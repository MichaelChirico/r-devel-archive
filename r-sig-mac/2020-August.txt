From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Aug  3 15:05:40 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 3 Aug 2020 09:05:40 -0400
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
Message-ID: <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>

I just got a message from someone else using Catalina 10.15.5 who still 
gets a crash from

library(rgl)
plot(1:10)

I don't have Catalina, and haven't seen it.  Has anyone else?

Duncan Murdoch

On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
> I upgraded last night to Catalina 10.15.5 (19F96).
> 
> The crash has gone away and that example now works normally.
> 
> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>>
>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>> No emacs/ESS involved.
>>
>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>
>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>> I attempted to update xquartz when I updated to Catalina, and the same
>>>> number is still the current version number.
>>>>
>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>> The interesting thing here is that rgl.quit() prevents rgl from being
>>>> reattached.
>>>
>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>> session:  detaching it doesn't clean up everything.  That's not
>>> something that I'd put any priority on fixing, whereas I would look at
>>> the problems you're having on startup if I could reproduce them.
>>>
>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR on
>>> the search list.  Do you have the same issues with plain R from the
>>> console, or R.app?
>>>
>>>> Is there an rgl equivalent for dev.cur()?
>>>
>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a Mac or
>>> Linux they'd be displayed as glX or null.  Windows also supports the
>>> null device (which doesn't display anything), and a different one to
>>> display within R:  I forget how the name is displayed.
>>>
>>> It might be that you'll need to set options(rgl.useNULL) before starting
>>> rgl, and only use the null device.  It won't display anything in R, but
>>> allows you to call rglwidget() for a display in a browser.
>>>
>>> Duncan Murdoch
>>>
>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>
>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>> I have the same Xquartz as you.
>>>>>
>>>>> I'd guess it should be updated.  Generally XQuartz needs updates with
>>>>> every MacOS release, and your 10.15.4 is two releases further along than
>>>>> my 10.13.6.
>>>>>
>>>>>> I have rgl-0.100.50 from CRAN
>>>>>
>>>>> You could update that, but I doubt if it would make any difference.
>>>>>
>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>> Do you need hardware information?
>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>
>>>>> I think the XQuartz issue is most likely to help, but if it doesn't, I'm
>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>
>>>>> Duncan Murdoch
>>>>>>
>>>>>>
>>>>>> from the Terminal App:
>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>> I didn't send it to Apple.
>>>>>>
>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>
>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>
>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>
>>>>>>
>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>
>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>
>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>
>>>>>>
>>>>>>      Natural language support but running in an English locale
>>>>>>
>>>>>>
>>>>>> R is a collaborative project with many contributors.
>>>>>>
>>>>>> Type 'contributors()' for more information and
>>>>>>
>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>
>>>>>>
>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>
>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>
>>>>>> Type 'q()' to quit R.
>>>>>>
>>>>>>
>>>>>>> library(rgl)
>>>>>>
>>>>>>> plot(1:10)
>>>>>>
>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure in BOOL NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>
>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app due to
>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>
>>>>>> *** First throw call stack:
>>>>>>
>>>>>> (
>>>>>>
>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>> __exceptionPreprocess + 250
>>>>>>
>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>> objc_exception_throw + 48
>>>>>>
>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>
>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>> -[NSAssertionHandler
>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>
>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>> 361
>>>>>>
>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>
>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>
>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>
>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>
>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>> dockClientNotificationProc + 217
>>>>>>
>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>> 1002
>>>>>>
>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>
>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>
>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>> SLEventCreateNextEvent + 136
>>>>>>
>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>
>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>> _dispatch_client_callout + 8
>>>>>>
>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>> _dispatch_continuation_pop + 414
>>>>>>
>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>> _dispatch_source_invoke + 2084
>>>>>>
>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>
>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>> _dispatch_lane_invoke + 363
>>>>>>
>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>
>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>> _pthread_wqthread + 290
>>>>>>
>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>
>>>>>> )
>>>>>>
>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>
>>>>>> zsh: abort      R
>>>>>>
>>>>>> rmh at rmhs-Air ~ %
>>>>>>
>>>>>>
>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>
>>>>>>> I'm not seeing that with R-patched r78557, run from the console.  I'm
>>>>>>> not sure I have the same MacOS version as you (R prints the same thing,
>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary of rgl
>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  I'm not
>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine is "XQuartz
>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>
>>>>>>> Duncan Murdoch
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>
>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>
>>>>>>>>       Natural language support but running in an English locale
>>>>>>>>
>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>> Type 'contributors()' for more information and
>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>
>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>> Type 'q()' to quit R.
>>>>>>>>
>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>> version
>>>>>>>>                    _
>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>> arch           x86_64
>>>>>>>> os             darwin17.0
>>>>>>>> system         x86_64, darwin17.0
>>>>>>>> status
>>>>>>>> major          4
>>>>>>>> minor          0.0
>>>>>>>> year           2020
>>>>>>>> month          04
>>>>>>>> day            24
>>>>>>>> svn rev        78286
>>>>>>>> language       R
>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>> nickname       Arbor Day
>>>>>>>>>
>>>>>>>>> library(rgl)
>>>>>>>>> plot(1:10)
>>>>>>>>>
>>>>>>>>
>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion failure in BOOL
>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app due to
>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>> *** First throw call stack:
>>>>>>>> (
>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>> __exceptionPreprocess + 250
>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>> objc_exception_throw + 48
>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>> -[NSAssertionHandler
>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>> 361
>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>> dockClientNotificationProc + 217
>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>> 1002
>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>> _dispatch_client_callout + 8
>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>> _pthread_wqthread + 290
>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>> )
>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-SIG-Mac mailing list
>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>
>>>>>>>
>>>>>
>>>


From m@rc_@chw@rtz @end|ng |rom me@com  Mon Aug  3 15:21:50 2020
From: m@rc_@chw@rtz @end|ng |rom me@com (Marc Schwartz)
Date: Mon, 3 Aug 2020 09:21:50 -0400
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
Message-ID: <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>

Hi,

Just installed rgl and I get the same crash and error message from the original post below, running R from the CLI.

If I run R from within ESS (what I normally use), I get:

  Process R abort trap: 6 at Mon Aug  3 09:15:32 2020

If I run R from R.app (the default macOS GUI), the command runs fine and I get the graphic.

I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.

R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.

Regards,

Marc Schwartz


> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> I just got a message from someone else using Catalina 10.15.5 who still gets a crash from
> 
> library(rgl)
> plot(1:10)
> 
> I don't have Catalina, and haven't seen it.  Has anyone else?
> 
> Duncan Murdoch
> 
> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>> I upgraded last night to Catalina 10.15.5 (19F96).
>> The crash has gone away and that example now works normally.
>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>>> 
>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>> No emacs/ESS involved.
>>> 
>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>> 
>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>> I attempted to update xquartz when I updated to Catalina, and the same
>>>>> number is still the current version number.
>>>>> 
>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>> The interesting thing here is that rgl.quit() prevents rgl from being
>>>>> reattached.
>>>> 
>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>> session:  detaching it doesn't clean up everything.  That's not
>>>> something that I'd put any priority on fixing, whereas I would look at
>>>> the problems you're having on startup if I could reproduce them.
>>>> 
>>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR on
>>>> the search list.  Do you have the same issues with plain R from the
>>>> console, or R.app?
>>>> 
>>>>> Is there an rgl equivalent for dev.cur()?
>>>> 
>>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a Mac or
>>>> Linux they'd be displayed as glX or null.  Windows also supports the
>>>> null device (which doesn't display anything), and a different one to
>>>> display within R:  I forget how the name is displayed.
>>>> 
>>>> It might be that you'll need to set options(rgl.useNULL) before starting
>>>> rgl, and only use the null device.  It won't display anything in R, but
>>>> allows you to call rglwidget() for a display in a browser.
>>>> 
>>>> Duncan Murdoch
>>>> 
>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>> 
>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>> I have the same Xquartz as you.
>>>>>> 
>>>>>> I'd guess it should be updated.  Generally XQuartz needs updates with
>>>>>> every MacOS release, and your 10.15.4 is two releases further along than
>>>>>> my 10.13.6.
>>>>>> 
>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>> 
>>>>>> You could update that, but I doubt if it would make any difference.
>>>>>> 
>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>> Do you need hardware information?
>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>> 
>>>>>> I think the XQuartz issue is most likely to help, but if it doesn't, I'm
>>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>> 
>>>>>> Duncan Murdoch
>>>>>>> 
>>>>>>> 
>>>>>>> from the Terminal App:
>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>> I didn't send it to Apple.
>>>>>>> 
>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>> 
>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>> 
>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>> 
>>>>>>> 
>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>> 
>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>> 
>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>> 
>>>>>>> 
>>>>>>>     Natural language support but running in an English locale
>>>>>>> 
>>>>>>> 
>>>>>>> R is a collaborative project with many contributors.
>>>>>>> 
>>>>>>> Type 'contributors()' for more information and
>>>>>>> 
>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>> 
>>>>>>> 
>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>> 
>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>> 
>>>>>>> Type 'q()' to quit R.
>>>>>>> 
>>>>>>> 
>>>>>>>> library(rgl)
>>>>>>> 
>>>>>>>> plot(1:10)
>>>>>>> 
>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure in BOOL NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>> 
>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app due to
>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>> 
>>>>>>> *** First throw call stack:
>>>>>>> 
>>>>>>> (
>>>>>>> 
>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>> __exceptionPreprocess + 250
>>>>>>> 
>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>> objc_exception_throw + 48
>>>>>>> 
>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>> 
>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>> -[NSAssertionHandler
>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>> 
>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>> 361
>>>>>>> 
>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>> 
>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>> 
>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>> 
>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>> 
>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>> dockClientNotificationProc + 217
>>>>>>> 
>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>> 1002
>>>>>>> 
>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>> 
>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>> 
>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>> SLEventCreateNextEvent + 136
>>>>>>> 
>>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>> 
>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>> _dispatch_client_callout + 8
>>>>>>> 
>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>> _dispatch_continuation_pop + 414
>>>>>>> 
>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>> _dispatch_source_invoke + 2084
>>>>>>> 
>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>> 
>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>> _dispatch_lane_invoke + 363
>>>>>>> 
>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>> 
>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>> _pthread_wqthread + 290
>>>>>>> 
>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>> 
>>>>>>> )
>>>>>>> 
>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>> 
>>>>>>> zsh: abort      R
>>>>>>> 
>>>>>>> rmh at rmhs-Air ~ %
>>>>>>> 
>>>>>>> 
>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>> 
>>>>>>>> I'm not seeing that with R-patched r78557, run from the console.  I'm
>>>>>>>> not sure I have the same MacOS version as you (R prints the same thing,
>>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary of rgl
>>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  I'm not
>>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine is "XQuartz
>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>> 
>>>>>>>> Duncan Murdoch
>>>>>>>> 
>>>>>>>> 
>>>>>>>> 
>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>> 
>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>> 
>>>>>>>>>      Natural language support but running in an English locale
>>>>>>>>> 
>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>> 
>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>> 
>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>> version
>>>>>>>>>                   _
>>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>>> arch           x86_64
>>>>>>>>> os             darwin17.0
>>>>>>>>> system         x86_64, darwin17.0
>>>>>>>>> status
>>>>>>>>> major          4
>>>>>>>>> minor          0.0
>>>>>>>>> year           2020
>>>>>>>>> month          04
>>>>>>>>> day            24
>>>>>>>>> svn rev        78286
>>>>>>>>> language       R
>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>> nickname       Arbor Day
>>>>>>>>>> 
>>>>>>>>>> library(rgl)
>>>>>>>>>> plot(1:10)
>>>>>>>>>> 
>>>>>>>>> 
>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion failure in BOOL
>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app due to
>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>> *** First throw call stack:
>>>>>>>>> (
>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>> objc_exception_throw + 48
>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>> -[NSAssertionHandler
>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>> 361
>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>> 1002
>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>> )
>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>> 
>>>>>>>>> _______________________________________________
>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>> 
>>>>>>>> 
>>>>>> 
>>>> 
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Aug  3 15:25:40 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 3 Aug 2020 09:25:40 -0400
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
Message-ID: <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>

Thanks.  Looks like I should update.  I'm looking forward to the crashes...

Duncan Murdoch

On 03/08/2020 9:21 a.m., Marc Schwartz wrote:
> Hi,
> 
> Just installed rgl and I get the same crash and error message from the original post below, running R from the CLI.
> 
> If I run R from within ESS (what I normally use), I get:
> 
>    Process R abort trap: 6 at Mon Aug  3 09:15:32 2020
> 
> If I run R from R.app (the default macOS GUI), the command runs fine and I get the graphic.
> 
> I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.
> 
> R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.
> 
> Regards,
> 
> Marc Schwartz
> 
> 
>> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>> I just got a message from someone else using Catalina 10.15.5 who still gets a crash from
>>
>> library(rgl)
>> plot(1:10)
>>
>> I don't have Catalina, and haven't seen it.  Has anyone else?
>>
>> Duncan Murdoch
>>
>> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>>> I upgraded last night to Catalina 10.15.5 (19F96).
>>> The crash has gone away and that example now works normally.
>>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>>>>
>>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>>> No emacs/ESS involved.
>>>>
>>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>
>>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>>> I attempted to update xquartz when I updated to Catalina, and the same
>>>>>> number is still the current version number.
>>>>>>
>>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>>> The interesting thing here is that rgl.quit() prevents rgl from being
>>>>>> reattached.
>>>>>
>>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>>> session:  detaching it doesn't clean up everything.  That's not
>>>>> something that I'd put any priority on fixing, whereas I would look at
>>>>> the problems you're having on startup if I could reproduce them.
>>>>>
>>>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR on
>>>>> the search list.  Do you have the same issues with plain R from the
>>>>> console, or R.app?
>>>>>
>>>>>> Is there an rgl equivalent for dev.cur()?
>>>>>
>>>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a Mac or
>>>>> Linux they'd be displayed as glX or null.  Windows also supports the
>>>>> null device (which doesn't display anything), and a different one to
>>>>> display within R:  I forget how the name is displayed.
>>>>>
>>>>> It might be that you'll need to set options(rgl.useNULL) before starting
>>>>> rgl, and only use the null device.  It won't display anything in R, but
>>>>> allows you to call rglwidget() for a display in a browser.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>
>>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>>> I have the same Xquartz as you.
>>>>>>>
>>>>>>> I'd guess it should be updated.  Generally XQuartz needs updates with
>>>>>>> every MacOS release, and your 10.15.4 is two releases further along than
>>>>>>> my 10.13.6.
>>>>>>>
>>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>>>
>>>>>>> You could update that, but I doubt if it would make any difference.
>>>>>>>
>>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>>> Do you need hardware information?
>>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>>>
>>>>>>> I think the XQuartz issue is most likely to help, but if it doesn't, I'm
>>>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>>>
>>>>>>> Duncan Murdoch
>>>>>>>>
>>>>>>>>
>>>>>>>> from the Terminal App:
>>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>>> I didn't send it to Apple.
>>>>>>>>
>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>
>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>
>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>
>>>>>>>>
>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>
>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>
>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>
>>>>>>>>
>>>>>>>>      Natural language support but running in an English locale
>>>>>>>>
>>>>>>>>
>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>
>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>
>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>
>>>>>>>>
>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>
>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>
>>>>>>>> Type 'q()' to quit R.
>>>>>>>>
>>>>>>>>
>>>>>>>>> library(rgl)
>>>>>>>>
>>>>>>>>> plot(1:10)
>>>>>>>>
>>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure in BOOL NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>
>>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app due to
>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>
>>>>>>>> *** First throw call stack:
>>>>>>>>
>>>>>>>> (
>>>>>>>>
>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>
>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>> objc_exception_throw + 48
>>>>>>>>
>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>
>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>> -[NSAssertionHandler
>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>
>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>> 361
>>>>>>>>
>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>
>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>
>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>
>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>
>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>
>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>> 1002
>>>>>>>>
>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>
>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>
>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>
>>>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>
>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>
>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>
>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>
>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>
>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>
>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>
>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>> _pthread_wqthread + 290
>>>>>>>>
>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>
>>>>>>>> )
>>>>>>>>
>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>
>>>>>>>> zsh: abort      R
>>>>>>>>
>>>>>>>> rmh at rmhs-Air ~ %
>>>>>>>>
>>>>>>>>
>>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>> I'm not seeing that with R-patched r78557, run from the console.  I'm
>>>>>>>>> not sure I have the same MacOS version as you (R prints the same thing,
>>>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary of rgl
>>>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  I'm not
>>>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine is "XQuartz
>>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>>>
>>>>>>>>> Duncan Murdoch
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>
>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>
>>>>>>>>>>       Natural language support but running in an English locale
>>>>>>>>>>
>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>
>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>
>>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>>> version
>>>>>>>>>>                    _
>>>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>>>> arch           x86_64
>>>>>>>>>> os             darwin17.0
>>>>>>>>>> system         x86_64, darwin17.0
>>>>>>>>>> status
>>>>>>>>>> major          4
>>>>>>>>>> minor          0.0
>>>>>>>>>> year           2020
>>>>>>>>>> month          04
>>>>>>>>>> day            24
>>>>>>>>>> svn rev        78286
>>>>>>>>>> language       R
>>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>>> nickname       Arbor Day
>>>>>>>>>>>
>>>>>>>>>>> library(rgl)
>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion failure in BOOL
>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app due to
>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>> *** First throw call stack:
>>>>>>>>>> (
>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>> 361
>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>> 1002
>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>> )
>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>>>
>>>>>>>>>
>>>>>>>
>>>>>
>>
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>


From p@tr|ck@@chr@tz @end|ng |rom gm@||@com  Mon Aug  3 15:28:59 2020
From: p@tr|ck@@chr@tz @end|ng |rom gm@||@com (Patrick Schratz)
Date: Mon, 03 Aug 2020 15:28:59 +0200
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
Message-ID: <BEFD9E4B-A1F4-4239-B34E-2E1AD20496EC@gmail.com>

Works fine in both RStudio and in the terminal for me (10.15.6).

R 4.0.2, official binary

On 3 Aug 2020, at 15:21, Marc Schwartz via R-SIG-Mac wrote:

> Hi,
>
> Just installed rgl and I get the same crash and error message from the 
> original post below, running R from the CLI.
>
> If I run R from within ESS (what I normally use), I get:
>
>   Process R abort trap: 6 at Mon Aug  3 09:15:32 2020
>
> If I run R from R.app (the default macOS GUI), the command runs fine 
> and I get the graphic.
>
> I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.
>
> R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.
>
> Regards,
>
> Marc Schwartz
>
>
>> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch <murdoch.duncan at gmail.com> 
>> wrote:
>>
>> I just got a message from someone else using Catalina 10.15.5 who 
>> still gets a crash from
>>
>> library(rgl)
>> plot(1:10)
>>
>> I don't have Catalina, and haven't seen it.  Has anyone else?
>>
>> Duncan Murdoch
>>
>> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>>> I upgraded last night to Catalina 10.15.5 (19F96).
>>> The crash has gone away and that example now works normally.
>>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger 
>>> <rmh at temple.edu> wrote:
>>>>
>>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>>> No emacs/ESS involved.
>>>>
>>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch 
>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>
>>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>>> I attempted to update xquartz when I updated to Catalina, and the 
>>>>>> same
>>>>>> number is still the current version number.
>>>>>>
>>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>>> The interesting thing here is that rgl.quit() prevents rgl from 
>>>>>> being
>>>>>> reattached.
>>>>>
>>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>>> session:  detaching it doesn't clean up everything.  That's not
>>>>> something that I'd put any priority on fixing, whereas I would 
>>>>> look at
>>>>> the problems you're having on startup if I could reproduce them.
>>>>>
>>>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR 
>>>>> on
>>>>> the search list.  Do you have the same issues with plain R from 
>>>>> the
>>>>> console, or R.app?
>>>>>
>>>>>> Is there an rgl equivalent for dev.cur()?
>>>>>
>>>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a 
>>>>> Mac or
>>>>> Linux they'd be displayed as glX or null.  Windows also supports 
>>>>> the
>>>>> null device (which doesn't display anything), and a different one 
>>>>> to
>>>>> display within R:  I forget how the name is displayed.
>>>>>
>>>>> It might be that you'll need to set options(rgl.useNULL) before 
>>>>> starting
>>>>> rgl, and only use the null device.  It won't display anything in 
>>>>> R, but
>>>>> allows you to call rglwidget() for a display in a browser.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch 
>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>
>>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>>> I have the same Xquartz as you.
>>>>>>>
>>>>>>> I'd guess it should be updated.  Generally XQuartz needs updates 
>>>>>>> with
>>>>>>> every MacOS release, and your 10.15.4 is two releases further 
>>>>>>> along than
>>>>>>> my 10.13.6.
>>>>>>>
>>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>>>
>>>>>>> You could update that, but I doubt if it would make any 
>>>>>>> difference.
>>>>>>>
>>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>>> Do you need hardware information?
>>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>>>
>>>>>>> I think the XQuartz issue is most likely to help, but if it 
>>>>>>> doesn't, I'm
>>>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>>>
>>>>>>> Duncan Murdoch
>>>>>>>>
>>>>>>>>
>>>>>>>> from the Terminal App:
>>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>>> I didn't send it to Apple.
>>>>>>>>
>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>
>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>
>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>
>>>>>>>>
>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>
>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>
>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>
>>>>>>>>
>>>>>>>>     Natural language support but running in an English locale
>>>>>>>>
>>>>>>>>
>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>
>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>
>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>
>>>>>>>>
>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>
>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>
>>>>>>>> Type 'q()' to quit R.
>>>>>>>>
>>>>>>>>
>>>>>>>>> library(rgl)
>>>>>>>>
>>>>>>>>> plot(1:10)
>>>>>>>>
>>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure 
>>>>>>>>> in BOOL 
>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), 
>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>
>>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app 
>>>>>>>> due to
>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>
>>>>>>>> *** First throw call stack:
>>>>>>>>
>>>>>>>> (
>>>>>>>>
>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>
>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>> objc_exception_throw + 48
>>>>>>>>
>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>
>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>> -[NSAssertionHandler
>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>
>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>> +[_NSScreenConfiguration 
>>>>>>>> invalidateConfigurationIfNeededForReason:] +
>>>>>>>> 361
>>>>>>>>
>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>
>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>
>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>
>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>
>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>
>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ 
>>>>>>>> +
>>>>>>>> 1002
>>>>>>>>
>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>
>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>
>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>
>>>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>
>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>
>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>
>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>
>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>
>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>
>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>
>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>> _pthread_wqthread + 290
>>>>>>>>
>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 
>>>>>>>> start_wqthread + 15
>>>>>>>>
>>>>>>>> )
>>>>>>>>
>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type 
>>>>>>>> NSException
>>>>>>>>
>>>>>>>> zsh: abort      R
>>>>>>>>
>>>>>>>> rmh at rmhs-Air ~ %
>>>>>>>>
>>>>>>>>
>>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>> I'm not seeing that with R-patched r78557, run from the 
>>>>>>>>> console.  I'm
>>>>>>>>> not sure I have the same MacOS version as you (R prints the 
>>>>>>>>> same thing,
>>>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary 
>>>>>>>>> of rgl
>>>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  
>>>>>>>>> I'm not
>>>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine 
>>>>>>>>> is "XQuartz
>>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>>>
>>>>>>>>> Duncan Murdoch
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>
>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>
>>>>>>>>>>      Natural language support but running in an English 
>>>>>>>>>> locale
>>>>>>>>>>
>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>
>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>
>>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 
>>>>>>>>>>> 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", 
>>>>>>>>>>> editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>>> version
>>>>>>>>>>                   _
>>>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>>>> arch           x86_64
>>>>>>>>>> os             darwin17.0
>>>>>>>>>> system         x86_64, darwin17.0
>>>>>>>>>> status
>>>>>>>>>> major          4
>>>>>>>>>> minor          0.0
>>>>>>>>>> year           2020
>>>>>>>>>> month          04
>>>>>>>>>> day            24
>>>>>>>>>> svn rev        78286
>>>>>>>>>> language       R
>>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>>> nickname       Arbor Day
>>>>>>>>>>>
>>>>>>>>>>> library(rgl)
>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion 
>>>>>>>>>> failure in BOOL
>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app 
>>>>>>>>>> due to
>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', 
>>>>>>>>>> reason:
>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>> *** First throw call stack:
>>>>>>>>>> (
>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>> +[_NSScreenConfiguration 
>>>>>>>>>> invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>> 361
>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 
>>>>>>>>>> 243
>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ 
>>>>>>>>>> +
>>>>>>>>>> 1002
>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 
>>>>>>>>>> start_wqthread + 15
>>>>>>>>>> )
>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type 
>>>>>>>>>> NSException
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>>>
>>>>>>>>>
>>>>>>>
>>>>>
>>
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Aug  3 18:54:18 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 3 Aug 2020 12:54:18 -0400
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
 <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
Message-ID: <7cdfbcc2-dfac-c7ae-4f6a-467b06bee269@gmail.com>

With great trepidation, I installed Catalina.  I saw the same crash as 
reported.  Then I reinstalled Xquartz, shut down the Xquartz that was 
still running (should have done that in the other order!), and tried 
again:  no crash.  Hope it stays fixed!

Duncan Murdoch

On 03/08/2020 9:25 a.m., Duncan Murdoch wrote:
> Thanks.  Looks like I should update.  I'm looking forward to the crashes...
> 
> Duncan Murdoch
> 
> On 03/08/2020 9:21 a.m., Marc Schwartz wrote:
>> Hi,
>>
>> Just installed rgl and I get the same crash and error message from the original post below, running R from the CLI.
>>
>> If I run R from within ESS (what I normally use), I get:
>>
>>     Process R abort trap: 6 at Mon Aug  3 09:15:32 2020
>>
>> If I run R from R.app (the default macOS GUI), the command runs fine and I get the graphic.
>>
>> I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.
>>
>> R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.
>>
>> Regards,
>>
>> Marc Schwartz
>>
>>
>>> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>
>>> I just got a message from someone else using Catalina 10.15.5 who still gets a crash from
>>>
>>> library(rgl)
>>> plot(1:10)
>>>
>>> I don't have Catalina, and haven't seen it.  Has anyone else?
>>>
>>> Duncan Murdoch
>>>
>>> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>>>> I upgraded last night to Catalina 10.15.5 (19F96).
>>>> The crash has gone away and that example now works normally.
>>>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>>>>>
>>>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>>>> No emacs/ESS involved.
>>>>>
>>>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>
>>>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>>>> I attempted to update xquartz when I updated to Catalina, and the same
>>>>>>> number is still the current version number.
>>>>>>>
>>>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>>>> The interesting thing here is that rgl.quit() prevents rgl from being
>>>>>>> reattached.
>>>>>>
>>>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>>>> session:  detaching it doesn't clean up everything.  That's not
>>>>>> something that I'd put any priority on fixing, whereas I would look at
>>>>>> the problems you're having on startup if I could reproduce them.
>>>>>>
>>>>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR on
>>>>>> the search list.  Do you have the same issues with plain R from the
>>>>>> console, or R.app?
>>>>>>
>>>>>>> Is there an rgl equivalent for dev.cur()?
>>>>>>
>>>>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a Mac or
>>>>>> Linux they'd be displayed as glX or null.  Windows also supports the
>>>>>> null device (which doesn't display anything), and a different one to
>>>>>> display within R:  I forget how the name is displayed.
>>>>>>
>>>>>> It might be that you'll need to set options(rgl.useNULL) before starting
>>>>>> rgl, and only use the null device.  It won't display anything in R, but
>>>>>> allows you to call rglwidget() for a display in a browser.
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>>
>>>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>>>> I have the same Xquartz as you.
>>>>>>>>
>>>>>>>> I'd guess it should be updated.  Generally XQuartz needs updates with
>>>>>>>> every MacOS release, and your 10.15.4 is two releases further along than
>>>>>>>> my 10.13.6.
>>>>>>>>
>>>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>>>>
>>>>>>>> You could update that, but I doubt if it would make any difference.
>>>>>>>>
>>>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>>>> Do you need hardware information?
>>>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>>>>
>>>>>>>> I think the XQuartz issue is most likely to help, but if it doesn't, I'm
>>>>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>>>>
>>>>>>>> Duncan Murdoch
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> from the Terminal App:
>>>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>>>> I didn't send it to Apple.
>>>>>>>>>
>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>
>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>
>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>
>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>
>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>       Natural language support but running in an English locale
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>
>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>
>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>
>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>
>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>> library(rgl)
>>>>>>>>>
>>>>>>>>>> plot(1:10)
>>>>>>>>>
>>>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure in BOOL NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>
>>>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app due to
>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>
>>>>>>>>> *** First throw call stack:
>>>>>>>>>
>>>>>>>>> (
>>>>>>>>>
>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>
>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>
>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>
>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>> -[NSAssertionHandler
>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>
>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>> 361
>>>>>>>>>
>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>
>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>
>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>
>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>
>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>
>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>> 1002
>>>>>>>>>
>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>
>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>
>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>
>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>
>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>
>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>
>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>
>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>
>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>
>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>
>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>
>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>
>>>>>>>>> )
>>>>>>>>>
>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>
>>>>>>>>> zsh: abort      R
>>>>>>>>>
>>>>>>>>> rmh at rmhs-Air ~ %
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>>
>>>>>>>>>> I'm not seeing that with R-patched r78557, run from the console.  I'm
>>>>>>>>>> not sure I have the same MacOS version as you (R prints the same thing,
>>>>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary of rgl
>>>>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  I'm not
>>>>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine is "XQuartz
>>>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>>>>
>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>>
>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>>
>>>>>>>>>>>        Natural language support but running in an English locale
>>>>>>>>>>>
>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>>
>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>>
>>>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>>>> version
>>>>>>>>>>>                     _
>>>>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>>>>> arch           x86_64
>>>>>>>>>>> os             darwin17.0
>>>>>>>>>>> system         x86_64, darwin17.0
>>>>>>>>>>> status
>>>>>>>>>>> major          4
>>>>>>>>>>> minor          0.0
>>>>>>>>>>> year           2020
>>>>>>>>>>> month          04
>>>>>>>>>>> day            24
>>>>>>>>>>> svn rev        78286
>>>>>>>>>>> language       R
>>>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>>>> nickname       Arbor Day
>>>>>>>>>>>>
>>>>>>>>>>>> library(rgl)
>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion failure in BOOL
>>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app due to
>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>> (
>>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>> 361
>>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>>> 1002
>>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>> )
>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>
>>>>>>
>>>
>>> _______________________________________________
>>> R-SIG-Mac mailing list
>>> R-SIG-Mac at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Aug  3 20:44:31 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 3 Aug 2020 14:44:31 -0400
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <7cdfbcc2-dfac-c7ae-4f6a-467b06bee269@gmail.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
 <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
 <7cdfbcc2-dfac-c7ae-4f6a-467b06bee269@gmail.com>
Message-ID: <70880381-8027-1286-c489-577155a4aadd@gmail.com>

It didn't stay fixed.  I get crashes about half the time now.  I'll see 
if I can figure out what's going wrong.  My guess would be that rather 
than an rgl bug this is an Xquartz bug, but maybe I can find a way to 
prevent it.

Duncan Murdoch

On 03/08/2020 12:54 p.m., Duncan Murdoch wrote:
> With great trepidation, I installed Catalina.  I saw the same crash as
> reported.  Then I reinstalled Xquartz, shut down the Xquartz that was
> still running (should have done that in the other order!), and tried
> again:  no crash.  Hope it stays fixed!
> 
> Duncan Murdoch
> 
> On 03/08/2020 9:25 a.m., Duncan Murdoch wrote:
>> Thanks.  Looks like I should update.  I'm looking forward to the crashes...
>>
>> Duncan Murdoch
>>
>> On 03/08/2020 9:21 a.m., Marc Schwartz wrote:
>>> Hi,
>>>
>>> Just installed rgl and I get the same crash and error message from the original post below, running R from the CLI.
>>>
>>> If I run R from within ESS (what I normally use), I get:
>>>
>>>      Process R abort trap: 6 at Mon Aug  3 09:15:32 2020
>>>
>>> If I run R from R.app (the default macOS GUI), the command runs fine and I get the graphic.
>>>
>>> I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.
>>>
>>> R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.
>>>
>>> Regards,
>>>
>>> Marc Schwartz
>>>
>>>
>>>> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>
>>>> I just got a message from someone else using Catalina 10.15.5 who still gets a crash from
>>>>
>>>> library(rgl)
>>>> plot(1:10)
>>>>
>>>> I don't have Catalina, and haven't seen it.  Has anyone else?
>>>>
>>>> Duncan Murdoch
>>>>
>>>> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>>>>> I upgraded last night to Catalina 10.15.5 (19F96).
>>>>> The crash has gone away and that example now works normally.
>>>>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>>>>>>
>>>>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>>>>> No emacs/ESS involved.
>>>>>>
>>>>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>
>>>>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>>>>> I attempted to update xquartz when I updated to Catalina, and the same
>>>>>>>> number is still the current version number.
>>>>>>>>
>>>>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>>>>> The interesting thing here is that rgl.quit() prevents rgl from being
>>>>>>>> reattached.
>>>>>>>
>>>>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>>>>> session:  detaching it doesn't clean up everything.  That's not
>>>>>>> something that I'd put any priority on fixing, whereas I would look at
>>>>>>> the problems you're having on startup if I could reproduce them.
>>>>>>>
>>>>>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR on
>>>>>>> the search list.  Do you have the same issues with plain R from the
>>>>>>> console, or R.app?
>>>>>>>
>>>>>>>> Is there an rgl equivalent for dev.cur()?
>>>>>>>
>>>>>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a Mac or
>>>>>>> Linux they'd be displayed as glX or null.  Windows also supports the
>>>>>>> null device (which doesn't display anything), and a different one to
>>>>>>> display within R:  I forget how the name is displayed.
>>>>>>>
>>>>>>> It might be that you'll need to set options(rgl.useNULL) before starting
>>>>>>> rgl, and only use the null device.  It won't display anything in R, but
>>>>>>> allows you to call rglwidget() for a display in a browser.
>>>>>>>
>>>>>>> Duncan Murdoch
>>>>>>>
>>>>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>>>>> I have the same Xquartz as you.
>>>>>>>>>
>>>>>>>>> I'd guess it should be updated.  Generally XQuartz needs updates with
>>>>>>>>> every MacOS release, and your 10.15.4 is two releases further along than
>>>>>>>>> my 10.13.6.
>>>>>>>>>
>>>>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>>>>>
>>>>>>>>> You could update that, but I doubt if it would make any difference.
>>>>>>>>>
>>>>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>>>>> Do you need hardware information?
>>>>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>>>>>
>>>>>>>>> I think the XQuartz issue is most likely to help, but if it doesn't, I'm
>>>>>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>>>>>
>>>>>>>>> Duncan Murdoch
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> from the Terminal App:
>>>>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>>>>> I didn't send it to Apple.
>>>>>>>>>>
>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>
>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>
>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>
>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>
>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>        Natural language support but running in an English locale
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>
>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>
>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>
>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>
>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>> library(rgl)
>>>>>>>>>>
>>>>>>>>>>> plot(1:10)
>>>>>>>>>>
>>>>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure in BOOL NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>
>>>>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app due to
>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>
>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>
>>>>>>>>>> (
>>>>>>>>>>
>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>
>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>
>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>
>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>
>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>> 361
>>>>>>>>>>
>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>
>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>
>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>
>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>
>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>
>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>> 1002
>>>>>>>>>>
>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>
>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>
>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>
>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>
>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>
>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>
>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>
>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>
>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>
>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>
>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>
>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>
>>>>>>>>>> )
>>>>>>>>>>
>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>
>>>>>>>>>> zsh: abort      R
>>>>>>>>>>
>>>>>>>>>> rmh at rmhs-Air ~ %
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>>>
>>>>>>>>>>> I'm not seeing that with R-patched r78557, run from the console.  I'm
>>>>>>>>>>> not sure I have the same MacOS version as you (R prints the same thing,
>>>>>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary of rgl
>>>>>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  I'm not
>>>>>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine is "XQuartz
>>>>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>>>>>
>>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>>>
>>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>>>
>>>>>>>>>>>>         Natural language support but running in an English locale
>>>>>>>>>>>>
>>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>>>
>>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>>>
>>>>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>>>>> version
>>>>>>>>>>>>                      _
>>>>>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>>>>>> arch           x86_64
>>>>>>>>>>>> os             darwin17.0
>>>>>>>>>>>> system         x86_64, darwin17.0
>>>>>>>>>>>> status
>>>>>>>>>>>> major          4
>>>>>>>>>>>> minor          0.0
>>>>>>>>>>>> year           2020
>>>>>>>>>>>> month          04
>>>>>>>>>>>> day            24
>>>>>>>>>>>> svn rev        78286
>>>>>>>>>>>> language       R
>>>>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>>>>> nickname       Arbor Day
>>>>>>>>>>>>>
>>>>>>>>>>>>> library(rgl)
>>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion failure in BOOL
>>>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app due to
>>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>>> (
>>>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>>> 361
>>>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>>>> 1002
>>>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>>> )
>>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>>>
>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>
>>>>>>>
>>>>
>>>> _______________________________________________
>>>> R-SIG-Mac mailing list
>>>> R-SIG-Mac at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>
>>
>


From r|p|ey @end|ng |rom @t@t@@ox@@c@uk  Mon Aug  3 20:51:25 2020
From: r|p|ey @end|ng |rom @t@t@@ox@@c@uk (Brian Ripley)
Date: Mon, 3 Aug 2020 19:51:25 +0100
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <70880381-8027-1286-c489-577155a4aadd@gmail.com>
References: <70880381-8027-1286-c489-577155a4aadd@gmail.com>
Message-ID: <B5488BD7-5E09-41E7-A0AC-0721B9AF85A2@stats.ox.ac.uk>



> On 3 Aug 2020, at 19:45, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> ?It didn't stay fixed.  I get crashes about half the time now.  I'll see if I can figure out what's going wrong.  My guess would be that rather than an rgl bug this is an Xquartz bug, but maybe I can find a way to prevent it.

Unfortunately XQuartz has not been updated for nearly 4 years, so I don?t hold any hope it will get fixed there.

You are right to point out that XQuartz often needs reinstalling after a macOS update ? sometimes even a minor one.

> 
> Duncan Murdoch
> 
>> On 03/08/2020 12:54 p.m., Duncan Murdoch wrote:
>> With great trepidation, I installed Catalina.  I saw the same crash as
>> reported.  Then I reinstalled Xquartz, shut down the Xquartz that was
>> still running (should have done that in the other order!), and tried
>> again:  no crash.  Hope it stays fixed!
>> Duncan Murdoch
>>> On 03/08/2020 9:25 a.m., Duncan Murdoch wrote:
>>> Thanks.  Looks like I should update.  I'm looking forward to the crashes...
>>> 
>>> Duncan Murdoch
>>> 
>>> On 03/08/2020 9:21 a.m., Marc Schwartz wrote:
>>>> Hi,
>>>> 
>>>> Just installed rgl and I get the same crash and error message from the original post below, running R from the CLI.
>>>> 
>>>> If I run R from within ESS (what I normally use), I get:
>>>> 
>>>>     Process R abort trap: 6 at Mon Aug  3 09:15:32 2020
>>>> 
>>>> If I run R from R.app (the default macOS GUI), the command runs fine and I get the graphic.
>>>> 
>>>> I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.
>>>> 
>>>> R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.
>>>> 
>>>> Regards,
>>>> 
>>>> Marc Schwartz
>>>> 
>>>> 
>>>>> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>> 
>>>>> I just got a message from someone else using Catalina 10.15.5 who still gets a crash from
>>>>> 
>>>>> library(rgl)
>>>>> plot(1:10)
>>>>> 
>>>>> I don't have Catalina, and haven't seen it.  Has anyone else?
>>>>> 
>>>>> Duncan Murdoch
>>>>> 
>>>>> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>>>>>> I upgraded last night to Catalina 10.15.5 (19F96).
>>>>>> The crash has gone away and that example now works normally.
>>>>>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>>>>>>> 
>>>>>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>>>>>> No emacs/ESS involved.
>>>>>>> 
>>>>>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>> 
>>>>>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>>>>>> I attempted to update xquartz when I updated to Catalina, and the same
>>>>>>>>> number is still the current version number.
>>>>>>>>> 
>>>>>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>>>>>> The interesting thing here is that rgl.quit() prevents rgl from being
>>>>>>>>> reattached.
>>>>>>>> 
>>>>>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>>>>>> session:  detaching it doesn't clean up everything.  That's not
>>>>>>>> something that I'd put any priority on fixing, whereas I would look at
>>>>>>>> the problems you're having on startup if I could reproduce them.
>>>>>>>> 
>>>>>>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR on
>>>>>>>> the search list.  Do you have the same issues with plain R from the
>>>>>>>> console, or R.app?
>>>>>>>> 
>>>>>>>>> Is there an rgl equivalent for dev.cur()?
>>>>>>>> 
>>>>>>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a Mac or
>>>>>>>> Linux they'd be displayed as glX or null.  Windows also supports the
>>>>>>>> null device (which doesn't display anything), and a different one to
>>>>>>>> display within R:  I forget how the name is displayed.
>>>>>>>> 
>>>>>>>> It might be that you'll need to set options(rgl.useNULL) before starting
>>>>>>>> rgl, and only use the null device.  It won't display anything in R, but
>>>>>>>> allows you to call rglwidget() for a display in a browser.
>>>>>>>> 
>>>>>>>> Duncan Murdoch
>>>>>>>> 
>>>>>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>> 
>>>>>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>>>>>> I have the same Xquartz as you.
>>>>>>>>>> 
>>>>>>>>>> I'd guess it should be updated.  Generally XQuartz needs updates with
>>>>>>>>>> every MacOS release, and your 10.15.4 is two releases further along than
>>>>>>>>>> my 10.13.6.
>>>>>>>>>> 
>>>>>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>>>>>> 
>>>>>>>>>> You could update that, but I doubt if it would make any difference.
>>>>>>>>>> 
>>>>>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>>>>>> Do you need hardware information?
>>>>>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>>>>>> 
>>>>>>>>>> I think the XQuartz issue is most likely to help, but if it doesn't, I'm
>>>>>>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>>>>>> 
>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> from the Terminal App:
>>>>>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>>>>>> I didn't send it to Apple.
>>>>>>>>>>> 
>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>> 
>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>> 
>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>> 
>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>> 
>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>>       Natural language support but running in an English locale
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>> 
>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>> 
>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>> 
>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>> 
>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>>> library(rgl)
>>>>>>>>>>> 
>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>> 
>>>>>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure in BOOL NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>> 
>>>>>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app due to
>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>> 
>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>> 
>>>>>>>>>>> (
>>>>>>>>>>> 
>>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>> 
>>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>> 
>>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>> 
>>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>> 
>>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>> 361
>>>>>>>>>>> 
>>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>> 
>>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>> 
>>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>> 
>>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>> 
>>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>> 
>>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>>> 1002
>>>>>>>>>>> 
>>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>> 
>>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>> 
>>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>> 
>>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>> 
>>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>> 
>>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>> 
>>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>> 
>>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>> 
>>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>> 
>>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>> 
>>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>> 
>>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>> 
>>>>>>>>>>> )
>>>>>>>>>>> 
>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>> 
>>>>>>>>>>> zsh: abort      R
>>>>>>>>>>> 
>>>>>>>>>>> rmh at rmhs-Air ~ %
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>>>> 
>>>>>>>>>>>> I'm not seeing that with R-patched r78557, run from the console.  I'm
>>>>>>>>>>>> not sure I have the same MacOS version as you (R prints the same thing,
>>>>>>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary of rgl
>>>>>>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  I'm not
>>>>>>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine is "XQuartz
>>>>>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>>>>>> 
>>>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>>> 
>>>>>>>>>>>> 
>>>>>>>>>>>> 
>>>>>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>>>> 
>>>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>>>> 
>>>>>>>>>>>>>        Natural language support but running in an English locale
>>>>>>>>>>>>> 
>>>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>>>> 
>>>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>>>> 
>>>>>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>>>>>> version
>>>>>>>>>>>>>                     _
>>>>>>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>>>>>>> arch           x86_64
>>>>>>>>>>>>> os             darwin17.0
>>>>>>>>>>>>> system         x86_64, darwin17.0
>>>>>>>>>>>>> status
>>>>>>>>>>>>> major          4
>>>>>>>>>>>>> minor          0.0
>>>>>>>>>>>>> year           2020
>>>>>>>>>>>>> month          04
>>>>>>>>>>>>> day            24
>>>>>>>>>>>>> svn rev        78286
>>>>>>>>>>>>> language       R
>>>>>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>>>>>> nickname       Arbor Day
>>>>>>>>>>>>>> 
>>>>>>>>>>>>>> library(rgl)
>>>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>>>> 
>>>>>>>>>>>>> 
>>>>>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion failure in BOOL
>>>>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app due to
>>>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>>>> (
>>>>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>>>> 361
>>>>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>>>>> 1002
>>>>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>>>> )
>>>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>>>> 
>>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>>>>>> 
>>>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>> 
>>>>> 
>>>>> _______________________________________________
>>>>> R-SIG-Mac mailing list
>>>>> R-SIG-Mac at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>> 
>>> 
>> 
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From @|mon@urb@nek @end|ng |rom R-project@org  Mon Aug  3 22:34:33 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Tue, 4 Aug 2020 08:34:33 +1200
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <70880381-8027-1286-c489-577155a4aadd@gmail.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
 <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
 <7cdfbcc2-dfac-c7ae-4f6a-467b06bee269@gmail.com>
 <70880381-8027-1286-c489-577155a4aadd@gmail.com>
Message-ID: <2F02DA50-B09D-4E16-88AB-8B4B62A48139@R-project.org>

Duncan,

I have seen crashes in rgl with X11 before, in fact I have an e-mail in my draft folder to you with that crash and backtrace (see below). However, I also recall that I have fixed the issue with some trivial step (which I can't remember - I think I may have messed with /opt and/or restart X11 or something like that) and I felt silly not doing it so I didn't end up sending the report. The crash comes likely from
https://github.com/XQuartz/AppleSGLX/blob/master/apple_visual.c#L142
which means that CGLChoosePixelFormat() fails, but no idea why since it is in principle independent of X11 - there should be also an error on stderr. The libGL code is more than 10 years old, so I wouldn't expect any changes anytime soon.

Cheers,
Simon


Begin forwarded message:

From: Simon Urbanek <simon.urbanek at R-project.org>
Subject: rgl
Date: April 1, 2020 at 13:05:20 GMT+13
To: Duncan Murdoch <murdoch.duncan at gmail.com>

Duncan,

I'm preparing packages for R 4.0.0 release and rgl is segfaulting on load when DISPLAY is set (i.e. when X11 is available). Do you have any idea? (rgl 0.100.50)

I remember something about a way to use native GL instead of X11, but I can't recall how to activate that. If DISPLAY is not set, it uses a NULL device which doesn't segfault (obviously).

Thanks,
Simon


> library(rgl)
Process 54673 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGABRT
    frame #0: 0x00007fff5a145b66 libsystem_kernel.dylib`__pthread_kill + 10
libsystem_kernel.dylib`__pthread_kill:
->  0x7fff5a145b66 <+10>: jae    0x7fff5a145b70            ; <+20>
    0x7fff5a145b68 <+12>: movq   %rax, %rdi
    0x7fff5a145b6b <+15>: jmp    0x7fff5a13cae5            ; cerror_nocancel
    0x7fff5a145b70 <+20>: retq   
Target 0: (R) stopped.
(lldb) bt
* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGABRT
  * frame #0: 0x00007fff5a145b66 libsystem_kernel.dylib`__pthread_kill + 10
    frame #1: 0x00007fff5a310080 libsystem_pthread.dylib`pthread_kill + 333
    frame #2: 0x00007fff5a0a11ae libsystem_c.dylib`abort + 127
    frame #3: 0x00000001086e6aed libGL.1.dylib`apple_visual_create_pfobj + 1010
    frame #4: 0x00000001086e457b libGL.1.dylib`apple_glx_create_context + 204
    frame #5: 0x00000001086e15b9 libGL.1.dylib`applegl_create_context + 182
    frame #6: 0x00000001086c1377 libGL.1.dylib`CreateContext + 126
    frame #7: 0x00000001086c1288 libGL.1.dylib`glXCreateContext + 199
    frame #8: 0x00000001084e5b23 rgl.so`rgl::X11WindowImpl::X11WindowImpl(rgl::Window*, rgl::X11GUIFactory*, unsigned long, XVisualInfo*) [inlined] rgl::X11WindowImpl::initGL(this=0x000000010584fc00) at x11gui.cpp:335 [opt]
    frame #9: 0x00000001084e5b10 rgl.so`rgl::X11WindowImpl::X11WindowImpl(rgl::Window*, rgl::X11GUIFactory*, unsigned long, XVisualInfo*) [inlined] rgl::X11WindowImpl::on_init(this=0x000000010584fc00) at x11gui.cpp:411 [opt]
    frame #10: 0x00000001084e5b10 rgl.so`rgl::X11WindowImpl::X11WindowImpl(this=0x000000010584fc00, w=<unavailable>, f=0x000000010262c9b0, in_xwindow=10485763, invisualinfo=0x0000000100a6f560) at x11gui.cpp:78 [opt]
    frame #11: 0x00000001084e7610 rgl.so`rgl::X11GUIFactory::createWindowImpl(rgl::Window*) [inlined] rgl::X11WindowImpl::X11WindowImpl(this=<unavailable>, w=<unavailable>, f=<unavailable>, in_xwindow=<unavailable>, invisualinfo=<unavailable>) at x11gui.cpp:77 [opt]
    frame #12: 0x00000001084e75fa rgl.so`rgl::X11GUIFactory::createWindowImpl(this=<unavailable>, window=0x0000000100b33ba0) at x11gui.cpp:694 [opt]
    frame #13: 0x00000001084d9401 rgl.so`rgl::Window::Window(this=0x0000000100b33ba0, in_child=<unavailable>, factory=<unavailable>) at gui.cpp:147 [opt]
    frame #14: 0x00000001084c1dea rgl.so`rgl::Device::Device(this=0x0000000100b2d4c0, id=<unavailable>, useNULL=<unavailable>) at device.cpp:16 [opt]
    frame #15: 0x00000001084c28c5 rgl.so`rgl::DeviceManager::createTestWindow(this=0x0000000100b34880) at devicemanager.cpp:167 [opt]
    frame #16: 0x00000001084d9a9a rgl.so`::rgl_init(initValue=<unavailable>, useNULL=<unavailable>, in_namespace=<unavailable>, debug=<unavailable>) at init.cpp:94 [opt]
    frame #17: 0x000000010012b4cb libR.dylib`R_doDotCall(ofun=<unavailable>, nargs=<unavailable>, cargs=0x00007ffeefbef4e0, call=0x0000000101cc1618) at dotcode.c:607 [opt]
    frame #18: 0x000000010017738a libR.dylib`bcEval(body=0x0000000101cc1650, rho=0x0000000101cc1228, useCache=<unavailable>) at eval.c:7646 [opt]
    frame #19: 0x000000010015d141 libR.dylib`Rf_eval(e=<unavailable>, rho=<unavailable>) at eval.c:723 [opt]
    frame #20: 0x000000010017d601 libR.dylib`R_execClosure(call=0x00000001019f12b0, newrho=<unavailable>, sysparent=<unavailable>, rho=0x00000001019df6b8, arglist=<unavailable>, op=<unavailable>) at eval.c:0 [opt]





> On Aug 4, 2020, at 06:44, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> It didn't stay fixed.  I get crashes about half the time now.  I'll see if I can figure out what's going wrong.  My guess would be that rather than an rgl bug this is an Xquartz bug, but maybe I can find a way to prevent it.
> 
> Duncan Murdoch
> 
> On 03/08/2020 12:54 p.m., Duncan Murdoch wrote:
>> With great trepidation, I installed Catalina.  I saw the same crash as
>> reported.  Then I reinstalled Xquartz, shut down the Xquartz that was
>> still running (should have done that in the other order!), and tried
>> again:  no crash.  Hope it stays fixed!
>> Duncan Murdoch
>> On 03/08/2020 9:25 a.m., Duncan Murdoch wrote:
>>> Thanks.  Looks like I should update.  I'm looking forward to the crashes...
>>> 
>>> Duncan Murdoch
>>> 
>>> On 03/08/2020 9:21 a.m., Marc Schwartz wrote:
>>>> Hi,
>>>> 
>>>> Just installed rgl and I get the same crash and error message from the original post below, running R from the CLI.
>>>> 
>>>> If I run R from within ESS (what I normally use), I get:
>>>> 
>>>>     Process R abort trap: 6 at Mon Aug  3 09:15:32 2020
>>>> 
>>>> If I run R from R.app (the default macOS GUI), the command runs fine and I get the graphic.
>>>> 
>>>> I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.
>>>> 
>>>> R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.
>>>> 
>>>> Regards,
>>>> 
>>>> Marc Schwartz
>>>> 
>>>> 
>>>>> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>> 
>>>>> I just got a message from someone else using Catalina 10.15.5 who still gets a crash from
>>>>> 
>>>>> library(rgl)
>>>>> plot(1:10)
>>>>> 
>>>>> I don't have Catalina, and haven't seen it.  Has anyone else?
>>>>> 
>>>>> Duncan Murdoch
>>>>> 
>>>>> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>>>>>> I upgraded last night to Catalina 10.15.5 (19F96).
>>>>>> The crash has gone away and that example now works normally.
>>>>>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>>>>>>> 
>>>>>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>>>>>> No emacs/ESS involved.
>>>>>>> 
>>>>>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>> 
>>>>>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>>>>>> I attempted to update xquartz when I updated to Catalina, and the same
>>>>>>>>> number is still the current version number.
>>>>>>>>> 
>>>>>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>>>>>> The interesting thing here is that rgl.quit() prevents rgl from being
>>>>>>>>> reattached.
>>>>>>>> 
>>>>>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>>>>>> session:  detaching it doesn't clean up everything.  That's not
>>>>>>>> something that I'd put any priority on fixing, whereas I would look at
>>>>>>>> the problems you're having on startup if I could reproduce them.
>>>>>>>> 
>>>>>>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR on
>>>>>>>> the search list.  Do you have the same issues with plain R from the
>>>>>>>> console, or R.app?
>>>>>>>> 
>>>>>>>>> Is there an rgl equivalent for dev.cur()?
>>>>>>>> 
>>>>>>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a Mac or
>>>>>>>> Linux they'd be displayed as glX or null.  Windows also supports the
>>>>>>>> null device (which doesn't display anything), and a different one to
>>>>>>>> display within R:  I forget how the name is displayed.
>>>>>>>> 
>>>>>>>> It might be that you'll need to set options(rgl.useNULL) before starting
>>>>>>>> rgl, and only use the null device.  It won't display anything in R, but
>>>>>>>> allows you to call rglwidget() for a display in a browser.
>>>>>>>> 
>>>>>>>> Duncan Murdoch
>>>>>>>> 
>>>>>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>> 
>>>>>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>>>>>> I have the same Xquartz as you.
>>>>>>>>>> 
>>>>>>>>>> I'd guess it should be updated.  Generally XQuartz needs updates with
>>>>>>>>>> every MacOS release, and your 10.15.4 is two releases further along than
>>>>>>>>>> my 10.13.6.
>>>>>>>>>> 
>>>>>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>>>>>> 
>>>>>>>>>> You could update that, but I doubt if it would make any difference.
>>>>>>>>>> 
>>>>>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>>>>>> Do you need hardware information?
>>>>>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>>>>>> 
>>>>>>>>>> I think the XQuartz issue is most likely to help, but if it doesn't, I'm
>>>>>>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>>>>>> 
>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> from the Terminal App:
>>>>>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>>>>>> I didn't send it to Apple.
>>>>>>>>>>> 
>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>> 
>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>> 
>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>> 
>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>> 
>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>>       Natural language support but running in an English locale
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>> 
>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>> 
>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>> 
>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>> 
>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>>> library(rgl)
>>>>>>>>>>> 
>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>> 
>>>>>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure in BOOL NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>> 
>>>>>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app due to
>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>> 
>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>> 
>>>>>>>>>>> (
>>>>>>>>>>> 
>>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>> 
>>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>> 
>>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>> 
>>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>> 
>>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>> 361
>>>>>>>>>>> 
>>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>> 
>>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>> 
>>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>> 
>>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>> 
>>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>> 
>>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>>> 1002
>>>>>>>>>>> 
>>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>> 
>>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>> 
>>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>> 
>>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>> 
>>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>> 
>>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>> 
>>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>> 
>>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>> 
>>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>> 
>>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>> 
>>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>> 
>>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>> 
>>>>>>>>>>> )
>>>>>>>>>>> 
>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>> 
>>>>>>>>>>> zsh: abort      R
>>>>>>>>>>> 
>>>>>>>>>>> rmh at rmhs-Air ~ %
>>>>>>>>>>> 
>>>>>>>>>>> 
>>>>>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>>>> 
>>>>>>>>>>>> I'm not seeing that with R-patched r78557, run from the console.  I'm
>>>>>>>>>>>> not sure I have the same MacOS version as you (R prints the same thing,
>>>>>>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary of rgl
>>>>>>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  I'm not
>>>>>>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine is "XQuartz
>>>>>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>>>>>> 
>>>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>>> 
>>>>>>>>>>>> 
>>>>>>>>>>>> 
>>>>>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>>>> 
>>>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>>>> 
>>>>>>>>>>>>>        Natural language support but running in an English locale
>>>>>>>>>>>>> 
>>>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>>>> 
>>>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>>>> 
>>>>>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>>>>>> version
>>>>>>>>>>>>>                     _
>>>>>>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>>>>>>> arch           x86_64
>>>>>>>>>>>>> os             darwin17.0
>>>>>>>>>>>>> system         x86_64, darwin17.0
>>>>>>>>>>>>> status
>>>>>>>>>>>>> major          4
>>>>>>>>>>>>> minor          0.0
>>>>>>>>>>>>> year           2020
>>>>>>>>>>>>> month          04
>>>>>>>>>>>>> day            24
>>>>>>>>>>>>> svn rev        78286
>>>>>>>>>>>>> language       R
>>>>>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>>>>>> nickname       Arbor Day
>>>>>>>>>>>>>> 
>>>>>>>>>>>>>> library(rgl)
>>>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>>>> 
>>>>>>>>>>>>> 
>>>>>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion failure in BOOL
>>>>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app due to
>>>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>>>> (
>>>>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>>>> 361
>>>>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>>>>> 1002
>>>>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>>>> )
>>>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>>>> 
>>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>>>>>> 
>>>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>> 
>>>>> 
>>>>> _______________________________________________
>>>>> R-SIG-Mac mailing list
>>>>> R-SIG-Mac at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>> 
>>> 
>> 
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Aug  3 22:55:10 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 3 Aug 2020 16:55:10 -0400
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <2F02DA50-B09D-4E16-88AB-8B4B62A48139@R-project.org>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
 <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
 <7cdfbcc2-dfac-c7ae-4f6a-467b06bee269@gmail.com>
 <70880381-8027-1286-c489-577155a4aadd@gmail.com>
 <2F02DA50-B09D-4E16-88AB-8B4B62A48139@R-project.org>
Message-ID: <6128be7b-f562-41c3-287a-9086291a3196@gmail.com>

I dropped the native Apple GL support a few years ago.  Currently the 
only options are X11, WGL (for Windows), and null, which means you need 
to produce WebGL to view in a browser.

I suppose I could resurrect the native display.  OpenGL has been 
deprecated on MacOS since Mojave, but maybe it will be supported for a 
few more years.  Right now I don't even have svn running (the Catalina 
update broke it), but eventually things should get back to normal here.

Duncan Murdoch

On 03/08/2020 4:34 p.m., Simon Urbanek wrote:
> Duncan,
> 
> I have seen crashes in rgl with X11 before, in fact I have an e-mail in my draft folder to you with that crash and backtrace (see below). However, I also recall that I have fixed the issue with some trivial step (which I can't remember - I think I may have messed with /opt and/or restart X11 or something like that) and I felt silly not doing it so I didn't end up sending the report. The crash comes likely from
> https://github.com/XQuartz/AppleSGLX/blob/master/apple_visual.c#L142
> which means that CGLChoosePixelFormat() fails, but no idea why since it is in principle independent of X11 - there should be also an error on stderr. The libGL code is more than 10 years old, so I wouldn't expect any changes anytime soon.
> 
> Cheers,
> Simon
> 
> 
> Begin forwarded message:
> 
> From: Simon Urbanek <simon.urbanek at R-project.org>
> Subject: rgl
> Date: April 1, 2020 at 13:05:20 GMT+13
> To: Duncan Murdoch <murdoch.duncan at gmail.com>
> 
> Duncan,
> 
> I'm preparing packages for R 4.0.0 release and rgl is segfaulting on load when DISPLAY is set (i.e. when X11 is available). Do you have any idea? (rgl 0.100.50)
> 
> I remember something about a way to use native GL instead of X11, but I can't recall how to activate that. If DISPLAY is not set, it uses a NULL device which doesn't segfault (obviously).
> 
> Thanks,
> Simon
> 
> 
>> library(rgl)
> Process 54673 stopped
> * thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGABRT
>      frame #0: 0x00007fff5a145b66 libsystem_kernel.dylib`__pthread_kill + 10
> libsystem_kernel.dylib`__pthread_kill:
> ->  0x7fff5a145b66 <+10>: jae    0x7fff5a145b70            ; <+20>
>      0x7fff5a145b68 <+12>: movq   %rax, %rdi
>      0x7fff5a145b6b <+15>: jmp    0x7fff5a13cae5            ; cerror_nocancel
>      0x7fff5a145b70 <+20>: retq
> Target 0: (R) stopped.
> (lldb) bt
> * thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGABRT
>    * frame #0: 0x00007fff5a145b66 libsystem_kernel.dylib`__pthread_kill + 10
>      frame #1: 0x00007fff5a310080 libsystem_pthread.dylib`pthread_kill + 333
>      frame #2: 0x00007fff5a0a11ae libsystem_c.dylib`abort + 127
>      frame #3: 0x00000001086e6aed libGL.1.dylib`apple_visual_create_pfobj + 1010
>      frame #4: 0x00000001086e457b libGL.1.dylib`apple_glx_create_context + 204
>      frame #5: 0x00000001086e15b9 libGL.1.dylib`applegl_create_context + 182
>      frame #6: 0x00000001086c1377 libGL.1.dylib`CreateContext + 126
>      frame #7: 0x00000001086c1288 libGL.1.dylib`glXCreateContext + 199
>      frame #8: 0x00000001084e5b23 rgl.so`rgl::X11WindowImpl::X11WindowImpl(rgl::Window*, rgl::X11GUIFactory*, unsigned long, XVisualInfo*) [inlined] rgl::X11WindowImpl::initGL(this=0x000000010584fc00) at x11gui.cpp:335 [opt]
>      frame #9: 0x00000001084e5b10 rgl.so`rgl::X11WindowImpl::X11WindowImpl(rgl::Window*, rgl::X11GUIFactory*, unsigned long, XVisualInfo*) [inlined] rgl::X11WindowImpl::on_init(this=0x000000010584fc00) at x11gui.cpp:411 [opt]
>      frame #10: 0x00000001084e5b10 rgl.so`rgl::X11WindowImpl::X11WindowImpl(this=0x000000010584fc00, w=<unavailable>, f=0x000000010262c9b0, in_xwindow=10485763, invisualinfo=0x0000000100a6f560) at x11gui.cpp:78 [opt]
>      frame #11: 0x00000001084e7610 rgl.so`rgl::X11GUIFactory::createWindowImpl(rgl::Window*) [inlined] rgl::X11WindowImpl::X11WindowImpl(this=<unavailable>, w=<unavailable>, f=<unavailable>, in_xwindow=<unavailable>, invisualinfo=<unavailable>) at x11gui.cpp:77 [opt]
>      frame #12: 0x00000001084e75fa rgl.so`rgl::X11GUIFactory::createWindowImpl(this=<unavailable>, window=0x0000000100b33ba0) at x11gui.cpp:694 [opt]
>      frame #13: 0x00000001084d9401 rgl.so`rgl::Window::Window(this=0x0000000100b33ba0, in_child=<unavailable>, factory=<unavailable>) at gui.cpp:147 [opt]
>      frame #14: 0x00000001084c1dea rgl.so`rgl::Device::Device(this=0x0000000100b2d4c0, id=<unavailable>, useNULL=<unavailable>) at device.cpp:16 [opt]
>      frame #15: 0x00000001084c28c5 rgl.so`rgl::DeviceManager::createTestWindow(this=0x0000000100b34880) at devicemanager.cpp:167 [opt]
>      frame #16: 0x00000001084d9a9a rgl.so`::rgl_init(initValue=<unavailable>, useNULL=<unavailable>, in_namespace=<unavailable>, debug=<unavailable>) at init.cpp:94 [opt]
>      frame #17: 0x000000010012b4cb libR.dylib`R_doDotCall(ofun=<unavailable>, nargs=<unavailable>, cargs=0x00007ffeefbef4e0, call=0x0000000101cc1618) at dotcode.c:607 [opt]
>      frame #18: 0x000000010017738a libR.dylib`bcEval(body=0x0000000101cc1650, rho=0x0000000101cc1228, useCache=<unavailable>) at eval.c:7646 [opt]
>      frame #19: 0x000000010015d141 libR.dylib`Rf_eval(e=<unavailable>, rho=<unavailable>) at eval.c:723 [opt]
>      frame #20: 0x000000010017d601 libR.dylib`R_execClosure(call=0x00000001019f12b0, newrho=<unavailable>, sysparent=<unavailable>, rho=0x00000001019df6b8, arglist=<unavailable>, op=<unavailable>) at eval.c:0 [opt]
> 
> 
> 
> 
> 
>> On Aug 4, 2020, at 06:44, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>> It didn't stay fixed.  I get crashes about half the time now.  I'll see if I can figure out what's going wrong.  My guess would be that rather than an rgl bug this is an Xquartz bug, but maybe I can find a way to prevent it.
>>
>> Duncan Murdoch
>>
>> On 03/08/2020 12:54 p.m., Duncan Murdoch wrote:
>>> With great trepidation, I installed Catalina.  I saw the same crash as
>>> reported.  Then I reinstalled Xquartz, shut down the Xquartz that was
>>> still running (should have done that in the other order!), and tried
>>> again:  no crash.  Hope it stays fixed!
>>> Duncan Murdoch
>>> On 03/08/2020 9:25 a.m., Duncan Murdoch wrote:
>>>> Thanks.  Looks like I should update.  I'm looking forward to the crashes...
>>>>
>>>> Duncan Murdoch
>>>>
>>>> On 03/08/2020 9:21 a.m., Marc Schwartz wrote:
>>>>> Hi,
>>>>>
>>>>> Just installed rgl and I get the same crash and error message from the original post below, running R from the CLI.
>>>>>
>>>>> If I run R from within ESS (what I normally use), I get:
>>>>>
>>>>>      Process R abort trap: 6 at Mon Aug  3 09:15:32 2020
>>>>>
>>>>> If I run R from R.app (the default macOS GUI), the command runs fine and I get the graphic.
>>>>>
>>>>> I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.
>>>>>
>>>>> R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.
>>>>>
>>>>> Regards,
>>>>>
>>>>> Marc Schwartz
>>>>>
>>>>>
>>>>>> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>
>>>>>> I just got a message from someone else using Catalina 10.15.5 who still gets a crash from
>>>>>>
>>>>>> library(rgl)
>>>>>> plot(1:10)
>>>>>>
>>>>>> I don't have Catalina, and haven't seen it.  Has anyone else?
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>>>>>>> I upgraded last night to Catalina 10.15.5 (19F96).
>>>>>>> The crash has gone away and that example now works normally.
>>>>>>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>>>>>>>>
>>>>>>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>>>>>>> No emacs/ESS involved.
>>>>>>>>
>>>>>>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>
>>>>>>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>>>>>>> I attempted to update xquartz when I updated to Catalina, and the same
>>>>>>>>>> number is still the current version number.
>>>>>>>>>>
>>>>>>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>>>>>>> The interesting thing here is that rgl.quit() prevents rgl from being
>>>>>>>>>> reattached.
>>>>>>>>>
>>>>>>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>>>>>>> session:  detaching it doesn't clean up everything.  That's not
>>>>>>>>> something that I'd put any priority on fixing, whereas I would look at
>>>>>>>>> the problems you're having on startup if I could reproduce them.
>>>>>>>>>
>>>>>>>>> I wonder if ESS is involved somehow:  your sessionInfo listed ESSR on
>>>>>>>>> the search list.  Do you have the same issues with plain R from the
>>>>>>>>> console, or R.app?
>>>>>>>>>
>>>>>>>>>> Is there an rgl equivalent for dev.cur()?
>>>>>>>>>
>>>>>>>>> There's rgl.cur().  rgl only supports two kinds of devices:  on a Mac or
>>>>>>>>> Linux they'd be displayed as glX or null.  Windows also supports the
>>>>>>>>> null device (which doesn't display anything), and a different one to
>>>>>>>>> display within R:  I forget how the name is displayed.
>>>>>>>>>
>>>>>>>>> It might be that you'll need to set options(rgl.useNULL) before starting
>>>>>>>>> rgl, and only use the null device.  It won't display anything in R, but
>>>>>>>>> allows you to call rglwidget() for a display in a browser.
>>>>>>>>>
>>>>>>>>> Duncan Murdoch
>>>>>>>>>
>>>>>>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>>>
>>>>>>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>>>>>>> I have the same Xquartz as you.
>>>>>>>>>>>
>>>>>>>>>>> I'd guess it should be updated.  Generally XQuartz needs updates with
>>>>>>>>>>> every MacOS release, and your 10.15.4 is two releases further along than
>>>>>>>>>>> my 10.13.6.
>>>>>>>>>>>
>>>>>>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>>>>>>>
>>>>>>>>>>> You could update that, but I doubt if it would make any difference.
>>>>>>>>>>>
>>>>>>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>>>>>>> Do you need hardware information?
>>>>>>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>>>>>>>
>>>>>>>>>>> I think the XQuartz issue is most likely to help, but if it doesn't, I'm
>>>>>>>>>>> not sure what I could suggest:  I don't have Catalina.
>>>>>>>>>>>
>>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> from the Terminal App:
>>>>>>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>>>>>>> I didn't send it to Apple.
>>>>>>>>>>>>
>>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>>>
>>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>>>
>>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>>>
>>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>>>
>>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>        Natural language support but running in an English locale
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>>>
>>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>>>
>>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>>>
>>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>>>
>>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>> library(rgl)
>>>>>>>>>>>>
>>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>>
>>>>>>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion failure in BOOL NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>>>
>>>>>>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app due to
>>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>>>
>>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>>>
>>>>>>>>>>>> (
>>>>>>>>>>>>
>>>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>>>
>>>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>>>
>>>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>>>
>>>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>>>
>>>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>>> 361
>>>>>>>>>>>>
>>>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>>>
>>>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>>>
>>>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>>>
>>>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>>>
>>>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>>>
>>>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>>>> 1002
>>>>>>>>>>>>
>>>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>>>
>>>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>>>
>>>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>>>
>>>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010686df0c
>>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>>>
>>>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>>>
>>>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>>>
>>>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>>>
>>>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>>>
>>>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>>>
>>>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>>>
>>>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>>>
>>>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>>>
>>>>>>>>>>>> )
>>>>>>>>>>>>
>>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>>>
>>>>>>>>>>>> zsh: abort      R
>>>>>>>>>>>>
>>>>>>>>>>>> rmh at rmhs-Air ~ %
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>>>>>
>>>>>>>>>>>>> I'm not seeing that with R-patched r78557, run from the console.  I'm
>>>>>>>>>>>>> not sure I have the same MacOS version as you (R prints the same thing,
>>>>>>>>>>>>> Apple says High Sierra 10.13.6).  I tried with the CRAN binary of rgl
>>>>>>>>>>>>> 0.100.54.  I'd guess the version of XQuartz may be important:  I'm not
>>>>>>>>>>>>> seeing rgl in the call stack, but libXplugin is there.  Mine is "XQuartz
>>>>>>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>>>>>>>
>>>>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>         Natural language support but running in an English locale
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>>>>>>> version
>>>>>>>>>>>>>>                      _
>>>>>>>>>>>>>> platform       x86_64-apple-darwin17.0
>>>>>>>>>>>>>> arch           x86_64
>>>>>>>>>>>>>> os             darwin17.0
>>>>>>>>>>>>>> system         x86_64, darwin17.0
>>>>>>>>>>>>>> status
>>>>>>>>>>>>>> major          4
>>>>>>>>>>>>>> minor          0.0
>>>>>>>>>>>>>> year           2020
>>>>>>>>>>>>>> month          04
>>>>>>>>>>>>>> day            24
>>>>>>>>>>>>>> svn rev        78286
>>>>>>>>>>>>>> language       R
>>>>>>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>>>>>>> nickname       Arbor Day
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> library(rgl)
>>>>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion failure in BOOL
>>>>>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(),
>>>>>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473
>>>>>>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app due to
>>>>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>>>>> (
>>>>>>>>>>>>>> 0   CoreFoundation                      0x00007fff371698d7
>>>>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>>>>> 1   libobjc.A.dylib                     0x00007fff6ff47a9e
>>>>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>>>>> 2   CoreFoundation                      0x00007fff37192bb0
>>>>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>>>>> 3   Foundation                          0x00007fff398de456
>>>>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>>>>> 4   AppKit                              0x00007fff34503083
>>>>>>>>>>>>>> +[_NSScreenConfiguration invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>>>>> 361
>>>>>>>>>>>>>> 5   AppKit                              0x00007fff34e4bda8
>>>>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>>>>> 6   AppKit                              0x00007fff34502c85
>>>>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>>>>> 7   AppKit                              0x00007fff345024dc
>>>>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>>>>> 8   HIToolbox                           0x00007fff35d34a3c
>>>>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>>>>> 9   HIServices                          0x00007fff3539c8ec
>>>>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>>>>> 10  SkyLight                            0x00007fff6626f174
>>>>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ +
>>>>>>>>>>>>>> 1002
>>>>>>>>>>>>>> 11  SkyLight                            0x00007fff6626de71
>>>>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>>>>> 12  SkyLight                            0x00007fff6649d5a5
>>>>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>>>>> 13  SkyLight                            0x00007fff6633bfbe
>>>>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>>>>> 14  libXplugin.1.dylib                  0x000000010ffa5f0c
>>>>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>>>>> 15  libdispatch.dylib                   0x00007fff7108d658
>>>>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>>>>> 16  libdispatch.dylib                   0x00007fff7108f818
>>>>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>>>>> 17  libdispatch.dylib                   0x00007fff7109f4be
>>>>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>>>>> 18  libdispatch.dylib                   0x00007fff71092af6
>>>>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>>>>> 19  libdispatch.dylib                   0x00007fff710935d6
>>>>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>>>>> 20  libdispatch.dylib                   0x00007fff7109cc09
>>>>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>>>>> 21  libsystem_pthread.dylib             0x00007fff712eba3d
>>>>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>>>>> 22  libsystem_pthread.dylib             0x00007fff712eab77 start_wqthread + 15
>>>>>>>>>>>>>> )
>>>>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type NSException
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-SIG-Mac mailing list
>>>>>> R-SIG-Mac at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>
>>>>
>>>
>>
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Aug  4 15:58:45 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 4 Aug 2020 09:58:45 -0400
Subject: [R-SIG-Mac] "cannot run mixed C/Fortran code"
Message-ID: <e21239e9-3373-8ef5-78d3-5feec871c80a@gmail.com>

After updating to Catalina, I've installed the Xcode command line tools 
version 11.4.1, and gfortran 8.2.  When trying to build R, configure dies:

  checking whether gfortran appends underscores to external names... yes
  checking whether gfortran appends extra underscores to external 
names... no
  checking whether mixed C/Fortran code can be run... configure: 
WARNING: cannot run mixed C/Fortran code
  configure: error: Maybe check LDFLAGS for paths to Fortran libraries?

I don't have LDFLAGS set.  I'm not certain I'm running the right 
compilers (I might have old ones that have precedence on the path).  Are 
these the versions I should be seeing?

$ clang --version
Apple clang version 11.0.3 (clang-1103.0.32.59)
Target: x86_64-apple-darwin19.6.0
Thread model: posix
InstalledDir: /Library/Developer/CommandLineTools/usr/bin

$ gfortran --version
GNU Fortran (GCC) 8.2.0
Copyright (C) 2018 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

If those are the right versions, any other suggestions on how to fix the 
configure problem?

Duncan Murdoch


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Aug  4 18:24:10 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 4 Aug 2020 12:24:10 -0400
Subject: [R-SIG-Mac] "cannot run mixed C/Fortran code"
In-Reply-To: <e21239e9-3373-8ef5-78d3-5feec871c80a@gmail.com>
References: <e21239e9-3373-8ef5-78d3-5feec871c80a@gmail.com>
Message-ID: <f0d25842-1006-c628-348d-531b3450a6c3@gmail.com>

I found the problem.  /usr/local/lib had old copies of libgfortran* and 
libquadmath* from 2015, and removing these allowed things to proceed. 
The current copies are in /usr/local/gfortran/lib.

That directory contains a lot of old junk; I'll probably find more needs 
to go too.

Duncan Murdoch

On 04/08/2020 9:58 a.m., Duncan Murdoch wrote:
> After updating to Catalina, I've installed the Xcode command line tools
> version 11.4.1, and gfortran 8.2.  When trying to build R, configure dies:
> 
>    checking whether gfortran appends underscores to external names... yes
>    checking whether gfortran appends extra underscores to external
> names... no
>    checking whether mixed C/Fortran code can be run... configure:
> WARNING: cannot run mixed C/Fortran code
>    configure: error: Maybe check LDFLAGS for paths to Fortran libraries?
> 
> I don't have LDFLAGS set.  I'm not certain I'm running the right
> compilers (I might have old ones that have precedence on the path).  Are
> these the versions I should be seeing?
> 
> $ clang --version
> Apple clang version 11.0.3 (clang-1103.0.32.59)
> Target: x86_64-apple-darwin19.6.0
> Thread model: posix
> InstalledDir: /Library/Developer/CommandLineTools/usr/bin
> 
> $ gfortran --version
> GNU Fortran (GCC) 8.2.0
> Copyright (C) 2018 Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.  There is NO
> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
> 
> If those are the right versions, any other suggestions on how to fix the
> configure problem?
> 
> Duncan Murdoch
>


From b@|@mut2 @end|ng |rom ||||no|@@edu  Tue Aug  4 18:51:41 2020
From: b@|@mut2 @end|ng |rom ||||no|@@edu (Balamuta, James Joseph)
Date: Tue, 4 Aug 2020 16:51:41 +0000
Subject: [R-SIG-Mac] "cannot run mixed C/Fortran code"
In-Reply-To: <f0d25842-1006-c628-348d-531b3450a6c3@gmail.com>
References: <e21239e9-3373-8ef5-78d3-5feec871c80a@gmail.com>
 <f0d25842-1006-c628-348d-531b3450a6c3@gmail.com>
Message-ID: <A06D3085-2B49-42F6-B080-5EDA0CD1689B@illinois.edu>

Yes, the old gfortran ~4.8.6 binary can cause this issue. Unfortunately, there isn't an uninstaller. I wrote up some guidelines for removing it here:

https://thecoatlessprofessor.com/programming/cpp/removing-the-old-r-custom-gfortran-4.8.2-binary/

The gist is:

# Download installer into working directory
curl -O http://r.research.att.com/libs/gfortran-4.8.2-darwin13.tar.bz2

# Remove _files_ associated with the binary
for file in $(tar tfz gfortran-4.8.2-darwin13.tar.bz2); do
sudo rm -f /$file; 
done

# Remove empty _folders_ associated with the binary
for folder in $(tar tfz gfortran-4.8.2-darwin13.tar.bz2); do 
sudo rmdir -p /$folder; 
done

# Delete the installer
rm -rf gfortran-4.8.2-darwin13.tar.bz2

Best,

JJB

?On 8/4/20, 11:25 AM, "R-SIG-Mac on behalf of Duncan Murdoch" <r-sig-mac-bounces at r-project.org on behalf of murdoch.duncan at gmail.com> wrote:

    I found the problem.  /usr/local/lib had old copies of libgfortran* and 
    libquadmath* from 2015, and removing these allowed things to proceed. 
    The current copies are in /usr/local/gfortran/lib.

    That directory contains a lot of old junk; I'll probably find more needs 
    to go too.

    Duncan Murdoch

    On 04/08/2020 9:58 a.m., Duncan Murdoch wrote:
    > After updating to Catalina, I've installed the Xcode command line tools
    > version 11.4.1, and gfortran 8.2.  When trying to build R, configure dies:
    > 
    >    checking whether gfortran appends underscores to external names... yes
    >    checking whether gfortran appends extra underscores to external
    > names... no
    >    checking whether mixed C/Fortran code can be run... configure:
    > WARNING: cannot run mixed C/Fortran code
    >    configure: error: Maybe check LDFLAGS for paths to Fortran libraries?
    > 
    > I don't have LDFLAGS set.  I'm not certain I'm running the right
    > compilers (I might have old ones that have precedence on the path).  Are
    > these the versions I should be seeing?
    > 
    > $ clang --version
    > Apple clang version 11.0.3 (clang-1103.0.32.59)
    > Target: x86_64-apple-darwin19.6.0
    > Thread model: posix
    > InstalledDir: /Library/Developer/CommandLineTools/usr/bin
    > 
    > $ gfortran --version
    > GNU Fortran (GCC) 8.2.0
    > Copyright (C) 2018 Free Software Foundation, Inc.
    > This is free software; see the source for copying conditions.  There is NO
    > warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    > 
    > If those are the right versions, any other suggestions on how to fix the
    > configure problem?
    > 
    > Duncan Murdoch
    >

    _______________________________________________
    R-SIG-Mac mailing list
    R-SIG-Mac at r-project.org
    https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Aug  4 22:51:28 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 4 Aug 2020 16:51:28 -0400
Subject: [R-SIG-Mac] Workaround for crash due to rgl and base graphics
 conflict
In-Reply-To: <6128be7b-f562-41c3-287a-9086291a3196@gmail.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
 <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
 <7cdfbcc2-dfac-c7ae-4f6a-467b06bee269@gmail.com>
 <70880381-8027-1286-c489-577155a4aadd@gmail.com>
 <2F02DA50-B09D-4E16-88AB-8B4B62A48139@R-project.org>
 <6128be7b-f562-41c3-287a-9086291a3196@gmail.com>
Message-ID: <efd2d08c-ee49-c64b-845e-34ab8e69a127@gmail.com>

I seem to have a workaround for the rgl-related crash.  If I insert a 
one second delay after the first quartz() device is opened but before 
anything is plotted, then I don't see the crash.  This script does that 
if the RGL_SLOW_DEV environment variable is non-empty:



if (nchar(Sys.getenv("RGL_SLOW_DEV")))
   options(device = local({
     olddev <- getOption("device")
     function(...) {
       olddev(...)
       Sys.sleep(1)
       options(device = olddev)
     }
   }))

library(rgl)
plot(1:10)


The last two lines are the code to trigger a crash.  I'm seeing pretty 
regular crashes if I source this without RGL_SLOW_DEV being set, but 
setting it seems to make things work.  I tried reducing the delay to 0.1 
seconds and it didn't work.

I'd hypothesize that what's happening is that some part of the 
initialization of the quartz() window is asynchronous with the main R 
thread, and in Catalina something about rgl makes it so slow that the 
window isn't ready when R starts plotting there.  But I don't know the 
quartz() device code, so this might not be right at all.

Duncan Murdoch


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Aug  5 02:02:48 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 5 Aug 2020 12:02:48 +1200
Subject: [R-SIG-Mac] Workaround for crash due to rgl and base graphics
 conflict
In-Reply-To: <efd2d08c-ee49-c64b-845e-34ab8e69a127@gmail.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
 <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
 <7cdfbcc2-dfac-c7ae-4f6a-467b06bee269@gmail.com>
 <70880381-8027-1286-c489-577155a4aadd@gmail.com>
 <2F02DA50-B09D-4E16-88AB-8B4B62A48139@R-project.org>
 <6128be7b-f562-41c3-287a-9086291a3196@gmail.com>
 <efd2d08c-ee49-c64b-845e-34ab8e69a127@gmail.com>
Message-ID: <0E69EEBB-CD5E-478C-9B6C-C7FF93FE5EFA@R-project.org>

Duncan,

how is quartz() related to rgl? I thought that now you only supported X11 which wouldn't involve quartz. In general, Cocoa windows are asynchronous, i.e. when the quartz device is created the window may not exist yet, but I'm not sure why that would affect rgl (quartz device draws to off-screen buffer so it doesn't mind if the windows doesn't exist yet). For the X11 device there could be significant delay with X11 (not related to quartz) if you don't have X11 running yet as users have typically DISPLAY set to a socket which will first start XQuartz if it's not up yet.

Cheers,
Simon



> On 5/08/2020, at 8:51 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> I seem to have a workaround for the rgl-related crash.  If I insert a one second delay after the first quartz() device is opened but before anything is plotted, then I don't see the crash.  This script does that if the RGL_SLOW_DEV environment variable is non-empty:
> 
> 
> 
> if (nchar(Sys.getenv("RGL_SLOW_DEV")))
>  options(device = local({
>    olddev <- getOption("device")
>    function(...) {
>      olddev(...)
>      Sys.sleep(1)
>      options(device = olddev)
>    }
>  }))
> 
> library(rgl)
> plot(1:10)
> 
> 
> The last two lines are the code to trigger a crash.  I'm seeing pretty regular crashes if I source this without RGL_SLOW_DEV being set, but setting it seems to make things work.  I tried reducing the delay to 0.1 seconds and it didn't work.
> 
> I'd hypothesize that what's happening is that some part of the initialization of the quartz() window is asynchronous with the main R thread, and in Catalina something about rgl makes it so slow that the window isn't ready when R starts plotting there.  But I don't know the quartz() device code, so this might not be right at all.
> 
> Duncan Murdoch
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Aug  5 02:27:27 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 4 Aug 2020 20:27:27 -0400
Subject: [R-SIG-Mac] Workaround for crash due to rgl and base graphics
 conflict
In-Reply-To: <0E69EEBB-CD5E-478C-9B6C-C7FF93FE5EFA@R-project.org>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
 <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
 <7cdfbcc2-dfac-c7ae-4f6a-467b06bee269@gmail.com>
 <70880381-8027-1286-c489-577155a4aadd@gmail.com>
 <2F02DA50-B09D-4E16-88AB-8B4B62A48139@R-project.org>
 <6128be7b-f562-41c3-287a-9086291a3196@gmail.com>
 <efd2d08c-ee49-c64b-845e-34ab8e69a127@gmail.com>
 <0E69EEBB-CD5E-478C-9B6C-C7FF93FE5EFA@R-project.org>
Message-ID: <2729feaf-c466-9d4f-ff7c-b355e5aec8f6@gmail.com>

On 04/08/2020 8:02 p.m., Simon Urbanek wrote:
> Duncan,
> 
> how is quartz() related to rgl? I thought that now you only supported X11 which wouldn't involve quartz. In general, Cocoa windows are asynchronous, i.e. when the quartz device is created the window may not exist yet, but I'm not sure why that would affect rgl (quartz device draws to off-screen buffer so it doesn't mind if the windows doesn't exist yet). For the X11 device there could be significant delay with X11 (not related to quartz) if you don't have X11 running yet as users have typically DISPLAY set to a socket which will first start XQuartz if it's not up yet.

The only connections I know between rgl and quartz() are this bug, and 
the fact that XQuartz uses Quartz.

When I see the crash, what happens is that the library(rgl) starts 
XQuartz.  Running quartz() at this point opens a window with no crash 
(but it's a little slower than I'd expect).  Running plot(1:10) after 
that causes no problems.

However, if I skip calling quartz() explicitly as in the demo code 
below, the plot(1:10) call will call it and plot immediately, and that 
usually causes the crash.

Duncan



> 
> Cheers,
> Simon
> 
> 
> 
>> On 5/08/2020, at 8:51 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>> I seem to have a workaround for the rgl-related crash.  If I insert a one second delay after the first quartz() device is opened but before anything is plotted, then I don't see the crash.  This script does that if the RGL_SLOW_DEV environment variable is non-empty:
>>
>>
>>
>> if (nchar(Sys.getenv("RGL_SLOW_DEV")))
>>   options(device = local({
>>     olddev <- getOption("device")
>>     function(...) {
>>       olddev(...)
>>       Sys.sleep(1)
>>       options(device = olddev)
>>     }
>>   }))
>>
>> library(rgl)
>> plot(1:10)
>>
>>
>> The last two lines are the code to trigger a crash.  I'm seeing pretty regular crashes if I source this without RGL_SLOW_DEV being set, but setting it seems to make things work.  I tried reducing the delay to 0.1 seconds and it didn't work.
>>
>> I'd hypothesize that what's happening is that some part of the initialization of the quartz() window is asynchronous with the main R thread, and in Catalina something about rgl makes it so slow that the window isn't ready when R starts plotting there.  But I don't know the quartz() device code, so this might not be right at all.
>>
>> Duncan Murdoch
>>
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>


From dw|n@em|u@ @end|ng |rom comc@@t@net  Wed Aug  5 03:38:59 2020
From: dw|n@em|u@ @end|ng |rom comc@@t@net (David Winsemius)
Date: Tue, 4 Aug 2020 18:38:59 -0700
Subject: [R-SIG-Mac] [External] Re: crash due to rgl and base graphics
 conflict
In-Reply-To: <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
References: <CAGx1TMCi5HgiMyccsLV0Q+JXfFcsrpEaT7zYp0AC+zM5zCYkzA@mail.gmail.com>
 <6a2860c8-935f-b6a8-7eb8-e7281c18b94e@gmail.com>
 <CAGx1TMCDPbGpce8o_v3PSr658GAykfp4Wy8105GEL+9LQZ_LEg@mail.gmail.com>
 <91e5a5a9-0a42-dc94-7acb-03647a994a3e@gmail.com>
 <CAGx1TMBswW7BTXjzAhUjZYgR5NjsU=utwJWAxbOruNsr1ADVEQ@mail.gmail.com>
 <8d908d24-2b46-27ee-81c7-2a8cc8d6193b@gmail.com>
 <CAGx1TMCHm7zqEoX4B3u7-Ww+9sB8Mvuf+POQL=scTC=sk9CiSA@mail.gmail.com>
 <CAGx1TMCtm_YK_VmKtwi0_MYAacGAjvs49ag1+KS6f6fFJ=Oatw@mail.gmail.com>
 <e48ee3b0-e99a-5a88-c958-91e0c4b3dd60@gmail.com>
 <09B95AA1-D830-4472-A178-3748F3541FF9@me.com>
 <6333b309-1054-5eeb-ab2e-eb6918cb8e00@gmail.com>
Message-ID: <54d1d443-16ae-a941-176a-c41df7df7d05@comcast.net>


On 8/3/20 6:25 AM, Duncan Murdoch wrote:
> Thanks. Looks like I should update.? I'm looking forward to the 
> crashes...
Fortune candidate.
>
> Duncan Murdoch
>
> On 03/08/2020 9:21 a.m., Marc Schwartz wrote:
>> Hi,
>>
>> Just installed rgl and I get the same crash and error message from 
>> the original post below, running R from the CLI.
>>
>> If I run R from within ESS (what I normally use), I get:
>>
>> ?? Process R abort trap: 6 at Mon Aug? 3 09:15:32 2020
>>
>> If I run R from R.app (the default macOS GUI), the command runs fine 
>> and I get the graphic.
>>
>> I am running R 4.0.2 (2020-06-22) on macOS 10.15.6.
>>
>> R was cleanly installed, and XQuartz (2.7.11) was updated afterwards.
>>
>> Regards,
>>
>> Marc Schwartz
>>
>>
>>> On Aug 3, 2020, at 9:05 AM, Duncan Murdoch 
>>> <murdoch.duncan at gmail.com> wrote:
>>>
>>> I just got a message from someone else using Catalina 10.15.5 who 
>>> still gets a crash from
>>>
>>> library(rgl)
>>> plot(1:10)
>>>
>>> I don't have Catalina, and haven't seen it.? Has anyone else?
>>>
>>> Duncan Murdoch
>>>
>>> On 31/05/2020 4:44 p.m., Richard M. Heiberger wrote:
>>>> I upgraded last night to Catalina 10.15.5 (19F96).
>>>> The crash has gone away and that example now works normally.
>>>> On Fri, May 29, 2020 at 3:25 PM Richard M. Heiberger 
>>>> <rmh at temple.edu> wrote:
>>>>>
>>>>> my 12:35 email and the attached tmp.txt are from the Terminal.app,
>>>>> No emacs/ESS involved.
>>>>>
>>>>> On Fri, May 29, 2020 at 3:13 PM Duncan Murdoch 
>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>
>>>>>> On 29/05/2020 2:21 p.m., Richard M. Heiberger wrote:
>>>>>>> I attempted to update xquartz when I updated to Catalina, and 
>>>>>>> the same
>>>>>>> number is still the current version number.
>>>>>>>
>>>>>>> Here is a related issue, attached tmp2.txt is the R transcript.
>>>>>>> The interesting thing here is that rgl.quit() prevents rgl from 
>>>>>>> being
>>>>>>> reattached.
>>>>>>
>>>>>> Generally speaking rgl doesn't want to be reloaded in the same R
>>>>>> session:? detaching it doesn't clean up everything. That's not
>>>>>> something that I'd put any priority on fixing, whereas I would 
>>>>>> look at
>>>>>> the problems you're having on startup if I could reproduce them.
>>>>>>
>>>>>> I wonder if ESS is involved somehow:? your sessionInfo listed 
>>>>>> ESSR on
>>>>>> the search list.? Do you have the same issues with plain R from the
>>>>>> console, or R.app?
>>>>>>
>>>>>>> Is there an rgl equivalent for dev.cur()?
>>>>>>
>>>>>> There's rgl.cur().? rgl only supports two kinds of devices:? on a 
>>>>>> Mac or
>>>>>> Linux they'd be displayed as glX or null.? Windows also supports the
>>>>>> null device (which doesn't display anything), and a different one to
>>>>>> display within R:? I forget how the name is displayed.
>>>>>>
>>>>>> It might be that you'll need to set options(rgl.useNULL) before 
>>>>>> starting
>>>>>> rgl, and only use the null device.? It won't display anything in 
>>>>>> R, but
>>>>>> allows you to call rglwidget() for a display in a browser.
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>>> On Fri, May 29, 2020 at 1:51 PM Duncan Murdoch 
>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>
>>>>>>>> On 29/05/2020 12:35 p.m., Richard M. Heiberger wrote:
>>>>>>>>> I have the same Xquartz as you.
>>>>>>>>
>>>>>>>> I'd guess it should be updated.? Generally XQuartz needs 
>>>>>>>> updates with
>>>>>>>> every MacOS release, and your 10.15.4 is two releases further 
>>>>>>>> along than
>>>>>>>> my 10.13.6.
>>>>>>>>
>>>>>>>>> I have rgl-0.100.50 from CRAN
>>>>>>>>
>>>>>>>> You could update that, but I doubt if it would make any 
>>>>>>>> difference.
>>>>>>>>
>>>>>>>>> Apple is macOS Catalina, Version 10.15.4
>>>>>>>>> Do you need hardware information?
>>>>>>>>> MacBpok Air (13 -inch, Mid 2012)
>>>>>>>>> Processor 2GHz Dual-Core Intel Core i7
>>>>>>>>> Memory 8 GB 1600 MHz DDR3
>>>>>>>>> Graphics Intel HD Graphics 4000 1536 MB
>>>>>>>>
>>>>>>>> I think the XQuartz issue is most likely to help, but if it 
>>>>>>>> doesn't, I'm
>>>>>>>> not sure what I could suggest:? I don't have Catalina.
>>>>>>>>
>>>>>>>> Duncan Murdoch
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> from the Terminal App:
>>>>>>>>> The Apple Crash Report is in the attached tmp.txt
>>>>>>>>> I didn't send it to Apple.
>>>>>>>>>
>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>
>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>
>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>
>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>
>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> ???? Natural language support but running in an English locale
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>
>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>
>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>
>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>
>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>> library(rgl)
>>>>>>>>>
>>>>>>>>>> plot(1:10)
>>>>>>>>>
>>>>>>>>>> 2020-05-29 12:30:00.536 R[24961:3275889] *** Assertion 
>>>>>>>>>> failure in BOOL 
>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), 
>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473 
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>> 2020-05-29 12:30:00.543 R[24961:3275889] *** Terminating app 
>>>>>>>>> due to
>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>
>>>>>>>>> *** First throw call stack:
>>>>>>>>>
>>>>>>>>> (
>>>>>>>>>
>>>>>>>>> 0?? CoreFoundation 0x00007fff371698d7
>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>
>>>>>>>>> 1?? libobjc.A.dylib 0x00007fff6ff47a9e
>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>
>>>>>>>>> 2?? CoreFoundation 0x00007fff37192bb0
>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>
>>>>>>>>> 3?? Foundation 0x00007fff398de456
>>>>>>>>> -[NSAssertionHandler
>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>
>>>>>>>>> 4?? AppKit 0x00007fff34503083
>>>>>>>>> +[_NSScreenConfiguration 
>>>>>>>>> invalidateConfigurationIfNeededForReason:] +
>>>>>>>>> 361
>>>>>>>>>
>>>>>>>>> 5?? AppKit 0x00007fff34e4bda8
>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>
>>>>>>>>> 6?? AppKit 0x00007fff34502c85
>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>
>>>>>>>>> 7?? AppKit 0x00007fff345024dc
>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>
>>>>>>>>> 8?? HIToolbox 0x00007fff35d34a3c
>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>
>>>>>>>>> 9?? HIServices 0x00007fff3539c8ec
>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>
>>>>>>>>> 10? SkyLight 0x00007fff6626f174
>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ 
>>>>>>>>> +
>>>>>>>>> 1002
>>>>>>>>>
>>>>>>>>> 11? SkyLight 0x00007fff6626de71
>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>
>>>>>>>>> 12? SkyLight 0x00007fff6649d5a5
>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>
>>>>>>>>> 13? SkyLight 0x00007fff6633bfbe
>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>
>>>>>>>>> 14? libXplugin.1.dylib 0x000000010686df0c
>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>
>>>>>>>>> 15? libdispatch.dylib 0x00007fff7108d658
>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>
>>>>>>>>> 16? libdispatch.dylib 0x00007fff7108f818
>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>
>>>>>>>>> 17? libdispatch.dylib 0x00007fff7109f4be
>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>
>>>>>>>>> 18? libdispatch.dylib 0x00007fff71092af6
>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>
>>>>>>>>> 19? libdispatch.dylib 0x00007fff710935d6
>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>
>>>>>>>>> 20? libdispatch.dylib 0x00007fff7109cc09
>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>
>>>>>>>>> 21? libsystem_pthread.dylib 0x00007fff712eba3d
>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>
>>>>>>>>> 22? libsystem_pthread.dylib 0x00007fff712eab77 start_wqthread 
>>>>>>>>> + 15
>>>>>>>>>
>>>>>>>>> )
>>>>>>>>>
>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type 
>>>>>>>>> NSException
>>>>>>>>>
>>>>>>>>> zsh: abort????? R
>>>>>>>>>
>>>>>>>>> rmh at rmhs-Air ~ %
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Fri, May 29, 2020 at 12:16 PM Duncan Murdoch
>>>>>>>>> <murdoch.duncan at gmail.com> wrote:
>>>>>>>>>>
>>>>>>>>>> I'm not seeing that with R-patched r78557, run from the 
>>>>>>>>>> console.? I'm
>>>>>>>>>> not sure I have the same MacOS version as you (R prints the 
>>>>>>>>>> same thing,
>>>>>>>>>> Apple says High Sierra 10.13.6).? I tried with the CRAN 
>>>>>>>>>> binary of rgl
>>>>>>>>>> 0.100.54.? I'd guess the version of XQuartz may be 
>>>>>>>>>> important:? I'm not
>>>>>>>>>> seeing rgl in the call stack, but libXplugin is there.? Mine 
>>>>>>>>>> is "XQuartz
>>>>>>>>>> 2.7.11 (xorg-server 1.18.4)".
>>>>>>>>>>
>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 29/05/2020 11:44 a.m., Richard M. Heiberger wrote:
>>>>>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>>>>>>
>>>>>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>>>>>>
>>>>>>>>>>> ????? Natural language support but running in an English locale
>>>>>>>>>>>
>>>>>>>>>>> R is a collaborative project with many contributors.
>>>>>>>>>>> Type 'contributors()' for more information and
>>>>>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>>>>>>
>>>>>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>>>>>> Type 'q()' to quit R.
>>>>>>>>>>>
>>>>>>>>>>>> if(identical(getOption('pager'), file.path(R.home('bin'), 
>>>>>>>>>>>> 'pager'))) options(pager='cat') # rather take the ESS one
>>>>>>>>>>>> options(STERM='iESS', str.dendrogram.last="'", 
>>>>>>>>>>>> editor='emacsclient', show.error.locations=TRUE)
>>>>>>>>>>>> version
>>>>>>>>>>> ?????????????????? _
>>>>>>>>>>> platform?????? x86_64-apple-darwin17.0
>>>>>>>>>>> arch?????????? x86_64
>>>>>>>>>>> os???????????? darwin17.0
>>>>>>>>>>> system???????? x86_64, darwin17.0
>>>>>>>>>>> status
>>>>>>>>>>> major????????? 4
>>>>>>>>>>> minor????????? 0.0
>>>>>>>>>>> year?????????? 2020
>>>>>>>>>>> month????????? 04
>>>>>>>>>>> day??????????? 24
>>>>>>>>>>> svn rev??????? 78286
>>>>>>>>>>> language?????? R
>>>>>>>>>>> version.string R version 4.0.0 (2020-04-24)
>>>>>>>>>>> nickname?????? Arbor Day
>>>>>>>>>>>>
>>>>>>>>>>>> library(rgl)
>>>>>>>>>>>> plot(1:10)
>>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> Process R abort trap: 6 at Fri May 29 11:32:59 2020
>>>>>>>>>>> 2020-05-29 11:32:59.542 R[24448:3255600] *** Assertion 
>>>>>>>>>>> failure in BOOL
>>>>>>>>>>> NSScreenConfigurationInvalidateIfNeededForReason(_NSScreenConfigurationUpdateReason)(), 
>>>>>>>>>>>
>>>>>>>>>>> /AppleInternal/BuildRoot/Library/Caches/com.apple.xbs/Sources/AppKit/AppKit-1894.40.150/AppKit.subproj/NSScreenConfiguration.m:473 
>>>>>>>>>>>
>>>>>>>>>>> 2020-05-29 11:32:59.560 R[24448:3255600] *** Terminating app 
>>>>>>>>>>> due to
>>>>>>>>>>> uncaught exception 'NSInternalInconsistencyException', reason:
>>>>>>>>>>> 'NSScreen reconfig must only happen on the main thread.'
>>>>>>>>>>> *** First throw call stack:
>>>>>>>>>>> (
>>>>>>>>>>> 0?? CoreFoundation 0x00007fff371698d7
>>>>>>>>>>> __exceptionPreprocess + 250
>>>>>>>>>>> 1?? libobjc.A.dylib 0x00007fff6ff47a9e
>>>>>>>>>>> objc_exception_throw + 48
>>>>>>>>>>> 2?? CoreFoundation 0x00007fff37192bb0
>>>>>>>>>>> +[NSException raise:format:arguments:] + 88
>>>>>>>>>>> 3?? Foundation 0x00007fff398de456
>>>>>>>>>>> -[NSAssertionHandler
>>>>>>>>>>> handleFailureInFunction:file:lineNumber:description:] + 166
>>>>>>>>>>> 4?? AppKit 0x00007fff34503083
>>>>>>>>>>> +[_NSScreenConfiguration 
>>>>>>>>>>> invalidateConfigurationIfNeededForReason:] +
>>>>>>>>>>> 361
>>>>>>>>>>> 5?? AppKit 0x00007fff34e4bda8
>>>>>>>>>>> _NSApplicationInvalidateScreenConfigurationMaybeIfNeeded + 243
>>>>>>>>>>> 6?? AppKit 0x00007fff34502c85
>>>>>>>>>>> -[NSApplication(ScreenHandling) _reactToDockChanged] + 144
>>>>>>>>>>> 7?? AppKit 0x00007fff345024dc
>>>>>>>>>>> _NSCGSDockMessageReceive + 268
>>>>>>>>>>> 8?? HIToolbox 0x00007fff35d34a3c
>>>>>>>>>>> _ZL12DockCallbackjjPvS_ + 1987
>>>>>>>>>>> 9?? HIServices 0x00007fff3539c8ec
>>>>>>>>>>> dockClientNotificationProc + 217
>>>>>>>>>>> 10? SkyLight 0x00007fff6626f174
>>>>>>>>>>> _ZN12_GLOBAL__N_123notify_datagram_handlerEj15CGSDatagramTypePvmS1_ 
>>>>>>>>>>> +
>>>>>>>>>>> 1002
>>>>>>>>>>> 11? SkyLight 0x00007fff6626de71
>>>>>>>>>>> CGSSnarfAndDispatchDatagrams + 1671
>>>>>>>>>>> 12? SkyLight 0x00007fff6649d5a5
>>>>>>>>>>> SLSGetNextEventRecordInternal + 83
>>>>>>>>>>> 13? SkyLight 0x00007fff6633bfbe
>>>>>>>>>>> SLEventCreateNextEvent + 136
>>>>>>>>>>> 14? libXplugin.1.dylib 0x000000010ffa5f0c
>>>>>>>>>>> ___xp_init_service_cg_event_port_block_invoke + 104
>>>>>>>>>>> 15? libdispatch.dylib 0x00007fff7108d658
>>>>>>>>>>> _dispatch_client_callout + 8
>>>>>>>>>>> 16? libdispatch.dylib 0x00007fff7108f818
>>>>>>>>>>> _dispatch_continuation_pop + 414
>>>>>>>>>>> 17? libdispatch.dylib 0x00007fff7109f4be
>>>>>>>>>>> _dispatch_source_invoke + 2084
>>>>>>>>>>> 18? libdispatch.dylib 0x00007fff71092af6
>>>>>>>>>>> _dispatch_lane_serial_drain + 263
>>>>>>>>>>> 19? libdispatch.dylib 0x00007fff710935d6
>>>>>>>>>>> _dispatch_lane_invoke + 363
>>>>>>>>>>> 20? libdispatch.dylib 0x00007fff7109cc09
>>>>>>>>>>> _dispatch_workloop_worker_thread + 596
>>>>>>>>>>> 21? libsystem_pthread.dylib 0x00007fff712eba3d
>>>>>>>>>>> _pthread_wqthread + 290
>>>>>>>>>>> 22? libsystem_pthread.dylib 0x00007fff712eab77 
>>>>>>>>>>> start_wqthread + 15
>>>>>>>>>>> )
>>>>>>>>>>> libc++abi.dylib: terminating with uncaught exception of type 
>>>>>>>>>>> NSException
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> R-SIG-Mac mailing list
>>>>>>>>>>> R-SIG-Mac at r-project.org
>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>
>>>>>>
>>>
>>> _______________________________________________
>>> R-SIG-Mac mailing list
>>> R-SIG-Mac at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>>
>
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Aug  5 15:25:52 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 5 Aug 2020 09:25:52 -0400
Subject: [R-SIG-Mac] Running R with lldb
In-Reply-To: <6F80E69C-C674-4B6E-A9B8-1A4F8E33540B@R-project.org>
References: <CAANT7+Ux8uLoRWod3J=rnCgcpnpd5fWywt58G1e1XSy5q2+WAQ@mail.gmail.com>
 <6F80E69C-C674-4B6E-A9B8-1A4F8E33540B@R-project.org>
Message-ID: <f10ab080-0e85-e15f-707c-9a2c3ae99119@gmail.com>

I'm now successfully building R-devel in /Users/murdoch/R/R-devel.  If I 
run it from that directory using

  bin/R -d lldb

it starts, but "run" gives this error:

Process 11165 launched: '/Users/murdoch/R/R-devel/bin/exec/R' (x86_64)
dyld: Library not loaded: libRblas.dylib
   Referenced from: /Users/murdoch/R/R-devel/bin/exec/R
   Reason: image not found
Process 11165 stopped
* thread #1, stop reason = signal SIGABRT
     frame #0: 0x00000001004c7ede dyld`__abort_with_payload + 10
dyld`__abort_with_payload:
->  0x1004c7ede <+10>: jae    0x1004c7ee8               ; <+20>
     0x1004c7ee0 <+12>: movq   %rax, %rdi
     0x1004c7ee3 <+15>: jmp    0x1004c6408               ; cerror_nocancel
     0x1004c7ee8 <+20>: retq
Target 0: (R) stopped.

I can start it from the /Users/murdoch/R/R-devel/lib directory where 
libRblas.dylib lives.  Setting DYLD_LIBRARY_PATH or LD_LIBRARY_PATH to 
point there doesn't help (either on the bin/R command line or exported). 
  Is there some other way to run it from whatever directory I happen to 
be in?

Duncan Murdoch

On 02/05/2020 11:26 p.m., Simon Urbanek wrote:
> Vince,
> 
> Apple no longer allows debugging of distributed apps - see R for Mac FAQ 10.17:
> http://mac.r-project.org/bin/macosx/RMacOSX-FAQ.html#I-cannot-attach-debugger-to-R
> 
> Another (not recommended) work-around is to disable SIP.
> 
> Cheers,
> Simon
> 
> 
> 
>> On 3/05/2020, at 10:42 AM, Vincent Carey <stvjc at channing.harvard.edu> wrote:
>>
>> I'd like to make use of material in
>>
>> https://kevinushey.github.io/blog/2015/04/13/debugging-with-lldb/
>>
>> But with R 4.0 I get
>>
>> %vjcair> R -d lldb
>>
>> (lldb) target create "/Library/Frameworks/R.framework/Resources/bin/exec/R"
>>
>> Current executable set to
>> '/Library/Frameworks/R.framework/Resources/bin/exec/R' (x86_64).
>>
>> (lldb) run
>>
>> error: process exited with status -1 (Error 1)
>>
>> (lldb) quit
>>
>> %vjcair> which lldb
>>
>> /usr/bin/lldb
>>
>> %vjcair> lldb --version
>>
>> lldb-1100.0.30.12
>>
>> Apple Swift version 5.1.3 (swiftlang-1100.0.282.1 clang-1100.0.33.15)
>>
>>
>> with gdb, there is a little more info -- and a peculiar warning that
>> mentions /Volumes/Builds/Simon/R4/h ...
>>
>>
>> %vjcair> R -d gdb
>>
>> GNU gdb (GDB) 8.1
>>
>> Copyright (C) 2018 Free Software Foundation, Inc.
>>
>> License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html
>>>
>>
>> This is free software: you are free to change and redistribute it.
>>
>> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
>>
>> and "show warranty" for details.
>>
>> This GDB was configured as "x86_64-apple-darwin16.7.0".
>>
>> Type "show configuration" for configuration details.
>>
>> For bug reporting instructions, please see:
>>
>> <http://www.gnu.org/software/gdb/bugs/>.
>>
>> Find the GDB manual and other documentation resources online at:
>>
>> <http://www.gnu.org/software/gdb/documentation/>.
>>
>> For help, type "help".
>>
>> Type "apropos word" to search for commands related to "word"...
>>
>> Reading symbols from /Library/Frameworks/R.framework/Resources/bin/exec/R...
>>
>> warning:
>> `/Volumes/Builds/Simon/R4/high-sierra-x86_64/R-4.0-branch/src/main/Rmain.o':
>> can't open to read symbols: No such file or directory.
>>
>> (no debugging symbols found)...done.
>>
>> (gdb) run
>>
>> Starting program:
>> /Library/Frameworks/R.framework/Versions/4.0/Resources/bin/exec/R
>>
>> Unable to find Mach task port for process-id 59032: (os/kern) failure (0x5).
>>
>> (please check gdb is codesigned - see taskgated(8))
>>
>>> sessionInfo()
>>
>> R version 4.0.0 Patched (2020-04-27 r78309)
>>
>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>
>> Running under: macOS Mojave 10.14.6
>>
>>
>> Matrix products: default
>>
>> BLAS:
>> /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
>>
>> LAPACK:
>> /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
>>
>> -- 
>> The information in this e-mail is intended only for t...{{dropped:8}}


From r|p|ey @end|ng |rom @t@t@@ox@@c@uk  Wed Aug  5 16:16:25 2020
From: r|p|ey @end|ng |rom @t@t@@ox@@c@uk (Prof Brian Ripley)
Date: Wed, 5 Aug 2020 15:16:25 +0100
Subject: [R-SIG-Mac] Running R with lldb
In-Reply-To: <f10ab080-0e85-e15f-707c-9a2c3ae99119@gmail.com>
References: <CAANT7+Ux8uLoRWod3J=rnCgcpnpd5fWywt58G1e1XSy5q2+WAQ@mail.gmail.com>
 <6F80E69C-C674-4B6E-A9B8-1A4F8E33540B@R-project.org>
 <f10ab080-0e85-e15f-707c-9a2c3ae99119@gmail.com>
Message-ID: <a3fe2dc2-7f58-794e-6d52-5a759207972b@stats.ox.ac.uk>

One of the suggestions in

https://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Debugging-on-macOS

should help.  Both worked for my build of R-devel yesterday ....


On 05/08/2020 14:25, Duncan Murdoch wrote:
> I'm now successfully building R-devel in /Users/murdoch/R/R-devel.? If I 
> run it from that directory using
> 
>  ?bin/R -d lldb
> 
> it starts, but "run" gives this error:
> 
> Process 11165 launched: '/Users/murdoch/R/R-devel/bin/exec/R' (x86_64)
> dyld: Library not loaded: libRblas.dylib
>  ? Referenced from: /Users/murdoch/R/R-devel/bin/exec/R
>  ? Reason: image not found
> Process 11165 stopped
> * thread #1, stop reason = signal SIGABRT
>  ??? frame #0: 0x00000001004c7ede dyld`__abort_with_payload + 10
> dyld`__abort_with_payload:
> ->? 0x1004c7ede <+10>: jae??? 0x1004c7ee8?????????????? ; <+20>
>  ??? 0x1004c7ee0 <+12>: movq?? %rax, %rdi
>  ??? 0x1004c7ee3 <+15>: jmp??? 0x1004c6408?????????????? ; cerror_nocancel
>  ??? 0x1004c7ee8 <+20>: retq
> Target 0: (R) stopped.
> 
> I can start it from the /Users/murdoch/R/R-devel/lib directory where 
> libRblas.dylib lives.? Setting DYLD_LIBRARY_PATH or LD_LIBRARY_PATH to 
> point there doesn't help (either on the bin/R command line or exported). 
>  ?Is there some other way to run it from whatever directory I happen to 
> be in?
> 
> Duncan Murdoch
> 
> On 02/05/2020 11:26 p.m., Simon Urbanek wrote:
>> Vince,
>>
>> Apple no longer allows debugging of distributed apps - see R for Mac 
>> FAQ 10.17:
>> http://mac.r-project.org/bin/macosx/RMacOSX-FAQ.html#I-cannot-attach-debugger-to-R 
>>
>>
>> Another (not recommended) work-around is to disable SIP.
>>
>> Cheers,
>> Simon
>>
>>
>>
>>> On 3/05/2020, at 10:42 AM, Vincent Carey <stvjc at channing.harvard.edu> 
>>> wrote:
>>>
>>> I'd like to make use of material in
>>>
>>> https://kevinushey.github.io/blog/2015/04/13/debugging-with-lldb/
>>>
>>> But with R 4.0 I get
>>>
>>> %vjcair> R -d lldb
>>>
>>> (lldb) target create 
>>> "/Library/Frameworks/R.framework/Resources/bin/exec/R"
>>>
>>> Current executable set to
>>> '/Library/Frameworks/R.framework/Resources/bin/exec/R' (x86_64).
>>>
>>> (lldb) run
>>>
>>> error: process exited with status -1 (Error 1)
>>>
>>> (lldb) quit
>>>
>>> %vjcair> which lldb
>>>
>>> /usr/bin/lldb
>>>
>>> %vjcair> lldb --version
>>>
>>> lldb-1100.0.30.12
>>>
>>> Apple Swift version 5.1.3 (swiftlang-1100.0.282.1 clang-1100.0.33.15)
>>>
>>>
>>> with gdb, there is a little more info -- and a peculiar warning that
>>> mentions /Volumes/Builds/Simon/R4/h ...
>>>
>>>
>>> %vjcair> R -d gdb
>>>
>>> GNU gdb (GDB) 8.1
>>>
>>> Copyright (C) 2018 Free Software Foundation, Inc.
>>>
>>> License GPLv3+: GNU GPL version 3 or later 
>>> <http://gnu.org/licenses/gpl.html
>>>>
>>>
>>> This is free software: you are free to change and redistribute it.
>>>
>>> There is NO WARRANTY, to the extent permitted by law.? Type "show 
>>> copying"
>>>
>>> and "show warranty" for details.
>>>
>>> This GDB was configured as "x86_64-apple-darwin16.7.0".
>>>
>>> Type "show configuration" for configuration details.
>>>
>>> For bug reporting instructions, please see:
>>>
>>> <http://www.gnu.org/software/gdb/bugs/>.
>>>
>>> Find the GDB manual and other documentation resources online at:
>>>
>>> <http://www.gnu.org/software/gdb/documentation/>.
>>>
>>> For help, type "help".
>>>
>>> Type "apropos word" to search for commands related to "word"...
>>>
>>> Reading symbols from 
>>> /Library/Frameworks/R.framework/Resources/bin/exec/R...
>>>
>>> warning:
>>> `/Volumes/Builds/Simon/R4/high-sierra-x86_64/R-4.0-branch/src/main/Rmain.o': 
>>>
>>> can't open to read symbols: No such file or directory.
>>>
>>> (no debugging symbols found)...done.
>>>
>>> (gdb) run
>>>
>>> Starting program:
>>> /Library/Frameworks/R.framework/Versions/4.0/Resources/bin/exec/R
>>>
>>> Unable to find Mach task port for process-id 59032: (os/kern) failure 
>>> (0x5).
>>>
>>> (please check gdb is codesigned - see taskgated(8))
>>>
>>>> sessionInfo()
>>>
>>> R version 4.0.0 Patched (2020-04-27 r78309)
>>>
>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>
>>> Running under: macOS Mojave 10.14.6
>>>
>>>
>>> Matrix products: default
>>>
>>> BLAS:
>>> /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib 
>>>
>>>
>>> LAPACK:
>>> /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib 
>>>
>>>
>>> -- 
>>> The information in this e-mail is intended only for t...{{dropped:8}}
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Emeritus Professor of Applied Statistics, University of Oxford


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Aug  5 16:42:21 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 5 Aug 2020 10:42:21 -0400
Subject: [R-SIG-Mac] Running R with lldb
In-Reply-To: <a3fe2dc2-7f58-794e-6d52-5a759207972b@stats.ox.ac.uk>
References: <CAANT7+Ux8uLoRWod3J=rnCgcpnpd5fWywt58G1e1XSy5q2+WAQ@mail.gmail.com>
 <6F80E69C-C674-4B6E-A9B8-1A4F8E33540B@R-project.org>
 <f10ab080-0e85-e15f-707c-9a2c3ae99119@gmail.com>
 <a3fe2dc2-7f58-794e-6d52-5a759207972b@stats.ox.ac.uk>
Message-ID: <84f8196d-9bfd-c413-62c8-72745f191030@gmail.com>

Thanks, attaching to the process seemed simplest.

For others:  the manual talks about doing it with gdb, but the same 
syntax works with lldb.  Here's an example:  Start R, then open a new 
terminal window:

murdoch at djmair3 ~
$ ps
   PID TTY           TIME CMD
11293 ttys000    0:00.08 -bash
13829 ttys000    0:00.31 /Users/murdoch/R/R-devel/bin/exec/R
13804 ttys001    0:00.03 -bash

murdoch at djmair3 ~
$ lldb -p 13829
(lldb) process attach --pid 13829
Process 13829 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP
     frame #0: 0x00007fff70eb10fe libsystem_kernel.dylib`__select + 10
libsystem_kernel.dylib`__select:
->  0x7fff70eb10fe <+10>: jae    0x7fff70eb1108            ; <+20>
     0x7fff70eb1100 <+12>: movq   %rax, %rdi
     0x7fff70eb1103 <+15>: jmp    0x7fff70eaa22d            ; cerror
     0x7fff70eb1108 <+20>: retq
Target 0: (R) stopped.

Duncan Murdoch

On 05/08/2020 10:16 a.m., Prof Brian Ripley wrote:
> One of the suggestions in
> 
> https://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Debugging-on-macOS
> 
> should help.  Both worked for my build of R-devel yesterday ....
> 
> 
> On 05/08/2020 14:25, Duncan Murdoch wrote:
>> I'm now successfully building R-devel in /Users/murdoch/R/R-devel.? If I
>> run it from that directory using
>>
>>   ?bin/R -d lldb
>>
>> it starts, but "run" gives this error:
>>
>> Process 11165 launched: '/Users/murdoch/R/R-devel/bin/exec/R' (x86_64)
>> dyld: Library not loaded: libRblas.dylib
>>   ? Referenced from: /Users/murdoch/R/R-devel/bin/exec/R
>>   ? Reason: image not found
>> Process 11165 stopped
>> * thread #1, stop reason = signal SIGABRT
>>   ??? frame #0: 0x00000001004c7ede dyld`__abort_with_payload + 10
>> dyld`__abort_with_payload:
>> ->? 0x1004c7ede <+10>: jae??? 0x1004c7ee8?????????????? ; <+20>
>>   ??? 0x1004c7ee0 <+12>: movq?? %rax, %rdi
>>   ??? 0x1004c7ee3 <+15>: jmp??? 0x1004c6408?????????????? ; cerror_nocancel
>>   ??? 0x1004c7ee8 <+20>: retq
>> Target 0: (R) stopped.
>>
>> I can start it from the /Users/murdoch/R/R-devel/lib directory where
>> libRblas.dylib lives.? Setting DYLD_LIBRARY_PATH or LD_LIBRARY_PATH to
>> point there doesn't help (either on the bin/R command line or exported).
>>   ?Is there some other way to run it from whatever directory I happen to
>> be in?
>>
>> Duncan Murdoch
>>
>> On 02/05/2020 11:26 p.m., Simon Urbanek wrote:
>>> Vince,
>>>
>>> Apple no longer allows debugging of distributed apps - see R for Mac
>>> FAQ 10.17:
>>> http://mac.r-project.org/bin/macosx/RMacOSX-FAQ.html#I-cannot-attach-debugger-to-R
>>>
>>>
>>> Another (not recommended) work-around is to disable SIP.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>
>>>> On 3/05/2020, at 10:42 AM, Vincent Carey <stvjc at channing.harvard.edu>
>>>> wrote:
>>>>
>>>> I'd like to make use of material in
>>>>
>>>> https://kevinushey.github.io/blog/2015/04/13/debugging-with-lldb/
>>>>
>>>> But with R 4.0 I get
>>>>
>>>> %vjcair> R -d lldb
>>>>
>>>> (lldb) target create
>>>> "/Library/Frameworks/R.framework/Resources/bin/exec/R"
>>>>
>>>> Current executable set to
>>>> '/Library/Frameworks/R.framework/Resources/bin/exec/R' (x86_64).
>>>>
>>>> (lldb) run
>>>>
>>>> error: process exited with status -1 (Error 1)
>>>>
>>>> (lldb) quit
>>>>
>>>> %vjcair> which lldb
>>>>
>>>> /usr/bin/lldb
>>>>
>>>> %vjcair> lldb --version
>>>>
>>>> lldb-1100.0.30.12
>>>>
>>>> Apple Swift version 5.1.3 (swiftlang-1100.0.282.1 clang-1100.0.33.15)
>>>>
>>>>
>>>> with gdb, there is a little more info -- and a peculiar warning that
>>>> mentions /Volumes/Builds/Simon/R4/h ...
>>>>
>>>>
>>>> %vjcair> R -d gdb
>>>>
>>>> GNU gdb (GDB) 8.1
>>>>
>>>> Copyright (C) 2018 Free Software Foundation, Inc.
>>>>
>>>> License GPLv3+: GNU GPL version 3 or later
>>>> <http://gnu.org/licenses/gpl.html
>>>>>
>>>>
>>>> This is free software: you are free to change and redistribute it.
>>>>
>>>> There is NO WARRANTY, to the extent permitted by law.? Type "show
>>>> copying"
>>>>
>>>> and "show warranty" for details.
>>>>
>>>> This GDB was configured as "x86_64-apple-darwin16.7.0".
>>>>
>>>> Type "show configuration" for configuration details.
>>>>
>>>> For bug reporting instructions, please see:
>>>>
>>>> <http://www.gnu.org/software/gdb/bugs/>.
>>>>
>>>> Find the GDB manual and other documentation resources online at:
>>>>
>>>> <http://www.gnu.org/software/gdb/documentation/>.
>>>>
>>>> For help, type "help".
>>>>
>>>> Type "apropos word" to search for commands related to "word"...
>>>>
>>>> Reading symbols from
>>>> /Library/Frameworks/R.framework/Resources/bin/exec/R...
>>>>
>>>> warning:
>>>> `/Volumes/Builds/Simon/R4/high-sierra-x86_64/R-4.0-branch/src/main/Rmain.o':
>>>>
>>>> can't open to read symbols: No such file or directory.
>>>>
>>>> (no debugging symbols found)...done.
>>>>
>>>> (gdb) run
>>>>
>>>> Starting program:
>>>> /Library/Frameworks/R.framework/Versions/4.0/Resources/bin/exec/R
>>>>
>>>> Unable to find Mach task port for process-id 59032: (os/kern) failure
>>>> (0x5).
>>>>
>>>> (please check gdb is codesigned - see taskgated(8))
>>>>
>>>>> sessionInfo()
>>>>
>>>> R version 4.0.0 Patched (2020-04-27 r78309)
>>>>
>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>
>>>> Running under: macOS Mojave 10.14.6
>>>>
>>>>
>>>> Matrix products: default
>>>>
>>>> BLAS:
>>>> /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
>>>>
>>>>
>>>> LAPACK:
>>>> /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
>>>>
>>>>
>>>> -- 
>>>> The information in this e-mail is intended only for t...{{dropped:8}}
>>
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 
>


From ken @end|ng |rom kjbe@th@com@@u  Mon Aug 10 04:01:35 2020
From: ken @end|ng |rom kjbe@th@com@@u (Ken Beath)
Date: Mon, 10 Aug 2020 12:01:35 +1000
Subject: [R-SIG-Mac] Daily builds
In-Reply-To: <CABtg=KnfEM3xZU535OcyLUTcqgJnXix78Qi4+8=kjsh=8Rvidw@mail.gmail.com>
References: <CABtg=KnfEM3xZU535OcyLUTcqgJnXix78Qi4+8=kjsh=8Rvidw@mail.gmail.com>
Message-ID: <D6F2ACD8-3D5B-4B98-8161-D3E8FBED9C71@kjbeath.com.au>

Still missing.

Ken

> On 23 Jul 2020, at 11:06 pm, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
> 
> Hi Simon,
> 
> I wonder if the tarballs and the installers for 4.0 and 4.1 are
> missing from https://mac.r-project.org/ on purpose. The logs seem to
> have recent dates, but the installers or the links to them are not
> there?
> 
> Thanks much,
> Gabor
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From @|mon@urb@nek @end|ng |rom R-project@org  Mon Aug 10 05:12:49 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 10 Aug 2020 15:12:49 +1200
Subject: [R-SIG-Mac] Daily builds
In-Reply-To: <D6F2ACD8-3D5B-4B98-8161-D3E8FBED9C71@kjbeath.com.au>
References: <CABtg=KnfEM3xZU535OcyLUTcqgJnXix78Qi4+8=kjsh=8Rvidw@mail.gmail.com>
 <D6F2ACD8-3D5B-4B98-8161-D3E8FBED9C71@kjbeath.com.au>
Message-ID: <F58C048D-22E3-4F84-8160-EB242BA8E051@R-project.org>

There is an issue with automated signing (more precisely the authorization of the codesigning tools), so the tar balls are available, but the packaging fails. The website generation scripts makes the output conditional on the presence of the package, so it wasn't showing the links even though the files are present. I have fixed the latter, so at least the tar ball links should be there.
Hopefully the package will appear again once the signing issues are solved.

Cheers,
Simon



> On 10/08/2020, at 2:01 PM, Ken Beath <ken at kjbeath.com.au> wrote:
> 
> Still missing.
> 
> Ken
> 
>> On 23 Jul 2020, at 11:06 pm, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
>> 
>> Hi Simon,
>> 
>> I wonder if the tarballs and the installers for 4.0 and 4.1 are
>> missing from https://mac.r-project.org/ on purpose. The logs seem to
>> have recent dates, but the installers or the links to them are not
>> there?
>> 
>> Thanks much,
>> Gabor
>> 
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 


From |@@@c-t-peter@en @end|ng |rom u|ow@@edu  Tue Aug 11 00:33:07 2020
From: |@@@c-t-peter@en @end|ng |rom u|ow@@edu (Isaac Petersen)
Date: Mon, 10 Aug 2020 17:33:07 -0500
Subject: [R-SIG-Mac] Error compiling C++ code in R 4.0 on Mac OS X Catalina
Message-ID: <CAPBn5XtzH3bu3h_CMpzJpAmZvRFe5aoJWRzVQb2xPoFNrxxknQ@mail.gmail.com>

I'm trying to compile C++ code in R so I can install packages from source.
I?m running R 4.0.2 on Mac OS X Catalina (10.15.6).  I receive an error
when trying to compile C++ code in R.  I posted the full details of my
problem on Stack Overflow here:
https://stackoverflow.com/questions/63276265/error-compiling-c-code-in-r-4-0-on-mac-os-x-catalina?noredirect=1#comment112012438_63276265.
The question was unfortunately marked as a duplicate because it is similar
to another question, even though the answers to the "similar" question did
not solve my problem.  One responder noted that
"/usr/local/include/RcppArmadillo.h" was missing (even though I
successfully installed the RcppArmadillo package).  Any help would be
greatly appreciated.

Thanks very much in advance.
-Isaac

---
Isaac T. Petersen, Ph.D.
Assistant Professor
Department of Psychological and Brain Sciences
University of Iowa
175 Psychological and Brain Sciences Building
Iowa City, IA 52242
p: (319) 467-1014
isaac-t-petersen at uiowa.edu
https://psychology.uiowa.edu/developmental-psychopathology-lab

	[[alternative HTML version deleted]]


From bob @end|ng |rom rud@|@  Tue Aug 11 01:48:46 2020
From: bob @end|ng |rom rud@|@ (Bob Rudis)
Date: Mon, 10 Aug 2020 19:48:46 -0400
Subject: [R-SIG-Mac] 
 Error compiling C++ code in R 4.0 on Mac OS X Catalina
In-Reply-To: <CAPBn5XtzH3bu3h_CMpzJpAmZvRFe5aoJWRzVQb2xPoFNrxxknQ@mail.gmail.com>
References: <CAPBn5XtzH3bu3h_CMpzJpAmZvRFe5aoJWRzVQb2xPoFNrxxknQ@mail.gmail.com>
Message-ID: <2CEB65A9-A7D8-4036-AEB8-509AF191D5DA@rud.is>

Something is causing Rcpp to be unable to detect the presence of {RcppArmadillo}, which can be seen in the lack of the include for it in the snippet you posted on SO (FWIW that site has multiple trackers and I'm not really a fan of being made a product to try to answer a question):

    clang++ 
      -mmacosx-version-min=10.13 \
      -std=gnu++11 \
      -I"/Library/Frameworks/R.framework/Resources/include" \
      -DNDEBUG \
      -I"/Library/Frameworks/R.framework/Packages/Rcpp/include" \
      -I"/Users/itpetersen/Desktop" \
      -I/usr/local/include \
      -fPIC -Wall -g -O2  -c helloworld.cpp -o helloworld.o


Can you re-run the sourceRcpp() call with `verbose = TRUE` and paste the output here?

Also, have you tried:

    remove.packages(c("Rcpp", "RcppArmadillo"))
    install.packages(c("Rcpp", "RcppArmadillo"))

and trying everything again in a `--vanilla` R session?

> On Aug 10, 2020, at 18:33, Isaac Petersen <isaac-t-petersen at uiowa.edu> wrote:
> 
> I'm trying to compile C++ code in R so I can install packages from source.
> I?m running R 4.0.2 on Mac OS X Catalina (10.15.6).  I receive an error
> when trying to compile C++ code in R.  I posted the full details of my
> problem on Stack Overflow here:
> https://stackoverflow.com/questions/63276265/error-compiling-c-code-in-r-4-0-on-mac-os-x-catalina?noredirect=1#comment112012438_63276265.
> The question was unfortunately marked as a duplicate because it is similar
> to another question, even though the answers to the "similar" question did
> not solve my problem.  One responder noted that
> "/usr/local/include/RcppArmadillo.h" was missing (even though I
> successfully installed the RcppArmadillo package).  Any help would be
> greatly appreciated.
> 
> Thanks very much in advance.
> -Isaac
> 
> ---
> Isaac T. Petersen, Ph.D.
> Assistant Professor
> Department of Psychological and Brain Sciences
> University of Iowa
> 175 Psychological and Brain Sciences Building
> Iowa City, IA 52242
> p: (319) 467-1014
> isaac-t-petersen at uiowa.edu
> https://psychology.uiowa.edu/developmental-psychopathology-lab
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From b@|@mut2 @end|ng |rom ||||no|@@edu  Tue Aug 11 02:26:47 2020
From: b@|@mut2 @end|ng |rom ||||no|@@edu (Balamuta, James Joseph)
Date: Tue, 11 Aug 2020 00:26:47 +0000
Subject: [R-SIG-Mac] 
 Error compiling C++ code in R 4.0 on Mac OS X Catalina
In-Reply-To: <2CEB65A9-A7D8-4036-AEB8-509AF191D5DA@rud.is>
References: <CAPBn5XtzH3bu3h_CMpzJpAmZvRFe5aoJWRzVQb2xPoFNrxxknQ@mail.gmail.com>
 <2CEB65A9-A7D8-4036-AEB8-509AF191D5DA@rud.is>
Message-ID: <AD096D36-FE3B-4213-8F4D-236572276E6F@illinois.edu>

Isaac, 

To build off of what Bob mentioned, you may wish to check that Rcpp and RcppArmadillo are indeed installed.

From SO, we see:

/Library/Frameworks/R.framework/Packages/RcppArmadillo/include/RcppArmadilloForward.h:26:10: fatal error: 'RcppCommon.h' file not found
#include <RcppCommon.h>
         ^~~~~~~~~~~~~~

helloworld.cpp:1:10: fatal error: 'RcppArmadillo.h' file not found
#include <RcppArmadillo.h>   

Both statements are indicating that the header files for Rcpp and RcppArmadillo are not present on the system.

Could you try this minimal compilation?

install.packages("Rcpp", type = "source")
Rcpp::evalCpp("1 + 1", verbose = TRUE)

Best,

JJB

?On 8/10/20, 7:00 PM, "R-SIG-Mac on behalf of Bob Rudis" <r-sig-mac-bounces at r-project.org on behalf of bob at rud.is> wrote:

    Something is causing Rcpp to be unable to detect the presence of {RcppArmadillo}, which can be seen in the lack of the include for it in the snippet you posted on SO (FWIW that site has multiple trackers and I'm not really a fan of being made a product to try to answer a question):

        clang++ 
          -mmacosx-version-min=10.13 \
          -std=gnu++11 \
          -I"/Library/Frameworks/R.framework/Resources/include" \
          -DNDEBUG \
          -I"/Library/Frameworks/R.framework/Packages/Rcpp/include" \
          -I"/Users/itpetersen/Desktop" \
          -I/usr/local/include \
          -fPIC -Wall -g -O2  -c helloworld.cpp -o helloworld.o


    Can you re-run the sourceRcpp() call with `verbose = TRUE` and paste the output here?

    Also, have you tried:

        remove.packages(c("Rcpp", "RcppArmadillo"))
        install.packages(c("Rcpp", "RcppArmadillo"))

    and trying everything again in a `--vanilla` R session?

    > On Aug 10, 2020, at 18:33, Isaac Petersen <isaac-t-petersen at uiowa.edu> wrote:
    > 
    > I'm trying to compile C++ code in R so I can install packages from source.
    > I?m running R 4.0.2 on Mac OS X Catalina (10.15.6).  I receive an error
    > when trying to compile C++ code in R.  I posted the full details of my
    > problem on Stack Overflow here:
    > https://stackoverflow.com/questions/63276265/error-compiling-c-code-in-r-4-0-on-mac-os-x-catalina?noredirect=1#comment112012438_63276265.
    > The question was unfortunately marked as a duplicate because it is similar
    > to another question, even though the answers to the "similar" question did
    > not solve my problem.  One responder noted that
    > "/usr/local/include/RcppArmadillo.h" was missing (even though I
    > successfully installed the RcppArmadillo package).  Any help would be
    > greatly appreciated.
    > 
    > Thanks very much in advance.
    > -Isaac
    > 
    > ---
    > Isaac T. Petersen, Ph.D.
    > Assistant Professor
    > Department of Psychological and Brain Sciences
    > University of Iowa
    > 175 Psychological and Brain Sciences Building
    > Iowa City, IA 52242
    > p: (319) 467-1014
    > isaac-t-petersen at uiowa.edu
    > https://psychology.uiowa.edu/developmental-psychopathology-lab
    > 
    > 	[[alternative HTML version deleted]]
    > 
    > _______________________________________________
    > R-SIG-Mac mailing list
    > R-SIG-Mac at r-project.org
    > https://stat.ethz.ch/mailman/listinfo/r-sig-mac

    _______________________________________________
    R-SIG-Mac mailing list
    R-SIG-Mac at r-project.org
    https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From |@@@c-t-peter@en @end|ng |rom u|ow@@edu  Tue Aug 11 18:16:47 2020
From: |@@@c-t-peter@en @end|ng |rom u|ow@@edu (Isaac Petersen)
Date: Tue, 11 Aug 2020 11:16:47 -0500
Subject: [R-SIG-Mac] 
 [External] Re: Error compiling C++ code in R 4.0 on Mac
 OS X Catalina
In-Reply-To: <AD096D36-FE3B-4213-8F4D-236572276E6F@illinois.edu>
References: <CAPBn5XtzH3bu3h_CMpzJpAmZvRFe5aoJWRzVQb2xPoFNrxxknQ@mail.gmail.com>
 <2CEB65A9-A7D8-4036-AEB8-509AF191D5DA@rud.is>
 <AD096D36-FE3B-4213-8F4D-236572276E6F@illinois.edu>
Message-ID: <CAPBn5XvwW248MX25cmFnCPLpz5f-AtH3oxu8fF6O02Edrrd9yA@mail.gmail.com>

Hi James and Bob,

I tried your suggestions and am attaching the output.  I wasn't able to
figure out how to run a vanilla R session, but I ran the commands in an R
session without loading any packages and without any Rprofile.site or
.Renviron files.  I removed both the Rcpp and RcppArmadillo packages and
reinstalled both from source.  Then I ran the commands.

The following command evaluated successfully (and returned the value of
"2"):
Rcpp::evalCpp("1 + 1", verbose = TRUE)

The following command did not evaluate successfully and returned an error.
I added "verbose = TRUE" to the command to provide the additional requested
output:
Rcpp::sourceCpp('/Users/itpetersen/Desktop/helloworld.cpp', verbose = TRUE)

Thanks very much for your help.
-Isaac

On Mon, Aug 10, 2020 at 7:26 PM Balamuta, James Joseph <
balamut2 at illinois.edu> wrote:

> Isaac,
>
> To build off of what Bob mentioned, you may wish to check that Rcpp and
> RcppArmadillo are indeed installed.
>
> From SO, we see:
>
> /Library/Frameworks/R.framework/Packages/RcppArmadillo/include/RcppArmadilloForward.h:26:10:
> fatal error: 'RcppCommon.h' file not found
> #include <RcppCommon.h>
>          ^~~~~~~~~~~~~~
>
> helloworld.cpp:1:10: fatal error: 'RcppArmadillo.h' file not found
> #include <RcppArmadillo.h>
>
> Both statements are indicating that the header files for Rcpp and
> RcppArmadillo are not present on the system.
>
> Could you try this minimal compilation?
>
> install.packages("Rcpp", type = "source")
> Rcpp::evalCpp("1 + 1", verbose = TRUE)
>
> Best,
>
> JJB
>
> ?On 8/10/20, 7:00 PM, "R-SIG-Mac on behalf of Bob Rudis" <
> r-sig-mac-bounces at r-project.org on behalf of bob at rud.is> wrote:
>
>     Something is causing Rcpp to be unable to detect the presence of
> {RcppArmadillo}, which can be seen in the lack of the include for it in the
> snippet you posted on SO (FWIW that site has multiple trackers and I'm not
> really a fan of being made a product to try to answer a question):
>
>         clang++
>           -mmacosx-version-min=10.13 \
>           -std=gnu++11 \
>           -I"/Library/Frameworks/R.framework/Resources/include" \
>           -DNDEBUG \
>           -I"/Library/Frameworks/R.framework/Packages/Rcpp/include" \
>           -I"/Users/itpetersen/Desktop" \
>           -I/usr/local/include \
>           -fPIC -Wall -g -O2  -c helloworld.cpp -o helloworld.o
>
>
>     Can you re-run the sourceRcpp() call with `verbose = TRUE` and paste
> the output here?
>
>     Also, have you tried:
>
>         remove.packages(c("Rcpp", "RcppArmadillo"))
>         install.packages(c("Rcpp", "RcppArmadillo"))
>
>     and trying everything again in a `--vanilla` R session?
>
>     > On Aug 10, 2020, at 18:33, Isaac Petersen <
> isaac-t-petersen at uiowa.edu> wrote:
>     >
>     > I'm trying to compile C++ code in R so I can install packages from
> source.
>     > I?m running R 4.0.2 on Mac OS X Catalina (10.15.6).  I receive an
> error
>     > when trying to compile C++ code in R.  I posted the full details of
> my
>     > problem on Stack Overflow here:
>     >
> https://stackoverflow.com/questions/63276265/error-compiling-c-code-in-r-4-0-on-mac-os-x-catalina?noredirect=1#comment112012438_63276265
> .
>     > The question was unfortunately marked as a duplicate because it is
> similar
>     > to another question, even though the answers to the "similar"
> question did
>     > not solve my problem.  One responder noted that
>     > "/usr/local/include/RcppArmadillo.h" was missing (even though I
>     > successfully installed the RcppArmadillo package).  Any help would be
>     > greatly appreciated.
>     >
>     > Thanks very much in advance.
>     > -Isaac
>     >
>     > ---
>     > Isaac T. Petersen, Ph.D.
>     > Assistant Professor
>     > Department of Psychological and Brain Sciences
>     > University of Iowa
>     > 175 Psychological and Brain Sciences Building
>     > Iowa City, IA 52242
>     > p: (319) 467-1014
>     > isaac-t-petersen at uiowa.edu
>     > https://psychology.uiowa.edu/developmental-psychopathology-lab
>     >
>     >   [[alternative HTML version deleted]]
>     >
>     > _______________________________________________
>     > R-SIG-Mac mailing list
>     > R-SIG-Mac at r-project.org
>     > https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>
>     _______________________________________________
>     R-SIG-Mac mailing list
>     R-SIG-Mac at r-project.org
>     https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-mac/attachments/20200811/5cb1b874/attachment-0001.html>

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: output.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-mac/attachments/20200811/5cb1b874/attachment-0001.txt>

From c@r| @end|ng |rom w|ttho|t@com  Sat Aug 15 16:07:56 2020
From: c@r| @end|ng |rom w|ttho|t@com (Carl Witthoft)
Date: Sat, 15 Aug 2020 10:07:56 -0400
Subject: [R-SIG-Mac] Editor beginning-of-line-chomp?
Message-ID: <ee0569c6-d374-180c-96d5-4e4d5138b37c@witthoft.com>

Hi,
Not sure when I first noticed this.  When I open a file in the Rgui 
Editor,  the window opens with the text "shifted left" so the first char 
or two are invisible. I can click & "push" to get the proper left-hand 
margin viewable, but have to do this every time.

I've tried it with "show line numbers" preference set to ON and to OFF; 
same problem.
I'm running Catalina, R7849Debug but saw the same thing with previous 
release versions.


-- 
Carl Witthoft
carl at witthoft.com
resume: https://app.box.com/file/498153801347


From h@n@on @end|ng |rom dep@uw@edu  Sat Aug 15 17:36:49 2020
From: h@n@on @end|ng |rom dep@uw@edu (Bryan Hanson)
Date: Sat, 15 Aug 2020 11:36:49 -0400
Subject: [R-SIG-Mac] Editor beginning-of-line-chomp?
In-Reply-To: <ee0569c6-d374-180c-96d5-4e4d5138b37c@witthoft.com>
References: <ee0569c6-d374-180c-96d5-4e4d5138b37c@witthoft.com>
Message-ID: <9EA2871C-5C05-47F8-A3B5-CAB0E3729A18@depauw.edu>

I have seen this for about a month or so as well. 

> On Aug 15, 2020, at 10:07 AM, Carl Witthoft <carl at witthoft.com> wrote:
> 
> Hi,
> Not sure when I first noticed this.  When I open a file in the Rgui Editor,  the window opens with the text "shifted left" so the first char or two are invisible. I can click & "push" to get the proper left-hand margin viewable, but have to do this every time.
> 
> I've tried it with "show line numbers" preference set to ON and to OFF; same problem.
> I'm running Catalina, R7849Debug but saw the same thing with previous release versions.
> 
> 
> -- 
> Carl Witthoft
> carl at witthoft.com
> resume: https://app.box.com/file/498153801347
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From @|mon@urb@nek @end|ng |rom R-project@org  Sun Aug 16 00:55:36 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sun, 16 Aug 2020 10:55:36 +1200
Subject: [R-SIG-Mac] Editor beginning-of-line-chomp?
In-Reply-To: <ee0569c6-d374-180c-96d5-4e4d5138b37c@witthoft.com>
References: <ee0569c6-d374-180c-96d5-4e4d5138b37c@witthoft.com>
Message-ID: <7CDD4B10-CEBC-4D33-9BA2-445DBD2E2FCA@R-project.org>

Yes, this is a known problem on Catalina. It goes away if you use the touchpad to pan or if you start typing. It's unclear at this point what is causing it. Catalina generally exhibits few rendering issues (missing background for some elements etc.). Those are under investigation.

Cheers,
Simon


> On Aug 16, 2020, at 02:07, Carl Witthoft <carl at witthoft.com> wrote:
> 
> Hi,
> Not sure when I first noticed this.  When I open a file in the Rgui Editor,  the window opens with the text "shifted left" so the first char or two are invisible. I can click & "push" to get the proper left-hand margin viewable, but have to do this every time.
> 
> I've tried it with "show line numbers" preference set to ON and to OFF; same problem.
> I'm running Catalina, R7849Debug but saw the same thing with previous release versions.
> 
> 
> -- 
> Carl Witthoft
> carl at witthoft.com
> resume: https://app.box.com/file/498153801347
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 


From j@me@@|@he@ter @end|ng |rom gm@||@com  Mon Aug 24 16:12:21 2020
From: j@me@@|@he@ter @end|ng |rom gm@||@com (Jim Hester)
Date: Mon, 24 Aug 2020 10:12:21 -0400
Subject: [R-SIG-Mac] R, FORTRAN and Apple Silicon
Message-ID: <CAD6tx97s=BpTJJJ6U2oxTJiuSDGnKqiofpqhmAzbUrBzt31Uvg@mail.gmail.com>

I recently inquired about the progress of gcc (more specifically gfortran)
support with Apple's new 'Apple Silicon' architecture. [0]

As of today it seems gfortran is not available natively, which has
implications for R support on upcoming Apple hardware.

Subsequently I have been in email contact with a few people at Apple on
their progress and wanted to update those here.

They also have some questions on what features we rely on in the R
community that I thought some on this mailing list would have better
insight in answering than I.

I would be happy to give the apple contacts information off-list, or CC you
into the email thread if you would like. Alternatively I can communicate
our answers back to them myself.

Also I have a Developer Transition Kit at home, so I can run tests if it
would be beneficial.

Apple's response follows

> We've been working with Iain on figuring out a path forward for gfortran,
they recently published a branch
https://github.com/iains/gcc-darwin-arm64#readme with some early support in
gcc. We are aware of some of the issues with FP80 vs FP64 and our last
internal discussion was trying to ascertain how relevant and important FP80
is in the fortran community. There are some complexities with FP80 (and
higher) that are going to make it not very timely, even native, on Apple
silicon. If we could set aside FP80+ as not critical it would allow us to
focus on FP64. What are your thoughts?

> I think we are able to support technical discussions if people have
questions and we've made hardware available to individuals as
needed/requested as well.

> I did see those tweets when they were posted, we'd already been
discussing Fortran with several vendors that depend on it, like Matlab.  It
would also be good to understand example workloads that are important so we
can take a look at them on Rosetta today, since any effort to go native
will likely rely on some period of Rosetta as a fall back and we'd like to
ensure thats feasible.

[0]: https://twitter.com/jimhester_/status/1292821727165194240

	[[alternative HTML version deleted]]


From jpr|t|k|n @end|ng |rom pobox@com  Mon Aug 24 19:30:20 2020
From: jpr|t|k|n @end|ng |rom pobox@com (Joshua N Pritikin)
Date: Mon, 24 Aug 2020 13:30:20 -0400
Subject: [R-SIG-Mac] [R-pkg-devel] os/x compiled w/ openmp?
In-Reply-To: <20200721115727.6kclscyu5vb5figc@cocoa>
References: <20200713141414.piydxyjzyslfqg2a-3708@cocoa>
 <20200721132417.12420599@trisector>
 <20200721115727.6kclscyu5vb5figc@cocoa>
Message-ID: <20200824173020.7ywk75knv4tnq4pe@cocoa>

On Tue, Jul 21, 2020 at 07:57:27AM -0400, Joshua N Pritikin wrote:
> On Tue, Jul 21, 2020 at 01:24:17PM +0300, Ivan Krylov wrote:
> > https://ryanhomer.github.io/posts/build-openmp-macos-catalina-complete
> 
> Are you aware of any CRAN packages built by Travis with OpenMP enabled?

FYI, it looks like the OpenMx build is succeeding,

  https://travis-ci.org/github/OpenMx/OpenMx/jobs/720373285


From @|mon@urb@nek @end|ng |rom R-project@org  Tue Aug 25 00:11:03 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Tue, 25 Aug 2020 10:11:03 +1200
Subject: [R-SIG-Mac] R, FORTRAN and Apple Silicon
In-Reply-To: <CAD6tx97s=BpTJJJ6U2oxTJiuSDGnKqiofpqhmAzbUrBzt31Uvg@mail.gmail.com>
References: <CAD6tx97s=BpTJJJ6U2oxTJiuSDGnKqiofpqhmAzbUrBzt31Uvg@mail.gmail.com>
Message-ID: <3D648DC7-A78A-4AA2-9877-1FDC235D2C10@R-project.org>

Jim,

thanks for the update, yes, we are aware and we have an ADP now, too, and are assessing the issues. I got base R working using f2c as a stop-gap measure, but it doesn't pass all checks due to fp issues (not necessarily related to Fortran) so there are more moving parts to this. It would be good to be involved in the discussions, so any pointers are welcome.

Thanks,
Simon



> On Aug 25, 2020, at 2:12 AM, Jim Hester <james.f.hester at gmail.com> wrote:
> 
> I recently inquired about the progress of gcc (more specifically gfortran)
> support with Apple's new 'Apple Silicon' architecture. [0]
> 
> As of today it seems gfortran is not available natively, which has
> implications for R support on upcoming Apple hardware.
> 
> Subsequently I have been in email contact with a few people at Apple on
> their progress and wanted to update those here.
> 
> They also have some questions on what features we rely on in the R
> community that I thought some on this mailing list would have better
> insight in answering than I.
> 
> I would be happy to give the apple contacts information off-list, or CC you
> into the email thread if you would like. Alternatively I can communicate
> our answers back to them myself.
> 
> Also I have a Developer Transition Kit at home, so I can run tests if it
> would be beneficial.
> 
> Apple's response follows
> 
>> We've been working with Iain on figuring out a path forward for gfortran,
> they recently published a branch
> https://github.com/iains/gcc-darwin-arm64#readme with some early support in
> gcc. We are aware of some of the issues with FP80 vs FP64 and our last
> internal discussion was trying to ascertain how relevant and important FP80
> is in the fortran community. There are some complexities with FP80 (and
> higher) that are going to make it not very timely, even native, on Apple
> silicon. If we could set aside FP80+ as not critical it would allow us to
> focus on FP64. What are your thoughts?
> 
>> I think we are able to support technical discussions if people have
> questions and we've made hardware available to individuals as
> needed/requested as well.
> 
>> I did see those tweets when they were posted, we'd already been
> discussing Fortran with several vendors that depend on it, like Matlab.  It
> would also be good to understand example workloads that are important so we
> can take a look at them on Rosetta today, since any effort to go native
> will likely rely on some period of Rosetta as a fall back and we'd like to
> ensure thats feasible.
> 
> [0]: https://twitter.com/jimhester_/status/1292821727165194240
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From he||yj @end|ng |rom uc@d@edu  Tue Aug 25 07:08:34 2020
From: he||yj @end|ng |rom uc@d@edu (John Helly)
Date: Mon, 24 Aug 2020 22:08:34 -0700
Subject: [R-SIG-Mac] R, FORTRAN and Apple Silicon
In-Reply-To: <3D648DC7-A78A-4AA2-9877-1FDC235D2C10@R-project.org>
References: <CAD6tx97s=BpTJJJ6U2oxTJiuSDGnKqiofpqhmAzbUrBzt31Uvg@mail.gmail.com>
 <3D648DC7-A78A-4AA2-9877-1FDC235D2C10@R-project.org>
Message-ID: <e6278b0d-6ecb-9cc5-cd5f-1a35a13aa1bd@ucsd.edu>

Aloha.

At the risk of being a voice from left-field, there are a few
observations I'd like to add in a constructive spirit.? I see now that
they don't? sounds constructive but think about the strategy for the
next 10-20 years.

 1.

    I have bitten the bullet and switched to macports for most GNU-type
    software.? I still roll-my-own for things like GDAL and GMT since
    macports doesn't always have what I want.? I do use it for compilers
    and related development tools for the most part and it has been ok
    most of the time.? I'm not advocating maports per se but one needs
    an escape hatch from Apple's clutches as long as it's moderately
    useful.?

 2.

    Brew, macports they are headed in the same direction as Red Hat
    Linux but the spirit of the open-source community has deflated
    because of the proliferation of dependencies and the time require to
    make anything work.? Is there any hope of ever getting that back??
    Probably not, since we're all dying off and being replaced by people
    who have grown up being dependent on vendors.? This is what happened
    in centralized computing in the 70's before the personal computer
    revolution.? Now it's centralization again.

 3. I've also accepted the fact that Apple has been closing-down its
    open-source universe for years (maybe decades) now and I maintain
    *nix servers as an alternate against the day that the next OSX
    release blows everything away.? Catalina came close, maybe still
    will but the pattern is clear.? Apple is going entirely proprietary
    and has been for a long time.? The open-source community will have
    to abandon Apple in the not so distant future.? Many have already.?
    I've got tons of Apple hardware but resigned to the fact that it
    will be only useful for audio-visual 'stuff'.
 4.

    Perhaps a major shift out of Apple hardware is needed to re-vitalize
    the open-source community that has gotten lazily dependent on
    Apple's ex-Unix-like alter ego.? That alter ego is turning into the
    Invisible Man.? Pretty soon we will be stuck between a brick and an
    Apple.

J.

On 8/24/20 15:11, Simon Urbanek wrote:
> Jim,
>
> thanks for the update, yes, we are aware and we have an ADP now, too, and are assessing the issues. I got base R working using f2c as a stop-gap measure, but it doesn't pass all checks due to fp issues (not necessarily related to Fortran) so there are more moving parts to this. It would be good to be involved in the discussions, so any pointers are welcome.
>
> Thanks,
> Simon
>
>
>
>> On Aug 25, 2020, at 2:12 AM, Jim Hester <james.f.hester at gmail.com> wrote:
>>
>> I recently inquired about the progress of gcc (more specifically gfortran)
>> support with Apple's new 'Apple Silicon' architecture. [0]
>>
>> As of today it seems gfortran is not available natively, which has
>> implications for R support on upcoming Apple hardware.
>>
>> Subsequently I have been in email contact with a few people at Apple on
>> their progress and wanted to update those here.
>>
>> They also have some questions on what features we rely on in the R
>> community that I thought some on this mailing list would have better
>> insight in answering than I.
>>
>> I would be happy to give the apple contacts information off-list, or CC you
>> into the email thread if you would like. Alternatively I can communicate
>> our answers back to them myself.
>>
>> Also I have a Developer Transition Kit at home, so I can run tests if it
>> would be beneficial.
>>
>> Apple's response follows
>>
>>> We've been working with Iain on figuring out a path forward for gfortran,
>> they recently published a branch
>> https://urldefense.com/v3/__https://github.com/iains/gcc-darwin-arm64*readme__;Iw!!Mih3wA!XBd8e0aklPimxl7B4w7FK7p3Z_EjeXxQRUyaT8xsKavf2ftfTcos4EzlgerUXig$  with some early support in
>> gcc. We are aware of some of the issues with FP80 vs FP64 and our last
>> internal discussion was trying to ascertain how relevant and important FP80
>> is in the fortran community. There are some complexities with FP80 (and
>> higher) that are going to make it not very timely, even native, on Apple
>> silicon. If we could set aside FP80+ as not critical it would allow us to
>> focus on FP64. What are your thoughts?
>>
>>> I think we are able to support technical discussions if people have
>> questions and we've made hardware available to individuals as
>> needed/requested as well.
>>
>>> I did see those tweets when they were posted, we'd already been
>> discussing Fortran with several vendors that depend on it, like Matlab.  It
>> would also be good to understand example workloads that are important so we
>> can take a look at them on Rosetta today, since any effort to go native
>> will likely rely on some period of Rosetta as a fall back and we'd like to
>> ensure thats feasible.
>>
>> [0]: https://urldefense.com/v3/__https://twitter.com/jimhester_/status/1292821727165194240__;!!Mih3wA!XBd8e0aklPimxl7B4w7FK7p3Z_EjeXxQRUyaT8xsKavf2ftfTcos4EzlsekNOpo$ 
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-mac__;!!Mih3wA!XBd8e0aklPimxl7B4w7FK7p3Z_EjeXxQRUyaT8xsKavf2ftfTcos4EzlIHqWQUQ$ 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-mac__;!!Mih3wA!XBd8e0aklPimxl7B4w7FK7p3Z_EjeXxQRUyaT8xsKavf2ftfTcos4EzlIHqWQUQ$ 

-- 
John Helly, University of California, San Diego / San Diego Supercomputer Center / Scripps Institution of Oceanography / 760 840 8660 mobile / http://www.sdsc.edu/~hellyj
ORCID ID: orcid.org/0000-0002-3779-0603


	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Aug 26 00:27:18 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 26 Aug 2020 10:27:18 +1200
Subject: [R-SIG-Mac] svn now available from the tools
Message-ID: <B46EE9B6-D0C9-4906-9450-E02BE6C2CD16@R-project.org>

If you want to build R from the svn repository you need svn (subversion). Xcode 10 has removed svn so it is no loner available from Apple, we are providing a binary (cmopatible with OS X 10.11 and higher) in
https://mac.r-project.org/tools/
(in "optional tools and libraries" at the bottom), direct link:
https://mac.r-project.org/tools/subversion-1.14.0-darwin15.6.tar.gz
It is a single-file signed, static build so has no dependencies and can be run from anywhere.

Cheers,
Simon


From c@r| @end|ng |rom w|ttho|t@com  Wed Aug 26 18:43:56 2020
From: c@r| @end|ng |rom w|ttho|t@com (Carl Witthoft)
Date: Wed, 26 Aug 2020 12:43:56 -0400
Subject: [R-SIG-Mac] svn tarball
In-Reply-To: <mailman.13900.3.1598436002.30881.r-sig-mac@r-project.org>
References: <mailman.13900.3.1598436002.30881.r-sig-mac@r-project.org>
Message-ID: <358c6b46-a808-3e9e-4634-21bd6954dbbc@witthoft.com>

Dumb question from someone who hasn't done any building in quite a 
while: recommended director to place the svn executable?
thanks
Carl

On 8/26/20 6:00 AM, r-sig-mac-request at r-project.org wrote:

> 
>     1.  svn now available from the tools (Simon Urbanek)
> 
>ntent-Type: text/plain; charset="us-ascii"
> 
> If you want to build R from the svn repository you need svn (subversion). Xcode 10 has removed svn so it is no loner available from Apple, we are providing a binary (cmopatible with OS X 10.11 and higher) in
> https://mac.r-project.org/tools/
> (in "optional tools and libraries" at the bottom), direct link:
> https://mac.r-project.org/tools/subversion-1.14.0-darwin15.6.tar.gz
> It is a single-file signed, static build so has no dependencies and can be run from anywhere.
> 
> Cheers,


From pd@|gd @end|ng |rom gm@||@com  Wed Aug 26 19:00:31 2020
From: pd@|gd @end|ng |rom gm@||@com (peter dalgaard)
Date: Wed, 26 Aug 2020 19:00:31 +0200
Subject: [R-SIG-Mac] svn tarball
In-Reply-To: <358c6b46-a808-3e9e-4634-21bd6954dbbc@witthoft.com>
References: <mailman.13900.3.1598436002.30881.r-sig-mac@r-project.org>
 <358c6b46-a808-3e9e-4634-21bd6954dbbc@witthoft.com>
Message-ID: <E790DA93-391F-4693-8E23-DF61EEB07B04@gmail.com>

Not dumb. 

Simon's usual style is that tarballs are installed at / and things end up under /usr/local, using the procedure outlined at the bottom of

https://mac.r-project.org/libs/

but you should probably check with "tar tvfz" first. 

-pd

 

> On 26 Aug 2020, at 18:43 , Carl Witthoft <carl at witthoft.com> wrote:
> 
> Dumb question from someone who hasn't done any building in quite a while: recommended director to place the svn executable?
> thanks
> Carl
> 
> On 8/26/20 6:00 AM, r-sig-mac-request at r-project.org wrote:
> 
>>    1.  svn now available from the tools (Simon Urbanek)
>> ntent-Type: text/plain; charset="us-ascii"
>> If you want to build R from the svn repository you need svn (subversion). Xcode 10 has removed svn so it is no loner available from Apple, we are providing a binary (cmopatible with OS X 10.11 and higher) in
>> https://mac.r-project.org/tools/
>> (in "optional tools and libraries" at the bottom), direct link:
>> https://mac.r-project.org/tools/subversion-1.14.0-darwin15.6.tar.gz
>> It is a single-file signed, static build so has no dependencies and can be run from anywhere.
>> Cheers,
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From bob @end|ng |rom rud@|@  Wed Aug 26 20:48:43 2020
From: bob @end|ng |rom rud@|@ (Bob Rudis)
Date: Wed, 26 Aug 2020 14:48:43 -0400
Subject: [R-SIG-Mac] svn tarball
In-Reply-To: <E790DA93-391F-4693-8E23-DF61EEB07B04@gmail.com>
References: <mailman.13900.3.1598436002.30881.r-sig-mac@r-project.org>
 <358c6b46-a808-3e9e-4634-21bd6954dbbc@witthoft.com>
 <E790DA93-391F-4693-8E23-DF61EEB07B04@gmail.com>
Message-ID: <13558096-1A5D-47EC-B892-360282B44D52@rud.is>

As an alternative, this:

    https://github.com/r-devel/r-svn

is also kept current and has another advantage of being usable with git and running CI tests on PRs.

-boB

> On Aug 26, 2020, at 13:00, peter dalgaard <pdalgd at gmail.com> wrote:
> 
> Not dumb. 
> 
> Simon's usual style is that tarballs are installed at / and things end up under /usr/local, using the procedure outlined at the bottom of
> 
> https://mac.r-project.org/libs/
> 
> but you should probably check with "tar tvfz" first. 
> 
> -pd
> 
> 
> 
>> On 26 Aug 2020, at 18:43 , Carl Witthoft <carl at witthoft.com> wrote:
>> 
>> Dumb question from someone who hasn't done any building in quite a while: recommended director to place the svn executable?
>> thanks
>> Carl
>> 
>> On 8/26/20 6:00 AM, r-sig-mac-request at r-project.org wrote:
>> 
>>>   1.  svn now available from the tools (Simon Urbanek)
>>> ntent-Type: text/plain; charset="us-ascii"
>>> If you want to build R from the svn repository you need svn (subversion). Xcode 10 has removed svn so it is no loner available from Apple, we are providing a binary (cmopatible with OS X 10.11 and higher) in
>>> https://mac.r-project.org/tools/
>>> (in "optional tools and libraries" at the bottom), direct link:
>>> https://mac.r-project.org/tools/subversion-1.14.0-darwin15.6.tar.gz
>>> It is a single-file signed, static build so has no dependencies and can be run from anywhere.
>>> Cheers,
>> 
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 
> -- 
> Peter Dalgaard, Professor,
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Office: A 4.23
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From @|mon@urb@nek @end|ng |rom R-project@org  Thu Aug 27 10:58:14 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Thu, 27 Aug 2020 20:58:14 +1200
Subject: [R-SIG-Mac] svn tarball
In-Reply-To: <13558096-1A5D-47EC-B892-360282B44D52@rud.is>
References: <mailman.13900.3.1598436002.30881.r-sig-mac@r-project.org>
 <358c6b46-a808-3e9e-4634-21bd6954dbbc@witthoft.com>
 <E790DA93-391F-4693-8E23-DF61EEB07B04@gmail.com>
 <13558096-1A5D-47EC-B892-360282B44D52@rud.is>
Message-ID: <6C983D5E-C360-45E2-9D32-09446C1042D6@R-project.org>

Bob, 

please note that it is not identical to the official sources and a checkout from the repo doesn't build. It only works with the action scripts in that repo, but not using the regular instructions from R-admin, so I would not recommend that for regular use. There are many other 3rd party ways to get the R sources, but that's not the question here.

Cheers,
Simon




> On Aug 27, 2020, at 06:48, Bob Rudis <bob at rud.is> wrote:
> 
> As an alternative, this:
> 
>    https://github.com/r-devel/r-svn
> 
> is also kept current and has another advantage of being usable with git and running CI tests on PRs.
> 
> -boB
> 
>> On Aug 26, 2020, at 13:00, peter dalgaard <pdalgd at gmail.com> wrote:
>> 
>> Not dumb. 
>> 
>> Simon's usual style is that tarballs are installed at / and things end up under /usr/local, using the procedure outlined at the bottom of
>> 
>> https://mac.r-project.org/libs/
>> 
>> but you should probably check with "tar tvfz" first. 
>> 
>> -pd
>> 
>> 
>> 
>>> On 26 Aug 2020, at 18:43 , Carl Witthoft <carl at witthoft.com> wrote:
>>> 
>>> Dumb question from someone who hasn't done any building in quite a while: recommended director to place the svn executable?
>>> thanks
>>> Carl
>>> 
>>> On 8/26/20 6:00 AM, r-sig-mac-request at r-project.org wrote:
>>> 
>>>>  1.  svn now available from the tools (Simon Urbanek)
>>>> ntent-Type: text/plain; charset="us-ascii"
>>>> If you want to build R from the svn repository you need svn (subversion). Xcode 10 has removed svn so it is no loner available from Apple, we are providing a binary (cmopatible with OS X 10.11 and higher) in
>>>> https://mac.r-project.org/tools/
>>>> (in "optional tools and libraries" at the bottom), direct link:
>>>> https://mac.r-project.org/tools/subversion-1.14.0-darwin15.6.tar.gz
>>>> It is a single-file signed, static build so has no dependencies and can be run from anywhere.
>>>> Cheers,
>>> 
>>> _______________________________________________
>>> R-SIG-Mac mailing list
>>> R-SIG-Mac at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>> 
>> -- 
>> Peter Dalgaard, Professor,
>> Center for Statistics, Copenhagen Business School
>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>> Phone: (+45)38153501
>> Office: A 4.23
>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>> 
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Aug 28 16:41:16 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 28 Aug 2020 10:41:16 -0400
Subject: [R-SIG-Mac] bzip2 configure error
Message-ID: <92d2ddd8-2a43-6c27-d756-3255d3797c62@gmail.com>

I'm trying to build R-devel in Catalina for the first time in a few 
weeks, and configure is dying with this error:

  checking whether bzip2 support suffices... configure: error: bzip2 
library and headers are required

I tried a Homebrew install of bzip2, and it didn't help.

When I look in config.log, I see this:


configure:45424: checking if bzip2 version >= 1.0.6
configure:45452: gcc -o conftest  -g -O2 -I/usr/local/opt/libffi/include 
  -L/usr/local/opt/libffi/lib conftest.c -lbz2 -lz -licucore -ldl -lm 
-liconv >&5
conftest.c:250:11: warning: initializing 'char *' with an expression of 
type 'const char *' discards qualifiers 
[-Wincompatible-pointer-types-discards-qualifiers]
     char *ver = BZ2_bzlibVersion();
           ^     ~~~~~~~~~~~~~~~~~~
conftest.c:251:5: error: implicitly declaring library function 'exit' 
with type 'void (int) __attribute__((noreturn))' 
[-Werror,-Wimplicit-function-declaration]
     exit(strcmp(ver, "1.0.6") < 0);
     ^
conftest.c:251:5: note: include the header <stdlib.h> or explicitly 
provide a declaration for 'exit'
conftest.c:251:10: error: implicitly declaring library function 'strcmp' 
with type 'int (const char *, const char *)' 
[-Werror,-Wimplicit-function-declaration]
     exit(strcmp(ver, "1.0.6") < 0);
          ^
conftest.c:251:10: note: include the header <string.h> or explicitly 
provide a declaration for 'strcmp'
1 warning and 2 errors generated.


Suggestions for fixing this?

Duncan Murdoch


From c@r| @end|ng |rom w|ttho|t@com  Fri Aug 28 19:11:11 2020
From: c@r| @end|ng |rom w|ttho|t@com (Carl Witthoft)
Date: Fri, 28 Aug 2020 13:11:11 -0400
Subject: [R-SIG-Mac] svn location
In-Reply-To: <E790DA93-391F-4693-8E23-DF61EEB07B04@gmail.com>
References: <mailman.13900.3.1598436002.30881.r-sig-mac@r-project.org>
 <358c6b46-a808-3e9e-4634-21bd6954dbbc@witthoft.com>
 <E790DA93-391F-4693-8E23-DF61EEB07B04@gmail.com>
Message-ID: <2795ec95-c70e-8dc7-eb3e-340a9f528962@witthoft.com>

Well, I put this new svn in /usr/local, then checked around my Catalina 
system:


iMac:~ cgw$ which svn
/usr/bin/svn
iMac:local cgw$ cd /usr/bin
iMac:bin cgw$ ls -l svn
-rwxr-xr-x  1 root  wheel  31488 Aug 10 16:55 svn
iMac:bin cgw$ cd /usr/local
iMac:local cgw$ ls -l svn
-rwxr-xr-x@ 1 cgw  wheel  8767792 Aug 25 18:04 svn
iMac:local cgw$ what svn
svn
	1.14.0 (r1876290)

That's a huge difference in file size!  Any idea what the /usr/bin one is?

Carl

On 8/26/20 1:00 PM, peter dalgaard wrote:
> Not dumb.
> 
> Simon's usual style is that tarballs are installed at / and things end up under /usr/local, using the procedure outlined at the bottom of
> 
> https://mac.r-project.org/libs/
> 
> but you should probably check with "tar tvfz" first.
> 
> -pd
> 
>   
> 
>> On 26 Aug 2020, at 18:43 , Carl Witthoft <carl at witthoft.com> wrote:
>>
>> Dumb question from someone who hasn't done any building in quite a while: recommended director to place the svn executable?
>> thanks
>> Carl
>>
>> On 8/26/20 6:00 AM, r-sig-mac-request at r-project.org wrote:
>>
>>>     1.  svn now available from the tools (Simon Urbanek)
>>> ntent-Type: text/plain; charset="us-ascii"
>>> If you want to build R from the svn repository you need svn (subversion). Xcode 10 has removed svn so it is no loner available from Apple, we are providing a binary (cmopatible with OS X 10.11 and higher) in
>>> https://mac.r-project.org/tools/
>>> (in "optional tools and libraries" at the bottom), direct link:
>>> https://mac.r-project.org/tools/subversion-1.14.0-darwin15.6.tar.gz
>>> It is a single-file signed, static build so has no dependencies and can be run from anywhere.
>>> Cheers,
>>
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 

-- 
Carl Witthoft
carl at witthoft.com
resume: https://app.box.com/file/498153801347


From @|mon@urb@nek @end|ng |rom R-project@org  Fri Aug 28 23:45:27 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sat, 29 Aug 2020 09:45:27 +1200
Subject: [R-SIG-Mac] svn location
In-Reply-To: <2795ec95-c70e-8dc7-eb3e-340a9f528962@witthoft.com>
References: <mailman.13900.3.1598436002.30881.r-sig-mac@r-project.org>
 <358c6b46-a808-3e9e-4634-21bd6954dbbc@witthoft.com>
 <E790DA93-391F-4693-8E23-DF61EEB07B04@gmail.com>
 <2795ec95-c70e-8dc7-eb3e-340a9f528962@witthoft.com>
Message-ID: <9DA5FD6F-4300-4EF6-9642-B1CC59F065DB@R-project.org>

Carl,

the one in /usr/bin is just a stub from Apple that re-directs to real svn. Where that one is depends on your installed tools (Xcode/CLT,...), for CLT it is in

$ ls -lh /Library/Developer/CommandLineTools/usr/bin/svn
-rwxr-xr-x  1 root  admin   321K Jul 13  2019 /Library/Developer/CommandLineTools/usr/bin/svn

And it is a dynamic build so it needs all the dependent libraries (see otool -L). The build I'm providing is single-file so all (non-system) libraries are included in the binary hence it is bigger.

As to where to put it, I'd probably use /usr/local/bin, but if you don't have access there you can run it from your home or anywhere else.

Cheers,
Simon


> On Aug 29, 2020, at 05:11, Carl Witthoft <carl at witthoft.com> wrote:
> 
> Well, I put this new svn in /usr/local, then checked around my Catalina system:
> 
> 
> iMac:~ cgw$ which svn
> /usr/bin/svn
> iMac:local cgw$ cd /usr/bin
> iMac:bin cgw$ ls -l svn
> -rwxr-xr-x  1 root  wheel  31488 Aug 10 16:55 svn
> iMac:bin cgw$ cd /usr/local
> iMac:local cgw$ ls -l svn
> -rwxr-xr-x@ 1 cgw  wheel  8767792 Aug 25 18:04 svn
> iMac:local cgw$ what svn
> svn
> 	1.14.0 (r1876290)
> 
> That's a huge difference in file size!  Any idea what the /usr/bin one is?
> 
> Carl
> 
> On 8/26/20 1:00 PM, peter dalgaard wrote:
>> Not dumb.
>> Simon's usual style is that tarballs are installed at / and things end up under /usr/local, using the procedure outlined at the bottom of
>> https://mac.r-project.org/libs/
>> but you should probably check with "tar tvfz" first.
>> -pd
>>  
>>> On 26 Aug 2020, at 18:43 , Carl Witthoft <carl at witthoft.com> wrote:
>>> 
>>> Dumb question from someone who hasn't done any building in quite a while: recommended director to place the svn executable?
>>> thanks
>>> Carl
>>> 
>>> On 8/26/20 6:00 AM, r-sig-mac-request at r-project.org wrote:
>>> 
>>>>    1.  svn now available from the tools (Simon Urbanek)
>>>> ntent-Type: text/plain; charset="us-ascii"
>>>> If you want to build R from the svn repository you need svn (subversion). Xcode 10 has removed svn so it is no loner available from Apple, we are providing a binary (cmopatible with OS X 10.11 and higher) in
>>>> https://mac.r-project.org/tools/
>>>> (in "optional tools and libraries" at the bottom), direct link:
>>>> https://mac.r-project.org/tools/subversion-1.14.0-darwin15.6.tar.gz
>>>> It is a single-file signed, static build so has no dependencies and can be run from anywhere.
>>>> Cheers,
>>> 
>>> _______________________________________________
>>> R-SIG-Mac mailing list
>>> R-SIG-Mac at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 
> -- 
> Carl Witthoft
> carl at witthoft.com
> resume: https://app.box.com/file/498153801347
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Aug 29 20:38:59 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 29 Aug 2020 14:38:59 -0400
Subject: [R-SIG-Mac] bzip2 configure error
In-Reply-To: <92d2ddd8-2a43-6c27-d756-3255d3797c62@gmail.com>
References: <92d2ddd8-2a43-6c27-d756-3255d3797c62@gmail.com>
Message-ID: <ba4e8cae-9ef9-8e4c-0328-1ecc7aa50836@gmail.com>

I seem to have got past this error by reinstalling Xcode.  I'm not sure 
what went wrong with the old install; I'm pretty sure I did an R-devel 
build since installing Catalina.

Duncan Murdoch

On 28/08/2020 10:41 a.m., Duncan Murdoch wrote:
> I'm trying to build R-devel in Catalina for the first time in a few
> weeks, and configure is dying with this error:
> 
>    checking whether bzip2 support suffices... configure: error: bzip2
> library and headers are required
> 
> I tried a Homebrew install of bzip2, and it didn't help.
> 
> When I look in config.log, I see this:
> 
> 
> configure:45424: checking if bzip2 version >= 1.0.6
> configure:45452: gcc -o conftest  -g -O2 -I/usr/local/opt/libffi/include
>    -L/usr/local/opt/libffi/lib conftest.c -lbz2 -lz -licucore -ldl -lm
> -liconv >&5
> conftest.c:250:11: warning: initializing 'char *' with an expression of
> type 'const char *' discards qualifiers
> [-Wincompatible-pointer-types-discards-qualifiers]
>       char *ver = BZ2_bzlibVersion();
>             ^     ~~~~~~~~~~~~~~~~~~
> conftest.c:251:5: error: implicitly declaring library function 'exit'
> with type 'void (int) __attribute__((noreturn))'
> [-Werror,-Wimplicit-function-declaration]
>       exit(strcmp(ver, "1.0.6") < 0);
>       ^
> conftest.c:251:5: note: include the header <stdlib.h> or explicitly
> provide a declaration for 'exit'
> conftest.c:251:10: error: implicitly declaring library function 'strcmp'
> with type 'int (const char *, const char *)'
> [-Werror,-Wimplicit-function-declaration]
>       exit(strcmp(ver, "1.0.6") < 0);
>            ^
> conftest.c:251:10: note: include the header <string.h> or explicitly
> provide a declaration for 'strcmp'
> 1 warning and 2 errors generated.
> 
> 
> Suggestions for fixing this?
> 
> Duncan Murdoch
>


From @|mon@urb@nek @end|ng |rom R-project@org  Sun Aug 30 00:17:34 2020
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sun, 30 Aug 2020 10:17:34 +1200
Subject: [R-SIG-Mac] bzip2 configure error
In-Reply-To: <ba4e8cae-9ef9-8e4c-0328-1ecc7aa50836@gmail.com>
References: <92d2ddd8-2a43-6c27-d756-3255d3797c62@gmail.com>
 <ba4e8cae-9ef9-8e4c-0328-1ecc7aa50836@gmail.com>
Message-ID: <72EF557E-7A9D-4A4A-A4BB-80CA54E5131C@R-project.org>

Duncan,

We have a bunch of bugs in configure (on all platforms) when used with -Werror which is default for some Apple compiler builds recently, the one below is just one for them (failing to include stdlib.h and string.h in the test). It may be worth filing a bug report, this should be a reasonably straight-forward task for someone to supply a patch to go through with -Werror and fix them.

Cheers,
Simon



> On Aug 30, 2020, at 06:38, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> I seem to have got past this error by reinstalling Xcode.  I'm not sure what went wrong with the old install; I'm pretty sure I did an R-devel build since installing Catalina.
> 
> Duncan Murdoch
> 
> On 28/08/2020 10:41 a.m., Duncan Murdoch wrote:
>> I'm trying to build R-devel in Catalina for the first time in a few
>> weeks, and configure is dying with this error:
>>   checking whether bzip2 support suffices... configure: error: bzip2
>> library and headers are required
>> I tried a Homebrew install of bzip2, and it didn't help.
>> When I look in config.log, I see this:
>> configure:45424: checking if bzip2 version >= 1.0.6
>> configure:45452: gcc -o conftest  -g -O2 -I/usr/local/opt/libffi/include
>>   -L/usr/local/opt/libffi/lib conftest.c -lbz2 -lz -licucore -ldl -lm
>> -liconv >&5
>> conftest.c:250:11: warning: initializing 'char *' with an expression of
>> type 'const char *' discards qualifiers
>> [-Wincompatible-pointer-types-discards-qualifiers]
>>      char *ver = BZ2_bzlibVersion();
>>            ^     ~~~~~~~~~~~~~~~~~~
>> conftest.c:251:5: error: implicitly declaring library function 'exit'
>> with type 'void (int) __attribute__((noreturn))'
>> [-Werror,-Wimplicit-function-declaration]
>>      exit(strcmp(ver, "1.0.6") < 0);
>>      ^
>> conftest.c:251:5: note: include the header <stdlib.h> or explicitly
>> provide a declaration for 'exit'
>> conftest.c:251:10: error: implicitly declaring library function 'strcmp'
>> with type 'int (const char *, const char *)'
>> [-Werror,-Wimplicit-function-declaration]
>>      exit(strcmp(ver, "1.0.6") < 0);
>>           ^
>> conftest.c:251:10: note: include the header <string.h> or explicitly
>> provide a declaration for 'strcmp'
>> 1 warning and 2 errors generated.
>> Suggestions for fixing this?
>> Duncan Murdoch
>> 
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 


