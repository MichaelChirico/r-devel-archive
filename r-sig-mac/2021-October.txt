From dj@@mper| @end|ng |rom gm@||@com  Thu Oct  7 18:56:08 2021
From: dj@@mper| @end|ng |rom gm@||@com (Dominick Samperi)
Date: Thu, 7 Oct 2021 12:56:08 -0400
Subject: [R-SIG-Mac] [Rcpp-devel] Any recent change that would remove
 Rcpp_precious_remove?
In-Reply-To: <4410C325-BE26-4617-90F8-299A1C341DB4@R-project.org>
References: <PR3P194MB0812D2DFEDE1FE7636E40E0EB1129@PR3P194MB0812.EURP194.PROD.OUTLOOK.COM>
 <24816.9790.765864.646219@rob.eddelbuettel.com>
 <CADUbQ5i+cihTu2csXCZw8OAQpH7qyie0YThriJ8w_PkE09iDVQ@mail.gmail.com>
 <4410C325-BE26-4617-90F8-299A1C341DB4@R-project.org>
Message-ID: <CADUbQ5gHRuMapkG7BQsuBHC902UfEbkBP0G0OnhfpYLJp3PPuQ@mail.gmail.com>

Simon,

On your dynamic vs static linking comment (R-exts 5.8), is there anything
specific to MacOS that adds complexity, or is this generic to UNIX systems
that use the -rpath flag to hard-code the path into the executable? I
understand that there are potential versioning issues with the use of
shared libraries as well.

On Mon, Oct 4, 2021 at 6:04 PM Simon Urbanek <simon.urbanek at r-project.org>
wrote:

> Dominick,
>
> in that case this would be best reported on R-SIG-Mac. I just happen to be
> on this list so it worked ;).
>
> Re-building RInside seems to fix the issue, now updated.
>
> While I have you here, unrelated, but please note that linking to packages
> dynamically is not supported (see R-exts 5.8), so your makefile needs to be
> fixed to use static libRInside.a (and RInside shouldn't be really creating
> or installing .dylib at all as it cannot be used reliably).
>
> Cheers,
> Simon
>
>
>
> On Oct 3, 2021, at 1:55 AM, Dominick Samperi <djsamperi at gmail.com> wrote:
>
> Forcing source install of the latest versions of Rcpp and RInside is
> required
> under MacOS. By default MacOS installs binary versions of the latest
> versions, 1.0.7 and 0.2.16, resp., and a simple repl app seg faults.
>
> It appears that there is a problem with the current binary distribution
> under
> MacOS.
>
> Under Ubuntu the packages are installed from source by default, and
> there are no problems. There are also no problems under Windows.
>
>
>
> On Thu, Jul 15, 2021 at 8:13 AM Dirk Eddelbuettel <edd at debian.org> wrote:
>
>>
>> On 15 July 2021 at 08:24, ma wh wrote:
>> | Colleague of mine wrote some R last week that was working OK, and
>> hasn't been changed in itself since that time. This week it's ceased
>> working( I've tried it on my machine and also see a fail, the following
>> error is encountered:
>> |
>> | Error in C_valid_tz(tzone): Function 'Rcpp_precious_remove' not
>> provided by package 'Rcpp'
>> |
>> | Searching around there aren't many hits. Those I do find seem quite
>> recent (stackoverflow questions or GitHub issues logged in various
>> projects, dates of posting are within the last few days). None of the
>> posted queries seem to have a solution, one person said restarting RStudio
>> helped, but not in my case. The SO question I found was marked as deleted.
>> The GitHub issue I found was "I solved it" but no mention of how. The SO
>> question was asking about svg export:
>> https://stackoverflow.com/questions/68345118/exporting-a-ggplot-in-svg-call-a-non-esixting-function
>> | The GitHub were also asking about packages I don't use -
>> | https://github.com/r-spatial/spdep/issues/60
>> | https://github.com/drizopoulos/JMbayes2/issues/5
>> |
>> | Anyone on the list have any pointers? Thanks
>>
>> Packages following a the GNU style often have a file ChangeLog which
>> "details
>> changes made to the code". Rcpp follows this convention, see 2021-07-05
>> and
>> 2021-01-017.
>>
>> Packages following the R packaging conventions often have a file
>> inst/NEWS.rd
>> (also rendered as NEWS at CRAN). Rcpp follow this conventions, see the
>> Rcpp
>> 1.0.7 release (even if the functions is not named).
>>
>> Packages have source code you can search.I like `ag` aka "the
>> silversearcher":
>>
>>   edd at rob:~/git/rcpp(master)$ ag -c Rcpp_precious_remove
>>   ChangeLog:2
>>   inst/include/Rcpp/routines.h:3
>>   inst/include/RcppCommon.h:2
>>   src/rcpp_init.cpp:1
>>   src/barrier.cpp:1
>>   edd at rob:~/git/rcpp(master)$
>>
>> It is still there, and available via the standard export mechanism.
>>
>> I recommend your friend take a look. The function is a) still there yet
>> has
>> also b) been supplanted by a more sufficient alternative.
>>
>> Otherwise, a reproducible example would be the only way to make this
>> concrete.
>>
>> Hope this helps, Dirk
>>
>> --
>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>> _______________________________________________
>> Rcpp-devel mailing list
>> Rcpp-devel at lists.r-forge.r-project.org
>> https://lists.r-forge.r-project.org/cgi-bin/mailman/listinfo/rcpp-devel
>
> _______________________________________________
> Rcpp-devel mailing list
> Rcpp-devel at lists.r-forge.r-project.org
> https://lists.r-forge.r-project.org/cgi-bin/mailman/listinfo/rcpp-devel
>
>
>

	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Sun Oct 10 05:23:09 2021
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Sat, 9 Oct 2021 23:23:09 -0400
Subject: [R-SIG-Mac] Retrieving Script Path in R.app
Message-ID: <CAPcHnpSuKFbc66S4eu5teyAwH1VhcOkNfaRKZnC5JyMn0mAsRg@mail.gmail.com>

Hello,


I'd like to programmatically retrieve the path of the currently open script
in R.app.
Something like, if I had written:

this.path()

within a script that was open in R.app, and I ran that line with
Command+Enter,
I'd like it to return the path of the script.
It seems like this should be possible since Command+E runs the following:

source("/absolute/path/to/file")

so R.app knows the path of the open script, but I was unable to find
anything that would retrieve it on my own. First, I tried looking through
the environment 'as.environment("tools:RGUI")', but I didn't find anything
that looked like what I was looking for. Second, I tried comparing the
functions available in the base packages between Windows and macOS, and
while there are a few functions available for macOS that are not for
Windows, none of them looked like what I was looking for.
Any help will be greatly appreciated, thank you!


Regards,
    Andrew Simmons

	[[alternative HTML version deleted]]


From tomhopper @end|ng |rom gm@||@com  Sun Oct 10 17:10:37 2021
From: tomhopper @end|ng |rom gm@||@com (Thomas Hopper)
Date: Sun, 10 Oct 2021 11:10:37 -0400
Subject: [R-SIG-Mac] Retrieving Script Path in R.app
In-Reply-To: <CAPcHnpSuKFbc66S4eu5teyAwH1VhcOkNfaRKZnC5JyMn0mAsRg@mail.gmail.com>
References: <CAPcHnpSuKFbc66S4eu5teyAwH1VhcOkNfaRKZnC5JyMn0mAsRg@mail.gmail.com>
Message-ID: <7141D0F4-F1F8-4292-B707-F304016CB2C6@gmail.com>

You may want to look at the ?here? package. 

Sent from my iPhone

> On Oct 9, 2021, at 23:23, Andrew Simmons <akwsimmo at gmail.com> wrote:
> 
> ?Hello,
> 
> 
> I'd like to programmatically retrieve the path of the currently open script
> in R.app.
> Something like, if I had written:
> 
> this.path()
> 
> within a script that was open in R.app, and I ran that line with
> Command+Enter,
> I'd like it to return the path of the script.
> It seems like this should be possible since Command+E runs the following:
> 
> source("/absolute/path/to/file")
> 
> so R.app knows the path of the open script, but I was unable to find
> anything that would retrieve it on my own. First, I tried looking through
> the environment 'as.environment("tools:RGUI")', but I didn't find anything
> that looked like what I was looking for. Second, I tried comparing the
> functions available in the base packages between Windows and macOS, and
> while there are a few functions available for macOS that are not for
> Windows, none of them looked like what I was looking for.
> Any help will be greatly appreciated, thank you!
> 
> 
> Regards,
>    Andrew Simmons
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From btupper @end|ng |rom b|ge|ow@org  Sun Oct 10 17:14:42 2021
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Sun, 10 Oct 2021 11:14:42 -0400
Subject: [R-SIG-Mac] Retrieving Script Path in R.app
In-Reply-To: <CAPcHnpSuKFbc66S4eu5teyAwH1VhcOkNfaRKZnC5JyMn0mAsRg@mail.gmail.com>
References: <CAPcHnpSuKFbc66S4eu5teyAwH1VhcOkNfaRKZnC5JyMn0mAsRg@mail.gmail.com>
Message-ID: <CALrbzg1reWHzL0EAATPN+_prBVODMpc33NFWfQgpZVp7XSdxLQ@mail.gmail.com>

Hi,

Would ?getSrcDirectory help?

Ben

On Sat, Oct 9, 2021 at 11:23 PM Andrew Simmons <akwsimmo at gmail.com> wrote:
>
> Hello,
>
>
> I'd like to programmatically retrieve the path of the currently open script
> in R.app.
> Something like, if I had written:
>
> this.path()
>
> within a script that was open in R.app, and I ran that line with
> Command+Enter,
> I'd like it to return the path of the script.
> It seems like this should be possible since Command+E runs the following:
>
> source("/absolute/path/to/file")
>
> so R.app knows the path of the open script, but I was unable to find
> anything that would retrieve it on my own. First, I tried looking through
> the environment 'as.environment("tools:RGUI")', but I didn't find anything
> that looked like what I was looking for. Second, I tried comparing the
> functions available in the base packages between Windows and macOS, and
> while there are a few functions available for macOS that are not for
> Windows, none of them looked like what I was looking for.
> Any help will be greatly appreciated, thank you!
>
>
> Regards,
>     Andrew Simmons
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac



-- 
Ben Tupper (he/him)
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org


From @kw@|mmo @end|ng |rom gm@||@com  Sun Oct 10 17:29:03 2021
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Sun, 10 Oct 2021 11:29:03 -0400
Subject: [R-SIG-Mac] Retrieving Script Path in R.app
In-Reply-To: <CALrbzg1reWHzL0EAATPN+_prBVODMpc33NFWfQgpZVp7XSdxLQ@mail.gmail.com>
References: <CAPcHnpSuKFbc66S4eu5teyAwH1VhcOkNfaRKZnC5JyMn0mAsRg@mail.gmail.com>
 <CALrbzg1reWHzL0EAATPN+_prBVODMpc33NFWfQgpZVp7XSdxLQ@mail.gmail.com>
Message-ID: <CAPcHnpT7s=R1BMpXGtB1Vj4+a4rvM30MyuLnSXJ2DDCj_109og@mail.gmail.com>

getSrcDirectory is fine, but it only works when using 'source' with
'keep.source = TRUE', so it severely limits how I can run my scripts.

I've made a function / / package called this.path which returns the path of
the executing script, and right now it works from Rscript, when using
source, when running in RStudio, and when running from Rgui on Windows, but
not in R.app on macOS. Similar idea to getSrcDirectory, but you can run it
any way with or without keep.source


On Sun, Oct 10, 2021, 11:14 Ben Tupper <btupper at bigelow.org> wrote:

> Hi,
>
> Would ?getSrcDirectory help?
>
> Ben
>
> On Sat, Oct 9, 2021 at 11:23 PM Andrew Simmons <akwsimmo at gmail.com> wrote:
> >
> > Hello,
> >
> >
> > I'd like to programmatically retrieve the path of the currently open
> script
> > in R.app.
> > Something like, if I had written:
> >
> > this.path()
> >
> > within a script that was open in R.app, and I ran that line with
> > Command+Enter,
> > I'd like it to return the path of the script.
> > It seems like this should be possible since Command+E runs the following:
> >
> > source("/absolute/path/to/file")
> >
> > so R.app knows the path of the open script, but I was unable to find
> > anything that would retrieve it on my own. First, I tried looking through
> > the environment 'as.environment("tools:RGUI")', but I didn't find
> anything
> > that looked like what I was looking for. Second, I tried comparing the
> > functions available in the base packages between Windows and macOS, and
> > while there are a few functions available for macOS that are not for
> > Windows, none of them looked like what I was looking for.
> > Any help will be greatly appreciated, thank you!
> >
> >
> > Regards,
> >     Andrew Simmons
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Mac mailing list
> > R-SIG-Mac at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>
>
>
> --
> Ben Tupper (he/him)
> Bigelow Laboratory for Ocean Science
> East Boothbay, Maine
> http://www.bigelow.org/
> https://eco.bigelow.org
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Oct 10 18:31:38 2021
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 10 Oct 2021 12:31:38 -0400
Subject: [R-SIG-Mac] Retrieving Script Path in R.app
In-Reply-To: <CAPcHnpSuKFbc66S4eu5teyAwH1VhcOkNfaRKZnC5JyMn0mAsRg@mail.gmail.com>
References: <CAPcHnpSuKFbc66S4eu5teyAwH1VhcOkNfaRKZnC5JyMn0mAsRg@mail.gmail.com>
Message-ID: <4ad04acd-aaad-041b-2ad0-d1bd63c1c0d4@gmail.com>

See https://stackoverflow.com/a/47045368/2554330 for a risky-looking method.

I think the non-RStudio method is equivalent to this function:

this.path <- function() {
   sys.frame(-5)$srcfile
}

which works for me using Cmd-E, but of course it doesn't work using 
Cmd-Enter, because that doesn't call source().

My conclusion would be to use RStudio rather than the R.app editor.  I 
prefer R.app for interactive use, but not at all for code development.

Duncan Murdoch


On 09/10/2021 11:23 p.m., Andrew Simmons wrote:
> Hello,
> 
> 
> I'd like to programmatically retrieve the path of the currently open script
> in R.app.
> Something like, if I had written:
> 
> this.path()
> 
> within a script that was open in R.app, and I ran that line with
> Command+Enter,
> I'd like it to return the path of the script.
> It seems like this should be possible since Command+E runs the following:
> 
> source("/absolute/path/to/file")
> 
> so R.app knows the path of the open script, but I was unable to find
> anything that would retrieve it on my own. First, I tried looking through
> the environment 'as.environment("tools:RGUI")', but I didn't find anything
> that looked like what I was looking for. Second, I tried comparing the
> functions available in the base packages between Windows and macOS, and
> while there are a few functions available for macOS that are not for
> Windows, none of them looked like what I was looking for.
> Any help will be greatly appreciated, thank you!
> 
> 
> Regards,
>      Andrew Simmons
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>


From h@n@on @end|ng |rom dep@uw@edu  Sat Oct 23 00:29:36 2021
From: h@n@on @end|ng |rom dep@uw@edu (Bryan Hanson)
Date: Fri, 22 Oct 2021 15:29:36 -0700
Subject: [R-SIG-Mac] Link to headers lost? Headers not where they should be?
Message-ID: <D9957CE9-CB2E-48DC-BB55-B5A91EC31D07@depauw.edu>

I don?t know how/when this problem arose, but as of a few days ago, I can?t build source packages any longer.  I?ve been through quite a lot of resources looking for answers and no luck so far, so turning to the mercies of this list.

I have this problem with either R 4.1.1 or R 4.2.0  I?ve disabled .Rprofile and .cshrc files and the problem persists.  Running BigSur 10.16

When I try for instance to install MASS (as an example, the problem occurs with any pkg needing compilation) I see this:

[Abbott-2:~/Desktop] bryanhanson% R CMD INSTALL MASS
* installing to library ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library?
* installing *source* package ?MASS? ...
** package ?MASS? successfully unpacked and MD5 sums checked
** using staged installation
** libs
/usr/local/clang4/bin/clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I/usr/local/include   -fPIC  -Wall -g -O2  -c MASS.c -o MASS.o
MASS.c:18:10: fatal error: 'stdlib.h' file not found
#include <stdlib.h>
         ^~~~~~~~~~
1 error generated.
make: *** [MASS.o] Error 1
ERROR: compilation failed for package ?MASS?
* removing ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library/MASS?
* restoring previous ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library/MASS?

I think this feedback says the compiler is present and working. 

Most resources about "fatal error: 'stdlib.h' file not found? end up being cases  of the headers are actually not installed.  However I can see the ?missing? headers in /Library/Developer/CommandLineTools/usr/include/c++/v1 but I?m not sure this is place R is looking (information on the web is sometimes dated, and Apple seems to have moved things around in recent versions).  So my best guess is that R is looking elsewhere or doesn?t have a link to the correct location.  R Installation and Administration doesn?t appear to spell the location or I missed it.

I have carefully uninstalled Xcode (13) and re-installed it, and run Xcode-select ?install (it thinks the CLTs are already installed).  This does not make any difference, the problem persists.  Restarting the machine after updates does not make a difference either.

Thanks for any suggestions, as I?m really stuck...

Bryan


> sessionInfo()
R version 4.1.1 Patched (2021-10-18 r81073)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib

Random number generation:
 RNG:     Mersenne-Twister 
 Normal:  Inversion 
 Sample:  Rounding 
 
locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
[1] compiler_4.1.1


From @|mon@urb@nek @end|ng |rom R-project@org  Sat Oct 23 00:54:08 2021
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sat, 23 Oct 2021 11:54:08 +1300
Subject: [R-SIG-Mac] 
 Link to headers lost? Headers not where they should be?
In-Reply-To: <D9957CE9-CB2E-48DC-BB55-B5A91EC31D07@depauw.edu>
References: <D9957CE9-CB2E-48DC-BB55-B5A91EC31D07@depauw.edu>
Message-ID: <35C78FA2-4716-4ED2-B9A4-3498383488CD@R-project.org>


Bryan,

you seen to be using non-standard compiler in /usr/local/clang4. Remove it and check you overrides - do you have some forgotten invalid ~/.R/Makeconf file? Remove those if you do - and check ~/.R for any old stuff. (In fact the latter will probably fix it alone).

Cheers,
Simon



> On Oct 23, 2021, at 11:29 AM, Bryan Hanson <hanson at depauw.edu> wrote:
> 
> I don?t know how/when this problem arose, but as of a few days ago, I can?t build source packages any longer.  I?ve been through quite a lot of resources looking for answers and no luck so far, so turning to the mercies of this list.
> 
> I have this problem with either R 4.1.1 or R 4.2.0  I?ve disabled .Rprofile and .cshrc files and the problem persists.  Running BigSur 10.16
> 
> When I try for instance to install MASS (as an example, the problem occurs with any pkg needing compilation) I see this:
> 
> [Abbott-2:~/Desktop] bryanhanson% R CMD INSTALL MASS
> * installing to library ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library?
> * installing *source* package ?MASS? ...
> ** package ?MASS? successfully unpacked and MD5 sums checked
> ** using staged installation
> ** libs
> /usr/local/clang4/bin/clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I/usr/local/include   -fPIC  -Wall -g -O2  -c MASS.c -o MASS.o
> MASS.c:18:10: fatal error: 'stdlib.h' file not found
> #include <stdlib.h>
>         ^~~~~~~~~~
> 1 error generated.
> make: *** [MASS.o] Error 1
> ERROR: compilation failed for package ?MASS?
> * removing ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library/MASS?
> * restoring previous ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library/MASS?
> 
> I think this feedback says the compiler is present and working. 
> 
> Most resources about "fatal error: 'stdlib.h' file not found? end up being cases  of the headers are actually not installed.  However I can see the ?missing? headers in /Library/Developer/CommandLineTools/usr/include/c++/v1 but I?m not sure this is place R is looking (information on the web is sometimes dated, and Apple seems to have moved things around in recent versions).  So my best guess is that R is looking elsewhere or doesn?t have a link to the correct location.  R Installation and Administration doesn?t appear to spell the location or I missed it.
> 
> I have carefully uninstalled Xcode (13) and re-installed it, and run Xcode-select ?install (it thinks the CLTs are already installed).  This does not make any difference, the problem persists.  Restarting the machine after updates does not make a difference either.
> 
> Thanks for any suggestions, as I?m really stuck...
> 
> Bryan
> 
> 
>> sessionInfo()
> R version 4.1.1 Patched (2021-10-18 r81073)
> Platform: x86_64-apple-darwin17.0 (64-bit)
> Running under: macOS Big Sur 10.16
> 
> Matrix products: default
> BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib
> LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
> 
> Random number generation:
> RNG:     Mersenne-Twister 
> Normal:  Inversion 
> Sample:  Rounding 
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base     
> 
> loaded via a namespace (and not attached):
> [1] compiler_4.1.1
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 


From h@n@on @end|ng |rom dep@uw@edu  Sat Oct 23 01:24:20 2021
From: h@n@on @end|ng |rom dep@uw@edu (Bryan Hanson)
Date: Fri, 22 Oct 2021 16:24:20 -0700
Subject: [R-SIG-Mac] 
 Link to headers lost? Headers not where they should be?
In-Reply-To: <35C78FA2-4716-4ED2-B9A4-3498383488CD@R-project.org>
References: <D9957CE9-CB2E-48DC-BB55-B5A91EC31D07@depauw.edu>
 <35C78FA2-4716-4ED2-B9A4-3498383488CD@R-project.org>
Message-ID: <A525B876-2A4A-42AA-B212-631C09695A81@depauw.edu>

Thank you Simon, that was spot-on!  There was a stale Makevars file from about a year ago when a particular package needed a kluge to compile with openMP.  Much appreciated!  Bryan

> On Oct 22, 2021, at 3:54 PM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> Bryan,
> 
> you seen to be using non-standard compiler in /usr/local/clang4. Remove it and check you overrides - do you have some forgotten invalid ~/.R/Makeconf file? Remove those if you do - and check ~/.R for any old stuff. (In fact the latter will probably fix it alone).
> 
> Cheers,
> Simon
> 
> 
> 
>> On Oct 23, 2021, at 11:29 AM, Bryan Hanson <hanson at depauw.edu> wrote:
>> 
>> I don?t know how/when this problem arose, but as of a few days ago, I can?t build source packages any longer.  I?ve been through quite a lot of resources looking for answers and no luck so far, so turning to the mercies of this list.
>> 
>> I have this problem with either R 4.1.1 or R 4.2.0  I?ve disabled .Rprofile and .cshrc files and the problem persists.  Running BigSur 10.16
>> 
>> When I try for instance to install MASS (as an example, the problem occurs with any pkg needing compilation) I see this:
>> 
>> [Abbott-2:~/Desktop] bryanhanson% R CMD INSTALL MASS
>> * installing to library ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library?
>> * installing *source* package ?MASS? ...
>> ** package ?MASS? successfully unpacked and MD5 sums checked
>> ** using staged installation
>> ** libs
>> /usr/local/clang4/bin/clang -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I/usr/local/include   -fPIC  -Wall -g -O2  -c MASS.c -o MASS.o
>> MASS.c:18:10: fatal error: 'stdlib.h' file not found
>> #include <stdlib.h>
>>        ^~~~~~~~~~
>> 1 error generated.
>> make: *** [MASS.o] Error 1
>> ERROR: compilation failed for package ?MASS?
>> * removing ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library/MASS?
>> * restoring previous ?/Library/Frameworks/R.framework/Versions/4.1/Resources/library/MASS?
>> 
>> I think this feedback says the compiler is present and working. 
>> 
>> Most resources about "fatal error: 'stdlib.h' file not found? end up being cases  of the headers are actually not installed.  However I can see the ?missing? headers in /Library/Developer/CommandLineTools/usr/include/c++/v1 but I?m not sure this is place R is looking (information on the web is sometimes dated, and Apple seems to have moved things around in recent versions).  So my best guess is that R is looking elsewhere or doesn?t have a link to the correct location.  R Installation and Administration doesn?t appear to spell the location or I missed it.
>> 
>> I have carefully uninstalled Xcode (13) and re-installed it, and run Xcode-select ?install (it thinks the CLTs are already installed).  This does not make any difference, the problem persists.  Restarting the machine after updates does not make a difference either.
>> 
>> Thanks for any suggestions, as I?m really stuck...
>> 
>> Bryan
>> 
>> 
>>> sessionInfo()
>> R version 4.1.1 Patched (2021-10-18 r81073)
>> Platform: x86_64-apple-darwin17.0 (64-bit)
>> Running under: macOS Big Sur 10.16
>> 
>> Matrix products: default
>> BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib
>> LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
>> 
>> Random number generation:
>> RNG:     Mersenne-Twister 
>> Normal:  Inversion 
>> Sample:  Rounding 
>> 
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base     
>> 
>> loaded via a namespace (and not attached):
>> [1] compiler_4.1.1
>> 
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>> 
> 


From t|mothy@c@b@te@ @end|ng |rom gm@||@com  Sun Oct 31 14:48:35 2021
From: t|mothy@c@b@te@ @end|ng |rom gm@||@com (Tim Bates)
Date: Sun, 31 Oct 2021 13:48:35 +0000
Subject: [R-SIG-Mac] https://mac.r-project.org/benchmarks/
Message-ID: <F311C911-F19E-4CC4-B177-34EFBFC32CC9@gmail.com>

I wonder if this (2008/R 2.7) page could be updated with some current benchmark runs?

Especially current Intel server chips, i9, and M1/+ 

I'm guessing if Simon could help upload the resulting updated page, people here could contribute bench mark runs on different hardware.


Also be interesting to see different blas results.

I wonder if either intel or arm chip "neural" cores (dot product engines?) or multi-core and GPU are being used in current R builds?

tim





 


From @|mon@urb@nek @end|ng |rom R-project@org  Sun Oct 31 22:11:12 2021
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 1 Nov 2021 10:11:12 +1300
Subject: [R-SIG-Mac] https://mac.r-project.org/benchmarks/
In-Reply-To: <F311C911-F19E-4CC4-B177-34EFBFC32CC9@gmail.com>
References: <F311C911-F19E-4CC4-B177-34EFBFC32CC9@gmail.com>
Message-ID: <8D07527C-3EF3-4815-8B1E-E8ED939611AF@R-project.org>


Tim,

that is a great idea, those test are really old. Just for the fun of it I have run the tests on my old iMac, but with R 4.1.2 and they still work.
It's nice to see the huge speed improvements in loops and similar (see below - recall the original tests were scaled to be around 1).

I have added the page to the repo
https://github.com/R-macos/R-mac-dev
so I'd be happy to review PRs, but I'll probably want to re-do it first so it is better organized for comparisons as we have to also accommodate M1 etc.

Cheers,
Simon

---
iMac14,2 3.2Ghz i5, macOS 10.4.6, R 4.1.2 vecib/Accelerate BLAS


   R Benchmark 2.5
   ===============
Number of times each test is run__________________________:  3

   I. Matrix calculation
   ---------------------
Creation, transp., deformation of a 2500x2500 matrix (sec):  0.829666666666667 
2400x2400 normal distributed random matrix ^1000____ (sec):  0.155333333333334 
Sorting of 7,000,000 random values__________________ (sec):  0.638333333333334 
2800x2800 cross-product matrix (b = a' * a)_________ (sec):  0.242000000000001 
Linear regr. over a 3000x3000 matrix (c = a \ b')___ (sec):  0.170999999999999 
                      --------------------------------------------
                 Trimmed geom. mean (2 extremes eliminated):  0.29781941072597 

   II. Matrix functions
   --------------------
FFT over 2,400,000 random values____________________ (sec):  0.331333333333333 
Eigenvalues of a 640x640 random matrix______________ (sec):  0.347000000000001 
Determinant of a 2500x2500 random matrix____________ (sec):  0.207000000000001 
Cholesky decomposition of a 3000x3000 matrix________ (sec):  0.254333333333334 
Inverse of a 1600x1600 random matrix________________ (sec):  0.345666666666663 
                      --------------------------------------------
                Trimmed geom. mean (2 extremes eliminated):  0.307686639256803 

   III. Programmation
   ------------------
3,500,000 Fibonacci numbers calculation (vector calc)(sec):  0.245 
Creation of a 3000x3000 Hilbert matrix (matrix calc) (sec):  0.289666666666669 
Grand common divisors of 400,000 pairs (recursion)__ (sec):  0.259333333333331 
Creation of a 500x500 Toeplitz matrix (loops)_______ (sec):  0.0400000000000015 
Escoufier's method on a 45x45 matrix (mixed)________ (sec):  0.263000000000005 
                      --------------------------------------------
                Trimmed geom. mean (2 extremes eliminated):  0.255658395143118 


Total time for all 15 tests_________________________ (sec):  4.61866666666667 
Overall mean (sum of I, II and III trimmed means/3)_ (sec):  0.286136920519432 
                      --- End of test ---



> On Nov 1, 2021, at 2:48 AM, Tim Bates <timothy.c.bates at gmail.com> wrote:
> 
> I wonder if this (2008/R 2.7) page could be updated with some current benchmark runs?
> 
> Especially current Intel server chips, i9, and M1/+ 
> 
> I'm guessing if Simon could help upload the resulting updated page, people here could contribute bench mark runs on different hardware.
> 
> 
> Also be interesting to see different blas results.
> 
> I wonder if either intel or arm chip "neural" cores (dot product engines?) or multi-core and GPU are being used in current R builds?
> 
> tim
> 
> 
> 
> 
> 
> 
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
> 


From ken @end|ng |rom kjbe@th@com@@u  Sun Oct 31 23:00:07 2021
From: ken @end|ng |rom kjbe@th@com@@u (Ken Beath)
Date: Mon, 1 Nov 2021 09:00:07 +1100
Subject: [R-SIG-Mac] https://mac.r-project.org/benchmarks/
In-Reply-To: <8D07527C-3EF3-4815-8B1E-E8ED939611AF@R-project.org>
References: <F311C911-F19E-4CC4-B177-34EFBFC32CC9@gmail.com>
 <8D07527C-3EF3-4815-8B1E-E8ED939611AF@R-project.org>
Message-ID: <7D5217C8-43A0-4EDC-BB51-83FBDB92878B@kjbeath.com.au>

I ran some tests using my packages and a bootstrapped linear model, and the results were that my M1 MacBook Air was faster than my iMac 8-core 2020, and that included using 4 parallel cores on the M1 versus 8 on the iMac. 

Ken

> On 1 Nov 2021, at 8:11 am, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> 
> Tim,
> 
> that is a great idea, those test are really old. Just for the fun of it I have run the tests on my old iMac, but with R 4.1.2 and they still work.
> It's nice to see the huge speed improvements in loops and similar (see below - recall the original tests were scaled to be around 1).
> 
> I have added the page to the repo
> https://github.com/R-macos/R-mac-dev
> so I'd be happy to review PRs, but I'll probably want to re-do it first so it is better organized for comparisons as we have to also accommodate M1 etc.
> 
> Cheers,
> Simon
> 
> ---
> iMac14,2 3.2Ghz i5, macOS 10.4.6, R 4.1.2 vecib/Accelerate BLAS
> 
> 
>   R Benchmark 2.5
>   ===============
> Number of times each test is run__________________________:  3
> 
>   I. Matrix calculation
>   ---------------------
> Creation, transp., deformation of a 2500x2500 matrix (sec):  0.829666666666667 
> 2400x2400 normal distributed random matrix ^1000____ (sec):  0.155333333333334 
> Sorting of 7,000,000 random values__________________ (sec):  0.638333333333334 
> 2800x2800 cross-product matrix (b = a' * a)_________ (sec):  0.242000000000001 
> Linear regr. over a 3000x3000 matrix (c = a \ b')___ (sec):  0.170999999999999 
>                      --------------------------------------------
>                 Trimmed geom. mean (2 extremes eliminated):  0.29781941072597 
> 
>   II. Matrix functions
>   --------------------
> FFT over 2,400,000 random values____________________ (sec):  0.331333333333333 
> Eigenvalues of a 640x640 random matrix______________ (sec):  0.347000000000001 
> Determinant of a 2500x2500 random matrix____________ (sec):  0.207000000000001 
> Cholesky decomposition of a 3000x3000 matrix________ (sec):  0.254333333333334 
> Inverse of a 1600x1600 random matrix________________ (sec):  0.345666666666663 
>                      --------------------------------------------
>                Trimmed geom. mean (2 extremes eliminated):  0.307686639256803 
> 
>   III. Programmation
>   ------------------
> 3,500,000 Fibonacci numbers calculation (vector calc)(sec):  0.245 
> Creation of a 3000x3000 Hilbert matrix (matrix calc) (sec):  0.289666666666669 
> Grand common divisors of 400,000 pairs (recursion)__ (sec):  0.259333333333331 
> Creation of a 500x500 Toeplitz matrix (loops)_______ (sec):  0.0400000000000015 
> Escoufier's method on a 45x45 matrix (mixed)________ (sec):  0.263000000000005 
>                      --------------------------------------------
>                Trimmed geom. mean (2 extremes eliminated):  0.255658395143118 
> 
> 
> Total time for all 15 tests_________________________ (sec):  4.61866666666667 
> Overall mean (sum of I, II and III trimmed means/3)_ (sec):  0.286136920519432 
>                      --- End of test ---
> 
> 
> 
>> On Nov 1, 2021, at 2:48 AM, Tim Bates <timothy.c.bates at gmail.com> wrote:
>> 
>> I wonder if this (2008/R 2.7) page could be updated with some current benchmark runs?
>> 
>> Especially current Intel server chips, i9, and M1/+ 
>> 
>> I'm guessing if Simon could help upload the resulting updated page, people here could contribute bench mark runs on different hardware.
>> 
>> 
>> Also be interesting to see different blas results.
>> 
>> I wonder if either intel or arm chip "neural" cores (dot product engines?) or multi-core and GPU are being used in current R builds?
>> 
>> tim
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>> 
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


From kjhe@|y @end|ng |rom gm@||@com  Sun Oct 31 23:31:55 2021
From: kjhe@|y @end|ng |rom gm@||@com (Kieran Healy)
Date: Sun, 31 Oct 2021 18:31:55 -0400
Subject: [R-SIG-Mac] https://mac.r-project.org/benchmarks/
In-Reply-To: <8D07527C-3EF3-4815-8B1E-E8ED939611AF@R-project.org>
References: <F311C911-F19E-4CC4-B177-34EFBFC32CC9@gmail.com>
 <8D07527C-3EF3-4815-8B1E-E8ED939611AF@R-project.org>
Message-ID: <9C722E0A-DF3F-45AF-9DA2-A8D152B3AF02@gmail.com>

Hello, 

Just out of interest, I ran benchmark-25.R from Simon?s repo, as I have access to an M1 Max. Are the *very* long times on cross-product, linear regression, and Matrix functions a consequence of the BLAS version?

Kieran

> sessionInfo()
R version 4.1.1 (2021-08-10)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Monterey 12.0.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/lib/libRlapack.dylib


> source("R-benchmark-25.R")
Loading required package: SuppDists


   R Benchmark 2.5
   ===============
Number of times each test is run__________________________:  3

   I. Matrix calculation
   ---------------------
Creation, transp., deformation of a 2500x2500 matrix (sec):  0.249666666666656
2400x2400 normal distributed random matrix ^1000____ (sec):  0.105000000000009
Sorting of 7,000,000 random values__________________ (sec):  0.594666666666673
2800x2800 cross-product matrix (b = a' * a)_________ (sec):  13.3016666666667
Linear regr. over a 3000x3000 matrix (c = a \ b')___ (sec):  6.27033333333334
                      --------------------------------------------
                 Trimmed geom. mean (2 extremes eliminated):  0.976431082297569

   II. Matrix functions
   --------------------
FFT over 2,400,000 random values____________________ (sec):  0.0726666666666631
Eigenvalues of a 640x640 random matrix______________ (sec):  0.425666666666672
Determinant of a 2500x2500 random matrix____________ (sec):  1.73833333333333
Cholesky decomposition of a 3000x3000 matrix________ (sec):  5.17333333333333
Inverse of a 1600x1600 random matrix________________ (sec):  1.43099999999996
                      --------------------------------------------
                Trimmed geom. mean (2 extremes eliminated):  1.01925013610031

   III. Programmation
   ------------------
3,500,000 Fibonacci numbers calculation (vector calc)(sec):  0.0950000000000273
Creation of a 3000x3000 Hilbert matrix (matrix calc) (sec):  0.115333333333335
Grand common divisors of 400,000 pairs (recursion)__ (sec):  0.0799999999999841
Creation of a 500x500 Toeplitz matrix (loops)_______ (sec):  0.0173333333333593
Escoufier's method on a 45x45 matrix (mixed)________ (sec):  0.152999999999963
                      --------------------------------------------
                Trimmed geom. mean (2 extremes eliminated):  0.0957023962714685


Total time for all 15 tests_________________________ (sec):  29.823
Overall mean (sum of I, II and III trimmed means/3)_ (sec):  0.45668322781674
                      --- End of test ---

Warning messages:
1: In remove("a", "b") : object 'a' not found
2: In remove("a", "b") : object 'b' not found

> On Oct 31, 2021, at 5:11 PM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> 
> Tim,
> 
> that is a great idea, those test are really old. Just for the fun of it I have run the tests on my old iMac, but with R 4.1.2 and they still work.
> It's nice to see the huge speed improvements in loops and similar (see below - recall the original tests were scaled to be around 1).
> 
> I have added the page to the repo
> https://github.com/R-macos/R-mac-dev
> so I'd be happy to review PRs, but I'll probably want to re-do it first so it is better organized for comparisons as we have to also accommodate M1 etc.
> 
> Cheers,
> Simon
> 
> ---
> iMac14,2 3.2Ghz i5, macOS 10.4.6, R 4.1.2 vecib/Accelerate BLAS
> 
> 
>   R Benchmark 2.5
>   ===============
> Number of times each test is run__________________________:  3
> 
>   I. Matrix calculation
>   ---------------------
> Creation, transp., deformation of a 2500x2500 matrix (sec):  0.829666666666667 
> 2400x2400 normal distributed random matrix ^1000____ (sec):  0.155333333333334 
> Sorting of 7,000,000 random values__________________ (sec):  0.638333333333334 
> 2800x2800 cross-product matrix (b = a' * a)_________ (sec):  0.242000000000001 
> Linear regr. over a 3000x3000 matrix (c = a \ b')___ (sec):  0.170999999999999 
>                      --------------------------------------------
>                 Trimmed geom. mean (2 extremes eliminated):  0.29781941072597 
> 
>   II. Matrix functions
>   --------------------
> FFT over 2,400,000 random values____________________ (sec):  0.331333333333333 
> Eigenvalues of a 640x640 random matrix______________ (sec):  0.347000000000001 
> Determinant of a 2500x2500 random matrix____________ (sec):  0.207000000000001 
> Cholesky decomposition of a 3000x3000 matrix________ (sec):  0.254333333333334 
> Inverse of a 1600x1600 random matrix________________ (sec):  0.345666666666663 
>                      --------------------------------------------
>                Trimmed geom. mean (2 extremes eliminated):  0.307686639256803 
> 
>   III. Programmation
>   ------------------
> 3,500,000 Fibonacci numbers calculation (vector calc)(sec):  0.245 
> Creation of a 3000x3000 Hilbert matrix (matrix calc) (sec):  0.289666666666669 
> Grand common divisors of 400,000 pairs (recursion)__ (sec):  0.259333333333331 
> Creation of a 500x500 Toeplitz matrix (loops)_______ (sec):  0.0400000000000015 
> Escoufier's method on a 45x45 matrix (mixed)________ (sec):  0.263000000000005 
>                      --------------------------------------------
>                Trimmed geom. mean (2 extremes eliminated):  0.255658395143118 
> 
> 
> Total time for all 15 tests_________________________ (sec):  4.61866666666667 
> Overall mean (sum of I, II and III trimmed means/3)_ (sec):  0.286136920519432 
>                      --- End of test ---
> 
> 
> 
>> On Nov 1, 2021, at 2:48 AM, Tim Bates <timothy.c.bates at gmail.com> wrote:
>> 
>> I wonder if this (2008/R 2.7) page could be updated with some current benchmark runs?
>> 
>> Especially current Intel server chips, i9, and M1/+ 
>> 
>> I'm guessing if Simon could help upload the resulting updated page, people here could contribute bench mark runs on different hardware.
>> 
>> 
>> Also be interesting to see different blas results.
>> 
>> I wonder if either intel or arm chip "neural" cores (dot product engines?) or multi-core and GPU are being used in current R builds?
>> 
>> tim
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> R-SIG-Mac mailing list
>> R-SIG-Mac at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-mac
>> 
> 
> _______________________________________________
> R-SIG-Mac mailing list
> R-SIG-Mac at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-mac


