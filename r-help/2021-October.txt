From m@rong|u@|u|g| @end|ng |rom gm@||@com  Fri Oct  1 08:30:55 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Fri, 1 Oct 2021 08:30:55 +0200
Subject: [R] how to combine logic test on vectors in R?
In-Reply-To: <CAGgJW77WETWGALN_t3N8NoXFxMrKo5tsCDXPNWWHEROMw=8yAw@mail.gmail.com>
References: <CAMk+s2TiRXCr1dP1xf6F9fKj7DvGpuMSjrqfpQRBp=N8AAR-xA@mail.gmail.com>
 <CAM_vjunfBsW94i8N3-b+c5WZ19+XZi-tLMACixyTzmpj006Zyw@mail.gmail.com>
 <CAMk+s2R-eLK-b1bcHzSmrJCs7H1N9ynA3n6ckZC9mZYd+DgVOw@mail.gmail.com>
 <CAGxFJbSY2gjSGfmMYVxR5qn8dAyLnH57hDUdKjW_wa++Gj5CtA@mail.gmail.com>
 <CAGgJW77WETWGALN_t3N8NoXFxMrKo5tsCDXPNWWHEROMw=8yAw@mail.gmail.com>
Message-ID: <CAMk+s2RGOm0uCa5ZzgkA0czAyHzL9DTW-U_qR1qu4iw3O40eBg@mail.gmail.com>

Thank you! I have been thinking of using length but it would make the
test more complex. I did not know about all() but it looks like the
tool for the job. Cheers

On Thu, Sep 30, 2021 at 6:24 PM Eric Berger <ericjberger at gmail.com> wrote:
>
> Alternatively you can modify the test as follows:
>
> length(unique(df_b$q)) == 1
>
>
>
> On Thu, Sep 30, 2021 at 7:22 PM Bert Gunter <bgunter.4567 at gmail.com> wrote:
>>
>> I haven't followed this thread closely, but to your question I think
>> maybe this is what you want"
>>
>> > z <- c("","")
>> > all(z == "")
>> [1] TRUE
>> > z <- c("a","")
>> > all(z == "")
>> [1] FALSE
>>
>> If this isn't it, just ignore without reply.
>>
>> Bert Gunter
>>
>> "The trouble with having an open mind is that people keep coming along
>> and sticking things into it."
>> -- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )
>>
>> On Thu, Sep 30, 2021 at 8:51 AM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>> >
>> > Yes, but the && should work within `unique(df_b$q) == ""` because the
>> > test should be: (IF THE DATAFRAME HAS ZERO ROW) OR (ALL THE ELEMENTS
>> > OF $q ARE EMPTY) THEN (PRINT empty).
>> > Can I collapse the TRUE FALSE of `unique(df_b$q) == ""`into a single FALSE?
>> >
>> > On Thu, Sep 30, 2021 at 4:28 PM Sarah Goslee <sarah.goslee at gmail.com> wrote:
>> > >
>> > > Hi,
>> > >
>> > > The OR operator you used is working as expected: || starts from the
>> > > left and evaluates only enough of the options to determine the
>> > > results. The first test is TRUE,  so the result is TRUE. It sounds
>> > > like you might actually want an AND operator, & or &&, which will only
>> > > return TRUE if all elements are TRUE,
>> > >
>> > > More on logical operators:
>> > > https://stat.ethz.ch/R-manual/R-devel/library/base/html/Logic.html
>> > >
>> > > Sarah
>> > >
>> > > On Thu, Sep 30, 2021 at 9:07 AM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>> > > >
>> > > > Hello,
>> > > > I have two data frames, each with three rows:
>> > > > ```
>> > > > df_a <- data.frame(a = letters[1:3], b = LETTERS[1:3], q = c("", "", ""),
>> > > > stringsAsFactors = FALSE)
>> > > > df_b <- data.frame(a = letters[4:6], b = LETTERS[4:6], q = c("", "", "1.5"),
>> > > > stringsAsFactors = FALSE)
>> > > > ```
>> > > > I need to test whether the dataframe has been selected and if there is
>> > > > a value in the q column. I combined in the following test:
>> > > > ```
>> > > > if (nrow(df_a) == 0 || unique(df_a$q) == "") {
>> > > > print("empty")
>> > > > }
>> > > > if (nrow(df_b) == 0 || unique(df_b$q) == "") {
>> > > > print("empty")
>> > > > }
>> > > > ```
>> > > > The test for df_a worked as expected:
>> > > > ```
>> > > > > nrow(df_a) == 0
>> > > > [1] FALSE
>> > > > > unique(df_a$q) == ""
>> > > > [1] TRUE
>> > > > > (nrow(df_a) == 0 || unique(df_a$q) == "")
>> > > > [1] TRUE
>> > > > > if (nrow(df_a) == 0 || unique(df_a$q) == "") {
>> > > > + print("empty")
>> > > > + }
>> > > > [1] "empty"
>> > > > ```
>> > > > but the one for df_b did not:
>> > > > ```
>> > > > > nrow(df_b) == 0
>> > > > [1] FALSE
>> > > > > unique(df_b$q) == ""
>> > > > [1]  TRUE FALSE
>> > > > > (nrow(df_b) == 0 || unique(df_b$q) == "")
>> > > > [1] TRUE
>> > > > > unique(df_b$q)
>> > > > [1] ""    "1.5"
>> > > > ```
>> > > > I say that it did not work because unique(df_b$q) IS NOT "", hence
>> > > > `(nrow(df_b) == 0 || unique(df_b$q) == "")` should be FALSE, instead R
>> > > > evaluated the first element of unique(df_b$q) == "", which is TRUE.
>> > > > How can I properly implement a logic test on vectors?
>> > > >  Thank you
>> > > >
>> > > > ______________________________________________
>> > > > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> > > > https://stat.ethz.ch/mailman/listinfo/r-help
>> > > > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> > > > and provide commented, minimal, self-contained, reproducible code.
>> > >
>> > >
>> > >
>> > > --
>> > > Sarah Goslee (she/her)
>> > > http://www.sarahgoslee.com
>> >
>> >
>> >
>> > --
>> > Best regards,
>> > Luigi
>> >
>> > ______________________________________________
>> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> > https://stat.ethz.ch/mailman/listinfo/r-help
>> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> > and provide commented, minimal, self-contained, reproducible code.
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.



-- 
Best regards,
Luigi


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Fri Oct  1 10:05:04 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Fri, 1 Oct 2021 10:05:04 +0200
Subject: [R] How to get a given cut-off in logit regression?
Message-ID: <CAMk+s2RYq+P_kJ64L2PfLPsuS8dm2QC6or5VtSz+nrmKM4nRUQ@mail.gmail.com>

Hello,
I would like to calculate the 95% success rate of a test. I have a
series of dilutions and the proportion of positive results out of 37
attempts for each of them. I would like to find the concentration that
gives 95% success and I used logit regression:
```
df <- data.frame(concentration = c(1, 10, 100, 1000, 10000),
positivity = c(0.86, 1, 1, 1, 1))
model <- glm(positivity~concentration, family="binomial", data=df)
summary(model)
confint(model)
```
When running the model, I get a warning:
```
Warning messages:
1: In eval(family$initialize) : non-integer #successes in a binomial glm!
2: glm.fit: algorithm did not converge
3: glm.fit: fitted probabilities numerically 0 or 1 occurred
```
but I got  something:
```
> summary(model)

Call:
glm(formula = positivity ~ concentration, family = "binomial",
data = df)

Deviance Residuals:
1         2         3         4         5
0.00e+00  4.41e-04  2.00e-08  2.00e-08  2.00e-08

Coefficients:
Estimate Std. Error z value Pr(>|z|)
(Intercept)      0.223    216.154   0.001    0.999
concentration    1.592    216.131   0.007    0.994

(Dispersion parameter for binomial family taken to be 1)

Null deviance: 4.6727e-01  on 4  degrees of freedom
Residual deviance: 1.9445e-07  on 3  degrees of freedom
AIC: 4.3016

Number of Fisher Scoring iterations: 25
```

How can I now find the concentration that gives 95% positivity?

Thanks

-- 
Best regards,
Luigi


From tr|ng @end|ng |rom gvdnet@dk  Fri Oct  1 14:52:45 2021
From: tr|ng @end|ng |rom gvdnet@dk (Troels Ring)
Date: Fri, 1 Oct 2021 14:52:45 +0200
Subject: [R] linetype corruption in ggplot2
Message-ID: <ec71d5cf-8c78-7bcf-1e02-aee2ae21d71b@gvdnet.dk>

Dear friends - another simple question: the assignment of linetype seems 
to be corrupted in the code below- I would want the solid line
to be the lowest? and also want the legend to be correct. I guess R 
orders the legend names alphabetically and could handle? that but
cannot unnderstand how the lines apparently are switched.

library(ggplot2)

BB <- cbind(c(1,2,3),c(2,4,6),c(3,6,9))
x <- c(2,3,4)
LT <- c("solid","dashed","dotted")

GG <- ggplot()
for (i in 1:3) {
 ? dd <- data.frame(x,BB=BB[i,],LT=LT[i])
 ? GG <- GG + geom_line(data=dd,aes(x=x,y=BB,linetype=LT),size=1)

}
GG+scale_y_continuous(breaks=seq(1,10))

I'm on Windows, R 4.0.5

All best wishes

Troels


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Fri Oct  1 15:21:55 2021
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Fri, 1 Oct 2021 14:21:55 +0100
Subject: [R] linetype corruption in ggplot2
In-Reply-To: <ec71d5cf-8c78-7bcf-1e02-aee2ae21d71b@gvdnet.dk>
References: <ec71d5cf-8c78-7bcf-1e02-aee2ae21d71b@gvdnet.dk>
Message-ID: <26f6b1da-d04e-7f28-2ab7-06945769eaef@sapo.pt>

Hello,

The problem is in the for loop. Every time through it the data argument 
changes and ggplot only evaluates when printing, not when it's 
constructing the object.

It's not a good idea to construct a ggplot object in a loop.

Why don't you put x and BB in a data.frame, reshape it to long format 
and plot all lines in the same instruction?


df1 <- data.frame(x, BB)
names(df1)[2:4] <- paste0("BB", 1:3)

df1_long <- reshape(
   df1, direction = "long",
   varying = names(df1)[2:4],
   v.names = "BB",
   timevar = "LT"
)
df1_long$LT <- LT[df1_long$LT]

ggplot(df1_long, aes(x, BB, linetype = LT)) +
   geom_line() +
   scale_linetype_manual(values = c(solid = "solid", dashed = "dashed", 
dotted = "dotted"))



Hope this helps,

Rui Barradas

?s 13:52 de 01/10/21, Troels Ring escreveu:
> Dear friends - another simple question: the assignment of linetype seems 
> to be corrupted in the code below- I would want the solid line
> to be the lowest? and also want the legend to be correct. I guess R 
> orders the legend names alphabetically and could handle? that but
> cannot unnderstand how the lines apparently are switched.
> 
> library(ggplot2)
> 
> BB <- cbind(c(1,2,3),c(2,4,6),c(3,6,9))
> x <- c(2,3,4)
> LT <- c("solid","dashed","dotted")
> 
> GG <- ggplot()
> for (i in 1:3) {
>  ? dd <- data.frame(x,BB=BB[i,],LT=LT[i])
>  ? GG <- GG + geom_line(data=dd,aes(x=x,y=BB,linetype=LT),size=1)
> 
> }
> GG+scale_y_continuous(breaks=seq(1,10))
> 
> I'm on Windows, R 4.0.5
> 
> All best wishes
> 
> Troels
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From tr|ng @end|ng |rom gvdnet@dk  Sat Oct  2 07:28:42 2021
From: tr|ng @end|ng |rom gvdnet@dk (Troels Ring)
Date: Sat, 2 Oct 2021 07:28:42 +0200
Subject: [R] linetype corruption in ggplot2
In-Reply-To: <ec71d5cf-8c78-7bcf-1e02-aee2ae21d71b@gvdnet.dk>
References: <ec71d5cf-8c78-7bcf-1e02-aee2ae21d71b@gvdnet.dk>
Message-ID: <4f1e6e43-cd06-8ac7-7d2d-79e5c91f9f16@gvdnet.dk>

Thanks a lot, Rui - this works well - although I still fail to see why a 
loop could not do it although your explanation for the problem is well 
taken!

All best
Troels

Den 01-10-2021 kl. 15:21 skrev Rui Barradas:
> Hello,
>
> The problem is in the for loop. Every time through it the data 
> argument changes and ggplot only evaluates when printing, not when 
> it's constructing the object.
>
> It's not a good idea to construct a ggplot object in a loop.
>
> Why don't you put x and BB in a data.frame, reshape it to long format 
> and plot all lines in the same instruction?
>
>
> df1 <- data.frame(x, BB)
> names(df1)[2:4] <- paste0("BB", 1:3)
>
> df1_long <- reshape(
> ? df1, direction = "long",
> ? varying = names(df1)[2:4],
> ? v.names = "BB",
> ? timevar = "LT"
> )
> df1_long$LT <- LT[df1_long$LT]
>
> ggplot(df1_long, aes(x, BB, linetype = LT)) +
> ? geom_line() +
> ? scale_linetype_manual(values = c(solid = "solid", dashed = "dashed", 
> dotted = "dotted"))
>
>
>
> Hope this helps,
>
> Rui Barradas
>
> ?s 13:52 de 01/10/21, Troels Ring escreveu:
>> Dear friends - another simple question: the assignment of linetype 
>> seems to be corrupted in the code below- I would want the solid line
>> to be the lowest? and also want the legend to be correct. I guess R 
>> orders the legend names alphabetically and could handle that but
>> cannot unnderstand how the lines apparently are switched.
>>
>> library(ggplot2)
>>
>> BB <- cbind(c(1,2,3),c(2,4,6),c(3,6,9))
>> x <- c(2,3,4)
>> LT <- c("solid","dashed","dotted")
>>
>> GG <- ggplot()
>> for (i in 1:3) {
>> ?? dd <- data.frame(x,BB=BB[i,],LT=LT[i])
>> ?? GG <- GG + geom_line(data=dd,aes(x=x,y=BB,linetype=LT),size=1)
>>
>> }
>> GG+scale_y_continuous(breaks=seq(1,10))
>>
>> I'm on Windows, R 4.0.5
>>
>> All best wishes
>>
>> Troels
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide 
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Sat Oct  2 10:14:02 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Sat, 2 Oct 2021 10:14:02 +0200
Subject: [R] how to predict X given Y using logit regresion in R?
Message-ID: <CAMk+s2QALE7pbnsgp5=A1omW+CFh6YzoHTcWnzQrnmZJvUzy1w@mail.gmail.com>

Hello,
I have set a glm model using probit. I would like to use it to predict
X given Y. I have followed this example:
```
f2<-data.frame(age=c(10,20,30),weight=c(100,200,300))
f3<-data.frame(age=c(15,25))
f4<-data.frame(age=18)
mod<-lm(weight~age,data=f2)
> predict(mod,f3)
1
150
> predict(mod,f4)
1
180
```

I have set the following:
```
df <- data.frame(concentration = c(1, 10, 100, 1000, 10000),
positivity = c(0.86, 1, 1, 1, 1))
model <- glm(positivity~concentration,family = binomial(link =
"logit"), data=df)
> e3<-data.frame(concentration=c(11, 101), positivity=c(1, 1))
> predict(model, e3)
1               2
5.645045 46.727573
```
but:
```
> e4<-data.frame(positivity=0.95)
> e4
positivity
1       0.95
> predict(model, e4)
Error in eval(predvars, data, env) : object 'concentration' not found
```
Why did the thing worked for f4 but not e4? How do I get X given Y?
Do I need to find the inverse function of logit (which one?) and apply
this to the regression or is there a simpler method?
Also, is it possible to plot the model to get a smooter line than
`plot(positivity ~ concentration, data = df, log = "x", type="o")`?
Thanks
-- 
Best regards,
Luigi


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Sat Oct  2 16:33:32 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Sat, 2 Oct 2021 16:33:32 +0200
Subject: [R] how to predict X given Y using logit regresion in R?
In-Reply-To: <CAMk+s2QALE7pbnsgp5=A1omW+CFh6YzoHTcWnzQrnmZJvUzy1w@mail.gmail.com>
References: <CAMk+s2QALE7pbnsgp5=A1omW+CFh6YzoHTcWnzQrnmZJvUzy1w@mail.gmail.com>
Message-ID: <CAMk+s2RS4KFZM00fBzzOZFrmOyfve0XJ2KG80WYSOgpDt_Go+Q@mail.gmail.com>

I tried with:
```
library(chemCal)
inverse.predict(model, 0.95)
> inverse.predict(model, 0.95)
$Prediction
[1] 0.4565871

$`Standard Error`
[1] 5.525725e-10

$Confidence
[1] 1.758532e-09

$`Confidence Limits`
[1] 0.4565871 0.4565871
```
but the value 0.457 does not sound good, it should be about 1.7. Could
it be that model is based on glm whereas inverse.predict uses linear
regression?

On Sat, Oct 2, 2021 at 10:14 AM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>
> Hello,
> I have set a glm model using probit. I would like to use it to predict
> X given Y. I have followed this example:
> ```
> f2<-data.frame(age=c(10,20,30),weight=c(100,200,300))
> f3<-data.frame(age=c(15,25))
> f4<-data.frame(age=18)
> mod<-lm(weight~age,data=f2)
> > predict(mod,f3)
> 1
> 150
> > predict(mod,f4)
> 1
> 180
> ```
>
> I have set the following:
> ```
> df <- data.frame(concentration = c(1, 10, 100, 1000, 10000),
> positivity = c(0.86, 1, 1, 1, 1))
> model <- glm(positivity~concentration,family = binomial(link =
> "logit"), data=df)
> > e3<-data.frame(concentration=c(11, 101), positivity=c(1, 1))
> > predict(model, e3)
> 1               2
> 5.645045 46.727573
> ```
> but:
> ```
> > e4<-data.frame(positivity=0.95)
> > e4
> positivity
> 1       0.95
> > predict(model, e4)
> Error in eval(predvars, data, env) : object 'concentration' not found
> ```
> Why did the thing worked for f4 but not e4? How do I get X given Y?
> Do I need to find the inverse function of logit (which one?) and apply
> this to the regression or is there a simpler method?
> Also, is it possible to plot the model to get a smooter line than
> `plot(positivity ~ concentration, data = df, log = "x", type="o")`?
> Thanks
> --
> Best regards,
> Luigi



-- 
Best regards,
Luigi


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Sat Oct  2 22:36:57 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Sat, 2 Oct 2021 22:36:57 +0200
Subject: [R] how to predict X given Y using logit regresion in R?
In-Reply-To: <CAMk+s2QALE7pbnsgp5=A1omW+CFh6YzoHTcWnzQrnmZJvUzy1w@mail.gmail.com>
References: <CAMk+s2QALE7pbnsgp5=A1omW+CFh6YzoHTcWnzQrnmZJvUzy1w@mail.gmail.com>
Message-ID: <CAMk+s2Rm-eJfXP8Qzr2OoPohm1yryvwNA4dDk5tzqJ0mLPdy7Q@mail.gmail.com>

Hello,
I also tried with
```
library(MASS)
> dose.p(model,p=.95)
               Dose       SE
p = 0.95: 1.70912 96.26511
```
which is closer to the expected 1.72 but with a very large error (I
expected 1.10-2.34). Is this regression correct?

On Sat, Oct 2, 2021 at 10:14 AM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>
> Hello,
> I have set a glm model using probit. I would like to use it to predict
> X given Y. I have followed this example:
> ```
> f2<-data.frame(age=c(10,20,30),weight=c(100,200,300))
> f3<-data.frame(age=c(15,25))
> f4<-data.frame(age=18)
> mod<-lm(weight~age,data=f2)
> > predict(mod,f3)
> 1
> 150
> > predict(mod,f4)
> 1
> 180
> ```
>
> I have set the following:
> ```
> df <- data.frame(concentration = c(1, 10, 100, 1000, 10000),
> positivity = c(0.86, 1, 1, 1, 1))
> model <- glm(positivity~concentration,family = binomial(link =
> "logit"), data=df)
> > e3<-data.frame(concentration=c(11, 101), positivity=c(1, 1))
> > predict(model, e3)
> 1               2
> 5.645045 46.727573
> ```
> but:
> ```
> > e4<-data.frame(positivity=0.95)
> > e4
> positivity
> 1       0.95
> > predict(model, e4)
> Error in eval(predvars, data, env) : object 'concentration' not found
> ```
> Why did the thing worked for f4 but not e4? How do I get X given Y?
> Do I need to find the inverse function of logit (which one?) and apply
> this to the regression or is there a simpler method?
> Also, is it possible to plot the model to get a smooter line than
> `plot(positivity ~ concentration, data = df, log = "x", type="o")`?
> Thanks
> --
> Best regards,
> Luigi



-- 
Best regards,
Luigi


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Sat Oct  2 22:48:51 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Sat, 2 Oct 2021 22:48:51 +0200
Subject: [R] how to predict X given Y using logit regresion in R?
In-Reply-To: <CAMk+s2RS4KFZM00fBzzOZFrmOyfve0XJ2KG80WYSOgpDt_Go+Q@mail.gmail.com>
References: <CAMk+s2QALE7pbnsgp5=A1omW+CFh6YzoHTcWnzQrnmZJvUzy1w@mail.gmail.com>
 <CAMk+s2RS4KFZM00fBzzOZFrmOyfve0XJ2KG80WYSOgpDt_Go+Q@mail.gmail.com>
Message-ID: <CAMk+s2SrPDtbip4ZPxvTZ0+fjdAgNpu3yUXrw+apYNo_7x8Fxw@mail.gmail.com>

Actually,
I think it worked with chemCal, it was the drawing that was a bit
rough. I sort it with:
```
library(MASS)
lod <- dose.p(model,p=.95)
plot(positivity ~ concentration, data = df, log = "x",
xlab=expression(bold(paste("Concentration (c/", mu, "L)"))),
ylab=expression(bold("Proportion of positivity")))
newdata <- data.frame(concentration=seq(min(df$concentration),
max(df$concentration),by=0.01))
newdata$positivity = predict(model, newdata, type="response")
abline(h=0.95, lty=3)
abline(v=lod, lty=3)
points(positivity ~ concentration, data = newdata, type="l")
text(lod+0.2, 0.87, labels = round(lod, 2), cex = 0.9)
```


Case closed

On Sat, Oct 2, 2021 at 4:33 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>
> I tried with:
> ```
> library(chemCal)
> inverse.predict(model, 0.95)
> > inverse.predict(model, 0.95)
> $Prediction
> [1] 0.4565871
>
> $`Standard Error`
> [1] 5.525725e-10
>
> $Confidence
> [1] 1.758532e-09
>
> $`Confidence Limits`
> [1] 0.4565871 0.4565871
> ```
> but the value 0.457 does not sound good, it should be about 1.7. Could
> it be that model is based on glm whereas inverse.predict uses linear
> regression?
>
> On Sat, Oct 2, 2021 at 10:14 AM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
> >
> > Hello,
> > I have set a glm model using probit. I would like to use it to predict
> > X given Y. I have followed this example:
> > ```
> > f2<-data.frame(age=c(10,20,30),weight=c(100,200,300))
> > f3<-data.frame(age=c(15,25))
> > f4<-data.frame(age=18)
> > mod<-lm(weight~age,data=f2)
> > > predict(mod,f3)
> > 1
> > 150
> > > predict(mod,f4)
> > 1
> > 180
> > ```
> >
> > I have set the following:
> > ```
> > df <- data.frame(concentration = c(1, 10, 100, 1000, 10000),
> > positivity = c(0.86, 1, 1, 1, 1))
> > model <- glm(positivity~concentration,family = binomial(link =
> > "logit"), data=df)
> > > e3<-data.frame(concentration=c(11, 101), positivity=c(1, 1))
> > > predict(model, e3)
> > 1               2
> > 5.645045 46.727573
> > ```
> > but:
> > ```
> > > e4<-data.frame(positivity=0.95)
> > > e4
> > positivity
> > 1       0.95
> > > predict(model, e4)
> > Error in eval(predvars, data, env) : object 'concentration' not found
> > ```
> > Why did the thing worked for f4 but not e4? How do I get X given Y?
> > Do I need to find the inverse function of logit (which one?) and apply
> > this to the regression or is there a simpler method?
> > Also, is it possible to plot the model to get a smooter line than
> > `plot(positivity ~ concentration, data = df, log = "x", type="o")`?
> > Thanks
> > --
> > Best regards,
> > Luigi
>
>
>
> --
> Best regards,
> Luigi



-- 
Best regards,
Luigi

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rplot.png
Type: image/png
Size: 8687 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-help/attachments/20211002/e5f2b21a/attachment.png>

From |eo@m@d@ @end|ng |rom @yon|c@eu  Sun Oct  3 00:00:15 2021
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leonard Mada)
Date: Sun, 3 Oct 2021 01:00:15 +0300
Subject: [R] Descriptive Statistics: useful hacks
Message-ID: <31e14083-b267-0e06-074f-814f34d15c9e@syonic.eu>

Dear R Users,


I have started to compile some useful hacks for the generation of nice 
descriptive statistics. I hope that these functions & hacks are useful 
to the wider R community. I hope that package developers also get some 
inspiration from the code or from these ideas.


I have started to review various packages focused on descriptive 
statistics - although I am still at the very beginning.


### Hacks / Code
- split table headers in 2 rows;
- split results over 2 rows: view.gtsummary(...);
- add abbreviations as footnotes: add.abbrev(...);

The results are exported as a web page (using shiny) and can be printed 
as a pdf documented. See the following pdf example:

https://github.com/discoleo/R/blob/master/Stat/Tools.DescriptiveStatistics.Example_1.pdf


### Example
# currently focused on package gtsummary
library(gtsummary)
library(xml2)

mtcars %>%
 ??? # rename2():
 ??? # - see file Tools.Data.R;
 ??? # - behaves in most cases the same as dplyr::rename();
 ??? rename2("HP" = "hp", "Displ" = disp, "Wt (klb)" = "wt", "Rar" = 
drat) %>%
 ??? # as.factor.df():
 ??? # - see file Tools.Data.R;
 ??? # - encode as (ordered) factor;
 ??? as.factor.df("cyl", "Cyl ") %>%
 ??? # the Descriptive Statistics:
 ??? tbl_summary(by = cyl) %>%
 ??? modify_header(update = header) %>%
 ??? add_p() %>%
 ??? add_overall() %>%
 ??? modify_header(update = header0) %>%
 ??? # Hack: split long statistics !!!
 ??? view.gtsummary(view=FALSE, len=8) %>%
 ??? add.abbrev(
 ??? ??? c("Displ", "HP", "Rar", "Wt (klb)" = "Wt"),
 ??? ??? c("Displacement (in^3)", "Gross horsepower", "Rear axle ratio",
 ??? ??? "Weight (1000 lbs)"));


The required functions are on Github:
https://github.com/discoleo/R/blob/master/Stat/Tools.DescriptiveStatistics.R 



The functions rename2() & as.factor.df() are only data-helpers and can 
be found also on Github:
https://github.com/discoleo/R/blob/master/Stat/Tools.Data.R


Note:

1.) The function add.abbrev() operates on the generated html-code:

- the functionality is more generic and could be used easily with other 
packages that export web pages as well;

2.) Split statistics: is an ugly hack. I plan to redesign the 
functionality using xml-technologies. But I have already too many 
side-projects.

3.) as.factor.df(): traditionally, one would create derived data-sets or 
add a new column with the variable as factor (as the user may need the 
numeric values for further analysis). But it looked nicer as a single 
block of code.


Sincerely,


Leonard


From bgunter@4567 @end|ng |rom gm@||@com  Sun Oct  3 00:31:33 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Sat, 2 Oct 2021 15:31:33 -0700
Subject: [R] Descriptive Statistics: useful hacks
In-Reply-To: <31e14083-b267-0e06-074f-814f34d15c9e@syonic.eu>
References: <31e14083-b267-0e06-074f-814f34d15c9e@syonic.eu>
Message-ID: <CAGxFJbQMGmYa3qKd2a+c0_bQg8nAfyj6EgnHdjNqrqcBhCQYuA@mail.gmail.com>

If you think what you are doing is useful, why do you not put it in a
package?! That is, after all, the whole purpose of packages.

I can only speak for myself, of course, but I doubt that posting long
involved messages with code here is going to have anything like the
utility of providing a package with carefully written and tested code
and documented functionality. If you have suggestions about how to
improve a *particular* package, a better alternative is probably to
contact the package maintainer.


Bert Gunter

"The trouble with having an open mind is that people keep coming along
and sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )

On Sat, Oct 2, 2021 at 3:00 PM Leonard Mada via R-help
<r-help at r-project.org> wrote:
>
> Dear R Users,
>
>
> I have started to compile some useful hacks for the generation of nice
> descriptive statistics. I hope that these functions & hacks are useful
> to the wider R community. I hope that package developers also get some
> inspiration from the code or from these ideas.
>
>
> I have started to review various packages focused on descriptive
> statistics - although I am still at the very beginning.
>
>
> ### Hacks / Code
> - split table headers in 2 rows;
> - split results over 2 rows: view.gtsummary(...);
> - add abbreviations as footnotes: add.abbrev(...);
>
> The results are exported as a web page (using shiny) and can be printed
> as a pdf documented. See the following pdf example:
>
> https://github.com/discoleo/R/blob/master/Stat/Tools.DescriptiveStatistics.Example_1.pdf
>
>
> ### Example
> # currently focused on package gtsummary
> library(gtsummary)
> library(xml2)
>
> mtcars %>%
>      # rename2():
>      # - see file Tools.Data.R;
>      # - behaves in most cases the same as dplyr::rename();
>      rename2("HP" = "hp", "Displ" = disp, "Wt (klb)" = "wt", "Rar" =
> drat) %>%
>      # as.factor.df():
>      # - see file Tools.Data.R;
>      # - encode as (ordered) factor;
>      as.factor.df("cyl", "Cyl ") %>%
>      # the Descriptive Statistics:
>      tbl_summary(by = cyl) %>%
>      modify_header(update = header) %>%
>      add_p() %>%
>      add_overall() %>%
>      modify_header(update = header0) %>%
>      # Hack: split long statistics !!!
>      view.gtsummary(view=FALSE, len=8) %>%
>      add.abbrev(
>          c("Displ", "HP", "Rar", "Wt (klb)" = "Wt"),
>          c("Displacement (in^3)", "Gross horsepower", "Rear axle ratio",
>          "Weight (1000 lbs)"));
>
>
> The required functions are on Github:
> https://github.com/discoleo/R/blob/master/Stat/Tools.DescriptiveStatistics.R
>
>
>
> The functions rename2() & as.factor.df() are only data-helpers and can
> be found also on Github:
> https://github.com/discoleo/R/blob/master/Stat/Tools.Data.R
>
>
> Note:
>
> 1.) The function add.abbrev() operates on the generated html-code:
>
> - the functionality is more generic and could be used easily with other
> packages that export web pages as well;
>
> 2.) Split statistics: is an ugly hack. I plan to redesign the
> functionality using xml-technologies. But I have already too many
> side-projects.
>
> 3.) as.factor.df(): traditionally, one would create derived data-sets or
> add a new column with the variable as factor (as the user may need the
> numeric values for further analysis). But it looked nicer as a single
> block of code.
>
>
> Sincerely,
>
>
> Leonard
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From pd@|gd @end|ng |rom gm@||@com  Sun Oct  3 18:40:48 2021
From: pd@|gd @end|ng |rom gm@||@com (peter dalgaard)
Date: Sun, 3 Oct 2021 18:40:48 +0200
Subject: [R] [Rd] R 4.1.2 scheduled for November 1
Message-ID: <7BC92570-396C-47AD-A035-6558E1FEEAC0@gmail.com>

(Just a quick heads-up for developers.)
 
Full schedule to be made available soon.

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com

_______________________________________________
R-announce at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-announce


From pd@|gd @end|ng |rom gm@||@com  Sun Oct  3 18:58:08 2021
From: pd@|gd @end|ng |rom gm@||@com (peter dalgaard)
Date: Sun, 3 Oct 2021 18:58:08 +0200
Subject: [R] [Rd] R 4.1.2 scheduled for November 1
In-Reply-To: <7BC92570-396C-47AD-A035-6558E1FEEAC0@gmail.com>
References: <7BC92570-396C-47AD-A035-6558E1FEEAC0@gmail.com>
Message-ID: <EE1D7D21-430D-4FF8-BEF8-3B46DBD29B7A@gmail.com>

Schedule should appear on developer.r-project.org when it gets updated from SVN.

> On 3 Oct 2021, at 18:40 , peter dalgaard <pdalgd at gmail.com> wrote:
> 
> (Just a quick heads-up for developers.)
> 
> Full schedule to be made available soon.
> 

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com

_______________________________________________
R-announce at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-announce


From pj@|nh@07 @end|ng |rom gm@||@com  Tue Oct  5 14:19:31 2021
From: pj@|nh@07 @end|ng |rom gm@||@com (pooja sinha)
Date: Tue, 5 Oct 2021 08:19:31 -0400
Subject: [R] Need in formatting data for circos plot
Message-ID: <CAGjf1cM_bW+y6LvC=e0yxtHqoG8LXeM6Qf2emry0_qkZRPh_yQ@mail.gmail.com>

Hi All,

I have gene expression data with differential fold change value and the
file looks like as below:
Chrom start_pos end_pos value
14 20482867 20496901 2.713009346
4 123712710 123718202 -2.20797815
13 80883384 80896042 1.646405782
16 48842551 48844461 -1.636002557
17 28399094 28517527 1.033066311
9 31846044 31913462 -1.738549101
1 45311538 45349706 -1.360867536
I wrote a code in R but it is giving error so I need help in trouble
shooting:
library(circlize)
library(gtools)
library(dplyr)
circos.initializeWithIdeogram(species = "mm10")
circos.par("track.height"=0.20)

circos.genomicTrackPlotRegion(data = db_tr,ylim = C(-7, 7), numeric.column
= 4,
                              panel.fun = function(region,value,...) {
                                cond <- value[,1] < 0.0
                                circos.genomicPoints(region[cond,],
value[cond,], pch = ".", cex = 0.1,
                                                     col = "khaki4")
                                circos.genomicPoints(region[!cond,],
value[!cond,], pch = ".", cex = 0.1,
                                                     col = "indianred")
                              })
Error is : Error in C(-7, 7) : object not interpretable as a factor

Please help as I am new to circos plot and tried a lot. The file is also
attached here.

Thanks,
Puja

From petr@p|k@| @end|ng |rom prechez@@cz  Tue Oct  5 15:19:42 2021
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Tue, 5 Oct 2021 13:19:42 +0000
Subject: [R] Need in formatting data for circos plot
In-Reply-To: <CAGjf1cM_bW+y6LvC=e0yxtHqoG8LXeM6Qf2emry0_qkZRPh_yQ@mail.gmail.com>
References: <CAGjf1cM_bW+y6LvC=e0yxtHqoG8LXeM6Qf2emry0_qkZRPh_yQ@mail.gmail.com>
Message-ID: <fedaf419791a4b45a9b6e80bb003930c@SRVEXCHCM1302.precheza.cz>

Hm,

Maybe if you change 
> C(-7, 7)
Error in C(-7, 7) : object not interpretable as a factor

to

> c(-7, 7)
[1] -7  7

Cheers
Petr


S pozdravem | Best Regards
RNDr. Petr PIKAL
Vedouc? V?zkumu a v?voje | Research Manager
PRECHEZA a.s.
n?b?. Dr. Edvarda Bene?e 1170/24 | 750 02 P?erov | Czech Republic
Tel: +420 581 252 256 | GSM: +420 724 008 364
petr.pikal at precheza.cz | www.precheza.cz
Osobn? ?daje: Informace o zpracov?n? a ochran? osobn?ch ?daj? obchodn?ch
partner? PRECHEZA a.s. jsou zve?ejn?ny na:
https://www.precheza.cz/zasady-ochrany-osobnich-udaju/ | Information about
processing and protection of business partner's personal data are available
on website: https://www.precheza.cz/en/personal-data-protection-principles/
D?v?rnost: Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn?
a podl?haj? tomuto pr?vn? z?vazn?mu prohl??en? o vylou?en? odpov?dnosti:
https://www.precheza.cz/01-dovetek/ | This email and any documents attached
to it may be confidential and are subject to the legally binding disclaimer:
https://www.precheza.cz/en/01-disclaimer/

> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of pooja sinha
> Sent: Tuesday, October 5, 2021 2:20 PM
> To: r-help mailing list <r-help at r-project.org>
> Subject: [R] Need in formatting data for circos plot
> 
> Hi All,
> 
> I have gene expression data with differential fold change value and the
file
> looks like as below:
> Chrom start_pos end_pos value
> 14 20482867 20496901 2.713009346
> 4 123712710 123718202 -2.20797815
> 13 80883384 80896042 1.646405782
> 16 48842551 48844461 -1.636002557
> 17 28399094 28517527 1.033066311
> 9 31846044 31913462 -1.738549101
> 1 45311538 45349706 -1.360867536
> I wrote a code in R but it is giving error so I need help in trouble
> shooting:
> library(circlize)
> library(gtools)
> library(dplyr)
> circos.initializeWithIdeogram(species = "mm10")
> circos.par("track.height"=0.20)
> 
> circos.genomicTrackPlotRegion(data = db_tr,ylim = C(-7, 7), numeric.column
> = 4,
>                               panel.fun = function(region,value,...) {
>                                 cond <- value[,1] < 0.0
>                                 circos.genomicPoints(region[cond,],
> value[cond,], pch = ".", cex = 0.1,
>                                                      col = "khaki4")
>                                 circos.genomicPoints(region[!cond,],
> value[!cond,], pch = ".", cex = 0.1,
>                                                      col = "indianred")
>                               })
> Error is : Error in C(-7, 7) : object not interpretable as a factor
> 
> Please help as I am new to circos plot and tried a lot. The file is also
attached
> here.
> 
> Thanks,
> Puja
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-
> guide.html
> and provide commented, minimal, self-contained, reproducible code.

From pj@|nh@07 @end|ng |rom gm@||@com  Tue Oct  5 16:15:01 2021
From: pj@|nh@07 @end|ng |rom gm@||@com (pooja sinha)
Date: Tue, 5 Oct 2021 10:15:01 -0400
Subject: [R] Need in formatting data for circos plot
In-Reply-To: <fedaf419791a4b45a9b6e80bb003930c@SRVEXCHCM1302.precheza.cz>
References: <CAGjf1cM_bW+y6LvC=e0yxtHqoG8LXeM6Qf2emry0_qkZRPh_yQ@mail.gmail.com>
 <fedaf419791a4b45a9b6e80bb003930c@SRVEXCHCM1302.precheza.cz>
Message-ID: <CAGjf1cO=dN5PkzE5k7h-nL9eZ9uwD+eqAqc6abt5kxLC0tokog@mail.gmail.com>

Thanks, the code is working now but it is not plotting in the colorwise
manner ie, khaki4 and indian red. Maybe I need to work more. If you have
any clue then please let me know.


Thanks again,
Puja

On Tue, Oct 5, 2021 at 9:19 AM PIKAL Petr <petr.pikal at precheza.cz> wrote:

> Hm,
>
> Maybe if you change
> > C(-7, 7)
> Error in C(-7, 7) : object not interpretable as a factor
>
> to
>
> > c(-7, 7)
> [1] -7  7
>
> Cheers
> Petr
>
>
> S pozdravem | Best Regards
> RNDr. Petr PIKAL
> Vedouc? V?zkumu a v?voje | Research Manager
> PRECHEZA a.s.
> n?b?. Dr. Edvarda Bene?e 1170/24 | 750 02 P?erov | Czech Republic
> Tel: +420 581 252 256 | GSM: +420 724 008 364
> petr.pikal at precheza.cz | www.precheza.cz
> Osobn? ?daje: Informace o zpracov?n? a ochran? osobn?ch ?daj? obchodn?ch
> partner? PRECHEZA a.s. jsou zve?ejn?ny na:
> https://www.precheza.cz/zasady-ochrany-osobnich-udaju/ | Information about
> processing and protection of business partner's personal data are available
> on website:
> https://www.precheza.cz/en/personal-data-protection-principles/
> D?v?rnost: Tento e-mail a jak?koliv k n?mu p?ipojen? dokumenty jsou d?v?rn?
> a podl?haj? tomuto pr?vn? z?vazn?mu prohl??en? o vylou?en? odpov?dnosti:
> https://www.precheza.cz/01-dovetek/ | This email and any documents
> attached
> to it may be confidential and are subject to the legally binding
> disclaimer:
> https://www.precheza.cz/en/01-disclaimer/
>
> > -----Original Message-----
> > From: R-help <r-help-bounces at r-project.org> On Behalf Of pooja sinha
> > Sent: Tuesday, October 5, 2021 2:20 PM
> > To: r-help mailing list <r-help at r-project.org>
> > Subject: [R] Need in formatting data for circos plot
> >
> > Hi All,
> >
> > I have gene expression data with differential fold change value and the
> file
> > looks like as below:
> > Chrom start_pos end_pos value
> > 14 20482867 20496901 2.713009346
> > 4 123712710 123718202 -2.20797815
> > 13 80883384 80896042 1.646405782
> > 16 48842551 48844461 -1.636002557
> > 17 28399094 28517527 1.033066311
> > 9 31846044 31913462 -1.738549101
> > 1 45311538 45349706 -1.360867536
> > I wrote a code in R but it is giving error so I need help in trouble
> > shooting:
> > library(circlize)
> > library(gtools)
> > library(dplyr)
> > circos.initializeWithIdeogram(species = "mm10")
> > circos.par("track.height"=0.20)
> >
> > circos.genomicTrackPlotRegion(data = db_tr,ylim = C(-7, 7),
> numeric.column
> > = 4,
> >                               panel.fun = function(region,value,...) {
> >                                 cond <- value[,1] < 0.0
> >                                 circos.genomicPoints(region[cond,],
> > value[cond,], pch = ".", cex = 0.1,
> >                                                      col = "khaki4")
> >                                 circos.genomicPoints(region[!cond,],
> > value[!cond,], pch = ".", cex = 0.1,
> >                                                      col = "indianred")
> >                               })
> > Error is : Error in C(-7, 7) : object not interpretable as a factor
> >
> > Please help as I am new to circos plot and tried a lot. The file is also
> attached
> > here.
> >
> > Thanks,
> > Puja
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-
> > guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From @nne@z@ch@z@ch @end|ng |rom gm@||@com  Mon Oct  4 20:02:36 2021
From: @nne@z@ch@z@ch @end|ng |rom gm@||@com (Anne Zach)
Date: Mon, 4 Oct 2021 11:02:36 -0700
Subject: [R] Rename variables starting with digits
Message-ID: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>

Dear R users,

I have a dataframe that contains several variables, among which 105
correspond to scores on certain trials. Unfortunately, when I imported this
dataframe into R, I realised that the variable names corresponding to each
trial begin with digits, which violates R naming conventions.

I am trying to relabel these variables by adding a 'v' as a prefix to each
of them, I'd like to use tidyverse, but I am struggling with this process
of renaming. When I run this chunk of code, no error occurs but my
variables are not renamed. I'm fairly new to R and I can't understand what
I'm doing wrong.

```{r}

behavioral_df <- behavioral_df %>% rename_with(.fn =  ~paste0("v"),
starts_with('^\\d'))

```

I appreciate if you can help.

Best,
Anne

	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Tue Oct  5 18:21:51 2021
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Tue, 5 Oct 2021 12:21:51 -0400
Subject: [R] Rename variables starting with digits
In-Reply-To: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
References: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
Message-ID: <CAPcHnpRhbEuwyX+1=JNvEFHV2M7OBEnmVMEV8V6n40Gp_3hvdQ@mail.gmail.com>

Hello,


I think you have to use 'matches' instead of 'starts_with', I believe
starts_with does not accept a regular expression whereas matches does.

On Tue, Oct 5, 2021 at 12:15 PM Anne Zach <anne.zach.zach at gmail.com> wrote:

> Dear R users,
>
> I have a dataframe that contains several variables, among which 105
> correspond to scores on certain trials. Unfortunately, when I imported this
> dataframe into R, I realised that the variable names corresponding to each
> trial begin with digits, which violates R naming conventions.
>
> I am trying to relabel these variables by adding a 'v' as a prefix to each
> of them, I'd like to use tidyverse, but I am struggling with this process
> of renaming. When I run this chunk of code, no error occurs but my
> variables are not renamed. I'm fairly new to R and I can't understand what
> I'm doing wrong.
>
> ```{r}
>
> behavioral_df <- behavioral_df %>% rename_with(.fn =  ~paste0("v"),
> starts_with('^\\d'))
>
> ```
>
> I appreciate if you can help.
>
> Best,
> Anne
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From er|cjberger @end|ng |rom gm@||@com  Tue Oct  5 18:25:46 2021
From: er|cjberger @end|ng |rom gm@||@com (Eric Berger)
Date: Tue, 5 Oct 2021 19:25:46 +0300
Subject: [R] Rename variables starting with digits
In-Reply-To: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
References: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
Message-ID: <CAGgJW756u4DTR9X_bMqa7haZJ=vKPqOy8c0BO_WXvhGj7zqz-Q@mail.gmail.com>

Hi Anne,
It would be helpful to include at least part of behavioral_df for people to
understand the issue better.
Please do the following in R and post the output.

dput( head( behavioral_df) )

Also, set your email to plain text as HTML is stripped from emails on this
list.

Best,
Eric




On Tue, Oct 5, 2021 at 7:15 PM Anne Zach <anne.zach.zach at gmail.com> wrote:

> Dear R users,
>
> I have a dataframe that contains several variables, among which 105
> correspond to scores on certain trials. Unfortunately, when I imported this
> dataframe into R, I realised that the variable names corresponding to each
> trial begin with digits, which violates R naming conventions.
>
> I am trying to relabel these variables by adding a 'v' as a prefix to each
> of them, I'd like to use tidyverse, but I am struggling with this process
> of renaming. When I run this chunk of code, no error occurs but my
> variables are not renamed. I'm fairly new to R and I can't understand what
> I'm doing wrong.
>
> ```{r}
>
> behavioral_df <- behavioral_df %>% rename_with(.fn =  ~paste0("v"),
> starts_with('^\\d'))
>
> ```
>
> I appreciate if you can help.
>
> Best,
> Anne
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct  5 19:11:11 2021
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 5 Oct 2021 13:11:11 -0400
Subject: [R] Rename variables starting with digits
In-Reply-To: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
References: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
Message-ID: <21104a65-5f3d-f7f2-d953-ce644de2f210@gmail.com>

On 04/10/2021 2:02 p.m., Anne Zach wrote:
> Dear R users,
> 
> I have a dataframe that contains several variables, among which 105
> correspond to scores on certain trials. Unfortunately, when I imported this
> dataframe into R, I realised that the variable names corresponding to each
> trial begin with digits, which violates R naming conventions.
> 
> I am trying to relabel these variables by adding a 'v' as a prefix to each
> of them, I'd like to use tidyverse, but I am struggling with this process
> of renaming. When I run this chunk of code, no error occurs but my
> variables are not renamed. I'm fairly new to R and I can't understand what
> I'm doing wrong.
> 
> ```{r}
> 
> behavioral_df <- behavioral_df %>% rename_with(.fn =  ~paste0("v"),
> starts_with('^\\d'))
> 
> ```

You should also consider not renaming the columns.  R allows 
non-standard names to be used as long as you quote them somehow.  For 
example,

   behavioral_df[, "50%"]

will get you the column with name "50%", as will

   behavioral_df$`50%`

I suspect most tidyverse functions will be fine with the `50%` style of 
quoting.

Duncan Murdoch


From bgunter@4567 @end|ng |rom gm@||@com  Tue Oct  5 19:21:38 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Tue, 5 Oct 2021 10:21:38 -0700
Subject: [R] Rename variables starting with digits
In-Reply-To: <21104a65-5f3d-f7f2-d953-ce644de2f210@gmail.com>
References: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
 <21104a65-5f3d-f7f2-d953-ce644de2f210@gmail.com>
Message-ID: <CAGxFJbRWMxBUGS_HUmxYJ+ahqyhp7W6PSGwE9N_73=8a5rXMBg@mail.gmail.com>

... and to add to what Eric and Duncan have said, what you have as column
names depends on how the data were imported. e.g.:

> d1 <-data.frame(a = 1:3, `1b` = letters[1:3]) ## check.names has a
default of TRUE
> names(d1)
[1] "a"   "X1b"   ## note the conversion to a syntactically valid name. See
?data.frame and ?make.names for details

> d2 <-data.frame(a = 1:3, `1b` = letters[1:3], check.names = FALSE)
> names(d2)
[1] "a"  "1b"

So what does names(behavioral_df)  give?

Bert Gunter

"The trouble with having an open mind is that people keep coming along and
sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )


On Tue, Oct 5, 2021 at 10:11 AM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 04/10/2021 2:02 p.m., Anne Zach wrote:
> > Dear R users,
> >
> > I have a dataframe that contains several variables, among which 105
> > correspond to scores on certain trials. Unfortunately, when I imported
> this
> > dataframe into R, I realised that the variable names corresponding to
> each
> > trial begin with digits, which violates R naming conventions.
> >
> > I am trying to relabel these variables by adding a 'v' as a prefix to
> each
> > of them, I'd like to use tidyverse, but I am struggling with this process
> > of renaming. When I run this chunk of code, no error occurs but my
> > variables are not renamed. I'm fairly new to R and I can't understand
> what
> > I'm doing wrong.
> >
> > ```{r}
> >
> > behavioral_df <- behavioral_df %>% rename_with(.fn =  ~paste0("v"),
> > starts_with('^\\d'))
> >
> > ```
>
> You should also consider not renaming the columns.  R allows
> non-standard names to be used as long as you quote them somehow.  For
> example,
>
>    behavioral_df[, "50%"]
>
> will get you the column with name "50%", as will
>
>    behavioral_df$`50%`
>
> I suspect most tidyverse functions will be fine with the `50%` style of
> quoting.
>
> Duncan Murdoch
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From |eo@m@d@ @end|ng |rom @yon|c@eu  Tue Oct  5 20:50:29 2021
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leonard Mada)
Date: Tue, 5 Oct 2021 21:50:29 +0300
Subject: [R] Descriptive Statistics: useful hacks
In-Reply-To: <31e14083-b267-0e06-074f-814f34d15c9e@syonic.eu>
References: <31e14083-b267-0e06-074f-814f34d15c9e@syonic.eu>
Message-ID: <b4dbe674-1547-125a-66db-3159da8f8d46@syonic.eu>

Dear R users,


I wrote in the meantime a new function:

apply.html(html, XPATH, FUN, ...)


This function applies FUN to the nodes selected using XPATH. However, I 
wonder if there is a possibility to use more simple selectors (e.g. 
jQuery). Although I am not an expert with jQuery, it may be easier for 
end users than XPATH.


Package htmltools does not seem to offer support to import a native html 
file, nor do I see any functions using jQuery selectors. I do not seem 
to find any such packages. I would be glad for any hints.


Many thanks,


Leonard

=======

Latest code is on Github:

https://github.com/discoleo/R/blob/master/Stat/Tools.DescriptiveStatistics.R


Notes:

1.) as.html() currently imports only a few types, but it could be easily 
extended to fully generic html;

Note: the export as shiny app may not work with a fully generic html; I 
have not yet explored all the implications!

2.) I am still struggling to understand how to best design the option: 
with.tags = TRUE.

3.) llammas.FUN: Was implemented at great expense and at the last 
minute, but unfortunately is still incomplete and important visual 
styles are missing. Help is welcomed.


On 10/3/2021 1:00 AM, Leonard Mada wrote:
> Dear R Users,
>
>
> I have started to compile some useful hacks for the generation of nice 
> descriptive statistics. I hope that these functions & hacks are useful 
> to the wider R community. I hope that package developers also get some 
> inspiration from the code or from these ideas.
>
>
> I have started to review various packages focused on descriptive 
> statistics - although I am still at the very beginning.
>
>
> ### Hacks / Code
> - split table headers in 2 rows;
> - split results over 2 rows: view.gtsummary(...);
> - add abbreviations as footnotes: add.abbrev(...);
>
> The results are exported as a web page (using shiny) and can be 
> printed as a pdf documented. See the following pdf example:
>
> https://github.com/discoleo/R/blob/master/Stat/Tools.DescriptiveStatistics.Example_1.pdf 
>
>
>
> ### Example
> # currently focused on package gtsummary
> library(gtsummary)
> library(xml2)
>
> mtcars %>%
> ??? # rename2():
> ??? # - see file Tools.Data.R;
> ??? # - behaves in most cases the same as dplyr::rename();
> ??? rename2("HP" = "hp", "Displ" = disp, "Wt (klb)" = "wt", "Rar" = 
> drat) %>%
> ??? # as.factor.df():
> ??? # - see file Tools.Data.R;
> ??? # - encode as (ordered) factor;
> ??? as.factor.df("cyl", "Cyl ") %>%
> ??? # the Descriptive Statistics:
> ??? tbl_summary(by = cyl) %>%
> ??? modify_header(update = header) %>%
> ??? add_p() %>%
> ??? add_overall() %>%
> ??? modify_header(update = header0) %>%
> ??? # Hack: split long statistics !!!
> ??? view.gtsummary(view=FALSE, len=8) %>%
> ??? add.abbrev(
> ??? ??? c("Displ", "HP", "Rar", "Wt (klb)" = "Wt"),
> ??? ??? c("Displacement (in^3)", "Gross horsepower", "Rear axle ratio",
> ??? ??? "Weight (1000 lbs)"));
>
>
> The required functions are on Github:
> https://github.com/discoleo/R/blob/master/Stat/Tools.DescriptiveStatistics.R 
>
>
>
> The functions rename2() & as.factor.df() are only data-helpers and can 
> be found also on Github:
> https://github.com/discoleo/R/blob/master/Stat/Tools.Data.R
>
>
> Note:
>
> 1.) The function add.abbrev() operates on the generated html-code:
>
> - the functionality is more generic and could be used easily with 
> other packages that export web pages as well;
>
> 2.) Split statistics: is an ugly hack. I plan to redesign the 
> functionality using xml-technologies. But I have already too many 
> side-projects.
>
> 3.) as.factor.df(): traditionally, one would create derived data-sets 
> or add a new column with the variable as factor (as the user may need 
> the numeric values for further analysis). But it looked nicer as a 
> single block of code.
>
>
> Sincerely,
>
>
> Leonard
>
>

	[[alternative HTML version deleted]]


From drj|m|emon @end|ng |rom gm@||@com  Wed Oct  6 00:12:13 2021
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Wed, 6 Oct 2021 09:12:13 +1100
Subject: [R] Rename variables starting with digits
In-Reply-To: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
References: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
Message-ID: <CA+8X3fV2DFxug5hr0M=xnKxfFD3y8R2ZUPx68QWa7mKV0Ah-0g@mail.gmail.com>

Hi Anne,
As mentioned above, you may have to do nothing. Here is an example
that might clarify that:

azdat<-read.table(text="subject 1 2 3
1 10 20 30
2 11 22 33",
header=TRUE,stringsAsFactors=FALSE)
azdat
 subject X1 X2 X3
1       1 10 20 30
2       2 11 22 33

As you can see, R simply prepends an "X" to numeric names. If you
really want a "v":

names(azdat)<-gsub("X","v",names(azdat))

Jim
Always happy to help an ANZAC (bad joke)

On Wed, Oct 6, 2021 at 3:15 AM Anne Zach <anne.zach.zach at gmail.com> wrote:
>
> Dear R users,
>
> I have a dataframe that contains several variables, among which 105
> correspond to scores on certain trials. Unfortunately, when I imported this
> dataframe into R, I realised that the variable names corresponding to each
> trial begin with digits, which violates R naming conventions.
>
> I am trying to relabel these variables by adding a 'v' as a prefix to each
> of them, I'd like to use tidyverse, but I am struggling with this process
> of renaming. When I run this chunk of code, no error occurs but my
> variables are not renamed. I'm fairly new to R and I can't understand what
> I'm doing wrong.
>
> ```{r}
>
> behavioral_df <- behavioral_df %>% rename_with(.fn =  ~paste0("v"),
> starts_with('^\\d'))
>
> ```
>
> I appreciate if you can help.
>
> Best,
> Anne
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From thom@@@@ub|@ @end|ng |rom |m|ndu@tr|e@@com  Wed Oct  6 00:20:33 2021
From: thom@@@@ub|@ @end|ng |rom |m|ndu@tr|e@@com (Thomas Subia)
Date: Tue, 5 Oct 2021 22:20:33 +0000
Subject: [R] (no subject)
Message-ID: <MWHPR12MB1790809FDFA7B79A5B019569ECAF9@MWHPR12MB1790.namprd12.prod.outlook.com>

Colleagues,

Some co-workers are wondering about how secure R software is. 
Is there any documentation on this which I can forward to them?


All the best,
Thomas Subia
Quality Engineer


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Oct  6 11:53:03 2021
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 6 Oct 2021 12:53:03 +0300
Subject: [R] (no subject)
In-Reply-To: <MWHPR12MB1790809FDFA7B79A5B019569ECAF9@MWHPR12MB1790.namprd12.prod.outlook.com>
References: <MWHPR12MB1790809FDFA7B79A5B019569ECAF9@MWHPR12MB1790.namprd12.prod.outlook.com>
Message-ID: <20211006125303.2d294a92@Tarkus>

On Tue, 5 Oct 2021 22:20:33 +0000
Thomas Subia <thomas.subia at fmindustries.com> wrote:

> Some co-workers are wondering about how secure R software is.

I'm afraid that this question is too hard to answer without their
threat model. Secure against what, specifically?

> Is there any documentation on this which I can forward to them?

Well, R is a programming language. It's Turing-complete (see halting
problem), will happily run machine code from shared objects (see
dyn.load, .C, .Call), and install.packages() is there to download
third-party code from the Internet. But that's the case with all
programming languages I know that are used for statistics, which aren't
supposed to run untrusted code.

Maybe you're concerned about data input/output instead. Functions are
first-class objects, so it's possible to save and load them from data
files. Not sure if there's a way to run code on data load, but you can
do it on print() (e.g. print.nls(x) calling x$m$getAllPars()), so don't
load()/readRDS() untrusted data files. There are known bugs in the
deserialiser, too: https://bugs.r-project.org/show_bug.cgi?id=16034

Don't know if it's documented anywhere, though. What are your
co-workers concerned about?

-- 
Best regards,
Ivan


From bgunter@4567 @end|ng |rom gm@||@com  Wed Oct  6 15:56:14 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Wed, 6 Oct 2021 06:56:14 -0700
Subject: [R] (no subject)
In-Reply-To: <20211006125303.2d294a92@Tarkus>
References: <MWHPR12MB1790809FDFA7B79A5B019569ECAF9@MWHPR12MB1790.namprd12.prod.outlook.com>
 <20211006125303.2d294a92@Tarkus>
Message-ID: <CAGxFJbQG=MrwZYAHd5XkRCEBq0isrVXRj6FDo44zoNFyPGp5qw@mail.gmail.com>

Perhaps it's R packages and the security policies -- checks for malicious
software, etc. -- of the repositories on which they reside that Thomas
should be concerned with. R, itself, is fine(checksums are provided), but,
as you say, can be programmed to do anything. So R packages can certainly
do damage. For CRAN, at least, I believe it's download at your own risk.
Presumably, virus checking capabilities at the local level could check all
such downloads, as per usual.

Correction and clarification of any of the above welcome of course.

Bert Gunter

"The trouble with having an open mind is that people keep coming along and
sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )


On Wed, Oct 6, 2021 at 2:53 AM Ivan Krylov <krylov.r00t at gmail.com> wrote:

> On Tue, 5 Oct 2021 22:20:33 +0000
> Thomas Subia <thomas.subia at fmindustries.com> wrote:
>
> > Some co-workers are wondering about how secure R software is.
>
> I'm afraid that this question is too hard to answer without their
> threat model. Secure against what, specifically?
>
> > Is there any documentation on this which I can forward to them?
>
> Well, R is a programming language. It's Turing-complete (see halting
> problem), will happily run machine code from shared objects (see
> dyn.load, .C, .Call), and install.packages() is there to download
> third-party code from the Internet. But that's the case with all
> programming languages I know that are used for statistics, which aren't
> supposed to run untrusted code.
>
> Maybe you're concerned about data input/output instead. Functions are
> first-class objects, so it's possible to save and load them from data
> files. Not sure if there's a way to run code on data load, but you can
> do it on print() (e.g. print.nls(x) calling x$m$getAllPars()), so don't
> load()/readRDS() untrusted data files. There are known bugs in the
> deserialiser, too: https://bugs.r-project.org/show_bug.cgi?id=16034
>
> Don't know if it's documented anywhere, though. What are your
> co-workers concerned about?
>
> --
> Best regards,
> Ivan
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From jr@| @end|ng |rom po@teo@no  Wed Oct  6 18:23:15 2021
From: jr@| @end|ng |rom po@teo@no (Rasmus Liland)
Date: Wed,  6 Oct 2021 16:23:15 +0000
Subject: [R] RSQLite slowness
Message-ID: <YV3Nc2Be5rl6EzwD@posteo.no>

Dear r-help readers,

why is it so much slower to query an 
sqlite database using RSQlite ?from the 
outside? using param like 

	statement <-
	 "SELECT * FROM gene2refseq
	  LEFT JOIN gene_info ON
	    gene_info.GeneID = gene2refseq.GeneID
	  WHERE gene2refseq.`RNA_nucleotide_accession.version` 
	    LIKE ?"
	db <- "gene_info.sqlite"
	conn <- DBI::dbConnect(RSQLite::SQLite(), db)
	x1 <- DBI::dbGetQuery(conn=conn, 
	  statement=statement, 
	  param=list(H?kan20210914$RNANucleotideAccession))

compared to querying ?from the inside? 
of sqlite, by writing your search terms 
as a table first, and then calling it 

	statement <- 
	 "SELECT * FROM H
	  LEFT JOIN gene2refseq R ON
	    R.`RNA_nucleotide_accession.version` 
	    LIKE '%' || H.RNANucleotideAccession || '%'
	  LEFT JOIN gene_info I ON I.GeneID = R.GeneID"
	DBI::dbWriteTable(conn, "H", H?kan20210914)
	x2 <- DBI::dbGetQuery(conn=conn, statement=statement)
	DBI::dbDisconnect(conn)

On my system (E5-2603 v4), the first 
query took more than an hour, while the 
second took only a few minutes ...  

Do you guys know of any faster (but also 
nice) way to dig around in very large 
tsv files like 
https://ftp.ncbi.nlm.nih.gov/gene/DATA/gene2refseq.gz 
and 
https://ftp.ncbi.nlm.nih.gov/gene/DATA/gene_info.gz 
?

Best,
Rasmus

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-help/attachments/20211006/671429f1/attachment.sig>

From bgunter@4567 @end|ng |rom gm@||@com  Wed Oct  6 19:22:25 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Wed, 6 Oct 2021 10:22:25 -0700
Subject: [R] RSQLite slowness
In-Reply-To: <YV3Nc2Be5rl6EzwD@posteo.no>
References: <YV3Nc2Be5rl6EzwD@posteo.no>
Message-ID: <CAGxFJbRT6jPfCKvRuys9Z0ScZqvAO-xB7G9_Lk1aG9504SqfBg@mail.gmail.com>

Generally, such gene-related questions are better asked on Bioconductor
than here. They also might know of more efficient, purpose built tools for
your efforts there. No guarantees, of course, and you might get a helpful
response here. But if not ...

Bert Gunter

"The trouble with having an open mind is that people keep coming along and
sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )


On Wed, Oct 6, 2021 at 9:23 AM Rasmus Liland <jral at posteo.no> wrote:

> Dear r-help readers,
>
> why is it so much slower to query an
> sqlite database using RSQlite ?from the
> outside? using param like
>
>         statement <-
>          "SELECT * FROM gene2refseq
>           LEFT JOIN gene_info ON
>             gene_info.GeneID = gene2refseq.GeneID
>           WHERE gene2refseq.`RNA_nucleotide_accession.version`
>             LIKE ?"
>         db <- "gene_info.sqlite"
>         conn <- DBI::dbConnect(RSQLite::SQLite(), db)
>         x1 <- DBI::dbGetQuery(conn=conn,
>           statement=statement,
>           param=list(H?kan20210914$RNANucleotideAccession))
>
> compared to querying ?from the inside?
> of sqlite, by writing your search terms
> as a table first, and then calling it
>
>         statement <-
>          "SELECT * FROM H
>           LEFT JOIN gene2refseq R ON
>             R.`RNA_nucleotide_accession.version`
>             LIKE '%' || H.RNANucleotideAccession || '%'
>           LEFT JOIN gene_info I ON I.GeneID = R.GeneID"
>         DBI::dbWriteTable(conn, "H", H?kan20210914)
>         x2 <- DBI::dbGetQuery(conn=conn, statement=statement)
>         DBI::dbDisconnect(conn)
>
> On my system (E5-2603 v4), the first
> query took more than an hour, while the
> second took only a few minutes ...
>
> Do you guys know of any faster (but also
> nice) way to dig around in very large
> tsv files like
> https://ftp.ncbi.nlm.nih.gov/gene/DATA/gene2refseq.gz
> and
> https://ftp.ncbi.nlm.nih.gov/gene/DATA/gene_info.gz
> ?
>
> Best,
> Rasmus
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From @nne@z@ch@z@ch @end|ng |rom gm@||@com  Wed Oct  6 19:30:49 2021
From: @nne@z@ch@z@ch @end|ng |rom gm@||@com (Anne Zach)
Date: Wed, 6 Oct 2021 10:30:49 -0700
Subject: [R] Rename variables starting with digits
In-Reply-To: <CA+8X3fV2DFxug5hr0M=xnKxfFD3y8R2ZUPx68QWa7mKV0Ah-0g@mail.gmail.com>
References: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
 <CA+8X3fV2DFxug5hr0M=xnKxfFD3y8R2ZUPx68QWa7mKV0Ah-0g@mail.gmail.com>
Message-ID: <CACt1pfo0_XNR+u61_W8_YjSVGAWm+35TxO=rzjXqVat29q=Tgg@mail.gmail.com>

Hello,

Thank you for your help, I really appreciate it, I was able to solve the
problem!

Here is a part of my dataframe (just in case...):

> dput( head( behavioral_df) )

structure(list(ID = c(1, 2, 3, 4, 5, 6), DOB = c("9/53/1959",

"4/8/1953", "2/21/1961", "10/11/1948", "9/4/1962", "8/22/1953"

), startpoint = c(2.33, 2.44, 1.57, 3.1, 2.78, 1.89), endpoint = c(3.5,

4, 2.4, 4.02, 3.98, 2.1), `1_t1_start` = c(1, 1, 1, 1, 1, 1),

    `1_T1` = c(4, 7, 2, 3, 3, 5), `2_T2_start` = c(2.67, 3.3,

    2.45, 2.2, 1.9, 2.6), `2_T2` = c(5, 5, 6, 4, 5, 3), `3_T3_start` =
c(4.76,

    5.1, 3.87, 3.61, 2.83, 3.7), `3_T3` = c(7, 3, 4, 2, 5, 3),

    `4_T4_start` = c(6.09, 6.99, 5.21, 5.19, 5.02, 6.34), `4_T4` = c(4,

    5, 5, 4, 3, 6)), row.names = c(NA, -6L), class = c("tbl_df",
"tbl", "data.frame"))

Also, I checked my options and I have my email set to plain text...

Best,
Anne



On Tue, Oct 5, 2021 at 3:12 PM Jim Lemon <drjimlemon at gmail.com> wrote:

> Hi Anne,
> As mentioned above, you may have to do nothing. Here is an example
> that might clarify that:
>
> azdat<-read.table(text="subject 1 2 3
> 1 10 20 30
> 2 11 22 33",
> header=TRUE,stringsAsFactors=FALSE)
> azdat
>  subject X1 X2 X3
> 1       1 10 20 30
> 2       2 11 22 33
>
> As you can see, R simply prepends an "X" to numeric names. If you
> really want a "v":
>
> names(azdat)<-gsub("X","v",names(azdat))
>
> Jim
> Always happy to help an ANZAC (bad joke)
>
> On Wed, Oct 6, 2021 at 3:15 AM Anne Zach <anne.zach.zach at gmail.com> wrote:
> >
> > Dear R users,
> >
> > I have a dataframe that contains several variables, among which 105
> > correspond to scores on certain trials. Unfortunately, when I imported
> this
> > dataframe into R, I realised that the variable names corresponding to
> each
> > trial begin with digits, which violates R naming conventions.
> >
> > I am trying to relabel these variables by adding a 'v' as a prefix to
> each
> > of them, I'd like to use tidyverse, but I am struggling with this process
> > of renaming. When I run this chunk of code, no error occurs but my
> > variables are not renamed. I'm fairly new to R and I can't understand
> what
> > I'm doing wrong.
> >
> > ```{r}
> >
> > behavioral_df <- behavioral_df %>% rename_with(.fn =  ~paste0("v"),
> > starts_with('^\\d'))
> >
> > ```
> >
> > I appreciate if you can help.
> >
> > Best,
> > Anne
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From toro @end|ng |rom |ett|@c|@com  Wed Oct  6 20:31:51 2021
From: toro @end|ng |rom |ett|@c|@com (Gabriel Toro)
Date: Wed, 6 Oct 2021 18:31:51 +0000
Subject: [R] Strange behavior of 2-d array within function
Message-ID: <DM6PR16MB3529BA05ABE89FCDCA0755D5AAB09@DM6PR16MB3529.namprd16.prod.outlook.com>

Hi,

I have a function, which defines an array of dimensions 5000 by 60, calculates the values within that array and then returns the array on exit.

I get an error: Error in my_simulated[ir, 1:it] : incorrect number of dimensions

For some strange reason, the array is somehow being changed from
       mode "numeric" and attributes $dim=6000 by 50
       to
       mode "list" and attributes NULL

This change occurs at more or less random iterations within a loop (all within the same function call). I am not explicitly manipulating the mode or attributes of the array after it is created.

I would appreciate any suggestions on what may be causing this problem. I have stared at the code for a long time, run the debugger, etc.

Thanks,

Gabriel

	[[alternative HTML version deleted]]


From jr@| @end|ng |rom po@teo@no  Wed Oct  6 20:49:55 2021
From: jr@| @end|ng |rom po@teo@no (Rasmus Liland)
Date: Wed,  6 Oct 2021 18:49:55 +0000
Subject: [R] RSQLite slowness
In-Reply-To: <CAGxFJbRT6jPfCKvRuys9Z0ScZqvAO-xB7G9_Lk1aG9504SqfBg@mail.gmail.com>
References: <YV3Nc2Be5rl6EzwD@posteo.no>
 <CAGxFJbRT6jPfCKvRuys9Z0ScZqvAO-xB7G9_Lk1aG9504SqfBg@mail.gmail.com>
Message-ID: <YV3v0y6SEJdLyrOb@posteo.no>

Thank you Bert, I set up a new thread on 
BioStars [1].  So far, I'm a bit 
unfamilliar with Bioconductor (but will 
hopefully attend a course about it in 
November, which I'm kinda hyped about), 
other than installing and updating R 
packages using BiocManager ....  Did you 
think of something else than 
BioStars.org when saying ?Bioconductor??

The question could be viewed as gene 
related, but I think it is really about 
how can one easier than with sqlite 
handle large tsv files, and why is that 
parser thing so slow ...  I think this 
is more like a core R thing than gene 
related question ...  

[1] https://www.biostars.org/p/9492486/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-help/attachments/20211006/659983b5/attachment.sig>

From mtmorg@n@b|oc @end|ng |rom gm@||@com  Wed Oct  6 21:02:12 2021
From: mtmorg@n@b|oc @end|ng |rom gm@||@com (Martin Morgan)
Date: Wed, 6 Oct 2021 19:02:12 +0000
Subject: [R] RSQLite slowness
In-Reply-To: <YV3v0y6SEJdLyrOb@posteo.no>
References: <YV3Nc2Be5rl6EzwD@posteo.no>
 <CAGxFJbRT6jPfCKvRuys9Z0ScZqvAO-xB7G9_Lk1aG9504SqfBg@mail.gmail.com>
 <YV3v0y6SEJdLyrOb@posteo.no>
Message-ID: <BN8PR04MB6241F386D4924EB76C7A372CF9B09@BN8PR04MB6241.namprd04.prod.outlook.com>

https://support.bioconductor.org and the community slack (sign up at https://bioc-community.herokuapp.com/ ) as well as the general site https://bioconductor.org . Actually your question sounds like a SQLite question ? JOIN a table, versus parameterized query. One could perhaps construct the relevant example at the sqlite command line?

Martin Morgan

On 10/6/21, 2:50 PM, "R-help" <r-help-bounces at r-project.org> wrote:
Thank you Bert, I set up a new thread on
BioStars [1].  So far, I'm a bit
unfamilliar with Bioconductor (but will
hopefully attend a course about it in
November, which I'm kinda hyped about),
other than installing and updating R
packages using BiocManager ....  Did you
think of something else than
BioStars.org when saying ?Bioconductor??

The question could be viewed as gene
related, but I think it is really about
how can one easier than with sqlite
handle large tsv files, and why is that
parser thing so slow ...  I think this
is more like a core R thing than gene
related question ...

[1] https://www.biostars.org/p/9492486/



	[[alternative HTML version deleted]]


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Wed Oct  6 21:11:00 2021
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Wed, 06 Oct 2021 12:11:00 -0700
Subject: [R] RSQLite slowness
In-Reply-To: <YV3v0y6SEJdLyrOb@posteo.no>
References: <YV3Nc2Be5rl6EzwD@posteo.no>
 <CAGxFJbRT6jPfCKvRuys9Z0ScZqvAO-xB7G9_Lk1aG9504SqfBg@mail.gmail.com>
 <YV3v0y6SEJdLyrOb@posteo.no>
Message-ID: <08BBFB7E-00CE-41A0-A4F4-7D4DE07C7757@dcn.davis.ca.us>

Since the sqlite package is contributed, it is NOT related to "core R", and is in fact technically off-topic on this list.

FWIW all SQL implementations work better with indexes, but AFAIK the R data frame support does nothing with indexes. This may be related to your question, or not. I am not a regular sqlite user.

As for fast reading of tsv files, I think arrow, readr, and data.table packages all offer high-performance import functions that could be relevant.

On October 6, 2021 11:49:55 AM PDT, Rasmus Liland <jral at posteo.no> wrote:
>Thank you Bert, I set up a new thread on 
>BioStars [1].  So far, I'm a bit 
>unfamilliar with Bioconductor (but will 
>hopefully attend a course about it in 
>November, which I'm kinda hyped about), 
>other than installing and updating R 
>packages using BiocManager ....  Did you 
>think of something else than 
>BioStars.org when saying ?Bioconductor??
>
>The question could be viewed as gene 
>related, but I think it is really about 
>how can one easier than with sqlite 
>handle large tsv files, and why is that 
>parser thing so slow ...  I think this 
>is more like a core R thing than gene 
>related question ...  
>
>[1] https://www.biostars.org/p/9492486/

-- 
Sent from my phone. Please excuse my brevity.


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Wed Oct  6 21:15:10 2021
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Wed, 06 Oct 2021 12:15:10 -0700
Subject: [R] Rename variables starting with digits
In-Reply-To: <CACt1pfo0_XNR+u61_W8_YjSVGAWm+35TxO=rzjXqVat29q=Tgg@mail.gmail.com>
References: <CACt1pfrz-L8d1GXa2uPKaWjQaB+ar2t0V=X33PafGzR-C3osOw@mail.gmail.com>
 <CA+8X3fV2DFxug5hr0M=xnKxfFD3y8R2ZUPx68QWa7mKV0Ah-0g@mail.gmail.com>
 <CACt1pfo0_XNR+u61_W8_YjSVGAWm+35TxO=rzjXqVat29q=Tgg@mail.gmail.com>
Message-ID: <BB42515D-565D-4D72-A94F-1600C89104CE@dcn.davis.ca.us>

>Also, I checked my options and I have my email set to plain text...

The warning inserted by the mailing list at the bottom of your message below

>	[[alternative HTML version deleted]]

indicates that you may still need to understand your mail client better.

On October 6, 2021 10:30:49 AM PDT, Anne Zach <anne.zach.zach at gmail.com> wrote:
>Hello,
>
>Thank you for your help, I really appreciate it, I was able to solve the
>problem!
>
>Here is a part of my dataframe (just in case...):
>
>> dput( head( behavioral_df) )
>
>structure(list(ID = c(1, 2, 3, 4, 5, 6), DOB = c("9/53/1959",
>
>"4/8/1953", "2/21/1961", "10/11/1948", "9/4/1962", "8/22/1953"
>
>), startpoint = c(2.33, 2.44, 1.57, 3.1, 2.78, 1.89), endpoint = c(3.5,
>
>4, 2.4, 4.02, 3.98, 2.1), `1_t1_start` = c(1, 1, 1, 1, 1, 1),
>
>    `1_T1` = c(4, 7, 2, 3, 3, 5), `2_T2_start` = c(2.67, 3.3,
>
>    2.45, 2.2, 1.9, 2.6), `2_T2` = c(5, 5, 6, 4, 5, 3), `3_T3_start` =
>c(4.76,
>
>    5.1, 3.87, 3.61, 2.83, 3.7), `3_T3` = c(7, 3, 4, 2, 5, 3),
>
>    `4_T4_start` = c(6.09, 6.99, 5.21, 5.19, 5.02, 6.34), `4_T4` = c(4,
>
>    5, 5, 4, 3, 6)), row.names = c(NA, -6L), class = c("tbl_df",
>"tbl", "data.frame"))
>
>Also, I checked my options and I have my email set to plain text...
>
>Best,
>Anne
>
>
>
>On Tue, Oct 5, 2021 at 3:12 PM Jim Lemon <drjimlemon at gmail.com> wrote:
>
>> Hi Anne,
>> As mentioned above, you may have to do nothing. Here is an example
>> that might clarify that:
>>
>> azdat<-read.table(text="subject 1 2 3
>> 1 10 20 30
>> 2 11 22 33",
>> header=TRUE,stringsAsFactors=FALSE)
>> azdat
>>  subject X1 X2 X3
>> 1       1 10 20 30
>> 2       2 11 22 33
>>
>> As you can see, R simply prepends an "X" to numeric names. If you
>> really want a "v":
>>
>> names(azdat)<-gsub("X","v",names(azdat))
>>
>> Jim
>> Always happy to help an ANZAC (bad joke)
>>
>> On Wed, Oct 6, 2021 at 3:15 AM Anne Zach <anne.zach.zach at gmail.com> wrote:
>> >
>> > Dear R users,
>> >
>> > I have a dataframe that contains several variables, among which 105
>> > correspond to scores on certain trials. Unfortunately, when I imported
>> this
>> > dataframe into R, I realised that the variable names corresponding to
>> each
>> > trial begin with digits, which violates R naming conventions.
>> >
>> > I am trying to relabel these variables by adding a 'v' as a prefix to
>> each
>> > of them, I'd like to use tidyverse, but I am struggling with this process
>> > of renaming. When I run this chunk of code, no error occurs but my
>> > variables are not renamed. I'm fairly new to R and I can't understand
>> what
>> > I'm doing wrong.
>> >
>> > ```{r}
>> >
>> > behavioral_df <- behavioral_df %>% rename_with(.fn =  ~paste0("v"),
>> > starts_with('^\\d'))
>> >
>> > ```
>> >
>> > I appreciate if you can help.
>> >
>> > Best,
>> > Anne
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > ______________________________________________
>> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> > https://stat.ethz.ch/mailman/listinfo/r-help
>> > PLEASE do read the posting guide
>> http://www.R-project.org/posting-guide.html
>> > and provide commented, minimal, self-contained, reproducible code.
>>
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From bgunter@4567 @end|ng |rom gm@||@com  Wed Oct  6 21:39:13 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Wed, 6 Oct 2021 12:39:13 -0700
Subject: [R] Strange behavior of 2-d array within function
In-Reply-To: <DM6PR16MB3529BA05ABE89FCDCA0755D5AAB09@DM6PR16MB3529.namprd16.prod.outlook.com>
References: <DM6PR16MB3529BA05ABE89FCDCA0755D5AAB09@DM6PR16MB3529.namprd16.prod.outlook.com>
Message-ID: <CAGxFJbTkBHwPieAuaKtUXE3aDKx9eUCSSGLtb+K7D5_GX4biZw@mail.gmail.com>

Likely impossible to answer without seeing your  code.

Bert Gunter

"The trouble with having an open mind is that people keep coming along and
sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )


On Wed, Oct 6, 2021 at 11:33 AM Gabriel Toro <toro at lettisci.com> wrote:

> Hi,
>
> I have a function, which defines an array of dimensions 5000 by 60,
> calculates the values within that array and then returns the array on exit.
>
> I get an error: Error in my_simulated[ir, 1:it] : incorrect number of
> dimensions
>
> For some strange reason, the array is somehow being changed from
>        mode "numeric" and attributes $dim=6000 by 50
>        to
>        mode "list" and attributes NULL
>
> This change occurs at more or less random iterations within a loop (all
> within the same function call). I am not explicitly manipulating the mode
> or attributes of the array after it is created.
>
> I would appreciate any suggestions on what may be causing this problem. I
> have stared at the code for a long time, run the debugger, etc.
>
> Thanks,
>
> Gabriel
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From petr@p|k@| @end|ng |rom prechez@@cz  Thu Oct  7 10:36:00 2021
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Thu, 7 Oct 2021 08:36:00 +0000
Subject: [R] Strange behavior of 2-d array within function
In-Reply-To: <DM6PR16MB3529BA05ABE89FCDCA0755D5AAB09@DM6PR16MB3529.namprd16.prod.outlook.com>
References: <DM6PR16MB3529BA05ABE89FCDCA0755D5AAB09@DM6PR16MB3529.namprd16.prod.outlook.com>
Message-ID: <ad95dc05551f45e8908eefa60f60754f@SRVEXCHCM1302.precheza.cz>

Hi

I would print/save iteration number to see at what time this occured and
probably traceback() could give you some hint.
Alternatively you could make a function from your code see ?function and use
debug to trace the error.

Without some working example it is impossible to see where is the problem.

Cheers
Petr

> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Gabriel Toro
> Sent: Wednesday, October 6, 2021 8:32 PM
> To: r-help at r-project.org
> Subject: [R] Strange behavior of 2-d array within function
> 
> Hi,
> 
> I have a function, which defines an array of dimensions 5000 by 60,
calculates
> the values within that array and then returns the array on exit.
> 
> I get an error: Error in my_simulated[ir, 1:it] : incorrect number of
dimensions
> 
> For some strange reason, the array is somehow being changed from
>        mode "numeric" and attributes $dim=6000 by 50
>        to
>        mode "list" and attributes NULL
> 
> This change occurs at more or less random iterations within a loop (all
within
> the same function call). I am not explicitly manipulating the mode or
> attributes of the array after it is created.
> 
> I would appreciate any suggestions on what may be causing this problem. I
> have stared at the code for a long time, run the debugger, etc.
> 
> Thanks,
> 
> Gabriel
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-
> guide.html
> and provide commented, minimal, self-contained, reproducible code.

From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct  7 10:58:09 2021
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 7 Oct 2021 11:58:09 +0300
Subject: [R] RSQLite slowness
In-Reply-To: <YV3Nc2Be5rl6EzwD@posteo.no>
References: <YV3Nc2Be5rl6EzwD@posteo.no>
Message-ID: <20211007115809.2e83938e@arachnoid>

On Wed,  6 Oct 2021 16:23:15 +0000
Rasmus Liland <jral at posteo.no> wrote:

> 	 "SELECT * FROM gene2refseq
> 	  LEFT JOIN gene_info ON
> 	    gene_info.GeneID = gene2refseq.GeneID
> 	  WHERE gene2refseq.`RNA_nucleotide_accession.version` 
> 	    LIKE ?"

<...>

> 	x1 <- DBI::dbGetQuery(conn=conn, 
> 	  statement=statement, 
> 	  param=list(H?kan20210914$RNANucleotideAccession))

I think that the problem here is that you pass a vector as a bound
parameter to LIKE, when parameter placeholders usually expect a scalar.
DBI transparently handles this:

>> The elements of the `params` argument do not need to be scalars,
>> vectors of arbitrary length (including length 0) are supported.  For
>> queries, calling dbFetch() binding such parameters returns
>> concatenated results, equivalent to binding and fetching for each
>> set of values and connecting via rbind().

I think this means that DBI runs a SELECT for each value in
H?kan20210914$RNANucleotideAccession, which is understandably slower
than a single query. Unfortunately, it's hard to pass vectors of values
to queries with bound parameters; the SQL engines I know don't have a
syntax for "WHERE param IN (:multi_placeholder:)". SQLite comes with
carray [1], but I don't know whether it's exposed by RSQLite (could be
hard to do in a pointer-safe way), and you're already aware of the
traditional way of doing that: create a temporary table, populate it
and JOIN with the rest of the query.

-- 
Best regards,
Ivan

[1] https://www.sqlite.org/carray.html


From mon|c@p@|@|ovejoy @end|ng |rom gm@||@com  Thu Oct  7 15:44:27 2021
From: mon|c@p@|@|ovejoy @end|ng |rom gm@||@com (Monica Palaseanu-Lovejoy)
Date: Thu, 7 Oct 2021 09:44:27 -0400
Subject: [R] Tidygrraph example not working
Message-ID: <CABnpDg0UJUzF+mCcR5QXr_cj5UgDJuF96UTj-Z75k+jurWakSg@mail.gmail.com>

Hi,

I am trying to learn more about tidygraph, so i am following this blog:
https://www.data-imaginist.com/2017/introducing-tidygraph/

Few months ago the examples in the blog worked very well, but today they do
not.

I just installed R x64 4.1.1, so i should be up and running with the latest
on a Windows machine.

From the blog:

iris_clust <- hclust(dist(iris[1:4]))
iris_tree <- as_tbl_graph(iris_clust)

iris_tree <- iris_tree %>%
    activate(nodes) %>%
    mutate(Species = ifelse(leaf, as.character(iris$Species)[label], NA)) %>%
    activate(edges) %>%
    mutate(to_setose = .N()$Species[to] == 'setosa')
iris_tree#> # A tbl_graph: 299 nodes and 298 edges#> ##> # A rooted
tree#> ##> # Edge Data: 298 x 3 (active)#>    from    to to_setose#>
<int> <int>     <lgl>#> 1     3     1      TRUE#> 2     3     2
TRUE#> 3     7     5      TRUE#> 4     7     6      TRUE#> 5     8
4      TRUE#> 6     8     7        NA#> # ... with 292 more rows#> ##>
# Node Data: 299 x 5#>      height  leaf  label members Species#>
 <dbl> <lgl> <fctr>   <int>   <chr>#> 1 0.0000000  TRUE    108       1
 setosa#> 2 0.0000000  TRUE    131       1  setosa#> 3 0.2645751 FALSE
             2    <NA>#> # ... with 296 more rows
Now from my R session:

library(tidygraph)

Attaching package: ?tidygraph?

The following object is masked from ?package:stats?:

    filter
iris_clust <- hclust(dist(iris[1:4]))
iris_tree <- as_tbl_graph(iris_clust)

iris_tree <- iris_tree %>%
     activate(nodes) %>%
     mutate(Species = ifelse(leaf, as.character(iris$Species)[label], NA)) %>%
     activate(edges) %>%
     mutate(to_setose = .N()$Species[to] == "setosa")
 iris_tree
# A tbl_graph: 299 nodes and 298 edges
#
# A rooted tree
#
# Edge Data: 298 x 3 (active)
   from    to to_setose
  <int> <int> <lgl>
1     3     1 NA
2     3     2 NA
3     7     5 NA
4     7     6 NA
5     8     4 NA
6     8     7 NA
# ... with 292 more rows
#
# Node Data: 299 x 5
  height leaf  label members Species
   <dbl> <lgl> <chr>   <int> <chr>
1  0     TRUE  "108"       1 <NA>
2  0     TRUE  "131"       1 <NA>
3  0.265 FALSE ""          2 <NA>
# ... with 296 more rows

As you see the attributes from the Species column are not added to the
table, and all are NA.

It is not clear to me where i made my mistake. Any help is very much
appreciated.

Thanks,

Monica

	[[alternative HTML version deleted]]


From petr@p|k@| @end|ng |rom prechez@@cz  Thu Oct  7 15:47:33 2021
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Thu, 7 Oct 2021 13:47:33 +0000
Subject: [R] adding results to plot
In-Reply-To: <b354f020-4f18-d696-74d5-43a787996edf@sapo.pt>
References: <0671d8bb61d74f2db55853bf19f32381@SRVEXCHCM1302.precheza.cz>
 <b354f020-4f18-d696-74d5-43a787996edf@sapo.pt>
Message-ID: <9401ae8901ae4cf9adeed4d122374a91@SRVEXCHCM1302.precheza.cz>

Hallo Rui.

I finally tested your function and it seems to me that it should propagate
to the core R or at least to the stats package.

Although it is a bit overkill for my purpose, its use is straightforward and
simple. I checked it for several *test functions and did not find any
problem.

Thanks and best regards.

Petr

> -----Original Message-----
> From: Rui Barradas <ruipbarradas at sapo.pt>
> Sent: Friday, September 17, 2021 9:56 PM
> To: PIKAL Petr <petr.pikal at precheza.cz>; r-help <r-help at r-project.org>
> Subject: Re: [R] adding results to plot
> 
> Hello,
> 
> *.test functions in base R return a list of class "htest", with its own
> print method.
> The method text.htest for objects of class "htest" below is a hack. I
> adapted the formating part of the code of print.htest to plot text().
> I find it maybe too complicated but it seems to work.
> 
> Warning: Not debugged at all.
> 
> 
> 
> text.htest <- function (ht, x, y = NULL, digits = getOption("digits"),
>                          prefix = "", adj = NULL, ...) {
>    out <- list()
>    i_out <- 1L
>    out[[i_out]] <- paste(strwrap(ht$method, prefix = prefix), sep = "\n")
>    i_out <- i_out + 1L
>    out[[i_out]] <- paste0("data:  ", ht$data.name)
> 
>    stat_line <- NULL
>    i_stat_line <- 0L
>    if (!is.null(ht$statistic)) {
>      i_stat_line <- i_stat_line + 1L
>      stat_line[[i_stat_line]] <- paste(names(ht$statistic), "=",
>                                        format(ht$statistic, digits =
> max(1L, digits - 2L)))
>    }
>    if (!is.null(ht$parameter)) {
>      i_stat_line <- i_stat_line + 1L
>      stat_line[[i_stat_line]] <- paste(names(ht$parameter), "=",
>                                        format(ht$parameter, digits =
> max(1L, digits - 2L)))
>    }
>    if (!is.null(ht$p.value)) {
>      fp <- format.pval(ht$p.value, digits = max(1L, digits - 3L))
>      i_stat_line <- i_stat_line + 1L
>      stat_line[[i_stat_line]] <- paste("p-value",
>                                        if (startsWith(fp, "<")) fp else
> paste("=", fp))
>    }
>    if(!is.null(stat_line)){
>      i_out <- i_out + 1L
>      #out[[i_out]] <- strwrap(paste(stat_line, collapse = ", "))
>      out[[i_out]] <- paste(stat_line, collapse = ", ")
>    }
>    if (!is.null(ht$alternative)) {
>      alt <- NULL
>      i_alt <- 1L
>      alt[[i_alt]] <- "alternative hypothesis: "
>      if (!is.null(ht$null.value)) {
>        if (length(ht$null.value) == 1L) {
>          alt.char <- switch(ht$alternative, two.sided = "not equal to",
>                             less = "less than", greater = "greater than")
>          i_alt <- i_alt + 1L
>          alt[[i_alt]] <- paste0("true ", names(ht$null.value), " is ",
> alt.char,
>                                 " ", ht$null.value)
>        }
>        else {
>          i_alt <- i_alt + 1L
>          alt[[i_alt]] <- paste0(ht$alternative, "\nnull values:\n")
>        }
>      }
>      else {
>        i_alt <- i_alt + 1L
>        alt[[i_alt]] <- ht$alternative
>      }
>      i_out <- i_out + 1L
>      out[[i_out]] <- paste(alt, collapse = " ")
>    }
>    if (!is.null(ht$conf.int)) {
>      i_out <- i_out + 1L
>      out[[i_out]] <- paste0(format(100 * attr(ht$conf.int, "conf.level")),
>                             " percent confidence interval:\n", " ",
>                             paste(format(ht$conf.int[1:2], digits =
> digits), collapse = " "))
>    }
>    if (!is.null(ht$estimate)) {
>      i_out <- i_out + 1L
>      out[[i_out]] <- paste("sample estimates:", round(ht$estimate,
> digits = digits), sep = "\n")
>    }
>    i_out <- i_out + 1L
>    out[[i_out]] <- "\n"
>    names(out)[i_out] <- "sep"
>    out <- do.call(paste, out)
>    if(is.null(adj)) adj <- 0L
>    text(x, y, labels = out, adj = adj, ...)
>    invisible(out)
> }
> 
> 
> res <- shapiro.test(rnorm(100))
> plot(1,1, ylim = c(0, length(res) + 1L))
> text(res, 0.6, length(res) - 1)
> res
> 
> res2 <- t.test(rnorm(100))
> plot(1,1, ylim = c(0, length(res2) + 1L))
> text(res2, 0.6, length(res2) - 1L)
> res2
> 
> 
> Hope this helps,
> 
> Rui Barradas
> 
> 
> 
> ?s 15:12 de 16/09/21, PIKAL Petr escreveu:
> > Dear all
> >
> > I know I have seen the answer somewhere but I am not able to find it.
> Please
> > help
> >
> >> plot(1,1)
> >> res <- shapiro.test(rnorm(100))
> >> res
> >
> >          Shapiro-Wilk normality test
> >
> > data:  rnorm(100)
> > W = 0.98861, p-value = 0.5544
> >
> > I would like to add whole res object to the plot.
> >
> > I can do it one by one
> >> text(locator(1), res$method)
> >> text(locator(1), as.character(res$p.value))
> > ...
> > But it is quite inconvenient
> >
> > I could find some way in ggplot world but not in plain plot world.
> >
> > Best regards
> > Petr
> >
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-
> guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> >

From jr@| @end|ng |rom po@teo@no  Thu Oct  7 16:27:40 2021
From: jr@| @end|ng |rom po@teo@no (Rasmus Liland)
Date: Thu,  7 Oct 2021 14:27:40 +0000
Subject: [R] RSQLite slowness
In-Reply-To: <20211007115809.2e83938e@arachnoid>
References: <YV3Nc2Be5rl6EzwD@posteo.no>
 <20211007115809.2e83938e@arachnoid>
Message-ID: <YV8D3Ibp8bDtd3iR@posteo.no>

Dear Ivan,

Thanks for that explaination!  I think 
it explains the slowness clearly.

It is possible to use carray is in Rust 
[1] so it might be available in R in the 
future(?)  I'll look into rusqlite some 
time at least.

sqlite is supposed to be one of the 
fastest sql implementations.  Realm [2] 
might be faster, but I don't know how to 
use it in R so ...  

I thought someone might suggest Redis, 
but I think it is way slower.  

sqlite with indexes and the traditional 
way of doing that by writing in a 
temporary table might just be it ... 

Best,
Rasmus

[1] https://docs.rs/rusqlite/0.24.2/rusqlite/vtab/array/index.html
[2] https://en.wikipedia.org/wiki/Realm_(database)
[3] https://en.wikipedia.org/wiki/Redis

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-help/attachments/20211007/481d4bf3/attachment.sig>

From jr@| @end|ng |rom po@teo@no  Thu Oct  7 16:27:29 2021
From: jr@| @end|ng |rom po@teo@no (Rasmus Liland)
Date: Thu,  7 Oct 2021 14:27:29 +0000
Subject: [R] RSQLite slowness
In-Reply-To: <08BBFB7E-00CE-41A0-A4F4-7D4DE07C7757@dcn.davis.ca.us>
References: <YV3Nc2Be5rl6EzwD@posteo.no>
 <CAGxFJbRT6jPfCKvRuys9Z0ScZqvAO-xB7G9_Lk1aG9504SqfBg@mail.gmail.com>
 <YV3v0y6SEJdLyrOb@posteo.no>
 <08BBFB7E-00CE-41A0-A4F4-7D4DE07C7757@dcn.davis.ca.us>
Message-ID: <YV8D0daIjI1+dYRt@posteo.no>

On 2021-10-06 12:11 -0700, Jeff Newmiller wrote:
> FWIW all SQL implementations work 
> better with indexes

An index seems to be a good way to 
improve sql performance, I'll look into 
it.

Best,
Rasmus

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-help/attachments/20211007/866e206c/attachment.sig>

From kev|n@thorpe @end|ng |rom utoronto@c@  Thu Oct  7 16:56:05 2021
From: kev|n@thorpe @end|ng |rom utoronto@c@ (Kevin Thorpe)
Date: Thu, 7 Oct 2021 14:56:05 +0000
Subject: [R] Unusual Error Loading tidyverse
In-Reply-To: <94303eba-9239-3d62-bf23-d1c19721a6b2@gmail.com>
References: <1BF57FD6-084F-417A-B427-CA605963FD5D@utoronto.ca>
 <8B47DEAA-AE9E-44C5-9F8D-3D73DAD6ADE9@dcn.davis.ca.us>
 <1AE05F6A-672B-4A8C-8F12-90128F95F6DD@utoronto.ca>
 <94303eba-9239-3d62-bf23-d1c19721a6b2@gmail.com>
Message-ID: <851E37B0-DF67-422E-9D27-789F8CAE30CC@utoronto.ca>

I thought I would close the loop on this. It was really weird and I don?t understand everything that went on.

First, it was indeed the case that the main library was not writeable so packages were being installed in a user library.

Here is where it gets confusing to me. Both library paths did appear in .libPaths(). I could not figure out where that was being set since there was no user .Rprofile and Rprofile.site was not modified. To start over I got the user to delete the local library and started R as an administrator and forced installation in the main library with the lib argument. However, even with dependencies=TRUE in install.packages() everything was not getting installed. I then had the user start RStudio as an admin and use the install packages from the menu, again specifying the main library and asking for dependencies. When this was done, many additional packages were then installed that were not installed when running the native R application. Eventually, after that, tidyverse loaded (I realize it is a wrapper to load a bunch of other packages). I also had the user install rms (which we use) and again, various bits did not get installed and had to be manually requested (I don?t remember which ones).

Anyway, in the end we got his system functioning. I realize that running as admin to install packages is probably not best practice, but it was the only way I saw to get things working. I _think_ some of the problems were because his home directory is synced with OneDrive and the user library path was to a OneDrive folder.

I am often shocked by the difficulties students have installing packages. They manage to get errors that I have never seen in all my user of using R. On a Win10 box of my own, I installed R and packages with no difficulties so, naturally am surprised when things go this haywire with an installation.

That?s my story. Hope it was entertaining. :-)

Kevin


> On Sep 24, 2021, at 3:26 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> It is worth checking that the library where things were most recently installed is the first place R looks, i.e. the first entry in .libPaths().  Often R is installed by an administrator, and users can't write to the main library, so when they install packages they go somewhere else.  If "somewhere else" isn't first in .libPaths(), R won't see the new installs.
> 
> Duncan Murdoch
> 
> On 24/09/2021 2:04 p.m., Kevin Thorpe wrote:
>> I did try installing xml2 and it appeared to complete. I will ask him to try again and send me the output.
>>> On Sep 24, 2021, at 1:58 PM, Jeff Newmiller <jdnewmil at dcn.davis.ca.us> wrote:
>>> 
>>> Seems like they should install the xml2 package before proceeding to load whatever (tidyverse).
>>> 
>>> This kind of "dependency missing" problem tends to be a recurring problem particularly on Windows but in general when some deeply-embedded dependency fails to load or is removed in preparation for upgrading.
>>> 
>>> On September 24, 2021 10:40:41 AM PDT, Kevin Thorpe <kevin.thorpe at utoronto.ca> wrote:
>>>> Below is some output from one of my students. I have never seen this error and tried a few things (updating packages for one) but am at a loss to help further. Would appreciate suggestions that I can pass along.
>>>> 
>>>> Here is the error. I tried an install.packages(?xml2?) which appeared to complete but the error persists.
>>>> 
>>>>> library("tidyverse")
>>>> Error: package or namespace load failed for ?tidyverse? in library.dynam(lib, package, package.lib):
>>>> DLL ?xml2? not found: maybe not installed for this architecture?
>>>> 
>>>> Here is the sessionInfo()
>>>> 
>>>>> sessionInfo()
>>>> R version 4.1.1 (2021-08-10)
>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>> Running under: Windows 10 x64 (build 19042)
>>>> 
>>>> Matrix products: default
>>>> 
>>>> locale:
>>>> [1] LC_COLLATE=English_Canada.1252 LC_CTYPE=English_Canada.1252 LC_MONETARY=English_Canada.1252 LC_NUMERIC=C
>>>> [5] LC_TIME=English_Canada.1252
>>>> 
>>>> attached base packages:
>>>> [1] stats graphics grDevices utils datasets methods base
>>>> 
>>>> loaded via a namespace (and not attached):
>>>> [1] Rcpp_1.0.7 cellranger_1.1.0 pillar_1.6.2 compiler_4.1.1 dbplyr_2.1.1 forcats_0.5.1 tools_4.1.1
>>>> [8] jsonlite_1.7.2 lubridate_1.7.10 lifecycle_1.0.0 tibble_3.1.4 gtable_0.3.0 pkgconfig_2.0.3 rlang_0.4.11
>>>> [15] reprex_2.0.1 DBI_1.1.1 haven_2.4.3 withr_2.4.2 dplyr_1.0.7 httr_1.4.2 fs_1.5.0
>>>> [22] generics_0.1.0 vctrs_0.3.8 hms_1.1.0 grid_4.1.1 tidyselect_1.1.1 glue_1.4.2 R6_2.5.1
>>>> [29] fansi_0.5.0 readxl_1.3.1 tzdb_0.1.2 tidyr_1.1.3 ggplot2_3.3.5 purrr_0.3.4 readr_2.0.1
>>>> [36] modelr_0.1.8 magrittr_2.0.1 backports_1.2.1 scales_1.1.1 ellipsis_0.3.2 assertthat_0.2.1 colorspace_2.0-2
>>>> [43] utf8_1.2.2 munsell_0.5.0 broom_0.7.9 crayon_1.4.1
>>>> 
>>> 
>>> -- 
>>> Sent from my phone. Please excuse my brevity.
> 

-- 
Kevin E. Thorpe
Head of Biostatistics,  Applied Health Research Centre (AHRC)
Li Ka Shing Knowledge Institute of St. Michael?s Hospital
Assistant Professor, Dalla Lana School of Public Health
University of Toronto
email: kevin.thorpe at utoronto.ca  Tel: 416.864.5776  Fax: 416.864.3016


From jr@| @end|ng |rom po@teo@no  Thu Oct  7 16:27:19 2021
From: jr@| @end|ng |rom po@teo@no (Rasmus Liland)
Date: Thu,  7 Oct 2021 14:27:19 +0000
Subject: [R] RSQLite slowness
In-Reply-To: <BN8PR04MB6241F386D4924EB76C7A372CF9B09@BN8PR04MB6241.namprd04.prod.outlook.com>
References: <YV3Nc2Be5rl6EzwD@posteo.no>
 <CAGxFJbRT6jPfCKvRuys9Z0ScZqvAO-xB7G9_Lk1aG9504SqfBg@mail.gmail.com>
 <YV3v0y6SEJdLyrOb@posteo.no>
 <BN8PR04MB6241F386D4924EB76C7A372CF9B09@BN8PR04MB6241.namprd04.prod.outlook.com>
Message-ID: <YV8DxwtCEYuBDcbX@posteo.no>

Dear Martin Morgan,

Thanks for all those links!  Yes, my 
question can be characterized like that 
I think, traditional way writing 
a temporary table into the database and 
left JOINing the others vs. 
parameterized query. 

A relevant example would be to first 
create the database from the compressed 
tsv files:

	for i in gene_info gene2refseq; do
	  wget -c https://ftp.ncbi.nlm.nih.gov/gene/DATA/$i.gz
	  gzip -d $i.gz
	  sqlite3 gene_info.sqlite ".mode tabs" ".import $i $i"
	  rm $i; done

then run this R code:

	H <- data.frame(Group = c(1, 1, 2, 2),
	  NM = c("NM_001267695", "NM_001007636",
	         "NM_001003706", "NM_001353612"))
	conn <- DBI::dbConnect(RSQLite::SQLite(), "gene_info.sqlite")
	DBI::dbWriteTable(conn, "H", H, overwrite=T)
	
	statement.1 <-
	 "SELECT * FROM gene2refseq R
	  LEFT JOIN gene_info I ON I.GeneID = R.GeneID
	  WHERE R.`RNA_nucleotide_accession.version`
	    LIKE '%' || ? || '%'"
	time.1 <- proc.time()
	x1 <- DBI::dbGetQuery(
	  conn=conn,
	  statement=statement.1,
	  param=list(H$NM))
	time.1 <- proc.time() - time.1
	
	statement.2 <-
	 "SELECT * FROM H
	  LEFT JOIN gene2refseq R ON
	    R.`RNA_nucleotide_accession.version`
	    LIKE '%' || H.NM || '%'
	  LEFT JOIN gene_info I ON I.GeneID = R.GeneID"
	time.2 <- proc.time()
	x2 <- DBI::dbGetQuery(
	  conn=conn,
	  statement=statement.2)
	time.2 <- proc.time() - time.2
	
	DBI::dbDisconnect(conn)
	
	saveRDS(object=x1, file="ex1_x1.rds", compress="xz")
	saveRDS(object=x2, file="ex1_x2.rds", compress="xz")
	saveRDS(object=list("Time x1"=list(time.1),
	                    "Time x2"=list(time.2)),
	        file="ex1_t.rds", compress="xz")

I got these timings in the ex1_t.rds 
file:

	$`Time x1`
	   user  system elapsed
	571.731 182.006 772.199
	
	$`Time x2`
	   user  system elapsed
	200.068  90.529 295.086

As you can see, statement.1 takes a lot 
longer to process compared to 
statement.2 ...  When I add the rest of 
the 31 search terms, the difference gets 
a lot bigger like I pointed out 
initially, beyond the full hour vs. only 
a few minutes. 

Best,
Rasmus

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-help/attachments/20211007/c25ba4ab/attachment.sig>

From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Thu Oct  7 17:37:17 2021
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Thu, 07 Oct 2021 08:37:17 -0700
Subject: [R] Unusual Error Loading tidyverse
In-Reply-To: <851E37B0-DF67-422E-9D27-789F8CAE30CC@utoronto.ca>
References: <1BF57FD6-084F-417A-B427-CA605963FD5D@utoronto.ca>
 <8B47DEAA-AE9E-44C5-9F8D-3D73DAD6ADE9@dcn.davis.ca.us>
 <1AE05F6A-672B-4A8C-8F12-90128F95F6DD@utoronto.ca>
 <94303eba-9239-3d62-bf23-d1c19721a6b2@gmail.com>
 <851E37B0-DF67-422E-9D27-789F8CAE30CC@utoronto.ca>
Message-ID: <D1F37452-AB58-47F2-90A5-4254DB9D2867@dcn.davis.ca.us>

Sad, more like.

fortunes::fortune(337)

You would have done just as well to delete the user library and let R prompt you to re-create it if things were that bad. Note that the default R configuration always looks first in the user library and only falls back to the system library if the desired package is not found in the user library. In most user-administered R installations you are better off acting as though the system library wasn't there.

On October 7, 2021 7:56:05 AM PDT, Kevin Thorpe <kevin.thorpe at utoronto.ca> wrote:
>I thought I would close the loop on this. It was really weird and I don?t understand everything that went on.
>
>First, it was indeed the case that the main library was not writeable so packages were being installed in a user library.
>
>Here is where it gets confusing to me. Both library paths did appear in .libPaths(). I could not figure out where that was being set since there was no user .Rprofile and Rprofile.site was not modified. To start over I got the user to delete the local library and started R as an administrator and forced installation in the main library with the lib argument. However, even with dependencies=TRUE in install.packages() everything was not getting installed. I then had the user start RStudio as an admin and use the install packages from the menu, again specifying the main library and asking for dependencies. When this was done, many additional packages were then installed that were not installed when running the native R application. Eventually, after that, tidyverse loaded (I realize it is a wrapper to load a bunch of other packages). I also had the user install rms (which we use) and again, various bits did not get installed and had to be manually requested (I don?t remember which ones).
>
>Anyway, in the end we got his system functioning. I realize that running as admin to install packages is probably not best practice, but it was the only way I saw to get things working. I _think_ some of the problems were because his home directory is synced with OneDrive and the user library path was to a OneDrive folder.
>
>I am often shocked by the difficulties students have installing packages. They manage to get errors that I have never seen in all my user of using R. On a Win10 box of my own, I installed R and packages with no difficulties so, naturally am surprised when things go this haywire with an installation.
>
>That?s my story. Hope it was entertaining. :-)
>
>Kevin
>
>
>> On Sep 24, 2021, at 3:26 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> 
>> It is worth checking that the library where things were most recently installed is the first place R looks, i.e. the first entry in .libPaths().  Often R is installed by an administrator, and users can't write to the main library, so when they install packages they go somewhere else.  If "somewhere else" isn't first in .libPaths(), R won't see the new installs.
>> 
>> Duncan Murdoch
>> 
>> On 24/09/2021 2:04 p.m., Kevin Thorpe wrote:
>>> I did try installing xml2 and it appeared to complete. I will ask him to try again and send me the output.
>>>> On Sep 24, 2021, at 1:58 PM, Jeff Newmiller <jdnewmil at dcn.davis.ca.us> wrote:
>>>> 
>>>> Seems like they should install the xml2 package before proceeding to load whatever (tidyverse).
>>>> 
>>>> This kind of "dependency missing" problem tends to be a recurring problem particularly on Windows but in general when some deeply-embedded dependency fails to load or is removed in preparation for upgrading.
>>>> 
>>>> On September 24, 2021 10:40:41 AM PDT, Kevin Thorpe <kevin.thorpe at utoronto.ca> wrote:
>>>>> Below is some output from one of my students. I have never seen this error and tried a few things (updating packages for one) but am at a loss to help further. Would appreciate suggestions that I can pass along.
>>>>> 
>>>>> Here is the error. I tried an install.packages(?xml2?) which appeared to complete but the error persists.
>>>>> 
>>>>>> library("tidyverse")
>>>>> Error: package or namespace load failed for ?tidyverse? in library.dynam(lib, package, package.lib):
>>>>> DLL ?xml2? not found: maybe not installed for this architecture?
>>>>> 
>>>>> Here is the sessionInfo()
>>>>> 
>>>>>> sessionInfo()
>>>>> R version 4.1.1 (2021-08-10)
>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>> Running under: Windows 10 x64 (build 19042)
>>>>> 
>>>>> Matrix products: default
>>>>> 
>>>>> locale:
>>>>> [1] LC_COLLATE=English_Canada.1252 LC_CTYPE=English_Canada.1252 LC_MONETARY=English_Canada.1252 LC_NUMERIC=C
>>>>> [5] LC_TIME=English_Canada.1252
>>>>> 
>>>>> attached base packages:
>>>>> [1] stats graphics grDevices utils datasets methods base
>>>>> 
>>>>> loaded via a namespace (and not attached):
>>>>> [1] Rcpp_1.0.7 cellranger_1.1.0 pillar_1.6.2 compiler_4.1.1 dbplyr_2.1.1 forcats_0.5.1 tools_4.1.1
>>>>> [8] jsonlite_1.7.2 lubridate_1.7.10 lifecycle_1.0.0 tibble_3.1.4 gtable_0.3.0 pkgconfig_2.0.3 rlang_0.4.11
>>>>> [15] reprex_2.0.1 DBI_1.1.1 haven_2.4.3 withr_2.4.2 dplyr_1.0.7 httr_1.4.2 fs_1.5.0
>>>>> [22] generics_0.1.0 vctrs_0.3.8 hms_1.1.0 grid_4.1.1 tidyselect_1.1.1 glue_1.4.2 R6_2.5.1
>>>>> [29] fansi_0.5.0 readxl_1.3.1 tzdb_0.1.2 tidyr_1.1.3 ggplot2_3.3.5 purrr_0.3.4 readr_2.0.1
>>>>> [36] modelr_0.1.8 magrittr_2.0.1 backports_1.2.1 scales_1.1.1 ellipsis_0.3.2 assertthat_0.2.1 colorspace_2.0-2
>>>>> [43] utf8_1.2.2 munsell_0.5.0 broom_0.7.9 crayon_1.4.1
>>>>> 
>>>> 
>>>> -- 
>>>> Sent from my phone. Please excuse my brevity.
>> 
>

-- 
Sent from my phone. Please excuse my brevity.


From kev|n@thorpe @end|ng |rom utoronto@c@  Thu Oct  7 17:49:34 2021
From: kev|n@thorpe @end|ng |rom utoronto@c@ (Kevin Thorpe)
Date: Thu, 7 Oct 2021 15:49:34 +0000
Subject: [R] Unusual Error Loading tidyverse
In-Reply-To: <D1F37452-AB58-47F2-90A5-4254DB9D2867@dcn.davis.ca.us>
References: <1BF57FD6-084F-417A-B427-CA605963FD5D@utoronto.ca>
 <8B47DEAA-AE9E-44C5-9F8D-3D73DAD6ADE9@dcn.davis.ca.us>
 <1AE05F6A-672B-4A8C-8F12-90128F95F6DD@utoronto.ca>
 <94303eba-9239-3d62-bf23-d1c19721a6b2@gmail.com>
 <851E37B0-DF67-422E-9D27-789F8CAE30CC@utoronto.ca>
 <D1F37452-AB58-47F2-90A5-4254DB9D2867@dcn.davis.ca.us>
Message-ID: <5D18BAE5-CD54-4D6A-A5BD-1DEBB6115529@utoronto.ca>

Nice fortune.

In retrospect, maybe it would have worked to re-build the user library. Things were acting so strangely to me I opted for the direct, if more dangerous approach. :-)


> On Oct 7, 2021, at 11:37 AM, Jeff Newmiller <jdnewmil at dcn.davis.ca.us> wrote:
> 
> Sad, more like.
> 
> fortunes::fortune(337)
> 
> You would have done just as well to delete the user library and let R prompt you to re-create it if things were that bad. Note that the default R configuration always looks first in the user library and only falls back to the system library if the desired package is not found in the user library. In most user-administered R installations you are better off acting as though the system library wasn't there.
> 
> On October 7, 2021 7:56:05 AM PDT, Kevin Thorpe <kevin.thorpe at utoronto.ca> wrote:
>> I thought I would close the loop on this. It was really weird and I don?t understand everything that went on.
>> 
>> First, it was indeed the case that the main library was not writeable so packages were being installed in a user library.
>> 
>> Here is where it gets confusing to me. Both library paths did appear in .libPaths(). I could not figure out where that was being set since there was no user .Rprofile and Rprofile.site was not modified. To start over I got the user to delete the local library and started R as an administrator and forced installation in the main library with the lib argument. However, even with dependencies=TRUE in install.packages() everything was not getting installed. I then had the user start RStudio as an admin and use the install packages from the menu, again specifying the main library and asking for dependencies. When this was done, many additional packages were then installed that were not installed when running the native R application. Eventually, after that, tidyverse loaded (I realize it is a wrapper to load a bunch of other packages). I also had the user install rms (which we use) and again, various bits did not get installed and had to be manually requested (I don?t remember which ones).
>> 
>> Anyway, in the end we got his system functioning. I realize that running as admin to install packages is probably not best practice, but it was the only way I saw to get things working. I _think_ some of the problems were because his home directory is synced with OneDrive and the user library path was to a OneDrive folder.
>> 
>> I am often shocked by the difficulties students have installing packages. They manage to get errors that I have never seen in all my user of using R. On a Win10 box of my own, I installed R and packages with no difficulties so, naturally am surprised when things go this haywire with an installation.
>> 
>> That?s my story. Hope it was entertaining. :-)
>> 
>> Kevin
>> 
>> 
>>> On Sep 24, 2021, at 3:26 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>> 
>>> It is worth checking that the library where things were most recently installed is the first place R looks, i.e. the first entry in .libPaths().  Often R is installed by an administrator, and users can't write to the main library, so when they install packages they go somewhere else.  If "somewhere else" isn't first in .libPaths(), R won't see the new installs.
>>> 
>>> Duncan Murdoch
>>> 
>>> On 24/09/2021 2:04 p.m., Kevin Thorpe wrote:
>>>> I did try installing xml2 and it appeared to complete. I will ask him to try again and send me the output.
>>>>> On Sep 24, 2021, at 1:58 PM, Jeff Newmiller <jdnewmil at dcn.davis.ca.us> wrote:
>>>>> 
>>>>> Seems like they should install the xml2 package before proceeding to load whatever (tidyverse).
>>>>> 
>>>>> This kind of "dependency missing" problem tends to be a recurring problem particularly on Windows but in general when some deeply-embedded dependency fails to load or is removed in preparation for upgrading.
>>>>> 
>>>>> On September 24, 2021 10:40:41 AM PDT, Kevin Thorpe <kevin.thorpe at utoronto.ca> wrote:
>>>>>> Below is some output from one of my students. I have never seen this error and tried a few things (updating packages for one) but am at a loss to help further. Would appreciate suggestions that I can pass along.
>>>>>> 
>>>>>> Here is the error. I tried an install.packages(?xml2?) which appeared to complete but the error persists.
>>>>>> 
>>>>>>> library("tidyverse")
>>>>>> Error: package or namespace load failed for ?tidyverse? in library.dynam(lib, package, package.lib):
>>>>>> DLL ?xml2? not found: maybe not installed for this architecture?
>>>>>> 
>>>>>> Here is the sessionInfo()
>>>>>> 
>>>>>>> sessionInfo()
>>>>>> R version 4.1.1 (2021-08-10)
>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>> Running under: Windows 10 x64 (build 19042)
>>>>>> 
>>>>>> Matrix products: default
>>>>>> 
>>>>>> locale:
>>>>>> [1] LC_COLLATE=English_Canada.1252 LC_CTYPE=English_Canada.1252 LC_MONETARY=English_Canada.1252 LC_NUMERIC=C
>>>>>> [5] LC_TIME=English_Canada.1252
>>>>>> 
>>>>>> attached base packages:
>>>>>> [1] stats graphics grDevices utils datasets methods base
>>>>>> 
>>>>>> loaded via a namespace (and not attached):
>>>>>> [1] Rcpp_1.0.7 cellranger_1.1.0 pillar_1.6.2 compiler_4.1.1 dbplyr_2.1.1 forcats_0.5.1 tools_4.1.1
>>>>>> [8] jsonlite_1.7.2 lubridate_1.7.10 lifecycle_1.0.0 tibble_3.1.4 gtable_0.3.0 pkgconfig_2.0.3 rlang_0.4.11
>>>>>> [15] reprex_2.0.1 DBI_1.1.1 haven_2.4.3 withr_2.4.2 dplyr_1.0.7 httr_1.4.2 fs_1.5.0
>>>>>> [22] generics_0.1.0 vctrs_0.3.8 hms_1.1.0 grid_4.1.1 tidyselect_1.1.1 glue_1.4.2 R6_2.5.1
>>>>>> [29] fansi_0.5.0 readxl_1.3.1 tzdb_0.1.2 tidyr_1.1.3 ggplot2_3.3.5 purrr_0.3.4 readr_2.0.1
>>>>>> [36] modelr_0.1.8 magrittr_2.0.1 backports_1.2.1 scales_1.1.1 ellipsis_0.3.2 assertthat_0.2.1 colorspace_2.0-2
>>>>>> [43] utf8_1.2.2 munsell_0.5.0 broom_0.7.9 crayon_1.4.1
>>>>>> 
>>>>> 
>>>>> -- 
>>>>> Sent from my phone. Please excuse my brevity.
>>> 
>> 
> 
> -- 
> Sent from my phone. Please excuse my brevity.

-- 
Kevin E. Thorpe
Head of Biostatistics,  Applied Health Research Centre (AHRC)
Li Ka Shing Knowledge Institute of St. Michael?s Hospital
Assistant Professor, Dalla Lana School of Public Health
University of Toronto
email: kevin.thorpe at utoronto.ca  Tel: 416.864.5776  Fax: 416.864.3016


From M|ke@Conk||n @end|ng |rom g|k@com  Thu Oct  7 17:57:30 2021
From: M|ke@Conk||n @end|ng |rom g|k@com (Conklin, Mike (GfK))
Date: Thu, 7 Oct 2021 15:57:30 +0000
Subject: [R] Unusual Error Loading tidyverse
In-Reply-To: <5D18BAE5-CD54-4D6A-A5BD-1DEBB6115529@utoronto.ca>
References: <1BF57FD6-084F-417A-B427-CA605963FD5D@utoronto.ca>
 <8B47DEAA-AE9E-44C5-9F8D-3D73DAD6ADE9@dcn.davis.ca.us>
 <1AE05F6A-672B-4A8C-8F12-90128F95F6DD@utoronto.ca>
 <94303eba-9239-3d62-bf23-d1c19721a6b2@gmail.com>
 <851E37B0-DF67-422E-9D27-789F8CAE30CC@utoronto.ca>
 <D1F37452-AB58-47F2-90A5-4254DB9D2867@dcn.davis.ca.us>
 <5D18BAE5-CD54-4D6A-A5BD-1DEBB6115529@utoronto.ca>
Message-ID: <CWXP123MB4952B029921E0FFBB7AF9FB399B19@CWXP123MB4952.GBRP123.PROD.OUTLOOK.COM>

My experience is that the combination of OneDrive and R leads to lack of productivity.

--
W. Michael Conklin
EVP Marketing & Data Sciences
GfK 
M +1 612 567 8287

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Kevin Thorpe
Sent: Thursday, October 7, 2021 10:50 AM
To: Jeff Newmiller <jdnewmil at dcn.davis.ca.us>
Cc: R Help Mailing List <r-help at r-project.org>
Subject: Re: [R] Unusual Error Loading tidyverse



Nice fortune.

In retrospect, maybe it would have worked to re-build the user library. Things were acting so strangely to me I opted for the direct, if more dangerous approach. :-)


> On Oct 7, 2021, at 11:37 AM, Jeff Newmiller <jdnewmil at dcn.davis.ca.us> wrote:
>
> Sad, more like.
>
> fortunes::fortune(337)
>
> You would have done just as well to delete the user library and let R prompt you to re-create it if things were that bad. Note that the default R configuration always looks first in the user library and only falls back to the system library if the desired package is not found in the user library. In most user-administered R installations you are better off acting as though the system library wasn't there.
>
> On October 7, 2021 7:56:05 AM PDT, Kevin Thorpe <kevin.thorpe at utoronto.ca> wrote:
>> I thought I would close the loop on this. It was really weird and I don?t understand everything that went on.
>>
>> First, it was indeed the case that the main library was not writeable so packages were being installed in a user library.
>>
>> Here is where it gets confusing to me. Both library paths did appear in .libPaths(). I could not figure out where that was being set since there was no user .Rprofile and Rprofile.site was not modified. To start over I got the user to delete the local library and started R as an administrator and forced installation in the main library with the lib argument. However, even with dependencies=TRUE in install.packages() everything was not getting installed. I then had the user start RStudio as an admin and use the install packages from the menu, again specifying the main library and asking for dependencies. When this was done, many additional packages were then installed that were not installed when running the native R application. Eventually, after that, tidyverse loaded (I realize it is a wrapper to load a bunch of other packages). I also had the user install rms (which we use) and again, various bits did not get installed and had to be manually requested (I don?t remember which ones).
>>
>> Anyway, in the end we got his system functioning. I realize that running as admin to install packages is probably not best practice, but it was the only way I saw to get things working. I _think_ some of the problems were because his home directory is synced with OneDrive and the user library path was to a OneDrive folder.
>>
>> I am often shocked by the difficulties students have installing packages. They manage to get errors that I have never seen in all my user of using R. On a Win10 box of my own, I installed R and packages with no difficulties so, naturally am surprised when things go this haywire with an installation.
>>
>> That?s my story. Hope it was entertaining. :-)
>>
>> Kevin
>>
>>
>>> On Sep 24, 2021, at 3:26 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>
>>> It is worth checking that the library where things were most recently installed is the first place R looks, i.e. the first entry in .libPaths().  Often R is installed by an administrator, and users can't write to the main library, so when they install packages they go somewhere else.  If "somewhere else" isn't first in .libPaths(), R won't see the new installs.
>>>
>>> Duncan Murdoch
>>>
>>> On 24/09/2021 2:04 p.m., Kevin Thorpe wrote:
>>>> I did try installing xml2 and it appeared to complete. I will ask him to try again and send me the output.
>>>>> On Sep 24, 2021, at 1:58 PM, Jeff Newmiller <jdnewmil at dcn.davis.ca.us> wrote:
>>>>>
>>>>> Seems like they should install the xml2 package before proceeding to load whatever (tidyverse).
>>>>>
>>>>> This kind of "dependency missing" problem tends to be a recurring problem particularly on Windows but in general when some deeply-embedded dependency fails to load or is removed in preparation for upgrading.
>>>>>
>>>>> On September 24, 2021 10:40:41 AM PDT, Kevin Thorpe <kevin.thorpe at utoronto.ca> wrote:
>>>>>> Below is some output from one of my students. I have never seen this error and tried a few things (updating packages for one) but am at a loss to help further. Would appreciate suggestions that I can pass along.
>>>>>>
>>>>>> Here is the error. I tried an install.packages(?xml2?) which appeared to complete but the error persists.
>>>>>>
>>>>>>> library("tidyverse")
>>>>>> Error: package or namespace load failed for ?tidyverse? in library.dynam(lib, package, package.lib):
>>>>>> DLL ?xml2? not found: maybe not installed for this architecture?
>>>>>>
>>>>>> Here is the sessionInfo()
>>>>>>
>>>>>>> sessionInfo()
>>>>>> R version 4.1.1 (2021-08-10)
>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit) Running under: Windows 
>>>>>> 10 x64 (build 19042)
>>>>>>
>>>>>> Matrix products: default
>>>>>>
>>>>>> locale:
>>>>>> [1] LC_COLLATE=English_Canada.1252 LC_CTYPE=English_Canada.1252 
>>>>>> LC_MONETARY=English_Canada.1252 LC_NUMERIC=C [5] 
>>>>>> LC_TIME=English_Canada.1252
>>>>>>
>>>>>> attached base packages:
>>>>>> [1] stats graphics grDevices utils datasets methods base
>>>>>>
>>>>>> loaded via a namespace (and not attached):
>>>>>> [1] Rcpp_1.0.7 cellranger_1.1.0 pillar_1.6.2 compiler_4.1.1 
>>>>>> dbplyr_2.1.1 forcats_0.5.1 tools_4.1.1 [8] jsonlite_1.7.2 
>>>>>> lubridate_1.7.10 lifecycle_1.0.0 tibble_3.1.4 gtable_0.3.0 
>>>>>> pkgconfig_2.0.3 rlang_0.4.11 [15] reprex_2.0.1 DBI_1.1.1 
>>>>>> haven_2.4.3 withr_2.4.2 dplyr_1.0.7 httr_1.4.2 fs_1.5.0 [22] 
>>>>>> generics_0.1.0 vctrs_0.3.8 hms_1.1.0 grid_4.1.1 tidyselect_1.1.1 
>>>>>> glue_1.4.2 R6_2.5.1 [29] fansi_0.5.0 readxl_1.3.1 tzdb_0.1.2 
>>>>>> tidyr_1.1.3 ggplot2_3.3.5 purrr_0.3.4 readr_2.0.1 [36] 
>>>>>> modelr_0.1.8 magrittr_2.0.1 backports_1.2.1 scales_1.1.1 
>>>>>> ellipsis_0.3.2 assertthat_0.2.1 colorspace_2.0-2 [43] utf8_1.2.2 
>>>>>> munsell_0.5.0 broom_0.7.9 crayon_1.4.1
>>>>>>
>>>>>
>>>>> --
>>>>> Sent from my phone. Please excuse my brevity.
>>>
>>
>
> --
> Sent from my phone. Please excuse my brevity.

--
Kevin E. Thorpe
Head of Biostatistics,  Applied Health Research Centre (AHRC) Li Ka Shing Knowledge Institute of St. Michael?s Hospital Assistant Professor, Dalla Lana School of Public Health University of Toronto
email: kevin.thorpe at utoronto.ca  Tel: 416.864.5776  Fax: 416.864.3016

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see https://stat.ethz.ch/mailman/listinfo/r-help
PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
and provide commented, minimal, self-contained, reproducible code.


From |eo@m@d@ @end|ng |rom @yon|c@eu  Thu Oct  7 18:30:24 2021
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leonard Mada)
Date: Thu, 7 Oct 2021 19:30:24 +0300
Subject: [R] Extracting Comments from Functions/Packages
Message-ID: <6b279d84-f7e8-8bdd-b70e-f3d08b3d0c5c@syonic.eu>

Dear R Users,


I wrote a minimal parser to extract strings and comments from the 
function definitions.


The string extraction works fine. But there are no comments:

a.) Are the comments stripped from the compiled packages?

b.) Alternatively: Is the deparse() not suited for this task?

b.2.) Is deparse() parsing the function/expression itself?

[see code for extract.str.fun() function below]


### All strings in "base"
extract.str.pkg("base")
# type = 2 for Comments:
extract.str.pkg("base", type=2)
extract.str.pkg("sp", type=2)
extract.str.pkg("NetLogoR", type=2)

The code for the 2 functions (extract.str.pkg & extract.str.fun) and the 
code for the parse.simple() parser are below.


Sincerely,


Leonard

=======

The latest code is on GitHub:

https://github.com/discoleo/R/blob/master/Stat/Tools.Formulas.R


### Code to process functions in packages:
extract.str.fun = function(fn, pkg, type=1, strip=TRUE) {
 ??? fn = as.symbol(fn); pkg = as.symbol(pkg);
 ??? fn = list(substitute(pkg ::: fn));
 ??? # deparse
 ??? s = paste0(do.call(deparse, fn), collapse="");
 ??? npos = parse.simple(s);
 ??? extract.str(s, npos[[type]], strip=strip)
}
extract.str.pkg = function(pkg, type=1, exclude.z = TRUE, strip=TRUE) {
 ??? nms = ls(getNamespace(pkg));
 ??? l = lapply(nms, function(fn) extract.str.fun(fn, pkg, type=type, 
strip=strip));
 ??? if(exclude.z) {
 ??? ??? hasStr = sapply(l, function(s) length(s) >= 1);
 ??? ??? nms = nms[hasStr];
 ??? ??? l = l[hasStr];
 ??? }
 ??? names(l) = nms;
 ??? return(l);
}

### minimal Parser:
# - proof of concept;
# - may be useful to process non-conformant R "code", e.g.:
#?? "{\"abc\" + \"bcd\"} {FUN}"; (still TODO)
# Warning:
# - not thoroughly checked &
#?? may be a little buggy!

parse.simple = function(x, eol="\n") {
 ??? len = nchar(x);
 ??? n.comm = list(integer(0), integer(0));
 ??? n.str? = list(integer(0), integer(0));
 ??? is.hex = function(ch) {
 ??? ??? # Note: only for 1 character!
 ??? ??? return((ch >= "0" && ch <= "9") ||
 ??? ??? ??? (ch >= "A" && ch <= "F") ||
 ??? ??? ??? (ch >= "a" && ch <= "f"));
 ??? }
 ??? npos = 1;
 ??? while(npos <= len) {
 ??? ??? s = substr(x, npos, npos);
 ??? ??? # State: COMMENT
 ??? ??? if(s == "#") {
 ??? ??? ??? n.comm[[1]] = c(n.comm[[1]], npos);
 ??? ??? ??? while(npos < len) {
 ??? ??? ??? ??? npos = npos + 1;
 ??? ??? ??? ??? if(substr(x, npos, npos) == eol) break;
 ??? ??? ??? }
 ??? ??? ??? n.comm[[2]] = c(n.comm[[2]], npos);
 ??? ??? ??? npos = npos + 1; next;
 ??? ??? }
 ??? ??? # State: STRING
 ??? ??? if(s == "\"" || s == "'") {
 ??? ??? ??? n.str[[1]] = c(n.str[[1]], npos);
 ??? ??? ??? while(npos < len) {
 ??? ??? ??? ??? npos = npos + 1;
 ??? ??? ??? ??? se = substr(x, npos, npos);
 ??? ??? ??? ??? if(se == "\\") {
 ??? ??? ??? ??? ??? npos = npos + 1;
 ??? ??? ??? ??? ??? # simple escape vs Unicode:
 ??? ??? ??? ??? ??? if(substr(x, npos, npos) != "u") next;
 ??? ??? ??? ??? ??? len.end = min(len, npos + 4);
 ??? ??? ??? ??? ??? npos = npos + 1;
 ??? ??? ??? ??? ??? isAllHex = TRUE;
 ??? ??? ??? ??? ??? while(npos <= len.end) {
 ??? ??? ??? ??? ??? ??? se = substr(x, npos, npos);
 ??? ??? ??? ??? ??? ??? if( ! is.hex(se)) { isAllHex = FALSE; break; }
 ??? ??? ??? ??? ??? ??? npos = npos + 1;
 ??? ??? ??? ??? ??? }
 ??? ??? ??? ??? ??? if(isAllHex) next;
 ??? ??? ??? ??? }
 ??? ??? ??? ??? if(se == s) break;
 ??? ??? ??? }
 ??? ??? ??? n.str[[2]] = c(n.str[[2]], npos);
 ??? ??? ??? npos = npos + 1; next;
 ??? ??? }
 ??? ??? npos = npos + 1;
 ??? }
 ??? return(list(str = n.str, comm = n.comm));
}


extract.str = function(s, npos, strip=FALSE) {
 ??? if(length(npos[[1]]) == 0) return(character(0));
 ??? strip.FUN = if(strip) {
 ??? ??? ??? function(id) {
 ??? ??? ??? ??? if(npos[[1]][[id]] + 1 < npos[[2]][[id]]) {
 ??? ??? ??? ??? ??? nStart = npos[[1]][[id]] + 1;
 ??? ??? ??? ??? ??? nEnd = npos[[2]][[id]] - 1; # TODO: Error with 
malformed string
 ??? ??? ??? ??? ??? return(substr(s, nStart, nEnd));
 ??? ??? ??? ??? } else {
 ??? ??? ??? ??? ??? return("");
 ??? ??? ??? ??? }
 ??? ??? ??? }
 ??? ??? } else function(id) substr(s, npos[[1]][[id]], npos[[2]][[id]]);
 ??? sapply(seq(length(npos[[1]])), strip.FUN);
}


From r@v|@v@r@dh@n @end|ng |rom jhu@edu  Thu Oct  7 18:29:04 2021
From: r@v|@v@r@dh@n @end|ng |rom jhu@edu (Ravi Varadhan)
Date: Thu, 7 Oct 2021 16:29:04 +0000
Subject: [R] How to use ifelse without invoking warnings
Message-ID: <MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>

Hi,
I would like to execute the following vectorized calculation:

  ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE), ifelse (k < -1, 0, 1) )

For example:


> k <- c(-1.2,-0.5, 1.5, 10.4)
> n <- 10
> ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) )
Warning message:
In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
> print(ans)
[1] 0.000000000 0.006821826 0.254991551 1.000000000

The answer is correct.  However, I would like to eliminate the annoying warnings.  Is there a better way to do this?

Thank you,
Ravi


	[[alternative HTML version deleted]]


From bgunter@4567 @end|ng |rom gm@||@com  Thu Oct  7 19:34:17 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Thu, 7 Oct 2021 10:34:17 -0700
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
References: <MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
Message-ID: <CAGxFJbRE1GoX=JHFUxBDDmho47ENsceYbgxxwn6J49Xab_CWaQ@mail.gmail.com>

?suppressWarnings

> p <- .05
> k <- c(-1.2,-0.5, 1.5, 10.4)
> n <- 10
>
> ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE),
ifelse (k < -1, 0, 1) )
Warning message:
In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
>
> suppressWarnings(ans <- ifelse (k >= -1 & k <= n,
pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) ))
## no warnings

Bert Gunter

"The trouble with having an open mind is that people keep coming along and
sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )


On Thu, Oct 7, 2021 at 10:21 AM Ravi Varadhan via R-help <
r-help at r-project.org> wrote:

> Hi,
> I would like to execute the following vectorized calculation:
>
>   ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE),
> ifelse (k < -1, 0, 1) )
>
> For example:
>
>
> > k <- c(-1.2,-0.5, 1.5, 10.4)
> > n <- 10
> > ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE),
> ifelse (k < -1, 0, 1) )
> Warning message:
> In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
> > print(ans)
> [1] 0.000000000 0.006821826 0.254991551 1.000000000
>
> The answer is correct.  However, I would like to eliminate the annoying
> warnings.  Is there a better way to do this?
>
> Thank you,
> Ravi
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From @@r@h@go@|ee @end|ng |rom gm@||@com  Thu Oct  7 19:34:35 2021
From: @@r@h@go@|ee @end|ng |rom gm@||@com (Sarah Goslee)
Date: Thu, 7 Oct 2021 13:34:35 -0400
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
References: <MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
Message-ID: <CAM_vjukuPfMZmQQ2X5+0FicRLr8k3cCa_+Ao-8LPxCoRgvFHcw@mail.gmail.com>

If you are positive the warnings don't matter for your application,
you can disable them: see ?options for details of warn.

But that can be dangerous, so be careful!

Sarah

On Thu, Oct 7, 2021 at 1:21 PM Ravi Varadhan via R-help
<r-help at r-project.org> wrote:
>
> Hi,
> I would like to execute the following vectorized calculation:
>
>   ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE), ifelse (k < -1, 0, 1) )
>
> For example:
>
>
> > k <- c(-1.2,-0.5, 1.5, 10.4)
> > n <- 10
> > ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) )
> Warning message:
> In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
> > print(ans)
> [1] 0.000000000 0.006821826 0.254991551 1.000000000
>
> The answer is correct.  However, I would like to eliminate the annoying warnings.  Is there a better way to do this?
>
> Thank you,
> Ravi
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



-- 
Sarah Goslee (she/her)
http://www.sarahgoslee.com


From @@r@h@go@|ee @end|ng |rom gm@||@com  Thu Oct  7 19:38:34 2021
From: @@r@h@go@|ee @end|ng |rom gm@||@com (Sarah Goslee)
Date: Thu, 7 Oct 2021 13:38:34 -0400
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <CAGxFJbRE1GoX=JHFUxBDDmho47ENsceYbgxxwn6J49Xab_CWaQ@mail.gmail.com>
References: <MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
 <CAGxFJbRE1GoX=JHFUxBDDmho47ENsceYbgxxwn6J49Xab_CWaQ@mail.gmail.com>
Message-ID: <CAM_vju=7uB98YDWq9Gm9=F=MUWp7nW8=OQOJ5_C50CG2Y5W=wQ@mail.gmail.com>

Bert's approach is much less risky!

On Thu, Oct 7, 2021 at 1:37 PM Bert Gunter <bgunter.4567 at gmail.com> wrote:
>
> ?suppressWarnings
>
> > p <- .05
> > k <- c(-1.2,-0.5, 1.5, 10.4)
> > n <- 10
> >
> > ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE),
> ifelse (k < -1, 0, 1) )
> Warning message:
> In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
> >
> > suppressWarnings(ans <- ifelse (k >= -1 & k <= n,
> pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) ))
> ## no warnings
>
> Bert Gunter
>
> "The trouble with having an open mind is that people keep coming along and
> sticking things into it."
> -- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )
>
>
> On Thu, Oct 7, 2021 at 10:21 AM Ravi Varadhan via R-help <
> r-help at r-project.org> wrote:
>
> > Hi,
> > I would like to execute the following vectorized calculation:
> >
> >   ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE),
> > ifelse (k < -1, 0, 1) )
> >
> > For example:
> >
> >
> > > k <- c(-1.2,-0.5, 1.5, 10.4)
> > > n <- 10
> > > ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE),
> > ifelse (k < -1, 0, 1) )
> > Warning message:
> > In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
> > > print(ans)
> > [1] 0.000000000 0.006821826 0.254991551 1.000000000
> >
> > The answer is correct.  However, I would like to eliminate the annoying
> > warnings.  Is there a better way to do this?
> >
> > Thank you,
> > Ravi
> >
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> > http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.



-- 
Sarah Goslee (she/her)
http://www.sarahgoslee.com


From j|ox @end|ng |rom mcm@@ter@c@  Thu Oct  7 20:00:51 2021
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Thu, 7 Oct 2021 14:00:51 -0400
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <8197_1633627307_197HLkf0027632_MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
References: <8197_1633627307_197HLkf0027632_MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
Message-ID: <6203fea2-3235-531d-891f-01a0ac23bef7@mcmaster.ca>

Dear Ravi,

It's already been suggested that you could disable warnings, but that's 
risky in case there's a warning that you didn't anticipate. Here's a 
different approach:

 > kk <- k[k >= -1 & k <= n]
 > ans <- numeric(length(k))
 > ans[k > n] <- 1
 > ans[k >= -1 & k <= n] <- pbeta(p, kk + 1, n - kk, lower.tail=FALSE)
 > ans
[1] 0.000000000 0.006821826 0.254991551 1.000000000

BTW, I don't think that you mentioned that p = 0.3, but that seems 
apparent from the output you showed.

I hope this helps,
  John

-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/

On 2021-10-07 12:29 p.m., Ravi Varadhan via R-help wrote:
> Hi,
> I would like to execute the following vectorized calculation:
> 
>    ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE), ifelse (k < -1, 0, 1) )
> 
> For example:
> 
> 
>> k <- c(-1.2,-0.5, 1.5, 10.4)
>> n <- 10
>> ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) )
> Warning message:
> In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
>> print(ans)
> [1] 0.000000000 0.006821826 0.254991551 1.000000000
> 
> The answer is correct.  However, I would like to eliminate the annoying warnings.  Is there a better way to do this?
> 
> Thank you,
> Ravi
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>


From e@ @end|ng |rom enr|co@chum@nn@net  Thu Oct  7 21:26:47 2021
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Thu, 07 Oct 2021 21:26:47 +0200
Subject: [R] Extracting Comments from Functions/Packages
In-Reply-To: <6b279d84-f7e8-8bdd-b70e-f3d08b3d0c5c@syonic.eu> (Leonard Mada
 via's message of "Thu, 7 Oct 2021 19:30:24 +0300")
References: <6b279d84-f7e8-8bdd-b70e-f3d08b3d0c5c@syonic.eu>
Message-ID: <87k0iofxfs.fsf@enricoschumann.net>

On Thu, 07 Oct 2021, Leonard Mada via R-help writes:

> Dear R Users,
>
>
> I wrote a minimal parser to extract strings and
> comments from the function definitions.
>
>
> The string extraction works fine. But there are no comments:
>
> a.) Are the comments stripped from the compiled packages?
>
> b.) Alternatively: Is the deparse() not suited for this task?
>
> b.2.) Is deparse() parsing the function/expression itself?
>
> [see code for extract.str.fun() function below]
>
>
> ### All strings in "base"
> extract.str.pkg("base")
> # type = 2 for Comments:
> extract.str.pkg("base", type=2)
> extract.str.pkg("sp", type=2)
> extract.str.pkg("NetLogoR", type=2)
>
> The code for the 2 functions (extract.str.pkg &
> extract.str.fun) and the code for the parse.simple()
> parser are below.
>
>
> Sincerely,
>
>
> Leonard
>
> =======
>
> The latest code is on GitHub:
>
> https://github.com/discoleo/R/blob/master/Stat/Tools.Formulas.R
>
>
> ### Code to process functions in packages:
> extract.str.fun = function(fn, pkg, type=1, strip=TRUE) {
> ??? fn = as.symbol(fn); pkg = as.symbol(pkg);
> ??? fn = list(substitute(pkg ::: fn));
> ??? # deparse
> ??? s = paste0(do.call(deparse, fn), collapse="");
> ??? npos = parse.simple(s);
> ??? extract.str(s, npos[[type]], strip=strip)
> }
> extract.str.pkg = function(pkg, type=1, exclude.z = TRUE, strip=TRUE) {
> ??? nms = ls(getNamespace(pkg));
> ??? l = lapply(nms, function(fn) extract.str.fun(fn,
> pkg, type=type, strip=strip));
> ??? if(exclude.z) {
> ??? ??? hasStr = sapply(l, function(s) length(s) >= 1);
> ??? ??? nms = nms[hasStr];
> ??? ??? l = l[hasStr];
> ??? }
> ??? names(l) = nms;
> ??? return(l);
> }
>
> ### minimal Parser:
> # - proof of concept;
> # - may be useful to process non-conformant R "code", e.g.:
> #?? "{\"abc\" + \"bcd\"} {FUN}"; (still TODO)
> # Warning:
> # - not thoroughly checked &
> #?? may be a little buggy!
>
> parse.simple = function(x, eol="\n") {
> ??? len = nchar(x);
> ??? n.comm = list(integer(0), integer(0));
> ??? n.str? = list(integer(0), integer(0));
> ??? is.hex = function(ch) {
> ??? ??? # Note: only for 1 character!
> ??? ??? return((ch >= "0" && ch <= "9") ||
> ??? ??? ??? (ch >= "A" && ch <= "F") ||
> ??? ??? ??? (ch >= "a" && ch <= "f"));
> ??? }
> ??? npos = 1;
> ??? while(npos <= len) {
> ??? ??? s = substr(x, npos, npos);
> ??? ??? # State: COMMENT
> ??? ??? if(s == "#") {
> ??? ??? ??? n.comm[[1]] = c(n.comm[[1]], npos);
> ??? ??? ??? while(npos < len) {
> ??? ??? ??? ??? npos = npos + 1;
> ??? ??? ??? ??? if(substr(x, npos, npos) == eol) break;
> ??? ??? ??? }
> ??? ??? ??? n.comm[[2]] = c(n.comm[[2]], npos);
> ??? ??? ??? npos = npos + 1; next;
> ??? ??? }
> ??? ??? # State: STRING
> ??? ??? if(s == "\"" || s == "'") {
> ??? ??? ??? n.str[[1]] = c(n.str[[1]], npos);
> ??? ??? ??? while(npos < len) {
> ??? ??? ??? ??? npos = npos + 1;
> ??? ??? ??? ??? se = substr(x, npos, npos);
> ??? ??? ??? ??? if(se == "\\") {
> ??? ??? ??? ??? ??? npos = npos + 1;
> ??? ??? ??? ??? ??? # simple escape vs Unicode:
> ??? ??? ??? ??? ??? if(substr(x, npos, npos) != "u") next;
> ??? ??? ??? ??? ??? len.end = min(len, npos + 4);
> ??? ??? ??? ??? ??? npos = npos + 1;
> ??? ??? ??? ??? ??? isAllHex = TRUE;
> ??? ??? ??? ??? ??? while(npos <= len.end) {
> ??? ??? ??? ??? ??? ??? se = substr(x, npos, npos);
> ??? ??? ??? ??? ??? ??? if( ! is.hex(se)) { isAllHex = FALSE; break; }
> ??? ??? ??? ??? ??? ??? npos = npos + 1;
> ??? ??? ??? ??? ??? }
> ??? ??? ??? ??? ??? if(isAllHex) next;
> ??? ??? ??? ??? }
> ??? ??? ??? ??? if(se == s) break;
> ??? ??? ??? }
> ??? ??? ??? n.str[[2]] = c(n.str[[2]], npos);
> ??? ??? ??? npos = npos + 1; next;
> ??? ??? }
> ??? ??? npos = npos + 1;
> ??? }
> ??? return(list(str = n.str, comm = n.comm));
> }
>
>
> extract.str = function(s, npos, strip=FALSE) {
> ??? if(length(npos[[1]]) == 0) return(character(0));
> ??? strip.FUN = if(strip) {
> ??? ??? ??? function(id) {
> ??? ??? ??? ??? if(npos[[1]][[id]] + 1 < npos[[2]][[id]]) {
> ??? ??? ??? ??? ??? nStart = npos[[1]][[id]] + 1;
> ??? ??? ??? ??? ??? nEnd = npos[[2]][[id]] - 1; # TODO:
> Error with malformed string
> ??? ??? ??? ??? ??? return(substr(s, nStart, nEnd));
> ??? ??? ??? ??? } else {
> ??? ??? ??? ??? ??? return("");
> ??? ??? ??? ??? }
> ??? ??? ??? }
> ??? ??? } else function(id) substr(s, npos[[1]][[id]], npos[[2]][[id]]);
> ??? sapply(seq(length(npos[[1]])), strip.FUN);
> }
>

On a.) There is an option "keep.source" that controls
       this behaviour. When you install a package via
       R CMD INSTALL, you can specify the option; see
       R CMD INSTALL --help .

There is also the "remindR" package on CRAN which
(I think) does something similar.


-- 
Enrico Schumann
Lucerne, Switzerland
http://enricoschumann.net


From ben@de|v|de @end|ng |rom u|@j@edu@br  Fri Oct  8 00:46:52 2021
From: ben@de|v|de @end|ng |rom u|@j@edu@br (Ben Deivide de Oliveira Batista)
Date: Thu, 7 Oct 2021 19:46:52 -0300
Subject: [R] There is a relationship of the Modify-in-place optimisation of
 a object and the local variable `*tmp*`?
Message-ID: <CAM7vW+PAjzsyQhry=n9oKJwAVvj9cxqJiqppdrM4UbVzxDUdsQ@mail.gmail.com>

Dear R users,

When modify-in-place of objects occurs, is there a local variable called
`*tmp*`, behind the scenes R? Let's look at two examples to understand the
question.

Example 1 (R Language Definition)
--------------------------------------------------

> x <- 1:10
> tracemem(x)
[1] "<000000000798F758>"
> x[3:5] <- 13:15
tracemem[0x000000000798f758 -> 0x0000000008207030]:

The result of this command is as if the following had been executed
`*tmp*` <- x
x <- "[<-"(`*tmp*`, 3:5, value=13:15)
rm(`*tmp*`)

Conclusion: Here copy-on-modify occurs!


Example 2 : Modify-in-place
-----------------------

> x <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
> tracemem(x)
[1] "<0000000008BFB818>"
> x[3:5] <- 13:15Conclusion: Here modify-in-place occurs!
For example 2, is there a local variable `*tmp*` for this case? If so,
what would the syntactic representation look like, similar to example 1?



-- 
Ben D?ivide de Oliveira Batista

Prof. Estat?stica (DEFIM/CAP/UFSJ)
P?gina pessoal/profissional: bendeivide.github.io
P?gina Institucional: www.ufsj.edu.br/bendeivide

	[[alternative HTML version deleted]]


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Fri Oct  8 09:15:47 2021
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Fri, 8 Oct 2021 08:15:47 +0100
Subject: [R] adding results to plot
In-Reply-To: <9401ae8901ae4cf9adeed4d122374a91@SRVEXCHCM1302.precheza.cz>
References: <0671d8bb61d74f2db55853bf19f32381@SRVEXCHCM1302.precheza.cz>
 <b354f020-4f18-d696-74d5-43a787996edf@sapo.pt>
 <9401ae8901ae4cf9adeed4d122374a91@SRVEXCHCM1302.precheza.cz>
Message-ID: <d36da0a3-1ad4-5d1b-3aac-b4a88a3a80c2@sapo.pt>

Hello,

Thanks for the compliment.

The R Core team, to which we must be very grateful for their great work 
along so many years, is, for good and obvious reasons, known to be 
change resistant and a new method would overload them even more with 
maintenance worries so I guess text.htest won't make it to core R.

(And that would be to open a precedent. Is, for instance, text.lm next?)

If it does make it to base R, which I doubt, then the base R package 
should be package graphics, right?

In the mean time I have found a small bug, near the end of print.htest 
there's


print(x$estimate, digits = digits, ...)


corresponding to my


paste("sample estimates:", round(ht$estimate, digits = digits), sep =  "\n")


The bug is that x$estimate/ht$estimate is a named vector and with paste 
the names attribute is lost. It doesn't plot "mean of x". I will 
probably try to sort this out but make no promises.

Thanks once again,

Rui Barradas

?s 14:47 de 07/10/21, PIKAL Petr escreveu:
> Hallo Rui.
> 
> I finally tested your function and it seems to me that it should propagate
> to the core R or at least to the stats package.
> 
> Although it is a bit overkill for my purpose, its use is straightforward and
> simple. I checked it for several *test functions and did not find any
> problem.
> 
> Thanks and best regards.
> 
> Petr
> 
>> -----Original Message-----
>> From: Rui Barradas <ruipbarradas at sapo.pt>
>> Sent: Friday, September 17, 2021 9:56 PM
>> To: PIKAL Petr <petr.pikal at precheza.cz>; r-help <r-help at r-project.org>
>> Subject: Re: [R] adding results to plot
>>
>> Hello,
>>
>> *.test functions in base R return a list of class "htest", with its own
>> print method.
>> The method text.htest for objects of class "htest" below is a hack. I
>> adapted the formating part of the code of print.htest to plot text().
>> I find it maybe too complicated but it seems to work.
>>
>> Warning: Not debugged at all.
>>
>>
>>
>> text.htest <- function (ht, x, y = NULL, digits = getOption("digits"),
>>                           prefix = "", adj = NULL, ...) {
>>     out <- list()
>>     i_out <- 1L
>>     out[[i_out]] <- paste(strwrap(ht$method, prefix = prefix), sep = "\n")
>>     i_out <- i_out + 1L
>>     out[[i_out]] <- paste0("data:  ", ht$data.name)
>>
>>     stat_line <- NULL
>>     i_stat_line <- 0L
>>     if (!is.null(ht$statistic)) {
>>       i_stat_line <- i_stat_line + 1L
>>       stat_line[[i_stat_line]] <- paste(names(ht$statistic), "=",
>>                                         format(ht$statistic, digits =
>> max(1L, digits - 2L)))
>>     }
>>     if (!is.null(ht$parameter)) {
>>       i_stat_line <- i_stat_line + 1L
>>       stat_line[[i_stat_line]] <- paste(names(ht$parameter), "=",
>>                                         format(ht$parameter, digits =
>> max(1L, digits - 2L)))
>>     }
>>     if (!is.null(ht$p.value)) {
>>       fp <- format.pval(ht$p.value, digits = max(1L, digits - 3L))
>>       i_stat_line <- i_stat_line + 1L
>>       stat_line[[i_stat_line]] <- paste("p-value",
>>                                         if (startsWith(fp, "<")) fp else
>> paste("=", fp))
>>     }
>>     if(!is.null(stat_line)){
>>       i_out <- i_out + 1L
>>       #out[[i_out]] <- strwrap(paste(stat_line, collapse = ", "))
>>       out[[i_out]] <- paste(stat_line, collapse = ", ")
>>     }
>>     if (!is.null(ht$alternative)) {
>>       alt <- NULL
>>       i_alt <- 1L
>>       alt[[i_alt]] <- "alternative hypothesis: "
>>       if (!is.null(ht$null.value)) {
>>         if (length(ht$null.value) == 1L) {
>>           alt.char <- switch(ht$alternative, two.sided = "not equal to",
>>                              less = "less than", greater = "greater than")
>>           i_alt <- i_alt + 1L
>>           alt[[i_alt]] <- paste0("true ", names(ht$null.value), " is ",
>> alt.char,
>>                                  " ", ht$null.value)
>>         }
>>         else {
>>           i_alt <- i_alt + 1L
>>           alt[[i_alt]] <- paste0(ht$alternative, "\nnull values:\n")
>>         }
>>       }
>>       else {
>>         i_alt <- i_alt + 1L
>>         alt[[i_alt]] <- ht$alternative
>>       }
>>       i_out <- i_out + 1L
>>       out[[i_out]] <- paste(alt, collapse = " ")
>>     }
>>     if (!is.null(ht$conf.int)) {
>>       i_out <- i_out + 1L
>>       out[[i_out]] <- paste0(format(100 * attr(ht$conf.int, "conf.level")),
>>                              " percent confidence interval:\n", " ",
>>                              paste(format(ht$conf.int[1:2], digits =
>> digits), collapse = " "))
>>     }
>>     if (!is.null(ht$estimate)) {
>>       i_out <- i_out + 1L
>>       out[[i_out]] <- paste("sample estimates:", round(ht$estimate,
>> digits = digits), sep = "\n")
>>     }
>>     i_out <- i_out + 1L
>>     out[[i_out]] <- "\n"
>>     names(out)[i_out] <- "sep"
>>     out <- do.call(paste, out)
>>     if(is.null(adj)) adj <- 0L
>>     text(x, y, labels = out, adj = adj, ...)
>>     invisible(out)
>> }
>>
>>
>> res <- shapiro.test(rnorm(100))
>> plot(1,1, ylim = c(0, length(res) + 1L))
>> text(res, 0.6, length(res) - 1)
>> res
>>
>> res2 <- t.test(rnorm(100))
>> plot(1,1, ylim = c(0, length(res2) + 1L))
>> text(res2, 0.6, length(res2) - 1L)
>> res2
>>
>>
>> Hope this helps,
>>
>> Rui Barradas
>>
>>
>>
>> ?s 15:12 de 16/09/21, PIKAL Petr escreveu:
>>> Dear all
>>>
>>> I know I have seen the answer somewhere but I am not able to find it.
>> Please
>>> help
>>>
>>>> plot(1,1)
>>>> res <- shapiro.test(rnorm(100))
>>>> res
>>>
>>>           Shapiro-Wilk normality test
>>>
>>> data:  rnorm(100)
>>> W = 0.98861, p-value = 0.5544
>>>
>>> I would like to add whole res object to the plot.
>>>
>>> I can do it one by one
>>>> text(locator(1), res$method)
>>>> text(locator(1), as.character(res$p.value))
>>> ...
>>> But it is quite inconvenient
>>>
>>> I could find some way in ggplot world but not in plain plot world.
>>>
>>> Best regards
>>> Petr
>>>
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide http://www.R-project.org/posting-
>> guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>>


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Oct  8 11:58:35 2021
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 8 Oct 2021 05:58:35 -0400
Subject: [R] 
 There is a relationship of the Modify-in-place optimisation of
 a object and the local variable `*tmp*`?
In-Reply-To: <CAM7vW+PAjzsyQhry=n9oKJwAVvj9cxqJiqppdrM4UbVzxDUdsQ@mail.gmail.com>
References: <CAM7vW+PAjzsyQhry=n9oKJwAVvj9cxqJiqppdrM4UbVzxDUdsQ@mail.gmail.com>
Message-ID: <a743b96d-d2cc-d9d7-47cb-342d8a23b84a@gmail.com>

On 07/10/2021 6:46 p.m., Ben Deivide de Oliveira Batista wrote:
> Dear R users,
> 
> When modify-in-place of objects occurs, is there a local variable called
> `*tmp*`, behind the scenes R? Let's look at two examples to understand the
> question.
> 
> Example 1 (R Language Definition)
> --------------------------------------------------
> 
>> x <- 1:10
>> tracemem(x)
> [1] "<000000000798F758>"
>> x[3:5] <- 13:15
> tracemem[0x000000000798f758 -> 0x0000000008207030]:
> 
> The result of this command is as if the following had been executed
> `*tmp*` <- x
> x <- "[<-"(`*tmp*`, 3:5, value=13:15)
> rm(`*tmp*`)
> 
> Conclusion: Here copy-on-modify occurs!
> 
> 
> Example 2 : Modify-in-place
> -----------------------
> 
>> x <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
>> tracemem(x)
> [1] "<0000000008BFB818>"
>> x[3:5] <- 13:15Conclusion: Here modify-in-place occurs!
> For example 2, is there a local variable `*tmp*` for this case? If so,
> what would the syntactic representation look like, similar to example 1?

I think there is, and it would be the same as in 1.  The memory 
operations are different because x is different:  in 1, it is stored in 
a compact representation of 1:10, which needs to be expanded to a full 
array of doubles before the entries can be changed.  In 2, it is already 
stored as an array of doubles so this isn't needed.

Duncan Murdoch


From j|ox @end|ng |rom mcm@@ter@c@  Fri Oct  8 17:38:52 2021
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Fri, 8 Oct 2021 11:38:52 -0400
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>
References: <8197_1633627307_197HLkf0027632_MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
 <6203fea2-3235-531d-891f-01a0ac23bef7@mcmaster.ca>
 <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>
Message-ID: <6b011831-5760-3c9a-56db-b0779e2c2638@mcmaster.ca>

Dear Ravi,

On 2021-10-08 8:21 a.m., Ravi Varadhan wrote:
> Thank you to Bert, Sarah, and John. I did consider suppressing warnings, 
> but I felt that there must be a more principled approach.? While John's 
> solution is what I would prefer, I cannot help but wonder why `ifelse' 
> was not constructed to avoid this behavior.

The conditional if () else, which works on an individual logical value, 
uses lazy evaluation and so can avoid the problem you encountered. My 
guess is that implementing lazy evaluation for the vectorized ifelse() 
would incur too high a computational overhead for large arguments.

Best,
  John

> 
> Thanks & Best regards,
> Ravi
> ------------------------------------------------------------------------
> *From:* John Fox <jfox at mcmaster.ca>
> *Sent:* Thursday, October 7, 2021 2:00 PM
> *To:* Ravi Varadhan <ravi.varadhan at jhu.edu>
> *Cc:* R-Help <r-help at r-project.org>
> *Subject:* Re: [R] How to use ifelse without invoking warnings
> 
>  ????? External Email - Use Caution
> 
> 
> 
> Dear Ravi,
> 
> It's already been suggested that you could disable warnings, but that's
> risky in case there's a warning that you didn't anticipate. Here's a
> different approach:
> 
>  ?> kk <- k[k >= -1 & k <= n]
>  ?> ans <- numeric(length(k))
>  ?> ans[k > n] <- 1
>  ?> ans[k >= -1 & k <= n] <- pbeta(p, kk + 1, n - kk, lower.tail=FALSE)
>  ?> ans
> [1] 0.000000000 0.006821826 0.254991551 1.000000000
> 
> BTW, I don't think that you mentioned that p = 0.3, but that seems
> apparent from the output you showed.
> 
> I hope this helps,
>  ? John
> 
> --
> John Fox, Professor Emeritus
> McMaster University
> Hamilton, Ontario, Canada
> web: 
> https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsocialsciences.mcmaster.ca%2Fjfox%2F&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160038474%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=Q33yXm36BwEVKUWO72CWFpSUx7gcEEXhM3qFi7n78ZM%3D&amp;reserved=0 
> <https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsocialsciences.mcmaster.ca%2Fjfox%2F&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160038474%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=Q33yXm36BwEVKUWO72CWFpSUx7gcEEXhM3qFi7n78ZM%3D&amp;reserved=0>
> 
> On 2021-10-07 12:29 p.m., Ravi Varadhan via R-help wrote:
>> Hi,
>> I would like to execute the following vectorized calculation:
>>
>>??? ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE), ifelse (k < -1, 0, 1) )
>>
>> For example:
>>
>>
>>> k <- c(-1.2,-0.5, 1.5, 10.4)
>>> n <- 10
>>> ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) )
>> Warning message:
>> In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
>>> print(ans)
>> [1] 0.000000000 0.006821826 0.254991551 1.000000000
>>
>> The answer is correct.? However, I would like to eliminate the annoying warnings.? Is there a better way to do this?
>>
>> Thank you,
>> Ravi
>>
>>
>>?????? [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=FXX%2B4zNT0JHBnDFO5dXBDQ484oQF1EK5%2Fa0dG9P%2F4k4%3D&amp;reserved=0 
> <https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=FXX%2B4zNT0JHBnDFO5dXBDQ484oQF1EK5%2Fa0dG9P%2F4k4%3D&amp;reserved=0>
>> PLEASE do read the posting guide https://nam02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=ss2ohzJIY6qj0eAexk4yVzTzbjXxK5VZNors0GpsbA0%3D&amp;reserved=0 
> <https://nam02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=ss2ohzJIY6qj0eAexk4yVzTzbjXxK5VZNors0GpsbA0%3D&amp;reserved=0>
>> and provide commented, minimal, self-contained, reproducible code.
>>
>


From Ry@n@Der|ck@on @end|ng |rom v@@gov  Fri Oct  8 19:49:20 2021
From: Ry@n@Der|ck@on @end|ng |rom v@@gov (Derickson, Ryan, VHA NCOD)
Date: Fri, 8 Oct 2021 17:49:20 +0000
Subject: [R] unexpected behavior in apply
Message-ID: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>

Hello, 

I'm seeing unexpected behavior when using apply() compared to a for loop when a character vector is part of the data subjected to the apply statement. Below, I check whether all non-missing values are <= 3. If I include a character column, apply incorrectly returns TRUE for d3. If I only pass the numeric columns to apply, it is correct for d3. If I use a for loop, it is correct. 

> d<-data.frame(d1 = letters[1:3],
+               d2 = c(1,2,3),
+               d3 = c(NA,NA,6))
> 
> d
  d1 d2 d3
1  a  1 NA
2  b  2 NA
3  c  3  6
> 
> # results are incorrect
> apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
   d1    d2    d3 
FALSE  TRUE  TRUE 
> 
> # results are correct
> apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
   d2    d3 
 TRUE FALSE 
> 
> # results are correct
> for(i in names(d)){
+   print(all(d[!is.na(d[,i]),i] <= 3))
+ }
[1] FALSE
[1] TRUE
[1] FALSE


Finally, if I remove the NA values from d3 and include the character column in apply, it is correct.

> d<-data.frame(d1 = letters[1:3],
+               d2 = c(1,2,3),
+               d3 = c(4,5,6))
> 
> d
  d1 d2 d3
1  a  1  4
2  b  2  5
3  c  3  6
> 
> # results are correct
> apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
   d1    d2    d3 
FALSE  TRUE FALSE


Can someone help me understand what's happening?


From @zwj|08 @end|ng |rom gm@||@com  Fri Oct  8 20:03:25 2021
From: @zwj|08 @end|ng |rom gm@||@com (Jiefei Wang)
Date: Sat, 9 Oct 2021 02:03:25 +0800
Subject: [R] unexpected behavior in apply
In-Reply-To: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
Message-ID: <CAGiFhPN4C2zinAm7_UjrdkYvtMVu7SUvVV3VUMLJYbG4Pd+XMA@mail.gmail.com>

Hi,

I guess this can tell you what happens behind the scene


> d<-data.frame(d1 = letters[1:3],
+               d2 = c(1,2,3),
+               d3 = c(NA,NA,6))
> apply(d, 2, FUN=function(x)x)
     d1  d2  d3
[1,] "a" "1" NA
[2,] "b" "2" NA
[3,] "c" "3" " 6"
> "a"<=3
[1] FALSE
> "2"<=3
[1] TRUE
> "6"<=3
[1] FALSE

Note that there is an additional space in the character value " 6",
that's why your comparison fails. I do not understand why but this
might be a bug in R

Best,
Jiefei

On Sat, Oct 9, 2021 at 1:49 AM Derickson, Ryan, VHA NCOD via R-help
<r-help at r-project.org> wrote:
>
> Hello,
>
> I'm seeing unexpected behavior when using apply() compared to a for loop when a character vector is part of the data subjected to the apply statement. Below, I check whether all non-missing values are <= 3. If I include a character column, apply incorrectly returns TRUE for d3. If I only pass the numeric columns to apply, it is correct for d3. If I use a for loop, it is correct.
>
> > d<-data.frame(d1 = letters[1:3],
> +               d2 = c(1,2,3),
> +               d3 = c(NA,NA,6))
> >
> > d
>   d1 d2 d3
> 1  a  1 NA
> 2  b  2 NA
> 3  c  3  6
> >
> > # results are incorrect
> > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
>    d1    d2    d3
> FALSE  TRUE  TRUE
> >
> > # results are correct
> > apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
>    d2    d3
>  TRUE FALSE
> >
> > # results are correct
> > for(i in names(d)){
> +   print(all(d[!is.na(d[,i]),i] <= 3))
> + }
> [1] FALSE
> [1] TRUE
> [1] FALSE
>
>
> Finally, if I remove the NA values from d3 and include the character column in apply, it is correct.
>
> > d<-data.frame(d1 = letters[1:3],
> +               d2 = c(1,2,3),
> +               d3 = c(4,5,6))
> >
> > d
>   d1 d2 d3
> 1  a  1  4
> 2  b  2  5
> 3  c  3  6
> >
> > # results are correct
> > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
>    d1    d2    d3
> FALSE  TRUE FALSE
>
>
> Can someone help me understand what's happening?
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From @kw@|mmo @end|ng |rom gm@||@com  Fri Oct  8 20:08:25 2021
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Fri, 8 Oct 2021 14:08:25 -0400
Subject: [R] unexpected behavior in apply
In-Reply-To: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
Message-ID: <CAPcHnpQacRZ5CS00vZmOjnx9yQWPkJzMADBjeTYZQwJZG-q_dw@mail.gmail.com>

Hello,


The issue comes that 'apply' tries to coerce its argument to a matrix. This
means that all your columns will become character class, and the result
will not be what you wanted. I would suggest something more like:


sapply(d, function(x) all(x[!is.na(x)] <= 3))

or

vapply(d, function(x) all(x[!is.na(x)] <= 3), NA)


Also, here is a different method that might look cleaner:


sapply(d, function(x) all(x <= 3, na.rm = TRUE))

vapply(d, function(x) all(x <= 3, na.rm = TRUE), NA)


It's up to you which you choose. I hope this helps!

On Fri, Oct 8, 2021 at 1:50 PM Derickson, Ryan, VHA NCOD via R-help <
r-help at r-project.org> wrote:

> Hello,
>
> I'm seeing unexpected behavior when using apply() compared to a for loop
> when a character vector is part of the data subjected to the apply
> statement. Below, I check whether all non-missing values are <= 3. If I
> include a character column, apply incorrectly returns TRUE for d3. If I
> only pass the numeric columns to apply, it is correct for d3. If I use a
> for loop, it is correct.
>
> > d<-data.frame(d1 = letters[1:3],
> +               d2 = c(1,2,3),
> +               d3 = c(NA,NA,6))
> >
> > d
>   d1 d2 d3
> 1  a  1 NA
> 2  b  2 NA
> 3  c  3  6
> >
> > # results are incorrect
> > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
>    d1    d2    d3
> FALSE  TRUE  TRUE
> >
> > # results are correct
> > apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
>    d2    d3
>  TRUE FALSE
> >
> > # results are correct
> > for(i in names(d)){
> +   print(all(d[!is.na(d[,i]),i] <= 3))
> + }
> [1] FALSE
> [1] TRUE
> [1] FALSE
>
>
> Finally, if I remove the NA values from d3 and include the character
> column in apply, it is correct.
>
> > d<-data.frame(d1 = letters[1:3],
> +               d2 = c(1,2,3),
> +               d3 = c(4,5,6))
> >
> > d
>   d1 d2 d3
> 1  a  1  4
> 2  b  2  5
> 3  c  3  6
> >
> > # results are correct
> > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
>    d1    d2    d3
> FALSE  TRUE FALSE
>
>
> Can someone help me understand what's happening?
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From g@@mo||n@k|1 @end|ng |rom gm@||@com  Fri Oct  8 20:20:30 2021
From: g@@mo||n@k|1 @end|ng |rom gm@||@com (=?UTF-8?Q?Grzegorz_Smoli=C5=84ski?=)
Date: Fri, 8 Oct 2021 20:20:30 +0200
Subject: [R] ODP:  unexpected behavior in apply
In-Reply-To: <CAPcHnpQacRZ5CS00vZmOjnx9yQWPkJzMADBjeTYZQwJZG-q_dw@mail.gmail.com>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
 <CAPcHnpQacRZ5CS00vZmOjnx9yQWPkJzMADBjeTYZQwJZG-q_dw@mail.gmail.com>
Message-ID: <CABxpnnm4BzbXb4cWhFo+bv=cORKTDvQABt3CCSno6W8fWrWFZg@mail.gmail.com>

Hi,
but why is there a space before 6? Isn't it the source of the problem?

Best regards,
Grzegorz


pt., 8 pa? 2021 o 20:14 Andrew Simmons <akwsimmo at gmail.com> napisa?(a):
>
> Hello,
>
>
> The issue comes that 'apply' tries to coerce its argument to a matrix. This
> means that all your columns will become character class, and the result
> will not be what you wanted. I would suggest something more like:
>
>
> sapply(d, function(x) all(x[!is.na(x)] <= 3))
>
> or
>
> vapply(d, function(x) all(x[!is.na(x)] <= 3), NA)
>
>
> Also, here is a different method that might look cleaner:
>
>
> sapply(d, function(x) all(x <= 3, na.rm = TRUE))
>
> vapply(d, function(x) all(x <= 3, na.rm = TRUE), NA)
>
>
> It's up to you which you choose. I hope this helps!
>
> On Fri, Oct 8, 2021 at 1:50 PM Derickson, Ryan, VHA NCOD via R-help <
> r-help at r-project.org> wrote:
>
> > Hello,
> >
> > I'm seeing unexpected behavior when using apply() compared to a for loop
> > when a character vector is part of the data subjected to the apply
> > statement. Below, I check whether all non-missing values are <= 3. If I
> > include a character column, apply incorrectly returns TRUE for d3. If I
> > only pass the numeric columns to apply, it is correct for d3. If I use a
> > for loop, it is correct.
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(NA,NA,6))
> > >
> > > d
> >   d1 d2 d3
> > 1  a  1 NA
> > 2  b  2 NA
> > 3  c  3  6
> > >
> > > # results are incorrect
> > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d1    d2    d3
> > FALSE  TRUE  TRUE
> > >
> > > # results are correct
> > > apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d2    d3
> >  TRUE FALSE
> > >
> > > # results are correct
> > > for(i in names(d)){
> > +   print(all(d[!is.na(d[,i]),i] <= 3))
> > + }
> > [1] FALSE
> > [1] TRUE
> > [1] FALSE
> >
> >
> > Finally, if I remove the NA values from d3 and include the character
> > column in apply, it is correct.
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(4,5,6))
> > >
> > > d
> >   d1 d2 d3
> > 1  a  1  4
> > 2  b  2  5
> > 3  c  3  6
> > >
> > > # results are correct
> > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d1    d2    d3
> > FALSE  TRUE FALSE
> >
> >
> > Can someone help me understand what's happening?
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide
> > http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From @zwj|08 @end|ng |rom gm@||@com  Fri Oct  8 20:21:35 2021
From: @zwj|08 @end|ng |rom gm@||@com (Jiefei Wang)
Date: Sat, 9 Oct 2021 02:21:35 +0800
Subject: [R] unexpected behavior in apply
In-Reply-To: <CAGiFhPN4C2zinAm7_UjrdkYvtMVu7SUvVV3VUMLJYbG4Pd+XMA@mail.gmail.com>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
 <CAGiFhPN4C2zinAm7_UjrdkYvtMVu7SUvVV3VUMLJYbG4Pd+XMA@mail.gmail.com>
Message-ID: <CAGiFhPNg+3A+gQjXOGEM=_tVAi=41hpW_Xp-F4VrZOfSCn-y4A@mail.gmail.com>

Ok, it turns out that this is documented, even though it looks surprising.

First of all, the apply function will try to convert any object with
the dim attribute to a matrix(my intuition agrees with you that there
should be no conversion), so the first step of the apply function is

> as.matrix.data.frame(d)
     d1  d2  d3
[1,] "a" "1" NA
[2,] "b" "2" NA
[3,] "c" "3" " 6"

Since the data frame `d` is a mixture of character and non-character
values, the non-character value will be converted to the character
using the function `format`. However, the problem is that the NA value
will also be formatted to the character

> format(c(NA, 6))
[1] "NA" " 6"

That's where the space comes from. It is purely for making the result
pretty... The character NA will be removed later, but the space is not
stripped. I would say this is not a good design, and it might be worth
not including the NA value in the format function. At the current
stage, I will suggest using the function `lapply` to do what you want.

> lapply(d, FUN=function(x)all(x[!is.na(x)] <= 3))
$d1
[1] FALSE
$d2
[1] TRUE
$d3
[1] FALSE

Everything should work as you expect.

Best,
Jiefei

On Sat, Oct 9, 2021 at 2:03 AM Jiefei Wang <szwjf08 at gmail.com> wrote:
>
> Hi,
>
> I guess this can tell you what happens behind the scene
>
>
> > d<-data.frame(d1 = letters[1:3],
> +               d2 = c(1,2,3),
> +               d3 = c(NA,NA,6))
> > apply(d, 2, FUN=function(x)x)
>      d1  d2  d3
> [1,] "a" "1" NA
> [2,] "b" "2" NA
> [3,] "c" "3" " 6"
> > "a"<=3
> [1] FALSE
> > "2"<=3
> [1] TRUE
> > "6"<=3
> [1] FALSE
>
> Note that there is an additional space in the character value " 6",
> that's why your comparison fails. I do not understand why but this
> might be a bug in R
>
> Best,
> Jiefei
>
> On Sat, Oct 9, 2021 at 1:49 AM Derickson, Ryan, VHA NCOD via R-help
> <r-help at r-project.org> wrote:
> >
> > Hello,
> >
> > I'm seeing unexpected behavior when using apply() compared to a for loop when a character vector is part of the data subjected to the apply statement. Below, I check whether all non-missing values are <= 3. If I include a character column, apply incorrectly returns TRUE for d3. If I only pass the numeric columns to apply, it is correct for d3. If I use a for loop, it is correct.
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(NA,NA,6))
> > >
> > > d
> >   d1 d2 d3
> > 1  a  1 NA
> > 2  b  2 NA
> > 3  c  3  6
> > >
> > > # results are incorrect
> > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d1    d2    d3
> > FALSE  TRUE  TRUE
> > >
> > > # results are correct
> > > apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d2    d3
> >  TRUE FALSE
> > >
> > > # results are correct
> > > for(i in names(d)){
> > +   print(all(d[!is.na(d[,i]),i] <= 3))
> > + }
> > [1] FALSE
> > [1] TRUE
> > [1] FALSE
> >
> >
> > Finally, if I remove the NA values from d3 and include the character column in apply, it is correct.
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(4,5,6))
> > >
> > > d
> >   d1 d2 d3
> > 1  a  1  4
> > 2  b  2  5
> > 3  c  3  6
> > >
> > > # results are correct
> > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d1    d2    d3
> > FALSE  TRUE FALSE
> >
> >
> > Can someone help me understand what's happening?
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.


From Ry@n@Der|ck@on @end|ng |rom v@@gov  Fri Oct  8 20:24:17 2021
From: Ry@n@Der|ck@on @end|ng |rom v@@gov (Derickson, Ryan, VHA NCOD)
Date: Fri, 8 Oct 2021 18:24:17 +0000
Subject: [R] [EXTERNAL] Re:  unexpected behavior in apply
In-Reply-To: <CAGiFhPNg+3A+gQjXOGEM=_tVAi=41hpW_Xp-F4VrZOfSCn-y4A@mail.gmail.com>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
 <CAGiFhPN4C2zinAm7_UjrdkYvtMVu7SUvVV3VUMLJYbG4Pd+XMA@mail.gmail.com>
 <CAGiFhPNg+3A+gQjXOGEM=_tVAi=41hpW_Xp-F4VrZOfSCn-y4A@mail.gmail.com>
Message-ID: <SA0PR09MB73390E557D67C26608D7CC83F7B29@SA0PR09MB7339.namprd09.prod.outlook.com>

This is interesting and does seem suboptimal. Especially because if I start with a matrix from the beginning, it behaves as expected.

> d<-data.frame(d1 = letters[1:3],
+               d2 = c("1","2","3"),
+               d3 = c(NA,NA,"6"))
> 
> str(d)
'data.frame':	3 obs. of  3 variables:
 $ d1: chr  "a" "b" "c"
 $ d2: chr  "1" "2" "3"
 $ d3: chr  NA NA "6"
> 
> apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
   d1    d2    d3 
FALSE  TRUE FALSE




-----Original Message-----
From: Jiefei Wang <szwjf08 at gmail.com> 
Sent: Friday, October 8, 2021 2:22 PM
To: Derickson, Ryan, VHA NCOD <Ryan.Derickson at va.gov>
Cc: r-help at r-project.org
Subject: [EXTERNAL] Re: [R] unexpected behavior in apply

Ok, it turns out that this is documented, even though it looks surprising.

First of all, the apply function will try to convert any object with the dim attribute to a matrix(my intuition agrees with you that there should be no conversion), so the first step of the apply function is

> as.matrix.data.frame(d)
     d1  d2  d3
[1,] "a" "1" NA
[2,] "b" "2" NA
[3,] "c" "3" " 6"

Since the data frame `d` is a mixture of character and non-character values, the non-character value will be converted to the character using the function `format`. However, the problem is that the NA value will also be formatted to the character

> format(c(NA, 6))
[1] "NA" " 6"

That's where the space comes from. It is purely for making the result pretty... The character NA will be removed later, but the space is not stripped. I would say this is not a good design, and it might be worth not including the NA value in the format function. At the current stage, I will suggest using the function `lapply` to do what you want.

> lapply(d, FUN=function(x)all(x[!is.na(x)] <= 3))
$d1
[1] FALSE
$d2
[1] TRUE
$d3
[1] FALSE

Everything should work as you expect.

Best,
Jiefei

On Sat, Oct 9, 2021 at 2:03 AM Jiefei Wang <szwjf08 at gmail.com> wrote:
>
> Hi,
>
> I guess this can tell you what happens behind the scene
>
>
> > d<-data.frame(d1 = letters[1:3],
> +               d2 = c(1,2,3),
> +               d3 = c(NA,NA,6))
> > apply(d, 2, FUN=function(x)x)
>      d1  d2  d3
> [1,] "a" "1" NA
> [2,] "b" "2" NA
> [3,] "c" "3" " 6"
> > "a"<=3
> [1] FALSE
> > "2"<=3
> [1] TRUE
> > "6"<=3
> [1] FALSE
>
> Note that there is an additional space in the character value " 6", 
> that's why your comparison fails. I do not understand why but this 
> might be a bug in R
>
> Best,
> Jiefei
>
> On Sat, Oct 9, 2021 at 1:49 AM Derickson, Ryan, VHA NCOD via R-help 
> <r-help at r-project.org> wrote:
> >
> > Hello,
> >
> > I'm seeing unexpected behavior when using apply() compared to a for loop when a character vector is part of the data subjected to the apply statement. Below, I check whether all non-missing values are <= 3. If I include a character column, apply incorrectly returns TRUE for d3. If I only pass the numeric columns to apply, it is correct for d3. If I use a for loop, it is correct.
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(NA,NA,6))
> > >
> > > d
> >   d1 d2 d3
> > 1  a  1 NA
> > 2  b  2 NA
> > 3  c  3  6
> > >
> > > # results are incorrect
> > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d1    d2    d3
> > FALSE  TRUE  TRUE
> > >
> > > # results are correct
> > > apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d2    d3
> >  TRUE FALSE
> > >
> > > # results are correct
> > > for(i in names(d)){
> > +   print(all(d[!is.na(d[,i]),i] <= 3)) }
> > [1] FALSE
> > [1] TRUE
> > [1] FALSE
> >
> >
> > Finally, if I remove the NA values from d3 and include the character column in apply, it is correct.
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(4,5,6))
> > >
> > > d
> >   d1 d2 d3
> > 1  a  1  4
> > 2  b  2  5
> > 3  c  3  6
> > >
> > > # results are correct
> > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> >    d1    d2    d3
> > FALSE  TRUE FALSE
> >
> >
> > Can someone help me understand what's happening?
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fst
> > at.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7C%7Cd4c50
> > d8f8da547cbf36108d98a88880c%7Ce95f1b23abaf45ee821db7ab251ab3bf%7C0%7
> > C0%7C637693141284202940%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAi
> > LCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=3KAp
> > Y5pdxAh5BzVZvjyrQKTpqkigQmW8N7pmU7DQGcU%3D&amp;reserved=0
> > PLEASE do read the posting guide 
> > https://gcc02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww
> > .r-project.org%2Fposting-guide.html&amp;data=04%7C01%7C%7Cd4c50d8f8d
> > a547cbf36108d98a88880c%7Ce95f1b23abaf45ee821db7ab251ab3bf%7C0%7C0%7C
> > 637693141284202940%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQI
> > joiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=mgrquTpZU
> > SQt7cGywiHtaKWrdqAjvaG4gFx9aD7nRlA%3D&amp;reserved=0
> > and provide commented, minimal, self-contained, reproducible code.


From g@@mo||n@k|1 @end|ng |rom gm@||@com  Fri Oct  8 20:51:57 2021
From: g@@mo||n@k|1 @end|ng |rom gm@||@com (=?UTF-8?Q?Grzegorz_Smoli=C5=84ski?=)
Date: Fri, 8 Oct 2021 20:51:57 +0200
Subject: [R] [EXTERNAL] Re: unexpected behavior in apply
In-Reply-To: <SA0PR09MB73390E557D67C26608D7CC83F7B29@SA0PR09MB7339.namprd09.prod.outlook.com>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
 <CAGiFhPN4C2zinAm7_UjrdkYvtMVu7SUvVV3VUMLJYbG4Pd+XMA@mail.gmail.com>
 <CAGiFhPNg+3A+gQjXOGEM=_tVAi=41hpW_Xp-F4VrZOfSCn-y4A@mail.gmail.com>
 <SA0PR09MB73390E557D67C26608D7CC83F7B29@SA0PR09MB7339.namprd09.prod.outlook.com>
Message-ID: <CABxpnnmETVnQhjiH4RByvn1o8BkK1k4_V0jZSbH=18q=nvaDrQ@mail.gmail.com>

This will work as well:

d<-data.frame(d1 = letters[1:3],
              d2 = c(1,2,3),
              d3 = c(NA_character_,NA_character_,6))

apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))

d1          d2      d3
FALSE  TRUE FALSE

i.e. when NA changed do NA_character_

pt., 8 pa? 2021 o 20:44 Derickson, Ryan, VHA NCOD via R-help
<r-help at r-project.org> napisa?(a):
>
> This is interesting and does seem suboptimal. Especially because if I start with a matrix from the beginning, it behaves as expected.
>
> > d<-data.frame(d1 = letters[1:3],
> +               d2 = c("1","2","3"),
> +               d3 = c(NA,NA,"6"))
> >
> > str(d)
> 'data.frame':   3 obs. of  3 variables:
>  $ d1: chr  "a" "b" "c"
>  $ d2: chr  "1" "2" "3"
>  $ d3: chr  NA NA "6"
> >
> > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
>    d1    d2    d3
> FALSE  TRUE FALSE
>
>
>
>
> -----Original Message-----
> From: Jiefei Wang <szwjf08 at gmail.com>
> Sent: Friday, October 8, 2021 2:22 PM
> To: Derickson, Ryan, VHA NCOD <Ryan.Derickson at va.gov>
> Cc: r-help at r-project.org
> Subject: [EXTERNAL] Re: [R] unexpected behavior in apply
>
> Ok, it turns out that this is documented, even though it looks surprising.
>
> First of all, the apply function will try to convert any object with the dim attribute to a matrix(my intuition agrees with you that there should be no conversion), so the first step of the apply function is
>
> > as.matrix.data.frame(d)
>      d1  d2  d3
> [1,] "a" "1" NA
> [2,] "b" "2" NA
> [3,] "c" "3" " 6"
>
> Since the data frame `d` is a mixture of character and non-character values, the non-character value will be converted to the character using the function `format`. However, the problem is that the NA value will also be formatted to the character
>
> > format(c(NA, 6))
> [1] "NA" " 6"
>
> That's where the space comes from. It is purely for making the result pretty... The character NA will be removed later, but the space is not stripped. I would say this is not a good design, and it might be worth not including the NA value in the format function. At the current stage, I will suggest using the function `lapply` to do what you want.
>
> > lapply(d, FUN=function(x)all(x[!is.na(x)] <= 3))
> $d1
> [1] FALSE
> $d2
> [1] TRUE
> $d3
> [1] FALSE
>
> Everything should work as you expect.
>
> Best,
> Jiefei
>
> On Sat, Oct 9, 2021 at 2:03 AM Jiefei Wang <szwjf08 at gmail.com> wrote:
> >
> > Hi,
> >
> > I guess this can tell you what happens behind the scene
> >
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(NA,NA,6))
> > > apply(d, 2, FUN=function(x)x)
> >      d1  d2  d3
> > [1,] "a" "1" NA
> > [2,] "b" "2" NA
> > [3,] "c" "3" " 6"
> > > "a"<=3
> > [1] FALSE
> > > "2"<=3
> > [1] TRUE
> > > "6"<=3
> > [1] FALSE
> >
> > Note that there is an additional space in the character value " 6",
> > that's why your comparison fails. I do not understand why but this
> > might be a bug in R
> >
> > Best,
> > Jiefei
> >
> > On Sat, Oct 9, 2021 at 1:49 AM Derickson, Ryan, VHA NCOD via R-help
> > <r-help at r-project.org> wrote:
> > >
> > > Hello,
> > >
> > > I'm seeing unexpected behavior when using apply() compared to a for loop when a character vector is part of the data subjected to the apply statement. Below, I check whether all non-missing values are <= 3. If I include a character column, apply incorrectly returns TRUE for d3. If I only pass the numeric columns to apply, it is correct for d3. If I use a for loop, it is correct.
> > >
> > > > d<-data.frame(d1 = letters[1:3],
> > > +               d2 = c(1,2,3),
> > > +               d3 = c(NA,NA,6))
> > > >
> > > > d
> > >   d1 d2 d3
> > > 1  a  1 NA
> > > 2  b  2 NA
> > > 3  c  3  6
> > > >
> > > > # results are incorrect
> > > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d1    d2    d3
> > > FALSE  TRUE  TRUE
> > > >
> > > > # results are correct
> > > > apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d2    d3
> > >  TRUE FALSE
> > > >
> > > > # results are correct
> > > > for(i in names(d)){
> > > +   print(all(d[!is.na(d[,i]),i] <= 3)) }
> > > [1] FALSE
> > > [1] TRUE
> > > [1] FALSE
> > >
> > >
> > > Finally, if I remove the NA values from d3 and include the character column in apply, it is correct.
> > >
> > > > d<-data.frame(d1 = letters[1:3],
> > > +               d2 = c(1,2,3),
> > > +               d3 = c(4,5,6))
> > > >
> > > > d
> > >   d1 d2 d3
> > > 1  a  1  4
> > > 2  b  2  5
> > > 3  c  3  6
> > > >
> > > > # results are correct
> > > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d1    d2    d3
> > > FALSE  TRUE FALSE
> > >
> > >
> > > Can someone help me understand what's happening?
> > >
> > > ______________________________________________
> > > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > > https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fst
> > > at.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7C%7Cd4c50
> > > d8f8da547cbf36108d98a88880c%7Ce95f1b23abaf45ee821db7ab251ab3bf%7C0%7
> > > C0%7C637693141284202940%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAi
> > > LCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=3KAp
> > > Y5pdxAh5BzVZvjyrQKTpqkigQmW8N7pmU7DQGcU%3D&amp;reserved=0
> > > PLEASE do read the posting guide
> > > https://gcc02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww
> > > .r-project.org%2Fposting-guide.html&amp;data=04%7C01%7C%7Cd4c50d8f8d
> > > a547cbf36108d98a88880c%7Ce95f1b23abaf45ee821db7ab251ab3bf%7C0%7C0%7C
> > > 637693141284202940%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQI
> > > joiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=mgrquTpZU
> > > SQt7cGywiHtaKWrdqAjvaG4gFx9aD7nRlA%3D&amp;reserved=0
> > > and provide commented, minimal, self-contained, reproducible code.
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From r@v|@v@r@dh@n @end|ng |rom jhu@edu  Fri Oct  8 14:21:44 2021
From: r@v|@v@r@dh@n @end|ng |rom jhu@edu (Ravi Varadhan)
Date: Fri, 8 Oct 2021 12:21:44 +0000
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <6203fea2-3235-531d-891f-01a0ac23bef7@mcmaster.ca>
References: <8197_1633627307_197HLkf0027632_MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
 <6203fea2-3235-531d-891f-01a0ac23bef7@mcmaster.ca>
Message-ID: <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>

Thank you to Bert, Sarah, and John. I did consider suppressing warnings, but I felt that there must be a more principled approach.  While John's solution is what I would prefer, I cannot help but wonder why `ifelse' was not constructed to avoid this behavior.

Thanks & Best regards,
Ravi
________________________________
From: John Fox <jfox at mcmaster.ca>
Sent: Thursday, October 7, 2021 2:00 PM
To: Ravi Varadhan <ravi.varadhan at jhu.edu>
Cc: R-Help <r-help at r-project.org>
Subject: Re: [R] How to use ifelse without invoking warnings


      External Email - Use Caution



Dear Ravi,

It's already been suggested that you could disable warnings, but that's
risky in case there's a warning that you didn't anticipate. Here's a
different approach:

 > kk <- k[k >= -1 & k <= n]
 > ans <- numeric(length(k))
 > ans[k > n] <- 1
 > ans[k >= -1 & k <= n] <- pbeta(p, kk + 1, n - kk, lower.tail=FALSE)
 > ans
[1] 0.000000000 0.006821826 0.254991551 1.000000000

BTW, I don't think that you mentioned that p = 0.3, but that seems
apparent from the output you showed.

I hope this helps,
  John

--
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsocialsciences.mcmaster.ca%2Fjfox%2F&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160038474%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=Q33yXm36BwEVKUWO72CWFpSUx7gcEEXhM3qFi7n78ZM%3D&amp;reserved=0

On 2021-10-07 12:29 p.m., Ravi Varadhan via R-help wrote:
> Hi,
> I would like to execute the following vectorized calculation:
>
>    ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE), ifelse (k < -1, 0, 1) )
>
> For example:
>
>
>> k <- c(-1.2,-0.5, 1.5, 10.4)
>> n <- 10
>> ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) )
> Warning message:
> In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
>> print(ans)
> [1] 0.000000000 0.006821826 0.254991551 1.000000000
>
> The answer is correct.  However, I would like to eliminate the annoying warnings.  Is there a better way to do this?
>
> Thank you,
> Ravi
>
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=FXX%2B4zNT0JHBnDFO5dXBDQ484oQF1EK5%2Fa0dG9P%2F4k4%3D&amp;reserved=0
> PLEASE do read the posting guide https://nam02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=ss2ohzJIY6qj0eAexk4yVzTzbjXxK5VZNors0GpsbA0%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.
>


	[[alternative HTML version deleted]]


From @v|gro@@ @end|ng |rom ver|zon@net  Sat Oct  9 00:22:11 2021
From: @v|gro@@ @end|ng |rom ver|zon@net (Avi Gross)
Date: Fri, 8 Oct 2021 18:22:11 -0400
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>
References: <8197_1633627307_197HLkf0027632_MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
 <6203fea2-3235-531d-891f-01a0ac23bef7@mcmaster.ca>
 <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>
Message-ID: <00d401d7bc92$f0b79850$d226c8f0$@verizon.net>

Ravi,

I have no idea what motivated the people who made ifelse() but there is no
reason they felt the need to program it to meet your precise need. As others
have noted, it probably was built to handle simple cases well and it expects
to return a result that is the same length as the input. If some of the
processing returns an NA or a NaN then that is what it probably should
return. 

What is the alternative? Return a shorter result? Replace it with a zero?
Fail utterly and abort the program?

YOU as the programmer should make such decisions for a non-routine case.

You can create functions with names like wrapperIf() and wrapperElse() and
do your ifelse like this:

result <- ifelse(condition, wrapperIf(args), wrapperElse(args))

Why the wrappers? If your logic is to replace NaN with 0 or NA or 666 or
Inf, then the code for it would invoke your functionality and if tested to
be a NaN it would replace it as you wish. Yes, it would slow things down a
bit but leave the ifelse() routine fairly simple.

If your goal is to remove those entries, you can do it after by manipulating
"result" above such as not keeping any item that matches 666, or even
without the wrappers, something like:

result <- result[!is.nan(result)]

But, of course, warnings are only suppressed if done right. Clearly you can
very selectively suppress warnings in the wrapper functions above without
also suppressing some other more valid warnings. But if the warning is
coming from ifelse() itself then not ever having it see a NaN would suppress
that.

Do note that the implementation of ifelse() is currently a function, not
some internal call. You can copy that and make your own slightly modified
version if you wish. 

(no R) Avi

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Ravi Varadhan via
R-help
Sent: Friday, October 8, 2021 8:22 AMiu
To: John Fox <jfox at mcmaster.ca>l
Cc: R-Help <r-help at r-project.org>
Subject: Re: [R] How to use ifelse without invoking warnings

Thank you to Bert, Sarah, and John. I did consider suppressing warnings, but
I felt that there must be a more principled approach.  While John's solution
is what I would prefer, I cannot help but wonder why `ifelse' was not
constructed to avoid this behavior.

Thanks & Best regards,
Ravi
________________________________
From: John Fox <jfox at mcmaster.ca>
Sent: Thursday, October 7, 2021 2:00 PM
To: Ravi Varadhan <ravi.varadhan at jhu.edu>
Cc: R-Help <r-help at r-project.org>
Subject: Re: [R] How to use ifelse without invoking warnings


      External Email - Use Caution



Dear Ravi,

It's already been suggested that you could disable warnings, but that's
risky in case there's a warning that you didn't anticipate. Here's a
different approach:

 > kk <- k[k >= -1 & k <= n]
 > ans <- numeric(length(k))
 > ans[k > n] <- 1
 > ans[k >= -1 & k <= n] <- pbeta(p, kk + 1, n - kk, lower.tail=FALSE)  >
ans [1] 0.000000000 0.006821826 0.254991551 1.000000000

BTW, I don't think that you mentioned that p = 0.3, but that seems apparent
from the output you showed.

I hope this helps,
  John

--
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web:
https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsocialscie
nces.mcmaster.ca%2Fjfox%2F&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd88
2e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C63
7692265160038474%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=Q33yXm36BwEVKUWO72CWFpSUx7g
cEEXhM3qFi7n78ZM%3D&amp;reserved=0

On 2021-10-07 12:29 p.m., Ravi Varadhan via R-help wrote:
> Hi,
> I would like to execute the following vectorized calculation:
>
>    ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = 
> FALSE), ifelse (k < -1, 0, 1) )
>
> For example:
>
>
>> k <- c(-1.2,-0.5, 1.5, 10.4)
>> n <- 10
>> ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE), 
>> ifelse (k < -1, 0, 1) )
> Warning message:
> In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
>> print(ans)
> [1] 0.000000000 0.006821826 0.254991551 1.000000000
>
> The answer is correct.  However, I would like to eliminate the annoying
warnings.  Is there a better way to do this?
>
> Thank you,
> Ravi
>
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat
> .ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7Cravi.varadha
> n%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f8
> 6f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWI
> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&a
> mp;sdata=FXX%2B4zNT0JHBnDFO5dXBDQ484oQF1EK5%2Fa0dG9P%2F4k4%3D&amp;rese
> rved=0 PLEASE do read the posting guide 
> https://nam02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r
> -project.org%2Fposting-guide.html&amp;data=04%7C01%7Cravi.varadhan%40j
> hu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8ae
> df0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC
> 4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sd
> ata=ss2ohzJIY6qj0eAexk4yVzTzbjXxK5VZNors0GpsbA0%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.
>


	[[alternative HTML version deleted]]

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://stat.ethz.ch/mailman/listinfo/r-help
PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
and provide commented, minimal, self-contained, reproducible code.


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Sat Oct  9 00:45:44 2021
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Fri, 08 Oct 2021 15:45:44 -0700
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>
References: <8197_1633627307_197HLkf0027632_MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
 <6203fea2-3235-531d-891f-01a0ac23bef7@mcmaster.ca>
 <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>
Message-ID: <AD74ADED-A9EE-451C-9615-7B9EFE4C320B@dcn.davis.ca.us>

I don't think it is avoidable... ifelse cannot figure out which elements will exist in the second and third arguments until they are evaluated, so it cannot make use of the TRUE/FALSE information until both possible output vectors have been evaluated, which is a performance hit and yields warnings or errors.

You, on the other hand, can figure that out and use input validation to limit which inputs get fed into the warning- or error- producing algorithm and put the results into a final result vector using indexed assignment as Dr Fox suggested.


On October 8, 2021 5:21:44 AM PDT, Ravi Varadhan via R-help <r-help at r-project.org> wrote:
>Thank you to Bert, Sarah, and John. I did consider suppressing warnings, but I felt that there must be a more principled approach.  While John's solution is what I would prefer, I cannot help but wonder why `ifelse' was not constructed to avoid this behavior.
>
>Thanks & Best regards,
>Ravi
>________________________________
>From: John Fox <jfox at mcmaster.ca>
>Sent: Thursday, October 7, 2021 2:00 PM
>To: Ravi Varadhan <ravi.varadhan at jhu.edu>
>Cc: R-Help <r-help at r-project.org>
>Subject: Re: [R] How to use ifelse without invoking warnings
>
>
>      External Email - Use Caution
>
>
>
>Dear Ravi,
>
>It's already been suggested that you could disable warnings, but that's
>risky in case there's a warning that you didn't anticipate. Here's a
>different approach:
>
> > kk <- k[k >= -1 & k <= n]
> > ans <- numeric(length(k))
> > ans[k > n] <- 1
> > ans[k >= -1 & k <= n] <- pbeta(p, kk + 1, n - kk, lower.tail=FALSE)
> > ans
>[1] 0.000000000 0.006821826 0.254991551 1.000000000
>
>BTW, I don't think that you mentioned that p = 0.3, but that seems
>apparent from the output you showed.
>
>I hope this helps,
>  John
>
>--
>John Fox, Professor Emeritus
>McMaster University
>Hamilton, Ontario, Canada
>web: https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsocialsciences.mcmaster.ca%2Fjfox%2F&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160038474%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=Q33yXm36BwEVKUWO72CWFpSUx7gcEEXhM3qFi7n78ZM%3D&amp;reserved=0
>
>On 2021-10-07 12:29 p.m., Ravi Varadhan via R-help wrote:
>> Hi,
>> I would like to execute the following vectorized calculation:
>>
>>    ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE), ifelse (k < -1, 0, 1) )
>>
>> For example:
>>
>>
>>> k <- c(-1.2,-0.5, 1.5, 10.4)
>>> n <- 10
>>> ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) )
>> Warning message:
>> In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
>>> print(ans)
>> [1] 0.000000000 0.006821826 0.254991551 1.000000000
>>
>> The answer is correct.  However, I would like to eliminate the annoying warnings.  Is there a better way to do this?
>>
>> Thank you,
>> Ravi
>>
>>
>>       [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=FXX%2B4zNT0JHBnDFO5dXBDQ484oQF1EK5%2Fa0dG9P%2F4k4%3D&amp;reserved=0
>> PLEASE do read the posting guide https://nam02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=ss2ohzJIY6qj0eAexk4yVzTzbjXxK5VZNors0GpsbA0%3D&amp;reserved=0
>> and provide commented, minimal, self-contained, reproducible code.
>>
>
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>https://stat.ethz.ch/mailman/listinfo/r-help
>PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>and provide commented, minimal, self-contained, reproducible code.

-- 
Sent from my phone. Please excuse my brevity.


From deep@y@n@@@rk@r @end|ng |rom gm@||@com  Sat Oct  9 07:02:58 2021
From: deep@y@n@@@rk@r @end|ng |rom gm@||@com (Deepayan Sarkar)
Date: Sat, 9 Oct 2021 10:32:58 +0530
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>
References: <8197_1633627307_197HLkf0027632_MW4PR01MB6212AE658D3DDB1A55B38469F2B19@MW4PR01MB6212.prod.exchangelabs.com>
 <6203fea2-3235-531d-891f-01a0ac23bef7@mcmaster.ca>
 <MW4PR01MB621281C95C40AEE978CC2BF9F2B29@MW4PR01MB6212.prod.exchangelabs.com>
Message-ID: <CADfFDC7W323Y4n=M0EDAtv7uF-vzCbEUHkq_gd_aFdVpkYGWyQ@mail.gmail.com>

On Sat, Oct 9, 2021 at 3:00 AM Ravi Varadhan via R-help
<r-help at r-project.org> wrote:
>
> Thank you to Bert, Sarah, and John. I did consider suppressing warnings, but I felt that
> there must be a more principled approach.  While John's solution is what I would prefer,
> I cannot help but wonder why `ifelse' was not constructed to avoid this behavior.

Note that John's approach is mentioned twice in the help page for
ifelse, once in the examples, and once quite early on in the "Warning"
section:

     Sometimes it is better to use a construction such as

       (tmp <- yes; tmp[!test] <- no[!test]; tmp)

     , possibly extended to handle missing values in 'test'.

Best,
-Deepayan

> Thanks & Best regards,
> Ravi
> ________________________________
> From: John Fox <jfox at mcmaster.ca>
> Sent: Thursday, October 7, 2021 2:00 PM
> To: Ravi Varadhan <ravi.varadhan at jhu.edu>
> Cc: R-Help <r-help at r-project.org>
> Subject: Re: [R] How to use ifelse without invoking warnings
>
>
>       External Email - Use Caution
>
>
>
> Dear Ravi,
>
> It's already been suggested that you could disable warnings, but that's
> risky in case there's a warning that you didn't anticipate. Here's a
> different approach:
>
>  > kk <- k[k >= -1 & k <= n]
>  > ans <- numeric(length(k))
>  > ans[k > n] <- 1
>  > ans[k >= -1 & k <= n] <- pbeta(p, kk + 1, n - kk, lower.tail=FALSE)
>  > ans
> [1] 0.000000000 0.006821826 0.254991551 1.000000000
>
> BTW, I don't think that you mentioned that p = 0.3, but that seems
> apparent from the output you showed.
>
> I hope this helps,
>   John
>
> --
> John Fox, Professor Emeritus
> McMaster University
> Hamilton, Ontario, Canada
> web: https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsocialsciences.mcmaster.ca%2Fjfox%2F&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160038474%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=Q33yXm36BwEVKUWO72CWFpSUx7gcEEXhM3qFi7n78ZM%3D&amp;reserved=0
>
> On 2021-10-07 12:29 p.m., Ravi Varadhan via R-help wrote:
> > Hi,
> > I would like to execute the following vectorized calculation:
> >
> >    ans <- ifelse (k >= -1 & k <= n, pbeta(p, k+1, n-k, lower.tail = FALSE), ifelse (k < -1, 0, 1) )
> >
> > For example:
> >
> >
> >> k <- c(-1.2,-0.5, 1.5, 10.4)
> >> n <- 10
> >> ans <- ifelse (k >= -1 & k <= n, pbeta(p,k+1,n-k,lower.tail=FALSE), ifelse (k < -1, 0, 1) )
> > Warning message:
> > In pbeta(p, k + 1, n - k, lower.tail = FALSE) : NaNs produced
> >> print(ans)
> > [1] 0.000000000 0.006821826 0.254991551 1.000000000
> >
> > The answer is correct.  However, I would like to eliminate the annoying warnings.  Is there a better way to do this?
> >
> > Thank you,
> > Ravi
> >
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://nam02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=FXX%2B4zNT0JHBnDFO5dXBDQ484oQF1EK5%2Fa0dG9P%2F4k4%3D&amp;reserved=0
> > PLEASE do read the posting guide https://nam02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=04%7C01%7Cravi.varadhan%40jhu.edu%7Cfd882e7c4f4349db34e108d989bc6a9f%7C9fa4f438b1e6473b803f86f8aedf0dec%7C0%7C0%7C637692265160048428%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C2000&amp;sdata=ss2ohzJIY6qj0eAexk4yVzTzbjXxK5VZNors0GpsbA0%3D&amp;reserved=0
> > and provide commented, minimal, self-contained, reproducible code.
> >
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From |eo@m@d@ @end|ng |rom @yon|c@eu  Sat Oct  9 20:26:01 2021
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leonard Mada)
Date: Sat, 9 Oct 2021 21:26:01 +0300
Subject: [R] How to use ifelse without invoking warnings
Message-ID: <55052e24-3337-12e9-09f1-7681d2d77de1@syonic.eu>

Dear Ravi,


I wrote a small replacement for ifelse() which avoids such unnecessary 
evaluations (it bothered me a few times as well - so I decided to try a 
small replacement).


### Example:
x = 1:10
FUN = list();
FUN[[1]] = function(x, y) x*y;
FUN[[2]] = function(x, y) x^2;
FUN[[3]] = function(x, y) x;
# lets run multiple conditions
# eval.by.formula(conditions, FUN.list, ... (arguments for FUN) );
eval.by.formula((x > 5 & x %% 2) ~ (x <= 5) ~ ., FUN, x, x-1)
# Example 2
eval.by.formula((x > 5 & x %% 2) ~ (x <= 5) ~ ., FUN, 2, x)


### Disclaimer:
- NOT properly tested;


The code for the function is below. Maybe someone can experiment with 
the code and improve it further. There are a few issues / open 
questions, like:

1.) Best Name: eval.by.formula, ifelse.formula, ...?

2.) Named arguments: not yet;

3.) Fixed values inside FUN.list

4.) Format of expression for conditions:

expression(cond1, cond2, cond3) vs cond1 ~ cond2 ~ cond3 ???

5.) Code efficiency

- some tests on large data sets & optimizations are warranted;


Sincerely,


Leonard

=======

The latest code is on Github:

https://github.com/discoleo/R/blob/master/Stat/Tools.Formulas.R


eval.by.formula = function(e, FUN.list, ..., default=NA) {
 ?? ?tok = split.formula(e);
 ?? ?if(length(tok) == 0) return();
 ?? ?FUN = FUN.list;
 ?? ?# Argument List
 ?? ?clst = substitute(as.list(...))[-1];
 ?? ?len? = length(clst);
 ?? ?clst.all = lapply(clst, eval);
 ?? ?eval.f = function(idCond) {
 ?? ???? sapply(seq(length(isEval)), function(id) {
 ?? ???? ??? if(isEval[[id]] == FALSE) return(default);
 ?? ???? ??? args.l = lapply(clst.all, function(a) if(length(a) == 1) a 
else a[[id]]);
 ?? ???? ??? do.call(FUN[[idCond]], args.l);
 ?? ???? });
 ?? ?}
 ?? ?# eval 1st condition:
 ?? ?isEval = eval(tok[[1]]);
 ?? ?rez = eval.f(1);
 ?? ?if(length(tok) == 1) return(rez);
 ?? ?# eval remaining conditions
 ?? ?isEvalAll = isEval;
 ?? ?for(id in seq(2, length(tok))) {
 ?? ???? if(tok[[id]] == ".") {
 ?? ???? ??? # Remaining conditions: tok == ".";
 ?? ???? ??? # makes sens only on the last position
 ?? ???? ??? if(id < length(tok)) warning("\".\" is not last!");
 ?? ???? ??? isEval = ! isEvalAll;
 ?? ???? ??? rez[isEval] = eval.f(id)[isEval];
 ?? ???? ??? next;
 ?? ???? }
 ?? ???? isEval = rep(FALSE, length(isEval));
 ?? ???? isEval[ ! isEvalAll] = eval(tok[[id]])[ ! isEvalAll];
 ?? ???? isEvalAll[isEval] = isEval[isEval];
 ?? ???? rez[isEval] = eval.f(id)[isEval];
 ?? ?}
 ?? ?return(rez);
}


# current code uses the formula format:
# cond1 ~ cond 2 ~ cond3

# tokenizes a formula in its parts delimited by "~"
# Note:
# - tokenization is automatic for ",";
# - but call MUST then use FUN(expression(_conditions_), other_args, ...);
split.formula = function(e) {
 ?? ?tok = list();
 ?? ?while(length(e) > 0) {
 ?? ???? if(e[[1]] == "~") {
 ?? ???? ??? if(length(e) == 2) { tok = c(NA, e[[2]], tok); break; }
 ?? ???? ??? tok = c(e[[3]], tok);
 ?? ???? ??? e = e[[2]];
 ?? ???? } else {
 ?? ???? ??? tok = c(e, tok); break;
 ?? ???? }
 ?? ?}
 ?? ?return(tok);
}


From @v|gro@@ @end|ng |rom ver|zon@net  Sat Oct  9 21:35:55 2021
From: @v|gro@@ @end|ng |rom ver|zon@net (Avi Gross)
Date: Sat, 9 Oct 2021 15:35:55 -0400
Subject: [R] assumptions about how things are done
References: <029401d7bd44$e10843c0$a318cb40$.ref@verizon.net>
Message-ID: <029401d7bd44$e10843c0$a318cb40$@verizon.net>

This is supposed to be a forum for help so general and philosophical
discussions belong elsewhere, or nowhere.

 

Having said that, I want to make a brief point. Both new and experienced
people make implicit assumptions about the code they use. Often nobody looks
at how the sausage is made. The recent discussion of ifelse() made me take a
look and I was not thrilled.

 

My NA?VE view was that ifelse() was implemented as a sort of loop construct.
I mean if I have a vector of length N and perhaps a few other vectors of the
same length, I might say:

 

result <- ifelse(condition-on-vector-A, result-if-true-using-vectors,
result-if-false-using-vectors)

 

So say I want to take a vector of integers from 1 to N and make an output a
second vector where you have either a prime number or NA. If I have a
function called is.prime() that checks a single number and returns
TRUE/FALSE, it might look like this:

 

primed <- ifelse(is.prime(A, A, NA)

 

So A[1] will be mapped to 1 and A[2} to 2 and A[3] to 3, but A[4] being
composite becomes NA and so on.

 

If you wrote the above using loops, it would be to range from index 1 to N
and apply the above. There are many complications as R allows vectors to be
longer or to be repeated as needed.

 

What I found ifelse() as implemented to do, is sort of like this:

 

Make a vector of the right length for the results, initially empty.

 

Make a vector evaluating the condition so it is effectively a Boolean
result.

Calculate which indices are TRUE. Secondarily, calculate another set of
indices that are false.

 

Calculate ALL the THEN conditions and ditto all the ELSE conditions.

 

Now copy into the result all the THEN values indexed by the TRUE above and
than all the ELSE values indicated by the FALSE above.

 

In plain English, make a result from two other results based on picking
either one from menu A or one from menu B.

 

That is not a bad algorithm and in a vectorized language like R, maybe even
quite effective and efficient. It does lots of extra work as by definition
it throws at least half away.

 

I suspect the implementation could be made much faster by making some of it
done internally using a language like C.

 

But now that I know what this implementation did, I might have some qualms
at using it in some situations. The original complaint led to other
observations and needs and perhaps blindly using a supplied function like
ifelse() may not be a decent solution for some needs.

 

I note how I had to reorient my work elsewhere using a group of packages
called the tidyverse when they added a function to allow rowwise
manipulation of the data as compared to an ifelse-like method using all
columns at once. There is room for many approaches and if a function may not
be doing quite what you want, something else may better meet your needs OR
you may want to see if you can copy the existing function and modify it for
your own personal needs.

 

In the case we mentioned, the goal was to avoid printing selected warnings.
Since the function is readable, it can easily be modified in a copy to find
what is causing the warnings and either rewrite a bit to avoid them or start
over with perhaps your own function that tests before doing things and
avoids tripping the condition (generating a NaN) entirely.

 

Like may languages, R is a bit too rich. You can piggyback on the work of
others but with some caution as they did not necessarily have you in mind
with what they created.

 

 


	[[alternative HTML version deleted]]


From |eo@m@d@ @end|ng |rom @yon|c@eu  Sat Oct  9 23:09:11 2021
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leonard Mada)
Date: Sun, 10 Oct 2021 00:09:11 +0300
Subject: [R] How to use ifelse without invoking warnings
In-Reply-To: <55052e24-3337-12e9-09f1-7681d2d77de1@syonic.eu>
References: <55052e24-3337-12e9-09f1-7681d2d77de1@syonic.eu>
Message-ID: <04ed42ba-7ca6-d795-2603-38cca097fb38@syonic.eu>

Dear Ravi,


I have uploaded on GitHub a version which handles also constant values 
instead of functions.


Regarding named arguments: this is actually handled automatically as well:

eval.by.formula((x > 5 & x %% 2) ~ (x <= 5) ~ ., FUN, y=2, x)
# [1]? 1? 4? 9 16 25? 6 14? 8 18 10
eval.by.formula((x > 5 & x %% 2) ~ (x <= 5) ~ ., FUN, x=2, x)
# [1]? 4? 4? 4? 4? 4? 2 14? 2 18? 2
eval.by.formula((x > 5 & x %% 2) ~ (x <= 5) ~ ., list(FUN[[1]], 0, 1), 
y=2, x)
 ?# [1]? 0? 0? 0? 0? 0? 1 14? 1 18? 1


But it still needs proper testing and maybe optimization: it is possible 
to run sapply on the filtered sequence (but I did not want to break 
anything now).


Sincerely,


Leonard



On 10/9/2021 9:26 PM, Leonard Mada wrote:
> Dear Ravi,
>
>
> I wrote a small replacement for ifelse() which avoids such unnecessary 
> evaluations (it bothered me a few times as well - so I decided to try 
> a small replacement).
>
>
> ### Example:
> x = 1:10
> FUN = list();
> FUN[[1]] = function(x, y) x*y;
> FUN[[2]] = function(x, y) x^2;
> FUN[[3]] = function(x, y) x;
> # lets run multiple conditions
> # eval.by.formula(conditions, FUN.list, ... (arguments for FUN) );
> eval.by.formula((x > 5 & x %% 2) ~ (x <= 5) ~ ., FUN, x, x-1)
> # Example 2
> eval.by.formula((x > 5 & x %% 2) ~ (x <= 5) ~ ., FUN, 2, x)
>
>
> ### Disclaimer:
> - NOT properly tested;
>
>
> The code for the function is below. Maybe someone can experiment with 
> the code and improve it further. There are a few issues / open 
> questions, like:
>
> 1.) Best Name: eval.by.formula, ifelse.formula, ...?
>
> 2.) Named arguments: not yet;
>
> 3.) Fixed values inside FUN.list
>
> 4.) Format of expression for conditions:
>
> expression(cond1, cond2, cond3) vs cond1 ~ cond2 ~ cond3 ???
>
> 5.) Code efficiency
>
> - some tests on large data sets & optimizations are warranted;
>
>
> Sincerely,
>
>
> Leonard
>
> =======
>
> The latest code is on Github:
>
> https://github.com/discoleo/R/blob/master/Stat/Tools.Formulas.R
>
> [...]
>


From drj|m|emon @end|ng |rom gm@||@com  Sat Oct  9 23:34:52 2021
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Sun, 10 Oct 2021 08:34:52 +1100
Subject: [R] assumptions about how things are done
In-Reply-To: <029401d7bd44$e10843c0$a318cb40$@verizon.net>
References: <029401d7bd44$e10843c0$a318cb40$.ref@verizon.net>
 <029401d7bd44$e10843c0$a318cb40$@verizon.net>
Message-ID: <CA+8X3fUQvXUx0=cVvNVTv144PQrRHgHgp1iBiXk23R8V+9=71g@mail.gmail.com>

Hi Avi,
Definitely a learning moment. I may consider writing an ifElse() for
my own use and sharing it if anyone wants it.

Jim

On Sun, Oct 10, 2021 at 6:36 AM Avi Gross via R-help
<r-help at r-project.org> wrote:
>
> This is supposed to be a forum for help so general and philosophical
> discussions belong elsewhere, or nowhere.
>
>
>
> Having said that, I want to make a brief point. Both new and experienced
> people make implicit assumptions about the code they use. Often nobody looks
> at how the sausage is made. The recent discussion of ifelse() made me take a
> look and I was not thrilled.
>
>
>
> My NA?VE view was that ifelse() was implemented as a sort of loop construct.
> I mean if I have a vector of length N and perhaps a few other vectors of the
> same length, I might say:
>
>
>
> result <- ifelse(condition-on-vector-A, result-if-true-using-vectors,
> result-if-false-using-vectors)
>
>
>
> So say I want to take a vector of integers from 1 to N and make an output a
> second vector where you have either a prime number or NA. If I have a
> function called is.prime() that checks a single number and returns
> TRUE/FALSE, it might look like this:
>
>
>
> primed <- ifelse(is.prime(A, A, NA)
>
>
>
> So A[1] will be mapped to 1 and A[2} to 2 and A[3] to 3, but A[4] being
> composite becomes NA and so on.
>
>
>
> If you wrote the above using loops, it would be to range from index 1 to N
> and apply the above. There are many complications as R allows vectors to be
> longer or to be repeated as needed.
>
>
>
> What I found ifelse() as implemented to do, is sort of like this:
>
>
>
> Make a vector of the right length for the results, initially empty.
>
>
>
> Make a vector evaluating the condition so it is effectively a Boolean
> result.
>
> Calculate which indices are TRUE. Secondarily, calculate another set of
> indices that are false.
>
>
>
> Calculate ALL the THEN conditions and ditto all the ELSE conditions.
>
>
>
> Now copy into the result all the THEN values indexed by the TRUE above and
> than all the ELSE values indicated by the FALSE above.
>
>
>
> In plain English, make a result from two other results based on picking
> either one from menu A or one from menu B.
>
>
>
> That is not a bad algorithm and in a vectorized language like R, maybe even
> quite effective and efficient. It does lots of extra work as by definition
> it throws at least half away.
>
>
>
> I suspect the implementation could be made much faster by making some of it
> done internally using a language like C.
>
>
>
> But now that I know what this implementation did, I might have some qualms
> at using it in some situations. The original complaint led to other
> observations and needs and perhaps blindly using a supplied function like
> ifelse() may not be a decent solution for some needs.
>
>
>
> I note how I had to reorient my work elsewhere using a group of packages
> called the tidyverse when they added a function to allow rowwise
> manipulation of the data as compared to an ifelse-like method using all
> columns at once. There is room for many approaches and if a function may not
> be doing quite what you want, something else may better meet your needs OR
> you may want to see if you can copy the existing function and modify it for
> your own personal needs.
>
>
>
> In the case we mentioned, the goal was to avoid printing selected warnings.
> Since the function is readable, it can easily be modified in a copy to find
> what is causing the warnings and either rewrite a bit to avoid them or start
> over with perhaps your own function that tests before doing things and
> avoids tripping the condition (generating a NaN) entirely.
>
>
>
> Like may languages, R is a bit too rich. You can piggyback on the work of
> others but with some caution as they did not necessarily have you in mind
> with what they created.
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From r@ywong @end|ng |rom t@mu@edu  Sun Oct 10 04:39:51 2021
From: r@ywong @end|ng |rom t@mu@edu (Raymond Wong)
Date: Sat, 9 Oct 2021 21:39:51 -0500
Subject: [R] 2022 John M. Chambers Software Award
In-Reply-To: <c303bf24-2935-45bd-a2c8-eee89ecc3ae6@Spark>
References: <c303bf24-2935-45bd-a2c8-eee89ecc3ae6@Spark>
Message-ID: <5682efef-3a6f-44bc-9d42-fd8ad4306855@Spark>

Dear R-help listers,

The Statistical Computing Section of the American Statistical Association announces the competition for the John M. Chambers Statistical Software Award. In 1998 the Association for Computing Machinery (ACM) presented the ACM Software System Award to John Chambers for the design and development of S. Dr. Chambers generously donated his award to the Statistical Computing Section to endow an annual prize for statistical software written by, or in collaboration with, an undergraduate or graduate student.

Please visit?http://asa.stat.uconn.edu?for more information.

Best regards,

Raymond Wong

Awards Chair
ASA Section on Statistical Computing
ASA Section on Statistical Graphics

Associate Professor
Department of Statistics
Texas A&M University




	[[alternative HTML version deleted]]


From r@oknz @end|ng |rom gm@||@com  Sun Oct 10 08:27:27 2021
From: r@oknz @end|ng |rom gm@||@com (Richard O'Keefe)
Date: Sun, 10 Oct 2021 19:27:27 +1300
Subject: [R] assumptions about how things are done
In-Reply-To: <029401d7bd44$e10843c0$a318cb40$@verizon.net>
References: <029401d7bd44$e10843c0$a318cb40$.ref@verizon.net>
 <029401d7bd44$e10843c0$a318cb40$@verizon.net>
Message-ID: <CABcYAdKDerXkaUKTZn58nYRTtN+zSprDGTtRiE=wZ6Mauy+rbQ@mail.gmail.com>

Colour me confused.
if (...) { ... } else { ... }
is a control structure.  It requires the test to evaluate to a single
logical value,
then it evaluates one choice completely and the other not at all.
It is special syntax.

ifelse(..., ..., ...) is not a control structure.  It is not special
syntax.  It is a
normal function call, and it evaluates its arguments and expands them to
a common length just like "+" or, more to the point, just like "&".

So why do we have people expecting a normal function call to do special
control structure magic?

Leaving aside the extending-to-a-common-length part, it's
ifelse <- function (test, true.part, false.part) {
    false.part[test] <- true.part[test]
    false.part
}

Why is it so hard to understand that there is nothing special to
understand here?

On Sun, 10 Oct 2021 at 08:36, Avi Gross via R-help <r-help at r-project.org> wrote:
>
> This is supposed to be a forum for help so general and philosophical
> discussions belong elsewhere, or nowhere.
>
>
>
> Having said that, I want to make a brief point. Both new and experienced
> people make implicit assumptions about the code they use. Often nobody looks
> at how the sausage is made. The recent discussion of ifelse() made me take a
> look and I was not thrilled.
>
>
>
> My NA?VE view was that ifelse() was implemented as a sort of loop construct.
> I mean if I have a vector of length N and perhaps a few other vectors of the
> same length, I might say:
>
>
>
> result <- ifelse(condition-on-vector-A, result-if-true-using-vectors,
> result-if-false-using-vectors)
>
>
>
> So say I want to take a vector of integers from 1 to N and make an output a
> second vector where you have either a prime number or NA. If I have a
> function called is.prime() that checks a single number and returns
> TRUE/FALSE, it might look like this:
>
>
>
> primed <- ifelse(is.prime(A, A, NA)
>
>
>
> So A[1] will be mapped to 1 and A[2} to 2 and A[3] to 3, but A[4] being
> composite becomes NA and so on.
>
>
>
> If you wrote the above using loops, it would be to range from index 1 to N
> and apply the above. There are many complications as R allows vectors to be
> longer or to be repeated as needed.
>
>
>
> What I found ifelse() as implemented to do, is sort of like this:
>
>
>
> Make a vector of the right length for the results, initially empty.
>
>
>
> Make a vector evaluating the condition so it is effectively a Boolean
> result.
>
> Calculate which indices are TRUE. Secondarily, calculate another set of
> indices that are false.
>
>
>
> Calculate ALL the THEN conditions and ditto all the ELSE conditions.
>
>
>
> Now copy into the result all the THEN values indexed by the TRUE above and
> than all the ELSE values indicated by the FALSE above.
>
>
>
> In plain English, make a result from two other results based on picking
> either one from menu A or one from menu B.
>
>
>
> That is not a bad algorithm and in a vectorized language like R, maybe even
> quite effective and efficient. It does lots of extra work as by definition
> it throws at least half away.
>
>
>
> I suspect the implementation could be made much faster by making some of it
> done internally using a language like C.
>
>
>
> But now that I know what this implementation did, I might have some qualms
> at using it in some situations. The original complaint led to other
> observations and needs and perhaps blindly using a supplied function like
> ifelse() may not be a decent solution for some needs.
>
>
>
> I note how I had to reorient my work elsewhere using a group of packages
> called the tidyverse when they added a function to allow rowwise
> manipulation of the data as compared to an ifelse-like method using all
> columns at once. There is room for many approaches and if a function may not
> be doing quite what you want, something else may better meet your needs OR
> you may want to see if you can copy the existing function and modify it for
> your own personal needs.
>
>
>
> In the case we mentioned, the goal was to avoid printing selected warnings.
> Since the function is readable, it can easily be modified in a copy to find
> what is causing the warnings and either rewrite a bit to avoid them or start
> over with perhaps your own function that tests before doing things and
> avoids tripping the condition (generating a NaN) entirely.
>
>
>
> Like may languages, R is a bit too rich. You can piggyback on the work of
> others but with some caution as they did not necessarily have you in mind
> with what they created.
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From m|n@h@|| @end|ng |rom um|ch@edu  Sun Oct 10 10:18:13 2021
From: m|n@h@|| @end|ng |rom um|ch@edu (Greg Minshall)
Date: Sun, 10 Oct 2021 11:18:13 +0300
Subject: [R] assumptions about how things are done
In-Reply-To: <CABcYAdKDerXkaUKTZn58nYRTtN+zSprDGTtRiE=wZ6Mauy+rbQ@mail.gmail.com>
References: <029401d7bd44$e10843c0$a318cb40$.ref@verizon.net>
 <029401d7bd44$e10843c0$a318cb40$@verizon.net>
 <CABcYAdKDerXkaUKTZn58nYRTtN+zSprDGTtRiE=wZ6Mauy+rbQ@mail.gmail.com>
Message-ID: <2933100.1633853893@apollo2.minshall.org>

hi, Richard,

> ifelse(..., ..., ...) is not a control structure.  It is not special
> syntax.  It is a normal function call, and it evaluates its arguments
> and expands them to a common length just like "+" or, more to the
> point, just like "&".
>
> So why do we have people expecting a normal function call to do
> special control structure magic?
>
> Leaving aside the extending-to-a-common-length part, it's
> ifelse <- function (test, true.part, false.part) {
>     false.part[test] <- true.part[test]
>     false.part
> }
>
> Why is it so hard to understand that there is nothing special to
> understand here?

i wonder if possibly because features like non-standard evaluation lead
many of us to conclude there may/should/could be magic at all levels?

cheers, Greg


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Oct 10 10:28:43 2021
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sun, 10 Oct 2021 21:28:43 +1300
Subject: [R] assumptions about how things are done
In-Reply-To: <CABcYAdKDerXkaUKTZn58nYRTtN+zSprDGTtRiE=wZ6Mauy+rbQ@mail.gmail.com>
References: <029401d7bd44$e10843c0$a318cb40$.ref@verizon.net>
 <029401d7bd44$e10843c0$a318cb40$@verizon.net>
 <CABcYAdKDerXkaUKTZn58nYRTtN+zSprDGTtRiE=wZ6Mauy+rbQ@mail.gmail.com>
Message-ID: <20211010212843.5c7691c2@rolf-Latitude-E7470>


On Sun, 10 Oct 2021 19:27:27 +1300
"Richard O'Keefe" <raoknz at gmail.com> wrote:

<SNIP>

> Why is it so hard to understand that there is nothing special to
> understand here?

<SNIP>

Fortune nomination.

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From petr@p|k@| @end|ng |rom prechez@@cz  Mon Oct 11 11:15:27 2021
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Mon, 11 Oct 2021 09:15:27 +0000
Subject: [R] unexpected behavior in apply
In-Reply-To: <CAGiFhPNg+3A+gQjXOGEM=_tVAi=41hpW_Xp-F4VrZOfSCn-y4A@mail.gmail.com>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
 <CAGiFhPN4C2zinAm7_UjrdkYvtMVu7SUvVV3VUMLJYbG4Pd+XMA@mail.gmail.com>
 <CAGiFhPNg+3A+gQjXOGEM=_tVAi=41hpW_Xp-F4VrZOfSCn-y4A@mail.gmail.com>
Message-ID: <a71107e9441e476db477fe28acfff8d1@SRVEXCHCM1302.precheza.cz>

Hi

it is not surprising at all.

from apply documentation

Arguments
X	
an array, including a matrix.

data.frame is not matrix or array (even if it rather resembles one)

So if you put a cake into oven you cannot expect getting fried potatoes from
it.

For data frames sapply or lapply is preferable as it is designed for lists
and data frame is (again from documentation)

A data frame is a list of variables of the same number of rows with unique
row names, given class "data.frame".

> sapply(d,function(x) all(x[!is.na(x)]<=3))
   d1    d2    d3 
FALSE  TRUE FALSE 

Cheers
Petr


> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Jiefei Wang
> Sent: Friday, October 8, 2021 8:22 PM
> To: Derickson, Ryan, VHA NCOD <Ryan.Derickson at va.gov>
> Cc: r-help at r-project.org
> Subject: Re: [R] unexpected behavior in apply
> 
> Ok, it turns out that this is documented, even though it looks surprising.
> 
> First of all, the apply function will try to convert any object with the
dim
> attribute to a matrix(my intuition agrees with you that there should be no
> conversion), so the first step of the apply function is
> 
> > as.matrix.data.frame(d)
>      d1  d2  d3
> [1,] "a" "1" NA
> [2,] "b" "2" NA
> [3,] "c" "3" " 6"
> 
> Since the data frame `d` is a mixture of character and non-character
values,
> the non-character value will be converted to the character using the
function
> `format`. However, the problem is that the NA value will also be formatted
to
> the character
> 
> > format(c(NA, 6))
> [1] "NA" " 6"
> 
> That's where the space comes from. It is purely for making the result
pretty...
> The character NA will be removed later, but the space is not stripped. I
would
> say this is not a good design, and it might be worth not including the NA
value
> in the format function. At the current stage, I will suggest using the
function
> `lapply` to do what you want.
> 
> > lapply(d, FUN=function(x)all(x[!is.na(x)] <= 3))
> $d1
> [1] FALSE
> $d2
> [1] TRUE
> $d3
> [1] FALSE
> 
> Everything should work as you expect.
> 
> Best,
> Jiefei
> 
> On Sat, Oct 9, 2021 at 2:03 AM Jiefei Wang <szwjf08 at gmail.com> wrote:
> >
> > Hi,
> >
> > I guess this can tell you what happens behind the scene
> >
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(NA,NA,6))
> > > apply(d, 2, FUN=function(x)x)
> >      d1  d2  d3
> > [1,] "a" "1" NA
> > [2,] "b" "2" NA
> > [3,] "c" "3" " 6"
> > > "a"<=3
> > [1] FALSE
> > > "2"<=3
> > [1] TRUE
> > > "6"<=3
> > [1] FALSE
> >
> > Note that there is an additional space in the character value " 6",
> > that's why your comparison fails. I do not understand why but this
> > might be a bug in R
> >
> > Best,
> > Jiefei
> >
> > On Sat, Oct 9, 2021 at 1:49 AM Derickson, Ryan, VHA NCOD via R-help
> > <r-help at r-project.org> wrote:
> > >
> > > Hello,
> > >
> > > I'm seeing unexpected behavior when using apply() compared to a for
> loop when a character vector is part of the data subjected to the apply
> statement. Below, I check whether all non-missing values are <= 3. If I
> include a character column, apply incorrectly returns TRUE for d3. If I
only
> pass the numeric columns to apply, it is correct for d3. If I use a for
loop, it is
> correct.
> > >
> > > > d<-data.frame(d1 = letters[1:3],
> > > +               d2 = c(1,2,3),
> > > +               d3 = c(NA,NA,6))
> > > >
> > > > d
> > >   d1 d2 d3
> > > 1  a  1 NA
> > > 2  b  2 NA
> > > 3  c  3  6
> > > >
> > > > # results are incorrect
> > > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d1    d2    d3
> > > FALSE  TRUE  TRUE
> > > >
> > > > # results are correct
> > > > apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d2    d3
> > >  TRUE FALSE
> > > >
> > > > # results are correct
> > > > for(i in names(d)){
> > > +   print(all(d[!is.na(d[,i]),i] <= 3)) }
> > > [1] FALSE
> > > [1] TRUE
> > > [1] FALSE
> > >
> > >
> > > Finally, if I remove the NA values from d3 and include the character
> column in apply, it is correct.
> > >
> > > > d<-data.frame(d1 = letters[1:3],
> > > +               d2 = c(1,2,3),
> > > +               d3 = c(4,5,6))
> > > >
> > > > d
> > >   d1 d2 d3
> > > 1  a  1  4
> > > 2  b  2  5
> > > 3  c  3  6
> > > >
> > > > # results are correct
> > > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d1    d2    d3
> > > FALSE  TRUE FALSE
> > >
> > >
> > > Can someone help me understand what's happening?
> > >
> > > ______________________________________________
> > > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide
> > > http://www.R-project.org/posting-guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-
> guide.html
> and provide commented, minimal, self-contained, reproducible code.

From m@rong|u@|u|g| @end|ng |rom gm@||@com  Mon Oct 11 13:46:36 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Mon, 11 Oct 2021 13:46:36 +0200
Subject: [R] Missing text in lattice key legend
Message-ID: <CAMk+s2SWKE1a8aB2wyTR9q8HQhQVpsBUksWDo2NzTurVywT+ZA@mail.gmail.com>

Hello,
I am drawing some data with lattice using:
```
library(lattice)
COLS = c("gold", "forestgreen", "darkslategray3", "purple")
xyplot(Value ~ Concentration,
       group = Substance, data = inf_avg,
       pch = 16, cex = 1.2, type = "b",
       xlab=expression(bold(paste("Concentration (", mu, "M)"))),
       ylab=expression(bold("Infection rate")),
       col=COLS,
       scales = list(x = list(log = 10, at=c(unique(inf_avg$Concentration))
                              )
                     ),
       key = list(space="top", columns=4, col = "black",
                       points=list(pch=c(16, 16, 16, 16),
                                   col=COLS,
                                   text=list(c("6-PN", "8-PN", "IX", "XN")
                                            )
                                   )
                  ),
       panel = function(x,y) {
         panel.xyplot(x,y)
         errbar()
       }
)
```
It all works but the legend only shows the colored dots, there is no
text. Is it something missing from the syntax?
Thanks

-- 
Best regards,
Luigi


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Mon Oct 11 14:11:06 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Mon, 11 Oct 2021 14:11:06 +0200
Subject: [R] How to add error bars to lattice xyplot
Message-ID: <CAMk+s2TMivV+OOT-Saapdz_HJhD8-rFfkdRBxdfOYyhkkm10WQ@mail.gmail.com>

Hello,
I am trying to plot data using lattice. The basic plot works:
```
Substance = rep(c("A", "B", "C", "D"),4)
Concentration = rep(1:4,4),
Value = c(62.80666667, 116.26333333,  92.26000000,   9.87333333,  14.82333333,
          92.37333333, 98.95666667,   1.48333333,   0.64666667,  50.66000000,
          25.75333333,   0.69000000, 0.21666667,   7.40666667,   6.92000000,
          0.06333333)
df = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
Value = c(15.2974126, 16.3196089, 57.4294280,  9.1943370, 20.5567321,
14.0874424,
       38.3626672, 0.3780653,  0.4738495, 37.9124874, 16.2473916,  0.7218726,
       0.2498666,  8.4537585, 10.8058456,  0.1096966)
dfsd = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)

library(lattice)
COLS = c("gold", "forestgreen", "darkslategray3", "purple")
xyplot(Value ~ Concentration,
       group = Substance, data = df,
       pch = 16, cex = 1.2, type = "b",
       xlab=expression(bold(paste("Concentration (", mu, "M)"))),
       ylab=expression(bold("Infection rate")),
       col=COLS,
       scales = list(x = list(log = 10, at=c(unique(df$Concentration))
       )
       ),
       key = list(space="top", columns=4, col = "black",
                  points=list(pch=c(16, 16, 16, 16),
                              col=COLS,
                              text=list(c("6-PN", "8-PN", "IX", "XN")
                              )
                  )
       )

)
```
but how do I add the error bars?
I tried with
```
xyplot(Value ~ Concentration,
       group = Substance, data = df,
       pch = 16, cex = 1.2, type = "b",
       xlab=expression(bold(paste("Concentration (", mu, "M)"))),
       ylab=expression(bold("Infection rate")),
       col=COLS,
       scales = list(x = list(log = 10, at=c(unique(df$Concentration))
       )
       ),
       key = list(space="top", columns=4, col = "black",
                  points=list(pch=c(16, 16, 16, 16),
                              col=COLS,
                              text=list(c("6-PN", "8-PN", "IX", "XN")
                              )
                  )
       ),
       panel = function (x,y,) {
         panel.segments(x0 = df$Concentration, x1 = df$Concentration,
                        y0 = df$Value - dfsd$Value,
                        y1 = df$Value + dfsd$Value,
                        col = COLS)
       }

)
```
but the bars are plotted outside the graph.
What is the correct syntax? can I use raw data instead of making the
mean and std dev separately?
Thanks

-- 
Best regards,
Luigi


From deep@y@n@@@rk@r @end|ng |rom gm@||@com  Mon Oct 11 14:18:54 2021
From: deep@y@n@@@rk@r @end|ng |rom gm@||@com (Deepayan Sarkar)
Date: Mon, 11 Oct 2021 17:48:54 +0530
Subject: [R] Missing text in lattice key legend
In-Reply-To: <CAMk+s2SWKE1a8aB2wyTR9q8HQhQVpsBUksWDo2NzTurVywT+ZA@mail.gmail.com>
References: <CAMk+s2SWKE1a8aB2wyTR9q8HQhQVpsBUksWDo2NzTurVywT+ZA@mail.gmail.com>
Message-ID: <CADfFDC6VQfQZutNsRhSgd64qeGMGAtxxHG3xPfJDLjwAFJu82w@mail.gmail.com>

On Mon, Oct 11, 2021 at 5:17 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>
> Hello,
> I am drawing some data with lattice using:
> ```
> library(lattice)
> COLS = c("gold", "forestgreen", "darkslategray3", "purple")
> xyplot(Value ~ Concentration,
>        group = Substance, data = inf_avg,
>        pch = 16, cex = 1.2, type = "b",
>        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>        ylab=expression(bold("Infection rate")),
>        col=COLS,
>        scales = list(x = list(log = 10, at=c(unique(inf_avg$Concentration))
>                               )
>                      ),
>        key = list(space="top", columns=4, col = "black",
>                        points=list(pch=c(16, 16, 16, 16),
>                                    col=COLS,
>                                    text=list(c("6-PN", "8-PN", "IX", "XN")
>                                             )
>                                    )
>                   ),
>        panel = function(x,y) {
>          panel.xyplot(x,y)
>          errbar()
>        }
> )
> ```
> It all works but the legend only shows the colored dots, there is no
> text. Is it something missing from the syntax?

Your text component is nested inside the points component. I think you
want it outside, e.g.,

xyplot(1 ~ 1,
       key = list(space="top", columns=4, col = "black",
                  points=list(pch=c(16, 16, 16, 16),
                              col=COLS),
                  text=list(c("6-PN", "8-PN", "IX", "XN"))
                  ))

Best,
-Deepayan

> Thanks
>
> --
> Best regards,
> Luigi
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Mon Oct 11 14:38:36 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Mon, 11 Oct 2021 14:38:36 +0200
Subject: [R] Missing text in lattice key legend
In-Reply-To: <CADfFDC6VQfQZutNsRhSgd64qeGMGAtxxHG3xPfJDLjwAFJu82w@mail.gmail.com>
References: <CAMk+s2SWKE1a8aB2wyTR9q8HQhQVpsBUksWDo2NzTurVywT+ZA@mail.gmail.com>
 <CADfFDC6VQfQZutNsRhSgd64qeGMGAtxxHG3xPfJDLjwAFJu82w@mail.gmail.com>
Message-ID: <CAMk+s2R=kUhiCze_LWqhLw6Ee+oH6h_uwgDyTVkkPzTAfsh4VQ@mail.gmail.com>

Awesome, thanks!

On Mon, Oct 11, 2021 at 2:19 PM Deepayan Sarkar
<deepayan.sarkar at gmail.com> wrote:
>
> On Mon, Oct 11, 2021 at 5:17 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
> >
> > Hello,
> > I am drawing some data with lattice using:
> > ```
> > library(lattice)
> > COLS = c("gold", "forestgreen", "darkslategray3", "purple")
> > xyplot(Value ~ Concentration,
> >        group = Substance, data = inf_avg,
> >        pch = 16, cex = 1.2, type = "b",
> >        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
> >        ylab=expression(bold("Infection rate")),
> >        col=COLS,
> >        scales = list(x = list(log = 10, at=c(unique(inf_avg$Concentration))
> >                               )
> >                      ),
> >        key = list(space="top", columns=4, col = "black",
> >                        points=list(pch=c(16, 16, 16, 16),
> >                                    col=COLS,
> >                                    text=list(c("6-PN", "8-PN", "IX", "XN")
> >                                             )
> >                                    )
> >                   ),
> >        panel = function(x,y) {
> >          panel.xyplot(x,y)
> >          errbar()
> >        }
> > )
> > ```
> > It all works but the legend only shows the colored dots, there is no
> > text. Is it something missing from the syntax?
>
> Your text component is nested inside the points component. I think you
> want it outside, e.g.,
>
> xyplot(1 ~ 1,
>        key = list(space="top", columns=4, col = "black",
>                   points=list(pch=c(16, 16, 16, 16),
>                               col=COLS),
>                   text=list(c("6-PN", "8-PN", "IX", "XN"))
>                   ))
>
> Best,
> -Deepayan
>
> > Thanks
> >
> > --
> > Best regards,
> > Luigi
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.



-- 
Best regards,
Luigi


From deep@y@n@@@rk@r @end|ng |rom gm@||@com  Mon Oct 11 15:55:54 2021
From: deep@y@n@@@rk@r @end|ng |rom gm@||@com (Deepayan Sarkar)
Date: Mon, 11 Oct 2021 19:25:54 +0530
Subject: [R] How to add error bars to lattice xyplot
In-Reply-To: <CAMk+s2TMivV+OOT-Saapdz_HJhD8-rFfkdRBxdfOYyhkkm10WQ@mail.gmail.com>
References: <CAMk+s2TMivV+OOT-Saapdz_HJhD8-rFfkdRBxdfOYyhkkm10WQ@mail.gmail.com>
Message-ID: <CADfFDC4bYN4cv87AcddwdFL7Pg2u6bCOZrNHuKB7Y3anisF4Jw@mail.gmail.com>

On Mon, Oct 11, 2021 at 5:41 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>
> Hello,
> I am trying to plot data using lattice. The basic plot works:
> ```
> Substance = rep(c("A", "B", "C", "D"),4)
> Concentration = rep(1:4,4),
> Value = c(62.80666667, 116.26333333,  92.26000000,   9.87333333,  14.82333333,
>           92.37333333, 98.95666667,   1.48333333,   0.64666667,  50.66000000,
>           25.75333333,   0.69000000, 0.21666667,   7.40666667,   6.92000000,
>           0.06333333)
> df = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
> Value = c(15.2974126, 16.3196089, 57.4294280,  9.1943370, 20.5567321,
> 14.0874424,
>        38.3626672, 0.3780653,  0.4738495, 37.9124874, 16.2473916,  0.7218726,
>        0.2498666,  8.4537585, 10.8058456,  0.1096966)
> dfsd = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
>
> library(lattice)
> COLS = c("gold", "forestgreen", "darkslategray3", "purple")
> xyplot(Value ~ Concentration,
>        group = Substance, data = df,
>        pch = 16, cex = 1.2, type = "b",
>        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>        ylab=expression(bold("Infection rate")),
>        col=COLS,
>        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
>        )
>        ),
>        key = list(space="top", columns=4, col = "black",
>                   points=list(pch=c(16, 16, 16, 16),
>                               col=COLS,
>                               text=list(c("6-PN", "8-PN", "IX", "XN")
>                               )
>                   )
>        )
>
> )
> ```
> but how do I add the error bars?
> I tried with
> ```
> xyplot(Value ~ Concentration,
>        group = Substance, data = df,
>        pch = 16, cex = 1.2, type = "b",
>        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>        ylab=expression(bold("Infection rate")),
>        col=COLS,
>        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
>        )
>        ),
>        key = list(space="top", columns=4, col = "black",
>                   points=list(pch=c(16, 16, 16, 16),
>                               col=COLS,
>                               text=list(c("6-PN", "8-PN", "IX", "XN")
>                               )
>                   )
>        ),
>        panel = function (x,y,) {
>          panel.segments(x0 = df$Concentration, x1 = df$Concentration,
>                         y0 = df$Value - dfsd$Value,
>                         y1 = df$Value + dfsd$Value,
>                         col = COLS)
>        }
>
> )
> ```
> but the bars are plotted outside the graph.

You need to apply the log-transformation yourself, e.g.,

         panel.segments(x0 = log10(df$Concentration), x1 =
log10(df$Concentration),

But this is not really a scalable approach. You should check if
Hmisc::xYplot suits your needs:

https://search.r-project.org/CRAN/refmans/Hmisc/html/xYplot.html

Best,
-Deepayan

> What is the correct syntax? can I use raw data instead of making the
> mean and std dev separately?
> Thanks
>
> --
> Best regards,
> Luigi
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From rmh @end|ng |rom temp|e@edu  Mon Oct 11 16:22:25 2021
From: rmh @end|ng |rom temp|e@edu (Richard M. Heiberger)
Date: Mon, 11 Oct 2021 14:22:25 +0000
Subject: [R] [External]  Missing text in lattice key legend
In-Reply-To: <CAMk+s2SWKE1a8aB2wyTR9q8HQhQVpsBUksWDo2NzTurVywT+ZA@mail.gmail.com>
References: <CAMk+s2SWKE1a8aB2wyTR9q8HQhQVpsBUksWDo2NzTurVywT+ZA@mail.gmail.com>
Message-ID: <BL1PR11MB523999CF72669E54D13EE543D2B59@BL1PR11MB5239.namprd11.prod.outlook.com>

looks like a paren outof place.  the text is inside the points. it should be parallel to the points in the calling sequence.

Get Outlook for iOS<https://aka.ms/o0ukef>
________________________________
From: R-help <r-help-bounces at r-project.org> on behalf of Luigi Marongiu <marongiu.luigi at gmail.com>
Sent: Monday, October 11, 2021 7:46:36 AM
To: r-help <r-help at r-project.org>
Subject: [External] [R] Missing text in lattice key legend

Hello,
I am drawing some data with lattice using:
```
library(lattice)
COLS = c("gold", "forestgreen", "darkslategray3", "purple")
xyplot(Value ~ Concentration,
       group = Substance, data = inf_avg,
       pch = 16, cex = 1.2, type = "b",
       xlab=expression(bold(paste("Concentration (", mu, "M)"))),
       ylab=expression(bold("Infection rate")),
       col=COLS,
       scales = list(x = list(log = 10, at=c(unique(inf_avg$Concentration))
                              )
                     ),
       key = list(space="top", columns=4, col = "black",
                       points=list(pch=c(16, 16, 16, 16),
                                   col=COLS,
                                   text=list(c("6-PN", "8-PN", "IX", "XN")
                                            )
                                   )
                  ),
       panel = function(x,y) {
         panel.xyplot(x,y)
         errbar()
       }
)
```
It all works but the legend only shows the colored dots, there is no
text. Is it something missing from the syntax?
Thanks

--
Best regards,
Luigi

______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7Crmh%40temple.edu%7C3f303633d643499924e208d98cacdaef%7C716e81efb52244738e3110bd02ccf6e5%7C0%7C0%7C637695496888670932%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=98vQNMB7OcS%2B2R73ZMngEeg%2BP6PeP3oCAOUDHxs9SU8%3D&amp;reserved=0
PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=04%7C01%7Crmh%40temple.edu%7C3f303633d643499924e208d98cacdaef%7C716e81efb52244738e3110bd02ccf6e5%7C0%7C0%7C637695496888670932%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=1yzXmD57qql7UXEKNqdK8Iq1vhfkUYf%2BpX8gvfvD3p0%3D&amp;reserved=0
and provide commented, minimal, self-contained, reproducible code.

	[[alternative HTML version deleted]]


From JH@rm@e @end|ng |rom roku@com  Mon Oct 11 17:08:03 2021
From: JH@rm@e @end|ng |rom roku@com (Jorgen Harmse)
Date: Mon, 11 Oct 2021 15:08:03 +0000
Subject: [R] assumptions about how things are done
Message-ID: <C9330D44-9671-438C-9FC2-5F0CC11C8C32@roku.com>

As noted by Richard O'Keefe, what usually happens in an R function is that any argument is evaluated either in its entirety or not at all. A few functions use substitute or similar trickery, but then expectations should be documented. I can understand that you want something like ifelse(y>x,x/y,z) to run without warning about division by zero, but how would that be implemented in general? Even a subexpression as simple as f(a,b) presents a problem: you want f(a,b)[cond], but you don't know how the function f works. It might be just a vector operation (and then perhaps f(a[cond],b[cond]) is what we want), or it might return a+rev(b). Avi Gross correctly notes that the implementation is not what he wants, but I think that what he wants is possible only in special cases.

Regards,
Jorgen Harmse. 

?

    Message: 2
    Date: Sat, 9 Oct 2021 15:35:55 -0400
    From: "Avi Gross" <avigross at verizon.net>
    To: <r-help at r-project.org>
    Subject: [R] assumptions about how things are done
    Message-ID: <029401d7bd44$e10843c0$a318cb40$@verizon.net>
    Content-Type: text/plain; charset="utf-8"

    This is supposed to be a forum for help so general and philosophical
    discussions belong elsewhere, or nowhere.



    Having said that, I want to make a brief point. Both new and experienced
    people make implicit assumptions about the code they use. Often nobody looks
    at how the sausage is made. The recent discussion of ifelse() made me take a
    look and I was not thrilled.



    My NA?VE view was that ifelse() was implemented as a sort of loop construct.
    I mean if I have a vector of length N and perhaps a few other vectors of the
    same length, I might say:



    result <- ifelse(condition-on-vector-A, result-if-true-using-vectors,
    result-if-false-using-vectors)



    So say I want to take a vector of integers from 1 to N and make an output a
    second vector where you have either a prime number or NA. If I have a
    function called is.prime() that checks a single number and returns
    TRUE/FALSE, it might look like this:



    primed <- ifelse(is.prime(A, A, NA)



    So A[1] will be mapped to 1 and A[2} to 2 and A[3] to 3, but A[4] being
    composite becomes NA and so on.



    If you wrote the above using loops, it would be to range from index 1 to N
    and apply the above. There are many complications as R allows vectors to be
    longer or to be repeated as needed.



    What I found ifelse() as implemented to do, is sort of like this:



    Make a vector of the right length for the results, initially empty.



    Make a vector evaluating the condition so it is effectively a Boolean
    result.

    Calculate which indices are TRUE. Secondarily, calculate another set of
    indices that are false.



    Calculate ALL the THEN conditions and ditto all the ELSE conditions.



    Now copy into the result all the THEN values indexed by the TRUE above and
    than all the ELSE values indicated by the FALSE above.



    In plain English, make a result from two other results based on picking
    either one from menu A or one from menu B.



    That is not a bad algorithm and in a vectorized language like R, maybe even
    quite effective and efficient. It does lots of extra work as by definition
    it throws at least half away.



    I suspect the implementation could be made much faster by making some of it
    done internally using a language like C.



    But now that I know what this implementation did, I might have some qualms
    at using it in some situations. The original complaint led to other
    observations and needs and perhaps blindly using a supplied function like
    ifelse() may not be a decent solution for some needs.



    I note how I had to reorient my work elsewhere using a group of packages
    called the tidyverse when they added a function to allow rowwise
    manipulation of the data as compared to an ifelse-like method using all
    columns at once. There is room for many approaches and if a function may not
    be doing quite what you want, something else may better meet your needs OR
    you may want to see if you can copy the existing function and modify it for
    your own personal needs.



    In the case we mentioned, the goal was to avoid printing selected warnings.
    Since the function is readable, it can easily be modified in a copy to find
    what is causing the warnings and either rewrite a bit to avoid them or start
    over with perhaps your own function that tests before doing things and
    avoids tripping the condition (generating a NaN) entirely.



    Like may languages, R is a bit too rich. You can piggyback on the work of
    others but with some caution as they did not necessarily have you in mind
    with what they created.






    	[[alternative HTML version deleted]]





    ------------------------------

    Message: 4
    Date: Sun, 10 Oct 2021 08:34:52 +1100
    From: Jim Lemon <drjimlemon at gmail.com>
    To: Avi Gross <avigross at verizon.net>
    Cc: r-help mailing list <r-help at r-project.org>
    Subject: Re: [R] assumptions about how things are done
    Message-ID:
    	<CA+8X3fUQvXUx0=cVvNVTv144PQrRHgHgp1iBiXk23R8V+9=71g at mail.gmail.com>
    Content-Type: text/plain; charset="utf-8"

    Hi Avi,
    Definitely a learning moment. I may consider writing an ifElse() for
    my own use and sharing it if anyone wants it.

    Jim

    On Sun, Oct 10, 2021 at 6:36 AM Avi Gross via R-help
    <r-help at r-project.org> wrote:
    >
    > This is supposed to be a forum for help so general and philosophical
    > discussions belong elsewhere, or nowhere.
    >
    >
    >
    > Having said that, I want to make a brief point. Both new and experienced
    > people make implicit assumptions about the code they use. Often nobody looks
    > at how the sausage is made. The recent discussion of ifelse() made me take a
    > look and I was not thrilled.
    >
    >
    >
    > My NA?VE view was that ifelse() was implemented as a sort of loop construct.
    > I mean if I have a vector of length N and perhaps a few other vectors of the
    > same length, I might say:
    >
    >
    >
    > result <- ifelse(condition-on-vector-A, result-if-true-using-vectors,
    > result-if-false-using-vectors)
    >
    >
    >
    > So say I want to take a vector of integers from 1 to N and make an output a
    > second vector where you have either a prime number or NA. If I have a
    > function called is.prime() that checks a single number and returns
    > TRUE/FALSE, it might look like this:
    >
    >
    >
    > primed <- ifelse(is.prime(A, A, NA)
    >
    >
    >
    > So A[1] will be mapped to 1 and A[2} to 2 and A[3] to 3, but A[4] being
    > composite becomes NA and so on.
    >
    >
    >
    > If you wrote the above using loops, it would be to range from index 1 to N
    > and apply the above. There are many complications as R allows vectors to be
    > longer or to be repeated as needed.
    >
    >
    >
    > What I found ifelse() as implemented to do, is sort of like this:
    >
    >
    >
    > Make a vector of the right length for the results, initially empty.
    >
    >
    >
    > Make a vector evaluating the condition so it is effectively a Boolean
    > result.
    >
    > Calculate which indices are TRUE. Secondarily, calculate another set of
    > indices that are false.
    >
    >
    >
    > Calculate ALL the THEN conditions and ditto all the ELSE conditions.
    >
    >
    >
    > Now copy into the result all the THEN values indexed by the TRUE above and
    > than all the ELSE values indicated by the FALSE above.
    >
    >
    >
    > In plain English, make a result from two other results based on picking
    > either one from menu A or one from menu B.
    >
    >
    >
    > That is not a bad algorithm and in a vectorized language like R, maybe even
    > quite effective and efficient. It does lots of extra work as by definition
    > it throws at least half away.
    >
    >
    >
    > I suspect the implementation could be made much faster by making some of it
    > done internally using a language like C.
    >
    >
    >
    > But now that I know what this implementation did, I might have some qualms
    > at using it in some situations. The original complaint led to other
    > observations and needs and perhaps blindly using a supplied function like
    > ifelse() may not be a decent solution for some needs.
    >
    >
    >
    > I note how I had to reorient my work elsewhere using a group of packages
    > called the tidyverse when they added a function to allow rowwise
    > manipulation of the data as compared to an ifelse-like method using all
    > columns at once. There is room for many approaches and if a function may not
    > be doing quite what you want, something else may better meet your needs OR
    > you may want to see if you can copy the existing function and modify it for
    > your own personal needs.
    >
    >
    >
    > In the case we mentioned, the goal was to avoid printing selected warnings.
    > Since the function is readable, it can easily be modified in a copy to find
    > what is causing the warnings and either rewrite a bit to avoid them or start
    > over with perhaps your own function that tests before doing things and
    > avoids tripping the condition (generating a NaN) entirely.
    >
    >
    >
    > Like may languages, R is a bit too rich. You can piggyback on the work of
    > others but with some caution as they did not necessarily have you in mind
    > with what they created.
    >
    >
    >
    >
    >
    >
    >         [[alternative HTML version deleted]]
    >
    > ______________________________________________
    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    > https://stat.ethz.ch/mailman/listinfo/r-help
    > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
    > and provide commented, minimal, self-contained, reproducible code.





From M|ke@Conk||n @end|ng |rom g|k@com  Mon Oct 11 18:24:01 2021
From: M|ke@Conk||n @end|ng |rom g|k@com (Conklin, Mike (GfK))
Date: Mon, 11 Oct 2021 16:24:01 +0000
Subject: [R] How to read from a file within a gzipped file
Message-ID: <CWXP123MB4952F49DC4D769102F4A877899B59@CWXP123MB4952.GBRP123.PROD.OUTLOOK.COM>


Hi have a large number of zipped files, each containing 3 xml files that I want to read.  I would like to read one of the xml files without having to decompress each zip file first.

If I run gzfile(path2zipped file) I get

A connection with
description "X:/Mkt Science/Projects/ tv/202109.ext/tsa.20210901.xml.zip"
class       "gzfile"
mode        "rb"
text        "text"
opened      "closed"
can read    "yes"
can write   "yes"

Within that zipped file I want to read from

"20210901.socioDemos.a.xml" which is one of 3 xml files within the zip file



Is there a way to return a connection to a single file within a zipped file using gzfile or some other method.



--
W. Michael Conklin
Executive Vice President
Marketing & Data Sciences - North America
GfK
mike.conklin at gfk.com<mailto:mike.conklin at gfk.com>
M +1 612 567 8287
www.gfk.com<http://www.gfk.com/>


	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Oct 11 19:01:55 2021
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 11 Oct 2021 20:01:55 +0300
Subject: [R] How to read from a file within a gzipped file
In-Reply-To: <CWXP123MB4952F49DC4D769102F4A877899B59@CWXP123MB4952.GBRP123.PROD.OUTLOOK.COM>
References: <CWXP123MB4952F49DC4D769102F4A877899B59@CWXP123MB4952.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <20211011200155.0b3a6566@Tarkus>

On Mon, 11 Oct 2021 16:24:01 +0000
"Conklin, Mike (GfK) via R-help" <r-help at r-project.org> wrote:

> Is there a way to return a connection to a single file within a
> zipped file using gzfile or some other method.

Sure! Use unz() instead of gzfile().

-- 
Best regards,
Ivan


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Mon Oct 11 19:16:52 2021
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Mon, 11 Oct 2021 18:16:52 +0100
Subject: [R] How to read from a file within a gzipped file
In-Reply-To: <CWXP123MB4952F49DC4D769102F4A877899B59@CWXP123MB4952.GBRP123.PROD.OUTLOOK.COM>
References: <CWXP123MB4952F49DC4D769102F4A877899B59@CWXP123MB4952.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <f4ef7179-e2ee-e694-8c48-74a38877c9a3@sapo.pt>

Hello,

You can create a connection and read from it.

desc <- "X:/Mkt Science/Projects/ tv/202109.ext/tsa.20210901.xml.zip"
fname <- "20210901.socioDemos.a.xml"
zz <- unz(desc, fname)


Now read from zz. Example:


xml <- XML::xmlParse(zz)


Hope this helps,

Rui Barradas

?s 17:24 de 11/10/21, Conklin, Mike (GfK) via R-help escreveu:
> 
> Hi have a large number of zipped files, each containing 3 xml files that I want to read.  I would like to read one of the xml files without having to decompress each zip file first.
> 
> If I run gzfile(path2zipped file) I get
> 
> A connection with
> description "X:/Mkt Science/Projects/ tv/202109.ext/tsa.20210901.xml.zip"
> class       "gzfile"
> mode        "rb"
> text        "text"
> opened      "closed"
> can read    "yes"
> can write   "yes"
> 
> Within that zipped file I want to read from
> 
> "20210901.socioDemos.a.xml" which is one of 3 xml files within the zip file
> 
> 
> 
> Is there a way to return a connection to a single file within a zipped file using gzfile or some other method.
> 
> 
> 
> --
> W. Michael Conklin
> Executive Vice President
> Marketing & Data Sciences - North America
> GfK
> mike.conklin at gfk.com<mailto:mike.conklin at gfk.com>
> M +1 612 567 8287
> www.gfk.com<http://www.gfk.com/>
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Mon Oct 11 20:58:08 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Mon, 11 Oct 2021 20:58:08 +0200
Subject: [R] [External]  Missing text in lattice key legend
In-Reply-To: <BL1PR11MB523999CF72669E54D13EE543D2B59@BL1PR11MB5239.namprd11.prod.outlook.com>
References: <CAMk+s2SWKE1a8aB2wyTR9q8HQhQVpsBUksWDo2NzTurVywT+ZA@mail.gmail.com>
 <BL1PR11MB523999CF72669E54D13EE543D2B59@BL1PR11MB5239.namprd11.prod.outlook.com>
Message-ID: <CAMk+s2Tv08yYj1aVH78SukjbotQm5yTWGYEP-fZ5EQebXAteMQ@mail.gmail.com>

Yes, that was the case. Now it works! Thanks

On Mon, Oct 11, 2021 at 4:22 PM Richard M. Heiberger <rmh at temple.edu> wrote:
>
> looks like a paren outof place.  the text is inside the points. it should be parallel to the points in the calling sequence.
>
> Get Outlook for iOS
> ________________________________
> From: R-help <r-help-bounces at r-project.org> on behalf of Luigi Marongiu <marongiu.luigi at gmail.com>
> Sent: Monday, October 11, 2021 7:46:36 AM
> To: r-help <r-help at r-project.org>
> Subject: [External] [R] Missing text in lattice key legend
>
> Hello,
> I am drawing some data with lattice using:
> ```
> library(lattice)
> COLS = c("gold", "forestgreen", "darkslategray3", "purple")
> xyplot(Value ~ Concentration,
>        group = Substance, data = inf_avg,
>        pch = 16, cex = 1.2, type = "b",
>        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>        ylab=expression(bold("Infection rate")),
>        col=COLS,
>        scales = list(x = list(log = 10, at=c(unique(inf_avg$Concentration))
>                               )
>                      ),
>        key = list(space="top", columns=4, col = "black",
>                        points=list(pch=c(16, 16, 16, 16),
>                                    col=COLS,
>                                    text=list(c("6-PN", "8-PN", "IX", "XN")
>                                             )
>                                    )
>                   ),
>        panel = function(x,y) {
>          panel.xyplot(x,y)
>          errbar()
>        }
> )
> ```
> It all works but the legend only shows the colored dots, there is no
> text. Is it something missing from the syntax?
> Thanks
>
> --
> Best regards,
> Luigi
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-help&amp;data=04%7C01%7Crmh%40temple.edu%7C3f303633d643499924e208d98cacdaef%7C716e81efb52244738e3110bd02ccf6e5%7C0%7C0%7C637695496888670932%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=98vQNMB7OcS%2B2R73ZMngEeg%2BP6PeP3oCAOUDHxs9SU8%3D&amp;reserved=0
> PLEASE do read the posting guide https://nam10.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.r-project.org%2Fposting-guide.html&amp;data=04%7C01%7Crmh%40temple.edu%7C3f303633d643499924e208d98cacdaef%7C716e81efb52244738e3110bd02ccf6e5%7C0%7C0%7C637695496888670932%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=1yzXmD57qql7UXEKNqdK8Iq1vhfkUYf%2BpX8gvfvD3p0%3D&amp;reserved=0
> and provide commented, minimal, self-contained, reproducible code.



-- 
Best regards,
Luigi


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Mon Oct 11 21:24:13 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Mon, 11 Oct 2021 21:24:13 +0200
Subject: [R] How to add error bars to lattice xyplot
In-Reply-To: <CADfFDC4bYN4cv87AcddwdFL7Pg2u6bCOZrNHuKB7Y3anisF4Jw@mail.gmail.com>
References: <CAMk+s2TMivV+OOT-Saapdz_HJhD8-rFfkdRBxdfOYyhkkm10WQ@mail.gmail.com>
 <CADfFDC4bYN4cv87AcddwdFL7Pg2u6bCOZrNHuKB7Y3anisF4Jw@mail.gmail.com>
Message-ID: <CAMk+s2Qo6gOzDsbtykvDzxF6hGGo5TSw9VBu8zMhyereJMmvbQ@mail.gmail.com>

Thanks,
now I got the bars (although without notch) but I lost the main plot:
```
xyplot(Value ~ Concentration,
group = Substance, data = df,
pch = 16, cex = 1.2, type = "b",
xlab=expression(bold(paste("Concentration (", mu, "M)"))),
ylab=expression(bold("Infection rate")),
col=COLS,
scales = list(x = list(log = 10, at=c(unique(df$Concentration))
)
),
key = list(space="top", columns=4, col = "black",
points=list(pch=c(16, 16, 16, 16),
col=COLS
),
text=list(c("A", "B", "C", "D")
)
),
panel = function (x,y) {
panel.segments(x0 = log10(df$Concentration),
x1 = log10(df$Concentration),
y0 = df$Value - dfsd$Value,
y1 = df$Value + dfsd$Value,
col = COLS)
}

)
```
I will check xYplot out, I think it is the tool for the job.

On Mon, Oct 11, 2021 at 3:56 PM Deepayan Sarkar
<deepayan.sarkar at gmail.com> wrote:
>
> On Mon, Oct 11, 2021 at 5:41 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
> >
> > Hello,
> > I am trying to plot data using lattice. The basic plot works:
> > ```
> > Substance = rep(c("A", "B", "C", "D"),4)
> > Concentration = rep(1:4,4),
> > Value = c(62.80666667, 116.26333333,  92.26000000,   9.87333333,  14.82333333,
> >           92.37333333, 98.95666667,   1.48333333,   0.64666667,  50.66000000,
> >           25.75333333,   0.69000000, 0.21666667,   7.40666667,   6.92000000,
> >           0.06333333)
> > df = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
> > Value = c(15.2974126, 16.3196089, 57.4294280,  9.1943370, 20.5567321,
> > 14.0874424,
> >        38.3626672, 0.3780653,  0.4738495, 37.9124874, 16.2473916,  0.7218726,
> >        0.2498666,  8.4537585, 10.8058456,  0.1096966)
> > dfsd = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
> >
> > library(lattice)
> > COLS = c("gold", "forestgreen", "darkslategray3", "purple")
> > xyplot(Value ~ Concentration,
> >        group = Substance, data = df,
> >        pch = 16, cex = 1.2, type = "b",
> >        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
> >        ylab=expression(bold("Infection rate")),
> >        col=COLS,
> >        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
> >        )
> >        ),
> >        key = list(space="top", columns=4, col = "black",
> >                   points=list(pch=c(16, 16, 16, 16),
> >                               col=COLS,
> >                               text=list(c("6-PN", "8-PN", "IX", "XN")
> >                               )
> >                   )
> >        )
> >
> > )
> > ```
> > but how do I add the error bars?
> > I tried with
> > ```
> > xyplot(Value ~ Concentration,
> >        group = Substance, data = df,
> >        pch = 16, cex = 1.2, type = "b",
> >        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
> >        ylab=expression(bold("Infection rate")),
> >        col=COLS,
> >        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
> >        )
> >        ),
> >        key = list(space="top", columns=4, col = "black",
> >                   points=list(pch=c(16, 16, 16, 16),
> >                               col=COLS,
> >                               text=list(c("6-PN", "8-PN", "IX", "XN")
> >                               )
> >                   )
> >        ),
> >        panel = function (x,y,) {
> >          panel.segments(x0 = df$Concentration, x1 = df$Concentration,
> >                         y0 = df$Value - dfsd$Value,
> >                         y1 = df$Value + dfsd$Value,
> >                         col = COLS)
> >        }
> >
> > )
> > ```
> > but the bars are plotted outside the graph.
>
> You need to apply the log-transformation yourself, e.g.,
>
>          panel.segments(x0 = log10(df$Concentration), x1 =
> log10(df$Concentration),
>
> But this is not really a scalable approach. You should check if
> Hmisc::xYplot suits your needs:
>
> https://search.r-project.org/CRAN/refmans/Hmisc/html/xYplot.html
>
> Best,
> -Deepayan
>
> > What is the correct syntax? can I use raw data instead of making the
> > mean and std dev separately?
> > Thanks
> >
> > --
> > Best regards,
> > Luigi
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.



-- 
Best regards,
Luigi


From r@turner @end|ng |rom @uck|@nd@@c@nz  Mon Oct 11 22:18:36 2021
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Tue, 12 Oct 2021 09:18:36 +1300
Subject: [R] unexpected behavior in apply
In-Reply-To: <a71107e9441e476db477fe28acfff8d1@SRVEXCHCM1302.precheza.cz>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
 <CAGiFhPN4C2zinAm7_UjrdkYvtMVu7SUvVV3VUMLJYbG4Pd+XMA@mail.gmail.com>
 <CAGiFhPNg+3A+gQjXOGEM=_tVAi=41hpW_Xp-F4VrZOfSCn-y4A@mail.gmail.com>
 <a71107e9441e476db477fe28acfff8d1@SRVEXCHCM1302.precheza.cz>
Message-ID: <20211012091836.46f81efd@rolf-Latitude-E7470>

On Mon, 11 Oct 2021 09:15:27 +0000
PIKAL Petr <petr.pikal at precheza.cz> wrote:

<SNIP>

> 
> data.frame is not matrix or array (even if it rather resembles one)
> 
> So if you put a cake into oven you cannot expect getting fried
> potatoes from it.

<SNIP>

Another fortune nomination!

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From bgunter@4567 @end|ng |rom gm@||@com  Mon Oct 11 22:28:31 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Mon, 11 Oct 2021 13:28:31 -0700
Subject: [R] How to add error bars to lattice xyplot
In-Reply-To: <CAMk+s2Qo6gOzDsbtykvDzxF6hGGo5TSw9VBu8zMhyereJMmvbQ@mail.gmail.com>
References: <CAMk+s2TMivV+OOT-Saapdz_HJhD8-rFfkdRBxdfOYyhkkm10WQ@mail.gmail.com>
 <CADfFDC4bYN4cv87AcddwdFL7Pg2u6bCOZrNHuKB7Y3anisF4Jw@mail.gmail.com>
 <CAMk+s2Qo6gOzDsbtykvDzxF6hGGo5TSw9VBu8zMhyereJMmvbQ@mail.gmail.com>
Message-ID: <CAGxFJbSmBR-B8V8c+-LGe4BtALjE=uN9hhd-pTNPAB9AwyD2fA@mail.gmail.com>

Your panel function needs to plot the points! See at ############ below

xyplot(Value ~ Concentration,
       group = Substance, data = df,
       pch = 16, cex = 1.2, type = "b",
       xlab=expression(bold(paste("Concentration (", mu, "M)"))),
       ylab=expression(bold("Infection rate")),
       col=COLS,
       scales = list(x = list(log = 10, at=c(unique(df$Concentration))
       )
       ),
       key = list(space="top", columns=4, col = "black",
                  points=list(pch=c(16, 16, 16, 16),
                              col=COLS
                  ),
                  text=list(c("A", "B", "C", "D")
                  )
       ),
       panel = function (x,y,...) {
          panel.xyplot(x,y, ...)  ###########
          panel.segments(x0 = log10(df$Concentration),
                         x1 = log10(df$Concentration),
                         y0 = df$Value - dfsd$Value,
                         y1 = df$Value + dfsd$Value,
                         col = COLS)
       }



Bert Gunter

"The trouble with having an open mind is that people keep coming along and
sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )


On Mon, Oct 11, 2021 at 12:24 PM Luigi Marongiu <marongiu.luigi at gmail.com>
wrote:

> Thanks,
> now I got the bars (although without notch) but I lost the main plot:
> ```
> xyplot(Value ~ Concentration,
> group = Substance, data = df,
> pch = 16, cex = 1.2, type = "b",
> xlab=expression(bold(paste("Concentration (", mu, "M)"))),
> ylab=expression(bold("Infection rate")),
> col=COLS,
> scales = list(x = list(log = 10, at=c(unique(df$Concentration))
> )
> ),
> key = list(space="top", columns=4, col = "black",
> points=list(pch=c(16, 16, 16, 16),
> col=COLS
> ),
> text=list(c("A", "B", "C", "D")
> )
> ),
> panel = function (x,y) {
> panel.segments(x0 = log10(df$Concentration),
> x1 = log10(df$Concentration),
> y0 = df$Value - dfsd$Value,
> y1 = df$Value + dfsd$Value,
> col = COLS)
> }
>
> )
> ```
> I will check xYplot out, I think it is the tool for the job.
>
> On Mon, Oct 11, 2021 at 3:56 PM Deepayan Sarkar
> <deepayan.sarkar at gmail.com> wrote:
> >
> > On Mon, Oct 11, 2021 at 5:41 PM Luigi Marongiu <marongiu.luigi at gmail.com>
> wrote:
> > >
> > > Hello,
> > > I am trying to plot data using lattice. The basic plot works:
> > > ```
> > > Substance = rep(c("A", "B", "C", "D"),4)
> > > Concentration = rep(1:4,4),
> > > Value = c(62.80666667, 116.26333333,  92.26000000,   9.87333333,
> 14.82333333,
> > >           92.37333333, 98.95666667,   1.48333333,   0.64666667,
> 50.66000000,
> > >           25.75333333,   0.69000000, 0.21666667,   7.40666667,
>  6.92000000,
> > >           0.06333333)
> > > df = data.frame(Substance, Concentration, Value, stringsAsFactors =
> FALSE)
> > > Value = c(15.2974126, 16.3196089, 57.4294280,  9.1943370, 20.5567321,
> > > 14.0874424,
> > >        38.3626672, 0.3780653,  0.4738495, 37.9124874, 16.2473916,
> 0.7218726,
> > >        0.2498666,  8.4537585, 10.8058456,  0.1096966)
> > > dfsd = data.frame(Substance, Concentration, Value, stringsAsFactors =
> FALSE)
> > >
> > > library(lattice)
> > > COLS = c("gold", "forestgreen", "darkslategray3", "purple")
> > > xyplot(Value ~ Concentration,
> > >        group = Substance, data = df,
> > >        pch = 16, cex = 1.2, type = "b",
> > >        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
> > >        ylab=expression(bold("Infection rate")),
> > >        col=COLS,
> > >        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
> > >        )
> > >        ),
> > >        key = list(space="top", columns=4, col = "black",
> > >                   points=list(pch=c(16, 16, 16, 16),
> > >                               col=COLS,
> > >                               text=list(c("6-PN", "8-PN", "IX", "XN")
> > >                               )
> > >                   )
> > >        )
> > >
> > > )
> > > ```
> > > but how do I add the error bars?
> > > I tried with
> > > ```
> > > xyplot(Value ~ Concentration,
> > >        group = Substance, data = df,
> > >        pch = 16, cex = 1.2, type = "b",
> > >        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
> > >        ylab=expression(bold("Infection rate")),
> > >        col=COLS,
> > >        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
> > >        )
> > >        ),
> > >        key = list(space="top", columns=4, col = "black",
> > >                   points=list(pch=c(16, 16, 16, 16),
> > >                               col=COLS,
> > >                               text=list(c("6-PN", "8-PN", "IX", "XN")
> > >                               )
> > >                   )
> > >        ),
> > >        panel = function (x,y,) {
> > >          panel.segments(x0 = df$Concentration, x1 = df$Concentration,
> > >                         y0 = df$Value - dfsd$Value,
> > >                         y1 = df$Value + dfsd$Value,
> > >                         col = COLS)
> > >        }
> > >
> > > )
> > > ```
> > > but the bars are plotted outside the graph.
> >
> > You need to apply the log-transformation yourself, e.g.,
> >
> >          panel.segments(x0 = log10(df$Concentration), x1 =
> > log10(df$Concentration),
> >
> > But this is not really a scalable approach. You should check if
> > Hmisc::xYplot suits your needs:
> >
> > https://search.r-project.org/CRAN/refmans/Hmisc/html/xYplot.html
> >
> > Best,
> > -Deepayan
> >
> > > What is the correct syntax? can I use raw data instead of making the
> > > mean and std dev separately?
> > > Thanks
> > >
> > > --
> > > Best regards,
> > > Luigi
> > >
> > > ______________________________________________
> > > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
>
>
>
> --
> Best regards,
> Luigi
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From @v|gro@@ @end|ng |rom ver|zon@net  Tue Oct 12 05:29:34 2021
From: @v|gro@@ @end|ng |rom ver|zon@net (Avi Gross)
Date: Mon, 11 Oct 2021 23:29:34 -0400
Subject: [R] assumptions about how things are done
In-Reply-To: <C9330D44-9671-438C-9FC2-5F0CC11C8C32@roku.com>
References: <C9330D44-9671-438C-9FC2-5F0CC11C8C32@roku.com>
Message-ID: <01fc01d7bf19$61025770$23070650$@verizon.net>

I appreciate the feedback from several people. As noted, I do not want a deep philosophical discussion here and my main point remains not to expect software you "borrow" to do what you WANT but to accommodate it doing what it should.

Most of the time, I would say that a I want a vectorized function to do things exactly the way ifelse() does it. A mean A+B vectorized adds corresponding entries in any order and perhaps even using multiple cores to do it concurrently for larger vectors. Bu we normally don't care about the details, just the result. We want ALL the conditions evaluated and all the then and else parts and the appropriate ones combined into a result. Other than some storage considerations, and maybe efficiency considerations, it matters little if it is done in a gradual loop way or some other.

My point is some are used to loops and if they assume everything will not be evaluated, may have problems if that is a problem. Your example about division by zero is an example where you might change your code to avoid it. One way is to compute the then or else vector before calling ifelse() on the result and doing that calculation carefully as in a way that tests for dividing by zero and does something appropriate to avoid it or trap the error or something. Another is the wrapper method I mentioned, And, if you really need not to evaluate some things such as to avoid side effects, ifelse() may not be what you use then.

I was wondering if I do depend on the times R does non-standard evaluation too much that I think it can be done anytime. Obviously, not. I have often seen anomalous results when I forgot that changing something multiple times that gets evaluated ONCE later, does not work even if my intent was say to make lines that are dashed then others that are dotted and so on.

Many other languages I use do not have this gimmick and it can be annoying but realistic to have to pass some things explicitly such as a text version of the formula used so it can be displayed in the result. Most functions only see the result of arguments passed after evaluation.

So a strength of R can also be ...

-----Original Message-----
From: R-help <r-help-bounces at r-project.org> On Behalf Of Jorgen Harmse via R-help
Sent: Monday, October 11, 2021 11:08 AM
To: r-help at r-project.org
Subject: Re: [R] assumptions about how things are done

As noted by Richard O'Keefe, what usually happens in an R function is that any argument is evaluated either in its entirety or not at all. A few functions use substitute or similar trickery, but then expectations should be documented. I can understand that you want something like ifelse(y>x,x/y,z) to run without warning about division by zero, but how would that be implemented in general? Even a subexpression as simple as f(a,b) presents a problem: you want f(a,b)[cond], but you don't know how the function f works. It might be just a vector operation (and then perhaps f(a[cond],b[cond]) is what we want), or it might return a+rev(b). Avi Gross correctly notes that the implementation is not what he wants, but I think that what he wants is possible only in special cases.

Regards,
Jorgen Harmse. 

?

    Message: 2
    Date: Sat, 9 Oct 2021 15:35:55 -0400
    From: "Avi Gross" <avigross at verizon.net>
    To: <r-help at r-project.org>
    Subject: [R] assumptions about how things are done
    Message-ID: <029401d7bd44$e10843c0$a318cb40$@verizon.net>
    Content-Type: text/plain; charset="utf-8"

    This is supposed to be a forum for help so general and philosophical
    discussions belong elsewhere, or nowhere.



    Having said that, I want to make a brief point. Both new and experienced
    people make implicit assumptions about the code they use. Often nobody looks
    at how the sausage is made. The recent discussion of ifelse() made me take a
    look and I was not thrilled.



    My NA VE view was that ifelse() was implemented as a sort of loop construct.
    I mean if I have a vector of length N and perhaps a few other vectors of the
    same length, I might say:



    result <- ifelse(condition-on-vector-A, result-if-true-using-vectors,
    result-if-false-using-vectors)



    So say I want to take a vector of integers from 1 to N and make an output a
    second vector where you have either a prime number or NA. If I have a
    function called is.prime() that checks a single number and returns
    TRUE/FALSE, it might look like this:



    primed <- ifelse(is.prime(A, A, NA)



    So A[1] will be mapped to 1 and A[2} to 2 and A[3] to 3, but A[4] being
    composite becomes NA and so on.



    If you wrote the above using loops, it would be to range from index 1 to N
    and apply the above. There are many complications as R allows vectors to be
    longer or to be repeated as needed.



    What I found ifelse() as implemented to do, is sort of like this:



    Make a vector of the right length for the results, initially empty.



    Make a vector evaluating the condition so it is effectively a Boolean
    result.

    Calculate which indices are TRUE. Secondarily, calculate another set of
    indices that are false.



    Calculate ALL the THEN conditions and ditto all the ELSE conditions.



    Now copy into the result all the THEN values indexed by the TRUE above and
    than all the ELSE values indicated by the FALSE above.



    In plain English, make a result from two other results based on picking
    either one from menu A or one from menu B.



    That is not a bad algorithm and in a vectorized language like R, maybe even
    quite effective and efficient. It does lots of extra work as by definition
    it throws at least half away.



    I suspect the implementation could be made much faster by making some of it
    done internally using a language like C.



    But now that I know what this implementation did, I might have some qualms
    at using it in some situations. The original complaint led to other
    observations and needs and perhaps blindly using a supplied function like
    ifelse() may not be a decent solution for some needs.



    I note how I had to reorient my work elsewhere using a group of packages
    called the tidyverse when they added a function to allow rowwise
    manipulation of the data as compared to an ifelse-like method using all
    columns at once. There is room for many approaches and if a function may not
    be doing quite what you want, something else may better meet your needs OR
    you may want to see if you can copy the existing function and modify it for
    your own personal needs.



    In the case we mentioned, the goal was to avoid printing selected warnings.
    Since the function is readable, it can easily be modified in a copy to find
    what is causing the warnings and either rewrite a bit to avoid them or start
    over with perhaps your own function that tests before doing things and
    avoids tripping the condition (generating a NaN) entirely.



    Like may languages, R is a bit too rich. You can piggyback on the work of
    others but with some caution as they did not necessarily have you in mind
    with what they created.






    	[[alternative HTML version deleted]]





    ------------------------------

    Message: 4
    Date: Sun, 10 Oct 2021 08:34:52 +1100
    From: Jim Lemon <drjimlemon at gmail.com>
    To: Avi Gross <avigross at verizon.net>
    Cc: r-help mailing list <r-help at r-project.org>
    Subject: Re: [R] assumptions about how things are done
    Message-ID:
    	<CA+8X3fUQvXUx0=cVvNVTv144PQrRHgHgp1iBiXk23R8V+9=71g at mail.gmail.com>
    Content-Type: text/plain; charset="utf-8"

    Hi Avi,
    Definitely a learning moment. I may consider writing an ifElse() for
    my own use and sharing it if anyone wants it.

    Jim

    On Sun, Oct 10, 2021 at 6:36 AM Avi Gross via R-help
    <r-help at r-project.org> wrote:
    >
    > This is supposed to be a forum for help so general and philosophical
    > discussions belong elsewhere, or nowhere.
    >
    >
    >
    > Having said that, I want to make a brief point. Both new and experienced
    > people make implicit assumptions about the code they use. Often nobody looks
    > at how the sausage is made. The recent discussion of ifelse() made me take a
    > look and I was not thrilled.
    >
    >
    >
    > My NA?VE view was that ifelse() was implemented as a sort of loop construct.
    > I mean if I have a vector of length N and perhaps a few other vectors of the
    > same length, I might say:
    >
    >
    >
    > result <- ifelse(condition-on-vector-A, result-if-true-using-vectors,
    > result-if-false-using-vectors)
    >
    >
    >
    > So say I want to take a vector of integers from 1 to N and make an output a
    > second vector where you have either a prime number or NA. If I have a
    > function called is.prime() that checks a single number and returns
    > TRUE/FALSE, it might look like this:
    >
    >
    >
    > primed <- ifelse(is.prime(A, A, NA)
    >
    >
    >
    > So A[1] will be mapped to 1 and A[2} to 2 and A[3] to 3, but A[4] being
    > composite becomes NA and so on.
    >
    >
    >
    > If you wrote the above using loops, it would be to range from index 1 to N
    > and apply the above. There are many complications as R allows vectors to be
    > longer or to be repeated as needed.
    >
    >
    >
    > What I found ifelse() as implemented to do, is sort of like this:
    >
    >
    >
    > Make a vector of the right length for the results, initially empty.
    >
    >
    >
    > Make a vector evaluating the condition so it is effectively a Boolean
    > result.
    >
    > Calculate which indices are TRUE. Secondarily, calculate another set of
    > indices that are false.
    >
    >
    >
    > Calculate ALL the THEN conditions and ditto all the ELSE conditions.
    >
    >
    >
    > Now copy into the result all the THEN values indexed by the TRUE above and
    > than all the ELSE values indicated by the FALSE above.
    >
    >
    >
    > In plain English, make a result from two other results based on picking
    > either one from menu A or one from menu B.
    >
    >
    >
    > That is not a bad algorithm and in a vectorized language like R, maybe even
    > quite effective and efficient. It does lots of extra work as by definition
    > it throws at least half away.
    >
    >
    >
    > I suspect the implementation could be made much faster by making some of it
    > done internally using a language like C.
    >
    >
    >
    > But now that I know what this implementation did, I might have some qualms
    > at using it in some situations. The original complaint led to other
    > observations and needs and perhaps blindly using a supplied function like
    > ifelse() may not be a decent solution for some needs.
    >
    >
    >
    > I note how I had to reorient my work elsewhere using a group of packages
    > called the tidyverse when they added a function to allow rowwise
    > manipulation of the data as compared to an ifelse-like method using all
    > columns at once. There is room for many approaches and if a function may not
    > be doing quite what you want, something else may better meet your needs OR
    > you may want to see if you can copy the existing function and modify it for
    > your own personal needs.
    >
    >
    >
    > In the case we mentioned, the goal was to avoid printing selected warnings.
    > Since the function is readable, it can easily be modified in a copy to find
    > what is causing the warnings and either rewrite a bit to avoid them or start
    > over with perhaps your own function that tests before doing things and
    > avoids tripping the condition (generating a NaN) entirely.
    >
    >
    >
    > Like may languages, R is a bit too rich. You can piggyback on the work of
    > others but with some caution as they did not necessarily have you in mind
    > with what they created.
    >
    >
    >
    >
    >
    >
    >         [[alternative HTML version deleted]]
    >
    > ______________________________________________
    > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
    > https://stat.ethz.ch/mailman/listinfo/r-help
    > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
    > and provide commented, minimal, self-contained, reproducible code.




______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see https://stat.ethz.ch/mailman/listinfo/r-help
PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
and provide commented, minimal, self-contained, reproducible code.


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Tue Oct 12 08:28:26 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Tue, 12 Oct 2021 08:28:26 +0200
Subject: [R] How to add error bars to lattice xyplot
In-Reply-To: <CAGxFJbSmBR-B8V8c+-LGe4BtALjE=uN9hhd-pTNPAB9AwyD2fA@mail.gmail.com>
References: <CAMk+s2TMivV+OOT-Saapdz_HJhD8-rFfkdRBxdfOYyhkkm10WQ@mail.gmail.com>
 <CADfFDC4bYN4cv87AcddwdFL7Pg2u6bCOZrNHuKB7Y3anisF4Jw@mail.gmail.com>
 <CAMk+s2Qo6gOzDsbtykvDzxF6hGGo5TSw9VBu8zMhyereJMmvbQ@mail.gmail.com>
 <CAGxFJbSmBR-B8V8c+-LGe4BtALjE=uN9hhd-pTNPAB9AwyD2fA@mail.gmail.com>
Message-ID: <CAMk+s2S0FmGFOze6CJjuQer2zYE1kJGa4Kv8hquVKBE3xGxf6A@mail.gmail.com>

Thank you, but on the example in use, it draws at each x a triplet of
y from the same class linked by a segment. It is essentially a strip
plot rather than a scatter plot...

On Mon, Oct 11, 2021 at 10:28 PM Bert Gunter <bgunter.4567 at gmail.com> wrote:
>
> Your panel function needs to plot the points! See at ############ below
>
> xyplot(Value ~ Concentration,
>        group = Substance, data = df,
>        pch = 16, cex = 1.2, type = "b",
>        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>        ylab=expression(bold("Infection rate")),
>        col=COLS,
>        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
>        )
>        ),
>        key = list(space="top", columns=4, col = "black",
>                   points=list(pch=c(16, 16, 16, 16),
>                               col=COLS
>                   ),
>                   text=list(c("A", "B", "C", "D")
>                   )
>        ),
>        panel = function (x,y,...) {
>           panel.xyplot(x,y, ...)  ###########
>           panel.segments(x0 = log10(df$Concentration),
>                          x1 = log10(df$Concentration),
>                          y0 = df$Value - dfsd$Value,
>                          y1 = df$Value + dfsd$Value,
>                          col = COLS)
>        }
>
>
>
> Bert Gunter
>
> "The trouble with having an open mind is that people keep coming along and sticking things into it."
> -- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )
>
>
> On Mon, Oct 11, 2021 at 12:24 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>>
>> Thanks,
>> now I got the bars (although without notch) but I lost the main plot:
>> ```
>> xyplot(Value ~ Concentration,
>> group = Substance, data = df,
>> pch = 16, cex = 1.2, type = "b",
>> xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>> ylab=expression(bold("Infection rate")),
>> col=COLS,
>> scales = list(x = list(log = 10, at=c(unique(df$Concentration))
>> )
>> ),
>> key = list(space="top", columns=4, col = "black",
>> points=list(pch=c(16, 16, 16, 16),
>> col=COLS
>> ),
>> text=list(c("A", "B", "C", "D")
>> )
>> ),
>> panel = function (x,y) {
>> panel.segments(x0 = log10(df$Concentration),
>> x1 = log10(df$Concentration),
>> y0 = df$Value - dfsd$Value,
>> y1 = df$Value + dfsd$Value,
>> col = COLS)
>> }
>>
>> )
>> ```
>> I will check xYplot out, I think it is the tool for the job.
>>
>> On Mon, Oct 11, 2021 at 3:56 PM Deepayan Sarkar
>> <deepayan.sarkar at gmail.com> wrote:
>> >
>> > On Mon, Oct 11, 2021 at 5:41 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>> > >
>> > > Hello,
>> > > I am trying to plot data using lattice. The basic plot works:
>> > > ```
>> > > Substance = rep(c("A", "B", "C", "D"),4)
>> > > Concentration = rep(1:4,4),
>> > > Value = c(62.80666667, 116.26333333,  92.26000000,   9.87333333,  14.82333333,
>> > >           92.37333333, 98.95666667,   1.48333333,   0.64666667,  50.66000000,
>> > >           25.75333333,   0.69000000, 0.21666667,   7.40666667,   6.92000000,
>> > >           0.06333333)
>> > > df = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
>> > > Value = c(15.2974126, 16.3196089, 57.4294280,  9.1943370, 20.5567321,
>> > > 14.0874424,
>> > >        38.3626672, 0.3780653,  0.4738495, 37.9124874, 16.2473916,  0.7218726,
>> > >        0.2498666,  8.4537585, 10.8058456,  0.1096966)
>> > > dfsd = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
>> > >
>> > > library(lattice)
>> > > COLS = c("gold", "forestgreen", "darkslategray3", "purple")
>> > > xyplot(Value ~ Concentration,
>> > >        group = Substance, data = df,
>> > >        pch = 16, cex = 1.2, type = "b",
>> > >        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>> > >        ylab=expression(bold("Infection rate")),
>> > >        col=COLS,
>> > >        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
>> > >        )
>> > >        ),
>> > >        key = list(space="top", columns=4, col = "black",
>> > >                   points=list(pch=c(16, 16, 16, 16),
>> > >                               col=COLS,
>> > >                               text=list(c("6-PN", "8-PN", "IX", "XN")
>> > >                               )
>> > >                   )
>> > >        )
>> > >
>> > > )
>> > > ```
>> > > but how do I add the error bars?
>> > > I tried with
>> > > ```
>> > > xyplot(Value ~ Concentration,
>> > >        group = Substance, data = df,
>> > >        pch = 16, cex = 1.2, type = "b",
>> > >        xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>> > >        ylab=expression(bold("Infection rate")),
>> > >        col=COLS,
>> > >        scales = list(x = list(log = 10, at=c(unique(df$Concentration))
>> > >        )
>> > >        ),
>> > >        key = list(space="top", columns=4, col = "black",
>> > >                   points=list(pch=c(16, 16, 16, 16),
>> > >                               col=COLS,
>> > >                               text=list(c("6-PN", "8-PN", "IX", "XN")
>> > >                               )
>> > >                   )
>> > >        ),
>> > >        panel = function (x,y,) {
>> > >          panel.segments(x0 = df$Concentration, x1 = df$Concentration,
>> > >                         y0 = df$Value - dfsd$Value,
>> > >                         y1 = df$Value + dfsd$Value,
>> > >                         col = COLS)
>> > >        }
>> > >
>> > > )
>> > > ```
>> > > but the bars are plotted outside the graph.
>> >
>> > You need to apply the log-transformation yourself, e.g.,
>> >
>> >          panel.segments(x0 = log10(df$Concentration), x1 =
>> > log10(df$Concentration),
>> >
>> > But this is not really a scalable approach. You should check if
>> > Hmisc::xYplot suits your needs:
>> >
>> > https://search.r-project.org/CRAN/refmans/Hmisc/html/xYplot.html
>> >
>> > Best,
>> > -Deepayan
>> >
>> > > What is the correct syntax? can I use raw data instead of making the
>> > > mean and std dev separately?
>> > > Thanks
>> > >
>> > > --
>> > > Best regards,
>> > > Luigi
>> > >
>> > > ______________________________________________
>> > > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> > > https://stat.ethz.ch/mailman/listinfo/r-help
>> > > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> > > and provide commented, minimal, self-contained, reproducible code.
>>
>>
>>
>> --
>> Best regards,
>> Luigi
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.



-- 
Best regards,
Luigi


From petr@p|k@| @end|ng |rom prechez@@cz  Tue Oct 12 13:16:04 2021
From: petr@p|k@| @end|ng |rom prechez@@cz (PIKAL Petr)
Date: Tue, 12 Oct 2021 11:16:04 +0000
Subject: [R] complicated sequence with preset length
Message-ID: <7cac22e35cf344558818acfe3a70209d@SRVEXCHCM1302.precheza.cz>

Dear all

I know it is quite easy to get a simple seqence by rep function
> c(rep(1:3, 2), rep(4:6,2))
 [1] 1 2 3 1 2 3 4 5 6 4 5 6

I could easily get vector of length 24 or 36 using another rep

> rep(c(rep(1:3, 2), rep(4:6,2)),2)
 [1] 1 2 3 1 2 3 4 5 6 4 5 6 1 2 3 1 2 3 4 5 6 4 5 6

> length(rep(c(rep(1:3, 2), rep(4:6,2)),2))
[1] 24
> length(rep(c(rep(1:3, 2), rep(4:6,2)),3))
[1] 36

But what about vector of length 30 i.e. 

> length(c(rep(c(rep(1:3, 2), rep(4:6,2)),2), rep(1:3,2)))
[1] 30

I know I could make some if construction based on known vector length but is
there a way to use "vector recycling" if I know the desired length and want
to "fill in" the values to get required length vector?

Here is my complicated solution

len <- 30
vec1 <- rep(1:3, 2)
vec2 <- rep(4:6, 2)
base.vec <- c(vec1, vec2)
base.len <- length(c(vec1, vec2))
part <- (len/base.len-trunc(len/base.len))
result <- if (part==0) rep(c(vec1,vec2), len/base.len) else
c(rep(c(vec1,vec2), len/base.len), base.vec[1:(base.len*part)])

Is there any way how to achieve the result by simpler way?

Best regards
Petr

From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 12 13:27:34 2021
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 12 Oct 2021 07:27:34 -0400
Subject: [R] complicated sequence with preset length
In-Reply-To: <7cac22e35cf344558818acfe3a70209d@SRVEXCHCM1302.precheza.cz>
References: <7cac22e35cf344558818acfe3a70209d@SRVEXCHCM1302.precheza.cz>
Message-ID: <2c7a5211-eb12-44c8-9cd3-8fd478a10d1e@gmail.com>

On 12/10/2021 7:16 a.m., PIKAL Petr wrote:
> Dear all
> 
> I know it is quite easy to get a simple seqence by rep function
>> c(rep(1:3, 2), rep(4:6,2))
>   [1] 1 2 3 1 2 3 4 5 6 4 5 6
> 
> I could easily get vector of length 24 or 36 using another rep
> 
>> rep(c(rep(1:3, 2), rep(4:6,2)),2)
>   [1] 1 2 3 1 2 3 4 5 6 4 5 6 1 2 3 1 2 3 4 5 6 4 5 6
> 
>> length(rep(c(rep(1:3, 2), rep(4:6,2)),2))
> [1] 24
>> length(rep(c(rep(1:3, 2), rep(4:6,2)),3))
> [1] 36
> 
> But what about vector of length 30 i.e.
> 
>> length(c(rep(c(rep(1:3, 2), rep(4:6,2)),2), rep(1:3,2)))
> [1] 30
> 
> I know I could make some if construction based on known vector length but is
> there a way to use "vector recycling" if I know the desired length and want
> to "fill in" the values to get required length vector?
> 
> Here is my complicated solution
> 
> len <- 30
> vec1 <- rep(1:3, 2)
> vec2 <- rep(4:6, 2)
> base.vec <- c(vec1, vec2)
> base.len <- length(c(vec1, vec2))
> part <- (len/base.len-trunc(len/base.len))
> result <- if (part==0) rep(c(vec1,vec2), len/base.len) else
> c(rep(c(vec1,vec2), len/base.len), base.vec[1:(base.len*part)])
> 
> Is there any way how to achieve the result by simpler way?
> 

You can use the length.out argument to repeat the input as often as 
necessary, e.g.

  rep(c(rep(1:3, 2), rep(4:6,2)), length.out = 30)
  #>  [1] 1 2 3 1 2 3 4 5 6 4 5 6 1 2 3 1 2 3 4 5 6 4 5 6 1 2 3 1 2 3

Duncan Murdoch
Duncan Murdoch


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Tue Oct 12 15:49:01 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Tue, 12 Oct 2021 15:49:01 +0200
Subject: [R] How to convert line plot to lattice xtplot?
Message-ID: <CAMk+s2TLo+-o4x9zL-BCa0PyZSrjs8U9+B0Hvgt2Kp8w=m6AQQ@mail.gmail.com>

Hello,
I have drawn data from a dataframe as follows:
```
Substance = rep(c("A", "B", "C", "D"),4)
Concentration = rep(1:4,4)
Value = c(62.80666667, 116.26333333,  92.26000000,   9.87333333,  14.82333333,
92.37333333, 98.95666667,   1.48333333,   0.64666667,  50.66000000,
25.75333333,   0.69000000, 0.21666667,   7.40666667,   6.92000000,
0.06333333)
df = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
Value = c(15.2974126, 16.3196089, 57.4294280,  9.1943370, 20.5567321,
14.0874424,
38.3626672, 0.3780653,  0.4738495, 37.9124874, 16.2473916,  0.7218726,
0.2498666,  8.4537585, 10.8058456,  0.1096966)
dfsd = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
COLS = c("gold", "green", "purple", "blue")

plot(df$Value[df$Substance == "A"] ~ unique(df$Concentration),
xlab=expression(bold(paste("Concentration (", mu, "M)"))),
ylab=expression(bold("Value")),
type = "o", col = "gold", pch = 16,
xaxt="n", las=3, log = "x",
ylim = c(0, max(df$Value+dfsd$Value))
)
points(df$Value[df$Substance == "B"] ~ unique(df$Concentration),
type = "o", col = "green", pch = 16)
points(df$Value[df$Substance == "C"] ~ unique(df$Concentration),
type = "o", col = "purple", pch = 16)
points(df$Value[df$Substance == "D"] ~ unique(df$Concentration),
type = "o", col = "blue", pch = 16)
legend("topright", legend = LETTERS[1:4],
lty = 1, pch = 16,
col = COLS)
```
I then tried to use lattice but I got a stripplot instead. At each x
(1:4) only one group (A:D) is drawn. What am I missing?
```
library(lattice)
xyplot(Value ~ Concentration,
group = Substance, data = df,
pch = 16, cex = 1.2, type = "b",
xlab=expression(bold(paste("Concentration (", mu, "M)"))),
ylab=expression(bold("Infection rate")),
col=COLS,
scales = list(x = list(log = 10, at=c(unique(df$Concentration))
)
),
key = list(space="top", columns=4, col = "black",
points=list(pch=c(16, 16, 16, 16),
col=COLS
),
text=list(c("A", "B", "C", "D")
)
)
)
```

Thank you

-- 
Best regards,
Luigi


From bgunter@4567 @end|ng |rom gm@||@com  Tue Oct 12 16:20:38 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Tue, 12 Oct 2021 07:20:38 -0700
Subject: [R] How to convert line plot to lattice xtplot?
In-Reply-To: <CAMk+s2TLo+-o4x9zL-BCa0PyZSrjs8U9+B0Hvgt2Kp8w=m6AQQ@mail.gmail.com>
References: <CAMk+s2TLo+-o4x9zL-BCa0PyZSrjs8U9+B0Hvgt2Kp8w=m6AQQ@mail.gmail.com>
Message-ID: <CAGxFJbSQCRKxZNOMK98YS1uP1f-VyEvOMwiw-tgXPbTUMfTG6w@mail.gmail.com>

You have misspecified the grouping.

df$subs <- rep(1:4, e=4)

xyplot(Value ~ Concentration,
       groups = subs, data = df,  ##... etc.



Bert Gunter

"The trouble with having an open mind is that people keep coming along and
sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )


On Tue, Oct 12, 2021 at 6:49 AM Luigi Marongiu <marongiu.luigi at gmail.com>
wrote:

> Hello,
> I have drawn data from a dataframe as follows:
> ```
> Substance = rep(c("A", "B", "C", "D"),4)
> Concentration = rep(1:4,4)
> Value = c(62.80666667, 116.26333333,  92.26000000,   9.87333333,
> 14.82333333,
> 92.37333333, 98.95666667,   1.48333333,   0.64666667,  50.66000000,
> 25.75333333,   0.69000000, 0.21666667,   7.40666667,   6.92000000,
> 0.06333333)
> df = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
> Value = c(15.2974126, 16.3196089, 57.4294280,  9.1943370, 20.5567321,
> 14.0874424,
> 38.3626672, 0.3780653,  0.4738495, 37.9124874, 16.2473916,  0.7218726,
> 0.2498666,  8.4537585, 10.8058456,  0.1096966)
> dfsd = data.frame(Substance, Concentration, Value, stringsAsFactors =
> FALSE)
> COLS = c("gold", "green", "purple", "blue")
>
> plot(df$Value[df$Substance == "A"] ~ unique(df$Concentration),
> xlab=expression(bold(paste("Concentration (", mu, "M)"))),
> ylab=expression(bold("Value")),
> type = "o", col = "gold", pch = 16,
> xaxt="n", las=3, log = "x",
> ylim = c(0, max(df$Value+dfsd$Value))
> )
> points(df$Value[df$Substance == "B"] ~ unique(df$Concentration),
> type = "o", col = "green", pch = 16)
> points(df$Value[df$Substance == "C"] ~ unique(df$Concentration),
> type = "o", col = "purple", pch = 16)
> points(df$Value[df$Substance == "D"] ~ unique(df$Concentration),
> type = "o", col = "blue", pch = 16)
> legend("topright", legend = LETTERS[1:4],
> lty = 1, pch = 16,
> col = COLS)
> ```
> I then tried to use lattice but I got a stripplot instead. At each x
> (1:4) only one group (A:D) is drawn. What am I missing?
> ```
> library(lattice)
> xyplot(Value ~ Concentration,
> group = Substance, data = df,
> pch = 16, cex = 1.2, type = "b",
> xlab=expression(bold(paste("Concentration (", mu, "M)"))),
> ylab=expression(bold("Infection rate")),
> col=COLS,
> scales = list(x = list(log = 10, at=c(unique(df$Concentration))
> )
> ),
> key = list(space="top", columns=4, col = "black",
> points=list(pch=c(16, 16, 16, 16),
> col=COLS
> ),
> text=list(c("A", "B", "C", "D")
> )
> )
> )
> ```
>
> Thank you
>
> --
> Best regards,
> Luigi
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Tue Oct 12 19:09:05 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Tue, 12 Oct 2021 19:09:05 +0200
Subject: [R] How to convert line plot to lattice xtplot?
In-Reply-To: <CAGxFJbSQCRKxZNOMK98YS1uP1f-VyEvOMwiw-tgXPbTUMfTG6w@mail.gmail.com>
References: <CAMk+s2TLo+-o4x9zL-BCa0PyZSrjs8U9+B0Hvgt2Kp8w=m6AQQ@mail.gmail.com>
 <CAGxFJbSQCRKxZNOMK98YS1uP1f-VyEvOMwiw-tgXPbTUMfTG6w@mail.gmail.com>
Message-ID: <CAMk+s2RZQuEQuLWV6hLhz+6-KPyKT1yZ7AOiiKOaQkvK=_782w@mail.gmail.com>

Awesome, thanks!

On Tue, Oct 12, 2021 at 4:20 PM Bert Gunter <bgunter.4567 at gmail.com> wrote:
>
> You have misspecified the grouping.
>
> df$subs <- rep(1:4, e=4)
>
> xyplot(Value ~ Concentration,
>        groups = subs, data = df,  ##... etc.
>
>
>
> Bert Gunter
>
> "The trouble with having an open mind is that people keep coming along and sticking things into it."
> -- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )
>
>
> On Tue, Oct 12, 2021 at 6:49 AM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>>
>> Hello,
>> I have drawn data from a dataframe as follows:
>> ```
>> Substance = rep(c("A", "B", "C", "D"),4)
>> Concentration = rep(1:4,4)
>> Value = c(62.80666667, 116.26333333,  92.26000000,   9.87333333,  14.82333333,
>> 92.37333333, 98.95666667,   1.48333333,   0.64666667,  50.66000000,
>> 25.75333333,   0.69000000, 0.21666667,   7.40666667,   6.92000000,
>> 0.06333333)
>> df = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
>> Value = c(15.2974126, 16.3196089, 57.4294280,  9.1943370, 20.5567321,
>> 14.0874424,
>> 38.3626672, 0.3780653,  0.4738495, 37.9124874, 16.2473916,  0.7218726,
>> 0.2498666,  8.4537585, 10.8058456,  0.1096966)
>> dfsd = data.frame(Substance, Concentration, Value, stringsAsFactors = FALSE)
>> COLS = c("gold", "green", "purple", "blue")
>>
>> plot(df$Value[df$Substance == "A"] ~ unique(df$Concentration),
>> xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>> ylab=expression(bold("Value")),
>> type = "o", col = "gold", pch = 16,
>> xaxt="n", las=3, log = "x",
>> ylim = c(0, max(df$Value+dfsd$Value))
>> )
>> points(df$Value[df$Substance == "B"] ~ unique(df$Concentration),
>> type = "o", col = "green", pch = 16)
>> points(df$Value[df$Substance == "C"] ~ unique(df$Concentration),
>> type = "o", col = "purple", pch = 16)
>> points(df$Value[df$Substance == "D"] ~ unique(df$Concentration),
>> type = "o", col = "blue", pch = 16)
>> legend("topright", legend = LETTERS[1:4],
>> lty = 1, pch = 16,
>> col = COLS)
>> ```
>> I then tried to use lattice but I got a stripplot instead. At each x
>> (1:4) only one group (A:D) is drawn. What am I missing?
>> ```
>> library(lattice)
>> xyplot(Value ~ Concentration,
>> group = Substance, data = df,
>> pch = 16, cex = 1.2, type = "b",
>> xlab=expression(bold(paste("Concentration (", mu, "M)"))),
>> ylab=expression(bold("Infection rate")),
>> col=COLS,
>> scales = list(x = list(log = 10, at=c(unique(df$Concentration))
>> )
>> ),
>> key = list(space="top", columns=4, col = "black",
>> points=list(pch=c(16, 16, 16, 16),
>> col=COLS
>> ),
>> text=list(c("A", "B", "C", "D")
>> )
>> )
>> )
>> ```
>>
>> Thank you
>>
>> --
>> Best regards,
>> Luigi
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.



-- 
Best regards,
Luigi


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Tue Oct 12 22:42:26 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Tue, 12 Oct 2021 22:42:26 +0200
Subject: [R] How to rotate only one panel by 90 degrees in R plot?
Message-ID: <CAMk+s2TAx0mXygcfSaNT9YxJg62d4Mk=_WczipVgB6uFDvZWFQ@mail.gmail.com>

Hello,
I would like to show a density plot of the Y axis. To do that, I would
like to split the plot into a panel 2/3 long and a density plot 1/3
long. The problem is that, since the density is on the Y axis, the
density plot should be rotated byb90 degrees. I tried with the package
gridGraphics but it rotates both panels.
```
negative_y <- runif(50, 0, 0.099)
negative_x <- runif(50, 1, 40)
positive_y <- c(runif(30, 0.2, 0.5), runif(20, 0.4, 0.5))
positive_x <- c(runif(30, 25, 40), runif(20, 10, 25))
uncertain_y <- runif(10, 0.099, 0.2)
uncertain_x <- runif(10, 2, 40)
# plot on MR/FCN space
layout(matrix(c(1,2),nrow=1), widths=c(3,1)) # split panels unevenly
plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
xlab=expression(bold("X")),
ylab=expression(bold("Y")))
points(positive_x, positive_y, pch=16, cex=1.5)
points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
legend("topleft",
legend = c("Positives", "Negatives", "Uncertains"),
pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)
# plot density
plot(density(c(negative_y, uncertain_y, positive_y)),
yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
library(gridGraphics)
grab_grob <- function(){
grid.echo()
grid.grab()
}
g <- grab_grob()
grid.newpage()
pushViewport(viewport(width=0.7,angle=270))
grid.draw(g)
```
How can I rotate only the second panel? I tried to assign the second
plot to an object p and then call grid.draw(p), or to assign g to the
second plot, but they did not work...
Thanks


-- 
Best regards,
Luigi


From bgunter@4567 @end|ng |rom gm@||@com  Wed Oct 13 01:17:22 2021
From: bgunter@4567 @end|ng |rom gm@||@com (Bert Gunter)
Date: Tue, 12 Oct 2021 16:17:22 -0700
Subject: [R] How to rotate only one panel by 90 degrees in R plot?
In-Reply-To: <CAMk+s2TAx0mXygcfSaNT9YxJg62d4Mk=_WczipVgB6uFDvZWFQ@mail.gmail.com>
References: <CAMk+s2TAx0mXygcfSaNT9YxJg62d4Mk=_WczipVgB6uFDvZWFQ@mail.gmail.com>
Message-ID: <CAGxFJbTFZhC-d+ovCeywMJA1Vb59kBJW3DnkCdMr3=VYnq6WXQ@mail.gmail.com>

I don't know the gridGraphics package, and I haven't looked closely at what
you are trying to do. But note that lattice functions construct grid
"grobs" that can be saved and plotted in arbitrary, including rotated,
viewports, using the print.trellis function. I frankly am pretty ignorant
about such things, but this simple little example might give you some
notion of how to proceed. You may also be able to do what you want with
grid.layout() and pushing a suitably rotated viewport onto a layout. Others
would have to advise on such details, if so.

If I'm wrong and this is useless, just ignore without comment.



dp <- densityplot(~y, main = "",
                  xlab = "", ylab = "")
grid.newpage()
pushViewport(
   viewport(width = unit(.5,"npc"),
            height = unit(.3,"npc"),
            angle = 270))
print(dp, newp = FALSE,  ## this is the print.trellis method
      panel.width = list(1,"npc"),
      panel.height = list(1, "npc")
)

Bert Gunter

"The trouble with having an open mind is that people keep coming along and
sticking things into it."
-- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )


On Tue, Oct 12, 2021 at 1:43 PM Luigi Marongiu <marongiu.luigi at gmail.com>
wrote:

> Hello,
> I would like to show a density plot of the Y axis. To do that, I would
> like to split the plot into a panel 2/3 long and a density plot 1/3
> long. The problem is that, since the density is on the Y axis, the
> density plot should be rotated byb90 degrees. I tried with the package
> gridGraphics but it rotates both panels.
> ```
> negative_y <- runif(50, 0, 0.099)
> negative_x <- runif(50, 1, 40)
> positive_y <- c(runif(30, 0.2, 0.5), runif(20, 0.4, 0.5))
> positive_x <- c(runif(30, 25, 40), runif(20, 10, 25))
> uncertain_y <- runif(10, 0.099, 0.2)
> uncertain_x <- runif(10, 2, 40)
> # plot on MR/FCN space
> layout(matrix(c(1,2),nrow=1), widths=c(3,1)) # split panels unevenly
> plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
> xlab=expression(bold("X")),
> ylab=expression(bold("Y")))
> points(positive_x, positive_y, pch=16, cex=1.5)
> points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
> legend("topleft",
> legend = c("Positives", "Negatives", "Uncertains"),
> pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)
> # plot density
> plot(density(c(negative_y, uncertain_y, positive_y)),
> yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
> library(gridGraphics)
> grab_grob <- function(){
> grid.echo()
> grid.grab()
> }
> g <- grab_grob()
> grid.newpage()
> pushViewport(viewport(width=0.7,angle=270))
> grid.draw(g)
> ```
> How can I rotate only the second panel? I tried to assign the second
> plot to an object p and then call grid.draw(p), or to assign g to the
> second plot, but they did not work...
> Thanks
>
>
> --
> Best regards,
> Luigi
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

	[[alternative HTML version deleted]]


From p@u| @end|ng |rom @t@t@@uck|@nd@@c@nz  Wed Oct 13 01:29:31 2021
From: p@u| @end|ng |rom @t@t@@uck|@nd@@c@nz (Paul Murrell)
Date: Wed, 13 Oct 2021 12:29:31 +1300
Subject: [R] How to rotate only one panel by 90 degrees in R plot?
In-Reply-To: <CAMk+s2TAx0mXygcfSaNT9YxJg62d4Mk=_WczipVgB6uFDvZWFQ@mail.gmail.com>
References: <CAMk+s2TAx0mXygcfSaNT9YxJg62d4Mk=_WczipVgB6uFDvZWFQ@mail.gmail.com>
Message-ID: <6815ddd1-787b-8e3c-143b-3de1d5167e37@stat.auckland.ac.nz>

Hi

I don't think you need (or want) the 'gridGraphics' package for this.
You just need to flip the x-/y-data that you get from density() (and 
make sure that you align the y-axes of the two plots).
The following code shows an example (and adds a bit of par() control to 
eliminate white space).


layout(matrix(c(1,2),nrow=1), widths=c(3,1))
par(mar=c(5, 4, 2, 1))
plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
      xlab=expression(bold("X")),
      ylab=expression(bold("Y")))
points(positive_x, positive_y, pch=16, cex=1.5)
points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
legend("topleft",
        legend = c("Positives", "Negatives", "Uncertains"),
        pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)
# plot density
d <- density(c(negative_y, uncertain_y, positive_y))
par(mar=c(5, 1, 2, 1))
plot(d$y, d$x, ylim=c(0,0.5), type="l",
      yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)


Does that produce the sort of thing you want?

Paul


On 13/10/2021 9:42 am, Luigi Marongiu wrote:
> Hello,
> I would like to show a density plot of the Y axis. To do that, I would
> like to split the plot into a panel 2/3 long and a density plot 1/3
> long. The problem is that, since the density is on the Y axis, the
> density plot should be rotated byb90 degrees. I tried with the package
> gridGraphics but it rotates both panels.
> ```
> negative_y <- runif(50, 0, 0.099)
> negative_x <- runif(50, 1, 40)
> positive_y <- c(runif(30, 0.2, 0.5), runif(20, 0.4, 0.5))
> positive_x <- c(runif(30, 25, 40), runif(20, 10, 25))
> uncertain_y <- runif(10, 0.099, 0.2)
> uncertain_x <- runif(10, 2, 40)
> # plot on MR/FCN space
> layout(matrix(c(1,2),nrow=1), widths=c(3,1)) # split panels unevenly
> plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
> xlab=expression(bold("X")),
> ylab=expression(bold("Y")))
> points(positive_x, positive_y, pch=16, cex=1.5)
> points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
> legend("topleft",
> legend = c("Positives", "Negatives", "Uncertains"),
> pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)
> # plot density
> plot(density(c(negative_y, uncertain_y, positive_y)),
> yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
> library(gridGraphics)
> grab_grob <- function(){
> grid.echo()
> grid.grab()
> }
> g <- grab_grob()
> grid.newpage()
> pushViewport(viewport(width=0.7,angle=270))
> grid.draw(g)
> ```
> How can I rotate only the second panel? I tried to assign the second
> plot to an object p and then call grid.draw(p), or to assign g to the
> second plot, but they did not work...
> Thanks
> 
> 
> -- 
> Best regards,
> Luigi
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help 
> <https://stat.ethz.ch/mailman/listinfo/r-help>
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html 
> <http://www.R-project.org/posting-guide.html>
> and provide commented, minimal, self-contained, reproducible code.

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Wed Oct 13 08:42:58 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Wed, 13 Oct 2021 08:42:58 +0200
Subject: [R] How to rotate only one panel by 90 degrees in R plot?
In-Reply-To: <CAGxFJbTFZhC-d+ovCeywMJA1Vb59kBJW3DnkCdMr3=VYnq6WXQ@mail.gmail.com>
References: <CAMk+s2TAx0mXygcfSaNT9YxJg62d4Mk=_WczipVgB6uFDvZWFQ@mail.gmail.com>
 <CAGxFJbTFZhC-d+ovCeywMJA1Vb59kBJW3DnkCdMr3=VYnq6WXQ@mail.gmail.com>
Message-ID: <CAMk+s2RHe68as2sHL0LHtZzMm6MGDth2n0DMdCPPuXaZZwjVeA@mail.gmail.com>

I have seen that the only package that easily rotate the plot is
ggplot, so I ran:
```
library(ggplot2)
df = data.frame(MR = c(negative_mr, uncertain_mr, positive_mr),
FCN = c(negative_fcn, uncertain_fcn, positive_fcn))
p <- ggplot(df, aes(x=MR)) +
geom_density()
p + coord_flip()
```
Even in this case, the plot is correctly rotated, but I can't place it
in the allocated panel. ggplot2 simply overwrites the whole plot. This
means I need to do the whole thing in ggplot2 (would lattice have an
equivalent?) and split the plot into uneven panels with ggplot2.
Changing x into y is a clever approach, but it is not the same as
rotating a plot. But YES, that is exactly what I wanted to plot. Thank
you!

On Wed, Oct 13, 2021 at 1:17 AM Bert Gunter <bgunter.4567 at gmail.com> wrote:
>
> I don't know the gridGraphics package, and I haven't looked closely at what you are trying to do. But note that lattice functions construct grid "grobs" that can be saved and plotted in arbitrary, including rotated, viewports, using the print.trellis function. I frankly am pretty ignorant about such things, but this simple little example might give you some notion of how to proceed. You may also be able to do what you want with grid.layout() and pushing a suitably rotated viewport onto a layout. Others would have to advise on such details, if so.
>
> If I'm wrong and this is useless, just ignore without comment.
>
>
>
> dp <- densityplot(~y, main = "",
>                   xlab = "", ylab = "")
> grid.newpage()
> pushViewport(
>    viewport(width = unit(.5,"npc"),
>             height = unit(.3,"npc"),
>             angle = 270))
> print(dp, newp = FALSE,  ## this is the print.trellis method
>       panel.width = list(1,"npc"),
>       panel.height = list(1, "npc")
> )
>
> Bert Gunter
>
> "The trouble with having an open mind is that people keep coming along and sticking things into it."
> -- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )
>
>
> On Tue, Oct 12, 2021 at 1:43 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
>>
>> Hello,
>> I would like to show a density plot of the Y axis. To do that, I would
>> like to split the plot into a panel 2/3 long and a density plot 1/3
>> long. The problem is that, since the density is on the Y axis, the
>> density plot should be rotated byb90 degrees. I tried with the package
>> gridGraphics but it rotates both panels.
>> ```
>> negative_y <- runif(50, 0, 0.099)
>> negative_x <- runif(50, 1, 40)
>> positive_y <- c(runif(30, 0.2, 0.5), runif(20, 0.4, 0.5))
>> positive_x <- c(runif(30, 25, 40), runif(20, 10, 25))
>> uncertain_y <- runif(10, 0.099, 0.2)
>> uncertain_x <- runif(10, 2, 40)
>> # plot on MR/FCN space
>> layout(matrix(c(1,2),nrow=1), widths=c(3,1)) # split panels unevenly
>> plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
>> xlab=expression(bold("X")),
>> ylab=expression(bold("Y")))
>> points(positive_x, positive_y, pch=16, cex=1.5)
>> points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
>> legend("topleft",
>> legend = c("Positives", "Negatives", "Uncertains"),
>> pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)
>> # plot density
>> plot(density(c(negative_y, uncertain_y, positive_y)),
>> yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
>> library(gridGraphics)
>> grab_grob <- function(){
>> grid.echo()
>> grid.grab()
>> }
>> g <- grab_grob()
>> grid.newpage()
>> pushViewport(viewport(width=0.7,angle=270))
>> grid.draw(g)
>> ```
>> How can I rotate only the second panel? I tried to assign the second
>> plot to an object p and then call grid.draw(p), or to assign g to the
>> second plot, but they did not work...
>> Thanks
>>
>>
>> --
>> Best regards,
>> Luigi
>>
>> ______________________________________________
>> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.



-- 
Best regards,
Luigi


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Wed Oct 13 11:11:13 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Wed, 13 Oct 2021 11:11:13 +0200
Subject: [R] How to find local minimum between distributions using mixtools?
Message-ID: <CAMk+s2TEAYzPc_6kMSv6C4rXNaKTqupk5STksSpMtCT9dBwaxw@mail.gmail.com>

Hello,
I have two peaks distributions (and some noise values in between), and
I used mixtools to characterize the two overlapping data. How can I
find the minimum between the peak distributions?
The sigma value of the second population is close to that value, but I
am not sure if this is really the cut-off point between the two
distributions (by eye, I would say the value is 0.125 against 0.1 of
the sigma value). Is there a better approach?
Thanks

```
set.seed(10)
negative_mr <- runif(50, 0, 0.099)
negative_fcn <- runif(50, 1, 40)
positive_mr <- c(runif(30, 0.2, 0.5), runif(20, 0.4, 0.5))
positive_fcn <- c(runif(30, 25, 40), runif(20, 10, 25))
uncertain_mr <- runif(10, 0.099, 0.2)
uncertain_fcn <- runif(10, 2, 40)
df <- data.frame(Y=c(negative_mr, uncertain_mr, positive_mr),
X=c(negative_fcn, uncertain_fcn, positive_fcn),
GROUP=c(rep("negative", length(negative_mr)),
rep("uncertain", length(uncertain_mr)),
rep("positive", length(positive_mr))))
library(mixtools)
model = normalmixEM((x = df$Y))
summary(model)
# plot
plot(model, which=2)
Cut_off <- model$sigma[2]
Cut_offE <- 0.125
abline(v=Cut_off, col="blue", lwd=2)
abline(v=Cut_offE, col="blue", lwd=2, lty=2)
plot(df$Y[df$GROUP=="negative"]~df$X[df$GROUP=="negative"],
pch=1, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
xlab=expression(bold("X")),
ylab=expression(bold("Y")))
points(df$Y[df$GROUP=="positive"]~df$X[df$GROUP=="positive"],
pch=16, cex=1.5)
points(df$Y[df$GROUP=="uncertain"]~df$X[df$GROUP=="uncertain"],
pch=16, cex=1.5, col="grey")
abline(h=Cut_off, col="blue", lwd=2)
abline(h=Cut_offE, col="blue", lwd=2, lty=2)
```


-- 
Best regards,
Luigi


From deep@y@n@@@rk@r @end|ng |rom gm@||@com  Wed Oct 13 12:00:04 2021
From: deep@y@n@@@rk@r @end|ng |rom gm@||@com (Deepayan Sarkar)
Date: Wed, 13 Oct 2021 15:30:04 +0530
Subject: [R] How to rotate only one panel by 90 degrees in R plot?
In-Reply-To: <CAMk+s2RHe68as2sHL0LHtZzMm6MGDth2n0DMdCPPuXaZZwjVeA@mail.gmail.com>
References: <CAMk+s2TAx0mXygcfSaNT9YxJg62d4Mk=_WczipVgB6uFDvZWFQ@mail.gmail.com>
 <CAGxFJbTFZhC-d+ovCeywMJA1Vb59kBJW3DnkCdMr3=VYnq6WXQ@mail.gmail.com>
 <CAMk+s2RHe68as2sHL0LHtZzMm6MGDth2n0DMdCPPuXaZZwjVeA@mail.gmail.com>
Message-ID: <CADfFDC6O8gmiu4uWGB=hTwVkW55eL=q=Z9rQVX-kbehcP6Tk=Q@mail.gmail.com>

On Wed, Oct 13, 2021 at 12:13 PM Luigi Marongiu
<marongiu.luigi at gmail.com> wrote:
>
> I have seen that the only package that easily rotate the plot is
> ggplot, so I ran:
> ```
> library(ggplot2)
> df = data.frame(MR = c(negative_mr, uncertain_mr, positive_mr),
> FCN = c(negative_fcn, uncertain_fcn, positive_fcn))
> p <- ggplot(df, aes(x=MR)) +
> geom_density()
> p + coord_flip()
> ```
> Even in this case, the plot is correctly rotated, but I can't place it
> in the allocated panel. ggplot2 simply overwrites the whole plot. This
> means I need to do the whole thing in ggplot2 (would lattice have an
> equivalent?) and split the plot into uneven panels with ggplot2.
> Changing x into y is a clever approach, but it is not the same as
> rotating a plot. But YES, that is exactly what I wanted to plot. Thank
> you!

Well, traditional R graphics (as well as lattice) requires a more DIY
approach. As Paul already indicated, you need to control what you are
plotting instead of relying on plot(density(...)) doing the right
thing.

Modifying your original code:

```
layout(matrix(c(1,2),nrow=1), widths=c(3,1)) # split panels unevenly

plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
     xlab=expression(bold("X")),
     ylab=expression(bold("Y")))
points(positive_x, positive_y, pch=16, cex=1.5)
points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
legend("topleft",
       legend = c("Positives", "Negatives", "Uncertains"),
       pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)

## calculate density (but don't plot yet)
d <- density(c(negative_y, uncertain_y, positive_y))

## Your original code is equivalent to this
## plot(d,
##      yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)

plot(d$y, d$x, type = "l",
     ##yaxt="n",
     xaxt="n", main=NA, ylab=NA, xlab=NA)
```

Note that in the last plot, I have plot(d$y, d$x, ...) instead of
plot(d$x, d$y, ...).

I have commented out your yaxt="n" to highlight something that may not
be initially obvious, which is that the axis limits of your two plots
do not match. To ensure that, you would additionally need to match
ylim:

```
plot(d$y, d$x, type = "l", ylim=c(0,0.5),
     yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
```

Best,
-Deepayan

> On Wed, Oct 13, 2021 at 1:17 AM Bert Gunter <bgunter.4567 at gmail.com> wrote:
> >
> > I don't know the gridGraphics package, and I haven't looked closely at what you are trying to do. But note that lattice functions construct grid "grobs" that can be saved and plotted in arbitrary, including rotated, viewports, using the print.trellis function. I frankly am pretty ignorant about such things, but this simple little example might give you some notion of how to proceed. You may also be able to do what you want with grid.layout() and pushing a suitably rotated viewport onto a layout. Others would have to advise on such details, if so.
> >
> > If I'm wrong and this is useless, just ignore without comment.
> >
> >
> >
> > dp <- densityplot(~y, main = "",
> >                   xlab = "", ylab = "")
> > grid.newpage()
> > pushViewport(
> >    viewport(width = unit(.5,"npc"),
> >             height = unit(.3,"npc"),
> >             angle = 270))
> > print(dp, newp = FALSE,  ## this is the print.trellis method
> >       panel.width = list(1,"npc"),
> >       panel.height = list(1, "npc")
> > )
> >
> > Bert Gunter
> >
> > "The trouble with having an open mind is that people keep coming along and sticking things into it."
> > -- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )
> >
> >
> > On Tue, Oct 12, 2021 at 1:43 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
> >>
> >> Hello,
> >> I would like to show a density plot of the Y axis. To do that, I would
> >> like to split the plot into a panel 2/3 long and a density plot 1/3
> >> long. The problem is that, since the density is on the Y axis, the
> >> density plot should be rotated byb90 degrees. I tried with the package
> >> gridGraphics but it rotates both panels.
> >> ```
> >> negative_y <- runif(50, 0, 0.099)
> >> negative_x <- runif(50, 1, 40)
> >> positive_y <- c(runif(30, 0.2, 0.5), runif(20, 0.4, 0.5))
> >> positive_x <- c(runif(30, 25, 40), runif(20, 10, 25))
> >> uncertain_y <- runif(10, 0.099, 0.2)
> >> uncertain_x <- runif(10, 2, 40)
> >> # plot on MR/FCN space
> >> layout(matrix(c(1,2),nrow=1), widths=c(3,1)) # split panels unevenly
> >> plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
> >> xlab=expression(bold("X")),
> >> ylab=expression(bold("Y")))
> >> points(positive_x, positive_y, pch=16, cex=1.5)
> >> points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
> >> legend("topleft",
> >> legend = c("Positives", "Negatives", "Uncertains"),
> >> pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)
> >> # plot density
> >> plot(density(c(negative_y, uncertain_y, positive_y)),
> >> yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
> >> library(gridGraphics)
> >> grab_grob <- function(){
> >> grid.echo()
> >> grid.grab()
> >> }
> >> g <- grab_grob()
> >> grid.newpage()
> >> pushViewport(viewport(width=0.7,angle=270))
> >> grid.draw(g)
> >> ```
> >> How can I rotate only the second panel? I tried to assign the second
> >> plot to an object p and then call grid.draw(p), or to assign g to the
> >> second plot, but they did not work...
> >> Thanks
> >>
> >>
> >> --
> >> Best regards,
> >> Luigi
> >>
> >> ______________________________________________
> >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> >> https://stat.ethz.ch/mailman/listinfo/r-help
> >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> >> and provide commented, minimal, self-contained, reproducible code.
>
>
>
> --
> Best regards,
> Luigi
>
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.


From m@rong|u@|u|g| @end|ng |rom gm@||@com  Wed Oct 13 12:04:14 2021
From: m@rong|u@|u|g| @end|ng |rom gm@||@com (Luigi Marongiu)
Date: Wed, 13 Oct 2021 12:04:14 +0200
Subject: [R] How to rotate only one panel by 90 degrees in R plot?
In-Reply-To: <CADfFDC6O8gmiu4uWGB=hTwVkW55eL=q=Z9rQVX-kbehcP6Tk=Q@mail.gmail.com>
References: <CAMk+s2TAx0mXygcfSaNT9YxJg62d4Mk=_WczipVgB6uFDvZWFQ@mail.gmail.com>
 <CAGxFJbTFZhC-d+ovCeywMJA1Vb59kBJW3DnkCdMr3=VYnq6WXQ@mail.gmail.com>
 <CAMk+s2RHe68as2sHL0LHtZzMm6MGDth2n0DMdCPPuXaZZwjVeA@mail.gmail.com>
 <CADfFDC6O8gmiu4uWGB=hTwVkW55eL=q=Z9rQVX-kbehcP6Tk=Q@mail.gmail.com>
Message-ID: <CAMk+s2TfKOsiU6FX_Mxiv5x3Lk1AmbfhQsfgMWyjyB6QGqM+MQ@mail.gmail.com>

Thank you!

On Wed, Oct 13, 2021 at 12:00 PM Deepayan Sarkar
<deepayan.sarkar at gmail.com> wrote:
>
> On Wed, Oct 13, 2021 at 12:13 PM Luigi Marongiu
> <marongiu.luigi at gmail.com> wrote:
> >
> > I have seen that the only package that easily rotate the plot is
> > ggplot, so I ran:
> > ```
> > library(ggplot2)
> > df = data.frame(MR = c(negative_mr, uncertain_mr, positive_mr),
> > FCN = c(negative_fcn, uncertain_fcn, positive_fcn))
> > p <- ggplot(df, aes(x=MR)) +
> > geom_density()
> > p + coord_flip()
> > ```
> > Even in this case, the plot is correctly rotated, but I can't place it
> > in the allocated panel. ggplot2 simply overwrites the whole plot. This
> > means I need to do the whole thing in ggplot2 (would lattice have an
> > equivalent?) and split the plot into uneven panels with ggplot2.
> > Changing x into y is a clever approach, but it is not the same as
> > rotating a plot. But YES, that is exactly what I wanted to plot. Thank
> > you!
>
> Well, traditional R graphics (as well as lattice) requires a more DIY
> approach. As Paul already indicated, you need to control what you are
> plotting instead of relying on plot(density(...)) doing the right
> thing.
>
> Modifying your original code:
>
> ```
> layout(matrix(c(1,2),nrow=1), widths=c(3,1)) # split panels unevenly
>
> plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
>      xlab=expression(bold("X")),
>      ylab=expression(bold("Y")))
> points(positive_x, positive_y, pch=16, cex=1.5)
> points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
> legend("topleft",
>        legend = c("Positives", "Negatives", "Uncertains"),
>        pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)
>
> ## calculate density (but don't plot yet)
> d <- density(c(negative_y, uncertain_y, positive_y))
>
> ## Your original code is equivalent to this
> ## plot(d,
> ##      yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
>
> plot(d$y, d$x, type = "l",
>      ##yaxt="n",
>      xaxt="n", main=NA, ylab=NA, xlab=NA)
> ```
>
> Note that in the last plot, I have plot(d$y, d$x, ...) instead of
> plot(d$x, d$y, ...).
>
> I have commented out your yaxt="n" to highlight something that may not
> be initially obvious, which is that the axis limits of your two plots
> do not match. To ensure that, you would additionally need to match
> ylim:
>
> ```
> plot(d$y, d$x, type = "l", ylim=c(0,0.5),
>      yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
> ```
>
> Best,
> -Deepayan
>
> > On Wed, Oct 13, 2021 at 1:17 AM Bert Gunter <bgunter.4567 at gmail.com> wrote:
> > >
> > > I don't know the gridGraphics package, and I haven't looked closely at what you are trying to do. But note that lattice functions construct grid "grobs" that can be saved and plotted in arbitrary, including rotated, viewports, using the print.trellis function. I frankly am pretty ignorant about such things, but this simple little example might give you some notion of how to proceed. You may also be able to do what you want with grid.layout() and pushing a suitably rotated viewport onto a layout. Others would have to advise on such details, if so.
> > >
> > > If I'm wrong and this is useless, just ignore without comment.
> > >
> > >
> > >
> > > dp <- densityplot(~y, main = "",
> > >                   xlab = "", ylab = "")
> > > grid.newpage()
> > > pushViewport(
> > >    viewport(width = unit(.5,"npc"),
> > >             height = unit(.3,"npc"),
> > >             angle = 270))
> > > print(dp, newp = FALSE,  ## this is the print.trellis method
> > >       panel.width = list(1,"npc"),
> > >       panel.height = list(1, "npc")
> > > )
> > >
> > > Bert Gunter
> > >
> > > "The trouble with having an open mind is that people keep coming along and sticking things into it."
> > > -- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )
> > >
> > >
> > > On Tue, Oct 12, 2021 at 1:43 PM Luigi Marongiu <marongiu.luigi at gmail.com> wrote:
> > >>
> > >> Hello,
> > >> I would like to show a density plot of the Y axis. To do that, I would
> > >> like to split the plot into a panel 2/3 long and a density plot 1/3
> > >> long. The problem is that, since the density is on the Y axis, the
> > >> density plot should be rotated byb90 degrees. I tried with the package
> > >> gridGraphics but it rotates both panels.
> > >> ```
> > >> negative_y <- runif(50, 0, 0.099)
> > >> negative_x <- runif(50, 1, 40)
> > >> positive_y <- c(runif(30, 0.2, 0.5), runif(20, 0.4, 0.5))
> > >> positive_x <- c(runif(30, 25, 40), runif(20, 10, 25))
> > >> uncertain_y <- runif(10, 0.099, 0.2)
> > >> uncertain_x <- runif(10, 2, 40)
> > >> # plot on MR/FCN space
> > >> layout(matrix(c(1,2),nrow=1), widths=c(3,1)) # split panels unevenly
> > >> plot(negative_x, negative_y, ylim=c(0,0.5), xlim=c(0,41), cex=1.5,
> > >> xlab=expression(bold("X")),
> > >> ylab=expression(bold("Y")))
> > >> points(positive_x, positive_y, pch=16, cex=1.5)
> > >> points(uncertain_x, uncertain_y, pch=16, cex=1.5, col="grey")
> > >> legend("topleft",
> > >> legend = c("Positives", "Negatives", "Uncertains"),
> > >> pch = c(16, 1, 16), col=c("black", "black", "grey"), cex=0.8)
> > >> # plot density
> > >> plot(density(c(negative_y, uncertain_y, positive_y)),
> > >> yaxt="n", xaxt="n", main=NA, ylab=NA, xlab=NA)
> > >> library(gridGraphics)
> > >> grab_grob <- function(){
> > >> grid.echo()
> > >> grid.grab()
> > >> }
> > >> g <- grab_grob()
> > >> grid.newpage()
> > >> pushViewport(viewport(width=0.7,angle=270))
> > >> grid.draw(g)
> > >> ```
> > >> How can I rotate only the second panel? I tried to assign the second
> > >> plot to an object p and then call grid.draw(p), or to assign g to the
> > >> second plot, but they did not work...
> > >> Thanks
> > >>
> > >>
> > >> --
> > >> Best regards,
> > >> Luigi
> > >>
> > >> ______________________________________________
> > >> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > >> https://stat.ethz.ch/mailman/listinfo/r-help
> > >> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > >> and provide commented, minimal, self-contained, reproducible code.
> >
> >
> >
> > --
> > Best regards,
> > Luigi
> >
> > ______________________________________________
> > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > https://stat.ethz.ch/mailman/listinfo/r-help
> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> > and provide commented, minimal, self-contained, reproducible code.



-- 
Best regards,
Luigi


From Ry@n@Der|ck@on @end|ng |rom v@@gov  Wed Oct 13 16:09:12 2021
From: Ry@n@Der|ck@on @end|ng |rom v@@gov (Derickson, Ryan, VHA NCOD)
Date: Wed, 13 Oct 2021 14:09:12 +0000
Subject: [R] unexpected behavior in apply
In-Reply-To: <a71107e9441e476db477fe28acfff8d1@SRVEXCHCM1302.precheza.cz>
References: <DM8PR09MB733303431EF91EF8B137EB94F7B29@DM8PR09MB7333.namprd09.prod.outlook.com>
 <CAGiFhPN4C2zinAm7_UjrdkYvtMVu7SUvVV3VUMLJYbG4Pd+XMA@mail.gmail.com>
 <CAGiFhPNg+3A+gQjXOGEM=_tVAi=41hpW_Xp-F4VrZOfSCn-y4A@mail.gmail.com>
 <a71107e9441e476db477fe28acfff8d1@SRVEXCHCM1302.precheza.cz>
Message-ID: <DM8PR09MB733335A9C841028D14AA8081F7B79@DM8PR09MB7333.namprd09.prod.outlook.com>

If an oven expects fried potatoes and I put a cake in, I would hope it
complains or does nothing rather than surreptitiously poisoning my cake.
Jiefei's finding that "6" becomes " 6" during matrix coercion (apparently
for aesthetic reasons only) feels more like the latter. But I appreciate the
explanation and the solutions.   



-----Original Message-----
From: PIKAL Petr <petr.pikal at precheza.cz> 
Sent: Monday, October 11, 2021 5:15 AM
To: Jiefei Wang <szwjf08 at gmail.com>; Derickson, Ryan, VHA NCOD
<Ryan.Derickson at va.gov>
Cc: r-help at r-project.org
Subject: [EXTERNAL] RE: [R] unexpected behavior in apply

Hi

it is not surprising at all.

from apply documentation

Arguments
X	
an array, including a matrix.

data.frame is not matrix or array (even if it rather resembles one)

So if you put a cake into oven you cannot expect getting fried potatoes from
it.

For data frames sapply or lapply is preferable as it is designed for lists
and data frame is (again from documentation)

A data frame is a list of variables of the same number of rows with unique
row names, given class "data.frame".

> sapply(d,function(x) all(x[!is.na(x)]<=3))
   d1    d2    d3 
FALSE  TRUE FALSE 

Cheers
Petr


> -----Original Message-----
> From: R-help <r-help-bounces at r-project.org> On Behalf Of Jiefei Wang
> Sent: Friday, October 8, 2021 8:22 PM
> To: Derickson, Ryan, VHA NCOD <Ryan.Derickson at va.gov>
> Cc: r-help at r-project.org
> Subject: Re: [R] unexpected behavior in apply
> 
> Ok, it turns out that this is documented, even though it looks surprising.
> 
> First of all, the apply function will try to convert any object with the
dim
> attribute to a matrix(my intuition agrees with you that there should be no
> conversion), so the first step of the apply function is
> 
> > as.matrix.data.frame(d)
>      d1  d2  d3
> [1,] "a" "1" NA
> [2,] "b" "2" NA
> [3,] "c" "3" " 6"
> 
> Since the data frame `d` is a mixture of character and non-character
values,
> the non-character value will be converted to the character using the
function
> `format`. However, the problem is that the NA value will also be formatted
to
> the character
> 
> > format(c(NA, 6))
> [1] "NA" " 6"
> 
> That's where the space comes from. It is purely for making the result
pretty...
> The character NA will be removed later, but the space is not stripped. I
would
> say this is not a good design, and it might be worth not including the NA
value
> in the format function. At the current stage, I will suggest using the
function
> `lapply` to do what you want.
> 
> > lapply(d, FUN=function(x)all(x[!is.na(x)] <= 3))
> $d1
> [1] FALSE
> $d2
> [1] TRUE
> $d3
> [1] FALSE
> 
> Everything should work as you expect.
> 
> Best,
> Jiefei
> 
> On Sat, Oct 9, 2021 at 2:03 AM Jiefei Wang <szwjf08 at gmail.com> wrote:
> >
> > Hi,
> >
> > I guess this can tell you what happens behind the scene
> >
> >
> > > d<-data.frame(d1 = letters[1:3],
> > +               d2 = c(1,2,3),
> > +               d3 = c(NA,NA,6))
> > > apply(d, 2, FUN=function(x)x)
> >      d1  d2  d3
> > [1,] "a" "1" NA
> > [2,] "b" "2" NA
> > [3,] "c" "3" " 6"
> > > "a"<=3
> > [1] FALSE
> > > "2"<=3
> > [1] TRUE
> > > "6"<=3
> > [1] FALSE
> >
> > Note that there is an additional space in the character value " 6",
> > that's why your comparison fails. I do not understand why but this
> > might be a bug in R
> >
> > Best,
> > Jiefei
> >
> > On Sat, Oct 9, 2021 at 1:49 AM Derickson, Ryan, VHA NCOD via R-help
> > <r-help at r-project.org> wrote:
> > >
> > > Hello,
> > >
> > > I'm seeing unexpected behavior when using apply() compared to a for
> loop when a character vector is part of the data subjected to the apply
> statement. Below, I check whether all non-missing values are <= 3. If I
> include a character column, apply incorrectly returns TRUE for d3. If I
only
> pass the numeric columns to apply, it is correct for d3. If I use a for
loop, it is
> correct.
> > >
> > > > d<-data.frame(d1 = letters[1:3],
> > > +               d2 = c(1,2,3),
> > > +               d3 = c(NA,NA,6))
> > > >
> > > > d
> > >   d1 d2 d3
> > > 1  a  1 NA
> > > 2  b  2 NA
> > > 3  c  3  6
> > > >
> > > > # results are incorrect
> > > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d1    d2    d3
> > > FALSE  TRUE  TRUE
> > > >
> > > > # results are correct
> > > > apply(d[,2:3], 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d2    d3
> > >  TRUE FALSE
> > > >
> > > > # results are correct
> > > > for(i in names(d)){
> > > +   print(all(d[!is.na(d[,i]),i] <= 3)) }
> > > [1] FALSE
> > > [1] TRUE
> > > [1] FALSE
> > >
> > >
> > > Finally, if I remove the NA values from d3 and include the character
> column in apply, it is correct.
> > >
> > > > d<-data.frame(d1 = letters[1:3],
> > > +               d2 = c(1,2,3),
> > > +               d3 = c(4,5,6))
> > > >
> > > > d
> > >   d1 d2 d3
> > > 1  a  1  4
> > > 2  b  2  5
> > > 3  c  3  6
> > > >
> > > > # results are correct
> > > > apply(d, 2, FUN=function(x)all(x[!is.na(x)] <= 3))
> > >    d1    d2    d3
> > > FALSE  TRUE FALSE
> > >
> > >
> > > Can someone help me understand what's happening?
> > >
> > > ______________________________________________
> > > R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> > > https://stat.ethz.ch/mailman/listinfo/r-help
> > > PLEASE do read the posting guide
> > > http://www.R-project.org/posting-guide.html
> > > and provide commented, minimal, self-contained, reproducible code.
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-
> guide.html
> and provide commented, minimal, self-contained, reproducible code.

