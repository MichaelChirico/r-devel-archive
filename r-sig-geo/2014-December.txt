From rway024 at uottawa.ca  Mon Dec  1 02:25:21 2014
From: rway024 at uottawa.ca (Robert Way)
Date: Sun, 30 Nov 2014 20:25:21 -0500
Subject: [R-sig-Geo] Spatial interpolation using thin plate spline [fields]
	through time
Message-ID: <CALxJZ4ASkj7whCE6M5mXYJProL7v=2vCaW9UoGpo7euhs7zAvg@mail.gmail.com>

Hello,
I am trying to interpolate air temperature surfaces through time and space
in my study region. After testing a number of different techniques (e.g.
co-kriging) I have evaluated that for my test data the Thin Plate Spline
implementation from the *fields *package gives the best results against
out-of-sample data over a test period.

I am looking to apply the TPS interpolation to cover the whole time period
of study (e.g. 50 years) at the seasonal timescale with .geotiffs of
interpolated air temperatures being output at each step meaning that I am
looking to iteratively feed the TPS function the same X-inputs
(xposition,yposition, zposition) from the station data but different
columns of my Y-input with the temperature of each season through the time
interval.

I am hoping to get some advice on the best way of solving this problem
which efficiently uses computing resources considering this project will be
a huge drain on computing time for the more powerful computers in our Lab.
For instance, is it best if I find a way to build a function and feed it
with a loop or alternatively other methods such as with apply(). Another
question is whether it is best to output each raster individually or to
create a rasterstack or rasterbrick and split it afterwards. Overall i've
found outputting the .tif files and running calcs on large rasters in R to
be time consuming so any advice would be helpful. Thank you for your time.


Although I have not written a test example the code below is very simple
and shows what I have done:

### Load required packages ###
library(fields)
library(raster)
library(spatial.tools)
library(gdalUtils)
library(mapplots)
library(rgdal)
library(gstat)

### Use more computing resources ###
sfQuickInit()

### Load X-Data - in this case three columns with x,y and z positions per
station ###
xdata <- file.choose()
x <- read.csv(xdata, TRUE, ",")

### Load Y-Data - in this case data.frame of air temperatures through time
per station ###
### Columns = time intervals ### Rows = individual stations
ydata <- file.choose()
y <- read.csv(ydata, TRUE, ",")

### Load elevation data ###
elev1k <- raster("dem1k.tif")

### Thin plate spline fit for first time interval ###
fit <- Tps(x, y[,1])

## Output diagnostic plots ###
set.panel(2,2)
plot(fit)
dev.off()

### Creating interpolated surface for first time interval ###
result <- interpolate(elev1k,fit, xyOnly=FALSE)

### Output geotiff ###
writeRaster(result, "TPSresult.tif", overwrite=TRUE)

-- 

*Robert*

	[[alternative HTML version deleted]]


From jianyun.fred.wu at gmail.com  Mon Dec  1 03:00:08 2014
From: jianyun.fred.wu at gmail.com (Jianyun Wu)
Date: Mon, 1 Dec 2014 13:00:08 +1100
Subject: [R-sig-Geo] How to delete some polygons from
	'SpatialPolygonsDataFrame'
In-Reply-To: <alpine.LRH.2.03.1411281051330.4437@reclus.nhh.no>
References: <CAOMGRD+EadNHjNQw_HFDcEbbmKJuvC9RxB_NgLRzrV5MdispWA@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9EF8D6E@DKRDSEXC016.vestas.net>
	<alpine.LRH.2.03.1411281051330.4437@reclus.nhh.no>
Message-ID: <CAOMGRDJCj3Z1q2JJP0HqC29Q3EgHtJSCceE-gV35SKj0a3Okkw@mail.gmail.com>

Hi Roger,

You are right, it is polygon 1:12 making the remote islands.
Thanks for a very detailed example.
It worked after I tried your method on my shapefile.

I actually used ggplot() after fortify() the data in the first place. The
remote islands were easily deleted from the dataframe. However, as you
illustrated, if I want to plot the neighbour structure, it is such a mess,
and interaction with ggplot is yet unknown to me.

Thanks and Regards

Fred ?

On Fri, Nov 28, 2014 at 9:38 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Fri, 28 Nov 2014, Frede Aakmann T?gersen wrote:
>
>  Hi
>>
>> If nsw_lga[153, ] is the island that you do not want to plot then you can
>> do
>>
>
> I think that the problem is that only Polygon objects 1:12 in Polygons
> object 153 are the islands, while 13:14 are larger and do not have label
> point longitude > 159. One possibility then is to take out the Polygons
> object (using Scotland in rgdal as an example and recalling Barry
> Rowlingson's insight that someone added slivers of islands to their desired
> proximate neighbours - so part of 48 Shetland is on Orkney):
>
> library(rgdal)
> dsn <- system.file("vectors", package = "rgdal")[1]
> scot_BNG <- readOGR(dsn=dsn, layer="scot_BNG")
> plot(scot_BNG)
> plot(scot_BNG[48,], col="red", add=TRUE)
> library(spdep)
> nb <- poly2nb(scot_BNG)
> plot(nb, coordinates(scot_BNG), add=TRUE)
>
> If we drop Shetland and Fair Isle (using a latitude cutoff):
>
> scot_BNG1 <- scot_BNG
> pols48 <- slot(scot_BNG1, "polygons")[[48]]
> pol48 <- slot(pols48, "Polygons")
> length(pol48)
> sapply(pol48, function(x) {slot(x, "labpt")[2]})
>
> res <- pol48[sapply(pol48, function(x) {slot(x, "labpt")[2]}) < 1050000]
>
> slot(pols48, "Polygons") <- res
> slot(scot_BNG1, "polygons")[[48]] <- pols48
>
> plot(scot_BNG1, lwd=3, add=TRUE)
> bbox(scot_BNG)
> bbox(scot_BNG1)
>
> we appear to get what we want (but the plot order and bounding box of the
> SpatialPolygons object are not updated to match the exclusion).
> Alternatively, and reconstructing the object, use rgeos:
>
> library(rgeos)
> bb <- bbox(scot_BNG)
> plot(scot_BNG)
> plot(scot_BNG[48,], col="red", add=TRUE)
>
> crds <- cbind(x=c(bb[1, 1]-1, bb[1, 1]-1, bb[1, 2]+1, bb[1, 2]+1,
>  bb[1, 1]-1),  y=c(bb[2, 1]-1, 1050000, 1050000, bb[2, 1]-1, bb[2, 1]-1))
> c1 <- SpatialPolygons(list(Polygons(list(Polygon(crds)), "1")),
>  proj4string=CRS(proj4string(scot_BNG)))
> plot(c1, add=TRUE, lty=2)
>
> scot_BNG2a <- gIntersection(scot_BNG, c1, byid=c(TRUE, FALSE))
> scot_BNG2b <- SpatialPolygonsDataFrame(scot_BNG2a, data=slot(scot_BNG,
>  "data"))
>
> plot(scot_BNG2b, lwd=3, add=TRUE)
> bbox(scot_BNG)
> bbox(scot_BNG2b)
>
> Hope this clarifies,
>
> Roger
>
>
>
>> plot(nsw_lga[ -153,  ])
>>
>> or you can set an xlim in plot()
>>
>> plot(nsw_lga, xlim = c(140, 153))
>>
>> you may perhaps need play with the settings of xlim to find the right
>> ones.
>>
>> If you want to have an object without the island then do
>>
>> nsw_lga_wo_island <- nsw_lga[ -153,  ]
>>
>> Something like
>>
>> nsw_lga[ -153,  ] <- NULL doesn't seem to work. Don't know if something
>> similar will work.
>>
>>
>> Yours sincerely / Med venlig hilsen
>>
>>
>> Frede Aakmann T?gersen
>> Specialist, M.Sc., Ph.D.
>> Plant Performance & Modeling
>>
>> Technology & Service Solutions
>> T +45 9730 5135
>> M +45 2547 6050
>> frtog at vestas.com
>> http://www.vestas.com
>>
>> Company reg. name: Vestas Wind Systems A/S
>> This e-mail is subject to our e-mail disclaimer statement.
>> Please refer to www.vestas.com/legal/notice
>> If you have received this e-mail in error please contact the sender.
>>
>>  -----Original Message-----
>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
>>> Jianyun Wu
>>> Sent: 28. november 2014 06:33
>>> To: R-sig-Geo at r-project.org
>>> Subject: [R-sig-Geo] How to delete some polygons from
>>> 'SpatialPolygonsDataFrame'
>>>
>>> Dear list,
>>>
>>> I usually use 'readOGR()' from rgdal package in R to input the ESRI
>>> shapefile.
>>> So the inputted data are SpatialPolygonsDataFrame.
>>>
>>> I am processing the New South Wales, Australia map for a spatial
>>> analysis.
>>> There is an island far away from the mainland, which I want to delete it
>>> from the map when I plot NSW.  Because it makes the whole plot small due
>>> to
>>> its long distant.
>>>
>>> Below is the area contains the polygons of this island and surrounding
>>> islands. There are 14 "@Polygons" contributing to the entire area. From
>>> some experiments, I know that it is Polygon 3-14 making the distant
>>> islands.
>>>
>>> Is there a simple way that I can delete those small polygons from this
>>> area
>>> polygon and their attributes from the data
>>>
>>> Thank you
>>>
>>> Fred
>>>
>>> str(nsw_lga[153, ])
>>> Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots
>>>   ..@ data       :'data.frame':    1 obs. of  3 variables:
>>>   .. ..$ STATE_CODE: Factor w/ 9 levels "1","2","3","4",..: 1
>>>   .. ..$ LGA_CODE11: Factor w/ 565 levels "10050","10110",..: 153
>>>   .. ..$ LGA_NAME11: Factor w/ 564 levels "Adelaide (C)",..: 483
>>>   ..@ polygons   :List of 1
>>>   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
>>>   .. .. .. ..@ Polygons :List of 14
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 3.83e-07
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:38, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 4.69e-07
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:13, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 7.82e-07
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:31, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 1.02e-06
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:47, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 1.14e-06
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:22, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
>>>   .. .. .. .. .. .. ..@ area   : num 1.38e-06
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:24, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 1.52e-06
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:26, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 2.05e-06
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:32, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 2.61e-06
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:36, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 4.27e-06
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:109, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.5
>>>   .. .. .. .. .. .. ..@ area   : num 1.42e-05
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:85, 1:2] 159 159 159 159 159 ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 159.1 -31.6
>>>   .. .. .. .. .. .. ..@ area   : num 0.00152
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:2929, 1:2] 159 159 159 159 159
>>> ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 142.2 -30.7
>>>   .. .. .. .. .. .. ..@ area   : num 8.79
>>>   .. .. .. .. .. .. ..@ hole   : logi FALSE
>>>   .. .. .. .. .. .. ..@ ringDir: int 1
>>>   .. .. .. .. .. .. ..@ coords : num [1:5178, 1:2] 144 144 144 144 144
>>> ...
>>>   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
>>>   .. .. .. .. .. .. ..@ labpt  : num [1:2] 141.5 -31.9
>>>   .. .. .. .. .. .. ..@ area   : num 0.0162
>>>   .. .. .. .. .. .. ..@ hole   : logi TRUE
>>>   .. .. .. .. .. .. ..@ ringDir: int -1
>>>   .. .. .. .. .. .. ..@ coords : num [1:131, 1:2] 141 141 141 141 141 ...
>>>   .. .. .. ..@ plotOrder: int [1:14] 13 14 12 11 10 9 8 7 6 5 ...
>>>   .. .. .. ..@ labpt    : num [1:2] 142.2 -30.7
>>>   .. .. .. ..@ ID       : chr "152"
>>>   .. .. .. ..@ area     : num 8.79
>>>   ..@ plotOrder  : int 1
>>>   ..@ bbox       : num [1:2, 1:2] 141 -33.4 159.1 -29
>>>   .. ..- attr(*, "dimnames")=List of 2
>>>   .. .. ..$ : chr [1:2] "x" "y"
>>>   .. .. ..$ : chr [1:2] "min" "max"
>>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
>>>   .. .. ..@ projargs: chr "+proj=longlat +ellps=GRS80 +no_defs"
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no

	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Mon Dec  1 09:24:09 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 1 Dec 2014 00:24:09 -0800
Subject: [R-sig-Geo] Calculating what proportion of polygons is covered
	by rivers
In-Reply-To: <CAHMizkMu2m2PFq4iR2AYRO90bZ3muyBkCvMgUmCcf6E5BmUxag@mail.gmail.com>
References: <CAHMizkMu2m2PFq4iR2AYRO90bZ3muyBkCvMgUmCcf6E5BmUxag@mail.gmail.com>
Message-ID: <CANtt_hySmfjAqR6vE1TKX5eEpkFyGu7=i6Nic=AZuBueVr__Fg@mail.gmail.com>

Juta,
I think you can do something along these lines:

library(raster)
library(rgeos)

x <- union(districts, rivers)
a <- gArea(x, byid=TRUE)
head(x)
head(a)

or
x <- intersect(districts, rivers)

and compare to 'districts'

Robert


On Sun, Nov 30, 2014 at 2:59 PM, Juta Kawalerowicz
<juta.kawalerowicz at nuffield.ox.ac.uk> wrote:
> Hi, I have question - I am looking for ideas how to proceed.
>
> I have a SpatialPolygonsDataFrame with polygons (300) representing
> districts. Another SpatialPolygonsDataFrame has 700 polygons and these
> polygons represent rivers and flooding areas. My question is how would you
> go about calculating what proportion of districts is covered by rivers and
> flooding areas?
>
> My first intuition was to rasterize it and then use the extract function
> but maybe I am overcomplicating this. Any ideas would be appreciated.
>
> Thanks,
> Juta
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From m.yang at student.utwente.nl  Mon Dec  1 10:31:47 2014
From: m.yang at student.utwente.nl (Mengxi Yang)
Date: Mon, 1 Dec 2014 10:31:47 +0100
Subject: [R-sig-Geo] rainfall interpolation using ANN
Message-ID: <CA+vD2zqQ9FESeynNcFb=-Q62Oy-aq=rDhTMNc36f1ZtTYSWdCA@mail.gmail.com>

Dear list,
I am going to do daily rainfall interpolation using ANN. but I am not
familiar with it. Can somebody give some advise or example?

my data like:
 I have 325 stations in different location.each station have unique code
and coordinates. And I want to interpolate in 1km resolution. I have the
mask map of NL.
[image: Inline image 2]

can someone give me some advice? because I want to compare ANN with Kriging
and IDW.
Thank you very much.

Mengxi Yang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141201/f1cbf4f1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 14586 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141201/f1cbf4f1/attachment.png>

From juta.kawalerowicz at nuffield.ox.ac.uk  Mon Dec  1 11:07:58 2014
From: juta.kawalerowicz at nuffield.ox.ac.uk (Juta Kawalerowicz)
Date: Mon, 1 Dec 2014 10:07:58 +0000
Subject: [R-sig-Geo] Calculating what proportion of polygons is covered
	by rivers
In-Reply-To: <9c6ee602-72f4-4d81-ab00-3aa78afd9d8e@HUB01.ad.oak.ox.ac.uk>
References: <CAHMizkMu2m2PFq4iR2AYRO90bZ3muyBkCvMgUmCcf6E5BmUxag@mail.gmail.com>
	<9c6ee602-72f4-4d81-ab00-3aa78afd9d8e@HUB01.ad.oak.ox.ac.uk>
Message-ID: <CAHMizkOwzSCNOTJjck33UhCndfmo2t+dcAtTb5dk7R4eBi6zFA@mail.gmail.com>

Many thanks for this suggestion Robert. Meanwhile, for anyone trying to
solve similar problem in the future a nice walk though is on page 139-140
of the new edition of Applied Spatial Data Analysis with R book!

Juta

On Mon, Dec 1, 2014 at 8:24 AM, Robert J. Hijmans <r.hijmans at gmail.com>
wrote:

> Juta,
> I think you can do something along these lines:
>
> library(raster)
> library(rgeos)
>
> x <- union(districts, rivers)
> a <- gArea(x, byid=TRUE)
> head(x)
> head(a)
>
> or
> x <- intersect(districts, rivers)
>
> and compare to 'districts'
>
> Robert
>
>
> On Sun, Nov 30, 2014 at 2:59 PM, Juta Kawalerowicz
> <juta.kawalerowicz at nuffield.ox.ac.uk> wrote:
> > Hi, I have question - I am looking for ideas how to proceed.
> >
> > I have a SpatialPolygonsDataFrame with polygons (300) representing
> > districts. Another SpatialPolygonsDataFrame has 700 polygons and these
> > polygons represent rivers and flooding areas. My question is how would
> you
> > go about calculating what proportion of districts is covered by rivers
> and
> > flooding areas?
> >
> > My first intuition was to rasterize it and then use the extract function
> > but maybe I am overcomplicating this. Any ideas would be appreciated.
> >
> > Thanks,
> > Juta
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From nlee at valleywater.org  Mon Dec  1 19:31:54 2014
From: nlee at valleywater.org (Nahm Lee)
Date: Mon, 1 Dec 2014 18:31:54 +0000
Subject: [R-sig-Geo] rainfall interpolation using ANN
In-Reply-To: <CA+vD2zqQ9FESeynNcFb=-Q62Oy-aq=rDhTMNc36f1ZtTYSWdCA@mail.gmail.com>
References: <CA+vD2zqQ9FESeynNcFb=-Q62Oy-aq=rDhTMNc36f1ZtTYSWdCA@mail.gmail.com>
Message-ID: <4F96A3E542010442B8785D2CC23841471A56A700@SrvExchMbx1.scvwd.gov>

This is my example with idw based on a web site, # http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html.

Nahm Lee
nlee at valleywater.org<mailto:nlee at valleywater.org>



# http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html

library(ggplot2)
library(gstat)
library(sp)
library(maptools)
library(rgeos)

setwd("C:/Users/Michael/Dropbox/R/SHP")

AlertRain <- read.csv(file = "AlertRain.csv",header = TRUE)

names(AlertRain)

AlertRain_test <- AlertRain   # duplicate air temp. data file
AlertRain$x <- AlertRain$longitude  # define x & y as longitude and latitude
AlertRain$y <- AlertRain$latitude

# Set spatial coordinates to create a Spatial object:
coordinates(AlertRain_test) = ~x + y

plot(AlertRain_test)

# Define the grid extent:
#x.range <- as.numeric(c(21.76, 28.21))  # min/max longitude of the interpolation area
#y.range <- as.numeric(c(57.45, 59.72))  # min/max latitude of the interpolation area

x.range <- c(min(round(AlertRain_test$x,2)-0.1),max(round(AlertRain_test$x,2)+0.1))
y.range <- c(min(round(AlertRain_test$y,2)-0.1),max(round(AlertRain_test$y,2)+0.1))

# Create a data frame from all combinations of the supplied vectors or factors.
# See the description of the return value for precise details of the way this is done.
# Set spatial coordinates to create a Spatial object. Assign gridded structure:
grd <- expand.grid(x = seq(from = x.range[1], to = x.range[2], by = 0.1), y = seq(from = y.range[1],
    to = y.range[2], by = 0.1))  # expand points to grid
coordinates(grd) <- ~x + y
gridded(grd) <- TRUE

#Plot the weather station locations and interpolation grid:
plot(grd, cex = 1.5, col = "grey")
points(AlertRain_test, pch = 1, col = "red", cex = 1)

# interpolate surface and fix the output:

idw <- idw(formula = Elevation ~ 1, locations = AlertRain_test,
    newdata = grd)  # apply idw model for the data
## [inverse distance weighted interpolation]

idw.output = as.data.frame(idw)  # output is defined as a data table
names(idw.output)[1:3] <- c("long", "lat", "var1.pred")  # give names to the modelled variables

#Plot the results:

ggplot() + geom_tile(data = idw.output, aes(x = long, y = lat, fill = var1.pred)) + scale_fill_gradient(low = "cyan", high = "orange")+
    geom_point(data = AlertRain, aes(x = longitude, y = latitude), shape = 21,
        colour = "red")+labs(title = "Elevation by rainfall station elevation")



From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Mengxi Yang
Sent: Monday, December 01, 2014 1:32 AM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] rainfall interpolation using ANN

Dear list,
I am going to do daily rainfall interpolation using ANN. but I am not familiar with it. Can somebody give some advise or example?

my data like:
 I have 325 stations in different location.each station have unique code and coordinates. And I want to interpolate in 1km resolution. I have the mask map of NL.
[Inline image 2]

can someone give me some advice? because I want to compare ANN with Kriging and IDW.
Thank you very much.

Mengxi Yang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141201/12a09645/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 14586 bytes
Desc: image001.png
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141201/12a09645/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: AlertRain.csv
Type: application/octet-stream
Size: 2304 bytes
Desc: AlertRain.csv
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141201/12a09645/attachment.obj>

From pingyang.whu at gmail.com  Tue Dec  2 17:45:14 2014
From: pingyang.whu at gmail.com (ping yang)
Date: Tue, 2 Dec 2014 10:45:14 -0600
Subject: [R-sig-Geo] rainfall interpolation using ANN
In-Reply-To: <4F96A3E542010442B8785D2CC23841471A56A700@SrvExchMbx1.scvwd.gov>
References: <CA+vD2zqQ9FESeynNcFb=-Q62Oy-aq=rDhTMNc36f1ZtTYSWdCA@mail.gmail.com>
	<4F96A3E542010442B8785D2CC23841471A56A700@SrvExchMbx1.scvwd.gov>
Message-ID: <CAK8gSG-TGEwSXgZmOmXmcnwcc8KCZMsswKuabQ9n-=7T9Fc-+Q@mail.gmail.com>

Hi Nahm Lee and R-sig-geo,

I am quite interested in the IDW interpolation comparing to other methods
such as Krige, I have a code like this which I think also did the IDW:

library(gstat)
library(maptools)
library(raster)
dat71 <- readShapePoints("d:/FireDanger/IDW/71stations.shp")
bubble(dat71,"VALUE1")
sample.grid <- raster("rawsd_71Stations.tif")
Left <- bbox(sample.grid)[1]
Right <- bbox(sample.grid)[3]
Bottom <- bbox(sample.grid)[2]
Top <- bbox(sample.grid)[4]
cell.size <- res(sample.grid)
grid.xy <- expand.grid(x = seq(Left, Right, cell.size[1]), y = seq(Top,
Bottom, -cell.size[2]))
coordinates(grid.xy) <- ~x + y
gridded(grid.xy) = TRUE
value71.idw <- krige(VALUE1 ~ 1, dat71, grid.xy)
spplot(value71.idw["var1.pred"])
r_grid71 <- raster(value71.idw["var1.pred"])
plot(r_grid71)

However, I am not sure it is correct. Have someone using this method to do
the IDW? and One more question, How can I complete a Krige application
based on a shapefile (there are other examples using the spreedsheet).

Looking forward to hearing from you.

Peter

On Mon, Dec 1, 2014 at 12:31 PM, Nahm Lee <nlee at valleywater.org> wrote:

>  This is my example with idw based on a web site, #
> http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html.
>
>
>
> Nahm Lee
>
> nlee at valleywater.org
>
>
>
>
>
>
>
> # http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html
>
>
>
> library(ggplot2)
>
> library(gstat)
>
> library(sp)
>
> library(maptools)
>
> library(rgeos)
>
>
>
> setwd("C:/Users/Michael/Dropbox/R/SHP")
>
>
>
> AlertRain <- read.csv(file = "AlertRain.csv",header = TRUE)
>
>
>
> names(AlertRain)
>
>
>
> AlertRain_test <- AlertRain   # duplicate air temp. data file
>
> AlertRain$x <- AlertRain$longitude  # define x & y as longitude and
> latitude
>
> AlertRain$y <- AlertRain$latitude
>
>
>
> # Set spatial coordinates to create a Spatial object:
>
> coordinates(AlertRain_test) = ~x + y
>
>
>
> plot(AlertRain_test)
>
>
>
> # Define the grid extent:
>
> #x.range <- as.numeric(c(21.76, 28.21))  # min/max longitude of the
> interpolation area
>
> #y.range <- as.numeric(c(57.45, 59.72))  # min/max latitude of the
> interpolation area
>
>
>
> x.range <-
> c(min(round(AlertRain_test$x,2)-0.1),max(round(AlertRain_test$x,2)+0.1))
>
> y.range <-
> c(min(round(AlertRain_test$y,2)-0.1),max(round(AlertRain_test$y,2)+0.1))
>
>
>
> # Create a data frame from all combinations of the supplied vectors or
> factors.
>
> # See the description of the return value for precise details of the way
> this is done.
>
> # Set spatial coordinates to create a Spatial object. Assign gridded
> structure:
>
> grd <- expand.grid(x = seq(from = x.range[1], to = x.range[2], by = 0.1),
> y = seq(from = y.range[1],
>
>     to = y.range[2], by = 0.1))  # expand points to grid
>
> coordinates(grd) <- ~x + y
>
> gridded(grd) <- TRUE
>
>
>
> #Plot the weather station locations and interpolation grid:
>
> plot(grd, cex = 1.5, col = "grey")
>
> points(AlertRain_test, pch = 1, col = "red", cex = 1)
>
>
>
> # interpolate surface and fix the output:
>
>
>
> idw <- idw(formula = Elevation ~ 1, locations = AlertRain_test,
>
>     newdata = grd)  # apply idw model for the data
>
> ## [inverse distance weighted interpolation]
>
>
>
> idw.output = as.data.frame(idw)  # output is defined as a data table
>
> names(idw.output)[1:3] <- c("long", "lat", "var1.pred")  # give names to
> the modelled variables
>
>
>
> #Plot the results:
>
>
>
> ggplot() + geom_tile(data = idw.output, aes(x = long, y = lat, fill =
> var1.pred)) + scale_fill_gradient(low = "cyan", high = "orange")+
>
>     geom_point(data = AlertRain, aes(x = longitude, y = latitude), shape =
> 21,
>
>         colour = "red")+labs(title = "Elevation by rainfall station
> elevation")
>
>
>
>
>
>
>
> *From:* R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] *On Behalf Of *Mengxi
> Yang
> *Sent:* Monday, December 01, 2014 1:32 AM
> *To:* r-sig-geo at r-project.org
> *Subject:* [R-sig-Geo] rainfall interpolation using ANN
>
>
>
> Dear list,
>
> I am going to do daily rainfall interpolation using ANN. but I am not
> familiar with it. Can somebody give some advise or example?
>
>
>
> my data like:
>
>  I have 325 stations in different location.each station have unique code
> and coordinates. And I want to interpolate in 1km resolution. I have the
> mask map of NL.
>
> [image: Inline image 2]
>
>
>
> can someone give me some advice? because I want to compare ANN with
> Kriging and IDW.
>
> Thank you very much.
>
>
>
> Mengxi Yang
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141202/b7954585/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 14586 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141202/b7954585/attachment.png>

From r.hijmans at gmail.com  Tue Dec  2 18:17:59 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 2 Dec 2014 09:17:59 -0800
Subject: [R-sig-Geo] rainfall interpolation using ANN
In-Reply-To: <CAK8gSG-TGEwSXgZmOmXmcnwcc8KCZMsswKuabQ9n-=7T9Fc-+Q@mail.gmail.com>
References: <CA+vD2zqQ9FESeynNcFb=-Q62Oy-aq=rDhTMNc36f1ZtTYSWdCA@mail.gmail.com>
	<4F96A3E542010442B8785D2CC23841471A56A700@SrvExchMbx1.scvwd.gov>
	<CAK8gSG-TGEwSXgZmOmXmcnwcc8KCZMsswKuabQ9n-=7T9Fc-+Q@mail.gmail.com>
Message-ID: <CANtt_hw9yPdtzULD+XW6cvgwExn+YgxcFk5R+_vDw=d91sRkfg@mail.gmail.com>

Peter,
This is a simplified version of your script untested, of course, given you
send you no data):

library(gstat)
library(raster)

dat71 <- shapefile("d:/FireDanger/IDW/71stations.shp")
sample.grid <- raster("rawsd_71Stations.tif")
#note that there are parameters you need to choose
m <- gstat(formula=VALUE1 ~1, data=dat71, nmax=10, set=list(idp = 0.5))
r_grid71 <- interpolate(sample.grid, m)

plot(r_grid71)

Robert


On Tue, Dec 2, 2014 at 8:45 AM, ping yang <pingyang.whu at gmail.com> wrote:

> Hi Nahm Lee and R-sig-geo,
>
> I am quite interested in the IDW interpolation comparing to other methods
> such as Krige, I have a code like this which I think also did the IDW:
>
> library(gstat)
> library(maptools)
> library(raster)
> dat71 <- readShapePoints("d:/FireDanger/IDW/71stations.shp")
> bubble(dat71,"VALUE1")
> sample.grid <- raster("rawsd_71Stations.tif")
> Left <- bbox(sample.grid)[1]
> Right <- bbox(sample.grid)[3]
> Bottom <- bbox(sample.grid)[2]
> Top <- bbox(sample.grid)[4]
> cell.size <- res(sample.grid)
> grid.xy <- expand.grid(x = seq(Left, Right, cell.size[1]), y = seq(Top,
> Bottom, -cell.size[2]))
> coordinates(grid.xy) <- ~x + y
> gridded(grid.xy) = TRUE
> value71.idw <- krige(VALUE1 ~ 1, dat71, grid.xy)
> spplot(value71.idw["var1.pred"])
> r_grid71 <- raster(value71.idw["var1.pred"])
> plot(r_grid71)
>
> However, I am not sure it is correct. Have someone using this method to do
> the IDW? and One more question, How can I complete a Krige application
> based on a shapefile (there are other examples using the spreedsheet).
>
> Looking forward to hearing from you.
>
> Peter
>
> On Mon, Dec 1, 2014 at 12:31 PM, Nahm Lee <nlee at valleywater.org> wrote:
>
>>  This is my example with idw based on a web site, #
>> http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html.
>>
>>
>>
>> Nahm Lee
>>
>> nlee at valleywater.org
>>
>>
>>
>>
>>
>>
>>
>> # http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html
>>
>>
>>
>> library(ggplot2)
>>
>> library(gstat)
>>
>> library(sp)
>>
>> library(maptools)
>>
>> library(rgeos)
>>
>>
>>
>> setwd("C:/Users/Michael/Dropbox/R/SHP")
>>
>>
>>
>> AlertRain <- read.csv(file = "AlertRain.csv",header = TRUE)
>>
>>
>>
>> names(AlertRain)
>>
>>
>>
>> AlertRain_test <- AlertRain   # duplicate air temp. data file
>>
>> AlertRain$x <- AlertRain$longitude  # define x & y as longitude and
>> latitude
>>
>> AlertRain$y <- AlertRain$latitude
>>
>>
>>
>> # Set spatial coordinates to create a Spatial object:
>>
>> coordinates(AlertRain_test) = ~x + y
>>
>>
>>
>> plot(AlertRain_test)
>>
>>
>>
>> # Define the grid extent:
>>
>> #x.range <- as.numeric(c(21.76, 28.21))  # min/max longitude of the
>> interpolation area
>>
>> #y.range <- as.numeric(c(57.45, 59.72))  # min/max latitude of the
>> interpolation area
>>
>>
>>
>> x.range <-
>> c(min(round(AlertRain_test$x,2)-0.1),max(round(AlertRain_test$x,2)+0.1))
>>
>> y.range <-
>> c(min(round(AlertRain_test$y,2)-0.1),max(round(AlertRain_test$y,2)+0.1))
>>
>>
>>
>> # Create a data frame from all combinations of the supplied vectors or
>> factors.
>>
>> # See the description of the return value for precise details of the way
>> this is done.
>>
>> # Set spatial coordinates to create a Spatial object. Assign gridded
>> structure:
>>
>> grd <- expand.grid(x = seq(from = x.range[1], to = x.range[2], by = 0.1),
>> y = seq(from = y.range[1],
>>
>>     to = y.range[2], by = 0.1))  # expand points to grid
>>
>> coordinates(grd) <- ~x + y
>>
>> gridded(grd) <- TRUE
>>
>>
>>
>> #Plot the weather station locations and interpolation grid:
>>
>> plot(grd, cex = 1.5, col = "grey")
>>
>> points(AlertRain_test, pch = 1, col = "red", cex = 1)
>>
>>
>>
>> # interpolate surface and fix the output:
>>
>>
>>
>> idw <- idw(formula = Elevation ~ 1, locations = AlertRain_test,
>>
>>     newdata = grd)  # apply idw model for the data
>>
>> ## [inverse distance weighted interpolation]
>>
>>
>>
>> idw.output = as.data.frame(idw)  # output is defined as a data table
>>
>> names(idw.output)[1:3] <- c("long", "lat", "var1.pred")  # give names to
>> the modelled variables
>>
>>
>>
>> #Plot the results:
>>
>>
>>
>> ggplot() + geom_tile(data = idw.output, aes(x = long, y = lat, fill =
>> var1.pred)) + scale_fill_gradient(low = "cyan", high = "orange")+
>>
>>     geom_point(data = AlertRain, aes(x = longitude, y = latitude), shape
>> = 21,
>>
>>         colour = "red")+labs(title = "Elevation by rainfall station
>> elevation")
>>
>>
>>
>>
>>
>>
>>
>> *From:* R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] *On Behalf Of
>> *Mengxi Yang
>> *Sent:* Monday, December 01, 2014 1:32 AM
>> *To:* r-sig-geo at r-project.org
>> *Subject:* [R-sig-Geo] rainfall interpolation using ANN
>>
>>
>>
>> Dear list,
>>
>> I am going to do daily rainfall interpolation using ANN. but I am not
>> familiar with it. Can somebody give some advise or example?
>>
>>
>>
>> my data like:
>>
>>  I have 325 stations in different location.each station have unique code
>> and coordinates. And I want to interpolate in 1km resolution. I have the
>> mask map of NL.
>>
>> [image: Inline image 2]
>>
>>
>>
>> can someone give me some advice? because I want to compare ANN with
>> Kriging and IDW.
>>
>> Thank you very much.
>>
>>
>>
>> Mengxi Yang
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141202/71066e42/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 14586 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141202/71066e42/attachment.png>

From frtog at vestas.com  Wed Dec  3 07:20:15 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Wed, 3 Dec 2014 07:20:15 +0100
Subject: [R-sig-Geo] rainfall interpolation using ANN
In-Reply-To: <4F96A3E542010442B8785D2CC23841471A56A700@SrvExchMbx1.scvwd.gov>
References: <CA+vD2zqQ9FESeynNcFb=-Q62Oy-aq=rDhTMNc36f1ZtTYSWdCA@mail.gmail.com>
	<4F96A3E542010442B8785D2CC23841471A56A700@SrvExchMbx1.scvwd.gov>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9FE0CE5@DKRDSEXC016.vestas.net>

Hi Nahm

I suppose that by ?ANN? you mean artificial neural network.

If you do google for ?ann interpolation? you?ll get many hits.

Here is one comparing kriging, idw and ann interpolation (in this case kriging seems to be superior in terms of root mean squared error, RMSE):

http://omicsgroup.org/journals/testing-artificial-neural-network-ann-for-spatial-interpolation-2329-6755.1000145.pdf 

Another one is:

https://www.researchgate.net/publication/260496994_Testing_Artificial_Neural_Network_%28ANN%29_for_Spatial_Interpolation

which may lead you to:

https://www.researchgate.net/publication/225544039_A_new_approach_for_deriving_temperature_and_salinity_fields_in_the_Indian_Ocean_using_artificial_neural_networks 

Hope that helps.

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 

From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Nahm Lee
Sent: 1. december 2014 19:32
To: Mengxi Yang; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] rainfall interpolation using ANN

This is my example with idw based on a web site, # http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html.

Nahm Lee
nlee at valleywater.org



# http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html

library(ggplot2)
library(gstat)
library(sp)
library(maptools)
library(rgeos)

setwd("C:/Users/Michael/Dropbox/R/SHP")

AlertRain <- read.csv(file = "AlertRain.csv",header = TRUE)

names(AlertRain)

AlertRain_test <- AlertRain?? # duplicate air temp. data file
AlertRain$x <- AlertRain$longitude? # define x & y as longitude and latitude
AlertRain$y <- AlertRain$latitude

# Set spatial coordinates to create a Spatial object:
coordinates(AlertRain_test) = ~x + y

plot(AlertRain_test)

# Define the grid extent:
#x.range <- as.numeric(c(21.76, 28.21))? # min/max longitude of the interpolation area
#y.range <- as.numeric(c(57.45, 59.72))? # min/max latitude of the interpolation area

x.range <- c(min(round(AlertRain_test$x,2)-0.1),max(round(AlertRain_test$x,2)+0.1))
y.range <- c(min(round(AlertRain_test$y,2)-0.1),max(round(AlertRain_test$y,2)+0.1))

# Create a data frame from all combinations of the supplied vectors or factors. 
# See the description of the return value for precise details of the way this is done. 
# Set spatial coordinates to create a Spatial object. Assign gridded structure:
grd <- expand.grid(x = seq(from = x.range[1], to = x.range[2], by = 0.1), y = seq(from = y.range[1], 
????to = y.range[2], by = 0.1))? # expand points to grid
coordinates(grd) <- ~x + y
gridded(grd) <- TRUE

#Plot the weather station locations and interpolation grid:
plot(grd, cex = 1.5, col = "grey")
points(AlertRain_test, pch = 1, col = "red", cex = 1)

# interpolate surface and fix the output:

idw <- idw(formula = Elevation ~ 1, locations = AlertRain_test, 
????newdata = grd)? # apply idw model for the data
## [inverse distance weighted interpolation]

idw.output = as.data.frame(idw)? # output is defined as a data table
names(idw.output)[1:3] <- c("long", "lat", "var1.pred")? # give names to the modelled variables

#Plot the results:

ggplot() + geom_tile(data = idw.output, aes(x = long, y = lat, fill = var1.pred)) + scale_fill_gradient(low = "cyan", high = "orange")+
??? geom_point(data = AlertRain, aes(x = longitude, y = latitude), shape = 21, 
????????colour = "red")+labs(title = "Elevation by rainfall station elevation")



From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Mengxi Yang
Sent: Monday, December 01, 2014 1:32 AM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] rainfall interpolation using ANN

Dear list,
I am going to do daily rainfall interpolation using ANN. but I am not familiar with it. Can somebody give some advise or example?

my data like:
?I have 325 stations in different location.each station have unique code and coordinates. And I want to interpolate in 1km resolution. I have the mask map of NL.


can someone give me some advice? because I want to compare ANN with Kriging and IDW.
Thank you very much.

Mengxi Yang

From nlee at valleywater.org  Wed Dec  3 09:39:15 2014
From: nlee at valleywater.org (Nahm Lee)
Date: Wed, 3 Dec 2014 08:39:15 +0000
Subject: [R-sig-Geo] rainfall interpolation using ANN
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9FE0CE5@DKRDSEXC016.vestas.net>
References: <CA+vD2zqQ9FESeynNcFb=-Q62Oy-aq=rDhTMNc36f1ZtTYSWdCA@mail.gmail.com>
	<4F96A3E542010442B8785D2CC23841471A56A700@SrvExchMbx1.scvwd.gov>,
	<B078CDF40DFE4045AF172A8B4F68FC4857C9FE0CE5@DKRDSEXC016.vestas.net>
Message-ID: <4F96A3E542010442B8785D2CC23841471A56B59E@SrvExchMbx1.scvwd.gov>

Hi Frede,
Thank you very much because the article you introduced was what I was looking for too.
Thanks,

Nahm
>From Santa Clara Valley Water District 
________________________________________
From: Frede Aakmann T?gersen [frtog at vestas.com]
Sent: Tuesday, December 02, 2014 10:20 PM
To: Nahm Lee; Mengxi Yang; r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] rainfall interpolation using ANN

Hi Nahm

I suppose that by ?ANN? you mean artificial neural network.

If you do google for ?ann interpolation? you?ll get many hits.

Here is one comparing kriging, idw and ann interpolation (in this case kriging seems to be superior in terms of root mean squared error, RMSE):

http://omicsgroup.org/journals/testing-artificial-neural-network-ann-for-spatial-interpolation-2329-6755.1000145.pdf

Another one is:

https://www.researchgate.net/publication/260496994_Testing_Artificial_Neural_Network_%28ANN%29_for_Spatial_Interpolation

which may lead you to:

https://www.researchgate.net/publication/225544039_A_new_approach_for_deriving_temperature_and_salinity_fields_in_the_Indian_Ocean_using_artificial_neural_networks

Hope that helps.

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender.

From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Nahm Lee
Sent: 1. december 2014 19:32
To: Mengxi Yang; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] rainfall interpolation using ANN

This is my example with idw based on a web site, # http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html.

Nahm Lee
nlee at valleywater.org



# http://www.geo.ut.ee/aasa/LOOM02331/R_idw_interpolation.html

library(ggplot2)
library(gstat)
library(sp)
library(maptools)
library(rgeos)

setwd("C:/Users/Michael/Dropbox/R/SHP")

AlertRain <- read.csv(file = "AlertRain.csv",header = TRUE)

names(AlertRain)

AlertRain_test <- AlertRain   # duplicate air temp. data file
AlertRain$x <- AlertRain$longitude  # define x & y as longitude and latitude
AlertRain$y <- AlertRain$latitude

# Set spatial coordinates to create a Spatial object:
coordinates(AlertRain_test) = ~x + y

plot(AlertRain_test)

# Define the grid extent:
#x.range <- as.numeric(c(21.76, 28.21))  # min/max longitude of the interpolation area
#y.range <- as.numeric(c(57.45, 59.72))  # min/max latitude of the interpolation area

x.range <- c(min(round(AlertRain_test$x,2)-0.1),max(round(AlertRain_test$x,2)+0.1))
y.range <- c(min(round(AlertRain_test$y,2)-0.1),max(round(AlertRain_test$y,2)+0.1))

# Create a data frame from all combinations of the supplied vectors or factors.
# See the description of the return value for precise details of the way this is done.
# Set spatial coordinates to create a Spatial object. Assign gridded structure:
grd <- expand.grid(x = seq(from = x.range[1], to = x.range[2], by = 0.1), y = seq(from = y.range[1],
    to = y.range[2], by = 0.1))  # expand points to grid
coordinates(grd) <- ~x + y
gridded(grd) <- TRUE

#Plot the weather station locations and interpolation grid:
plot(grd, cex = 1.5, col = "grey")
points(AlertRain_test, pch = 1, col = "red", cex = 1)

# interpolate surface and fix the output:

idw <- idw(formula = Elevation ~ 1, locations = AlertRain_test,
    newdata = grd)  # apply idw model for the data
## [inverse distance weighted interpolation]

idw.output = as.data.frame(idw)  # output is defined as a data table
names(idw.output)[1:3] <- c("long", "lat", "var1.pred")  # give names to the modelled variables

#Plot the results:

ggplot() + geom_tile(data = idw.output, aes(x = long, y = lat, fill = var1.pred)) + scale_fill_gradient(low = "cyan", high = "orange")+
    geom_point(data = AlertRain, aes(x = longitude, y = latitude), shape = 21,
        colour = "red")+labs(title = "Elevation by rainfall station elevation")



From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Mengxi Yang
Sent: Monday, December 01, 2014 1:32 AM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] rainfall interpolation using ANN

Dear list,
I am going to do daily rainfall interpolation using ANN. but I am not familiar with it. Can somebody give some advise or example?

my data like:
 I have 325 stations in different location.each station have unique code and coordinates. And I want to interpolate in 1km resolution. I have the mask map of NL.


can someone give me some advice? because I want to compare ANN with Kriging and IDW.
Thank you very much.

Mengxi Yang


From simone.ruzza12 at gmail.com  Thu Dec  4 01:15:02 2014
From: simone.ruzza12 at gmail.com (Simone Ruzza)
Date: Thu, 4 Dec 2014 01:15:02 +0100
Subject: [R-sig-Geo] overlay polygon with raster
Message-ID: <CADZVqobosr0No9KAZVzLaGdWEPwS4LF2GFRPM2L+kCKVEfBbxg@mail.gmail.com>

Dear R-sig-geo users,

apologies for the simplicity of my question, but I have been
struggling with this for a bit I have not managed to find a solution.
Basically, I would like to overlay a polygon onto raster grid and
extract some statistics for the polygon in question i.e. the area of
every raster cell covered by the polygon. Here is a figure that might
make it clearer
<https://dl.dropboxusercontent.com/u/33966347/example.JPG> . I have
been fiddling around with the extract function from the raster
package, which works to some extent, as I am able to retrieve
information on the categories of each of the raster cells covered by
the polygon. However, as I said, I am interested in the area covered
by the polygon within each raster cell. I know that perhaps I should
try and convert my polygon into another raster and then overlay the
two rasters, but this perhaps would mean that the polygon should be
converted into a raster at a high resolution? If this was case, it is
not computationally feasible for me as some polygons I have cover a
huge area and it would take forever to overlay all those rasters. Any
help, suggestions would be highly appreciated!

thanks in advance!

Simone


From frtog at vestas.com  Thu Dec  4 07:36:34 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Thu, 4 Dec 2014 07:36:34 +0100
Subject: [R-sig-Geo] overlay polygon with raster
In-Reply-To: <CADZVqobosr0No9KAZVzLaGdWEPwS4LF2GFRPM2L+kCKVEfBbxg@mail.gmail.com>
References: <CADZVqobosr0No9KAZVzLaGdWEPwS4LF2GFRPM2L+kCKVEfBbxg@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C9FE1218@DKRDSEXC016.vestas.net>

Hi Simone

If I understand you correctly, then have a look at the man page of raster(). Here is the relevant sections:

     ## S4 method for signature 'Raster,SpatialPolygons'
     extract(x, y, fun=NULL, na.rm=FALSE, weights=FALSE, cellnumbers=FALSE,
          small=FALSE, df=FALSE, layer, nl, factors=FALSE, sp=FALSE, ...)

Where
       x: Raster* object

       y: points represented by a two-column matrix or data.frame, or
          'SpatialPoints*'; 'SpatialPolygons*'; 'SpatialLines';
          'Extent'; or a numeric vector representing cell numbers

and

weights: logical. If 'TRUE', the function returns, for each polygon, a
          matrix with the cell values and the approximate fraction of
          each cell that is covered by the polygon(rounded to 1/100).
          The weights can be used for averaging; see examples. This
          option can be useful (but slow) if the polygons are small
          relative to the cells size of the Raster* object.

I just googled for ' R area of raster cells within polygon' and got this hit with a reproducible small example:

http://stackoverflow.com/questions/17766989/extract-data-from-raster-with-small-polygons-rounded-weights-too-small 

See that page for a solution to some rounding errors in the case of the polygon being very small compared to raster cell size.

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 

> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
> Simone Ruzza
> Sent: 4. december 2014 01:15
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] overlay polygon with raster
> 
> Dear R-sig-geo users,
> 
> apologies for the simplicity of my question, but I have been
> struggling with this for a bit I have not managed to find a solution.
> Basically, I would like to overlay a polygon onto raster grid and
> extract some statistics for the polygon in question i.e. the area of
> every raster cell covered by the polygon. Here is a figure that might
> make it clearer
> <https://dl.dropboxusercontent.com/u/33966347/example.JPG> . I have
> been fiddling around with the extract function from the raster
> package, which works to some extent, as I am able to retrieve
> information on the categories of each of the raster cells covered by
> the polygon. However, as I said, I am interested in the area covered
> by the polygon within each raster cell. I know that perhaps I should
> try and convert my polygon into another raster and then overlay the
> two rasters, but this perhaps would mean that the polygon should be
> converted into a raster at a high resolution? If this was case, it is
> not computationally feasible for me as some polygons I have cover a
> huge area and it would take forever to overlay all those rasters. Any
> help, suggestions would be highly appreciated!
> 
> thanks in advance!
> 
> Simone
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From bwtian at gmail.com  Thu Dec  4 08:19:46 2014
From: bwtian at gmail.com (Bingwei Tian)
Date: Thu, 4 Dec 2014 00:19:46 -0700 (MST)
Subject: [R-sig-Geo] What is the reason for Very high value by Universal
 Kriging based on Nested 3D varigram
Message-ID: <1417677586464-7587514.post@n2.nabble.com>

Dear list,

I am doing a 3D estimation of logtransfered subsurface temperature (with a
strong vertical trend) with a Nested 3D variogram, but the results show very
high value over than origin data.
This is not normal and absolutely wrong if I back transfer logged data.

I attached the 
<http://r-sig-geo.2731867.n2.nabble.com/file/n7587514/vgm.png>  and anyone
who knows what is the reason for the very high value differ from origin
data?
Or what kind of processing I should to do for the data back transfer? Thanks
in advance for any help.

Data:
summary((spdf$logt))
          Min.        1st Qu.         Median           Mean        3rd Qu. 
0.741937344729 3.487375077900 3.908014984030 3.952886346280 4.452019006490 
          Max. 
5.733988316710 

Model: Nested 3D varigram
uk.eye1  <- vgm(psill = 0.155,  model = "Gau",  range=700,  nugget=0)
uk.eye   <- vgm(psill = 0.125,  model = "Sph",  range=35000,  nugget=0, 
add.to=uk.eye1)
  model psill range
1   Nug 0.000     0
2   Gau 0.155   700
3   Nug 0.000     0
4   Sph 0.125 35000
UK: 
logt.uk <- krige(log(t)~z, spdf, grid, model = uk.eye, nmax = 20)

Result:

summary((logt.uk$var1.pred))
          Min.        1st Qu.         Median           Mean        3rd Qu. 
-1.66562650678  3.30346488250  3.76836777085  3.81376070431  4.24457939254 
          Max. 
15.05945622140 



-----
Bingwei

Ph.D. Student 
Kyoto University
C-1-2-225, Katsura Campus, Kyoto University, 
Nishikyo-ku, ?615-8530, Kyoto, Japan
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/What-is-the-reason-for-Very-high-value-by-Universal-Kriging-based-on-Nested-3D-varigram-tp7587514.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Thu Dec  4 08:49:28 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 04 Dec 2014 08:49:28 +0100
Subject: [R-sig-Geo] What is the reason for Very high value by Universal
 Kriging based on Nested 3D varigram
In-Reply-To: <1417677586464-7587514.post@n2.nabble.com>
References: <1417677586464-7587514.post@n2.nabble.com>
Message-ID: <54801208.2090502@uni-muenster.de>

You don't describe your problem completely, and you also do not provide
a reproducible example, so I can only make a wild guess: your z variable
takes an extreme value at the prediction location(s) where you see the
high predictions.


On 12/04/2014 08:19 AM, Bingwei Tian wrote:
> Dear list,
> 
> I am doing a 3D estimation of logtransfered subsurface temperature (with a
> strong vertical trend) with a Nested 3D variogram, but the results show very
> high value over than origin data.
> This is not normal and absolutely wrong if I back transfer logged data.
> 
> I attached the 
> <http://r-sig-geo.2731867.n2.nabble.com/file/n7587514/vgm.png>  and anyone
> who knows what is the reason for the very high value differ from origin
> data?
> Or what kind of processing I should to do for the data back transfer? Thanks
> in advance for any help.
> 
> Data:
> summary((spdf$logt))
>           Min.        1st Qu.         Median           Mean        3rd Qu. 
> 0.741937344729 3.487375077900 3.908014984030 3.952886346280 4.452019006490 
>           Max. 
> 5.733988316710 
> 
> Model: Nested 3D varigram
> uk.eye1  <- vgm(psill = 0.155,  model = "Gau",  range=700,  nugget=0)
> uk.eye   <- vgm(psill = 0.125,  model = "Sph",  range=35000,  nugget=0, 
> add.to=uk.eye1)
>   model psill range
> 1   Nug 0.000     0
> 2   Gau 0.155   700
> 3   Nug 0.000     0
> 4   Sph 0.125 35000
> UK: 
> logt.uk <- krige(log(t)~z, spdf, grid, model = uk.eye, nmax = 20)
> 
> Result:
> 
> summary((logt.uk$var1.pred))
>           Min.        1st Qu.         Median           Mean        3rd Qu. 
> -1.66562650678  3.30346488250  3.76836777085  3.81376070431  4.24457939254 
>           Max. 
> 15.05945622140 
> 
> 
> 
> -----
> Bingwei
> 
> Ph.D. Student 
> Kyoto University
> C-1-2-225, Katsura Campus, Kyoto University, 
> Nishikyo-ku, ?615-8530, Kyoto, Japan
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/What-is-the-reason-for-Very-high-value-by-Universal-Kriging-based-on-Nested-3D-varigram-tp7587514.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141204/1e970c8e/attachment.bin>

From hidasineto at gmail.com  Thu Dec  4 09:11:44 2014
From: hidasineto at gmail.com (=?UTF-8?B?Sm9zw6kgSGlkYXNp?=)
Date: Thu, 4 Dec 2014 06:11:44 -0200
Subject: [R-sig-Geo] overlay polygon with raster
In-Reply-To: <CADZVqobosr0No9KAZVzLaGdWEPwS4LF2GFRPM2L+kCKVEfBbxg@mail.gmail.com>
References: <CADZVqobosr0No9KAZVzLaGdWEPwS4LF2GFRPM2L+kCKVEfBbxg@mail.gmail.com>
Message-ID: <CAJZjMOg4edLLp674ErCSkHi6TYpyXdG9bygZK+g+xXQqKZ+9vQ@mail.gmail.com>

Hello Simone,

You can also intersect the raster with the polygon and then calculate the
area covered by each raster cell. If that's what you want, you might need
to:

1) use "rasterToPolygons()" function to transform the raster into a polygon.

2) apply an equal area projection (e.g. lambert azimuthal) to both polygons
using "spTransform()" (raster/polygon and the other polygon).

3) create a new attribute in your "raster polygon" to identify each cell
(i.e. give a number to each cell). After creating the attribute, you can
use something like:
rasterpolygon$new.attribute <- c(1:length(rasterpolygon$new.attribute))

4) intersect both polygons using "intersect()".

5) use "gArea()" function to calculate the area of each "intersected cell",
but remember to use the "byid=T" argument. It should look like "area.cells
<- gArea(IntersectedPolygon, byid=T)". It will return a vector with the
area sizes in the units of the projection you used in step 2.

6) finally, get the area for each cell while identifying its number before
the intersection. To do that, you can bring up together "area.cells" (from
step 5) and the attribute you created in step 3 (which was maintained after
the intersection). For example:
info <- cbind(intersected.raster$new.attribute, area.cells)


Just an idea.


All the best,
Jose


On Wed, Dec 3, 2014 at 10:15 PM, Simone Ruzza <simone.ruzza12 at gmail.com>
wrote:

> Dear R-sig-geo users,
>
> apologies for the simplicity of my question, but I have been
> struggling with this for a bit I have not managed to find a solution.
> Basically, I would like to overlay a polygon onto raster grid and
> extract some statistics for the polygon in question i.e. the area of
> every raster cell covered by the polygon. Here is a figure that might
> make it clearer
> <https://dl.dropboxusercontent.com/u/33966347/example.JPG> . I have
> been fiddling around with the extract function from the raster
> package, which works to some extent, as I am able to retrieve
> information on the categories of each of the raster cells covered by
> the polygon. However, as I said, I am interested in the area covered
> by the polygon within each raster cell. I know that perhaps I should
> try and convert my polygon into another raster and then overlay the
> two rasters, but this perhaps would mean that the polygon should be
> converted into a raster at a high resolution? If this was case, it is
> not computationally feasible for me as some polygons I have cover a
> huge area and it would take forever to overlay all those rasters. Any
> help, suggestions would be highly appreciated!
>
> thanks in advance!
>
> Simone
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Jos? Hidasi Neto
Ph.D. Candidate in Ecology and Evolution - Community Ecology and
Functioning Lab - UFG
Lattes:
http://buscatextual.cnpq.br/buscatextual/visualizacv.do?id=K4293841A0
Community Ecology and Functioning Lab: http://cianciaruso.wix.com/home
My blog about R: http://rfunctions.blogspot.com.br/

	[[alternative HTML version deleted]]


From jon.skoien at jrc.ec.europa.eu  Thu Dec  4 10:06:29 2014
From: jon.skoien at jrc.ec.europa.eu (Jon Skoien)
Date: Thu, 04 Dec 2014 10:06:29 +0100
Subject: [R-sig-Geo] What is the reason for Very high value by Universal
 Kriging based on Nested 3D varigram
In-Reply-To: <1417677586464-7587514.post@n2.nabble.com>
References: <1417677586464-7587514.post@n2.nabble.com>
Message-ID: <54802415.8040202@jrc.ec.europa.eu>

It is difficult for us to know exactly what happens as you are not 
providing a reproducible example. But my guess would be that this is 
related to your use of a Gaussian variogram without nugget for the first 
part of the variogram. This can cause rather large weights (positive and 
negative) if you have observations in close vicinity of each other, 
leading to predictions far away from your range of observations. See if 
a small nugget effect (~0.01 or less) can solve the problem, or if you 
can change to a different variogram model.

Cheers,
Jon

On 12/4/2014 8:19 AM, Bingwei Tian wrote:
> Dear list,
>
> I am doing a 3D estimation of logtransfered subsurface temperature (with a
> strong vertical trend) with a Nested 3D variogram, but the results show very
> high value over than origin data.
> This is not normal and absolutely wrong if I back transfer logged data.
>
> I attached the
> <http://r-sig-geo.2731867.n2.nabble.com/file/n7587514/vgm.png>  and anyone
> who knows what is the reason for the very high value differ from origin
> data?
> Or what kind of processing I should to do for the data back transfer? Thanks
> in advance for any help.
>
> Data:
> summary((spdf$logt))
>            Min.        1st Qu.         Median           Mean        3rd Qu.
> 0.741937344729 3.487375077900 3.908014984030 3.952886346280 4.452019006490
>            Max.
> 5.733988316710
>
> Model: Nested 3D varigram
> uk.eye1  <- vgm(psill = 0.155,  model = "Gau",  range=700,  nugget=0)
> uk.eye   <- vgm(psill = 0.125,  model = "Sph",  range=35000,  nugget=0,
> add.to=uk.eye1)
>    model psill range
> 1   Nug 0.000     0
> 2   Gau 0.155   700
> 3   Nug 0.000     0
> 4   Sph 0.125 35000
> UK:
> logt.uk <- krige(log(t)~z, spdf, grid, model = uk.eye, nmax = 20)
>
> Result:
>
> summary((logt.uk$var1.pred))
>            Min.        1st Qu.         Median           Mean        3rd Qu.
> -1.66562650678  3.30346488250  3.76836777085  3.81376070431  4.24457939254
>            Max.
> 15.05945622140
>
>
>
> -----
> Bingwei
>
> Ph.D. Student
> Kyoto University
> C-1-2-225, Katsura Campus, Kyoto University,
> Nishikyo-ku, ?615-8530, Kyoto, Japan
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/What-is-the-reason-for-Very-high-value-by-Universal-Kriging-based-on-Nested-3D-varigram-tp7587514.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Climate Risk Management Unit

Via Fermi 2749, TP 100-01,  I-21027 Ispra (VA), ITALY

Disclaimer: Views expressed in this email are those of the individual 
and do not necessarily represent official views of the European Commission.


From nlee at valleywater.org  Thu Dec  4 21:32:38 2014
From: nlee at valleywater.org (Nahm Lee)
Date: Thu, 4 Dec 2014 20:32:38 +0000
Subject: [R-sig-Geo] overlay polygon with raster
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4857C9FE1218@DKRDSEXC016.vestas.net>
References: <CADZVqobosr0No9KAZVzLaGdWEPwS4LF2GFRPM2L+kCKVEfBbxg@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9FE1218@DKRDSEXC016.vestas.net>
Message-ID: <4F96A3E542010442B8785D2CC23841471A56C044@SrvExchMbx1.scvwd.gov>

Yes, there is a round issues when you use "extract or mask", http://gis.stackexchange.com/questions/112274/is-this-a-known-issue-in-gaps-between-masked-raster-and-spatial-polygon-in-r-wit.

I use "disaggregate" to improve(?) raster resolution.
This is an example

yourraster.dis <- disaggregate("yourraster" , fact = 2)

Nahm Lee
nlee at valleywater.org
Santa Clara Valley Water District

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Frede Aakmann T?gersen
Sent: Wednesday, December 03, 2014 10:37 PM
To: Simone Ruzza; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] overlay polygon with raster

Hi Simone

If I understand you correctly, then have a look at the man page of raster(). Here is the relevant sections:

     ## S4 method for signature 'Raster,SpatialPolygons'
     extract(x, y, fun=NULL, na.rm=FALSE, weights=FALSE, cellnumbers=FALSE,
          small=FALSE, df=FALSE, layer, nl, factors=FALSE, sp=FALSE, ...)

Where
       x: Raster* object

       y: points represented by a two-column matrix or data.frame, or
          'SpatialPoints*'; 'SpatialPolygons*'; 'SpatialLines';
          'Extent'; or a numeric vector representing cell numbers

and

weights: logical. If 'TRUE', the function returns, for each polygon, a
          matrix with the cell values and the approximate fraction of
          each cell that is covered by the polygon(rounded to 1/100).
          The weights can be used for averaging; see examples. This
          option can be useful (but slow) if the polygons are small
          relative to the cells size of the Raster* object.

I just googled for ' R area of raster cells within polygon' and got this hit with a reproducible small example:

http://stackoverflow.com/questions/17766989/extract-data-from-raster-with-small-polygons-rounded-weights-too-small 

See that page for a solution to some rounding errors in the case of the polygon being very small compared to raster cell size.

Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice If you have received this e-mail in error please contact the sender. 

> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of 
> Simone Ruzza
> Sent: 4. december 2014 01:15
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] overlay polygon with raster
> 
> Dear R-sig-geo users,
> 
> apologies for the simplicity of my question, but I have been 
> struggling with this for a bit I have not managed to find a solution.
> Basically, I would like to overlay a polygon onto raster grid and 
> extract some statistics for the polygon in question i.e. the area of 
> every raster cell covered by the polygon. Here is a figure that might 
> make it clearer 
> <https://dl.dropboxusercontent.com/u/33966347/example.JPG> . I have 
> been fiddling around with the extract function from the raster 
> package, which works to some extent, as I am able to retrieve 
> information on the categories of each of the raster cells covered by 
> the polygon. However, as I said, I am interested in the area covered 
> by the polygon within each raster cell. I know that perhaps I should 
> try and convert my polygon into another raster and then overlay the 
> two rasters, but this perhaps would mean that the polygon should be 
> converted into a raster at a high resolution? If this was case, it is 
> not computationally feasible for me as some polygons I have cover a 
> huge area and it would take forever to overlay all those rasters. Any 
> help, suggestions would be highly appreciated!
> 
> thanks in advance!
> 
> Simone
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jh.eco.cas at gmail.com  Thu Dec  4 23:39:29 2014
From: jh.eco.cas at gmail.com (Jianhua Huang)
Date: Thu, 4 Dec 2014 15:39:29 -0700
Subject: [R-sig-Geo] netcdf file limitation
Message-ID: <12d901d01013$2b312b10$81938130$@gmail.com>

Hi All:

 

I am trying to write a 3-dimensional big netcdf file with the ncdf4 package.
I found that when the length of the variable is larger than 2^31 (or file
size larger than 16 GB), it will show an error "ncvar_put doesn't support
long vector yet". Is that the limitation of the ncdf4 package or NetCDF
format? Is there any way to overcome this?

 

Thanks for any suggestion.

 

Jianhua


	[[alternative HTML version deleted]]


From simone.ruzza12 at gmail.com  Fri Dec  5 00:54:06 2014
From: simone.ruzza12 at gmail.com (Simone Ruzza)
Date: Fri, 5 Dec 2014 00:54:06 +0100
Subject: [R-sig-Geo] overlay polygon with raster
In-Reply-To: <4F96A3E542010442B8785D2CC23841471A56C044@SrvExchMbx1.scvwd.gov>
References: <CADZVqobosr0No9KAZVzLaGdWEPwS4LF2GFRPM2L+kCKVEfBbxg@mail.gmail.com>
	<B078CDF40DFE4045AF172A8B4F68FC4857C9FE1218@DKRDSEXC016.vestas.net>
	<4F96A3E542010442B8785D2CC23841471A56C044@SrvExchMbx1.scvwd.gov>
Message-ID: <CADZVqoYggiqNHBB=1vuszJR6exV1SJi-Dwuuedzr5KmnbD-QbQ@mail.gmail.com>

Thank you for your prompt and kind replies! I think that maybe what
Jose Hidasi was suggesting is what I want. I will give it a go! Just
to clarify, what I would like to extract is the only the area (or
proportion) of a particular cell covered by the polygon and the
corresponding raster category. I am not sure whether this makes it
clearer but I have drawn a rough sketch of the information I am
interested in, highlighted in different colours...
<https://dl.dropboxusercontent.com/u/33966347/query1.JPG>Ideally, I
would like to extract the area or the proportion of each the sections
in different colours and the corresponding category number for the
raster below it...

thanks in advance!

Simone



On Thu, Dec 4, 2014 at 9:32 PM, Nahm Lee <nlee at valleywater.org> wrote:
> Yes, there is a round issues when you use "extract or mask", http://gis.stackexchange.com/questions/112274/is-this-a-known-issue-in-gaps-between-masked-raster-and-spatial-polygon-in-r-wit.
>
> I use "disaggregate" to improve(?) raster resolution.
> This is an example
>
> yourraster.dis <- disaggregate("yourraster" , fact = 2)
>
> Nahm Lee
> nlee at valleywater.org
> Santa Clara Valley Water District
>
> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Frede Aakmann T?gersen
> Sent: Wednesday, December 03, 2014 10:37 PM
> To: Simone Ruzza; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] overlay polygon with raster
>
> Hi Simone
>
> If I understand you correctly, then have a look at the man page of raster(). Here is the relevant sections:
>
>      ## S4 method for signature 'Raster,SpatialPolygons'
>      extract(x, y, fun=NULL, na.rm=FALSE, weights=FALSE, cellnumbers=FALSE,
>           small=FALSE, df=FALSE, layer, nl, factors=FALSE, sp=FALSE, ...)
>
> Where
>        x: Raster* object
>
>        y: points represented by a two-column matrix or data.frame, or
>           'SpatialPoints*'; 'SpatialPolygons*'; 'SpatialLines';
>           'Extent'; or a numeric vector representing cell numbers
>
> and
>
> weights: logical. If 'TRUE', the function returns, for each polygon, a
>           matrix with the cell values and the approximate fraction of
>           each cell that is covered by the polygon(rounded to 1/100).
>           The weights can be used for averaging; see examples. This
>           option can be useful (but slow) if the polygons are small
>           relative to the cells size of the Raster* object.
>
> I just googled for ' R area of raster cells within polygon' and got this hit with a reproducible small example:
>
> http://stackoverflow.com/questions/17766989/extract-data-from-raster-with-small-polygons-rounded-weights-too-small
>
> See that page for a solution to some rounding errors in the case of the polygon being very small compared to raster cell size.
>
> Yours sincerely / Med venlig hilsen
>
>
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
>
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
>
> Company reg. name: Vestas Wind Systems A/S This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice If you have received this e-mail in error please contact the sender.
>
>> -----Original Message-----
>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
>> Simone Ruzza
>> Sent: 4. december 2014 01:15
>> To: r-sig-geo at r-project.org
>> Subject: [R-sig-Geo] overlay polygon with raster
>>
>> Dear R-sig-geo users,
>>
>> apologies for the simplicity of my question, but I have been
>> struggling with this for a bit I have not managed to find a solution.
>> Basically, I would like to overlay a polygon onto raster grid and
>> extract some statistics for the polygon in question i.e. the area of
>> every raster cell covered by the polygon. Here is a figure that might
>> make it clearer
>> <https://dl.dropboxusercontent.com/u/33966347/example.JPG> . I have
>> been fiddling around with the extract function from the raster
>> package, which works to some extent, as I am able to retrieve
>> information on the categories of each of the raster cells covered by
>> the polygon. However, as I said, I am interested in the area covered
>> by the polygon within each raster cell. I know that perhaps I should
>> try and convert my polygon into another raster and then overlay the
>> two rasters, but this perhaps would mean that the polygon should be
>> converted into a raster at a high resolution? If this was case, it is
>> not computationally feasible for me as some polygons I have cover a
>> huge area and it would take forever to overlay all those rasters. Any
>> help, suggestions would be highly appreciated!
>>
>> thanks in advance!
>>
>> Simone
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mdsumner at gmail.com  Fri Dec  5 03:41:31 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 05 Dec 2014 02:41:31 +0000
Subject: [R-sig-Geo] netcdf file limitation
References: <12d901d01013$2b312b10$81938130$@gmail.com>
Message-ID: <CAAcGz9-OHYikxk5Noc+yOn6EegDF0e24cCx5wzOM+vUZ35TsoQ@mail.gmail.com>

It's a limitation of ncdf4 (that's why the error refers to ncvar_put). Just
write the vector out in parts using the 'start' and 'count' arguments.

There's plenty of examples of doing that in the help page for ncvar_put,
though it's a bit abstract if you've not encountered that kind of thing
before.

(It seems strange to have to write to disk in pieces from memory,
interesting times we live in.)

Cheers, Mike.

On Fri Dec 05 2014 at 9:37:03 AM Jianhua Huang <jh.eco.cas at gmail.com> wrote:

> Hi All:
>
>
>
> I am trying to write a 3-dimensional big netcdf file with the ncdf4
> package.
> I found that when the length of the variable is larger than 2^31 (or file
> size larger than 16 GB), it will show an error "ncvar_put doesn't support
> long vector yet". Is that the limitation of the ncdf4 package or NetCDF
> format? Is there any way to overcome this?
>
>
>
> Thanks for any suggestion.
>
>
>
> Jianhua
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From bwtian at gmail.com  Fri Dec  5 05:08:10 2014
From: bwtian at gmail.com (Bingwei Tian)
Date: Thu, 4 Dec 2014 21:08:10 -0700 (MST)
Subject: [R-sig-Geo] can we use georob package to make a 3D nested variogram?
Message-ID: <1417752490956-7587522.post@n2.nabble.com>

Dear list,
It seems only gstat can make a 3D nested variogram but can not auto fit it
until now, .
Recently I find georob is also a useful package to do 3D estimation with
trend data, 
But I did not find the way to create a  3D nested variogram, Does anyone
kown about this,
or any other package for fit  a  3D nested variogram?
Thank you in advance!



-----
Bingwei

Ph.D. Student 
Kyoto University
C-1-2-225, Katsura Campus, Kyoto University, 
Nishikyo-ku, ?615-8530, Kyoto, Japan
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/can-we-use-georob-package-to-make-a-3D-nested-variogram-tp7587522.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Fri Dec  5 08:04:48 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 05 Dec 2014 08:04:48 +0100
Subject: [R-sig-Geo] can we use georob package to make a 3D nested
	variogram?
In-Reply-To: <1417752490956-7587522.post@n2.nabble.com>
References: <1417752490956-7587522.post@n2.nabble.com>
Message-ID: <54815910.8010800@uni-muenster.de>



On 12/05/2014 05:08 AM, Bingwei Tian wrote:
> Dear list,
> It seems only gstat can make a 3D nested variogram but can not auto fit it
> until now, .

?fit.variogram gives me

Description:

     Fit ranges and/or sills from a simple or nested variogram model to
     a sample variogram

Or do you mean, by "auto fit", that it should also chooses the number of
nested structures, and the corresponding models automatically?

> Recently I find georob is also a useful package to do 3D estimation with
> trend data, 
> But I did not find the way to create a  3D nested variogram, Does anyone
> kown about this,
> or any other package for fit  a  3D nested variogram?
> Thank you in advance!
> 
> 
> 
> -----
> Bingwei
> 
> Ph.D. Student 
> Kyoto University
> C-1-2-225, Katsura Campus, Kyoto University, 
> Nishikyo-ku, ?615-8530, Kyoto, Japan
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/can-we-use-georob-package-to-make-a-3D-nested-variogram-tp7587522.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141205/c5c60d4f/attachment.bin>

From bwtian at gmail.com  Fri Dec  5 08:56:53 2014
From: bwtian at gmail.com (Bingwei Tian)
Date: Fri, 5 Dec 2014 00:56:53 -0700 (MST)
Subject: [R-sig-Geo] can we use georob package to make a 3D nested
	variogram?
In-Reply-To: <54815910.8010800@uni-muenster.de>
References: <1417752490956-7587522.post@n2.nabble.com>
	<54815910.8010800@uni-muenster.de>
Message-ID: <1417766213474-7587524.post@n2.nabble.com>

Thanks edzer, As you said , I hope it can choose the number of
nested structures, at least keep the eyefitted number and the corresponding
models automatically.
But, for my case , the fit seems do noting except change the second Nug to 
1.

R:> uk.eye1  <- vgm(psill = 0.155,  model = "Gau",  range=700,  nugget=0.01)
R:> uk.eye   <- vgm(psill = 0.125,  model = "Sph",  range=35000,  nugget=0, 
add.to=uk.eye1)
R:> uk.eye
  model psill range
1   Nug 0.010     0
2   Gau 0.155   700
3   Nug 0.000     0
4   Sph 0.125 35000

R:> uk.fit  <- fit.variogram(uk.vgm, uk.eye, fit.sills = TRUE, fit.ranges =
TRUE,
+ fit.method = 7, debug.level = 1, warn.if.neg = FALSE)

Warning: singular model in variogram fit

R:> uk.fit
  model psill range
1   Nug 0.010     0
2   Gau 0.155   700
3   Nug 1.000     0
4   Sph 0.125 35000



-----
Bingwei

Ph.D. Student 
Kyoto University
C-1-2-225, Katsura Campus, Kyoto University, 
Nishikyo-ku, ?615-8530, Kyoto, Japan
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/can-we-use-georob-package-to-make-a-3D-nested-variogram-tp7587522p7587524.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From michael.koehler at nw-fva.de  Fri Dec  5 11:20:55 2014
From: michael.koehler at nw-fva.de (Michael Koehler)
Date: Fri, 05 Dec 2014 11:20:55 +0100
Subject: [R-sig-Geo] sampleStratified Error
Message-ID: <54818707.9090906@nw-fva.de>

Dear R-sig-geo users,

I have a large Rasterlayer with integers ranging from 0 to 44.

class       : RasterLayer
dimensions  : 29800, 34470, 1027206000  (nrow, ncol, ncell)
resolution  : 10, 10  (x, y)
extent      : 331300, 676000, 5681995, 5979995  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs
data source : /home/mkoehler/stk_rast_whz
names       : stk_rast_whz
values      : 0, 44  (min, max)

I want to do a stratified sampling of 5000 points per stratum.
I get the following error:
POINTS<-sampleStratified(b, size=5000, na.rm=T, xy=F)
(Error in ys[[i]] <- y : attempt to select less than one element)

Here is a code that reproduces the problems (even when only selecting 1 
item per stratum):

 > set.seed(10)
 > r <- raster(ncol=5000, nrow=5000)
 > names(r) <- 'stratum'
 > r[] <- round((runif(ncell(r)))*44)
 > #plot(r)
 >
 > sampleStratified(r, size=1,xy=T)
Error in ys[[i]] <- y : attempt to select less than one element

Trying that with fewer strata and changing the settings of "size" or 
"exp" have no effect.
R version: [64-bit] C:\Program Files\R\R-3.1.1


Any ideas?

thanks in advance!

-- 
Michael K?hler


From pickering at penguin.kobe-u.ac.jp  Fri Dec  5 14:09:13 2014
From: pickering at penguin.kobe-u.ac.jp (Steve Pickering)
Date: Fri, 5 Dec 2014 22:09:13 +0900
Subject: [R-sig-Geo] Moran.I function in "ape" library yielding unexpected
	values
Message-ID: <CAEdPBsGr1oUs=L-D3inZZrM=_fW4NcH+vcRmSNJ9OnvzkKtGRw@mail.gmail.com>

Dear r-sig-geo community,

I'm running the Moran.I function in the "ape" library and getting some
values which are not what I'm expecting.  Consider the code below, in
which a simple 8 x 8 grid is set up, and then populated with a
chessboard pattern.  My understanding is that a chessboard is an
example of perfect negative spatial autocorrelation, and that it
should therefore yield a Moran's I value of -1.  The result it yields,
while negative, is not close to -1:

$observed
[1] -0.07775248

$expected
[1] -0.01587302

$sd
[1] 0.01499786

$p.value
[1] 3.693094e-05

The code is as follows.  Can anyone tell me what I'm doing wrong?

As always, many thanks!

 - Steve.



library(ape)

# first, build an 8 x 8 grid
# lats and lngs will go from 0 to 7

lng <- rep(seq(0, 7, by=1), 8)

counter = 1
subCounter = 0
startNum = 0
lat = NULL

while (counter < 65) {

if (subCounter == 8) {
startNum = startNum + 1
subCounter = 0
}

lat = c(lat, startNum)
subCounter = subCounter + 1
counter = counter + 1

}

# now add the black/ white chessboard pattern

chess <- rep(c(0,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0), 4)

gridNum <- seq(1:64)

testGrid <- data.frame(gridNum, lat, lng, chess)

# simple Euclidean distance measure

testGrid.dists <- as.matrix(dist(cbind(testGrid$lng, testGrid$lat)))

# invert the distances, then replace the infinities with 0

testGrid.dists.inv <- 1 / testGrid.dists

diag(testGrid.dists.inv) <- 0

# now test the chessboard pattern

Moran.I(testGrid$chess, testGrid.dists.inv)



Steve Pickering
Assistant Professor
Graduate School of Law
Kobe University
2-1 Rokkodai-cho
Nada-ku, Kobe
657-8501 Japan
pickering at penguin.kobe-u.ac.jp
http://www.stevepickering.net


From Roger.Bivand at nhh.no  Fri Dec  5 15:03:30 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Dec 2014 15:03:30 +0100
Subject: [R-sig-Geo] Moran.I function in "ape" library yielding
 unexpected values
In-Reply-To: <CAEdPBsGr1oUs=L-D3inZZrM=_fW4NcH+vcRmSNJ9OnvzkKtGRw@mail.gmail.com>
References: <CAEdPBsGr1oUs=L-D3inZZrM=_fW4NcH+vcRmSNJ9OnvzkKtGRw@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1412051432030.31319@reclus.nhh.no>

On Fri, 5 Dec 2014, Steve Pickering wrote:

> Dear r-sig-geo community,
>
> I'm running the Moran.I function in the "ape" library and getting some
> values which are not what I'm expecting.  Consider the code below, in
> which a simple 8 x 8 grid is set up, and then populated with a
> chessboard pattern.  My understanding is that a chessboard is an
> example of perfect negative spatial autocorrelation, and that it
> should therefore yield a Moran's I value of -1.  The result it yields,
> while negative, is not close to -1:
>
> $observed
> [1] -0.07775248
>
> $expected
> [1] -0.01587302
>
> $sd
> [1] 0.01499786
>
> $p.value
> [1] 3.693094e-05
>
> The code is as follows.  Can anyone tell me what I'm doing wrong?

Your definition of all observations as neighbours of each other is causing 
this result. It isn't wrong, but very often the choice of weights will 
have an effect. Try:

library(spdep)
nb8r <- cell2nb(8, 8, type="rook", torus=FALSE)
nb8q <- cell2nb(8, 8, type="queen", torus=FALSE)
nb8rt <- cell2nb(8, 8, type="rook", torus=TRUE)
nb8qt <- cell2nb(8, 8, type="queen", torus=TRUE)

moran.test(testGrid$chess, nb2listw(nb8r, style="B"),
   alternative="two.sided")
# -1.000000000
moran.test(testGrid$chess, nb2listw(nb8q, style="B"),
   alternative="two.sided")
# -0.066666667
moran.test(testGrid$chess, nb2listw(nb8rt, style="B"),
   alternative="two.sided")
# -1.000000000
moran.test(testGrid$chess, nb2listw(nb8qt, style="B"),
   alternative="two.sided")
# 0.000000000

rdists <- nbdists(nb8r, cbind(testGrid$lng, testGrid$lat))
irdists <- lapply(rdists, function(x) 1/x)
qdists <- nbdists(nb8q, cbind(testGrid$lng, testGrid$lat))
iqdists <- lapply(qdists, function(x) 1/x)

moran.test(testGrid$chess, nb2listw(nb8r, glist=irdists, style="B"),
   alternative="two.sided")
# -1.000000000
moran.test(testGrid$chess, nb2listw(nb8q, glist=iqdists, style="B"),
   alternative="two.sided")
# -0.235545329

nb8all <- dnearneigh(cbind(testGrid$lng, testGrid$lat), 0,
   sqrt(2*(7^2)))
alldist <- nbdists(nb8all, cbind(testGrid$lng, testGrid$lat))
ialldist <- lapply(alldist, function(x) 1/x)
summary(rowSums(testGrid.dists.inv))
summary(sapply(ialldist, sum))
moran.test(testGrid$chess, nb2listw(nb8all, glist=ialldist, style="B"),
   randomisation=TRUE, alternative="two.sided")
# -0.0769782624

So the design of the spatial weights is driving the outcome. In addition, 
the 0/1 nature of the data is not strictly appropriate for Moran's I, 
which could take the residuals of a glm():

mod <- glm(chess ~ 1, data=testGrid, family=binomial)
lm.morantest(mod, nb2listw(nb8rt, style="B"), alternative="two.sided")
# -1.00000000

or join-count tests:

joincount.multi(as.factor(testGrid$chess), nb2listw(nb8r, style="B"))
#      Joincount Expected Variance z-value
# 0:0      0.000   27.556    8.325 -9.5503
# 1:1      0.000   27.556    8.325 -9.5503
# 1:0    112.000   56.889   27.205 10.5662
# Jtot   112.000   56.889   27.205 10.5662

joincount.multi(as.factor(testGrid$chess), nb2listw(nb8q, style="B"))
#      Joincount Expected Variance z-value
# 0:0     49.000   51.667   23.616 -0.5487
# 1:1     49.000   51.667   23.616 -0.5487
# 1:0    112.000  106.667   47.796  0.7714
# Jtot   112.000  106.667   47.796  0.7714

joincount.multi(as.factor(testGrid$chess), nb2listw(nb8all, 
glist=ialldist, style="B"))
#      Joincount Expected Variance z-value
# 0:0    148.864  158.719   34.009 -1.6899
# 1:1    148.864  158.719   34.009 -1.6899
# 1:0    347.388  327.678   22.506  4.1547
# Jtot   347.388  327.678   22.506  4.1547

In the rook case, there are no 0:0 or 1:1 joins, but there are in the 
Queen and all-in inverted distance cases.

I'm not sure that this clarifies, but it does account for your result.

Roger

>
> As always, many thanks!
>
> - Steve.
>
>
>
> library(ape)
>
> # first, build an 8 x 8 grid
> # lats and lngs will go from 0 to 7
>
> lng <- rep(seq(0, 7, by=1), 8)
>
> counter = 1
> subCounter = 0
> startNum = 0
> lat = NULL
>
> while (counter < 65) {
>
> if (subCounter == 8) {
> startNum = startNum + 1
> subCounter = 0
> }
>
> lat = c(lat, startNum)
> subCounter = subCounter + 1
> counter = counter + 1
>
> }
>
> # now add the black/ white chessboard pattern
>
> chess <- rep(c(0,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0), 4)
>
> gridNum <- seq(1:64)
>
> testGrid <- data.frame(gridNum, lat, lng, chess)
>
> # simple Euclidean distance measure
>
> testGrid.dists <- as.matrix(dist(cbind(testGrid$lng, testGrid$lat)))
>
> # invert the distances, then replace the infinities with 0
>
> testGrid.dists.inv <- 1 / testGrid.dists
>
> diag(testGrid.dists.inv) <- 0
>
> # now test the chessboard pattern
>
> Moran.I(testGrid$chess, testGrid.dists.inv)
>
>
>
> Steve Pickering
> Assistant Professor
> Graduate School of Law
> Kobe University
> 2-1 Rokkodai-cho
> Nada-ku, Kobe
> 657-8501 Japan
> pickering at penguin.kobe-u.ac.jp
> http://www.stevepickering.net
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From pickering at penguin.kobe-u.ac.jp  Fri Dec  5 15:51:20 2014
From: pickering at penguin.kobe-u.ac.jp (Steve Pickering)
Date: Fri, 5 Dec 2014 23:51:20 +0900
Subject: [R-sig-Geo] Moran.I function in "ape" library yielding
	unexpected values
In-Reply-To: <alpine.LRH.2.03.1412051432030.31319@reclus.nhh.no>
References: <CAEdPBsGr1oUs=L-D3inZZrM=_fW4NcH+vcRmSNJ9OnvzkKtGRw@mail.gmail.com>
	<alpine.LRH.2.03.1412051432030.31319@reclus.nhh.no>
Message-ID: <CAEdPBsG55O1nCt4MmyePVu9zcVdjRKfxaOwWrpdYaHdEYxMddg@mail.gmail.com>

Certainly does clarify, and gives me the results I was expecting with
simulated and real data: thanks, Roger!

 - Steve.


Steve Pickering
Assistant Professor
Graduate School of Law
Kobe University
2-1 Rokkodai-cho
Nada-ku, Kobe
657-8501 Japan
pickering at penguin.kobe-u.ac.jp
http://www.stevepickering.net



On 5 December 2014 at 23:03, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 5 Dec 2014, Steve Pickering wrote:
>
>> Dear r-sig-geo community,
>>
>> I'm running the Moran.I function in the "ape" library and getting some
>> values which are not what I'm expecting.  Consider the code below, in
>> which a simple 8 x 8 grid is set up, and then populated with a
>> chessboard pattern.  My understanding is that a chessboard is an
>> example of perfect negative spatial autocorrelation, and that it
>> should therefore yield a Moran's I value of -1.  The result it yields,
>> while negative, is not close to -1:
>>
>> $observed
>> [1] -0.07775248
>>
>> $expected
>> [1] -0.01587302
>>
>> $sd
>> [1] 0.01499786
>>
>> $p.value
>> [1] 3.693094e-05
>>
>> The code is as follows.  Can anyone tell me what I'm doing wrong?
>
>
> Your definition of all observations as neighbours of each other is causing
> this result. It isn't wrong, but very often the choice of weights will have
> an effect. Try:
>
> library(spdep)
> nb8r <- cell2nb(8, 8, type="rook", torus=FALSE)
> nb8q <- cell2nb(8, 8, type="queen", torus=FALSE)
> nb8rt <- cell2nb(8, 8, type="rook", torus=TRUE)
> nb8qt <- cell2nb(8, 8, type="queen", torus=TRUE)
>
> moran.test(testGrid$chess, nb2listw(nb8r, style="B"),
>   alternative="two.sided")
> # -1.000000000
> moran.test(testGrid$chess, nb2listw(nb8q, style="B"),
>   alternative="two.sided")
> # -0.066666667
> moran.test(testGrid$chess, nb2listw(nb8rt, style="B"),
>   alternative="two.sided")
> # -1.000000000
> moran.test(testGrid$chess, nb2listw(nb8qt, style="B"),
>   alternative="two.sided")
> # 0.000000000
>
> rdists <- nbdists(nb8r, cbind(testGrid$lng, testGrid$lat))
> irdists <- lapply(rdists, function(x) 1/x)
> qdists <- nbdists(nb8q, cbind(testGrid$lng, testGrid$lat))
> iqdists <- lapply(qdists, function(x) 1/x)
>
> moran.test(testGrid$chess, nb2listw(nb8r, glist=irdists, style="B"),
>   alternative="two.sided")
> # -1.000000000
> moran.test(testGrid$chess, nb2listw(nb8q, glist=iqdists, style="B"),
>   alternative="two.sided")
> # -0.235545329
>
> nb8all <- dnearneigh(cbind(testGrid$lng, testGrid$lat), 0,
>   sqrt(2*(7^2)))
> alldist <- nbdists(nb8all, cbind(testGrid$lng, testGrid$lat))
> ialldist <- lapply(alldist, function(x) 1/x)
> summary(rowSums(testGrid.dists.inv))
> summary(sapply(ialldist, sum))
> moran.test(testGrid$chess, nb2listw(nb8all, glist=ialldist, style="B"),
>   randomisation=TRUE, alternative="two.sided")
> # -0.0769782624
>
> So the design of the spatial weights is driving the outcome. In addition,
> the 0/1 nature of the data is not strictly appropriate for Moran's I, which
> could take the residuals of a glm():
>
> mod <- glm(chess ~ 1, data=testGrid, family=binomial)
> lm.morantest(mod, nb2listw(nb8rt, style="B"), alternative="two.sided")
> # -1.00000000
>
> or join-count tests:
>
> joincount.multi(as.factor(testGrid$chess), nb2listw(nb8r, style="B"))
> #      Joincount Expected Variance z-value
> # 0:0      0.000   27.556    8.325 -9.5503
> # 1:1      0.000   27.556    8.325 -9.5503
> # 1:0    112.000   56.889   27.205 10.5662
> # Jtot   112.000   56.889   27.205 10.5662
>
> joincount.multi(as.factor(testGrid$chess), nb2listw(nb8q, style="B"))
> #      Joincount Expected Variance z-value
> # 0:0     49.000   51.667   23.616 -0.5487
> # 1:1     49.000   51.667   23.616 -0.5487
> # 1:0    112.000  106.667   47.796  0.7714
> # Jtot   112.000  106.667   47.796  0.7714
>
> joincount.multi(as.factor(testGrid$chess), nb2listw(nb8all, glist=ialldist,
> style="B"))
> #      Joincount Expected Variance z-value
> # 0:0    148.864  158.719   34.009 -1.6899
> # 1:1    148.864  158.719   34.009 -1.6899
> # 1:0    347.388  327.678   22.506  4.1547
> # Jtot   347.388  327.678   22.506  4.1547
>
> In the rook case, there are no 0:0 or 1:1 joins, but there are in the Queen
> and all-in inverted distance cases.
>
> I'm not sure that this clarifies, but it does account for your result.
>
> Roger
>
>>
>> As always, many thanks!
>>
>> - Steve.
>>
>>
>>
>> library(ape)
>>
>> # first, build an 8 x 8 grid
>> # lats and lngs will go from 0 to 7
>>
>> lng <- rep(seq(0, 7, by=1), 8)
>>
>> counter = 1
>> subCounter = 0
>> startNum = 0
>> lat = NULL
>>
>> while (counter < 65) {
>>
>> if (subCounter == 8) {
>> startNum = startNum + 1
>> subCounter = 0
>> }
>>
>> lat = c(lat, startNum)
>> subCounter = subCounter + 1
>> counter = counter + 1
>>
>> }
>>
>> # now add the black/ white chessboard pattern
>>
>> chess <- rep(c(0,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0), 4)
>>
>> gridNum <- seq(1:64)
>>
>> testGrid <- data.frame(gridNum, lat, lng, chess)
>>
>> # simple Euclidean distance measure
>>
>> testGrid.dists <- as.matrix(dist(cbind(testGrid$lng, testGrid$lat)))
>>
>> # invert the distances, then replace the infinities with 0
>>
>> testGrid.dists.inv <- 1 / testGrid.dists
>>
>> diag(testGrid.dists.inv) <- 0
>>
>> # now test the chessboard pattern
>>
>> Moran.I(testGrid$chess, testGrid.dists.inv)
>>
>>
>>
>> Steve Pickering
>> Assistant Professor
>> Graduate School of Law
>> Kobe University
>> 2-1 Rokkodai-cho
>> Nada-ku, Kobe
>> 657-8501 Japan
>> pickering at penguin.kobe-u.ac.jp
>> http://www.stevepickering.net
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>


From edzer.pebesma at uni-muenster.de  Fri Dec  5 22:17:38 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 05 Dec 2014 22:17:38 +0100
Subject: [R-sig-Geo] can we use georob package to make a 3D nested
	variogram?
In-Reply-To: <1417766213474-7587524.post@n2.nabble.com>
References: <1417752490956-7587522.post@n2.nabble.com>	<54815910.8010800@uni-muenster.de>
	<1417766213474-7587524.post@n2.nabble.com>
Message-ID: <548220F2.8030100@uni-muenster.de>

Well, yes, you can't fit two nuggets independently, can you? Either fix
one of them, or remove one of them. Note that these two are different
models, when it comes to fitting parameters:

> vgm(1, "Sph", 900)
  model psill range
1   Sph     1   900
> vgm(1, "Sph", 900, 0)
  model psill range
1   Nug     0     0
2   Sph     1   900


On 12/05/2014 08:56 AM, Bingwei Tian wrote:
> Thanks edzer, As you said , I hope it can choose the number of
> nested structures, at least keep the eyefitted number and the corresponding
> models automatically.
> But, for my case , the fit seems do noting except change the second Nug to 
> 1.
> 
> R:> uk.eye1  <- vgm(psill = 0.155,  model = "Gau",  range=700,  nugget=0.01)
> R:> uk.eye   <- vgm(psill = 0.125,  model = "Sph",  range=35000,  nugget=0, 
> add.to=uk.eye1)
> R:> uk.eye
>   model psill range
> 1   Nug 0.010     0
> 2   Gau 0.155   700
> 3   Nug 0.000     0
> 4   Sph 0.125 35000
> 
> R:> uk.fit  <- fit.variogram(uk.vgm, uk.eye, fit.sills = TRUE, fit.ranges =
> TRUE,
> + fit.method = 7, debug.level = 1, warn.if.neg = FALSE)
> 
> Warning: singular model in variogram fit
> 
> R:> uk.fit
>   model psill range
> 1   Nug 0.010     0
> 2   Gau 0.155   700
> 3   Nug 1.000     0
> 4   Sph 0.125 35000
> 
> 
> 
> -----
> Bingwei
> 
> Ph.D. Student 
> Kyoto University
> C-1-2-225, Katsura Campus, Kyoto University, 
> Nishikyo-ku, ?615-8530, Kyoto, Japan
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/can-we-use-georob-package-to-make-a-3D-nested-variogram-tp7587522p7587524.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141205/c32c18a0/attachment.bin>

From nature.aseem at gmail.com  Sat Dec  6 17:47:20 2014
From: nature.aseem at gmail.com (Aseem Sharma)
Date: Sat, 6 Dec 2014 08:47:20 -0800
Subject: [R-sig-Geo] Extract spatial mean of subset of netCDF.
Message-ID: <CAPB42UwFSKBH4=NZaOZTpSWWemS6R-=n_LJxEkL-L1HjL7LpbQ@mail.gmail.com>

Hi,

I am  new with raster work in R.

I am trying to get the spatial mean of a subset (define by the extent) of
larger domain netCDF data file using raster and ncdf packages

The netCDF data of Snow Water Equivalent(SWE) were obtained from
http://www.globsnow.info/swe/archive_v2.0/. The two files I have used are
nc1
<https://www.dropbox.com/s/tk388w67tjg704s/GlobSnow_SWE_L3A_19900101_v2.0.nc?dl=0>
and nc2
<https://www.dropbox.com/s/pft2dlio96n6ncw/GlobSnow_SWE_L3A_19900102_v2.0.nc?dl=0>
.

The codes I used are

library(raster)

library(ncdf)

nc1<-"C:\\Users\\bunug_000.BUNU\\Documents\\Dropbox\\Public\\
GlobSnow_SWE_L3A_19900101_v2.0.nc"

nc2<-"C:\\Users\\bunug_000.BUNU\\Documents\\Dropbox\\Public\\
GlobSnow_SWE_L3A_19900102_v2.0.nc"



about_nc<-open.ncdf(nc1)

print(about_nc)



nc_data<-stack(nc1,nc2,varname="SWE")

print(nc_data)

dim(nc_data)

nc_data1<-brick(nc_data)

plot(nc_data1)

subsetd<-extent(-78,-74,50,52)

subsetd

crop_data <- crop(nc_data1, subsetd)

dim(dt.ras.c)



dt.anm<-as.data.frame(cbind(unname(cellStats(dt.ras.c,
stat="mean")),seq(1:2))) # use unname to separate named numebr to just
numbers

str(dt.anm)

colnames(dt.anm)<-c("Mean_SWE","ID")


What is not right here so that I am not getting mean SWE. It should not be
-1.

Any suggestions will be highly appreciated.

Thank you.


------------------

"Namaste ??????"

Aseem Sharma

Graduate Research Assistant

Northern Hydrometeorology Group(NHG)

Natural Resources and Environmental Studies Institute(NRESi)

University of Northern British Columbia

Prince George, BC, V2N 4Z9, Canada

Tel: 250-960-5427

Web: http://www.unbc.ca/


 "All know the Way, but few actually walk it."
"????? ?????? ???? ?"

	[[alternative HTML version deleted]]


From jed.long at st-andrews.ac.uk  Mon Dec  8 11:15:34 2014
From: jed.long at st-andrews.ac.uk (JLong)
Date: Mon, 8 Dec 2014 03:15:34 -0700 (MST)
Subject: [R-sig-Geo] Does there already exist a function in R to
 identify intersection between pairs of points?
In-Reply-To: <1417912481033-7587531.post@n2.nabble.com>
References: <1417912481033-7587531.post@n2.nabble.com>
Message-ID: <1418033734062-7587532.post@n2.nabble.com>

Sharon,
You are likely best to leave the road data as lines (SpatialLines) and then
convert your radio collar to SpatialLines connecting consecutive fixes. see: 
http://stackoverflow.com/questions/24284356/convert-spatialpointsdataframe-to-spatiallinesdataframe-in-r
<http://stackoverflow.com/questions/24284356/convert-spatialpointsdataframe-to-spatiallinesdataframe-in-r> 
, keep in mind the ordering of the points will matter.

Then intersecting the two SpatialLines can be done using the rgeos package
and gIntersection function. The output will be the SpatialPoints
(Coordinates) where the collar fix segments and roads intersect
(representing presumably road crossing areas?), which you can map.

Cheers,
Jed



-----
Jed Long
Lecturer in GeoInformatics
Department of Geography & Sustainable Development
University of St Andrews, UK
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Does-there-already-exist-a-function-in-R-to-identify-intersection-between-pairs-of-points-tp7587531p7587532.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ajdamico at gmail.com  Tue Dec  9 13:07:31 2014
From: ajdamico at gmail.com (Anthony Damico)
Date: Tue, 9 Dec 2014 07:07:31 -0500
Subject: [R-sig-Geo] R code to make maps with complex survey microdata
Message-ID: <CAOwvMDyfkUqdT3xdtx=iwXzfM4H8PBV2sH8egxWk5NAVmm7M9Q@mail.gmail.com>

this is still an art

http://www.asdfree.com/2014/12/maps-and-art-of-survey-weighted.html


complete syntax to create those seven examples:

https://github.com/davidbrae/swmap

	[[alternative HTML version deleted]]


From bwtian at gmail.com  Tue Dec  9 14:13:34 2014
From: bwtian at gmail.com (Bingwei Tian)
Date: Tue, 9 Dec 2014 06:13:34 -0700 (MST)
Subject: [R-sig-Geo] can we use georob package to make a 3D nested
	variogram?
In-Reply-To: <548220F2.8030100@uni-muenster.de>
References: <1417752490956-7587522.post@n2.nabble.com>
	<54815910.8010800@uni-muenster.de>
	<1417766213474-7587524.post@n2.nabble.com>
	<548220F2.8030100@uni-muenster.de>
Message-ID: <1418130814355-7587534.post@n2.nabble.com>

Yes, you are right, only one nugget effect can be fitted.
I fitted the variogram with one nugget, but still did not better than eye
fitted.



-----
Bingwei

Ph.D. Student 
Kyoto University
C-1-2-225, Katsura Campus, Kyoto University, 
Nishikyo-ku, ?615-8530, Kyoto, Japan
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/can-we-use-georob-package-to-make-a-3D-nested-variogram-tp7587522p7587534.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Tue Dec  9 15:47:49 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 09 Dec 2014 15:47:49 +0100
Subject: [R-sig-Geo] can we use georob package to make a 3D nested
	variogram?
In-Reply-To: <1418130814355-7587534.post@n2.nabble.com>
References: <1417752490956-7587522.post@n2.nabble.com>	<54815910.8010800@uni-muenster.de>	<1417766213474-7587524.post@n2.nabble.com>	<548220F2.8030100@uni-muenster.de>
	<1418130814355-7587534.post@n2.nabble.com>
Message-ID: <54870B95.80100@uni-muenster.de>



On 12/09/2014 02:13 PM, Bingwei Tian wrote:
> Yes, you are right, only one nugget effect can be fitted.
> I fitted the variogram with one nugget, but still did not better than eye
> fitted.
> 
> 

If your criterion for "better" is visual, then you must be right. If
your criterion involves minimising a weighted sum of squares similar to
what gstat::fit.variogram uses, I would be happy to receive from you a
reproducible example.

> 
> -----
> Bingwei
> 
> Ph.D. Student 
> Kyoto University
> C-1-2-225, Katsura Campus, Kyoto University, 
> Nishikyo-ku, ?615-8530, Kyoto, Japan
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/can-we-use-georob-package-to-make-a-3D-nested-variogram-tp7587522p7587534.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141209/0120ad03/attachment.bin>

From rpaolo1967 at gmail.com  Tue Dec  9 16:17:46 2014
From: rpaolo1967 at gmail.com (rpaolo1967 RP)
Date: Tue, 9 Dec 2014 10:47:46 -0430
Subject: [R-sig-Geo] (no subject)
Message-ID: <CANvsoOuVw1AVq=G751XjtPF93k3zHVRoJPeWszvxeeVNkg79nA@mail.gmail.com>

Hi everybody,



I apologize for this simple question. I?m running a code which, at each
step of a loop, generates a data frame similar to this one:



d <- rep(1:10, each = 6, len = 60)

a <- rep(0:5, each = 1, len = 60)

v <- rep(sort(runif(5, 30, 50), decreasing = T), each = 1, len = 60)

x <- data.frame(t(cbind(d,a,v)))



I want to create and save plots of the results, once data frames are
created. I?m using this code within the loop, after the creation of the
data frame:



# library(lattice)

svg("eraseMe.svg") # Format doesn?t matter, and name is iteratively created

xyplot(v ~ a | d, x, aspect = 5, type = "o", xlab = "a", ylab = "v")

update(trellis.last.object(),

    strip = strip.custom(strip.names = FALSE, strip.levels = i),

    par.strip.text = list(cex = 1.1))

dev.off()



where ?i? is something as simple as



i <- as.numeric(c(1:10))



It works troublelessly on my laptop (under 32 bits Windows Vista), but I
get the following message when running in computers under ubuntu or 64 bits
Windows 7:



Error in !lattice.getStatus("current.plot.saved", prefix = prefix) :

  invalid argument type



Notwithstanding, when I simply copy and paste again the following code,
after getting the message, it works fine (but loop is interrupted).



svg("eraseMe.svg") # No matter the format

xyplot(v ~ a | d, x, aspect = 5, type = "o", xlab = "a", ylab = "v")

update(trellis.last.object(),

   strip = strip.custom(strip.names = FALSE, strip.levels = i),

   par.strip.text = list(cex = 1.1))

dev.off()



Any suggestion? Thanks a lot!!!!


Paolo

	[[alternative HTML version deleted]]


From junkmail2 at mail.ru  Wed Dec 10 07:03:57 2014
From: junkmail2 at mail.ru (=?UTF-8?B?VmFzeWEgUHVwa2lu?=)
Date: Wed, 10 Dec 2014 09:03:57 +0300
Subject: [R-sig-Geo] =?utf-8?q?bootstrapping_linear_model_and_residuals_kr?=
 =?utf-8?q?iging_by_RSAGA?=
Message-ID: <1418191437.647847662@f73.i.mail.ru>


Dear ladies and gentlemen, I don?t really know it this is a suitable platform for asking such questions, but stackoverflow could not help me, so I am trying my luck here:).
What I am doing: I am trying to make a soil erodibility map. I have soil erodibility measurements at points and I do a linear regression analysis to predict soil erodibility from predictors (morphological and remotely sensed). Then I apply the regression equation to the predictor rasters and get a raster of soil erodibility. Then I calculate residuals and extra/inter-polate with ordinary kriging (global) using my own formula discribing the variogramm. Then I summ up the map from regression equation and the interpolated rsiduals to create the final map, thus mimiking regression kriging as you have suggested. The regression was done in R.
Now I want to validate the final map with bootstrap as it is implimented in R "boot" package. In the madual it says you can wrap any complicated model in the "boot" sequence. So I wanted to write this whole regression+residual_kriging model in the boostrap in R. After googling I fould this RSAGA package that provides a direct access to SAGA's functionality. And there is this "rsaga.geoprocessor" module which works like CMD for SAGA, and will not return the results back to R environment for further calculations but will save them to a file, like SAGA's CMD normally does. And there is this "pick.from.points" module which has sort of deeper integration with SAGA's modules (not all though) and is what I think I need but I can't figure out how I can use my own variogram formula and how I can return the results back to R environment for further calculations. So in other words I need to do a regression and then predict the values and extrapolate residuals for excluded points, so the RSAGA module should return the values of extrapolated residuals back to ?boot? calculation.
What I want to do is something like this (R script):
boot(mydata,
?????? lm( resp~predict, ...)+
?????? pick.from.points( lm(resp~predict)$residuals, method = "krige", model = "a+b^c",...))
Do you have any idea how it could be done? If not, could you please advise on any other ways or anybody who could know? The approach ? regression + residuals kriging is critical, but not the software, so if there are any other packages for doing this, please advice. 

Best wishes,
Maksim.

	[[alternative HTML version deleted]]


From s.m.mordue at newcastle.ac.uk  Wed Dec 10 12:43:04 2014
From: s.m.mordue at newcastle.ac.uk (Simone Mordue (PGR))
Date: Wed, 10 Dec 2014 11:43:04 +0000
Subject: [R-sig-Geo] FW: subscript out of bounds, getvertices adehabitathr
Message-ID: <3BF8FBEB6584F146A69D2902AFD7AEB887127684@EXMBDB02.campus.ncl.ac.uk>

Hope someone can help, I have 10 animals and have generated random points based on recorded polygons for each animal. I have run this 100 times per animal. My aim is to generate a mean utilized distribution for each animal based on all 100 runs. so far I have used this code:

xybat <- subset(bat.master, bat.master$id =="Y2889a",select=x:loopno )

# change to spatial points
xy <- xybat[1:2 ] # first two rows save as coords
df <- xybat[-1:-3 ]# remove unneded columns for ud

SPDF <- SpatialPointsDataFrame(coords=xy, data=df ) # combine df and

udHR <- kernelUD(SPDF, h = 200, grid=habitat)

## I would proceed using the raster packages
# stack the UD's as a raster
ud <- stack(lapply(udHR, raster))

## You can now check the first one
plot(ud[[1]])

## take the mean
plot(udm <- mean(ud))

## now convert it back to a estUD, this is a bit of a hack and not the nicest way to do it

Y2889a<- udHR[[1]]
Y2889a at grid <- as(udm, "GridTopology")

I do this first bit of code for each animal, here is a subset of just two of them. I can visulise them using image(liud) but when I try to use the function "getverticeshr" I get an error that the subscript is out of bounds. I have tried changing the grid and the value of h to no avail. I wonder if it something to do with the way I am combining them into and out of a list?

library(adehabitatHR)
# combine all Ud's into one dataset
liud <- list(Y2889a, Y2889b)
class(liud) <- "estUDm"

image(liud) # plot all est ud's

v<-getverticeshr(liud)

I have reproduced the error with the puechabonsp dataset below

library(adehabitatHR)
# Load the data
data(puechabonsp)
loc <- puechabonsp$relocs

## Estimation of UD for each of the animals (two here as an example)
udBrock <- kernelUD(loc[as.data.frame(loc)[,1]=="Brock",], grid=200)
udCalou <- kernelUD(loc[as.data.frame(loc)[,1]=="Calou",], grid=200)

# join the UD's into an estUDm object
liud <- list(udBrock, udCalou)
class(liud) <- "estUDm"
image(liud) # plot all est ud's

v<-getverticeshr(liud)

this results in the same error, subscript is out of bounds. Hope someone can help!

Best wishes, Simone




	[[alternative HTML version deleted]]


From alobolistas at gmail.com  Wed Dec 10 13:39:36 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Dec 2014 13:39:36 +0100
Subject: [R-sig-Geo] Problem with plotting overlaid maps
Message-ID: <CAG4NRe+fgivSnhjDU1R=JUUhZ=WLPfUo-OcfM3xH3_HNbsfzSg@mail.gmail.com>

I have a problem plotting a raster layer with its legend overlaid on
a GM map. I can circunvent the problem (see below), but then
I get another problem: the resulting map has a geometry that is dependent
upon the geometry of the window. Is there any solution?

This is what I do:

require(rgdal)
require(raster)
require(dismo)
require(colorspace)

colores <- rev(heat_hcl(9,c=c(80,30), l=c(30,90),
power=c(1/5,1.3),alpha = 0.75))
system("wget https://dl.dropboxusercontent.com/u/3180464/hcL1G2.tif",intern=TRUE)
g2 <- raster("hcL1G2.tif")

migmap <- gmap(x = g1, type = "hybrid", zoom = 5)
g2GM <- projectRaster(from = g2, crs = CRS("+init=epsg:3857"))
g2GM[g2GM<0] <- 0


#' Display without legend: no problems but no legend...
plot(migmap)
plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
     legend=FALSE, add=TRUE)
#' The map is not distorted (shape independent of window geometry)

#' with legend we must do it this way
plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
     legend=TRUE,axes=FALSE)
plot(migmap,add=TRUE)
plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
     legend=FALSE, add=TRUE)
#' the map gets distorted depending upon de geometry of the window


Thanks,

Agus


From rubenfcasal at gmail.com  Wed Dec 10 13:48:19 2014
From: rubenfcasal at gmail.com (rubenfcasal)
Date: Wed, 10 Dec 2014 13:48:19 +0100
Subject: [R-sig-Geo] bootstrapping linear model and residuals kriging by
 RSAGA
In-Reply-To: <1418191437.647847662@f73.i.mail.ru>
References: <1418191437.647847662@f73.i.mail.ru>
Message-ID: <54884113.8060805@gmail.com>

Hi Vasya,

     You have to take into account, when doing bootstrap, that you are 
dealing with dependent data. Standard bootstrap will destroy this 
dependence, so you should use alternatives such as some kind of block 
bootstrap (see e.g. Politis and Romano, 1994. The stationary bootstrap. 
JASA, 89, 1303-1313). Alternatively, you may use the estimated 
covariance matrix to try to reproduce the spatial variability (see e.g. 
Francisco-Fernandez et al., 2012. Nonparametric methods for spatial 
regression. An application to seismic events, Environmetrics, 23, 
85-93). In any case, if the number of data is large enough (as it 
seems), my recommendation would be to use some kind of cross validation 
instead of bootstrap.

     Note also that the linear regression can be integrated in the 
kriging procedure (using e.g. gstat or geoR), thereby obtaining an 
estimate of the variance of the final prediction.

     Best Regards,
         Ruben Fernandez-Casal


El 10/12/2014 7:03, Vasya Pupkin escribi?:
> Dear ladies and gentlemen, I don?t really know it this is a suitable platform for asking such questions, but stackoverflow could not help me, so I am trying my luck here:).
> What I am doing: I am trying to make a soil erodibility map. I have soil erodibility measurements at points and I do a linear regression analysis to predict soil erodibility from predictors (morphological and remotely sensed). Then I apply the regression equation to the predictor rasters and get a raster of soil erodibility. Then I calculate residuals and extra/inter-polate with ordinary kriging (global) using my own formula discribing the variogramm. Then I summ up the map from regression equation and the interpolated rsiduals to create the final map, thus mimiking regression kriging as you have suggested. The regression was done in R.
> Now I want to validate the final map with bootstrap as it is implimented in R "boot" package. In the madual it says you can wrap any complicated model in the "boot" sequence. So I wanted to write this whole regression+residual_kriging model in the boostrap in R. After googling I fould this RSAGA package that provides a direct access to SAGA's functionality. And there is this "rsaga.geoprocessor" module which works like CMD for SAGA, and will not return the results back to R environment for further calculations but will save them to a file, like SAGA's CMD normally does. And there is this "pick.from.points" module which has sort of deeper integration with SAGA's modules (not all though) and is what I think I need but I can't figure out how I can use my own variogram formula and how I can return the results back to R environment for further calculations. So in other words I need to do a regression and then predict the values and extrapolate residuals for excluded points, so the RSAGA module should return the values of extrapolated residuals back to ?boot? calculation.
> What I want to do is something like this (R script):
> boot(mydata,
>         lm( resp~predict, ...)+
>         pick.from.points( lm(resp~predict)$residuals, method = "krige", model = "a+b^c",...))
> Do you have any idea how it could be done? If not, could you please advise on any other ways or anybody who could know? The approach ? regression + residuals kriging is critical, but not the software, so if there are any other packages for doing this, please advice.
>
> Best wishes,
> Maksim.
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Wed Dec 10 14:07:09 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 10 Dec 2014 14:07:09 +0100
Subject: [R-sig-Geo] Problem with plotting overlaid maps
In-Reply-To: <CAG4NRe+fgivSnhjDU1R=JUUhZ=WLPfUo-OcfM3xH3_HNbsfzSg@mail.gmail.com>
References: <CAG4NRe+fgivSnhjDU1R=JUUhZ=WLPfUo-OcfM3xH3_HNbsfzSg@mail.gmail.com>
Message-ID: <5488457D.3020103@uni-muenster.de>

A general piece of advice: always test run your script in an EMPTY R
session (e.g., R --vanilla) before posting.

Below, g1 is unknown; if replaced with g2 the script runs, at least.

On 12/10/2014 01:39 PM, Agustin Lobo wrote:
> I have a problem plotting a raster layer with its legend overlaid on
> a GM map. I can circunvent the problem (see below), but then
> I get another problem: the resulting map has a geometry that is dependent
> upon the geometry of the window. Is there any solution?
> 
> This is what I do:
> 
> require(rgdal)
> require(raster)
> require(dismo)
> require(colorspace)
> 
> colores <- rev(heat_hcl(9,c=c(80,30), l=c(30,90),
> power=c(1/5,1.3),alpha = 0.75))
> system("wget https://dl.dropboxusercontent.com/u/3180464/hcL1G2.tif",intern=TRUE)
> g2 <- raster("hcL1G2.tif")
> 
> migmap <- gmap(x = g1, type = "hybrid", zoom = 5)
> g2GM <- projectRaster(from = g2, crs = CRS("+init=epsg:3857"))
> g2GM[g2GM<0] <- 0
> 
> 
> #' Display without legend: no problems but no legend...
> plot(migmap)
> plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
>      legend=FALSE, add=TRUE)
> #' The map is not distorted (shape independent of window geometry)
> 
> #' with legend we must do it this way
> plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
>      legend=TRUE,axes=FALSE)
> plot(migmap,add=TRUE)
> plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
>      legend=FALSE, add=TRUE)
> #' the map gets distorted depending upon de geometry of the window
> 
> 
> Thanks,
> 
> Agus
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20141210/60d848c9/attachment.bin>

From alobolistas at gmail.com  Wed Dec 10 14:49:17 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Dec 2014 14:49:17 +0100
Subject: [R-sig-Geo] Problem with plotting overlaid maps
In-Reply-To: <5488457D.3020103@uni-muenster.de>
References: <CAG4NRe+fgivSnhjDU1R=JUUhZ=WLPfUo-OcfM3xH3_HNbsfzSg@mail.gmail.com>
	<5488457D.3020103@uni-muenster.de>
Message-ID: <CAG4NRe+brcEKCnXBDqSobeqFRj_aoQjGbf6fGxvNBc8SiR0Wgw@mail.gmail.com>

(sorry for the g1 issue, g2 can be used as it is the same extent)
It works for me as well, but when you resize the graphic window  the
map gets distorted. Close
the graphic window before the second part and resize to a rectangle
with much shorter height than length. Does the map keep with its correct shape?
Not for me, while it does with the first option.
Tried before within and outside RStudio

Agus



On Wed, Dec 10, 2014 at 2:07 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> A general piece of advice: always test run your script in an EMPTY R
> session (e.g., R --vanilla) before posting.
>
> Below, g1 is unknown; if replaced with g2 the script runs, at least.
>
> On 12/10/2014 01:39 PM, Agustin Lobo wrote:
>> I have a problem plotting a raster layer with its legend overlaid on
>> a GM map. I can circunvent the problem (see below), but then
>> I get another problem: the resulting map has a geometry that is dependent
>> upon the geometry of the window. Is there any solution?
>>
>> This is what I do:
>>
>> require(rgdal)
>> require(raster)
>> require(dismo)
>> require(colorspace)
>>
>> colores <- rev(heat_hcl(9,c=c(80,30), l=c(30,90),
>> power=c(1/5,1.3),alpha = 0.75))
>> system("wget https://dl.dropboxusercontent.com/u/3180464/hcL1G2.tif",intern=TRUE)
>> g2 <- raster("hcL1G2.tif")
>>
>> migmap <- gmap(x = g1, type = "hybrid", zoom = 5)
>> g2GM <- projectRaster(from = g2, crs = CRS("+init=epsg:3857"))
>> g2GM[g2GM<0] <- 0
>>
>>
>> #' Display without legend: no problems but no legend...
>> plot(migmap)
>> plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
>>      legend=FALSE, add=TRUE)
>> #' The map is not distorted (shape independent of window geometry)
>>
>> #' with legend we must do it this way
>> plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
>>      legend=TRUE,axes=FALSE)
>> plot(migmap,add=TRUE)
>> plot(log10(g2GM),zlim=c(1,5),col=colores, breaks=seq(1,5,by=0.5),
>>      legend=FALSE, add=TRUE)
>> #' the map gets distorted depending upon de geometry of the window
>>
>>
>> Thanks,
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Edzer Pebesma,  Co-Editor-in-Chief Computers & Geosciences
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From zilefacelvis at yahoo.com  Sun Dec 14 00:02:12 2014
From: zilefacelvis at yahoo.com (Zilefac Elvis)
Date: Sat, 13 Dec 2014 23:02:12 +0000 (UTC)
Subject: [R-sig-Geo] Position of colorbar and color vs label breaks R raster
Message-ID: <45250672.86042.1418511732396.JavaMail.yahoo@jws10602g.mail.bf1.yahoo.com>

Dear All,
I have a raster layer (lr) with the following attributes:

library(raster)

#-------------------------------------------------------
class       : RasterLayer 

dimensions  : 137, 229, 31373  (nrow, ncol, ncell) 
resolution  : 0.136, 0.0808  (x, y) 
extent      : -120.0072, -88.8632, 48.95328, 60.02288  (xmin, xmax, ymin, ymax) 
coord. ref. : +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs 
data source : in memory 
names       : myfile100 
values      : 106.6673, 172.4463  (min, max) 
#-----------------------------------------------------------

I write the raster to a directory like this:
writeRaster(r, file="myfile100.tif", format="GTiff", overwrite=TRUE) 

lr = raster("myfile100.tif")
bbox(lr) 
Long=c(-120.0072, -88.8632) 
Lat=c(48.95328, 60.02288)
brks <- seq(minValue(lr), maxValue(lr), by=10) 
nb <- length(brks)-1 
colors<-c("darkred", "red3","orange","gold1", "yellow", "lightskyblue","steelblue3", "royalblue3", 
"darkblue","darkblue") 


Long=c(-120.0072, -88.8632) 
Lat=c(48.95328, 60.02288)# plot the raster
plot(Long, Lat, type="n",axes=FALSE,xlab="",ylab="") 
plot(lr,add=TRUE,legend=F,axes=FALSE,lab.breaks=brks, zlim=c(105,175), 
main='first',col=colorRampPalette(c("darkred", "red3","orange","gold1", "yellow", "lightskyblue","steelblue3", "royalblue3", 
"darkblue","darkblue"))(30))# change number of colors 
#plot(Prairie.Boundaries,add=T)
 
1) Problem: Legend falls on the raster image and not out of the box. How can I change the postion of the raster? I found this answer but it just does not solve the problem. 
  
r.range <- c(minValue(lr), maxValue(lr)) 
plot(lr, legend.only=TRUE,legend.width=1.4, 
legend.shrink=1,col=colors, 
axis.args=list(at=seq(r.range[1], r.range[2], 10), 
labels=seq(r.range[1], r.range[2], 10), 
cex.axis=0.6), 
legend.args=list(text='Elevation (m)', side=4, font=2, line=2.5, cex=0.8)) 


2) How can I set set legend (colorbar) label breaks to match color breaks? 

I will send my raster upon request since I could not make a good reproducible example enough to illustrate the problem.

Many thanks,
Asong.


From Emma.Brooks at soton.ac.uk  Tue Dec 16 16:07:33 2014
From: Emma.Brooks at soton.ac.uk (Brooks E.G.E.)
Date: Tue, 16 Dec 2014 15:07:33 +0000
Subject: [R-sig-Geo] Extract from raster produces NA when polygon has holes
Message-ID: <F075976912A9094987C85F2ADA48393A4DF5B40C@SRV00046.soton.ac.uk>

Dear all

I am using extract to 'extract' the values from raster to polygons, which is working fine until I noticed a couple of values are coming up as NA. On closer inspection these polygons have holes; it is a lake layer so these are representing islands. I don't know why expressly the extract function doesn't like holes - is there any way round this, or do I need to manually remove these? (I don't want to remove them as ideally I don't want to extract the data which belongs to the islands rather than the lakes).

I am thinking this may be obvious for people in the know, but if it needs clarifying, or dummy data, apologies and please let me know.

Many thanks
Emma

	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Tue Dec 16 16:29:59 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 16 Dec 2014 15:29:59 +0000
Subject: [R-sig-Geo] Extract from raster produces NA when polygon has
	holes
In-Reply-To: <F075976912A9094987C85F2ADA48393A4DF5B40C@SRV00046.soton.ac.uk>
References: <F075976912A9094987C85F2ADA48393A4DF5B40C@SRV00046.soton.ac.uk>
Message-ID: <CANVKczNWvkWH+Q5kOwH5soMfwHQjomsa2BObn51Etoh27Uk1vA@mail.gmail.com>

On Tue, Dec 16, 2014 at 3:07 PM, Brooks E.G.E. <Emma.Brooks at soton.ac.uk> wrote:
> Dear all
>
> I am using extract to 'extract' the values from raster to polygons, which is working fine until I noticed a couple of values are coming up as NA. On closer inspection these polygons have holes; it is a lake layer so these are representing islands. I don't know why expressly the extract function doesn't like holes - is there any way round this, or do I need to manually remove these? (I don't want to remove them as ideally I don't want to extract the data which belongs to the islands rather than the lakes).
>
> I am thinking this may be obvious for people in the know, but if it needs clarifying, or dummy data, apologies and please let me know.

 I think we need dummy data.... I would expect NA where there is a
hole, since extract doesn't know what the right value is there. If you
want to get the value of the surrounding polygon when extracting at a
hole then you'll have to remove the holes and just use the outer
polygon, assuming you only have one outer polygon...

 However, if you are getting NA all over any polygon that does have a
hole somewhere then I wonder if your polygons are coded the right way
round....

 Barry


From pliege at anisteme.net  Tue Dec 16 16:33:20 2014
From: pliege at anisteme.net (Philippe Liege)
Date: Tue, 16 Dec 2014 16:33:20 +0100
Subject: [R-sig-Geo] gIntersection fails
Message-ID: <00e801d01945$9f911e30$deb35a90$@anisteme.net>

Hello,

 

I'm looking to clip the Europe map after reading this post:

http://stackoverflow.com/questions/15881455/how-to-clip-worldmap-with-polygo
n-in-r

 

The procedure in running fine when using the shape file NUTS_RG_60M_2010.shp

 

library(rgdal)

s <- readOGR('NUTS_2010_60M_SH/data', layer="NUTS_RG_60M_2010")

s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in%
c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]

# plot(s1)

clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")

# clip.extent <- as(extent(-10, 40, 60, 72), "SpatialPolygons")

proj4string(clip.extent) <- CRS(proj4string(s))

gI <- gIntersects( s1 , clip.extent , byid = TRUE )

out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] , clip.extent)
} )

 

# But let's look at what is returned

table( sapply( out , class ) )

 

# We want to keep only objects of class SpatialPolygons                 

keep <- sapply(out, class)

out <- out[keep == "SpatialPolygons"]

 

# Coerce list back to SpatialPolygons object

EuropeW <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)

   Pol

}))

plot( EuropeW )

 

 

 

However I'm getting an error when using the shape files NUTS_RG_10M_2010.shp
or NUTS_RG_03M_2010.shp

 

Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
"rgeos_intersection"): TopologyException: Input geom 0 is invalid:
Self-intersection at or near point 0.68803650000000005 51.7317125 at
0.68803650000000005 51.7317125

 

 

The conflicts originate from the UK map, somewhere above lat 50. Steps to
reproduce:

 

library(rgdal)

  s <- readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")

s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% c("UK"),]

# plot(s1)

clip.extent <- as(extent(-10, 19, 36, 53), "SpatialPolygons")

proj4string(clip.extent) <- CRS(proj4string(s))

gI <- gIntersects( s1 , clip.extent , byid = TRUE )

out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] , clip.extent)
} )

 

# But let's look at what is returned

table( sapply( out , class ) )

 

# We want to keep only objects of class SpatialPolygons                 

keep <- sapply(out, class)

out <- out[keep == "SpatialPolygons"]

 

# Coerce list back to SpatialPolygons object

UK <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)

   Pol

}))

plot( UK )

 

 

What does this self-intersection means?

 

 

 

Regards,

 

 

Philippe

 


	[[alternative HTML version deleted]]


From Emma.Brooks at soton.ac.uk  Tue Dec 16 17:07:46 2014
From: Emma.Brooks at soton.ac.uk (Brooks E.G.E.)
Date: Tue, 16 Dec 2014 16:07:46 +0000
Subject: [R-sig-Geo] Extract from raster produces NA when polygon has
 holes
In-Reply-To: <CANVKczNWvkWH+Q5kOwH5soMfwHQjomsa2BObn51Etoh27Uk1vA@mail.gmail.com>
References: <F075976912A9094987C85F2ADA48393A4DF5B40C@SRV00046.soton.ac.uk>
	<CANVKczNWvkWH+Q5kOwH5soMfwHQjomsa2BObn51Etoh27Uk1vA@mail.gmail.com>
Message-ID: <F075976912A9094987C85F2ADA48393A4DF5B436@SRV00046.soton.ac.uk>

Apologies, I tried it with a couple of my own different data sets and I thought the holes were the problem, however I've just tried to reproduce the example:

library(maptools)
library(raster)
data(wrld_simpl)
Afr2<-wrld_simpl[which(wrld_simpl at data$NAME=='South Africa'|wrld_simpl at data$NAME=='Namibia'),]
ras<-raster(extent(Afr2), nrows = 10, ncols = 10)
values(ras) = 1:100
Afr2$Score<-extract(ras,Afr2,na.rm=T,progress='text',fun=sum)
data.frame(Afr2)

The equivalent problem in my own data would give South Africa a $Score of NA, however it seems to be working fine here, so I'll have to go back to the drawing board to pinpoint the problem.

Thanks for your time,
Emma

-----Original Message-----
From: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] On Behalf Of Barry Rowlingson
Sent: 16 December 2014 15:30
To: Brooks E.G.E.
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Extract from raster produces NA when polygon has holes

On Tue, Dec 16, 2014 at 3:07 PM, Brooks E.G.E. <Emma.Brooks at soton.ac.uk> wrote:
> Dear all
>
> I am using extract to 'extract' the values from raster to polygons, which is working fine until I noticed a couple of values are coming up as NA. On closer inspection these polygons have holes; it is a lake layer so these are representing islands. I don't know why expressly the extract function doesn't like holes - is there any way round this, or do I need to manually remove these? (I don't want to remove them as ideally I don't want to extract the data which belongs to the islands rather than the lakes).
>
> I am thinking this may be obvious for people in the know, but if it needs clarifying, or dummy data, apologies and please let me know.

 I think we need dummy data.... I would expect NA where there is a hole, since extract doesn't know what the right value is there. If you want to get the value of the surrounding polygon when extracting at a hole then you'll have to remove the holes and just use the outer polygon, assuming you only have one outer polygon...

 However, if you are getting NA all over any polygon that does have a hole somewhere then I wonder if your polygons are coded the right way round....

 Barry

From Roger.Bivand at nhh.no  Tue Dec 16 19:36:00 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 16 Dec 2014 19:36:00 +0100
Subject: [R-sig-Geo] gIntersection fails
In-Reply-To: <00e801d01945$9f911e30$deb35a90$@anisteme.net>
References: <00e801d01945$9f911e30$deb35a90$@anisteme.net>
Message-ID: <alpine.LRH.2.03.1412161911210.17094@reclus.nhh.no>

Please never post HTML, only plain text.

Always include a link to data, but not this data, as this requires 
acceptance of conditions to download, so is not automatic.

Note that the SO posting you quote was from April 2013 - it is always 
important to give your sessionInfo() output, as how things work changes 
over time, leaving legacy advice stale. Your results might match the SO 
ones if your platform is the same as that was then. In particular, the:

http://cran.r-project.org/web/packages/rgeos/ChangeLog

entry for 2014-02-08 indicates that non-polygon output from polygon 
intersections is now handled more gracefully.

The underlying problem may be that these coordinates are geographical, not 
projected, and the integer discretisation used by GEOS is failing for some 
input - have you tried projecting to planar coordinates in a different 
metric and doing the same operation? Or using setScale()?

For my 20M 2006:

library(rgdal)
s <- readOGR('.', layer="NUTS_RG_20M_2006")
s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% 
c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]
library(raster)
clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")
proj4string(clip.extent) <- CRS(proj4string(s))
EuropeW <- gIntersection(s1, clip.extent, byid=c(TRUE, FALSE))
plot(EuropeW)

just works.

Hope this clarifies,

Roger

PS:

> sessionInfo()
R version 3.1.2 (2014-10-31)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C
  [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8
  [5] LC_MONETARY=en_US.utf8    LC_MESSAGES=en_US.utf8
  [7] LC_PAPER=en_US.utf8       LC_NAME=C
  [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgeos_0.3-8   raster_2.3-12 rgdal_0.9-1   sp_1.0-16

loaded via a namespace (and not attached):
[1] grid_3.1.2      lattice_0.20-29
> version_GEOS()
[1] "3.4.2-CAPI-1.8.2 r3921"


On Tue, 16 Dec 2014, Philippe Liege wrote:

> Hello,
>
>
>
> I'm looking to clip the Europe map after reading this post:
>
> http://stackoverflow.com/questions/15881455/how-to-clip-worldmap-with-polygo
> n-in-r
>
>
>
> The procedure in running fine when using the shape file NUTS_RG_60M_2010.shp
>
>
>
> library(rgdal)
>
> s <- readOGR('NUTS_2010_60M_SH/data', layer="NUTS_RG_60M_2010")
>
> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in%
> c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]
>
> # plot(s1)
>
> clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")
>
> # clip.extent <- as(extent(-10, 40, 60, 72), "SpatialPolygons")
>
> proj4string(clip.extent) <- CRS(proj4string(s))
>
> gI <- gIntersects( s1 , clip.extent , byid = TRUE )
>
> out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] , clip.extent)
> } )
>
>
>
> # But let's look at what is returned
>
> table( sapply( out , class ) )
>
>
>
> # We want to keep only objects of class SpatialPolygons
>
> keep <- sapply(out, class)
>
> out <- out[keep == "SpatialPolygons"]
>
>
>
> # Coerce list back to SpatialPolygons object
>
> EuropeW <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
> slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>
>   Pol
>
> }))
>
> plot( EuropeW )
>
>
>
>
>
>
>
> However I'm getting an error when using the shape files NUTS_RG_10M_2010.shp
> or NUTS_RG_03M_2010.shp
>
>
>
> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
> "rgeos_intersection"): TopologyException: Input geom 0 is invalid:
> Self-intersection at or near point 0.68803650000000005 51.7317125 at
> 0.68803650000000005 51.7317125
>
>
>
>
>
> The conflicts originate from the UK map, somewhere above lat 50. Steps to
> reproduce:
>
>
>
> library(rgdal)
>
>  s <- readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")
>
> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% c("UK"),]
>
> # plot(s1)
>
> clip.extent <- as(extent(-10, 19, 36, 53), "SpatialPolygons")
>
> proj4string(clip.extent) <- CRS(proj4string(s))
>
> gI <- gIntersects( s1 , clip.extent , byid = TRUE )
>
> out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] , clip.extent)
> } )
>
>
>
> # But let's look at what is returned
>
> table( sapply( out , class ) )
>
>
>
> # We want to keep only objects of class SpatialPolygons
>
> keep <- sapply(out, class)
>
> out <- out[keep == "SpatialPolygons"]
>
>
>
> # Coerce list back to SpatialPolygons object
>
> UK <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
> slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>
>   Pol
>
> }))
>
> plot( UK )
>
>
>
>
>
> What does this self-intersection means?
>
>
>
>
>
>
>
> Regards,
>
>
>
>
>
> Philippe
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From mtreglia at gmail.com  Wed Dec 17 00:02:53 2014
From: mtreglia at gmail.com (Michael Treglia)
Date: Tue, 16 Dec 2014 17:02:53 -0600
Subject: [R-sig-Geo] Extract with Large Rasters
Message-ID: <CAPKp32vcJ+0WVTZL1mA_NeaqPrSfcFCgsk+=w4i87TPUZ4YHOw@mail.gmail.com>

Hi All,

I'm working with some pretty huge rasters and trying to extract data to
SpatialPointsDataFrames, and running into some issues. I'm using the raster
package for this. (sessionInfo at the end of this e-mail)

Here are the specs of my raster:

class       : RasterLayer
dimensions  : 59901, 49494, 2964740094  (nrow, ncol, ncell)
resolution  : 9.332575, 9.332575  (x, y)
extent      : 222855.6, 684762, 3762092, 4321122  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=15 +datum=WGS84 +units=m +no_defs
+ellps=WGS84 +towgs84=0,0,0
data source :
D:\GIS\Projects\ETynerensis\GISData\n35w092_n39_w096_UTM_cubic.tif
names       : n35w092_n39_w096_UTM_cubic
values      : 0, 837.6777  (min, max)

When I run the following line, with a vector points layer in the same CRS
as the raster, I get the error below.
>points at data <- data.frame(points at data, extract(elev, points)

Error in .readCellsGDAL(x, uniquecells, layers) :
  NAs are not allowed in subscripted assignments
In addition: Warning message:
In .readCells(x, cells, 1) : NAs introduced by coercion

> traceback()
8: .readCellsGDAL(x, uniquecells, layers)
7: .readCells(x, cells, 1)
6: .cellValues(object, cells, layer = layer, nl = nl)
5: .xyValues(x, coordinates(y), ..., df = df)
4: .local(x, y, ...)
3: extract(elev, sdata)
2: extract(elev, sdata)
1: data.frame(sdata at data, extract(elev, sdata))

I had a tough time trouble-shooting from the error, but the raster are huge
(~2x10^9 cells), so I tried to clip a small portion of it and do the
extract, and it worked.

Here's the code I used to Crop:
>bbox <- as(extent(22285.6, 3762091.8, 23285.6, 3862091.8),
'SpatialPolygons')
>y <- crop(elev,bbox)

The data are FLT4S, and as a TIF, take up ~11.5GB. Is this just out of the
bounds for what is feasible? Or is there some trouble-shooting anybody
recommends I do? (Or is there a good way to do this as tiles in R?) And if
there's a way to do this with spatial.tools, I'm open to that, but wasn't
able to figure it out on my own thus far.

Thanks for any suggestions,
Mike T

> sessionInfo()
R version 3.1.2 (2014-10-31)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
States.1252    LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                           LC_TIME=English_United
States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] raster_2.2-31 rgdal_0.8-16  sp_1.0-15

loaded via a namespace (and not attached):
[1] grid_3.1.2      lattice_0.20-29 tools_3.1.2

	[[alternative HTML version deleted]]


From michael.koehler at nw-fva.de  Wed Dec 17 10:51:01 2014
From: michael.koehler at nw-fva.de (Mika)
Date: Wed, 17 Dec 2014 02:51:01 -0700 (MST)
Subject: [R-sig-Geo] Error when using sampleStratified with large
	rasterlayer
In-Reply-To: <54818707.9090906@nw-fva.de>
References: <54818707.9090906@nw-fva.de>
Message-ID: <1418809861201-7587552.post@n2.nabble.com>

The problem has been solved (its a bug in raster)
http://stackoverflow.com/questions/27483130/random-sampling-from-large-rasterlayer





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-when-using-sampleStratified-with-large-rasterlayer-tp7587525p7587552.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mdsumner at gmail.com  Wed Dec 17 11:27:14 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 17 Dec 2014 10:27:14 +0000
Subject: [R-sig-Geo] Extract with Large Rasters
References: <CAPKp32vcJ+0WVTZL1mA_NeaqPrSfcFCgsk+=w4i87TPUZ4YHOw@mail.gmail.com>
Message-ID: <CAAcGz9-XnMdAJG+MrnMX2D2r3jHX2vRjom4+Ub4qUdvX7-z-XQ@mail.gmail.com>

Hello, see response inline.

On Wed Dec 17 2014 at 10:03:23 Michael Treglia <mtreglia at gmail.com> wrote:

> Hi All,
>
> I'm working with some pretty huge rasters and trying to extract data to
> SpatialPointsDataFrames, and running into some issues. I'm using the raster
> package for this. (sessionInfo at the end of this e-mail)
>
> Here are the specs of my raster:
>
> class       : RasterLayer
> dimensions  : 59901, 49494, 2964740094  (nrow, ncol, ncell)
> resolution  : 9.332575, 9.332575  (x, y)
> extent      : 222855.6, 684762, 3762092, 4321122  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=utm +zone=15 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
> data source :
> D:\GIS\Projects\ETynerensis\GISData\n35w092_n39_w096_UTM_cubic.tif
> names       : n35w092_n39_w096_UTM_cubic
> values      : 0, 837.6777  (min, max)
>
> When I run the following line, with a vector points layer in the same CRS
> as the raster, I get the error below.
> >points at data <- data.frame(points at data, extract(elev, points)
>
>
There's a few problems with your code,  you should never use @ for getting
and setting slots, and besides you can assign to the data with $ in the
usual way (the developers do use @ in internal code to provide high level
methods that behave in defined ways). I would do it like this:

library(raster)

## simulate a raster, not large
r <- raster(volcano, crs = "+proj=laea")

## more fake data
pts0 <- xyFromCell(r, sample(ncell(r), 10), sp = TRUE)
pts <- SpatialPointsDataFrame(pts, data.frame(id =
1:nrow(coordinates(pts0))))

## rather than points at data <- etc.
pts$r <- extract(r, pts)

That might help  if the overall points data is large, but you didn't
include that information. You could use print(points) (with raster loaded)
for a succinct summary. (Also points is a commonly used function so best
avoided as a name).


Cheers, Mike.




> Error in .readCellsGDAL(x, uniquecells, layers) :
>   NAs are not allowed in subscripted assignments
> In addition: Warning message:
> In .readCells(x, cells, 1) : NAs introduced by coercion
>
> > traceback()
> 8: .readCellsGDAL(x, uniquecells, layers)
> 7: .readCells(x, cells, 1)
> 6: .cellValues(object, cells, layer = layer, nl = nl)
> 5: .xyValues(x, coordinates(y), ..., df = df)
> 4: .local(x, y, ...)
> 3: extract(elev, sdata)
> 2: extract(elev, sdata)
> 1: data.frame(sdata at data, extract(elev, sdata))
>
> I had a tough time trouble-shooting from the error, but the raster are huge
> (~2x10^9 cells), so I tried to clip a small portion of it and do the
> extract, and it worked.
>
> Here's the code I used to Crop:
> >bbox <- as(extent(22285.6, 3762091.8, 23285.6, 3862091.8),
> 'SpatialPolygons')
> >y <- crop(elev,bbox)
>
> The data are FLT4S, and as a TIF, take up ~11.5GB. Is this just out of the
> bounds for what is feasible? Or is there some trouble-shooting anybody
> recommends I do? (Or is there a good way to do this as tiles in R?) And if
> there's a way to do this with spatial.tools, I'm open to that, but wasn't
> able to figure it out on my own thus far.
>
> Thanks for any suggestions,
> Mike T
>
> > sessionInfo()
> R version 3.1.2 (2014-10-31)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
> States.1252    LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C                           LC_TIME=English_United
> States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] raster_2.2-31 rgdal_0.8-16  sp_1.0-15
>
> loaded via a namespace (and not attached):
> [1] grid_3.1.2      lattice_0.20-29 tools_3.1.2
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From pliege at anisteme.net  Wed Dec 17 11:58:58 2014
From: pliege at anisteme.net (Philippe Liege)
Date: Wed, 17 Dec 2014 11:58:58 +0100
Subject: [R-sig-Geo] gIntersection fails
In-Reply-To: <alpine.LRH.2.03.1412161911210.17094@reclus.nhh.no>
References: <00e801d01945$9f911e30$deb35a90$@anisteme.net>
	<alpine.LRH.2.03.1412161911210.17094@reclus.nhh.no>
Message-ID: <005001d019e8$76039e00$620ada00$@anisteme.net>

Roger,

Thanks for your detailed answer. Sure it helps!

I have projected the SpatialPolygonsDataFrame object to planar coordinates
using etrs89/etrs-laea, and it works fine now.

The Eurostat website has been redesigned and links to publically available
reference data have not yet been updated in Google. The datasets for EU
Administrative Units/Statistical Units (the so-called NUTS files) can be
found here:
http://ec.europa.eu/eurostat/c/portal/layout?p_l_id=6033084&p_v_l_s_g_id=0

And the file I was referring to in my previous e-mail can be downloaded
from:
http://ec.europa.eu/eurostat/cache/GISCO/geodatafiles/NUTS_2010_10M_SH.zip

library(rgdal)
library(RColorBrewer)
library(raster)
library(rgeos)
s <- readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")
s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in%
c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK"),]
#  ETRS89 / ETRS-LAEA
# as in: http://spatialreference.org/ref/epsg/3035/proj4/
proj.laea <- CRS("+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
+ellps=GRS80 +units=m +no_defs")
s1.laea <-spTransform(s1,proj.laea)
summary(s1.laea)
clip.extent <- as(extent(2.5e6, +5e6, 1.5e6, 4.1e6), "SpatialPolygons")
proj4string(clip.extent) <- CRS(proj4string(s1.laea))
EuropeW <- gIntersection(s1.laea, clip.extent, byid=c(TRUE, FALSE))
plot(EuropeW,col=brewer.pal(10,"Set3"))


 Regards,

Philippe







-----Message d'origine-----
De?: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Envoy??: mardi 16 d?cembre 2014 19:36
??: Philippe Liege
Cc?: r-sig-geo at r-project.org
Objet?: Re: [R-sig-Geo] gIntersection fails

Please never post HTML, only plain text.

Always include a link to data, but not this data, as this requires
acceptance of conditions to download, so is not automatic.

Note that the SO posting you quote was from April 2013 - it is always
important to give your sessionInfo() output, as how things work changes over
time, leaving legacy advice stale. Your results might match the SO ones if
your platform is the same as that was then. In particular, the:

http://cran.r-project.org/web/packages/rgeos/ChangeLog

entry for 2014-02-08 indicates that non-polygon output from polygon
intersections is now handled more gracefully.

The underlying problem may be that these coordinates are geographical, not
projected, and the integer discretisation used by GEOS is failing for some
input - have you tried projecting to planar coordinates in a different
metric and doing the same operation? Or using setScale()?

For my 20M 2006:

library(rgdal)
s <- readOGR('.', layer="NUTS_RG_20M_2006")
s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in%
c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]
library(raster)
clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")
proj4string(clip.extent) <- CRS(proj4string(s)) EuropeW <- gIntersection(s1,
clip.extent, byid=c(TRUE, FALSE))
plot(EuropeW)

just works.

Hope this clarifies,

Roger

PS:

> sessionInfo()
R version 3.1.2 (2014-10-31)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C
  [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8
  [5] LC_MONETARY=en_US.utf8    LC_MESSAGES=en_US.utf8
  [7] LC_PAPER=en_US.utf8       LC_NAME=C
  [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgeos_0.3-8   raster_2.3-12 rgdal_0.9-1   sp_1.0-16

loaded via a namespace (and not attached):
[1] grid_3.1.2      lattice_0.20-29
> version_GEOS()
[1] "3.4.2-CAPI-1.8.2 r3921"


On Tue, 16 Dec 2014, Philippe Liege wrote:

> Hello,
>
>
>
> I'm looking to clip the Europe map after reading this post:
>
> http://stackoverflow.com/questions/15881455/how-to-clip-worldmap-with-
> polygo
> n-in-r
>
>
>
> The procedure in running fine when using the shape file 
> NUTS_RG_60M_2010.shp
>
>
>
> library(rgdal)
>
> s <- readOGR('NUTS_2010_60M_SH/data', layer="NUTS_RG_60M_2010")
>
> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% 
> c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]
>
> # plot(s1)
>
> clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")
>
> # clip.extent <- as(extent(-10, 40, 60, 72), "SpatialPolygons")
>
> proj4string(clip.extent) <- CRS(proj4string(s))
>
> gI <- gIntersects( s1 , clip.extent , byid = TRUE )
>
> out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] , 
> clip.extent) } )
>
>
>
> # But let's look at what is returned
>
> table( sapply( out , class ) )
>
>
>
> # We want to keep only objects of class SpatialPolygons
>
> keep <- sapply(out, class)
>
> out <- out[keep == "SpatialPolygons"]
>
>
>
> # Coerce list back to SpatialPolygons object
>
> EuropeW <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
> slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>
>   Pol
>
> }))
>
> plot( EuropeW )
>
>
>
>
>
>
>
> However I'm getting an error when using the shape files 
> NUTS_RG_10M_2010.shp or NUTS_RG_03M_2010.shp
>
>
>
> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
> "rgeos_intersection"): TopologyException: Input geom 0 is invalid:
> Self-intersection at or near point 0.68803650000000005 51.7317125 at
> 0.68803650000000005 51.7317125
>
>
>
>
>
> The conflicts originate from the UK map, somewhere above lat 50. Steps 
> to
> reproduce:
>
>
>
> library(rgdal)
>
>  s <- readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")
>
> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% c("UK"),]
>
> # plot(s1)
>
> clip.extent <- as(extent(-10, 19, 36, 53), "SpatialPolygons")
>
> proj4string(clip.extent) <- CRS(proj4string(s))
>
> gI <- gIntersects( s1 , clip.extent , byid = TRUE )
>
> out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] , 
> clip.extent) } )
>
>
>
> # But let's look at what is returned
>
> table( sapply( out , class ) )
>
>
>
> # We want to keep only objects of class SpatialPolygons
>
> keep <- sapply(out, class)
>
> out <- out[keep == "SpatialPolygons"]
>
>
>
> # Coerce list back to SpatialPolygons object
>
> UK <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
> slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>
>   Pol
>
> }))
>
> plot( UK )
>
>
>
>
>
> What does this self-intersection means?
>
>
>
>
>
>
>
> Regards,
>
>
>
>
>
> Philippe
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30,
N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Wed Dec 17 13:18:44 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 17 Dec 2014 13:18:44 +0100
Subject: [R-sig-Geo] gIntersection fails
In-Reply-To: <005001d019e8$76039e00$620ada00$@anisteme.net>
References: <00e801d01945$9f911e30$deb35a90$@anisteme.net>
	<alpine.LRH.2.03.1412161911210.17094@reclus.nhh.no>
	<005001d019e8$76039e00$620ada00$@anisteme.net>
Message-ID: <alpine.LRH.2.03.1412171309140.20012@reclus.nhh.no>

On Wed, 17 Dec 2014, Philippe Liege wrote:

> Roger,
>
> Thanks for your detailed answer. Sure it helps!
>
> I have projected the SpatialPolygonsDataFrame object to planar coordinates
> using etrs89/etrs-laea, and it works fine now.
>
> The Eurostat website has been redesigned and links to publically available
> reference data have not yet been updated in Google. The datasets for EU
> Administrative Units/Statistical Units (the so-called NUTS files) can be
> found here:
> http://ec.europa.eu/eurostat/c/portal/layout?p_l_id=6033084&p_v_l_s_g_id=0
>
> And the file I was referring to in my previous e-mail can be downloaded
> from:
> http://ec.europa.eu/eurostat/cache/GISCO/geodatafiles/NUTS_2010_10M_SH.zip

OK, thanks for this. The resolution is either as you chose, or:

ce_ll <- spTransform(clip.extent, CRS(proj4string(s1)))
oS <- getScale()
oS
# [1] 1e+08
EuropeW <- gIntersection(s1, ce_ll, byid=c(TRUE, FALSE))
# Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td, 
# "rgeos_intersection") :
#   TopologyException: Input geom 0 is invalid: Self-intersection at or 
# near point 10.648729489383225 57.7454124997018 at 10.648729489383225 
# 57.7454124997018
setScale(1e+9)
EuropeW <- gIntersection(s1, ce_ll, byid=c(TRUE, FALSE))
# OK
setScale(oS)

One has to find the appropriate scale manually in such cases, curiously 
setScale(1e+7) also works, but for geographical coordinates one probably 
wants to increase rather than decrease.

Roger

(I'm assuming that NL hasn't been flooded?)

>
> library(rgdal)
> library(RColorBrewer)
> library(raster)
> library(rgeos)
> s <- readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")
> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in%
> c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK"),]
> #  ETRS89 / ETRS-LAEA
> # as in: http://spatialreference.org/ref/epsg/3035/proj4/
> proj.laea <- CRS("+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
> +ellps=GRS80 +units=m +no_defs")
> s1.laea <-spTransform(s1,proj.laea)
> summary(s1.laea)
> clip.extent <- as(extent(2.5e6, +5e6, 1.5e6, 4.1e6), "SpatialPolygons")
> proj4string(clip.extent) <- CRS(proj4string(s1.laea))
> EuropeW <- gIntersection(s1.laea, clip.extent, byid=c(TRUE, FALSE))
> plot(EuropeW,col=brewer.pal(10,"Set3"))
>
>
> Regards,
>
> Philippe
>
>
>
>
>
>
>
> -----Message d'origine-----
> De?: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Envoy??: mardi 16 d?cembre 2014 19:36
> ??: Philippe Liege
> Cc?: r-sig-geo at r-project.org
> Objet?: Re: [R-sig-Geo] gIntersection fails
>
> Please never post HTML, only plain text.
>
> Always include a link to data, but not this data, as this requires
> acceptance of conditions to download, so is not automatic.
>
> Note that the SO posting you quote was from April 2013 - it is always
> important to give your sessionInfo() output, as how things work changes over
> time, leaving legacy advice stale. Your results might match the SO ones if
> your platform is the same as that was then. In particular, the:
>
> http://cran.r-project.org/web/packages/rgeos/ChangeLog
>
> entry for 2014-02-08 indicates that non-polygon output from polygon
> intersections is now handled more gracefully.
>
> The underlying problem may be that these coordinates are geographical, not
> projected, and the integer discretisation used by GEOS is failing for some
> input - have you tried projecting to planar coordinates in a different
> metric and doing the same operation? Or using setScale()?
>
> For my 20M 2006:
>
> library(rgdal)
> s <- readOGR('.', layer="NUTS_RG_20M_2006")
> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in%
> c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]
> library(raster)
> clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")
> proj4string(clip.extent) <- CRS(proj4string(s)) EuropeW <- gIntersection(s1,
> clip.extent, byid=c(TRUE, FALSE))
> plot(EuropeW)
>
> just works.
>
> Hope this clarifies,
>
> Roger
>
> PS:
>
>> sessionInfo()
> R version 3.1.2 (2014-10-31)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8
>  [5] LC_MONETARY=en_US.utf8    LC_MESSAGES=en_US.utf8
>  [7] LC_PAPER=en_US.utf8       LC_NAME=C
>  [9] LC_ADDRESS=C              LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgeos_0.3-8   raster_2.3-12 rgdal_0.9-1   sp_1.0-16
>
> loaded via a namespace (and not attached):
> [1] grid_3.1.2      lattice_0.20-29
>> version_GEOS()
> [1] "3.4.2-CAPI-1.8.2 r3921"
>
>
> On Tue, 16 Dec 2014, Philippe Liege wrote:
>
>> Hello,
>>
>>
>>
>> I'm looking to clip the Europe map after reading this post:
>>
>> http://stackoverflow.com/questions/15881455/how-to-clip-worldmap-with-
>> polygo
>> n-in-r
>>
>>
>>
>> The procedure in running fine when using the shape file
>> NUTS_RG_60M_2010.shp
>>
>>
>>
>> library(rgdal)
>>
>> s <- readOGR('NUTS_2010_60M_SH/data', layer="NUTS_RG_60M_2010")
>>
>> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in%
>> c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]
>>
>> # plot(s1)
>>
>> clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")
>>
>> # clip.extent <- as(extent(-10, 40, 60, 72), "SpatialPolygons")
>>
>> proj4string(clip.extent) <- CRS(proj4string(s))
>>
>> gI <- gIntersects( s1 , clip.extent , byid = TRUE )
>>
>> out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] ,
>> clip.extent) } )
>>
>>
>>
>> # But let's look at what is returned
>>
>> table( sapply( out , class ) )
>>
>>
>>
>> # We want to keep only objects of class SpatialPolygons
>>
>> keep <- sapply(out, class)
>>
>> out <- out[keep == "SpatialPolygons"]
>>
>>
>>
>> # Coerce list back to SpatialPolygons object
>>
>> EuropeW <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
>> slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>>
>>   Pol
>>
>> }))
>>
>> plot( EuropeW )
>>
>>
>>
>>
>>
>>
>>
>> However I'm getting an error when using the shape files
>> NUTS_RG_10M_2010.shp or NUTS_RG_03M_2010.shp
>>
>>
>>
>> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
>> "rgeos_intersection"): TopologyException: Input geom 0 is invalid:
>> Self-intersection at or near point 0.68803650000000005 51.7317125 at
>> 0.68803650000000005 51.7317125
>>
>>
>>
>>
>>
>> The conflicts originate from the UK map, somewhere above lat 50. Steps
>> to
>> reproduce:
>>
>>
>>
>> library(rgdal)
>>
>>  s <- readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")
>>
>> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% c("UK"),]
>>
>> # plot(s1)
>>
>> clip.extent <- as(extent(-10, 19, 36, 53), "SpatialPolygons")
>>
>> proj4string(clip.extent) <- CRS(proj4string(s))
>>
>> gI <- gIntersects( s1 , clip.extent , byid = TRUE )
>>
>> out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] ,
>> clip.extent) } )
>>
>>
>>
>> # But let's look at what is returned
>>
>> table( sapply( out , class ) )
>>
>>
>>
>> # We want to keep only objects of class SpatialPolygons
>>
>> keep <- sapply(out, class)
>>
>> out <- out[keep == "SpatialPolygons"]
>>
>>
>>
>> # Coerce list back to SpatialPolygons object
>>
>> UK <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
>> slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>>
>>   Pol
>>
>> }))
>>
>> plot( UK )
>>
>>
>>
>>
>>
>> What does this self-intersection means?
>>
>>
>>
>>
>>
>>
>>
>> Regards,
>>
>>
>>
>>
>>
>> Philippe
>>
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Helleveien 30,
> N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From pliege at anisteme.net  Wed Dec 17 16:31:24 2014
From: pliege at anisteme.net (Philippe Liege)
Date: Wed, 17 Dec 2014 16:31:24 +0100
Subject: [R-sig-Geo] gIntersection fails
In-Reply-To: <alpine.LRH.2.03.1412171309140.20012@reclus.nhh.no>
References: <00e801d01945$9f911e30$deb35a90$@anisteme.net>
	<alpine.LRH.2.03.1412161911210.17094@reclus.nhh.no>
	<005001d019e8$76039e00$620ada00$@anisteme.net>
	<alpine.LRH.2.03.1412171309140.20012@reclus.nhh.no>
Message-ID: <009301d01a0e$84d4fe80$8e7efb80$@anisteme.net>

> One has to find the appropriate scale manually in such cases, 
> curiously

I have no idea to generate the scale programmatically. 
Well, the EuroStat dataset goes up to French Guiana to the west, then to
Reunion Island to the South etc. It is deprived of any index to identify
those overseas regions.
Either we create a new index of we clip the area to be plotted. In both
cases we have to manually retrieve the extreme points of this area. In the
present case, one can start from "Cabo de Roca" in Portugal etc. A much
simple solution might be to exclude France, Spain and Portugal from the EU
and plot the remaining countries...

I slightly changed the script so that the outcome sp object is now of class
SpatialPolygonsDataFrame.

I couldn't find out Andorra in the Eurostat dataset. No NUTS_ID starting
with AD.


library(rgdal)
library(RColorBrewer)
library(raster)
library(rgeos)
s <- readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")
s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in%
c("BE","CH","DE","DK","ES","IE","FR","IT","LU","NL","PT","UK"),]
#  ETRS89 / ETRS-LAEA
# as in: http://spatialreference.org/ref/epsg/3035/proj4/
proj.laea <- CRS("+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
+ellps=GRS80 +units=m +no_defs")
s1.laea <- spTransform(s1,proj.laea)
summary(s1.laea)
#clip.extent <- as(extent(2.5e6, +5e6, 1.5e6, 4.1e6), "SpatialPolygons")
# proj4string(clip.extent) <- CRS(proj4string(s1.laea))
clip.extent <- as(extent(-10, 19, 35, 59), "SpatialPolygons")
proj4string(clip.extent) <- CRS(proj4string(s1))
clip.extent <- spTransform(clip.extent,proj.laea)
summary(clip.extent)
EuropeW <- gIntersection(s1.laea, clip.extent, byid=c(TRUE, FALSE))
# side effect: the data frale is removed
# You may need a SpatialPolygonDataFrame for future use
EuropeW <- s1.laea[sapply(slot(s1.laea,"polygons"),slot,"ID") %in%
sapply(slot(EuropeW,"polygons"),slot,"ID"),]
EuropeW$NUTS_ID <- EuropeW$NUTS_ID[drop=T]
plot(EuropeW,col=brewer.pal(10,"Set3"))
plot(EuropeW,col=brewer.pal(12,"Set3")[as.factor(substring(EuropeWdf$NUTS_ID
,1,2))])

-----Message d'origine-----
De?: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Envoy??: mercredi 17 d?cembre 2014 13:19
??: Philippe Liege
Cc?: r-sig-geo at r-project.org
Objet?: RE: [R-sig-Geo] gIntersection fails

On Wed, 17 Dec 2014, Philippe Liege wrote:

> Roger,
>
> Thanks for your detailed answer. Sure it helps!
>
> I have projected the SpatialPolygonsDataFrame object to planar 
> coordinates using etrs89/etrs-laea, and it works fine now.
>
> The Eurostat website has been redesigned and links to publically 
> available reference data have not yet been updated in Google. The 
> datasets for EU Administrative Units/Statistical Units (the so-called 
> NUTS files) can be found here:
> http://ec.europa.eu/eurostat/c/portal/layout?p_l_id=6033084&p_v_l_s_g_
> id=0
>
> And the file I was referring to in my previous e-mail can be 
> downloaded
> from:
> http://ec.europa.eu/eurostat/cache/GISCO/geodatafiles/NUTS_2010_10M_SH
> .zip

OK, thanks for this. The resolution is either as you chose, or:

ce_ll <- spTransform(clip.extent, CRS(proj4string(s1))) oS <- getScale() oS
# [1] 1e+08 EuropeW <- gIntersection(s1, ce_ll, byid=c(TRUE, FALSE)) # Error
in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td, #
"rgeos_intersection") :
#   TopologyException: Input geom 0 is invalid: Self-intersection at or 
# near point 10.648729489383225 57.7454124997018 at 10.648729489383225 #
57.7454124997018
setScale(1e+9)
EuropeW <- gIntersection(s1, ce_ll, byid=c(TRUE, FALSE)) # OK
setScale(oS)

One has to find the appropriate scale manually in such cases, curiously
setScale(1e+7) also works, but for geographical coordinates one probably
wants to increase rather than decrease.

Roger

(I'm assuming that NL hasn't been flooded?)

>
> library(rgdal)
> library(RColorBrewer)
> library(raster)
> library(rgeos)
> s <- readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")
> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% 
> c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK"),]
> #  ETRS89 / ETRS-LAEA
> # as in: http://spatialreference.org/ref/epsg/3035/proj4/
> proj.laea <- CRS("+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 
> +y_0=3210000
> +ellps=GRS80 +units=m +no_defs")
> s1.laea <-spTransform(s1,proj.laea)
> summary(s1.laea)
> clip.extent <- as(extent(2.5e6, +5e6, 1.5e6, 4.1e6), 
> "SpatialPolygons")
> proj4string(clip.extent) <- CRS(proj4string(s1.laea)) EuropeW <- 
> gIntersection(s1.laea, clip.extent, byid=c(TRUE, FALSE))
> plot(EuropeW,col=brewer.pal(10,"Set3"))
>
>
> Regards,
>
> Philippe
>
>
>
>
>
>
>
> -----Message d'origine-----
> De?: Roger Bivand [mailto:Roger.Bivand at nhh.no] Envoy??: mardi 16 
> d?cembre 2014 19:36 ??: Philippe Liege Cc?: r-sig-geo at r-project.org 
> Objet?: Re: [R-sig-Geo] gIntersection fails
>
> Please never post HTML, only plain text.
>
> Always include a link to data, but not this data, as this requires 
> acceptance of conditions to download, so is not automatic.
>
> Note that the SO posting you quote was from April 2013 - it is always 
> important to give your sessionInfo() output, as how things work 
> changes over time, leaving legacy advice stale. Your results might 
> match the SO ones if your platform is the same as that was then. In
particular, the:
>
> http://cran.r-project.org/web/packages/rgeos/ChangeLog
>
> entry for 2014-02-08 indicates that non-polygon output from polygon 
> intersections is now handled more gracefully.
>
> The underlying problem may be that these coordinates are geographical, 
> not projected, and the integer discretisation used by GEOS is failing 
> for some input - have you tried projecting to planar coordinates in a 
> different metric and doing the same operation? Or using setScale()?
>
> For my 20M 2006:
>
> library(rgdal)
> s <- readOGR('.', layer="NUTS_RG_20M_2006")
> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% 
> c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]
> library(raster)
> clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")
> proj4string(clip.extent) <- CRS(proj4string(s)) EuropeW <- 
> gIntersection(s1, clip.extent, byid=c(TRUE, FALSE))
> plot(EuropeW)
>
> just works.
>
> Hope this clarifies,
>
> Roger
>
> PS:
>
>> sessionInfo()
> R version 3.1.2 (2014-10-31)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8
>  [5] LC_MONETARY=en_US.utf8    LC_MESSAGES=en_US.utf8
>  [7] LC_PAPER=en_US.utf8       LC_NAME=C
>  [9] LC_ADDRESS=C              LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgeos_0.3-8   raster_2.3-12 rgdal_0.9-1   sp_1.0-16
>
> loaded via a namespace (and not attached):
> [1] grid_3.1.2      lattice_0.20-29
>> version_GEOS()
> [1] "3.4.2-CAPI-1.8.2 r3921"
>
>
> On Tue, 16 Dec 2014, Philippe Liege wrote:
>
>> Hello,
>>
>>
>>
>> I'm looking to clip the Europe map after reading this post:
>>
>> http://stackoverflow.com/questions/15881455/how-to-clip-worldmap-with
>> -
>> polygo
>> n-in-r
>>
>>
>>
>> The procedure in running fine when using the shape file 
>> NUTS_RG_60M_2010.shp
>>
>>
>>
>> library(rgdal)
>>
>> s <- readOGR('NUTS_2010_60M_SH/data', layer="NUTS_RG_60M_2010")
>>
>> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% 
>> c("FR","BE","ES","IT","PT","DE","CH","UK","IE","DK","AT"),]
>>
>> # plot(s1)
>>
>> clip.extent <- as(extent(-10, 19, 36, 51), "SpatialPolygons")
>>
>> # clip.extent <- as(extent(-10, 40, 60, 72), "SpatialPolygons")
>>
>> proj4string(clip.extent) <- CRS(proj4string(s))
>>
>> gI <- gIntersects( s1 , clip.extent , byid = TRUE )
>>
>> out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] ,
>> clip.extent) } )
>>
>>
>>
>> # But let's look at what is returned
>>
>> table( sapply( out , class ) )
>>
>>
>>
>> # We want to keep only objects of class SpatialPolygons
>>
>> keep <- sapply(out, class)
>>
>> out <- out[keep == "SpatialPolygons"]
>>
>>
>>
>> # Coerce list back to SpatialPolygons object
>>
>> EuropeW <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol
<-
>> slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>>
>>   Pol
>>
>> }))
>>
>> plot( EuropeW )
>>
>>
>>
>>
>>
>>
>>
>> However I'm getting an error when using the shape files 
>> NUTS_RG_10M_2010.shp or NUTS_RG_03M_2010.shp
>>
>>
>>
>> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
>> "rgeos_intersection"): TopologyException: Input geom 0 is invalid:
>> Self-intersection at or near point 0.68803650000000005 51.7317125 at
>> 0.68803650000000005 51.7317125
>>
>>
>>
>>
>>
>> The conflicts originate from the UK map, somewhere above lat 50. 
>> Steps to
>> reproduce:
>>
>>
>>
>> library(rgdal)
>>
>>  s <- 
>> readOGR('EUmaps/NUTS_2010_10M_SH/data',layer="NUTS_RG_10M_2010")
>>
>> s1 <- s[s$STAT_LEVL_==2 & substring(s$NUTS_ID,1,2) %in% c("UK"),]
>>
>> # plot(s1)
>>
>> clip.extent <- as(extent(-10, 19, 36, 53), "SpatialPolygons")
>>
>> proj4string(clip.extent) <- CRS(proj4string(s))
>>
>> gI <- gIntersects( s1 , clip.extent , byid = TRUE )
>>
>> out <- lapply( which(gI) , function(x){ gIntersection( s1[x,] ,
>> clip.extent) } )
>>
>>
>>
>> # But let's look at what is returned
>>
>> table( sapply( out , class ) )
>>
>>
>>
>> # We want to keep only objects of class SpatialPolygons
>>
>> keep <- sapply(out, class)
>>
>> out <- out[keep == "SpatialPolygons"]
>>
>>
>>
>> # Coerce list back to SpatialPolygons object
>>
>> UK <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <-
>> slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>>
>>   Pol
>>
>> }))
>>
>> plot( UK )
>>
>>
>>
>>
>>
>> What does this self-intersection means?
>>
>>
>>
>>
>>
>>
>>
>> Regards,
>>
>>
>>
>>
>>
>> Philippe
>>
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Helleveien 30,
> N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30,
N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Wed Dec 17 21:06:12 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 17 Dec 2014 12:06:12 -0800
Subject: [R-sig-Geo] Extract with Large Rasters
In-Reply-To: <CAAcGz9-XnMdAJG+MrnMX2D2r3jHX2vRjom4+Ub4qUdvX7-z-XQ@mail.gmail.com>
References: <CAPKp32vcJ+0WVTZL1mA_NeaqPrSfcFCgsk+=w4i87TPUZ4YHOw@mail.gmail.com>
	<CAAcGz9-XnMdAJG+MrnMX2D2r3jHX2vRjom4+Ub4qUdvX7-z-XQ@mail.gmail.com>
Message-ID: <CANtt_hypODXRs3zgjdQnkWKKsxAXPBWOdqjD0Mbm76qoMXypeA@mail.gmail.com>

>From the traceback

8: .readCellsGDAL(x, uniquecells, layers)

it seems to me that the error occurs here:

extract(elev, points)

and that it has nothing to do with the size of the raster.  I am not
sure what causes it.
Could you perhaps email me the points?

Thanks, Robert


On Wed, Dec 17, 2014 at 2:27 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> Hello, see response inline.
>
> On Wed Dec 17 2014 at 10:03:23 Michael Treglia <mtreglia at gmail.com> wrote:
>
>> Hi All,
>>
>> I'm working with some pretty huge rasters and trying to extract data to
>> SpatialPointsDataFrames, and running into some issues. I'm using the raster
>> package for this. (sessionInfo at the end of this e-mail)
>>
>> Here are the specs of my raster:
>>
>> class       : RasterLayer
>> dimensions  : 59901, 49494, 2964740094  (nrow, ncol, ncell)
>> resolution  : 9.332575, 9.332575  (x, y)
>> extent      : 222855.6, 684762, 3762092, 4321122  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=utm +zone=15 +datum=WGS84 +units=m +no_defs
>> +ellps=WGS84 +towgs84=0,0,0
>> data source :
>> D:\GIS\Projects\ETynerensis\GISData\n35w092_n39_w096_UTM_cubic.tif
>> names       : n35w092_n39_w096_UTM_cubic
>> values      : 0, 837.6777  (min, max)
>>
>> When I run the following line, with a vector points layer in the same CRS
>> as the raster, I get the error below.
>> >points at data <- data.frame(points at data, extract(elev, points)
>>
>>
> There's a few problems with your code,  you should never use @ for getting
> and setting slots, and besides you can assign to the data with $ in the
> usual way (the developers do use @ in internal code to provide high level
> methods that behave in defined ways). I would do it like this:
>
> library(raster)
>
> ## simulate a raster, not large
> r <- raster(volcano, crs = "+proj=laea")
>
> ## more fake data
> pts0 <- xyFromCell(r, sample(ncell(r), 10), sp = TRUE)
> pts <- SpatialPointsDataFrame(pts, data.frame(id =
> 1:nrow(coordinates(pts0))))
>
> ## rather than points at data <- etc.
> pts$r <- extract(r, pts)
>
> That might help  if the overall points data is large, but you didn't
> include that information. You could use print(points) (with raster loaded)
> for a succinct summary. (Also points is a commonly used function so best
> avoided as a name).
>
>
> Cheers, Mike.
>
>
>
>
>> Error in .readCellsGDAL(x, uniquecells, layers) :
>>   NAs are not allowed in subscripted assignments
>> In addition: Warning message:
>> In .readCells(x, cells, 1) : NAs introduced by coercion
>>
>> > traceback()
>> 8: .readCellsGDAL(x, uniquecells, layers)
>> 7: .readCells(x, cells, 1)
>> 6: .cellValues(object, cells, layer = layer, nl = nl)
>> 5: .xyValues(x, coordinates(y), ..., df = df)
>> 4: .local(x, y, ...)
>> 3: extract(elev, sdata)
>> 2: extract(elev, sdata)
>> 1: data.frame(sdata at data, extract(elev, sdata))
>>
>> I had a tough time trouble-shooting from the error, but the raster are huge
>> (~2x10^9 cells), so I tried to clip a small portion of it and do the
>> extract, and it worked.
>>
>> Here's the code I used to Crop:
>> >bbox <- as(extent(22285.6, 3762091.8, 23285.6, 3862091.8),
>> 'SpatialPolygons')
>> >y <- crop(elev,bbox)
>>
>> The data are FLT4S, and as a TIF, take up ~11.5GB. Is this just out of the
>> bounds for what is feasible? Or is there some trouble-shooting anybody
>> recommends I do? (Or is there a good way to do this as tiles in R?) And if
>> there's a way to do this with spatial.tools, I'm open to that, but wasn't
>> able to figure it out on my own thus far.
>>
>> Thanks for any suggestions,
>> Mike T
>>
>> > sessionInfo()
>> R version 3.1.2 (2014-10-31)
>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
>> States.1252    LC_MONETARY=English_United States.1252
>> [4] LC_NUMERIC=C                           LC_TIME=English_United
>> States.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] raster_2.2-31 rgdal_0.8-16  sp_1.0-15
>>
>> loaded via a namespace (and not attached):
>> [1] grid_3.1.2      lattice_0.20-29 tools_3.1.2
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From rplatt at gettysburg.edu  Thu Dec 18 16:44:54 2014
From: rplatt at gettysburg.edu (Rutherford Platt)
Date: Thu, 18 Dec 2014 15:44:54 +0000
Subject: [R-sig-Geo] gdal19.dll is missing from your computer
Message-ID: <47297903EAC29341B8399B24D2DB968270E7ED7B@exacd10.ms.gettysburg.edu>

Hello,

I'm a relatively new user, so bear with me.

I'm using a Windows 7 computer and R 3.1.   I wrote some scripts back in August that worked perfectly.  Now, when the script reaches 'require(rgdal)' I get several error messages in a row that say: "The program can't start because gdal19.dll is missing from your computer.  Try reinstalling the program to fix this problem"

I then get the following output:
Loading required package: rgdal
Loading required package: sp
rgdal: version: 0.8-16, (SVN revision 498)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.11.0, released 2014/04/16
Path to GDAL shared files: C:/Users/rplatt.GETTYSBURG/Documents/R/win-library/3.1/rgdal/gdal
GDAL does not use iconv for recoding strings.
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files: C:/Users/rplatt.GETTYSBURG/Documents/R/win-library/3.1/rgdal/proj

It seems like rgdal may have successfully installed, so why do I get all these error messages?  And how can I get rid of them?

Thanks!

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Thu Dec 18 19:54:08 2014
From: mtreglia at gmail.com (Michael Treglia)
Date: Thu, 18 Dec 2014 12:54:08 -0600
Subject: [R-sig-Geo] Extract with Large Rasters
In-Reply-To: <CANtt_hypODXRs3zgjdQnkWKKsxAXPBWOdqjD0Mbm76qoMXypeA@mail.gmail.com>
References: <CAPKp32vcJ+0WVTZL1mA_NeaqPrSfcFCgsk+=w4i87TPUZ4YHOw@mail.gmail.com>
	<CAAcGz9-XnMdAJG+MrnMX2D2r3jHX2vRjom4+Ub4qUdvX7-z-XQ@mail.gmail.com>
	<CANtt_hypODXRs3zgjdQnkWKKsxAXPBWOdqjD0Mbm76qoMXypeA@mail.gmail.com>
Message-ID: <CAPKp32sxQBhYRryHStrJahOtbFXa2mem6Ov-LNSgbFPw+yAS7Q@mail.gmail.com>

Thanks Mike and Robert,

Avoiding using @ didn't seem to help this problem. Also, I can do the
extract using the same exact points with different rasters (e.g., Bioclim
variables or a coarser DEM), so it doesn't seem to be a problem with the
points [Robert, if you still think they might pose an issue, let me know
and I'll send them off-list; I've included the specs of the points below
too though].

I realized I could clip the raster a bit and did so in with gdalwarp
(outside of R), and the extract worked without issue. I'm still curious to
figure out why it won't work with the original raster file though and I'm
all ears for suggestions, in case it can save me or others some trouble in
the future

Also, the reason I was using the @ was because I am ultimately doing this
for a stack of rasters, and would like to have all the raster fields added
to the SpatialPointsDataFrame. Is there a more preferred way to do that? I
see that if you do a hypothetical
>pts$field <- extract(stack, pts)
you get the values from the whole stack, but the columns have the prefix of
'field'.  (I realize you can just rename columns after doing the extract)

Here's are the specs of the clipped Raster (for which the extract() works):
class       : RasterLayer
dimensions  : 35410, 39925, 1413744250  (nrow, ncol, ncell)
resolution  : 9.332523, 9.332448  (x, y)
extent      : 273952, 646553, 3885751, 4216213  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=15 +datum=WGS84 +units=m +no_defs
+ellps=WGS84 +towgs84=0,0,0
data source : D:\GISData\Clipped_10mDEM.tif
names       : Clipped_10mDEM

Here are the specs of the original (for which the extract() doesn't work):
class       : RasterLayer
dimensions  : 59901, 49494, 2964740094  (nrow, ncol, ncell)
resolution  : 9.332575, 9.332575  (x, y)
extent      : 222855.6, 684762, 3762092, 4321122  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=15 +datum=WGS84 +units=m +no_defs
+ellps=WGS84 +towgs84=0,0,0
data source : D:\GISData\n35w092_n39_w096_UTM_cubic.tif
names       : n35w092_n39_w096_UTM_cubic

Here are the Specs of the Points [excluding field names and max/min values]:
class       : SpatialPointsDataFrame
features    : 159
extent      : 300852.6, 611979.9, 3910111, 4196814  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=15 +datum=WGS84 +units=m +no_defs
+ellps=WGS84 +towgs84=0,0,0
variables   : 16

Thanks again!
Mike T





On Wed, Dec 17, 2014 at 2:06 PM, Robert J. Hijmans <r.hijmans at gmail.com>
wrote:
>
> From the traceback
>
> 8: .readCellsGDAL(x, uniquecells, layers)
>
> it seems to me that the error occurs here:
>
> extract(elev, points)
>
> and that it has nothing to do with the size of the raster.  I am not
> sure what causes it.
> Could you perhaps email me the points?
>
> Thanks, Robert
>
>
> On Wed, Dec 17, 2014 at 2:27 AM, Michael Sumner <mdsumner at gmail.com>
> wrote:
> > Hello, see response inline.
> >
> > On Wed Dec 17 2014 at 10:03:23 Michael Treglia <mtreglia at gmail.com>
> wrote:
> >
> >> Hi All,
> >>
> >> I'm working with some pretty huge rasters and trying to extract data to
> >> SpatialPointsDataFrames, and running into some issues. I'm using the
> raster
> >> package for this. (sessionInfo at the end of this e-mail)
> >>
> >> Here are the specs of my raster:
> >>
> >> class       : RasterLayer
> >> dimensions  : 59901, 49494, 2964740094  (nrow, ncol, ncell)
> >> resolution  : 9.332575, 9.332575  (x, y)
> >> extent      : 222855.6, 684762, 3762092, 4321122  (xmin, xmax, ymin,
> ymax)
> >> coord. ref. : +proj=utm +zone=15 +datum=WGS84 +units=m +no_defs
> >> +ellps=WGS84 +towgs84=0,0,0
> >> data source :
> >> D:\GIS\Projects\ETynerensis\GISData\n35w092_n39_w096_UTM_cubic.tif
> >> names       : n35w092_n39_w096_UTM_cubic
> >> values      : 0, 837.6777  (min, max)
> >>
> >> When I run the following line, with a vector points layer in the same
> CRS
> >> as the raster, I get the error below.
> >> >points at data <- data.frame(points at data, extract(elev, points)
> >>
> >>
> > There's a few problems with your code,  you should never use @ for
> getting
> > and setting slots, and besides you can assign to the data with $ in the
> > usual way (the developers do use @ in internal code to provide high level
> > methods that behave in defined ways). I would do it like this:
> >
> > library(raster)
> >
> > ## simulate a raster, not large
> > r <- raster(volcano, crs = "+proj=laea")
> >
> > ## more fake data
> > pts0 <- xyFromCell(r, sample(ncell(r), 10), sp = TRUE)
> > pts <- SpatialPointsDataFrame(pts, data.frame(id =
> > 1:nrow(coordinates(pts0))))
> >
> > ## rather than points at data <- etc.
> > pts$r <- extract(r, pts)
> >
> > That might help  if the overall points data is large, but you didn't
> > include that information. You could use print(points) (with raster
> loaded)
> > for a succinct summary. (Also points is a commonly used function so best
> > avoided as a name).
> >
> >
> > Cheers, Mike.
> >
> >
> >
> >
> >> Error in .readCellsGDAL(x, uniquecells, layers) :
> >>   NAs are not allowed in subscripted assignments
> >> In addition: Warning message:
> >> In .readCells(x, cells, 1) : NAs introduced by coercion
> >>
> >> > traceback()
> >> 8: .readCellsGDAL(x, uniquecells, layers)
> >> 7: .readCells(x, cells, 1)
> >> 6: .cellValues(object, cells, layer = layer, nl = nl)
> >> 5: .xyValues(x, coordinates(y), ..., df = df)
> >> 4: .local(x, y, ...)
> >> 3: extract(elev, sdata)
> >> 2: extract(elev, sdata)
> >> 1: data.frame(sdata at data, extract(elev, sdata))
> >>
> >> I had a tough time trouble-shooting from the error, but the raster are
> huge
> >> (~2x10^9 cells), so I tried to clip a small portion of it and do the
> >> extract, and it worked.
> >>
> >> Here's the code I used to Crop:
> >> >bbox <- as(extent(22285.6, 3762091.8, 23285.6, 3862091.8),
> >> 'SpatialPolygons')
> >> >y <- crop(elev,bbox)
> >>
> >> The data are FLT4S, and as a TIF, take up ~11.5GB. Is this just out of
> the
> >> bounds for what is feasible? Or is there some trouble-shooting anybody
> >> recommends I do? (Or is there a good way to do this as tiles in R?) And
> if
> >> there's a way to do this with spatial.tools, I'm open to that, but
> wasn't
> >> able to figure it out on my own thus far.
> >>
> >> Thanks for any suggestions,
> >> Mike T
> >>
> >> > sessionInfo()
> >> R version 3.1.2 (2014-10-31)
> >> Platform: x86_64-w64-mingw32/x64 (64-bit)
> >>
> >> locale:
> >> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
> >> States.1252    LC_MONETARY=English_United States.1252
> >> [4] LC_NUMERIC=C                           LC_TIME=English_United
> >> States.1252
> >>
> >> attached base packages:
> >> [1] stats     graphics  grDevices utils     datasets  methods   base
> >>
> >> other attached packages:
> >> [1] raster_2.2-31 rgdal_0.8-16  sp_1.0-15
> >>
> >> loaded via a namespace (and not attached):
> >> [1] grid_3.1.2      lattice_0.20-29 tools_3.1.2
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Thu Dec 18 20:55:44 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 18 Dec 2014 19:55:44 +0000
Subject: [R-sig-Geo] gdal19.dll is missing from your computer
References: <47297903EAC29341B8399B24D2DB968270E7ED7B@exacd10.ms.gettysburg.edu>
Message-ID: <CAAcGz98YLZX5NG_sewtQZZ+VT6gQWL1aAmsvLq9fEMRJkzK3MA@mail.gmail.com>

Hi, it's actually not an error.  The message is there to be explicit about
the details of exactly what installed GDAL is used, which has been very
helpful in the past for solving problems like your gdal19.dll one. It's
less complicated on Windows if you use the CRAN binary, but on other
systems or on other types of Windows builds it's extremely handy to have
that information readily.

You can keep the peace with:

 suppressPackageStartupMessages(library(rgdal))

or

suppressMessages(library(rgdal))

Cheers, Mike.



On Fri Dec 19 2014 at 02:45:34 Rutherford Platt <rplatt at gettysburg.edu>
wrote:

> Hello,
>
> I'm a relatively new user, so bear with me.
>
> I'm using a Windows 7 computer and R 3.1.   I wrote some scripts back in
> August that worked perfectly.  Now, when the script reaches
> 'require(rgdal)' I get several error messages in a row that say: "The
> program can't start because gdal19.dll is missing from your computer.  Try
> reinstalling the program to fix this problem"
>
> I then get the following output:
> Loading required package: rgdal
> Loading required package: sp
> rgdal: version: 0.8-16, (SVN revision 498)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.11.0, released 2014/04/16
> Path to GDAL shared files: C:/Users/rplatt.GETTYSBURG/
> Documents/R/win-library/3.1/rgdal/gdal
> GDAL does not use iconv for recoding strings.
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: C:/Users/rplatt.GETTYSBURG/
> Documents/R/win-library/3.1/rgdal/proj
>
> It seems like rgdal may have successfully installed, so why do I get all
> these error messages?  And how can I get rid of them?
>
> Thanks!
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From ekosusilo at live.com  Fri Dec 19 09:02:53 2014
From: ekosusilo at live.com (Eko Susilo)
Date: Fri, 19 Dec 2014 16:02:53 +0800
Subject: [R-sig-Geo] How do I read and plot .nc data in R?
Message-ID: <BLU437-SMTP66EEBFB5C727B68E8F5FA7DD6B0@phx.gbl>

Could somebody help me to figure out my data

I have .nc data around Indonesia water (attached below)

I use R to open and plot it. This is my syntax

nc <- open.ncdf(choose.files('D:/R/yfin_pelikan/yfin_input', caption = 
'Select netcdf Files .....'))
print (nc)

# Read the variable

adl <- nc$var[[1]]
varsize <- adl$varsize
ndims <- adl$ndims
nt <- varsize[ndims]

start <- rep(1,ndims) # begin with start=(1,1,1,...,1)
start[ndims] <- j # change to start=(1,1,1,...,i) to read timestep i
count <- varsize # begin w/count=(nx,ny,nz,...,nt), reads entire var
count[ndims] <- 1 # change to count=(nx,ny,nz,...,1) to read 1 tstep

data <- get.var.ncdf(nc, adl, start=start, count=count )

# plot the map

jet.colors <- colorRampPalette(c('#00007F', 'blue', '#007FFF', 
'cyan','#7FFF7F', 'yellow', '#FF7F00', 'red', '#7F0000'))

plot.adl <- levelplot(data,
col.regions = jet.colors(255), at=seq(0, 1, 0.005),
yscale.components=yscale.raster.subticks,
xscale.components=xscale.raster.subticks,
margin=FALSE, ylab='latitude', xlab='longitude', main='test')
print(plot.adl + layer(sp.lines(indo.map, lwd=1, col='black')))

# The results is good bad not georreference so i can't overlay with the 
base map (costaline)...

# So i try to convert it to raster

# Convert it to raster and re-plot

y <- raster(data.adl, xmn=-20, xmx=25, ymn=90, ymx=144)
projection(y) <- CRS("+proj=longlat +datum=WGS84")

plot.y <- levelplot(y,
col.regions = jet.colors(255), at=seq(0, 1, 0.005),
yscale.components=yscale.raster.subticks,
xscale.components=xscale.raster.subticks,
margin=FALSE, ylab='latitude', xlab='longitude', main='test')
print(plot.y + layer(sp.lines(indo.map, lwd=1, col='black')))

# The result is not good..

Attached file:

data (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21165 
<https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521165>)

result1 (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21164 
<https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521164>)

result2 (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21163 
<https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521163>)


	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Fri Dec 19 10:04:56 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 19 Dec 2014 09:04:56 +0000
Subject: [R-sig-Geo] How do I read and plot .nc data in R?
References: <BLU437-SMTP66EEBFB5C727B68E8F5FA7DD6B0@phx.gbl>
Message-ID: <CAAcGz99Lgzqor996PxB8g=xsdNgpV5HsAyosv+P=GxBCFKVZaA@mail.gmail.com>

If you could easily convert it to raster, raster is the best place to start.
Try

library(raster)
r = raster(fname)
plot(r)

Please report on the effect.

Netcdf is *so* general a format it really can come down to specifics. If
you can it is best to share a link to the or a representative file.

Cheers, Mike

On Fri, 19 Dec 2014 19:05 Eko Susilo <ekosusilo at live.com> wrote:

> Could somebody help me to figure out my data
>
> I have .nc data around Indonesia water (attached below)
>
> I use R to open and plot it. This is my syntax
>
> nc <- open.ncdf(choose.files('D:/R/yfin_pelikan/yfin_input', caption =
> 'Select netcdf Files .....'))
> print (nc)
>
> # Read the variable
>
> adl <- nc$var[[1]]
> varsize <- adl$varsize
> ndims <- adl$ndims
> nt <- varsize[ndims]
>
> start <- rep(1,ndims) # begin with start=(1,1,1,...,1)
> start[ndims] <- j # change to start=(1,1,1,...,i) to read timestep i
> count <- varsize # begin w/count=(nx,ny,nz,...,nt), reads entire var
> count[ndims] <- 1 # change to count=(nx,ny,nz,...,1) to read 1 tstep
>
> data <- get.var.ncdf(nc, adl, start=start, count=count )
>
> # plot the map
>
> jet.colors <- colorRampPalette(c('#00007F', 'blue', '#007FFF',
> 'cyan','#7FFF7F', 'yellow', '#FF7F00', 'red', '#7F0000'))
>
> plot.adl <- levelplot(data,
> col.regions = jet.colors(255), at=seq(0, 1, 0.005),
> yscale.components=yscale.raster.subticks,
> xscale.components=xscale.raster.subticks,
> margin=FALSE, ylab='latitude', xlab='longitude', main='test')
> print(plot.adl + layer(sp.lines(indo.map, lwd=1, col='black')))
>
> # The results is good bad not georreference so i can't overlay with the
> base map (costaline)...
>
> # So i try to convert it to raster
>
> # Convert it to raster and re-plot
>
> y <- raster(data.adl, xmn=-20, xmx=25, ymn=90, ymx=144)
> projection(y) <- CRS("+proj=longlat +datum=WGS84")
>
> plot.y <- levelplot(y,
> col.regions = jet.colors(255), at=seq(0, 1, 0.005),
> yscale.components=yscale.raster.subticks,
> xscale.components=xscale.raster.subticks,
> margin=FALSE, ylab='latitude', xlab='longitude', main='test')
> print(plot.y + layer(sp.lines(indo.map, lwd=1, col='black')))
>
> # The result is not good..
>
> Attached file:
>
> data (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21165
> <https://www.researchgate.net/go.Deref.html?url=https%3A%2F%
> 2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521165>)
>
> result1 (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21164
> <https://www.researchgate.net/go.Deref.html?url=https%3A%2F%
> 2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521164>)
>
> result2 (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21163
> <https://www.researchgate.net/go.Deref.html?url=https%3A%2F%
> 2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521163>)
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From ekosusilo at live.com  Fri Dec 19 10:32:33 2014
From: ekosusilo at live.com (Eko Susilo)
Date: Fri, 19 Dec 2014 17:32:33 +0800
Subject: [R-sig-Geo] How do I read and plot .nc data in R?
In-Reply-To: <CAAcGz99Lgzqor996PxB8g=xsdNgpV5HsAyosv+P=GxBCFKVZaA@mail.gmail.com>
References: <BLU437-SMTP66EEBFB5C727B68E8F5FA7DD6B0@phx.gbl>
	<CAAcGz99Lgzqor996PxB8g=xsdNgpV5HsAyosv+P=GxBCFKVZaA@mail.gmail.com>
Message-ID: <BLU436-SMTP805EA268C387ED12FAB39EDD6B0@phx.gbl>

Hi Micheal,

I have tried do your scripts,
/y <- raster(fname, xmn=-20, xmx=25, ymn=90, ymx=144)//
//projection(y) <- CRS("+proj=longlat +datum=WGS84")/
the result is good, but not georeference image (i mean the data is not 
right position), you can see my plot here 
https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21163

Meanwhile  when I read .nc directly and plot the data is look like 
https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21164 
<https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21163>
not georeferenced image  but in the right position)

The .nc data available in this link 
https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21165


On 19/12/2014 17:04, Michael Sumner wrote:
>
> If you could easily convert it to raster, raster is the best place to 
> start.
> Try
>
> library(raster)
> r = raster(fname)
> plot(r)
>
> Please report on the effect.
>
> Netcdf is *so* general a format it really can come down to specifics. 
> If you can it is best to share a link to the or a representative file.
>
> Cheers, Mike
>
>
> On Fri, 19 Dec 2014 19:05 Eko Susilo <ekosusilo at live.com 
> <mailto:ekosusilo at live.com>> wrote:
>
>     Could somebody help me to figure out my data
>
>     I have .nc data around Indonesia water (attached below)
>
>     I use R to open and plot it. This is my syntax
>
>     nc <- open.ncdf(choose.files('D:/R/yfin_pelikan/yfin_input', caption =
>     'Select netcdf Files .....'))
>     print (nc)
>
>     # Read the variable
>
>     adl <- nc$var[[1]]
>     varsize <- adl$varsize
>     ndims <- adl$ndims
>     nt <- varsize[ndims]
>
>     start <- rep(1,ndims) # begin with start=(1,1,1,...,1)
>     start[ndims] <- j # change to start=(1,1,1,...,i) to read timestep i
>     count <- varsize # begin w/count=(nx,ny,nz,...,nt), reads entire var
>     count[ndims] <- 1 # change to count=(nx,ny,nz,...,1) to read 1 tstep
>
>     data <- get.var.ncdf(nc, adl, start=start, count=count )
>
>     # plot the map
>
>     jet.colors <- colorRampPalette(c('#00007F', 'blue', '#007FFF',
>     'cyan','#7FFF7F', 'yellow', '#FF7F00', 'red', '#7F0000'))
>
>     plot.adl <- levelplot(data,
>     col.regions = jet.colors(255), at=seq(0, 1, 0.005),
>     yscale.components=yscale.raster.subticks,
>     xscale.components=xscale.raster.subticks,
>     margin=FALSE, ylab='latitude', xlab='longitude', main='test')
>     print(plot.adl + layer(sp.lines(indo.map, lwd=1, col='black')))
>
>     # The results is good bad not georreference so i can't overlay
>     with the
>     base map (costaline)...
>
>     # So i try to convert it to raster
>
>     # Convert it to raster and re-plot
>
>     y <- raster(data.adl, xmn=-20, xmx=25, ymn=90, ymx=144)
>     projection(y) <- CRS("+proj=longlat +datum=WGS84")
>
>     plot.y <- levelplot(y,
>     col.regions = jet.colors(255), at=seq(0, 1, 0.005),
>     yscale.components=yscale.raster.subticks,
>     xscale.components=xscale.raster.subticks,
>     margin=FALSE, ylab='latitude', xlab='longitude', main='test')
>     print(plot.y + layer(sp.lines(indo.map, lwd=1, col='black')))
>
>     # The result is not good..
>
>     Attached file:
>
>     data (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21165
>     <https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521165>)
>
>     result1 (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21164
>     <https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521164>)
>
>     result2 (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21163
>     <https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521163>)
>
>
>             [[alternative HTML version deleted]]
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


	[[alternative HTML version deleted]]


From Wade.A.Wall at usace.army.mil  Fri Dec 19 15:34:55 2014
From: Wade.A.Wall at usace.army.mil (Wall, Wade A ERDC-RDE-CERL-IL)
Date: Fri, 19 Dec 2014 14:34:55 +0000
Subject: [R-sig-Geo] Raster projection alignment issues
Message-ID: <C1524BE4BF45454293B8DF38FB9B5ECA178B6B4D@MS-EX1VKS.erdc.dren.mil>

Hi all,

I posted this over at gis.stackexchange.com, but thought this user group may be interested.

I downloaded  raster data from  http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcomein

The BCSD-CMIP5 data is found under the tab "Projections: Complete Archives".
The files are in netCDF format, but am running into some issues. The original raster data (let's call it rast1) when imported has the extent

xmin 235.25
xmax 293
ymin 25.125
ymax 52.875

and a crs of +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0

The other objects (both sp and raster) I am working with contain negative values for xmin and xmax


xmin        : -122.8021

xmax        : -75.38249

ymin        : 31.78881

ymax        : 47.15952



When I attempt to reproject the raster data into Albers Equal Area (+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83

+units=m +no_defs +ellps=GRS80+towgs84=0,0,0)using the following code:



rast_new = projectRaster(rast1, rast2) ## rast2 is a raster with the crs for Albers Equal Area



the extents still don't line up, so I have to do the following.



rast_new = projectExtent(rast1,rast2)

rast_new = projectRaster(rast1,rast_new)

values(rast_new) = values(rast1) ### This is necessary because all the values were NA



However, rast_new, even though its crs is defined as Albers Equal Area, does not project correctly. Even when I export these files from R and open in ArcGIS, the issues persist. However, if I import the netCDF files directly into ArcGIS and reproject, there are no problems.



Any clues as to what I am doing wrong?



Thanks for any assistance.


Wade A. Wall
US Army ERDC-CERL
P.O. Box 9005
Champaign, IL  61826-9005
1-217-373-4420
Wade.A.Wall at usace.army.mil




	[[alternative HTML version deleted]]


From famuvie at alumni.uv.es  Fri Dec 19 16:53:33 2014
From: famuvie at alumni.uv.es (=?UTF-8?B?RmFjdW5kbyBNdcOxb3o=?=)
Date: Fri, 19 Dec 2014 16:53:33 +0100
Subject: [R-sig-Geo] kriging with non-euclidean distances
Message-ID: <549449FD.8090207@alumni.uv.es>

This is a recurring question from time to time.

I finally packaged [1] some old code (2009) that modifies certain
functions in geoR in order to use custom distance matrices in the
construction of empirical variograms (variog), the fit of variogram
models (likfit) and the kriging (krige.conv).

I used it at the time with ?cost-based? distances, which need to be
computed elsewhere.
I used |GRASS GIS|, but nowadays there is |gdistance| which can complete
a full-R solution.
I also included some sample data and examples of usage.

I hope it is more easily accesible now.

Best regards
?acu.-

[1] https://github.com/famuvie/geoRcb

?

	[[alternative HTML version deleted]]


From galuardi at mit.edu  Fri Dec 19 17:55:22 2014
From: galuardi at mit.edu (Benjamin.Galuardi)
Date: Fri, 19 Dec 2014 11:55:22 -0500
Subject: [R-sig-Geo] Extract spatial mean of subset of netCDF.
In-Reply-To: <CAPB42UwFSKBH4=NZaOZTpSWWemS6R-=n_LJxEkL-L1HjL7LpbQ@mail.gmail.com>
References: <CAPB42UwFSKBH4=NZaOZTpSWWemS6R-=n_LJxEkL-L1HjL7LpbQ@mail.gmail.com>
Message-ID: <5494587A.7030009@mit.edu>

Hi Aseem,

I can offer the following advice:

1) there is no

dt.ras.c

variable created in your code. It would be helpful to include that line 
in the question.

2) do you need a raster brick? unless you have very large data, this 
step seems unnecessary.
3) are you looking for a mean across layers or a mean for each layer 
within the stack?
4) try using 'extract'
    mean( extract(raster, extent), na.rm=T)
4a) use na.rm=T! I'm not sure but perhaps this is causing problems.
5) double check the import. if the orientation of the raster is not what 
you think it is, you ,ay be extracting the wrong area.

hope that helps

Ben

On 12/6/2014 11:47 AM, Aseem Sharma wrote:
> Hi,
>
> I am  new with raster work in R.
>
> I am trying to get the spatial mean of a subset (define by the extent) of
> larger domain netCDF data file using raster and ncdf packages
>
> The netCDF data of Snow Water Equivalent(SWE) were obtained from
> http://www.globsnow.info/swe/archive_v2.0/. The two files I have used are
> nc1
> <https://www.dropbox.com/s/tk388w67tjg704s/GlobSnow_SWE_L3A_19900101_v2.0.nc?dl=0>
> and nc2
> <https://www.dropbox.com/s/pft2dlio96n6ncw/GlobSnow_SWE_L3A_19900102_v2.0.nc?dl=0>
> .
>
> The codes I used are
>
> library(raster)
>
> library(ncdf)
>
> nc1<-"C:\\Users\\bunug_000.BUNU\\Documents\\Dropbox\\Public\\
> GlobSnow_SWE_L3A_19900101_v2.0.nc"
>
> nc2<-"C:\\Users\\bunug_000.BUNU\\Documents\\Dropbox\\Public\\
> GlobSnow_SWE_L3A_19900102_v2.0.nc"
>
>
>
> about_nc<-open.ncdf(nc1)
>
> print(about_nc)
>
>
>
> nc_data<-stack(nc1,nc2,varname="SWE")
>
> print(nc_data)
>
> dim(nc_data)
>
> nc_data1<-brick(nc_data)
>
> plot(nc_data1)
>
> subsetd<-extent(-78,-74,50,52)
>
> subsetd
>
> crop_data <- crop(nc_data1, subsetd)
>
> dim(dt.ras.c)
>
>
>
> dt.anm<-as.data.frame(cbind(unname(cellStats(dt.ras.c,
> stat="mean")),seq(1:2))) # use unname to separate named numebr to just
> numbers
>
> str(dt.anm)
>
> colnames(dt.anm)<-c("Mean_SWE","ID")
>
>
> What is not right here so that I am not getting mean SWE. It should not be
> -1.
>
> Any suggestions will be highly appreciated.
>
> Thank you.
>
>
> ------------------
>
> "Namaste ??????"
>
> Aseem Sharma
>
> Graduate Research Assistant
>
> Northern Hydrometeorology Group(NHG)
>
> Natural Resources and Environmental Studies Institute(NRESi)
>
> University of Northern British Columbia
>
> Prince George, BC, V2N 4Z9, Canada
>
> Tel: 250-960-5427
>
> Web: http://www.unbc.ca/
>
>
>   "All know the Way, but few actually walk it."
> "????? ?????? ???? ?"
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
==================================================
Benjamin Galuardi
PhD Student
NMFS-Seagrant Population Dynamics Fellow
SMAST, UMass Dartmouth


From mdsumner at gmail.com  Fri Dec 19 21:32:53 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 19 Dec 2014 20:32:53 +0000
Subject: [R-sig-Geo] How do I read and plot .nc data in R?
References: <BLU437-SMTP66EEBFB5C727B68E8F5FA7DD6B0@phx.gbl>
	<CAAcGz99Lgzqor996PxB8g=xsdNgpV5HsAyosv+P=GxBCFKVZaA@mail.gmail.com>
	<BLU436-SMTP805EA268C387ED12FAB39EDD6B0@phx.gbl>
Message-ID: <CAAcGz9-ukbj_M_uLXpak+8LP-2N7=SeT3H5-o=v50MtFEROyng@mail.gmail.com>

I had sent a second email that did not make it to the archives it seems,
here it is:

I think it works fine, I downloaded your file and:

library(raster)
 f <- "yfin_20141219.nc"
r <- raster(f)
plot(r)
## check we get sensible orientation and scaling and offset and
interpretation etc. etc.
library(rworldmap)
data(countriesLow)
plot(countriesLow, add = TRUE)

r
       : RasterLayer
dimensions  : 541, 649, 351109  (nrow, ncol, ncell)
resolution  : 0.08333333, 0.08333333  (x, y)
extent      : 89.95833, 144.0417, -20.04167, 25.04167  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=longlat +datum=WGS84
data source : C:\Users\mdsumner\Downloads\yfin_20141219.nc
names       : yft_adu
z-value     : 251164800
zvar        : yft_adu

Note that in general, reading a raw array from file and applying this
assumptive georeferencing is fraught with danger:
?
y <- raster(data.adl, xmn=-20, xmx=25, ymn=90, ymx=144)

You should check assumptions about the orientation, order, units and
scaling of the coordinate arrays. The raster package is pretty smart about
telling you when danger lurks, but I would still be very careful.  NetCDF
doesn't generally get used store the standard GIS affine transform, it
usually stores every dimension's coordinate and only removes that
redundancy in some cases for rectilinear grids. It's one of those murky
boundaries between different worlds.

HTH

Cheers, Mike.

On Fri Dec 19 2014 at 20:33:20 Eko Susilo <ekosusilo at live.com> wrote:

>  Hi Micheal,
>
> I have tried do your scripts,
> *y <- raster(fname, xmn=-20, xmx=25, ymn=90, ymx=144)*
>
> * projection(y) <- CRS("+proj=longlat +datum=WGS84")*
>
> the result is good, but not georeference image (i mean the data is not
> right position), you can see my plot here
> https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21163
>
> Meanwhile  when I read .nc directly and plot the data is look like
> https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21164
> <https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21163>
> not georeferenced image  but in the right position)
>
> The .nc data available in this link
> https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21165
>
>
>
> On 19/12/2014 17:04, Michael Sumner wrote:
>
> If you could easily convert it to raster, raster is the best place to
> start.
> Try
>
> library(raster)
> r = raster(fname)
> plot(r)
>
> Please report on the effect.
>
> Netcdf is *so* general a format it really can come down to specifics. If
> you can it is best to share a link to the or a representative file.
>
> Cheers, Mike
>
> On Fri, 19 Dec 2014 19:05 Eko Susilo <ekosusilo at live.com> wrote:
>
>> Could somebody help me to figure out my data
>>
>> I have .nc data around Indonesia water (attached below)
>>
>> I use R to open and plot it. This is my syntax
>>
>> nc <- open.ncdf(choose.files('D:/R/yfin_pelikan/yfin_input', caption =
>> 'Select netcdf Files .....'))
>> print (nc)
>>
>> # Read the variable
>>
>> adl <- nc$var[[1]]
>> varsize <- adl$varsize
>> ndims <- adl$ndims
>> nt <- varsize[ndims]
>>
>> start <- rep(1,ndims) # begin with start=(1,1,1,...,1)
>> start[ndims] <- j # change to start=(1,1,1,...,i) to read timestep i
>> count <- varsize # begin w/count=(nx,ny,nz,...,nt), reads entire var
>> count[ndims] <- 1 # change to count=(nx,ny,nz,...,1) to read 1 tstep
>>
>> data <- get.var.ncdf(nc, adl, start=start, count=count )
>>
>> # plot the map
>>
>> jet.colors <- colorRampPalette(c('#00007F', 'blue', '#007FFF',
>> 'cyan','#7FFF7F', 'yellow', '#FF7F00', 'red', '#7F0000'))
>>
>> plot.adl <- levelplot(data,
>> col.regions = jet.colors(255), at=seq(0, 1, 0.005),
>> yscale.components=yscale.raster.subticks,
>> xscale.components=xscale.raster.subticks,
>> margin=FALSE, ylab='latitude', xlab='longitude', main='test')
>> print(plot.adl + layer(sp.lines(indo.map, lwd=1, col='black')))
>>
>> # The results is good bad not georreference so i can't overlay with the
>> base map (costaline)...
>>
>> # So i try to convert it to raster
>>
>> # Convert it to raster and re-plot
>>
>> y <- raster(data.adl, xmn=-20, xmx=25, ymn=90, ymx=144)
>> projection(y) <- CRS("+proj=longlat +datum=WGS84")
>>
>> plot.y <- levelplot(y,
>> col.regions = jet.colors(255), at=seq(0, 1, 0.005),
>> yscale.components=yscale.raster.subticks,
>> xscale.components=xscale.raster.subticks,
>> margin=FALSE, ylab='latitude', xlab='longitude', main='test')
>> print(plot.y + layer(sp.lines(indo.map, lwd=1, col='black')))
>>
>> # The result is not good..
>>
>> Attached file:
>>
>> data (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21165
>> <
>> https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521165
>> >)
>>
>> result1 (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21164
>> <
>> https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521164
>> >)
>>
>> result2 (https://onedrive.live.com/redir?resid=6FFDD661570C7D0A%21163
>> <
>> https://www.researchgate.net/go.Deref.html?url=https%3A%2F%2Fonedrive.live.com%2Fredir%3Fresid%3D6FFDD661570C7D0A%2521163
>> >)
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Sat Dec 20 07:23:32 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 19 Dec 2014 22:23:32 -0800
Subject: [R-sig-Geo] Raster projection alignment issues
In-Reply-To: <C1524BE4BF45454293B8DF38FB9B5ECA178B6B4D@MS-EX1VKS.erdc.dren.mil>
References: <C1524BE4BF45454293B8DF38FB9B5ECA178B6B4D@MS-EX1VKS.erdc.dren.mil>
Message-ID: <CANtt_hxRQS7vageCJ22FGi=uKN=uO3CaKA95=32_DJExMbM1Eg@mail.gmail.com>

Wade,

I do not think you are doing anything wrong. projectRaster gets
confused because of the uncommon longitude coordinates used by climate
models (0 to 360, rather than -180 to 180)
You can use the 'rotate' function to fix that (ignore the warning), or
by setting the extent, and then proceed. See below.

Robert

library(raster)
r <- raster(xmn=235.25, xmx=293, ymn=25.125, ymx=52.875, res=1/8,
crs='+proj=longlat +datum=WGS84')
rr <- rotate(r)

## or something like
## extent(r) <- extent(235.25-360, 293-360, 25.125, 52.875)

aea <- '+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
+y_0=0 +datum=NAD83'

library(maptools)
data(wrld_simpl)
us <- wrld_simpl[wrld_simpl$ISO3=='USA', ]

library(rgdal)
usa <- spTransform(us, CRS(aea))
rra <- projectRaster(rr, crs=aea)

plot(rra)
plot(usa, add=TRUE)




by the way. this is almost certainly a bad idea:
values(rast_new) = values(rast1) ### This is necessary because all the
values were NA

On Fri, Dec 19, 2014 at 6:34 AM, Wall, Wade A ERDC-RDE-CERL-IL
<Wade.A.Wall at usace.army.mil> wrote:
> Hi all,
>
> I posted this over at gis.stackexchange.com, but thought this user group may be interested.
>
> I downloaded  raster data from  http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcomein
>
> The BCSD-CMIP5 data is found under the tab "Projections: Complete Archives".
> The files are in netCDF format, but am running into some issues. The original raster data (let's call it rast1) when imported has the extent
>
> xmin 235.25
> xmax 293
> ymin 25.125
> ymax 52.875
>
> and a crs of +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0
>
> The other objects (both sp and raster) I am working with contain negative values for xmin and xmax
>
>
> xmin        : -122.8021
>
> xmax        : -75.38249
>
> ymin        : 31.78881
>
> ymax        : 47.15952
>
>
>
> When I attempt to reproject the raster data into Albers Equal Area (+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83
>
> +units=m +no_defs +ellps=GRS80+towgs84=0,0,0)using the following code:
>
>
>
> rast_new = projectRaster(rast1, rast2) ## rast2 is a raster with the crs for Albers Equal Area
>
>
>
> the extents still don't line up, so I have to do the following.
>
>
>
> rast_new = projectExtent(rast1,rast2)
>
> rast_new = projectRaster(rast1,rast_new)
>
> values(rast_new) = values(rast1) ### This is necessary because all the values were NA
>
>
>
> However, rast_new, even though its crs is defined as Albers Equal Area, does not project correctly. Even when I export these files from R and open in ArcGIS, the issues persist. However, if I import the netCDF files directly into ArcGIS and reproject, there are no problems.
>
>
>
> Any clues as to what I am doing wrong?
>
>
>
> Thanks for any assistance.
>
>
> Wade A. Wall
> US Army ERDC-CERL
> P.O. Box 9005
> Champaign, IL  61826-9005
> 1-217-373-4420
> Wade.A.Wall at usace.army.mil
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Sat Dec 20 07:51:07 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 19 Dec 2014 22:51:07 -0800
Subject: [R-sig-Geo] Extract spatial mean of subset of netCDF.
In-Reply-To: <5494587A.7030009@mit.edu>
References: <CAPB42UwFSKBH4=NZaOZTpSWWemS6R-=n_LJxEkL-L1HjL7LpbQ@mail.gmail.com>
	<5494587A.7030009@mit.edu>
Message-ID: <CANtt_hwZ5Z165HwGZGAzcNWfQbtGFBmnoLQeeP2e-Lu-Pg31Vw@mail.gmail.com>

Aseem,

The problem is that you are trying to subset a raster using
latitude/longitude coordinates, while the raster has another CRS.

You can fix this, I think, by assigning the correct crs (you can find
these at http://www.spatialreference.org/)
and then, for example, adjusting your extent, or by using projectRaster

Robert


library(raster)
nc1 <- "GlobSnow_SWE_L3A_19900101_v2.0.nc"
nc2 <- "GlobSnow_SWE_L3A_19900102_v2.0.nc"
nc_data <-stack(nc1, nc2, varname="SWE")
nc_data
crs(nc_data) <- "+proj=laea +lat_0=90 +lon_0=0 +x_0=0 +y_0=0
+a=6371228 +b=6371228 +units=m +no_defs"

egeo <- extent(-78,-74,50,52)
x <- raster(egeo, crs='+proj=longlat +datum=WGS84' )
e <- extent(projectExtent(x, "+proj=laea +lat_0=90 +lon_0=0 +x_0=0
+y_0=0 +a=6371228 +b=6371228 +units=m +no_defs"))

d <- crop(nc_data, e)
cellStats(d, mean)
# or
as.vector(cellStats(d, mean))


### or
z <- projectRaster(nc_data, x)
cellStats(d, mean)

# number are similar, but (as expected) not the same.




Please provide more complete information, such as warning or error
messages, when you encounter a problem. Show the output of your script
(as below) that I needed to see to understand what is going on.

> library(raster)
> nc1 <- "GlobSnow_SWE_L3A_19900101_v2.0.nc"
> nc2 <- "GlobSnow_SWE_L3A_19900102_v2.0.nc"
> nc_data <-stack(nc1, nc2, varname="SWE")
Warning messages:
1: In .getCRSfromGridMap4(atts) : cannot process these parts of the CRS:
spatial_ref=PROJCS["NSIDC EASE-Grid North",GEOGCS["Unspecified datum
based upon the International 1924 Authalic
Sphere",DATUM["Not_specified_based_on_International_1924_Authalic_Sphere",SPHEROID["International
1924 Authalic Sphere",6371228,0,AUTHORITY["EPSG","7057"]],AUTHORITY["EPSG","6053"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4053"]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_center",90],PARAMETER["longitude_of_center",0],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["X",EAST],AXIS["Y",NORTH],AUTHORITY["EPSG","3408"]];
GeoTransform=-9036842.762 25067.525 0 9036842.763000002 0 -25067.525
2: In .getCRSfromGridMap4(atts) : cannot create a valid CRS
grid_mapping_name; false_easting; false_northing;
scale_factor_at_projection_origin; scale_factor_at_central_meridian;
standard_parallel; standard_parallel1; standard_parallel2;
longitude_of_central_meridian; longitude_of_projection_origin;
latitude_of_projection_origin; straight_vertical_longitude_from_pole;
longitude_of_prime_meridian; semi_major_axis; inverse_flattening;
+proj; +x_0; +y_0; +k_0; +k_0; +lat_1; +lat_1; +lat_2; +lon_0; +lon_0;
+lat_0; +lon_0; +lon_0; +a; +rf
3: In .getCRSfromGridMap4(atts) : cannot process these parts of the CRS:
spatial_ref=PROJCS["NSIDC EASE-Grid North",GEOGCS["Unspecified datum
based upon the International 1924 Authalic
Sphere",DATUM["Not_specified_based_on_International_1924_Authalic_Sphere",SPHEROID["International
1924 Authalic Sphere",6371228,0,AUTHORITY["EPSG","7057"]],AUTHORITY["EPSG","6053"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4053"]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_center",90],PARAMETER["longitude_of_center",0],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["X",EAST],AXIS["Y",NORTH],AUTHORITY["EPSG","3408"]];
GeoTransform=-9036842.762 25067.525 0 9036842.763000002 0 -25067.525
4: In .getCRSfromGridMap4(atts) : cannot create a valid CRS
grid_mapping_name; false_easting; false_northing;
scale_factor_at_projection_origin; scale_factor_at_central_meridian;
standard_parallel; standard_parallel1; standard_parallel2;
longitude_of_central_meridian; longitude_of_projection_origin;
latitude_of_projection_origin; straight_vertical_longitude_from_pole;
longitude_of_prime_meridian; semi_major_axis; inverse_flattening;
+proj; +x_0; +y_0; +k_0; +k_0; +lat_1; +lat_1; +lat_2; +lon_0; +lon_0;
+lat_0; +lon_0; +lon_0; +a; +rf
> nc_data
class       : RasterStack
dimensions  : 721, 721, 519841, 2  (nrow, ncol, ncell, nlayers)
resolution  : 25067.52, 25067.52  (x, y)
extent      : -9036843, 9036843, -9036843, 9036843  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
names       : Daily.Snow.Water.Equivalent.1, Daily.Snow.Water.Equivalent.2

On Fri, Dec 19, 2014 at 8:55 AM, Benjamin.Galuardi <galuardi at mit.edu> wrote:
> Hi Aseem,
>
> I can offer the following advice:
>
> 1) there is no
>
> dt.ras.c
>
> variable created in your code. It would be helpful to include that line in
> the question.
>
> 2) do you need a raster brick? unless you have very large data, this step
> seems unnecessary.
> 3) are you looking for a mean across layers or a mean for each layer within
> the stack?
> 4) try using 'extract'
>    mean( extract(raster, extent), na.rm=T)
> 4a) use na.rm=T! I'm not sure but perhaps this is causing problems.
> 5) double check the import. if the orientation of the raster is not what you
> think it is, you ,ay be extracting the wrong area.
>
> hope that helps
>
> Ben
>
>
> On 12/6/2014 11:47 AM, Aseem Sharma wrote:
>>
>> Hi,
>>
>> I am  new with raster work in R.
>>
>> I am trying to get the spatial mean of a subset (define by the extent) of
>> larger domain netCDF data file using raster and ncdf packages
>>
>> The netCDF data of Snow Water Equivalent(SWE) were obtained from
>> http://www.globsnow.info/swe/archive_v2.0/. The two files I have used are
>> nc1
>>
>> <https://www.dropbox.com/s/tk388w67tjg704s/GlobSnow_SWE_L3A_19900101_v2.0.nc?dl=0>
>> and nc2
>>
>> <https://www.dropbox.com/s/pft2dlio96n6ncw/GlobSnow_SWE_L3A_19900102_v2.0.nc?dl=0>
>> .
>>
>> The codes I used are
>>
>> library(raster)
>>
>> library(ncdf)
>>
>> nc1<-"C:\\Users\\bunug_000.BUNU\\Documents\\Dropbox\\Public\\
>> GlobSnow_SWE_L3A_19900101_v2.0.nc"
>>
>> nc2<-"C:\\Users\\bunug_000.BUNU\\Documents\\Dropbox\\Public\\
>> GlobSnow_SWE_L3A_19900102_v2.0.nc"
>>
>>
>>
>> about_nc<-open.ncdf(nc1)
>>
>> print(about_nc)
>>
>>
>>
>> nc_data<-stack(nc1,nc2,varname="SWE")
>>
>> print(nc_data)
>>
>> dim(nc_data)
>>
>> nc_data1<-brick(nc_data)
>>
>> plot(nc_data1)
>>
>> subsetd<-extent(-78,-74,50,52)
>>
>> subsetd
>>
>> crop_data <- crop(nc_data1, subsetd)
>>
>> dim(dt.ras.c)
>>
>>
>>
>> dt.anm<-as.data.frame(cbind(unname(cellStats(dt.ras.c,
>> stat="mean")),seq(1:2))) # use unname to separate named numebr to just
>> numbers
>>
>> str(dt.anm)
>>
>> colnames(dt.anm)<-c("Mean_SWE","ID")
>>
>>
>> What is not right here so that I am not getting mean SWE. It should not be
>> -1.
>>
>> Any suggestions will be highly appreciated.
>>
>> Thank you.
>>
>>
>> ------------------
>>
>> "Namaste ??????"
>>
>> Aseem Sharma
>>
>> Graduate Research Assistant
>>
>> Northern Hydrometeorology Group(NHG)
>>
>> Natural Resources and Environmental Studies Institute(NRESi)
>>
>> University of Northern British Columbia
>>
>> Prince George, BC, V2N 4Z9, Canada
>>
>> Tel: 250-960-5427
>>
>> Web: http://www.unbc.ca/
>>
>>
>>   "All know the Way, but few actually walk it."
>> "????? ?????? ???? ?"
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> --
> ==================================================
> Benjamin Galuardi
> PhD Student
> NMFS-Seagrant Population Dynamics Fellow
> SMAST, UMass Dartmouth
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From tea3rd at gmail.com  Sat Dec 20 18:21:24 2014
From: tea3rd at gmail.com (Thomas Adams)
Date: Sat, 20 Dec 2014 10:21:24 -0700
Subject: [R-sig-Geo] Raster projection alignment issues
In-Reply-To: <C1524BE4BF45454293B8DF38FB9B5ECA178B6B4D@MS-EX1VKS.erdc.dren.mil>
References: <C1524BE4BF45454293B8DF38FB9B5ECA178B6B4D@MS-EX1VKS.erdc.dren.mil>
Message-ID: <CAGxgkWgLtN3jDV_LeE_pwfw1jLAqceHMdkWJMm8VhqhdiNQ76A@mail.gmail.com>

Wade,

I was able to import the data into GRASS GIS (which uses gdal) without any
problems (ultimately); the issue you're having is that the ACTUAL map
projection is either not specified -OR- is specified as 'unprojected',
which is what I think is the case. In reality, the map projection is
latitude-longitude and the data is written that way within the netcdf file.
In GRASS GIS I simply imported the data (a 1-commandline step) directly
into a latitude-longitude GRASS GIS LOCATION, which I already had setup. I
tested by over-laying U.S. state boundaries, which align perfectly. That
the crs is defined as Albers Equal Area in the data set is CLEARLY an error.

Personally, I think you would be far better served to use something like
GRASS GIS for this kind of work; I have had a lot of success doing this.
One very nice feature is that GRASS GIS plays together with R wonderfully,
through the spgrass6 contributed package. Going this direction, allows one
to read/write GRASS raster and vector files into/from R and do any and all
the statistical manipulations you want. Additionally, I think for many
things, you'll find you don't need R, like simple data visualization and
most raster arithmetic.

Best,
Tom


On Fri, Dec 19, 2014 at 7:34 AM, Wall, Wade A ERDC-RDE-CERL-IL <
Wade.A.Wall at usace.army.mil> wrote:
>
> Hi all,
>
> I posted this over at gis.stackexchange.com, but thought this user group
> may be interested.
>
> I downloaded  raster data from
> http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcomein
>
> The BCSD-CMIP5 data is found under the tab "Projections: Complete
> Archives".
> The files are in netCDF format, but am running into some issues. The
> original raster data (let's call it rast1) when imported has the extent
>
> xmin 235.25
> xmax 293
> ymin 25.125
> ymax 52.875
>
> and a crs of +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
> +towgs84=0,0,0
>
> The other objects (both sp and raster) I am working with contain negative
> values for xmin and xmax
>
>
> xmin        : -122.8021
>
> xmax        : -75.38249
>
> ymin        : 31.78881
>
> ymax        : 47.15952
>
>
>
> When I attempt to reproject the raster data into Albers Equal Area
> (+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0
> +datum=NAD83
>
> +units=m +no_defs +ellps=GRS80+towgs84=0,0,0)using the following code:
>
>
>
> rast_new = projectRaster(rast1, rast2) ## rast2 is a raster with the crs
> for Albers Equal Area
>
>
>
> the extents still don't line up, so I have to do the following.
>
>
>
> rast_new = projectExtent(rast1,rast2)
>
> rast_new = projectRaster(rast1,rast_new)
>
> values(rast_new) = values(rast1) ### This is necessary because all the
> values were NA
>
>
>
> However, rast_new, even though its crs is defined as Albers Equal Area,
> does not project correctly. Even when I export these files from R and open
> in ArcGIS, the issues persist. However, if I import the netCDF files
> directly into ArcGIS and reproject, there are no problems.
>
>
>
> Any clues as to what I am doing wrong?
>
>
>
> Thanks for any assistance.
>
>
> Wade A. Wall
> US Army ERDC-CERL
> P.O. Box 9005
> Champaign, IL  61826-9005
> 1-217-373-4420
> Wade.A.Wall at usace.army.mil
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From kzhang at geo.ecnu.edu.cn  Sun Dec 21 15:19:44 2014
From: kzhang at geo.ecnu.edu.cn (kun17)
Date: Sun, 21 Dec 2014 07:19:44 -0700 (MST)
Subject: [R-sig-Geo] about global getis g
Message-ID: <1419171584771-7587571.post@n2.nabble.com>

cold.zip <http://r-sig-geo.2731867.n2.nabble.com/file/n7587571/cold.zip>  

hello everyone,

I have designed a random grid file and put a 'cold spots' in the center, I
used globalG.test in spdep package to test the 'cold spots',but the results
made me confused, below is my code:

library(spdep)
library(maptools)
simu=readShapeSpatial("C:/GridCold.shp")
dists=1:12 
n=length(dists)
GG=EG=VG=ZG=pvalue=numeric(length=n)

coord=coordinates(simu)
for(i in 1:n){
	dnb=dnearneigh(coord,0,dists[i]) 
	simu.w=nb2listw(dnb,style="B",zero.policy=TRUE)	
	G=globalG.test(simu$value,simu.w,zero.policy=TRUE,alternative="two.sided")
	GG[i]=G$estimate[1]
	EG[i]=G$estimate[2]
	VG[i]=G$estimate[3]
	ZG[i]=G$statistic
	pvalue[i]=G$p.value
}
cbind(dists,GG,EG,VG,ZG,pvalue)

the results is:

    dists         GG         EG           VG         ZG       pvalue
 [1,]     1 0.01326694 0.01307190 1.127119e-09  5.8097284 6.257426e-09
 [2,]     2 0.03791890 0.03762976 1.456950e-08  2.3954667 1.659922e-02
 [3,]     3 0.08282060 0.08294887 1.127367e-07 -0.3820144 7.024507e-01
 [4,]     4 0.13412895 0.13528451 3.728269e-07 -1.8925080 5.842333e-02
 [5,]     5 0.20749034 0.21073626 1.131177e-06 -3.0519145 2.273869e-03
 [6,]     6 0.27401114 0.27974817 2.170007e-06 -3.8945442 9.838356e-05
 [7,]     7 0.34154256 0.35049020 3.542196e-06 -4.7541397 1.992932e-06
 [8,]     8 0.42087567 0.43444829 5.557734e-06 -5.7572477 8.549642e-09
 [9,]     9 0.50377144 0.52100154 7.538721e-06 -6.2753643 3.488166e-10
[10,]    10 0.58757397 0.60659362 8.890566e-06 -6.3787831 1.785007e-10
[11,]    11 0.65976673 0.67685506 8.894732e-06 -5.7297151 1.005995e-08
[12,]    12 0.72722625 0.74144560 8.057964e-06 -5.0091840 5.466130e-07

the first two rows with distance 1 and 2 indicate significant 'hot spots'!
when I use CrimeStat to calculate global G, when distance is 1 and 2,the
results are both not significant.

Could someone explain the difference?

thank you!

Kun



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/about-global-getis-g-tp7587571.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Mon Dec 22 18:30:50 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 22 Dec 2014 18:30:50 +0100
Subject: [R-sig-Geo] about global getis g
In-Reply-To: <1419171584771-7587571.post@n2.nabble.com>
References: <1419171584771-7587571.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1412221814580.3260@reclus.nhh.no>

On Sun, 21 Dec 2014, kun17 wrote:

> cold.zip <http://r-sig-geo.2731867.n2.nabble.com/file/n7587571/cold.zip>
>
> hello everyone,
>
> I have designed a random grid file and put a 'cold spots' in the center, I
> used globalG.test in spdep package to test the 'cold spots',but the results
> made me confused, below is my code:
>
> library(spdep)
> library(maptools)
> simu=readShapeSpatial("C:/GridCold.shp")
> dists=1:12
> n=length(dists)
> GG=EG=VG=ZG=pvalue=numeric(length=n)
>
> coord=coordinates(simu)
> for(i in 1:n){
> 	dnb=dnearneigh(coord,0,dists[i])
> 	simu.w=nb2listw(dnb,style="B",zero.policy=TRUE)
> 	G=globalG.test(simu$value,simu.w,zero.policy=TRUE,alternative="two.sided")
> 	GG[i]=G$estimate[1]
> 	EG[i]=G$estimate[2]
> 	VG[i]=G$estimate[3]
> 	ZG[i]=G$statistic
> 	pvalue[i]=G$p.value
> }
> cbind(dists,GG,EG,VG,ZG,pvalue)
>
> the results is:
>
>    dists         GG         EG           VG         ZG       pvalue
> [1,]     1 0.01326694 0.01307190 1.127119e-09  5.8097284 6.257426e-09
> [2,]     2 0.03791890 0.03762976 1.456950e-08  2.3954667 1.659922e-02
> [3,]     3 0.08282060 0.08294887 1.127367e-07 -0.3820144 7.024507e-01
> [4,]     4 0.13412895 0.13528451 3.728269e-07 -1.8925080 5.842333e-02
> [5,]     5 0.20749034 0.21073626 1.131177e-06 -3.0519145 2.273869e-03
> [6,]     6 0.27401114 0.27974817 2.170007e-06 -3.8945442 9.838356e-05
> [7,]     7 0.34154256 0.35049020 3.542196e-06 -4.7541397 1.992932e-06
> [8,]     8 0.42087567 0.43444829 5.557734e-06 -5.7572477 8.549642e-09
> [9,]     9 0.50377144 0.52100154 7.538721e-06 -6.2753643 3.488166e-10
> [10,]    10 0.58757397 0.60659362 8.890566e-06 -6.3787831 1.785007e-10
> [11,]    11 0.65976673 0.67685506 8.894732e-06 -5.7297151 1.005995e-08
> [12,]    12 0.72722625 0.74144560 8.057964e-06 -5.0091840 5.466130e-07
>
> the first two rows with distance 1 and 2 indicate significant 'hot spots'!
> when I use CrimeStat to calculate global G, when distance is 1 and 2,the
> results are both not significant.
>
> Could someone explain the difference?

The Crimestat IV values are:

> CS
     d        G       EG      SEG        ZG
V2  1 0.013267 0.013072 0.000262  0.745199
V3  2 0.037919 0.037630 0.000457  0.632980
V4  3 0.082821 0.082949 0.000736 -0.174370
V5  4 0.134129 0.135285 0.001036 -1.115844
V6  5 0.207490 0.210736 0.001491 -2.176953
V7  6 0.274011 0.279748 0.001903 -3.014358
V8  7 0.341543 0.350490 0.002316 -3.862926
V9  8 0.420876 0.434448 0.002797 -4.852804
V10 9 0.503771 0.521002 0.003203 -5.378934

which agree on G and E(G), but not beyond that. Ch 5 of the Crimestat 
manual has an error for B1, equation 5.21, which does not take into 
account the erratum published by the authors in 1993: "On page 195, the 
coefficient of W2 in B1, (just below center of the page) should be 6, not 
3.". However, this doesn't seem to be the only problem, as the spdep code 
when modified not to correct B1 doesn't reproduce the CrimeStat Standard 
error of "G" values.

Since CrimeStat is closed-source, and since we can show an error in their 
documentation, I suggest that you take this up with them, pointing out 
their not accommodating an erratum (there were more) published over twenty 
years ago, ask for a clarification, and report back here when they say 
what they are actually doing. The source to globalG.test() is readable, so 
they can readily check what it does.

Hope this helps,

Roger

>
> thank you!
>
> Kun
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/about-global-getis-g-tp7587571.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Wade.A.Wall at usace.army.mil  Mon Dec 22 19:23:44 2014
From: Wade.A.Wall at usace.army.mil (Wall, Wade A ERDC-RDE-CERL-IL)
Date: Mon, 22 Dec 2014 18:23:44 +0000
Subject: [R-sig-Geo] [EXTERNAL] Re:  Raster projection alignment issues
In-Reply-To: <CANtt_hxRQS7vageCJ22FGi=uKN=uO3CaKA95=32_DJExMbM1Eg@mail.gmail.com>
References: <C1524BE4BF45454293B8DF38FB9B5ECA178B6B4D@MS-EX1VKS.erdc.dren.mil>
	<CANtt_hxRQS7vageCJ22FGi=uKN=uO3CaKA95=32_DJExMbM1Eg@mail.gmail.com>
Message-ID: <C1524BE4BF45454293B8DF38FB9B5ECA178B7693@MS-EX1VKS.erdc.dren.mil>

Thanks Dr. Hijmans,

That is a very simple solution. I had tried changing the extent by using other objects, but not directly manipulating the extent.

Wade 



-----Original Message-----
From: Robert J. Hijmans [mailto:r.hijmans at gmail.com] 
Sent: Saturday, December 20, 2014 12:24 AM
To: Wall, Wade A ERDC-RDE-CERL-IL
Cc: r-sig-geo at r-project.org
Subject: [EXTERNAL] Re: [R-sig-Geo] Raster projection alignment issues

Wade,

I do not think you are doing anything wrong. projectRaster gets confused because of the uncommon longitude coordinates used by climate models (0 to 360, rather than -180 to 180) You can use the 'rotate' function to fix that (ignore the warning), or by setting the extent, and then proceed. See below.

Robert

library(raster)
r <- raster(xmn=235.25, xmx=293, ymn=25.125, ymx=52.875, res=1/8, crs='+proj=longlat +datum=WGS84') rr <- rotate(r)

## or something like
## extent(r) <- extent(235.25-360, 293-360, 25.125, 52.875)

aea <- '+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0
+y_0=0 +datum=NAD83'

library(maptools)
data(wrld_simpl)
us <- wrld_simpl[wrld_simpl$ISO3=='USA', ]

library(rgdal)
usa <- spTransform(us, CRS(aea))
rra <- projectRaster(rr, crs=aea)

plot(rra)
plot(usa, add=TRUE)




by the way. this is almost certainly a bad idea:
values(rast_new) = values(rast1) ### This is necessary because all the values were NA

On Fri, Dec 19, 2014 at 6:34 AM, Wall, Wade A ERDC-RDE-CERL-IL <Wade.A.Wall at usace.army.mil> wrote:
> Hi all,
>
> I posted this over at gis.stackexchange.com, but thought this user group may be interested.
>
> I downloaded  raster data from  
> http://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.htm
> l#Welcomein
>
> The BCSD-CMIP5 data is found under the tab "Projections: Complete Archives".
> The files are in netCDF format, but am running into some issues. The 
> original raster data (let's call it rast1) when imported has the 
> extent
>
> xmin 235.25
> xmax 293
> ymin 25.125
> ymax 52.875
>
> and a crs of +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 
> +towgs84=0,0,0
>
> The other objects (both sp and raster) I am working with contain 
> negative values for xmin and xmax
>
>
> xmin        : -122.8021
>
> xmax        : -75.38249
>
> ymin        : 31.78881
>
> ymax        : 47.15952
>
>
>
> When I attempt to reproject the raster data into Albers Equal Area 
> (+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 
> +datum=NAD83
>
> +units=m +no_defs +ellps=GRS80+towgs84=0,0,0)using the following code:
>
>
>
> rast_new = projectRaster(rast1, rast2) ## rast2 is a raster with the 
> crs for Albers Equal Area
>
>
>
> the extents still don't line up, so I have to do the following.
>
>
>
> rast_new = projectExtent(rast1,rast2)
>
> rast_new = projectRaster(rast1,rast_new)
>
> values(rast_new) = values(rast1) ### This is necessary because all the 
> values were NA
>
>
>
> However, rast_new, even though its crs is defined as Albers Equal Area, does not project correctly. Even when I export these files from R and open in ArcGIS, the issues persist. However, if I import the netCDF files directly into ArcGIS and reproject, there are no problems.
>
>
>
> Any clues as to what I am doing wrong?
>
>
>
> Thanks for any assistance.
>
>
> Wade A. Wall
> US Army ERDC-CERL
> P.O. Box 9005
> Champaign, IL  61826-9005
> 1-217-373-4420
> Wade.A.Wall at usace.army.mil
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From ROONEYJ4 at tcd.ie  Tue Dec 23 16:43:20 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Tue, 23 Dec 2014 15:43:20 +0000
Subject: [R-sig-Geo] readOGR problem in Windows
Message-ID: <1A6C48C89F85014B84B487A91A4E533B030AE52E8908@GOMAIL.college.tcd.ie>

Dear List,

I have some code I have developed on a Mac that I'm trying to transfer onto a higher spec windows 8.1 machine and I am running into a problem with the readOGR function in rgdal.

My code is below. This works fine under Mac, but under windows readOGR gives me the error:
"Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv, :
Cannot open file "

The rgdal version on the Mac is rgdal_0.8-16
whilst on Win 8.1 is rgdal 0.9-1

The preceding read.csv statement works just fine.
Any ideas anyone ?
Thanks,
James


Code:

library(rgdal)
library(rgeos)
library(maptools)
library(RColorBrewer)
library(classInt)
library(ggplot2)
library(INLA)


# Set working directory
setwd("/Users/james/Project Work")

source("R_Files/Ireland - General Functions/SA.data-prep.functions.R")

# Load soils databse
soils <- read.csv("Irish Data/NSDB_SA_kriged.csv", header=TRUE)

# Load shape files and data file
SA <- readOGR("./Irish Data/Processed Data/","SA.basic.analysis.shapes",TRUE)

From tech_dev at wildintellect.com  Tue Dec 23 17:43:10 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Tue, 23 Dec 2014 08:43:10 -0800
Subject: [R-sig-Geo] readOGR problem in Windows
In-Reply-To: <1A6C48C89F85014B84B487A91A4E533B030AE52E8908@GOMAIL.college.tcd.ie>
References: <1A6C48C89F85014B84B487A91A4E533B030AE52E8908@GOMAIL.college.tcd.ie>
Message-ID: <54999B9E.7030705@wildintellect.com>

On 12/23/2014 07:43 AM, James Rooney wrote:
> Dear List,
> 
> I have some code I have developed on a Mac that I'm trying to transfer onto a higher spec windows 8.1 machine and I am running into a problem with the readOGR function in rgdal.
> 
> My code is below. This works fine under Mac, but under windows readOGR gives me the error:
> "Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv, :
> Cannot open file "
> 
> The rgdal version on the Mac is rgdal_0.8-16
> whilst on Win 8.1 is rgdal 0.9-1
> 
> The preceding read.csv statement works just fine.
> Any ideas anyone ?
> Thanks,
> James
> 
> 
> Code:
> 
> library(rgdal)
> library(rgeos)
> library(maptools)
> library(RColorBrewer)
> library(classInt)
> library(ggplot2)
> library(INLA)
> 
> 
> # Set working directory
> setwd("/Users/james/Project Work")
> 
^^ Pretty sure this line would fail on windows, so your code won't be
running in the correct directory when it gets to the readOGR later.
Windows absolute paths start with a drive letter.

> source("R_Files/Ireland - General Functions/SA.data-prep.functions.R")
> 
> # Load soils databse
> soils <- read.csv("Irish Data/NSDB_SA_kriged.csv", header=TRUE)
>
Though you say this one works? odd?

> # Load shape files and data file
> SA <- readOGR("./Irish Data/Processed Data/","SA.basic.analysis.shapes",TRUE)
>
No idea what Windows does with ./

Overall I think you need to verify the path that R is on, and that it
can actually see the files before it tries to load them.

Thanks,
Alex


From ROONEYJ4 at tcd.ie  Tue Dec 23 20:34:56 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Tue, 23 Dec 2014 19:34:56 +0000
Subject: [R-sig-Geo] readOGR problem in Windows
In-Reply-To: <54999B9E.7030705@wildintellect.com>
References: <1A6C48C89F85014B84B487A91A4E533B030AE52E8908@GOMAIL.college.tcd.ie>,
	<54999B9E.7030705@wildintellect.com>
Message-ID: <1A6C48C89F85014B84B487A91A4E533B030AE52E8909@GOMAIL.college.tcd.ie>

Hi Alex,

Doh! I cut and paste the mac version. The windows version that is not working looks as below.
The read.csv's work no problem - but read OGR won't work even with absolute paths. So I think it is not related to directory paths unless readOGR is someone different in this regard.
James
Correct Code:

library(rgdal)
library(rgeos)
library(maptools)
library(RColorBrewer)
library(classInt)
library(ggplot2)
library(INLA)


# Set working directory
#setwd("/Users/james/Project Work/ALS Spatial - Advanced")
setwd("C:/Users/james/Project Work/ALS Spatial - Advanced")

source("R_Files/Ireland - General Functions/SA.data-prep.functions.R")

# Load soils databse
soils <- read.csv("Irish Data/Soil Database/NSDB_SA_kriged.csv", header=TRUE)

# Load shape files and data file
SA <- readOGR("./Irish Data/Processed Data/","SA.basic.analysis.shapes",TRUE)
df <- read.csv("./Irish Data/Processed Data/SA.basic.analysis.data.csv", header=TRUE)
SA at data = data.frame(SA at data, df[match(SA at data$SA_CODE, df$SA_CODE),])


________________________________________
From: Alex Mandel [tech_dev at wildintellect.com]
Sent: 23 December 2014 16:43
To: James Rooney; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] readOGR problem in Windows

On 12/23/2014 07:43 AM, James Rooney wrote:
> Dear List,
>
> I have some code I have developed on a Mac that I'm trying to transfer onto a higher spec windows 8.1 machine and I am running into a problem with the readOGR function in rgdal.
>
> My code is below. This works fine under Mac, but under windows readOGR gives me the error:
> "Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv, :
> Cannot open file "
>
> The rgdal version on the Mac is rgdal_0.8-16
> whilst on Win 8.1 is rgdal 0.9-1
>
> The preceding read.csv statement works just fine.
> Any ideas anyone ?
> Thanks,
> James
>
>
> Code:
>
> library(rgdal)
> library(rgeos)
> library(maptools)
> library(RColorBrewer)
> library(classInt)
> library(ggplot2)
> library(INLA)
>
>
> # Set working directory
> setwd("/Users/james/Project Work")
>
^^ Pretty sure this line would fail on windows, so your code won't be
running in the correct directory when it gets to the readOGR later.
Windows absolute paths start with a drive letter.

> source("R_Files/Ireland - General Functions/SA.data-prep.functions.R")
>
> # Load soils databse
> soils <- read.csv("Irish Data/NSDB_SA_kriged.csv", header=TRUE)
>
Though you say this one works? odd?

> # Load shape files and data file
> SA <- readOGR("./Irish Data/Processed Data/","SA.basic.analysis.shapes",TRUE)
>
No idea what Windows does with ./

Overall I think you need to verify the path that R is on, and that it
can actually see the files before it tries to load them.

Thanks,
Alex


From mdsumner at gmail.com  Tue Dec 23 22:00:28 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 23 Dec 2014 21:00:28 +0000
Subject: [R-sig-Geo] readOGR problem in Windows
References: <1A6C48C89F85014B84B487A91A4E533B030AE52E8908@GOMAIL.college.tcd.ie>
	<54999B9E.7030705@wildintellect.com>
	<1A6C48C89F85014B84B487A91A4E533B030AE52E8909@GOMAIL.college.tcd.ie>
Message-ID: <CAAcGz98YOx1aMm33NsCKV-LFmGFWW0Fn31X8bLPtzo7++0kLxQ@mail.gmail.com>

Try removing the trailing slash from the dsn path.

HTH

On Wed, 24 Dec 2014 06:38 James Rooney <ROONEYJ4 at tcd.ie> wrote:

> Hi Alex,
>
> Doh! I cut and paste the mac version. The windows version that is not
> working looks as below.
> The read.csv's work no problem - but read OGR won't work even with
> absolute paths. So I think it is not related to directory paths unless
> readOGR is someone different in this regard.
> James
> Correct Code:
>
> library(rgdal)
> library(rgeos)
> library(maptools)
> library(RColorBrewer)
> library(classInt)
> library(ggplot2)
> library(INLA)
>
>
> # Set working directory
> #setwd("/Users/james/Project Work/ALS Spatial - Advanced")
> setwd("C:/Users/james/Project Work/ALS Spatial - Advanced")
>
> source("R_Files/Ireland - General Functions/SA.data-prep.functions.R")
>
> # Load soils databse
> soils <- read.csv("Irish Data/Soil Database/NSDB_SA_kriged.csv",
> header=TRUE)
>
> # Load shape files and data file
> SA <- readOGR("./Irish Data/Processed Data/","SA.basic.analysis.
> shapes",TRUE)
> df <- read.csv("./Irish Data/Processed Data/SA.basic.analysis.data.csv",
> header=TRUE)
> SA at data = data.frame(SA at data, df[match(SA at data$SA_CODE, df$SA_CODE),])
>
>
> ________________________________________
> From: Alex Mandel [tech_dev at wildintellect.com]
> Sent: 23 December 2014 16:43
> To: James Rooney; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] readOGR problem in Windows
>
> On 12/23/2014 07:43 AM, James Rooney wrote:
> > Dear List,
> >
> > I have some code I have developed on a Mac that I'm trying to transfer
> onto a higher spec windows 8.1 machine and I am running into a problem with
> the readOGR function in rgdal.
> >
> > My code is below. This works fine under Mac, but under windows readOGR
> gives me the error:
> > "Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding,
> use_iconv = use_iconv, :
> > Cannot open file "
> >
> > The rgdal version on the Mac is rgdal_0.8-16
> > whilst on Win 8.1 is rgdal 0.9-1
> >
> > The preceding read.csv statement works just fine.
> > Any ideas anyone ?
> > Thanks,
> > James
> >
> >
> > Code:
> >
> > library(rgdal)
> > library(rgeos)
> > library(maptools)
> > library(RColorBrewer)
> > library(classInt)
> > library(ggplot2)
> > library(INLA)
> >
> >
> > # Set working directory
> > setwd("/Users/james/Project Work")
> >
> ^^ Pretty sure this line would fail on windows, so your code won't be
> running in the correct directory when it gets to the readOGR later.
> Windows absolute paths start with a drive letter.
>
> > source("R_Files/Ireland - General Functions/SA.data-prep.functions.R")
> >
> > # Load soils databse
> > soils <- read.csv("Irish Data/NSDB_SA_kriged.csv", header=TRUE)
> >
> Though you say this one works? odd?
>
> > # Load shape files and data file
> > SA <- readOGR("./Irish Data/Processed Data/","SA.basic.analysis.
> shapes",TRUE)
> >
> No idea what Windows does with ./
>
> Overall I think you need to verify the path that R is on, and that it
> can actually see the files before it tries to load them.
>
> Thanks,
> Alex
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From ROONEYJ4 at tcd.ie  Tue Dec 23 22:11:52 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Tue, 23 Dec 2014 21:11:52 +0000
Subject: [R-sig-Geo] readOGR problem in Windows
In-Reply-To: <CAAcGz98YOx1aMm33NsCKV-LFmGFWW0Fn31X8bLPtzo7++0kLxQ@mail.gmail.com>
References: <1A6C48C89F85014B84B487A91A4E533B030AE52E8908@GOMAIL.college.tcd.ie>
	<54999B9E.7030705@wildintellect.com>
	<1A6C48C89F85014B84B487A91A4E533B030AE52E8909@GOMAIL.college.tcd.ie>,
	<CAAcGz98YOx1aMm33NsCKV-LFmGFWW0Fn31X8bLPtzo7++0kLxQ@mail.gmail.com>
Message-ID: <1A6C48C89F85014B84B487A91A4E533B030AE52E890A@GOMAIL.college.tcd.ie>

Fantastic! That fixed it.

Thanks much appreciated!
James
________________________________________
From: Michael Sumner [mdsumner at gmail.com]
Sent: 23 December 2014 21:00
To: James Rooney; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] readOGR problem in Windows

Try removing the trailing slash from the dsn path.

HTH

On Wed, 24 Dec 2014 06:38 James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>> wrote:
Hi Alex,

Doh! I cut and paste the mac version. The windows version that is not working looks as below.
The read.csv's work no problem - but read OGR won't work even with absolute paths. So I think it is not related to directory paths unless readOGR is someone different in this regard.
James
Correct Code:

library(rgdal)
library(rgeos)
library(maptools)
library(RColorBrewer)
library(classInt)
library(ggplot2)
library(INLA)


# Set working directory
#setwd("/Users/james/Project Work/ALS Spatial - Advanced")
setwd("C:/Users/james/Project Work/ALS Spatial - Advanced")

source("R_Files/Ireland - General Functions/SA.data-prep.functions.R")

# Load soils databse
soils <- read.csv("Irish Data/Soil Database/NSDB_SA_kriged.csv", header=TRUE)

# Load shape files and data file
SA <- readOGR("./Irish Data/Processed Data/","SA.basic.analysis.shapes",TRUE)
df <- read.csv("./Irish Data/Processed Data/SA.basic.analysis.data.csv", header=TRUE)
SA at data = data.frame(SA at data, df[match(SA at data$SA_CODE, df$SA_CODE),])


________________________________________
From: Alex Mandel [tech_dev at wildintellect.com<mailto:tech_dev at wildintellect.com>]
Sent: 23 December 2014 16:43
To: James Rooney; r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] readOGR problem in Windows

On 12/23/2014 07:43 AM, James Rooney wrote:
> Dear List,
>
> I have some code I have developed on a Mac that I'm trying to transfer onto a higher spec windows 8.1 machine and I am running into a problem with the readOGR function in rgdal.
>
> My code is below. This works fine under Mac, but under windows readOGR gives me the error:
> "Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv, :
> Cannot open file "
>
> The rgdal version on the Mac is rgdal_0.8-16
> whilst on Win 8.1 is rgdal 0.9-1
>
> The preceding read.csv statement works just fine.
> Any ideas anyone ?
> Thanks,
> James
>
>
> Code:
>
> library(rgdal)
> library(rgeos)
> library(maptools)
> library(RColorBrewer)
> library(classInt)
> library(ggplot2)
> library(INLA)
>
>
> # Set working directory
> setwd("/Users/james/Project Work")
>
^^ Pretty sure this line would fail on windows, so your code won't be
running in the correct directory when it gets to the readOGR later.
Windows absolute paths start with a drive letter.

> source("R_Files/Ireland - General Functions/SA.data-prep.functions.R")
>
> # Load soils databse
> soils <- read.csv("Irish Data/NSDB_SA_kriged.csv", header=TRUE)
>
Though you say this one works? odd?

> # Load shape files and data file
> SA <- readOGR("./Irish Data/Processed Data/","SA.basic.analysis.shapes",TRUE)
>
No idea what Windows does with ./

Overall I think you need to verify the path that R is on, and that it
can actually see the files before it tries to load them.

Thanks,
Alex

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From kzhang at geo.ecnu.edu.cn  Wed Dec 24 01:51:16 2014
From: kzhang at geo.ecnu.edu.cn (kun17)
Date: Tue, 23 Dec 2014 17:51:16 -0700 (MST)
Subject: [R-sig-Geo] about global getis g
In-Reply-To: <alpine.LRH.2.03.1412221814580.3260@reclus.nhh.no>
References: <1419171584771-7587571.post@n2.nabble.com>
	<alpine.LRH.2.03.1412221814580.3260@reclus.nhh.no>
Message-ID: <1419382276302-7587579.post@n2.nabble.com>

Thank you Roger, your professional knowledge has rebuilt my confidence in
spdep.

As to the example, I have a new understanding: when a 'cold spots' was put
in the center, the surrounding grids became 'hot spots' relatively, it
explained the result when distance was set to 1 unit. The idea of 'high' and
'low' in global G is comparative, not measured by mean value.

I will take the example to CrimeStat.

Merry Chrismas everyone!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/about-global-getis-g-tp7587571p7587579.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From kzhang at geo.ecnu.edu.cn  Thu Dec 25 10:43:37 2014
From: kzhang at geo.ecnu.edu.cn (kun17)
Date: Thu, 25 Dec 2014 02:43:37 -0700 (MST)
Subject: [R-sig-Geo] maptools issue
Message-ID: <1419500616999-7587580.post@n2.nabble.com>

Hi all,

I want to use maptools to plot map, there are many plot examples in the
document, but I can not find the usage explaination for plot function as
well as the possible parameters.

Could someone give me advice?

Kun






--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/maptools-issue-tp7587580.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From macqueen1 at llnl.gov  Fri Dec 26 17:58:41 2014
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Fri, 26 Dec 2014 16:58:41 +0000
Subject: [R-sig-Geo] maptools issue
In-Reply-To: <1419500616999-7587580.post@n2.nabble.com>
References: <1419500616999-7587580.post@n2.nabble.com>
Message-ID: <D0C2CED6.116DD8%macqueen1@llnl.gov>

The first thing to do is to find out the class of the object you are
plotting. For example, in this example:

library(maptools)
xx <- readShapePoints(system.file("shapes/baltim.shp",
package="maptools")[1])
plot(xx)

Then:
>  class(xx)
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"



This indicates that you are using the plot() function from the sp package.

> find('plot')
[1] "package:sp"       "package:graphics"


The plot function in the sp package is built on the plot function in the
graphics package, that is, the  plot() that is included with R. This
implies that the possible arguments include those of the basic plot
function. For example:

plot(xx, cex=2)
plot(xx, cex=2, col='red', pch=4)


Exactly what the additional arguments do depends on the class of the
object you're plotting.

For lines objects, see ?lines
For polygon objects, see ?polygons
For points objects, see ?points

(that list is an abbreviated version of Table 3.2 in the book Applied
Spatial Data Analysis with R, by Bivand, Pebesma, and Gomez-Rubio; get a
copy if you can!)

Final suggestion; if you are using the "read" functions from maptools as
in the example above, I would suggest installing the rgdal package and
using readOGR() instead. I think you will be better off in the long run
(and I'm pretty sure this is what the experts have been recommending).

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 12/25/14, 1:43 AM, "kun17" <kzhang at geo.ecnu.edu.cn> wrote:

>Hi all,
>
>I want to use maptools to plot map, there are many plot examples in the
>document, but I can not find the usage explaination for plot function as
>well as the possible parameters.
>
>Could someone give me advice?
>
>Kun
>
>
>
>
>
>
>--
>View this message in context:
>http://r-sig-geo.2731867.n2.nabble.com/maptools-issue-tp7587580.html
>Sent from the R-sig-geo mailing list archive at Nabble.com.
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From kzhang at geo.ecnu.edu.cn  Sat Dec 27 09:24:17 2014
From: kzhang at geo.ecnu.edu.cn (kun17)
Date: Sat, 27 Dec 2014 01:24:17 -0700 (MST)
Subject: [R-sig-Geo] maptools issue
In-Reply-To: <D0C2CED6.116DD8%macqueen1@llnl.gov>
References: <1419500616999-7587580.post@n2.nabble.com>
	<D0C2CED6.116DD8%macqueen1@llnl.gov>
Message-ID: <1419668657845-7587582.post@n2.nabble.com>

Don, thank you for your detailed answer!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/maptools-issue-tp7587580p7587582.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From sharu786786 at gmail.com  Sat Dec 27 20:34:51 2014
From: sharu786786 at gmail.com (sharoze ali)
Date: Sun, 28 Dec 2014 01:04:51 +0530
Subject: [R-sig-Geo] How to read simple raster data
Message-ID: <CAJudS0wuNck-EmkmApftpesGgrYPofaqQxRDhQ6PfAvk-LrFZQ@mail.gmail.com>

Hi All

Iam new to this convention \format " Simple raster format " . My intention
is to use the data of the book " two-dimensional phase unwrapping theory
algorithms and software " which is in raster format . The link for data is "
ftp://ftp.wiley.com/sci_tech_med/phase_unwrapping/ " . Can anyone help me
on this . I want to use/convert the *RASTER DATA TO MATRIX* so that i can
use the my  matlab programs . Please help !!!

Best Regards,
Sharoze Ali ,
Sharu786786 at gmail.com

	[[alternative HTML version deleted]]


From ortiz-bobea at rff.org  Sun Dec 28 16:46:01 2014
From: ortiz-bobea at rff.org (Ariel Ortiz-Bobea)
Date: Sun, 28 Dec 2014 08:46:01 -0700 (MST)
Subject: [R-sig-Geo] Creating neighbors base on the distance between
 different regions' nearest edge
In-Reply-To: <1418634270425-7587545.post@n2.nabble.com>
References: <1418634270425-7587545.post@n2.nabble.com>
Message-ID: <1419781561953-7587584.post@n2.nabble.com>

I don't think there's a built-in function that allows you to do that. What I
would do is to:

1- convert each polygon into a set of points

2- loop over pair of polygons (set of points): A- compute all the distances
between points across the 2 sets using a distance function like spDistsN1,
B- get the minimum .

This might take a long time to compute with a very large number of points
because you need to compute all distance pairs? I don't see how you can
avoid that.



-----
Ariel Ortiz-Bobea
Assistant Profesor in Applied Economics and Management
Cornell University
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Creating-neighbors-base-on-the-distance-between-different-regions-nearest-edge-tp7587545p7587584.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From galuardi at mit.edu  Mon Dec 29 16:14:20 2014
From: galuardi at mit.edu (Benjamin.Galuardi)
Date: Mon, 29 Dec 2014 10:14:20 -0500
Subject: [R-sig-Geo] How to read simple raster data
In-Reply-To: <CAJudS0wuNck-EmkmApftpesGgrYPofaqQxRDhQ6PfAvk-LrFZQ@mail.gmail.com>
References: <CAJudS0wuNck-EmkmApftpesGgrYPofaqQxRDhQ6PfAvk-LrFZQ@mail.gmail.com>
Message-ID: <54A16FCC.90900@mit.edu>

Hi Sharoze,

The data appear to be in hexadecimal form. I think Matlab is capable of 
importing this directly (fread??) but I'm not sure. If you need to use 
R, you might try this example:

library(fields)
hdat =  readBin('C:/Downloads/data/isola.157x458.phase', what = 'raw', 
size=1, n = 157*458)

ndat = strtoi(pdat)  # converts from hex to numeric, assuming it is 
supposed to be numeric..

image.plot(matrix(ndat, nrow=157, ncol=458))

according to the documentation, the '.surf' files are 4 byte, so change 
size=4 for those.

hope that helps,

Ben


On 12/27/2014 2:34 PM, sharoze ali wrote:
> Hi All
>
> Iam new to this convention \format " Simple raster format " . My intention
> is to use the data of the book " two-dimensional phase unwrapping theory
> algorithms and software " which is in raster format . The link for data is "
> ftp://ftp.wiley.com/sci_tech_med/phase_unwrapping/ " . Can anyone help me
> on this . I want to use/convert the *RASTER DATA TO MATRIX* so that i can
> use the my  matlab programs . Please help !!!
>
> Best Regards,
> Sharoze Ali ,
> Sharu786786 at gmail.com
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> -- 
> ==================================================
> Benjamin Galuardi
> PhD Student
> NMFS-Seagrant Population Dynamics Fellow
> SMAST, UMass Dartmouth
> ================================================


From noreply+2872486877 at badoo.com  Tue Dec 30 03:32:28 2014
From: noreply+2872486877 at badoo.com (Mario Montecinos)
Date: Tue, 30 Dec 2014 02:32:28 +0000
Subject: [R-sig-Geo] =?utf-8?q?=E2=98=85_R_Sig_Geo=2C_Mario_Montecinos_te_?=
	=?utf-8?q?ha_dejado_un_mensaje?=
Message-ID: <20141230023228.5BBB8D6604E@cluster2033.monopost.com>

Mario Montecinos  te ha dejado un mensaje

Este mensaje es personal. Solo t? y su remitente ten?is acceso a ?l y te recordamos que lo puedes eliminar en cualquier momento. Si quieres responder puedes hacerlo desde el chat. Para leer tu mensaje, haz clic en el siguiente enlace:
http://us1.badoo.com/mario.montecinos.4/in/lEHIx6.FmTo/?lang_id=7&g=57-0-4&m=63&mid=54a20ebb000000000007004d04b27bbb021fda42000b


Si al hacer clic en el enlace de este mensaje no funciona, copia y p?galo en la barra de tu navegador.


Este email es parte del proceso de entrega del mensaje enviado por Mario Montecinos. Si has recibido este email por error, por favor ign?ralo. En un breve periodo de tiempo ser? eliminado del sistema.


?Div?rtete!
El Equipo de Badoo

Has recibido este email de Badoo Trading Limited (direcci?n postal a continuaci?n). 
Si no deseas recibir comunicaciones por parte de Badoo en el futuro, haz clic aqu? para desactivarlas:
https://us1.badoo.com/impersonation.phtml?lang_id=7&email=r-sig-geo%40r-project.org&block_code=e97454&m=63&mid=54a20ebb000000000007004d04b27bbb021fda42000b&g=0-0-4.
Badoo Trading Limited es una sociedad de responsabilidad limitada registrada en Inglaterra y Gales con n?mero 7540255 y domicilio en Media Village, 131 - 151 Great Titchfield Street, Londres, W1W 5BB.
	[[alternative HTML version deleted]]


From sharu786786 at gmail.com  Tue Dec 30 16:00:24 2014
From: sharu786786 at gmail.com (sharoze ali)
Date: Tue, 30 Dec 2014 20:30:24 +0530
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 136, Issue 24
In-Reply-To: <mailman.13.1419937203.13620.r-sig-geo@r-project.org>
References: <mailman.13.1419937203.13620.r-sig-geo@r-project.org>
Message-ID: <CAJudS0yz=dJF2Ki1VScDR75L3z3gsJH81Qv-TQfF3yPcvq02aQ@mail.gmail.com>

Many Thanks Ben

It worked !!! fread of matlab works and i back scaled the data ...

Thanks again
Sharoze

On Tue, Dec 30, 2014 at 4:30 PM, <r-sig-geo-request at r-project.org> wrote:

> Send R-sig-Geo mailing list submissions to
>         r-sig-geo at r-project.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help' to
>         r-sig-geo-request at r-project.org
>
> You can reach the person managing the list at
>         r-sig-geo-owner at r-project.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of R-sig-Geo digest..."
>
>
> Today's Topics:
>
>    1. Re: How to read simple raster data (Benjamin.Galuardi)
>    2. ? R Sig Geo, Mario Montecinos te ha dejado un mensaje
>       (Mario Montecinos)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Mon, 29 Dec 2014 10:14:20 -0500
> From: "Benjamin.Galuardi" <galuardi at mit.edu>
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] How to read simple raster data
> Message-ID: <54A16FCC.90900 at mit.edu>
> Content-Type: text/plain; charset=windows-1252; format=flowed
>
> Hi Sharoze,
>
> The data appear to be in hexadecimal form. I think Matlab is capable of
> importing this directly (fread??) but I'm not sure. If you need to use
> R, you might try this example:
>
> library(fields)
> hdat =  readBin('C:/Downloads/data/isola.157x458.phase', what = 'raw',
> size=1, n = 157*458)
>
> ndat = strtoi(pdat)  # converts from hex to numeric, assuming it is
> supposed to be numeric..
>
> image.plot(matrix(ndat, nrow=157, ncol=458))
>
> according to the documentation, the '.surf' files are 4 byte, so change
> size=4 for those.
>
> hope that helps,
>
> Ben
>
>
> On 12/27/2014 2:34 PM, sharoze ali wrote:
> > Hi All
> >
> > Iam new to this convention \format " Simple raster format " . My
> intention
> > is to use the data of the book " two-dimensional phase unwrapping theory
> > algorithms and software " which is in raster format . The link for data
> is "
> > ftp://ftp.wiley.com/sci_tech_med/phase_unwrapping/ " . Can anyone help
> me
> > on this . I want to use/convert the *RASTER DATA TO MATRIX* so that i can
> > use the my  matlab programs . Please help !!!
> >
> > Best Regards,
> > Sharoze Ali ,
> > Sharu786786 at gmail.com
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > --
> > ==================================================
> > Benjamin Galuardi
> > PhD Student
> > NMFS-Seagrant Population Dynamics Fellow
> > SMAST, UMass Dartmouth
> > ================================================
>
>
>
> ------------------------------
>
> Message: 2
> Date: Tue, 30 Dec 2014 02:32:28 +0000
> From: Mario Montecinos <noreply+2872486877 at badoo.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] ? R Sig Geo, Mario Montecinos te ha dejado un
>         mensaje
> Message-ID: <20141230023228.5BBB8D6604E at cluster2033.monopost.com>
> Content-Type: text/plain; charset="UTF-8"
>
> Mario Montecinos  te ha dejado un mensaje
>
> Este mensaje es personal. Solo t? y su remitente ten?is acceso a ?l y te
> recordamos que lo puedes eliminar en cualquier momento. Si quieres
> responder puedes hacerlo desde el chat. Para leer tu mensaje, haz clic en
> el siguiente enlace:
>
> http://us1.badoo.com/mario.montecinos.4/in/lEHIx6.FmTo/?lang_id=7&g=57-0-4&m=63&mid=54a20ebb000000000007004d04b27bbb021fda42000b
>
>
> Si al hacer clic en el enlace de este mensaje no funciona, copia y p?galo
> en la barra de tu navegador.
>
>
> Este email es parte del proceso de entrega del mensaje enviado por Mario
> Montecinos. Si has recibido este email por error, por favor ign?ralo. En un
> breve periodo de tiempo ser? eliminado del sistema.
>
>
> ?Div?rtete!
> El Equipo de Badoo
>
> Has recibido este email de Badoo Trading Limited (direcci?n postal a
> continuaci?n).
> Si no deseas recibir comunicaciones por parte de Badoo en el futuro, haz
> clic aqu? para desactivarlas:
>
> https://us1.badoo.com/impersonation.phtml?lang_id=7&email=r-sig-geo%40r-project.org&block_code=e97454&m=63&mid=54a20ebb000000000007004d04b27bbb021fda42000b&g=0-0-4
> .
> Badoo Trading Limited es una sociedad de responsabilidad limitada
> registrada en Inglaterra y Gales con n?mero 7540255 y domicilio en Media
> Village, 131 - 151 Great Titchfield Street, Londres, W1W 5BB.
>         [[alternative HTML version deleted]]
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> ------------------------------
>
> End of R-sig-Geo Digest, Vol 136, Issue 24
> ******************************************
>

	[[alternative HTML version deleted]]


From ekosusilo at live.com  Wed Dec 31 07:22:25 2014
From: ekosusilo at live.com (Eko Susilo)
Date: Wed, 31 Dec 2014 14:22:25 +0800
Subject: [R-sig-Geo] Convert units	hours since 1950-01-01 00:00:00 to date
Message-ID: <BLU437-SMTP20448840CEF26EA6E74FBDD5F0@phx.gbl>

I have a question about converting the time value in my data set 
(global-analysis-forecast-phys-001-002).
For example the time value is 569004 for (2014-11-29) -- hours since 
1950-01-01 00:00:00
How to convert the time value in to date in R ?

I have tried several ways but not work..
 >  timeval <- 569004
 >  as.Date(timeval, origin=c("1950-01-01"))
[1] "3507-11-19"

 > as.Date(as.POSIXct(timeval, origin="1950-01-01"))
[1] "1950-01-07"

regards,
Eko Susilo

	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Wed Dec 31 09:39:12 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 31 Dec 2014 08:39:12 +0000
Subject: [R-sig-Geo] Convert units hours since 1950-01-01 00:00:00 to
	date
In-Reply-To: <BLU437-SMTP20448840CEF26EA6E74FBDD5F0@phx.gbl>
References: <BLU437-SMTP20448840CEF26EA6E74FBDD5F0@phx.gbl>
Message-ID: <CANVKczPJwVhUW8FLWwp5-s3pT-iNaOGje4is1QhEvBPKmJV4kw@mail.gmail.com>

On Wed, Dec 31, 2014 at 6:22 AM, Eko Susilo <ekosusilo at live.com> wrote:
> as.Date(as.POSIXct(timeval, origin="1950-01-01"))


as.Date works with number of days, so try:

 > as.Date(timeval/24, origin="1950-01-01")
 [1] "2014-11-29"

as.POSIXct works with seconds, so try:

 > as.POSIXct(timeval*60*60, origin="1950-01-01")
 [1] "2014-11-29 12:00:00 GMT"

I recommend as.Date if you only want dates and not date-times and your
data is really integer days.

Barry


From ekosusilo at live.com  Wed Dec 31 10:50:59 2014
From: ekosusilo at live.com (Eko Susilo)
Date: Wed, 31 Dec 2014 17:50:59 +0800
Subject: [R-sig-Geo] Convert units hours since 1950-01-01 00:00:00 to
 date
In-Reply-To: <CANVKczPJwVhUW8FLWwp5-s3pT-iNaOGje4is1QhEvBPKmJV4kw@mail.gmail.com>
References: <BLU437-SMTP20448840CEF26EA6E74FBDD5F0@phx.gbl>
	<CANVKczPJwVhUW8FLWwp5-s3pT-iNaOGje4is1QhEvBPKmJV4kw@mail.gmail.com>
Message-ID: <BLU437-SMTP661B6B47F097BD92A80C0BDD5F0@phx.gbl>

Hi Rowlingson
thanks you, your command is working well

On 31/12/2014 16:39, Barry Rowlingson wrote:
> On Wed, Dec 31, 2014 at 6:22 AM, Eko Susilo <ekosusilo at live.com> wrote:
>> as.Date(as.POSIXct(timeval, origin="1950-01-01"))
>
> as.Date works with number of days, so try:
>
>   > as.Date(timeval/24, origin="1950-01-01")
>   [1] "2014-11-29"
>
> as.POSIXct works with seconds, so try:
>
>   > as.POSIXct(timeval*60*60, origin="1950-01-01")
>   [1] "2014-11-29 12:00:00 GMT"
>
> I recommend as.Date if you only want dates and not date-times and your
> data is really integer days.
>
> Barry


