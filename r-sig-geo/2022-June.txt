From er|nm@hodge@@ @end|ng |rom gm@||@com  Wed Jun  1 14:24:10 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Wed, 1 Jun 2022 08:24:10 -0400
Subject: [R-sig-Geo] A leaflet question
Message-ID: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>

Hello everyone;

Can I ask a leaflet question here, please, or is that a topic for RStudio
Community?

Thanks,
Erin
-- 
Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com

	[[alternative HTML version deleted]]


From t|m@@ppe|h@n@ @end|ng |rom gm@||@com  Wed Jun  1 15:01:30 2022
From: t|m@@ppe|h@n@ @end|ng |rom gm@||@com (Tim Salabim)
Date: Wed, 1 Jun 2022 15:01:30 +0200
Subject: [R-sig-Geo] A leaflet question
In-Reply-To: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
References: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
Message-ID: <CAMbH+HhbDOAqc8j8UngbvN8r_2hBsM-3d9Y+5hvL2L_AHqkvFg@mail.gmail.com>

Sure, fire away

On Wed, Jun 1, 2022 at 2:24 PM Erin Hodgess <erinm.hodgess at gmail.com> wrote:
>
> Hello everyone;
>
> Can I ask a leaflet question here, please, or is that a topic for RStudio
> Community?
>
> Thanks,
> Erin
> --
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From btupper @end|ng |rom b|ge|ow@org  Wed Jun  1 15:03:32 2022
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Wed, 1 Jun 2022 09:03:32 -0400
Subject: [R-sig-Geo] A leaflet question
In-Reply-To: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
References: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
Message-ID: <CALrbzg2iKcQ2Va3+m+kSN11hp9CyPS=tucjw=ScM9RoXZ+LizA@mail.gmail.com>

Hi Erin,

This is a great place to ask questions - especially if you provide a
reproducible example.

Cheers,
Ben

On Wed, Jun 1, 2022 at 8:24 AM Erin Hodgess <erinm.hodgess at gmail.com> wrote:

> Hello everyone;
>
> Can I ask a leaflet question here, please, or is that a topic for RStudio
> Community?
>
> Thanks,
> Erin
> --
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Ben Tupper (he/him)
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org

	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Wed Jun  1 16:14:49 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Wed, 1 Jun 2022 10:14:49 -0400
Subject: [R-sig-Geo] A leaflet question
In-Reply-To: <CALrbzg2iKcQ2Va3+m+kSN11hp9CyPS=tucjw=ScM9RoXZ+LizA@mail.gmail.com>
References: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
 <CALrbzg2iKcQ2Va3+m+kSN11hp9CyPS=tucjw=ScM9RoXZ+LizA@mail.gmail.com>
Message-ID: <CACxE24kE+xEvJmxcR9u3z+05pnUhbB79VOpnrKv6EaXvwV2Kyg@mail.gmail.com>

Thank you for your kind response.

Here is my code:

library(tigris)
library(leaflet)
library(sf)

#Getting the data
tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
tarrant_sp <- as(tarrant,"Spatial")

#Set up ui
ui <- fluidPage(
  leafletOutput("plot"),
  tableOutput("data")
)
#Set up server
server <- function(input, output, session) {
  #Draw map
  output$plot <- renderLeaflet({
  leaflet(tarrant_sp) %>% addTiles() %>%
  addPolygons(label=~TRACTCE)
})
  #allegedly grab market clicks
  output$data <- renderTable({
    nearPoints(tarrant_sp, input$plot_marker_click)
    print(input$plot_marker_click)
  })
}
shinyApp(ui,server)

I would like to get the values from the click and make calculations based
on the tracts selected.  However, nothing is appearing in the
input$plot_marker_click.

Any suggestions much appreciated.

Sincerely,
Erin


Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com


On Wed, Jun 1, 2022 at 9:03 AM Ben Tupper <btupper at bigelow.org> wrote:

> Hi Erin,
>
> This is a great place to ask questions - especially if you provide a
> reproducible example.
>
> Cheers,
> Ben
>
> On Wed, Jun 1, 2022 at 8:24 AM Erin Hodgess <erinm.hodgess at gmail.com>
> wrote:
>
>> Hello everyone;
>>
>> Can I ask a leaflet question here, please, or is that a topic for RStudio
>> Community?
>>
>> Thanks,
>> Erin
>> --
>> Erin Hodgess, PhD
>> mailto: erinm.hodgess at gmail.com
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Ben Tupper (he/him)
> Bigelow Laboratory for Ocean Science
> East Boothbay, Maine
> http://www.bigelow.org/
> https://eco.bigelow.org
>
>

	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Wed Jun  1 18:21:48 2022
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 1 Jun 2022 10:21:48 -0600
Subject: [R-sig-Geo] Add popup coordinates to marker in leaflet
Message-ID: <CABkCotTaiqTWF+3q55hZ5HmWtaop3BPYdiyM9Vy858ygH+PF=w@mail.gmail.com>

Dear list members,

How can I add the coordinates to the popup of the marker?

library(leaflet)
leaflet(m) %>%
  addTiles() %>%
  fitBounds(0, 40, 10, 50) %>%
  setView(-93.65, 42.0285, zoom = 17) %>%
  addMarkers(-93.65, 42.0285)


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Institutional website: ICOMVIS
<http://www.icomvis.una.ac.cr/index.php/manuel>
Blog sobre Ciencia de Datos: https://mspinola-ciencia-de-datos.netlify.app

	[[alternative HTML version deleted]]


From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Wed Jun  1 19:45:50 2022
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Wed, 1 Jun 2022 19:45:50 +0200
Subject: [R-sig-Geo] Add popup coordinates to marker in leaflet
In-Reply-To: <CABkCotTaiqTWF+3q55hZ5HmWtaop3BPYdiyM9Vy858ygH+PF=w@mail.gmail.com>
References: <CABkCotTaiqTWF+3q55hZ5HmWtaop3BPYdiyM9Vy858ygH+PF=w@mail.gmail.com>
Message-ID: <CAKtE6yOzrmjkDSQ5FnYCPQ5Pa-YUXWk2druq5Qpu9PuhoyEs1w@mail.gmail.com>

Hi,

You could try something like this:

library(leaflet)
library(htmltools)

df <- read.csv(textConnection(
    "Name,Lat,Long
    Samurai Noodle,47.597131,-122.327298
    Kukai Ramen,47.6154,-122.327157
    Tsukushinbo,47.59987,-122.326726"
    ))

leaflet(df) %>% addTiles() %>%
    addMarkers(~Long, ~Lat, popup = ~htmlEscape(paste(Name, Lat, Long)))

Hope this helps.
Zivan


On Wed, Jun 1, 2022 at 6:22 PM Manuel Sp?nola <mspinola10 at gmail.com> wrote:

> Dear list members,
>
> How can I add the coordinates to the popup of the marker?
>
> library(leaflet)
> leaflet(m) %>%
>   addTiles() %>%
>   fitBounds(0, 40, 10, 50) %>%
>   setView(-93.65, 42.0285, zoom = 17) %>%
>   addMarkers(-93.65, 42.0285)
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Institutional website: ICOMVIS
> <http://www.icomvis.una.ac.cr/index.php/manuel>
> Blog sobre Ciencia de Datos: https://mspinola-ciencia-de-datos.netlify.app
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From btupper @end|ng |rom b|ge|ow@org  Wed Jun  1 20:16:48 2022
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Wed, 1 Jun 2022 14:16:48 -0400
Subject: [R-sig-Geo] A leaflet question
In-Reply-To: <CACxE24kE+xEvJmxcR9u3z+05pnUhbB79VOpnrKv6EaXvwV2Kyg@mail.gmail.com>
References: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
 <CALrbzg2iKcQ2Va3+m+kSN11hp9CyPS=tucjw=ScM9RoXZ+LizA@mail.gmail.com>
 <CACxE24kE+xEvJmxcR9u3z+05pnUhbB79VOpnrKv6EaXvwV2Kyg@mail.gmail.com>
Message-ID: <CALrbzg1HTFQNk++=Dqp7QNGKKjZb1P_yx_1kR=aU29E2rrSmvw@mail.gmail.com>

Hi Erin,

I think it has to do with the naming convention.  If your map object is
called "plot", then you should expect the input to have the name
"plot_click" which you can access with `input$plot_click` You have looked
for input$plot_marker_click which hasn't been defined.

I'm not sure why nearPoints() throws an error in this case.


```
library(tigris)
library(leaflet)
library(sf)
options(tigris_use_cache = TRUE)
#Getting the data
tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
tarrant_sp <- as(tarrant,"Spatial")

#Set up ui
ui <- fluidPage(
  leafletOutput("plot"),
  tableOutput("data")
)
#Set up server
server <- function(input, output, session) {
  #Draw map
  output$plot <- renderLeaflet({
    leaflet(tarrant_sp) %>% addTiles() %>%
      addPolygons(label=~TRACTCE)
  })
  #allegedly grab market clicks
  output$data <- renderTable({
    click <- input$plot_click
    cat("click class = ", class(click), "\n")
    cat(str(click), "\n")
    print(nearPoints(tarrant_sp, click))
  })
}
shinyApp(ui,server)
```

On Wed, Jun 1, 2022 at 10:15 AM Erin Hodgess <erinm.hodgess at gmail.com>
wrote:

> Thank you for your kind response.
>
> Here is my code:
>
> library(tigris)
> library(leaflet)
> library(sf)
>
> #Getting the data
> tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
> tarrant_sp <- as(tarrant,"Spatial")
>
> #Set up ui
> ui <- fluidPage(
>   leafletOutput("plot"),
>   tableOutput("data")
> )
> #Set up server
> server <- function(input, output, session) {
>   #Draw map
>   output$plot <- renderLeaflet({
>   leaflet(tarrant_sp) %>% addTiles() %>%
>   addPolygons(label=~TRACTCE)
> })
>   #allegedly grab market clicks
>   output$data <- renderTable({
>     nearPoints(tarrant_sp, input$plot_marker_click)
>     print(input$plot_marker_click)
>   })
> }
> shinyApp(ui,server)
>
> I would like to get the values from the click and make calculations based
> on the tracts selected.  However, nothing is appearing in the
> input$plot_marker_click.
>
> Any suggestions much appreciated.
>
> Sincerely,
> Erin
>
>
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>
>
> On Wed, Jun 1, 2022 at 9:03 AM Ben Tupper <btupper at bigelow.org> wrote:
>
>> Hi Erin,
>>
>> This is a great place to ask questions - especially if you provide a
>> reproducible example.
>>
>> Cheers,
>> Ben
>>
>> On Wed, Jun 1, 2022 at 8:24 AM Erin Hodgess <erinm.hodgess at gmail.com>
>> wrote:
>>
>>> Hello everyone;
>>>
>>> Can I ask a leaflet question here, please, or is that a topic for RStudio
>>> Community?
>>>
>>> Thanks,
>>> Erin
>>> --
>>> Erin Hodgess, PhD
>>> mailto: erinm.hodgess at gmail.com
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>> --
>> Ben Tupper (he/him)
>> Bigelow Laboratory for Ocean Science
>> East Boothbay, Maine
>> http://www.bigelow.org/
>> https://eco.bigelow.org
>>
>>

-- 
Ben Tupper (he/him)
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org

	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Wed Jun  1 20:21:54 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Wed, 1 Jun 2022 14:21:54 -0400
Subject: [R-sig-Geo] A leaflet question
In-Reply-To: <CALrbzg1HTFQNk++=Dqp7QNGKKjZb1P_yx_1kR=aU29E2rrSmvw@mail.gmail.com>
References: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
 <CALrbzg2iKcQ2Va3+m+kSN11hp9CyPS=tucjw=ScM9RoXZ+LizA@mail.gmail.com>
 <CACxE24kE+xEvJmxcR9u3z+05pnUhbB79VOpnrKv6EaXvwV2Kyg@mail.gmail.com>
 <CALrbzg1HTFQNk++=Dqp7QNGKKjZb1P_yx_1kR=aU29E2rrSmvw@mail.gmail.com>
Message-ID: <CACxE24n5Q6nQcLA6-T0BNzwiWw4jLzCh4NYO13ZqRJFqK--dwA@mail.gmail.com>

Thank you so much!

Here is the error that I get from nearPoints:
nearPoints requires a click/hover/double-click object with x and y values.

The "click" from the leaflet does not have the same components as the
"click" from a regular plot.

Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com


On Wed, Jun 1, 2022 at 2:16 PM Ben Tupper <btupper at bigelow.org> wrote:

> Hi Erin,
>
> I think it has to do with the naming convention.  If your map object is
> called "plot", then you should expect the input to have the name
> "plot_click" which you can access with `input$plot_click` You have looked
> for input$plot_marker_click which hasn't been defined.
>
> I'm not sure why nearPoints() throws an error in this case.
>
>
> ```
> library(tigris)
> library(leaflet)
> library(sf)
> options(tigris_use_cache = TRUE)
> #Getting the data
> tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
> tarrant_sp <- as(tarrant,"Spatial")
>
> #Set up ui
> ui <- fluidPage(
>   leafletOutput("plot"),
>   tableOutput("data")
> )
> #Set up server
> server <- function(input, output, session) {
>   #Draw map
>   output$plot <- renderLeaflet({
>     leaflet(tarrant_sp) %>% addTiles() %>%
>       addPolygons(label=~TRACTCE)
>   })
>   #allegedly grab market clicks
>   output$data <- renderTable({
>     click <- input$plot_click
>     cat("click class = ", class(click), "\n")
>     cat(str(click), "\n")
>     print(nearPoints(tarrant_sp, click))
>   })
> }
> shinyApp(ui,server)
> ```
>
> On Wed, Jun 1, 2022 at 10:15 AM Erin Hodgess <erinm.hodgess at gmail.com>
> wrote:
>
>> Thank you for your kind response.
>>
>> Here is my code:
>>
>> library(tigris)
>> library(leaflet)
>> library(sf)
>>
>> #Getting the data
>> tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
>> tarrant_sp <- as(tarrant,"Spatial")
>>
>> #Set up ui
>> ui <- fluidPage(
>>   leafletOutput("plot"),
>>   tableOutput("data")
>> )
>> #Set up server
>> server <- function(input, output, session) {
>>   #Draw map
>>   output$plot <- renderLeaflet({
>>   leaflet(tarrant_sp) %>% addTiles() %>%
>>   addPolygons(label=~TRACTCE)
>> })
>>   #allegedly grab market clicks
>>   output$data <- renderTable({
>>     nearPoints(tarrant_sp, input$plot_marker_click)
>>     print(input$plot_marker_click)
>>   })
>> }
>> shinyApp(ui,server)
>>
>> I would like to get the values from the click and make calculations based
>> on the tracts selected.  However, nothing is appearing in the
>> input$plot_marker_click.
>>
>> Any suggestions much appreciated.
>>
>> Sincerely,
>> Erin
>>
>>
>> Erin Hodgess, PhD
>> mailto: erinm.hodgess at gmail.com
>>
>>
>> On Wed, Jun 1, 2022 at 9:03 AM Ben Tupper <btupper at bigelow.org> wrote:
>>
>>> Hi Erin,
>>>
>>> This is a great place to ask questions - especially if you provide a
>>> reproducible example.
>>>
>>> Cheers,
>>> Ben
>>>
>>> On Wed, Jun 1, 2022 at 8:24 AM Erin Hodgess <erinm.hodgess at gmail.com>
>>> wrote:
>>>
>>>> Hello everyone;
>>>>
>>>> Can I ask a leaflet question here, please, or is that a topic for
>>>> RStudio
>>>> Community?
>>>>
>>>> Thanks,
>>>> Erin
>>>> --
>>>> Erin Hodgess, PhD
>>>> mailto: erinm.hodgess at gmail.com
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>> --
>>> Ben Tupper (he/him)
>>> Bigelow Laboratory for Ocean Science
>>> East Boothbay, Maine
>>> http://www.bigelow.org/
>>> https://eco.bigelow.org
>>>
>>>
>
> --
> Ben Tupper (he/him)
> Bigelow Laboratory for Ocean Science
> East Boothbay, Maine
> http://www.bigelow.org/
> https://eco.bigelow.org
>
>

	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Wed Jun  1 20:40:13 2022
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 1 Jun 2022 12:40:13 -0600
Subject: [R-sig-Geo] Add popup coordinates to marker in leaflet
In-Reply-To: <CAKtE6yOzrmjkDSQ5FnYCPQ5Pa-YUXWk2druq5Qpu9PuhoyEs1w@mail.gmail.com>
References: <CABkCotTaiqTWF+3q55hZ5HmWtaop3BPYdiyM9Vy858ygH+PF=w@mail.gmail.com>
 <CAKtE6yOzrmjkDSQ5FnYCPQ5Pa-YUXWk2druq5Qpu9PuhoyEs1w@mail.gmail.com>
Message-ID: <CABkCotSd6K65gd_g+=EjL6o2Q0yX+F+GcvyjQP_4NM-3S_-VLQ@mail.gmail.com>

Thank you very much Zivan.

El mi?, 1 jun 2022 a las 11:46, Zivan Karaman (<zivan.karaman at gmail.com>)
escribi?:

> Hi,
>
> You could try something like this:
>
> library(leaflet)
> library(htmltools)
>
> df <- read.csv(textConnection(
>     "Name,Lat,Long
>     Samurai Noodle,47.597131,-122.327298
>     Kukai Ramen,47.6154,-122.327157
>     Tsukushinbo,47.59987,-122.326726"
>     ))
>
> leaflet(df) %>% addTiles() %>%
>     addMarkers(~Long, ~Lat, popup = ~htmlEscape(paste(Name, Lat, Long)))
>
> Hope this helps.
> Zivan
>
>
> On Wed, Jun 1, 2022 at 6:22 PM Manuel Sp?nola <mspinola10 at gmail.com>
> wrote:
>
>> Dear list members,
>>
>> How can I add the coordinates to the popup of the marker?
>>
>> library(leaflet)
>> leaflet(m) %>%
>>   addTiles() %>%
>>   fitBounds(0, 40, 10, 50) %>%
>>   setView(-93.65, 42.0285, zoom = 17) %>%
>>   addMarkers(-93.65, 42.0285)
>>
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.cr <mspinola at una.ac.cr>
>> mspinola10 at gmail.com
>> Tel?fono: (506) 8706 - 4662
>> Institutional website: ICOMVIS
>> <http://www.icomvis.una.ac.cr/index.php/manuel>
>> Blog sobre Ciencia de Datos:
>> https://mspinola-ciencia-de-datos.netlify.app
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Institutional website: ICOMVIS
<http://www.icomvis.una.ac.cr/index.php/manuel>
Blog sobre Ciencia de Datos: https://mspinola-ciencia-de-datos.netlify.app

	[[alternative HTML version deleted]]


From btupper @end|ng |rom b|ge|ow@org  Wed Jun  1 20:45:02 2022
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Wed, 1 Jun 2022 14:45:02 -0400
Subject: [R-sig-Geo] A leaflet question
In-Reply-To: <CACxE24n5Q6nQcLA6-T0BNzwiWw4jLzCh4NYO13ZqRJFqK--dwA@mail.gmail.com>
References: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
 <CALrbzg2iKcQ2Va3+m+kSN11hp9CyPS=tucjw=ScM9RoXZ+LizA@mail.gmail.com>
 <CACxE24kE+xEvJmxcR9u3z+05pnUhbB79VOpnrKv6EaXvwV2Kyg@mail.gmail.com>
 <CALrbzg1HTFQNk++=Dqp7QNGKKjZb1P_yx_1kR=aU29E2rrSmvw@mail.gmail.com>
 <CACxE24n5Q6nQcLA6-T0BNzwiWw4jLzCh4NYO13ZqRJFqK--dwA@mail.gmail.com>
Message-ID: <CALrbzg1XY9n6o=01BMVzt7j9QCroP6s9eucm1_TaBT3uBWf1DA@mail.gmail.com>

Hmmm.  Are you looking to see which polygon the user clicks within?  If so,
perhaps look at sf::st_contains().  If that would do the trick then you
could skip casting `tarrant` to sp (leave it as sf object).  Then cast the
contents of click to to sf POINT using sf::st_as_sf().

On Wed, Jun 1, 2022 at 2:22 PM Erin Hodgess <erinm.hodgess at gmail.com> wrote:

> Thank you so much!
>
> Here is the error that I get from nearPoints:
> nearPoints requires a click/hover/double-click object with x and y values.
>
> The "click" from the leaflet does not have the same components as the
> "click" from a regular plot.
>
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>
>
> On Wed, Jun 1, 2022 at 2:16 PM Ben Tupper <btupper at bigelow.org> wrote:
>
>> Hi Erin,
>>
>> I think it has to do with the naming convention.  If your map object is
>> called "plot", then you should expect the input to have the name
>> "plot_click" which you can access with `input$plot_click` You have looked
>> for input$plot_marker_click which hasn't been defined.
>>
>> I'm not sure why nearPoints() throws an error in this case.
>>
>>
>> ```
>> library(tigris)
>> library(leaflet)
>> library(sf)
>> options(tigris_use_cache = TRUE)
>> #Getting the data
>> tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
>> tarrant_sp <- as(tarrant,"Spatial")
>>
>> #Set up ui
>> ui <- fluidPage(
>>   leafletOutput("plot"),
>>   tableOutput("data")
>> )
>> #Set up server
>> server <- function(input, output, session) {
>>   #Draw map
>>   output$plot <- renderLeaflet({
>>     leaflet(tarrant_sp) %>% addTiles() %>%
>>       addPolygons(label=~TRACTCE)
>>   })
>>   #allegedly grab market clicks
>>   output$data <- renderTable({
>>     click <- input$plot_click
>>     cat("click class = ", class(click), "\n")
>>     cat(str(click), "\n")
>>     print(nearPoints(tarrant_sp, click))
>>   })
>> }
>> shinyApp(ui,server)
>> ```
>>
>> On Wed, Jun 1, 2022 at 10:15 AM Erin Hodgess <erinm.hodgess at gmail.com>
>> wrote:
>>
>>> Thank you for your kind response.
>>>
>>> Here is my code:
>>>
>>> library(tigris)
>>> library(leaflet)
>>> library(sf)
>>>
>>> #Getting the data
>>> tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
>>> tarrant_sp <- as(tarrant,"Spatial")
>>>
>>> #Set up ui
>>> ui <- fluidPage(
>>>   leafletOutput("plot"),
>>>   tableOutput("data")
>>> )
>>> #Set up server
>>> server <- function(input, output, session) {
>>>   #Draw map
>>>   output$plot <- renderLeaflet({
>>>   leaflet(tarrant_sp) %>% addTiles() %>%
>>>   addPolygons(label=~TRACTCE)
>>> })
>>>   #allegedly grab market clicks
>>>   output$data <- renderTable({
>>>     nearPoints(tarrant_sp, input$plot_marker_click)
>>>     print(input$plot_marker_click)
>>>   })
>>> }
>>> shinyApp(ui,server)
>>>
>>> I would like to get the values from the click and make calculations
>>> based on the tracts selected.  However, nothing is appearing in the
>>> input$plot_marker_click.
>>>
>>> Any suggestions much appreciated.
>>>
>>> Sincerely,
>>> Erin
>>>
>>>
>>> Erin Hodgess, PhD
>>> mailto: erinm.hodgess at gmail.com
>>>
>>>
>>> On Wed, Jun 1, 2022 at 9:03 AM Ben Tupper <btupper at bigelow.org> wrote:
>>>
>>>> Hi Erin,
>>>>
>>>> This is a great place to ask questions - especially if you provide a
>>>> reproducible example.
>>>>
>>>> Cheers,
>>>> Ben
>>>>
>>>> On Wed, Jun 1, 2022 at 8:24 AM Erin Hodgess <erinm.hodgess at gmail.com>
>>>> wrote:
>>>>
>>>>> Hello everyone;
>>>>>
>>>>> Can I ask a leaflet question here, please, or is that a topic for
>>>>> RStudio
>>>>> Community?
>>>>>
>>>>> Thanks,
>>>>> Erin
>>>>> --
>>>>> Erin Hodgess, PhD
>>>>> mailto: erinm.hodgess at gmail.com
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>>
>>>> --
>>>> Ben Tupper (he/him)
>>>> Bigelow Laboratory for Ocean Science
>>>> East Boothbay, Maine
>>>> http://www.bigelow.org/
>>>> https://eco.bigelow.org
>>>>
>>>>
>>
>> --
>> Ben Tupper (he/him)
>> Bigelow Laboratory for Ocean Science
>> East Boothbay, Maine
>> http://www.bigelow.org/
>> https://eco.bigelow.org
>>
>>

-- 
Ben Tupper (he/him)
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org

	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Thu Jun  2 05:10:13 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Wed, 1 Jun 2022 23:10:13 -0400
Subject: [R-sig-Geo] A leaflet question
In-Reply-To: <CALrbzg1XY9n6o=01BMVzt7j9QCroP6s9eucm1_TaBT3uBWf1DA@mail.gmail.com>
References: <CACxE24k3T66HnDsu=rvU7YQ1CwZEeh7DQXOBGQwmZsYjHXP+0Q@mail.gmail.com>
 <CALrbzg2iKcQ2Va3+m+kSN11hp9CyPS=tucjw=ScM9RoXZ+LizA@mail.gmail.com>
 <CACxE24kE+xEvJmxcR9u3z+05pnUhbB79VOpnrKv6EaXvwV2Kyg@mail.gmail.com>
 <CALrbzg1HTFQNk++=Dqp7QNGKKjZb1P_yx_1kR=aU29E2rrSmvw@mail.gmail.com>
 <CACxE24n5Q6nQcLA6-T0BNzwiWw4jLzCh4NYO13ZqRJFqK--dwA@mail.gmail.com>
 <CALrbzg1XY9n6o=01BMVzt7j9QCroP6s9eucm1_TaBT3uBWf1DA@mail.gmail.com>
Message-ID: <CACxE24nyfh_9vCk6Bu3_N97NgveQFm1JpaVoR1wANtsrjPwzGQ@mail.gmail.com>

Ben,

Your suggestions were totally awesome!  They worked like a charm.  Thank
you very much!

Here is the final version, just in case anyone is interested:

library(tigris)
library(leaflet)
library(sf)

#Getting the data
tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)



#Set up ui
ui <- fluidPage(
  leafletOutput("plot"),
  verbatimTextOutput("data"),

 actionButton("goButton","Calculate",class="btn-success"),
 conditionalPanel(condition="input.goButton==1",
 verbatimTextOutput("text1")
 )


)

#Set up server
server <- function(input, output, session) {

  .x5 <- reactiveValues()
  .x5$df <- numeric(0)



  output$plot <- renderLeaflet({
  leaflet(tarrant) %>% addTiles() %>%
  addPolygons(label=~TRACTCE)
  })

output$data <- renderText({
# print(tarrant$TRACTCE[.x5$df])
  paste("tract = ", tarrant$TRACTCE[.x5$df],"\n",sep="")
})

observeEvent(input$goButton, {
        lil.tarr <- tarrant[.x5$df,]

mean_land <- mean(lil.tarr$ALAND)
output$text1 <- renderText({
  paste0("The mean from this selection is: ",round(mean_land,1),sep="")
  })

})


observeEvent(input$plot_click, {
 p <- input$plot_click
    if(!is.null(input$plot_click)) {
    .x6 <- st_point(c(input$plot_click$lng,input$plot_click$lat))
    xtemp <- which(st_contains(tarrant,.x6,sparse=FALSE))
    .x5$df <- c(.x5$df,xtemp)
 }
 })

}
shinyApp(ui,server)


Again, many thanks.

Sincerely,
Erin

Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com


On Wed, Jun 1, 2022 at 2:45 PM Ben Tupper <btupper at bigelow.org> wrote:

> Hmmm.  Are you looking to see which polygon the user clicks within?  If
> so, perhaps look at sf::st_contains().  If that would do the trick then you
> could skip casting `tarrant` to sp (leave it as sf object).  Then cast the
> contents of click to to sf POINT using sf::st_as_sf().
>
> On Wed, Jun 1, 2022 at 2:22 PM Erin Hodgess <erinm.hodgess at gmail.com>
> wrote:
>
>> Thank you so much!
>>
>> Here is the error that I get from nearPoints:
>> nearPoints requires a click/hover/double-click object with x and y values.
>>
>> The "click" from the leaflet does not have the same components as the
>> "click" from a regular plot.
>>
>> Erin Hodgess, PhD
>> mailto: erinm.hodgess at gmail.com
>>
>>
>> On Wed, Jun 1, 2022 at 2:16 PM Ben Tupper <btupper at bigelow.org> wrote:
>>
>>> Hi Erin,
>>>
>>> I think it has to do with the naming convention.  If your map object is
>>> called "plot", then you should expect the input to have the name
>>> "plot_click" which you can access with `input$plot_click` You have looked
>>> for input$plot_marker_click which hasn't been defined.
>>>
>>> I'm not sure why nearPoints() throws an error in this case.
>>>
>>>
>>> ```
>>> library(tigris)
>>> library(leaflet)
>>> library(sf)
>>> options(tigris_use_cache = TRUE)
>>> #Getting the data
>>> tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
>>> tarrant_sp <- as(tarrant,"Spatial")
>>>
>>> #Set up ui
>>> ui <- fluidPage(
>>>   leafletOutput("plot"),
>>>   tableOutput("data")
>>> )
>>> #Set up server
>>> server <- function(input, output, session) {
>>>   #Draw map
>>>   output$plot <- renderLeaflet({
>>>     leaflet(tarrant_sp) %>% addTiles() %>%
>>>       addPolygons(label=~TRACTCE)
>>>   })
>>>   #allegedly grab market clicks
>>>   output$data <- renderTable({
>>>     click <- input$plot_click
>>>     cat("click class = ", class(click), "\n")
>>>     cat(str(click), "\n")
>>>     print(nearPoints(tarrant_sp, click))
>>>   })
>>> }
>>> shinyApp(ui,server)
>>> ```
>>>
>>> On Wed, Jun 1, 2022 at 10:15 AM Erin Hodgess <erinm.hodgess at gmail.com>
>>> wrote:
>>>
>>>> Thank you for your kind response.
>>>>
>>>> Here is my code:
>>>>
>>>> library(tigris)
>>>> library(leaflet)
>>>> library(sf)
>>>>
>>>> #Getting the data
>>>> tarrant <- tracts(state="TX",county="Tarrant",cb=TRUE)
>>>> tarrant_sp <- as(tarrant,"Spatial")
>>>>
>>>> #Set up ui
>>>> ui <- fluidPage(
>>>>   leafletOutput("plot"),
>>>>   tableOutput("data")
>>>> )
>>>> #Set up server
>>>> server <- function(input, output, session) {
>>>>   #Draw map
>>>>   output$plot <- renderLeaflet({
>>>>   leaflet(tarrant_sp) %>% addTiles() %>%
>>>>   addPolygons(label=~TRACTCE)
>>>> })
>>>>   #allegedly grab market clicks
>>>>   output$data <- renderTable({
>>>>     nearPoints(tarrant_sp, input$plot_marker_click)
>>>>     print(input$plot_marker_click)
>>>>   })
>>>> }
>>>> shinyApp(ui,server)
>>>>
>>>> I would like to get the values from the click and make calculations
>>>> based on the tracts selected.  However, nothing is appearing in the
>>>> input$plot_marker_click.
>>>>
>>>> Any suggestions much appreciated.
>>>>
>>>> Sincerely,
>>>> Erin
>>>>
>>>>
>>>> Erin Hodgess, PhD
>>>> mailto: erinm.hodgess at gmail.com
>>>>
>>>>
>>>> On Wed, Jun 1, 2022 at 9:03 AM Ben Tupper <btupper at bigelow.org> wrote:
>>>>
>>>>> Hi Erin,
>>>>>
>>>>> This is a great place to ask questions - especially if you provide a
>>>>> reproducible example.
>>>>>
>>>>> Cheers,
>>>>> Ben
>>>>>
>>>>> On Wed, Jun 1, 2022 at 8:24 AM Erin Hodgess <erinm.hodgess at gmail.com>
>>>>> wrote:
>>>>>
>>>>>> Hello everyone;
>>>>>>
>>>>>> Can I ask a leaflet question here, please, or is that a topic for
>>>>>> RStudio
>>>>>> Community?
>>>>>>
>>>>>> Thanks,
>>>>>> Erin
>>>>>> --
>>>>>> Erin Hodgess, PhD
>>>>>> mailto: erinm.hodgess at gmail.com
>>>>>>
>>>>>>         [[alternative HTML version deleted]]
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Ben Tupper (he/him)
>>>>> Bigelow Laboratory for Ocean Science
>>>>> East Boothbay, Maine
>>>>> http://www.bigelow.org/
>>>>> https://eco.bigelow.org
>>>>>
>>>>>
>>>
>>> --
>>> Ben Tupper (he/him)
>>> Bigelow Laboratory for Ocean Science
>>> East Boothbay, Maine
>>> http://www.bigelow.org/
>>> https://eco.bigelow.org
>>>
>>>
>
> --
> Ben Tupper (he/him)
> Bigelow Laboratory for Ocean Science
> East Boothbay, Maine
> http://www.bigelow.org/
> https://eco.bigelow.org
>
>

	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Sat Jun  4 03:06:53 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Fri, 3 Jun 2022 21:06:53 -0400
Subject: [R-sig-Geo] writing a leaflet object to a KML file
Message-ID: <CACxE24n9gnfNUFw0azs+yFMO0RkVqSWg3maRBepVZZgY19ktrA@mail.gmail.com>

Hello!

Is there a way to write a leaflet object to a KML instead of an HTML file,
please?

I did see st_write for the sf object, but I really need the output from
leaflet.

Thanks so much!

Sincerely,
Erin


Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com

	[[alternative HTML version deleted]]


From jo@|@h@p@rry @end|ng |rom gm@||@com  Sat Jun  4 03:21:19 2022
From: jo@|@h@p@rry @end|ng |rom gm@||@com (Josiah Parry)
Date: Fri, 3 Jun 2022 21:21:19 -0400
Subject: [R-sig-Geo] writing a leaflet object to a KML file
In-Reply-To: <CACxE24n9gnfNUFw0azs+yFMO0RkVqSWg3maRBepVZZgY19ktrA@mail.gmail.com>
References: <CACxE24n9gnfNUFw0azs+yFMO0RkVqSWg3maRBepVZZgY19ktrA@mail.gmail.com>
Message-ID: <CAL3ufUJmGfiZOOuPR1QCVAyh9gwwMSORMf+0ntGWPA8RJZn47A@mail.gmail.com>

Hey Erin,

Leaflet is a JavaScript library to make interactive maps. So necessarily,
the output is html and JavaScript. Can you clarify what you mean by output?
Perhaps a more specific example can help inform the question.

I do think, however, st_write() is the proper tool. But maybe you need
subsets of data from an interactive map?

On Fri, Jun 3, 2022 at 21:07 Erin Hodgess <erinm.hodgess at gmail.com> wrote:

> Hello!
>
> Is there a way to write a leaflet object to a KML instead of an HTML file,
> please?
>
> I did see st_write for the sf object, but I really need the output from
> leaflet.
>
> Thanks so much!
>
> Sincerely,
> Erin
>
>
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Sat Jun  4 03:23:36 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Fri, 3 Jun 2022 21:23:36 -0400
Subject: [R-sig-Geo] writing a leaflet object to a KML file
In-Reply-To: <CAL3ufUJmGfiZOOuPR1QCVAyh9gwwMSORMf+0ntGWPA8RJZn47A@mail.gmail.com>
References: <CACxE24n9gnfNUFw0azs+yFMO0RkVqSWg3maRBepVZZgY19ktrA@mail.gmail.com>
 <CAL3ufUJmGfiZOOuPR1QCVAyh9gwwMSORMf+0ntGWPA8RJZn47A@mail.gmail.com>
Message-ID: <CACxE24ntsOxSbj3bsZU4aJL4D49GM_mjY9QZr0E8brRzXo4oqA@mail.gmail.com>

I am looking at my HTML file and a lot of the code is the same as KML.  I?m
going to try to generate KML From the HTML.

Thanks,
Erin

On Fri, Jun 3, 2022 at 9:21 PM Josiah Parry <josiah.parry at gmail.com> wrote:

> Hey Erin,
>
> Leaflet is a JavaScript library to make interactive maps. So necessarily,
> the output is html and JavaScript. Can you clarify what you mean by output?
> Perhaps a more specific example can help inform the question.
>
> I do think, however, st_write() is the proper tool. But maybe you need
> subsets of data from an interactive map?
>
> On Fri, Jun 3, 2022 at 21:07 Erin Hodgess <erinm.hodgess at gmail.com> wrote:
>
>> Hello!
>>
>> Is there a way to write a leaflet object to a KML instead of an HTML file,
>> please?
>>
>> I did see st_write for the sf object, but I really need the output from
>> leaflet.
>>
>> Thanks so much!
>>
>> Sincerely,
>> Erin
>>
>>
>> Erin Hodgess, PhD
>> mailto: erinm.hodgess at gmail.com
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> --
Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com

	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Sat Jun  4 17:20:39 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Sat, 4 Jun 2022 11:20:39 -0400
Subject: [R-sig-Geo] Back again with KML and st_write
Message-ID: <CACxE24nay5BMFxbpYPC+W7x2vqEq+GEvU=mNnryjfLVP_bsodg@mail.gmail.com>

Hi everyone

Hope you're having a nice weekend!

I'm still having trouble with the st_write.  It is doing the polygons
perfectly, but no fill Color.

Use this link to get the data:
https://www.dropbox.com/s/c2si2neeu179e8d/sg1.RData?dl=0

load("sg1.RData")

library(dplyr)
library(leaflet)
library(sf)

pal1 <- colorBin("YlOrRd",miej.sg$MiEJScreen,
bins=c(0,50,60,70,100))

popup1 <- paste(
"EJ: ",miej.sg$MiEJScreen,"<br>",
"Tract",substring(miej.sg$GEOID,6,11),"<br>",
"Zip",miej.sg$zip,"<br>")

#Full graph
 m5a <- leaflet() %>% #addTiles() %>%
 addPolygons(data=miej.sg,fillColor = ~pal1(miej.sg$MiEJScreen),
 popup=~popup1,
  fillOpacity=0.7,weight=2.5,color="#301934",opacity=1) %>%

 addLegend(pal=pal1,values=miej.sg$MiEJScreen,title="EJ Score",
 position="bottomright")

Now, if I use "st_write", the KML file is produced, but no fill color.

st_write(miej.sg,"test1a.kml",
fillColor=pal1(miej.sg$MiEJScreen))

I have tried all sorts of combinations with layer_options as well,
but no good.

Thanks for any help!

Sincerely,
Erin

Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com

	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Sat Jun  4 20:48:01 2022
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Sat, 4 Jun 2022 14:48:01 -0400
Subject: [R-sig-Geo] Back again with KML and st_write
In-Reply-To: <CACxE24nay5BMFxbpYPC+W7x2vqEq+GEvU=mNnryjfLVP_bsodg@mail.gmail.com>
References: <CACxE24nay5BMFxbpYPC+W7x2vqEq+GEvU=mNnryjfLVP_bsodg@mail.gmail.com>
Message-ID: <CACxE24nsT3KOaV3WPdp+aCFAS61YT_3X+j8FZN2C3iNYXPRaSQ@mail.gmail.com>

Hello again

I got a solution at last.  I downloaded geoR, RandomFields, landmap, and
plotKML. I got them from the archives.

Anyhow, the solution is not bad using the plotKML package.

 pal1 <- colorBin("YlOrRd",miej.sg$MiEJScreen,
 bins=c(0,50,60,70,100))
 xp <- pal1(miej.sg$MiEJScreen)
plotKML(miej.sg,fill=xp,"erin1b.kml")

So that is a particular solution.

Thanks,
Erin




Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com


On Sat, Jun 4, 2022 at 11:20 AM Erin Hodgess <erinm.hodgess at gmail.com>
wrote:

> Hi everyone
>
> Hope you're having a nice weekend!
>
> I'm still having trouble with the st_write.  It is doing the polygons
> perfectly, but no fill Color.
>
> Use this link to get the data:
> https://www.dropbox.com/s/c2si2neeu179e8d/sg1.RData?dl=0
>
> load("sg1.RData")
>
> library(dplyr)
> library(leaflet)
> library(sf)
>
> pal1 <- colorBin("YlOrRd",miej.sg$MiEJScreen,
> bins=c(0,50,60,70,100))
>
> popup1 <- paste(
> "EJ: ",miej.sg$MiEJScreen,"<br>",
> "Tract",substring(miej.sg$GEOID,6,11),"<br>",
> "Zip",miej.sg$zip,"<br>")
>
> #Full graph
>  m5a <- leaflet() %>% #addTiles() %>%
>  addPolygons(data=miej.sg,fillColor = ~pal1(miej.sg$MiEJScreen),
>  popup=~popup1,
>   fillOpacity=0.7,weight=2.5,color="#301934",opacity=1) %>%
>
>  addLegend(pal=pal1,values=miej.sg$MiEJScreen,title="EJ Score",
>  position="bottomright")
>
> Now, if I use "st_write", the KML file is produced, but no fill color.
>
> st_write(miej.sg,"test1a.kml",
> fillColor=pal1(miej.sg$MiEJScreen))
>
> I have tried all sorts of combinations with layer_options as well,
> but no good.
>
> Thanks for any help!
>
> Sincerely,
> Erin
>
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jun  6 16:26:02 2022
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 6 Jun 2022 16:26:02 +0200 (CEST)
Subject: [R-sig-Geo] Back again with KML and st_write
In-Reply-To: <CACxE24nsT3KOaV3WPdp+aCFAS61YT_3X+j8FZN2C3iNYXPRaSQ@mail.gmail.com>
References: <CACxE24nay5BMFxbpYPC+W7x2vqEq+GEvU=mNnryjfLVP_bsodg@mail.gmail.com>
 <CACxE24nsT3KOaV3WPdp+aCFAS61YT_3X+j8FZN2C3iNYXPRaSQ@mail.gmail.com>
Message-ID: <6c1b767f-397d-3b30-4c99-1152b074be2@reclus2.nhh.no>

On Sat, 4 Jun 2022, Erin Hodgess wrote:

> Hello again
>
> I got a solution at last.  I downloaded geoR, RandomFields, landmap, and
> plotKML. I got them from the archives.
>
> Anyhow, the solution is not bad using the plotKML package.
>
> pal1 <- colorBin("YlOrRd",miej.sg$MiEJScreen,
> bins=c(0,50,60,70,100))
> xp <- pal1(miej.sg$MiEJScreen)
> plotKML(miej.sg,fill=xp,"erin1b.kml")
>
> So that is a particular solution.

As you note, the archiving of packages has had consequences for packages 
using them (and further downstream too).

sf_write() can write KML files, but GDAL/OGR has two drivers: KML, which 
is simpler, and LIBKML which requires an extra external library when 
building GDAL. See https://gdal.org/drivers/vector/kml.html#vector-kml and 
https://gdal.org/drivers/vector/libkml.html#vector-libkml. However the 
latest libkml is from December 2015, suggesting that no active development 
is occurring. plotKML is described in 
https://www.jstatsoft.org/article/view/v063i05, and does pass R CMD check 
cleanly, so was probably archived when a package it imported was archived; 
it could be re-submitted, especially if someone wanted to help the 
current maintainer.

Roger

>
> Thanks,
> Erin
>
>
>
>
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>
>
> On Sat, Jun 4, 2022 at 11:20 AM Erin Hodgess <erinm.hodgess at gmail.com>
> wrote:
>
>> Hi everyone
>>
>> Hope you're having a nice weekend!
>>
>> I'm still having trouble with the st_write.  It is doing the polygons
>> perfectly, but no fill Color.
>>
>> Use this link to get the data:
>> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.dropbox.com%2Fs%2Fc2si2neeu179e8d%2Fsg1.RData%3Fdl%3D0&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C4fab69fff266422a4f2f08da465ad3c5%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637899653176959245%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=%2BVqWm%2Fxdy37os6Rj8eqirn7O5OKfgcDlVslSvn6Pei4%3D&amp;reserved=0
>>
>> load("sg1.RData")
>>
>> library(dplyr)
>> library(leaflet)
>> library(sf)
>>
>> pal1 <- colorBin("YlOrRd",miej.sg$MiEJScreen,
>> bins=c(0,50,60,70,100))
>>
>> popup1 <- paste(
>> "EJ: ",miej.sg$MiEJScreen,"<br>",
>> "Tract",substring(miej.sg$GEOID,6,11),"<br>",
>> "Zip",miej.sg$zip,"<br>")
>>
>> #Full graph
>>  m5a <- leaflet() %>% #addTiles() %>%
>>  addPolygons(data=miej.sg,fillColor = ~pal1(miej.sg$MiEJScreen),
>>  popup=~popup1,
>>   fillOpacity=0.7,weight=2.5,color="#301934",opacity=1) %>%
>>
>>  addLegend(pal=pal1,values=miej.sg$MiEJScreen,title="EJ Score",
>>  position="bottomright")
>>
>> Now, if I use "st_write", the KML file is produced, but no fill color.
>>
>> st_write(miej.sg,"test1a.kml",
>> fillColor=pal1(miej.sg$MiEJScreen))
>>
>> I have tried all sorts of combinations with layer_options as well,
>> but no good.
>>
>> Thanks for any help!
>>
>> Sincerely,
>> Erin
>>
>> Erin Hodgess, PhD
>> mailto: erinm.hodgess at gmail.com
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C4fab69fff266422a4f2f08da465ad3c5%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637899653176959245%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=rq0m2nMNRHLxHX482T4OGdRHRD7encqyba1X5cXuYvs%3D&amp;reserved=0
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From r@njeetjh@||tkgp @end|ng |rom gm@||@com  Thu Jun  9 07:28:29 2022
From: r@njeetjh@||tkgp @end|ng |rom gm@||@com (Ranjeet Kumar Jha)
Date: Thu, 9 Jun 2022 10:58:29 +0530
Subject: [R-sig-Geo] Need to plot all 5 spatial maps together in a single
 window
Message-ID: <CAJfMH3pKAvdekYnWqxnXzeNdBvtwDZKRg_Xv8=tSU9PDYvtNQw@mail.gmail.com>

Hi,

I like to plot all my 5 spatial maps of drought indices in a single window
using the sf plot function in R. I am able to plot all maps separately but
unable to plot altogether. All indexes are showing drought indices.

I really appreciate your help!

Here is the code:

#merging using merge function
merge_drought_indices <- merge(shp_dist, drought_indices)
view(merge_drought_indices)
#plot in a single window
library(sf)
par(mfrow=c(2,2))
 plot(merge_drought_indices["r_count_lt_p05_harvest_end"],
 pal = colorRampPalette(c("red", "white", "blue","green")),
 main = "End harvest index variation in India during drought year 2000",
 key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)

 plot(merge_drought_indices["r_count_lt_p05_harvest"],
 pal = colorRampPalette(c("red", "white", "blue","green")),
 main = "Harvest variation index in India during drought year 2000",
 key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)

 plot(merge_drought_indices["r_count_lt_p05_main"],
 pal = colorRampPalette(c("red", "white", "blue","green")),
 main = "Main growth stage index variation in India during drought year 2000",
 key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)

 plot(merge_drought_indices["r_count_lt_p05_plant.start"],
 pal = colorRampPalette(c("red", "white", "blue","green")),
 main = "Plant start index variation in India during drought year 2000",
 key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)

 plot(merge_drought_indices["r_count_lt_p05_plant"],
 pal = colorRampPalette(c("red", "white", "blue","green")),
 main = "main plant stage index variation in India during drought year 2000",
 key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)


Regards and Thanks,

Ranjeet


-- 



*"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
lives beautiful!"*

	[[alternative HTML version deleted]]


From je@n@m@r|u@@g @end|ng |rom gm@||@com  Thu Jun  9 09:48:54 2022
From: je@n@m@r|u@@g @end|ng |rom gm@||@com (J. Marius RAKOTONDRAMANGA)
Date: Thu, 9 Jun 2022 10:48:54 +0300
Subject: [R-sig-Geo] 
 Need to plot all 5 spatial maps together in a single window
In-Reply-To: <CAJfMH3pKAvdekYnWqxnXzeNdBvtwDZKRg_Xv8=tSU9PDYvtNQw@mail.gmail.com>
References: <CAJfMH3pKAvdekYnWqxnXzeNdBvtwDZKRg_Xv8=tSU9PDYvtNQw@mail.gmail.com>
Message-ID: <CAPCa8=HwAjSBMO9JLPMthW6qOzckZ2ozim_hDzGoZLSaXmm+Wg@mail.gmail.com>

Hi Ranjeet,
Have a look to this function cowplot::plot_grid(), from
https://wilkelab.org/cowplot/articles/plot_grid.html
It has mainy features and permit you to save also the combined plots :
here https://search.r-project.org/CRAN/refmans/cowplot/html/save_plot.html
or https://wilkelab.org/cowplot/reference/ggsave2.html

Regards,


Marius,


---------
J. Marius RAKOTONDRAMANGA, MSc
PhD Student in Biostatistics/Biomathematics
ED 393 Pierre Louis de Sant? Publique : Epid?miologie et Sciences de
l'Information Biom?dicale
Sorbonne Universit? (ex. UPMC)


Le jeu. 9 juin 2022 ? 08:29, Ranjeet Kumar Jha <ranjeetjhaiitkgp at gmail.com>
a ?crit :

> Hi,
>
> I like to plot all my 5 spatial maps of drought indices in a single window
> using the sf plot function in R. I am able to plot all maps separately but
> unable to plot altogether. All indexes are showing drought indices.
>
> I really appreciate your help!
>
> Here is the code:
>
> #merging using merge function
> merge_drought_indices <- merge(shp_dist, drought_indices)
> view(merge_drought_indices)
> #plot in a single window
> library(sf)
> par(mfrow=c(2,2))
>  plot(merge_drought_indices["r_count_lt_p05_harvest_end"],
>  pal = colorRampPalette(c("red", "white", "blue","green")),
>  main = "End harvest index variation in India during drought year 2000",
>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>
>  plot(merge_drought_indices["r_count_lt_p05_harvest"],
>  pal = colorRampPalette(c("red", "white", "blue","green")),
>  main = "Harvest variation index in India during drought year 2000",
>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>
>  plot(merge_drought_indices["r_count_lt_p05_main"],
>  pal = colorRampPalette(c("red", "white", "blue","green")),
>  main = "Main growth stage index variation in India during drought year
> 2000",
>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>
>  plot(merge_drought_indices["r_count_lt_p05_plant.start"],
>  pal = colorRampPalette(c("red", "white", "blue","green")),
>  main = "Plant start index variation in India during drought year 2000",
>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>
>  plot(merge_drought_indices["r_count_lt_p05_plant"],
>  pal = colorRampPalette(c("red", "white", "blue","green")),
>  main = "main plant stage index variation in India during drought year
> 2000",
>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>
>
> Regards and Thanks,
>
> Ranjeet
>
>
> --
>
>
>
> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
> lives beautiful!"*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Thu Jun  9 11:18:03 2022
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 9 Jun 2022 11:18:03 +0200 (CEST)
Subject: [R-sig-Geo] 
 Need to plot all 5 spatial maps together in a single window
In-Reply-To: <CAPCa8=HwAjSBMO9JLPMthW6qOzckZ2ozim_hDzGoZLSaXmm+Wg@mail.gmail.com>
References: <CAJfMH3pKAvdekYnWqxnXzeNdBvtwDZKRg_Xv8=tSU9PDYvtNQw@mail.gmail.com>
 <CAPCa8=HwAjSBMO9JLPMthW6qOzckZ2ozim_hDzGoZLSaXmm+Wg@mail.gmail.com>
Message-ID: <18428c6e-1175-4f8a-aec2-acc1a2373ca2@reclus2.nhh.no>

On Thu, 9 Jun 2022, J. Marius RAKOTONDRAMANGA wrote:

> Hi Ranjeet,
> Have a look to this function cowplot::plot_grid(), from

Marius,

Thanks for trying to help, but cowplot is designed to combine plots 
created using grid, not base, graphics. To use it (or gridExtra), sf 
plots, which are base graphics, must be converted to grid objects (grobs), 
for example using the gridGraphics package.

Since Ranjeet did not provide a reproducible example, this may not 
correspond well, but given the lack of information, it's hard to be more 
precise:

library(sf)
nc <- st_read(system.file("gpkg/nc.gpkg", package="sf"))
plot(nc["BIR74"])

creates output on the default device, but no object that can be 
manipulated. Using:

par(mfrow=c(2,2))
plot(nc["BIR74"])

gives exactly the same output, because sf's plot() itself takes control of 
the graphics device, so ignoring the request for multiple panels.

par(mfrow=c(1,1))
plot(nc["BIR74"])
gridGraphics::grid.echo()
library(grid)
g <- grid.grab()
grid.newpage()
gridExtra::grid.arrange(g, b, ncol=2)

gives two copies of our initial output after conversion to grid graphics.

However, it is easier to choose alternatives:

library(tmap)
tm_shape(nc) + tm_fill(c("BIR74", "BIR79"))

and probably library(mapsf) too, but it, like sf, uses base graphics; it 
respects par(mfrow=):

library(mapsf)
par(mfrow=c(1,2))
mf_map(x=nc, var=c("BIR74"), type="choro")
mf_map(x=nc, var=c("BIR79"), type="choro")

Hope this clarifies,

Roger


> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwilkelab.org%2Fcowplot%2Farticles%2Fplot_grid.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=vrH2iUZeaQw6TgzuYAYLXS6Yv%2Bt0hVXgu6PPDYcriEg%3D&amp;reserved=0
> It has mainy features and permit you to save also the combined plots :
> here https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsearch.r-project.org%2FCRAN%2Frefmans%2Fcowplot%2Fhtml%2Fsave_plot.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=gRj%2BPj%2B29W0mrOtT0Vp5HNEigvBQUsOL4VAdF%2B64fe0%3D&amp;reserved=0
> or https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwilkelab.org%2Fcowplot%2Freference%2Fggsave2.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Idsy6TN5bxrqZtqgi6CGpqzRKjcofl71cR9EBTc9jvY%3D&amp;reserved=0
>
> Regards,
>
>
> Marius,
>
>
> ---------
> J. Marius RAKOTONDRAMANGA, MSc
> PhD Student in Biostatistics/Biomathematics
> ED 393 Pierre Louis de Sant? Publique : Epid?miologie et Sciences de
> l'Information Biom?dicale
> Sorbonne Universit? (ex. UPMC)
>
>
> Le jeu. 9 juin 2022 ? 08:29, Ranjeet Kumar Jha <ranjeetjhaiitkgp at gmail.com>
> a ?crit :
>
>> Hi,
>>
>> I like to plot all my 5 spatial maps of drought indices in a single window
>> using the sf plot function in R. I am able to plot all maps separately but
>> unable to plot altogether. All indexes are showing drought indices.
>>
>> I really appreciate your help!
>>
>> Here is the code:
>>
>> #merging using merge function
>> merge_drought_indices <- merge(shp_dist, drought_indices)
>> view(merge_drought_indices)
>> #plot in a single window
>> library(sf)
>> par(mfrow=c(2,2))
>>  plot(merge_drought_indices["r_count_lt_p05_harvest_end"],
>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>  main = "End harvest index variation in India during drought year 2000",
>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>
>>  plot(merge_drought_indices["r_count_lt_p05_harvest"],
>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>  main = "Harvest variation index in India during drought year 2000",
>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>
>>  plot(merge_drought_indices["r_count_lt_p05_main"],
>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>  main = "Main growth stage index variation in India during drought year
>> 2000",
>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>
>>  plot(merge_drought_indices["r_count_lt_p05_plant.start"],
>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>  main = "Plant start index variation in India during drought year 2000",
>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>
>>  plot(merge_drought_indices["r_count_lt_p05_plant"],
>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>  main = "main plant stage index variation in India during drought year
>> 2000",
>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>
>>
>> Regards and Thanks,
>>
>> Ranjeet
>>
>>
>> --
>>
>>
>>
>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>> lives beautiful!"*
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=awwczk%2Bpse%2B5tTKYB1ecwtuNE3C6AjgtgvzbE7Aga6w%3D&amp;reserved=0
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=awwczk%2Bpse%2B5tTKYB1ecwtuNE3C6AjgtgvzbE7Aga6w%3D&amp;reserved=0
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From je@n@m@r|u@@g @end|ng |rom gm@||@com  Thu Jun  9 11:52:05 2022
From: je@n@m@r|u@@g @end|ng |rom gm@||@com (J. Marius RAKOTONDRAMANGA)
Date: Thu, 9 Jun 2022 12:52:05 +0300
Subject: [R-sig-Geo] 
 Need to plot all 5 spatial maps together in a single window
In-Reply-To: <18428c6e-1175-4f8a-aec2-acc1a2373ca2@reclus2.nhh.no>
References: <CAJfMH3pKAvdekYnWqxnXzeNdBvtwDZKRg_Xv8=tSU9PDYvtNQw@mail.gmail.com>
 <CAPCa8=HwAjSBMO9JLPMthW6qOzckZ2ozim_hDzGoZLSaXmm+Wg@mail.gmail.com>
 <18428c6e-1175-4f8a-aec2-acc1a2373ca2@reclus2.nhh.no>
Message-ID: <CAPCa8=Gx8hPgwCX+tdbxHSf2JLB_AdW5DT4qHpGc7JYhA_9KRg@mail.gmail.com>

Thank you Prof. Bivand for correcting my views.
Your insights and books are really helpful for us !


Marius,


---------
J. Marius RAKOTONDRAMANGA, MSc
PhD Student in Biostatistics/Biomathematics
ED 393 Pierre Louis de Sant? Publique : Epid?miologie et Sciences de
l'Information Biom?dicale
Sorbonne Universit? (ex. UPMC)


Le jeu. 9 juin 2022 ? 12:18, Roger Bivand <Roger.Bivand at nhh.no> a ?crit :

> On Thu, 9 Jun 2022, J. Marius RAKOTONDRAMANGA wrote:
>
> > Hi Ranjeet,
> > Have a look to this function cowplot::plot_grid(), from
>
> Marius,
>
> Thanks for trying to help, but cowplot is designed to combine plots
> created using grid, not base, graphics. To use it (or gridExtra), sf
> plots, which are base graphics, must be converted to grid objects (grobs),
> for example using the gridGraphics package.
>
> Since Ranjeet did not provide a reproducible example, this may not
> correspond well, but given the lack of information, it's hard to be more
> precise:
>
> library(sf)
> nc <- st_read(system.file("gpkg/nc.gpkg", package="sf"))
> plot(nc["BIR74"])
>
> creates output on the default device, but no object that can be
> manipulated. Using:
>
> par(mfrow=c(2,2))
> plot(nc["BIR74"])
>
> gives exactly the same output, because sf's plot() itself takes control of
> the graphics device, so ignoring the request for multiple panels.
>
> par(mfrow=c(1,1))
> plot(nc["BIR74"])
> gridGraphics::grid.echo()
> library(grid)
> g <- grid.grab()
> grid.newpage()
> gridExtra::grid.arrange(g, b, ncol=2)
>
> gives two copies of our initial output after conversion to grid graphics.
>
> However, it is easier to choose alternatives:
>
> library(tmap)
> tm_shape(nc) + tm_fill(c("BIR74", "BIR79"))
>
> and probably library(mapsf) too, but it, like sf, uses base graphics; it
> respects par(mfrow=):
>
> library(mapsf)
> par(mfrow=c(1,2))
> mf_map(x=nc, var=c("BIR74"), type="choro")
> mf_map(x=nc, var=c("BIR79"), type="choro")
>
> Hope this clarifies,
>
> Roger
>
>
> >
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwilkelab.org%2Fcowplot%2Farticles%2Fplot_grid.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=vrH2iUZeaQw6TgzuYAYLXS6Yv%2Bt0hVXgu6PPDYcriEg%3D&amp;reserved=0
> > It has mainy features and permit you to save also the combined plots :
> > here
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsearch.r-project.org%2FCRAN%2Frefmans%2Fcowplot%2Fhtml%2Fsave_plot.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=gRj%2BPj%2B29W0mrOtT0Vp5HNEigvBQUsOL4VAdF%2B64fe0%3D&amp;reserved=0
> > or
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwilkelab.org%2Fcowplot%2Freference%2Fggsave2.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Idsy6TN5bxrqZtqgi6CGpqzRKjcofl71cR9EBTc9jvY%3D&amp;reserved=0
> >
> > Regards,
> >
> >
> > Marius,
> >
> >
> > ---------
> > J. Marius RAKOTONDRAMANGA, MSc
> > PhD Student in Biostatistics/Biomathematics
> > ED 393 Pierre Louis de Sant? Publique : Epid?miologie et Sciences de
> > l'Information Biom?dicale
> > Sorbonne Universit? (ex. UPMC)
> >
> >
> > Le jeu. 9 juin 2022 ? 08:29, Ranjeet Kumar Jha <
> ranjeetjhaiitkgp at gmail.com>
> > a ?crit :
> >
> >> Hi,
> >>
> >> I like to plot all my 5 spatial maps of drought indices in a single
> window
> >> using the sf plot function in R. I am able to plot all maps separately
> but
> >> unable to plot altogether. All indexes are showing drought indices.
> >>
> >> I really appreciate your help!
> >>
> >> Here is the code:
> >>
> >> #merging using merge function
> >> merge_drought_indices <- merge(shp_dist, drought_indices)
> >> view(merge_drought_indices)
> >> #plot in a single window
> >> library(sf)
> >> par(mfrow=c(2,2))
> >>  plot(merge_drought_indices["r_count_lt_p05_harvest_end"],
> >>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>  main = "End harvest index variation in India during drought year 2000",
> >>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>
> >>  plot(merge_drought_indices["r_count_lt_p05_harvest"],
> >>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>  main = "Harvest variation index in India during drought year 2000",
> >>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>
> >>  plot(merge_drought_indices["r_count_lt_p05_main"],
> >>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>  main = "Main growth stage index variation in India during drought year
> >> 2000",
> >>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>
> >>  plot(merge_drought_indices["r_count_lt_p05_plant.start"],
> >>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>  main = "Plant start index variation in India during drought year 2000",
> >>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>
> >>  plot(merge_drought_indices["r_count_lt_p05_plant"],
> >>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>  main = "main plant stage index variation in India during drought year
> >> 2000",
> >>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>
> >>
> >> Regards and Thanks,
> >>
> >> Ranjeet
> >>
> >>
> >> --
> >>
> >>
> >>
> >> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
> >> lives beautiful!"*
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >>
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=awwczk%2Bpse%2B5tTKYB1ecwtuNE3C6AjgtgvzbE7Aga6w%3D&amp;reserved=0
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> >
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=awwczk%2Bpse%2B5tTKYB1ecwtuNE3C6AjgtgvzbE7Aga6w%3D&amp;reserved=0
> >
>
> --
> Roger Bivand
> Emeritus Professor
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Thu Jun  9 15:04:06 2022
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 9 Jun 2022 15:04:06 +0200 (CEST)
Subject: [R-sig-Geo] 
 Need to plot all 5 spatial maps together in a single window
In-Reply-To: <CAJfMH3qWDJYCFZo0v0d1NVSSKQ+ysSPFXKy0OP_4pJ=81EB5+A@mail.gmail.com>
References: <CAJfMH3pKAvdekYnWqxnXzeNdBvtwDZKRg_Xv8=tSU9PDYvtNQw@mail.gmail.com>
 <CAPCa8=HwAjSBMO9JLPMthW6qOzckZ2ozim_hDzGoZLSaXmm+Wg@mail.gmail.com>
 <18428c6e-1175-4f8a-aec2-acc1a2373ca2@reclus2.nhh.no>
 <CAJfMH3qWDJYCFZo0v0d1NVSSKQ+ysSPFXKy0OP_4pJ=81EB5+A@mail.gmail.com>
Message-ID: <789b1c5-e4fe-60e8-16c5-33737172d83@reclus2.nhh.no>

On Thu, 9 Jun 2022, Ranjeet Kumar Jha wrote:

> Hello Roger,
>
> Thanks for your kind response! I have provided the reproducible data and
> code now in this shared link.
>
> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>
> Please now look at it! I appreciate your help.

No, now it is up to you to take the reproducible example, and modify the 
alternative you choose to suit your needs. You can keep your existing 
code but convert each sf plot to a grob in turn, use tmap, or use mapsf, 
but if I do that, you will not learn from the process. That is why 
reproducible examples are crucial; they provide a shared platform for 
learning. Providing access to your data may be sensible in an off-list 
setting when no reproducible example permits a bug to be found, but 
preferably not otherwise.

Roger

>
> Regards and Thanks,
> Ranjeet
>
> On Thu, Jun 9, 2022 at 2:48 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Thu, 9 Jun 2022, J. Marius RAKOTONDRAMANGA wrote:
>>
>>> Hi Ranjeet,
>>> Have a look to this function cowplot::plot_grid(), from
>>
>> Marius,
>>
>> Thanks for trying to help, but cowplot is designed to combine plots
>> created using grid, not base, graphics. To use it (or gridExtra), sf
>> plots, which are base graphics, must be converted to grid objects (grobs),
>> for example using the gridGraphics package.
>>
>> Since Ranjeet did not provide a reproducible example, this may not
>> correspond well, but given the lack of information, it's hard to be more
>> precise:
>>
>> library(sf)
>> nc <- st_read(system.file("gpkg/nc.gpkg", package="sf"))
>> plot(nc["BIR74"])
>>
>> creates output on the default device, but no object that can be
>> manipulated. Using:
>>
>> par(mfrow=c(2,2))
>> plot(nc["BIR74"])
>>
>> gives exactly the same output, because sf's plot() itself takes control of
>> the graphics device, so ignoring the request for multiple panels.
>>
>> par(mfrow=c(1,1))
>> plot(nc["BIR74"])
>> gridGraphics::grid.echo()
>> library(grid)
>> g <- grid.grab()
>> grid.newpage()
>> gridExtra::grid.arrange(g, b, ncol=2)
>>
>> gives two copies of our initial output after conversion to grid graphics.
>>
>> However, it is easier to choose alternatives:
>>
>> library(tmap)
>> tm_shape(nc) + tm_fill(c("BIR74", "BIR79"))
>>
>> and probably library(mapsf) too, but it, like sf, uses base graphics; it
>> respects par(mfrow=):
>>
>> library(mapsf)
>> par(mfrow=c(1,2))
>> mf_map(x=nc, var=c("BIR74"), type="choro")
>> mf_map(x=nc, var=c("BIR79"), type="choro")
>>
>> Hope this clarifies,
>>
>> Roger
>>
>>
>>>
>> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwilkelab.org%2Fcowplot%2Farticles%2Fplot_grid.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=vrH2iUZeaQw6TgzuYAYLXS6Yv%2Bt0hVXgu6PPDYcriEg%3D&amp;reserved=0
>>> It has mainy features and permit you to save also the combined plots :
>>> here
>> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsearch.r-project.org%2FCRAN%2Frefmans%2Fcowplot%2Fhtml%2Fsave_plot.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=gRj%2BPj%2B29W0mrOtT0Vp5HNEigvBQUsOL4VAdF%2B64fe0%3D&amp;reserved=0
>>> or
>> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwilkelab.org%2Fcowplot%2Freference%2Fggsave2.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Idsy6TN5bxrqZtqgi6CGpqzRKjcofl71cR9EBTc9jvY%3D&amp;reserved=0
>>>
>>> Regards,
>>>
>>>
>>> Marius,
>>>
>>>
>>> ---------
>>> J. Marius RAKOTONDRAMANGA, MSc
>>> PhD Student in Biostatistics/Biomathematics
>>> ED 393 Pierre Louis de Sant? Publique : Epid?miologie et Sciences de
>>> l'Information Biom?dicale
>>> Sorbonne Universit? (ex. UPMC)
>>>
>>>
>>> Le jeu. 9 juin 2022 ? 08:29, Ranjeet Kumar Jha <
>> ranjeetjhaiitkgp at gmail.com>
>>> a ?crit :
>>>
>>>> Hi,
>>>>
>>>> I like to plot all my 5 spatial maps of drought indices in a single
>> window
>>>> using the sf plot function in R. I am able to plot all maps separately
>> but
>>>> unable to plot altogether. All indexes are showing drought indices.
>>>>
>>>> I really appreciate your help!
>>>>
>>>> Here is the code:
>>>>
>>>> #merging using merge function
>>>> merge_drought_indices <- merge(shp_dist, drought_indices)
>>>> view(merge_drought_indices)
>>>> #plot in a single window
>>>> library(sf)
>>>> par(mfrow=c(2,2))
>>>>  plot(merge_drought_indices["r_count_lt_p05_harvest_end"],
>>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>>>  main = "End harvest index variation in India during drought year 2000",
>>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>>>
>>>>  plot(merge_drought_indices["r_count_lt_p05_harvest"],
>>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>>>  main = "Harvest variation index in India during drought year 2000",
>>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>>>
>>>>  plot(merge_drought_indices["r_count_lt_p05_main"],
>>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>>>  main = "Main growth stage index variation in India during drought year
>>>> 2000",
>>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>>>
>>>>  plot(merge_drought_indices["r_count_lt_p05_plant.start"],
>>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>>>  main = "Plant start index variation in India during drought year 2000",
>>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>>>
>>>>  plot(merge_drought_indices["r_count_lt_p05_plant"],
>>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
>>>>  main = "main plant stage index variation in India during drought year
>>>> 2000",
>>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
>>>>
>>>>
>>>> Regards and Thanks,
>>>>
>>>> Ranjeet
>>>>
>>>>
>>>> --
>>>>
>>>>
>>>>
>>>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>>>> lives beautiful!"*
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>>
>> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=awwczk%2Bpse%2B5tTKYB1ecwtuNE3C6AjgtgvzbE7Aga6w%3D&amp;reserved=0
>>>>
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>>
>> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=awwczk%2Bpse%2B5tTKYB1ecwtuNE3C6AjgtgvzbE7Aga6w%3D&amp;reserved=0
>>>
>>
>> --
>> Roger Bivand
>> Emeritus Professor
>> Department of Economics, Norwegian School of Economics,
>> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>> e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>
>
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From r@njeetjh@||tkgp @end|ng |rom gm@||@com  Thu Jun  9 15:24:02 2022
From: r@njeetjh@||tkgp @end|ng |rom gm@||@com (Ranjeet Kumar Jha)
Date: Thu, 9 Jun 2022 18:54:02 +0530
Subject: [R-sig-Geo] 
 Need to plot all 5 spatial maps together in a single window
In-Reply-To: <789b1c5-e4fe-60e8-16c5-33737172d83@reclus2.nhh.no>
References: <CAJfMH3pKAvdekYnWqxnXzeNdBvtwDZKRg_Xv8=tSU9PDYvtNQw@mail.gmail.com>
 <CAPCa8=HwAjSBMO9JLPMthW6qOzckZ2ozim_hDzGoZLSaXmm+Wg@mail.gmail.com>
 <18428c6e-1175-4f8a-aec2-acc1a2373ca2@reclus2.nhh.no>
 <CAJfMH3qWDJYCFZo0v0d1NVSSKQ+ysSPFXKy0OP_4pJ=81EB5+A@mail.gmail.com>
 <789b1c5-e4fe-60e8-16c5-33737172d83@reclus2.nhh.no>
Message-ID: <CAJfMH3pCo-Tx+-jGgNUoTNhfqhjfu2Dsi7NbUhqQG_F2kiv88w@mail.gmail.com>

Thanks a lot.

On Thu, 9 Jun 2022, 6:34 pm Roger Bivand, <Roger.Bivand at nhh.no> wrote:

> On Thu, 9 Jun 2022, Ranjeet Kumar Jha wrote:
>
> > Hello Roger,
> >
> > Thanks for your kind response! I have provided the reproducible data and
> > code now in this shared link.
> >
> >
> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
> >
> > Please now look at it! I appreciate your help.
>
> No, now it is up to you to take the reproducible example, and modify the
> alternative you choose to suit your needs. You can keep your existing
> code but convert each sf plot to a grob in turn, use tmap, or use mapsf,
> but if I do that, you will not learn from the process. That is why
> reproducible examples are crucial; they provide a shared platform for
> learning. Providing access to your data may be sensible in an off-list
> setting when no reproducible example permits a bug to be found, but
> preferably not otherwise.
>
> Roger
>
> >
> > Regards and Thanks,
> > Ranjeet
> >
> > On Thu, Jun 9, 2022 at 2:48 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> >> On Thu, 9 Jun 2022, J. Marius RAKOTONDRAMANGA wrote:
> >>
> >>> Hi Ranjeet,
> >>> Have a look to this function cowplot::plot_grid(), from
> >>
> >> Marius,
> >>
> >> Thanks for trying to help, but cowplot is designed to combine plots
> >> created using grid, not base, graphics. To use it (or gridExtra), sf
> >> plots, which are base graphics, must be converted to grid objects
> (grobs),
> >> for example using the gridGraphics package.
> >>
> >> Since Ranjeet did not provide a reproducible example, this may not
> >> correspond well, but given the lack of information, it's hard to be more
> >> precise:
> >>
> >> library(sf)
> >> nc <- st_read(system.file("gpkg/nc.gpkg", package="sf"))
> >> plot(nc["BIR74"])
> >>
> >> creates output on the default device, but no object that can be
> >> manipulated. Using:
> >>
> >> par(mfrow=c(2,2))
> >> plot(nc["BIR74"])
> >>
> >> gives exactly the same output, because sf's plot() itself takes control
> of
> >> the graphics device, so ignoring the request for multiple panels.
> >>
> >> par(mfrow=c(1,1))
> >> plot(nc["BIR74"])
> >> gridGraphics::grid.echo()
> >> library(grid)
> >> g <- grid.grab()
> >> grid.newpage()
> >> gridExtra::grid.arrange(g, b, ncol=2)
> >>
> >> gives two copies of our initial output after conversion to grid
> graphics.
> >>
> >> However, it is easier to choose alternatives:
> >>
> >> library(tmap)
> >> tm_shape(nc) + tm_fill(c("BIR74", "BIR79"))
> >>
> >> and probably library(mapsf) too, but it, like sf, uses base graphics; it
> >> respects par(mfrow=):
> >>
> >> library(mapsf)
> >> par(mfrow=c(1,2))
> >> mf_map(x=nc, var=c("BIR74"), type="choro")
> >> mf_map(x=nc, var=c("BIR79"), type="choro")
> >>
> >> Hope this clarifies,
> >>
> >> Roger
> >>
> >>
> >>>
> >>
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwilkelab.org%2Fcowplot%2Farticles%2Fplot_grid.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=vrH2iUZeaQw6TgzuYAYLXS6Yv%2Bt0hVXgu6PPDYcriEg%3D&amp;reserved=0
> >>> It has mainy features and permit you to save also the combined plots :
> >>> here
> >>
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsearch.r-project.org%2FCRAN%2Frefmans%2Fcowplot%2Fhtml%2Fsave_plot.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=gRj%2BPj%2B29W0mrOtT0Vp5HNEigvBQUsOL4VAdF%2B64fe0%3D&amp;reserved=0
> >>> or
> >>
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwilkelab.org%2Fcowplot%2Freference%2Fggsave2.html&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Idsy6TN5bxrqZtqgi6CGpqzRKjcofl71cR9EBTc9jvY%3D&amp;reserved=0
> >>>
> >>> Regards,
> >>>
> >>>
> >>> Marius,
> >>>
> >>>
> >>> ---------
> >>> J. Marius RAKOTONDRAMANGA, MSc
> >>> PhD Student in Biostatistics/Biomathematics
> >>> ED 393 Pierre Louis de Sant? Publique : Epid?miologie et Sciences de
> >>> l'Information Biom?dicale
> >>> Sorbonne Universit? (ex. UPMC)
> >>>
> >>>
> >>> Le jeu. 9 juin 2022 ? 08:29, Ranjeet Kumar Jha <
> >> ranjeetjhaiitkgp at gmail.com>
> >>> a ?crit :
> >>>
> >>>> Hi,
> >>>>
> >>>> I like to plot all my 5 spatial maps of drought indices in a single
> >> window
> >>>> using the sf plot function in R. I am able to plot all maps separately
> >> but
> >>>> unable to plot altogether. All indexes are showing drought indices.
> >>>>
> >>>> I really appreciate your help!
> >>>>
> >>>> Here is the code:
> >>>>
> >>>> #merging using merge function
> >>>> merge_drought_indices <- merge(shp_dist, drought_indices)
> >>>> view(merge_drought_indices)
> >>>> #plot in a single window
> >>>> library(sf)
> >>>> par(mfrow=c(2,2))
> >>>>  plot(merge_drought_indices["r_count_lt_p05_harvest_end"],
> >>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>>>  main = "End harvest index variation in India during drought year
> 2000",
> >>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>>>
> >>>>  plot(merge_drought_indices["r_count_lt_p05_harvest"],
> >>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>>>  main = "Harvest variation index in India during drought year 2000",
> >>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>>>
> >>>>  plot(merge_drought_indices["r_count_lt_p05_main"],
> >>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>>>  main = "Main growth stage index variation in India during drought
> year
> >>>> 2000",
> >>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>>>
> >>>>  plot(merge_drought_indices["r_count_lt_p05_plant.start"],
> >>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>>>  main = "Plant start index variation in India during drought year
> 2000",
> >>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>>>
> >>>>  plot(merge_drought_indices["r_count_lt_p05_plant"],
> >>>>  pal = colorRampPalette(c("red", "white", "blue","green")),
> >>>>  main = "main plant stage index variation in India during drought year
> >>>> 2000",
> >>>>  key.pos = 4, axes = TRUE, key.width = lcm(1.3), key.length = 1.0)
> >>>>
> >>>>
> >>>> Regards and Thanks,
> >>>>
> >>>> Ranjeet
> >>>>
> >>>>
> >>>> --
> >>>>
> >>>>
> >>>>
> >>>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make
> our
> >>>> lives beautiful!"*
> >>>>
> >>>>         [[alternative HTML version deleted]]
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at r-project.org
> >>>>
> >>
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=awwczk%2Bpse%2B5tTKYB1ecwtuNE3C6AjgtgvzbE7Aga6w%3D&amp;reserved=0
> >>>>
> >>>
> >>>       [[alternative HTML version deleted]]
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>>
> >>
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C01ce113052f9492ab51d08da49ec9930%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637903577780613163%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=awwczk%2Bpse%2B5tTKYB1ecwtuNE3C6AjgtgvzbE7Aga6w%3D&amp;reserved=0
> >>>
> >>
> >> --
> >> Roger Bivand
> >> Emeritus Professor
> >> Department of Economics, Norwegian School of Economics,
> >> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> >> e-mail: Roger.Bivand at nhh.no
> >> https://orcid.org/0000-0003-2392-6140
> >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >
> >
> >
> >
>
> --
> Roger Bivand
> Emeritus Professor
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From t|m@how@rd @end|ng |rom dec@ny@gov  Thu Jun  9 21:48:06 2022
From: t|m@how@rd @end|ng |rom dec@ny@gov (Howard, Tim G (DEC))
Date: Thu, 9 Jun 2022 19:48:06 +0000
Subject: [R-sig-Geo] df with embedded wkt lists to sf
Message-ID: <SA1PR09MB77928623770FE8533E634261A8A79@SA1PR09MB7792.namprd09.prod.outlook.com>

Howdy all -?
There's probably a way to do this much? more simply than I've figured it out, so it's a bit embarrassing but here goes. I'm getting data out of a shiny app that looks like the following, with lists of coordinates within separate longitude and latitude columns. 

Is there more efficient way to get an `sf` collection than what I've got? Perhaps an `apply` replacement for the for() loop? Using a tibble because that's how `googlesheets4` gives it to me. 

# set up a couple of lines strings. lists within data.frame/tibble
txtString <- 'structure(list(comment = c("line one", "line two"), 
longitude = list("-115.138577; -114.942454; -114.170219", "-118.411382; -118.153971; -117.83527; -117.246901; -117.026262; -117.185613"), 
latitude = list("37.527588; 38.234088; 38.368805", "41.296472; 41.645606; 41.819467; 41.837741; 41.590604; 41.333312")), 
row.names = c(NA, -2L), class = c("tbl_df", "tbl", "data.frame"))'

dat <- dget(textConnection(txtString))

# function for parsing the text strings
getWKT <- function(x){
  st_linestring(matrix(
    c(as.numeric(unlist(strsplit(x$longitude[[1]],";"))),
      as.numeric(unlist(strsplit(x$latitude[[1]],";")))),
    byrow = FALSE, ncol = 2)
  )
}

# populate dataframe/tibble by going back to sf text
dat$wkt <- NA
for(i in 1:nrow(dat)){
  dat$wkt[[i]] <- st_as_text(getWKT(dat[i,]))
}

# finally make the sf collection
dat_sf <- st_as_sf(dat, wkt = "wkt", crs = 4326)


Thanks in advance for any tips. 
Tim

From jo@|@h@p@rry @end|ng |rom gm@||@com  Thu Jun  9 22:34:16 2022
From: jo@|@h@p@rry @end|ng |rom gm@||@com (Josiah Parry)
Date: Thu, 9 Jun 2022 16:34:16 -0400
Subject: [R-sig-Geo] df with embedded wkt lists to sf
In-Reply-To: <SA1PR09MB77928623770FE8533E634261A8A79@SA1PR09MB7792.namprd09.prod.outlook.com>
References: <SA1PR09MB77928623770FE8533E634261A8A79@SA1PR09MB7792.namprd09.prod.outlook.com>
Message-ID: <CAL3ufU+Uzwu6C2Qb537rw=qhy7jUkSE7r=amXsx=N4z07jQiGg@mail.gmail.com>

Hey Tim,

The key thing here is to separate the long / lat points into elements in a
vector. You can do this with a string split. Afterwards, separate these
into their own rows like I've done below.

I think this should get you on the right path!


dat <- dget(textConnection(txtString))

dat |>
  tidyr::unnest(c(longitude, latitude)) |>
  dplyr::mutate(longitude = strsplit(longitude, "; "),
                latitude = strsplit(latitude, "; ")) |>
  tidyr::unnest(c(longitude, latitude)) |>
  sf::st_as_sf(coords = c(2, 3), crs = 4326)

On Thu, Jun 9, 2022 at 3:48 PM Howard, Tim G (DEC) via R-sig-Geo <
r-sig-geo at r-project.org> wrote:

> Howdy all -
> There's probably a way to do this much? more simply than I've figured it
> out, so it's a bit embarrassing but here goes. I'm getting data out of a
> shiny app that looks like the following, with lists of coordinates within
> separate longitude and latitude columns.
>
> Is there more efficient way to get an `sf` collection than what I've got?
> Perhaps an `apply` replacement for the for() loop? Using a tibble because
> that's how `googlesheets4` gives it to me.
>
> # set up a couple of lines strings. lists within data.frame/tibble
> txtString <- 'structure(list(comment = c("line one", "line two"),
> longitude = list("-115.138577; -114.942454; -114.170219", "-118.411382;
> -118.153971; -117.83527; -117.246901; -117.026262; -117.185613"),
> latitude = list("37.527588; 38.234088; 38.368805", "41.296472; 41.645606;
> 41.819467; 41.837741; 41.590604; 41.333312")),
> row.names = c(NA, -2L), class = c("tbl_df", "tbl", "data.frame"))'
>
> dat <- dget(textConnection(txtString))
>
> # function for parsing the text strings
> getWKT <- function(x){
>   st_linestring(matrix(
>     c(as.numeric(unlist(strsplit(x$longitude[[1]],";"))),
>       as.numeric(unlist(strsplit(x$latitude[[1]],";")))),
>     byrow = FALSE, ncol = 2)
>   )
> }
>
> # populate dataframe/tibble by going back to sf text
> dat$wkt <- NA
> for(i in 1:nrow(dat)){
>   dat$wkt[[i]] <- st_as_text(getWKT(dat[i,]))
> }
>
> # finally make the sf collection
> dat_sf <- st_as_sf(dat, wkt = "wkt", crs = 4326)
>
>
> Thanks in advance for any tips.
> Tim
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From jo@|@h@p@rry @end|ng |rom gm@||@com  Thu Jun  9 22:39:05 2022
From: jo@|@h@p@rry @end|ng |rom gm@||@com (Josiah Parry)
Date: Thu, 9 Jun 2022 16:39:05 -0400
Subject: [R-sig-Geo] df with embedded wkt lists to sf
In-Reply-To: <CAL3ufU+Uzwu6C2Qb537rw=qhy7jUkSE7r=amXsx=N4z07jQiGg@mail.gmail.com>
References: <SA1PR09MB77928623770FE8533E634261A8A79@SA1PR09MB7792.namprd09.prod.outlook.com>
 <CAL3ufU+Uzwu6C2Qb537rw=qhy7jUkSE7r=amXsx=N4z07jQiGg@mail.gmail.com>
Message-ID: <CAL3ufUKNRHcLC05M0bp4HYKpppyagdKrO4kKrGcnHU4Zd0w_Rw@mail.gmail.com>

Furthermore, if you want to get these points into a linstring you can
combine the points by group (comment) and then cast them to a line like so
below.

This is an interesting use case! Thanks for introducing me to it.

dat_sf |>
  dplyr::group_by(comment) |>
  dplyr::summarise(geometry = sf::st_cast(
    sf::st_combine(geometry), "LINESTRING"
    ))

On Thu, Jun 9, 2022 at 4:34 PM Josiah Parry <josiah.parry at gmail.com> wrote:

> Hey Tim,
>
> The key thing here is to separate the long / lat points into elements in a
> vector. You can do this with a string split. Afterwards, separate these
> into their own rows like I've done below.
>
> I think this should get you on the right path!
>
>
> dat <- dget(textConnection(txtString))
>
> dat |>
>   tidyr::unnest(c(longitude, latitude)) |>
>   dplyr::mutate(longitude = strsplit(longitude, "; "),
>                 latitude = strsplit(latitude, "; ")) |>
>   tidyr::unnest(c(longitude, latitude)) |>
>   sf::st_as_sf(coords = c(2, 3), crs = 4326)
>
> On Thu, Jun 9, 2022 at 3:48 PM Howard, Tim G (DEC) via R-sig-Geo <
> r-sig-geo at r-project.org> wrote:
>
>> Howdy all -
>> There's probably a way to do this much? more simply than I've figured it
>> out, so it's a bit embarrassing but here goes. I'm getting data out of a
>> shiny app that looks like the following, with lists of coordinates within
>> separate longitude and latitude columns.
>>
>> Is there more efficient way to get an `sf` collection than what I've got?
>> Perhaps an `apply` replacement for the for() loop? Using a tibble because
>> that's how `googlesheets4` gives it to me.
>>
>> # set up a couple of lines strings. lists within data.frame/tibble
>> txtString <- 'structure(list(comment = c("line one", "line two"),
>> longitude = list("-115.138577; -114.942454; -114.170219", "-118.411382;
>> -118.153971; -117.83527; -117.246901; -117.026262; -117.185613"),
>> latitude = list("37.527588; 38.234088; 38.368805", "41.296472; 41.645606;
>> 41.819467; 41.837741; 41.590604; 41.333312")),
>> row.names = c(NA, -2L), class = c("tbl_df", "tbl", "data.frame"))'
>>
>> dat <- dget(textConnection(txtString))
>>
>> # function for parsing the text strings
>> getWKT <- function(x){
>>   st_linestring(matrix(
>>     c(as.numeric(unlist(strsplit(x$longitude[[1]],";"))),
>>       as.numeric(unlist(strsplit(x$latitude[[1]],";")))),
>>     byrow = FALSE, ncol = 2)
>>   )
>> }
>>
>> # populate dataframe/tibble by going back to sf text
>> dat$wkt <- NA
>> for(i in 1:nrow(dat)){
>>   dat$wkt[[i]] <- st_as_text(getWKT(dat[i,]))
>> }
>>
>> # finally make the sf collection
>> dat_sf <- st_as_sf(dat, wkt = "wkt", crs = 4326)
>>
>>
>> Thanks in advance for any tips.
>> Tim
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

	[[alternative HTML version deleted]]


From t|m@how@rd @end|ng |rom dec@ny@gov  Fri Jun 10 13:16:17 2022
From: t|m@how@rd @end|ng |rom dec@ny@gov (Howard, Tim G (DEC))
Date: Fri, 10 Jun 2022 11:16:17 +0000
Subject: [R-sig-Geo] df with embedded wkt lists to sf
In-Reply-To: <CAL3ufUKNRHcLC05M0bp4HYKpppyagdKrO4kKrGcnHU4Zd0w_Rw@mail.gmail.com>
References: <SA1PR09MB77928623770FE8533E634261A8A79@SA1PR09MB7792.namprd09.prod.outlook.com>
 <CAL3ufU+Uzwu6C2Qb537rw=qhy7jUkSE7r=amXsx=N4z07jQiGg@mail.gmail.com>
 <CAL3ufUKNRHcLC05M0bp4HYKpppyagdKrO4kKrGcnHU4Zd0w_Rw@mail.gmail.com>
Message-ID: <SA1PR09MB7792AB39555F30BBBF243B1EA8A69@SA1PR09MB7792.namprd09.prod.outlook.com>

Josiah,?
Interesting, thanks for working out and posting this approach. It may be just as complex and convoluted as what I've come up with! Dis-associating the line strings to points and then re-aggregating them to lines using group-by seems iffy to me, but it works (and for polygons as well).?

Of course I've got a much larger attribute table than just a "comments" column so the spot where you define 'coords=c(2,3)' doesn't work. But I've come up with a work-around to that by finding the location of the lon/lat columns before starting. And the attribute table is lost so it needs to be joined back in a step not needed in my approach.?

I guess this confirms that there isn't already a part of? st_as_sf? I was missing!
Thanks again, 
Tim


From: Josiah Parry <josiah.parry at gmail.com>
Sent: Thursday, June 9, 2022 4:39 PM
To: Howard, Tim G (DEC) <tim.howard at dec.ny.gov>
Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] df with embedded wkt lists to sf 
?
ATTENTION: This email came from an external source. Do not open attachments or click on links from unknown senders or unexpected emails.

Furthermore, if you want to get these points into a linstring you can combine the points by group (comment) and then cast them to a line like so below.? 

This is an interesting use case! Thanks for introducing me to it.?

dat_sf |> 
? dplyr::group_by(comment) |> 
? dplyr::summarise(geometry = sf::st_cast(
? ? sf::st_combine(geometry), "LINESTRING"
? ? ))?

On Thu, Jun 9, 2022 at 4:34 PM Josiah Parry <josiah.parry at gmail.com> wrote:
Hey Tim, 

The key thing here is to separate the long / lat points into elements in a vector. You can do this with a string split. Afterwards, separate these into their own rows like I've done below.?

I think this should get you on the right path!?


dat <- dget(textConnection(txtString))

dat |> 
? tidyr::unnest(c(longitude, latitude)) |> 
? dplyr::mutate(longitude = strsplit(longitude, "; "),
? ? ? ? ? ? ? ? latitude = strsplit(latitude, "; ")) |> 
? tidyr::unnest(c(longitude, latitude)) |> 
? sf::st_as_sf(coords = c(2, 3), crs = 4326)

On Thu, Jun 9, 2022 at 3:48 PM Howard, Tim G (DEC) via R-sig-Geo <r-sig-geo at r-project.org> wrote:
Howdy all -?
There's probably a way to do this much? more simply than I've figured it out, so it's a bit embarrassing but here goes. I'm getting data out of a shiny app that looks like the following, with lists of coordinates within separate longitude and latitude columns. 

Is there more efficient way to get an `sf` collection than what I've got? Perhaps an `apply` replacement for the for() loop? Using a tibble because that's how `googlesheets4` gives it to me. 

# set up a couple of lines strings. lists within data.frame/tibble
txtString <- 'structure(list(comment = c("line one", "line two"), 
longitude = list("-115.138577; -114.942454; -114.170219", "-118.411382; -118.153971; -117.83527; -117.246901; -117.026262; -117.185613"), 
latitude = list("37.527588; 38.234088; 38.368805", "41.296472; 41.645606; 41.819467; 41.837741; 41.590604; 41.333312")), 
row.names = c(NA, -2L), class = c("tbl_df", "tbl", "data.frame"))'

dat <- dget(textConnection(txtString))

# function for parsing the text strings
getWKT <- function(x){
? st_linestring(matrix(
? ? c(as.numeric(unlist(strsplit(x$longitude[[1]],";"))),
? ? ? as.numeric(unlist(strsplit(x$latitude[[1]],";")))),
? ? byrow = FALSE, ncol = 2)
? )
}

# populate dataframe/tibble by going back to sf text
dat$wkt <- NA
for(i in 1:nrow(dat)){
? dat$wkt[[i]] <- st_as_text(getWKT(dat[i,]))
}

# finally make the sf collection
dat_sf <- st_as_sf(dat, wkt = "wkt", crs = 4326)


Thanks in advance for any tips. 
Tim
_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From jo@|@h@p@rry @end|ng |rom gm@||@com  Fri Jun 10 14:02:09 2022
From: jo@|@h@p@rry @end|ng |rom gm@||@com (Josiah Parry)
Date: Fri, 10 Jun 2022 08:02:09 -0400
Subject: [R-sig-Geo] df with embedded wkt lists to sf
In-Reply-To: <SA1PR09MB7792AB39555F30BBBF243B1EA8A69@SA1PR09MB7792.namprd09.prod.outlook.com>
References: <SA1PR09MB77928623770FE8533E634261A8A79@SA1PR09MB7792.namprd09.prod.outlook.com>
 <CAL3ufU+Uzwu6C2Qb537rw=qhy7jUkSE7r=amXsx=N4z07jQiGg@mail.gmail.com>
 <CAL3ufUKNRHcLC05M0bp4HYKpppyagdKrO4kKrGcnHU4Zd0w_Rw@mail.gmail.com>
 <SA1PR09MB7792AB39555F30BBBF243B1EA8A69@SA1PR09MB7792.namprd09.prod.outlook.com>
Message-ID: <CAL3ufUKW-12LPRO30sJiE0rcuuOX4vuYwv+7oysAXRnC5zyD6Q@mail.gmail.com>

Yeah, of course. I wouldn?t necessarily call it ?convoluted!? It?s a pretty
standard data cleaning flow.

As a note, I was last and specified the coordinate columns by position. You
should provide a vector of the column names eg c(?x?, ?y?). Check out the
help documentation for that function. It should be useful!

The process, if it?s not necessarily clear, separates each point to a row,
those points then are combined to multipoint and then cast as a line
string.

On Fri, Jun 10, 2022 at 07:16 Howard, Tim G (DEC) <tim.howard at dec.ny.gov>
wrote:

> Josiah,
> Interesting, thanks for working out and posting this approach. It may be
> just as complex and convoluted as what I've come up with! Dis-associating
> the line strings to points and then re-aggregating them to lines using
> group-by seems iffy to me, but it works (and for polygons as well).
>
> Of course I've got a much larger attribute table than just a "comments"
> column so the spot where you define 'coords=c(2,3)' doesn't work. But I've
> come up with a work-around to that by finding the location of the lon/lat
> columns before starting. And the attribute table is lost so it needs to be
> joined back in a step not needed in my approach.
>
> I guess this confirms that there isn't already a part of  st_as_sf? I was
> missing!
> Thanks again,
> Tim
>
>
> From: Josiah Parry <josiah.parry at gmail.com>
> Sent: Thursday, June 9, 2022 4:39 PM
> To: Howard, Tim G (DEC) <tim.howard at dec.ny.gov>
> Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] df with embedded wkt lists to sf
>
> ATTENTION: This email came from an external source. Do not open
> attachments or click on links from unknown senders or unexpected emails.
>
> Furthermore, if you want to get these points into a linstring you can
> combine the points by group (comment) and then cast them to a line like so
> below.
>
> This is an interesting use case! Thanks for introducing me to it.
>
> dat_sf |>
>   dplyr::group_by(comment) |>
>   dplyr::summarise(geometry = sf::st_cast(
>     sf::st_combine(geometry), "LINESTRING"
>     ))
>
> On Thu, Jun 9, 2022 at 4:34 PM Josiah Parry <josiah.parry at gmail.com>
> wrote:
> Hey Tim,
>
> The key thing here is to separate the long / lat points into elements in a
> vector. You can do this with a string split. Afterwards, separate these
> into their own rows like I've done below.
>
> I think this should get you on the right path!
>
>
> dat <- dget(textConnection(txtString))
>
> dat |>
>   tidyr::unnest(c(longitude, latitude)) |>
>   dplyr::mutate(longitude = strsplit(longitude, "; "),
>                 latitude = strsplit(latitude, "; ")) |>
>   tidyr::unnest(c(longitude, latitude)) |>
>   sf::st_as_sf(coords = c(2, 3), crs = 4326)
>
> On Thu, Jun 9, 2022 at 3:48 PM Howard, Tim G (DEC) via R-sig-Geo <
> r-sig-geo at r-project.org> wrote:
> Howdy all -
> There's probably a way to do this much? more simply than I've figured it
> out, so it's a bit embarrassing but here goes. I'm getting data out of a
> shiny app that looks like the following, with lists of coordinates within
> separate longitude and latitude columns.
>
> Is there more efficient way to get an `sf` collection than what I've got?
> Perhaps an `apply` replacement for the for() loop? Using a tibble because
> that's how `googlesheets4` gives it to me.
>
> # set up a couple of lines strings. lists within data.frame/tibble
> txtString <- 'structure(list(comment = c("line one", "line two"),
> longitude = list("-115.138577; -114.942454; -114.170219", "-118.411382;
> -118.153971; -117.83527; -117.246901; -117.026262; -117.185613"),
> latitude = list("37.527588; 38.234088; 38.368805", "41.296472; 41.645606;
> 41.819467; 41.837741; 41.590604; 41.333312")),
> row.names = c(NA, -2L), class = c("tbl_df", "tbl", "data.frame"))'
>
> dat <- dget(textConnection(txtString))
>
> # function for parsing the text strings
> getWKT <- function(x){
>   st_linestring(matrix(
>     c(as.numeric(unlist(strsplit(x$longitude[[1]],";"))),
>       as.numeric(unlist(strsplit(x$latitude[[1]],";")))),
>     byrow = FALSE, ncol = 2)
>   )
> }
>
> # populate dataframe/tibble by going back to sf text
> dat$wkt <- NA
> for(i in 1:nrow(dat)){
>   dat$wkt[[i]] <- st_as_text(getWKT(dat[i,]))
> }
>
> # finally make the sf collection
> dat_sf <- st_as_sf(dat, wkt = "wkt", crs = 4326)
>
>
> Thanks in advance for any tips.
> Tim
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From n|ko@@tz|ok@@ @end|ng |rom gm@||@com  Tue Jun 14 15:08:54 2022
From: n|ko@@tz|ok@@ @end|ng |rom gm@||@com (Nikolaos Tziokas)
Date: Tue, 14 Jun 2022 14:08:54 +0100
Subject: [R-sig-Geo] Accounting for the point spread function when
 downscaling a satellite image using a spectral index as covariate
Message-ID: <CAGg5H0aO+gOtZ4Fg55rV=1r9zg40dgDqnYk_MNBot_MVQq117Q@mail.gmail.com>

Hi, I want to downscale a nighttime lights satellite image (VIIRS DNB)
using as covariate a spectral index (Normalize Difference Vegetation
Index-NDVI) calculated from Landsat 8. For the downscaling I am using
geographically
weighted regression and area-to-point kriging. I'd like to account for
the Point
Spread Function (PSF) during downscaling. For this reason, I am following
the paper of Wang et al., (2020) '*The effect of point spread function on
downscaling continua*'. On page 254 they mention the necessary steps for
approximation of the PSF:

   1.

   *The fine spatial resolution band (e.g., 10 m Sentinel-2 band) is
   convolved with a Gaussian PSF (with scale parameter ?i) and upscaled to the
   coarse spatial resolution (e.g., 20 m).*
   2.

   *For the coarse band, a linear regression model is fitted between the
   upscaled image (e.g., 20 m Sentinel-2 image) and the observed coarse image
   (e.g., the observed 20 m Sentinel-2 image). The CC is calculated.*
   3.

   *Step (2) is conducted for all parameter candidates of ?. For the
   visited coarse band, the optimal ? is estimated as the one leading to the
   largest CC in (2).*

Their paper differs from my methodology because they used as covariate a
single spectral band (and it's PSF) to downscale one other spectral band,
while in my case I am using a spectral index (NDVI) which is a combination
of spectral bands. My question is this: how should I approach for the
approximation of the PSF of NDVI? I already downscaled the VIIRS DNB but
without taking into account the PSF. I used the atakrig package. I can
share my code but I thought it would be irrelevant in this point. Thank you.

-- 
Tziokas Nikolaos
GIS Technician

Tel:(+44)07561120302
LinkedIn <http://linkedin.com/in/nikolaos-tziokas-896081130>

	[[alternative HTML version deleted]]


From b@ev@n@@unc @end|ng |rom gm@||@com  Wed Jun 22 17:46:58 2022
From: b@ev@n@@unc @end|ng |rom gm@||@com (Brian Evans)
Date: Wed, 22 Jun 2022 11:46:58 -0400
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 224, Issue 11
In-Reply-To: <mailman.28939.3.1650621602.29159.r-sig-geo@r-project.org>
References: <mailman.28939.3.1650621602.29159.r-sig-geo@r-project.org>
Message-ID: <CAF6G4vxYcLU4zgK_bfrK+zwmYvMzZhDJaspjdSdxpHLTx=X+nA@mail.gmail.com>

On Fri, Apr 22, 2022, 06:01 <r-sig-geo-request at r-project.org> wrote:

> Send R-sig-Geo mailing list submissions to
>         r-sig-geo at r-project.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help' to
>         r-sig-geo-request at r-project.org
>
> You can reach the person managing the list at
>         r-sig-geo-owner at r-project.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of R-sig-Geo digest..."
>
>
> Today's Topics:
>
>    1. gdalUtils future... (Jonathan Greenberg)
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Thu, 21 Apr 2022 08:30:46 -0700
> From: Jonathan Greenberg <jgreenberg at unr.edu>
> To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
> Subject: [R-sig-Geo] gdalUtils future...
> Message-ID:
>         <CABG0rftt79ba2KgCagr8xg616ceqq4u_EH=
> qFt5TQm5uvMviBA at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Hi all -- I know some of you have used gdalUtils in the past and some
> r-sig-geo packages have dependencies on it.  At present, I do not plan to
> continue support for the package myself, but I would be thrilled if someone
> might be interested in stepping up to take it over.  If anyone is
> interested, please shoot me an email at this address and we can arrange a
> time to speak.
>
> Here's the github repo:
>
> https://github.com/cran/gdalUtils
>
> --j
>
> --
> Jonathan A. Greenberg, PhD
> Randall Endowed Professor and Associate Professor of Remote Sensing
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Natural Resources & Environmental Science
> University of Nevada, Reno
> 1664 N Virginia St MS 0186
> Reno, NV 89557
> Phone: 415-763-5476
> Web: https://gearslab.org/
> Twitter: @GearsLaboratory <https://twitter.com/GearsLaboratory>
>
>         [[alternative HTML version deleted]]
>
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> ------------------------------
>
> End of R-sig-Geo Digest, Vol 224, Issue 11
> ******************************************
>

	[[alternative HTML version deleted]]


From rod@romero @end|ng |rom gm@||@com  Thu Jun 30 15:29:33 2022
From: rod@romero @end|ng |rom gm@||@com (David Romero)
Date: Thu, 30 Jun 2022 08:29:33 -0500
Subject: [R-sig-Geo] r-sig-geo@r-project.org
Message-ID: <CAJx8RnHNmK4KX=KgxL7PRfwCwmWsB389py8t35zv3X_hA_bYNQ@mail.gmail.com>

Hello,
How can I construct an sf polyline object directly in sf? I have a data
frame with 3 pairs of coordinates and need for each row a 2 segment line.

I did it with sp but would like to migrate to sf:

base$ID<-seq(1,nrow(base),1)
base_lines <- apply(base,1,function(x){
  points <- data.frame(lng=as.numeric(c(x["LONG1"],x["LONG2"],x["LONG3"])),

 lat=as.numeric(c(x["LAT1"],x["LAT2"],x["LAT3"])),stringsAsFactors = F)
  coordinates(points) <- c("lng","lat")
  Lines(Line(points),ID=as.numeric(x["ID"]))})
row.names(base) <- base$ID
base_lines <- SpatialLinesDataFrame(SpatialLines(base_lines),base)
sflines<-st_as_sf(base_lines)

	[[alternative HTML version deleted]]


From btupper @end|ng |rom b|ge|ow@org  Thu Jun 30 15:51:24 2022
From: btupper @end|ng |rom b|ge|ow@org (Ben Tupper)
Date: Thu, 30 Jun 2022 09:51:24 -0400
Subject: [R-sig-Geo] r-sig-geo@r-project.org
In-Reply-To: <CAJx8RnHNmK4KX=KgxL7PRfwCwmWsB389py8t35zv3X_hA_bYNQ@mail.gmail.com>
References: <CAJx8RnHNmK4KX=KgxL7PRfwCwmWsB389py8t35zv3X_hA_bYNQ@mail.gmail.com>
Message-ID: <CALrbzg1FJYUaBAFS=cGWfFYibvBh0gLPtJfxKLBtcgFgzbmjYw@mail.gmail.com>

Hi,

Hmmm... I think I can see what you are trying, but the mailing list
mangles HTML messages (switch your email to client to plain text mode
for this list).  Mifght you share what you get when you run,

dput(head(base))

in R?  That way each of us would have a small sample of your data.
And also resend the code to the list in plain text so we don't have to
to yoga moves to read the code?

Best wishes,
Ben


On Thu, Jun 30, 2022 at 9:30 AM David Romero <rodaromero at gmail.com> wrote:
>
> Hello,
> How can I construct an sf polyline object directly in sf? I have a data
> frame with 3 pairs of coordinates and need for each row a 2 segment line.
>
> I did it with sp but would like to migrate to sf:
>
> base$ID<-seq(1,nrow(base),1)
> base_lines <- apply(base,1,function(x){
>   points <- data.frame(lng=as.numeric(c(x["LONG1"],x["LONG2"],x["LONG3"])),
>
>  lat=as.numeric(c(x["LAT1"],x["LAT2"],x["LAT3"])),stringsAsFactors = F)
>   coordinates(points) <- c("lng","lat")
>   Lines(Line(points),ID=as.numeric(x["ID"]))})
> row.names(base) <- base$ID
> base_lines <- SpatialLinesDataFrame(SpatialLines(base_lines),base)
> sflines<-st_as_sf(base_lines)
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Ben Tupper (he/him)
Bigelow Laboratory for Ocean Science
East Boothbay, Maine
http://www.bigelow.org/
https://eco.bigelow.org


From rod@romero @end|ng |rom gm@||@com  Thu Jun 30 16:19:00 2022
From: rod@romero @end|ng |rom gm@||@com (David Romero)
Date: Thu, 30 Jun 2022 09:19:00 -0500
Subject: [R-sig-Geo] r-sig-geo@r-project.org
In-Reply-To: <CALrbzg1FJYUaBAFS=cGWfFYibvBh0gLPtJfxKLBtcgFgzbmjYw@mail.gmail.com>
References: <CAJx8RnHNmK4KX=KgxL7PRfwCwmWsB389py8t35zv3X_hA_bYNQ@mail.gmail.com>
 <CALrbzg1FJYUaBAFS=cGWfFYibvBh0gLPtJfxKLBtcgFgzbmjYw@mail.gmail.com>
Message-ID: <CAJx8RnEan3jUPpkbYZu8a_y3svT7nXcWP1f2Yi9Kg0Tcoh09qw@mail.gmail.com>

Here it is:

Hello,
How can I construct an sf polyline object directly in sf? I have a
data frame with 3 pairs of coordinates and need for each row a 2
segment line.
I did it with sp but would like to migrate to sf:

dput(head(base))
structure(list(Cuenca = c("NA", "NA", "NA", "NA", "NA", "NA"),IDH =
c("AL011851", "AL011851", "AL011851", "AL011851",
"AL011851","AL011851"), W = c(80L, 80L, 80L, 80L, 70L, 60L), LAT1 =
c(28,28, 28.05, 28.15, 28.2, 28.25), LONG1 = c(-95.1, -95.7,
-96.25,-96.65, -96.9, -97.3), LAT3 = c(28, 28.05, 28.15, 28.2,
28.25,28.35), LONG3 = c(-95.7, -96.25, -96.65, -96.9, -97.3, -97.95),
LAT2 = c(28, 28, 28.1, 28.2, 28.2, 28.3), LONG2 = c(-95.4,-96, -96.5,
-96.8, -97, -97.6), Resid = c(6, 6, 4.5, 3, 4.5,6)),row.names = c(NA,
6L), class = "data.frame")

base$ID<-seq(1,nrow(base),1)
base_lines <- apply(base,1,function(x){
  points <- data.frame(lng=as.numeric(c(x["LONG1"],x["LONG2"],x["LONG3"])),lat=as.numeric(c(x["LAT1"],x["LAT2"],x["LAT3"])),stringsAsFactors
= F)
  coordinates(points) <- c("lng","lat")
  Lines(Line(points),ID=as.numeric(x["ID"]))})
row.names(base) <- base$ID
base_lines <- SpatialLinesDataFrame(SpatialLines(base_lines),base)
sflines<-st_as_sf(base_lines)


Le jeu. 30 juin 2022 ? 08:51, Ben Tupper <btupper at bigelow.org> a ?crit :
>
> Hi,
>
> Hmmm... I think I can see what you are trying, but the mailing list
> mangles HTML messages (switch your email to client to plain text mode
> for this list).  Mifght you share what you get when you run,
>
> dput(head(base))
>
> in R?  That way each of us would have a small sample of your data.
> And also resend the code to the list in plain text so we don't have to
> to yoga moves to read the code?
>
> Best wishes,
> Ben
>
>
> On Thu, Jun 30, 2022 at 9:30 AM David Romero <rodaromero at gmail.com> wrote:
> >
> > Hello,
> > How can I construct an sf polyline object directly in sf? I have a data
> > frame with 3 pairs of coordinates and need for each row a 2 segment line.
> >
> > I did it with sp but would like to migrate to sf:
> >
> > base$ID<-seq(1,nrow(base),1)
> > base_lines <- apply(base,1,function(x){
> >   points <- data.frame(lng=as.numeric(c(x["LONG1"],x["LONG2"],x["LONG3"])),
> >
> >  lat=as.numeric(c(x["LAT1"],x["LAT2"],x["LAT3"])),stringsAsFactors = F)
> >   coordinates(points) <- c("lng","lat")
> >   Lines(Line(points),ID=as.numeric(x["ID"]))})
> > row.names(base) <- base$ID
> > base_lines <- SpatialLinesDataFrame(SpatialLines(base_lines),base)
> > sflines<-st_as_sf(base_lines)
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Ben Tupper (he/him)
> Bigelow Laboratory for Ocean Science
> East Boothbay, Maine
> http://www.bigelow.org/
> https://eco.bigelow.org


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Thu Jun 30 19:58:06 2022
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Thu, 30 Jun 2022 19:58:06 +0200
Subject: [R-sig-Geo] r-sig-geo@r-project.org
In-Reply-To: <CAJx8RnEan3jUPpkbYZu8a_y3svT7nXcWP1f2Yi9Kg0Tcoh09qw@mail.gmail.com>
References: <CAJx8RnHNmK4KX=KgxL7PRfwCwmWsB389py8t35zv3X_hA_bYNQ@mail.gmail.com>
 <CALrbzg1FJYUaBAFS=cGWfFYibvBh0gLPtJfxKLBtcgFgzbmjYw@mail.gmail.com>
 <CAJx8RnEan3jUPpkbYZu8a_y3svT7nXcWP1f2Yi9Kg0Tcoh09qw@mail.gmail.com>
Message-ID: <dad28a19-d91e-80d2-8e3a-db8ac598ea4b@uni-muenster.de>

Here is a way to do this:

base = structure(list(Cuenca = c("NA", "NA", "NA", "NA", "NA", "NA"),IDH =
c("AL011851", "AL011851", "AL011851", "AL011851",
"AL011851","AL011851"), W = c(80L, 80L, 80L, 80L, 70L, 60L), LAT1 =
c(28,28, 28.05, 28.15, 28.2, 28.25), LONG1 = c(-95.1, -95.7,
-96.25,-96.65, -96.9, -97.3), LAT3 = c(28, 28.05, 28.15, 28.2,
28.25,28.35), LONG3 = c(-95.7, -96.25, -96.65, -96.9, -97.3, -97.95),
LAT2 = c(28, 28, 28.1, 28.2, 28.2, 28.3), LONG2 = c(-95.4,-96, -96.5,
-96.8, -97, -97.6), Resid = c(6, 6, 4.5, 3, 4.5,6)),row.names = c(NA,
6L), class = "data.frame")

base$ID <- seq(1,nrow(base),1)

library(sf)
# Linking to GEOS 3.10.2, GDAL 3.4.3, PROJ 8.2.0; sf_use_s2() is TRUE

base_lines <- lapply(1:nrow(base), function(i){
   x = base[i,,drop=FALSE] # row i
   points <- 
cbind(lng=as.numeric(c(x["LONG1"],x["LONG2"],x["LONG3"])),lat=as.numeric(c(x["LAT1"],x["LAT2"],x["LAT3"])))
   st_linestring(points)
})
lines = st_sfc(base_lines)
names(lines) = NULL
(sflines = st_sf(base, geometry = lines))
# Simple feature collection with 6 features and 11 fields
# Geometry type: LINESTRING
# Dimension:     XY
# Bounding box:  xmin: -97.95 ymin: 28 xmax: -95.1 ymax: 28.35
# CRS:           NA
#   Cuenca      IDH  W  LAT1  LONG1  LAT3  LONG3 LAT2 LONG2 Resid ID
# 1     NA AL011851 80 28.00 -95.10 28.00 -95.70 28.0 -95.4   6.0  1
# 2     NA AL011851 80 28.00 -95.70 28.05 -96.25 28.0 -96.0   6.0  2
# 3     NA AL011851 80 28.05 -96.25 28.15 -96.65 28.1 -96.5   4.5  3
# 4     NA AL011851 80 28.15 -96.65 28.20 -96.90 28.2 -96.8   3.0  4
# 5     NA AL011851 70 28.20 -96.90 28.25 -97.30 28.2 -97.0   4.5  5
# 6     NA AL011851 60 28.25 -97.30 28.35 -97.95 28.3 -97.6   6.0  6
#                         geometry
# 1 LINESTRING (-95.1 28, -95.4...
# 2 LINESTRING (-95.7 28, -96 2...
# 3 LINESTRING (-96.25 28.05, -...
# 4 LINESTRING (-96.65 28.15, -...
# 5 LINESTRING (-96.9 28.2, -97...
# 6 LINESTRING (-97.3 28.25, -9...

# reference:
library(sp)
base_lines <- apply(base,1,function(x){
   points <- 
data.frame(lng=as.numeric(c(x["LONG1"],x["LONG2"],x["LONG3"])),lat=as.numeric(c(x["LAT1"],x["LAT2"],x["LAT3"])),stringsAsFactors
= F)
   coordinates(points) <- c("lng","lat")
   Lines(Line(points),ID=as.numeric(x["ID"]))})
row.names(base) <- base$ID
base_lines <- SpatialLinesDataFrame(SpatialLines(base_lines),base)
sflines_ref <- st_as_sf(base_lines)
sflines_ref
# Simple feature collection with 6 features and 11 fields
# Geometry type: LINESTRING
# Dimension:     XY
# Bounding box:  xmin: -97.95 ymin: 28 xmax: -95.1 ymax: 28.35
# CRS:           NA
#   Cuenca      IDH  W  LAT1  LONG1  LAT3  LONG3 LAT2 LONG2 Resid ID
# 1     NA AL011851 80 28.00 -95.10 28.00 -95.70 28.0 -95.4   6.0  1
# 2     NA AL011851 80 28.00 -95.70 28.05 -96.25 28.0 -96.0   6.0  2
# 3     NA AL011851 80 28.05 -96.25 28.15 -96.65 28.1 -96.5   4.5  3
# 4     NA AL011851 80 28.15 -96.65 28.20 -96.90 28.2 -96.8   3.0  4
# 5     NA AL011851 70 28.20 -96.90 28.25 -97.30 28.2 -97.0   4.5  5
# 6     NA AL011851 60 28.25 -97.30 28.35 -97.95 28.3 -97.6   6.0  6
#                         geometry
# 1 LINESTRING (-95.1 28, -95.4...
# 2 LINESTRING (-95.7 28, -96 2...
# 3 LINESTRING (-96.25 28.05, -...
# 4 LINESTRING (-96.65 28.15, -...
# 5 LINESTRING (-96.9 28.2, -97...
# 6 LINESTRING (-97.3 28.25, -9...

all.equal(sflines, sflines_ref, check.attributes = FALSE)
# [1] TRUE


On 30/06/2022 16:19, David Romero wrote:
> Here it is:
> 
> Hello,
> How can I construct an sf polyline object directly in sf? I have a
> data frame with 3 pairs of coordinates and need for each row a 2
> segment line.
> I did it with sp but would like to migrate to sf:
> 
> dput(head(base))
> structure(list(Cuenca = c("NA", "NA", "NA", "NA", "NA", "NA"),IDH =
> c("AL011851", "AL011851", "AL011851", "AL011851",
> "AL011851","AL011851"), W = c(80L, 80L, 80L, 80L, 70L, 60L), LAT1 =
> c(28,28, 28.05, 28.15, 28.2, 28.25), LONG1 = c(-95.1, -95.7,
> -96.25,-96.65, -96.9, -97.3), LAT3 = c(28, 28.05, 28.15, 28.2,
> 28.25,28.35), LONG3 = c(-95.7, -96.25, -96.65, -96.9, -97.3, -97.95),
> LAT2 = c(28, 28, 28.1, 28.2, 28.2, 28.3), LONG2 = c(-95.4,-96, -96.5,
> -96.8, -97, -97.6), Resid = c(6, 6, 4.5, 3, 4.5,6)),row.names = c(NA,
> 6L), class = "data.frame")
> 
> base$ID<-seq(1,nrow(base),1)
> base_lines <- apply(base,1,function(x){
>    points <- data.frame(lng=as.numeric(c(x["LONG1"],x["LONG2"],x["LONG3"])),lat=as.numeric(c(x["LAT1"],x["LAT2"],x["LAT3"])),stringsAsFactors
> = F)
>    coordinates(points) <- c("lng","lat")
>    Lines(Line(points),ID=as.numeric(x["ID"]))})
> row.names(base) <- base$ID
> base_lines <- SpatialLinesDataFrame(SpatialLines(base_lines),base)
> sflines<-st_as_sf(base_lines)
> 
> 
> Le jeu. 30 juin 2022 ? 08:51, Ben Tupper <btupper at bigelow.org> a ?crit :
>>
>> Hi,
>>
>> Hmmm... I think I can see what you are trying, but the mailing list
>> mangles HTML messages (switch your email to client to plain text mode
>> for this list).  Mifght you share what you get when you run,
>>
>> dput(head(base))
>>
>> in R?  That way each of us would have a small sample of your data.
>> And also resend the code to the list in plain text so we don't have to
>> to yoga moves to read the code?
>>
>> Best wishes,
>> Ben
>>
>>
>> On Thu, Jun 30, 2022 at 9:30 AM David Romero <rodaromero at gmail.com> wrote:
>>>
>>> Hello,
>>> How can I construct an sf polyline object directly in sf? I have a data
>>> frame with 3 pairs of coordinates and need for each row a 2 segment line.
>>>
>>> I did it with sp but would like to migrate to sf:
>>>
>>> base$ID<-seq(1,nrow(base),1)
>>> base_lines <- apply(base,1,function(x){
>>>    points <- data.frame(lng=as.numeric(c(x["LONG1"],x["LONG2"],x["LONG3"])),
>>>
>>>   lat=as.numeric(c(x["LAT1"],x["LAT2"],x["LAT3"])),stringsAsFactors = F)
>>>    coordinates(points) <- c("lng","lat")
>>>    Lines(Line(points),ID=as.numeric(x["ID"]))})
>>> row.names(base) <- base$ID
>>> base_lines <- SpatialLinesDataFrame(SpatialLines(base_lines),base)
>>> sflines<-st_as_sf(base_lines)
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Ben Tupper (he/him)
>> Bigelow Laboratory for Ocean Science
>> East Boothbay, Maine
>> http://www.bigelow.org/
>> https://eco.bigelow.org
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081


