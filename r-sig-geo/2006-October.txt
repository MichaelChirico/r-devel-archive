From Roger.Bivand at nhh.no  Sun Oct  1 22:49:21 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 1 Oct 2006 22:49:21 +0200 (CEST)
Subject: [R-sig-Geo] Considering "boundary effect" in spdep or spgwr
In-Reply-To: <20060928044424.90331.qmail@web10702.mail.bbt.yahoo.co.jp>
Message-ID: <Pine.LNX.4.44.0610012239290.1977-100000@reclus.nhh.no>

On Thu, 28 Sep 2006, Hisaji ONO wrote:

> Hello.
> 
>  In some "geo-spatial analysis" text books & articles,
> "boundary effect" was referred.
> 
>  For spatial weight matrix and its related statistical
> methods, this issue is very important, I think.
> 
>  For this issue, I've looked for this in "spdep" and
> "spgwr" in their "manual" pdf files, but no luck.
> 
>  Current version of these packages consider "boundary
> effect"? 
> 

Yes, you are right that boundary (or edge) effects can be important. They 
concern the extent to which inferences may change if we change the edges 
of the study area, and/or the configuration effect that occurs when some 
observations are fully surrounded (in the centre of the study area) and 
others are on the edge. 

There is an indirect reference to this in the joincount.test() example in
spdep - it uses different settings of the spatial weights style= argument
to show how weights configuration can change inference. So in spdep, the
only treatment is through the style= argument.

In spgwr, fitting adaptive bandwidths seems to be one way of preventing
observations far from their neighbours being impacted by a single global
distance bandwidth. The GWR book doesn't have edge effects in its index.

Best wishes,

Roger

> 
> 
>  Regards.
> 
> 
> 
> 
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From borghor at yahoo.ca  Mon Oct  2 16:36:10 2006
From: borghor at yahoo.ca (bertrand toupin)
Date: Mon, 2 Oct 2006 10:36:10 -0400 (EDT)
Subject: [R-sig-Geo] Error with krige.cv
In-Reply-To: <Pine.LNX.4.44.0609252128360.27019-100000@reclus.nhh.no>
Message-ID: <20061002143610.18578.qmail@web42204.mail.scd.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061002/0352cb5e/attachment.pl>

From e.pebesma at geo.uu.nl  Mon Oct  2 16:50:07 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 02 Oct 2006 16:50:07 +0200
Subject: [R-sig-Geo] Error with krige.cv
In-Reply-To: <20061002143610.18578.qmail@web42204.mail.scd.yahoo.com>
References: <20061002143610.18578.qmail@web42204.mail.scd.yahoo.com>
Message-ID: <4521271F.8030008@geo.uu.nl>

Bertrand,

Several causes can lead to a singular covariance matrix; the most common is
that you have duplicate observations (i.e. two or more observations on the
same location). Use zerodist to find out.
--
Edzer

bertrand toupin wrote:
> Hi everyone, another obstacle towards the achievement :)
>
> I'm trying to do a kriging of my data on a regular grid.  My data is organized like :
>
> Donnees (the data matrix) 
>
> Period      x(km)   y(km)      Stations      z(m)
>     1          400      400           22.5          120
>     1          430      500             34.5           56
> etc....
>
> For each period, I have 2300 stations.  
>
> So for t=1,  I do :
>
> vario=variogram(Stations~1,loc=~x+y,Donnees[Donnees$Periode==t,],cutoff=150,width=10)
> modele1=fit.variogram(vario,vgm(max(vario[,3]),"Nug"),fit.method=1)
> Info$KO1nugget[t]= modele1$psill[1]
> valid=krige.cv(Stations~1,~x+y,model=modele1,data=Donnees[Donnees$Periode==t,]) 
> The last command, I got this error :
>
> " [using ordinary kriging]
>
> "chfactor.c", line 130: singular matrix in function LDLfactor()
> Erreur dans predict.gstat(object, newdata = data[sel, ], ...) : 
>         LDLfactor  "
>
> I tried a lot of things, but nothing worked.  Any idea?
>
> Thanks!
> Philippe
>
> N.B. sessionInfo() gives :
>  sessionInfo()
> Version 2.3.1 (2006-06-01) 
> i386-pc-mingw32 
>
> attached base packages:
> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"  "base"     
>
> other attached packages:
>    gstat    rgdal       sp 
> "0.9-31" "0.4-10" "0.8-20" 
>
>
>  		
> ---------------------------------
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From wouter at paramo.be  Mon Oct  2 17:03:13 2006
From: wouter at paramo.be (Wouter Buytaert)
Date: Mon, 2 Oct 2006 16:03:13 +0100 (BST)
Subject: [R-sig-Geo] spatial averaging of interpolation data
Message-ID: <Pine.OSX.4.60.0610021554100.297@slobkous.local>


Hi list,

this is a rather theoretical question, so sorry if it is not very 
appropriate for this list, but with a bit of luck someone may feel 
challenged to reply.

I am looking for the correct procedure to average spatially interpolated 
data over an area. Specifically, I used kriging to interpolate point 
rainfall over a grid covering a catchment and now I want to estimate the 
average rainfall over the catchment, including the uncertainty on the 
estimation.

Obviously, taking just the mean and the variance of all the grid 
cell values doesn't work because it does not take into account spatial 
correlation and thus underestimates the uncertainty.

So what is/are the best method(s)? Suggestions on how to implement them in 
R are very welcome, as well as suggestions for literature if the answer 
would turn out to be more complicate than I imagined.

Many thanks!

Wouter Buytaert
Lancaster University



From e.pebesma at geo.uu.nl  Mon Oct  2 17:20:11 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 02 Oct 2006 17:20:11 +0200
Subject: [R-sig-Geo] spatial averaging of interpolation data
In-Reply-To: <Pine.OSX.4.60.0610021554100.297@slobkous.local>
References: <Pine.OSX.4.60.0610021554100.297@slobkous.local>
Message-ID: <45212E2B.4000602@geo.uu.nl>

Wouter,

you could resort to simulation, i.e. generate conditional
simulations, compute the catchment aggregated value and obtain
their distribution experimentally. If you're after the catchment mean,
you better use block kriging for irregular blocks (the catchment).
R package gstat provides this. If you're after another quantity,
e.g. the catchment fraction above a given threshold you need
to simulate, and e.g. use overlay() to select points in the catchment,
select them, calculate statistics, etc.

Hth,
--
Edzer

Wouter Buytaert wrote:
> Hi list,
>
> this is a rather theoretical question, so sorry if it is not very 
> appropriate for this list, but with a bit of luck someone may feel 
> challenged to reply.
>
> I am looking for the correct procedure to average spatially interpolated 
> data over an area. Specifically, I used kriging to interpolate point 
> rainfall over a grid covering a catchment and now I want to estimate the 
> average rainfall over the catchment, including the uncertainty on the 
> estimation.
>
> Obviously, taking just the mean and the variance of all the grid 
> cell values doesn't work because it does not take into account spatial 
> correlation and thus underestimates the uncertainty.
>
> So what is/are the best method(s)? Suggestions on how to implement them in 
> R are very welcome, as well as suggestions for literature if the answer 
> would turn out to be more complicate than I imagined.
>
> Many thanks!
>
> Wouter Buytaert
> Lancaster University
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From sf2257 at columbia.edu  Mon Oct  2 18:39:39 2006
From: sf2257 at columbia.edu (Sam Field)
Date: Mon, 02 Oct 2006 12:39:39 -0400
Subject: [R-sig-Geo] spatial averaging of interpolation data
In-Reply-To: <Pine.OSX.4.60.0610021554100.297@slobkous.local>
References: <Pine.OSX.4.60.0610021554100.297@slobkous.local>
Message-ID: <1159807179.452140cb9553d@cubmail.cc.columbia.edu>

I was going to say bootstrapping, but I guess that wouldn't work
since you can't have duplicate locations with kriging (see previous
post), as you would if you sampled from your sample.

Sam


Quoting Wouter Buytaert <wouter at paramo.be>:

>
> Hi list,
>
> this is a rather theoretical question, so sorry if it is not very
> appropriate for this list, but with a bit of luck someone may
> feel
> challenged to reply.
>
> I am looking for the correct procedure to average spatially
> interpolated
> data over an area. Specifically, I used kriging to interpolate
> point
> rainfall over a grid covering a catchment and now I want to
> estimate the
> average rainfall over the catchment, including the uncertainty on
> the
> estimation.
>
> Obviously, taking just the mean and the variance of all the grid
> cell values doesn't work because it does not take into account
> spatial
> correlation and thus underestimates the uncertainty.
>
> So what is/are the best method(s)? Suggestions on how to
> implement them in
> R are very welcome, as well as suggestions for literature if the
> answer
> would turn out to be more complicate than I imagined.
>
> Many thanks!
>
> Wouter Buytaert
> Lancaster University
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Samuel H. Field, Ph.D.
Associate Research Scholar
Institute for Social and Economic Research and Policy (ISERP)
Columbia University
420 W. 118th Street
Mail code 3355
New York, NY  10027
215-731-0106



From borghor at yahoo.ca  Mon Oct  2 20:37:57 2006
From: borghor at yahoo.ca (bertrand toupin)
Date: Mon, 2 Oct 2006 14:37:57 -0400 (EDT)
Subject: [R-sig-Geo] Error with krige.cv
In-Reply-To: <4521271F.8030008@geo.uu.nl>
Message-ID: <20061002183757.26466.qmail@web42202.mail.scd.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061002/0e17fa9e/attachment.pl>

From horacio at unm.edu  Tue Oct  3 23:52:42 2006
From: horacio at unm.edu (Horacio)
Date: Tue, 03 Oct 2006 15:52:42 -0600
Subject: [R-sig-Geo] distribution of distance for lags (spdep package)
In-Reply-To: <mailman.11.1159869604.23348.r-sig-geo@stat.math.ethz.ch>
References: <mailman.11.1159869604.23348.r-sig-geo@stat.math.ethz.ch>
Message-ID: <4522DBAA.9060902@unm.edu>

Dear R-geo people,

I just discovered the beauty of the spdep package to make spatial 
analysis of point data easier... However, as I am climbing the learning 
curve I have a question regarding the estimation of the the lag in the 
Moran and/or corelogram function.

As I understand, if the you generate a neighbor-list using the 
knearneigh 
<http://finzi.psych.upenn.edu/R/library/spdep/html/knearneigh.html> 
function you get a 'knn' class of the points I k distance apart. Then 
when you calculate the Moran's I (at least that's what I did) you get 
the Lag in terms of the number of links which in practical purposes is 
k. so, the first correlation value (od Moran's I) is the obtained by 
comaring all the sites that have a direct link between them, then, the 
second lag does it in terms of the ones that are 2 links apart and so on...

My question is perhaps very simple... How can I generate a list to plot 
the distribution of distances for each lag? I thought nbdists could do 
it, but are not sure how to go about it...


thank you



Horacio



From hi_ono2001 at yahoo.co.jp  Wed Oct  4 02:54:18 2006
From: hi_ono2001 at yahoo.co.jp (Hisaji ONO)
Date: Wed, 4 Oct 2006 09:54:18 +0900 (JST)
Subject: [R-sig-Geo] Considering "boundary effect" in spdep or spgwr
In-Reply-To: <Pine.LNX.4.44.0610012239290.1977-100000@reclus.nhh.no>
Message-ID: <20061004005418.19658.qmail@web10704.mail.bbt.yahoo.co.jp>

Thank you very much for you kind advice.


--- Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Thu, 28 Sep 2006, Hisaji ONO wrote:
> 
> > Hello.
> > 
> >  In some "geo-spatial analysis" text books &
> articles,
> > "boundary effect" was referred.
> > 
> >  For spatial weight matrix and its related
> statistical
> > methods, this issue is very important, I think.
> > 
> >  For this issue, I've looked for this in "spdep"
> and
> > "spgwr" in their "manual" pdf files, but no luck.
> > 
> >  Current version of these packages consider
> "boundary
> > effect"? 
> > 
> 
> Yes, you are right that boundary (or edge) effects
> can be important. They 
> concern the extent to which inferences may change if
> we change the edges 
> of the study area, and/or the configuration effect
> that occurs when some 
> observations are fully surrounded (in the centre of
> the study area) and 
> others are on the edge. 
> 
> There is an indirect reference to this in the
> joincount.test() example in
> spdep - it uses different settings of the spatial
> weights style= argument
> to show how weights configuration can change
> inference. So in spdep, the
> only treatment is through the style= argument.
> 
> In spgwr, fitting adaptive bandwidths seems to be
> one way of preventing
> observations far from their neighbours being
> impacted by a single global
> distance bandwidth. The GWR book doesn't have edge
> effects in its index.
> 
> Best wishes,
> 
> Roger
> 
> > 
> > 
> >  Regards.
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics,
> Norwegian School of
> Economics and Business Administration, Helleveien
> 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
>



From Roger.Bivand at nhh.no  Wed Oct  4 12:34:16 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 4 Oct 2006 12:34:16 +0200 (CEST)
Subject: [R-sig-Geo] distribution of distance for lags (spdep package)
In-Reply-To: <4522DBAA.9060902@unm.edu>
Message-ID: <Pine.LNX.4.44.0610041217320.5030-100000@reclus.nhh.no>

On Tue, 3 Oct 2006, Horacio wrote:

> Dear R-geo people,
> 
> I just discovered the beauty of the spdep package to make spatial 
> analysis of point data easier... However, as I am climbing the learning 
> curve I have a question regarding the estimation of the the lag in the 
> Moran and/or corelogram function.
> 
> As I understand, if the you generate a neighbor-list using the 
> knearneigh 
> <http://finzi.psych.upenn.edu/R/library/spdep/html/knearneigh.html> 
> function you get a 'knn' class of the points I k distance apart. Then 
> when you calculate the Moran's I (at least that's what I did) you get 
> the Lag in terms of the number of links which in practical purposes is 
> k. so, the first correlation value (od Moran's I) is the obtained by 
> comaring all the sites that have a direct link between them, then, the 
> second lag does it in terms of the ones that are 2 links apart and so on...
> 
> My question is perhaps very simple... How can I generate a list to plot 
> the distribution of distances for each lag? I thought nbdists could do 
> it, but are not sure how to go about it...
> 

You are on the right track. Here is an example:

data(columbus)
col.lags <- nblag(col.gal.nb, 4)
# to get a list of neighbour lists at increasing lags
ldists <- lapply(col.lags, function(x) nbdists(x, coords))
# to get a list of lists of distances
ldists1 <- lapply(ldists, unlist)
# to flatten the list to contain vectors of distances, as shown by:
str(ldists1)
# but note that each link is included, both i-j and j-i
sapply(ldists1, summary)
# for example will give a summary or more complicated:
dens <- lapply(ldists1, function(x) density(x, bw=0.1, from=0, to=3.1))
plot(c(0,3.1), c(0,max(sapply(dens, function(x) max(x$y)))), type="n", 
  xlab="distance", ylab="density")
lapply(1:4, function(i) lines(dens[[i]]$x, dens[[i]]$y, lty=i))

for a density plot.

Thanks for the question, I can see that summary.nb() needs a rewrite which 
would have made this a bit easier.

Roger

> 
> thank you
> 
> 
> 
> Horacio
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From bianca.federici at unige.it  Wed Oct  4 15:45:04 2006
From: bianca.federici at unige.it (Bianca Federici)
Date: Wed, 04 Oct 2006 15:45:04 +0200
Subject: [R-sig-Geo] Anisotropy in Kriging with R
Message-ID: <7.0.1.0.0.20061004154014.01ceece8@unige.it>


>Dear all,
>
>I'm a researcher at the University of Genova, 
>Italy, and I'm interested in interpolating 
>methods to reproduce braided rivers, hence river with multiple channels.
>We wanted to interpolate data distributed along 
>cross-sections of a river, hence with a strong anisotropy.
>
>Kriging methods implemented in R (gstat package) 
>take into account an anisotropy direction of the 
>spatial correlation between data;
>however, it's seems to us that such parameter 
>has an important role in the determination of 
>the variogram, but doesn?t influence at all the 
>interpolation algorithm that works in an isotropic way.
>
>Have you practice about this? If yes, do you conferm our conclusions?
>
>Thank you for your time
>
>         Bianca
>
>---------------------------------------------------------------------------------
>Bianca Federici
>Assegnista di ricerca
>
>DIMSET - Dipartimento di Macchine, Sistemi Energetici e Trasporti
>Facolt? di Ingegneria
>Universit? degli Studi di Genova
>Via Montallegro, 1 - 16145 Genova
>
>tel. 010-353 2421
>fax: 010-353 2555
>homepage: http://www.diam.unige.it/obelix



From e.pebesma at geo.uu.nl  Thu Oct  5 09:10:42 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Thu, 05 Oct 2006 09:10:42 +0200
Subject: [R-sig-Geo] complex dependency of gstat on sp, R 2.4.0
Message-ID: <4524AFF2.1020105@geo.uu.nl>

Roger,

install.packages("gstat") with 2.4 over a 2.3 library gives me the 
following:

...
ufctr.o sprow.o spswap.o stat.o submat.o userio.o utils.o vario.o 
vario_fn.o vario_io.o vecop.o version.o writecmd.o xvalid.o   
-L/usr/lib/R/lib -lR
** R
** data
** demo
** inst
** preparing package for lazy loading
Loading required package: sp
Error in loadNamespace(package, c(which.lib.loc, lib.loc), keep.source = 
keep.source) :
        in 'sp' methods for export not found: bbox, coordinates, 
coordinates<-, coordnames, coordnames<-, gridded, polygons, polygons<-, 
dimensions, [, transform, overlay, plot, recenter, spplot, spsample, summary
Error: package 'sp' could not be loaded
Execution halted
ERROR: lazy loading failed for package 'gstat'
** Removing '/home/edzer/S/library/gstat'
** Restoring previous '/home/edzer/S/library/gstat'

The downloaded packages are in
        /tmp/RtmpnLPOlM/downloaded_packages
Warning messages:
1: installation of package 'gstat' had non-zero exit status in: 
install.packages("gstat")
2: cannot create HTML package index in: tools:::unix.packages.html(.Library)

but when I first do install.packges("sp"), followed by ("gstat"), there 
are no problems.
I guess that my R version doesn't check for the dependencies first, or 
guesses
(wrong) that sp is fine: the dependence on sp is rather complicated: if 
R >= 2.4,
require sp >= 0.9, else sp >= 0.8. This is hard to express in DESCRIPTION.

Bests,
--
Edzer



From Roger.Bivand at nhh.no  Thu Oct  5 10:52:54 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 5 Oct 2006 10:52:54 +0200 (CEST)
Subject: [R-sig-Geo] complex dependency of gstat on sp, R 2.4.0
In-Reply-To: <4524AFF2.1020105@geo.uu.nl>
Message-ID: <Pine.LNX.4.44.0610051036450.8885-100000@reclus.nhh.no>

On Thu, 5 Oct 2006, Edzer J. Pebesma wrote:

> Roger,
> 
> install.packages("gstat") with 2.4 over a 2.3 library gives me the 
> following:
> 
> ...
> ufctr.o sprow.o spswap.o stat.o submat.o userio.o utils.o vario.o 
> vario_fn.o vario_io.o vecop.o version.o writecmd.o xvalid.o   
> -L/usr/lib/R/lib -lR
> ** R
> ** data
> ** demo
> ** inst
> ** preparing package for lazy loading
> Loading required package: sp
> Error in loadNamespace(package, c(which.lib.loc, lib.loc), keep.source = 
> keep.source) :
>         in 'sp' methods for export not found: bbox, coordinates, 
> coordinates<-, coordnames, coordnames<-, gridded, polygons, polygons<-, 
> dimensions, [, transform, overlay, plot, recenter, spplot, spsample, summary
> Error: package 'sp' could not be loaded
> Execution halted
> ERROR: lazy loading failed for package 'gstat'
> ** Removing '/home/edzer/S/library/gstat'
> ** Restoring previous '/home/edzer/S/library/gstat'
> 
> The downloaded packages are in
>         /tmp/RtmpnLPOlM/downloaded_packages
> Warning messages:
> 1: installation of package 'gstat' had non-zero exit status in: 
> install.packages("gstat")
> 2: cannot create HTML package index in: tools:::unix.packages.html(.Library)
> 
> but when I first do install.packges("sp"), followed by ("gstat"), there
> are no problems. I guess that my R version doesn't check for the
> dependencies first, or guesses (wrong) that sp is fine: the dependence
> on sp is rather complicated: if R >= 2.4, require sp >= 0.9, else sp >=
> 0.8. This is hard to express in DESCRIPTION.

Yes, the good things in 2.4.0 (much faster loading time of packages, 
faster performance with spatial classes in sp, etc.) come at a price. My 
experience is that (some) packages depending on sp, or indirectly by 
depending on packages that depend on sp, need to be install.packages() 
from scratch (my experience so far on Linux). I think in addition that the 
failed package load when a pre-2.4.0 package's namespace doesn't load, 
followed by an install.packages() of the offending package, doesn't clear 
the failed load, so without quitting R and restarting, it is difficult to 
proceed. 

I think that the problem is that package R-code binary images in packages
depending even indirectly on packages impacted by the changes in
representation of new-style classes made in the 2.4.0 methods package
still "remember" the previous representation, leading to fresh
installation being required. The package dependency graph in R is now
getting unwieldy, but progress is being made - the present troubles are
just a symptom of moving from a less satisfactory solution to a more
satisfactory one (I hope!).

Bottom line: on the 2.3.1/2.4.0 boundary:

1) save all spatial objects using sp classes externally (not in .RData!), 
for instance as shapefiles or geotiff, before upgrading, and import them 
again after upgrading and resolving 2).

2) trial and error library() of the packages you use, using 
install.packages() and quitting and restarting R until the hiccups go 
away. Remember that sp for 2.4.0 is >= 0.9-1. Takes at most 15 minutes.

Roger

> 
> Bests,
> --
> Edzer
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Katarzyna.Adamczyk at jouy.inra.fr  Fri Oct  6 13:29:29 2006
From: Katarzyna.Adamczyk at jouy.inra.fr (Katarzyna Adamczyk)
Date: Fri, 06 Oct 2006 13:29:29 +0200
Subject: [R-sig-Geo] extending sp classes
Message-ID: <45263E19.3000703@jouy.inra.fr>

Dear members of r-sig-geo,

I discovered "sp" library and I found
it very usefull  for switching
between different classes of R spatial
libraries.

I  defined my own class, extending
SpatialPolygonsDataFrame.
When I try to apply "spplot" function to
the extended class, it doesn't work :
I have a coercion problem error message,
but I don't know what it means.

I proceeded as follows:

I considered SpatialPolygonsDataFrame help example :

grd <- GridTopology(c(1,1), c(1,1), c(10,10))
polys <- as.SpatialPolygons.GridTopology(grd)
centroids <- getSpPPolygonsLabptSlots(polys)
x <- centroids[,1]
y <- centroids[,2]
z <- 1.4 + 0.1*x + 0.2*y + 0.002*x*x
ex_1.7 <- SpatialPolygonsDataFrame(polys, data=data.frame(x=x, y=y, z=z, row.names=getSpPPolygonsIDSlots(polys)))
spplot(ex_1.7)


I defined my own class :

 > setClass("myclass",contains="SpatialPolygonsDataFrame")
[1] "myclass"
 > ex<-ex_1.7
 > class(ex) = "myclass"
 > is(ex)
[1] "myclass"                  "SpatialPolygonsDataFrame"
[3] "SpatialPolygons"          "Spatial"
 > spplot(ex)
Erreur dans as.data.frame.default(obj) : cannot coerce class "myclass" 
into a data.frame

Did anyone of you encounter a similar problem and can help me?

Thank you in advance.

Katarzyna



From borghor at yahoo.ca  Fri Oct  6 19:56:12 2006
From: borghor at yahoo.ca (bertrand toupin)
Date: Fri, 6 Oct 2006 13:56:12 -0400 (EDT)
Subject: [R-sig-Geo] krige.cv, again :)
In-Reply-To: <Pine.LNX.4.44.0610051036450.8885-100000@reclus.nhh.no>
Message-ID: <20061006175612.22676.qmail@web42210.mail.scd.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061006/79f52720/attachment.pl>

From Roger.Bivand at nhh.no  Fri Oct  6 21:09:36 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 6 Oct 2006 21:09:36 +0200 (CEST)
Subject: [R-sig-Geo] extending sp classes
In-Reply-To: <45263E19.3000703@jouy.inra.fr>
Message-ID: <Pine.LNX.4.44.0610062058001.17651-100000@reclus.nhh.no>

On Fri, 6 Oct 2006, Katarzyna Adamczyk wrote:

> Dear members of r-sig-geo,
> 
> I discovered "sp" library and I found
> it very usefull  for switching
> between different classes of R spatial
> libraries.
> 
> I  defined my own class, extending
> SpatialPolygonsDataFrame.
> When I try to apply "spplot" function to
> the extended class, it doesn't work :
> I have a coercion problem error message,
> but I don't know what it means.
> 
> I proceeded as follows:
> 
> I considered SpatialPolygonsDataFrame help example :
> 
> grd <- GridTopology(c(1,1), c(1,1), c(10,10))
> polys <- as.SpatialPolygons.GridTopology(grd)
> centroids <- getSpPPolygonsLabptSlots(polys)
> x <- centroids[,1]
> y <- centroids[,2]
> z <- 1.4 + 0.1*x + 0.2*y + 0.002*x*x
> ex_1.7 <- SpatialPolygonsDataFrame(polys, data=data.frame(x=x, y=y, z=z, row.names=getSpPPolygonsIDSlots(polys)))
> spplot(ex_1.7)
> 
> 
> I defined my own class :
> 
>  > setClass("myclass",contains="SpatialPolygonsDataFrame")
> [1] "myclass"
>  > ex<-ex_1.7
>  > class(ex) = "myclass"
>  > is(ex)
> [1] "myclass"                  "SpatialPolygonsDataFrame"
> [3] "SpatialPolygons"          "Spatial"
>  > spplot(ex)
> Erreur dans as.data.frame.default(obj) : cannot coerce class "myclass" 
> into a data.frame
> 
> Did anyone of you encounter a similar problem and can help me?

Well, writing new-style classes is quite advanced. If you are not on 
Windows, please download the source package, and try editing line 158 of 
R/spplot.R from:

	sdf = as.data.frame(obj)

to

	sdf = as(obj, "data.frame")

to see if that way of doing method dispatch works:

> t1 <- as.data.frame(ex)
Error in as.data.frame.default(ex) : cannot coerce class "myclass" into a data.frame
> t2 <- as(ex, "data.frame")
> class(t2)
[1] "data.frame"

suggests that it might. I guess that "myclass" actually is richer, please 
let us know how you get on. 

If you are on Windows, you will need to write a small wrapper function 
like:

> as.data.frame.myclass <- function(obj) obj at data
> t1 <- as.data.frame(ex)
> class(t1)
[1] "data.frame"

This doesn't yet work, but you get the idea - provide an old-style method 
to match the one that cannot be found.

Roger

> 
> Thank you in advance.
> 
> Katarzyna
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From pebesma at geo.uu.nl  Sat Oct  7 12:04:07 2006
From: pebesma at geo.uu.nl (pebesma at geo.uu.nl)
Date: Sat, 7 Oct 2006 12:04:07 +0200 (CEST)
Subject: [R-sig-Geo] krige.cv, again :)
In-Reply-To: <20061006175612.22676.qmail@web42210.mail.scd.yahoo.com>
References: <20061006175612.22676.qmail@web42210.mail.scd.yahoo.com>
Message-ID: <10536.84.80.32.184.1160215447.squirrel@webmail.geo.uu.nl>

> hi, me again :)
>
> I've read that in the help of krige.cv :
>
> Note:
>
>      Leave-one-out cross validation seems to be much faster in plain
>      (stand-alone) gstat, apparently quite a bit of the effort is spent
>      moving  data around from R to gstat.
>
> Since I have 6 ensemble of 2300 stations, I was wondering : How could I
> launch gstat in stand-alone?  Do I need unix or it's possible to run it on
> Windows?
Either of the two; windows binary is at http://www.gstat.org/
>
> At this moment, I'm running R 2.3.1 on a windows machine with 512MB of RAM
> and a P4 2.6 GHz, and it's impossible to do a leave-one-out approach that
> takes less than 2 days to run.
Do you use kriging in a local neighbourhood? If not, moving out of R may
not help much, as 2300 times solving a new system of size 2299 will be the
bottle neck.
--
Edzer



From Roger.Bivand at nhh.no  Sat Oct  7 14:32:44 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 7 Oct 2006 14:32:44 +0200 (CEST)
Subject: [R-sig-Geo] extending sp classes
In-Reply-To: <Pine.LNX.4.44.0610062058001.17651-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.44.0610071427070.18254-100000@reclus.nhh.no>

On Fri, 6 Oct 2006, Roger Bivand wrote:

> On Fri, 6 Oct 2006, Katarzyna Adamczyk wrote:
> 
> > Dear members of r-sig-geo,
> > 
> > I discovered "sp" library and I found
> > it very usefull  for switching
> > between different classes of R spatial
> > libraries.
> > 
> > I  defined my own class, extending
> > SpatialPolygonsDataFrame.
> > When I try to apply "spplot" function to
> > the extended class, it doesn't work :
> > I have a coercion problem error message,
> > but I don't know what it means.
> > 
> > I proceeded as follows:
> > 
> > I considered SpatialPolygonsDataFrame help example :
> > 
> > grd <- GridTopology(c(1,1), c(1,1), c(10,10))
> > polys <- as.SpatialPolygons.GridTopology(grd)
> > centroids <- getSpPPolygonsLabptSlots(polys)
> > x <- centroids[,1]
> > y <- centroids[,2]
> > z <- 1.4 + 0.1*x + 0.2*y + 0.002*x*x
> > ex_1.7 <- SpatialPolygonsDataFrame(polys, data=data.frame(x=x, y=y, z=z, row.names=getSpPPolygonsIDSlots(polys)))
> > spplot(ex_1.7)
> > 
> > 
> > I defined my own class :
> > 
> >  > setClass("myclass",contains="SpatialPolygonsDataFrame")
> > [1] "myclass"
> >  > ex<-ex_1.7
> >  > class(ex) = "myclass"
> >  > is(ex)
> > [1] "myclass"                  "SpatialPolygonsDataFrame"
> > [3] "SpatialPolygons"          "Spatial"
> >  > spplot(ex)
> > Erreur dans as.data.frame.default(obj) : cannot coerce class "myclass" 
> > into a data.frame
> > 
> > Did anyone of you encounter a similar problem and can help me?
> 
> Well, writing new-style classes is quite advanced. If you are not on 
> Windows, please download the source package, and try editing line 158 of 
> R/spplot.R from:
> 
> 	sdf = as.data.frame(obj)
> 
> to
> 
> 	sdf = as(obj, "data.frame")
> 
> to see if that way of doing method dispatch works:
> 
> > t1 <- as.data.frame(ex)
> Error in as.data.frame.default(ex) : cannot coerce class "myclass" into a data.frame
> > t2 <- as(ex, "data.frame")
> > class(t2)
> [1] "data.frame"
> 
> suggests that it might. I guess that "myclass" actually is richer, please 
> let us know how you get on. 
> 
> If you are on Windows, you will need to write a small wrapper function 
> like:
> 
> > as.data.frame.myclass <- function(obj) obj at data
> > t1 <- as.data.frame(ex)
> > class(t1)
> [1] "data.frame"
> 
> This doesn't yet work, but you get the idea - provide an old-style method 
> to match the one that cannot be found.

The missing bit, after providing an as.data.frame method for your class, 
was to either specify the zcol= argument:

spplot(ex, zcol=c("x", "y", "z"))

or provide a names() method for your class:

names.myclass <- function(x) names(x at data)
spplot(ex)

The next > 0.9-2 release of sp will remove the as.data.frame() problem, 
but a names() method will be needed if zcol= cannot be used.

Roger 

> 
> Roger
> 
> > 
> > Thank you in advance.
> > 
> > Katarzyna
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From sf2257 at columbia.edu  Sat Oct  7 21:38:04 2006
From: sf2257 at columbia.edu (Sam Field)
Date: Sat, 07 Oct 2006 15:38:04 -0400
Subject: [R-sig-Geo] Sampling from a SAR error model
In-Reply-To: <1158421726.450c1cdead252@cubmail.cc.columbia.edu>
References: <1158421726.450c1cdead252@cubmail.cc.columbia.edu>
Message-ID: <1160249884.4528021c52c70@cubmail.cc.columbia.edu>

I finally got back to my simulation work - sampling from a SAR
model.  I found that convergence on true rho and lambda depends on
characteristics of the spatial weight matrix in my example.  I had
been drawing a set of points from a uniform distribution and
defining binary weights (row standardized) based on a distance
criteria. If I set the distance criteria to high, resulting in a
dense weight matrix, then the autoregressive coefficient
(especially from the SAR model), tended to be underestimated.  Does
anybody in the list know, off the top of their heads, a good
reference on the impact of the specification of W on the estimation
of the autoregressive parameters from the spatial lag and spatial
error model?  I can't recall seeing anything.

thanks!

Sam







Quoting Sam Field <sf2257 at columbia.edu>:

> Roger and Terry,
>
> Thanks to both of you for your reply. Yes, sigma^2 enters into
> the
> generation of e. The systematic component of the model,
> X_mat%*%parms, has a variance of around 10^2.  e is typically
> around 4^2, or...
>
> e <- rnorm(n,mean=0,sd=4)
>
>
> I went ahead and copied the code below (it isn't too long) - in
> case
> others are interested in this exersise.  The car package is only
> necessary for the n.bins function in the last lines of the code.
> So
> it is optional.  I also tried the invIrM function suggested by
> Terry.  It seems to produce the same results that I get.  It also
> appears in the code below. Any help/suggestions would be greatly
> appreciated.  I am stuck.
>
>
>
> #creating data
>
> library(spdep)
> library(car)
>
>
> #sample size
> n <- 100
>
>
>
>
>
> #coordinates
>
> x_coord <- runif(n,0,10)
> y_coord <- runif(n,0,10)
>
>
> ## w matrix and row normalized
>
> w_raw <- matrix(nrow=length(x_coord),ncol=length(x_coord),1)
>
> for(i in 1:length(x_coord)){for(j in 1:length(x_coord))
> {w_raw[i,j]<- (sqrt((x_coord[i]-x_coord[j])^2 +
> (y_coord[i]-y_coord[j])^2))}}
>
>
> w_dummy <-  matrix(nrow=length(x_coord),ncol=length(x_coord),1)
>
>
> #defines neighborhood distance
>
> neighbor_dist <- 3
>
> for(i in 1:length(x_coord)){for(j in 1:length(x_coord))
> {if(w_raw[i,j] > neighbor_dist) w_dummy[i,j] <- 0}}
>
> for(i in 1:length(x_coord)){for(j in 1:length(x_coord))
> {if( i == j ) w_dummy[i,j] <- 0}}
>
>
> row_sum <- rep(1,length(x_coord))
> for(i in 1:length(x_coord))
> 	{row_sum[i] <- sum(w_dummy[i,]) }
>
> w <- matrix(nrow=length(x_coord),ncol=length(x_coord),1)
>
>
> # divide by row sums
> for(i in 1:length(x_coord)){for(j in 1:length(x_coord))
> 	{w[i,j] <- w_dummy[i,j]/row_sum[i]}}
>
>
>
> neighbors <- dnearneigh(cbind(x_coord,y_coord),0,neighbor_dist)
> nb_list <- nb2listw(neighbors)
>
> #create some independent variables
> X1 <- rnorm(n,4,2)
> X2 <- rnorm(n,2,2)
> X3 <- rnorm(n,0,1)
> X4 <- rnorm(n,13,3)
> X5 <- rnorm(n,21,.5)
> X_mat <- cbind(rep(1,n),X1,X2,X3,X4,X5)
>
> # population parameters
> parms <- c(12.4,2,-4,5,1,-.5)
> rho <- .3
>
>
>
> #begin iterations
> n_iter <- 100  #draw 1500 samples of size n
>
> estimates <- matrix(nrow=n_iter,ncol=7)
> estimates2 <- matrix(nrow=n_iter,ncol=7)
> estimates3 <- matrix(nrow=n_iter,ncol=7)
>
>
> for(iter in 1:n_iter)
> 	{
>
>
>
> e <- rnorm(n,mean=0,sd=4)
>
>
> # drawing samples
> y_lag <- (solve(diag(100)- rho*w))%*%X_mat%*%parms +
> solve(diag(100)-rho*w)%*%e
> y_error <- X_mat%*%parms + (solve(diag(100)-rho*w))%*%e
> y_error2 <- X_mat%*%parms + invIrM(neighbors,.3)%*%e
>
>
> lag_model <- lagsarlm(y_lag ~ X1 + X2 + X3 + X4 + X5,
> listw=nb_list,type='lag')
> lag_model2 <- errorsarlm(y_error ~ X1 + X2 + X3 + X4 + X5,
> listw=nb_list)
> lag_model3 <- errorsarlm(y_error2 ~ X1 + X2 + X3 + X4 + X5,
> listw=nb_list)
>
>
> # retrieve parameter estimates
>
> estimates[iter,] <- coefficients(lag_model)
> estimates2[iter,] <- coefficients(lag_model2)
> estimates3[iter,] <- coefficients(lag_model3)
> }
>
>
>
> mean(estimates[,7])
> hist(estimates[,7],nclass=n.bins(estimates[,7]),probability=TRUE)
> lines(density(estimates[,7]),lwd=2)
>
> mean(estimates2[,7])
>
hist(estimates2[,7],nclass=n.bins(estimates2[,7]),probability=TRUE)
> lines(density(estimates2[,7]),lwd=2)
>
> mean(estimates3[,7])
>
hist(estimates3[,7],nclass=n.bins(estimates3[,7]),probability=TRUE)
> lines(density(estimates3[,7]),lwd=2)
>
>
> #data <- data.frame(cbind(y_lag, y_error,
> X1,X2,X3,X4,X5,x_coord,y_coord))
> #names(data) <- c("y_lag","y_error",names(data)[3:9])
> #write.table(data,file="C:/test.txt")
>
>
>
>
>
>
>
>
> Quoting Roger Bivand <Roger.Bivand at nhh.no>:
>
> > On Fri, 15 Sep 2006, Sam Field wrote:
> >
> > > List,
> > >
> > > I am having trouble writing a script that samples from an SAR
> > error
> > > process. I've done it successfully for a spatial lag model,
> but
> > not
> > > for the spatial error model.  For the spatial lag model, I
> have
> > the
> > > following:
> > >
> > > y_lag <- (solve(diag(100)- p*w))%*%X_mat%*%parms +
> > > solve(diag(100)-p*w)%*%e
> > >
> > > where parms is a parameter vector
> > > X_mat is n by p matrix of independent variables (+ constant)
> > > e is a vector of indepndent normal deviates (mean = 0)
> > > p is the autoregressive paramter
> > > and w is a square, n by n contiguity matrix (row normalized).
> > >
> > > This works beautifully.  lagsarlm recovers parms and p
> without
> > a
> > > problem. Over repeated sampling, the estimated values are
> > centered
> > > on the value for p in the simulation.
> > >
> > >
> > > Is there something wrong with the following for the spatial
> > error
> > > model?
> > >
> > > y_error <- X_mat%*%parms + (solve(diag(100)-p*w))%*%e
> > >
> >
> > Interesting question. Where is the sigma^2 going in your case -
> > is it in
> > the generation of e? Could you try to use the columbus dataset
> > and
> > set.seed to generate a reproducible example - it may be that
> what
> > you have
> > written does not communicate exactly what you have done?
> >
> > Roger
> >
> > >
> > > The distribution of values for p obtain from errorsarlm over
> > > repeated sampling are not centered around the value for the
> > > simulation, but are typically much lower and all over the
> > place.  I
> > > have only looked at values for p ranging from .3 to .7.
> > >
> > > any help would be greatly appreciated!
> > >
> > >
> > >
> > >
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian
> > School of
> > Economics and Business Administration, Helleveien 30, N-5045
> > Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> >
>
>
> --
> Samuel H. Field, Ph.D.
> Associate Research Scholar
> Institute for Social and Economic Research and Policy (ISERP)
> Columbia University
> 420 W. 118th Street
> Mail code 3355
> New York, NY  10027
> 215-731-0106
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Samuel H. Field, Ph.D.
Associate Research Scholar
Institute for Social and Economic Research and Policy (ISERP)
Columbia University
420 W. 118th Street
Mail code 3355
New York, NY  10027
215-731-0106



From tpcolson at ncsu.edu  Tue Oct 10 21:13:45 2006
From: tpcolson at ncsu.edu (Thomas P. Colson)
Date: Tue, 10 Oct 2006 15:13:45 -0400
Subject: [R-sig-Geo] Cumulative area distribution
In-Reply-To: <Pine.LNX.4.44.0610090956530.19518-100000@reclus.nhh.no>
Message-ID: <200610101911.k9AJBp4F024982@server-autogenerated.uni03mr.unity.ncsu.edu>

 Roger, thanks for the tip on maptools, waaayyyy easier to get an ESRI grid
into R, than what I was doing. 


I've narrowed down the problem definition: 

I have a flow accumulation grid, in which each cell reports the number of
cells, upstream of that cell, flowing into that cell, with the minimum being
"1" or "itself". The max, in my case, is 183695 cells, flow into one cell
(the watershed mouth). 

In this grid, there are many cells with a value of 1 (I think 33000), many
more with a value of 2 (perhaps 10000), not so many with a value of 100
(maybe 50)...so forth. 

Coverting the number of cells to area is relative simple, as Roger
demonstrated: basin_area <- cell_count * 20 * 20

The Cumulative area distribution plot, is the plot of the probabilty that
the drainage area of one cell is greater than the largest drainage area
found among all the cells. This would be 99% for the cells with fac=1, and
.001 for the cells with fac=183695.

I think the best way to do this is with an ordinal ranking (and the way many
do it by hand), so that the low-flow area cells (of which there are a lot)
get a rank of 100, med-flow area cells get, say 50, and the high-flow area
cells get, 1. Then the probabability could be defined as rank/101 e.g.,
100/101 for the low flow areas, and 1/101 for the high flow areas. The the
plot would show such things as the breakpoints between convergent and
divergent flow (McNamara, 2006). 

 This is very easy to do in Excel, but...with the explosion of ultra-high
resolution DEMs with many cells in a DEM, this reduces Excel to the role of
balancing checkbooks (as it should be). Not to mention the benefit of having
this data as a table or matrix in R.....

I tried the function that Roger posted below (thanks Roger!), it worked
great ( I learned some new R tricks), but the resulting curve.....isn't a
CAD plot. My lack of experience in both R and programming have led me to
this useful mailing list in search of some adivce on how best to get a CAD
plot for flow accumulation girds with many thousands of cells. 

Thanks for any help you can provide!



#################
To: Thomas P. Colson
Subject: Re: [R] Probability of exceedance function question (fwd)

A final cut:

t1 <- ecdf(basin_area)
x <- seq(min(basin_area), max(basin_area), length=500) y <- 1 - t1(x)
plot(x, y, type="l", xaxs="i", yaxs="i", ylim=c(0, 1))

This uses the ecdf() subtracted from 1 to perhaps get closer to what you
need.

Roger


By the way, you can read an Arc ASCII grid into a SpatialGridDataFrame 
with function readAsciiGrid() in package maptools, so for you:

basin.map <- readAsciiGrid("c:/temp/area.asc", colname="basinID")
basins <- split(basin.map$basinID, basin.map$basinID)
length(basins) # sanity check
cell_count <- sapply(basins, length)
basin_area <- cell_count * 20 * 20
t1 <- ecdf(basin_area)
plot(t1, pch=".", axes=FALSE) # and set xlab=, ylab=, main=
axis(1)
box()
grid()
axis(2, at=axTicks(2), labels=rev(axTicks(2)))



From borghor at yahoo.ca  Tue Oct 10 22:53:25 2006
From: borghor at yahoo.ca (bertrand toupin)
Date: Tue, 10 Oct 2006 16:53:25 -0400 (EDT)
Subject: [R-sig-Geo] krige.cv, again :)
In-Reply-To: <10536.84.80.32.184.1160215447.squirrel@webmail.geo.uu.nl>
Message-ID: <20061010205325.50699.qmail@web42202.mail.scd.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061010/bc0a629e/attachment.pl>

From Katarzyna.Adamczyk at jouy.inra.fr  Wed Oct 11 11:00:53 2006
From: Katarzyna.Adamczyk at jouy.inra.fr (Katarzyna Adamczyk)
Date: Wed, 11 Oct 2006 11:00:53 +0200
Subject: [R-sig-Geo] extending sp classes
In-Reply-To: <Pine.LNX.4.44.0610071427070.18254-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0610071427070.18254-100000@reclus.nhh.no>
Message-ID: <452CB2C5.5020007@jouy.inra.fr>

Hi,

Thank you for your help.
I work with linux platform, but
not as an individual user, so I cannot
modify R source installed on network.
For this reason I choose the second option
that you proposed : I defined as.data.frame
method for "myclass", and I used "spplot" with
argument "zcol" - it works, thank you.
At the moment "myclass" is just a
test of sp class extensions and without
any particular extension.

My best regards

Katarzyna



From massimodisasha at yahoo.it  Thu Oct 12 22:35:47 2006
From: massimodisasha at yahoo.it (massimodisasha)
Date: Thu, 12 Oct 2006 22:35:47 +0200
Subject: [R-sig-Geo] plot streamlines from codar data
Message-ID: <5D23E2CC-6C0D-4FA8-9B5F-430DAFE07BBB@yahoo.it>

hi, i'm tring to plot a streamline my set of data is like this :

Vectors: dx dy                            u              
v                              lat                  lon

   -6.25000     -2.50000         1.717      -7.092                  
40.644167     14.092523
   -6.25000     -1.25000         1.631      -9.520                  
40.655418     14.092523
   -6.25000      0.00000         1.251     -12.137                 
40.666667     14.092523
   -6.25000      1.25000         0.313     -12.531                 
40.677914     14.092523
   -5.00000     -2.50000         2.789      -4.769                  
40.644167     14.107351
   -5.00000     -1.25000         1.593      -7.360                  
40.655418     14.107351
   -5.00000      0.00000         1.259      -9.956                  
40.666667     14.107351
   -5.00000      1.25000        -0.763     -17.315                
40.677914     14.107351
......
........



i'm studing a metod for visualize this data  any suggestion is more  
apprechated!
  thanks
Massimo



From epistat at gmail.com  Sat Oct 14 08:08:28 2006
From: epistat at gmail.com (zhijie zhang)
Date: Sat, 14 Oct 2006 14:08:28 +0800
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 38, Issue 8
In-Reply-To: <mailman.17.1160733617.29872.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1160733617.29872.r-sig-geo@stat.math.ethz.ch>
Message-ID: <2fc17e30610132308m2adde713j44257bbc5b693e32@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061014/222c04b3/attachment.pl>

From Roger.Bivand at nhh.no  Sat Oct 14 08:28:31 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 14 Oct 2006 08:28:31 +0200 (CEST)
Subject: [R-sig-Geo] plot streamlines from codar data
In-Reply-To: <5D23E2CC-6C0D-4FA8-9B5F-430DAFE07BBB@yahoo.it>
Message-ID: <Pine.LNX.4.44.0610140823530.8595-100000@reclus.nhh.no>

On Thu, 12 Oct 2006, massimodisasha wrote:

> hi, i'm tring to plot a streamline my set of data is like this :
> 
There is not enough information here to say what you want to know. You 
have not told us the metrics of the columns (not everyone works in your 
field), nor how individual streamlines are defined (one row, many rows?). 
For each group of four rows, dx and lon are fixed and dy replicates.

> Vectors: dx dy                            u              
> v                              lat                  lon
> 
>    -6.25000     -2.50000         1.717      -7.092                  
> 40.644167     14.092523
>    -6.25000     -1.25000         1.631      -9.520                  
> 40.655418     14.092523
>    -6.25000      0.00000         1.251     -12.137                 
> 40.666667     14.092523
>    -6.25000      1.25000         0.313     -12.531                 
> 40.677914     14.092523
>    -5.00000     -2.50000         2.789      -4.769                  
> 40.644167     14.107351
>    -5.00000     -1.25000         1.593      -7.360                  
> 40.655418     14.107351
>    -5.00000      0.00000         1.259      -9.956                  
> 40.666667     14.107351
>    -5.00000      1.25000        -0.763     -17.315                
> 40.677914     14.107351
> ......
> ........
> 
> 
> 
> i'm studing a metod for visualize this data  any suggestion is more  
> apprechated!
>   thanks
> Massimo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From hi_ono2001 at ybb.ne.jp  Sat Oct 14 09:28:57 2006
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Sat, 14 Oct 2006 16:28:57 +0900 (JST)
Subject: [R-sig-Geo] plot streamlines from codar data
In-Reply-To: <Pine.LNX.4.44.0610140823530.8595-100000@reclus.nhh.no>
Message-ID: <20061014072857.97508.qmail@web10701.mail.bbt.yahoo.co.jp>


Hello.

 How about GrADS(http://grads.iges.org/grads/grads.html) ,
not R related one, used in meteorology?

  Formerly it can deal with only gridded data, but
currently seems to support station data(irregular spaced
data).



 Regards



> On Thu, 12 Oct 2006, massimodisasha wrote:
> 
> > hi, i'm tring to plot a streamline my set of data
> is like this :
> > 

> 
> > Vectors: dx dy                            u       
>       
> > v                              lat                
>  lon
> > 
> >    -6.25000     -2.50000         1.717      -7.092
>                  
> > 40.644167     14.092523
> >    -6.25000     -1.25000         1.631      -9.520
>                  
> > 40.655418     14.092523
> >    -6.25000      0.00000         1.251     -12.137
>                 
> > 40.666667     14.092523
> >    -6.25000      1.25000         0.313     -12.531
>                 
> > 40.677914     14.092523
> >    -5.00000     -2.50000         2.789      -4.769
>                  
> > 40.644167     14.107351
> >    -5.00000     -1.25000         1.593      -7.360
>                  
> > 40.655418     14.107351
> >    -5.00000      0.00000         1.259      -9.956
>                  
> > 40.666667     14.107351
> >    -5.00000      1.25000        -0.763     -17.315
>                
> > 40.677914     14.107351
> > ......
> > ........
> >



From matt.pettis at thomson.com  Mon Oct 16 20:27:01 2006
From: matt.pettis at thomson.com (matt.pettis at thomson.com)
Date: Mon, 16 Oct 2006 13:27:01 -0500
Subject: [R-sig-Geo] Plotting a shapefile
Message-ID: <89C159F45B13A24682D98BDEF58E451F0A63D513@TLRUSMNEAGMBX28.ERF.THOMSON.COM>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061016/e7022a2b/attachment.pl>

From Roger.Bivand at nhh.no  Mon Oct 16 21:14:32 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 16 Oct 2006 21:14:32 +0200 (CEST)
Subject: [R-sig-Geo] Plotting a shapefile
In-Reply-To: <89C159F45B13A24682D98BDEF58E451F0A63D513@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
Message-ID: <Pine.LNX.4.44.0610162046390.19878-100000@reclus.nhh.no>

On Mon, 16 Oct 2006 matt.pettis at thomson.com wrote:

> Hi,
>  
> I am trying to read in a shapefile, which is a state map broken into
> voting precints, and plot a map of the result.  There is no measure data
> as of yet -- only the shapefile with boundaries.  Can anybody give me
> direction on how to start this very basic task?

There are two ways to read the shapefile into a SpatialPolygonsDataFrame:

library(maptools)
getinfo.shape("shpfile.shp")
# to check that it is a polygon file
my_polys <- readShapePoly("shpfile.shp")
# this has two arguments, IDvar=, which takes the name (as a string) of a 
# field in the DBF file to use for IDs, and proj4string= for inserting the 
# coordinate reference system

or

library(rgdal)
# assuming you can install the rgdal package, easy on Windows, from source 
# with external dependencies elsewhere
my_polys <- readOGR(".", "shpfile")
# with no way of setting the IDs to a DBF field (they are the OGR internal 
# IDs, but reads the *.prj file automatically; the first argument is the 
# name of the directory (here the current directory), the second the file 
# name without extension

>From there, it's just:

plot(my_polys)

The plot method can be configured using arguments, including filling the 
polygons with colours or hatching, colouring the boundaries and setting 
the line thicknesses etc., and plotting a smaller window using xlim= and 
ylim= as usual in plot methods. 

The arguments are:

> args(sp:::plot.SpatialPolygons)
function (x, col, border = par("fg"), add = FALSE, xlim = NULL, 
    ylim = NULL, xpd = NULL, density = NULL, angle = 45, pbg = NULL, 
    axes = FALSE, ...) 

and in fact (this will be dealt with in the next sp release) are only 
documented under:

?plot.polylist 

in the maptools package, with the exception of pbg=, which is the 
background colour also used to fill holes provided that the holes (aka. 
lakes) are correctly given.

Roger

>  
> thanks,
> Matt
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mihainica at yahoo.com  Mon Oct 16 21:19:05 2006
From: mihainica at yahoo.com (Mihai Nica)
Date: Mon, 16 Oct 2006 12:19:05 -0700 (PDT)
Subject: [R-sig-Geo] Plotting a shapefile
Message-ID: <20061016191905.26624.qmail@web50801.mail.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061016/f880002b/attachment.pl>

From e.pebesma at geo.uu.nl  Tue Oct 17 13:29:40 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 17 Oct 2006 13:29:40 +0200
Subject: [R-sig-Geo] sp: spplot bug in sp 0.9-2
Message-ID: <4534BEA4.8020903@geo.uu.nl>

Dear spplot users,

When spplot is used with the names.attr argument for label placement in 
the strips, and the names of the variables in zcol are not in alphabetic 
order, strips will receive the wrong name. I found out only now because 
apparently I tend to use names in alphabetic order, or just overlooked 
it. sp 0.9-3 (submitted to CRAN) will fix this, but I'm unhappy with the 
way I fix it.

I believe the example below explains the bug and the unsatisfactory fix.

 > f = factor(c("c","c","b","b","a","a"))
 > f
[1] c c b b a a
Levels: a b c
# and we now want the same data, but with level order c, b, a

# what spmap.to.lev (called from spplot) did was:
 > factor(as.integer(f), labels = c("cc","bb","aa"))
[1] aa aa bb bb cc cc
Levels: cc bb aa

#what we want is (and sp 0.9-3 does) is:
 > factor(as.character(f), levels = c("c","b","a"), labels = 
c("cc","bb","aa"))
[1] cc cc bb bb aa aa
Levels: cc bb aa

which is quite something different. But this will convert a potentially 
huge factor to character and back to factor which may be resource 
intensive. Does anyone here know a simpler way of achieving this, i.e. 
given f, without using as.character()?

Without names.attr, the panel order could be wrong as
 > spplot(meuse.grid, c("part.a", "part.b"))
 > spplot(meuse.grid, c("part.b", "part.b"))
produced the same plot; but with correct strip labels.
The plots are now different in sp 0.9-3.

Bests,
--
Edzer



From mdsumner at utas.edu.au  Tue Oct 17 22:52:51 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Wed, 18 Oct 2006 07:52:51 +1100
Subject: [R-sig-Geo] sp: spplot bug in sp 0.9-2
In-Reply-To: <4534BEA4.8020903@geo.uu.nl>
References: <4534BEA4.8020903@geo.uu.nl>
Message-ID: <453542A3.1010402@utas.edu.au>


>
> which is quite something different. But this will convert a potentially 
> huge factor to character and back to factor which may be resource 
> intensive. Does anyone here know a simpler way of achieving this, i.e. 
> given f, without using as.character()?
>   
Does this help? 

 factor(levels(f)[f], levels = c("c","b","a"), labels =  c("cc","bb","aa"))



From chabotd at globetrotter.net  Wed Oct 18 02:29:38 2006
From: chabotd at globetrotter.net (Denis Chabot)
Date: Tue, 17 Oct 2006 20:29:38 -0400
Subject: [R-sig-Geo] any way to prompt users for information?
In-Reply-To: <mailman.17.1160820006.15835.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1160820006.15835.r-sig-geo@stat.math.ethz.ch>
Message-ID: <A7015572-3C1A-4199-91F1-A6441F533D77@globetrotter.net>

Dear R users,

I am trying to automate some analyses for people who will know very  
little about R. At some point in the program, I'd like to ask the  
user to answer a question so that the program can take action  
according to the answer given. Just making a question appear in the  
console is not ideal, it is easily missed by users who will be  
watching mostly for figures I'll produce.

I am hoping there is a way to make a simple text window pop up with  
my question in it, and the cursor placed ready for the user to type  
his answer.

I already made it easy for the user to chose which file to analyse  
with the command

txt <- file.choose()

I tried to look into the help system and found nothing, although I  
may be using the wrong keywords to get something out of the help  
system or of RSiteSearch.

I'd appreciate being put on the right track!

Thanks in advance,

Denis Chabot



From mdsumner at utas.edu.au  Wed Oct 18 02:45:40 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Wed, 18 Oct 2006 11:45:40 +1100
Subject: [R-sig-Geo] any way to prompt users for information?
In-Reply-To: <A7015572-3C1A-4199-91F1-A6441F533D77@globetrotter.net>
References: <mailman.17.1160820006.15835.r-sig-geo@stat.math.ethz.ch>
	<A7015572-3C1A-4199-91F1-A6441F533D77@globetrotter.net>
Message-ID: <45357934.4020000@utas.edu.au>

I think this question would be more appropriately asked on R-help. But,


> I am hoping there is a way to make a simple text window pop up with  
> my question in it, and the cursor placed ready for the user to type  
> his answer.
>   

winDialogString("One lump or two?", "")


Cheers, Mike.



From chabotd at globetrotter.net  Wed Oct 18 03:21:26 2006
From: chabotd at globetrotter.net (Denis Chabot)
Date: Tue, 17 Oct 2006 21:21:26 -0400
Subject: [R-sig-Geo] any way to prompt users for information?
In-Reply-To: <45357934.4020000@utas.edu.au>
References: <mailman.17.1160820006.15835.r-sig-geo@stat.math.ethz.ch>
	<A7015572-3C1A-4199-91F1-A6441F533D77@globetrotter.net>
	<45357934.4020000@utas.edu.au>
Message-ID: <4879A47B-CD0A-4482-A2B3-6410D3BB93BF@globetrotter.net>

Michael,

I intended to ask this to the R Help list, but I was careless in  
filling the address of my message, I apologise.

Your suggestion does not work on Mac OS X, unfortunately. It allowed  
me to search further, and I found this:
http://finzi.psych.upenn.edu/R/Rhelp02a/archive/84306.html

Unfortunately, I got a syntax error with this example. I'll try to  
read a bit about tcl to see why this is so.

Denis

Le 06-10-17 ? 20:45, Michael Sumner a ?crit :

> I think this question would be more appropriately asked on R-help.  
> But,
>
>
>> I am hoping there is a way to make a simple text window pop up  
>> with  my question in it, and the cursor placed ready for the user  
>> to type  his answer.
>>
>
> winDialogString("One lump or two?", "")
>
>
> Cheers, Mike.



From putler at sauder.ubc.ca  Wed Oct 18 07:15:53 2006
From: putler at sauder.ubc.ca (Dan Putler)
Date: Tue, 17 Oct 2006 22:15:53 -0700
Subject: [R-sig-Geo] any way to prompt users for information?
In-Reply-To: <4879A47B-CD0A-4482-A2B3-6410D3BB93BF@globetrotter.net>
References: <mailman.17.1160820006.15835.r-sig-geo@stat.math.ethz.ch><A7015572-3C1A-4199-91F1-A6441F533D77@globetrotter.net><45357934.4020000@utas.edu.au>
	<4879A47B-CD0A-4482-A2B3-6410D3BB93BF@globetrotter.net>
Message-ID: <AF758313-FE82-4703-8EF0-99EFC690AB5B@sauder.ubc.ca>

Denis,

If you are trying to do this within the context of using PBSmapping,  
you might want to check out the PBSmodelling package as well since it  
includes facilities to write dialog boxes using simple text files.  
Plus, it is a Geo related package so it makes it appropriate for this  
list ;-).

Dan

On 17-Oct-06, at 6:21 PM, Denis Chabot wrote:

> Michael,
>
> I intended to ask this to the R Help list, but I was careless in
> filling the address of my message, I apologise.
>
> Your suggestion does not work on Mac OS X, unfortunately. It allowed
> me to search further, and I found this:
> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/84306.html
>
> Unfortunately, I got a syntax error with this example. I'll try to
> read a bit about tcl to see why this is so.
>
> Denis
>
> Le 06-10-17 ? 20:45, Michael Sumner a ?crit :
>
>> I think this question would be more appropriately asked on R-help.
>> But,
>>
>>
>>> I am hoping there is a way to make a simple text window pop up
>>> with  my question in it, and the cursor placed ready for the user
>>> to type  his answer.
>>>
>>
>> winDialogString("One lump or two?", "")
>>
>>
>> Cheers, Mike.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From reeves at nceas.ucsb.edu  Wed Oct 18 20:08:23 2006
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Wed, 18 Oct 2006 11:08:23 -0700
Subject: [R-sig-Geo] PBSMapping package: what are the default units for
	calcArea() results
Message-ID: <45366D97.7050206@nceas.ucsb.edu>

Greetings:

I am using the PBSMapping package calcVoronoi() routine to calculate 
ROIs surrounding elements in
an imported ESRI point shape file. Point coords are in decimal lat/long.

here is the gist of the code.....

sites <- read.csv("ThreeCountyPoints.csv")

coordinates(sites) = c("LonDD","LatDD")
xy=coordinates(sites)

events <- 
as.EventData(data.frame(EID=1:len,X=xy[,1],Y=xy[,2],projection="LL"))

Vpolys <-calcVoronoi(events)

plot.new()
plotPolys(Vpolys) # the voronois look good.

polyData <- calcArea(Vpolys)

#
# polyData's Z attribute contains numbers in the magnitude.01 - .0001
#

Two questions:

1) What are the units of polyData.Z , and how can I convert them to km**2 ?

    If I try to convert the units to UTM, as suggested in the PBSMapping 
user guide, as below,

    attr(Vpolys,"zone") <- 9
    VpolysUTM <- convUL(Vpolys)

I get the error:
--> Error in convUL(Vpolys) : Missing or invalid projection attribute.

2) Can you suggest a way in which I could clip the Voronois in the 
polySet using
     as a clipping polygon the county boundary polygons contained in a 
polyset
     (TcPoly), generated  from an incoming polygon shapefile (also 
lat/lon DD):

TriCounty <-read.shape("TriCountyPolyDD.shp")
TcPolys = Map2poly(TriCounty)

# here are the contents of the TriCountyPolyDD shapefile:
# GEOGCS["GCS_North_American_1983",DATUM["D_North_American_1983",
# 
SPHEROID["GRS_1980",6378137.0,298.257222101]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]


Please see attached jpg for the 'big picture'

Many thanks for any suggestions!

Regards,
Rick Reeves
UCSB / NCEAS

-- 
Rick Reeves	
Scientific Programmer / Analyst	
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
reeves at nceas.ucsb.edu
www.nceas.ucsb.edu
805 892 2533

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PbsVoronoiWCty.jpg
Type: image/jpeg
Size: 28543 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061018/32f4b5ee/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: reeves.vcf
Type: text/x-vcard
Size: 339 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061018/32f4b5ee/attachment.vcf>

From White.Denis at epamail.epa.gov  Thu Oct 19 02:44:58 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Wed, 18 Oct 2006 17:44:58 -0700
Subject: [R-sig-Geo] correlogram for categorical data
Message-ID: <OF4465226C.C4ACEE8D-ON8825720C.0003908B-8825720C.00041DFD@epamail.epa.gov>

I have a 1000 x 1000 grid of categorical values (nine of these) and want
to compute and plot a correlogram.  Function cell2nb() will take a while
it appears but if that succeeds then can methods of sp.correlogram() be
used on categorical data?  What are "style" options in sp.correlogram()?

thanks,
Denis



From matt.pettis at thomson.com  Thu Oct 19 03:00:43 2006
From: matt.pettis at thomson.com (matt.pettis at thomson.com)
Date: Wed, 18 Oct 2006 20:00:43 -0500
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
	and removing internal boundary lines
Message-ID: <89C159F45B13A24682D98BDEF58E451F08C0EC@TLRUSMNEAGMBX28.ERF.THOMSON.COM>

I have sucessfully inputted a shapefile into a SpatialPolygonsDataFrame object.  I would like to output this file as a .gif/.png/.bmp/.jpeg image and generate an imagemap for the outputted image.  Does anybody know the best way to approach this?
 
secondly (and i may need to start another thread for this), but is there an easy function to remove the interior lines of aggregated shapes (and generate an imagemap again, etc.)?  For example, If I have a map of the U.S.'s with a polygon for each state, could I remove all internal state boundaries to leave just the national border?
 
thanks,
Matt



From Roger.Bivand at nhh.no  Thu Oct 19 09:05:31 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Oct 2006 09:05:31 +0200 (CEST)
Subject: [R-sig-Geo] correlogram for categorical data
In-Reply-To: <OF4465226C.C4ACEE8D-ON8825720C.0003908B-8825720C.00041DFD@epamail.epa.gov>
Message-ID: <Pine.LNX.4.44.0610190846290.24445-100000@reclus.nhh.no>

On Wed, 18 Oct 2006 White.Denis at epamail.epa.gov wrote:

> I have a 1000 x 1000 grid of categorical values (nine of these) and want
> to compute and plot a correlogram.  Function cell2nb() will take a while
> it appears but if that succeeds then can methods of sp.correlogram() be
> used on categorical data?  What are "style" options in sp.correlogram()?
> 

Sorry, could you say how a correlogram might be constructed for 
categorical values (eg. land cover)? Wouldn't join counts be a more 
natural choice? joincoint.multi() in spdep has a Jtot value of total 
different category joins, so using that with different lags of a cell2nb() 
neighbour list might work. However, the 1M cell grid is pretty large for 
cell2nb(), using dnearneigh() on cell centres may be faster and scale 
better, (and other possibilities should exist) and nblag() will be 
definitely sub-optimal in this setting. For join counts, the "B" weights 
style is the obvious one to chose. Note that joincoint.multi() is not 
coded in C.

This would need trying on a small subset and scaling up - I think that 
alternative routes to constructing the lagged neighbour lists would be 
preferable.

Roger

> thanks,
> Denis
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Oct 19 09:32:12 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Oct 2006 09:32:12 +0200 (CEST)
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
 and removing internal boundary lines
In-Reply-To: <89C159F45B13A24682D98BDEF58E451F08C0EC@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
Message-ID: <Pine.LNX.4.44.0610190908040.24445-100000@reclus.nhh.no>

On Wed, 18 Oct 2006 matt.pettis at thomson.com wrote:

> I have sucessfully inputted a shapefile into a SpatialPolygonsDataFrame
> object.  I would like to output this file as a .gif/.png/.bmp/.jpeg
> image and generate an imagemap for the outputted image.  Does anybody
> know the best way to approach this?

RSiteSearch("imagemap")

gets you to:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/28035.html

This installs on R 2.4.0 from source - which platform are you using and
can you install source packages? The documentation in
imagemap/inst/doc/imagemap-howto.pdf is clear, addRegion(im) <- for each
clickable object. How to go from there depends on what you want to be
clickable. 

Alternatives might be Rpad:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/77952.html

or using ogr2ogr in FWTools (external software) to generate a KML for 
Google Earth (if the bubble that pops up is enough - I don't know how to 
put a link into it, though I guess it could be done), or writing the KML 
from R:

http://bbs.keyhole.com/ubb/showflat.php/Cat/0/Number/221682/Main/219131

>  secondly (and i may need to start another thread for this), but is
> there an easy function to remove the interior lines of aggregated shapes
> (and generate an imagemap again, etc.)?  For example, If I have a map of
> the U.S.'s with a polygon for each state, could I remove all internal
> state boundaries to leave just the national border?

Using the objects you have now, you need to install the spgpc package:

rSpatial <- "http://r-spatial.sourceforge.net/R"
install.packages("spgpc", repos=rSpatial)

and install gpclib from CRAN. Then

?unionSpatialPolygons

to dissolve internal boundaries. This is for arbitrary polygons, if you 
really just need to dissolve US states, perhaps using the CRAN maps 
package with its built-in database, and its own dissolve mechanism would 
save re-doing topology, but it only works for polygons in the database.

Roger

>  
> thanks,
> Matt
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From White.Denis at epamail.epa.gov  Thu Oct 19 17:27:48 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Thu, 19 Oct 2006 08:27:48 -0700
Subject: [R-sig-Geo] correlogram for categorical data
In-Reply-To: <Pine.LNX.4.44.0610190846290.24445-100000@reclus.nhh.no>
Message-ID: <OF6AE32ADF.202E5E40-ON8825720C.0054D79E-8825720C.0054F28D@epamail.epa.gov>

Yes, a "joincountogram" is the idea.  Thanks for advice on size, I'll
try scaling up.


Roger Bivand <Roger.Bivand at nhh.no> wrote on 2006-10-19 00:05:31:

> On Wed, 18 Oct 2006 White.Denis at epamail.epa.gov wrote:
>
> > I have a 1000 x 1000 grid of categorical values (nine of
> these) and want
> > to compute and plot a correlogram.  Function cell2nb()
> will take a while
> > it appears but if that succeeds then can methods of sp.
> correlogram() be
> > used on categorical data?  What are "style" options in
> sp.correlogram()?
> >
>
> Sorry, could you say how a correlogram might be constructed for
> categorical values (eg. land cover)? Wouldn't join counts be a more
> natural choice? joincoint.multi() in spdep has a Jtot
> value of total
> different category joins, so using that with different
> lags of a cell2nb()
> neighbour list might work. However, the 1M cell grid is
> pretty large for
> cell2nb(), using dnearneigh() on cell centres may be
> faster and scale
> better, (and other possibilities should exist) and nblag() will be
> definitely sub-optimal in this setting. For join counts,
> the "B" weights
> style is the obvious one to chose. Note that joincoint.
> multi() is not
> coded in C.
>
> This would need trying on a small subset and scaling up -
> I think that
> alternative routes to constructing the lagged neighbour
> lists would be
> preferable.
>
> Roger
>
> > thanks,
> > Denis
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics,
> Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



From matt.pettis at thomson.com  Thu Oct 19 17:59:07 2006
From: matt.pettis at thomson.com (matt.pettis at thomson.com)
Date: Thu, 19 Oct 2006 10:59:07 -0500
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
	and removing internalboundary lines
Message-ID: <89C159F45B13A24682D98BDEF58E451F0A7AA5C2@TLRUSMNEAGMBX28.ERF.THOMSON.COM>

Hi Roger,

Thanks again for the response.  To answer your questions:

- I am currently running on R 2.3.1.  I was at 2.4.x, but some of the
packages I thought I needed weren't available on the cran interface in
the rgui (I was experimenting, and I can't remember what they were now,
so that may no longer be true).  It sounds like you are fine running R
at 2.4, though, and I could probably upgrade, as my sole purpose for
having R right now is to deal with shapefiles and create image maps.

- Related to the above, I don't see the spgpc package on my mirror (USA
(IA)), but that may be related to being at 2.3?

Also, I saw the 'unionSpatialPolygons' command in Debarchana Ghosh's
code, but didn't know what it did.  I'll investigate the paths you have
listed here.

Thanks again,
Matt

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Thursday, October 19, 2006 2:32 AM
To: Pettis, Matthew (TLR Corp)
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] shapefiles, images, iimagemaps, and removing
internalboundary lines

On Wed, 18 Oct 2006 matt.pettis at thomson.com wrote:

> I have sucessfully inputted a shapefile into a 
> SpatialPolygonsDataFrame object.  I would like to output this file as 
> a .gif/.png/.bmp/.jpeg image and generate an imagemap for the 
> outputted image.  Does anybody know the best way to approach this?

RSiteSearch("imagemap")

gets you to:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/28035.html

This installs on R 2.4.0 from source - which platform are you using and
can you install source packages? The documentation in
imagemap/inst/doc/imagemap-howto.pdf is clear, addRegion(im) <- for each
clickable object. How to go from there depends on what you want to be
clickable. 

Alternatives might be Rpad:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/77952.html

or using ogr2ogr in FWTools (external software) to generate a KML for
Google Earth (if the bubble that pops up is enough - I don't know how to
put a link into it, though I guess it could be done), or writing the KML
from R:

http://bbs.keyhole.com/ubb/showflat.php/Cat/0/Number/221682/Main/219131

>  secondly (and i may need to start another thread for this), but is 
> there an easy function to remove the interior lines of aggregated 
> shapes (and generate an imagemap again, etc.)?  For example, If I have

> a map of the U.S.'s with a polygon for each state, could I remove all 
> internal state boundaries to leave just the national border?

Using the objects you have now, you need to install the spgpc package:

rSpatial <- "http://r-spatial.sourceforge.net/R"
install.packages("spgpc", repos=rSpatial)

and install gpclib from CRAN. Then

?unionSpatialPolygons

to dissolve internal boundaries. This is for arbitrary polygons, if you
really just need to dissolve US states, perhaps using the CRAN maps
package with its built-in database, and its own dissolve mechanism would
save re-doing topology, but it only works for polygons in the database.

Roger

>  
> thanks,
> Matt
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Oct 19 18:14:01 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Oct 2006 18:14:01 +0200 (CEST)
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
 and removing internalboundary lines
In-Reply-To: <89C159F45B13A24682D98BDEF58E451F0A7AA5C2@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
Message-ID: <Pine.LNX.4.44.0610191811270.24530-100000@reclus.nhh.no>

On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:

> Hi Roger,
> 
> Thanks again for the response.  To answer your questions:
> 
> - I am currently running on R 2.3.1.  I was at 2.4.x, but some of the
> packages I thought I needed weren't available on the cran interface in
> the rgui (I was experimenting, and I can't remember what they were now,
> so that may no longer be true).  It sounds like you are fine running R
> at 2.4, though, and I could probably upgrade, as my sole purpose for
> having R right now is to deal with shapefiles and create image maps.
> 
> - Related to the above, I don't see the spgpc package on my mirror (USA
> (IA)), but that may be related to being at 2.3?

No, but it isn't on CRAN, only on the little sp extras repository on 
sourceforge:

rSpatial <- "http://r-spatial.sourceforge.net/R"
install.packages("spgpc", repos=rSpatial)

so this should install it. In fact there isn't yet a Windows binary for 
2.4, so 2.3 is OK.

> 
> Also, I saw the 'unionSpatialPolygons' command in Debarchana Ghosh's
> code, but didn't know what it did.  I'll investigate the paths you have
> listed here.
> 
> Thanks again,
> Matt
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Thursday, October 19, 2006 2:32 AM
> To: Pettis, Matthew (TLR Corp)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] shapefiles, images, iimagemaps, and removing
> internalboundary lines
> 
> On Wed, 18 Oct 2006 matt.pettis at thomson.com wrote:
> 
> > I have sucessfully inputted a shapefile into a 
> > SpatialPolygonsDataFrame object.  I would like to output this file as 
> > a .gif/.png/.bmp/.jpeg image and generate an imagemap for the 
> > outputted image.  Does anybody know the best way to approach this?
> 
> RSiteSearch("imagemap")
> 
> gets you to:
> 
> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/28035.html
> 
> This installs on R 2.4.0 from source - which platform are you using and
> can you install source packages? The documentation in
> imagemap/inst/doc/imagemap-howto.pdf is clear, addRegion(im) <- for each
> clickable object. How to go from there depends on what you want to be
> clickable. 
> 
> Alternatives might be Rpad:
> 
> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/77952.html
> 
> or using ogr2ogr in FWTools (external software) to generate a KML for
> Google Earth (if the bubble that pops up is enough - I don't know how to
> put a link into it, though I guess it could be done), or writing the KML
> from R:
> 
> http://bbs.keyhole.com/ubb/showflat.php/Cat/0/Number/221682/Main/219131
> 
> >  secondly (and i may need to start another thread for this), but is 
> > there an easy function to remove the interior lines of aggregated 
> > shapes (and generate an imagemap again, etc.)?  For example, If I have
> 
> > a map of the U.S.'s with a polygon for each state, could I remove all 
> > internal state boundaries to leave just the national border?
> 
> Using the objects you have now, you need to install the spgpc package:
> 
> rSpatial <- "http://r-spatial.sourceforge.net/R"
> install.packages("spgpc", repos=rSpatial)
> 
> and install gpclib from CRAN. Then
> 
> ?unionSpatialPolygons
> 
> to dissolve internal boundaries. This is for arbitrary polygons, if you
> really just need to dissolve US states, perhaps using the CRAN maps
> package with its built-in database, and its own dissolve mechanism would
> save re-doing topology, but it only works for polygons in the database.
> 
> Roger
> 
> >  
> > thanks,
> > Matt
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From matt.pettis at thomson.com  Thu Oct 19 18:40:14 2006
From: matt.pettis at thomson.com (matt.pettis at thomson.com)
Date: Thu, 19 Oct 2006 11:40:14 -0500
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
	and removinginternalboundary lines
Message-ID: <89C159F45B13A24682D98BDEF58E451F0A7AA6FE@TLRUSMNEAGMBX28.ERF.THOMSON.COM>

Thanks! Got it to work.

However, the install of "imagemap" didn't work for me... I'm on Windows
XP, and the souce comes in a .tar.gz file, which the 'Packages > Install
packages(s) from local .zip files...' doesn't recognize.  Any alternate
location for this, or a method for windows xp to import this module
correctly?

Thanks,
matt 

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Thursday, October 19, 2006 11:14 AM
To: Pettis, Matthew (TLR Corp)
Cc: r-sig-geo at stat.math.ethz.ch
Subject: RE: [R-sig-Geo] shapefiles, images, iimagemaps, and
removinginternalboundary lines

On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:

> Hi Roger,
> 
> Thanks again for the response.  To answer your questions:
> 
> - I am currently running on R 2.3.1.  I was at 2.4.x, but some of the 
> packages I thought I needed weren't available on the cran interface in

> the rgui (I was experimenting, and I can't remember what they were 
> now, so that may no longer be true).  It sounds like you are fine 
> running R at 2.4, though, and I could probably upgrade, as my sole 
> purpose for having R right now is to deal with shapefiles and create
image maps.
> 
> - Related to the above, I don't see the spgpc package on my mirror 
> (USA (IA)), but that may be related to being at 2.3?

No, but it isn't on CRAN, only on the little sp extras repository on
sourceforge:

rSpatial <- "http://r-spatial.sourceforge.net/R"
install.packages("spgpc", repos=rSpatial)

so this should install it. In fact there isn't yet a Windows binary for
2.4, so 2.3 is OK.

> 
> Also, I saw the 'unionSpatialPolygons' command in Debarchana Ghosh's 
> code, but didn't know what it did.  I'll investigate the paths you 
> have listed here.
> 
> Thanks again,
> Matt
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Thursday, October 19, 2006 2:32 AM
> To: Pettis, Matthew (TLR Corp)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] shapefiles, images, iimagemaps, and removing 
> internalboundary lines
> 
> On Wed, 18 Oct 2006 matt.pettis at thomson.com wrote:
> 
> > I have sucessfully inputted a shapefile into a 
> > SpatialPolygonsDataFrame object.  I would like to output this file 
> > as a .gif/.png/.bmp/.jpeg image and generate an imagemap for the 
> > outputted image.  Does anybody know the best way to approach this?
> 
> RSiteSearch("imagemap")
> 
> gets you to:
> 
> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/28035.html
> 
> This installs on R 2.4.0 from source - which platform are you using 
> and can you install source packages? The documentation in 
> imagemap/inst/doc/imagemap-howto.pdf is clear, addRegion(im) <- for 
> each clickable object. How to go from there depends on what you want 
> to be clickable.
> 
> Alternatives might be Rpad:
> 
> http://finzi.psych.upenn.edu/R/Rhelp02a/archive/77952.html
> 
> or using ogr2ogr in FWTools (external software) to generate a KML for 
> Google Earth (if the bubble that pops up is enough - I don't know how 
> to put a link into it, though I guess it could be done), or writing 
> the KML from R:
> 
> http://bbs.keyhole.com/ubb/showflat.php/Cat/0/Number/221682/Main/21913
> 1
> 
> >  secondly (and i may need to start another thread for this), but is 
> > there an easy function to remove the interior lines of aggregated 
> > shapes (and generate an imagemap again, etc.)?  For example, If I 
> > have
> 
> > a map of the U.S.'s with a polygon for each state, could I remove 
> > all internal state boundaries to leave just the national border?
> 
> Using the objects you have now, you need to install the spgpc package:
> 
> rSpatial <- "http://r-spatial.sourceforge.net/R"
> install.packages("spgpc", repos=rSpatial)
> 
> and install gpclib from CRAN. Then
> 
> ?unionSpatialPolygons
> 
> to dissolve internal boundaries. This is for arbitrary polygons, if 
> you really just need to dissolve US states, perhaps using the CRAN 
> maps package with its built-in database, and its own dissolve 
> mechanism would save re-doing topology, but it only works for polygons
in the database.
> 
> Roger
> 
> >  
> > thanks,
> > Matt
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School 
> of Economics and Business Administration, Helleveien 30, N-5045 
> Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Oct 19 21:56:55 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Oct 2006 21:56:55 +0200 (CEST)
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
 and removinginternalboundary lines
In-Reply-To: <89C159F45B13A24682D98BDEF58E451F0A7AA6FE@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
Message-ID: <Pine.LNX.4.44.0610192148280.24530-100000@reclus.nhh.no>

On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:

> Thanks! Got it to work.
> 
> However, the install of "imagemap" didn't work for me... I'm on Windows
> XP, and the souce comes in a .tar.gz file, which the 'Packages > Install
> packages(s) from local .zip files...' doesn't recognize.  Any alternate
> location for this, or a method for windows xp to import this module
> correctly?

The *.tar.gz is a source package. The *.zip are typically Windows binary 
packages, pre-built. Some Windows users with programming experience do 
build their own from source, the toolset is described in Appendix E of the 
R Installation and Administration manual, and package installation in Ch. 
6. If that isn't for you (or anybody nearby), say, and someone may have a 
go at building a Windows binary. Whether it is worth the trouble for 
spatial objects will however depend on the objects you want to make 
clickable, if they are simple, it'll work, but if they are polygons with 
very detailed boundaries (remember that the image map is raster while the 
boundaries are vector), it may not scale well. Probably worth trying, 
though.

Roger

> 
> Thanks,
> matt 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Thursday, October 19, 2006 11:14 AM
> To: Pettis, Matthew (TLR Corp)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] shapefiles, images, iimagemaps, and
> removinginternalboundary lines
> 
> On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:
> 
> > Hi Roger,
> > 
> > Thanks again for the response.  To answer your questions:
> > 
> > - I am currently running on R 2.3.1.  I was at 2.4.x, but some of the 
> > packages I thought I needed weren't available on the cran interface in
> 
> > the rgui (I was experimenting, and I can't remember what they were 
> > now, so that may no longer be true).  It sounds like you are fine 
> > running R at 2.4, though, and I could probably upgrade, as my sole 
> > purpose for having R right now is to deal with shapefiles and create
> image maps.
> > 
> > - Related to the above, I don't see the spgpc package on my mirror 
> > (USA (IA)), but that may be related to being at 2.3?
> 
> No, but it isn't on CRAN, only on the little sp extras repository on
> sourceforge:
> 
> rSpatial <- "http://r-spatial.sourceforge.net/R"
> install.packages("spgpc", repos=rSpatial)
> 
> so this should install it. In fact there isn't yet a Windows binary for
> 2.4, so 2.3 is OK.
> 
> > 
> > Also, I saw the 'unionSpatialPolygons' command in Debarchana Ghosh's 
> > code, but didn't know what it did.  I'll investigate the paths you 
> > have listed here.
> > 
> > Thanks again,
> > Matt
> > 
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > Sent: Thursday, October 19, 2006 2:32 AM
> > To: Pettis, Matthew (TLR Corp)
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Subject: Re: [R-sig-Geo] shapefiles, images, iimagemaps, and removing 
> > internalboundary lines
> > 
> > On Wed, 18 Oct 2006 matt.pettis at thomson.com wrote:
> > 
> > > I have sucessfully inputted a shapefile into a 
> > > SpatialPolygonsDataFrame object.  I would like to output this file 
> > > as a .gif/.png/.bmp/.jpeg image and generate an imagemap for the 
> > > outputted image.  Does anybody know the best way to approach this?
> > 
> > RSiteSearch("imagemap")
> > 
> > gets you to:
> > 
> > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/28035.html
> > 
> > This installs on R 2.4.0 from source - which platform are you using 
> > and can you install source packages? The documentation in 
> > imagemap/inst/doc/imagemap-howto.pdf is clear, addRegion(im) <- for 
> > each clickable object. How to go from there depends on what you want 
> > to be clickable.
> > 
> > Alternatives might be Rpad:
> > 
> > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/77952.html
> > 
> > or using ogr2ogr in FWTools (external software) to generate a KML for 
> > Google Earth (if the bubble that pops up is enough - I don't know how 
> > to put a link into it, though I guess it could be done), or writing 
> > the KML from R:
> > 
> > http://bbs.keyhole.com/ubb/showflat.php/Cat/0/Number/221682/Main/21913
> > 1
> > 
> > >  secondly (and i may need to start another thread for this), but is 
> > > there an easy function to remove the interior lines of aggregated 
> > > shapes (and generate an imagemap again, etc.)?  For example, If I 
> > > have
> > 
> > > a map of the U.S.'s with a polygon for each state, could I remove 
> > > all internal state boundaries to leave just the national border?
> > 
> > Using the objects you have now, you need to install the spgpc package:
> > 
> > rSpatial <- "http://r-spatial.sourceforge.net/R"
> > install.packages("spgpc", repos=rSpatial)
> > 
> > and install gpclib from CRAN. Then
> > 
> > ?unionSpatialPolygons
> > 
> > to dissolve internal boundaries. This is for arbitrary polygons, if 
> > you really just need to dissolve US states, perhaps using the CRAN 
> > maps package with its built-in database, and its own dissolve 
> > mechanism would save re-doing topology, but it only works for polygons
> in the database.
> > 
> > Roger
> > 
> > >  
> > > thanks,
> > > Matt
> > > 
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > 
> > 
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School 
> > of Economics and Business Administration, Helleveien 30, N-5045 
> > Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> > 
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From matt.pettis at thomson.com  Thu Oct 19 22:14:12 2006
From: matt.pettis at thomson.com (matt.pettis at thomson.com)
Date: Thu, 19 Oct 2006 15:14:12 -0500
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
	and removinginternalboundarylines
Message-ID: <89C159F45B13A24682D98BDEF58E451F0A7AACF3@TLRUSMNEAGMBX28.ERF.THOMSON.COM>

Thanks Roger,

I'll try and build my own from source -- I was just hoping there was a
binary floating around somewhere.

Truthfully, my maps will have very detailed boundaries (Relatively
speaking, I think), so I'll give it a try.

I'll be posting some more questions in a bit about
'unionSpatialPolygons', as I am having some troubles with it...

Thanks,
Matt 

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Thursday, October 19, 2006 2:57 PM
To: Pettis, Matthew (TLR Corp)
Cc: r-sig-geo at stat.math.ethz.ch
Subject: RE: [R-sig-Geo] shapefiles, images, iimagemaps, and
removinginternalboundarylines

On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:

> Thanks! Got it to work.
> 
> However, the install of "imagemap" didn't work for me... I'm on 
> Windows XP, and the souce comes in a .tar.gz file, which the 'Packages

> > Install
> packages(s) from local .zip files...' doesn't recognize.  Any 
> alternate location for this, or a method for windows xp to import this

> module correctly?

The *.tar.gz is a source package. The *.zip are typically Windows binary
packages, pre-built. Some Windows users with programming experience do
build their own from source, the toolset is described in Appendix E of
the R Installation and Administration manual, and package installation
in Ch. 
6. If that isn't for you (or anybody nearby), say, and someone may have
a go at building a Windows binary. Whether it is worth the trouble for
spatial objects will however depend on the objects you want to make
clickable, if they are simple, it'll work, but if they are polygons with
very detailed boundaries (remember that the image map is raster while
the boundaries are vector), it may not scale well. Probably worth
trying, though.

Roger

> 
> Thanks,
> matt
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Thursday, October 19, 2006 11:14 AM
> To: Pettis, Matthew (TLR Corp)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] shapefiles, images, iimagemaps, and 
> removinginternalboundary lines
> 
> On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:
> 
> > Hi Roger,
> > 
> > Thanks again for the response.  To answer your questions:
> > 
> > - I am currently running on R 2.3.1.  I was at 2.4.x, but some of 
> > the packages I thought I needed weren't available on the cran 
> > interface in
> 
> > the rgui (I was experimenting, and I can't remember what they were 
> > now, so that may no longer be true).  It sounds like you are fine 
> > running R at 2.4, though, and I could probably upgrade, as my sole 
> > purpose for having R right now is to deal with shapefiles and create
> image maps.
> > 
> > - Related to the above, I don't see the spgpc package on my mirror 
> > (USA (IA)), but that may be related to being at 2.3?
> 
> No, but it isn't on CRAN, only on the little sp extras repository on
> sourceforge:
> 
> rSpatial <- "http://r-spatial.sourceforge.net/R"
> install.packages("spgpc", repos=rSpatial)
> 
> so this should install it. In fact there isn't yet a Windows binary 
> for 2.4, so 2.3 is OK.
> 
> > 
> > Also, I saw the 'unionSpatialPolygons' command in Debarchana Ghosh's

> > code, but didn't know what it did.  I'll investigate the paths you 
> > have listed here.
> > 
> > Thanks again,
> > Matt
> > 
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > Sent: Thursday, October 19, 2006 2:32 AM
> > To: Pettis, Matthew (TLR Corp)
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Subject: Re: [R-sig-Geo] shapefiles, images, iimagemaps, and 
> > removing internalboundary lines
> > 
> > On Wed, 18 Oct 2006 matt.pettis at thomson.com wrote:
> > 
> > > I have sucessfully inputted a shapefile into a 
> > > SpatialPolygonsDataFrame object.  I would like to output this file

> > > as a .gif/.png/.bmp/.jpeg image and generate an imagemap for the 
> > > outputted image.  Does anybody know the best way to approach this?
> > 
> > RSiteSearch("imagemap")
> > 
> > gets you to:
> > 
> > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/28035.html
> > 
> > This installs on R 2.4.0 from source - which platform are you using 
> > and can you install source packages? The documentation in 
> > imagemap/inst/doc/imagemap-howto.pdf is clear, addRegion(im) <- for 
> > each clickable object. How to go from there depends on what you want

> > to be clickable.
> > 
> > Alternatives might be Rpad:
> > 
> > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/77952.html
> > 
> > or using ogr2ogr in FWTools (external software) to generate a KML 
> > for Google Earth (if the bubble that pops up is enough - I don't 
> > know how to put a link into it, though I guess it could be done), or

> > writing the KML from R:
> > 
> > http://bbs.keyhole.com/ubb/showflat.php/Cat/0/Number/221682/Main/219
> > 13
> > 1
> > 
> > >  secondly (and i may need to start another thread for this), but 
> > > is there an easy function to remove the interior lines of 
> > > aggregated shapes (and generate an imagemap again, etc.)?  For 
> > > example, If I have
> > 
> > > a map of the U.S.'s with a polygon for each state, could I remove 
> > > all internal state boundaries to leave just the national border?
> > 
> > Using the objects you have now, you need to install the spgpc
package:
> > 
> > rSpatial <- "http://r-spatial.sourceforge.net/R"
> > install.packages("spgpc", repos=rSpatial)
> > 
> > and install gpclib from CRAN. Then
> > 
> > ?unionSpatialPolygons
> > 
> > to dissolve internal boundaries. This is for arbitrary polygons, if 
> > you really just need to dissolve US states, perhaps using the CRAN 
> > maps package with its built-in database, and its own dissolve 
> > mechanism would save re-doing topology, but it only works for 
> > polygons
> in the database.
> > 
> > Roger
> > 
> > >  
> > > thanks,
> > > Matt
> > > 
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > 
> > 
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian 
> > School of Economics and Business Administration, Helleveien 30, 
> > N-5045 Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> > 
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School 
> of Economics and Business Administration, Helleveien 30, N-5045 
> Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> 

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From matt.pettis at thomson.com  Thu Oct 19 22:38:31 2006
From: matt.pettis at thomson.com (matt.pettis at thomson.com)
Date: Thu, 19 Oct 2006 15:38:31 -0500
Subject: [R-sig-Geo] Problems graphing shapefiles with detailed boundaries
Message-ID: <89C159F45B13A24682D98BDEF58E451F0A7AADA6@TLRUSMNEAGMBX28.ERF.THOMSON.COM>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061019/9f43a2d0/attachment.pl>

From B.Rowlingson at lancaster.ac.uk  Thu Oct 19 23:56:34 2006
From: B.Rowlingson at lancaster.ac.uk (Baz)
Date: Thu, 19 Oct 2006 22:56:34 +0100
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
	and removinginternalboundarylines
In-Reply-To: <89C159F45B13A24682D98BDEF58E451F0A7AACF3@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
References: <89C159F45B13A24682D98BDEF58E451F0A7AACF3@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
Message-ID: <4537F492.7050100@lancaster.ac.uk>

matt.pettis at thomson.com wrote:
> Thanks Roger,
> 
> I'll try and build my own from source -- I was just hoping there was a
> binary floating around somewhere.
> 
> Truthfully, my maps will have very detailed boundaries (Relatively
> speaking, I think), so I'll give it a try.
> 

  Matt,
   my imagemap package is all R code - if you can extract the .tar.gz 
file (ask a friendly local linux user to do it, or install cygwin) then 
you just need to source the .R files.

  Okay, I've zipped this up here:

http://www.maths.lancs.ac.uk/Software/Imagemap/imagemap.zip

  note this is probably *not* an installable package. Unzip it, then 
source() the .R file. Also, it was designed for R 1.8.x, and R has moved 
on so things may have changed and not work anymore. Someone could 
probably easily build a windows .zip package for installation...

Barry



From matt.pettis at thomson.com  Fri Oct 20 06:42:09 2006
From: matt.pettis at thomson.com (matt.pettis at thomson.com)
Date: Thu, 19 Oct 2006 23:42:09 -0500
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
	and removinginternalboundarylines
References: <89C159F45B13A24682D98BDEF58E451F0A7AACF3@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
	<4537F492.7050100@lancaster.ac.uk>
Message-ID: <89C159F45B13A24682D98BDEF58E451F08C0ED@TLRUSMNEAGMBX28.ERF.THOMSON.COM>

Thanks Baz! I'll give it a go...
 
Matt

________________________________

From: Baz [mailto:B.Rowlingson at lancaster.ac.uk]
Sent: Thu 10/19/2006 4:56 PM
To: Pettis, Matthew (TLR Corp)
Cc: Roger.Bivand at nhh.no; r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] shapefiles, images, iimagemaps, and removinginternalboundarylines



matt.pettis at thomson.com wrote:
> Thanks Roger,
>
> I'll try and build my own from source -- I was just hoping there was a
> binary floating around somewhere.
>
> Truthfully, my maps will have very detailed boundaries (Relatively
> speaking, I think), so I'll give it a try.
>

  Matt,
   my imagemap package is all R code - if you can extract the .tar.gz
file (ask a friendly local linux user to do it, or install cygwin) then
you just need to source the .R files.

  Okay, I've zipped this up here:

http://www.maths.lancs.ac.uk/Software/Imagemap/imagemap.zip

  note this is probably *not* an installable package. Unzip it, then
source() the .R file. Also, it was designed for R 1.8.x, and R has moved
on so things may have changed and not work anymore. Someone could
probably easily build a windows .zip package for installation...

Barry



From Roger.Bivand at nhh.no  Fri Oct 20 09:51:20 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 20 Oct 2006 09:51:20 +0200 (CEST)
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
 and removinginternalboundarylines
In-Reply-To: <4537F492.7050100@lancaster.ac.uk>
Message-ID: <Pine.LNX.4.44.0610200950460.25151-100000@reclus.nhh.no>

On Thu, 19 Oct 2006, Baz wrote:

> matt.pettis at thomson.com wrote:
> > Thanks Roger,
> > 
> > I'll try and build my own from source -- I was just hoping there was a
> > binary floating around somewhere.
> > 
> > Truthfully, my maps will have very detailed boundaries (Relatively
> > speaking, I think), so I'll give it a try.
> > 
> 
>   Matt,
>    my imagemap package is all R code - if you can extract the .tar.gz 
> file (ask a friendly local linux user to do it, or install cygwin) then 
> you just need to source the .R files.
> 
>   Okay, I've zipped this up here:
> 
> http://www.maths.lancs.ac.uk/Software/Imagemap/imagemap.zip
> 
>   note this is probably *not* an installable package. Unzip it, then 
> source() the .R file. Also, it was designed for R 1.8.x, and R has moved 
> on so things may have changed and not work anymore. Someone could 
> probably easily build a windows .zip package for installation...
> 

Ran for me installed from source package on 2.4.0.

Roger

> Barry
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Oct 20 10:36:15 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 20 Oct 2006 10:36:15 +0200 (CEST)
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
 and removinginternalboundarylines
In-Reply-To: <89C159F45B13A24682D98BDEF58E451F0A7AACF3@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
Message-ID: <Pine.LNX.4.44.0610200952540.25151-100000@reclus.nhh.no>

On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:

> Thanks Roger,
> 
> I'll try and build my own from source -- I was just hoping there was a
> binary floating around somewhere.
> 
> Truthfully, my maps will have very detailed boundaries (Relatively
> speaking, I think), so I'll give it a try.

A possible dirty fix is to overlay the polygons with a low-resolution grid 
and take the convex hull of cell centres within each polygon as the object 
passed to the HTML code as a clickable mask - there will be "no-hit" 
slivers, and overlaps for convex/concave boundaries, but life is too short 
...

library(maptools)
xx <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
  IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
grd <- GridTopology(c(-84.5, 33.75), c(0.025, 0.025), c(360, 120))
mask <- SpatialGrid(grd, proj4string=CRS("+proj=longlat +ellps=clrk66"))
where <- overlay(mask, xx) # takes some time
incrds <- coordinates(mask)[!is.na(where),]
inwhere <- where[!is.na(where)]
incrds1 <- split(data.frame(incrds), inwhere)
chulls <- lapply(incrds1, function(x) {xx <- as.matrix(x); 
  xx[chull(xx),]})
plot(xx, border="blue")
lapply(chulls, polygon, col="yellow")

There are slivers/overlaps, it'll need fine tuning, but these image map 
polygons have many fewer boundary points that the originals. In addition 
multiple polygon objects are not treated gracefully. 

Roger


> 
> I'll be posting some more questions in a bit about
> 'unionSpatialPolygons', as I am having some troubles with it...
> 
> Thanks,
> Matt 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Thursday, October 19, 2006 2:57 PM
> To: Pettis, Matthew (TLR Corp)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] shapefiles, images, iimagemaps, and
> removinginternalboundarylines
> 
> On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:
> 
> > Thanks! Got it to work.
> > 
> > However, the install of "imagemap" didn't work for me... I'm on 
> > Windows XP, and the souce comes in a .tar.gz file, which the 'Packages
> 
> > > Install
> > packages(s) from local .zip files...' doesn't recognize.  Any 
> > alternate location for this, or a method for windows xp to import this
> 
> > module correctly?
> 
> The *.tar.gz is a source package. The *.zip are typically Windows binary
> packages, pre-built. Some Windows users with programming experience do
> build their own from source, the toolset is described in Appendix E of
> the R Installation and Administration manual, and package installation
> in Ch. 
> 6. If that isn't for you (or anybody nearby), say, and someone may have
> a go at building a Windows binary. Whether it is worth the trouble for
> spatial objects will however depend on the objects you want to make
> clickable, if they are simple, it'll work, but if they are polygons with
> very detailed boundaries (remember that the image map is raster while
> the boundaries are vector), it may not scale well. Probably worth
> trying, though.
> 
> Roger
> 
> > 
> > Thanks,
> > matt
> > 
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > Sent: Thursday, October 19, 2006 11:14 AM
> > To: Pettis, Matthew (TLR Corp)
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Subject: RE: [R-sig-Geo] shapefiles, images, iimagemaps, and 
> > removinginternalboundary lines
> > 
> > On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:
> > 
> > > Hi Roger,
> > > 
> > > Thanks again for the response.  To answer your questions:
> > > 
> > > - I am currently running on R 2.3.1.  I was at 2.4.x, but some of 
> > > the packages I thought I needed weren't available on the cran 
> > > interface in
> > 
> > > the rgui (I was experimenting, and I can't remember what they were 
> > > now, so that may no longer be true).  It sounds like you are fine 
> > > running R at 2.4, though, and I could probably upgrade, as my sole 
> > > purpose for having R right now is to deal with shapefiles and create
> > image maps.
> > > 
> > > - Related to the above, I don't see the spgpc package on my mirror 
> > > (USA (IA)), but that may be related to being at 2.3?
> > 
> > No, but it isn't on CRAN, only on the little sp extras repository on
> > sourceforge:
> > 
> > rSpatial <- "http://r-spatial.sourceforge.net/R"
> > install.packages("spgpc", repos=rSpatial)
> > 
> > so this should install it. In fact there isn't yet a Windows binary 
> > for 2.4, so 2.3 is OK.
> > 
> > > 
> > > Also, I saw the 'unionSpatialPolygons' command in Debarchana Ghosh's
> 
> > > code, but didn't know what it did.  I'll investigate the paths you 
> > > have listed here.
> > > 
> > > Thanks again,
> > > Matt
> > > 
> > > -----Original Message-----
> > > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > > Sent: Thursday, October 19, 2006 2:32 AM
> > > To: Pettis, Matthew (TLR Corp)
> > > Cc: r-sig-geo at stat.math.ethz.ch
> > > Subject: Re: [R-sig-Geo] shapefiles, images, iimagemaps, and 
> > > removing internalboundary lines
> > > 
> > > On Wed, 18 Oct 2006 matt.pettis at thomson.com wrote:
> > > 
> > > > I have sucessfully inputted a shapefile into a 
> > > > SpatialPolygonsDataFrame object.  I would like to output this file
> 
> > > > as a .gif/.png/.bmp/.jpeg image and generate an imagemap for the 
> > > > outputted image.  Does anybody know the best way to approach this?
> > > 
> > > RSiteSearch("imagemap")
> > > 
> > > gets you to:
> > > 
> > > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/28035.html
> > > 
> > > This installs on R 2.4.0 from source - which platform are you using 
> > > and can you install source packages? The documentation in 
> > > imagemap/inst/doc/imagemap-howto.pdf is clear, addRegion(im) <- for 
> > > each clickable object. How to go from there depends on what you want
> 
> > > to be clickable.
> > > 
> > > Alternatives might be Rpad:
> > > 
> > > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/77952.html
> > > 
> > > or using ogr2ogr in FWTools (external software) to generate a KML 
> > > for Google Earth (if the bubble that pops up is enough - I don't 
> > > know how to put a link into it, though I guess it could be done), or
> 
> > > writing the KML from R:
> > > 
> > > http://bbs.keyhole.com/ubb/showflat.php/Cat/0/Number/221682/Main/219
> > > 13
> > > 1
> > > 
> > > >  secondly (and i may need to start another thread for this), but 
> > > > is there an easy function to remove the interior lines of 
> > > > aggregated shapes (and generate an imagemap again, etc.)?  For 
> > > > example, If I have
> > > 
> > > > a map of the U.S.'s with a polygon for each state, could I remove 
> > > > all internal state boundaries to leave just the national border?
> > > 
> > > Using the objects you have now, you need to install the spgpc
> package:
> > > 
> > > rSpatial <- "http://r-spatial.sourceforge.net/R"
> > > install.packages("spgpc", repos=rSpatial)
> > > 
> > > and install gpclib from CRAN. Then
> > > 
> > > ?unionSpatialPolygons
> > > 
> > > to dissolve internal boundaries. This is for arbitrary polygons, if 
> > > you really just need to dissolve US states, perhaps using the CRAN 
> > > maps package with its built-in database, and its own dissolve 
> > > mechanism would save re-doing topology, but it only works for 
> > > polygons
> > in the database.
> > > 
> > > Roger
> > > 
> > > >  
> > > > thanks,
> > > > Matt
> > > > 
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > 
> > > 
> > > --
> > > Roger Bivand
> > > Economic Geography Section, Department of Economics, Norwegian 
> > > School of Economics and Business Administration, Helleveien 30, 
> > > N-5045 Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > > e-mail: Roger.Bivand at nhh.no
> > > 
> > 
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School 
> > of Economics and Business Administration, Helleveien 30, N-5045 
> > Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> > 
> > 
> 
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Oct 20 11:25:26 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 20 Oct 2006 11:25:26 +0200 (CEST)
Subject: [R-sig-Geo] shapefiles, images, iimagemaps,
 and removinginternalboundarylines
In-Reply-To: <Pine.LNX.4.44.0610200952540.25151-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.44.0610201117280.25151-100000@reclus.nhh.no>

On Fri, 20 Oct 2006, Roger Bivand wrote:

> On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:
> 
> > Thanks Roger,
> > 
> > I'll try and build my own from source -- I was just hoping there was a
> > binary floating around somewhere.
> > 
> > Truthfully, my maps will have very detailed boundaries (Relatively
> > speaking, I think), so I'll give it a try.

After thinking abour using imagemaps, I realised that this will probably 
not scale with regard to the client-side/server-side balance. I really 
recommend looking at Rpad, and at MapServer for an open-source way of 
keeping relatively little on the client side. The harder bits are moving 
the data in the data base tables into R and back again maintaining the 
correct keys, but I'm sure it can be done. Apart from Rpad, are there 
others on the list with experience of using R as middleware for processing 
attribute data for web mapping? The O'Reilly "Web Mapping Illustrated" 
by Tyler Mitchell has plenty of ideas, but I can't see that they use R.

Roger

> 
> A possible dirty fix is to overlay the polygons with a low-resolution grid 
> and take the convex hull of cell centres within each polygon as the object 
> passed to the HTML code as a clickable mask - there will be "no-hit" 
> slivers, and overlaps for convex/concave boundaries, but life is too short 
> ...
> 
> library(maptools)
> xx <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
>   IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
> grd <- GridTopology(c(-84.5, 33.75), c(0.025, 0.025), c(360, 120))
> mask <- SpatialGrid(grd, proj4string=CRS("+proj=longlat +ellps=clrk66"))
> where <- overlay(mask, xx) # takes some time
> incrds <- coordinates(mask)[!is.na(where),]
> inwhere <- where[!is.na(where)]
> incrds1 <- split(data.frame(incrds), inwhere)
> chulls <- lapply(incrds1, function(x) {xx <- as.matrix(x); 
>   xx[chull(xx),]})
> plot(xx, border="blue")
> lapply(chulls, polygon, col="yellow")
> 
> There are slivers/overlaps, it'll need fine tuning, but these image map 
> polygons have many fewer boundary points that the originals. In addition 
> multiple polygon objects are not treated gracefully. 
> 
> Roger
> 
> 
> > 
> > I'll be posting some more questions in a bit about
> > 'unionSpatialPolygons', as I am having some troubles with it...
> > 
> > Thanks,
> > Matt 
> > 
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> > Sent: Thursday, October 19, 2006 2:57 PM
> > To: Pettis, Matthew (TLR Corp)
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Subject: RE: [R-sig-Geo] shapefiles, images, iimagemaps, and
> > removinginternalboundarylines
> > 
> > On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:
> > 
> > > Thanks! Got it to work.
> > > 
> > > However, the install of "imagemap" didn't work for me... I'm on 
> > > Windows XP, and the souce comes in a .tar.gz file, which the 'Packages
> > 
> > > > Install
> > > packages(s) from local .zip files...' doesn't recognize.  Any 
> > > alternate location for this, or a method for windows xp to import this
> > 
> > > module correctly?
> > 
> > The *.tar.gz is a source package. The *.zip are typically Windows binary
> > packages, pre-built. Some Windows users with programming experience do
> > build their own from source, the toolset is described in Appendix E of
> > the R Installation and Administration manual, and package installation
> > in Ch. 
> > 6. If that isn't for you (or anybody nearby), say, and someone may have
> > a go at building a Windows binary. Whether it is worth the trouble for
> > spatial objects will however depend on the objects you want to make
> > clickable, if they are simple, it'll work, but if they are polygons with
> > very detailed boundaries (remember that the image map is raster while
> > the boundaries are vector), it may not scale well. Probably worth
> > trying, though.
> > 
> > Roger
> > 
> > > 
> > > Thanks,
> > > matt
> > > 
> > > -----Original Message-----
> > > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > > Sent: Thursday, October 19, 2006 11:14 AM
> > > To: Pettis, Matthew (TLR Corp)
> > > Cc: r-sig-geo at stat.math.ethz.ch
> > > Subject: RE: [R-sig-Geo] shapefiles, images, iimagemaps, and 
> > > removinginternalboundary lines
> > > 
> > > On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:
> > > 
> > > > Hi Roger,
> > > > 
> > > > Thanks again for the response.  To answer your questions:
> > > > 
> > > > - I am currently running on R 2.3.1.  I was at 2.4.x, but some of 
> > > > the packages I thought I needed weren't available on the cran 
> > > > interface in
> > > 
> > > > the rgui (I was experimenting, and I can't remember what they were 
> > > > now, so that may no longer be true).  It sounds like you are fine 
> > > > running R at 2.4, though, and I could probably upgrade, as my sole 
> > > > purpose for having R right now is to deal with shapefiles and create
> > > image maps.
> > > > 
> > > > - Related to the above, I don't see the spgpc package on my mirror 
> > > > (USA (IA)), but that may be related to being at 2.3?
> > > 
> > > No, but it isn't on CRAN, only on the little sp extras repository on
> > > sourceforge:
> > > 
> > > rSpatial <- "http://r-spatial.sourceforge.net/R"
> > > install.packages("spgpc", repos=rSpatial)
> > > 
> > > so this should install it. In fact there isn't yet a Windows binary 
> > > for 2.4, so 2.3 is OK.
> > > 
> > > > 
> > > > Also, I saw the 'unionSpatialPolygons' command in Debarchana Ghosh's
> > 
> > > > code, but didn't know what it did.  I'll investigate the paths you 
> > > > have listed here.
> > > > 
> > > > Thanks again,
> > > > Matt
> > > > 
> > > > -----Original Message-----
> > > > From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> > > > Sent: Thursday, October 19, 2006 2:32 AM
> > > > To: Pettis, Matthew (TLR Corp)
> > > > Cc: r-sig-geo at stat.math.ethz.ch
> > > > Subject: Re: [R-sig-Geo] shapefiles, images, iimagemaps, and 
> > > > removing internalboundary lines
> > > > 
> > > > On Wed, 18 Oct 2006 matt.pettis at thomson.com wrote:
> > > > 
> > > > > I have sucessfully inputted a shapefile into a 
> > > > > SpatialPolygonsDataFrame object.  I would like to output this file
> > 
> > > > > as a .gif/.png/.bmp/.jpeg image and generate an imagemap for the 
> > > > > outputted image.  Does anybody know the best way to approach this?
> > > > 
> > > > RSiteSearch("imagemap")
> > > > 
> > > > gets you to:
> > > > 
> > > > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/28035.html
> > > > 
> > > > This installs on R 2.4.0 from source - which platform are you using 
> > > > and can you install source packages? The documentation in 
> > > > imagemap/inst/doc/imagemap-howto.pdf is clear, addRegion(im) <- for 
> > > > each clickable object. How to go from there depends on what you want
> > 
> > > > to be clickable.
> > > > 
> > > > Alternatives might be Rpad:
> > > > 
> > > > http://finzi.psych.upenn.edu/R/Rhelp02a/archive/77952.html
> > > > 
> > > > or using ogr2ogr in FWTools (external software) to generate a KML 
> > > > for Google Earth (if the bubble that pops up is enough - I don't 
> > > > know how to put a link into it, though I guess it could be done), or
> > 
> > > > writing the KML from R:
> > > > 
> > > > http://bbs.keyhole.com/ubb/showflat.php/Cat/0/Number/221682/Main/219
> > > > 13
> > > > 1
> > > > 
> > > > >  secondly (and i may need to start another thread for this), but 
> > > > > is there an easy function to remove the interior lines of 
> > > > > aggregated shapes (and generate an imagemap again, etc.)?  For 
> > > > > example, If I have
> > > > 
> > > > > a map of the U.S.'s with a polygon for each state, could I remove 
> > > > > all internal state boundaries to leave just the national border?
> > > > 
> > > > Using the objects you have now, you need to install the spgpc
> > package:
> > > > 
> > > > rSpatial <- "http://r-spatial.sourceforge.net/R"
> > > > install.packages("spgpc", repos=rSpatial)
> > > > 
> > > > and install gpclib from CRAN. Then
> > > > 
> > > > ?unionSpatialPolygons
> > > > 
> > > > to dissolve internal boundaries. This is for arbitrary polygons, if 
> > > > you really just need to dissolve US states, perhaps using the CRAN 
> > > > maps package with its built-in database, and its own dissolve 
> > > > mechanism would save re-doing topology, but it only works for 
> > > > polygons
> > > in the database.
> > > > 
> > > > Roger
> > > > 
> > > > >  
> > > > > thanks,
> > > > > Matt
> > > > > 
> > > > > _______________________________________________
> > > > > R-sig-Geo mailing list
> > > > > R-sig-Geo at stat.math.ethz.ch
> > > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > > > 
> > > > 
> > > > --
> > > > Roger Bivand
> > > > Economic Geography Section, Department of Economics, Norwegian 
> > > > School of Economics and Business Administration, Helleveien 30, 
> > > > N-5045 Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > > > e-mail: Roger.Bivand at nhh.no
> > > > 
> > > 
> > > --
> > > Roger Bivand
> > > Economic Geography Section, Department of Economics, Norwegian School 
> > > of Economics and Business Administration, Helleveien 30, N-5045 
> > > Bergen, Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > > e-mail: Roger.Bivand at nhh.no
> > > 
> > > 
> > 
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From p.hiemstra at geo.uu.nl  Fri Oct 20 15:03:13 2006
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Fri, 20 Oct 2006 15:03:13 +0200
Subject: [R-sig-Geo] Variogram does not plot correctly when using layout()
Message-ID: <6.1.0.6.0.20061020144725.01ab5f30@pop3.geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061020/147af970/attachment.pl>

From Roger.Bivand at nhh.no  Fri Oct 20 18:06:28 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 20 Oct 2006 18:06:28 +0200 (CEST)
Subject: [R-sig-Geo] Problems graphing shapefiles with detailed
	boundaries
In-Reply-To: <89C159F45B13A24682D98BDEF58E451F0A7AADA6@TLRUSMNEAGMBX28.ERF.THOMSON.COM>
Message-ID: <Pine.LNX.4.44.0610201754460.25793-100000@reclus.nhh.no>

On Thu, 19 Oct 2006 matt.pettis at thomson.com wrote:

> Hi,
>  
> I'm loading in a shapefile with all of the voting precincts in
> Minnesota.  Each precinct belongs to a Senate district, which has a
> variable named "SEN" in the .dbf  ("Precinct" is also in the .dbf).
>  
> I am including a script that should allow anyone to replicate my
> problems, which I will lay out here (on Windows XP, R 2.3.1):
>  
> 1.  I limit myself to the first 2 SEN districts.  If I subset to each
> district and plot them with spplot, they individually get drawn and
> colored just fine.  When I try to draw them together, I get a
> checkerboard effect in the colorization (same with just drawing the
> internal boundaries).

This is a simple mistake in subsetting, you have to specify the chosen 
values in an appropriate way:

x12 <- vtd[vtd[["SEN"]] == 1 | vtd[["SEN"]] == 2, "SEN"]
spplot(x12)

>  
> 2.  When I try to remove internal boundaries from the SEN districts, it
> works fine on SEN == 1, but I get some phantom lines in SEN == 2.

I'm not sure whether the above clears up the problems, I'd also use 
vtd$SEN rather than vtd[["SEN"]], less error prone unless you need to 
insert the fiel/column name as a string.

I can also see the internal debris in vtd$SEN == 2, those are slivers 
from the original shapefile:

x2 <- vtd[vtd[["SEN"]]  == 2,]
x <- unionSpatialPolygons(x2, x2[["SEN"]])
plot(x)
summary(sapply(slot(slot(x, "polygons")[[1]], "Polygons"), function(x) 
  slot(x, "area")))

is:

     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
7.485e-05 2.075e-02 9.230e-02 2.593e+08 3.406e-01 1.996e+10 

so pruning the output object to leave only the large polygon is an option.

Hope this helps,

Roger

>  
> I wager these two problems might be related, but I am not sure.  Any
> ideas?
>  
> thanks,
> Matt
>  
> ########################################################################
> ####
> #----------------------------------------------------------------------
> # Config
> #----------------------------------------------------------------------
> # When I need to turn off proxy
> # Sys.putenv("no_proxy"=True)
> library(sp)
> library(maptools)
> library(spgpc)
> # needed for unionSpatialPolygons?  Looks like not...
> #library(gpclib)
>  
> #----------------------------------------------------------------------
> # Load Shapefile
> #----------------------------------------------------------------------
> # This shapefile is the shapefile of all of the voting precincts in
> Minnesota, 2006
> # All Precincts are contained within a SEN group
> # shapefile source:
> ftp://ftp.commissions.leg.state.mn.us/pub/gis/shape/vtd2006.zip
> # unzipped to pdir\Data\vtd2006
> pdir <- "C:\\Documents and Settings\\U0008998\\My
> Documents\\Projects\\GISVote";
> vtd <- readShapePoly(paste(pdir,"\\Data\\vtd2006\\vtd2006.shp",sep=""))
>  
> #----------------------------------------------------------------------
> # Plot the whole map of Minnesota
> #----------------------------------------------------------------------
> plot(vtd)
>  
> #----------------------------------------------------------------------
> # Shading regions
> #----------------------------------------------------------------------
> # Show and color SEN == 1, the Northwest corner of Minnesota
> x <- vtd[vtd[["SEN"]] == c(1), "SEN"]
> spplot(x,col.regions=2)
>  
> # Show and color SEN == 2, east and south of SEN == 1
> x <- vtd[vtd[["SEN"]] == c(2), "SEN"]
> spplot(x,col.regions=3)
>  
> # Plot them both together
> x <- vtd[vtd[["SEN"]] == c(1,2), "SEN"]
> spplot(x,col.regions=2:3)
>  
> #!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
> # Note that the whole regions are not colored
> #!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
>  
> 
> #----------------------------------------------------------------------
> # Plotting SEN districts together
> #----------------------------------------------------------------------
> # Subset to SEN == 1 and plot
> x <- vtd[vtd[["SEN"]]  == 1,names(vtd)]
> plot(x)
>  
> # Subset to SEN == 2 and plot
> x <- vtd[vtd[["SEN"]]  == 2,names(vtd)]
> plot(x)
>  
> # Plot SEN == 1 and 2 together
> x <- vtd[vtd[["SEN"]]  == 1:2,names(vtd)]
> plot(x)
> #!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
> # Note that the whole regions are not plotted
> #!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
>  
> #----------------------------------------------------------------------
> # Removing internal Precinct boundaries from SEN regions
> #----------------------------------------------------------------------
> # Subset to SEN == 1 and plot
> x <- vtd[vtd[["SEN"]]  == 1,names(vtd)]
> x <- unionSpatialPolygons(x, x[["SEN"]])
> plot(x)
>  
> # Subset to SEN == 2 and plot
> x <- vtd[vtd[["SEN"]]  == 2,names(vtd)]
> x <- unionSpatialPolygons(x, x[["SEN"]])
> plot(x)
> #!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
> # Note that some internal boundaries are not removed from SEN == 2
> #!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
>  
> # Subset to SEN == 1 and 2 and plot
> x <- vtd[vtd[["SEN"]]  == 1:2,names(vtd)]
> x <- unionSpatialPolygons(x, x[["SEN"]])
> plot(x)
> #!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
> # Note that most internal boundaries are not removed
> #!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
> 
> ########################################################################
> ####
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mauricio at cnpt.embrapa.br  Fri Oct 20 19:58:36 2006
From: mauricio at cnpt.embrapa.br (=?ISO-8859-1?Q?Jos=E9_Mauricio_Cunha_Fernandes?=)
Date: Fri, 20 Oct 2006 15:58:36 -0200
Subject: [R-sig-Geo] lesions distribution
Message-ID: <45390E4C.7000507@cnpt.embrapa.br>

Dear Friends,                                                         

I am a plant pathologist working in Southern Brazil. I have a research 
project dealing with the development of plant disease simulators. 
Amongst the research topics under investigation is the distribution
of disease symptoms within a particular leaf. We used a scanner to 
acquire images from wheat leaves infected with rust (a wheat disease).A 
grid x(-6,6) and y(0,100) was superimposed on each image and the number 
of lesions (z) in each cell of the grid was recorded. We have a few 
hundreds leaves examined. A example of data is shown bellow (leaf_46.txt).

x y z                                                                 

 0   0   1                                                            

 2   36  1                                                            

 1   18  1                                                            

 1   17  2                                                             

 1   32  2                                                            

 1   24  1                                                            

 1   23  1                                                            

 0   46  1                                                             

 1   43  7                                                            

 1   63  4                                                            

 -1  61  2                                                             

 1   55  2                                                            

 2   57  2                                                            

 -1  57  2                                                            

 -1  52  2                                                             

 -1  51  2                                                            

 1   51  2                                                            

 3   52  8                                                             

 0   37  2                                                            

 -1  66  6                                                            

 1   69  2                                                            

 2   72  4                                                            

 -4  73  3                                                            

 -4  72  1                                                            

 -1  70  2                                                             

 -4  67  2                                                            

 2   59  2                                                            

 -1  78  3                                                            

 0   77  1                                                            

 -2  76  2                                                            

 1   75  3                                                            

 2   27  1                                                             

 1   29  1                                                            

 0   27  1                                                            

This R code bellow was used to visualize:                                

 leaf_46 <- read.table("leaf_46.txt",header=T)                        

 win <- list(x=c(-6,-6,0,6,6), y=c(0,80,100,80,0))                    

 plot(win, asp=1, type="n")                                           

 polygon(win)                                                          

 points(leaf_46[,1:2])                                                

 

I am reading on published literature but I am still a little confused on 
choosing an appropriate technique to analyze the data. Therefore, any 
suggestions from the list members will be very welcome.

Thanks very much for your attention



From White.Denis at epamail.epa.gov  Sat Oct 21 01:14:49 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Fri, 20 Oct 2006 16:14:49 -0700
Subject: [R-sig-Geo] correlogram for categorical data
Message-ID: <OF73851C96.EDD8B16F-ON8825720D.007FB30F-8825720D.007FB311@epamail.epa.gov>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061020/2f4688f5/attachment.html>

From White.Denis at epamail.epa.gov  Sat Oct 21 01:32:13 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Fri, 20 Oct 2006 16:32:13 -0700
Subject: [R-sig-Geo] correlogram for categorical data
In-Reply-To: <Pine.LNX.4.44.0610190846290.24445-100000@reclus.nhh.no>
Message-ID: <OF7601C75F.E21447CF-ON8825720D.0081284C-8825720D.008148E4@epamail.epa.gov>

Roger Bivand <Roger.Bivand at nhh.no> wrote on 2006-10-19 00:05:31:

> On Wed, 18 Oct 2006 White.Denis at epamail.epa.gov wrote:
>
> > I have a 1000 x 1000 grid of categorical values (nine of these) and
want
> > to compute and plot a correlogram.  Function cell2nb() will take a
while
> > it appears but if that succeeds then can methods of sp.correlogram()
be
> > used on categorical data?  What are "style" options in
sp.correlogram()?
> >
>
> Sorry, could you say how a correlogram might be constructed for
> categorical values (eg. land cover)? Wouldn't join counts be a more
> natural choice? joincoint.multi() in spdep has a Jtot value of total
> different category joins, so using that with different lags of a
cell2nb()
> neighbour list might work. However, the 1M cell grid is pretty large
for
> cell2nb(), using dnearneigh() on cell centres may be faster and scale
> better, (and other possibilities should exist) and nblag() will be
> definitely sub-optimal in this setting. For join counts, the "B"
weights
> style is the obvious one to chose. Note that joincoint.multi() is not
> coded in C.
>
> This would need trying on a small subset and scaling up - I think that

> alternative routes to constructing the lagged neighbour lists would be

> preferable.
>
> Roger
>

I wrote a short function to compute proportion agreement between classes
at different lags, R code below.  Because it's a brute force O(n^2)
algorithm, it takes way too long in R for datasets with more than some
10's of points.  So I wrote a C version that took about 20 hours for 1M
points on a 2GHz linux computer.  Subsampling from the 1000x1000 image
reduced time considerably, naturally.

I haven't looked at Cliff and Ord or other texts on these kinds of
statistics for a long time and I don't know whether this simple
proportion agreement measure is closely related to a multinomial
joincount or not.  And so I don't know what the test for non-randomness
is or what a variance measure is, etc.  It does seem to portray the
spatial pattern in agreement though.

isotaxogram <- function (pts, nlags=10, maxdist)

# Calculate proportion agreement of categorical point data
# at successive lags
#
# pts      matrix or data frame with columns/names
#          "x", "y", "val"
# nlags    number of lags in the output function
# maxdist  maximum distance over which to compute the function;
#          needs to be specified

{
    agree <- num <- lag <- rep (0, nlags)
    for (i in 1:(nrow(pts)-1))
    {
        x1 <- pts[i, "x"]
        y1 <- pts[i, "y"]
        for (j in (i+1):nrow(pts))
        {
            x2 <- pts[j, "x"]
            y2 <- pts[j, "y"]
            d <- sqrt ((x2-x1)^2 + (y2-y1)^2)
            d <- round (d / maxdist * nlags)
            a <- as.integer (pts[i, "val"] == pts[j, "val"])
            if (d %in% 1:nlags)
            {
                agree[d] <- agree[d] + a
                num[d] <- num[d] + 1
            }
        }
    }
    for (k in 1:nlags)
    {
        lag[k] <- k * (maxdist / nlags)
        if (num[k] != 0) agree[k] <- agree[k] / num[k]
    }
    return (list (agree=agree, lag=lag, num=num))
}



From milton_ruser at yahoo.com.br  Sun Oct 22 00:17:03 2006
From: milton_ruser at yahoo.com.br (Milton Cezar Ribeiro)
Date: Sat, 21 Oct 2006 19:17:03 -0300 (ART)
Subject: [R-sig-Geo] clampy in binary image
Message-ID: <20061021221703.14675.qmail@web57907.mail.re3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061021/455a90e9/attachment.pl>

From Roger.Bivand at nhh.no  Sun Oct 22 16:46:58 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 22 Oct 2006 16:46:58 +0200 (CEST)
Subject: [R-sig-Geo] clampy in binary image
In-Reply-To: <20061021221703.14675.qmail@web57907.mail.re3.yahoo.com>
Message-ID: <Pine.LNX.4.44.0610221622080.21903-100000@reclus.nhh.no>

On Sat, 21 Oct 2006, Milton Cezar Ribeiro wrote:

> Hi there,
>    
>   I have a binary image and I need to identify each clump of non-zero
> values and attrib a diferent "patch" id-number.
>   Is there a R package that do that? 
>   By the way, what are the R packages for image manipulation?
>    

Both rimage and EBImage (on Bioconductor) provide filtering and other 
tools. You may also find that you can use functions from the 
spatstat package such as solutionset() on your image, but it isn't 
obvious how to add the ID. A lot will depend on your specific application.

>   Kind regards,
>    
>   Miltinho
>   BRAZIL
> 
>  		
> ---------------------------------
> 
> 	[[alternative HTML version deleted]]

Please only send text email messages, HTML will be deleted.

> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sun Oct 22 16:54:29 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 22 Oct 2006 16:54:29 +0200 (CEST)
Subject: [R-sig-Geo] correlogram for categorical data
In-Reply-To: <OF7601C75F.E21447CF-ON8825720D.0081284C-8825720D.008148E4@epamail.epa.gov>
Message-ID: <Pine.LNX.4.44.0610221648350.21903-100000@reclus.nhh.no>

On Fri, 20 Oct 2006 White.Denis at epamail.epa.gov wrote:

> Roger Bivand <Roger.Bivand at nhh.no> wrote on 2006-10-19 00:05:31:
> 
> > On Wed, 18 Oct 2006 White.Denis at epamail.epa.gov wrote:
> >
> > > I have a 1000 x 1000 grid of categorical values (nine of these) and
> want
> > > to compute and plot a correlogram.  Function cell2nb() will take a
> while
> > > it appears but if that succeeds then can methods of sp.correlogram()
> be
> > > used on categorical data?  What are "style" options in
> sp.correlogram()?
> > >
> >
> > Sorry, could you say how a correlogram might be constructed for
> > categorical values (eg. land cover)? Wouldn't join counts be a more
> > natural choice? joincoint.multi() in spdep has a Jtot value of total
> > different category joins, so using that with different lags of a
> cell2nb()
> > neighbour list might work. However, the 1M cell grid is pretty large
> for
> > cell2nb(), using dnearneigh() on cell centres may be faster and scale
> > better, (and other possibilities should exist) and nblag() will be
> > definitely sub-optimal in this setting. For join counts, the "B"
> weights
> > style is the obvious one to chose. Note that joincoint.multi() is not
> > coded in C.
> >
> > This would need trying on a small subset and scaling up - I think that
> 
> > alternative routes to constructing the lagged neighbour lists would be
> 
> > preferable.
> >
> > Roger
> >
> 
> I wrote a short function to compute proportion agreement between classes
> at different lags, R code below.  Because it's a brute force O(n^2)
> algorithm, it takes way too long in R for datasets with more than some
> 10's of points.  So I wrote a C version that took about 20 hours for 1M
> points on a 2GHz linux computer.  Subsampling from the 1000x1000 image
> reduced time considerably, naturally.
> 
> I haven't looked at Cliff and Ord or other texts on these kinds of
> statistics for a long time and I don't know whether this simple
> proportion agreement measure is closely related to a multinomial
> joincount or not.  And so I don't know what the test for non-randomness
> is or what a variance measure is, etc.  It does seem to portray the
> spatial pattern in agreement though.

It would be the non-free sampling as in joincount.test() in spdep, or 
possibly free sampling, which would be simpler. These are cumulated 
same-color tests, so som adaptation would be needed. This isn't the 
biggest problem, though, since the resolution of the grid and the steps in 
the "joincountogram" will get mixed up - very high join counts at small 
distances when the grid resolution is small compared the the effective 
scale of variation of the phenomena. 

Roger

> 
> isotaxogram <- function (pts, nlags=10, maxdist)
> 
> # Calculate proportion agreement of categorical point data
> # at successive lags
> #
> # pts      matrix or data frame with columns/names
> #          "x", "y", "val"
> # nlags    number of lags in the output function
> # maxdist  maximum distance over which to compute the function;
> #          needs to be specified
> 
> {
>     agree <- num <- lag <- rep (0, nlags)
>     for (i in 1:(nrow(pts)-1))
>     {
>         x1 <- pts[i, "x"]
>         y1 <- pts[i, "y"]
>         for (j in (i+1):nrow(pts))
>         {
>             x2 <- pts[j, "x"]
>             y2 <- pts[j, "y"]
>             d <- sqrt ((x2-x1)^2 + (y2-y1)^2)
>             d <- round (d / maxdist * nlags)
>             a <- as.integer (pts[i, "val"] == pts[j, "val"])
>             if (d %in% 1:nlags)
>             {
>                 agree[d] <- agree[d] + a
>                 num[d] <- num[d] + 1
>             }
>         }
>     }
>     for (k in 1:nlags)
>     {
>         lag[k] <- k * (maxdist / nlags)
>         if (num[k] != 0) agree[k] <- agree[k] / num[k]
>     }
>     return (list (agree=agree, lag=lag, num=num))
> }
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From borghor at yahoo.ca  Mon Oct 23 18:12:45 2006
From: borghor at yahoo.ca (bertrand toupin)
Date: Mon, 23 Oct 2006 12:12:45 -0400 (EDT)
Subject: [R-sig-Geo] Map projection
In-Reply-To: <Pine.LNX.4.44.0610201754460.25793-100000@reclus.nhh.no>
Message-ID: <20061023161245.20358.qmail@web42203.mail.scd.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061023/285d4e51/attachment.pl>

From dubroca at szn.it  Mon Oct 23 18:23:48 2006
From: dubroca at szn.it (Laurent Dubroca)
Date: Mon, 23 Oct 2006 18:23:48 +0200
Subject: [R-sig-Geo] clampy in binary image
In-Reply-To: <20061021221703.14675.qmail@web57907.mail.re3.yahoo.com>
References: <20061021221703.14675.qmail@web57907.mail.re3.yahoo.com>
Message-ID: <453CEC94.5000006@szn.it>

Milton Cezar Ribeiro wrote:

>Hi there,
>   
>  I have a binary image and I need to identify each clump of non-zero values and attrib a diferent "patch" id-number.
>  Is there a R package that do that? 
>  By the way, what are the R packages for image manipulation?
>  
>
Have a look to adehabitat and the function labcon.
For image manipulation rimage may be useful.

Laurent

>   
>  Kind regards,
>   
>  Miltinho
>  BRAZIL
>
> 		
>---------------------------------
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  
>



From Roger.Bivand at nhh.no  Mon Oct 23 18:33:28 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 23 Oct 2006 18:33:28 +0200 (CEST)
Subject: [R-sig-Geo] Map projection
In-Reply-To: <20061023161245.20358.qmail@web42203.mail.scd.yahoo.com>
Message-ID: <Pine.LNX.4.44.0610231826170.23376-100000@reclus.nhh.no>

On Mon, 23 Oct 2006, bertrand toupin wrote:

> Hi, earlier, I used those functions to transform a lat-long database to a Lambert Azimuthal Equal Area (LAEA) :
> 
> Lam_proj <- project(cbind(Grille$x, Grille$y),"+proj=laea
> +lat_0=latitudem_grid +lon_0=longitudem_grid +x_0=0 +y_0=0 +a=6370997
> +b=6370997 +units=m")
> 
> 
> Now that my calculations is done, I'd like to show the result and I'd need to re-transform the LAEA database to a lat-long database (since "surfm" in Matlab needs lat-long).
> 
> I used : project(cbind(Prev$x, Prev$y),"+proj=latlong")

?project:

and see inv=

That is:

project(cbind(Prev$x, Prev$y), proj=paste("+proj=laea", 
"+lat_0=latitudem_grid +lon_0=longitudem_grid +x_0=0 +y_0=0",
"+a=6370997 +b=6370997 +units=m"), inv=TRUE))

> 
> But I got this error message : "latitude or longitude exceeded limits"

Well, yes, you gave project() LAEA coordinates in metres, and asked it to 
project to +proj=longlat, which would be a null-op anyway, because 
project() only goes to (inv=TRUE) and from longlat. If you need objects 
that "remember" their coordinate reference systems, use sp classes and the 
spTransform() methods in rgdal.

Roger

> 
> Thanks for any help!
> 
> 
>  		
> ---------------------------------
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From borghor at yahoo.ca  Mon Oct 23 19:30:44 2006
From: borghor at yahoo.ca (bertrand toupin)
Date: Mon, 23 Oct 2006 13:30:44 -0400 (EDT)
Subject: [R-sig-Geo] Map projection
In-Reply-To: <Pine.LNX.4.44.0610231826170.23376-100000@reclus.nhh.no>
Message-ID: <20061023173044.50066.qmail@web42208.mail.scd.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061023/eb5a236c/attachment.pl>

From mreisman at isis.wu-wien.ac.at  Tue Oct 24 20:25:10 2006
From: mreisman at isis.wu-wien.ac.at (Martin Reismann)
Date: Tue, 24 Oct 2006 20:25:10 +0200 (MES)
Subject: [R-sig-Geo] From Sparse Matrix to Listw (capacity problems)
Message-ID: <Pine.A32.3.96.1061024200145.111438A-100000@isis.wu-wien.ac.at>

Dear colleagues,

This message concerns packages spdep and SparseM.

I have a problem converting a large binary weight matrix (12432 *
12432) from matrix.csr class to listw. 

I tried W.listw <- asListwMatrixCsr(W.csr)
which gives: error in asListwMatrixCsr(W.csr): row indices out of range

As a second approach I tried to read elements of the Sparse matrix one
by one to write an ASCII (GAL) file from W.csr. This failed as well 
because my method of accessing matrix
 as.matrix(W.csr[x,y]) 
is much too slow.

I am grateful for either:
- hints how to increase capacity of asListwMatrixCsr
- hints whether there is a Sparse matrix class and/or single element
access method which is faster.
- (or other workarounds).

Best wishes,
Martin Reismann

---
Mag. Martin Reismann
c/o
Institut fuer Wirtschaftsgeographie und Geoinformatik
Wirtschaftsuniversitaet Wien
Nordbergstrasse 15, 4. Stock, Kern A
A-1090 Wien

EMail: Martin.Reismann at wu-wien.ac.at
Tel +43-(0)-1-31336-5720
Fax +43-(0)-1-31336-703



From dgoliche at sclc.ecosur.mx  Tue Oct 24 21:30:06 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Tue, 24 Oct 2006 14:30:06 -0500
Subject: [R-sig-Geo] adehabitat
In-Reply-To: <mailman.17.1161684006.19058.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1161684006.19058.r-sig-geo@stat.math.ethz.ch>
Message-ID: <453E69BE.7060104@sclc.ecosur.mx>


>Milton Cezar Ribeiro wrote:
>
>  
>
>>Hi there,
>>  
>> I have a binary image and I need to identify each clump of non-zero values and attrib a diferent "patch" id-number.
>> Is there a R package that do that? 
>> By the way, what are the R packages for image manipulation?
>> 
>>
>>    
>>
>Have a look to adehabitat and the function labcon.
>  
>
This was a useful comment as I was doing something similar at the same 
time as Milton. I thought it worth mentioning that I found that when 
using sp0.9-2 I needed to fix the function spixdf2kasc in order to get 
sp data into the adehabitat kasc format.

The line that reads  ka <- as.data.frame(attr(sg at data, "att"))

should be changed to

ka <- sg at data

>For image manipulation rimage may be useful.
>
>Laurent
>
>  
>
>> 
>>
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher



From Roger.Bivand at nhh.no  Tue Oct 24 21:41:26 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 24 Oct 2006 21:41:26 +0200 (CEST)
Subject: [R-sig-Geo] From Sparse Matrix to Listw (capacity problems)
In-Reply-To: <Pine.A32.3.96.1061024200145.111438A-100000@isis.wu-wien.ac.at>
Message-ID: <Pine.LNX.4.44.0610242136060.23994-100000@reclus.nhh.no>

On Tue, 24 Oct 2006, Martin Reismann wrote:

> Dear colleagues,
> 
> This message concerns packages spdep and SparseM.
> 
> I have a problem converting a large binary weight matrix (12432 *
> 12432) from matrix.csr class to listw. 
> 
> I tried W.listw <- asListwMatrixCsr(W.csr)
> which gives: error in asListwMatrixCsr(W.csr): row indices out of range

What did traceback() say immediately after the error? Did debug() show the 
error happening before the loop (when you get to the loop, enter c to run 
through)? I think the problem is earlier, in dia, see if any values are 
zero by sum(dia == 0).

Roger

> 
> As a second approach I tried to read elements of the Sparse matrix one
> by one to write an ASCII (GAL) file from W.csr. This failed as well 
> because my method of accessing matrix
>  as.matrix(W.csr[x,y]) 
> is much too slow.
> 
> I am grateful for either:
> - hints how to increase capacity of asListwMatrixCsr
> - hints whether there is a Sparse matrix class and/or single element
> access method which is faster.
> - (or other workarounds).
> 
> Best wishes,
> Martin Reismann
> 
> ---
> Mag. Martin Reismann
> c/o
> Institut fuer Wirtschaftsgeographie und Geoinformatik
> Wirtschaftsuniversitaet Wien
> Nordbergstrasse 15, 4. Stock, Kern A
> A-1090 Wien
> 
> EMail: Martin.Reismann at wu-wien.ac.at
> Tel +43-(0)-1-31336-5720
> Fax +43-(0)-1-31336-703
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Tue Oct 24 23:34:03 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 24 Oct 2006 23:34:03 +0200
Subject: [R-sig-Geo] Variogram does not plot correctly when using
	layout()
In-Reply-To: <6.1.0.6.0.20061020144725.01ab5f30@pop3.geo.uu.nl>
References: <6.1.0.6.0.20061020144725.01ab5f30@pop3.geo.uu.nl>
Message-ID: <453E86CB.4080408@geo.uu.nl>

Paul, please note that at least 5 R packages calculate variograms, and 
not everyone can see from your email address which one you are using 
(gstat).

plot is a generic method; to find which instance is called try

class(plot(rad_data_vgm,rad_data_mod$sph))
[1] "trellis"

so the plot returns is actually a trellis object; the default action on 
returned objects is to print it, using the print.trellis function. Read 
its help,

library(lattice)
?print.trellis

to find out how to arrange multiple trellis objects on a single page. 
Trellis objects don't obey layout().

More likely you don't want separate plots but rather a single trellis 
object; you may want to work along these lines:

library(gstat)
g = gstat(formula = log(zinc)~1, data = meuse)
g = gstat(g, formula = log(zinc)~1, data = meuse) # define it twice
v = variogram(log(zinc)~1,meuse)
vgm1 = fit.variogram(v,vgm(1, "Sph", 900,1))
vgm2 = fit.variogram(v,vgm(1, "Exp", 300,1))
plot(variogram(g,cross=F),layout=c(1,2),model=list(var1=vgm1,var2=vgm2))
--
Edzer


Paul Hiemstra wrote:
> Dear All,
>
> I want to make a plot that compares several different models fitted to the 
> same experimental variogram.
>
> # Try different models
> rad_data_mod$sph = fit.variogram(rad_data_vgm,vgm(psill=60,model="Sph", 
> range=40e3,nugget=5))
> rad_data_mod$exp = fit.variogram(rad_data_vgm,vgm(psill=60,model="Exp", 
> range=40e3,nugget=5))
> rad_data_mod$gau = fit.variogram(rad_data_vgm,vgm(psill=60,model="Gau", 
> range=40e3,nugget=5))
>
> Then I use layout to divide the plotting area into 4 different areas:
>
> layout(matrix(c(1,2,3,4),2,2,byrow=TRUE), TRUE)
>
> Now I want to fill the plot area by calling the plot() command three times.
>
> plot(rad_data_vgm,rad_data_mod$sph)
> plot(rad_data_vgm,rad_data_mod$exp)
> plot(rad_data_vgm,rad_data_mod$gau)
>
> I expected that the sub-areas would be filled with the three plots. But the 
> variogram plot fills the entire plot area and not just the small sub-area. 
> A test function:
>
> x = seq(1:1000)
> y = x^2
> plot(x,y)
> plot(x,y)
> plot(x,y)
>
> performed as expected producing one plot with four subplots.
>
> Does anybody know how to make such a trellis plot for variogram plots?
>
> kind regards,
>
> Paul Hiemstra 
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From calenge at biomserv.univ-lyon1.fr  Wed Oct 25 08:51:31 2006
From: calenge at biomserv.univ-lyon1.fr (=?ISO-8859-1?Q?Cl=E9ment_Calenge?=)
Date: Wed, 25 Oct 2006 08:51:31 +0200
Subject: [R-sig-Geo] adehabitat
In-Reply-To: <453E69BE.7060104@sclc.ecosur.mx>
References: <mailman.17.1161684006.19058.r-sig-geo@stat.math.ethz.ch>
	<453E69BE.7060104@sclc.ecosur.mx>
Message-ID: <453F0973.1030606@biomserv.univ-lyon1.fr>

Dear Duncan,

> This was a useful comment as I was doing something similar at the same 
> time as Milton. I thought it worth mentioning that I found that when 
> using sp0.9-2 I needed to fix the function spixdf2kasc in order to get 
> sp data into the adehabitat kasc format.
>
> The line that reads  ka <- as.data.frame(attr(sg at data, "att"))
>
> should be changed to
>
> ka <- sg at data
>   
Many thanks for this comment. This will be included in the next version 
which will be uploaded on CRAN before the end of the week.
Best wishes,

Cl?ment CALENGE
-- 
======================================
Cl?ment CALENGE
LBBE - UMR CNRS 5558 - Universit? Claude Bernard Lyon 1 - FRANCE
tel. (+33) 04.72.43.27.57
fax. (+33) 04.72.43.13.88



From Roger.Bivand at nhh.no  Wed Oct 25 08:59:51 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 25 Oct 2006 08:59:51 +0200 (CEST)
Subject: [R-sig-Geo] adehabitat
In-Reply-To: <453F0973.1030606@biomserv.univ-lyon1.fr>
Message-ID: <Pine.LNX.4.44.0610250856560.24913-100000@reclus.nhh.no>

On Wed, 25 Oct 2006, Cl?ment Calenge wrote:

> Dear Duncan,
> 
> > This was a useful comment as I was doing something similar at the same 
> > time as Milton. I thought it worth mentioning that I found that when 
> > using sp0.9-2 I needed to fix the function spixdf2kasc in order to get 
> > sp data into the adehabitat kasc format.
> >
> > The line that reads  ka <- as.data.frame(attr(sg at data, "att"))
> >
> > should be changed to
> >
> > ka <- sg at data

Please try:

ka <- as(sg, "data.frame")

Indeed, it ought to have been that before, then the 2.3.*/2.4.* change in 
how S4 classes are represented would have been hidden. Using coercion and 
access methods is much more robust than grabbing internal bits of objects 
(which are subject to change). 

Roger

> >   
> Many thanks for this comment. This will be included in the next version 
> which will be uploaded on CRAN before the end of the week.
> Best wishes,
> 
> Cl?ment CALENGE
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From p.hiemstra at geo.uu.nl  Wed Oct 25 15:32:04 2006
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 25 Oct 2006 15:32:04 +0200
Subject: [R-sig-Geo] Variogram does not plot correctly when using
 layout()
In-Reply-To: <453E86CB.4080408@geo.uu.nl>
References: <6.1.0.6.0.20061020144725.01ab5f30@pop3.geo.uu.nl>
	<453E86CB.4080408@geo.uu.nl>
Message-ID: <6.1.0.6.0.20061025152125.01aeaea0@pop3.geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061025/0edceb31/attachment.pl>

From borghor at yahoo.ca  Wed Oct 25 16:30:15 2006
From: borghor at yahoo.ca (bertrand toupin)
Date: Wed, 25 Oct 2006 10:30:15 -0400 (EDT)
Subject: [R-sig-Geo] Surface Maps
Message-ID: <20061025143015.15290.qmail@web42207.mail.scd.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061025/ef365976/attachment.pl>

From A.Lam at geo.uu.nl  Wed Oct 25 18:12:53 2006
From: A.Lam at geo.uu.nl (Arien Lam)
Date: Wed, 25 Oct 2006 18:12:53 +0200
Subject: [R-sig-Geo] Surface Maps
In-Reply-To: <20061025143015.15290.qmail@web42207.mail.scd.yahoo.com>
References: <20061025143015.15290.qmail@web42207.mail.scd.yahoo.com>
Message-ID: <453F8D05.8010402@geo.uu.nl>


bertrand toupin wrote:
> Hi everyone,
> 
> I'm trying to do a surface map like this one :
> 
> http://img63.imageshack.us/my.php?image=terreeu4.jpg

That looks like a plot of gridded data that you could 
produce with spplot() in package sp.

> 
> Of course, my domain is smaller :)
> 
> My entry are like that (polar stereographic grid from a numerical model):
> 
> lat    long    Data
> 40    -77.0    24.0        
> 42     -77.2    23.0
> 41    -76.0     22.5
This doesn't look like a grid, and it also doesn't look like 
projected, but it does look like spatial points in latlon 
and you can plot them with spplot().
If these spatial points are gridcell centers, you can define 
their representative area as a grid or as polygons (given 
the parameters of the projection and the numerical model) 
and you can plot those with spplot(), or you can interpolate 
these point data to a regular grid and then plot the grid 
(with spplot()).

Hope this helps,
Arien
> 
> So, i have about 58 pts on a 2? x 1? window in the North-Eastern US and the entry are unsorted and it's not a regular grid when I plot my points on a map.
> 
> I tried help.search("surface map"), but I found nothing.  It's probably in a package i still don't have.
> 
> Thanks for any help again! 
> 
>  		
> ---------------------------------
> 
> ---------------------------------
> Get a sneak peak at messages with a handy reading pane.
> 	[[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
H.A. (Arien) Lam (Ph.D. student)
Department of Physical Geography
Faculty of Geosciences
Utrecht University, The Netherlands



From Roger.Bivand at nhh.no  Wed Oct 25 18:59:42 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 25 Oct 2006 18:59:42 +0200 (CEST)
Subject: [R-sig-Geo] Surface Maps
In-Reply-To: <453F8D05.8010402@geo.uu.nl>
Message-ID: <Pine.LNX.4.44.0610251855310.28949-100000@reclus.nhh.no>

On Wed, 25 Oct 2006, Arien Lam wrote:

> 
> bertrand toupin wrote:
> > Hi everyone,
> > 
> > I'm trying to do a surface map like this one :
> > 
> > http://img63.imageshack.us/my.php?image=terreeu4.jpg
> 
> That looks like a plot of gridded data that you could 
> produce with spplot() in package sp.
> 
> > 
> > Of course, my domain is smaller :)
> > 
> > My entry are like that (polar stereographic grid from a numerical model):
> > 
> > lat    long    Data
> > 40    -77.0    24.0        
> > 42     -77.2    23.0
> > 41    -76.0     22.5
> This doesn't look like a grid, and it also doesn't look like 
> projected, but it does look like spatial points in latlon 
> and you can plot them with spplot().
> If these spatial points are gridcell centers, you can define 
> their representative area as a grid or as polygons (given 
> the parameters of the projection and the numerical model) 
> and you can plot those with spplot(), or you can interpolate 
> these point data to a regular grid and then plot the grid 
> (with spplot()).

Typical advice is to interpolate using splines, for example interp() in 
the akima package, Tps in the fields package, or you may like to try out 
this new package:

The new Multilevel B-spline Approximation (MBA) R package fits B-spline 
surfaces to bivariate scattered data. The mba.surf function is similar 
to Akima's interp function, but provides improved surface fit 
characteristics, efficiency for large datasets, and extended 
functionality. Additional package information is available on CRAN and 
http://blue.fr.umn.edu/MBA

just on CRAN from Andrew Finley.

Of course, interpolation is about creating data where you don't have any, 
so no single solution is best for all data sets. If you want to display 
the output using spplot, you'll need to get the output into at least a 
SpatialPixelsDataFrame object.

Roger

> 
> Hope this helps,
> Arien
> > 
> > So, i have about 58 pts on a 2? x 1? window in the North-Eastern US and the entry are unsorted and it's not a regular grid when I plot my points on a map.
> > 
> > I tried help.search("surface map"), but I found nothing.  It's probably in a package i still don't have.
> > 
> > Thanks for any help again! 
> > 
> >  		
> > ---------------------------------
> > 
> > ---------------------------------
> > Get a sneak peak at messages with a handy reading pane.
> > 	[[alternative HTML version deleted]]
> > 
> > 
> > 
> > ------------------------------------------------------------------------
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dgoliche at sclc.ecosur.mx  Fri Oct 27 17:02:57 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Fri, 27 Oct 2006 10:02:57 -0500
Subject: [R-sig-Geo] converting old sp objects
Message-ID: <45421FA1.8020803@sclc.ecosur.mx>

I have quite a number of SpatialGridDataFrame objects that were saved 
internally under R 2.3.0 and sp0.8-16.  Can anyone suggest a quick and 
easy way to convert them for use with R2.4.0 and sp0.9-2. (I do have 
ways, but they are all a bit longwinded).

Thanks,

Duncan

-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher



From Roger.Bivand at nhh.no  Fri Oct 27 18:22:54 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 27 Oct 2006 18:22:54 +0200 (CEST)
Subject: [R-sig-Geo] converting old sp objects
In-Reply-To: <45421FA1.8020803@sclc.ecosur.mx>
Message-ID: <Pine.LNX.4.44.0610271811350.31004-100000@reclus.nhh.no>

On Fri, 27 Oct 2006, Duncan Golicher wrote:

> I have quite a number of SpatialGridDataFrame objects that were saved 
> internally under R 2.3.0 and sp0.8-16.  Can anyone suggest a quick and 
> easy way to convert them for use with R2.4.0 and sp0.9-2. (I do have 
> ways, but they are all a bit longwinded).

The issue was announced on this list on 28 September:

https://stat.ethz.ch/pipermail/r-sig-geo/2006-September/001354.html

and has been on the Rgeo site since about the same time.

The major issue is that the way new-style classes (and objects belonging 
to those classes) are defined internally, so the internal (*.RData) 
representations are not compatible.

To transfer from the old internal form, use R < 2.4.0, and sp < 0.9 to for 
example export column by column to GRASS, and then read back in in R >= 
2.4.0 and sp >= 0.9. Alternatively for non-GRASS users, rgdal and the 
GTiff fotmat could be used (and should work with multiple bands). The 
writeAsciiGrid() function in maptools could also be used. There is no way 
of upgrading the serialised object from the *.RData form directly. 

We know that this is an unfortunate incompatibility, but the changes in 
the methods package are being made to improve class/object handling, 
making the software faster and more robust, so the difficulties are 
unavoidable. For critical projects already using R < 2.4.0, I suggest only 
upgrading when sensible.

Roger

> 
> Thanks,
> 
> Duncan
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dgoliche at sclc.ecosur.mx  Fri Oct 27 18:49:06 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Fri, 27 Oct 2006 11:49:06 -0500
Subject: [R-sig-Geo] converting old sp objects
In-Reply-To: <Pine.LNX.4.44.0610271811350.31004-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0610271811350.31004-100000@reclus.nhh.no>
Message-ID: <45423882.6060107@sclc.ecosur.mx>

Thanks. No problem, I use GRASS and was converting them using rgrass6. I 
just hoped there was an even simpler way. I had missed the posting on 
the change, but realised more or less what was going on a few days ago 
when I upgraded.

Duncan

Roger Bivand wrote:

>On Fri, 27 Oct 2006, Duncan Golicher wrote:
>
>  
>
>>I have quite a number of SpatialGridDataFrame objects that were saved 
>>internally under R 2.3.0 and sp0.8-16.  Can anyone suggest a quick and 
>>easy way to convert them for use with R2.4.0 and sp0.9-2. (I do have 
>>ways, but they are all a bit longwinded).
>>    
>>
>
>The issue was announced on this list on 28 September:
>
>https://stat.ethz.ch/pipermail/r-sig-geo/2006-September/001354.html
>
>and has been on the Rgeo site since about the same time.
>
>The major issue is that the way new-style classes (and objects belonging 
>to those classes) are defined internally, so the internal (*.RData) 
>representations are not compatible.
>
>To transfer from the old internal form, use R < 2.4.0, and sp < 0.9 to for 
>example export column by column to GRASS, and then read back in in R >= 
>2.4.0 and sp >= 0.9. Alternatively for non-GRASS users, rgdal and the 
>GTiff fotmat could be used (and should work with multiple bands). The 
>writeAsciiGrid() function in maptools could also be used. There is no way 
>of upgrading the serialised object from the *.RData form directly. 
>
>We know that this is an unfortunate incompatibility, but the changes in 
>the methods package are being made to improve class/object handling, 
>making the software faster and more robust, so the difficulties are 
>unavoidable. For critical projects already using R < 2.4.0, I suggest only 
>upgrading when sensible.
>
>Roger
>
>  
>
>>Thanks,
>>
>>Duncan
>>
>>
>>    
>>
>
>  
>


-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher



From marco.helbich at gmx.at  Sat Oct 28 18:10:42 2006
From: marco.helbich at gmx.at (Marco Helbich)
Date: Sat, 28 Oct 2006 18:10:42 +0200
Subject: [R-sig-Geo] illustrate kernel density estimation as wireframe
Message-ID: <000d01c6faab$9e777ba0$0300a8c0@mirk>

hello,

how can i illustrate a kernel density estimation as an perspective plot or 
wireframe? enclosed you can find an kde example-code...

library(splancs)
data(uganda)
plot(uganda$poly, type = "n", xlab = "x", ylab = "y", main = "Bsp KDE: 
Craters in Uganda")
polygon(uganda$poly)
points(uganda)
events <- as.points(uganda$x, uganda$y)
kde <- kernel2d(events, uganda$poly, h0 = 200, 500, 500, kernel="quartic")
image(kde, add = TRUE)
polygon(uganda$poly)
points(uganda)

thanks for reply and best regards
marco



From stratja at auburn.edu  Sat Oct 28 21:06:39 2006
From: stratja at auburn.edu (Jeffrey Stratford)
Date: Sat, 28 Oct 2006 14:06:39 -0500
Subject: [R-sig-Geo] incorporating spatial autocorrelation (getting started)
Message-ID: <454363F0020000F200017968@TMIA1.AUBURN.EDU>

Hi.  I would like to incorporate spatial autocorreation into some
ecological models and I'm overwhelmed by the number of programs out
there and I would appreciate some advice where I can get started (and
maybe finish!).

The study: I surveyed birds along roads every 0.8 km and each point was
georeferenced.  I clipped buffers from satellite imagery to quantify the
proportion of cover around each point (radii of buffers = 90, 210, 990
m).  I submitted a paper where I linked the number of species at a point
to land use variables but this manuscript was rejected because I did not
incorporate spatial autocorrelation.  I'm unfamiliar with spatial
statistics so I'll be reading Cressie and others but I would like to
start tinkering with the data and methods. 

Many thanks,

Jeff



****************************************
Jeffrey A. Stratford, Ph.D.
Postdoctoral Associate
331 Funchess Hall
Department of Biological Sciences
Auburn University
Auburn, AL 36849
334-329-9198
FAX 334-844-9234
http://www.auburn.edu/~stratja



From mihainica at yahoo.com  Sat Oct 28 21:52:23 2006
From: mihainica at yahoo.com (Mihai Nica)
Date: Sat, 28 Oct 2006 12:52:23 -0700 (PDT)
Subject: [R-sig-Geo] incorporating spatial autocorrelation (getting
	started)
Message-ID: <20061028195223.7191.qmail@web50803.mail.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061028/3ee019ca/attachment.pl>

From tkobayas at indiana.edu  Mon Oct 30 01:45:16 2006
From: tkobayas at indiana.edu (Takatsugu Kobayashi)
Date: Sun, 29 Oct 2006 19:45:16 -0500
Subject: [R-sig-Geo] geographically weighted negative binomial
	regression model?
Message-ID: <45454B1C.2050909@indiana.edu>

Hi,

I wonder if anyone know whether there is a R package for implementing a 
geographically weighted negative binomial regression model.
Or is it possible to do this model by using a mgcv package with a family 
= negative.binomial?
I am not sure how to determine the adaptive bandwidth in a gam 
package...... Does anyone out there kindly help?


Thanks in advance.

Taka kobayashi
Indiana Univeristy Bloomington
PhD student



From philjking at verizon.net  Mon Oct 30 11:46:53 2006
From: philjking at verizon.net (Phil J King)
Date: Mon, 30 Oct 2006 02:46:53 -0800
Subject: [R-sig-Geo] 'sp' for 3.2.1
Message-ID: <4545D81D.3030406@verizon.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061030/c81978eb/attachment.pl>

From Roger.Bivand at nhh.no  Mon Oct 30 11:59:59 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Oct 2006 11:59:59 +0100 (CET)
Subject: [R-sig-Geo] 'sp' for 3.2.1
In-Reply-To: <4545D81D.3030406@verizon.net>
Message-ID: <Pine.LNX.4.44.0610301155310.30407-100000@reclus.nhh.no>

On Mon, 30 Oct 2006, Phil J King wrote:

> Good Day,
> I have just loaded R base and an assistant program, "RKWard", onto my
> computer only to find that my version is two weeks too old to load the
> 'sp' file from 'CRAN'. The 'R' version is 2.3.1 and I am wondering where
> I might get an older version of 'sp' to run with it. Are there other
> repositories other than CRAN that supply for older versions of 'R'?

For which OS/platform? All source packages are archived on CRAN:

http://cran.r-project.org/src/contrib/Archive

and binary packages from CRAN (Windows, various Mac OSX) are in versioned 
directory trees, so R 2.3.1 will choose the 2.3 directory for the latest 
version of the package compatible with it.

If a source package, download sp < 0.9 manually from the Archive, and 
install manually (R CMD INSTALL sp*.tar.gz).

Roger


> Thanks,
> Phil
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From B.Rowlingson at lancaster.ac.uk  Mon Oct 30 12:43:50 2006
From: B.Rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 30 Oct 2006 11:43:50 +0000
Subject: [R-sig-Geo] 'sp' for 3.2.1
In-Reply-To: <Pine.LNX.4.44.0610301155310.30407-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0610301155310.30407-100000@reclus.nhh.no>
Message-ID: <4545E576.8010307@lancaster.ac.uk>

Roger Bivand wrote:

> 
> For which OS/platform? All source packages are archived on CRAN:
> 
> http://cran.r-project.org/src/contrib/Archive
> 
> and binary packages from CRAN (Windows, various Mac OSX) are in versioned 
> directory trees, so R 2.3.1 will choose the 2.3 directory for the latest 
> version of the package compatible with it.
> 

  Do you have to tell install.packages() about this, because with R 
2.3.0 I get:

  > install.packages("sp",lib="~/Rlibs")
  Warning in download.packages(pkgs, destdir = tmpd, available = 
available,  :
          no package 'sp' at the repositories

Barry



From Roger.Bivand at nhh.no  Mon Oct 30 13:24:13 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Oct 2006 13:24:13 +0100 (CET)
Subject: [R-sig-Geo] 'sp' for 3.2.1
In-Reply-To: <4545E576.8010307@lancaster.ac.uk>
Message-ID: <Pine.LNX.4.44.0610301315440.30407-100000@reclus.nhh.no>

On Mon, 30 Oct 2006, Barry Rowlingson wrote:

> Roger Bivand wrote:
> 
> > 
> > For which OS/platform? All source packages are archived on CRAN:
> > 
> > http://cran.r-project.org/src/contrib/Archive
> > 
> > and binary packages from CRAN (Windows, various Mac OSX) are in versioned 
> > directory trees, so R 2.3.1 will choose the 2.3 directory for the latest 
> > version of the package compatible with it.
> > 
> 
>   Do you have to tell install.packages() about this, because with R 
> 2.3.0 I get:
> 
>   > install.packages("sp",lib="~/Rlibs")
>   Warning in download.packages(pkgs, destdir = tmpd, available = 
> available,  :
>           no package 'sp' at the repositories

I do not think that install.packages() can handle this itself. It looks as 
though a combination of download.file() and install.packages() as shown in 
its example could do it (with repos=NULL), but the url in the Archives 
would have to be chosen by hand.

Roger

> 
> Barry
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dgoliche at sclc.ecosur.mx  Mon Oct 30 17:09:49 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Mon, 30 Oct 2006 10:09:49 -0600
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges
Message-ID: <454623CD.6000106@sclc.ecosur.mx>

I have a follow up question regarding moving old (R <2.4) sp objects to 
R 2.4. It is indeed easy using GRASS as an intermediary with spgrass6. 
But one of my students has installed GRASS with the QGIS interface 
rather than running GRASS under Cygwin. He wanted to do the same.

I tried with him and quickly got R to communicate with GRASS by simply 
changing the first lines of system to read .....

function (command, intern = FALSE, wait = TRUE, input = NULL,
    show.output.on.console = TRUE, minimized = FALSE, invisible = FALSE)
{
command<-paste(Sys.getenv("COMSPEC"),"/c",command)

etc}

But we still couldn't get spgrass6 to import and export raster layers 
even after fiddling with the code to get rid of cygpath etc. Perhaps 
Roger has a fix? It would be useful.

Also while posting, can anyone suggest a way of measuring the closest 
distance between disjunct polygons in R (forest fragments)? Its easy to 
use centroids in spdep, but we were interested in the distances between 
the edges.

Duncan


-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher



From colinr23 at gmail.com  Mon Oct 30 17:58:59 2006
From: colinr23 at gmail.com (Colin Robertson)
Date: Mon, 30 Oct 2006 08:58:59 -0800
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges
In-Reply-To: <454623CD.6000106@sclc.ecosur.mx>
Message-ID: <000f01c6fc44$b2d88db0$4efa4418@PC>

Hi Duncan,

For calculating the distance between polygons, there are descriptions of
the calculations for average distance and minimum distance in the
reference below.  Although I'm not sure if they're implemented in any R
packages.

Okabe, A. and Miller, H. J. (1996) "Exact computational methods for
calculating distances between objects in a cartographic database,"
Cartography and Geographic Information Systems, 23, 180-195.


Colin


Colin Robertson
MSc Candidate
Dept of Geography
University of Victoria
www.geog.uvic.ca/spar
(250) 885-8065
 

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Duncan
Golicher
Sent: Monday, October 30, 2006 8:10 AM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges

I have a follow up question regarding moving old (R <2.4) sp objects to 
R 2.4. It is indeed easy using GRASS as an intermediary with spgrass6. 
But one of my students has installed GRASS with the QGIS interface 
rather than running GRASS under Cygwin. He wanted to do the same.

I tried with him and quickly got R to communicate with GRASS by simply 
changing the first lines of system to read .....

function (command, intern = FALSE, wait = TRUE, input = NULL,
    show.output.on.console = TRUE, minimized = FALSE, invisible = FALSE)
{
command<-paste(Sys.getenv("COMSPEC"),"/c",command)

etc}

But we still couldn't get spgrass6 to import and export raster layers 
even after fiddling with the code to get rid of cygpath etc. Perhaps 
Roger has a fix? It would be useful.

Also while posting, can anyone suggest a way of measuring the closest 
distance between disjunct polygons in R (forest fragments)? Its easy to 
use centroids in spdep, but we were interested in the distances between 
the edges.

Duncan


-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From White.Denis at epamail.epa.gov  Mon Oct 30 17:55:36 2006
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Mon, 30 Oct 2006 08:55:36 -0800
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges
In-Reply-To: <454623CD.6000106@sclc.ecosur.mx>
Message-ID: <OF6FACDFA2.6BD8803D-ON88257217.005BE02D-88257217.005CFAD7@epamail.epa.gov>

Duncan Golicher <dgoliche at sclc.ecosur.mx> wrote on 2006-10-30 08:09:49:

> ...
>
> Also while posting, can anyone suggest a way of measuring the closest
> distance between disjunct polygons in R (forest fragments)? Its easy
to
> use centroids in spdep, but we were interested in the distances
between
> the edges.
>
> Duncan

For many polygons each having possibly many points defining the edges,
it's a time consuming search.  I am not aware of any GIS software or R
packages that do this comprehensively.  One alternative is to use
buffering by some set of fixed distances.  Or, write a program/function
to do the search:  for each polygon, find the minimum distance between
all of its vertices and all of the vertices of each other polygon.
However, this algorithm does not work well with two polygons like this:

|---------------------|
|                     |
|---------------------|

           /\
          /  \
         /____\

A buffering approach would do better.

Denis



From b.rowlingson at lancaster.ac.uk  Mon Oct 30 18:22:14 2006
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 30 Oct 2006 17:22:14 +0000
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges
In-Reply-To: <OF6FACDFA2.6BD8803D-ON88257217.005BE02D-88257217.005CFAD7@epamail.epa.gov>
References: <OF6FACDFA2.6BD8803D-ON88257217.005BE02D-88257217.005CFAD7@epamail.epa.gov>
Message-ID: <454634C6.6060500@lancaster.ac.uk>


> For many polygons each having possibly many points defining the edges,
> it's a time consuming search.  I am not aware of any GIS software or R
> packages that do this comprehensively.  One alternative is to use
> buffering by some set of fixed distances.  Or, write a program/function
> to do the search:  for each polygon, find the minimum distance between
> all of its vertices and all of the vertices of each other polygon.
> However, this algorithm does not work well with two polygons like this:
> 
> |---------------------|
> |                     |
> |---------------------|
> 
>            /\
>           /  \
>          /____\
> 
> A buffering approach would do better.

I think if you compute the minimum distances from each vertex of polygon 
A to each segment of polygon B, then do the same for each vertex of 
polygon B to each segment of polygon A you should get the exact answer. 
At least, for non-overlapping polygons. This is because you cant arrange 
two non-intersecting line segments such that their closest approach 
isn't at one of the four ends. For any point within one of the line 
segments, going one way along the line must get you either closer or 
further to the other line segment. I think thats intuitively obvious now 
I've intuited it enough times...

To find the nearest point-line segment, parameterise the line segment so 
the ends are at p=0 and 1, do a bit of vector math, work out the p for 
the closest point, if 0<p then p=0, and p>1 then p=1, work out the 
distance from your vertex to the point p. Keep the minimum.

  You have to repeat with B's vertices against A's segments since in the 
rectangle-triangle case either could be A or B and the nearest point is 
where the triangle's vertex is close to the rectangles segment.

  It doesnt work for overlapping polygons since the nearest approach of 
two overlapping line segments is partway between the segments. But its 
fairly easy to detect overlapping line segments in one go and then 
distance=0.

  Barry



From dgoliche at sclc.ecosur.mx  Mon Oct 30 18:32:14 2006
From: dgoliche at sclc.ecosur.mx (Duncan Golicher)
Date: Mon, 30 Oct 2006 11:32:14 -0600
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges
In-Reply-To: <OF6FACDFA2.6BD8803D-ON88257217.005BE02D-88257217.005CFAD7@epam
	ail.epa.gov>
References: <OF6FACDFA2.6BD8803D-ON88257217.005BE02D-88257217.005CFAD7@epama
	il.epa.gov>
Message-ID: <4546371E.8080907@sclc.ecosur.mx>

White.Denis at epamail.epa.gov wrote:

> Or, write a program/function
>to do the search:  for each polygon, find the minimum distance between
>all of its vertices and all of the vertices of each other polygon.
>  
>
I thought of that, but was too lazy to start doing it.

>However, this algorithm does not work well with two polygons like this:
>
>|---------------------|
>|                     |
>|---------------------|
>
>           /\
>          /  \
>         /____\
>  
>
Indeed.

>A buffering approach would do better.
>
>Denis
>
>  
>
Thanks for this Dennis.  I found morphology in adehabitat does what we 
needed through erosion or dilation. Good to know that there isn't 
another simple way that we overlooked.

Duncan

-- 
Dr Duncan Golicher
Ecologia y Sistematica Terrestre
Conservaci?n de la Biodiversidad
El Colegio de la Frontera Sur
San Cristobal de Las Casas, 
Chiapas, Mexico

Email: dgoliche at sclc.ecosur.mx 

Tel: 967 674 9000 ext 1310
Fax: 967 678 2322

United Kingdom Skypein; 020 7870 6251
Skype name: duncangolicher



From milton_ruser at yahoo.com.br  Mon Oct 30 19:13:09 2006
From: milton_ruser at yahoo.com.br (Milton Cezar Ribeiro)
Date: Mon, 30 Oct 2006 15:13:09 -0300 (ART)
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges
In-Reply-To: <000f01c6fc44$b2d88db0$4efa4418@PC>
Message-ID: <20061030181309.75737.qmail@web57909.mail.re3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061030/ee518174/attachment.pl>

From Roger.Bivand at nhh.no  Mon Oct 30 21:45:53 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Oct 2006 21:45:53 +0100 (CET)
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges
In-Reply-To: <454623CD.6000106@sclc.ecosur.mx>
Message-ID: <Pine.LNX.4.44.0610302058590.30407-100000@reclus.nhh.no>

On Mon, 30 Oct 2006, Duncan Golicher wrote:

> I have a follow up question regarding moving old (R <2.4) sp objects to 
> R 2.4. It is indeed easy using GRASS as an intermediary with spgrass6. 
> But one of my students has installed GRASS with the QGIS interface 
> rather than running GRASS under Cygwin. He wanted to do the same.
> 
> I tried with him and quickly got R to communicate with GRASS by simply 
> changing the first lines of system to read .....
> 
> function (command, intern = FALSE, wait = TRUE, input = NULL,
>     show.output.on.console = TRUE, minimized = FALSE, invisible = FALSE)
> {
> command<-paste(Sys.getenv("COMSPEC"),"/c",command)
> 
> etc}
> 
> But we still couldn't get spgrass6 to import and export raster layers 
> even after fiddling with the code to get rid of cygpath etc. Perhaps 
> Roger has a fix? It would be useful.

I do not have a stable working version of the winGRASS port (the one 
packaged with QGIS), and since it is described on the GRASS-dev list as at 
best pre-alpha, will not try it soon.

Since it does come with the circular GDAL plugin fix, you should be able 
to read the GRASS rasters using the GRASS driver in readGDAL() in rgdal, 
and maybe vectors too. Of course, the driver is read-only, but it ought to 
work.

As far as spgrass6 is concerned, GRASS on Windows runs under cygwin. The 
number of different GRASS releases in the wild is now substantial, and 
even just keeping the Unix/Linux and cygwin ones working and maintainable 
is not easy. 

If you have usable patches that don't break anything else (cygwin), I 
would be interested, but something will have to let Rwin know how to 
branch to native winGRASS rather than cygwin.

Roger

> 
> Also while posting, can anyone suggest a way of measuring the closest 
> distance between disjunct polygons in R (forest fragments)? Its easy to 
> use centroids in spdep, but we were interested in the distances between 
> the edges.
> 

PS. There is a good deal of vector computational geometry in spatstat, 
often in the internal functions. For example, ?distpl brings up a list 
with many useful possibilities.


> Duncan
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon Oct 30 21:54:53 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Oct 2006 21:54:53 +0100 (CET)
Subject: [R-sig-Geo] geographically weighted negative binomial
 regression model?
In-Reply-To: <45454B1C.2050909@indiana.edu>
Message-ID: <Pine.LNX.4.44.0610302151030.30407-100000@reclus.nhh.no>

On Sun, 29 Oct 2006, Takatsugu Kobayashi wrote:

> Hi,
> 
> I wonder if anyone know whether there is a R package for implementing a 
> geographically weighted negative binomial regression model.

Not as far as I'm aware. There is draft ggwr() not yet released, which 
could possibly be extended, but you would be on untested ground - as is 
ggwr() anyway.

> Or is it possible to do this model by using a mgcv package with a family 
> = negative.binomial?
> I am not sure how to determine the adaptive bandwidth in a gam 
> package...... Does anyone out there kindly help?
> 

You could try fixing the other variables and letting gam() choose the 
"bandwidths" for s(x,y) by CV, if you like, but the "bandwidths" are not 
directly comparable with ggwr() bandwidths.

Roger

> 
> Thanks in advance.
> 
> Taka kobayashi
> Indiana Univeristy Bloomington
> PhD student
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From milton_ruser at yahoo.com.br  Tue Oct 31 02:52:14 2006
From: milton_ruser at yahoo.com.br (Milton Cezar Ribeiro)
Date: Mon, 30 Oct 2006 22:52:14 -0300 (ART)
Subject: [R-sig-Geo] GRASS with R and distances between polygon edges
Message-ID: <20061031015214.83289.qmail@web57913.mail.re3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20061030/85241472/attachment.pl>

