From hariom.cs1 at gmail.com  Wed Apr  1 07:52:50 2015
From: hariom.cs1 at gmail.com (hariom)
Date: Tue, 31 Mar 2015 22:52:50 -0700 (MST)
Subject: [R-sig-Geo] customized focal mean
In-Reply-To: <1426138645618-7587890.post@n2.nabble.com>
References: <1426138645618-7587890.post@n2.nabble.com>
Message-ID: <1427867570397-7587995.post@n2.nabble.com>

Hello,

Thanks for your reply...

I am new in R programming and I have tried this code but no success.

library(raster)
seq1 <- seq(1:16)
x <- matrix(seq1, 4)
rc2 <- raster(x)

u1 <- matrix(1,3,3)

# apply the function to a 3x3 moving window
aggr <- as.matrix(focal(rc2, w=u1, fun=mean,na.rm=TRUE))

c <- raster(aggr)
spplot(c)

It is calculating by default mean but I need as I have already described.
Where I need to customize the code so that I could get my result. Kindly
help me to customize this type of mean I would appreciate for your time and
concern.





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/customized-focal-mean-tp7587890p7587995.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From holtermann at hwwi.org  Wed Apr  1 14:19:22 2015
From: holtermann at hwwi.org (Linus Holtermann)
Date: Wed, 1 Apr 2015 12:19:22 +0000
Subject: [R-sig-Geo] Spatial Panel and robust standard errors
Message-ID: <11896b8be27b42408b178826007af301@winhexbeeu15.win.mail>

Hello,

I used the spml function in the splm-package to estimate a SAR panel model. Is it possible to get HC or HAC robust standard errors for these types of panel models in R?
I tried coeftest and sandwich, but it wont work.

Bets reagrds,

Linus Holtermann
Hamburgisches WeltWirtschaftsInstitut gemeinn?tzige GmbH (HWWI)
Heimhuder Stra?e 71
20148 Hamburg
Tel +49-(0)40-340576-336
Fax+49-(0)40-340576-776
Internet: www.hwwi.org<http://www.hwwi.org/>
Email: holtermann at hwwi.org<mailto:holtermann at hwwi.org>

Amtsgericht Hamburg HRB 94303
Gesch?ftsf?hrer: PD Dr. Christian Growitsch | Prof. Dr. Henning V?pel
Prokura: Dipl. Kauffrau Alexis Malchin
Umsatzsteuer-ID: DE 241849425


	[[alternative HTML version deleted]]


From amit.boshale at yahoo.com  Wed Apr  1 14:38:03 2015
From: amit.boshale at yahoo.com (Amit Boshale)
Date: Wed, 1 Apr 2015 12:38:03 +0000 (UTC)
Subject: [R-sig-Geo] MODIS Whittaker Smoothing multicore support
In-Reply-To: <CAEBQMMnc7ZQ-Aj9mmwDC7O4xcTnpzo56mk_yQL5T8L1UDq=xbQ@mail.gmail.com>
References: <CAEBQMMnc7ZQ-Aj9mmwDC7O4xcTnpzo56mk_yQL5T8L1UDq=xbQ@mail.gmail.com>
Message-ID: <1639345011.4138192.1427891883474.JavaMail.yahoo@mail.yahoo.com>

Hi Forrest, that worked! Thank you so much!I was always getting an error that sendCall function was not found, I just had to load snow package and everything is fine. 
Thanks!Amit







     Forrest Stevens <forrest at ufl.edu> schrieb am 15:26 Dienstag, 31.M?rz 2015:
   

 

Hi Amit, I can provide you with some help to get smoothing working to
leverage multiple cores.? This is already baked into the
whittaker.raster() function of our MODIS package and it makes sense to
use it since the problem is of the "embarrassingly parallel" variety.
To leverage multiple cores you can do something like the following:


#beginCluster(type="SOCK",exclude="MODIS")
##? Alternatively:
nodes <- 4
beginCluster(nodes)
system.time(whittaker.raster(vi=vi, wt=qa, inT=time,
timeInfo=timeInfo, groupYears=FALSE,
outDirPath=paste(root_path,"output/",sep="")))
endCluster()

##? Where vi, qa, time, timeInfo are all arguments you can learn about
in the whittaker.raster() documentation.


Hope this helps!

Sincerely,
Forrest


On Tue, Mar 31, 2015 at 5:33 AM Amit Boshale via R-sig-Geo
<r-sig-geo at r-project.org> wrote:
>
> Dear Matteo,
> Are there any plans to enable multicore in Whittaker smoothing function? I use your MODIS package on regular basis and multicore calculations would make my life easier.
>
> Keep up the great work
> Amit
>? ? ? ? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


  
	[[alternative HTML version deleted]]


From btupper at bigelow.org  Wed Apr  1 14:48:32 2015
From: btupper at bigelow.org (Ben Tupper)
Date: Wed, 1 Apr 2015 08:48:32 -0400
Subject: [R-sig-Geo] Pole centric map with Raster?
In-Reply-To: <5515C83A.8000404@gmail.com>
References: <0DB9402E-968E-4CE8-9448-373184FCEF13@bigelow.org>
	<5515C83A.8000404@gmail.com>
Message-ID: <0790A74C-402C-424D-8FBB-89BBEFF276DC@bigelow.org>

Hello again,

Thanks again for your help - it really gave me the push I needed.  Below is a stripped down version of your script that projects the datasets::volcano matrix over the north pole.  In case it is of some use to others, I have added some notes one what I think is happening.  If you run the script you'll see that I am still fiddling with the graticules (reaching 90N and the one missing at 180).

Thanks also for making me aware of the remote package - that looks really useful.

Cheers and thanks,
Ben



### START
library(raster)
library(rgdal)
library(rgeos)
library(rworldmap)
library(RColorBrewer)

data("coastsCoarse", package = 'rworldmap')
# the crs of coastsCoarse has a leading space, this trims it
crs(coastsCoarse) <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0")

# the desrired projection
ster <- "+proj=stere +lat_0=90 +lon_0=-30" 

# map view limits
xmn <- -180
xmx <- 180
ymn <- 30
ymx <- 90

# create a raster from datasets::volcano
r <- raster::raster(volcano,
    xmn = xmn, xmx = xmx, ymn = ymn, ymx = ymx, 
    crs = "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0")

# if the raster extends into opposite hemisphere it helps to crop it
#r <- crop(b, extent(xmn, xmx, ymn, ymx))

# create a polygon used for trimming the map segments
# bounding box from lower left clockwise
bb <- cbind(x = c(xmn, xmn, xmx, xmx, xmn),
            y = c(ymn, ymx, ymx, ymn, ymn))
# convert to Spatial   
SP <- sp::SpatialPolygons(
   list(sp::Polygons(
      list(sp::Polygon(bb)), "1")),
   proj4string = sp::CRS(sp::proj4string(coastsCoarse))
   )

# compute where map bounding box and map segements overlap
# I think this amounts to cropping the map segments
gI <- rgeos::gIntersects(coastsCoarse, SP, byid = TRUE)
out <- vector(mode = "list", length = length(which(gI)))
ii <- 1
for (i in seq(along = gI)) {
   if (gI[i]) {
      out[[ii]] <- rgeos::gIntersection(coastsCoarse[i, ], SP)
      row.names(out[[ii]]) <- row.names(coastsCoarse)[i]
   ii <- ii + 1
   }
}
nh_coasts <- do.call("rbind", out)

# project the coastline map segments
nh_coasts_ster <- sp::spTransform(nh_coasts, CRS(ster))

# make graticules and project
gr <- sp::gridlines(nh_coasts,
   easts = seq(xmn, xmx, by = 20),
   norths = seq(ymn, ymx, by = 10),
   ndiscr = length(xmn:xmx))
pgr <- sp::spTransform(gr, CRS(ster))

# project the raster volcano data
projr <- projectRaster(r, crs = ster)

# sp.layout elements
lout <- list(
   list("sp.lines", nh_coasts_ster, col = "grey30", grid = TRUE),
   list("sp.lines", pgr, col = 'grey50', lty = 'dashed'))

# pretty colors function from RColorBrewer
clrs <- colorRampPalette(brewer.pal(9, "YlOrRd"))

# compute steps for coloring
data_range <- range(values(projr), na.rm = TRUE)
steps <- 10

polar_map <- sp::spplot(projr, sp.layout = lout,
   col.regions = clrs(steps),
   at = seq(data_range[1], data_range[2], length = steps),
   par.settings = list(axis.line = list(col = 1)),
   colorkey = list(height = 0.75, width = 1))

print(polar_map)

### END



On Mar 27, 2015, at 5:14 PM, Tim Appelhans <tim.appelhans at gmail.com> wrote:

> Ben
> here's some code I used for a paper.
> 
> Is this producing what you want?
> 
> 
> 
> library("remote")
> 
> ###### EXAMPLE I ##########################################################
> ###########################################################################
> library("rworldmap")
> library("rgdal")
> library("rgeos")
> library("gridExtra")
> library("RColorBrewer")
> 
> ## load data
> data("vdendool")
> data("coastsCoarse")
> 
> ## calculate 4 leading modes
> nh_modes <- eot(x = vdendool, y = NULL, n = 4, reduce.both = FALSE,
>                standardised = FALSE, verbose = TRUE)
> 
> ## create coastal outlines
> ster <- CRS("+proj=stere +lat_0=90 +lon_0=-45")
> xmin <- -180
> xmax <- 180
> ymin <- 20
> ymax <- 90     # Coordinates for bounding box
> bb <- cbind(x = c(xmin, xmin, xmax, xmax, xmin),
>            y = c(ymin, ymax, ymax, ymin, ymin))    #Create bounding box
> SP <- SpatialPolygons(list(Polygons(list(Polygon(bb)), "1")),
>                      proj4string = CRS(proj4string(coastsCoarse)))
> 
> gI <- gIntersects(coastsCoarse, SP, byid = TRUE)
> out <- vector(mode = "list", length = length(which(gI)))
> ii <- 1
> 
> for (i in seq(along = gI)) if (gI[i]) {
>  out[[ii]] <- gIntersection(coastsCoarse[i, ], SP)
>  row.names(out[[ii]]) <- row.names(coastsCoarse)[i]
>  ii <- ii + 1
> }
> 
> nh_coasts <- do.call("rbind", out)
> nh_coasts_ster <- spTransform(nh_coasts, ster)
> 
> lout <- list("sp.lines", nh_coasts_ster,
>             col = "grey30", grid = TRUE)
> 
> ## define colours
> clrs <- colorRampPalette(rev(brewer.pal(9, "RdBu")))
> 
> ## project modes to polar stereographic CRS
> mode1 <- projectRaster(nh_modes[[1]]@r_predictor, crs = ster)
> 
> spplot(mode1, sp.layout = lout,
>       col.regions = clrs(1000), at = seq(-1, 1, 0.2),
>       par.settings = list(axis.line = list(col = 0)),
>       colorkey = list(height = 0.75, width = 1))
> 
> 
> Tim
> 
> 
> 
> On 27.03.2015 21:20, Ben Tupper wrote:
>> Hello,
>> 
>> I'm learning how to use Raster* objects and ultimately hope to draw rasters from a (north) polar perspective.  I can do something like this using tiling in ggplot2:
>> 
>> https://dl.dropboxusercontent.com/u/8433654/polar-map-with-matrix.png
>> 
>> 
>> I have hopes of doing similar using raster, sp and lattice.  But I'm drowning in information as neophytes are prone to do.  Below is a self-contained example...  I'm not getting too far.  It creates two plots:
>> 
>> raster without using projectRaster: https://dl.dropboxusercontent.com/u/8433654/raster_no_project.png
>> 
>> raster using projectRaster: https://dl.dropboxusercontent.com/u/8433654/raster_with_project.png
>> 
>> Neither is what I would like.  How does one get the map centered on the pole and draw a (warped) raster using spplot?
>> 
>> Thanks!
>> Ben
>> 
>> 
>> ##### START
>> library(raster)
>> library(maps)
>> library(maptools)
>> library(rgdal)
>> 
>> # create a Raster from 'volcano'
>> my_proj <- "+proj=stere +lat_0=90 +lon_0=-30 +x_0=0 +y_0=0"
>> r <- raster(volcano,
>>    xmn = -90, xmx = 0, ymn = 50, ymx = 85,
>>    crs = my_proj)
>> # class       : RasterLayer
>> # dimensions  : 87, 61, 5307  (nrow, ncol, ncell)
>> # resolution  : 1.47541, 0.4022989  (x, y)
>> # extent      : -90, 0, 50, 85  (xmin, xmax, ymin, ymax)
>> # coord. ref. : +proj=stere +lat_0=90 +lon_0=-30 +x_0=0 +y_0=0 +ellps=WGS84
>> # data source : in memory
>> # names       : layer
>> # values      : 94, 195  (min, max)
>> 
>> pr <- projectRaster(r, crs=my_proj)
>> # class       : RasterLayer
>> # dimensions  : 123, 71, 8733  (nrow, ncol, ncell)
>> # resolution  : 1.48, 0.402  (x, y)
>> # extent      : -97.4, 7.68, 42.79, 92.236  (xmin, xmax, ymin, ymax)
>> # coord. ref. : +proj=stere +lat_0=90 +lon_0=-30 +x_0=0 +y_0=0 +ellps=WGS84
>> # data source : in memory
>> # names       : layer
>> # values      : 93.88372, 194.8761  (min, max)
>> 
>> # create a coastline and transform to the projection
>> mp <- map2SpatialLines(map(plot = FALSE, interior = FALSE), proj4string = CRS(my_proj))
>> mp <- spTransform(mp, CRSobj = CRS(my_proj))
>> # class       : SpatialLines
>> # features    : 2904
>> # extent      : -179.9572, 190.2908, -85.44308, 83.57391  (xmin, xmax, ymin, ymax)
>> # coord. ref. : +proj=stere +lat_0=90 +lon_0=-30 +x_0=0 +y_0=0 +ellps=WGS84
>> 
>> # show the map with the 'unprojected' raster
>> plot_r <- spplot(r,
>>    sp.layout = list( sp.lines, mp, first = FALSE)
>> )
>> 
>> # show the map with the projected raster
>> plot_pr <- spplot(pr,
>>    sp.layout = list( sp.lines, mp, first = FALSE)
>> )
>> 
>> print(plot_r)
>> print(plot_pr)
>> ##### END
>> 
>> 
>> 
>>> sessionInfo()
>> R version 3.1.2 (2014-10-31)
>> Platform: x86_64-apple-darwin13.4.0 (64-bit)
>> 
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
>> other attached packages:
>> [1] rgdal_0.9-2     maptools_0.8-34 maps_2.3-9      raster_2.3-33   sp_1.0-17
>> 
>> loaded via a namespace (and not attached):
>> [1] foreign_0.8-63  grid_3.1.2      lattice_0.20-30 tools_3.1.2
>> 
>> 
>> Ben Tupper
>> Bigelow Laboratory for Ocean Sciences
>> 60 Bigelow Drive, P.O. Box 380
>> East Boothbay, Maine 04544
>> http://www.bigelow.org
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> -- 
> #####################################
> Tim Appelhans
> Department of Geography
> Environmental Informatics
> Philipps Universit?t Marburg
> Deutschhausstra?e 12
> 35032 Marburg (Paketpost: 35037 Marburg)
> Germany
> 
> Tel +49 (0) 6421 28-25957
> 
> http://environmentalinformatics-marburg.de/
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



Ben Tupper
Bigelow Laboratory for Ocean Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org


From robert.t.leaf at gmail.com  Wed Apr  1 16:09:03 2015
From: robert.t.leaf at gmail.com (Robert Leaf)
Date: Wed, 1 Apr 2015 09:09:03 -0500
Subject: [R-sig-Geo] model fitting of randomly generated data in spatstat
Message-ID: <CAEqf7EXzPLbbgZMr3SJCA69KL=vOwAF0JdQqvSY+wuHuxipt3g@mail.gmail.com>

I was generating some data for analysis and was curious to see if we could
fit a ?MatClust? model using the function *spatstat*::kppm to some of our
observed data. As a first cut, and to see if we get values that conform to
our expectations, I fit models to simulated data and was curious about the
results. I am hoping that the group can help me understand the departures
from expecations.

Is it reasonable that the kppm function should return parameters values
that are similar to the those that generated the data?

We are not getting value that are anywhere close to what we would expect.

library(*spatstat*)
(point.vals <- rMatClust(kappa = 2, r = 2, mu = 2000)) # generate random
points

if (point.vals$n > 0) { # some realizations of the model return .ppp
variables of with no data
print(point.vals$n)
plot(point.vals)
kppm(point.vals, ~1, "MatClust") } # stationary MatClust fitting

I am sure that I am missing something here? I would appreciate any input
that group members have to help us with this. Thanks in advance, Robert

	[[alternative HTML version deleted]]


From forrest at ufl.edu  Wed Apr  1 16:11:26 2015
From: forrest at ufl.edu (Forrest Stevens)
Date: Wed, 01 Apr 2015 14:11:26 +0000
Subject: [R-sig-Geo] MODIS Whittaker Smoothing multicore support
In-Reply-To: <1639345011.4138192.1427891883474.JavaMail.yahoo@mail.yahoo.com>
References: <CAEBQMMnc7ZQ-Aj9mmwDC7O4xcTnpzo56mk_yQL5T8L1UDq=xbQ@mail.gmail.com>
	<1639345011.4138192.1427891883474.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CAEBQMMn6d7LQ3osWdWU8889y-+3vyyox_g8-K8MV7zTmL9=_Bw@mail.gmail.com>

Great!  Always glad to help!

Forrest

On Wed, Apr 1, 2015 at 8:38 AM Amit Boshale <amit.boshale at yahoo.com> wrote:

> Hi Forrest, that worked! Thank you so much!
> I was always getting an error that sendCall function was not found, I just
> had to load snow package and everything is fine.
> Thanks!
> Amit
>
>
>
>
>
>
>
>   Forrest Stevens <forrest at ufl.edu> schrieb am 15:26 Dienstag, 31.M?rz
> 2015:
>
>
>
>
> Hi Amit, I can provide you with some help to get smoothing working to
> leverage multiple cores.  This is already baked into the
> whittaker.raster() function of our MODIS package and it makes sense to
> use it since the problem is of the "embarrassingly parallel" variety.
> To leverage multiple cores you can do something like the following:
>
>
> #beginCluster(type="SOCK",exclude="MODIS")
> ##  Alternatively:
> nodes <- 4
> beginCluster(nodes)
> system.time(whittaker.raster(vi=vi, wt=qa, inT=time,
> timeInfo=timeInfo, groupYears=FALSE,
> outDirPath=paste(root_path,"output/",sep="")))
> endCluster()
>
> ##  Where vi, qa, time, timeInfo are all arguments you can learn about
> in the whittaker.raster() documentation.
>
>
> Hope this helps!
>
> Sincerely,
> Forrest
>
>
> On Tue, Mar 31, 2015 at 5:33 AM Amit Boshale via R-sig-Geo
> <r-sig-geo at r-project.org> wrote:
> >
> > Dear Matteo,
> > Are there any plans to enable multicore in Whittaker smoothing function?
> I use your MODIS package on regular basis and multicore calculations would
> make my life easier.
> >
> > Keep up the great work
> > Amit
>
> >        [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>

	[[alternative HTML version deleted]]


From wandrson01 at gmail.com  Wed Apr  1 17:18:56 2015
From: wandrson01 at gmail.com (Walter Anderson)
Date: Wed, 01 Apr 2015 10:18:56 -0500
Subject: [R-sig-Geo] Calculating the length of a line created from a spatial
	intersect.
Message-ID: <551C0C60.30603@gmail.com>

Hello all,

I am continuing on the process of automating an analysis that I
developed with ArcInfo using R with the sp, rgdal, rgeos, and raster
libraries.

This step is similiar to my previous question concerning calculating the
area of a polygon created from a spatial intersect; however, the command
I was referred doesn't perform the merge of the two data frames as it
does when both spatial data sets are polygons.

Here is the process I am using in ArcInfo that I need to replicate:

I have a shape file (lines) that defines the limits of all of the
projects with each project having a unique identifier.

I have another shape file (lines) that represent the road centerlines
and have a traffic volumen associated with each link.

Process
Step 1.
I then buffer these project lines to create a second shape file that
represents the 'footprint' of the project. (Creates polys).  This is a
small footprint (250 ft) that is solely used to associate the
appropriate portion of any adjacent roadways.  Mostly to accomodate
spatial errors...

Step 2.
In ArcInfo, I perform an intersection of the two shape files
(footprint and roadway centerlines) and this creates a third shape file
which has a unique line for every project buffer/roadway intersection.
This attribute table contains the attributes from both original shape files

Step 3.
I then perform a calculation that provides a weighted volume to
associate with each project.  The weighting is based upon the lengths of
the road segments that are 'cut' by the project in relation to their
original lengths.

My issue is that I have not found a method to 'intersect' the two
spatial data sets and retain both of their attributes (and calculate new
lengths).

Walter Anderson


From r.hijmans at gmail.com  Wed Apr  1 19:36:12 2015
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 1 Apr 2015 10:36:12 -0700
Subject: [R-sig-Geo] Calculating the length of a line created from a
 spatial intersect.
In-Reply-To: <551C0C60.30603@gmail.com>
References: <551C0C60.30603@gmail.com>
Message-ID: <CANtt_hzB8-YPzfqyLwW2o04zY3jsftu8hSZN7c0AiBr0P-KStw@mail.gmail.com>

Walter,

Next time, please try to give as a simple self contained example in R
showing what you have done, and where you are stuck.

Here is how you can intersect lines and polygons, keeping their attributes:

library(raster)
library(rgeos)

# example data
p <- shapefile(system.file("external/lux.shp", package="raster"))

k1 <- (rbind(c(5.5, 49.6), c(6.5, 49.6)))
k2 <- (rbind(c(5.5, 50), c(6.5, 50)))
k <- SpatialLines(list(Lines(list(Line(k1)), "1"),  Lines(list(Line(k2)), "2")))
k <- SpatialLinesDataFrame(k, data.frame(LID=1:2))
crs(k) <- crs(p)

# intersection
x <- intersect(k, p)

## note that   x <- intersect(p, k)
## currently does not work; I'll fix that.

x
data.frame(x)

Robert

On Wed, Apr 1, 2015 at 8:18 AM, Walter Anderson <wandrson01 at gmail.com> wrote:
> Hello all,
>
> I am continuing on the process of automating an analysis that I
> developed with ArcInfo using R with the sp, rgdal, rgeos, and raster
> libraries.
>
> This step is similiar to my previous question concerning calculating the
> area of a polygon created from a spatial intersect; however, the command
> I was referred doesn't perform the merge of the two data frames as it
> does when both spatial data sets are polygons.
>
> Here is the process I am using in ArcInfo that I need to replicate:
>
> I have a shape file (lines) that defines the limits of all of the
> projects with each project having a unique identifier.
>
> I have another shape file (lines) that represent the road centerlines
> and have a traffic volumen associated with each link.
>
> Process
> Step 1.
> I then buffer these project lines to create a second shape file that
> represents the 'footprint' of the project. (Creates polys).  This is a
> small footprint (250 ft) that is solely used to associate the
> appropriate portion of any adjacent roadways.  Mostly to accomodate
> spatial errors...
>
> Step 2.
> In ArcInfo, I perform an intersection of the two shape files
> (footprint and roadway centerlines) and this creates a third shape file
> which has a unique line for every project buffer/roadway intersection.
> This attribute table contains the attributes from both original shape files
>
> Step 3.
> I then perform a calculation that provides a weighted volume to
> associate with each project.  The weighting is based upon the lengths of
> the road segments that are 'cut' by the project in relation to their
> original lengths.
>
> My issue is that I have not found a method to 'intersect' the two
> spatial data sets and retain both of their attributes (and calculate new
> lengths).
>
> Walter Anderson
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From wandrson01 at gmail.com  Wed Apr  1 19:59:32 2015
From: wandrson01 at gmail.com (Walter Anderson)
Date: Wed, 01 Apr 2015 12:59:32 -0500
Subject: [R-sig-Geo] Calculating the length of a line created from a
 spatial intersect.
In-Reply-To: <CANtt_hzB8-YPzfqyLwW2o04zY3jsftu8hSZN7c0AiBr0P-KStw@mail.gmail.com>
References: <551C0C60.30603@gmail.com>
	<CANtt_hzB8-YPzfqyLwW2o04zY3jsftu8hSZN7c0AiBr0P-KStw@mail.gmail.com>
Message-ID: <551C3204.7000703@gmail.com>

Robert,

Thank you and I apologize.  I was trying the intersect command that you
used below (with the other material).

Specifically

result <- intersect(buffered_projects, road_centerline)

which only contained attributes from the buffered projects (ie no road
attributes).  I also tried it the other way,

result <- intersect(road_centerline, buffered_projects)

and this only had the attributes from the road (ie no project attributes).

When I performe the above intersection operation with ESRI I get both
attribute tables, ie

PROJECT	ROAD_NAME VOLUME
...

Which allow me to perform my calculations using the road data by project.

Since your example is using the same approach I was trying can you give
me some insight into what I am doing wrong?

Walter Anderson

On 04/01/2015 12:36 PM, Robert J. Hijmans wrote:
> Walter,
> 
> Next time, please try to give as a simple self contained example in R
> showing what you have done, and where you are stuck.
> 
> Here is how you can intersect lines and polygons, keeping their attributes:
> 
> library(raster)
> library(rgeos)
> 
> # example data
> p <- shapefile(system.file("external/lux.shp", package="raster"))
> 
> k1 <- (rbind(c(5.5, 49.6), c(6.5, 49.6)))
> k2 <- (rbind(c(5.5, 50), c(6.5, 50)))
> k <- SpatialLines(list(Lines(list(Line(k1)), "1"),  Lines(list(Line(k2)), "2")))
> k <- SpatialLinesDataFrame(k, data.frame(LID=1:2))
> crs(k) <- crs(p)
> 
> # intersection
> x <- intersect(k, p)
> 
> ## note that   x <- intersect(p, k)
> ## currently does not work; I'll fix that.
> 
> x
> data.frame(x)
> 
> Robert
> 
> On Wed, Apr 1, 2015 at 8:18 AM, Walter Anderson <wandrson01 at gmail.com> wrote:
>> Hello all,
>>
>> I am continuing on the process of automating an analysis that I
>> developed with ArcInfo using R with the sp, rgdal, rgeos, and raster
>> libraries.
>>
>> This step is similiar to my previous question concerning calculating the
>> area of a polygon created from a spatial intersect; however, the command
>> I was referred doesn't perform the merge of the two data frames as it
>> does when both spatial data sets are polygons.
>>
>> Here is the process I am using in ArcInfo that I need to replicate:
>>
>> I have a shape file (lines) that defines the limits of all of the
>> projects with each project having a unique identifier.
>>
>> I have another shape file (lines) that represent the road centerlines
>> and have a traffic volumen associated with each link.
>>
>> Process
>> Step 1.
>> I then buffer these project lines to create a second shape file that
>> represents the 'footprint' of the project. (Creates polys).  This is a
>> small footprint (250 ft) that is solely used to associate the
>> appropriate portion of any adjacent roadways.  Mostly to accomodate
>> spatial errors...
>>
>> Step 2.
>> In ArcInfo, I perform an intersection of the two shape files
>> (footprint and roadway centerlines) and this creates a third shape file
>> which has a unique line for every project buffer/roadway intersection.
>> This attribute table contains the attributes from both original shape files
>>
>> Step 3.
>> I then perform a calculation that provides a weighted volume to
>> associate with each project.  The weighting is based upon the lengths of
>> the road segments that are 'cut' by the project in relation to their
>> original lengths.
>>
>> My issue is that I have not found a method to 'intersect' the two
>> spatial data sets and retain both of their attributes (and calculate new
>> lengths).
>>
>> Walter Anderson
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alexandrovich at mathematik.uni-marburg.de  Wed Apr  1 20:03:15 2015
From: alexandrovich at mathematik.uni-marburg.de (Grigory Alexandrovich)
Date: Wed, 01 Apr 2015 20:03:15 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
Message-ID: <551C32E3.1010902@mathematik.uni-marburg.de>

Hello all,

I encountered the following unexpected result using checkPolygonsHoles:

# attach the worldmap as SpatialPolygonsDataFrame from the package maptools
library(sp)
library(maptools)
data(wrld_simpl)

# get a polygon with a hole
shape_with_hole <- wrld_simpl[5,]

# plot it (hole is left white, surrounded by blue color)
plot(shape_with_hole, col = "blue")

# perform checkPolygonsHoles
shape_with_hole at polygons <- lapply(shape_with_hole at polygons, 
checkPolygonsHoles)

# plot again, now holes aren't recognized as such
plot(shape_with_hole, col = "blue")

# and even the original SpatialPolygonsDataFrame object is changed !?
plot(wrld_simpl[5,], col = "blue")

One irritating side effect here is that the original object wrld_simpl 
is also changed. This result looks to me like a bug, or have I missed 
something?


From r.turner at auckland.ac.nz  Thu Apr  2 02:02:51 2015
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Thu, 02 Apr 2015 13:02:51 +1300
Subject: [R-sig-Geo] model fitting of randomly generated data in spatstat
In-Reply-To: <CAEqf7EXzPLbbgZMr3SJCA69KL=vOwAF0JdQqvSY+wuHuxipt3g@mail.gmail.com>
References: <CAEqf7EXzPLbbgZMr3SJCA69KL=vOwAF0JdQqvSY+wuHuxipt3g@mail.gmail.com>
Message-ID: <551C872B.2090406@auckland.ac.nz>

On 02/04/15 03:09, Robert Leaf wrote:

> I was generating some data for analysis and was curious to see if we could
> fit a ?MatClust? model using the function *spatstat*::kppm to some of our
> observed data. As a first cut, and to see if we get values that conform to
> our expectations, I fit models to simulated data and was curious about the
> results. I am hoping that the group can help me understand the departures
> from expecations.
>
> Is it reasonable that the kppm function should return parameters values
> that are similar to the those that generated the data?

Sure, given that the those used to generate the data are not too bizarre.

>
> We are not getting value that are anywhere close to what we would expect.

That appears to be because you are using *bizarre* parameter values to 
generate your data.  The algorithms used by kppm() can be expected to 
return far-out results unless the data to which kppm() is applied have 
at least *some* reasonable prospect of conforming to the model that is 
being fitted.

> library(*spatstat*)

What are those asterisks doing in that call???  That cannot have been 
the call that you actually used.


> (point.vals <- rMatClust(kappa = 2, r = 2, mu = 2000)) # generate random
> points
>
> if (point.vals$n > 0) { # some realizations of the model return .ppp
> variables of with no data

I was initially bewildered by this --- the expected number of points is 
4000, so how could you possibly get zero points? I asked.  Finally I saw
the light; with kappa = 2 you will zero parent points, and hence an 
empty pattern about 13.5% of the time.  I.e. kappa = 2 is just plain 
silly-small.

Using "r = 2" (these days the syntax is ***scale = 2*** means that you 
are forming clusters in discs of radius 2 .... in the unit square!!!
(You are using the default window.) This makes no sense to me.

Setting mu = 2000 means you are generating an average of 2000 points in
each such disk.  I really don't think this is a realistic value for a 
Mat?rn cluster process.

Your simulated pattern (if it is not empty) will have the appearance of 
having arisen from a very high intensity Poisson process.  Fitting a 
Mat?rn cluster process to such a pattern results in ill-determined 
parameter values.

Try:

set.seed(42)
X <- rMatClust(kappa=20,scale=0.04,mu=5)
fit <- kppm(X ~ 1,"MatClust")
fit

....

Fitted cluster parameters:
       kappa       scale
22.37058543  0.04168089
Mean cluster size:  4.514857 points

The estimated parameters are reasonably commensurate with those used
to generate the pattern.

<SNIP>

cheers,

Rolf Turner

P.S. If your chosen parameter values (kappa = 2, mu = 2000) were 
selected in imitation of parameter estimates obtained from fitting a 
Mat?rn cluster model to real data, then I would suggest that you should 
probably *not* fit such a model to those data.

In modelling it is important to try fitting *appropriate* models to data 
sets.  Otherwise the results you get may well be meaningless.

R. T.

-- 
Rolf Turner
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276
Home phone: +64-9-480-4619


From Jin.Li at ga.gov.au  Thu Apr  2 06:00:11 2015
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Thu, 2 Apr 2015 04:00:11 +0000
Subject: [R-sig-Geo] Spatial sampling design using information more than
	spatial coordinates [SEC=UNCLASSIFIED]
Message-ID: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>

Hi All,

I need to consider both spatial information and another variable (e.g. elevation, soil type) in a sampling design. It seems the available libraries (e.g. sp and spcosa) in R for spatial sampling design are unable to handle it. Please correct me if I am wrong. Before I start to develop my own function for it, I would like to confirm if I have missed some other functions that are available for it in R.  Any suggestions and advice? Thanks in advance!

Regards,
Jin

Jin Li, PhD
Spatial Modeller/Computational Statistician  |  National Earth and Marine Observations Group
Environmental Geoscience Division  |  GEOSCIENCE AUSTRALIA
____________________________________________________________
Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
Email:  Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au>    Web:  www.ga.gov.au<http://www.ga.gov.au/>
Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT
GPO Box 378 Canberra ACT 2601 Australia
Applying geoscience to Australia's most important challenges


Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
-------------------------------------------------------------------------------------------------------------------------


	[[alternative HTML version deleted]]


From robert.t.leaf at gmail.com  Thu Apr  2 14:12:01 2015
From: robert.t.leaf at gmail.com (robleaf)
Date: Thu, 2 Apr 2015 05:12:01 -0700 (MST)
Subject: [R-sig-Geo] model fitting of randomly generated data in spatstat
In-Reply-To: <551C872B.2090406@auckland.ac.nz>
References: <551C872B.2090406@auckland.ac.nz>
Message-ID: <1427976721158-7588008.post@n2.nabble.com>

Rolf, 

Really appreciate your responding to my query. We were interested in
simulating highly clumped distributions and the values that I used 

rMatClust(kappa = 2, r = 2, mu = 2000))

Seemed to do a adequate job in creating them. I am appreciative of your
comment to the effect that the parameter values cannot be too strange. Looks
like I will need to spend more time with this. Really appreciate your in
input, regards, Robert



-----
Robert Leaf, PhD
Assistant Professor
Department of Coastal Sciences
The University of Southern Mississippi
703 East Beach Dr.
Ocean Springs, MS 39564
228-872-4296 (Office)
228-818-8816 (Lab)

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Re-model-fitting-of-randomly-generated-data-in-spatstat-tp7588006p7588008.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Thu Apr  2 14:50:44 2015
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 02 Apr 2015 14:50:44 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <551C32E3.1010902@mathematik.uni-marburg.de>
References: <551C32E3.1010902@mathematik.uni-marburg.de>
Message-ID: <551D3B24.8070705@uni-muenster.de>



On 04/01/2015 08:03 PM, Grigory Alexandrovich wrote:
> Hello all,
> 
> I encountered the following unexpected result using checkPolygonsHoles:
> 
> # attach the worldmap as SpatialPolygonsDataFrame from the package maptools
> library(sp)
> library(maptools)
> data(wrld_simpl)
> 
> # get a polygon with a hole
> shape_with_hole <- wrld_simpl[5,]
> 
> # plot it (hole is left white, surrounded by blue color)
> plot(shape_with_hole, col = "blue")
> 
> # perform checkPolygonsHoles
> shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
> checkPolygonsHoles)
> 
> # plot again, now holes aren't recognized as such
> plot(shape_with_hole, col = "blue")
> 
> # and even the original SpatialPolygonsDataFrame object is changed !?
> plot(wrld_simpl[5,], col = "blue")
> 
> One irritating side effect here is that the original object wrld_simpl
> is also changed. This result looks to me like a bug, or have I missed
> something?
> 

It looks as if it is related to rgeos, as

avoidGEOS = FALSE
library(sp)
library(maptools)
data(wrld_simpl)
x = wrld_simpl

shape_with_hole <- wrld_simpl[5,]

if (avoidGEOS)
	gpclibPermit()
shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
checkPolygonsHoles,
	avoidGEOS = avoidGEOS)

data(wrld_simpl)
all.equal(x, wrld_simpl)

returns a difference, but TRUE if avoidGEOS = TRUE.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi),  University of M?nster,
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150402/a4af2d3c/attachment.bin>

From Roger.Bivand at nhh.no  Thu Apr  2 17:01:02 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 2 Apr 2015 17:01:02 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <551D3B24.8070705@uni-muenster.de>
References: <551C32E3.1010902@mathematik.uni-marburg.de>
	<551D3B24.8070705@uni-muenster.de>
Message-ID: <alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>

On Thu, 2 Apr 2015, Edzer Pebesma wrote:

>
>
> On 04/01/2015 08:03 PM, Grigory Alexandrovich wrote:
>> Hello all,
>>
>> I encountered the following unexpected result using checkPolygonsHoles:
>>
>> # attach the worldmap as SpatialPolygonsDataFrame from the package maptools
>> library(sp)
>> library(maptools)
>> data(wrld_simpl)
>>
>> # get a polygon with a hole
>> shape_with_hole <- wrld_simpl[5,]
>>
>> # plot it (hole is left white, surrounded by blue color)
>> plot(shape_with_hole, col = "blue")
>>
>> # perform checkPolygonsHoles
>> shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>> checkPolygonsHoles)
>>
>> # plot again, now holes aren't recognized as such
>> plot(shape_with_hole, col = "blue")
>>
>> # and even the original SpatialPolygonsDataFrame object is changed !?
>> plot(wrld_simpl[5,], col = "blue")
>>
>> One irritating side effect here is that the original object wrld_simpl
>> is also changed. This result looks to me like a bug, or have I missed
>> something?
>>
>
> It looks as if it is related to rgeos, as
>
> avoidGEOS = FALSE
> library(sp)
> library(maptools)
> data(wrld_simpl)
> x = wrld_simpl
>
> shape_with_hole <- wrld_simpl[5,]
>
> if (avoidGEOS)
> 	gpclibPermit()
> shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
> checkPolygonsHoles,
> 	avoidGEOS = avoidGEOS)
>
> data(wrld_simpl)
> all.equal(x, wrld_simpl)

No, but:

library(sp)
library(maptools)
data(wrld_simpl)
x = wrld_simpl
shape_with_hole <- wrld_simpl[5,]
pls <- slot(shape_with_hole, "polygons")
pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = FALSE)
isTRUE(all.equal(pls, pls1))
# TRUE
gpclibPermit()
pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = TRUE)
isTRUE(all.equal(pls, pls1))
# FALSE

where the Polygon objects are re-ordered and plotted out of order, so the 
deprecated gpclib code may be broken here. However, this isn't the 
problem, but rather (perhaps) graphics::polypath. If it is used (by 
default it is), and with the default path fill mode:

plot(x[5,], col="blue", usePolypath=TRUE, rule="winding")

does not whiten the holes. However:

plot(x[5,], col="blue", usePolypath=TRUE, rule="evenodd")

does. Using:

plot(x[5,], col="blue", pbg="white", usePolypath=FALSE)

also works by overpainting the island with the holes in white.

Please summarise the your SO thread.

By the way, in R it is unusual for changes in one object to propagate in 
an unintended way to another object, and this is not happening here. The 
visual impression is being driven by polypath doing different things 
depending on its rule setting. Look at ?polypath for details.

Well, this doesn't clarify, but it explains what is happeing, I hope ...

Roger

>
> returns a difference, but TRUE if avoidGEOS = TRUE.
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Thu Apr  2 17:05:52 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 2 Apr 2015 17:05:52 +0200
Subject: [R-sig-Geo] Spatial sampling design using information more than
 spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
Message-ID: <alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>

On Thu, 2 Apr 2015, Jin.Li at ga.gov.au wrote:

> Hi All,
>
> I need to consider both spatial information and another variable (e.g. 
> elevation, soil type) in a sampling design. It seems the available 
> libraries (e.g. sp and spcosa) in R for spatial sampling design are 
> unable to handle it. Please correct me if I am wrong. Before I start to 
> develop my own function for it, I would like to confirm if I have missed 
> some other functions that are available for it in R.  Any suggestions 
> and advice? Thanks in advance!

Have you looked at spsurvey? It may not provide what you need, but 
checking it would probably help you see whether there is anything meeting 
your needs. Otherwise you might need to stratify first on your covariates.

Roger

>
> Regards,
> Jin
>
> Jin Li, PhD
> Spatial Modeller/Computational Statistician  |  National Earth and Marine Observations Group
> Environmental Geoscience Division  |  GEOSCIENCE AUSTRALIA
> ____________________________________________________________
> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
> Email:  Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au>    Web:  www.ga.gov.au<http://www.ga.gov.au/>
> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT
> GPO Box 378 Canberra ACT 2601 Australia
> Applying geoscience to Australia's most important challenges
>
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
> -------------------------------------------------------------------------------------------------------------------------
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Thu Apr  2 22:24:22 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 2 Apr 2015 22:24:22 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>
References: <551C32E3.1010902@mathematik.uni-marburg.de>
	<551D3B24.8070705@uni-muenster.de>
	<alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>
Message-ID: <alpine.LFD.2.11.1504022223030.9896@reclus.nhh.no>

On Thu, 2 Apr 2015, Roger Bivand wrote:

> On Thu, 2 Apr 2015, Edzer Pebesma wrote:
>
>> 
>>
>>  On 04/01/2015 08:03 PM, Grigory Alexandrovich wrote:
>> >  Hello all,
>> > 
>> >  I encountered the following unexpected result using checkPolygonsHoles:
>> > 
>> >  # attach the worldmap as SpatialPolygonsDataFrame from the package 
>> >  maptools
>> >  library(sp)
>> >  library(maptools)
>> >  data(wrld_simpl)
>> > 
>> >  # get a polygon with a hole
>> >  shape_with_hole <- wrld_simpl[5,]
>> > 
>> >  # plot it (hole is left white, surrounded by blue color)
>> >  plot(shape_with_hole, col = "blue")
>> > 
>> >  # perform checkPolygonsHoles
>> >  shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>> >  checkPolygonsHoles)
>> > 
>> >  # plot again, now holes aren't recognized as such
>> >  plot(shape_with_hole, col = "blue")
>> > 
>> >  # and even the original SpatialPolygonsDataFrame object is changed !?
>> >  plot(wrld_simpl[5,], col = "blue")
>> > 
>> >  One irritating side effect here is that the original object wrld_simpl
>> >  is also changed. This result looks to me like a bug, or have I missed
>> >  something?
>> > 
>>
>>  It looks as if it is related to rgeos, as
>>
>>  avoidGEOS = FALSE
>>  library(sp)
>>  library(maptools)
>>  data(wrld_simpl)
>>  x = wrld_simpl
>>
>>  shape_with_hole <- wrld_simpl[5,]
>>
>>  if (avoidGEOS)
>>  	gpclibPermit()
>>  shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>>  checkPolygonsHoles,
>>   avoidGEOS = avoidGEOS)
>>
>>  data(wrld_simpl)
>>  all.equal(x, wrld_simpl)
>
> No, but:
>
> library(sp)
> library(maptools)
> data(wrld_simpl)
> x = wrld_simpl
> shape_with_hole <- wrld_simpl[5,]
> pls <- slot(shape_with_hole, "polygons")
> pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = FALSE)
> isTRUE(all.equal(pls, pls1))
> # TRUE
> gpclibPermit()
> pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = TRUE)
> isTRUE(all.equal(pls, pls1))
> # FALSE
>
> where the Polygon objects are re-ordered and plotted out of order, so the 
> deprecated gpclib code may be broken here. However, this isn't the problem,

The gpclib code is OK, it re-orders the Polygon objects, but the plot 
order is correct. The problem is as described below.

Roger

> but rather (perhaps) graphics::polypath. If it is used (by default it is), 
> and with the default path fill mode:
>
> plot(x[5,], col="blue", usePolypath=TRUE, rule="winding")
>
> does not whiten the holes. However:
>
> plot(x[5,], col="blue", usePolypath=TRUE, rule="evenodd")
>
> does. Using:
>
> plot(x[5,], col="blue", pbg="white", usePolypath=FALSE)
>
> also works by overpainting the island with the holes in white.
>
> Please summarise the your SO thread.
>
> By the way, in R it is unusual for changes in one object to propagate in an 
> unintended way to another object, and this is not happening here. The visual 
> impression is being driven by polypath doing different things depending on 
> its rule setting. Look at ?polypath for details.
>
> Well, this doesn't clarify, but it explains what is happeing, I hope ...
>
> Roger
>
>>
>>  returns a difference, but TRUE if avoidGEOS = TRUE.
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From r.turner at auckland.ac.nz  Fri Apr  3 00:25:17 2015
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Fri, 03 Apr 2015 11:25:17 +1300
Subject: [R-sig-Geo] model fitting of randomly generated data in spatstat
In-Reply-To: <1427976721158-7588008.post@n2.nabble.com>
References: <551C872B.2090406@auckland.ac.nz>
	<1427976721158-7588008.post@n2.nabble.com>
Message-ID: <551DC1CD.5050404@auckland.ac.nz>

On 03/04/15 01:12, robleaf wrote:
> Rolf,
>
> Really appreciate your responding to my query. We were interested in
> simulating highly clumped distributions and the values that I used
>
> rMatClust(kappa = 2, r = 2, mu = 2000))
>
> Seemed to do a adequate job in creating them. I am appreciative of your
> comment to the effect that the parameter values cannot be too strange. Looks
> like I will need to spend more time with this. Really appreciate your in
> input, regards, Robert


But those parameter values *won't* give you a "highly clumped" 
distribution.   You will generate on average *2* clumps and since the 
radius of each "clump" is 2 and you are simulating in the unit square, 
each clump will pretty much cover the window.  So you are (partially) 
superimposing (on average) two *very* dense clouds of points on the unit 
square.  This will not look ***at all*** "clumped.

Have you *plotted* the results of any of your simulations?

cheers,

Rolf

-- 
Rolf Turner
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276
Home phone: +64-9-480-4619


From alexandrovich at mathematik.uni-marburg.de  Fri Apr  3 09:46:48 2015
From: alexandrovich at mathematik.uni-marburg.de (Grigory Alexandrovich)
Date: Fri, 03 Apr 2015 09:46:48 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <alpine.LFD.2.11.1504022223030.9896@reclus.nhh.no>
References: <551C32E3.1010902@mathematik.uni-marburg.de>	<551D3B24.8070705@uni-muenster.de>	<alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>
	<alpine.LFD.2.11.1504022223030.9896@reclus.nhh.no>
Message-ID: <551E4568.3050608@mathematik.uni-marburg.de>

Am 02.04.2015 um 22:24 schrieb Roger Bivand:
> On Thu, 2 Apr 2015, Roger Bivand wrote:
>
>> On Thu, 2 Apr 2015, Edzer Pebesma wrote:
>>
>>>
>>>
>>>  On 04/01/2015 08:03 PM, Grigory Alexandrovich wrote:
>>> >  Hello all,
>>> > >  I encountered the following unexpected result using 
>>> checkPolygonsHoles:
>>> > >  # attach the worldmap as SpatialPolygonsDataFrame from the 
>>> package >  maptools
>>> >  library(sp)
>>> >  library(maptools)
>>> >  data(wrld_simpl)
>>> > >  # get a polygon with a hole
>>> >  shape_with_hole <- wrld_simpl[5,]
>>> > >  # plot it (hole is left white, surrounded by blue color)
>>> >  plot(shape_with_hole, col = "blue")
>>> > >  # perform checkPolygonsHoles
>>> >  shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>>> >  checkPolygonsHoles)
>>> > >  # plot again, now holes aren't recognized as such
>>> >  plot(shape_with_hole, col = "blue")
>>> > >  # and even the original SpatialPolygonsDataFrame object is 
>>> changed !?
>>> >  plot(wrld_simpl[5,], col = "blue")
>>> > >  One irritating side effect here is that the original object 
>>> wrld_simpl
>>> >  is also changed. This result looks to me like a bug, or have I 
>>> missed
>>> >  something?
>>> >
>>>  It looks as if it is related to rgeos, as
>>>
>>>  avoidGEOS = FALSE
>>>  library(sp)
>>>  library(maptools)
>>>  data(wrld_simpl)
>>>  x = wrld_simpl
>>>
>>>  shape_with_hole <- wrld_simpl[5,]
>>>
>>>  if (avoidGEOS)
>>>      gpclibPermit()
>>>  shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>>>  checkPolygonsHoles,
>>>   avoidGEOS = avoidGEOS)
>>>
>>>  data(wrld_simpl)
>>>  all.equal(x, wrld_simpl)
>>
>> No, but:
>>
>> library(sp)
>> library(maptools)
>> data(wrld_simpl)
>> x = wrld_simpl
>> shape_with_hole <- wrld_simpl[5,]
>> pls <- slot(shape_with_hole, "polygons")
>> pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = FALSE)
>> isTRUE(all.equal(pls, pls1))
>> # TRUE
>> gpclibPermit()
>> pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = TRUE)
>> isTRUE(all.equal(pls, pls1))
>> # FALSE
>>
>> where the Polygon objects are re-ordered and plotted out of order, so 
>> the deprecated gpclib code may be broken here. However, this isn't 
>> the problem,
>
> The gpclib code is OK, it re-orders the Polygon objects, but the plot 
> order is correct. The problem is as described below.
>
> Roger
>
>> but rather (perhaps) graphics::polypath. If it is used (by default it 
>> is), and with the default path fill mode:
>>
>> plot(x[5,], col="blue", usePolypath=TRUE, rule="winding")
>>
>> does not whiten the holes. However:
>>
>> plot(x[5,], col="blue", usePolypath=TRUE, rule="evenodd")
>>
>> does. Using:
>>
>> plot(x[5,], col="blue", pbg="white", usePolypath=FALSE)
>>
>> also works by overpainting the island with the holes in white.
>>
>> Please summarise the your SO thread.
>>
>> By the way, in R it is unusual for changes in one object to propagate 
>> in an unintended way to another object, and this is not happening 
>> here. The visual impression is being driven by polypath doing 
>> different things depending on its rule setting. Look at ?polypath for 
>> details.
>>
>> Well, this doesn't clarify, but it explains what is happeing, I hope ...
>>
>> Roger
>>
>>>
>>>  returns a difference, but TRUE if avoidGEOS = TRUE.
>>>
>>

|Thank you for your answers guys. But I am still not fully convinced 
that it is an issue of the plot function,
because the object shape_with_hole edited with checkPolygonsHoles 
before, continues to behave in a strange way:

# we check which polygons are flagged as holes.
# The flags are still set properly,
# although the plot() function didn't recognize them:
sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")

[1] FALSE  TRUE  TRUE  TRUE

# load library rgdal for reprojection
library(rgdal)

# reproject with spTransform, just for testing
shape_with_hole <- spTransform(shape_with_hole, CRS("+proj=longlat 
+ellps=WGS84 +datum=WGS84"))

# after reprojection all flags are set to FALSE
sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")

[1] FALSE FALSE FALSE FALSE


So it is still something wrong with shape_with_hole, or?

Best

Grigory|


	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Fri Apr  3 13:16:02 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 3 Apr 2015 13:16:02 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <551E4568.3050608@mathematik.uni-marburg.de>
References: <551C32E3.1010902@mathematik.uni-marburg.de>
	<551D3B24.8070705@uni-muenster.de>
	<alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>
	<alpine.LFD.2.11.1504022223030.9896@reclus.nhh.no>
	<551E4568.3050608@mathematik.uni-marburg.de>
Message-ID: <alpine.LFD.2.11.1504031309560.18824@reclus.nhh.no>

On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:

> Am 02.04.2015 um 22:24 schrieb Roger Bivand:
>> On Thu, 2 Apr 2015, Roger Bivand wrote:
>>
>>> On Thu, 2 Apr 2015, Edzer Pebesma wrote:
>>>
>>>>
>>>>
>>>>  On 04/01/2015 08:03 PM, Grigory Alexandrovich wrote:
>>>>>  Hello all,
>>>>>>  I encountered the following unexpected result using
>>>> checkPolygonsHoles:
>>>>>>  # attach the worldmap as SpatialPolygonsDataFrame from the
>>>> package >  maptools
>>>>>  library(sp)
>>>>>  library(maptools)
>>>>>  data(wrld_simpl)
>>>>>>  # get a polygon with a hole
>>>>>  shape_with_hole <- wrld_simpl[5,]
>>>>>>  # plot it (hole is left white, surrounded by blue color)
>>>>>  plot(shape_with_hole, col = "blue")
>>>>>>  # perform checkPolygonsHoles
>>>>>  shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>>>>>  checkPolygonsHoles)
>>>>>>  # plot again, now holes aren't recognized as such
>>>>>  plot(shape_with_hole, col = "blue")
>>>>>>  # and even the original SpatialPolygonsDataFrame object is
>>>> changed !?
>>>>>  plot(wrld_simpl[5,], col = "blue")
>>>>>>  One irritating side effect here is that the original object
>>>> wrld_simpl
>>>>>  is also changed. This result looks to me like a bug, or have I
>>>> missed
>>>>>  something?
>>>>>
>>>>  It looks as if it is related to rgeos, as
>>>>
>>>>  avoidGEOS = FALSE
>>>>  library(sp)
>>>>  library(maptools)
>>>>  data(wrld_simpl)
>>>>  x = wrld_simpl
>>>>
>>>>  shape_with_hole <- wrld_simpl[5,]
>>>>
>>>>  if (avoidGEOS)
>>>>      gpclibPermit()
>>>>  shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>>>>  checkPolygonsHoles,
>>>>   avoidGEOS = avoidGEOS)
>>>>
>>>>  data(wrld_simpl)
>>>>  all.equal(x, wrld_simpl)
>>>
>>> No, but:
>>>
>>> library(sp)
>>> library(maptools)
>>> data(wrld_simpl)
>>> x = wrld_simpl
>>> shape_with_hole <- wrld_simpl[5,]
>>> pls <- slot(shape_with_hole, "polygons")
>>> pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = FALSE)
>>> isTRUE(all.equal(pls, pls1))
>>> # TRUE
>>> gpclibPermit()
>>> pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = TRUE)
>>> isTRUE(all.equal(pls, pls1))
>>> # FALSE
>>>
>>> where the Polygon objects are re-ordered and plotted out of order, so
>>> the deprecated gpclib code may be broken here. However, this isn't
>>> the problem,
>>
>> The gpclib code is OK, it re-orders the Polygon objects, but the plot
>> order is correct. The problem is as described below.
>>
>> Roger
>>
>>> but rather (perhaps) graphics::polypath. If it is used (by default it
>>> is), and with the default path fill mode:
>>>
>>> plot(x[5,], col="blue", usePolypath=TRUE, rule="winding")
>>>
>>> does not whiten the holes. However:
>>>
>>> plot(x[5,], col="blue", usePolypath=TRUE, rule="evenodd")
>>>
>>> does. Using:
>>>
>>> plot(x[5,], col="blue", pbg="white", usePolypath=FALSE)
>>>
>>> also works by overpainting the island with the holes in white.
>>>
>>> Please summarise the your SO thread.
>>>
>>> By the way, in R it is unusual for changes in one object to propagate
>>> in an unintended way to another object, and this is not happening
>>> here. The visual impression is being driven by polypath doing
>>> different things depending on its rule setting. Look at ?polypath for
>>> details.
>>>
>>> Well, this doesn't clarify, but it explains what is happeing, I hope ...
>>>
>>> Roger
>>>
>>>>
>>>>  returns a difference, but TRUE if avoidGEOS = TRUE.
>>>>
>>>
>
> |Thank you for your answers guys. But I am still not fully convinced
> that it is an issue of the plot function,
> because the object shape_with_hole edited with checkPolygonsHoles
> before, continues to behave in a strange way:
>
> # we check which polygons are flagged as holes.
> # The flags are still set properly,
> # although the plot() function didn't recognize them:
> sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")
>
> [1] FALSE  TRUE  TRUE  TRUE
>
> # load library rgdal for reprojection
> library(rgdal)
>
> # reproject with spTransform, just for testing
> shape_with_hole <- spTransform(shape_with_hole, CRS("+proj=longlat
> +ellps=WGS84 +datum=WGS84"))
>
> # after reprojection all flags are set to FALSE
> sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")
>
> [1] FALSE FALSE FALSE FALSE
>
>
> So it is still something wrong with shape_with_hole, or?

Please provide the output of sessionInfo(), rgeos::version_GEOS(), and 
rgdal::getGDALVersionInfo() with rgdal::getPROJ4VersionInfo(). I cannot 
reproduce the degradation of hole status following a no-op use of 
spTransform() with:

> sessionInfo()
R version 3.1.3 (2015-03-09)
Platform: x86_64-unknown-linux-gnu (64-bit)
Running under: Fedora 21 (Twenty One)
...
attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.9-3     maptools_0.8-34 sp_1.0-17

loaded via a namespace (and not attached):
[1] foreign_0.8-63  grid_3.1.3      lattice_0.20-31 rgeos_0.3-8
[5] tools_3.1.3
> rgeos::version_GEOS()
[1] "3.4.2-CAPI-1.8.2 r3921"
> rgdal::getGDALVersionInfo()
[1] "GDAL 1.11.2, released 2015/02/10"
> rgdal::getPROJ4VersionInfo()
[1] "Rel. 4.9.1, 04 March 2015, [PJ_VERSION: 491]"

Roger


>
> Best
>
> Grigory|
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From alexandrovich at mathematik.uni-marburg.de  Fri Apr  3 14:48:59 2015
From: alexandrovich at mathematik.uni-marburg.de (Grigory Alexandrovich)
Date: Fri, 03 Apr 2015 14:48:59 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <alpine.LFD.2.11.1504031309560.18824@reclus.nhh.no>
References: <551C32E3.1010902@mathematik.uni-marburg.de>
	<551D3B24.8070705@uni-muenster.de>
	<alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>
	<alpine.LFD.2.11.1504022223030.9896@reclus.nhh.no>
	<551E4568.3050608@mathematik.uni-marburg.de>
	<alpine.LFD.2.11.1504031309560.18824@reclus.nhh.no>
Message-ID: <551E8C3B.70504@mathematik.uni-marburg.de>



Am 03.04.2015 um 13:16 schrieb Roger Bivand:
> On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:
>
>> Am 02.04.2015 um 22:24 schrieb Roger Bivand:
>>> On Thu, 2 Apr 2015, Roger Bivand wrote:
>>>
>>>> On Thu, 2 Apr 2015, Edzer Pebesma wrote:
>>>>
>>>>>
>>>>>
>>>>>  On 04/01/2015 08:03 PM, Grigory Alexandrovich wrote:
>>>>>>  Hello all,
>>>>>>>  I encountered the following unexpected result using
>>>>> checkPolygonsHoles:
>>>>>>>  # attach the worldmap as SpatialPolygonsDataFrame from the
>>>>> package >  maptools
>>>>>>  library(sp)
>>>>>>  library(maptools)
>>>>>>  data(wrld_simpl)
>>>>>>>  # get a polygon with a hole
>>>>>>  shape_with_hole <- wrld_simpl[5,]
>>>>>>>  # plot it (hole is left white, surrounded by blue color)
>>>>>>  plot(shape_with_hole, col = "blue")
>>>>>>>  # perform checkPolygonsHoles
>>>>>>  shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>>>>>>  checkPolygonsHoles)
>>>>>>>  # plot again, now holes aren't recognized as such
>>>>>>  plot(shape_with_hole, col = "blue")
>>>>>>>  # and even the original SpatialPolygonsDataFrame object is
>>>>> changed !?
>>>>>>  plot(wrld_simpl[5,], col = "blue")
>>>>>>>  One irritating side effect here is that the original object
>>>>> wrld_simpl
>>>>>>  is also changed. This result looks to me like a bug, or have I
>>>>> missed
>>>>>>  something?
>>>>>>
>>>>>  It looks as if it is related to rgeos, as
>>>>>
>>>>>  avoidGEOS = FALSE
>>>>>  library(sp)
>>>>>  library(maptools)
>>>>>  data(wrld_simpl)
>>>>>  x = wrld_simpl
>>>>>
>>>>>  shape_with_hole <- wrld_simpl[5,]
>>>>>
>>>>>  if (avoidGEOS)
>>>>>      gpclibPermit()
>>>>>  shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>>>>>  checkPolygonsHoles,
>>>>>   avoidGEOS = avoidGEOS)
>>>>>
>>>>>  data(wrld_simpl)
>>>>>  all.equal(x, wrld_simpl)
>>>>
>>>> No, but:
>>>>
>>>> library(sp)
>>>> library(maptools)
>>>> data(wrld_simpl)
>>>> x = wrld_simpl
>>>> shape_with_hole <- wrld_simpl[5,]
>>>> pls <- slot(shape_with_hole, "polygons")
>>>> pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = FALSE)
>>>> isTRUE(all.equal(pls, pls1))
>>>> # TRUE
>>>> gpclibPermit()
>>>> pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = TRUE)
>>>> isTRUE(all.equal(pls, pls1))
>>>> # FALSE
>>>>
>>>> where the Polygon objects are re-ordered and plotted out of order, so
>>>> the deprecated gpclib code may be broken here. However, this isn't
>>>> the problem,
>>>
>>> The gpclib code is OK, it re-orders the Polygon objects, but the plot
>>> order is correct. The problem is as described below.
>>>
>>> Roger
>>>
>>>> but rather (perhaps) graphics::polypath. If it is used (by default it
>>>> is), and with the default path fill mode:
>>>>
>>>> plot(x[5,], col="blue", usePolypath=TRUE, rule="winding")
>>>>
>>>> does not whiten the holes. However:
>>>>
>>>> plot(x[5,], col="blue", usePolypath=TRUE, rule="evenodd")
>>>>
>>>> does. Using:
>>>>
>>>> plot(x[5,], col="blue", pbg="white", usePolypath=FALSE)
>>>>
>>>> also works by overpainting the island with the holes in white.
>>>>
>>>> Please summarise the your SO thread.
>>>>
>>>> By the way, in R it is unusual for changes in one object to propagate
>>>> in an unintended way to another object, and this is not happening
>>>> here. The visual impression is being driven by polypath doing
>>>> different things depending on its rule setting. Look at ?polypath for
>>>> details.
>>>>
>>>> Well, this doesn't clarify, but it explains what is happeing, I 
>>>> hope ...
>>>>
>>>> Roger
>>>>
>>>>>
>>>>>  returns a difference, but TRUE if avoidGEOS = TRUE.
>>>>>
>>>>
>>
>> |Thank you for your answers guys. But I am still not fully convinced
>> that it is an issue of the plot function,
>> because the object shape_with_hole edited with checkPolygonsHoles
>> before, continues to behave in a strange way:
>>
>> # we check which polygons are flagged as holes.
>> # The flags are still set properly,
>> # although the plot() function didn't recognize them:
>> sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")
>>
>> [1] FALSE  TRUE  TRUE  TRUE
>>
>> # load library rgdal for reprojection
>> library(rgdal)
>>
>> # reproject with spTransform, just for testing
>> shape_with_hole <- spTransform(shape_with_hole, CRS("+proj=longlat
>> +ellps=WGS84 +datum=WGS84"))
>>
>> # after reprojection all flags are set to FALSE
>> sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")
>>
>> [1] FALSE FALSE FALSE FALSE
>>
>>
>> So it is still something wrong with shape_with_hole, or?
>
> Please provide the output of sessionInfo(), rgeos::version_GEOS(), and 
> rgdal::getGDALVersionInfo() with rgdal::getPROJ4VersionInfo(). I 
> cannot reproduce the degradation of hole status following a no-op use 
> of spTransform() with:
>
>> sessionInfo()
> R version 3.1.3 (2015-03-09)
> Platform: x86_64-unknown-linux-gnu (64-bit)
> Running under: Fedora 21 (Twenty One)
> ...
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods base
>
> other attached packages:
> [1] rgdal_0.9-3     maptools_0.8-34 sp_1.0-17
>
> loaded via a namespace (and not attached):
> [1] foreign_0.8-63  grid_3.1.3      lattice_0.20-31 rgeos_0.3-8
> [5] tools_3.1.3
>> rgeos::version_GEOS()
> [1] "3.4.2-CAPI-1.8.2 r3921"
>> rgdal::getGDALVersionInfo()
> [1] "GDAL 1.11.2, released 2015/02/10"
>> rgdal::getPROJ4VersionInfo()
> [1] "Rel. 4.9.1, 04 March 2015, [PJ_VERSION: 491]"
>
> Roger
>
>
>>
>> Best
>>
>> Grigory|
>>
>>
My session infos:

sessionInfo()
R version 3.1.1 (2014-07-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)

...
attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base

other attached packages:
[1] rgdal_0.9-1     maptools_0.8-34 sp_1.0-17

loaded via a namespace (and not attached):
[1] foreign_0.8-61  grid_3.1.1      lattice_0.20-29 tools_3.1.1


rgeos::version_GEOS()
[1] "3.4.2-CAPI-1.8.2 r3921"

rgdal::getGDALVersionInfo()
[1] "GDAL 1.11.0, released 2014/04/16"

rgdal::getPROJ4VersionInfo()
[1] "Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]"


But I also obtained the same result on another windows machine with R 
3.1.2 (dont have session info for it)

Grigory


From Roger.Bivand at nhh.no  Fri Apr  3 20:42:56 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 3 Apr 2015 20:42:56 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <551E8C3B.70504@mathematik.uni-marburg.de>
References: <551C32E3.1010902@mathematik.uni-marburg.de>
	<551D3B24.8070705@uni-muenster.de>
	<alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>
	<alpine.LFD.2.11.1504022223030.9896@reclus.nhh.no>
	<551E4568.3050608@mathematik.uni-marburg.de>
	<alpine.LFD.2.11.1504031309560.18824@reclus.nhh.no>
	<551E8C3B.70504@mathematik.uni-marburg.de>
Message-ID: <alpine.LFD.2.11.1504032037440.24504@reclus.nhh.no>

On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:

>
>
> Am 03.04.2015 um 13:16 schrieb Roger Bivand:
>>  On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:
>> 
>> >  Am 02.04.2015 um 22:24 schrieb Roger Bivand:
>> > >  On Thu, 2 Apr 2015, Roger Bivand wrote:
>> > > 
>> > > >  On Thu, 2 Apr 2015, Edzer Pebesma wrote:
>> > > > 
>> > > > > 
>> > > > > 
>> > > > >   On 04/01/2015 08:03 PM, Grigory Alexandrovich wrote:
>> > > > > >   Hello all,
>> > > > > > >   I encountered the following unexpected result using
>> > > > >  checkPolygonsHoles:
>> > > > > > >   # attach the worldmap as SpatialPolygonsDataFrame from the
>> > > > > package >   maptools
>> > > > > >   library(sp)
>> > > > > >   library(maptools)
>> > > > > >   data(wrld_simpl)
>> > > > > > >   # get a polygon with a hole
>> > > > > >   shape_with_hole <- wrld_simpl[5,]
>> > > > > > >   # plot it (hole is left white, surrounded by blue color)
>> > > > > >   plot(shape_with_hole, col = "blue")
>> > > > > > >   # perform checkPolygonsHoles
>> > > > > >   shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>> > > > > >   checkPolygonsHoles)
>> > > > > > >   # plot again, now holes aren't recognized as such
>> > > > > >   plot(shape_with_hole, col = "blue")
>> > > > > > >   # and even the original SpatialPolygonsDataFrame object is
>> > > > >  changed !?
>> > > > > >   plot(wrld_simpl[5,], col = "blue")
>> > > > > > >   One irritating side effect here is that the original object
>> > > > >  wrld_simpl
>> > > > > >   is also changed. This result looks to me like a bug, or have I
>> > > > >  missed
>> > > > > >   something?
>> > > > > > 
>> > > > >   It looks as if it is related to rgeos, as
>> > > > > 
>> > > > >   avoidGEOS = FALSE
>> > > > >   library(sp)
>> > > > >   library(maptools)
>> > > > >   data(wrld_simpl)
>> > > > >   x = wrld_simpl
>> > > > > 
>> > > > >   shape_with_hole <- wrld_simpl[5,]
>> > > > > 
>> > > > >   if (avoidGEOS)
>> > > > >       gpclibPermit()
>> > > > >   shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>> > > > >   checkPolygonsHoles,
>> > > > >    avoidGEOS = avoidGEOS)
>> > > > > 
>> > > > >   data(wrld_simpl)
>> > > > >   all.equal(x, wrld_simpl)
>> > > > 
>> > > >  No, but:
>> > > > 
>> > > >  library(sp)
>> > > >  library(maptools)
>> > > >  data(wrld_simpl)
>> > > >  x = wrld_simpl
>> > > >  shape_with_hole <- wrld_simpl[5,]
>> > > >  pls <- slot(shape_with_hole, "polygons")
>> > > >  pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = FALSE)
>> > > >  isTRUE(all.equal(pls, pls1))
>> > > >  # TRUE
>> > > >  gpclibPermit()
>> > > >  pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = TRUE)
>> > > >  isTRUE(all.equal(pls, pls1))
>> > > >  # FALSE
>> > > > 
>> > > >  where the Polygon objects are re-ordered and plotted out of order, 
>> > > >  so
>> > > >  the deprecated gpclib code may be broken here. However, this isn't
>> > > >  the problem,
>> > > 
>> > >  The gpclib code is OK, it re-orders the Polygon objects, but the plot
>> > >  order is correct. The problem is as described below.
>> > > 
>> > >  Roger
>> > > 
>> > > >  but rather (perhaps) graphics::polypath. If it is used (by default 
>> > > >  it
>> > > >  is), and with the default path fill mode:
>> > > > 
>> > > >  plot(x[5,], col="blue", usePolypath=TRUE, rule="winding")
>> > > > 
>> > > >  does not whiten the holes. However:
>> > > > 
>> > > >  plot(x[5,], col="blue", usePolypath=TRUE, rule="evenodd")
>> > > > 
>> > > >  does. Using:
>> > > > 
>> > > >  plot(x[5,], col="blue", pbg="white", usePolypath=FALSE)
>> > > > 
>> > > >  also works by overpainting the island with the holes in white.
>> > > > 
>> > > >  Please summarise the your SO thread.
>> > > > 
>> > > >  By the way, in R it is unusual for changes in one object to 
>> > > >  propagate
>> > > >  in an unintended way to another object, and this is not happening
>> > > >  here. The visual impression is being driven by polypath doing
>> > > >  different things depending on its rule setting. Look at ?polypath 
>> > > >  for
>> > > >  details.
>> > > > 
>> > > >  Well, this doesn't clarify, but it explains what is happeing, I hope 
>> > > >  ...
>> > > > 
>> > > >  Roger
>> > > > 
>> > > > > 
>> > > > >   returns a difference, but TRUE if avoidGEOS = TRUE.
>> > > > > 
>> > > > 
>> > 
>> > | Thank you for your answers guys. But I am still not fully convinced
>> >  that it is an issue of the plot function,
>> >  because the object shape_with_hole edited with checkPolygonsHoles
>> >  before, continues to behave in a strange way:
>> > 
>> > #  we check which polygons are flagged as holes.
>> > #  The flags are still set properly,
>> > #  although the plot() function didn't recognize them:
>> >  sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")
>> > 
>> >  [1] FALSE  TRUE  TRUE  TRUE
>> > 
>> >  # load library rgdal for reprojection
>> >  library(rgdal)
>> > 
>> >  # reproject with spTransform, just for testing
>> >  shape_with_hole <- spTransform(shape_with_hole, CRS("+proj=longlat
>> >  +ellps=WGS84 +datum=WGS84"))
>> > 
>> >  # after reprojection all flags are set to FALSE
>> >  sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")
>> > 
>> >  [1] FALSE FALSE FALSE FALSE
>> > 
>> > 
>> >  So it is still something wrong with shape_with_hole, or?
>>
>>  Please provide the output of sessionInfo(), rgeos::version_GEOS(), and
>>  rgdal::getGDALVersionInfo() with rgdal::getPROJ4VersionInfo(). I cannot
>>  reproduce the degradation of hole status following a no-op use of
>>  spTransform() with:
>> 
>> >  sessionInfo()
>>  R version 3.1.3 (2015-03-09)
>>  Platform: x86_64-unknown-linux-gnu (64-bit)
>>  Running under: Fedora 21 (Twenty One)
>>  ...
>>  attached base packages:
>>  [1] stats     graphics  grDevices utils     datasets  methods base
>>
>>  other attached packages:
>>  [1] rgdal_0.9-3     maptools_0.8-34 sp_1.0-17
>>
>>  loaded via a namespace (and not attached):
>>  [1] foreign_0.8-63  grid_3.1.3      lattice_0.20-31 rgeos_0.3-8
>>  [5] tools_3.1.3
>> >  rgeos::version_GEOS()
>>  [1] "3.4.2-CAPI-1.8.2 r3921"
>> >  rgdal::getGDALVersionInfo()
>>  [1] "GDAL 1.11.2, released 2015/02/10"
>> >  rgdal::getPROJ4VersionInfo()
>>  [1] "Rel. 4.9.1, 04 March 2015, [PJ_VERSION: 491]"
>>
>>  Roger
>> 
>> 
>> > 
>> >  Best
>> > 
>> >  Grigory|
>> > 
>> > 
> My session infos:
>
> sessionInfo()
> R version 3.1.1 (2014-07-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> ...
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods base
>
> other attached packages:
> [1] rgdal_0.9-1     maptools_0.8-34 sp_1.0-17
>
> loaded via a namespace (and not attached):
> [1] foreign_0.8-61  grid_3.1.1      lattice_0.20-29 tools_3.1.1
>
>
> rgeos::version_GEOS()
> [1] "3.4.2-CAPI-1.8.2 r3921"
>
> rgdal::getGDALVersionInfo()
> [1] "GDAL 1.11.0, released 2014/04/16"
>
> rgdal::getPROJ4VersionInfo()
> [1] "Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]"
>
>
> But I also obtained the same result on another windows machine with R 3.1.2 
> (dont have session info for it)

How often do you run update.packages() ? This can be done any time in the 
3.1 release cycle, as packages are compatible with R releases at that 
level unless otherwise stated. rgdal_0.9-1 was built linking against 
sp_1.0-15, as we don't lock-step packages depending on sp with its 
releases. So some of the code for creating sp objects being used in rgeos 
and rgdal at the C level is possibly out of date. Could you please try 
update.packages() with regard to the last problem which I cannot 
reproduce?

Roger

>
> Grigory
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From alexandrovich at mathematik.uni-marburg.de  Fri Apr  3 22:19:51 2015
From: alexandrovich at mathematik.uni-marburg.de (Grigory Alexandrovich)
Date: Fri, 03 Apr 2015 22:19:51 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <alpine.LFD.2.11.1504032037440.24504@reclus.nhh.no>
References: <551C32E3.1010902@mathematik.uni-marburg.de>
	<551D3B24.8070705@uni-muenster.de>
	<alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>
	<alpine.LFD.2.11.1504022223030.9896@reclus.nhh.no>
	<551E4568.3050608@mathematik.uni-marburg.de>
	<alpine.LFD.2.11.1504031309560.18824@reclus.nhh.no>
	<551E8C3B.70504@mathematik.uni-marburg.de>
	<alpine.LFD.2.11.1504032037440.24504@reclus.nhh.no>
Message-ID: <551EF5E7.5080006@mathematik.uni-marburg.de>



Am 03.04.2015 um 20:42 schrieb Roger Bivand:
> On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:
>
>>
>>
>> Am 03.04.2015 um 13:16 schrieb Roger Bivand:
>>>  On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:
>>>
>>> >  Am 02.04.2015 um 22:24 schrieb Roger Bivand:
>>> > >  On Thu, 2 Apr 2015, Roger Bivand wrote:
>>> > > > > >  On Thu, 2 Apr 2015, Edzer Pebesma wrote:
>>> > > > > > > > > > > > > > > >   On 04/01/2015 08:03 PM, Grigory 
>>> Alexandrovich wrote:
>>> > > > > >   Hello all,
>>> > > > > > >   I encountered the following unexpected result using
>>> > > > >  checkPolygonsHoles:
>>> > > > > > >   # attach the worldmap as SpatialPolygonsDataFrame from 
>>> the
>>> > > > > package >   maptools
>>> > > > > >   library(sp)
>>> > > > > >   library(maptools)
>>> > > > > >   data(wrld_simpl)
>>> > > > > > >   # get a polygon with a hole
>>> > > > > >   shape_with_hole <- wrld_simpl[5,]
>>> > > > > > >   # plot it (hole is left white, surrounded by blue color)
>>> > > > > >   plot(shape_with_hole, col = "blue")
>>> > > > > > >   # perform checkPolygonsHoles
>>> > > > > >   shape_with_hole at polygons <- 
>>> lapply(shape_with_hole at polygons,
>>> > > > > >   checkPolygonsHoles)
>>> > > > > > >   # plot again, now holes aren't recognized as such
>>> > > > > >   plot(shape_with_hole, col = "blue")
>>> > > > > > >   # and even the original SpatialPolygonsDataFrame 
>>> object is
>>> > > > >  changed !?
>>> > > > > >   plot(wrld_simpl[5,], col = "blue")
>>> > > > > > >   One irritating side effect here is that the original 
>>> object
>>> > > > >  wrld_simpl
>>> > > > > >   is also changed. This result looks to me like a bug, or 
>>> have I
>>> > > > >  missed
>>> > > > > >   something?
>>> > > > > > > > > >   It looks as if it is related to rgeos, as
>>> > > > > > > > >   avoidGEOS = FALSE
>>> > > > >   library(sp)
>>> > > > >   library(maptools)
>>> > > > >   data(wrld_simpl)
>>> > > > >   x = wrld_simpl
>>> > > > > > > > >   shape_with_hole <- wrld_simpl[5,]
>>> > > > > > > > >   if (avoidGEOS)
>>> > > > >       gpclibPermit()
>>> > > > >   shape_with_hole at polygons <- lapply(shape_with_hole at polygons,
>>> > > > >   checkPolygonsHoles,
>>> > > > >    avoidGEOS = avoidGEOS)
>>> > > > > > > > >   data(wrld_simpl)
>>> > > > >   all.equal(x, wrld_simpl)
>>> > > > > > >  No, but:
>>> > > > > > >  library(sp)
>>> > > >  library(maptools)
>>> > > >  data(wrld_simpl)
>>> > > >  x = wrld_simpl
>>> > > >  shape_with_hole <- wrld_simpl[5,]
>>> > > >  pls <- slot(shape_with_hole, "polygons")
>>> > > >  pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = FALSE)
>>> > > >  isTRUE(all.equal(pls, pls1))
>>> > > >  # TRUE
>>> > > >  gpclibPermit()
>>> > > >  pls1 <- lapply(pls, checkPolygonsHoles, avoidGEOS = TRUE)
>>> > > >  isTRUE(all.equal(pls, pls1))
>>> > > >  # FALSE
>>> > > > > > >  where the Polygon objects are re-ordered and plotted 
>>> out of order, > > >  so
>>> > > >  the deprecated gpclib code may be broken here. However, this 
>>> isn't
>>> > > >  the problem,
>>> > > > >  The gpclib code is OK, it re-orders the Polygon objects, 
>>> but the plot
>>> > >  order is correct. The problem is as described below.
>>> > > > >  Roger
>>> > > > > >  but rather (perhaps) graphics::polypath. If it is used 
>>> (by default > > > it
>>> > > >  is), and with the default path fill mode:
>>> > > > > > >  plot(x[5,], col="blue", usePolypath=TRUE, rule="winding")
>>> > > > > > >  does not whiten the holes. However:
>>> > > > > > >  plot(x[5,], col="blue", usePolypath=TRUE, rule="evenodd")
>>> > > > > > >  does. Using:
>>> > > > > > >  plot(x[5,], col="blue", pbg="white", usePolypath=FALSE)
>>> > > > > > >  also works by overpainting the island with the holes in 
>>> white.
>>> > > > > > >  Please summarise the your SO thread.
>>> > > > > > >  By the way, in R it is unusual for changes in one 
>>> object to > > >  propagate
>>> > > >  in an unintended way to another object, and this is not 
>>> happening
>>> > > >  here. The visual impression is being driven by polypath doing
>>> > > >  different things depending on its rule setting. Look at 
>>> ?polypath > > >  for
>>> > > >  details.
>>> > > > > > >  Well, this doesn't clarify, but it explains what is 
>>> happeing, I hope > > >  ...
>>> > > > > > >  Roger
>>> > > > > > > > > > > > returns a difference, but TRUE if avoidGEOS = 
>>> TRUE.
>>> > > > > > > > > > | Thank you for your answers guys. But I am still 
>>> not fully convinced
>>> >  that it is an issue of the plot function,
>>> >  because the object shape_with_hole edited with checkPolygonsHoles
>>> >  before, continues to behave in a strange way:
>>> > > #  we check which polygons are flagged as holes.
>>> > #  The flags are still set properly,
>>> > #  although the plot() function didn't recognize them:
>>> >  sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")
>>> > >  [1] FALSE  TRUE  TRUE  TRUE
>>> > >  # load library rgdal for reprojection
>>> >  library(rgdal)
>>> > >  # reproject with spTransform, just for testing
>>> >  shape_with_hole <- spTransform(shape_with_hole, CRS("+proj=longlat
>>> >  +ellps=WGS84 +datum=WGS84"))
>>> > >  # after reprojection all flags are set to FALSE
>>> >  sapply(shape_with_hole at polygons[[1]]@Polygons, slot, "hole")
>>> > >  [1] FALSE FALSE FALSE FALSE
>>> > > >  So it is still something wrong with shape_with_hole, or?
>>>
>>>  Please provide the output of sessionInfo(), rgeos::version_GEOS(), and
>>>  rgdal::getGDALVersionInfo() with rgdal::getPROJ4VersionInfo(). I 
>>> cannot
>>>  reproduce the degradation of hole status following a no-op use of
>>>  spTransform() with:
>>>
>>> >  sessionInfo()
>>>  R version 3.1.3 (2015-03-09)
>>>  Platform: x86_64-unknown-linux-gnu (64-bit)
>>>  Running under: Fedora 21 (Twenty One)
>>>  ...
>>>  attached base packages:
>>>  [1] stats     graphics  grDevices utils     datasets  methods base
>>>
>>>  other attached packages:
>>>  [1] rgdal_0.9-3     maptools_0.8-34 sp_1.0-17
>>>
>>>  loaded via a namespace (and not attached):
>>>  [1] foreign_0.8-63  grid_3.1.3      lattice_0.20-31 rgeos_0.3-8
>>>  [5] tools_3.1.3
>>> >  rgeos::version_GEOS()
>>>  [1] "3.4.2-CAPI-1.8.2 r3921"
>>> >  rgdal::getGDALVersionInfo()
>>>  [1] "GDAL 1.11.2, released 2015/02/10"
>>> >  rgdal::getPROJ4VersionInfo()
>>>  [1] "Rel. 4.9.1, 04 March 2015, [PJ_VERSION: 491]"
>>>
>>>  Roger
>>>
>>>
>>> > >  Best
>>> > >  Grigory|
>>> > > 
>> My session infos:
>>
>> sessionInfo()
>> R version 3.1.1 (2014-07-10)
>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>
>> ...
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods base
>>
>> other attached packages:
>> [1] rgdal_0.9-1     maptools_0.8-34 sp_1.0-17
>>
>> loaded via a namespace (and not attached):
>> [1] foreign_0.8-61  grid_3.1.1      lattice_0.20-29 tools_3.1.1
>>
>>
>> rgeos::version_GEOS()
>> [1] "3.4.2-CAPI-1.8.2 r3921"
>>
>> rgdal::getGDALVersionInfo()
>> [1] "GDAL 1.11.0, released 2014/04/16"
>>
>> rgdal::getPROJ4VersionInfo()
>> [1] "Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]"
>>
>>
>> But I also obtained the same result on another windows machine with R 
>> 3.1.2 (dont have session info for it)
>
> How often do you run update.packages() ? This can be done any time in 
> the 3.1 release cycle, as packages are compatible with R releases at 
> that level unless otherwise stated. rgdal_0.9-1 was built linking 
> against sp_1.0-15, as we don't lock-step packages depending on sp with 
> its releases. So some of the code for creating sp objects being used 
> in rgeos and rgdal at the C level is possibly out of date. Could you 
> please try update.packages() with regard to the last problem which I 
> cannot reproduce?
>
> Roger
>
>>
>> Grigory
>>
>>
>>
>
Roger, actually I didn't run update.packages()  on the corresponding 
spatial packages yet, since I installed them maybe two-three months ago.
Anyway, I just installed the newest R Version (3.1.3)  and the required 
packages and  the problem doesn't appear any more.
So one should take care using older versions of the rgeos/rgdal packages.

Thank you and Edzer for the concurrence and your contributions to R's 
spatial analysis toolkit.

Grigory


From fabriciovasselai at gmail.com  Sun Apr  5 21:35:28 2015
From: fabriciovasselai at gmail.com (Fabricio Vasselai)
Date: Sun, 5 Apr 2015 16:35:28 -0300
Subject: [R-sig-Geo] Very dissimilar results with Moran's I and EBI
In-Reply-To: <alpine.LFD.2.11.1503231134320.30005@reclus.nhh.no>
References: <CA+xNL7qdHpLd93SWWKVrjrCx7eRj_4u6vgAcnouX1cO=jp6t_w@mail.gmail.com>
	<alpine.LFD.2.11.1503230959230.30005@reclus.nhh.no>
	<alpine.LFD.2.11.1503231134320.30005@reclus.nhh.no>
Message-ID: <CAEkXS9K8ZEg4YG5PcZA_3Y6KTH31v82mFQKr8fveRoTC3=wTpw@mail.gmail.com>

Dears professor Bivand and Richard,

I just saw these emails today. Although I don't know exactly which was
the authors' intended formula (it is, whether it has a typo in the
paper or not), I can say the following. A couple of years ago, after a
course I took with professor Bivand, I contacted the EBI's authors
asking about whether there was a defined closed range of values for
the EBI, such as Moran's I has the [-1,1] range for row standardized W
matrices. Because I was getting some really high values for EBI, even
when using row standardized weight matrices.

Professor Assun??o replied me that he didn't look yet at that
particular question, but he also pointed specifically that an
empirical Bayes estimate is always between the crude rate and the
global average rate, which he claimed that could possibly imply that
Moran's I based on bayesian rates should also be contained between the
bounds of the usual Moran (depending on the weight matrix). The things
is, it seems to me that this scenario he was talking about can only be
true in case we subtract the mean of the EBI smoothed rates, as
professor Bivand has mentioned. Which could suggest that there might
really be a typo in the paper.

In any case I contacted professor Assun??o again last week to direct
the question to him. I recommend Richard to do the same. Let's see
what reply we might get. In any case, I will be eagerly waiting for
that new option to the EBImoran.mc, function to permit the subtraction
of the mean smoothed rate. Is there any approximate date for that to
become available? Since I've been working with comparisons between
indices, that could make for an interesting play for my research....

Best regards,

Fabricio Vasselai
Political Science Department
University of S?o Paulo


2015-03-23 7:43 GMT-03:00 Roger Bivand <Roger.Bivand at nhh.no>:
>
> On Mon, 23 Mar 2015, Roger Bivand wrote:
>
> Reason for difference inline below:
>
>> On Mon, 23 Mar 2015, Richard Asturia wrote:
>>
>>>  Dear list,
>>>
>>>  I have used a colleague's data to compare geographical clustering using
>>>  different ways of detecting clustering. Today, I found very dissimilar
>>>  results for the statistic of Moran's I and of the EBI version of Moran's I
>>>  (using spdep's EBImoran.mc), what I understand was not supposed to be the
>>>  case. In fact, with EBI it was twice as big (1.23 against 0.69).
>>>
>>>  The issue is that the EBI statistic was supposed to be similar to Moran's
>>>  I
>>>  in what regards the value of Z, while not necessarily in what regards the
>>>  p-value.
>>>
>>>  I would like to ask your advice on what seems to be going wrong. In order
>>>  to give a reproducible example without having to make you download my
>>>  shapefile, I wrote a code that creates precisely the same neighborhood
>>>  structure of the map I am using.
>>
>>
>> Thanks for trying to provide an example. Unfortunately, you posted HTML, which makes it very hard to copy and paste from any email client. The correct way to move an nb object would be:
>>
>> nb <- structure(list(21L, c(8L, 9L, 11L, 18L, 20L, 22L, 25L), c(10L,
>> 14L, 26L), c(8L, 25L), c(6L, 12L, 15L, 23L, 26L), c(5L, 12L,
>> 13L, 18L, 27L), c(13L, 16L, 18L, 24L), c(2L, 4L, 20L, 25L), c(2L,
>> 11L, 16L, 17L, 20L, 21L), c(3L, 14L, 28L), c(2L, 9L, 16L, 18L
>> ) , c(5L, 6L, 13L, 23L), c(6L, 7L, 12L, 18L, 19L, 23L, 24L, 27L
>> ) , c(3L, 10L, 26L, 28L), c(5L, 26L), c(7L, 9L, 11L, 18L, 21L),
>>     c(9L, 20L, 21L), c(2L, 6L, 7L, 11L, 13L, 16L, 22L, 27L),
>>     c(13L, 23L, 24L, 26L), c(2L, 8L, 9L, 17L, 21L), c(1L, 9L,
>>     16L, 17L, 20L), c(2L, 18L, 25L), c(5L, 12L, 13L, 19L, 26L
>>    ) , c(7L, 13L, 19L), c(2L, 4L, 8L, 22L), c(3L, 5L, 14L, 15L,
>>    19L, 23L), c(6L, 13L, 18L), c(10L, 14L)), class = "nb", region.id = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13",
>> "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24",
>> "25", "26", "27", "28"), call = NA, sym = TRUE)
>>
>> constructed by using dput() - so using spaces permitting line breaks, and for the others:
>>
>> cases <- c(5, 55, 6, 14, 22, 2, 8, 159, 158, 0, 15, 85, 21, 8, 3, 27,
>> 1128, 18, 16, 101, 72, 14, 1, 55, 18, 6, 0, 4)
>>
>> pop <- c(865, 4534, 9708, 1799, 4929, 2154, 4159, 10414, 10917, 1420,
>> 1166, 26098, 8417, 3049, 1853, 2419, 49108, 2982, 4218, 6824,
>> 6923, 1961, 1259, 13661, 2418, 3672, 811, 1375)
>>
>> and
>>
>> my.listW <- nb2listw(nb, style="W")
>>
>> Could you please say why you expect the values of I to be similar? Is this claimed in:
>>
>> Assun??o RM, Reis EA 1999 A new proposal to adjust Moran's I for
>> population density. Statistics in Medicine 18, pp. 2147-2162
>
>
> On p. 2157, EBI is n/S0 * sum(z_i*lag(z_i))/sum((z_i - \bar(z))^2)
>
> so sum(z_i*lag(z_i)) is implemented as it stands. If we change this to differences from the mean of z:
>
> sum((z_i - \bar(z))*(lag(z_i - \bar(z))))
>
> we get the same result as moran() on the EB smoothed rates. So the question is whether subtracting the mean of the EB smoothed rates in the numerator was intended but that there is a misprint in the paper, or whether it was intentionally omitted. The implementation follows the printed formula.
>
> I'll add an option to the function to permit the subtraction of the mean smoothed rate.
>
> Roger
>
>>
>> Running
>>
>> summary(glm(cases ~ 1 + offset(log(pop)), family=quasipoisson))
>>
>> suggests that the data are overdispersed, so the assumptions for empirical Bayes adjustment may not be met. For Negative Binomial alternatives, see the DCluster package.
>>
>> Hope this helps,
>>
>> Roger
>>
>> PS. It would be helpful to know why you are asking, and very helpful to have an affiliation in your signature. At least you use a real name!
>>
>>>
>>>  Any advice will be very much appreciated.
>>>
>>>  Thanks in advance,
>>>
>>>  RA
>>>
>>>
>>> # THE CODE:
>>> # obviously loading the package:
>>>
>>>  require(spdep)
>>>
>>>  #this big messy piece of code recreates in matrix form the neighborhood
>>>  structure:
>>>  neighb.structure
>>>  <-matrix(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.142857142857143,0.142857142857143,0,0.142857142857143,0,0,0,0,0,0,0.142857142857143,0,0.142857142857143,0,0.142857142857143,0,0,0.142857142857143,0,0,0,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0.333333333333333,0,0,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0,0,0,0.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0,0,0,0,0,0,0,0.2,0,0,0,0,0,0.2,0,0,0.2,0,0,0,0,0,0,0,0.2,0,0,0.2,0,0,0,0,0,0,0.2,0,0,0,0,0,0,0.2,0.2,0,0,0,0,0.2,0,0,0,0,0,0,0,0,0.2,0,0,0,0,0,0,0,0,0,0,0,0,0,0.25,0,0,0.25,0,0.25,0,0,0,0,0,0.25,0,0,0,0,0,0.25,0,0.25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.25,0,0,0,0,0.25,0,0,0,0,0.166666666666667,0,0,0,0,0,0,0,0,0.166666666666667,0,0,0,0,0.166666666666667,0.166666666666667,0,0,0.166666666666667,0.166666666666667,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0.25,0,0,0,0,0,0,0.25,0,0,0,0,0,0,0.25,0,0.25,0,0,0,0,0,0,0,0
>>>  ,0,!
>>>  0,0,0,0,0,0.25,0.25,0,0,0,0,0,0,0.25,0,0,0,0,0,0,0,0,0,0.25,0,0,0,0,0,0,0,0,0,0,0.125,0.125,0,0,0,0,0.125,0,0,0,0,0,0.125,0.125,0,0,0,0.125,0.125,0,0,0.125,0,0,0,0.25,0,0,0,0,0,0,0.25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.25,0,0.25,0,0,0,0,0.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0,0,0,0,0,0,0,0.2,0,0.2,0,0.2,0,0,0,0,0,0,0.2,0,0,0.2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0,0,0,0,0.333333333333333,0.333333333333333,0,0,0,0,0,0,0,0,0.125,0,0,0,0.125,0.125,0,0,0,0.125,0,0.125,0,0,0.125,0,0,0,0,0,0.125,0,0,0,0,0.125,0,0,0,0,0,0,0,0,0,0,0,0,0,0.25,0,0,0,0,0,0,0,0,0,0.25,0.25,0,0.25,0,0,0,0.2,0,0,0,0,0,0.2,0.2,0,0,0,0,0,0,0,0.2,0,0,0,0.2,0,0,0,0,0,0,0,0.2,0,0,0,0,0,0,0,0.2,0,0,0,0,0,0,0.2,0.2,0,0,0.2,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0,0.2,0,0,0,0,0,0,0.2,0.2,0,0,0,0,0,0.2,0,0,0,0,0,0,0.2,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0.33
>>>  33!
>>>  33333333333,0,0,0,0,0,0,0,0,0,0,0.25,0,0.25,0,0,0,0.25,0,0,0,0,0,0,0,0
>>>  ,0,0,0,0,0,0.25,0,0,0,0,0,0,0,0,0.166666666666667,0,0.166666666666667,0,0,0,0,0,0,0,0,0.166666666666667,0.166666666666667,0,0,0,0.166666666666667,0,0,0,0.166666666666667,0,0,0,0,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0.333333333333333,0,0,0,0,0.333333333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0,0,0.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0),28,28)
>>>
>>>  #recreating the absolute value of the cases of interest in each feature of
>>>  the map:
>>>  cases <-
>>>  c(5,55,6,14,22,2,8,159,158,0,15,85,21,8,3,27,1128,18,16,101,72,14,1,55,18,6,0,4)
>>>
>>>  #recreating  the absolute value of the population in each feature of the
>>>  map:
>>>  pop <-
>>>  c(865,4534,9708,1799,4929,2154,4159,10414,10917,1420,1166,26098,8417,3049,1853,2419,49108,2982,4218,6824,6923,1961,1259,13661,2418,3672,811,1375)
>>>
>>>  #recreating the rate values in each feature of the map:
>>>  rates <- cases/pop
>>>
>>>  #generating a listW:
>>>  neighb.structure <- t(neighb.structure)
>>>  row.names(neighb.structure) <-
>>>  my.listW <- mat2listw(neighb.structure)
>>>
>>>  #running the tests:
>>>  moran.test(x=rates, listw=my.listW)
>>>  moran.mc(x=rates, listw=my.listW, nsim=999)
>>>  EBImoran.mc(n=cases, x=pop, listw=my.listW, nsim=999)
>>>
>>>   [[alternative HTML version deleted]]
>>>
>>>  _______________________________________________
>>>  R-sig-Geo mailing list
>>>  R-sig-Geo at r-project.org
>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jimmyjmv at hotmail.com  Mon Apr  6 18:12:54 2015
From: jimmyjmv at hotmail.com (Jimmy Neutron)
Date: Mon, 6 Apr 2015 09:12:54 -0700
Subject: [R-sig-Geo] Working with Poisson distribution (geoRglm)
Message-ID: <BLU182-W4438A6755355D8667B06C2C4FE0@phx.gbl>

Hi comRades:
I realized that I'm working with count data (survey in the sea).
My 'geodata' (which I named a2008.posCEROSbin) is such as:       xUTMkm   yUTMkm 'Count'1385 450.1202 1011.425   01386 450.4273 1007.219   01387 450.2584 1011.884   01388 450.1696 1010.261   01389 450.1718 1009.887   01390 450.6981 1004.379   0...
I read the geoRglm structure. What does it mean that I have to make a empiric variogram?. I usually worked with binomial data (Success, No-Success). Then, my empiric variogram was such as:
a2008.posCEROS.spmod<-list(cov.pars=c(1,20),beta=1.0,cov.model="matern",nugget=0,kappa=0.35,family="binomial",link="logit")
Now, I suppose that, with my 'geodata' (which I named a2008.posCEROSbin), my Poisson model should be as following:
a2008.posCEROS.spmod<-list(cov.pars=c(1,20),beta=1.0,cov.model="matern",nugget=0,kappa=0.35,family="poisson",link="logit")
After that, I will generate MCMC simulations, such as:a2008.posCEROS.mcmc<-mcmc.control(S.scale=0.582, thin=10) #mcmc marc of change monte carlo, S.scale
However, when I do:a2008.posCEROS.tune<-glsm.mcmc(a2008.posCEROSbin, model=a2008.posCEROS.spmod, mcmc.input=a2008.posCEROS.mcmc)...I have this sentence:
Error in if (lambda == 0) {: argument has zero length.
I'd like to know where is my mistake. I think that I am not making right my empirical Poisson model.
My goal is to predict how many 'Count' do I have in the whole survey.
Thanks in advance for youR help.
Jimmy M. 		 	   		  
	[[alternative HTML version deleted]]


From ferra.xu at yahoo.com  Mon Apr  6 21:21:36 2015
From: ferra.xu at yahoo.com (Ferra Xu)
Date: Mon, 6 Apr 2015 19:21:36 +0000 (UTC)
Subject: [R-sig-Geo] How to calculate the integral of the sum of two kernel
 density functions in R?
Message-ID: <1116779937.478011.1428348096591.JavaMail.yahoo@mail.yahoo.com>

I want to calculate the non-deterministic integral (0 to t) of the sum of two kernel density functions in R. Here is the code that I wrote:?


library(ks)?library(rgl)
? ? zz <- " longitude ? latitude ? ?depth ? time ? ?magnitude? ? 363.218744 ?52.38412991 3.04532258 ?9.241866766 0.838097648363.685488 ?53.85946071 0.25531946 ?0.578126952 0.854703175319.732091 ?32.23166292 4.2952681 ? 1.06539397 ?0.781598317315.812817 ?36.98421462 3.27938697 ?2.295483245 0.769473951119.498255 ?75.1280934 ?0.83253364 ?8.783517513 0.969860223138.588107 ?169.629965 ?1.89874255 ?9.745653758 0.972609198139.158872 ?169.6452912 3.67211991 ?15.03850063 0.881092856139.247168 ?169.3478202 2.85800531 ?15.26106239 0.80957094565.1234 147.3603323 2.84478705 ?16.82280753 0.8795771565.55518 ? ?147.0377814 2.69845292 ?20.23640417 0.90054614467.954278 ? 148.6017748 3.41456545 ?21.21715903 0.96836922766.968587 ? 146.3484298 2.33379707 ?22.02860946 0.726200657359.087074 ?42.8644051 ?2.85850316 ?23.70757068 0.861703105357.875617 ?40.08052697 2.90391604 ?23.84198256 0.828534981358.483231 ?41.26875168 1.98773836 ?26.06830006 0.885146048358.218523 ?40.27344373 0.61176635 ?28.24887694 0.86766276356.391874 ? 87.82219658 1.18588976 ?31.82632342 0.76775520656.355593 ? 87.68729915 1.37666954 ?33.07983844 0.73135585956.274533 ? 88.16157107 1.8140712 ? 33.21245517 0.70299329758.264625 ? 90.59810498 0.71927382 ?36.35112295 0.717745991296.051213 ?47.32622119 3.55526758 ?37.01360264 0.796795711296.428135 ?47.14235728 0.37586386 ?40.99409991 0.933842952296.483974 ?47.11833773 1.63577079 ?42.59987436 0.800643576149.978704 ?40.21568522 0.86039359 ?43.88742522 0.885870584152.913486 ?41.02065553 1.60530239 ?44.22730093 0.997865715148.90665 ? 41.08012738 3.93188008 ?45.45667836 0.894401708346.076543 ?139.8808064 1.85955423 ?46.43473917 0.861932746346.414328 ?139.4533544 1.11412982 ?47.08968108 0.769676426345.144434 ?138.4076443 1.90880173 ?47.41656879 0.921949668347.214491 ?139.3465751 2.37729226 ?48.71147851 0.966697704332.753563 ?192.22991 ? 2.28814891 ?50.57969649 0.957942288334.317276 ?189.9511419 3.86455092 ?50.68494991 0.879118237333.754131 ?189.9786093 2.97285931 ?51.75537529 0.896425643369.001883 ?49.03757175 3.850737 ? ?53.25133012 0.974504198373.451478 ?47.04323055 2.68174275 ?53.26729487 0.829954924371.270915 ?48.75191315 1.48038601 ?53.65752507 0.786928227100.980042 ?229.3257773 0.34910759 ?53.95915957 0.88956469185.373887 ?191.1246659 0.77164573 ?55.59813846 0.788626552186.209454 ?190.9779546 1.56667836 ?57.767241 ? 0.886608637185.124518 ?191.2527261 0.29458722 ?60.01364617 0.714260258185.914337 ?190.2745825 2.52740599 ?60.61554743 0.99838296967.896372 ? 155.4809072 0.28886827 ?61.31286449 0.762029245142.43641 ? 227.5860602 4.14452355 ?62.29628681 0.882209187141.364062 ?228.3322702 4.1635609 ? 63.89678201 0.804289098347.840723 ?114.6970218 0.56248091 ?63.95948138 0.91532112253.564593 ?174.113376 ?1.2621932 ? 64.24838467 0.708397989253.984435 ?174.5656449 1.51828163 ?65.07176672 0.720052528253.0236 ? ?173.9265349 1.23375198 ?65.94064053 0.978119242231.629097 ?211.4394495 1.30405063 ?66.38331454 0.726331528232.328374 ?210.8879029 2.03407748 ?66.68961587 0.799719569232.644377 ?211.2277656 0.97238417 ?68.10333701 0.857854269232.56663 ? 211.1678557 0.13184224 ?68.29747246 0.773992637112.295704 ?228.7487399 2.55766852 ?70.99561628 0.862869837113.023663 ?228.1650996 3.59402383 ?71.87466297 0.934260355112.538871 ?228.4575775 1.45766956 ?77.57275212 0.856564714113.814248 ?228.2794604 3.42350373 ?78.59894388 0.97958498183.44226 ? 9.61564954 ?3.18554848 ?79.43332479 0.744133594183.54304 ? 9.19009803 ?3.26511022 ?80.64811426 0.825029711183.268762 ?9.301064 ? ?2.44033259 ?85.7161253 ?0.784087865.369079 ? ?116.1726895 1.63053766 ?86.89113268 0.8794300954.970461 ? ?116.4974335 2.93526191 ?87.42088984 0.7109424576.345342 ? ?116.6858803 0.89072222 ?87.63073063 0.7191059515.492747 ? ?115.8670653 1.61844848 ?89.67642448 0.796864752343.385969 ?193.322461 ?2.62979605 ?89.94483446 0.729513559344.352781 ?193.5268701 4.29402892 ?90.4154695 ?0.751013388345.668421 ?193.0400517 3.1033618 ? 91.93169629 0.81134914344.640169 ?194.248506 ?1.57956728 ?92.33756179 0.711928487167.038399 ?5.96957805 ?3.55962707 ?94.67162694 0.912772286166.987777 ?6.09536737 ?3.45933516 ?96.09079729 0.892402408168.510068 ?6.14462771 ?3.46656886 ?96.53093276 0.752218258167.103837 ?6.28745699 ?3.55633497 ?97.11208455 0.718645583183.30843 ? 45.57593198 0.24446465 ?98.29165891 0.821997826183.036565 ?51.9529565 ?0.52456176 ?98.81054412 0.838918878183.144323 ?45.93514679 0.47791706 ?99.81095514 0.76080229338.977521 ?169.6576259 2.49761535 ?100.8103695 0.960864967338.821559 ?170.0718334 2.66390501 ?101.5614461 0.879382111337.682972 ?172.5078824 2.44075925 ?102.5406185 0.706904061339.414764 ?168.484822 ?3.07636237 ?102.5455371 0.969827931336.702388 ?194.6364837 3.67393227 ?103.0440893 0.835883835360.026772 ?184.3444998 3.62982366 ?103.3028211 0.717407853361.460234 ?184.3184775 0.96558388 ?103.369371 ?0.731880813247.557142 ?184.8726881 4.39064255 ?103.4793669 0.999527587249.630948 ?186.9021382 3.2051117 ? 104.2020101 0.959898221246.647174 ?185.7989473 1.89101073 ?104.2744971 0.884561739248.079025 ?184.8060252 3.64218348 ?106.7323829 0.708083345343.213475 ?214.4993165 0.45176581 ?107.1307404 0.796756791345.720762 ?213.6341763 1.63235709 ?108.0652973 0.83913287345.016305 ?212.8656785 1.28675708 ?108.2516714 0.72970517345.462936 ?213.150121 ?2.88754323 ?110.0171049 0.871296443186.053395 ?7.62715418 ?2.02691573 ?112.650555 ?0.797762528182.455458 ?4.26944797 ?2.45740267 ?114.2678386 0.835147701182.235994 ?4.39627706 ?0.26503411 ?114.7318806 0.873353139409.403475 ?82.39618618 0.06216757 ?115.4464072 0.722453292409.052314 ?82.35559269 0.16314584 ?115.5665069 0.717202801215.780351 ?0.08912318 ?1.39563448 ?116.2344263 0.790286931214.837434 ?1.45883443 ?0.97705113 ?117.218643 ?0.856516375461.589113 ?9.86224616 ?0.9972708 ? 117.971268 ?0.868564071459.202929 ?11.42966468 1.15177071 ?118.8073097 0.772466431459.088894 ?15.47868051 2.3559397 ? 121.4164909 0.973816049256.903777 ?87.43673381 2.04200349 ?121.5194263 0.947720281257.382498 ?86.97386698 3.79079014 ?121.6251341 0.833363765256.697794 ?87.54199636 2.55432997 ?121.6996209 0.994618769222.945818 ?200.9308941 2.84077044 ?121.7241906 0.873480268222.819858 ?201.6746837 2.29641155 ?122.7084014 0.770327049222.130409 ?201.4562846 1.27840311 ?123.3858524 0.943177133384.260699 ?147.0320964 2.79131573 ?123.5775361 0.835382249381.993241 ?146.3060028 1.35450405 ?124.1866165 0.774990751382.080971 ?147.3370846 3.71228941 ?125.0491715 0.98663126381.648904 ?146.8234101 1.83454687 ?125.0912787 0.742795104474.324216 ?21.06180692 0.11079926 ?125.1323202 0.853769015475.098888 ?18.72632807 0.7689708 ? 125.1400455 0.991577541472.708781 ?21.18145004 1.53044597 ?126.206574 ?0.894496186261.054388 ?196.4845601 2.85653651 ?126.4870562 0.884401301261.104845 ?196.6365273 2.96048717 ?126.8060731 0.840895112260.23671 ? 197.1606291 2.73990119 ?128.0764361 0.873334209261.085155 ?196.6737482 2.69219319 ?128.5328058 0.97339396812.009559 ? 160.8273903 0.89371542 ?129.4377345 0.81286608511.849503 ? 160.841293 ?1.14120928 ?129.6794689 0.76862943212.345148 ? 160.5244702 1.28818423 ?129.8214878 0.82705746111.135317 ? 160.7668114 1.65208029 ?130.7028618 0.78207886631.623888 ? 130.3067685 2.1127655 ? 132.5014859 0.83336975327.170348 ? 129.6318075 1.40646722 ?132.5051924 0.88825451431.403392 ? 130.7047954 2.29731991 ?132.8479736 0.86039237629.923974 ? 131.9784448 1.92817547 ?133.6366443 0.81563264890.074671 ? 59.07610607 1.23271524 ?134.6497729 0.9620350387.906549 ? 54.82957282 0.65955499 ?135.3859154 0.7901046289.899048 ? 57.83154064 0.30141145 ?135.5092119 0.820008915276.323019 ?6.86787982 ?1.7776151 ? 135.5215818 0.855317054275.970301 ?7.91419119 ?3.21748128 ?135.6636361 0.718547414275.727285 ?8.3243395 ? 1.94806409 ?136.057032 ?0.769410166276.514291 ?7.01085361 ?1.43467439 ?137.343003 ?0.735545797330.040302 ?144.5877302 0.66277381 ?137.4281315 0.729634011324.893213 ?146.4365159 0.88234134 ?137.6037721 0.967082637291.11468 ? 49.33367767 2.47072766 ?138.7895341 0.710016723293.43458 ? 48.62581312 1.98062144 ?139.3682232 0.951710498250.764567 ?198.5016519 0.85846877 ?140.0507716 0.852180017253.539089 ?201.132831 ?1.49089404 ?140.9996563 0.734114932253.512945 ?201.0537249 2.4727616 ? 141.0409587 0.847133697253.542791 ?201.2490377 1.98635162 ?142.6391569 0.879832516257.795509 ?216.9359492 0.78064425 ?145.1118214 0.72706484257.764285 ?216.4872431 2.80925094 ?145.1624047 0.99346721257.818943 ?216.6897931 2.33814072 ?145.9038514 0.895905632257.774863 ?216.6051295 2.44114347 ?145.9367341 0.838339638367.514438 ?31.4793139 ?0.78736947 ?146.1964166 0.959127433367.588968 ?31.4867048 ?0.96941256 ?146.2887533 0.778848722369.492049 ?30.48020726 2.4794555 ? 150.0217156 0.947188883143.865075 ?233.3690032 1.67318663 ?150.4491923 0.798692592144.098544 ?234.3763707 0.23773927 ?150.5166887 0.982390159218.32888 ? 216.7083106 2.74041746 ?151.0604421 0.773232421325.353164 ?143.7297267 2.96706415 ?151.763207 ?0.98713305326.419993 ?143.5201895 3.63452168 ?152.3832321 0.853247489325.936613 ?144.5316032 2.32157168 ?153.3589663 0.869373958325.810082 ?144.356522 ?4.39008693 ?153.4582455 0.99811483931.910325 ? 124.5598197 2.33494244 ?153.6579228 0.93129518231.351707 ? 125.4332729 2.30507449 ?154.0737073 0.79414057631.574903 ? 124.0463483 0.75565309 ?154.0886993 0.71736178732.54375 ? ?122.7135364 2.18675079 ?154.2861579 0.71322213890.008543 ? 124.8990934 1.97911207 ?154.3444858 0.94388319190.28441 ? ?126.6897782 1.01474716 ?154.9277926 0.82362198387.735243 ? 125.8623578 3.00304403 ?155.2644112 0.815248951260.385862 ?96.59499166 3.96772436 ?156.995524 ?0.85693796259.739291 ?97.04823338 2.61008235 ?157.5583662 0.96764469260.311284 ?96.68968926 4.22429753 ?157.6724828 0.821776192260.229276 ?95.34657991 2.54473831 ?157.7533106 0.881316669260.212422 ?187.7862368 4.31051589 ?157.9162288 0.728441067260.231256 ?188.2226327 3.3502332 ? 158.0074879 0.800794383261.545309 ?191.0387749 3.93897914 ?158.0767802 0.743452552272.998243 ?214.0871297 0.58707332 ?158.0785985 0.773464159272.69374 ? 214.5296828 1.42084384 ?159.6240869 0.813691498274.126863 ?212.7891744 0.26609394 ?159.9565838 0.781095884367.90561 ? 15.41286762 2.95145208 ?160.5243755 0.76467979367.864872 ?15.25877454 2.64007335 ?161.3173639 0.890119333367.649781 ?19.91579374 3.97005021 ?161.9414598 0.939914671148.118458 ?177.8767452 0.7438971 ? 162.0120391 0.762554208147.655051 ?176.9144773 1.3703557 ? 162.030937 ?0.968876858148.050091 ?176.9031162 1.30790609 ?162.3061767 0.923712841147.649022 ?175.9846377 0.01212553 ?162.6304654 0.860915742356.818492 ?67.21939123 1.76786772 ?164.2579604 0.990989558355.622664 ?68.75829882 3.19659511 ?164.3880109 0.869464951355.844738 ?68.88550929 4.36517304 ?164.7900766 0.76530697108.71847 ? 215.0266242 1.98752526 ?166.393087 ?0.957328986109.014859 ?214.6488939 3.20229933 ?167.6177713 0.958599795109.164433 ?215.2627269 1.93777216 ?167.8951075 0.793990658108.131203 ?215.0862499 2.35653921 ?168.2758637 0.798095263196.231361 ?70.49924437 1.97858279 ?168.4511479 0.952004021197.737244 ?72.88240664 0.65482871 ?169.5036831 0.847759836339.257305 ?120.888616 ?1.34736322 ?169.6356306 0.715570745340.781081 ?117.0187847 2.51971051 ?169.6790878 0.933405511338.606336 ?121.5834442 1.80270464 ?170.3047686 0.828001716338.041063 ?120.7029464 1.73078138 ?170.3913998 0.783988564338.99619 ? 35.10033383 2.97337925 ?170.4444717 0.800052404337.200856 ?33.51899806 1.09814538 ?170.613345 ?0.810081986336.985755 ?34.21892728 0.24128014 ?170.8469088 0.938437723220.803763 ?53.14430613 1.29837937 ?170.8645578 0.711607236221.630219 ?52.1940613 ?1.79796509 ?171.6146056 0.91800080198.635642 ? 121.5862813 2.9432507 ? 171.8511343 0.96180533898.382482 ? 121.1350972 1.85599348 ?171.9082703 0.78574443595.692992 ? 121.8135249 2.76335185 ?172.186239 ?0.89705477895.455554 ? 121.1536975 3.06349446 ?172.3154888 0.76956598829.902259 ? 220.4663988 0.032004 ? ?172.6212011 0.88658618228.41221 ? ?220.079011 ?0.64563437 ?172.71164 ? 0.7225371328.608348 ? 219.9848542 0.81174981 ?173.474008 ?0.99002676328.837549 ? 219.7118007 0.88414209 ?176.6881568 0.882990987417.469016 ?60.71793319 3.13009015 ?178.4274218 0.815114554420.412299 ?59.95963986 3.77420788 ?178.5608842 0.709170932417.835488 ?61.34888422 3.412701 ? ?179.0698474 0.957269676266.303184 ?148.8628134 4.14332284 ?179.975606 ?0.881062956266.264066 ?149.8292293 4.17012164 ?180.080254 ?0.954352122290.584215 ?94.18249675 2.09946968 ?180.3264641 0.851384874211.043848 ?164.8354141 0.38617853 ?180.4780309 0.702373251394.665914 ?165.8533229 2.94896243 ?180.6401804 0.975721953396.948844 ?164.3185096 2.95721695 ?181.189757 ?0.823211439394.152446 ?166.1863908 2.85283338 ?181.4459117 0.919709724355.861861 ?151.482828 ?1.79907458 ?181.5735067 0.745331584355.604564 ?151.2328554 1.42786694 ?182.0786425 0.944569983355.977914 ?151.7258945 2.60632787 ?182.2734472 0.9728807655.193224 ? 70.13457335 1.95421619 ?182.4681836 0.93338273855.121245 ? 70.26190069 1.7134954 ? 182.7419885 0.927136941466.029024 ?43.60374817 3.02745392 ?183.048289 ?0.821559257466.713681 ?43.04071215 3.34442703 ?183.0495735 0.910570324361.343579 ?38.84946077 4.09011265 ?183.1337707 0.869638281107.494724 ?224.061154 ?0.64225969 ?184.3347164 0.875420906109.403587 ?222.7703059 1.02129489 ?184.5405119 0.80347438108.536435 ?221.8397702 1.32737534 ?185.2302114 0.911269972108.966261 ?223.5009692 0.64308213 ?185.599194 ?0.748259104319.258848 ?64.01371204 4.34421863 ?185.7281496 0.70045418321.53673 ? 62.05801435 4.02840039 ?185.9683567 0.868600256320.136879 ?62.7561261 ?2.02796518 ?186.1012058 0.863945237426.321536 ?79.57156783 1.80279196 ?186.1655452 0.865248329425.254692 ?80.84699203 0.53246863 ?186.351376 ?0.908361028424.301716 ?81.17660654 0.05602379 ?186.4132518 0.978248228424.827296 ?81.04033515 1.33209986 ?186.4734765 0.983263093119.807247 ?187.958236 ?3.33382966 ?186.7652667 0.970978999120.210092 ?189.4849366 2.84489764 ?187.4376306 0.881231886120.205569 ?189.1727403 4.18836325 ?187.4622579 0.977862927247.808605 ?146.4244449 0.83110586 ?188.5004803 0.735083878249.294833 ?144.1907226 1.22128356 ?188.962155 ?0.802240452250.204516 ?146.4749518 1.7944476 ? 189.3051254 0.711019133334.654137 ?11.15448488 3.46662664 ?189.8126837 0.861510955333.659862 ?11.64954098 2.1332473 ? 190.1436423 0.92116864333.427405 ?10.95652538 2.75561873 ?191.3076606 0.7543667519.482643 ? ?85.46858555 1.15438219 ?191.3293578 0.8278739989.378643 ? ?85.45893223 2.23185957 ?191.4270999 0.7294503879.333447 ? ?84.55839727 1.36554428 ?192.1174705 0.79096647439.424485 ?237.4993259 0.59464444 ?192.4302016 0.934036784438.638525 ?238.1309002 0.47642958 ?192.835047 ?0.861088125439.977322 ?237.950318 ?1.51017279 ?193.0183715 0.93072143438.636146 ?237.9862702 1.3178479 ? 193.2070887 0.891683094330.410302 ?62.51368701 2.99926551 ?193.8201965 0.967944474329.790522 ?62.17494892 2.86913557 ?194.8657309 0.718207116329.460954 ?62.13150555 3.26717085 ?195.1562923 0.752731464474.563651 ?69.88329745 4.03771076 ?195.1657446 0.824899558285.627382 ?72.98472026 1.95847784 ?196.1019459 0.921937552286.820235 ?72.90395374 1.26502975 ?196.2494223 0.967886438236.897161 ?134.567653 ?1.15564329 ?196.4295919 0.707755992234.806852 ?133.6690276 0.210115 ? ?196.5220457 0.741268909233.53859 ? 132.9487054 2.28750244 ?196.5612547 0.82722623277.005222 ?47.68301903 4.36155011 ?196.6331458 0.929370035277.336998 ?44.11638043 3.06712344 ?197.5726448 0.857331156277.800836 ?43.03107739 3.70528439 ?197.5837294 0.926344408276.793356 ?44.16753185 3.20462984 ?197.9290181 0.750939533165.177531 ?248.6222625 0.3374573 ? 197.9766126 0.901818102164.463612 ?249.5902955 1.32364566 ?198.1684532 0.885595823161.499292 ?251.3536746 1.75217305 ?198.2615641 0.702053827440.799878 ?176.1199082 3.19808685 ?198.3114499 0.922067657441.798136 ?176.5611422 2.98843581 ?198.9449421 0.997520643441.027104 ?176.7791779 3.08648705 ?199.572324 ?0.738454407"
y1 <- read.table(text=zz, header = TRUE)
zzz <- " longitude ?latitude ? ?depth ? time ? ?magnitude277.728371 ?139.925845 ?0.75103658 ?26.40786514 0.943718276426.087586 ?168.903095 ?0.2957441 ? 0.241456485 0.759137864331.549444 ?74.168092 ? 0.55140397 ?66.51363095 0.77617643393.078983 ? 78.588053 ? 0.15328453 ?104.9418546 0.834896464492.359229 ?11.082291 ? 0.08173915 ?111.3391451 0.87479811986.85704 ? ?42.34973 ? ?0.23081904 ?152.8098572 0.878111793128.038949 ?73.935782 ? 0.66160123 ?157.8933315 0.990100773295.300125 ?1.935765 ? ?0.49789785 ?159.9134319 0.842815655294.688309 ?1.024583 ? ?0.44789667 ?165.7092358 0.886545275221.246937 ?151.217171 ?0.6337224 ? 167.6213491 0.885163617111.240376 ?156.04214 ? 0.55752237 ?171.2039395 0.88527352625.929383 ? 136.975153 ?0.0271747 ? 172.6574772 0.812214826415.726989 ?158.482975 ?0.37340509 ?184.3767148 0.9083717473.921877 ? 60.031908 ? 0.15224511 ?189.6429637 0.7914032288.811256 ? ?124.676545 ?0.26806101 ?193.7498013 0.813638308"y2 <- read.table(text=zzz, header = TRUE)
evpts1 <-do.call(expand.grid, ?lapply(y1,quantile, prob=c(.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8, .85,.9,.95)))hat1 <- kde(y1, eval.points= evpts1)
evpts2 <-do.call(expand.grid, ?lapply(y2,quantile, prob=c(.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8, .85,.9,.95)))hat2 <- kde(y2, eval.points= evpts2)
str(hat1)str(hat2)
integrand1 <- function(p){hat1(p,y1)+hat2(p,y2)}
Vintegrand <- Vectorize(integrand1)
integrate( Vintegrand, lower = 0, upper = t)


But it gives me error.?I appreciate any help in advance.

	[[alternative HTML version deleted]]


From jimmyjmv at hotmail.com  Mon Apr  6 21:47:54 2015
From: jimmyjmv at hotmail.com (Jimmy Neutron)
Date: Mon, 6 Apr 2015 12:47:54 -0700
Subject: [R-sig-Geo] geoRglm doesn't work with R v. 2.7.1
Message-ID: <BLU182-W6083893F41D5F3D6A4D1F1C4FE0@phx.gbl>

Dear comRades:
I use Tinn-R because it's is faster to open the 'R gui' option to open R. This function only works with not all R versions, then I am still working with R v. 2.7.1.
One week ago I normally worked with the package PBSmapping, but today I realize that such package doesn't appear in my list. Why?. Is there any way to keep working with PBSmapping with my R version?.
Thanks in advance for you help. 		 	   		  
	[[alternative HTML version deleted]]


From thierry.onkelinx at inbo.be  Mon Apr  6 23:44:31 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Mon, 6 Apr 2015 23:44:31 +0200
Subject: [R-sig-Geo] geoRglm doesn't work with R v. 2.7.1
In-Reply-To: <BLU182-W6083893F41D5F3D6A4D1F1C4FE0@phx.gbl>
References: <BLU182-W6083893F41D5F3D6A4D1F1C4FE0@phx.gbl>
Message-ID: <CAJuCY5zkBQ6UHPNAg=iFpwpj5JzqfGhok6P4WmsYJjgcijg2_w@mail.gmail.com>

R ?2.7.1 is six years old. That's ancient. You really need to upgrade.

	[[alternative HTML version deleted]]


From jimmyjmv at hotmail.com  Tue Apr  7 16:07:17 2015
From: jimmyjmv at hotmail.com (Jimmy Neutron)
Date: Tue, 7 Apr 2015 07:07:17 -0700
Subject: [R-sig-Geo] geoRglm doesn't work with R v. 2.7.1
In-Reply-To: <BLU182-W6083893F41D5F3D6A4D1F1C4FE0@phx.gbl>
References: <BLU182-W6083893F41D5F3D6A4D1F1C4FE0@phx.gbl>
Message-ID: <BLU182-W83BF9239D107D8A554638C4FD0@phx.gbl>

Solved problem. Thanks to all!.
If any one uses Tinn-R, it is a pity that, in the last version, we can't use the Space-bar as a Hot-key. Does anyone know how to do it so?.

> From: jimmyjmv at hotmail.com
> To: r-sig-geo at r-project.org
> Date: Mon, 6 Apr 2015 12:47:54 -0700
> Subject: [R-sig-Geo] geoRglm doesn't work with R v. 2.7.1
> 
> Dear comRades:
> I use Tinn-R because it's is faster to open the 'R gui' option to open R. This function only works with not all R versions, then I am still working with R v. 2.7.1.
> One week ago I normally worked with the package PBSmapping, but today I realize that such package doesn't appear in my list. Why?. Is there any way to keep working with PBSmapping with my R version?.
> Thanks in advance for you help. 		 	   		  
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
 		 	   		  
	[[alternative HTML version deleted]]


From Jin.Li at ga.gov.au  Wed Apr  8 02:24:40 2015
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Wed, 8 Apr 2015 00:24:40 +0000
Subject: [R-sig-Geo] FW: Spatial sampling design using information more than
 spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
	<alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>
	<de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
Message-ID: <066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>

Sorry for not ccing to the list!

-----Original Message-----
From: Li Jin 
Sent: Tuesday, 7 April 2015 9:36 AM
To: 'Roger.Bivand at nhh.no'
Subject: RE: [R-sig-Geo] Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]

Thanks a lot, Roger! Yes, we have looked at spsurvey and it does not meet the needs of our client. 
Kind regards,
Jin

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
Sent: Friday, 3 April 2015 2:06 AM
To: Li Jin
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]

On Thu, 2 Apr 2015, Jin.Li at ga.gov.au wrote:

> Hi All,
>
> I need to consider both spatial information and another variable (e.g. 
> elevation, soil type) in a sampling design. It seems the available 
> libraries (e.g. sp and spcosa) in R for spatial sampling design are 
> unable to handle it. Please correct me if I am wrong. Before I start 
> to develop my own function for it, I would like to confirm if I have 
> missed some other functions that are available for it in R.  Any 
> suggestions and advice? Thanks in advance!

Have you looked at spsurvey? It may not provide what you need, but checking it would probably help you see whether there is anything meeting your needs. Otherwise you might need to stratify first on your covariates.

Roger

>
> Regards,
> Jin
>
> Jin Li, PhD
> Spatial Modeller/Computational Statistician  |  National Earth and 
> Marine Observations Group Environmental Geoscience Division  | 
> GEOSCIENCE AUSTRALIA ____________________________________________________________
> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
> Email:  Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au>    Web:  www.ga.gov.au<http://www.ga.gov.au/>
> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT GPO Box 378 
> Canberra ACT 2601 Australia Applying geoscience to Australia's most 
> important challenges
>
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
> ----------------------------------------------------------------------
> ---------------------------------------------------
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.


From dave.gregovich at alaska.gov  Wed Apr  8 03:06:50 2015
From: dave.gregovich at alaska.gov (Gregovich, Dave P (DFG))
Date: Wed, 08 Apr 2015 01:06:50 +0000
Subject: [R-sig-Geo] alpha support in raster function 'KML'?
Message-ID: <174524AB15B8E6478D6F927B2131B09B8E1D7116@SOAJNUEXMB3.soa.alaska.gov>

Hello,
Does the 'KML' function from the raster package support an alpha channel?
The .kml file output via the code below suggests it does not, but I was hoping for confirmation.
Thanks kindly.
Dave.

#__________________________________________________________
library(raster)
r <- raster(nrows=108, ncols=21, xmn=0, xmx=10)
r[]<-rep(1:10,1000)[1:ncell(r)]
t.colors <- colorRampPalette(colors = c('yellow','orange','red'),alpha=F)(10)
t.colors <- paste(t.colors,c('1A','33','4D','73','8C','99','B3','CC','E6','FF'),sep='')
KML(r, filename='c:/test/test.kml', blur = 3, col = t.colors, overwrite=T)
#__________________________________________________________

#salient sessionInfo()
#R version 3.1.3 (2015-03-09)
#Platform: x86_64-w64-mingw32/x64 (64-bit)
#Running under: Windows 7 x64 (build 7601) Service Pack 1
#other attached packages:
#[1] dismo_1.0-12    plotKML_0.5-0   twostageRSF_1.1 debug_1.3.1     rgdal_0.9-2     raster_2.3-33   sp_1.0-17


__________________________________
Dave Gregovich
Research Analyst
Alaska Department of Fish and Game
Wildlife Conservation Division
Douglas, AK 99821
(907) 465-4291
dave.gregovich at alaska.gov
__________________________________


	[[alternative HTML version deleted]]


From hengl at spatial-analyst.net  Wed Apr  8 15:32:59 2015
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 08 Apr 2015 15:32:59 +0200
Subject: [R-sig-Geo] alpha support in raster function 'KML'?
In-Reply-To: <174524AB15B8E6478D6F927B2131B09B8E1D7116@SOAJNUEXMB3.soa.alaska.gov>
References: <174524AB15B8E6478D6F927B2131B09B8E1D7116@SOAJNUEXMB3.soa.alaska.gov>
Message-ID: <55252E0B.3000005@spatial-analyst.net>


Yes, you can set-up transparency using 'alpha' e.g.:

R> library(plotKML)
R> library(sp)
R> data(eberg_grid)
R> gridded(eberg_grid) <- ~x+y
R> proj4string(eberg_grid) <- CRS("+init=epsg:31467")
R> data(SAGA_pal)
R> kml(eberg_grid, colour=TWISRT6, alpha=.8, colour_scale = SAGA_pal[[1]])
KML file opened for writing...
Reprojecting to +proj=longlat +datum=WGS84 ...
Writing to KML...
Closing  eberg_grid.kml

But you can also just set opacity directly in Google Earth 
(https://www.youtube.com/watch?v=5HZ8Q82qcFI).

HTH,

T. (Tom) Hengl
Researcher @ ISRIC - World Soil Information
Team member Africa Soil Information Services http://africasoils.net
Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
Network: http://profiles.google.com/tom.hengl
Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ


On 8-4-2015 3:06, Gregovich, Dave P (DFG) wrote:
> Hello,
> Does the 'KML' function from the raster package support an alpha channel?
> The .kml file output via the code below suggests it does not, but I was hoping for confirmation.
> Thanks kindly.
> Dave.
>
> #__________________________________________________________
> library(raster)
> r <- raster(nrows=108, ncols=21, xmn=0, xmx=10)
> r[]<-rep(1:10,1000)[1:ncell(r)]
> t.colors <- colorRampPalette(colors = c('yellow','orange','red'),alpha=F)(10)
> t.colors <- paste(t.colors,c('1A','33','4D','73','8C','99','B3','CC','E6','FF'),sep='')
> KML(r, filename='c:/test/test.kml', blur = 3, col = t.colors, overwrite=T)
> #__________________________________________________________
>
> #salient sessionInfo()
> #R version 3.1.3 (2015-03-09)
> #Platform: x86_64-w64-mingw32/x64 (64-bit)
> #Running under: Windows 7 x64 (build 7601) Service Pack 1
> #other attached packages:
> #[1] dismo_1.0-12    plotKML_0.5-0   twostageRSF_1.1 debug_1.3.1     rgdal_0.9-2     raster_2.3-33   sp_1.0-17
>
>
> __________________________________
> Dave Gregovich
> Research Analyst
> Alaska Department of Fish and Game
> Wildlife Conservation Division
> Douglas, AK 99821
> (907) 465-4291
> dave.gregovich at alaska.gov
> __________________________________
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hengl at spatial-analyst.net  Wed Apr  8 15:39:27 2015
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 08 Apr 2015 15:39:27 +0200
Subject: [R-sig-Geo] FW: Spatial sampling design using information more
 than spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>	<alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>	<de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
	<066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>
Message-ID: <55252F8F.2080500@spatial-analyst.net>


The "clhs" package (http://cran.r-project.org/web/packages/clhs/) has 
some functionality for latin-hypercube sampling hence it is suitable for 
your case. Here are some code examples: 
http://gsif.isric.org/doku.php?id=wiki:tutorial_eberg#testing_the_feature_space_coverage

I have also recently (experimentally) implemented a function to test 
'efficiency of any sampling plan' which looks at both geographical space 
and feature space representation: 
http://gsif.r-forge.r-project.org/spsample.prob.html
If you discover a bug or some 'strange behavior', please let me know.

HTH,

T. (Tom) Hengl
Researcher @ ISRIC - World Soil Information
Team member Africa Soil Information Services http://africasoils.net
Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
Network: http://profiles.google.com/tom.hengl
Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ


On 8-4-2015 2:24, Jin.Li at ga.gov.au wrote:
> Sorry for not ccing to the list!
>
> -----Original Message-----
> From: Li Jin
> Sent: Tuesday, 7 April 2015 9:36 AM
> To: 'Roger.Bivand at nhh.no'
> Subject: RE: [R-sig-Geo] Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]
>
> Thanks a lot, Roger! Yes, we have looked at spsurvey and it does not meet the needs of our client.
> Kind regards,
> Jin
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Friday, 3 April 2015 2:06 AM
> To: Li Jin
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]
>
> On Thu, 2 Apr 2015, Jin.Li at ga.gov.au wrote:
>
>> Hi All,
>>
>> I need to consider both spatial information and another variable (e.g.
>> elevation, soil type) in a sampling design. It seems the available
>> libraries (e.g. sp and spcosa) in R for spatial sampling design are
>> unable to handle it. Please correct me if I am wrong. Before I start
>> to develop my own function for it, I would like to confirm if I have
>> missed some other functions that are available for it in R.  Any
>> suggestions and advice? Thanks in advance!
>
> Have you looked at spsurvey? It may not provide what you need, but checking it would probably help you see whether there is anything meeting your needs. Otherwise you might need to stratify first on your covariates.
>
> Roger
>
>>
>> Regards,
>> Jin
>>
>> Jin Li, PhD
>> Spatial Modeller/Computational Statistician  |  National Earth and
>> Marine Observations Group Environmental Geoscience Division  |
>> GEOSCIENCE AUSTRALIA ____________________________________________________________
>> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
>> Email:  Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au>    Web:  www.ga.gov.au<http://www.ga.gov.au/>
>> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT GPO Box 378
>> Canberra ACT 2601 Australia Applying geoscience to Australia's most
>> important challenges
>>
>>
>> Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
>> ----------------------------------------------------------------------
>> ---------------------------------------------------
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hyinhe at gmail.com  Wed Apr  8 18:49:10 2015
From: hyinhe at gmail.com (Arc RS)
Date: Wed, 8 Apr 2015 18:49:10 +0200
Subject: [R-sig-Geo] Write a new raster brick calculated from the other two
	raster stacks
Message-ID: <CAFOt85Y3u5iCZ2KrWboLBRw8a+wfc8Pu6pLQhd1eiCeHPUoYsw@mail.gmail.com>

Hi, I got stuck in output a raster stack calculated from the other two
raster stacks. The input and output rasters have same dimentions
(nrow*ncol*nlayer).

input raster stack 1: ras1
input raster stack 2: ras2
output raster: outras

The function I used for stacks calculation is: func

Here are my codes:

#####make blocks#######
tr <- blockSize(ras1)

###check the block info###
> str(tr)
List of 3
 $ row  : num [1:4] 1 191 381 571
 $ nrows: num [1:4] 190 190 190 189
 $ n    : num 4

####define output raster###
outras <- brick(ras1)
outras <- writeStart(outras , filename='output.tif',  overwrite=TRUE)

####start calculation and output###
for (i in 1:tr$n)
{
  rasvl1  <- getValues(ras1,tr$row[i],tr$nrows[i])
  rasvl2  <- getValues(ras2,tr$row[i],tr$nrows[i])
  ok       <- func(rasvl1, rasvl2)
  outras  <- writeValues(x=outras, v=ok,start=tr$row[i])
}
outras <- writeStop(outras )

#####

But I got an error message 'Error in (function (classes, fdef, mtable) :
 unable to find an inherited method for function ?getValues? for signature
?"matrix", "numeric", "numeric"?

I checked the output tiff file, and I found only the first block was
written. The rest three blocks are missing.

Any ideas?

Thanks in advance!
Eric

	[[alternative HTML version deleted]]


From ftonini84 at gmail.com  Wed Apr  8 20:05:18 2015
From: ftonini84 at gmail.com (Francesco Tonini)
Date: Wed, 08 Apr 2015 14:05:18 -0400
Subject: [R-sig-Geo] Plot multiple temporal rasters on background image
In-Reply-To: <55255D9B.9020900@gmail.com>
References: <CAFOt85Y3u5iCZ2KrWboLBRw8a+wfc8Pu6pLQhd1eiCeHPUoYsw@mail.gmail.com>
	<55255D9B.9020900@gmail.com>
Message-ID: <55256DDE.2070804@gmail.com>

Hello everybody,

I would need your help with the following issue. I am trying to plot 
multiple consecutive temporal rasters on top of a single background 
satellite image to show the dynamic spread of a disease. If you would 
like to help me, please find the two raster images at the link posted below.

link: 
_https://www.dropbox.com/sh/de9z037ir1bwyec/AABfFqUEraGuj3wbPkfpFTtta?dl=0_

library(raster)

img <- raster('./ortho_5m_color.tif')
r <- raster('./HI_100m.img')

plot(img)    # ---> see img1.png in the shared link
plot(r, col=rev(heat.colors(5, alpha=.3)), axes=F, legend=F, add=T)   # 
---> see img2.png in the shared link
plot(r, col=rev(heat.colors(5, alpha=.3)), axes=F, legend=F, add=T) # 
---> see img3.png in the shared link

As you may notice, adding another raster on top of the previous two does 
not match the full extent anymore. If you keep plotting more and more 
the extent keeps changing (reducing) until it stops.

Any advice on how to fix this issue for plotting multiple raster layers 
on top of the satellite image? I can send the two raster files if you 
must replicate on your computer.

Thank you,
Francesco


	[[alternative HTML version deleted]]


From a.mosnier at gmail.com  Wed Apr  8 20:53:52 2015
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Wed, 8 Apr 2015 14:53:52 -0400
Subject: [R-sig-Geo] Define aliases in shapefiles
Message-ID: <CANkFkEfOg=U-E2w0hOXUOLB_w9qa8=fEpJwGWJsTbp6YuwXbkw@mail.gmail.com>

Dear useRs,

I am searching for a way to break the 10 character limit of the field names
in shapefiles created using for example the writeOGR function from the
rgdal package.

On way could be to define aliases for field names, but I am not aware of a
function allowing me to do that.

Any suggestions ?

Cheers,

Arnaud

	[[alternative HTML version deleted]]


From ts2789 at tc.columbia.edu  Wed Apr  8 21:03:27 2015
From: ts2789 at tc.columbia.edu (Suga, Taeko)
Date: Wed, 8 Apr 2015 15:03:27 -0400
Subject: [R-sig-Geo] Background shapefile does not appear
Message-ID: <CAGeqgYvug_sqNceDQZ8GSPo4cvniEPe29oyn1RwBBvfuxM5y+w@mail.gmail.com>

Dear All,

I have created a school-point-location shapefile, using the school point
location data (longitude & latitude) from the National Center for Education
Statistics, Common Core Data system.

I matched the geo-coding of the shapefile with the NYC school district
shapefile created by the NYC Department of City Planning.

Then, I try to over lay the point location to the NYC school district
shapefile, but failed. The district shape file did not appear.

Hope someone could help me.
Thank you!

Taeko Suga
Ed.M. student
Teachers College

	[[alternative HTML version deleted]]


From tephilippi at gmail.com  Thu Apr  9 01:31:43 2015
From: tephilippi at gmail.com (Tom Philippi)
Date: Wed, 8 Apr 2015 16:31:43 -0700
Subject: [R-sig-Geo] FW: Spatial sampling design using information more
 than spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <55252F8F.2080500@spatial-analyst.net>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
	<alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>
	<de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
	<066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>
	<55252F8F.2080500@spatial-analyst.net>
Message-ID: <CALyPt8yVYFYHBJAd-TddsWeazG+3xWKAoA7exG_rhf_E1udwFg@mail.gmail.com>

Jin--
Could you provide more information on what the needs of your client are
that cannot be handled by either stratification or unequal probability
based on your one or more covariates in spsurvey?  Also, is your sample
frame points, polygons, or raster?  I assume your covariates are raster
(e.g., DEM for elevation) and polygons (most soil maps)?

Tom 2


On Wed, Apr 8, 2015 at 6:39 AM, Tomislav Hengl <hengl at spatial-analyst.net>
wrote:

>
> The "clhs" package (http://cran.r-project.org/web/packages/clhs/) has
> some functionality for latin-hypercube sampling hence it is suitable for
> your case. Here are some code examples: http://gsif.isric.org/doku.
> php?id=wiki:tutorial_eberg#testing_the_feature_space_coverage
>
> I have also recently (experimentally) implemented a function to test
> 'efficiency of any sampling plan' which looks at both geographical space
> and feature space representation: http://gsif.r-forge.r-project.
> org/spsample.prob.html
> If you discover a bug or some 'strange behavior', please let me know.
>
> HTH,
>
> T. (Tom) Hengl
> Researcher @ ISRIC - World Soil Information
> Team member Africa Soil Information Services http://africasoils.net
> Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
> Network: http://profiles.google.com/tom.hengl
> Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ
>
>
>
> On 8-4-2015 2:24, Jin.Li at ga.gov.au wrote:
>
>> Sorry for not ccing to the list!
>>
>> -----Original Message-----
>> From: Li Jin
>> Sent: Tuesday, 7 April 2015 9:36 AM
>> To: 'Roger.Bivand at nhh.no'
>> Subject: RE: [R-sig-Geo] Spatial sampling design using information more
>> than spatial coordinates [SEC=UNCLASSIFIED]
>>
>> Thanks a lot, Roger! Yes, we have looked at spsurvey and it does not meet
>> the needs of our client.
>> Kind regards,
>> Jin
>>
>> -----Original Message-----
>> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>> Sent: Friday, 3 April 2015 2:06 AM
>> To: Li Jin
>> Cc: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Spatial sampling design using information more
>> than spatial coordinates [SEC=UNCLASSIFIED]
>>
>> On Thu, 2 Apr 2015, Jin.Li at ga.gov.au wrote:
>>
>>  Hi All,
>>>
>>> I need to consider both spatial information and another variable (e.g.
>>> elevation, soil type) in a sampling design. It seems the available
>>> libraries (e.g. sp and spcosa) in R for spatial sampling design are
>>> unable to handle it. Please correct me if I am wrong. Before I start
>>> to develop my own function for it, I would like to confirm if I have
>>> missed some other functions that are available for it in R.  Any
>>> suggestions and advice? Thanks in advance!
>>>
>>
>> Have you looked at spsurvey? It may not provide what you need, but
>> checking it would probably help you see whether there is anything meeting
>> your needs. Otherwise you might need to stratify first on your covariates.
>>
>> Roger
>>
>>
>>> Regards,
>>> Jin
>>>
>>> Jin Li, PhD
>>> Spatial Modeller/Computational Statistician  |  National Earth and
>>> Marine Observations Group Environmental Geoscience Division  |
>>> GEOSCIENCE AUSTRALIA ______________________________
>>> ______________________________
>>> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
>>> Email:  Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au>    Web:  www.ga.gov.au
>>> <http://www.ga.gov.au/>
>>> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT GPO Box 378
>>> Canberra ACT 2601 Australia Applying geoscience to Australia's most
>>> important challenges
>>>
>>>
>>> Geoscience Australia Disclaimer: This e-mail (and files transmitted with
>>> it) is intended only for the person or entity to which it is addressed. If
>>> you are not the intended recipient, then you have received this e-mail by
>>> mistake and any use, dissemination, forwarding, printing or copying of this
>>> e-mail and its file attachments is prohibited. The security of emails
>>> transmitted cannot be guaranteed; by forwarding or replying to this email,
>>> you acknowledge and accept these risks.
>>> ----------------------------------------------------------------------
>>> ---------------------------------------------------
>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics, Helleveien 30,
>> N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>> Geoscience Australia Disclaimer: This e-mail (and files transmitted with
>> it) is intended only for the person or entity to which it is addressed. If
>> you are not the intended recipient, then you have received this e-mail by
>> mistake and any use, dissemination, forwarding, printing or copying of this
>> e-mail and its file attachments is prohibited. The security of emails
>> transmitted cannot be guaranteed; by forwarding or replying to this email,
>> you acknowledge and accept these risks.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Jin.Li at ga.gov.au  Thu Apr  9 01:46:05 2015
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Wed, 8 Apr 2015 23:46:05 +0000
Subject: [R-sig-Geo] FW: Spatial sampling design using information more
 than spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <55252F8F.2080500@spatial-analyst.net>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
	<alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>
	<de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
	<066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>
	<55252F8F.2080500@spatial-analyst.net>
Message-ID: <a2f839b3c5c54d92b92909e877ac4348@WIN-EXCH01.agso.gov.au>

Many thanks, Tom. That is very helpful! I will have a try. Jin

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Tomislav Hengl
Sent: Wednesday, 8 April 2015 11:39 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] FW: Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]


The "clhs" package (http://cran.r-project.org/web/packages/clhs/) has some functionality for latin-hypercube sampling hence it is suitable for your case. Here are some code examples: 
http://gsif.isric.org/doku.php?id=wiki:tutorial_eberg#testing_the_feature_space_coverage

I have also recently (experimentally) implemented a function to test 'efficiency of any sampling plan' which looks at both geographical space and feature space representation: 
http://gsif.r-forge.r-project.org/spsample.prob.html
If you discover a bug or some 'strange behavior', please let me know.

HTH,

T. (Tom) Hengl
Researcher @ ISRIC - World Soil Information Team member Africa Soil Information Services http://africasoils.net
Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
Network: http://profiles.google.com/tom.hengl
Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ


On 8-4-2015 2:24, Jin.Li at ga.gov.au wrote:
> Sorry for not ccing to the list!
>
> -----Original Message-----
> From: Li Jin
> Sent: Tuesday, 7 April 2015 9:36 AM
> To: 'Roger.Bivand at nhh.no'
> Subject: RE: [R-sig-Geo] Spatial sampling design using information 
> more than spatial coordinates [SEC=UNCLASSIFIED]
>
> Thanks a lot, Roger! Yes, we have looked at spsurvey and it does not meet the needs of our client.
> Kind regards,
> Jin
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Friday, 3 April 2015 2:06 AM
> To: Li Jin
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Spatial sampling design using information 
> more than spatial coordinates [SEC=UNCLASSIFIED]
>
> On Thu, 2 Apr 2015, Jin.Li at ga.gov.au wrote:
>
>> Hi All,
>>
>> I need to consider both spatial information and another variable (e.g.
>> elevation, soil type) in a sampling design. It seems the available 
>> libraries (e.g. sp and spcosa) in R for spatial sampling design are 
>> unable to handle it. Please correct me if I am wrong. Before I start 
>> to develop my own function for it, I would like to confirm if I have 
>> missed some other functions that are available for it in R.  Any 
>> suggestions and advice? Thanks in advance!
>
> Have you looked at spsurvey? It may not provide what you need, but checking it would probably help you see whether there is anything meeting your needs. Otherwise you might need to stratify first on your covariates.
>
> Roger
>
>>
>> Regards,
>> Jin
>>
>> Jin Li, PhD
>> Spatial Modeller/Computational Statistician  |  National Earth and 
>> Marine Observations Group Environmental Geoscience Division  | 
>> GEOSCIENCE AUSTRALIA ____________________________________________________________
>> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
>> Email:  Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au>    Web:  www.ga.gov.au<http://www.ga.gov.au/>
>> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT GPO Box 
>> 378 Canberra ACT 2601 Australia Applying geoscience to Australia's 
>> most important challenges
>>
>>
>> Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
>> ---------------------------------------------------------------------
>> -
>> ---------------------------------------------------
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.


From Jin.Li at ga.gov.au  Thu Apr  9 03:49:39 2015
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Thu, 9 Apr 2015 01:49:39 +0000
Subject: [R-sig-Geo] [DKIM] Re: FW: Spatial sampling design using
 information more than spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <23118_1428535975_5525BAA5_23118_10078_1_CALyPt8yVYFYHBJAd-TddsWeazG+3xWKAoA7exG_rhf_E1udwFg@mail.gmail.com>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
	<alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>
	<de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
	<066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>
	<55252F8F.2080500@spatial-analyst.net>
	<23118_1428535975_5525BAA5_23118_10078_1_CALyPt8yVYFYHBJAd-TddsWeazG+3xWKAoA7exG_rhf_E1udwFg@mail.gmail.com>
Message-ID: <1a35f31662934bbcaa26f6f9ec3ce310@WIN-EXCH01.agso.gov.au>

Hi Tom 2  :-),



To be specific,  we need to do the spatial stratification first and need to stratify the survey area into n equal-area strata. The function stratify with equalArea in spcosa meets this need well.



And then within each stratum, we need to do further stratification based on a raster layer of 'elevation' that is a continuous layer and needs to be converted into 3 zones. We need to sample m samples within each stratum and these samples need to be evenly distributed within each zone. That is we need to use the area of each zone as a weight to decide how many samples should be allocated to each zone. And then do randomly sampling within each zone.



A further challenge is that they plan to sample 1 to 4 samples a day during 25 days, so we need to provide four designs with 25, 50, 75 and 100 samples respectively. The samples of the design with smaller sample size need to be nested in the samples of the design with larger sample size for operational reasons as the survey needs to meet other tasks and also to accommodate weather conditions at sea. Now you know the 'elevation' is bathymetry that is the depth of water. We plan to let n = 25, and m = 1 to 4. But it is hard to stratify if a stratum contains 3 zones and m <3.



Hope this clarify things a bit. Any further suggestions are appreciated!



Jin



-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Tom Philippi
Sent: Thursday, 9 April 2015 9:32 AM
To: Tomislav Hengl
Cc: r-sig-geo
Subject: [DKIM] Re: [R-sig-Geo] FW: Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]



Jin--

Could you provide more information on what the needs of your client are that cannot be handled by either stratification or unequal probability based on your one or more covariates in spsurvey?  Also, is your sample frame points, polygons, or raster?  I assume your covariates are raster (e.g., DEM for elevation) and polygons (most soil maps)?



Tom 2





On Wed, Apr 8, 2015 at 6:39 AM, Tomislav Hengl <hengl at spatial-analyst.net<mailto:hengl at spatial-analyst.net>>

wrote:



>

> The "clhs" package (http://cran.r-project.org/web/packages/clhs/) has

> some functionality for latin-hypercube sampling hence it is suitable

> for your case. Here are some code examples: http://gsif.isric.org/doku.

> php?id=wiki:tutorial_eberg#testing_the_feature_space_coverage

>

> I have also recently (experimentally) implemented a function to test

> 'efficiency of any sampling plan' which looks at both geographical

> space and feature space representation: http://gsif.r-forge.r-project.

> org/spsample.prob.html

> If you discover a bug or some 'strange behavior', please let me know.

>

> HTH,

>

> T. (Tom) Hengl

> Researcher @ ISRIC - World Soil Information Team member Africa Soil

> Information Services http://africasoils.net

> Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm

> Network: http://profiles.google.com/tom.hengl

> Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ

>

>

>

> On 8-4-2015 2:24, Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au> wrote:

>

>> Sorry for not ccing to the list!

>>

>> -----Original Message-----

>> From: Li Jin

>> Sent: Tuesday, 7 April 2015 9:36 AM

>> To: 'Roger.Bivand at nhh.no'

>> Subject: RE: [R-sig-Geo] Spatial sampling design using information

>> more than spatial coordinates [SEC=UNCLASSIFIED]

>>

>> Thanks a lot, Roger! Yes, we have looked at spsurvey and it does not

>> meet the needs of our client.

>> Kind regards,

>> Jin

>>

>> -----Original Message-----

>> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]

>> Sent: Friday, 3 April 2015 2:06 AM

>> To: Li Jin

>> Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>

>> Subject: Re: [R-sig-Geo] Spatial sampling design using information

>> more than spatial coordinates [SEC=UNCLASSIFIED]

>>

>> On Thu, 2 Apr 2015, Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au> wrote:

>>

>>  Hi All,

>>>

>>> I need to consider both spatial information and another variable (e.g.

>>> elevation, soil type) in a sampling design. It seems the available

>>> libraries (e.g. sp and spcosa) in R for spatial sampling design are

>>> unable to handle it. Please correct me if I am wrong. Before I start

>>> to develop my own function for it, I would like to confirm if I have

>>> missed some other functions that are available for it in R.  Any

>>> suggestions and advice? Thanks in advance!

>>>

>>

>> Have you looked at spsurvey? It may not provide what you need, but

>> checking it would probably help you see whether there is anything

>> meeting your needs. Otherwise you might need to stratify first on your covariates.

>>

>> Roger

>>

>>

>>> Regards,

>>> Jin

>>>

>>> Jin Li, PhD

>>> Spatial Modeller/Computational Statistician  |  National Earth and

>>> Marine Observations Group Environmental Geoscience Division  |

>>> GEOSCIENCE AUSTRALIA ______________________________

>>> ______________________________

>>> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999

>>> Email:  Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au%3cmailto:Jin.Li at ga.gov.au>>    Web:  www.ga.gov.au<http://www.ga.gov.au>

>>> <http://www.ga.gov.au/>

>>> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT GPO Box

>>> 378 Canberra ACT 2601 Australia Applying geoscience to Australia's

>>> most important challenges

>>>

>>>

>>> Geoscience Australia Disclaimer: This e-mail (and files transmitted

>>> with

>>> it) is intended only for the person or entity to which it is

>>> addressed. If you are not the intended recipient, then you have

>>> received this e-mail by mistake and any use, dissemination,

>>> forwarding, printing or copying of this e-mail and its file

>>> attachments is prohibited. The security of emails transmitted cannot

>>> be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.

>>> --------------------------------------------------------------------

>>> --

>>> ---------------------------------------------------

>>>

>>>

>>>         [[alternative HTML version deleted]]

>>>

>>> _______________________________________________

>>> R-sig-Geo mailing list

>>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>

>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

>>>

>>>

>> --

>> Roger Bivand

>> Department of Economics, Norwegian School of Economics, Helleveien

>> 30,

>> N-5045 Bergen, Norway.

>> voice: +47 55 95 93 55; fax +47 55 95 91 00

>> e-mail: Roger.Bivand at nhh.no<mailto:Roger.Bivand at nhh.no>

>>

>>

>> Geoscience Australia Disclaimer: This e-mail (and files transmitted

>> with

>> it) is intended only for the person or entity to which it is

>> addressed. If you are not the intended recipient, then you have

>> received this e-mail by mistake and any use, dissemination,

>> forwarding, printing or copying of this e-mail and its file

>> attachments is prohibited. The security of emails transmitted cannot

>> be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.

>>

>> _______________________________________________

>> R-sig-Geo mailing list

>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>

>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

>>

>>

> _______________________________________________

> R-sig-Geo mailing list

> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>

> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

>



                [[alternative HTML version deleted]]



_______________________________________________

R-sig-Geo mailing list

R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>

https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
-------------------------------------------------------------------------------------------------------------------------


	[[alternative HTML version deleted]]


From hyinhe at gmail.com  Thu Apr  9 12:15:08 2015
From: hyinhe at gmail.com (heyin)
Date: Thu, 9 Apr 2015 03:15:08 -0700 (MST)
Subject: [R-sig-Geo] Write a new raster brick calculated from the other
 two raster stacks
In-Reply-To: <CAFOt85Y3u5iCZ2KrWboLBRw8a+wfc8Pu6pLQhd1eiCeHPUoYsw@mail.gmail.com>
References: <CAFOt85Y3u5iCZ2KrWboLBRw8a+wfc8Pu6pLQhd1eiCeHPUoYsw@mail.gmail.com>
Message-ID: <1428574508512-7588036.post@n2.nabble.com>

Problem solved...

I just change 'getValues' to 'getValuesBlock' and voil?!

Best,
Eric



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Write-a-new-raster-brick-calculated-from-the-other-two-raster-stacks-tp7588029p7588036.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Thu Apr  9 13:36:09 2015
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 9 Apr 2015 12:36:09 +0100
Subject: [R-sig-Geo] Define aliases in shapefiles
In-Reply-To: <CANkFkEfOg=U-E2w0hOXUOLB_w9qa8=fEpJwGWJsTbp6YuwXbkw@mail.gmail.com>
References: <CANkFkEfOg=U-E2w0hOXUOLB_w9qa8=fEpJwGWJsTbp6YuwXbkw@mail.gmail.com>
Message-ID: <CANVKczMHzU-_uiOQ3MP06qYA=xp_tNNuEC=yniTtmuuoma96sw@mail.gmail.com>

On Wed, Apr 8, 2015 at 7:53 PM, Arnaud Mosnier <a.mosnier at gmail.com> wrote:
> Dear useRs,
>
> I am searching for a way to break the 10 character limit of the field names
> in shapefiles created using for example the writeOGR function from the
> rgdal package.
>
> On way could be to define aliases for field names, but I am not aware of a
> function allowing me to do that.

 Are aliases an ArcGIS thing for shapefile names? I can only see vague
references on the internet to something like that. Do you create field
name aliases in ArcGIS? Are they saved with the shapefile or with the
ArcGIS file? Do you get a foo.shp.xml file that is keeping this extra
metadata around? Perhaps we could reverse-engineer that and create it
in R.

 Standards-compliant shapefiles can only have 10-character field names.

 You could use another file format, such as GML or Spatialite, as long
as whatever you are saving these for can read them.

Barry


From Rainer at krugs.de  Thu Apr  9 13:50:16 2015
From: Rainer at krugs.de (Rainer M Krug)
Date: Thu, 09 Apr 2015 13:50:16 +0200
Subject: [R-sig-Geo] Define aliases in shapefiles
In-Reply-To: <CANVKczMHzU-_uiOQ3MP06qYA=xp_tNNuEC=yniTtmuuoma96sw@mail.gmail.com>
	(Barry Rowlingson's message of "Thu, 9 Apr 2015 12:36:09 +0100")
References: <CANkFkEfOg=U-E2w0hOXUOLB_w9qa8=fEpJwGWJsTbp6YuwXbkw@mail.gmail.com>
	<CANVKczMHzU-_uiOQ3MP06qYA=xp_tNNuEC=yniTtmuuoma96sw@mail.gmail.com>
Message-ID: <m2y4m14j2f.fsf@krugs.de>

Barry Rowlingson <b.rowlingson at lancaster.ac.uk> writes:

> On Wed, Apr 8, 2015 at 7:53 PM, Arnaud Mosnier <a.mosnier at gmail.com> wrote:
>> Dear useRs,
>>
>> I am searching for a way to break the 10 character limit of the field names
>> in shapefiles created using for example the writeOGR function from the
>> rgdal package.
>>
>> On way could be to define aliases for field names, but I am not aware of a
>> function allowing me to do that.
>
>  Are aliases an ArcGIS thing for shapefile names? I can only see vague
> references on the internet to something like that. Do you create field
> name aliases in ArcGIS? Are they saved with the shapefile or with the
> ArcGIS file? Do you get a foo.shp.xml file that is keeping this extra
> metadata around? Perhaps we could reverse-engineer that and create it
> in R.
>
>  Standards-compliant shapefiles can only have 10-character field names.
>
>  You could use another file format, such as GML or Spatialite, as long
> as whatever you are saving these for can read them.

There is always the possibility of a homegrown version, which should not
be to difficult to implement. As soon as the shape file has been loaded,
you can change the field names, and before you save it, you could change
them back. The longer field names could be saved in a file.

Rainer


>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology, UCT), Dipl. Phys. (Germany)

Centre of Excellence for Invasion Biology
Stellenbosch University
South Africa

Tel :       +33 - (0)9 53 10 27 44
Cell:       +33 - (0)6 85 62 59 98
Fax :       +33 - (0)9 58 10 27 44

Fax (D):    +49 - (0)3 21 21 25 22 44

email:      Rainer at krugs.de

Skype:      RMkrug

PGP: 0x0F52F982
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 494 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150409/b8674f84/attachment.bin>

From mauriziomarchi85 at gmail.com  Thu Apr  9 14:43:41 2015
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Thu, 9 Apr 2015 14:43:41 +0200
Subject: [R-sig-Geo] Raster map from data.frame
Message-ID: <CANJhsN2ibPko39jxtXaYQUwDmHNPKQ06yk1REsW9DNCctAet9w@mail.gmail.com>

Hi everybody, I need help with a big dataset that I need to transform in a
group of raster files. I have a big .csv (2 GB with 5 millions rows and 90
columns) which I want to transform in a group of raster images. The First
two culms represent the geographical coordinates while the others 88
columns represent the values I want to give to each cell of each raster
(temperatures, precipitations etc...). The database is compiled only with
the cells that will have a value (NA cells were not calculated).  I often
used the data.frame2ascii function of SDMTools package but in this case the
function doesn't works (too many rows maybe?).
Any suggestion? I prefer the .asc format but even GeoTiff or other formats
would be ok.

Manu thanks,
Maurizio



-- 
Maurizio Marchi
Calenzano (FI) - Italy
ID Skype: maurizioxyz
Ubuntu 14.04 LTS
linux user 552742

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Thu Apr  9 15:29:16 2015
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 09 Apr 2015 13:29:16 +0000
Subject: [R-sig-Geo] Raster map from data.frame
In-Reply-To: <CANJhsN2ibPko39jxtXaYQUwDmHNPKQ06yk1REsW9DNCctAet9w@mail.gmail.com>
References: <CANJhsN2ibPko39jxtXaYQUwDmHNPKQ06yk1REsW9DNCctAet9w@mail.gmail.com>
Message-ID: <CAAcGz9_eJ9wvHF4iZ9Tn+b7LruYnhc+Xr5JYxuVz3aT9DkK-wQ@mail.gmail.com>

raster::rasterFromXYZ  should do the trick. I always feel a little ill
turning raw tabular data into a raster, it's so easy(!) but represents a
ridiculous amount of redundancy that gets turned into a simple rule - which
is what the data should have been in the first place.

A somewhat more general solution exists in sp, you would do this ("d" is
your data frame with "x", "y", "z" columns):

library(sp)
coordinates(d) <- c("x", "y")
gridded(d) <- TRUE

That would give you a "SpatialPixelsDataFrame", which does two things (that
should be separate IMO):

- allows the grid to be sparse (note that algorithms to detect "regularity"
in any arbitrary set of coordinates is quite hard to achieve, and
impossible in some scenarios - if it's a grid that should be explicit, why
would its extent be defined by populated cells, etc., rant . . .)
- it allows some level of non-regularity, and it  justifies this by storing
the original explicit coordinates so it can restore them if needed

Also note the raster::rasterFromXYZ case needs extra work to apply it to
multiple-attributed grids (no matter if you have one "z" column or any
number of them the sp case works fine). You can also ingest any sp grid
into raster() or raster::stack() or brick(). If rgdal is present you can
writeRaster() to a .tif as well.

If your data really are not regular (why would you store all those
coordinates?), then you might
- rasterize from irregular data (or explore other model solutions from
packages like gstat)
- use sp::points2grid to control the threshold of "regularity" (really this
is for getting around numeric fuzz, but can be used)

(note also that rasterFromXYZ has a digits argument, similar to
points2grid's eps)

HTH





On Thu, 9 Apr 2015 at 22:44 Maurizio Marchi <mauriziomarchi85 at gmail.com>
wrote:

> Hi everybody, I need help with a big dataset that I need to transform in a
> group of raster files. I have a big .csv (2 GB with 5 millions rows and 90
> columns) which I want to transform in a group of raster images. The First
> two culms represent the geographical coordinates while the others 88
> columns represent the values I want to give to each cell of each raster
> (temperatures, precipitations etc...). The database is compiled only with
> the cells that will have a value (NA cells were not calculated).  I often
> used the data.frame2ascii function of SDMTools package but in this case the
> function doesn't works (too many rows maybe?).
> Any suggestion? I prefer the .asc format but even GeoTiff or other formats
> would be ok.
>
> Manu thanks,
> Maurizio
>
>
>
> --
> Maurizio Marchi
> Calenzano (FI) - Italy
> ID Skype: maurizioxyz
> Ubuntu 14.04 LTS
> linux user 552742
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From macqueen1 at llnl.gov  Thu Apr  9 15:44:43 2015
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Thu, 9 Apr 2015 13:44:43 +0000
Subject: [R-sig-Geo] Background shapefile does not appear
In-Reply-To: <CAGeqgYvug_sqNceDQZ8GSPo4cvniEPe29oyn1RwBBvfuxM5y+w@mail.gmail.com>
References: <CAGeqgYvug_sqNceDQZ8GSPo4cvniEPe29oyn1RwBBvfuxM5y+w@mail.gmail.com>
Message-ID: <D14BCEE4.124F56%macqueen1@llnl.gov>

My first guess is that your step "matched the geo-coding" did not succeed.
But with no details it's hard to say.

Is the NYC school district shapefile also in lat/long?
If you apply the proj4string() function to both of your objects in R, do
you get the same result?
If you apply the bbox() function (bounding box) to both of them, do the
bounding boxes at least overlap?

Of course they are not shapefiles anymore after they have been loaded into
R. Is the school point location data a SpatialPointsDataFrame, and the NYC
school district a SpatialPolygonsDataFrame object?

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 4/8/15, 12:03 PM, "Suga, Taeko" <ts2789 at tc.columbia.edu> wrote:

>Dear All,
>
>I have created a school-point-location shapefile, using the school point
>location data (longitude & latitude) from the National Center for
>Education
>Statistics, Common Core Data system.
>
>I matched the geo-coding of the shapefile with the NYC school district
>shapefile created by the NYC Department of City Planning.
>
>Then, I try to over lay the point location to the NYC school district
>shapefile, but failed. The district shape file did not appear.
>
>Hope someone could help me.
>Thank you!
>
>Taeko Suga
>Ed.M. student
>Teachers College
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From a.mosnier at gmail.com  Thu Apr  9 19:21:36 2015
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Thu, 9 Apr 2015 13:21:36 -0400
Subject: [R-sig-Geo] Define aliases in shapefiles
In-Reply-To: <m2y4m14j2f.fsf@krugs.de>
References: <CANkFkEfOg=U-E2w0hOXUOLB_w9qa8=fEpJwGWJsTbp6YuwXbkw@mail.gmail.com>
	<CANVKczMHzU-_uiOQ3MP06qYA=xp_tNNuEC=yniTtmuuoma96sw@mail.gmail.com>
	<m2y4m14j2f.fsf@krugs.de>
Message-ID: <CANkFkEeBsgg2GqCX53dt-MUPBgRXfOcNPef=QUUWYG9n7Mu8Gw@mail.gmail.com>

Barry and Rainer,

It seems that aliases are stored when a layer file (.lyr) is created by
ArcGIS and this file is not read by other GIS programs such as QGIS (QGIS
have is own "style" file .qml).

Arnaud

2015-04-09 7:50 GMT-04:00 Rainer M Krug <Rainer at krugs.de>:

> Barry Rowlingson <b.rowlingson at lancaster.ac.uk> writes:
>
> > On Wed, Apr 8, 2015 at 7:53 PM, Arnaud Mosnier <a.mosnier at gmail.com>
> wrote:
> >> Dear useRs,
> >>
> >> I am searching for a way to break the 10 character limit of the field
> names
> >> in shapefiles created using for example the writeOGR function from the
> >> rgdal package.
> >>
> >> On way could be to define aliases for field names, but I am not aware
> of a
> >> function allowing me to do that.
> >
> >  Are aliases an ArcGIS thing for shapefile names? I can only see vague
> > references on the internet to something like that. Do you create field
> > name aliases in ArcGIS? Are they saved with the shapefile or with the
> > ArcGIS file? Do you get a foo.shp.xml file that is keeping this extra
> > metadata around? Perhaps we could reverse-engineer that and create it
> > in R.
> >
> >  Standards-compliant shapefiles can only have 10-character field names.
> >
> >  You could use another file format, such as GML or Spatialite, as long
> > as whatever you are saving these for can read them.
>
> There is always the possibility of a homegrown version, which should not
> be to difficult to implement. As soon as the shape file has been loaded,
> you can change the field names, and before you save it, you could change
> them back. The longer field names could be saved in a file.
>
> Rainer
>
>
> >
> > Barry
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
> Biology, UCT), Dipl. Phys. (Germany)
>
> Centre of Excellence for Invasion Biology
> Stellenbosch University
> South Africa
>
> Tel :       +33 - (0)9 53 10 27 44
> Cell:       +33 - (0)6 85 62 59 98
> Fax :       +33 - (0)9 58 10 27 44
>
> Fax (D):    +49 - (0)3 21 21 25 22 44
>
> email:      Rainer at krugs.de
>
> Skype:      RMkrug
>
> PGP: 0x0F52F982
>

	[[alternative HTML version deleted]]


From a.mosnier at gmail.com  Thu Apr  9 19:51:11 2015
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Thu, 9 Apr 2015 13:51:11 -0400
Subject: [R-sig-Geo] Define aliases in shapefiles
In-Reply-To: <m2y4m14j2f.fsf@krugs.de>
References: <CANkFkEfOg=U-E2w0hOXUOLB_w9qa8=fEpJwGWJsTbp6YuwXbkw@mail.gmail.com>
	<CANVKczMHzU-_uiOQ3MP06qYA=xp_tNNuEC=yniTtmuuoma96sw@mail.gmail.com>
	<m2y4m14j2f.fsf@krugs.de>
Message-ID: <CANkFkEfPu_hm59HYyLxfqYDcXrY49+Xbkmfe-yoXy7ff7vzAmQ@mail.gmail.com>

Creating a .qml file for visualisation in QGIS is easy as it is an HTML
file like this.

<qgis>
  <aliases>
    <alias field="test" index="2" name="HEREISMYNEWNAMEhgfgfdcgt"/>
  </aliases>
</qgis>

So I will create this for each of my shapefile ... but I expected that it
could be embedded into the other "classic" shapefile files and could be
read everywhere (it least in the most common GIS softwares).

Have a good day !

Arnaud

2015-04-09 7:50 GMT-04:00 Rainer M Krug <Rainer at krugs.de>:

> Barry Rowlingson <b.rowlingson at lancaster.ac.uk> writes:
>
> > On Wed, Apr 8, 2015 at 7:53 PM, Arnaud Mosnier <a.mosnier at gmail.com>
> wrote:
> >> Dear useRs,
> >>
> >> I am searching for a way to break the 10 character limit of the field
> names
> >> in shapefiles created using for example the writeOGR function from the
> >> rgdal package.
> >>
> >> On way could be to define aliases for field names, but I am not aware
> of a
> >> function allowing me to do that.
> >
> >  Are aliases an ArcGIS thing for shapefile names? I can only see vague
> > references on the internet to something like that. Do you create field
> > name aliases in ArcGIS? Are they saved with the shapefile or with the
> > ArcGIS file? Do you get a foo.shp.xml file that is keeping this extra
> > metadata around? Perhaps we could reverse-engineer that and create it
> > in R.
> >
> >  Standards-compliant shapefiles can only have 10-character field names.
> >
> >  You could use another file format, such as GML or Spatialite, as long
> > as whatever you are saving these for can read them.
>
> There is always the possibility of a homegrown version, which should not
> be to difficult to implement. As soon as the shape file has been loaded,
> you can change the field names, and before you save it, you could change
> them back. The longer field names could be saved in a file.
>
> Rainer
>
>
> >
> > Barry
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
> Biology, UCT), Dipl. Phys. (Germany)
>
> Centre of Excellence for Invasion Biology
> Stellenbosch University
> South Africa
>
> Tel :       +33 - (0)9 53 10 27 44
> Cell:       +33 - (0)6 85 62 59 98
> Fax :       +33 - (0)9 58 10 27 44
>
> Fax (D):    +49 - (0)3 21 21 25 22 44
>
> email:      Rainer at krugs.de
>
> Skype:      RMkrug
>
> PGP: 0x0F52F982
>

	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Thu Apr  9 21:32:25 2015
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 9 Apr 2015 20:32:25 +0100
Subject: [R-sig-Geo] Define aliases in shapefiles
In-Reply-To: <6910512b4d6140539569dbcf8579101b@EX-0-HT0.lancs.local>
References: <CANkFkEfOg=U-E2w0hOXUOLB_w9qa8=fEpJwGWJsTbp6YuwXbkw@mail.gmail.com>
	<CANVKczMHzU-_uiOQ3MP06qYA=xp_tNNuEC=yniTtmuuoma96sw@mail.gmail.com>
	<m2y4m14j2f.fsf@krugs.de>
	<6910512b4d6140539569dbcf8579101b@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNddxy9X9=dR32e1Qp5y2=+SC8drtrRJMC5Qbd5U=4OJA@mail.gmail.com>

On Thu, Apr 9, 2015 at 6:51 PM, Arnaud Mosnier <a.mosnier at gmail.com> wrote:

> So I will create this for each of my shapefile ... but I expected that it
> could be embedded into the other "classic" shapefile files and could be read
> everywhere (it least in the most common GIS softwares).

I suspect the 10 char field name is one of the reasons everyone talks
about the "shapefile killer" format. That, and poor handling of
character sets, having to package three, four, five or more separate
files, and probably several other reasons.

 Really, if you can save as SpatiaLite (and you should be able to read
that into QGIS) you'll be using the latest "shapefile killer"
format.... Hopefully!

Barry


From ts2789 at tc.columbia.edu  Fri Apr 10 01:36:10 2015
From: ts2789 at tc.columbia.edu (Suga, Taeko)
Date: Thu, 9 Apr 2015 19:36:10 -0400
Subject: [R-sig-Geo] Background shapefile does not appear
In-Reply-To: <D14BCEE4.124F56%macqueen1@llnl.gov>
References: <CAGeqgYvug_sqNceDQZ8GSPo4cvniEPe29oyn1RwBBvfuxM5y+w@mail.gmail.com>
	<D14BCEE4.124F56%macqueen1@llnl.gov>
Message-ID: <CAGeqgYtwCLVjobXam0Ch_SKqa=Eb9uuDyJhkYQRyCNaBab2NNw@mail.gmail.com>

Dear Mr. MacQueen,

Thank you very much for your response.
1) I downloaded data (public school name, logitude, and latitude) from the
NCES Common Core Data.
2) I imported & displayed the data using "X Y Coordinate."
3) Coordinate System of Input Coordinates by "Import"nysd,shp" created by
the NYC Department of City Planning.

Projection: Lambert_Conformal_Conic
False_Easting: 984250.000000
False_Northing: 0.000000
Central_Meridian: -74.000000
Standard_Parallel_1: 40.666667
Standard_Parallel_2: 41.033333
Latitude_Of_Origin: 40.166667
Linear Unit: Foot_US (0.304801)

Geographic Coordinate System: GCS_North_American_1983
Angular Unit: Degree (0.017453292519943295)
Prime Meridian: Greenwich (0.000000000000000000)
Datum: D_North_American_1983
  Spheroid: GRS_1980
    Semimajor Axis: 6378137.000000000000000000
    Semiminor Axis: 6356752.314140356100000000
    Inverse Flattening: 298.257222101000020000

4) I exported "All features"
5) I added the exported data as a layer.
6) I added the nysd (new york school district)

But the shapefile (school district) does not appear.

My point file is:

Data Type: Shapefile Feature Class
Shapefile: C:\Users\Taeko\Desktop\Export_Output_9.shp
Geometry Type: Point

Projected Coordinate System:
NAD_1983_StatePlane_New_York_Long_Island_FIPS_3104_Feet
Projection: Lambert_Conformal_Conic
False_Easting: 984250.00000000
False_Northing: 0.00000000
Central_Meridian: -74.00000000
Standard_Parallel_1: 40.66666667
Standard_Parallel_2: 41.03333333
Latitude_Of_Origin: 40.16666667
Linear Unit: Foot_US

Geographic Coordinate System: GCS_North_American_1983
Datum: D_North_American_1983
Prime Meridian: Greenwich
Angular Unit: Degree


Thank you very much for your support.

Best,
Taeko



On Thu, Apr 9, 2015 at 9:44 AM, MacQueen, Don <macqueen1 at llnl.gov> wrote:

> My first guess is that your step "matched the geo-coding" did not succeed.
> But with no details it's hard to say.
>
> Is the NYC school district shapefile also in lat/long?
> If you apply the proj4string() function to both of your objects in R, do
> you get the same result?
> If you apply the bbox() function (bounding box) to both of them, do the
> bounding boxes at least overlap?
>
> Of course they are not shapefiles anymore after they have been loaded into
> R. Is the school point location data a SpatialPointsDataFrame, and the NYC
> school district a SpatialPolygonsDataFrame object?
>
> -Don
>
> --
> Don MacQueen
>
> Lawrence Livermore National Laboratory
> 7000 East Ave., L-627
> Livermore, CA 94550
> 925-423-1062
>
>
>
>
>
> On 4/8/15, 12:03 PM, "Suga, Taeko" <ts2789 at tc.columbia.edu> wrote:
>
> >Dear All,
> >
> >I have created a school-point-location shapefile, using the school point
> >location data (longitude & latitude) from the National Center for
> >Education
> >Statistics, Common Core Data system.
> >
> >I matched the geo-coding of the shapefile with the NYC school district
> >shapefile created by the NYC Department of City Planning.
> >
> >Then, I try to over lay the point location to the NYC school district
> >shapefile, but failed. The district shape file did not appear.
> >
> >Hope someone could help me.
> >Thank you!
> >
> >Taeko Suga
> >Ed.M. student
> >Teachers College
> >
> >       [[alternative HTML version deleted]]
> >
> >_______________________________________________
> >R-sig-Geo mailing list
> >R-sig-Geo at r-project.org
> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

	[[alternative HTML version deleted]]


From macqueen1 at llnl.gov  Fri Apr 10 02:00:03 2015
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Fri, 10 Apr 2015 00:00:03 +0000
Subject: [R-sig-Geo] Background shapefile does not appear
In-Reply-To: <CAGeqgYtwCLVjobXam0Ch_SKqa=Eb9uuDyJhkYQRyCNaBab2NNw@mail.gmail.com>
References: <CAGeqgYvug_sqNceDQZ8GSPo4cvniEPe29oyn1RwBBvfuxM5y+w@mail.gmail.com>
	<D14BCEE4.124F56%macqueen1@llnl.gov>
	<CAGeqgYtwCLVjobXam0Ch_SKqa=Eb9uuDyJhkYQRyCNaBab2NNw@mail.gmail.com>
Message-ID: <D14C5DFE.125032%macqueen1@llnl.gov>

This is a nice description of your steps, but I can't tell how it
translates to R (this is R-sig-Geo). For example, what does
    imported and displayed the data using "X Y Coordinate"
mean within R? Similarly,
  exported "All Features"
sounds like some sort of a menu command, not an R command.

What are the R commands that you used for these steps? Or at least the
plot commands.

There is advice available for how to ask questions about using R that it
would be good to take a look at:
    http://www.R-project.org/posting-guide.html
It is also helpful if you can provide commented, minimal, self-contained,
reproducible code.



-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062




From:  <Suga>, Taeko <ts2789 at tc.columbia.edu>
Date:  Thursday, April 9, 2015 at 4:36 PM
To:  dh m <macqueen1 at llnl.gov>
Cc:  "R-sig-Geo at r-project.org" <R-sig-Geo at r-project.org>
Subject:  Re: [R-sig-Geo] Background shapefile does not appear


Dear Mr. MacQueen,

Thank you very much for your response.
1) I downloaded data (public school name, logitude, and latitude) from the
NCES Common Core Data.
2) I imported & displayed the data using "X Y Coordinate."
3) Coordinate System of Input Coordinates by "Import"nysd,shp" created by
the NYC Department of City Planning.

Projection: Lambert_Conformal_Conic
False_Easting: 984250.000000
False_Northing: 0.000000
Central_Meridian: -74.000000
Standard_Parallel_1: 40.666667
Standard_Parallel_2: 41.033333
Latitude_Of_Origin: 40.166667
Linear Unit: Foot_US (0.304801)

Geographic Coordinate System: GCS_North_American_1983
Angular Unit: Degree (0.017453292519943295)
Prime Meridian: Greenwich (0.000000000000000000)
Datum: D_North_American_1983
  Spheroid: GRS_1980
    Semimajor Axis: 6378137.000000000000000000
    Semiminor Axis: 6356752.314140356100000000
    Inverse Flattening: 298.257222101000020000


4) I exported "All features"
5) I added the exported data as a layer.
6) I added the nysd (new york school district)

But the shapefile (school district) does not appear.

My point file is:

Data Type: Shapefile Feature Class
Shapefile: C:\Users\Taeko\Desktop\Export_Output_9.shp
Geometry Type: Point

Projected Coordinate
System:NAD_1983_StatePlane_New_York_Long_Island_FIPS_3104_Feet
Projection: Lambert_Conformal_Conic
False_Easting: 984250.00000000
False_Northing: 
0.00000000
Central_Meridian: 
-74.00000000
Standard_Parallel_1:
40.66666667
Standard_Parallel_2:
41.03333333
Latitude_Of_Origin:
40.16666667
Linear Unit: Foot_US

Geographic Coordinate System:GCS_North_American_1983
Datum: D_North_American_1983
Prime Meridian: Greenwich
Angular Unit: Degree



Thank you very much for your support.

Best,
Taeko




On Thu, Apr 9, 2015 at 9:44 AM, MacQueen, Don
<macqueen1 at llnl.gov> wrote:

My first guess is that your step "matched the geo-coding" did not succeed.
But with no details it's hard to say.

Is the NYC school district shapefile also in lat/long?
If you apply the proj4string() function to both of your objects in R, do
you get the same result?
If you apply the bbox() function (bounding box) to both of them, do the
bounding boxes at least overlap?

Of course they are not shapefiles anymore after they have been loaded into
R. Is the school point location data a SpatialPointsDataFrame, and the NYC
school district a SpatialPolygonsDataFrame object?

-Don

--
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062 <tel:925-423-1062>





On 4/8/15, 12:03 PM, "Suga, Taeko" <ts2789 at tc.columbia.edu> wrote:

>Dear All,
>
>I have created a school-point-location shapefile, using the school point
>location data (longitude & latitude) from the National Center for
>Education
>Statistics, Common Core Data system.
>
>I matched the geo-coding of the shapefile with the NYC school district
>shapefile created by the NYC Department of City Planning.
>
>Then, I try to over lay the point location to the NYC school district
>shapefile, but failed. The district shape file did not appear.
>
>Hope someone could help me.
>Thank you!
>
>Taeko Suga
>Ed.M. student
>Teachers College
>


>       [[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ts2789 at tc.columbia.edu  Fri Apr 10 02:41:22 2015
From: ts2789 at tc.columbia.edu (Suga, Taeko)
Date: Thu, 9 Apr 2015 20:41:22 -0400
Subject: [R-sig-Geo] Background shapefile does not appear
In-Reply-To: <D14C5DFE.125032%macqueen1@llnl.gov>
References: <CAGeqgYvug_sqNceDQZ8GSPo4cvniEPe29oyn1RwBBvfuxM5y+w@mail.gmail.com>
	<D14BCEE4.124F56%macqueen1@llnl.gov>
	<CAGeqgYtwCLVjobXam0Ch_SKqa=Eb9uuDyJhkYQRyCNaBab2NNw@mail.gmail.com>
	<D14C5DFE.125032%macqueen1@llnl.gov>
Message-ID: <CAGeqgYsw8JfT+sb+5HiTPu1-1E-DbraZUZ_wx0mG0NxWdWrSmg@mail.gmail.com>

I am sorry that I am only using ArcGIS and do not know R well.
Professor recommended us to join the mailing list when I took a GIS class
last year in which we learned a little about R.

I find the differences in the "Extent" between my point shapefile and the
NYC school district file:

My point shapefile has: Top (40.902338??), Bottom (40.507909??), Left
(-74.243994??), and Right (-73.708851??)

NYC shapefile has: Top (272844.293801 ft), Bottom (120121.881268 ft), Left
(913175.108826 ft), and Right (1067382.508423 ft).

I guess my point file has longitude and latitude in the "Extent" and may
need some conversion.

Sorry that I do not use R.

Anyway, thank you very much for your time and help.

Best,
Taeko

On Thu, Apr 9, 2015 at 8:00 PM, MacQueen, Don <macqueen1 at llnl.gov> wrote:

> This is a nice description of your steps, but I can't tell how it
> translates to R (this is R-sig-Geo). For example, what does
>     imported and displayed the data using "X Y Coordinate"
> mean within R? Similarly,
>   exported "All Features"
> sounds like some sort of a menu command, not an R command.
>
> What are the R commands that you used for these steps? Or at least the
> plot commands.
>
> There is advice available for how to ask questions about using R that it
> would be good to take a look at:
>     http://www.R-project.org/posting-guide.html
> It is also helpful if you can provide commented, minimal, self-contained,
> reproducible code.
>
>
>
> --
> Don MacQueen
>
> Lawrence Livermore National Laboratory
> 7000 East Ave., L-627
> Livermore, CA 94550
> 925-423-1062
>
>
>
>
> From:  <Suga>, Taeko <ts2789 at tc.columbia.edu>
> Date:  Thursday, April 9, 2015 at 4:36 PM
> To:  dh m <macqueen1 at llnl.gov>
> Cc:  "R-sig-Geo at r-project.org" <R-sig-Geo at r-project.org>
> Subject:  Re: [R-sig-Geo] Background shapefile does not appear
>
>
> Dear Mr. MacQueen,
>
> Thank you very much for your response.
> 1) I downloaded data (public school name, logitude, and latitude) from the
> NCES Common Core Data.
> 2) I imported & displayed the data using "X Y Coordinate."
> 3) Coordinate System of Input Coordinates by "Import"nysd,shp" created by
> the NYC Department of City Planning.
>
> Projection: Lambert_Conformal_Conic
> False_Easting: 984250.000000
> False_Northing: 0.000000
> Central_Meridian: -74.000000
> Standard_Parallel_1: 40.666667
> Standard_Parallel_2: 41.033333
> Latitude_Of_Origin: 40.166667
> Linear Unit: Foot_US (0.304801)
>
> Geographic Coordinate System: GCS_North_American_1983
> Angular Unit: Degree (0.017453292519943295)
> Prime Meridian: Greenwich (0.000000000000000000)
> Datum: D_North_American_1983
>   Spheroid: GRS_1980
>     Semimajor Axis: 6378137.000000000000000000
>     Semiminor Axis: 6356752.314140356100000000
>     Inverse Flattening: 298.257222101000020000
>
>
> 4) I exported "All features"
> 5) I added the exported data as a layer.
> 6) I added the nysd (new york school district)
>
> But the shapefile (school district) does not appear.
>
> My point file is:
>
> Data Type: Shapefile Feature Class
> Shapefile: C:\Users\Taeko\Desktop\Export_Output_9.shp
> Geometry Type: Point
>
> Projected Coordinate
> System:NAD_1983_StatePlane_New_York_Long_Island_FIPS_3104_Feet
> Projection: Lambert_Conformal_Conic
> False_Easting: 984250.00000000
> False_Northing:
> 0.00000000
> Central_Meridian:
> -74.00000000
> Standard_Parallel_1:
> 40.66666667
> Standard_Parallel_2:
> 41.03333333
> Latitude_Of_Origin:
> 40.16666667
> Linear Unit: Foot_US
>
> Geographic Coordinate System:GCS_North_American_1983
> Datum: D_North_American_1983
> Prime Meridian: Greenwich
> Angular Unit: Degree
>
>
>
> Thank you very much for your support.
>
> Best,
> Taeko
>
>
>
>
> On Thu, Apr 9, 2015 at 9:44 AM, MacQueen, Don
> <macqueen1 at llnl.gov> wrote:
>
> My first guess is that your step "matched the geo-coding" did not succeed.
> But with no details it's hard to say.
>
> Is the NYC school district shapefile also in lat/long?
> If you apply the proj4string() function to both of your objects in R, do
> you get the same result?
> If you apply the bbox() function (bounding box) to both of them, do the
> bounding boxes at least overlap?
>
> Of course they are not shapefiles anymore after they have been loaded into
> R. Is the school point location data a SpatialPointsDataFrame, and the NYC
> school district a SpatialPolygonsDataFrame object?
>
> -Don
>
> --
> Don MacQueen
>
> Lawrence Livermore National Laboratory
> 7000 East Ave., L-627
> Livermore, CA 94550
> 925-423-1062 <tel:925-423-1062>
>
>
>
>
>
> On 4/8/15, 12:03 PM, "Suga, Taeko" <ts2789 at tc.columbia.edu> wrote:
>
> >Dear All,
> >
> >I have created a school-point-location shapefile, using the school point
> >location data (longitude & latitude) from the National Center for
> >Education
> >Statistics, Common Core Data system.
> >
> >I matched the geo-coding of the shapefile with the NYC school district
> >shapefile created by the NYC Department of City Planning.
> >
> >Then, I try to over lay the point location to the NYC school district
> >shapefile, but failed. The district shape file did not appear.
> >
> >Hope someone could help me.
> >Thank you!
> >
> >Taeko Suga
> >Ed.M. student
> >Teachers College
> >
>
>
> >       [[alternative HTML version deleted]]
> >
> >_______________________________________________
> >R-sig-Geo mailing list
> >R-sig-Geo at r-project.org
> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
>
>
>

	[[alternative HTML version deleted]]


From dclare at unimelb.edu.au  Fri Apr 10 02:54:11 2015
From: dclare at unimelb.edu.au (Clare Death)
Date: Fri, 10 Apr 2015 00:54:11 +0000
Subject: [R-sig-Geo] adehabitatHR functions estUDm2spixdf & kernelUD
Message-ID: <D55ACF4BDEC48E4B83AA1A3BBB8BAF775CE2E61B@000S-EX-MBX-QS3.unimelb.edu.au>

Hello,

I am calculating the utilisation distribution (UD) for a group of mammals (n = 37), in order to define their individual exposure to an environmental contaminant. I need to know the meaning of the value returned in each cell of the converted UD output, as I need to multiply this by the contaminant levels in those cells. It is difficult to be certain what each cell value represents.

I have two questions - thank-you for any assistance:

1) When using the estUDm2spixdf conversion: What does the function return for each cell? The probability that an animal will be found in the cell, the number of fixes per cell, the number of fixes per unit area, or a 1 or 0 flag to identify if the animal is present or absent from the cell, or something else?

2) Does the grid parameter of the kernelUD script reflect the cell dimensions of the total grid area (i.e. an arbitrary value for resolution of the pixels)? In the code below I?ve entered grid = 125. Does this mean that a grid is constructed where there are 125 cells in the horizontal dimension and 125 in the vertical (i.e. 125 * 125 = 15625 cells in total).

Some example script:
spat_dat.spdf <- SpatialPointsDataFrame(spat_dat[,6:7], spat_dat)
kud <- kernelUD(xy = spat_dat.spdf[,1], h = "href", same4all = TRUE, grid = 125)
kud.spdf <- estUDm2spixdf(kud)

Kind regards,
Dr. Clare Death
Faculty of Veterinary and Agricultural Sciences
The University of Melbourne, Australia


	[[alternative HTML version deleted]]


From eerdeni at nies.go.jp  Fri Apr 10 04:10:08 2015
From: eerdeni at nies.go.jp (eerdeni)
Date: Fri, 10 Apr 2015 11:10:08 +0900
Subject: [R-sig-Geo] Define aliases in shapefiles
In-Reply-To: <CANVKczMHzU-_uiOQ3MP06qYA=xp_tNNuEC=yniTtmuuoma96sw@mail.gmail.com>
References: <CANkFkEfOg=U-E2w0hOXUOLB_w9qa8=fEpJwGWJsTbp6YuwXbkw@mail.gmail.com>
	<CANVKczMHzU-_uiOQ3MP06qYA=xp_tNNuEC=yniTtmuuoma96sw@mail.gmail.com>
Message-ID: <002401d07333$7b5838d0$7208aa70$@nies.go.jp>

Hi

I can not run the [unionExtent]. Where do Will be solved if you install from
the what package . Please tell me.

Regards,




-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Barry
Rowlingson
Sent: Thursday, April 9, 2015 8:36 PM
To: Arnaud Mosnier
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Define aliases in shapefiles

On Wed, Apr 8, 2015 at 7:53 PM, Arnaud Mosnier <a.mosnier at gmail.com> wrote:
> Dear useRs,
>
> I am searching for a way to break the 10 character limit of the field 
> names in shapefiles created using for example the writeOGR function 
> from the rgdal package.
>
> On way could be to define aliases for field names, but I am not aware 
> of a function allowing me to do that.

 Are aliases an ArcGIS thing for shapefile names? I can only see vague
references on the internet to something like that. Do you create field name
aliases in ArcGIS? Are they saved with the shapefile or with the ArcGIS
file? Do you get a foo.shp.xml file that is keeping this extra metadata
around? Perhaps we could reverse-engineer that and create it in R.

 Standards-compliant shapefiles can only have 10-character field names.

 You could use another file format, such as GML or Spatialite, as long as
whatever you are saving these for can read them.

Barry

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Fri Apr 10 10:38:01 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Apr 2015 10:38:01 +0200
Subject: [R-sig-Geo] Holes in polygons disappear after performing
 checkPolygonsHoles from maptools
In-Reply-To: <551EF5E7.5080006@mathematik.uni-marburg.de>
References: <551C32E3.1010902@mathematik.uni-marburg.de>
	<551D3B24.8070705@uni-muenster.de>
	<alpine.LFD.2.11.1504021638580.29472@reclus.nhh.no>
	<alpine.LFD.2.11.1504022223030.9896@reclus.nhh.no>
	<551E4568.3050608@mathematik.uni-marburg.de>
	<alpine.LFD.2.11.1504031309560.18824@reclus.nhh.no>
	<551E8C3B.70504@mathematik.uni-marburg.de>
	<alpine.LFD.2.11.1504032037440.24504@reclus.nhh.no>
	<551EF5E7.5080006@mathematik.uni-marburg.de>
Message-ID: <alpine.LFD.2.11.1504100828170.1934@reclus.nhh.no>

This posting turned out to be of major importance, and the conclusion 
below is a star case of the importance of contributing postings with 
well-constructed reproducible examples. Thanks to Grigory's careful 
contribution, a potential weakness in sp for R >= 3.1 has been found and 
corrected, details below.

On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:

>
>
> Am 03.04.2015 um 20:42 schrieb Roger Bivand:
>>  On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:
>> > 
>> >  Am 03.04.2015 um 13:16 schrieb Roger Bivand:
>> > >   On Fri, 3 Apr 2015, Grigory Alexandrovich wrote:
>> > > 
>> > > >   Am 02.04.2015 um 22:24 schrieb Roger Bivand:
>> > > > >   On Thu, 2 Apr 2015, Roger Bivand wrote:
>> > > > > > > >   On Thu, 2 Apr 2015, Edzer Pebesma wrote:
>> > > > > > > > > > > > > > > > > >    On 04/01/2015 08:03 PM, Grigory 
>> > >  Alexandrovich wrote:
>> > > > > > > >    Hello all,
>> > > > > > > > >    I encountered the following unexpected result using
>> > > > > > >   checkPolygonsHoles:
>> > > > > > > > >    # attach the worldmap as SpatialPolygonsDataFrame from 
>> > >  the
>> > > > > > > package >    maptools
>> > > > > > > >    library(sp)
>> > > > > > > >    library(maptools)
>> > > > > > > >    data(wrld_simpl)
>> > > > > > > > >    # get a polygon with a hole
>> > > > > > > >    shape_with_hole <- wrld_simpl[5,]
>> > > > > > > > >    # plot it (hole is left white, surrounded by blue color)
>> > > > > > > >    plot(shape_with_hole, col = "blue")
>> > > > > > > > >    # perform checkPolygonsHoles
>> > > > > > > >    shape_with_hole at polygons <- 
>> > >  lapply(shape_with_hole at polygons,
>> > > > > > > >    checkPolygonsHoles)
>> > > > > > > > >    # plot again, now holes aren't recognized as such
>> > > > > > > >    plot(shape_with_hole, col = "blue")
>> > > > > > > > >    # and even the original SpatialPolygonsDataFrame 
>> > >  object is
>> > > > > > >   changed !?
>> > > > > > > >    plot(wrld_simpl[5,], col = "blue")
>> > > > > > > > >    One irritating side effect here is that the original 
>> > >  object
>> > > > > > >   wrld_simpl
>> > > > > > > >    is also changed. This result looks to me like a bug, or 
>> > >  have I
>> > > > > > >   missed
>> > > > > > > >    something?
>> > 
>> 
> Roger, actually I didn't run update.packages()  on the corresponding spatial 
> packages yet, since I installed them maybe two-three months ago.
> Anyway, I just installed the newest R Version (3.1.3)  and the required 
> packages and  the problem doesn't appear any more.
> So one should take care using older versions of the rgeos/rgdal packages.

The identification of a modification without assignment, resulting in the 
ring direction of holes being flipped in maptools::checkPolygonsHoles 
using rgeos, was correct. Forthcoming sp 1.1-0 resolves the issue.

The issue was that some Spatial* objects (lines and polygons) involve new 
style classes with slots with lists of member objects. R says that it 
passes objects by value, but actually passes by reference in C, counting 
whether an object is modified and so needs to be duplicated. Before R 3.1, 
the internal mechanisms for copying objects in C functions were very 
defensive (counting more than strictly necessary), so reference chains 
were broken by possibly excessive copying.

The C code for handling Polygons and Polygon objects was added to sp in 
2009, and is also used in rgdal and rgeos.

In 2014, R 3.1 changed the way that the need for automatic duplication of 
objects was counted, so that sp code previously protected not by design 
but by R's defensive copying strategy became exposed. In this particular 
case, maptools::checkPolygonsHoles calls sp functions to turn a Polygons 
object into a SpatialPolygons object - where each Polygons object had one 
Polygon object with unknown hole status, but the underlying C code 
did not duplicate these object components explicitly.

The forthcoming sp version (now on R-forge), in addition to other changes, 
introduces explicit duplication in C code, and the behaviour reported here 
for R 3.1 and later is now corrected, so that the same results will be 
available without change across R versions.

It is unlikely that the lack of duplication has had major impacts, as it 
does not seem to affect rgdal or rgeos, but did affect the manipulation of 
objects using sp in some limited cases.

Without Grigory's clear report, analysis and testing by Ezder Pebesma and 
myself, and advice from R-core members Luke Tierney and Michael Lawrence, 
we would not have resolved this issue.

We remain crucially dependent on users reporting unexpected behavious 
clearly!

Roger


>
> Thank you and Edzer for the concurrence and your contributions to R's spatial 
> analysis toolkit.
>
> Grigory
>
>
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From hengl at spatial-analyst.net  Fri Apr 10 12:09:12 2015
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 10 Apr 2015 12:09:12 +0200
Subject: [R-sig-Geo] [DKIM] Re: FW: Spatial sampling design using
 information more than spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <1a35f31662934bbcaa26f6f9ec3ce310@WIN-EXCH01.agso.gov.au>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
	<alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>
	<de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
	<066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>
	<55252F8F.2080500@spatial-analyst.net>
	<23118_1428535975_5525BAA5_23118_10078_1_CALyPt8yVYFYHBJAd-TddsWeazG+3xWKAoA7exG_rhf_E1udwFg@mail.gmail.com>
	<1a35f31662934bbcaa26f6f9ec3ce310@WIN-EXCH01.agso.gov.au>
Message-ID: <5527A148.9080506@spatial-analyst.net>


Jin,

When it comes to stratification prior to any model building (hence no 
prior predictions) I think that a robust way to stratify an area would 
be to use a combination of PCA and unsupervised fuzzy k-means. Here is 
an example:

R> library(GSIF)
R> library(plotKML)
R> library(sp)
R> data(eberg_grid)
R> gridded(eberg_grid) <- ~x+y
R> proj4string(eberg_grid) <- CRS("+init=epsg:31467")
R> formulaString <- ~ PRMGEO6+DEMSRT6+TWISRT6+TIRAST6
R> eberg_spc <- spc(eberg_grid, formulaString)
Converting PRMGEO6 to indicators...
Converting covariates to principal components...
R> kmeans.eberg <- kmeans(eberg_spc at predicted@data, 4)
R> eberg_grid$cluster.4 <- as.factor(kmeans.eberg$cluster)
R> spplot(eberg_grid["cluster.4"], col.regions=rainbow(4))

I had problems following the procedure you described (a combination of 
geographical clustering first, then sampling in feature space). Maybe 
you do only need to use the clhs 
(http://www.inside-r.org/packages/cran/clhs/docs) or lhs package because 
this is a standard statistical method when it comes to sampling in 
feature space? It all depends on what is the purpose of sampling - 
validation, model building (maximum representation)...

HTH

Tom #1


On 9-4-2015 3:49, Jin.Li at ga.gov.au wrote:
> Hi Tom 2  :-),
>
> To be specific,  we need to do the spatial stratification first and need
> to stratify the survey area into n equal-area strata. The function
> stratify with equalArea in spcosa meets this need well.
>
> And then within each stratum, we need to do further stratification based
> on a raster layer of 'elevation' that is a continuous layer and needs to
> be converted into 3 zones. We need to sample m samples within each
> stratum and these samples need to be evenly distributed within each
> zone. That is we need to use the area of each zone as a weight to decide
> how many samples should be allocated to each zone. And then do randomly
> sampling within each zone.
>
> A further challenge is that they plan to sample 1 to 4 samples a day
> during 25 days, so we need to provide four designs with 25, 50, 75 and
> 100 samples respectively. The samples of the design with smaller sample
> size need to be nested in the samples of the design with larger sample
> size for operational reasons as the survey needs to meet other tasks and
> also to accommodate weather conditions at sea. Now you know the
> 'elevation' is bathymetry that is the depth of water. We plan to let n =
> 25, and m = 1 to 4. But it is hard to stratify if a stratum contains 3
> zones and m <3.
>
> Hope this clarify things a bit. Any further suggestions are appreciated!
>
> Jin
>
> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
> Tom Philippi
> Sent: Thursday, 9 April 2015 9:32 AM
> To: Tomislav Hengl
> Cc: r-sig-geo
> Subject: [DKIM] Re: [R-sig-Geo] FW: Spatial sampling design using
> information more than spatial coordinates [SEC=UNCLASSIFIED]
>
> Jin--
>
> Could you provide more information on what the needs of your client are
> that cannot be handled by either stratification or unequal probability
> based on your one or more covariates in spsurvey?  Also, is your sample
> frame points, polygons, or raster?  I assume your covariates are raster
> (e.g., DEM for elevation) and polygons (most soil maps)?
>
> Tom 2
>
> On Wed, Apr 8, 2015 at 6:39 AM, Tomislav Hengl
> <hengl at spatial-analyst.net <mailto:hengl at spatial-analyst.net>>
>
> wrote:
>
>  >
>
>  > The "clhs" package (http://cran.r-project.org/web/packages/clhs/) has
>
>  > some functionality for latin-hypercube sampling hence it is suitable
>
>  > for your case. Here are some code examples: http://gsif.isric.org/doku.
>
>  > php?id=wiki:tutorial_eberg#testing_the_feature_space_coverage
>
>  >
>
>  > I have also recently (experimentally) implemented a function to test
>
>  > 'efficiency of any sampling plan' which looks at both geographical
>
>  > space and feature space representation: http://gsif.r-forge.r-project.
>
>  > org/spsample.prob.html
>
>  > If you discover a bug or some 'strange behavior', please let me know.
>
>  >
>
>  > HTH,
>
>  >
>
>  > T. (Tom) Hengl
>
>  > Researcher @ ISRIC - World Soil Information Team member Africa Soil
>
>  > Information Services http://africasoils.net
>
>  > Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
>
>  > Network: http://profiles.google.com/tom.hengl
>
>  > Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ
>
>  >
>
>  >
>
>  >
>
>  > On 8-4-2015 2:24, Jin.Li at ga.gov.au <mailto:Jin.Li at ga.gov.au> wrote:
>
>  >
>
>  >> Sorry for not ccing to the list!
>
>  >>
>
>  >> -----Original Message-----
>
>  >> From: Li Jin
>
>  >> Sent: Tuesday, 7 April 2015 9:36 AM
>
>  >> To: 'Roger.Bivand at nhh.no'
>
>  >> Subject: RE: [R-sig-Geo] Spatial sampling design using information
>
>  >> more than spatial coordinates [SEC=UNCLASSIFIED]
>
>  >>
>
>  >> Thanks a lot, Roger! Yes, we have looked at spsurvey and it does not
>
>  >> meet the needs of our client.
>
>  >> Kind regards,
>
>  >> Jin
>
>  >>
>
>  >> -----Original Message-----
>
>  >> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>
>  >> Sent: Friday, 3 April 2015 2:06 AM
>
>  >> To: Li Jin
>
>  >> Cc: r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>
>
>  >> Subject: Re: [R-sig-Geo] Spatial sampling design using information
>
>  >> more than spatial coordinates [SEC=UNCLASSIFIED]
>
>  >>
>
>  >> On Thu, 2 Apr 2015, Jin.Li at ga.gov.au <mailto:Jin.Li at ga.gov.au> wrote:
>
>  >>
>
>  >>  Hi All,
>
>  >>>
>
>  >>> I need to consider both spatial information and another variable (e.g.
>
>  >>> elevation, soil type) in a sampling design. It seems the available
>
>  >>> libraries (e.g. sp and spcosa) in R for spatial sampling design are
>
>  >>> unable to handle it. Please correct me if I am wrong. Before I start
>
>  >>> to develop my own function for it, I would like to confirm if I have
>
>  >>> missed some other functions that are available for it in R.  Any
>
>  >>> suggestions and advice? Thanks in advance!
>
>  >>>
>
>  >>
>
>  >> Have you looked at spsurvey? It may not provide what you need, but
>
>  >> checking it would probably help you see whether there is anything
>
>  >> meeting your needs. Otherwise you might need to stratify first on
> your covariates.
>
>  >>
>
>  >> Roger
>
>  >>
>
>  >>
>
>  >>> Regards,
>
>  >>> Jin
>
>  >>>
>
>  >>> Jin Li, PhD
>
>  >>> Spatial Modeller/Computational Statistician  |  National Earth and
>
>  >>> Marine Observations Group Environmental Geoscience Division  |
>
>  >>> GEOSCIENCE AUSTRALIA ______________________________
>
>  >>> ______________________________
>
>  >>> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
>
>  >>> Email: Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au
> <mailto:Jin.Li at ga.gov.au%3cmailto:Jin.Li at ga.gov.au>>    Web:
> www.ga.gov.au <http://www.ga.gov.au>
>
>  >>> <http://www.ga.gov.au/>
>
>  >>> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT GPO Box
>
>  >>> 378 Canberra ACT 2601 Australia Applying geoscience to Australia's
>
>  >>> most important challenges
>
>  >>>
>
>  >>>
>
>  >>> Geoscience Australia Disclaimer: This e-mail (and files transmitted
>
>  >>> with
>
>  >>> it) is intended only for the person or entity to which it is
>
>  >>> addressed. If you are not the intended recipient, then you have
>
>  >>> received this e-mail by mistake and any use, dissemination,
>
>  >>> forwarding, printing or copying of this e-mail and its file
>
>  >>> attachments is prohibited. The security of emails transmitted cannot
>
>  >>> be guaranteed; by forwarding or replying to this email, you
> acknowledge and accept these risks.
>
>  >>> --------------------------------------------------------------------
>
>  >>> --
>
>  >>> ---------------------------------------------------
>
>  >>>
>
>  >>>
>
>  >>>         [[alternative HTML version deleted]]
>
>  >>>
>
>  >>> _______________________________________________
>
>  >>> R-sig-Geo mailing list
>
>  >>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >>>
>
>  >>>
>
>  >> --
>
>  >> Roger Bivand
>
>  >> Department of Economics, Norwegian School of Economics, Helleveien
>
>  >> 30,
>
>  >> N-5045 Bergen, Norway.
>
>  >> voice: +47 55 95 93 55; fax +47 55 95 91 00
>
>  >> e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
>
>  >>
>
>  >>
>
>  >> Geoscience Australia Disclaimer: This e-mail (and files transmitted
>
>  >> with
>
>  >> it) is intended only for the person or entity to which it is
>
>  >> addressed. If you are not the intended recipient, then you have
>
>  >> received this e-mail by mistake and any use, dissemination,
>
>  >> forwarding, printing or copying of this e-mail and its file
>
>  >> attachments is prohibited. The security of emails transmitted cannot
>
>  >> be guaranteed; by forwarding or replying to this email, you
> acknowledge and accept these risks.
>
>  >>
>
>  >> _______________________________________________
>
>  >> R-sig-Geo mailing list
>
>  >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >>
>
>  >>
>
>  > _______________________________________________
>
>  > R-sig-Geo mailing list
>
>  > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >
>
>                  [[alternative HTML version deleted]]
>
> _______________________________________________
>
> R-sig-Geo mailing list
>
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted with
> it) is intended only for the person or entity to which it is addressed.
> If you are not the intended recipient, then you have received this
> e-mail by mistake and any use, dissemination, forwarding, printing or
> copying of this e-mail and its file attachments is prohibited. The
> security of emails transmitted cannot be guaranteed; by forwarding or
> replying to this email, you acknowledge and accept these risks.
> -------------------------------------------------------------------------------------------------------------------------
>


From mauriziomarchi85 at gmail.com  Sat Apr 11 12:19:57 2015
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Sat, 11 Apr 2015 10:19:57 +0000
Subject: [R-sig-Geo] Raster map from data.frame
In-Reply-To: <CAAcGz9_eJ9wvHF4iZ9Tn+b7LruYnhc+Xr5JYxuVz3aT9DkK-wQ@mail.gmail.com>
References: <CANJhsN2ibPko39jxtXaYQUwDmHNPKQ06yk1REsW9DNCctAet9w@mail.gmail.com>
	<CAAcGz9_eJ9wvHF4iZ9Tn+b7LruYnhc+Xr5JYxuVz3aT9DkK-wQ@mail.gmail.com>
Message-ID: <CANJhsN22YUZJfdYsF9hNSacqcm1ag2scASaHyi142MauwnRy0w@mail.gmail.com>

Hi Michael, many thanks for your answer. The raster::rasterFromXYZ function
works perfectly and you solved my problem!! Many thanks

Il giorno gio 9 apr 2015 alle ore 15:29 Michael Sumner <mdsumner at gmail.com>
ha scritto:

> raster::rasterFromXYZ  should do the trick. I always feel a little ill
> turning raw tabular data into a raster, it's so easy(!) but represents a
> ridiculous amount of redundancy that gets turned into a simple rule - which
> is what the data should have been in the first place.
>
> A somewhat more general solution exists in sp, you would do this ("d" is
> your data frame with "x", "y", "z" columns):
>
> library(sp)
> coordinates(d) <- c("x", "y")
> gridded(d) <- TRUE
>
> That would give you a "SpatialPixelsDataFrame", which does two things
> (that should be separate IMO):
>
> - allows the grid to be sparse (note that algorithms to detect
> "regularity" in any arbitrary set of coordinates is quite hard to achieve,
> and impossible in some scenarios - if it's a grid that should be explicit,
> why would its extent be defined by populated cells, etc., rant . . .)
> - it allows some level of non-regularity, and it  justifies this by
> storing the original explicit coordinates so it can restore them if needed
>
> Also note the raster::rasterFromXYZ case needs extra work to apply it to
> multiple-attributed grids (no matter if you have one "z" column or any
> number of them the sp case works fine). You can also ingest any sp grid
> into raster() or raster::stack() or brick(). If rgdal is present you can
> writeRaster() to a .tif as well.
>
> If your data really are not regular (why would you store all those
> coordinates?), then you might
> - rasterize from irregular data (or explore other model solutions from
> packages like gstat)
> - use sp::points2grid to control the threshold of "regularity" (really
> this is for getting around numeric fuzz, but can be used)
>
> (note also that rasterFromXYZ has a digits argument, similar to
> points2grid's eps)
>
> HTH
>
>
>
>
>
> On Thu, 9 Apr 2015 at 22:44 Maurizio Marchi <mauriziomarchi85 at gmail.com>
> wrote:
>
>> Hi everybody, I need help with a big dataset that I need to transform in a
>> group of raster files. I have a big .csv (2 GB with 5 millions rows and 90
>> columns) which I want to transform in a group of raster images. The First
>> two culms represent the geographical coordinates while the others 88
>> columns represent the values I want to give to each cell of each raster
>> (temperatures, precipitations etc...). The database is compiled only with
>> the cells that will have a value (NA cells were not calculated).  I often
>> used the data.frame2ascii function of SDMTools package but in this case
>> the
>> function doesn't works (too many rows maybe?).
>> Any suggestion? I prefer the .asc format but even GeoTiff or other formats
>> would be ok.
>>
>> Manu thanks,
>> Maurizio
>>
>>
>>
>> --
>> Maurizio Marchi
>> Calenzano (FI) - Italy
>> ID Skype: maurizioxyz
>> Ubuntu 14.04 LTS
>> linux user 552742
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

	[[alternative HTML version deleted]]


From jl.iccp at gmail.com  Sun Apr 12 17:40:25 2015
From: jl.iccp at gmail.com (Jue Lin-Ye)
Date: Sun, 12 Apr 2015 17:40:25 +0200
Subject: [R-sig-Geo] Fwd: Pie charts on a map. v2
In-Reply-To: <CAAMkPW9TFZtgDw-HopLX-EmbgVXv47yNbPyiHpniQhMVaXkJ=A@mail.gmail.com>
References: <CAAMkPW9TFZtgDw-HopLX-EmbgVXv47yNbPyiHpniQhMVaXkJ=A@mail.gmail.com>
Message-ID: <CAAMkPW8Ep-T27eTMvSGDkyvg4gFqR8qaygB3zrmsDR2iQvYS6A@mail.gmail.com>

?
Dear sirs/madams,

May someone please help me with this issue: I have been trying to plot pie
charts on a map, without much success (see code enclosed herein). This is
quite distressing to me, as I had plot the same kind of map before without
problems. It would be appreciated if anyone would point out the flaw. I
enclose a reproducible set of data and codes for you to work with. I have
tested the code, you just have to paste the three of the files in the same
folder.

Thank you very much in advance.
?

-- 
Jue Lin-Ye

---------------------------------------------------------------
Civil Engineering phD candidate
Maritime Engineering Laboratory (LIM)
Universitat Polit?cnica de Catalunya (UPC)
C/Jordi Girona 1-3, Barcelona 08034 (Spain)
-----------------------------------------------------------------

?
?
? P.S.: My e-mails asking for questions are sometimes quite short and can
seem rude, I am sorry for that. The truth is that I hearfully appreciate
any help of yours. ?
?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150412/9a177eb1/attachment.html>
-------------- next part --------------
"node" "long" "lat" "prob1" "prob2" "prob3" "prob4" "prob5"
"1" 1 40.613 0.75 863 792 67 0 0
"2" 2 40.793 0.75 871 851 0 0 0
"3" 3 40.973 1 863 357 537 0 0
"4" 4 40.973 1 874 351 536 0 0
"5" 5 40.973 1 862 377 522 0 0
"6" 6 41.153 1.75 765 322 191 441 0
"7" 7 41.153 2 531 328 242 156 508
"8" 8 41.333 2.25 647 324 164 123 457
"9" 9 41.333 2.25 632 345 143 115 413
"10" 10 41.333 2.25 640 315 165 102 433
"11" 11 41.333 2.25 678 314 173 102 426
"12" 12 41.333 2.25 628 311 147 112 445
"13" 13 41.513 2.5 782 357 208 417 206
"14" 14 41.513 2.5 669 340 181 348 190
"15" 15 41.513 2.5 692 320 185 371 166
"16" 16 41.513 2.5 670 335 163 369 195
"17" 17 41.513 2.75 528 322 190 145 533
"18" 18 41.693 3 550 309 183 118 459
"19" 19 41.693 3 587 322 187 113 467
"20" 20 42.052 3.25 591 283 147 80 418
"21" 21 42.232 3.25 395 156 66 43 216
"22" 22 42.232 3.25 350 118 62 30 219
"23" 23 42.412 3.25 256 94 45 19 173
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Piecharts.R
Type: text/x-r-source
Size: 537 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150412/9a177eb1/attachment.bin>
-------------- next part --------------
5 36.6 68.2 99.8 131.4 163

From jbaldwin at fs.fed.us  Sun Apr 12 18:15:20 2015
From: jbaldwin at fs.fed.us (Baldwin, Jim -FS)
Date: Sun, 12 Apr 2015 16:15:20 +0000
Subject: [R-sig-Geo] Fwd: Pie charts on a map. v2
In-Reply-To: <CAAMkPW8Ep-T27eTMvSGDkyvg4gFqR8qaygB3zrmsDR2iQvYS6A@mail.gmail.com>
References: <CAAMkPW9TFZtgDw-HopLX-EmbgVXv47yNbPyiHpniQhMVaXkJ=A@mail.gmail.com>
	<CAAMkPW8Ep-T27eTMvSGDkyvg4gFqR8qaygB3zrmsDR2iQvYS6A@mail.gmail.com>
Message-ID: <DDC5EC9B78340042B0D5A0C3789D45691A576D2F@001FSN2MPN1-061.001f.mgd2.msft.net>

I think there are two issues:

1. You need the rworldxtra package to get the countriesHigh dataset so adding in
    library(rworldxtra) is necessary.
2. I think you need to "focus" the figure to a smaller area and add in a statement 
    like mapRegion="Somalia" in the mapPies function.

Jim


From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Jue Lin-Ye
Sent: Sunday, April 12, 2015 8:40 AM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Fwd: Pie charts on a map. v2

?
Dear sirs/madams,

May someone please help me with this issue: I have been trying to plot pie charts on a map, without much success (see code enclosed herein). This is quite distressing to me, as I had plot the same kind of map before without problems. It would be appreciated if anyone would point out the flaw. I enclose a reproducible set of data and codes for you to work with. I have tested the code, you just have to paste the three of the files in the same folder.

Thank you very much in advance. 
?

-- 
Jue Lin-Ye

---------------------------------------------------------------
Civil Engineering phD candidate
Maritime Engineering Laboratory (LIM)
Universitat Polit?cnica de Catalunya (UPC)
C/Jordi Girona 1-3, Barcelona 08034 (Spain)
-----------------------------------------------------------------
?
?
? P.S.: My e-mails asking for questions are sometimes quite short and can seem rude, I am sorry for that. The truth is that I hearfully appreciate any help of yours. ?
?


From jl.iccp at gmail.com  Sun Apr 12 18:29:54 2015
From: jl.iccp at gmail.com (Jue Lin-Ye)
Date: Sun, 12 Apr 2015 18:29:54 +0200
Subject: [R-sig-Geo] Fwd: Pie charts on a map. v2
In-Reply-To: <DDC5EC9B78340042B0D5A0C3789D45691A576D2F@001FSN2MPN1-061.001f.mgd2.msft.net>
References: <CAAMkPW9TFZtgDw-HopLX-EmbgVXv47yNbPyiHpniQhMVaXkJ=A@mail.gmail.com>
	<CAAMkPW8Ep-T27eTMvSGDkyvg4gFqR8qaygB3zrmsDR2iQvYS6A@mail.gmail.com>
	<DDC5EC9B78340042B0D5A0C3789D45691A576D2F@001FSN2MPN1-061.001f.mgd2.msft.net>
Message-ID: <CAAMkPW9cv2Kx5Y636s7BsKBsEu6+a8Zr-1qV7y6C6Pe0dXzwkg@mail.gmail.com>

?Thank you so much for answering! I have checked the two points that you
have mentioned. I actually had library(rworldxtra) in my original, longer
code, so I have copied it to this shorter one. However, R still refuses to
plot anything on the map.

About point 2, I am focusing on the Catalan coast with
xlim=c(.5,3.5),ylim=c(40.5,42.42)

?and it seems that there is no option for "NE Spain", "Catalonia" or
anything of the kind.

I enclose the modified code herein.

Best regards,

Jue?

On 12 April 2015 at 18:15, Baldwin, Jim -FS <jbaldwin at fs.fed.us> wrote:

> I think there are two issues:
>
> 1. You need the rworldxtra package to get the countriesHigh dataset so
> adding in
>     library(rworldxtra) is necessary.
> 2. I think you need to "focus" the figure to a smaller area and add in a
> statement
>     like mapRegion="Somalia" in the mapPies function.
>
> Jim
>
>
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Jue
> Lin-Ye
> Sent: Sunday, April 12, 2015 8:40 AM
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Fwd: Pie charts on a map. v2
>
> ?
> Dear sirs/madams,
>
> May someone please help me with this issue: I have been trying to plot pie
> charts on a map, without much success (see code enclosed herein). This is
> quite distressing to me, as I had plot the same kind of map before without
> problems. It would be appreciated if anyone would point out the flaw. I
> enclose a reproducible set of data and codes for you to work with. I have
> tested the code, you just have to paste the three of the files in the same
> folder.
>
> Thank you very much in advance.
> ?
>
> --
> Jue
>
> ?
> ? P.S.: My e-mails asking for questions are sometimes quite short and can
> seem rude, I am sorry for that. The truth is that I hearfully appreciate
> any help of yours. ?
> ?
>
>


-- 
Jue
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150412/ffe5a752/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Piecharts.R
Type: text/x-r-source
Size: 557 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150412/ffe5a752/attachment.bin>

From jbaldwin at fs.fed.us  Sun Apr 12 19:05:31 2015
From: jbaldwin at fs.fed.us (Baldwin, Jim -FS)
Date: Sun, 12 Apr 2015 17:05:31 +0000
Subject: [R-sig-Geo] Fwd: Pie charts on a map. v2
In-Reply-To: <CAAMkPW9cv2Kx5Y636s7BsKBsEu6+a8Zr-1qV7y6C6Pe0dXzwkg@mail.gmail.com>
References: <CAAMkPW9TFZtgDw-HopLX-EmbgVXv47yNbPyiHpniQhMVaXkJ=A@mail.gmail.com>
	<CAAMkPW8Ep-T27eTMvSGDkyvg4gFqR8qaygB3zrmsDR2iQvYS6A@mail.gmail.com>
	<DDC5EC9B78340042B0D5A0C3789D45691A576D2F@001FSN2MPN1-061.001f.mgd2.msft.net>
	<CAAMkPW9cv2Kx5Y636s7BsKBsEu6+a8Zr-1qV7y6C6Pe0dXzwkg@mail.gmail.com>
Message-ID: <DDC5EC9B78340042B0D5A0C3789D45691A576D64@001FSN2MPN1-061.001f.mgd2.msft.net>

I now see the issue:  you have lat and long reversed in pie.chart.txt.  That puts you in Somolia and Kenya (which is why I suggested mapRegion="Somalia" earlier).

Jim

From: Jue Lin-Ye [mailto:jl.iccp at gmail.com]
Sent: Sunday, April 12, 2015 9:30 AM
To: Baldwin, Jim -FS
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Fwd: Pie charts on a map. v2

?Thank you so much for answering! I have checked the two points that you have mentioned. I actually had library(rworldxtra) in my original, longer code, so I have copied it to this shorter one. However, R still refuses to plot anything on the map.

About point 2, I am focusing on the Catalan coast with
xlim=c(.5,3.5),ylim=c(40.5,42.42)

?and it seems that there is no option for "NE Spain", "Catalonia" or anything of the kind.

I enclose the modified code herein.

Best regards,

Jue?

On 12 April 2015 at 18:15, Baldwin, Jim -FS <jbaldwin at fs.fed.us<mailto:jbaldwin at fs.fed.us>> wrote:
I think there are two issues:

1. You need the rworldxtra package to get the countriesHigh dataset so adding in
    library(rworldxtra) is necessary.
2. I think you need to "focus" the figure to a smaller area and add in a statement
    like mapRegion="Somalia" in the mapPies function.

Jim


From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>] On Behalf Of Jue Lin-Ye
Sent: Sunday, April 12, 2015 8:40 AM
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: [R-sig-Geo] Fwd: Pie charts on a map. v2

?
Dear sirs/madams,

May someone please help me with this issue: I have been trying to plot pie charts on a map, without much success (see code enclosed herein). This is quite distressing to me, as I had plot the same kind of map before without problems. It would be appreciated if anyone would point out the flaw. I enclose a reproducible set of data and codes for you to work with. I have tested the code, you just have to paste the three of the files in the same folder.

Thank you very much in advance.
?

--
Jue

?
? P.S.: My e-mails asking for questions are sometimes quite short and can seem rude, I am sorry for that. The truth is that I hearfully appreciate any help of yours. ?
?



--
Jue

	[[alternative HTML version deleted]]


From Jin.Li at ga.gov.au  Mon Apr 13 03:57:07 2015
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Mon, 13 Apr 2015 01:57:07 +0000
Subject: [R-sig-Geo] [DKIM] Re: FW: Spatial sampling design using
 information more than spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <5527A148.9080506@spatial-analyst.net>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
	<alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>
	<de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
	<066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>
	<55252F8F.2080500@spatial-analyst.net>
	<23118_1428535975_5525BAA5_23118_10078_1_CALyPt8yVYFYHBJAd-TddsWeazG+3xWKAoA7exG_rhf_E1udwFg@mail.gmail.com>
	<1a35f31662934bbcaa26f6f9ec3ce310@WIN-EXCH01.agso.gov.au>
	<5527A148.9080506@spatial-analyst.net>
Message-ID: <09a83904f6cf4e02ac10eaf9c6a45a87@WIN-EXCH01.agso.gov.au>

Tom #1,

After discussion, the needs of the design now have been simplified as:
	1) stratify the survey area based on both spatial coordinates and bathymetry zones and 
	2) then pinpoint the locations for 100 samples. 

The purpose of this survey to my understanding is to collect some baseline information of seabed sediment and water properties as currently no information is available for these properties in the region to be surveyed.

I will try what you suggested and see if it makes our client happy. Thank you a lot for your kind help!

BTW, the function spsample.prob seems not available in the current GSIF (I am  using R version 3.1.0 and just updated GSIF). Where could I get it or should I install the latest version of R? 
Regards,
Jin



-----Original Message-----
From: Tomislav Hengl [mailto:hengl at spatial-analyst.net] 
Sent: Friday, 10 April 2015 8:09 PM
To: Li Jin; tephilippi at gmail.com
Cc: r-sig-geo at r-project.org; Ichsani Wheeler
Subject: Re: [DKIM] Re: [R-sig-Geo] FW: Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]


Jin,

When it comes to stratification prior to any model building (hence no prior predictions) I think that a robust way to stratify an area would be to use a combination of PCA and unsupervised fuzzy k-means. Here is an example:

R> library(GSIF)
R> library(plotKML)
R> library(sp)
R> data(eberg_grid)
R> gridded(eberg_grid) <- ~x+y
R> proj4string(eberg_grid) <- CRS("+init=epsg:31467") formulaString <- ~ 
R> PRMGEO6+DEMSRT6+TWISRT6+TIRAST6 eberg_spc <- spc(eberg_grid, 
R> formulaString)
Converting PRMGEO6 to indicators...
Converting covariates to principal components...
R> kmeans.eberg <- kmeans(eberg_spc at predicted@data, 4)
R> eberg_grid$cluster.4 <- as.factor(kmeans.eberg$cluster) 
R> spplot(eberg_grid["cluster.4"], col.regions=rainbow(4))

I had problems following the procedure you described (a combination of geographical clustering first, then sampling in feature space). Maybe you do only need to use the clhs
(http://www.inside-r.org/packages/cran/clhs/docs) or lhs package because this is a standard statistical method when it comes to sampling in feature space? It all depends on what is the purpose of sampling - validation, model building (maximum representation)...

HTH

Tom #1


On 9-4-2015 3:49, Jin.Li at ga.gov.au wrote:
> Hi Tom 2  :-),
>
> To be specific,  we need to do the spatial stratification first and 
> need to stratify the survey area into n equal-area strata. The 
> function stratify with equalArea in spcosa meets this need well.
>
> And then within each stratum, we need to do further stratification 
> based on a raster layer of 'elevation' that is a continuous layer and 
> needs to be converted into 3 zones. We need to sample m samples within 
> each stratum and these samples need to be evenly distributed within 
> each zone. That is we need to use the area of each zone as a weight to 
> decide how many samples should be allocated to each zone. And then do 
> randomly sampling within each zone.
>
> A further challenge is that they plan to sample 1 to 4 samples a day 
> during 25 days, so we need to provide four designs with 25, 50, 75 and
> 100 samples respectively. The samples of the design with smaller 
> sample size need to be nested in the samples of the design with larger 
> sample size for operational reasons as the survey needs to meet other 
> tasks and also to accommodate weather conditions at sea. Now you know 
> the 'elevation' is bathymetry that is the depth of water. We plan to 
> let n = 25, and m = 1 to 4. But it is hard to stratify if a stratum 
> contains 3 zones and m <3.
>
> Hope this clarify things a bit. Any further suggestions are appreciated!
>
> Jin
>
> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of 
> Tom Philippi
> Sent: Thursday, 9 April 2015 9:32 AM
> To: Tomislav Hengl
> Cc: r-sig-geo
> Subject: [DKIM] Re: [R-sig-Geo] FW: Spatial sampling design using 
> information more than spatial coordinates [SEC=UNCLASSIFIED]
>
> Jin--
>
> Could you provide more information on what the needs of your client 
> are that cannot be handled by either stratification or unequal 
> probability based on your one or more covariates in spsurvey?  Also, 
> is your sample frame points, polygons, or raster?  I assume your 
> covariates are raster (e.g., DEM for elevation) and polygons (most soil maps)?
>
> Tom 2
>
> On Wed, Apr 8, 2015 at 6:39 AM, Tomislav Hengl 
> <hengl at spatial-analyst.net <mailto:hengl at spatial-analyst.net>>
>
> wrote:
>
>  >
>
>  > The "clhs" package (http://cran.r-project.org/web/packages/clhs/) 
> has
>
>  > some functionality for latin-hypercube sampling hence it is 
> suitable
>
>  > for your case. Here are some code examples: http://gsif.isric.org/doku.
>
>  > php?id=wiki:tutorial_eberg#testing_the_feature_space_coverage
>
>  >
>
>  > I have also recently (experimentally) implemented a function to 
> test
>
>  > 'efficiency of any sampling plan' which looks at both geographical
>
>  > space and feature space representation: http://gsif.r-forge.r-project.
>
>  > org/spsample.prob.html
>
>  > If you discover a bug or some 'strange behavior', please let me know.
>
>  >
>
>  > HTH,
>
>  >
>
>  > T. (Tom) Hengl
>
>  > Researcher @ ISRIC - World Soil Information Team member Africa Soil
>
>  > Information Services http://africasoils.net
>
>  > Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
>
>  > Network: http://profiles.google.com/tom.hengl
>
>  > Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ
>
>  >
>
>  >
>
>  >
>
>  > On 8-4-2015 2:24, Jin.Li at ga.gov.au <mailto:Jin.Li at ga.gov.au> wrote:
>
>  >
>
>  >> Sorry for not ccing to the list!
>
>  >>
>
>  >> -----Original Message-----
>
>  >> From: Li Jin
>
>  >> Sent: Tuesday, 7 April 2015 9:36 AM
>
>  >> To: 'Roger.Bivand at nhh.no'
>
>  >> Subject: RE: [R-sig-Geo] Spatial sampling design using information
>
>  >> more than spatial coordinates [SEC=UNCLASSIFIED]
>
>  >>
>
>  >> Thanks a lot, Roger! Yes, we have looked at spsurvey and it does 
> not
>
>  >> meet the needs of our client.
>
>  >> Kind regards,
>
>  >> Jin
>
>  >>
>
>  >> -----Original Message-----
>
>  >> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>
>  >> Sent: Friday, 3 April 2015 2:06 AM
>
>  >> To: Li Jin
>
>  >> Cc: r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>
>
>  >> Subject: Re: [R-sig-Geo] Spatial sampling design using information
>
>  >> more than spatial coordinates [SEC=UNCLASSIFIED]
>
>  >>
>
>  >> On Thu, 2 Apr 2015, Jin.Li at ga.gov.au <mailto:Jin.Li at ga.gov.au> wrote:
>
>  >>
>
>  >>  Hi All,
>
>  >>>
>
>  >>> I need to consider both spatial information and another variable (e.g.
>
>  >>> elevation, soil type) in a sampling design. It seems the 
> available
>
>  >>> libraries (e.g. sp and spcosa) in R for spatial sampling design 
> are
>
>  >>> unable to handle it. Please correct me if I am wrong. Before I 
> start
>
>  >>> to develop my own function for it, I would like to confirm if I 
> have
>
>  >>> missed some other functions that are available for it in R.  Any
>
>  >>> suggestions and advice? Thanks in advance!
>
>  >>>
>
>  >>
>
>  >> Have you looked at spsurvey? It may not provide what you need, but
>
>  >> checking it would probably help you see whether there is anything
>
>  >> meeting your needs. Otherwise you might need to stratify first on 
> your covariates.
>
>  >>
>
>  >> Roger
>
>  >>
>
>  >>
>
>  >>> Regards,
>
>  >>> Jin
>
>  >>>
>
>  >>> Jin Li, PhD
>
>  >>> Spatial Modeller/Computational Statistician  |  National Earth 
> and
>
>  >>> Marine Observations Group Environmental Geoscience Division  |
>
>  >>> GEOSCIENCE AUSTRALIA ______________________________
>
>  >>> ______________________________
>
>  >>> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
>
>  >>> Email: Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au
> <mailto:Jin.Li at ga.gov.au%3cmailto:Jin.Li at ga.gov.au>>    Web:
> www.ga.gov.au <http://www.ga.gov.au>
>
>  >>> <http://www.ga.gov.au/>
>
>  >>> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT GPO 
> Box
>
>  >>> 378 Canberra ACT 2601 Australia Applying geoscience to 
> Australia's
>
>  >>> most important challenges
>
>  >>>
>
>  >>>
>
>  >>> Geoscience Australia Disclaimer: This e-mail (and files 
> transmitted
>
>  >>> with
>
>  >>> it) is intended only for the person or entity to which it is
>
>  >>> addressed. If you are not the intended recipient, then you have
>
>  >>> received this e-mail by mistake and any use, dissemination,
>
>  >>> forwarding, printing or copying of this e-mail and its file
>
>  >>> attachments is prohibited. The security of emails transmitted 
> cannot
>
>  >>> be guaranteed; by forwarding or replying to this email, you 
> acknowledge and accept these risks.
>
>  >>> 
> --------------------------------------------------------------------
>
>  >>> --
>
>  >>> ---------------------------------------------------
>
>  >>>
>
>  >>>
>
>  >>>         [[alternative HTML version deleted]]
>
>  >>>
>
>  >>> _______________________________________________
>
>  >>> R-sig-Geo mailing list
>
>  >>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >>>
>
>  >>>
>
>  >> --
>
>  >> Roger Bivand
>
>  >> Department of Economics, Norwegian School of Economics, Helleveien
>
>  >> 30,
>
>  >> N-5045 Bergen, Norway.
>
>  >> voice: +47 55 95 93 55; fax +47 55 95 91 00
>
>  >> e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
>
>  >>
>
>  >>
>
>  >> Geoscience Australia Disclaimer: This e-mail (and files 
> transmitted
>
>  >> with
>
>  >> it) is intended only for the person or entity to which it is
>
>  >> addressed. If you are not the intended recipient, then you have
>
>  >> received this e-mail by mistake and any use, dissemination,
>
>  >> forwarding, printing or copying of this e-mail and its file
>
>  >> attachments is prohibited. The security of emails transmitted 
> cannot
>
>  >> be guaranteed; by forwarding or replying to this email, you 
> acknowledge and accept these risks.
>
>  >>
>
>  >> _______________________________________________
>
>  >> R-sig-Geo mailing list
>
>  >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >>
>
>  >>
>
>  > _______________________________________________
>
>  > R-sig-Geo mailing list
>
>  > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >
>
>                  [[alternative HTML version deleted]]
>
> _______________________________________________
>
> R-sig-Geo mailing list
>
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted 
> with
> it) is intended only for the person or entity to which it is addressed.
> If you are not the intended recipient, then you have received this 
> e-mail by mistake and any use, dissemination, forwarding, printing or 
> copying of this e-mail and its file attachments is prohibited. The 
> security of emails transmitted cannot be guaranteed; by forwarding or 
> replying to this email, you acknowledge and accept these risks.
> ----------------------------------------------------------------------
> ---------------------------------------------------
>

Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.


From carlo.innocenti at isprambiente.it  Mon Apr 13 15:00:41 2015
From: carlo.innocenti at isprambiente.it (Carlo Innocenti)
Date: Mon, 13 Apr 2015 15:00:41 +0200
Subject: [R-sig-Geo] Fitting a 3D anisotropic variogram
Message-ID: <CAGOAjXOUK9TtW+RUYbM4b+L1cpOq28e3SVPSPcqRUPwpyVzSqg@mail.gmail.com>

Hello,

anybody know a function to fit a theoretical 3D variogram model to the
experimental data?

I work with pollution data from boreholes samples of marine sediment.
Generally the model that best fits to the data is a nested variogram with
both geometric and zonal anisotropy, composed by:

- nugget effect
- spherical model with short range (< 1 m) along the z axis and very long
range (1000 km) along  x and y axis
- spherical model with very long range  (10^6 m) along the z axis and
medium range (< 1 km) along  x and y axis

In the past I used Isatis to visually adapt the range of the model to the
experimental variogram and automatically fit the sill.
Now I'm moving on open source software and I'm looking for a way to fit at
least the sill of the 3D variogram to the data.

I found that gstat allows to use the 3D variogram, but doesn't fit the
anisotropic ones, and geoR fit the anisotropic variogram but not the 3D
ones.

Anybody knows a way in R to build and fit a variogram as that described
above?

Thanks,
Carlo





-- 


Carlo Innocenti, PhD

ISPRA
Istituto Superiore per la Protezione e la Ricerca Ambientale
High Institute for Environmental Protection and Research

Via Vitaliano Brancati, 60
00144 Roma
Italy

phone: +39 06 5007 4639
email: carlo.innocenti at isprambiente.it

	[[alternative HTML version deleted]]


From macqueen1 at llnl.gov  Mon Apr 13 17:32:41 2015
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Mon, 13 Apr 2015 15:32:41 +0000
Subject: [R-sig-Geo] Fitting a 3D anisotropic variogram
In-Reply-To: <CAGOAjXOUK9TtW+RUYbM4b+L1cpOq28e3SVPSPcqRUPwpyVzSqg@mail.gmail.com>
References: <CAGOAjXOUK9TtW+RUYbM4b+L1cpOq28e3SVPSPcqRUPwpyVzSqg@mail.gmail.com>
Message-ID: <D1512EC2.125349%macqueen1@llnl.gov>

There may be something in the RandomFields or georob packages.

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 4/13/15, 6:00 AM, "Carlo Innocenti" <carlo.innocenti at isprambiente.it>
wrote:

>Hello,
>
>anybody know a function to fit a theoretical 3D variogram model to the
>experimental data?
>
>I work with pollution data from boreholes samples of marine sediment.
>Generally the model that best fits to the data is a nested variogram with
>both geometric and zonal anisotropy, composed by:
>
>- nugget effect
>- spherical model with short range (< 1 m) along the z axis and very long
>range (1000 km) along  x and y axis
>- spherical model with very long range  (10^6 m) along the z axis and
>medium range (< 1 km) along  x and y axis
>
>In the past I used Isatis to visually adapt the range of the model to the
>experimental variogram and automatically fit the sill.
>Now I'm moving on open source software and I'm looking for a way to fit at
>least the sill of the 3D variogram to the data.
>
>I found that gstat allows to use the 3D variogram, but doesn't fit the
>anisotropic ones, and geoR fit the anisotropic variogram but not the 3D
>ones.
>
>Anybody knows a way in R to build and fit a variogram as that described
>above?
>
>Thanks,
>Carlo
>
>
>
>
>
>-- 
>
>
>Carlo Innocenti, PhD
>
>ISPRA
>Istituto Superiore per la Protezione e la Ricerca Ambientale
>High Institute for Environmental Protection and Research
>
>Via Vitaliano Brancati, 60
>00144 Roma
>Italy
>
>phone: +39 06 5007 4639
>email: carlo.innocenti at isprambiente.it
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From kmb56 at berkeley.edu  Tue Apr 14 01:27:50 2015
From: kmb56 at berkeley.edu (Kenny Bell)
Date: Mon, 13 Apr 2015 16:27:50 -0700
Subject: [R-sig-Geo] over() in sp package
Message-ID: <CALOjXYQYrU7NdfGqhUqVd1TKnVZLFCnFkGpC-f355ceSmg=w5A@mail.gmail.com>

Hi,

When I call:

over(spPolyDf, spGridDf)

The function seems to be returning the spGridDf$band1 value for the first
grid cell that is contained in each polygon.

What I would like is an overlap-area weighted average (or some provided
function like sum) of all the grid cells contained (or partially contained)
in each polygon element of spPolyDf.

I have code that does this by eventually using joinPolys() from PBSMapping,
but it's slow and would be much cleaner to have a sp-only solution. Is
there any way to do this? Some example code is below:

library(sp)
library(rgdal)

# Download a USA shapefile
tmpFile <- tempfile()
download.file("
http://www2.census.gov/geo/tiger/GENZ2013/cb_2013_us_state_20m.zip",
destfile = tmpFile)
unzipped <- unzip(zipfile = tmpFile, exdir = getwd())

# This is the actual reading stage
states <- readOGR(getwd(), layer="cb_2013_us_state_20m")

# Remove all the files on disk
file.remove(tmpFile)
file.remove(unzipped)

tmpFile <- tempfile()

url <- paste0("http://www.prism.oregonstate.edu/fetchData.php?type",
              "=bil&kind=recent&elem=tmax&range=daily&temporal=",
              "20140416")

# Download the file to fileName
download.file(url = url, mode = "wb", destfile = tmpFile)

# unzip the file to the working directory.
unzippedFiles <- unzip(zipfile = tmpFile, overwrite = TRUE)

# read into R
tMaxGrid <- readGDAL(fname = unzippedFiles[1])

# delete the file
file.remove(tmpFile)
file.remove(unzippedFiles)

# This doesn't work correctly
states$tmax20140416 <- over(states, tMaxGrid)

	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Tue Apr 14 02:44:55 2015
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 13 Apr 2015 17:44:55 -0700
Subject: [R-sig-Geo] over() in sp package
In-Reply-To: <CALOjXYQYrU7NdfGqhUqVd1TKnVZLFCnFkGpC-f355ceSmg=w5A@mail.gmail.com>
References: <CALOjXYQYrU7NdfGqhUqVd1TKnVZLFCnFkGpC-f355ceSmg=w5A@mail.gmail.com>
Message-ID: <CANtt_hwZx6UB0zcZyEYCc6rT+-rojpZVZF18Opsj-v_Z4G=sxg@mail.gmail.com>

Kenny,

Here is an alternative route

library(raster)
states <- shapefile("cb_2013_us_state_20m.shp")
tMaxGrid <- raster(unzippedFiles[1])
x <- extract(tMaxGrid, states)

This returns a list of the length of states. Each list element has a
vector with the grid cell values.

For a mean do

xs <- extract(tMaxGrid, states, fun=mean)

See ?extract for weights

Robert

On Mon, Apr 13, 2015 at 4:27 PM, Kenny Bell <kmb56 at berkeley.edu> wrote:
> Hi,
>
> When I call:
>
> over(spPolyDf, spGridDf)
>
> The function seems to be returning the spGridDf$band1 value for the first
> grid cell that is contained in each polygon.
>
> What I would like is an overlap-area weighted average (or some provided
> function like sum) of all the grid cells contained (or partially contained)
> in each polygon element of spPolyDf.
>
> I have code that does this by eventually using joinPolys() from PBSMapping,
> but it's slow and would be much cleaner to have a sp-only solution. Is
> there any way to do this? Some example code is below:
>
> library(sp)
> library(rgdal)
>
> # Download a USA shapefile
> tmpFile <- tempfile()
> download.file("
> http://www2.census.gov/geo/tiger/GENZ2013/cb_2013_us_state_20m.zip",
> destfile = tmpFile)
> unzipped <- unzip(zipfile = tmpFile, exdir = getwd())
>
> # This is the actual reading stage
> states <- readOGR(getwd(), layer="cb_2013_us_state_20m")
>
> # Remove all the files on disk
> file.remove(tmpFile)
> file.remove(unzipped)
>
> tmpFile <- tempfile()
>
> url <- paste0("http://www.prism.oregonstate.edu/fetchData.php?type",
>               "=bil&kind=recent&elem=tmax&range=daily&temporal=",
>               "20140416")
>
> # Download the file to fileName
> download.file(url = url, mode = "wb", destfile = tmpFile)
>
> # unzip the file to the working directory.
> unzippedFiles <- unzip(zipfile = tmpFile, overwrite = TRUE)
>
> # read into R
> tMaxGrid <- readGDAL(fname = unzippedFiles[1])
>
> # delete the file
> file.remove(tmpFile)
> file.remove(unzippedFiles)
>
> # This doesn't work correctly
> states$tmax20140416 <- over(states, tMaxGrid)
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Tue Apr 14 07:47:29 2015
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 14 Apr 2015 07:47:29 +0200
Subject: [R-sig-Geo] over() in sp package
In-Reply-To: <CALOjXYQYrU7NdfGqhUqVd1TKnVZLFCnFkGpC-f355ceSmg=w5A@mail.gmail.com>
References: <CALOjXYQYrU7NdfGqhUqVd1TKnVZLFCnFkGpC-f355ceSmg=w5A@mail.gmail.com>
Message-ID: <552CA9F1.308@uni-muenster.de>



On 04/14/2015 01:27 AM, Kenny Bell wrote:
> Hi,
> 
> When I call:
> 
> over(spPolyDf, spGridDf)
> 
> The function seems to be returning the spGridDf$band1 value for the first
> grid cell that is contained in each polygon.

This is documented; you can use returnList = TRUE to get the list of
values for each polygon. Since you want to aggregate these anyway, you
might as well use

aggregate(spGridDF, spPolyDf, mean)

this is gives a simple average of pixels whose centers fall inside the
polygons. Do you need a weighted average, weighted by how much of the
pixel overlaps with each polygon?

> 
> What I would like is an overlap-area weighted average (or some provided
> function like sum) of all the grid cells contained (or partially contained)
> in each polygon element of spPolyDf.
> 
> I have code that does this by eventually using joinPolys() from PBSMapping,
> but it's slow and would be much cleaner to have a sp-only solution. Is
> there any way to do this? Some example code is below:
> 
> library(sp)
> library(rgdal)
> 
> # Download a USA shapefile
> tmpFile <- tempfile()
> download.file("
> http://www2.census.gov/geo/tiger/GENZ2013/cb_2013_us_state_20m.zip",
> destfile = tmpFile)
> unzipped <- unzip(zipfile = tmpFile, exdir = getwd())
> 
> # This is the actual reading stage
> states <- readOGR(getwd(), layer="cb_2013_us_state_20m")
> 
> # Remove all the files on disk
> file.remove(tmpFile)
> file.remove(unzipped)
> 
> tmpFile <- tempfile()
> 
> url <- paste0("http://www.prism.oregonstate.edu/fetchData.php?type",
>               "=bil&kind=recent&elem=tmax&range=daily&temporal=",
>               "20140416")
> 
> # Download the file to fileName
> download.file(url = url, mode = "wb", destfile = tmpFile)
> 
> # unzip the file to the working directory.
> unzippedFiles <- unzip(zipfile = tmpFile, overwrite = TRUE)
> 
> # read into R
> tMaxGrid <- readGDAL(fname = unzippedFiles[1])
> 
> # delete the file
> file.remove(tmpFile)
> file.remove(unzippedFiles)
> 
> # This doesn't work correctly
> states$tmax20140416 <- over(states, tMaxGrid)

this would assign a data.frame to what you want to be a vector (in a
data.frame), so it would have to be:

states$tmax20140416 <- over(states, tMaxGrid)[[1]]

I'll try to modify sp so that it'd warn you in this case.


-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi),  University of M?nster,
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150414/4b4b3983/attachment.bin>

From carlo.innocenti at isprambiente.it  Tue Apr 14 15:28:43 2015
From: carlo.innocenti at isprambiente.it (Carlo Innocenti)
Date: Tue, 14 Apr 2015 15:28:43 +0200
Subject: [R-sig-Geo] Fitting a 3D anisotropic variogram
In-Reply-To: <D1512EC2.125349%macqueen1@llnl.gov>
References: <CAGOAjXOUK9TtW+RUYbM4b+L1cpOq28e3SVPSPcqRUPwpyVzSqg@mail.gmail.com>
	<D1512EC2.125349%macqueen1@llnl.gov>
Message-ID: <CAGOAjXMCi7Rd_iVXkz5MGAd_qFpz2dL2gKJHWCk6w4Uy=U8c2A@mail.gmail.com>

Thank you.
I will check.

Carlo





2015-04-13 17:32 GMT+02:00 MacQueen, Don <macqueen1 at llnl.gov>:

> There may be something in the RandomFields or georob packages.
>
> --
> Don MacQueen
>
> Lawrence Livermore National Laboratory
> 7000 East Ave., L-627
> Livermore, CA 94550
> 925-423-1062
>
>
>
>
>
> On 4/13/15, 6:00 AM, "Carlo Innocenti" <carlo.innocenti at isprambiente.it>
> wrote:
>
> >Hello,
> >
> >anybody know a function to fit a theoretical 3D variogram model to the
> >experimental data?
> >
> >I work with pollution data from boreholes samples of marine sediment.
> >Generally the model that best fits to the data is a nested variogram with
> >both geometric and zonal anisotropy, composed by:
> >
> >- nugget effect
> >- spherical model with short range (< 1 m) along the z axis and very long
> >range (1000 km) along  x and y axis
> >- spherical model with very long range  (10^6 m) along the z axis and
> >medium range (< 1 km) along  x and y axis
> >
> >In the past I used Isatis to visually adapt the range of the model to the
> >experimental variogram and automatically fit the sill.
> >Now I'm moving on open source software and I'm looking for a way to fit at
> >least the sill of the 3D variogram to the data.
> >
> >I found that gstat allows to use the 3D variogram, but doesn't fit the
> >anisotropic ones, and geoR fit the anisotropic variogram but not the 3D
> >ones.
> >
> >Anybody knows a way in R to build and fit a variogram as that described
> >above?
> >
> >Thanks,
> >Carlo
> >
> >
> >
> >
> >
> >--
> >
> >
> >Carlo Innocenti, PhD
> >
> >ISPRA
> >Istituto Superiore per la Protezione e la Ricerca Ambientale
> >High Institute for Environmental Protection and Research
> >
> >Via Vitaliano Brancati, 60
> >00144 Roma
> >Italy
> >
> >phone: +39 06 5007 4639
> >email: carlo.innocenti at isprambiente.it
> >
> >       [[alternative HTML version deleted]]
> >
> >_______________________________________________
> >R-sig-Geo mailing list
> >R-sig-Geo at r-project.org
> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 


Carlo Innocenti, PhD

ISPRA
Istituto Superiore per la Protezione e la Ricerca Ambientale
High Institute for Environmental Protection and Research

Via Vitaliano Brancati, 60
00144 Roma
Italy

phone: +39 06 5007 4639
email: carlo.innocenti at isprambiente.it

	[[alternative HTML version deleted]]


From kmb56 at berkeley.edu  Tue Apr 14 18:58:01 2015
From: kmb56 at berkeley.edu (Kenny Bell)
Date: Tue, 14 Apr 2015 09:58:01 -0700
Subject: [R-sig-Geo] over() in sp package
In-Reply-To: <552CA9F1.308@uni-muenster.de>
References: <CALOjXYQYrU7NdfGqhUqVd1TKnVZLFCnFkGpC-f355ceSmg=w5A@mail.gmail.com>
	<552CA9F1.308@uni-muenster.de>
Message-ID: <CALOjXYSf87tOJqDMC=p0cLQC+Lg8uCbbLOQq_D93NUWNZ74OWQ@mail.gmail.com>

Thanks so much for all this. Yes, I'm after the area weighted averages. The
eventual application is to aggregate a 2.5 arcminute temperature grid up to
a zip-5 polygon, many of which overlap only 2-3 grid cells.

On Mon, Apr 13, 2015 at 10:47 PM, Edzer Pebesma <
edzer.pebesma at uni-muenster.de> wrote:

>
>
> On 04/14/2015 01:27 AM, Kenny Bell wrote:
> > Hi,
> >
> > When I call:
> >
> > over(spPolyDf, spGridDf)
> >
> > The function seems to be returning the spGridDf$band1 value for the first
> > grid cell that is contained in each polygon.
>
> This is documented; you can use returnList = TRUE to get the list of
> values for each polygon. Since you want to aggregate these anyway, you
> might as well use
>
> aggregate(spGridDF, spPolyDf, mean)
>
> this is gives a simple average of pixels whose centers fall inside the
> polygons. Do you need a weighted average, weighted by how much of the
> pixel overlaps with each polygon?
>
> >
> > What I would like is an overlap-area weighted average (or some provided
> > function like sum) of all the grid cells contained (or partially
> contained)
> > in each polygon element of spPolyDf.
> >
> > I have code that does this by eventually using joinPolys() from
> PBSMapping,
> > but it's slow and would be much cleaner to have a sp-only solution. Is
> > there any way to do this? Some example code is below:
> >
> > library(sp)
> > library(rgdal)
> >
> > # Download a USA shapefile
> > tmpFile <- tempfile()
> > download.file("
> > http://www2.census.gov/geo/tiger/GENZ2013/cb_2013_us_state_20m.zip",
> > destfile = tmpFile)
> > unzipped <- unzip(zipfile = tmpFile, exdir = getwd())
> >
> > # This is the actual reading stage
> > states <- readOGR(getwd(), layer="cb_2013_us_state_20m")
> >
> > # Remove all the files on disk
> > file.remove(tmpFile)
> > file.remove(unzipped)
> >
> > tmpFile <- tempfile()
> >
> > url <- paste0("http://www.prism.oregonstate.edu/fetchData.php?type",
> >               "=bil&kind=recent&elem=tmax&range=daily&temporal=",
> >               "20140416")
> >
> > # Download the file to fileName
> > download.file(url = url, mode = "wb", destfile = tmpFile)
> >
> > # unzip the file to the working directory.
> > unzippedFiles <- unzip(zipfile = tmpFile, overwrite = TRUE)
> >
> > # read into R
> > tMaxGrid <- readGDAL(fname = unzippedFiles[1])
> >
> > # delete the file
> > file.remove(tmpFile)
> > file.remove(unzippedFiles)
> >
> > # This doesn't work correctly
> > states$tmax20140416 <- over(states, tMaxGrid)
>
> this would assign a data.frame to what you want to be a vector (in a
> data.frame), so it would have to be:
>
> states$tmax20140416 <- over(states, tMaxGrid)[[1]]
>
> I'll try to modify sp so that it'd warn you in this case.
>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi),  University of M?nster,
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
> Spatial Statistics Society http://www.spatialstatistics.info
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
Kendon Bell
Email: kmb56 at berkeley.edu
Phone: (510) 612-3375

Ph.D. Student
Department of Agricultural & Resource Economics
University of California, Berkeley

Graduate Student Researcher
Energy Biosciences Institute
http://www.energybiosciencesinstitute.org/

	[[alternative HTML version deleted]]


From galuardi at mit.edu  Wed Apr 15 17:33:14 2015
From: galuardi at mit.edu (Benjamin.Galuardi)
Date: Wed, 15 Apr 2015 11:33:14 -0400
Subject: [R-sig-Geo] adehabitatHR functions estUDm2spixdf & kernelUD
In-Reply-To: <D55ACF4BDEC48E4B83AA1A3BBB8BAF775CE2E61B@000S-EX-MBX-QS3.unimelb.edu.au>
References: <D55ACF4BDEC48E4B83AA1A3BBB8BAF775CE2E61B@000S-EX-MBX-QS3.unimelb.edu.au>
Message-ID: <552E84BA.1000007@mit.edu>

Hi Clare,

1) If you want a probability of occurrence within each cell, you should 
use the getvolumeUD function on the kud object in your script. Depending 
on the format of the fields you wish to compare, you might be able to 
omit the transform to spatialpixelsdataframe. In any case, the results  
are not a binned representations, which is what a 0/1 flag would 
constitute.

2) you are correct: grid=125 means a 125x125 grid.

Check out the 'raster' package as well for your comparisons. It's very 
good at display, overlay, grid math and export to other formats.

# once installed:
plot(raster(kud))

hope that helps!

Ben

On 4/9/2015 8:54 PM, Clare Death wrote:
> Hello,
>
> I am calculating the utilisation distribution (UD) for a group of mammals (n = 37), in order to define their individual exposure to an environmental contaminant. I need to know the meaning of the value returned in each cell of the converted UD output, as I need to multiply this by the contaminant levels in those cells. It is difficult to be certain what each cell value represents.
>
> I have two questions - thank-you for any assistance:
>
> 1) When using the estUDm2spixdf conversion: What does the function return for each cell? The probability that an animal will be found in the cell, the number of fixes per cell, the number of fixes per unit area, or a 1 or 0 flag to identify if the animal is present or absent from the cell, or something else?
>
> 2) Does the grid parameter of the kernelUD script reflect the cell dimensions of the total grid area (i.e. an arbitrary value for resolution of the pixels)? In the code below I?ve entered grid = 125. Does this mean that a grid is constructed where there are 125 cells in the horizontal dimension and 125 in the vertical (i.e. 125 * 125 = 15625 cells in total).
>
> Some example script:
> spat_dat.spdf <- SpatialPointsDataFrame(spat_dat[,6:7], spat_dat)
> kud <- kernelUD(xy = spat_dat.spdf[,1], h = "href", same4all = TRUE, grid = 125)
> kud.spdf <- estUDm2spixdf(kud)
>
> Kind regards,
> Dr. Clare Death
> Faculty of Veterinary and Agricultural Sciences
> The University of Melbourne, Australia
>
>
> 	[[alternative HTML version deleted]]
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
==================================================
Benjamin Galuardi
PhD Student
NMFS-Seagrant Population Dynamics Fellow
SMAST, UMass Dartmouth
================================================


	[[alternative HTML version deleted]]


From jan.elbers at wur.nl  Wed Apr 15 17:34:12 2015
From: jan.elbers at wur.nl (Elbers, Jan)
Date: Wed, 15 Apr 2015 15:34:12 +0000
Subject: [R-sig-Geo] plotKML: image width and height of legend in KML file
Message-ID: <77d5a15b4679497497d6f1411356384b@scomp5293.wurnet.nl>

Hello,

With my first plotKML project I managed to create a KML file containing a layer with irregular points (air temperature data) and add a legend overlay to it.
I tried changing the size of the legend to no avail, whatever I fill in for "width" and "height" I get a png file that is 120x240 pixels.
What am I doing wrong?

Cheers,
JanE

My code is:
library(sp)
library(plotKML)
library(spacetime)
#
# working directory
setwd('D:/A-user/Hi-Aware/plotKML')
#
# input file
tripfile <- 'wbgt_input_data_new.csv'
tripdata <- read.csv(tripfile)
#
# convert time to POSIX
tripdata$ctime <- as.POSIXct(strptime(tripdata$timestamp,"%Y-%m-%d %H:%M:%S"),format="%Y-%m-%d %H:%M:%S")
#
# lat lon with decimal minutes
tripdata$lat <- tripdata$lat + tripdata$latmin/60.
tripdata$lon <- tripdata$lon + tripdata$lonmin/60.
#
# create STIDF object
sp <- SpatialPoints(tripdata[,c("lon","lat")])
proj4string(sp) <- CRS("+proj=longlat +datum=WGS84")
tripdata.st <- STIDF(sp, time = tripdata$ctime, data = tripdata[,c("t2m","rh")])
#
# save to kml with legend bar overlay
kml_open(file.name = paste(tripfile, ".kml", sep=""))
kml_layer(tripdata.st, file.name=paste(tripfile, ".kml", sep=""), colour=t2m, labels="", points_names="",
        shape="http://maps.google.com/mapfiles/kml/pal2/icon18.png", kmz=FALSE, open.kml=TRUE)
kml_legend.bar(x=tripdata$t2m, width=100, height=500, pointsize = 10, legend.file="legend.png",
              legend.pal=SAGA_pal$SG_COLORS_DEFAULT, z.lim = range(tripdata$t2m, na.rm=TRUE, finite=TRUE))
kml_screen(image.file = "legend.png", position = "ML", sname = "legend")
kml_close(file.name = paste(tripfile, ".kml", sep=""))

end of code

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Thu Apr 16 00:19:40 2015
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 16 Apr 2015 00:19:40 +0200
Subject: [R-sig-Geo] over() in sp package
In-Reply-To: <CALOjXYSf87tOJqDMC=p0cLQC+Lg8uCbbLOQq_D93NUWNZ74OWQ@mail.gmail.com>
References: <CALOjXYQYrU7NdfGqhUqVd1TKnVZLFCnFkGpC-f355ceSmg=w5A@mail.gmail.com>	<552CA9F1.308@uni-muenster.de>
	<CALOjXYSf87tOJqDMC=p0cLQC+Lg8uCbbLOQq_D93NUWNZ74OWQ@mail.gmail.com>
Message-ID: <552EE3FC.3010009@uni-muenster.de>


On 04/14/2015 06:58 PM, Kenny Bell wrote:
> Thanks so much for all this. Yes, I'm after the area weighted averages. The
> eventual application is to aggregate a 2.5 arcminute temperature grid up to
> a zip-5 polygon, many of which overlap only 2-3 grid cells.

One approach would be to use spsample to resample the temperature to a
finer grid, then use aggregate.

Another approach would be to convert the grid to SpatialPolygons, and
then use the function below, which should do exact area weighting. Let
me know if it works, or if you have other comments / questions.


aggregatePoly = function(x, by) {
	require(rgeos)
	i = gIntersection(x, by, byid = TRUE)
	ids.i = sapply(i at polygons, function(x) slot(x, name = "ID"))
	grp_by = sapply(strsplit(ids.i, " "), function(x) x[2])

	obs = over(SpatialPoints(coordinates(i)), x)
	obs$area = sapply(i at polygons, function(x)
		slot(x, name = "area"))
	obs$x_area = obs[[1]] * obs$area
	agg = aggregate(obs[c("x_area", "area")], list(grp_by), sum)
	agg$value = with(agg, x_area / area)
	agg = agg[match(row.names(by), agg$Group.1),]
	row.names(agg) = row.names(by)
	SpatialPolygonsDataFrame(by, agg)
}

# Example with two partly overlapping grids:
library(sp)

gt1 = SpatialGrid(GridTopology(c(0,0), c(1,1), c(4,4)))
gt2 = SpatialGrid(GridTopology(c(-1.25,-1.25), c(1,1), c(4,4)))

# convert both to polygons; give p1 attributes to aggregate
p1 = SpatialPolygonsDataFrame(as(gt1, "SpatialPolygons"),
		data.frame(v = 1:16), match.ID = FALSE)
p2 = as(gt2, "SpatialPolygons")

# plot the scene:
plot(p1, xlim = c(-2,4), ylim = c(-2,4))
plot(p2, add = TRUE, border = 'red')
library(rgeos)
i = gIntersection(p1, p2, byid = TRUE)
plot(i, add=TRUE, density = 5, col = 'blue')
# plot IDs p2:
ids.p2 = sapply(p2 at polygons, function(x) slot(x, name = "ID"))
text(coordinates(p2), ids.p2)
# plot IDs i:
ids.i = sapply(i at polygons, function(x) slot(x, name = "ID"))
text(coordinates(i), ids.i, cex = .8, col = 'blue')

# compute & plot area-weighted average of p1[[1]]
ret = aggregatePoly(p1, p2)
spplot(ret["value"])


> 
> On Mon, Apr 13, 2015 at 10:47 PM, Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
> 
>>
>>
>> On 04/14/2015 01:27 AM, Kenny Bell wrote:
>>> Hi,
>>>
>>> When I call:
>>>
>>> over(spPolyDf, spGridDf)
>>>
>>> The function seems to be returning the spGridDf$band1 value for the first
>>> grid cell that is contained in each polygon.
>>
>> This is documented; you can use returnList = TRUE to get the list of
>> values for each polygon. Since you want to aggregate these anyway, you
>> might as well use
>>
>> aggregate(spGridDF, spPolyDf, mean)
>>
>> this is gives a simple average of pixels whose centers fall inside the
>> polygons. Do you need a weighted average, weighted by how much of the
>> pixel overlaps with each polygon?
>>
>>>
>>> What I would like is an overlap-area weighted average (or some provided
>>> function like sum) of all the grid cells contained (or partially
>> contained)
>>> in each polygon element of spPolyDf.
>>>
>>> I have code that does this by eventually using joinPolys() from
>> PBSMapping,
>>> but it's slow and would be much cleaner to have a sp-only solution. Is
>>> there any way to do this? Some example code is below:
>>>
>>> library(sp)
>>> library(rgdal)
>>>
>>> # Download a USA shapefile
>>> tmpFile <- tempfile()
>>> download.file("
>>> http://www2.census.gov/geo/tiger/GENZ2013/cb_2013_us_state_20m.zip",
>>> destfile = tmpFile)
>>> unzipped <- unzip(zipfile = tmpFile, exdir = getwd())
>>>
>>> # This is the actual reading stage
>>> states <- readOGR(getwd(), layer="cb_2013_us_state_20m")
>>>
>>> # Remove all the files on disk
>>> file.remove(tmpFile)
>>> file.remove(unzipped)
>>>
>>> tmpFile <- tempfile()
>>>
>>> url <- paste0("http://www.prism.oregonstate.edu/fetchData.php?type",
>>>               "=bil&kind=recent&elem=tmax&range=daily&temporal=",
>>>               "20140416")
>>>
>>> # Download the file to fileName
>>> download.file(url = url, mode = "wb", destfile = tmpFile)
>>>
>>> # unzip the file to the working directory.
>>> unzippedFiles <- unzip(zipfile = tmpFile, overwrite = TRUE)
>>>
>>> # read into R
>>> tMaxGrid <- readGDAL(fname = unzippedFiles[1])
>>>
>>> # delete the file
>>> file.remove(tmpFile)
>>> file.remove(unzippedFiles)
>>>
>>> # This doesn't work correctly
>>> states$tmax20140416 <- over(states, tMaxGrid)
>>
>> this would assign a data.frame to what you want to be a vector (in a
>> data.frame), so it would have to be:
>>
>> states$tmax20140416 <- over(states, tMaxGrid)[[1]]
>>
>> I'll try to modify sp so that it'd warn you in this case.
>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi),  University of M?nster,
>> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>> Journal of Statistical Software:   http://www.jstatsoft.org/
>> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>> Spatial Statistics Society http://www.spatialstatistics.info
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi),  University of M?nster,
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150416/929422ed/attachment.bin>

From hengl at spatial-analyst.net  Thu Apr 16 10:33:45 2015
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Thu, 16 Apr 2015 10:33:45 +0200
Subject: [R-sig-Geo] plotKML: image width and height of legend in KML
 file
In-Reply-To: <77d5a15b4679497497d6f1411356384b@scomp5293.wurnet.nl>
References: <77d5a15b4679497497d6f1411356384b@scomp5293.wurnet.nl>
Message-ID: <552F73E9.8030207@spatial-analyst.net>


We did not consider legends for point data because users will most 
likely use multiple esthetics parameters (color, size, altitude), so yes 
you need to use the lower level functions "kml_open", "kml_layer" to 
achieve this :(
Also 'width' and 'height' arguments only really make sense for factor 
type variables (hence the easiest is that you then make the legend 
yourself and then insert it using "kml_screen").

Notice that you need to use "z.lim" 2 times to ensure that the legend 
matches the colors of points. Here is an example:

R> library(plotKML)
R> library(sp)
R> library(rgdal)
R> data(eberg)
R> coordinates(eberg) <- ~X+Y
R> proj4string(eberg) <- CRS("+init=epsg:31467")
R> eberg <- eberg[runif(nrow(eberg))<.1,]
R> shape = "http://maps.google.com/mapfiles/kml/pal2/icon18.png"
R> kml_open("eberg_CLYMHT_A.kml")
KML file opened for writing...
R> kml_layer(eberg["CLYMHT_A"], colour=CLYMHT_A, z.lim=c(20,60),
+    colour_scale=SAGA_pal[[1]], shape=shape, points_names="")
Reprojecting to +proj=longlat +datum=WGS84 ...
Writing to KML...
R> kml_legend.bar(x=eberg$CLYMHT_A, legend.file="kml_legend.png",
+    legend.pal=SAGA_pal[[1]], z.lim=c(20,60))
null device
           1
R> kml_screen(image.file="kml_legend.png")
R> kml_close("eberg_CLYMHT_A.kml")
Closing  eberg_CLYMHT_A.kml

If you need to do this N times, then the best is to make a function e.g.:

R> kml_points <- function(obj, file, z.lim, points_names="", ...){
   kml_open(file)
   kml_layer(obj, colour=obj at data[,1], 
shape="http://maps.google.com/mapfiles/kml/pal2/icon18.png", 
colour_scale=SAGA_pal[[1]], points_names="", ...)
   kml_legend.bar(x=obj at data[,1], legend.file=gsub(".kml", ".png", 
file), legend.pal=SAGA_pal[[1]], z.lim=z.lim)
   kml_screen(image.file=gsub(".kml", ".png", file))
   kml_close(file)
}
## test it:
R> kml_points(eberg["CLYMHT_A"], file="eberg_CLYMHT_A.kml", z.lim=c(20,60))

FYI, the kml_legend.bar function is at:

https://r-forge.r-project.org/scm/viewvc.php/pkg/R/legend.bar.R?view=markup&root=plotkml

HTH,

T. Hengl

On 15-4-2015 17:34, Elbers, Jan wrote:
> Hello,
>
> With my first plotKML project I managed to create a KML file containing a layer with irregular points (air temperature data) and add a legend overlay to it.
> I tried changing the size of the legend to no avail, whatever I fill in for "width" and "height" I get a png file that is 120x240 pixels.
> What am I doing wrong?
>
> Cheers,
> JanE
>
> My code is:
> library(sp)
> library(plotKML)
> library(spacetime)
> #
> # working directory
> setwd('D:/A-user/Hi-Aware/plotKML')
> #
> # input file
> tripfile <- 'wbgt_input_data_new.csv'
> tripdata <- read.csv(tripfile)
> #
> # convert time to POSIX
> tripdata$ctime <- as.POSIXct(strptime(tripdata$timestamp,"%Y-%m-%d %H:%M:%S"),format="%Y-%m-%d %H:%M:%S")
> #
> # lat lon with decimal minutes
> tripdata$lat <- tripdata$lat + tripdata$latmin/60.
> tripdata$lon <- tripdata$lon + tripdata$lonmin/60.
> #
> # create STIDF object
> sp <- SpatialPoints(tripdata[,c("lon","lat")])
> proj4string(sp) <- CRS("+proj=longlat +datum=WGS84")
> tripdata.st <- STIDF(sp, time = tripdata$ctime, data = tripdata[,c("t2m","rh")])
> #
> # save to kml with legend bar overlay
> kml_open(file.name = paste(tripfile, ".kml", sep=""))
> kml_layer(tripdata.st, file.name=paste(tripfile, ".kml", sep=""), colour=t2m, labels="", points_names="",
>          shape="http://maps.google.com/mapfiles/kml/pal2/icon18.png", kmz=FALSE, open.kml=TRUE)
> kml_legend.bar(x=tripdata$t2m, width=100, height=500, pointsize = 10, legend.file="legend.png",
>                legend.pal=SAGA_pal$SG_COLORS_DEFAULT, z.lim = range(tripdata$t2m, na.rm=TRUE, finite=TRUE))
> kml_screen(image.file = "legend.png", position = "ML", sname = "legend")
> kml_close(file.name = paste(tripfile, ".kml", sep=""))
>
> end of code
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jan.elbers at wur.nl  Thu Apr 16 12:30:38 2015
From: jan.elbers at wur.nl (Elbers, Jan)
Date: Thu, 16 Apr 2015 10:30:38 +0000
Subject: [R-sig-Geo] plotKML: kml_View adds working directory to file name
Message-ID: <2bac6b90651e455d87f1a2c41506c456@scomp5293.wurnet.nl>

Hello,

Kml_View works fine if I use the following:

dfile <- "somefile.kml"
kml_View(file.name=dfile)

but when I do:

dfile <- file.choose(new=FALSE)
kml_View(file.name=dfile)

I get an error message saying file cannot be opened and a path[1] that has the working directory added to it.
Variable dfile is OK, it contains the path but that should be no problem. Why is the working directory path added to that in kml_View?

Cheers,
Jan


From bilelfathalli at yahoo.fr  Thu Apr 16 17:02:58 2015
From: bilelfathalli at yahoo.fr (fathalli bilel)
Date: Thu, 16 Apr 2015 15:02:58 +0000 (UTC)
Subject: [R-sig-Geo] adding a bravais pearson test to spplot
Message-ID: <2141127558.5329792.1429196578189.JavaMail.yahoo@mail.yahoo.com>

Dear all,
My name is Bilel and I'am a PhD student from Tunisia working on climate modelling. My issue today is how to add a Bravais Pearson test as a contour plot to an existing spplot map. Precisely, I have plotted a SpatialPixelsDataFrame of Pearson correlation coefficients between simulated and observed precipitation over the Mediterranean basin using spplot and now I need to add a contour line of the statically significant correlation coefficient at 95% CI.I have been vainly trying for several days to solve this issue, so I really need your help please.?
Best regards?Bilel
Here the code I'am using for plotting correlations between seasonal observed and simulated precipitation (cor_djf, cor_mam, cor_jja, cor_son : matrices)
cors <- data.frame(long=mylong,lat=mylat a =as.vector(cor_djf), b=as.vector(cor_mam), c=as.vector(cor_jja), d=as.vector(cor_son2))?coordinates(cors)<-~long+latcors2<-SpatialPixelsDataFrame(cors, tolerance=5.65099e-05, cors at data,? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?proj4string=CRS("+init=epsg:27572"))
spplot(cors2, ?col.regions =col.regions ,at=seq(-1, 1, length.out=(length(coll))+1),? ? ? ?par.strip.text=list(fontface='bold'),? ? ? ?xlab = list("Longitude", cex=1.2), ylab = list("Latitude",cex=1.2),? ? ? ?main = "",? ? ? ?aspect = "iso",? ? ? ?colorkey = list(labels=list(cex=0.9),space='bottom',height=1,width=2),? ? ? ?names.attr =c( "DJF","MAM","JJA","SON"),? ? ? ?sp.layout=list(lstc),scales=list(draw=TRUE, cex=1.1),? ? ? ?as.table=TRUE,? ? ? ?margin=FALSE)



	[[alternative HTML version deleted]]


From giuseppe.amatulli at gmail.com  Thu Apr 16 17:05:14 2015
From: giuseppe.amatulli at gmail.com (Giuseppe Amatulli)
Date: Thu, 16 Apr 2015 11:05:14 -0400
Subject: [R-sig-Geo] Fwd: Using Geographic Information Systems and Remote
 Sensing to study disease vector habitat
In-Reply-To: <CAKoiDHJ4886WsWCEAtudT0BS6s_SULFXBybb36h_fsxaL5+jCw@mail.gmail.com>
References: <CAKoiDHJ4886WsWCEAtudT0BS6s_SULFXBybb36h_fsxaL5+jCw@mail.gmail.com>
Message-ID: <CAKoiDHLSgKqwC33Qh8uPTScCrHZmwydW4OZmxPoEc4rTMfaGYw@mail.gmail.com>

HI,
Apologies for cross-posting:
This is a good opportunity for start to learn GIS and Statistical Analysis
(R) with open-source software.

*Workshop: **Using Geographic Information Systems and Remote Sensing to
study disease vector habitat*

Biotechonology Research Institute
<http://www.kalro.org/Biotechnology_Research_Institute> (BRI) in
collaboration with  Yale University (School of Public Helath
<http://publichealth.yale.edu/>, Institute for Biospehric Studies
<http://yibs.yale.edu/> and the Department of Ecology and Evolutionary
Biology <http://eeb.yale.edu/>) invites applications for a geospatial
analysis workshop to be held on June  *1 - 6,  2015 *at TRC Campus in
Muguga Kenya.

*The workshop will *introduce participants to Geographic Information
Systems (GIS) and satellite-based remote sensing technologies.   Students
will use the provided suite of *open-source software* (GRASS, R, QGIS,
PKTOOLS) to manipulate GIS data and satellite images to create basic
species habitat models with R ( library(hSDM) ) .  There will be a special
focus on identifying and mapping tsetse fly habitat.

Registration info and contact persons at
http://www.funai.edu.ng/call-for-applications
Best
Rigards

-- 
Giuseppe Amatulli, Ph.D.

Department of Ecology and Evolutionary Biology, Yale University.
Jetz Lab, OML Room 405

P.O. Box 208106
New Haven, CT 06520-8106
Teaching: spatial-ecology.net
Work:  http://sbsc.yale.edu/giuseppe-amatulli
<http://www.spatial-ecology.net>



-- 
Giuseppe Amatulli, Ph.D.

Department of Ecology and Evolutionary Biology, Yale University.
Jetz Lab, OML Room 405

P.O. Box 208106
165 PROSPECT ST
New Haven, CT 06520-8106
Teaching: spatial-ecology.net
Work:  http://sbsc.yale.edu/giuseppe-amatulli
<http://www.spatial-ecology.net>

	[[alternative HTML version deleted]]


From kmb56 at berkeley.edu  Fri Apr 17 05:56:19 2015
From: kmb56 at berkeley.edu (Kenny Bell)
Date: Thu, 16 Apr 2015 20:56:19 -0700
Subject: [R-sig-Geo] over() in sp package
In-Reply-To: <552EE3FC.3010009@uni-muenster.de>
References: <CALOjXYQYrU7NdfGqhUqVd1TKnVZLFCnFkGpC-f355ceSmg=w5A@mail.gmail.com>
	<552CA9F1.308@uni-muenster.de>
	<CALOjXYSf87tOJqDMC=p0cLQC+Lg8uCbbLOQq_D93NUWNZ74OWQ@mail.gmail.com>
	<552EE3FC.3010009@uni-muenster.de>
Message-ID: <CALOjXYTMxRFLP8ttAodiPoUaXRxd_aY7A1y10dwmHen_uCMu3w@mail.gmail.com>

Thanks so much for this.

The code does work. However, the gIntersection() stage is very time
intensive, so I will continue to use my own code that relies on joinPolys
in PBSmapping (faster).

It also allows you to store the rows/weights of the grid so that
aggregating many grids to polygons is feasible.

I have compared the two for aggregating a temperature grid up to an Alabama
polygon and they match, so your code was extremely helpful for verification
- Thanks!

The code is in an R package on my Github
<https://github.com/kendonB/gistools>, for anyone interested. This is my
first R package I've shared, so please make comments through the issues
system on Github.

On Wed, Apr 15, 2015 at 3:19 PM, Edzer Pebesma <
edzer.pebesma at uni-muenster.de> wrote:

>
> On 04/14/2015 06:58 PM, Kenny Bell wrote:
> > Thanks so much for all this. Yes, I'm after the area weighted averages.
> The
> > eventual application is to aggregate a 2.5 arcminute temperature grid up
> to
> > a zip-5 polygon, many of which overlap only 2-3 grid cells.
>
> One approach would be to use spsample to resample the temperature to a
> finer grid, then use aggregate.
>
> Another approach would be to convert the grid to SpatialPolygons, and
> then use the function below, which should do exact area weighting. Let
> me know if it works, or if you have other comments / questions.
>
>
> aggregatePoly = function(x, by) {
>         require(rgeos)
>         i = gIntersection(x, by, byid = TRUE)
>         ids.i = sapply(i at polygons, function(x) slot(x, name = "ID"))
>         grp_by = sapply(strsplit(ids.i, " "), function(x) x[2])
>
>         obs = over(SpatialPoints(coordinates(i)), x)
>         obs$area = sapply(i at polygons, function(x)
>                 slot(x, name = "area"))
>         obs$x_area = obs[[1]] * obs$area
>         agg = aggregate(obs[c("x_area", "area")], list(grp_by), sum)
>         agg$value = with(agg, x_area / area)
>         agg = agg[match(row.names(by), agg$Group.1),]
>         row.names(agg) = row.names(by)
>         SpatialPolygonsDataFrame(by, agg)
> }
>
> # Example with two partly overlapping grids:
> library(sp)
>
> gt1 = SpatialGrid(GridTopology(c(0,0), c(1,1), c(4,4)))
> gt2 = SpatialGrid(GridTopology(c(-1.25,-1.25), c(1,1), c(4,4)))
>
> # convert both to polygons; give p1 attributes to aggregate
> p1 = SpatialPolygonsDataFrame(as(gt1, "SpatialPolygons"),
>                 data.frame(v = 1:16), match.ID = FALSE)
> p2 = as(gt2, "SpatialPolygons")
>
> # plot the scene:
> plot(p1, xlim = c(-2,4), ylim = c(-2,4))
> plot(p2, add = TRUE, border = 'red')
> library(rgeos)
> i = gIntersection(p1, p2, byid = TRUE)
> plot(i, add=TRUE, density = 5, col = 'blue')
> # plot IDs p2:
> ids.p2 = sapply(p2 at polygons, function(x) slot(x, name = "ID"))
> text(coordinates(p2), ids.p2)
> # plot IDs i:
> ids.i = sapply(i at polygons, function(x) slot(x, name = "ID"))
> text(coordinates(i), ids.i, cex = .8, col = 'blue')
>
> # compute & plot area-weighted average of p1[[1]]
> ret = aggregatePoly(p1, p2)
> spplot(ret["value"])
>
>
> >
> > On Mon, Apr 13, 2015 at 10:47 PM, Edzer Pebesma <
> > edzer.pebesma at uni-muenster.de> wrote:
> >
> >>
> >>
> >> On 04/14/2015 01:27 AM, Kenny Bell wrote:
> >>> Hi,
> >>>
> >>> When I call:
> >>>
> >>> over(spPolyDf, spGridDf)
> >>>
> >>> The function seems to be returning the spGridDf$band1 value for the
> first
> >>> grid cell that is contained in each polygon.
> >>
> >> This is documented; you can use returnList = TRUE to get the list of
> >> values for each polygon. Since you want to aggregate these anyway, you
> >> might as well use
> >>
> >> aggregate(spGridDF, spPolyDf, mean)
> >>
> >> this is gives a simple average of pixels whose centers fall inside the
> >> polygons. Do you need a weighted average, weighted by how much of the
> >> pixel overlaps with each polygon?
> >>
> >>>
> >>> What I would like is an overlap-area weighted average (or some provided
> >>> function like sum) of all the grid cells contained (or partially
> >> contained)
> >>> in each polygon element of spPolyDf.
> >>>
> >>> I have code that does this by eventually using joinPolys() from
> >> PBSMapping,
> >>> but it's slow and would be much cleaner to have a sp-only solution. Is
> >>> there any way to do this? Some example code is below:
> >>>
> >>> library(sp)
> >>> library(rgdal)
> >>>
> >>> # Download a USA shapefile
> >>> tmpFile <- tempfile()
> >>> download.file("
> >>> http://www2.census.gov/geo/tiger/GENZ2013/cb_2013_us_state_20m.zip",
> >>> destfile = tmpFile)
> >>> unzipped <- unzip(zipfile = tmpFile, exdir = getwd())
> >>>
> >>> # This is the actual reading stage
> >>> states <- readOGR(getwd(), layer="cb_2013_us_state_20m")
> >>>
> >>> # Remove all the files on disk
> >>> file.remove(tmpFile)
> >>> file.remove(unzipped)
> >>>
> >>> tmpFile <- tempfile()
> >>>
> >>> url <- paste0("http://www.prism.oregonstate.edu/fetchData.php?type",
> >>>               "=bil&kind=recent&elem=tmax&range=daily&temporal=",
> >>>               "20140416")
> >>>
> >>> # Download the file to fileName
> >>> download.file(url = url, mode = "wb", destfile = tmpFile)
> >>>
> >>> # unzip the file to the working directory.
> >>> unzippedFiles <- unzip(zipfile = tmpFile, overwrite = TRUE)
> >>>
> >>> # read into R
> >>> tMaxGrid <- readGDAL(fname = unzippedFiles[1])
> >>>
> >>> # delete the file
> >>> file.remove(tmpFile)
> >>> file.remove(unzippedFiles)
> >>>
> >>> # This doesn't work correctly
> >>> states$tmax20140416 <- over(states, tMaxGrid)
> >>
> >> this would assign a data.frame to what you want to be a vector (in a
> >> data.frame), so it would have to be:
> >>
> >> states$tmax20140416 <- over(states, tMaxGrid)[[1]]
> >>
> >> I'll try to modify sp so that it'd warn you in this case.
> >>
> >>
> >> --
> >> Edzer Pebesma
> >> Institute for Geoinformatics (ifgi),  University of M?nster,
> >> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> >> Journal of Statistical Software:   http://www.jstatsoft.org/
> >> Computers & Geosciences:   http://elsevier.com/locate/cageo/
> >> Spatial Statistics Society http://www.spatialstatistics.info
> >>
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >>
> >
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi),  University of M?nster,
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
> Spatial Statistics Society http://www.spatialstatistics.info
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
Kendon Bell
Email: kmb56 at berkeley.edu
Phone: (510) 612-3375

Ph.D. Student
Department of Agricultural & Resource Economics
University of California, Berkeley

Graduate Student Researcher
Energy Biosciences Institute
http://www.energybiosciencesinstitute.org/

	[[alternative HTML version deleted]]


From kmb56 at berkeley.edu  Fri Apr 17 08:52:50 2015
From: kmb56 at berkeley.edu (Kenny Bell)
Date: Thu, 16 Apr 2015 23:52:50 -0700
Subject: [R-sig-Geo] Reading .nc netCDF files
Message-ID: <CALOjXYTnm7phTJnZOoHRzMXtGbPFf_ptGMNWnrp7s7cdGib_0A@mail.gmail.com>

I'm having trouble with the nc_open() from the ncdf4
<http://cirrus.ucsd.edu/~pierce/ncdf/>package in Windows 8.1.

The following code crashes R when running in the standard GUI and RStudio.
Any tips for fixing this and reading the data in more cleanly?

library(ncdf4)

url <- "
http://thredds.northwestknowledge.net:8080/thredds/fileServer/NWCSC_INTEGRATED_SCENARIOS_ALL_CLIMATE/macav2livneh/CCSM4/macav2livneh_huss_CCSM4_r6i1p1_historical_1990_2005_CONUS_monthly.nc
"
download.file(url = url,
              destfile =
"macav2livneh_huss_CCSM4_r6i1p1_historical_1990_2005_CONUS_monthly.nc")

nc <-
nc_open("macav2livneh_huss_CCSM4_r6i1p1_historical_1990_2005_CONUS_monthly.nc")

	[[alternative HTML version deleted]]


From kmb56 at berkeley.edu  Fri Apr 17 08:58:54 2015
From: kmb56 at berkeley.edu (Kenny Bell)
Date: Thu, 16 Apr 2015 23:58:54 -0700
Subject: [R-sig-Geo] Convert .nc to SpatialGridDataFrame
Message-ID: <CALOjXYTtiS6+rNAgWPJvHRU3z01BiEL1jg+p7WWi9A+asgb4tw@mail.gmail.com>

Hi,

Is there a way to do this in a cleaner way that doesn't require explicitly
extracting the lat-long coordinates of the netCDF grid?

I am looking at the example here
<http://stackoverflow.com/questions/20046500/convert-netcdf-to-spatialgriddataframe-with-r>
.

Thanks so much,
Kenny

	[[alternative HTML version deleted]]


From alessandracarioli at gmail.com  Fri Apr 17 12:40:59 2015
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Fri, 17 Apr 2015 12:40:59 +0200
Subject: [R-sig-Geo] testing of spatial panels
Message-ID: <695821EC-FEB3-46F9-8903-D60E1733FA34@gmail.com>

Hi,

I am exploring my data to decide how to construct my spatial panel model. I would like to test whether I can discard the Spatial Durbin model in favor of the Spatial Lag. Is there any test implemented by R on the subject? I am a bit confused by the literature.

Bests,

Ale

From nlezamaochoa at gmail.com  Sat Apr 18 16:30:35 2015
From: nlezamaochoa at gmail.com (Nerea Lezama Ochoa)
Date: Sat, 18 Apr 2015 16:30:35 +0200
Subject: [R-sig-Geo]  dismo package: using biasfile when calling maxent
Message-ID: <CAMx1JXZGmDDfAX3O2BA+d8DP=9-TdEd5GACAwNun=PmZkdYEvQ@mail.gmail.com>

Hi Julia,

I'm Nerea and I read your post about the biasfile. I have exactly the
same problem, and I would like to know how finally you resolved the
problem. Could you send me the script, please? I don't really know how
to do it.

Best regards,
Nerea


From amit.boshale at yahoo.com  Sun Apr 19 14:56:31 2015
From: amit.boshale at yahoo.com (Amit Boshale)
Date: Sun, 19 Apr 2015 12:56:31 +0000 (UTC)
Subject: [R-sig-Geo] plotKML RasterTimeSeries for large area
Message-ID: <1192279944.7487311.1429448191199.JavaMail.yahoo@mail.yahoo.com>

Dear List,
I want use plotKML to plot RasterTimeSeries graphs for a large raster stack (300 images, 500 km x500 km). Clearly, I have to produced hundreds of small kmls. But I cannot display them at once. <Region> could help in solving the problem. Does plotKML support Region and level of detail? (see Working with Regions)

Thanks!Amit


| ? |
| ? |  | ? | ? | ? | ? | ? |
| Working with RegionsRegions are a powerful KML feature that allows you to add very large datasets to Google Earth without sacrificing performance.  |
|  |
| Auf developers.goog... anzeigen | Vorschau nach Yahoo |
|  |
| ? |

?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150419/ac87450a/attachment.html>

From nevil.amos at gmail.com  Mon Apr 20 08:54:41 2015
From: nevil.amos at gmail.com (nevil amos)
Date: Mon, 20 Apr 2015 16:54:41 +1000
Subject: [R-sig-Geo] clusterR (fun=aggregate) error "number of items to
 replace is not a multiple of replacement length"
Message-ID: <CAN9eD7mkTq5=arfkOc7Gqk=XB+oUxfySmnddKWHmazKAyRRYBg@mail.gmail.com>

I am getting the above  error with clusterR and aggregate:

works fine without parralell:

library(raster)
r<-raster(matrix(data = sample(c(1:10,NA),10000,replace=T),100,100),xmn=0,
xmx=1000,ymn=0,ymx=1000)
beginCluster()
Parr_agg<-clusterR(r,fun=aggregate,args=list(fact=3,fun=modal,expand=TRUE,na.rm=TRUE))
endCluster()
agg<-aggregate(r,3,fun=modal,na.rm=TRUE)
plot(agg)

	[[alternative HTML version deleted]]


From drflying at sina.com  Mon Apr 20 11:44:35 2015
From: drflying at sina.com (drflying at sina.com)
Date: Mon, 20 Apr 2015 17:44:35 +0800 (CST)
Subject: [R-sig-Geo] =?utf-8?b?6Ieq5Yqo5Zue5aSN77yaIHBsb3RLTUwgUmFzdGVy?=
	=?utf-8?q?TimeSeries_for_large_area?=
Message-ID: <20150420094435.05B9ACB0328@mda06.fmail.tg.sinanode.com>

?????????~

From nevil.amos at gmail.com  Mon Apr 20 09:15:30 2015
From: nevil.amos at gmail.com (nevil amos)
Date: Mon, 20 Apr 2015 17:15:30 +1000
Subject: [R-sig-Geo] clusterR (fun=aggregate) error "number of items to
 replace is not a multiple of replacement length"
In-Reply-To: <CAN9eD7mkTq5=arfkOc7Gqk=XB+oUxfySmnddKWHmazKAyRRYBg@mail.gmail.com>
References: <CAN9eD7mkTq5=arfkOc7Gqk=XB+oUxfySmnddKWHmazKAyRRYBg@mail.gmail.com>
Message-ID: <CAN9eD7=MXg0JHX3qoP49nLQyALfcpoq==Wp1U7-1Yk2kwvP-YQ@mail.gmail.com>

Apoligies.  did not read help properly it states:
"Among other functions, it does _not_ work with ... (dis)aggregate"

On Mon, Apr 20, 2015 at 4:54 PM, nevil amos <nevil.amos at gmail.com> wrote:

> I am getting the above  error with clusterR and aggregate:
>
> works fine without parralell:
>
> library(raster)
> r<-raster(matrix(data = sample(c(1:10,NA),10000,replace=T),100,100),xmn=0,
> xmx=1000,ymn=0,ymx=1000)
> beginCluster()
>
> Parr_agg<-clusterR(r,fun=aggregate,args=list(fact=3,fun=modal,expand=TRUE,na.rm=TRUE))
> endCluster()
> agg<-aggregate(r,3,fun=modal,na.rm=TRUE)
> plot(agg)
>

	[[alternative HTML version deleted]]


From angelini75 at gmail.com  Mon Apr 20 12:01:51 2015
From: angelini75 at gmail.com (Marcos Angelini)
Date: Mon, 20 Apr 2015 12:01:51 +0200
Subject: [R-sig-Geo] extract X,
	Y coordinates from (points) POSTGIS coordinates (WKT
Message-ID: <CAGZnXNBmrM4X5zdZC94zMryeqD1VZbXWiYR2fL4M51LWvxVdzg@mail.gmail.com>

Hi community,

I have a data frame of points with coordinates (WKT) in one column. It is

d <- as.data.frame(NULL)
d$xy <- c("POINT (-59.900833 -34.869722)", "POINT (-60.009032477477234
-34.71350213192503)", "POINT (-60.13337136105485 -34.74472597084807)",
"POINT (-60.199859958706185 -34.7384738077165)")

I want to convert this into:
d$X
-59.900833
-60.009032
-60.133371
-60.199860
d$Y
-34.869722
-34.713502
-34.744726
-34.738474

I've tried with gsub() but I'm not handy with regular expressions. Could
you help me, please?

Marcos.

	[[alternative HTML version deleted]]


From Jin.Li at ga.gov.au  Mon Apr 20 06:30:07 2015
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Mon, 20 Apr 2015 04:30:07 +0000
Subject: [R-sig-Geo] [DKIM] Re: [DKIM] Re: FW: Spatial sampling design
 using information more than spatial coordinates [SEC=UNCLASSIFIED]
In-Reply-To: <1537_1428920227_552B97A3_1537_8519_1_09a83904f6cf4e02ac10eaf9c6a45a87@WIN-EXCH01.agso.gov.au>
References: <7dc1853e49ec4642bcbc2252de9ce47c@WIN-EXCH01.agso.gov.au>
	<alpine.LFD.2.11.1504021704070.29472@reclus.nhh.no>
	<de529c8dc4784340860b56018ad12f21@WIN-EXCH01.agso.gov.au>
	<066e98907a714fbd8afe1f9f605d1886@WIN-EXCH01.agso.gov.au>
	<55252F8F.2080500@spatial-analyst.net>
	<23118_1428535975_5525BAA5_23118_10078_1_CALyPt8yVYFYHBJAd-TddsWeazG+3xWKAoA7exG_rhf_E1udwFg@mail.gmail.com>
	<1a35f31662934bbcaa26f6f9ec3ce310@WIN-EXCH01.agso.gov.au>
	<5527A148.9080506@spatial-analyst.net>
	<1537_1428920227_552B97A3_1537_8519_1_09a83904f6cf4e02ac10eaf9c6a45a87@WIN-EXCH01.agso.gov.au>
Message-ID: <d8dc598d989b4e448bc5c6897fac0a71@WIN-EXCH01.agso.gov.au>

Hi All,

This is to close this thread. Thanks a lot for sending your advice to this list or to me privately. A few R packages were mentioned like: clhs, spsurvey, spcosa, sp.  The result from clhs was found to be satisfactory by our clients after further relaxing their conditions. Thank you all again for your kind help!

Regards,
Jin

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Jin.Li at ga.gov.au
Sent: Monday, 13 April 2015 11:57 AM
To: hengl at spatial-analyst.net; tephilippi at gmail.com
Cc: r-sig-geo at r-project.org; ichsani.wheeler at gmail.com
Subject: [DKIM] Re: [R-sig-Geo] [DKIM] Re: FW: Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]

Tom #1,

After discussion, the needs of the design now have been simplified as:
	1) stratify the survey area based on both spatial coordinates and bathymetry zones and 
	2) then pinpoint the locations for 100 samples. 

The purpose of this survey to my understanding is to collect some baseline information of seabed sediment and water properties as currently no information is available for these properties in the region to be surveyed.

I will try what you suggested and see if it makes our client happy. Thank you a lot for your kind help!

BTW, the function spsample.prob seems not available in the current GSIF (I am  using R version 3.1.0 and just updated GSIF). Where could I get it or should I install the latest version of R? 
Regards,
Jin



-----Original Message-----
From: Tomislav Hengl [mailto:hengl at spatial-analyst.net] 
Sent: Friday, 10 April 2015 8:09 PM
To: Li Jin; tephilippi at gmail.com
Cc: r-sig-geo at r-project.org; Ichsani Wheeler
Subject: Re: [DKIM] Re: [R-sig-Geo] FW: Spatial sampling design using information more than spatial coordinates [SEC=UNCLASSIFIED]


Jin,

When it comes to stratification prior to any model building (hence no prior predictions) I think that a robust way to stratify an area would be to use a combination of PCA and unsupervised fuzzy k-means. Here is an example:

R> library(GSIF)
R> library(plotKML)
R> library(sp)
R> data(eberg_grid)
R> gridded(eberg_grid) <- ~x+y
R> proj4string(eberg_grid) <- CRS("+init=epsg:31467") formulaString <- ~ 
R> PRMGEO6+DEMSRT6+TWISRT6+TIRAST6 eberg_spc <- spc(eberg_grid, 
R> formulaString)
Converting PRMGEO6 to indicators...
Converting covariates to principal components...
R> kmeans.eberg <- kmeans(eberg_spc at predicted@data, 4)
R> eberg_grid$cluster.4 <- as.factor(kmeans.eberg$cluster) 
R> spplot(eberg_grid["cluster.4"], col.regions=rainbow(4))

I had problems following the procedure you described (a combination of geographical clustering first, then sampling in feature space). Maybe you do only need to use the clhs
(http://www.inside-r.org/packages/cran/clhs/docs) or lhs package because this is a standard statistical method when it comes to sampling in feature space? It all depends on what is the purpose of sampling - validation, model building (maximum representation)...

HTH

Tom #1


On 9-4-2015 3:49, Jin.Li at ga.gov.au wrote:
> Hi Tom 2  :-),
>
> To be specific,  we need to do the spatial stratification first and 
> need to stratify the survey area into n equal-area strata. The 
> function stratify with equalArea in spcosa meets this need well.
>
> And then within each stratum, we need to do further stratification 
> based on a raster layer of 'elevation' that is a continuous layer and 
> needs to be converted into 3 zones. We need to sample m samples within 
> each stratum and these samples need to be evenly distributed within 
> each zone. That is we need to use the area of each zone as a weight to 
> decide how many samples should be allocated to each zone. And then do 
> randomly sampling within each zone.
>
> A further challenge is that they plan to sample 1 to 4 samples a day 
> during 25 days, so we need to provide four designs with 25, 50, 75 and
> 100 samples respectively. The samples of the design with smaller 
> sample size need to be nested in the samples of the design with larger 
> sample size for operational reasons as the survey needs to meet other 
> tasks and also to accommodate weather conditions at sea. Now you know 
> the 'elevation' is bathymetry that is the depth of water. We plan to 
> let n = 25, and m = 1 to 4. But it is hard to stratify if a stratum 
> contains 3 zones and m <3.
>
> Hope this clarify things a bit. Any further suggestions are appreciated!
>
> Jin
>
> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of 
> Tom Philippi
> Sent: Thursday, 9 April 2015 9:32 AM
> To: Tomislav Hengl
> Cc: r-sig-geo
> Subject: [DKIM] Re: [R-sig-Geo] FW: Spatial sampling design using 
> information more than spatial coordinates [SEC=UNCLASSIFIED]
>
> Jin--
>
> Could you provide more information on what the needs of your client 
> are that cannot be handled by either stratification or unequal 
> probability based on your one or more covariates in spsurvey?  Also, 
> is your sample frame points, polygons, or raster?  I assume your 
> covariates are raster (e.g., DEM for elevation) and polygons (most soil maps)?
>
> Tom 2
>
> On Wed, Apr 8, 2015 at 6:39 AM, Tomislav Hengl 
> <hengl at spatial-analyst.net <mailto:hengl at spatial-analyst.net>>
>
> wrote:
>
>  >
>
>  > The "clhs" package (http://cran.r-project.org/web/packages/clhs/) 
> has
>
>  > some functionality for latin-hypercube sampling hence it is 
> suitable
>
>  > for your case. Here are some code examples: http://gsif.isric.org/doku.
>
>  > php?id=wiki:tutorial_eberg#testing_the_feature_space_coverage
>
>  >
>
>  > I have also recently (experimentally) implemented a function to 
> test
>
>  > 'efficiency of any sampling plan' which looks at both geographical
>
>  > space and feature space representation: http://gsif.r-forge.r-project.
>
>  > org/spsample.prob.html
>
>  > If you discover a bug or some 'strange behavior', please let me know.
>
>  >
>
>  > HTH,
>
>  >
>
>  > T. (Tom) Hengl
>
>  > Researcher @ ISRIC - World Soil Information Team member Africa Soil
>
>  > Information Services http://africasoils.net
>
>  > Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
>
>  > Network: http://profiles.google.com/tom.hengl
>
>  > Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ
>
>  >
>
>  >
>
>  >
>
>  > On 8-4-2015 2:24, Jin.Li at ga.gov.au <mailto:Jin.Li at ga.gov.au> wrote:
>
>  >
>
>  >> Sorry for not ccing to the list!
>
>  >>
>
>  >> -----Original Message-----
>
>  >> From: Li Jin
>
>  >> Sent: Tuesday, 7 April 2015 9:36 AM
>
>  >> To: 'Roger.Bivand at nhh.no'
>
>  >> Subject: RE: [R-sig-Geo] Spatial sampling design using information
>
>  >> more than spatial coordinates [SEC=UNCLASSIFIED]
>
>  >>
>
>  >> Thanks a lot, Roger! Yes, we have looked at spsurvey and it does 
> not
>
>  >> meet the needs of our client.
>
>  >> Kind regards,
>
>  >> Jin
>
>  >>
>
>  >> -----Original Message-----
>
>  >> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>
>  >> Sent: Friday, 3 April 2015 2:06 AM
>
>  >> To: Li Jin
>
>  >> Cc: r-sig-geo at r-project.org <mailto:r-sig-geo at r-project.org>
>
>  >> Subject: Re: [R-sig-Geo] Spatial sampling design using information
>
>  >> more than spatial coordinates [SEC=UNCLASSIFIED]
>
>  >>
>
>  >> On Thu, 2 Apr 2015, Jin.Li at ga.gov.au <mailto:Jin.Li at ga.gov.au> wrote:
>
>  >>
>
>  >>  Hi All,
>
>  >>>
>
>  >>> I need to consider both spatial information and another variable (e.g.
>
>  >>> elevation, soil type) in a sampling design. It seems the 
> available
>
>  >>> libraries (e.g. sp and spcosa) in R for spatial sampling design 
> are
>
>  >>> unable to handle it. Please correct me if I am wrong. Before I 
> start
>
>  >>> to develop my own function for it, I would like to confirm if I 
> have
>
>  >>> missed some other functions that are available for it in R.  Any
>
>  >>> suggestions and advice? Thanks in advance!
>
>  >>>
>
>  >>
>
>  >> Have you looked at spsurvey? It may not provide what you need, but
>
>  >> checking it would probably help you see whether there is anything
>
>  >> meeting your needs. Otherwise you might need to stratify first on 
> your covariates.
>
>  >>
>
>  >> Roger
>
>  >>
>
>  >>
>
>  >>> Regards,
>
>  >>> Jin
>
>  >>>
>
>  >>> Jin Li, PhD
>
>  >>> Spatial Modeller/Computational Statistician  |  National Earth 
> and
>
>  >>> Marine Observations Group Environmental Geoscience Division  |
>
>  >>> GEOSCIENCE AUSTRALIA ______________________________
>
>  >>> ______________________________
>
>  >>> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
>
>  >>> Email: Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au
> <mailto:Jin.Li at ga.gov.au%3cmailto:Jin.Li at ga.gov.au>>    Web:
> www.ga.gov.au <http://www.ga.gov.au>
>
>  >>> <http://www.ga.gov.au/>
>
>  >>> Cnr Jerrabomberra Avenue and Hindmarsh Drive Symonston ACT GPO 
> Box
>
>  >>> 378 Canberra ACT 2601 Australia Applying geoscience to 
> Australia's
>
>  >>> most important challenges
>
>  >>>
>
>  >>>
>
>  >>> Geoscience Australia Disclaimer: This e-mail (and files 
> transmitted
>
>  >>> with
>
>  >>> it) is intended only for the person or entity to which it is
>
>  >>> addressed. If you are not the intended recipient, then you have
>
>  >>> received this e-mail by mistake and any use, dissemination,
>
>  >>> forwarding, printing or copying of this e-mail and its file
>
>  >>> attachments is prohibited. The security of emails transmitted 
> cannot
>
>  >>> be guaranteed; by forwarding or replying to this email, you 
> acknowledge and accept these risks.
>
>  >>> 
> --------------------------------------------------------------------
>
>  >>> --
>
>  >>> ---------------------------------------------------
>
>  >>>
>
>  >>>
>
>  >>>         [[alternative HTML version deleted]]
>
>  >>>
>
>  >>> _______________________________________________
>
>  >>> R-sig-Geo mailing list
>
>  >>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >>>
>
>  >>>
>
>  >> --
>
>  >> Roger Bivand
>
>  >> Department of Economics, Norwegian School of Economics, Helleveien
>
>  >> 30,
>
>  >> N-5045 Bergen, Norway.
>
>  >> voice: +47 55 95 93 55; fax +47 55 95 91 00
>
>  >> e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
>
>  >>
>
>  >>
>
>  >> Geoscience Australia Disclaimer: This e-mail (and files 
> transmitted
>
>  >> with
>
>  >> it) is intended only for the person or entity to which it is
>
>  >> addressed. If you are not the intended recipient, then you have
>
>  >> received this e-mail by mistake and any use, dissemination,
>
>  >> forwarding, printing or copying of this e-mail and its file
>
>  >> attachments is prohibited. The security of emails transmitted 
> cannot
>
>  >> be guaranteed; by forwarding or replying to this email, you 
> acknowledge and accept these risks.
>
>  >>
>
>  >> _______________________________________________
>
>  >> R-sig-Geo mailing list
>
>  >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >>
>
>  >>
>
>  > _______________________________________________
>
>  > R-sig-Geo mailing list
>
>  > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>  >
>
>                  [[alternative HTML version deleted]]
>
> _______________________________________________
>
> R-sig-Geo mailing list
>
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted 
> with
> it) is intended only for the person or entity to which it is addressed.
> If you are not the intended recipient, then you have received this 
> e-mail by mistake and any use, dissemination, forwarding, printing or 
> copying of this e-mail and its file attachments is prohibited. The 
> security of emails transmitted cannot be guaranteed; by forwarding or 
> replying to this email, you acknowledge and accept these risks.
> ----------------------------------------------------------------------
> ---------------------------------------------------
>

Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.


From markpayneatwork at gmail.com  Mon Apr 20 12:47:51 2015
From: markpayneatwork at gmail.com (Mark Payne)
Date: Mon, 20 Apr 2015 12:47:51 +0200
Subject: [R-sig-Geo] Raster Prediction with factors in model
Message-ID: <CAGBzUO9GVPpanwfws9Eh1gN5hVydRW0-vwXx3VxgKb=USAvpYg@mail.gmail.com>

Hi,

I have a GAM model that contains factors in addition to smooth terms etc. I
would like to evaluate this at all points on a raster, but I can't seem to
get the predict.raster() function to pick up the values of my factors. I
have created a minimum (not) working example here, based on the example for
the predict() function.

Any suggestions in this direction would be appreciated.

Mark

# create a RasterStack or RasterBrick with with a set of predictor layers
logo <- brick(system.file("external/rlogo.grd", package="raster"))

# known presence and absence points
p <- matrix(c(48, 48, 48, 53, 50, 46, 54, 70, 84, 85, 74, 84, 95, 85,
              66, 42, 26, 4, 19, 17, 7, 14, 26, 29, 39, 45, 51, 56, 46, 38,
31,
              22, 34, 60, 70, 73, 63, 46, 43, 28), ncol=2)

a <- matrix(c(22, 33, 64, 85, 92, 94, 59, 27, 30, 64, 60, 33, 31, 9,
              99, 67, 15, 5, 4, 30, 8, 37, 42, 27, 19, 69, 60, 73, 3, 5, 21,
              37, 52, 70, 74, 9, 13, 4, 17, 47), ncol=2)

# extract values for points
xy <- rbind(cbind(1, p), cbind(0, a))
v <- data.frame(cbind(xy[,1], extract(logo, xy[,2:3])))
colnames(v)[1] <- 'pa'

#Convert blue layer to a factor
v$blue <- factor(v$blue < 200)

#build a model, here an example with glm
model <- glm(formula=pa~., data=v)

#Setup prediction objects
pred.b <- logo[[1:2]]
const.df <- data.frame(blue=TRUE)

#predict to a raster
r1 <- predict(pred.b, model, progress='text',
              const=const.df)


#Returns an error as follows:
# Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected

	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Mon Apr 20 13:24:35 2015
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 20 Apr 2015 12:24:35 +0100
Subject: [R-sig-Geo] extract X,
 Y coordinates from (points) POSTGIS coordinates (WKT
In-Reply-To: <CAGZnXNBmrM4X5zdZC94zMryeqD1VZbXWiYR2fL4M51LWvxVdzg@mail.gmail.com>
References: <CAGZnXNBmrM4X5zdZC94zMryeqD1VZbXWiYR2fL4M51LWvxVdzg@mail.gmail.com>
Message-ID: <CANVKczMMF=RQr1DxmkZQuG73snn9v2=rqu=S1yQpge_smXn=nw@mail.gmail.com>

If you install rgeos then you get the readWKT function, and use sp as
well to build some spatial points:

[tip: use `dput(d)` to dump sample data]

> d = structure(list(xy = c("POINT (-59.900833 -34.869722)", "POINT (-60.009032477477234 -34.71350213192503)",
"POINT (-60.13337136105485 -34.74472597084807)", "POINT
(-60.199859958706185 -34.7384738077165)"
)), .Names = "xy", row.names = c(NA, -4L), class = "data.frame")

 > library(sp); library(rgeos)

 > xy = do.call(rbind,lapply(d$xy, readWKT))
 > xy
SpatialPoints:
          x         y
1 -59.90083 -34.86972
1 -60.00903 -34.71350
1 -60.13337 -34.74473
1 -60.19986 -34.73847

You can then get the separate coordinates as vectors:

 > xy$x
        1         1         1         1
-59.90083 -60.00903 -60.13337 -60.19986
 > xy$y
        1         1         1         1
-34.86972 -34.71350 -34.74473 -34.73847

[the 1s are just row labels]

If you just want a 2-column matrix:

 > coordinates(xy)
          x         y
1 -59.90083 -34.86972
1 -60.00903 -34.71350
1 -60.13337 -34.74473
1 -60.19986 -34.73847

 - thats a matrix, not a data frame, but you can easily build one!

Barry



On Mon, Apr 20, 2015 at 11:01 AM, Marcos Angelini <angelini75 at gmail.com> wrote:
> Hi community,
>
> I have a data frame of points with coordinates (WKT) in one column. It is
>
> d <- as.data.frame(NULL)
> d$xy <- c("POINT (-59.900833 -34.869722)", "POINT (-60.009032477477234
> -34.71350213192503)", "POINT (-60.13337136105485 -34.74472597084807)",
> "POINT (-60.199859958706185 -34.7384738077165)")
>
> I want to convert this into:
> d$X
> -59.900833
> -60.009032
> -60.133371
> -60.199860
> d$Y
> -34.869722
> -34.713502
> -34.744726
> -34.738474
>
> I've tried with gsub() but I'm not handy with regular expressions. Could
> you help me, please?
>
> Marcos.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From gosz at gmx.de  Mon Apr 20 14:05:41 2015
From: gosz at gmx.de (Guido Schulz)
Date: Mon, 20 Apr 2015 14:05:41 +0200
Subject: [R-sig-Geo] How to do residual & regression deletion diagnostics on
 spautolm/sarlm objects?
Message-ID: <5534EB95.4040603@gmx.de>

In stats there are nice functions to carry out residual & regression
deletion diagnostics on lm or glm objects, such as:

stats::plot.lm
and
stats::influence.measures

Example:
----------
install.packages("graphics");library(graphics)
lm.object <- lm(sr ~ pop75 + dpi + ddpi, data = LifeCycleSavings)
plot(lm.object)
influence.measures(lm.object)
----------

I would like to do these (or similar) diagnostics on a spdep::spautolm
(type "SAR") object, but neither plot.lm nor influence.measures accepts
spdep::spautolm/sarlm objects.

Can you recommend a workaround?
Or are these diagnostics simply not appropriate for SAR type regressions?


From luc.steinbuch at wur.nl  Tue Apr 21 17:19:35 2015
From: luc.steinbuch at wur.nl (Steinbuch, Luc)
Date: Tue, 21 Apr 2015 15:19:35 +0000
Subject: [R-sig-Geo] extract X, Y coordinates from (points) POSTGIS
Message-ID: <85f8df2a3afb40d5bbc544c26c23b534@scomp5292.wurnet.nl>

Hi Marcos and Barry,

Another, low-level solution would be:

----------------

d <- as.data.frame(matrix(data=NA, nrow=4))
d$xy <- c("POINT (-59.900833 -34.869722)", "POINT (-60.009032477477234 -34.71350213192503)", "POINT (-60.13337136105485 -34.74472597084807)", "POINT (-60.199859958706185 -34.7384738077165)")

vs_numbers_and_space = substr(d$xy, start=8, stop=nchar(d$xy)-1) # remove "POINT ("  at beginning and ")" at end of strings
# vs_ : vector of strings

ms_just_numbers =  matrix(unlist(strsplit(vs_numbers_and_space, split=" ")), nrow=4, byrow = TRUE) # split strings at space, and put into matrix
# ms_ : matrix of strings

d$X = as.numeric(ms_just_numbers[,1])
d$Y = as.numeric(ms_just_numbers[,2])

remove(vs_numbers_and_space, ms_just_numbers)

-------------------------------

Luc


Date: Mon, 20 Apr 2015 12:01:51 +0200
From: Marcos Angelini <angelini75 at gmail.com>
To: R-sig-Geo at r-project.org
Subject: [R-sig-Geo] extract X,	Y coordinates from (points) POSTGIS
	coordinates (WKT
Message-ID:
	<CAGZnXNBmrM4X5zdZC94zMryeqD1VZbXWiYR2fL4M51LWvxVdzg at mail.gmail.com>
Content-Type: text/plain; charset="UTF-8"

Hi community,

I have a data frame of points with coordinates (WKT) in one column. It is

d <- as.data.frame(NULL)
d$xy <- c("POINT (-59.900833 -34.869722)", "POINT (-60.009032477477234 -34.71350213192503)", "POINT (-60.13337136105485 -34.74472597084807)", "POINT (-60.199859958706185 -34.7384738077165)")

I want to convert this into:
d$X
-59.900833
-60.009032
-60.133371
-60.199860
d$Y
-34.869722
-34.713502
-34.744726
-34.738474

I've tried with gsub() but I'm not handy with regular expressions. Could you help me, please?

Marcos.

------------------------------

Message: 4
Date: Mon, 20 Apr 2015 12:24:35 +0100
From: Barry Rowlingson <b.rowlingson at lancaster.ac.uk>
To: Marcos Angelini <angelini75 at gmail.com>
Cc: r-sig-geo <R-sig-Geo at r-project.org>
Subject: Re: [R-sig-Geo] extract X, Y coordinates from (points)
	POSTGIS coordinates (WKT
Message-ID:
	<CANVKczMMF=RQr1DxmkZQuG73snn9v2=rqu=S1yQpge_smXn=nw at mail.gmail.com>
Content-Type: text/plain; charset=UTF-8

If you install rgeos then you get the readWKT function, and use sp as
well to build some spatial points:

[tip: use `dput(d)` to dump sample data]

> d = structure(list(xy = c("POINT (-59.900833 -34.869722)", "POINT (-60.009032477477234 -34.71350213192503)",
"POINT (-60.13337136105485 -34.74472597084807)", "POINT
(-60.199859958706185 -34.7384738077165)"
)), .Names = "xy", row.names = c(NA, -4L), class = "data.frame")

 > library(sp); library(rgeos)

 > xy = do.call(rbind,lapply(d$xy, readWKT))
 > xy
SpatialPoints:
          x         y
1 -59.90083 -34.86972
1 -60.00903 -34.71350
1 -60.13337 -34.74473
1 -60.19986 -34.73847

You can then get the separate coordinates as vectors:

 > xy$x
        1         1         1         1
-59.90083 -60.00903 -60.13337 -60.19986
 > xy$y
        1         1         1         1
-34.86972 -34.71350 -34.74473 -34.73847

[the 1s are just row labels]

If you just want a 2-column matrix:

 > coordinates(xy)
          x         y
1 -59.90083 -34.86972
1 -60.00903 -34.71350
1 -60.13337 -34.74473
1 -60.19986 -34.73847

 - thats a matrix, not a data frame, but you can easily build one!

Barry


From hengl at spatial-analyst.net  Tue Apr 21 19:22:02 2015
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Tue, 21 Apr 2015 19:22:02 +0200
Subject: [R-sig-Geo] plotKML RasterTimeSeries for large area
In-Reply-To: <1192279944.7487311.1429448191199.JavaMail.yahoo@mail.yahoo.com>
References: <1192279944.7487311.1429448191199.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <5536873A.9090308@spatial-analyst.net>


RE "Does plotKML support Region and level of detail?" Yes. Please try:

http://plotkml.r-forge.r-project.org/plotKML.GDALobj.html

To install plotKML v0.5-1 please refer to:

http://r-forge.r-project.org/R/?group_id=1106

This is an example of large raster (30 million pixels) plotted using the 
plotKML.GDALobj function: http://www.youtube.com/watch?v=Curr3LdF274


On 19-4-2015 14:56, Amit Boshale via R-sig-Geo wrote:
> Dear List,
>
> I want use plotKML to plot RasterTimeSeries graphs for a large raster
> stack (300 images, 500 km x500 km). Clearly, I have to produced hundreds
> of small kmls. But I cannot display them at once. <Region> could help in
> solving the problem. Does plotKML support Region and level of detail?
> (see Working with Regions
> <https://developers.google.com/kml/documentation/regions#pixelrange>)
>
> Thanks!
> Amit
>
> 	
> image <https://developers.google.com/kml/documentation/regions#pixelrange>
> 	
> 	
> 	
> 	
> 	
> Working with Regions
> <https://developers.google.com/kml/documentation/regions#pixelrange>
> Regions are a powerful KML feature that allows you to add very large
> datasets to Google Earth without sacrificing performance.
> Auf developers.goog... anzeigen
> <https://developers.google.com/kml/documentation/regions#pixelrange>
> 	
> Vorschau nach Yahoo
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From stephen.stewart85 at gmail.com  Wed Apr 22 01:28:21 2015
From: stephen.stewart85 at gmail.com (Stephen Stewart)
Date: Tue, 21 Apr 2015 16:28:21 -0700 (MST)
Subject: [R-sig-Geo] MODIS Package 0.10-23 (16/04/2015)
Message-ID: <1429658901122-7588090.post@n2.nabble.com>

Hi everyone,

I was testing a fresh install of the MODIS package on my laptop yesterday in
preparation for a workshop I am running later on in the week.

I came across an error in that I have previously not encountered with MODIS
0.10-18.

library(MODIS)

MODISoptions(gdalPath='c:/OSGeo4W64/bin', localArcPath =
"C:/GIS_in_R/MODIS/",outDirPath = "C:/GIS_in_R/MODIS/DONE/") # Set the GDAL
and output paths.

start_date <- as.Date("1-1-2014","%d-%m-%Y") 

end_date <- as.Date("1-1-2014","%d-%m-%Y") 

dates <- transDate(start_date,end_date) 

runGdal("MOD11A2",extent = extent(vic), begin = dates$beginDOY, end =
dates$endDOY, outProj="+proj=longlat +datum=WGS84 +no_defs")

Error in file (description = lockfile, open = "wt") :
cannot open the connection
In addition: warning message:
In file(description = lockfile, open = "wt") :
cannot open file
'C:/GIS_in_R/MODIS/DONE/.auxilliaries/MOD11A2.005.LPDAAC.lock': No such file
or directory.

This currently works on my main machine running R 3.1.3 with MODIS 0.10-18.

I've tried MODIS 0.10-23 on the laptop with both R 3.1.3 and R 3.2.0, both
of which do not work. I've also checked the dependencies (i.e. RCurl and
bitops) which are the same version between my laptop and my main PC. The
both machines have the latest OSGEO4Wx64 installed. The only difference
between them that I can find is the MODIS package version.

Has anyone encountered this issue? Can someone see if they can reproduce? 

Thanks in advance







--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/MODIS-Package-0-10-23-16-04-2015-tp7588090.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From stephen.stewart85 at gmail.com  Wed Apr 22 01:37:47 2015
From: stephen.stewart85 at gmail.com (Stephen Stewart)
Date: Tue, 21 Apr 2015 16:37:47 -0700 (MST)
Subject: [R-sig-Geo] MODIS Package 0.10-23 (16/04/2015)
In-Reply-To: <1429658901122-7588090.post@n2.nabble.com>
References: <1429658901122-7588090.post@n2.nabble.com>
Message-ID: <1429659467274-7588091.post@n2.nabble.com>

The extent for the vic shapefile:

class       : Extent 
xmin        : 140.9617 
xmax        : 149.9767 
ymin        : -39.15919 
ymax        : -33.98043 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/MODIS-Package-0-10-23-16-04-2015-tp7588090p7588091.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Beaulieu.Jake at epa.gov  Wed Apr 22 20:14:28 2015
From: Beaulieu.Jake at epa.gov (Beaulieu, Jake)
Date: Wed, 22 Apr 2015 18:14:28 +0000
Subject: [R-sig-Geo] plotKML throws status 37 warning
Message-ID: <DM2PR09MB0352FD408E5DAF0B2E7E2247F3EE0@DM2PR09MB0352.namprd09.prod.outlook.com>

I am having trouble running the example code provided in the plotKML help file.  The example is as follows:

library(sp)
library(rgdal)
data(eberg)
coordinates(eberg) <- ~X+Y
proj4string(eberg) <- CRS("+init=epsg:31467")
## subset to 20 percent:
eberg <- eberg[runif(nrow(eberg))<.1,]
## Not run: ## bubble type plot:
plotKML(eberg["CLYMHT_A"])

Here is what happens when I run the code:


> plotKML(eberg["CLYMHT_A"])

Plotting the first variable on the list

KML file opened for writing...

Reprojecting to +proj=longlat +datum=WGS84 ...

Writing to KML...

Closing  eberg__CLYMHT_A__.kml

access to 'C:\Users\jbeaulie\DOCUME~1\PLOTKM~1\EBERG_~1.KML' denied

Warning message:

running command 'open C:\Users\jbeaulie\DOCUME~1\PLOTKM~1\EBERG_~1.KML' had status 37

The kml file is written to the specified directory, but apparently R can't open the file from there.  Any thoughts?  Session info below.



> sessionInfo()

R version 3.1.2 (2014-10-31)

Platform: x86_64-w64-mingw32/x64 (64-bit)



locale:

[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252

[3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C

[5] LC_TIME=English_United States.1252



attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base



other attached packages:

[1] rgdal_0.9-1   plotKML_0.5-0 sp_1.0-17



loaded via a namespace (and not attached):

 [1] acepack_1.3-3.3     aqp_1.8             class_7.3-11        classInt_0.1-22

 [5] cluster_1.15.3      colorRamps_2.3      colorspace_1.2-4    digest_0.6.8

 [9] dismo_1.0-12        e1071_1.6-4         evaluate_0.5.5      FNN_1.1

[13] foreign_0.8-61      formatR_1.1         Formula_1.2-0       ggplot2_1.0.0

[17] grid_3.1.2          gstat_1.0-22        gtable_0.1.2        Hmisc_3.15-0

[21] htmltools_0.2.6     intervals_0.15.0    knitr_1.9           lattice_0.20-29

[25] latticeExtra_0.6-26 MASS_7.3-35         munsell_0.4.2       nnet_7.3-8

[29] pixmap_0.4-11       plotrix_3.5-11      plyr_1.8.1          proto_0.3-10

[33] raster_2.3-24       RColorBrewer_1.1-2  Rcpp_0.11.3         reshape_0.8.5

[37] reshape2_1.4.1      rmarkdown_0.3.11    rpart_4.1-8         RSAGA_0.93-6

[41] scales_0.2.4        spacetime_1.1-3     splines_3.1.2       stringr_0.6.2

[45] survival_2.37-7     tools_3.1.2         XML_3.98-1.1        xts_0.9-7

[49] yaml_2.1.13         zoo_1.7-11


Jake J Beaulieu, PhD
United States Environmental Protection Agency
Office of Research and Development
National Risk Management Research Laboratory
Water Supply and Water Resources Division
Urban Waters Management Branch
26 W MLK Dr.
MS 698
Cincinnati, OH 45268
Phone: 513-569-7842


	[[alternative HTML version deleted]]


From gbl1 at hi.is  Thu Apr 23 02:45:30 2015
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Thu, 23 Apr 2015 00:45:30 +0000
Subject: [R-sig-Geo] adding a scale
Message-ID: <645d-55384080-1f7-5ac5d900@51162230>

Hi all,

I am ploting map from shapefiles (curently read with readOGR from rgdal). 
My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily) 

Thanks in advance 

Benjamin


From frtog at vestas.com  Thu Apr 23 07:10:39 2015
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Thu, 23 Apr 2015 07:10:39 +0200
Subject: [R-sig-Geo] plotKML throws status 37 warning
In-Reply-To: <DM2PR09MB0352FD408E5DAF0B2E7E2247F3EE0@DM2PR09MB0352.namprd09.prod.outlook.com>
References: <DM2PR09MB0352FD408E5DAF0B2E7E2247F3EE0@DM2PR09MB0352.namprd09.prod.outlook.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4858836EC556@DKRDSEXC016.vestas.net>

Hi Jake

My guess is that you don't have any file association on files with extension kml. 

I had the same problem on my old laptop with the same error message but on my new laptop your example works. With the old laptop I just lived with it. But since it works on my new laptop I checked my hunch  that the problem is probably due to missing file association and that turned out to be true.

Find the kml your script produced with your favourite file manager and right click on that, choose file properties and see which program is set to open kml files. On my old laptop it said unknown application whereas on my new laptop it said Google Earth.

Hope that helps.

Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender.

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Beaulieu, Jake
Sent: 22. april 2015 20:14
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] plotKML throws status 37 warning

I am having trouble running the example code provided in the plotKML help file.  The example is as follows:

library(sp)
library(rgdal)
data(eberg)
coordinates(eberg) <- ~X+Y
proj4string(eberg) <- CRS("+init=epsg:31467")
## subset to 20 percent:
eberg <- eberg[runif(nrow(eberg))<.1,]
## Not run: ## bubble type plot:
plotKML(eberg["CLYMHT_A"])

Here is what happens when I run the code:


> plotKML(eberg["CLYMHT_A"])

Plotting the first variable on the list

KML file opened for writing...

Reprojecting to +proj=longlat +datum=WGS84 ...

Writing to KML...

Closing  eberg__CLYMHT_A__.kml

access to 'C:\Users\jbeaulie\DOCUME~1\PLOTKM~1\EBERG_~1.KML' denied

Warning message:

running command 'open C:\Users\jbeaulie\DOCUME~1\PLOTKM~1\EBERG_~1.KML' had status 37

The kml file is written to the specified directory, but apparently R can't open the file from there.  Any thoughts?  Session info below.



> sessionInfo()

R version 3.1.2 (2014-10-31)

Platform: x86_64-w64-mingw32/x64 (64-bit)



locale:

[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252

[3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C

[5] LC_TIME=English_United States.1252



attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base



other attached packages:

[1] rgdal_0.9-1   plotKML_0.5-0 sp_1.0-17



loaded via a namespace (and not attached):

 [1] acepack_1.3-3.3     aqp_1.8             class_7.3-11        classInt_0.1-22

 [5] cluster_1.15.3      colorRamps_2.3      colorspace_1.2-4    digest_0.6.8

 [9] dismo_1.0-12        e1071_1.6-4         evaluate_0.5.5      FNN_1.1

[13] foreign_0.8-61      formatR_1.1         Formula_1.2-0       ggplot2_1.0.0

[17] grid_3.1.2          gstat_1.0-22        gtable_0.1.2        Hmisc_3.15-0

[21] htmltools_0.2.6     intervals_0.15.0    knitr_1.9           lattice_0.20-29

[25] latticeExtra_0.6-26 MASS_7.3-35         munsell_0.4.2       nnet_7.3-8

[29] pixmap_0.4-11       plotrix_3.5-11      plyr_1.8.1          proto_0.3-10

[33] raster_2.3-24       RColorBrewer_1.1-2  Rcpp_0.11.3         reshape_0.8.5

[37] reshape2_1.4.1      rmarkdown_0.3.11    rpart_4.1-8         RSAGA_0.93-6

[41] scales_0.2.4        spacetime_1.1-3     splines_3.1.2       stringr_0.6.2

[45] survival_2.37-7     tools_3.1.2         XML_3.98-1.1        xts_0.9-7

[49] yaml_2.1.13         zoo_1.7-11


Jake J Beaulieu, PhD
United States Environmental Protection Agency
Office of Research and Development
National Risk Management Research Laboratory
Water Supply and Water Resources Division
Urban Waters Management Branch
26 W MLK Dr.
MS 698
Cincinnati, OH 45268
Phone: 513-569-7842


	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From frtog at vestas.com  Thu Apr 23 07:18:02 2015
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Thu, 23 Apr 2015 07:18:02 +0200
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <645d-55384080-1f7-5ac5d900@51162230>
References: <645d-55384080-1f7-5ac5d900@51162230>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4858836EC560@DKRDSEXC016.vestas.net>

Hi Benjamin

Yes, there are several ways to do that. But it depends on which kind of plotting function you used. Usually it is a setting of an argument of the plotting function.

I cannot help you more since I don't more than the information you provided in your email.

If you want more help from this list please provide a small example showing which functions you used with information on which package(s) they belong. Then you'll probably get more help.

The small example you can probably find in the example section on the help page for the plotting function.

Best Regards

Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender.

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Gilles Benjamin Leduc
Sent: 23. april 2015 02:46
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] adding a scale

Hi all,

I am ploting map from shapefiles (curently read with readOGR from rgdal). 
My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily) 

Thanks in advance 

Benjamin

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From r.hijmans at gmail.com  Thu Apr 23 08:23:31 2015
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 22 Apr 2015 23:23:31 -0700
Subject: [R-sig-Geo] Raster Prediction with factors in model
In-Reply-To: <CAGBzUO9GVPpanwfws9Eh1gN5hVydRW0-vwXx3VxgKb=USAvpYg@mail.gmail.com>
References: <CAGBzUO9GVPpanwfws9Eh1gN5hVydRW0-vwXx3VxgKb=USAvpYg@mail.gmail.com>
Message-ID: <CANtt_hyqnexcN6epW0HtR1jtvU682D_rCds3==QNGsyFAU9T2A@mail.gmail.com>

Mark,
I had not considered the case where the constant is a factor. I need
to fix that. Here is a script that accomplishes what you want, I think

# known presence and absence points
p <- matrix(c(48, 48, 48, 53, 50, 46, 54, 70, 84, 85, 74, 84, 95, 85,
              66, 42, 26, 4, 19, 17, 7, 14, 26, 29, 39, 45, 51, 56, 46, 38,31,
              22, 34, 60, 70, 73, 63, 46, 43, 28), ncol=2)

a <- matrix(c(22, 33, 64, 85, 92, 94, 59, 27, 30, 64, 60, 33, 31, 9,
              99, 67, 15, 5, 4, 30, 8, 37, 42, 27, 19, 69, 60, 73, 3, 5, 21,
              37, 52, 70, 74, 9, 13, 4, 17, 47), ncol=2)

# extract values for points
xy <- rbind(cbind(1, p), cbind(0, a))
v <- data.frame(cbind(xy[,1], extract(logo, xy[,2:3])))
colnames(v)[1] <- 'pa'

#Convert blue layer to a factor
## RH I would not use TRUE/FALSE but an integer representation instead
v$blue <- factor((v$blue < 200) + 0)

#build a model, here an example with glm
model <- glm(formula=pa~., data=v)

#Setup prediction objects
pred.b <- logo
pred.b[[3]] <- (pred.b[[3]] < 200) + 0
# or all TRUE?  pred.b[[3]] <- 1
names(pred.b) <- names(logo)

#predict to a raster
r1 <- predict(pred.b, model, progress='text')


You say you want to use a gam, but the example is a glm. With gam
there might be additional issues. Please let me know if that is the
case.

Robert


On Mon, Apr 20, 2015 at 3:47 AM, Mark Payne <markpayneatwork at gmail.com> wrote:
> Hi,
>
> I have a GAM model that contains factors in addition to smooth terms etc. I
> would like to evaluate this at all points on a raster, but I can't seem to
> get the predict.raster() function to pick up the values of my factors. I
> have created a minimum (not) working example here, based on the example for
> the predict() function.
>
> Any suggestions in this direction would be appreciated.
>
> Mark
>
> # create a RasterStack or RasterBrick with with a set of predictor layers
> logo <- brick(system.file("external/rlogo.grd", package="raster"))
>
> # known presence and absence points
> p <- matrix(c(48, 48, 48, 53, 50, 46, 54, 70, 84, 85, 74, 84, 95, 85,
>               66, 42, 26, 4, 19, 17, 7, 14, 26, 29, 39, 45, 51, 56, 46, 38,
> 31,
>               22, 34, 60, 70, 73, 63, 46, 43, 28), ncol=2)
>
> a <- matrix(c(22, 33, 64, 85, 92, 94, 59, 27, 30, 64, 60, 33, 31, 9,
>               99, 67, 15, 5, 4, 30, 8, 37, 42, 27, 19, 69, 60, 73, 3, 5, 21,
>               37, 52, 70, 74, 9, 13, 4, 17, 47), ncol=2)
>
> # extract values for points
> xy <- rbind(cbind(1, p), cbind(0, a))
> v <- data.frame(cbind(xy[,1], extract(logo, xy[,2:3])))
> colnames(v)[1] <- 'pa'
>
> #Convert blue layer to a factor
> v$blue <- factor(v$blue < 200)
>
> #build a model, here an example with glm
> model <- glm(formula=pa~., data=v)
>
> #Setup prediction objects
> pred.b <- logo[[1:2]]
> const.df <- data.frame(blue=TRUE)
>
> #predict to a raster
> r1 <- predict(pred.b, model, progress='text',
>               const=const.df)
>
>
> #Returns an error as follows:
> # Error in `[.data.frame`(blockvals, , f[j]) : undefined columns selected
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Thu Apr 23 09:15:31 2015
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 23 Apr 2015 08:15:31 +0100
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <645d-55384080-1f7-5ac5d900@51162230>
References: <645d-55384080-1f7-5ac5d900@51162230>
Message-ID: <CANVKczO00U7Xic+07fHCKbuu1xQBCa9g-onkvsOSJwFfmbY=GQ@mail.gmail.com>

Searching for "R map scale bar" should get you enough helpful hints,
including this nice looking blog post

http://andybeger.com/2012/08/25/scale-and-north-arrow-for-maps-in-r/
On 23 Apr 2015 01:46, "Gilles Benjamin Leduc" <gbl1 at hi.is> wrote:

> Hi all,
>
> I am ploting map from shapefiles (curently read with readOGR from rgdal).
> My PhD supervisor asked me to add a scale? Before going in crazy
> computation and the arrow function I wonder? Is there a function that can
> do it automatically (or easily)
>
> Thanks in advance
>
> Benjamin
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Beaulieu.Jake at epa.gov  Thu Apr 23 13:53:46 2015
From: Beaulieu.Jake at epa.gov (Beaulieu, Jake)
Date: Thu, 23 Apr 2015 11:53:46 +0000
Subject: [R-sig-Geo] plotKML throws status 37 warning
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4858836EC556@DKRDSEXC016.vestas.net>
References: <DM2PR09MB0352FD408E5DAF0B2E7E2247F3EE0@DM2PR09MB0352.namprd09.prod.outlook.com>
	<B078CDF40DFE4045AF172A8B4F68FC4858836EC556@DKRDSEXC016.vestas.net>
Message-ID: <DM2PR09MB0352CE90745932A25CD7EA9CF3ED0@DM2PR09MB0352.namprd09.prod.outlook.com>

Thanks for the suggestion Frede.  That was the problem.

Jake

-----Original Message-----
From: Frede Aakmann T?gersen [mailto:frtog at vestas.com] 
Sent: Thursday, April 23, 2015 1:11 AM
To: Beaulieu, Jake; r-sig-geo at r-project.org
Subject: RE: plotKML throws status 37 warning

Hi Jake

My guess is that you don't have any file association on files with extension kml. 

I had the same problem on my old laptop with the same error message but on my new laptop your example works. With the old laptop I just lived with it. But since it works on my new laptop I checked my hunch  that the problem is probably due to missing file association and that turned out to be true.

Find the kml your script produced with your favourite file manager and right click on that, choose file properties and see which program is set to open kml files. On my old laptop it said unknown application whereas on my new laptop it said Google Earth.

Hope that helps.

Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice If you have received this e-mail in error please contact the sender.

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Beaulieu, Jake
Sent: 22. april 2015 20:14
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] plotKML throws status 37 warning

I am having trouble running the example code provided in the plotKML help file.  The example is as follows:

library(sp)
library(rgdal)
data(eberg)
coordinates(eberg) <- ~X+Y
proj4string(eberg) <- CRS("+init=epsg:31467") ## subset to 20 percent:
eberg <- eberg[runif(nrow(eberg))<.1,]
## Not run: ## bubble type plot:
plotKML(eberg["CLYMHT_A"])

Here is what happens when I run the code:


> plotKML(eberg["CLYMHT_A"])

Plotting the first variable on the list

KML file opened for writing...

Reprojecting to +proj=longlat +datum=WGS84 ...

Writing to KML...

Closing  eberg__CLYMHT_A__.kml

access to 'C:\Users\jbeaulie\DOCUME~1\PLOTKM~1\EBERG_~1.KML' denied

Warning message:

running command 'open C:\Users\jbeaulie\DOCUME~1\PLOTKM~1\EBERG_~1.KML' had status 37

The kml file is written to the specified directory, but apparently R can't open the file from there.  Any thoughts?  Session info below.



> sessionInfo()

R version 3.1.2 (2014-10-31)

Platform: x86_64-w64-mingw32/x64 (64-bit)



locale:

[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252

[3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C

[5] LC_TIME=English_United States.1252



attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base



other attached packages:

[1] rgdal_0.9-1   plotKML_0.5-0 sp_1.0-17



loaded via a namespace (and not attached):

 [1] acepack_1.3-3.3     aqp_1.8             class_7.3-11        classInt_0.1-22

 [5] cluster_1.15.3      colorRamps_2.3      colorspace_1.2-4    digest_0.6.8

 [9] dismo_1.0-12        e1071_1.6-4         evaluate_0.5.5      FNN_1.1

[13] foreign_0.8-61      formatR_1.1         Formula_1.2-0       ggplot2_1.0.0

[17] grid_3.1.2          gstat_1.0-22        gtable_0.1.2        Hmisc_3.15-0

[21] htmltools_0.2.6     intervals_0.15.0    knitr_1.9           lattice_0.20-29

[25] latticeExtra_0.6-26 MASS_7.3-35         munsell_0.4.2       nnet_7.3-8

[29] pixmap_0.4-11       plotrix_3.5-11      plyr_1.8.1          proto_0.3-10

[33] raster_2.3-24       RColorBrewer_1.1-2  Rcpp_0.11.3         reshape_0.8.5

[37] reshape2_1.4.1      rmarkdown_0.3.11    rpart_4.1-8         RSAGA_0.93-6

[41] scales_0.2.4        spacetime_1.1-3     splines_3.1.2       stringr_0.6.2

[45] survival_2.37-7     tools_3.1.2         XML_3.98-1.1        xts_0.9-7

[49] yaml_2.1.13         zoo_1.7-11


Jake J Beaulieu, PhD
United States Environmental Protection Agency Office of Research and Development National Risk Management Research Laboratory Water Supply and Water Resources Division Urban Waters Management Branch
26 W MLK Dr.
MS 698
Cincinnati, OH 45268
Phone: 513-569-7842


	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From lucianolasala at yahoo.com.ar  Thu Apr 23 16:36:35 2015
From: lucianolasala at yahoo.com.ar (Luciano La Sala)
Date: Thu, 23 Apr 2015 11:36:35 -0300
Subject: [R-sig-Geo] Problem clipping SpatialPolygonDataFrame
Message-ID: <55390373.6000204@yahoo.com.ar>

Hello everyone,

I have a SpatialPolygonsDataFrame for Argentina which I need to crop 
using a bounding box or any other method. I tried the following but the 
new map turns out to have the same exact extent as the original one:

# Info on my Data Frame.

 > summary(arg.provinces)
Object of class SpatialPolygonsDataFrame
Coordinates:
         min       max
x -73.57778 -53.59183
y -55.06153 -21.77855
Is projected: FALSE
proj4string :
[+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]

 > extent(arg.provinces)
class       : Extent
xmin        : -73.57778
xmax        : -53.59183
ymin        : -55.06153
ymax        : -21.77855

# Trying to clip it

out <- crop(arg.provinces, extent(-73.57778, -53.59183, -55.06153, 
-21.77855))
plot(out)

 > extent(out)
class       : Extent
xmin        : -73.57778
xmax        : -53.59184
ymin        : -55.06153
ymax        : -21.77855


Thank you very much in advance!


-- 
Luciano F. La Sala
Consejo Nacional de Investigaciones Cient?ficas y T?cnicas (CONICET)
C?tedra de Epidemiolog?a
Departamento de Biolog?a, Bioqu?mica y Farmacia
Universidad Nacional del Sur
San Juan 670
Bah?a Blanca (8000)
Argentina


From r.hijmans at gmail.com  Thu Apr 23 17:16:22 2015
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 23 Apr 2015 08:16:22 -0700
Subject: [R-sig-Geo] Problem clipping SpatialPolygonDataFrame
In-Reply-To: <55390373.6000204@yahoo.com.ar>
References: <55390373.6000204@yahoo.com.ar>
Message-ID: <CANtt_hwTNKF_3Wb678kWKmw5U_g56SBkSFpU57vQUoUbXJPc1Q@mail.gmail.com>

Luciano,
The extent you are using to crop is the same as the extent of the
entire extent, so it does not surprise me that there is no change.
Here is an example that works:

library(raster)
library(rgeos)
g <- getData('GADM', country='ARG', level=1)
e <- extent(-63.6, -55.1, -32.8, -27.6)
x <- crop(g, e)
plot(g)
plot(x, add=TRUE, border='blue', lwd=2)

Robert


On Thu, Apr 23, 2015 at 7:36 AM, Luciano La Sala
<lucianolasala at yahoo.com.ar> wrote:
> Hello everyone,
>
> I have a SpatialPolygonsDataFrame for Argentina which I need to crop using a
> bounding box or any other method. I tried the following but the new map
> turns out to have the same exact extent as the original one:
>
> # Info on my Data Frame.
>
>> summary(arg.provinces)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>         min       max
> x -73.57778 -53.59183
> y -55.06153 -21.77855
> Is projected: FALSE
> proj4string :
> [+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
>
>> extent(arg.provinces)
> class       : Extent
> xmin        : -73.57778
> xmax        : -53.59183
> ymin        : -55.06153
> ymax        : -21.77855
>
> # Trying to clip it
>
> out <- crop(arg.provinces, extent(-73.57778, -53.59183, -55.06153,
> -21.77855))
> plot(out)
>
>> extent(out)
> class       : Extent
> xmin        : -73.57778
> xmax        : -53.59184
> ymin        : -55.06153
> ymax        : -21.77855
>
>
> Thank you very much in advance!
>
>
> --
> Luciano F. La Sala
> Consejo Nacional de Investigaciones Cient?ficas y T?cnicas (CONICET)
> C?tedra de Epidemiolog?a
> Departamento de Biolog?a, Bioqu?mica y Farmacia
> Universidad Nacional del Sur
> San Juan 670
> Bah?a Blanca (8000)
> Argentina
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From juta.kawalerowicz at nuffield.ox.ac.uk  Thu Apr 23 19:04:57 2015
From: juta.kawalerowicz at nuffield.ox.ac.uk (Juta Kawalerowicz)
Date: Thu, 23 Apr 2015 18:04:57 +0100
Subject: [R-sig-Geo] Spatial overlay vs. extract and aggregation methods
Message-ID: <CAHMizkNV7mDN0psgLnC8A3VpTRqNhHjWwkXOuaRM6cmO+8jj1Q@mail.gmail.com>

Hi,

I have a spatial polygon data frame (spdf1) and try to aggregate
information from it over polygons in a larger spatial polygon data
frame(spdf2). I wanted to run some simple test to see that my code is sound
(on nc.sids from maptools), but run into a problem which I don't
understand. As far as I can see, there are 2 ways to do this:

1) rasterise the smaller spdf1, extract and calculate over larger spdf2

library(maptools)
library(raster)
nc.sids <- readShapeSpatial(system.file("shapes/sids.shp",
package="maptools")[1],
                            IDvar="FIPSNO", proj4string=CRS("+proj=longlat
+ellps=clrk66"))

#plot(nc.sids)
r<-raster(ncol=180, nrow=180)
extent(r)<-extent(nc.sids)
rp<-rasterize(nc.sids, r, 'BIR74')
plot(rp)
plot(nc.sids, add=TRUE)

#this will take time on larger files...
v <- extract(rp, nc.sids, weights=TRUE)
res<-sapply(v, function(x) if (!is.null(x)) {sum(apply(x, 1, prod),
na.rm=TRUE) / sum(x[,2])} else NA )
cor(res, nc.sids$BIR74)
#seems to be working ok.

2) use over function from sp package

overlay<-over(nc.sids, nc.sids)
#this should return the same indices of nc.sids which fall inside nc.sids -
basically should be falling within itself for each polygon, right? But this
is not what I get.

Any hints would be greatly appreciated.

Cheers,
Juta

	[[alternative HTML version deleted]]


From gbl1 at hi.is  Fri Apr 24 14:10:19 2015
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Fri, 24 Apr 2015 12:10:19 +0000
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <B078CDF40DFE4045AF172A8B4F68FC4858836EC560@DKRDSEXC016.vestas.net>
Message-ID: <6ab-553a3280-f-3144fe80@74209466>

Hi again, 

So, I use the plot() function. 
I read a shapefile, that I convert in GPS coordinates like this: 

readOGR(dsn="IS50V_STRANDLINA_24122014_ISN2004/IS50V_STRANDLINA_SHP", layer="is50v_strandlina_flakar_24122014")->IslHD
spTransform(IslHD,CRS(" +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->IslHD 

then plot : plot(IslHD) 

I tried several stuff for making a scale, results were either ugly or wrong? 
The function Scalebar make a cute scale but really absurd? 

Any idea? 

Best regards

Benjamin   
 
 
On Thursday, April 23, 2015 05:18 GMT, Frede Aakmann T?gersen <frtog at vestas.com> wrote: 
 
> Hi Benjamin
> 
> Yes, there are several ways to do that. But it depends on which kind of plotting function you used. Usually it is a setting of an argument of the plotting function.
> 
> I cannot help you more since I don't more than the information you provided in your email.
> 
> If you want more help from this list please provide a small example showing which functions you used with information on which package(s) they belong. Then you'll probably get more help.
> 
> The small example you can probably find in the example section on the help page for the plotting function.
> 
> Best Regards
> 
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
> 
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
> 
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender.

> 
> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Gilles Benjamin Leduc
> Sent: 23. april 2015 02:46
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] adding a scale
> 
> Hi all,
> 
> I am ploting map from shapefiles (curently read with readOGR from rgdal). 
> My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily) 
> 
> Thanks in advance 
> 
> Benjamin
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Fri Apr 24 14:32:28 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Apr 2015 14:32:28 +0200
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <6ab-553a3280-f-3144fe80@74209466>
References: <6ab-553a3280-f-3144fe80@74209466>
Message-ID: <alpine.LFD.2.11.1504241426180.21391@reclus.nhh.no>

On Fri, 24 Apr 2015, Gilles Benjamin Leduc wrote:

> Hi again, 
>
> So, I use the plot() function. 
> I read a shapefile, that I convert in GPS coordinates like this:

Please do provide a reproducible example. When you have a working 
reproducible example, you'll find that you have solved your problem. Note 
that right-assignment is confusing. Have you consulted the R spatial 
graphics gallery:

http://rspatial.r-forge.r-project.org/gallery/

Further note that metric scales are hard to get right on maps in degrees. 
Usually, the inclusion of annotated axes is a rational substitute for a 
scale bar, and by default the vertical axis is the same as the North 
arrow, which is only really needed when vertical is not North.

Roger

>
> readOGR(dsn="IS50V_STRANDLINA_24122014_ISN2004/IS50V_STRANDLINA_SHP", layer="is50v_strandlina_flakar_24122014")->IslHD
> spTransform(IslHD,CRS(" +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->IslHD 
>
> then plot : plot(IslHD) 
>
> I tried several stuff for making a scale, results were either ugly or wrong? 
> The function Scalebar make a cute scale but really absurd? 
>
> Any idea? 
>
> Best regards
>
> Benjamin 
> 
> 
> On Thursday, April 23, 2015 05:18 GMT, Frede Aakmann T?gersen <frtog at vestas.com> wrote: 
> 
>> Hi Benjamin
>> 
>> Yes, there are several ways to do that. But it depends on which kind of plotting function you used. Usually it is a setting of an argument of the plotting function.
>> 
>> I cannot help you more since I don't more than the information you provided in your email.
>> 
>> If you want more help from this list please provide a small example showing which functions you used with information on which package(s) they belong. Then you'll probably get more help.
>> 
>> The small example you can probably find in the example section on the help page for the plotting function.
>> 
>> Best Regards
>> 
>> Frede Aakmann T?gersen
>> Specialist, M.Sc., Ph.D.
>> Plant Performance & Modeling
>> 
>> Technology & Service Solutions
>> T +45 9730 5135
>> M +45 2547 6050
>> frtog at vestas.com
>> http://www.vestas.com
>> 
>> Company reg. name: Vestas Wind Systems A/S
>> This e-mail is subject to our e-mail disclaimer statement.
>> Please refer to www.vestas.com/legal/notice
>> If you have received this e-mail in error please contact the sender.
>
>> 
>> -----Original Message-----
>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Gilles Benjamin Leduc
>> Sent: 23. april 2015 02:46
>> To: r-sig-geo at r-project.org
>> Subject: [R-sig-Geo] adding a scale
>> 
>> Hi all,
>> 
>> I am ploting map from shapefiles (curently read with readOGR from rgdal). 
>> My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily) 
>> 
>> Thanks in advance 
>> 
>> Benjamin
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From gbl1 at hi.is  Fri Apr 24 14:49:27 2015
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Fri, 24 Apr 2015 12:49:27 +0000
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <alpine.LFD.2.11.1504241426180.21391@reclus.nhh.no>
Message-ID: <69c7-553a3c00-65-4f5b6500@100852682>

Here i a minimal exemple: 

#Get data
 data(state)
 states <- data.frame(state.x77, state.center)
 states <- states[states$x > -121,]
 coordinates(states) <- c("x", "y")
 proj4string(states) <- CRS("+proj=longlat +ellps=clrk66")
#Put in my system 
 spTransform(states,CRS(" +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->states
#plot it 
 plot(states,axes = TRUE) 
 
 How to add a scale on it? the function spplot do not work with my shapefile. 

Benjamin 


On Friday, April 24, 2015 12:32 GMT, Roger Bivand <Roger.Bivand at nhh.no> wrote: 
 
> On Fri, 24 Apr 2015, Gilles Benjamin Leduc wrote:
> 
> > Hi again, 
> >
> > So, I use the plot() function. 
> > I read a shapefile, that I convert in GPS coordinates like this:
> 
> Please do provide a reproducible example. When you have a working 
> reproducible example, you'll find that you have solved your problem. Note 
> that right-assignment is confusing. Have you consulted the R spatial 
> graphics gallery:
> 
> http://rspatial.r-forge.r-project.org/gallery/
> 
> Further note that metric scales are hard to get right on maps in degrees. 
> Usually, the inclusion of annotated axes is a rational substitute for a 
> scale bar, and by default the vertical axis is the same as the North 
> arrow, which is only really needed when vertical is not North.
> 
> Roger
> 
> >
> > readOGR(dsn="IS50V_STRANDLINA_24122014_ISN2004/IS50V_STRANDLINA_SHP", layer="is50v_strandlina_flakar_24122014")->IslHD
> > spTransform(IslHD,CRS(" +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->IslHD 
> >
> > then plot : plot(IslHD) 
> >
> > I tried several stuff for making a scale, results were either ugly or wrong? 
> > The function Scalebar make a cute scale but really absurd? 
> >
> > Any idea? 
> >
> > Best regards
> >
> > Benjamin 
> > 
> > 
> > On Thursday, April 23, 2015 05:18 GMT, Frede Aakmann T?gersen <frtog at vestas.com> wrote: 
> > 
> >> Hi Benjamin
> >> 
> >> Yes, there are several ways to do that. But it depends on which kind of plotting function you used. Usually it is a setting of an argument of the plotting function.
> >> 
> >> I cannot help you more since I don't more than the information you provided in your email.
> >> 
> >> If you want more help from this list please provide a small example showing which functions you used with information on which package(s) they belong. Then you'll probably get more help.
> >> 
> >> The small example you can probably find in the example section on the help page for the plotting function.
> >> 
> >> Best Regards
> >> 
> >> Frede Aakmann T?gersen
> >> Specialist, M.Sc., Ph.D.
> >> Plant Performance & Modeling
> >> 
> >> Technology & Service Solutions
> >> T +45 9730 5135
> >> M +45 2547 6050
> >> frtog at vestas.com
> >> http://www.vestas.com
> >> 
> >> Company reg. name: Vestas Wind Systems A/S
> >> This e-mail is subject to our e-mail disclaimer statement.
> >> Please refer to www.vestas.com/legal/notice
> >> If you have received this e-mail in error please contact the sender.
> >
> >> 
> >> -----Original Message-----
> >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Gilles Benjamin Leduc
> >> Sent: 23. april 2015 02:46
> >> To: r-sig-geo at r-project.org
> >> Subject: [R-sig-Geo] adding a scale
> >> 
> >> Hi all,
> >> 
> >> I am ploting map from shapefiles (curently read with readOGR from rgdal). 
> >> My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily) 
> >> 
> >> Thanks in advance 
> >> 
> >> Benjamin
> >> 
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Fri Apr 24 15:17:19 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Apr 2015 15:17:19 +0200
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <69c7-553a3c00-65-4f5b6500@100852682>
References: <69c7-553a3c00-65-4f5b6500@100852682>
Message-ID: <alpine.LFD.2.11.1504241458100.21391@reclus.nhh.no>

On Fri, 24 Apr 2015, Gilles Benjamin Leduc wrote:

> Here i a minimal exemple:
>
> #Get data
> data(state)
> states <- data.frame(state.x77, state.center)
> states <- states[states$x > -121,]
> coordinates(states) <- c("x", "y")
> proj4string(states) <- CRS("+proj=longlat +ellps=clrk66")
> #Put in my system
> spTransform(states,CRS(" +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->states
> #plot it
> plot(states,axes = TRUE)

library(sp)
library(rgdal)
data(state)
states <- data.frame(state.x77, state.center)
states <- states[states$x > -121,]
coordinates(states) <- c("x", "y")
proj4string(states) <- CRS("+proj=longlat +ellps=clrk66")
states <- spTransform(states, CRS(" +proj=longlat +datum=WGS84 +no_defs
  +ellps=WGS84 +towgs84=0,0,0 ")) # no-op at this scale
plot(states, axes = TRUE) # scale information provided

but it isn't either easy or logical to include a metric scale, as a 1cm 
line will represent (very) different lengths at the north and south of the 
figure. North is upwards, but if you want a North arrow too, you get it 
with this (clicking to place the symbol):

SpatialPolygonsRescale(layout.north.arrow(), offset=locator(1), scale=3, 
plot.grid=FALSE)

states <- spTransform(states, CRS("+init=epsg:2163"))
plot(states, axes=TRUE)
SpatialPolygonsRescale(layout.north.arrow(), offset=locator(1), 
scale=4e+5, plot.grid=FALSE)
SpatialPolygonsRescale(layout.scale.bar(), offset=locator(1), 
scale=500000, fill=c("transparent", "black"), plot.grid=FALSE)
text(locator(1), "0")
text(locator(1), "500 km")

is at least not stupid, even if not shiny graphically. They are, however, 
redundant as information, as all that is needed is in the axes.

Roger

>
> How to add a scale on it? the function spplot do not work with my shapefile.
>
> Benjamin
>
>
> On Friday, April 24, 2015 12:32 GMT, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Fri, 24 Apr 2015, Gilles Benjamin Leduc wrote:
>>
>>> Hi again,
>>>
>>> So, I use the plot() function.
>>> I read a shapefile, that I convert in GPS coordinates like this:
>>
>> Please do provide a reproducible example. When you have a working
>> reproducible example, you'll find that you have solved your problem. Note
>> that right-assignment is confusing. Have you consulted the R spatial
>> graphics gallery:
>>
>> http://rspatial.r-forge.r-project.org/gallery/
>>
>> Further note that metric scales are hard to get right on maps in degrees.
>> Usually, the inclusion of annotated axes is a rational substitute for a
>> scale bar, and by default the vertical axis is the same as the North
>> arrow, which is only really needed when vertical is not North.
>>
>> Roger
>>
>>>
>>> readOGR(dsn="IS50V_STRANDLINA_24122014_ISN2004/IS50V_STRANDLINA_SHP", layer="is50v_strandlina_flakar_24122014")->IslHD
>>> spTransform(IslHD,CRS(" +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->IslHD
>>>
>>> then plot : plot(IslHD)
>>>
>>> I tried several stuff for making a scale, results were either ugly or wrong?
>>> The function Scalebar make a cute scale but really absurd?
>>>
>>> Any idea?
>>>
>>> Best regards
>>>
>>> Benjamin
>>>
>>>
>>> On Thursday, April 23, 2015 05:18 GMT, Frede Aakmann T?gersen <frtog at vestas.com> wrote:
>>>
>>>> Hi Benjamin
>>>>
>>>> Yes, there are several ways to do that. But it depends on which kind of plotting function you used. Usually it is a setting of an argument of the plotting function.
>>>>
>>>> I cannot help you more since I don't more than the information you provided in your email.
>>>>
>>>> If you want more help from this list please provide a small example showing which functions you used with information on which package(s) they belong. Then you'll probably get more help.
>>>>
>>>> The small example you can probably find in the example section on the help page for the plotting function.
>>>>
>>>> Best Regards
>>>>
>>>> Frede Aakmann T?gersen
>>>> Specialist, M.Sc., Ph.D.
>>>> Plant Performance & Modeling
>>>>
>>>> Technology & Service Solutions
>>>> T +45 9730 5135
>>>> M +45 2547 6050
>>>> frtog at vestas.com
>>>> http://www.vestas.com
>>>>
>>>> Company reg. name: Vestas Wind Systems A/S
>>>> This e-mail is subject to our e-mail disclaimer statement.
>>>> Please refer to www.vestas.com/legal/notice
>>>> If you have received this e-mail in error please contact the sender.
>>>
>>>>
>>>> -----Original Message-----
>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Gilles Benjamin Leduc
>>>> Sent: 23. april 2015 02:46
>>>> To: r-sig-geo at r-project.org
>>>> Subject: [R-sig-Geo] adding a scale
>>>>
>>>> Hi all,
>>>>
>>>> I am ploting map from shapefiles (curently read with readOGR from rgdal).
>>>> My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily)
>>>>
>>>> Thanks in advance
>>>>
>>>> Benjamin
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From gbl1 at hi.is  Fri Apr 24 16:34:41 2015
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Fri, 24 Apr 2015 14:34:41 +0000
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <alpine.LFD.2.11.1504241458100.21391@reclus.nhh.no>
Message-ID: <2495-553a5480-c7-55c76f00@15222988>

 
 Actually, my PhD Supervisor asked me to add a scale? and using a GPS system is requierd for technical reasons. If I use such a code, I get http://www.legtux.org/?page=upload&id=565677793, which isn't a satisfacting result. I shall do whatever my PhD supervisor ask? For it is written in Bible: "Thou shall honor, obey and respect your God, your parent and your PhD supervisor" (sotty for the joke, it's friday, start to be exhausted) 

Benjamin  
 
On Friday, April 24, 2015 13:17 GMT, Roger Bivand <Roger.Bivand at nhh.no> wrote: 
 
> On Fri, 24 Apr 2015, Gilles Benjamin Leduc wrote:
> 
> > Here i a minimal exemple:
> >
> > #Get data
> > data(state)
> > states <- data.frame(state.x77, state.center)
> > states <- states[states$x > -121,]
> > coordinates(states) <- c("x", "y")
> > proj4string(states) <- CRS("+proj=longlat +ellps=clrk66")
> > #Put in my system
> > spTransform(states,CRS(" +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->states
> > #plot it
> > plot(states,axes = TRUE)
> 
> library(sp)
> library(rgdal)
> data(state)
> states <- data.frame(state.x77, state.center)
> states <- states[states$x > -121,]
> coordinates(states) <- c("x", "y")
> proj4string(states) <- CRS("+proj=longlat +ellps=clrk66")
> states <- spTransform(states, CRS(" +proj=longlat +datum=WGS84 +no_defs
>   +ellps=WGS84 +towgs84=0,0,0 ")) # no-op at this scale
> plot(states, axes = TRUE) # scale information provided
> 
> but it isn't either easy or logical to include a metric scale, as a 1cm 
> line will represent (very) different lengths at the north and south of the 
> figure. North is upwards, but if you want a North arrow too, you get it 
> with this (clicking to place the symbol):
> 
> SpatialPolygonsRescale(layout.north.arrow(), offset=locator(1), scale=3, 
> plot.grid=FALSE)
> 
> states <- spTransform(states, CRS("+init=epsg:2163"))
> plot(states, axes=TRUE)
> SpatialPolygonsRescale(layout.north.arrow(), offset=locator(1), 
> scale=4e+5, plot.grid=FALSE)
> SpatialPolygonsRescale(layout.scale.bar(), offset=locator(1), 
> scale=500000, fill=c("transparent", "black"), plot.grid=FALSE)

> text(locator(1), "0")
> text(locator(1), "500 km")
> 
> is at least not stupid, even if not shiny graphically. They are, however, 
> redundant as information, as all that is needed is in the axes.
> 
> Roger
> 
> >
> > How to add a scale on it? the function spplot do not work with my shapefile.
> >
> > Benjamin
> >
> >
> > On Friday, April 24, 2015 12:32 GMT, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> >> On Fri, 24 Apr 2015, Gilles Benjamin Leduc wrote:
> >>
> >>> Hi again,
> >>>
> >>> So, I use the plot() function.
> >>> I read a shapefile, that I convert in GPS coordinates like this:

> >>
> >> Please do provide a reproducible example. When you have a working

> >> reproducible example, you'll find that you have solved your problem. Note
> >> that right-assignment is confusing. Have you consulted the R spatial
> >> graphics gallery:
> >>
> >> http://rspatial.r-forge.r-project.org/gallery/
> >>
> >> Further note that metric scales are hard to get right on maps in degrees.
> >> Usually, the inclusion of annotated axes is a rational substitute for a
> >> scale bar, and by default the vertical axis is the same as the North
> >> arrow, which is only really needed when vertical is not North.
> >>
> >> Roger
> >>
> >>>
> >>> readOGR(dsn="IS50V_STRANDLINA_24122014_ISN2004/IS50V_STRANDLINA_SHP", layer="is50v_strandlina_flakar_24122014")->IslHD
> >>> spTransform(IslHD,CRS(" +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->IslHD
> >>>
> >>> then plot : plot(IslHD)
> >>>
> >>> I tried several stuff for making a scale, results were either ugly or wrong?
> >>> The function Scalebar make a cute scale but really absurd?
> >>>
> >>> Any idea?
> >>>
> >>> Best regards
> >>>
> >>> Benjamin
> >>>
> >>>
> >>> On Thursday, April 23, 2015 05:18 GMT, Frede Aakmann T?gersen <frtog at vestas.com> wrote:
> >>>
> >>>> Hi Benjamin
> >>>>
> >>>> Yes, there are several ways to do that. But it depends on which kind of plotting function you used. Usually it is a setting of an argument of the plotting function.
> >>>>
> >>>> I cannot help you more since I don't more than the information you provided in your email.
> >>>>
> >>>> If you want more help from this list please provide a small example showing which functions you used with information on which package(s) they belong. Then you'll probably get more help.
> >>>>
> >>>> The small example you can probably find in the example section on the help page for the plotting function.
> >>>>
> >>>> Best Regards
> >>>>
> >>>> Frede Aakmann T?gersen
> >>>> Specialist, M.Sc., Ph.D.
> >>>> Plant Performance & Modeling
> >>>>
> >>>> Technology & Service Solutions
> >>>> T +45 9730 5135
> >>>> M +45 2547 6050
> >>>> frtog at vestas.com
> >>>> http://www.vestas.com
> >>>>
> >>>> Company reg. name: Vestas Wind Systems A/S
> >>>> This e-mail is subject to our e-mail disclaimer statement.
> >>>> Please refer to www.vestas.com/legal/notice
> >>>> If you have received this e-mail in error please contact the sender.
> >>>
> >>>>
> >>>> -----Original Message-----
> >>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Gilles Benjamin Leduc
> >>>> Sent: 23. april 2015 02:46
> >>>> To: r-sig-geo at r-project.org
> >>>> Subject: [R-sig-Geo] adding a scale
> >>>>
> >>>> Hi all,
> >>>>
> >>>> I am ploting map from shapefiles (curently read with readOGR from rgdal).
> >>>> My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily)
> >>>>
> >>>> Thanks in advance
> >>>>
> >>>> Benjamin
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at r-project.org
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >> --
> >> Roger Bivand
> >> Department of Economics, Norwegian School of Economics,
> >> Helleveien 30, N-5045 Bergen, Norway.
> >> voice: +47 55 95 93 55; fax +47 55 95 91 00
> >> e-mail: Roger.Bivand at nhh.no
> >
> >
> >
> >
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no


From amit.boshale at yahoo.com  Fri Apr 24 23:24:05 2015
From: amit.boshale at yahoo.com (Amit Boshale)
Date: Fri, 24 Apr 2015 21:24:05 +0000 (UTC)
Subject: [R-sig-Geo] Can plotKML produces <region> kmls to plot raster stack
 for large areas?
Message-ID: <1828175284.5688465.1429910645096.JavaMail.yahoo@mail.yahoo.com>

Hi All, 

I want to display MODIS rasterStack (300 images, area 1200 km x 1200 km)on Google Earth using plotKML, can I do that?
The code provided in RasterBrickTimeSeries in the tutorial worked well for small areas, but I don't know what to do for large areas
Best,Amit
Tuturial code (working on my data)
> require(raster)
> require (plotKML)
> data(LST)
> gridded(LST) <- ~lon+lat
> proj4string(LST) <- CRS("+proj=longlat +datum=WGS84")
> dates <- sapply(strsplit(names(LST), "LST"), function(x){x[[2]]})
> datesf <- format(as.Date(dates, "%Y_%m_%d"), "%Y-%m-%dT%H:%M:%SZ")
> # begin / end dates +/- 4 days:
> TimeSpan.begin = as.POSIXct(unclass(as.POSIXct(datesf))-4*24*60*60, origin="1970-01-01")
> TimeSpan.end = as.POSIXct(unclass(as.POSIXct(datesf))+4*24*60*60, origin="1970-01-01")
> # pick few climatic stations:
> pnts <- HRtemp08[which(HRtemp08$NAME=="Pazin")[1],]
> pnts <- rbind(pnts, HRtemp08[which(HRtemp08$NAME=="Crni Lug - NP Risnjak")[1],])
> pnts <- rbind(pnts, HRtemp08[which(HRtemp08$NAME=="Cres")[1],])
> coordinates(pnts) <- ~Lon + Lat
> proj4string(pnts) <- CRS("+proj=longlat +datum=WGS84")
> # get the dates from the file names:
> LST_ll <- brick(LST[1:5])
> LST_ll at title = "Time series of MODIS Land Surface Temperature (8-day mosaics) images"
> LST.ts <- new("RasterBrickTimeSeries", variable = "LST", sampled = pnts,
+???? rasters = LST_ll, TimeSpan.begin = TimeSpan.begin[1:5], TimeSpan.end = TimeSpan.end[1:5])
> data(SAGA_pal)
> # plot MODIS images in Google Earth:
> plotKML(LST.ts, colour_scale=SAGA_pal[[1]])





	[[alternative HTML version deleted]]


From drflying at sina.com  Fri Apr 24 23:25:10 2015
From: drflying at sina.com (drflying at sina.com)
Date: Sat, 25 Apr 2015 05:25:10 +0800 (CST)
Subject: [R-sig-Geo] =?utf-8?b?6Ieq5Yqo5Zue5aSN77yaIENhbiBwbG90S01MIHBy?=
	=?utf-8?q?oduces_=3Cregion=3E_kmls_to_plot_raster_stack_for_large_?=
	=?utf-8?q?areas=3F?=
Message-ID: <20150424212510.636C265032A@mda05.fmail.tg.sinanode.com>

?????????~

From gosz at gmx.de  Sat Apr 25 12:36:24 2015
From: gosz at gmx.de (Guido Schulz)
Date: Sat, 25 Apr 2015 12:36:24 +0200
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <6ab-553a3280-f-3144fe80@74209466>
References: <6ab-553a3280-f-3144fe80@74209466>
Message-ID: <553B6E28.6080807@gmx.de>

You may want to check out this paper "Auxiliary Cartographic Functions
in R: North Arrow, Scale Bar, and Label with a Leader Arrow"
(http://www.jstatsoft.org/v19/c01/paper).

It provides functions to add arrow and scale bar for plot.


Am 24.04.2015 um 14:10 schrieb Gilles Benjamin Leduc:
> Hi again, 
> 
> So, I use the plot() function. 
> I read a shapefile, that I convert in GPS coordinates like this: 
> 
> readOGR(dsn=S50V_STRANDLINA_24122014_ISN2004/IS50V_STRANDLINA_SHP", layer="is50v_strandlina_flakar_24122014")->IslHD
> spTransform(IslHD,CRS(" +proj=nglat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->IslHD 
> 
> then plot : plot(IslHD) 
> 
> I tried several stuff for making a scale, results were either ugly or wrong? 
> The function Scalebar make a cute scale but really absurd? 
> 
> Any idea? 
> 
> Best regards
> 
> Benjamin   
>  
>  
> On Thursday, April 23, 2015 05:18 GMT, Frede Aakmann T?gersen <frtog at vestas.com> wrote: 
>  
>> Hi Benjamin
>>
>> Yes, there are several ways to do that. But it depends on which kind of plotting function you used. Usually it is a setting of an argument of the plotting function.
>>
>> I cannot help you more since I don't more than the information you provided in your email.
>>
>> If you want more help from this list please provide a small example showing which functions you used with information on which package(s) they belong. Then you'll probably get more help.
>>
>> The small example you can probably find in the example section on the help page for the plotting function.
>>
>> Best Regards
>>
>> Frede Aakmann T?gersen
>> Specialist, M.Sc., Ph.D.
>> Plant Performance & Modeling
>>
>> Technology & Service Solutions
>> T +45 9730 5135
>> M +45 2547 6050
>> frtog at vestas.com
>> http://www.vestas.com
>>
>> Company reg. name: Vestas Wind Systems A/S
>> This e-mail is subject to our e-mail disclaimer statement.
>> Please refer to www.vestas.com/legal/notice
>> If you have received this e-mail in error please contact the sender.
> 
>>
>> -----Original Message-----
>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Gilles Benjamin Leduc
>> Sent: 23. april 2015 02:46
>> To: r-sig-geo at r-project.org
>> Subject: [R-sig-Geo] adding a scale
>>
>> Hi all,
>>
>> I am ploting map from shapefiles (curently read with readOGR from rgdal). 
>> My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily) 
>>
>> Thanks in advance 
>>
>> Benjamin
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
>


From arnold_salvacion at yahoo.com  Sat Apr 25 18:10:30 2015
From: arnold_salvacion at yahoo.com (Arnold Salvacion)
Date: Sat, 25 Apr 2015 16:10:30 +0000 (UTC)
Subject: [R-sig-Geo] Count Pixel with Specific of Values Appearing
 Sequentially in Rasterstack
Message-ID: <1708199815.2649533.1429978230870.JavaMail.yahoo@mail.yahoo.com>

Dear Colleagues,
Any idea on how to count the number of times a particular number (e.g. 1) appears consecutively within each pixel of a raster stack/brick? I found a similar question online (http://grokbase.com/t/r/r-sig-geo/1459p0s978/error-when-attempting-to-use-rle-in-calc-in-raster-package) but was not able to view/get any answer to solve such problem.
Thanks in advance.
Arnold



	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Sun Apr 26 04:44:53 2015
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 25 Apr 2015 19:44:53 -0700
Subject: [R-sig-Geo] Count Pixel with Specific of Values Appearing
 Sequentially in Rasterstack
In-Reply-To: <1708199815.2649533.1429978230870.JavaMail.yahoo@mail.yahoo.com>
References: <1708199815.2649533.1429978230870.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CANtt_hzOvZWwSCbLFPg2E4iGsE_LOOsxJtO_sQU=A0c5GzGFrg@mail.gmail.com>

Arnold,

In cases like this you can make a function that computes this for a
vector, test that function, including for a vector of NA values, and,
if it works, use calc.

# counting runs of 255
run <- function(x) {
  x[x != 255] <- NA
  r <- rle(x)
  w <- which(!is.na(r$values))
  ifelse(length(w) > 0, max(r$lengths), 0)
}

run(rep(NA, 5))
run(c(255, rep(NA, 5), 255, 255))
run(rep(255, 5))

# looking good, let's use it

b <- brick(system.file("external/rlogo.grd", package="raster"))
x <- calc(b, run)
plot(x)


Robert

On Sat, Apr 25, 2015 at 9:10 AM, Arnold Salvacion via R-sig-Geo
<r-sig-geo at r-project.org> wrote:
> Dear Colleagues,
> Any idea on how to count the number of times a particular number (e.g. 1) appears consecutively within each pixel of a raster stack/brick? I found a similar question online (http://grokbase.com/t/r/r-sig-geo/1459p0s978/error-when-attempting-to-use-rle-in-calc-in-raster-package) but was not able to view/get any answer to solve such problem.
> Thanks in advance.
> Arnold
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From arnold_salvacion at yahoo.com  Sun Apr 26 07:35:43 2015
From: arnold_salvacion at yahoo.com (Arnold Salvacion)
Date: Sun, 26 Apr 2015 05:35:43 +0000 (UTC)
Subject: [R-sig-Geo] Count Pixel with Specific of Values Appearing
 Sequentially in Rasterstack
In-Reply-To: <CANtt_hzOvZWwSCbLFPg2E4iGsE_LOOsxJtO_sQU=A0c5GzGFrg@mail.gmail.com>
References: <CANtt_hzOvZWwSCbLFPg2E4iGsE_LOOsxJtO_sQU=A0c5GzGFrg@mail.gmail.com>
Message-ID: <974295926.2736842.1430026543213.JavaMail.yahoo@mail.yahoo.com>

Hi Doc Robert,
Tried your code and works like magic!
Best regards,
Arnold 


     On Sunday, April 26, 2015 10:44 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
   

 Arnold,

In cases like this you can make a function that computes this for a
vector, test that function, including for a vector of NA values, and,
if it works, use calc.

# counting runs of 255
run <- function(x) {
? x[x != 255] <- NA
? r <- rle(x)
? w <- which(!is.na(r$values))
? ifelse(length(w) > 0, max(r$lengths), 0)
}

run(rep(NA, 5))
run(c(255, rep(NA, 5), 255, 255))
run(rep(255, 5))

# looking good, let's use it

b <- brick(system.file("external/rlogo.grd", package="raster"))
x <- calc(b, run)
plot(x)


Robert

On Sat, Apr 25, 2015 at 9:10 AM, Arnold Salvacion via R-sig-Geo
<r-sig-geo at r-project.org> wrote:
> Dear Colleagues,
> Any idea on how to count the number of times a particular number (e.g. 1) appears consecutively within each pixel of a raster stack/brick? I found a similar question online (http://grokbase.com/t/r/r-sig-geo/1459p0s978/error-when-attempting-to-use-rle-in-calc-in-raster-package) but was not able to view/get any answer to solve such problem.
> Thanks in advance.
> Arnold
>
>
>
>? ? ? ? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

  
	[[alternative HTML version deleted]]


From drflying at sina.com  Sun Apr 26 07:36:24 2015
From: drflying at sina.com (drflying at sina.com)
Date: Sun, 26 Apr 2015 13:36:24 +0800 (CST)
Subject: [R-sig-Geo] =?utf-8?b?6Ieq5Yqo5Zue5aSN77yaUmU6ICBDb3VudCBQaXhl?=
	=?utf-8?q?l_with_Specific_of_Values_Appearing_Sequentially_in_Rast?=
	=?utf-8?q?erstack?=
Message-ID: <20150426053624.CA31765032A@mda05.fmail.tg.sinanode.com>

?????????~

From nickmatzke.ncse at gmail.com  Mon Apr 27 00:37:38 2015
From: nickmatzke.ncse at gmail.com (Nick Matzke)
Date: Sun, 26 Apr 2015 18:37:38 -0400
Subject: [R-sig-Geo] Plot phylogeny with "increasing" or "decreasing" node
	ages?
Message-ID: <CAJdu7BB_uLj+N2edBq8qaCnF=wbTeFhLcSawNw_kMqvTC0Wr8w@mail.gmail.com>

Hi all,

In FigTree, there is an option (Left menu->Trees->Order nodes->increasing,
or decreasing) to plot trees and order them such that the higher nodes/tips
in the tree plot at the top or bottom of the plot.

Does anything like this exist for plotting trees in R?  Or do I have to
hunt-n-peck and manually rotate nodes 1-by-1 until it looks right?

(yes, I could save the tree out from FigTree and use that, but I want to
automate this plotting function without a FigTree step)

Cheers!
Nick

	[[alternative HTML version deleted]]


From gbl1 at hi.is  Mon Apr 27 16:59:23 2015
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Mon, 27 Apr 2015 14:59:23 +0000
Subject: [R-sig-Geo] adding a scale
In-Reply-To: <553B6E28.6080807@gmx.de>
Message-ID: <48fc-553e4f00-41-7f986f00@133731765>

 
 Not to bad hint :p

So From this one, I modified the function to get it work correctly: 

#############################################################################################################################################################################
####                                                            		         Scale				                                                                     ####
#############################################################################################################################################################################

scalebar <- function(loc,length,unit="km" ,degrees = TRUE,cex=par("cex"), ...) { 
	if(missing(loc)) stop("loc is missing") 
	if(missing(length)) stop("length is missing") 
	z <- c(0,length/c(4,2,4/3,1),length*1.1)+loc[1] 
	if(degrees == TRUE) length<-180*(acos((cos(length/6371)-sin(loc[2]*pi/180)*sin(loc[2]*pi/180))/(cos(loc[2]*pi/180)*cos(loc[2]*pi/180))))/pi
	x <- c(0,length/c(4,2,4/3,1),length*1.1)+loc[1] 
	y <- c(0,length/(10*3:1))+loc[2] 
	cols <- rep(c("black","white"),2) 
	for (i in 1:4) rect(x[i],y[1],x[i+1],y[2],col=cols[i])
	 for (i in 1:5) segments(x[i],y[2],x[i],y[3]) 
	 labels <- z[c(1,3)]-loc[1]
labels <- append(labels,paste(z[5]-loc[1],unit)) 
text(x[c(1,3,5)],y[4],labels=labels,cex,pos=3,offset=0) }


and pushed it in my package https://github.com/giby/Linarius if someone wanna try. I could do some improve to support other units, I'll do that latter on.  

Thanks a lot for help 

Benjamin 
 
On Saturday, April 25, 2015 10:36 GMT, Guido Schulz <gosz at gmx.de> wrote: 
 
> You may want to check out this paper "Auxiliary Cartographic Functions
> in R: North Arrow, Scale Bar, and Label with a Leader Arrow"
> (http://www.jstatsoft.org/v19/c01/paper).
> 
> It provides functions to add arrow and scale bar for plot.
> 
> 
> Am 24.04.2015 um 14:10 schrieb Gilles Benjamin Leduc:
> > Hi again, > > So, I use the plot() function. > I read a shapefile, that I convert in GPS coordinates like this: > > readOGR(dsn=S50V_STRANDLINA_24122014_ISN2004/IS50V_STRANDLINA_SHP", layer="is50v_strandlina_flakar_24122014")->IslHD
> > spTransform(IslHD,CRS(" +proj=nglat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "))->IslHD > > then plot : plot(IslHD) > > I tried several stuff for making a scale, results were either ugly or wrong? > The function Scalebar make a cute scale but really absurd? > > Any idea? > > Best regards
> > > Benjamin   >  >  > On Thursday, April 23, 2015 05:18 GMT, Frede Aakmann T?gersen <frtog at vestas.com> wrote: >  >> Hi Benjamin
> >>
> >> Yes, there are several ways to do that. But it depends on which kind of plotting function you used. Usually it is a setting of an argument of the plotting function.
> >>
> >> I cannot help you more since I don't more than the information you provided in your email.
> >>
> >> If you want more help from this list please provide a small example showing which functions you used with information on which package(s) they belong. Then you'll probably get more help.
> >>
> >> The small example you can probably find in the example section on the help page for the plotting function.
> >>
> >> Best Regards
> >>
> >> Frede Aakmann T?gersen
> >> Specialist, M.Sc., Ph.D.
> >> Plant Performance & Modeling
> >>
> >> Technology & Service Solutions
> >> T +45 9730 5135
> >> M +45 2547 6050
> >> frtog at vestas.com
> >> http://www.vestas.com
> >>
> >> Company reg. name: Vestas Wind Systems A/S
> >> This e-mail is subject to our e-mail disclaimer statement.
> >> Please refer to www.vestas.com/legal/notice
> >> If you have received this e-mail in error please contact the sender.
> > >>
> >> -----Original Message-----
> >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Gilles Benjamin Leduc
> >> Sent: 23. april 2015 02:46
> >> To: r-sig-geo at r-project.org
> >> Subject: [R-sig-Geo] adding a scale
> >>
> >> Hi all,
> >>
> >> I am ploting map from shapefiles (curently read with readOGR from rgdal). >> My PhD supervisor asked me to add a scale? Before going in crazy computation and the arrow function I wonder? Is there a function that can do it automatically (or easily) >>
> >> Thanks in advance >>
> >> Benjamin
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From sharx at ucla.edu  Tue Apr 28 02:31:11 2015
From: sharx at ucla.edu (sharx)
Date: Mon, 27 Apr 2015 17:31:11 -0700 (MST)
Subject: [R-sig-Geo] Using gdistance to compute a least cost path which
 avoids certain cells entirely, no matter the distance
Message-ID: <1430181071767-7588118.post@n2.nabble.com>

Hi all, 

I have some data of GPS locations of an animal and want to construct paths
between those coordinates. The goal is to obtain animal movement paths that
the cross the fewest roads possible by using shortestPath(), and assigning
resistance values to a raster of the animal's habitat. Ideally this means
that the path would show animals going out of their way to avoid roads, even
going ten times the distance they would have by crossing roads. I have
experimented with different resistance values with limited success.

Below is an example. Blue points are coordinates. Purple lines are roads.
Red line is the least cost path calculated, which goes through several roads
unnecessarily. Green line is the path I would like to generate.
<http://r-sig-geo.2731867.n2.nabble.com/file/n7588118/leastcost-example.png> 

With my current results, I have achieved some avoidance of roads, but cannot
construct a path that goes too much extraneous distance in order to avoid
roads. When setting the non-road cell resistance to 0, however, I got an
extraordinarily complicated set of paths, perhaps due to values of infinity
when calculating the transition matrix.

*Could anyone could give me an idea as to how to choose these resistance
values, or how shortestPath() calculates with regards to the transition
matrix values and the actual distance in meters? *

I have created a raster called cost from a shapefile of roads in projection
NAD83, and using extract(), I have assigned much higher resistance values to
each cell of the raster cost if the cell contains a road. Here the cost of
non-road cells is 2^-20 and the cost of road cells is 10^100.

Here is my code:

library(raster)
cost <-rasterize(rd, r.30m, field=2^-20) 
numbers <- extract(cost, rd, cellnumbers=TRUE, buffer=30)
cellnum <- unlist(numbers) 
cost[cellnum] <- 10^100

library(gdistance)
## Produce transition matrices, and correct because 8 directions
trCost <- transition(1/cost, mean, directions=8)
trCost <- geoCorrection(trCost, type="c")

# Iterate between a list of coordinate pairs, use shortestPath() to get a
path for each pair
#Each element of the list coords contains two points that straddle a road.
# For each pair of points, calculate the least cost path between them.
getpath <- function(coords) {
  c = unlist(coords)
  pt1 = c(c[1], c[3])
  pt2 = c(c[2], c[4])
  if (sqrt((pt1[1]-pt2[1])^2 + (pt1[2]-pt2[2])^2) <= sqrt(2*30^2)) {
    return(SpatialLines(list(Lines(Line(rbind(pt1,pt2)), ID="1"))))
  } # if the points are in the same raster cell, return a straight line
between them (a least cost path will not work)
  return(shortestPath(trCost, pt1, pt2, output="SpatialLines"))
}

paths <- numeric(0)
for (i in 1:length(coords[[1]])){
  c=lapply(coords, "[[", i)
  paths <- c(paths, getpath(c))
}

#Code end

Thank you for your help in advance!

Best,
Sharon



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Using-gdistance-to-compute-a-least-cost-path-which-avoids-certain-cells-entirely-no-matter-the-distae-tp7588118.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Andy.Bunn at wwu.edu  Tue Apr 28 07:09:35 2015
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Tue, 28 Apr 2015 05:09:35 +0000
Subject: [R-sig-Geo] A simple correlogram using sp.correlogram with
	data(meuse)
Message-ID: <D164608C.393F8%andy.bunn@wwu.edu>

Hi all, This seems trivial easy but being a bear of very little brain...

I'm looking to build a correlogram using Moran's I and the function
sp.correlogram() with data(meuse) as a SpatialPointsDataFrame. I've done
so with the ncf library using correlog() but getting the equivalent out of
library sp is eluding me. Can somebody help me out?

-Andy

require(sp)
require(ncf)
data(meuse)
coordinates(meuse) <- ~x+y
proj4string(meuse) <- CRS("+init=epsg:28992")
ncf.cor <- correlog(x=coordinates(meuse)[,1], y=coordinates(meuse)[,2],
z=meuse at data$zinc, increment=200, resamp=100)


From Roger.Bivand at nhh.no  Tue Apr 28 09:05:59 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 28 Apr 2015 09:05:59 +0200
Subject: [R-sig-Geo] A simple correlogram using sp.correlogram with
 data(meuse)
In-Reply-To: <D164608C.393F8%andy.bunn@wwu.edu>
References: <D164608C.393F8%andy.bunn@wwu.edu>
Message-ID: <alpine.LFD.2.11.1504280838400.19394@reclus.nhh.no>

On Tue, 28 Apr 2015, Andy Bunn wrote:

> Hi all, This seems trivial easy but being a bear of very little brain...
>
> I'm looking to build a correlogram using Moran's I and the function
> sp.correlogram() with data(meuse) as a SpatialPointsDataFrame. I've done
> so with the ncf library using correlog() but getting the equivalent out of
> library sp is eluding me. Can somebody help me out?

require(ncf)
ncf.cor <- ncf::correlog(x=coordinates(meuse)[,1],
  y=coordinates(meuse)[,2], z=meuse$zinc, increment=200, resamp=100)

ncf::correlog() chooses bins based on increment. Alternatively, 
pgirmess::correlog() uses by default an optimal number of bins, but can 
use a bin count:

library(pgirmess)
pgir.cor <- pgirmess::correlog(coordinates(meuse), z=meuse$zinc, "Moran",
   nbclass=23)
plot(pgir.cor[,1], pgir.cor[,2], type="b")
cbind(pgir.cor[,1], ncf.cor$mean.of.class)
cbind(pgir.cor[,4], ncf.cor$n)

The differences come from ncf::correlog() constructing the spatial weights 
itself, while pgirmess::correlog() uses spdep::dnearneigh() to construct 
them for the distance bins and then spdep::nb2listw() and 
spdep::moran.test() internally in a loop, once for each bin.

spdep::sp.correlogram() follows the original Cliff & Ord understanding of 
a spatial correlogram - like time series lags - of order 1, order 2, etc. 
The input spatial weights define the weighted graph, so order 2 neighbours 
are neighbours of order 1 neighbours by stepping out on the graph. 
pgirmess::correlog() was written to use distance rather than graph edge 
count distance:

library(spdep)
nb200 <- dnearneigh(meuse, 0, 200)
spdep.cor <- spdep::sp.correlogram(nb200, meuse$zinc, order=23,
  method="I", zero.policy=TRUE)
plot(spdep.cor)

To get the implied mean distances for lags of nb200:

nb200_23 <- nblag(nb200, 23)
mdbins <- sapply(nb200_23, function(x) mean(unlist(nbdists(x, meuse))))
mdbins

There are two different understandings of this spatial correlogram, the 
C&O one based on time series and counting distance in graph edges, and 
another using distance bands, also found in globalG.test, etc.

Hope this clarifies,

Roger


>
> -Andy
>
> require(sp)
> require(ncf)
> data(meuse)
> coordinates(meuse) <- ~x+y
> proj4string(meuse) <- CRS("+init=epsg:28992")
> ncf.cor <- correlog(x=coordinates(meuse)[,1], y=coordinates(meuse)[,2],
> z=meuse at data$zinc, increment=200, resamp=100)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Tue Apr 28 14:47:58 2015
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 28 Apr 2015 14:47:58 +0200
Subject: [R-sig-Geo] Spatial overlay vs. extract and aggregation methods
In-Reply-To: <CAHMizkNV7mDN0psgLnC8A3VpTRqNhHjWwkXOuaRM6cmO+8jj1Q@mail.gmail.com>
References: <CAHMizkNV7mDN0psgLnC8A3VpTRqNhHjWwkXOuaRM6cmO+8jj1Q@mail.gmail.com>
Message-ID: <553F817E.7070606@uni-muenster.de>



On 04/23/2015 07:04 PM, Juta Kawalerowicz wrote:
> Hi,
> 
> I have a spatial polygon data frame (spdf1) and try to aggregate
> information from it over polygons in a larger spatial polygon data
> frame(spdf2). I wanted to run some simple test to see that my code is sound
> (on nc.sids from maptools), but run into a problem which I don't
> understand. As far as I can see, there are 2 ways to do this:
> 
> 1) rasterise the smaller spdf1, extract and calculate over larger spdf2
> 
> library(maptools)
> library(raster)
> nc.sids <- readShapeSpatial(system.file("shapes/sids.shp",
> package="maptools")[1],
>                             IDvar="FIPSNO", proj4string=CRS("+proj=longlat
> +ellps=clrk66"))
> 
> #plot(nc.sids)
> r<-raster(ncol=180, nrow=180)
> extent(r)<-extent(nc.sids)
> rp<-rasterize(nc.sids, r, 'BIR74')
> plot(rp)
> plot(nc.sids, add=TRUE)
> 
> #this will take time on larger files...
> v <- extract(rp, nc.sids, weights=TRUE)
> res<-sapply(v, function(x) if (!is.null(x)) {sum(apply(x, 1, prod),
> na.rm=TRUE) / sum(x[,2])} else NA )
> cor(res, nc.sids$BIR74)
> #seems to be working ok.
> 
> 2) use over function from sp package
> 
> overlay<-over(nc.sids, nc.sids)
> #this should return the same indices of nc.sids which fall inside nc.sids -
> basically should be falling within itself for each polygon, right? But this
> is not what I get.

no, it uses gIntersects and picks the first intersecting polygon, which
might well be a neighbour. (Actually, over(nc.sids, geometry(nc.sids))
should return indexes and this call the corresponding attribute entries;
this is a bug, now fixed in rgeos on r-forge).

https://stat.ethz.ch/pipermail/r-sig-geo/2015-April/022636.html

has some pointers to the weighted aggregation problem of non-matching
polygons; sp 1.1-0 has the rgeos implementation mentioned
there, as option with sp::aggregate; see the last example of

example(aggregate).

> 
> Any hints would be greatly appreciated.
> 
> Cheers,
> Juta
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi),  University of M?nster,
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150428/b6880801/attachment.bin>

From mtreglia at gmail.com  Tue Apr 28 16:51:39 2015
From: mtreglia at gmail.com (Michael Treglia)
Date: Tue, 28 Apr 2015 09:51:39 -0500
Subject: [R-sig-Geo] A simple correlogram using sp.correlogram with
	data(meuse)
In-Reply-To: <alpine.LFD.2.11.1504280838400.19394@reclus.nhh.no>
References: <D164608C.393F8%andy.bunn@wwu.edu>
	<alpine.LFD.2.11.1504280838400.19394@reclus.nhh.no>
Message-ID: <CAPKp32v+XBJWs+_RAseTs3zsnnAefi-AtjBHWbWfy3fgioK=jg@mail.gmail.com>

Hi all,

This is a bit a tangential to the question, but related to
pgirmess::correlog used in this thread, so I thought it appropriate to
follow-up here [if not, apologies - I can start a new thread if that's
preferred].

In recent exploration with the pgirmess::correlog, I was unable to change
the alternative hypothesis being tested. Since pgirmess::correlog uses
spdep::moran.test, the alternative hypothesis being tested is by default
"greater" (confirmed in the documentation). The help for the function
indicates pgirmess::correlog should also be able to take arguments from
'moran.test' within it. Thus, users should be able to use the 'alternative'
argument to change the alternative hypothesis being tested.  When trying to
use "alternative='less'" (or 'two.sided'), an error is returned:

Error in try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]], style = "W")),
:
  unused argument (alternative = "less")

Reproducible Code (based on the example from help for pgirmess::correlog):

library(spdep)
library(pgirmess)
data(oldcol)
attach(COL.OLD)
coords<-cbind(X,Y)
res<-correlog(coords,CRIME, method="Moran", nbclass=NULL,alternative="less")
## Error in try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]], style =
"W")),  :
##  unused argument (alternative = "less")

I corresponded with the author of pgirmess and he did not have a solution
nor much time to work on it. I was hoping to give a go at trouble-shooting
myself, but haven't had a chance, so this thread seemed like a relevant
place to bring up the issue, so others are at least aware of it.

Best,
Mike Treglia






On Tue, Apr 28, 2015 at 2:05 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Tue, 28 Apr 2015, Andy Bunn wrote:
>
>  Hi all, This seems trivial easy but being a bear of very little brain...
>>
>> I'm looking to build a correlogram using Moran's I and the function
>> sp.correlogram() with data(meuse) as a SpatialPointsDataFrame. I've done
>> so with the ncf library using correlog() but getting the equivalent out of
>> library sp is eluding me. Can somebody help me out?
>>
>
> require(ncf)
> ncf.cor <- ncf::correlog(x=coordinates(meuse)[,1],
>  y=coordinates(meuse)[,2], z=meuse$zinc, increment=200, resamp=100)
>
> ncf::correlog() chooses bins based on increment. Alternatively,
> pgirmess::correlog() uses by default an optimal number of bins, but can use
> a bin count:
>
> library(pgirmess)
> pgir.cor <- pgirmess::correlog(coordinates(meuse), z=meuse$zinc, "Moran",
>   nbclass=23)
> plot(pgir.cor[,1], pgir.cor[,2], type="b")
> cbind(pgir.cor[,1], ncf.cor$mean.of.class)
> cbind(pgir.cor[,4], ncf.cor$n)
>
> The differences come from ncf::correlog() constructing the spatial weights
> itself, while pgirmess::correlog() uses spdep::dnearneigh() to construct
> them for the distance bins and then spdep::nb2listw() and
> spdep::moran.test() internally in a loop, once for each bin.
>
> spdep::sp.correlogram() follows the original Cliff & Ord understanding of
> a spatial correlogram - like time series lags - of order 1, order 2, etc.
> The input spatial weights define the weighted graph, so order 2 neighbours
> are neighbours of order 1 neighbours by stepping out on the graph.
> pgirmess::correlog() was written to use distance rather than graph edge
> count distance:
>
> library(spdep)
> nb200 <- dnearneigh(meuse, 0, 200)
> spdep.cor <- spdep::sp.correlogram(nb200, meuse$zinc, order=23,
>  method="I", zero.policy=TRUE)
> plot(spdep.cor)
>
> To get the implied mean distances for lags of nb200:
>
> nb200_23 <- nblag(nb200, 23)
> mdbins <- sapply(nb200_23, function(x) mean(unlist(nbdists(x, meuse))))
> mdbins
>
> There are two different understandings of this spatial correlogram, the
> C&O one based on time series and counting distance in graph edges, and
> another using distance bands, also found in globalG.test, etc.
>
> Hope this clarifies,
>
> Roger
>
>
>
>> -Andy
>>
>> require(sp)
>> require(ncf)
>> data(meuse)
>> coordinates(meuse) <- ~x+y
>> proj4string(meuse) <- CRS("+init=epsg:28992")
>> ncf.cor <- correlog(x=coordinates(meuse)[,1], y=coordinates(meuse)[,2],
>> z=meuse at data$zinc, increment=200, resamp=100)
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From jacobvanetten at yahoo.com  Tue Apr 28 17:17:33 2015
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Tue, 28 Apr 2015 15:17:33 +0000 (UTC)
Subject: [R-sig-Geo] Using gdistance to compute a least cost path which
 avoids certain cells entirely, no matter the distance
In-Reply-To: <1430181071767-7588118.post@n2.nabble.com>
References: <1430181071767-7588118.post@n2.nabble.com>
Message-ID: <821236528.9038145.1430234253585.JavaMail.yahoo@mail.yahoo.com>

Hi Sharon,
"Going ten times as far to avoid crossing a road" would require for each pair of points you measure the direct distance first and then make the road crossing value as 10x this value, taking into account you have set the road width to 30.
Best,
Jacob 


     On Monday, 27 April 2015, 18:35, sharx <sharx at ucla.edu> wrote:
   

 Hi all, 

I have some data of GPS locations of an animal and want to construct paths
between those coordinates. The goal is to obtain animal movement paths that
the cross the fewest roads possible by using shortestPath(), and assigning
resistance values to a raster of the animal's habitat. Ideally this means
that the path would show animals going out of their way to avoid roads, even
going ten times the distance they would have by crossing roads. I have
experimented with different resistance values with limited success.

Below is an example. Blue points are coordinates. Purple lines are roads.
Red line is the least cost path calculated, which goes through several roads
unnecessarily. Green line is the path I would like to generate.
<http://r-sig-geo.2731867.n2.nabble.com/file/n7588118/leastcost-example.png> 

With my current results, I have achieved some avoidance of roads, but cannot
construct a path that goes too much extraneous distance in order to avoid
roads. When setting the non-road cell resistance to 0, however, I got an
extraordinarily complicated set of paths, perhaps due to values of infinity
when calculating the transition matrix.

*Could anyone could give me an idea as to how to choose these resistance
values, or how shortestPath() calculates with regards to the transition
matrix values and the actual distance in meters? *

I have created a raster called cost from a shapefile of roads in projection
NAD83, and using extract(), I have assigned much higher resistance values to
each cell of the raster cost if the cell contains a road. Here the cost of
non-road cells is 2^-20 and the cost of road cells is 10^100.

Here is my code:

library(raster)
cost <-rasterize(rd, r.30m, field=2^-20) 
numbers <- extract(cost, rd, cellnumbers=TRUE, buffer=30)
cellnum <- unlist(numbers) 
cost[cellnum] <- 10^100

library(gdistance)
## Produce transition matrices, and correct because 8 directions
trCost <- transition(1/cost, mean, directions=8)
trCost <- geoCorrection(trCost, type="c")

# Iterate between a list of coordinate pairs, use shortestPath() to get a
path for each pair
#Each element of the list coords contains two points that straddle a road.
# For each pair of points, calculate the least cost path between them.
getpath <- function(coords) {
? c = unlist(coords)
? pt1 = c(c[1], c[3])
? pt2 = c(c[2], c[4])
? if (sqrt((pt1[1]-pt2[1])^2 + (pt1[2]-pt2[2])^2) <= sqrt(2*30^2)) {
? ? return(SpatialLines(list(Lines(Line(rbind(pt1,pt2)), ID="1"))))
? } # if the points are in the same raster cell, return a straight line
between them (a least cost path will not work)
? return(shortestPath(trCost, pt1, pt2, output="SpatialLines"))
}

paths <- numeric(0)
for (i in 1:length(coords[[1]])){
? c=lapply(coords, "[[", i)
? paths <- c(paths, getpath(c))
}

#Code end

Thank you for your help in advance!

Best,
Sharon



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Using-gdistance-to-compute-a-least-cost-path-which-avoids-certain-cells-entirely-no-matter-the-distae-tp7588118.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


  
	[[alternative HTML version deleted]]


From drflying at sina.com  Tue Apr 28 17:25:15 2015
From: drflying at sina.com (drflying at sina.com)
Date: Tue, 28 Apr 2015 23:25:15 +0800 (CST)
Subject: [R-sig-Geo] =?utf-8?b?6Ieq5Yqo5Zue5aSN77yaUmU6ICBVc2luZyBnZGlz?=
	=?utf-8?q?tance_to_compute_a_least_cost_path_which_avoids_certain_?=
	=?utf-8?q?cells_entirely=2C_no_matter_the_distance?=
Message-ID: <20150428152515.69D4D17F0108@mda113-94.sinamail.sina.com.cn>

?????????~

From carlo.innocenti at isprambiente.it  Tue Apr 28 18:09:05 2015
From: carlo.innocenti at isprambiente.it (Carlo Innocenti)
Date: Tue, 28 Apr 2015 18:09:05 +0200
Subject: [R-sig-Geo] Gaussian transformation
Message-ID: <CAGOAjXPkRuD-a1yEkFcAE85jRss2vwdZts1fuKPviYg=MD8o_g@mail.gmail.com>

I would like to perform a gaussian conditional simulation on a variable
that is highly skewed.
Could someone suggest me how to transform my variable in a gaussian
distribution?

Thanks,
Carlo


-- 


Carlo Innocenti, PhD

ISPRA
Istituto Superiore per la Protezione e la Ricerca Ambientale
High Institute for Environmental Protection and Research

Via Vitaliano Brancati, 60
00144 Roma
Italy

phone: +39 06 5007 4639
email: carlo.innocenti at isprambiente.it

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Tue Apr 28 19:49:11 2015
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 28 Apr 2015 19:49:11 +0200
Subject: [R-sig-Geo] A simple correlogram using sp.correlogram with
 data(meuse)
In-Reply-To: <CAPKp32v+XBJWs+_RAseTs3zsnnAefi-AtjBHWbWfy3fgioK=jg@mail.gmail.com>
References: <D164608C.393F8%andy.bunn@wwu.edu>
	<alpine.LFD.2.11.1504280838400.19394@reclus.nhh.no>
	<CAPKp32v+XBJWs+_RAseTs3zsnnAefi-AtjBHWbWfy3fgioK=jg@mail.gmail.com>
Message-ID: <alpine.LFD.2.11.1504281944470.11469@reclus.nhh.no>

On Tue, 28 Apr 2015, Michael Treglia wrote:

> Hi all,
>
> This is a bit a tangential to the question, but related to
> pgirmess::correlog used in this thread, so I thought it appropriate to
> follow-up here [if not, apologies - I can start a new thread if that's
> preferred].
>
> In recent exploration with the pgirmess::correlog, I was unable to change
> the alternative hypothesis being tested. Since pgirmess::correlog uses
> spdep::moran.test, the alternative hypothesis being tested is by default
> "greater" (confirmed in the documentation). The help for the function
> indicates pgirmess::correlog should also be able to take arguments from
> 'moran.test' within it. Thus, users should be able to use the 'alternative'
> argument to change the alternative hypothesis being tested.  When trying to
> use "alternative='less'" (or 'two.sided'), an error is returned:
>
> Error in try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]], style = "W")),
> :
>  unused argument (alternative = "less")

The problem is that the ... is passed to try(), not moran.test() or 
geary.test() in:

xt <- switch(pmatch(method, c("Moran", "Geary"), nomatch = 3),
     try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]],
         style = "W")), silent = TRUE, ...), try(geary.test(lst.z1[[i]],
         nb2listw(lst.nb1[[i]], style = "W")), silent = TRUE,
         ...), stop("Method must be 'Moran' or 'Geary'"))

With:

xt <- switch(pmatch(method, c("Moran", "Geary"), nomatch = 3),
     try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]],
         style = "W"), ...), silent = TRUE), try(geary.test(lst.z1[[i]],
         nb2listw(lst.nb1[[i]], style = "W"), ...), silent = TRUE),
         stop("Method must be 'Moran' or 'Geary'"))

via for example correlog1 <- edit(correlog), it works. You can save the 
function for later use too.

Hope this helps,

Roger


>
> Reproducible Code (based on the example from help for pgirmess::correlog):
>
> library(spdep)
> library(pgirmess)
> data(oldcol)
> attach(COL.OLD)
> coords<-cbind(X,Y)
> res<-correlog(coords,CRIME, method="Moran", nbclass=NULL,alternative="less")
> ## Error in try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]], style =
> "W")),  :
> ##  unused argument (alternative = "less")
>
> I corresponded with the author of pgirmess and he did not have a solution
> nor much time to work on it. I was hoping to give a go at trouble-shooting
> myself, but haven't had a chance, so this thread seemed like a relevant
> place to bring up the issue, so others are at least aware of it.
>
> Best,
> Mike Treglia
>
>
>
>
>
>
> On Tue, Apr 28, 2015 at 2:05 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Tue, 28 Apr 2015, Andy Bunn wrote:
>>
>>  Hi all, This seems trivial easy but being a bear of very little brain...
>>>
>>> I'm looking to build a correlogram using Moran's I and the function
>>> sp.correlogram() with data(meuse) as a SpatialPointsDataFrame. I've done
>>> so with the ncf library using correlog() but getting the equivalent out of
>>> library sp is eluding me. Can somebody help me out?
>>>
>>
>> require(ncf)
>> ncf.cor <- ncf::correlog(x=coordinates(meuse)[,1],
>>  y=coordinates(meuse)[,2], z=meuse$zinc, increment=200, resamp=100)
>>
>> ncf::correlog() chooses bins based on increment. Alternatively,
>> pgirmess::correlog() uses by default an optimal number of bins, but can use
>> a bin count:
>>
>> library(pgirmess)
>> pgir.cor <- pgirmess::correlog(coordinates(meuse), z=meuse$zinc, "Moran",
>>   nbclass=23)
>> plot(pgir.cor[,1], pgir.cor[,2], type="b")
>> cbind(pgir.cor[,1], ncf.cor$mean.of.class)
>> cbind(pgir.cor[,4], ncf.cor$n)
>>
>> The differences come from ncf::correlog() constructing the spatial weights
>> itself, while pgirmess::correlog() uses spdep::dnearneigh() to construct
>> them for the distance bins and then spdep::nb2listw() and
>> spdep::moran.test() internally in a loop, once for each bin.
>>
>> spdep::sp.correlogram() follows the original Cliff & Ord understanding of
>> a spatial correlogram - like time series lags - of order 1, order 2, etc.
>> The input spatial weights define the weighted graph, so order 2 neighbours
>> are neighbours of order 1 neighbours by stepping out on the graph.
>> pgirmess::correlog() was written to use distance rather than graph edge
>> count distance:
>>
>> library(spdep)
>> nb200 <- dnearneigh(meuse, 0, 200)
>> spdep.cor <- spdep::sp.correlogram(nb200, meuse$zinc, order=23,
>>  method="I", zero.policy=TRUE)
>> plot(spdep.cor)
>>
>> To get the implied mean distances for lags of nb200:
>>
>> nb200_23 <- nblag(nb200, 23)
>> mdbins <- sapply(nb200_23, function(x) mean(unlist(nbdists(x, meuse))))
>> mdbins
>>
>> There are two different understandings of this spatial correlogram, the
>> C&O one based on time series and counting distance in graph edges, and
>> another using distance bands, also found in globalG.test, etc.
>>
>> Hope this clarifies,
>>
>> Roger
>>
>>
>>
>>> -Andy
>>>
>>> require(sp)
>>> require(ncf)
>>> data(meuse)
>>> coordinates(meuse) <- ~x+y
>>> proj4string(meuse) <- CRS("+init=epsg:28992")
>>> ncf.cor <- correlog(x=coordinates(meuse)[,1], y=coordinates(meuse)[,2],
>>> z=meuse at data$zinc, increment=200, resamp=100)
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From mtreglia at gmail.com  Tue Apr 28 20:46:14 2015
From: mtreglia at gmail.com (Michael Treglia)
Date: Tue, 28 Apr 2015 13:46:14 -0500
Subject: [R-sig-Geo] A simple correlogram using sp.correlogram with
	data(meuse)
In-Reply-To: <alpine.LFD.2.11.1504281944470.11469@reclus.nhh.no>
References: <D164608C.393F8%andy.bunn@wwu.edu>
	<alpine.LFD.2.11.1504280838400.19394@reclus.nhh.no>
	<CAPKp32v+XBJWs+_RAseTs3zsnnAefi-AtjBHWbWfy3fgioK=jg@mail.gmail.com>
	<alpine.LFD.2.11.1504281944470.11469@reclus.nhh.no>
Message-ID: <CAPKp32sBuHLQyK3P72yv3OuT3h1Z9cUO9NXKZv03uu_7Hx=H3w@mail.gmail.com>

Thanks Roger! That solves it.
Best,
Mike

On Tue, Apr 28, 2015 at 12:49 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Tue, 28 Apr 2015, Michael Treglia wrote:
>
>  Hi all,
>>
>> This is a bit a tangential to the question, but related to
>> pgirmess::correlog used in this thread, so I thought it appropriate to
>> follow-up here [if not, apologies - I can start a new thread if that's
>> preferred].
>>
>> In recent exploration with the pgirmess::correlog, I was unable to change
>> the alternative hypothesis being tested. Since pgirmess::correlog uses
>> spdep::moran.test, the alternative hypothesis being tested is by default
>> "greater" (confirmed in the documentation). The help for the function
>> indicates pgirmess::correlog should also be able to take arguments from
>> 'moran.test' within it. Thus, users should be able to use the
>> 'alternative'
>> argument to change the alternative hypothesis being tested.  When trying
>> to
>> use "alternative='less'" (or 'two.sided'), an error is returned:
>>
>> Error in try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]], style = "W")),
>> :
>>  unused argument (alternative = "less")
>>
>
> The problem is that the ... is passed to try(), not moran.test() or
> geary.test() in:
>
> xt <- switch(pmatch(method, c("Moran", "Geary"), nomatch = 3),
>     try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]],
>         style = "W")), silent = TRUE, ...), try(geary.test(lst.z1[[i]],
>         nb2listw(lst.nb1[[i]], style = "W")), silent = TRUE,
>         ...), stop("Method must be 'Moran' or 'Geary'"))
>
> With:
>
> xt <- switch(pmatch(method, c("Moran", "Geary"), nomatch = 3),
>     try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]],
>         style = "W"), ...), silent = TRUE), try(geary.test(lst.z1[[i]],
>         nb2listw(lst.nb1[[i]], style = "W"), ...), silent = TRUE),
>         stop("Method must be 'Moran' or 'Geary'"))
>
> via for example correlog1 <- edit(correlog), it works. You can save the
> function for later use too.
>
> Hope this helps,
>
> Roger
>
>
>
>
>> Reproducible Code (based on the example from help for pgirmess::correlog):
>>
>> library(spdep)
>> library(pgirmess)
>> data(oldcol)
>> attach(COL.OLD)
>> coords<-cbind(X,Y)
>> res<-correlog(coords,CRIME, method="Moran",
>> nbclass=NULL,alternative="less")
>> ## Error in try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]], style =
>> "W")),  :
>> ##  unused argument (alternative = "less")
>>
>> I corresponded with the author of pgirmess and he did not have a solution
>> nor much time to work on it. I was hoping to give a go at trouble-shooting
>> myself, but haven't had a chance, so this thread seemed like a relevant
>> place to bring up the issue, so others are at least aware of it.
>>
>> Best,
>> Mike Treglia
>>
>>
>>
>>
>>
>>
>> On Tue, Apr 28, 2015 at 2:05 AM, Roger Bivand <Roger.Bivand at nhh.no>
>> wrote:
>>
>>  On Tue, 28 Apr 2015, Andy Bunn wrote:
>>>
>>>  Hi all, This seems trivial easy but being a bear of very little brain...
>>>
>>>>
>>>> I'm looking to build a correlogram using Moran's I and the function
>>>> sp.correlogram() with data(meuse) as a SpatialPointsDataFrame. I've done
>>>> so with the ncf library using correlog() but getting the equivalent out
>>>> of
>>>> library sp is eluding me. Can somebody help me out?
>>>>
>>>>
>>> require(ncf)
>>> ncf.cor <- ncf::correlog(x=coordinates(meuse)[,1],
>>>  y=coordinates(meuse)[,2], z=meuse$zinc, increment=200, resamp=100)
>>>
>>> ncf::correlog() chooses bins based on increment. Alternatively,
>>> pgirmess::correlog() uses by default an optimal number of bins, but can
>>> use
>>> a bin count:
>>>
>>> library(pgirmess)
>>> pgir.cor <- pgirmess::correlog(coordinates(meuse), z=meuse$zinc, "Moran",
>>>   nbclass=23)
>>> plot(pgir.cor[,1], pgir.cor[,2], type="b")
>>> cbind(pgir.cor[,1], ncf.cor$mean.of.class)
>>> cbind(pgir.cor[,4], ncf.cor$n)
>>>
>>> The differences come from ncf::correlog() constructing the spatial
>>> weights
>>> itself, while pgirmess::correlog() uses spdep::dnearneigh() to construct
>>> them for the distance bins and then spdep::nb2listw() and
>>> spdep::moran.test() internally in a loop, once for each bin.
>>>
>>> spdep::sp.correlogram() follows the original Cliff & Ord understanding of
>>> a spatial correlogram - like time series lags - of order 1, order 2, etc.
>>> The input spatial weights define the weighted graph, so order 2
>>> neighbours
>>> are neighbours of order 1 neighbours by stepping out on the graph.
>>> pgirmess::correlog() was written to use distance rather than graph edge
>>> count distance:
>>>
>>> library(spdep)
>>> nb200 <- dnearneigh(meuse, 0, 200)
>>> spdep.cor <- spdep::sp.correlogram(nb200, meuse$zinc, order=23,
>>>  method="I", zero.policy=TRUE)
>>> plot(spdep.cor)
>>>
>>> To get the implied mean distances for lags of nb200:
>>>
>>> nb200_23 <- nblag(nb200, 23)
>>> mdbins <- sapply(nb200_23, function(x) mean(unlist(nbdists(x, meuse))))
>>> mdbins
>>>
>>> There are two different understandings of this spatial correlogram, the
>>> C&O one based on time series and counting distance in graph edges, and
>>> another using distance bands, also found in globalG.test, etc.
>>>
>>> Hope this clarifies,
>>>
>>> Roger
>>>
>>>
>>>
>>>  -Andy
>>>>
>>>> require(sp)
>>>> require(ncf)
>>>> data(meuse)
>>>> coordinates(meuse) <- ~x+y
>>>> proj4string(meuse) <- CRS("+init=epsg:28992")
>>>> ncf.cor <- correlog(x=coordinates(meuse)[,1], y=coordinates(meuse)[,2],
>>>> z=meuse at data$zinc, increment=200, resamp=100)
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>>  --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Tue Apr 28 22:32:07 2015
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 28 Apr 2015 22:32:07 +0200
Subject: [R-sig-Geo] Gaussian transformation
In-Reply-To: <CAGOAjXPkRuD-a1yEkFcAE85jRss2vwdZts1fuKPviYg=MD8o_g@mail.gmail.com>
References: <CAGOAjXPkRuD-a1yEkFcAE85jRss2vwdZts1fuKPviYg=MD8o_g@mail.gmail.com>
Message-ID: <553FEE47.2030501@uni-muenster.de>

one way is the rank transform:

x = rgamma(100, 0.1)
hist(x)
y = qnorm((order(x)/(length(x) + 0.5)))
qqnorm(y)

but transforming your conditionally simulated values back will be
tricky. And I'm not sure about the 0.5.

On 04/28/2015 06:09 PM, Carlo Innocenti wrote:
> I would like to perform a gaussian conditional simulation on a variable
> that is highly skewed.
> Could someone suggest me how to transform my variable in a gaussian
> distribution?
> 
> Thanks,
> Carlo
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi),  University of M?nster,
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150428/a8c094a2/attachment.bin>

From ruipbarradas at sapo.pt  Wed Apr 29 11:18:20 2015
From: ruipbarradas at sapo.pt (Rui Barradas)
Date: Wed, 29 Apr 2015 10:18:20 +0100
Subject: [R-sig-Geo] Maps of continents
Message-ID: <5540A1DC.4010706@sapo.pt>

Hello,

This is a really basic question. I'm an R user but completely ignorant 
on geographical applications.
I need to graph the 5 Continents, one on each graph. How can I do it? 
Which packages do I need to have installed and use?.

Thank you,

Rui Barradas


From roman.lustrik at gmail.com  Wed Apr 29 11:34:22 2015
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Wed, 29 Apr 2015 11:34:22 +0200
Subject: [R-sig-Geo] Maps of continents
In-Reply-To: <5540A1DC.4010706@sapo.pt>
References: <5540A1DC.4010706@sapo.pt>
Message-ID: <CAHT1vpgGKuEkU0jRsFiH+qvt-kc+cpM4NjuAhDrxXhQg+_MvZA@mail.gmail.com>

Have you tried package "rworldmap"? It comes with a vignette

install.packages("rworldmap")
library(rworldmap)
vignette("rworldmap")

Another packages that contains world maps is
library(maps)
map()

Cheers,
Roman


On Wed, Apr 29, 2015 at 11:18 AM, Rui Barradas <ruipbarradas at sapo.pt> wrote:

> Hello,
>
> This is a really basic question. I'm an R user but completely ignorant on
> geographical applications.
> I need to graph the 5 Continents, one on each graph. How can I do it?
> Which packages do I need to have installed and use?.
>
> Thank you,
>
> Rui Barradas
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
In God we trust, all others bring data.

	[[alternative HTML version deleted]]


From carlo.innocenti at isprambiente.it  Wed Apr 29 12:32:27 2015
From: carlo.innocenti at isprambiente.it (Carlo Innocenti)
Date: Wed, 29 Apr 2015 12:32:27 +0200
Subject: [R-sig-Geo] Gaussian transformation
In-Reply-To: <553FEE47.2030501@uni-muenster.de>
References: <CAGOAjXPkRuD-a1yEkFcAE85jRss2vwdZts1fuKPviYg=MD8o_g@mail.gmail.com>
	<553FEE47.2030501@uni-muenster.de>
Message-ID: <CAGOAjXPKDFRWavuVAiJbAQ0yYAdMXPPNdvm-=sHQcLt24fsHFg@mail.gmail.com>

Thank you Edzer.

It works, but I need the back transformation as well.
What about the gaussian anamorphosis with hermite polynomials? I know that
is a method used to normalize the data before to apply the conditional
gaussian simulation.
There is a package in R to transform and back transform with this method?
Another method that is used in these cases should be the normal scores
transformation: is it implemented in some package?

Carlo




2015-04-28 22:32 GMT+02:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:

> one way is the rank transform:
>
> x = rgamma(100, 0.1)
> hist(x)
> y = qnorm((order(x)/(length(x) + 0.5)))
> qqnorm(y)
>
> but transforming your conditionally simulated values back will be
> tricky. And I'm not sure about the 0.5.
>
> On 04/28/2015 06:09 PM, Carlo Innocenti wrote:
> > I would like to perform a gaussian conditional simulation on a variable
> > that is highly skewed.
> > Could someone suggest me how to transform my variable in a gaussian
> > distribution?
> >
> > Thanks,
> > Carlo
> >
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi),  University of M?nster,
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
> Spatial Statistics Society http://www.spatialstatistics.info
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 


Carlo Innocenti, PhD

ISPRA
Istituto Superiore per la Protezione e la Ricerca Ambientale
High Institute for Environmental Protection and Research

Via Vitaliano Brancati, 60
00144 Roma
Italy

phone: +39 06 5007 4639
email: carlo.innocenti at isprambiente.it

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Wed Apr 29 12:57:52 2015
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 29 Apr 2015 12:57:52 +0200
Subject: [R-sig-Geo] Gaussian transformation
In-Reply-To: <CAGOAjXPKDFRWavuVAiJbAQ0yYAdMXPPNdvm-=sHQcLt24fsHFg@mail.gmail.com>
References: <CAGOAjXPkRuD-a1yEkFcAE85jRss2vwdZts1fuKPviYg=MD8o_g@mail.gmail.com>	<553FEE47.2030501@uni-muenster.de>
	<CAGOAjXPKDFRWavuVAiJbAQ0yYAdMXPPNdvm-=sHQcLt24fsHFg@mail.gmail.com>
Message-ID: <5540B930.6000907@uni-muenster.de>



On 04/29/2015 12:32 PM, Carlo Innocenti wrote:
> Thank you Edzer.
> 
> It works, but I need the back transformation as well. 
> What about the gaussian anamorphosis with hermite polynomials? I know
> that is a method used to normalize the data before to apply the
> conditional gaussian simulation.

I haven't seen this in R.

> There is a package in R to transform and back transform with this method?
> Another method that is used in these cases should be the normal scores
> transformation: is it implemented in some package?

I think what I suggested below is commonly referred to as normal score
transformation, maybe with the variation of taking out the 0.5 or having
1, there. GSLIB used to advocate this, and had a program for
backtransforming, making certain assumptions about the tails. I'd
recommend trying log or Box-Cox first, and then look into copulas.

> 
> Carlo
> 
> 
> 
> 
> 2015-04-28 22:32 GMT+02:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de
> <mailto:edzer.pebesma at uni-muenster.de>>:
> 
>     one way is the rank transform:
> 
>     x = rgamma(100, 0.1)
>     hist(x)
>     y = qnorm((order(x)/(length(x) + 0.5)))
>     qqnorm(y)
> 
>     but transforming your conditionally simulated values back will be
>     tricky. And I'm not sure about the 0.5.
> 
>     On 04/28/2015 06:09 PM, Carlo Innocenti wrote:
>     > I would like to perform a gaussian conditional simulation on a
>     variable
>     > that is highly skewed.
>     > Could someone suggest me how to transform my variable in a gaussian
>     > distribution?
>     >
>     > Thanks,
>     > Carlo
>     >
>     >
> 
>     --
>     Edzer Pebesma
>     Institute for Geoinformatics (ifgi),  University of M?nster,
>     Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>     <tel:%2B49%20251%2083%2033081>
>     Journal of Statistical Software:   http://www.jstatsoft.org/
>     Computers & Geosciences:   http://elsevier.com/locate/cageo/
>     Spatial Statistics Society http://www.spatialstatistics.info
> 
> 
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
> 
> -- 
> 
> 
> Carlo Innocenti, PhD
> 
> ISPRA
> Istituto Superiore per la Protezione e la Ricerca Ambientale
> High Institute for Environmental Protection and Research
> 
> Via Vitaliano Brancati, 60
> 00144 Roma
> Italy
> 
> phone: +39 06 5007 4639
> email: carlo.innocenti at isprambiente.it
> <mailto:carlo.innocenti at isprambiente.it>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi),  University of M?nster,
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20150429/b8d6f743/attachment.bin>

From jaonyango at yahoo.com  Wed Apr 29 12:59:09 2015
From: jaonyango at yahoo.com (Joshua Onyango)
Date: Wed, 29 Apr 2015 10:59:09 +0000 (UTC)
Subject: [R-sig-Geo] Spatial Statistics
Message-ID: <1475302093.323594.1430305149509.JavaMail.yahoo@mail.yahoo.com>

Hello,
I have some animal disease data which I wanted to spatially analyse using R though very new with using the software. Data has several variables which I will be looking to analyse as some of the factors that explain disease distribution in eight regions of England. Any clue how I go about the analysis including making some disease maps for the two years - 2011 and 2012?
Here is a quick view of the variables

| FARMNo | POSTCODE | County | Region | Region.Coding | LAT | LONG | EASTING | NORTHING | precip | tempmax | tempmean | tempmin | altitude | Flock2011 | Breed | orf-no.orf 2011 | Cases2011 | Flock2012 | orf-no.orf2012 | Cases2012 | Landarea.ha | Farming.practise | landforsheep | 2011.stocking.density | 2012.stocking.density | thistles | Ragwort | Nettles | Docks | Lambing.Mangement |
| 40 | MK44 2DH | Bedfordshire | East? | 1 | 52.20418 | -0.48039 | 503943 | 257305 | 49 | 13.4 | 9.6 | 5.9 | 78 | 225 | 2 | 1 | 0 | 190 | 1 | 0 | 16 | 1 | 16 | 14 | 12 | 1 | 0 | 0 | 5 | 1 |  |
| 176 | LU3 3PS | Bedfordshire | East? | 1 | 51.94303 | -0.44177 | 507205 | 228316 | 54 | 13.4 | 9.5 | 5.7 | 155 | 330 | 1 | 1 | 0 | 343 | 1 | 0 | 56 | 1 | 50 | 7 | 7 | 2 | 0 | 1 | 2 | 1 |  |
| 209 | LU7 0EP | Bedfordshire | East? | 1 | 51.93331 | -0.77006 | 484658 | 226803 | 54 | 13.3 | 9.5 | 5.7 | 137 | 770 | 2 | 2 | 8 | 810 | 2 | 8 | 94 | 2 | 65 | 12 | 12 | 1 | 0 | 4 | 0 | 1 |  |


Many thanks
Josh
	[[alternative HTML version deleted]]


From gbl1 at hi.is  Wed Apr 29 13:23:16 2015
From: gbl1 at hi.is (Gilles Benjamin Leduc)
Date: Wed, 29 Apr 2015 11:23:16 +0000
Subject: [R-sig-Geo] Maps of continents
In-Reply-To: <5540A1DC.4010706@sapo.pt>
Message-ID: <1fc8-5540bf00-24b-22498880@235915451>

Hi 

So, I would advise you: Find nice shapefiles of the world: 
http://www.diva-gis.org/datadown 
http://spatialanalysis.co.uk/  

Then you load it, either :
 library(maptools)
bordures<-readShapeSpatial("10m_cultural/ne_10m_admin_0_countries.shp") 

Or better:
library(rgdal)
readOGR(dsn="10m_cultural", layer="ne_10m_admin_0_countries")->bordures

then plot with good limits (here France)
plot(bordures,xlim=c(?-4.3,9.1),ylim=c(41,51),axes = TRUE, col="grey") 

I hope it helps

Benjamin  
 
 
On Wednesday, April 29, 2015 09:18 GMT, Rui Barradas <ruipbarradas at sapo.pt> wrote: 
 
> Hello,
> 
> This is a really basic question. I'm an R user but completely ignorant 
> on geographical applications.
> I need to graph the 5 Continents, one on each graph. How can I do it? 
> Which packages do I need to have installed and use?.
> 
> Thank you,
> 
> Rui Barradas
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From paulojus at c3sl.ufpr.br  Wed Apr 29 15:11:35 2015
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 29 Apr 2015 10:11:35 -0300 (BRT)
Subject: [R-sig-Geo] Gaussian transformation
In-Reply-To: <CAGOAjXPKDFRWavuVAiJbAQ0yYAdMXPPNdvm-=sHQcLt24fsHFg@mail.gmail.com>
References: <CAGOAjXPkRuD-a1yEkFcAE85jRss2vwdZts1fuKPviYg=MD8o_g@mail.gmail.com>
	<553FEE47.2030501@uni-muenster.de>
	<CAGOAjXPKDFRWavuVAiJbAQ0yYAdMXPPNdvm-=sHQcLt24fsHFg@mail.gmail.com>
Message-ID: <alpine.DEB.2.10.1504291011160.12289@macalan.c3sl.ufpr.br>

> Perhaps you can also look at the Box-Cox family of transformation for
> which some cases such as log is a particular case
>
> You may look at MASS::boxcox()
> and/or boxcox related functions in geoR
>
> If log works well you benefit from the results of log-normal kriging.
>


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
VOIP: (+55) (41) (3361 3600) 1053 1066
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Wed, 29 Apr 2015, Carlo Innocenti wrote:

> Thank you Edzer.
>
> It works, but I need the back transformation as well.
> What about the gaussian anamorphosis with hermite polynomials? I know that
> is a method used to normalize the data before to apply the conditional
> gaussian simulation.
> There is a package in R to transform and back transform with this method?
> Another method that is used in these cases should be the normal scores
> transformation: is it implemented in some package?
>
> Carlo
>
>
>
>
> 2015-04-28 22:32 GMT+02:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
>
>> one way is the rank transform:
>>
>> x = rgamma(100, 0.1)
>> hist(x)
>> y = qnorm((order(x)/(length(x) + 0.5)))
>> qqnorm(y)
>>
>> but transforming your conditionally simulated values back will be
>> tricky. And I'm not sure about the 0.5.
>>
>> On 04/28/2015 06:09 PM, Carlo Innocenti wrote:
>> > I would like to perform a gaussian conditional simulation on a variable
>> > that is highly skewed.
>> > Could someone suggest me how to transform my variable in a gaussian
>> > distribution?
>> >
>> > Thanks,
>> > Carlo
>> >
>> >
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi),  University of M?nster,
>> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>> Journal of Statistical Software:   http://www.jstatsoft.org/
>> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>> Spatial Statistics Society http://www.spatialstatistics.info
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>
> -- 
>
>
> Carlo Innocenti, PhD
>
> ISPRA
> Istituto Superiore per la Protezione e la Ricerca Ambientale
> High Institute for Environmental Protection and Research
>
> Via Vitaliano Brancati, 60
> 00144 Roma
> Italy
>
> phone: +39 06 5007 4639
> email: carlo.innocenti at isprambiente.it
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From aasdelat at aim.com  Wed Apr 29 15:36:13 2015
From: aasdelat at aim.com (Antonio Serrano)
Date: Wed, 29 Apr 2015 09:36:13 -0400
Subject: [R-sig-Geo] Interactive maps
Message-ID: <14d05645fb5-2933-bb0@webprd-a62.mail.aol.com>


  Hello, all:
 
    I'm new in this forum. I have been redirected here from the r-help forum.
 
    Well, I have the challenge to produce an interactive map.
 
    I have a map which has been produced by a Fortran program. I have the sources of this Fortran program and can produce the map in many formats: eps, ps, png, jpeg, svg, etc.
 
    I have to load the map in R, which has to display it on the screen.
 
    Then, the user clicks on a point on the map, and then, R has to retrieve the longitude and latitude where the user has just clicked.
 
    And then, R has to look for some information corresponding to that location, process that information, and present it to the user in another graphic.
 
    And the point is: what format and metainformation has to have the map to be correctly read by R and to retrieve longitude and latitude when the user clicks, and not "figure" coordinates?.
 
    I am thinking on inoculating some metainformation into the map, from the fortran program, and read and interpret it from R, but there is perhaps a more "correct" way to do this.
 

Antonio Serrano
aasdelat at aim.com
?


	[[alternative HTML version deleted]]


From ruipbarradas at sapo.pt  Wed Apr 29 16:34:07 2015
From: ruipbarradas at sapo.pt (Rui Barradas)
Date: Wed, 29 Apr 2015 15:34:07 +0100
Subject: [R-sig-Geo] Maps of continents
In-Reply-To: <1fc8-5540bf00-24b-22498880@235915451>
References: <1fc8-5540bf00-24b-22498880@235915451>
Message-ID: <5540EBDF.50400@sapo.pt>

Hello,

Thank you. Now I have another problem, when I run the code you've 
provided error messages occur.

 > library(maptools)
 > bordures<-readShapeSpatial("10m_cultural/ne_10m_admin_0_countries.shp")
Error in getinfo.shape(fn) : Error opening SHP file
 >
 > library(rgdal)
 > readOGR(dsn="10m_cultural", layer="ne_10m_admin_0_countries")->bordures
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, 
use_iconv = use_iconv,  :
   Cannot open file


How can I solve this?

Rui Barradas


 > sessionInfo()
R version 3.2.0 (2015-04-16)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=Portuguese_Portugal.1252 
LC_CTYPE=Portuguese_Portugal.1252
[3] LC_MONETARY=Portuguese_Portugal.1252 LC_NUMERIC=C 

[5] LC_TIME=Portuguese_Portugal.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] maps_2.3-9      rworldmap_1.3-1 rgdal_0.9-2     maptools_0.8-36
[5] sp_1.1-0

loaded via a namespace (and not attached):
[1] tools_3.2.0     foreign_0.8-63  fields_8.2-1    grid_3.2.0
[5] spam_1.0-1      lattice_0.20-31



Em 29-04-2015 12:23, Gilles Benjamin Leduc escreveu:
> Hi
>
> So, I would advise you: Find nice shapefiles of the world:
> http://www.diva-gis.org/datadown
> http://spatialanalysis.co.uk/
>
> Then you load it, either :
>   library(maptools)
> bordures<-readShapeSpatial("10m_cultural/ne_10m_admin_0_countries.shp")
>
> Or better:
> library(rgdal)
> readOGR(dsn="10m_cultural", layer="ne_10m_admin_0_countries")->bordures
>
> then plot with good limits (here France)
> plot(bordures,xlim=c( -4.3,9.1),ylim=c(41,51),axes = TRUE, col="grey")
>
> I hope it helps
>
> Benjamin
>
>
> On Wednesday, April 29, 2015 09:18 GMT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>
>> Hello,
>>
>> This is a really basic question. I'm an R user but completely ignorant
>> on geographical applications.
>> I need to graph the 5 Continents, one on each graph. How can I do it?
>> Which packages do I need to have installed and use?.
>>
>> Thank you,
>>
>> Rui Barradas
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>


From ruipbarradas at sapo.pt  Wed Apr 29 16:35:46 2015
From: ruipbarradas at sapo.pt (Rui Barradas)
Date: Wed, 29 Apr 2015 15:35:46 +0100
Subject: [R-sig-Geo] Maps of continents
In-Reply-To: <CAHT1vpgGKuEkU0jRsFiH+qvt-kc+cpM4NjuAhDrxXhQg+_MvZA@mail.gmail.com>
References: <5540A1DC.4010706@sapo.pt>
	<CAHT1vpgGKuEkU0jRsFiH+qvt-kc+cpM4NjuAhDrxXhQg+_MvZA@mail.gmail.com>
Message-ID: <5540EC42.6030205@sapo.pt>

Hello,

Thanks, I will look into the vignette.

Rui Barradas

Em 29-04-2015 10:34, Roman Lu?trik escreveu:
> Have you tried package "rworldmap"? It comes with a vignette
>
> install.packages("rworldmap")
> library(rworldmap)
> vignette("rworldmap")
>
> Another packages that contains world maps is
> library(maps)
> map()
>
> Cheers,
> Roman
>
>
> On Wed, Apr 29, 2015 at 11:18 AM, Rui Barradas <ruipbarradas at sapo.pt
> <mailto:ruipbarradas at sapo.pt>> wrote:
>
>     Hello,
>
>     This is a really basic question. I'm an R user but completely
>     ignorant on geographical applications.
>     I need to graph the 5 Continents, one on each graph. How can I do
>     it? Which packages do I need to have installed and use?.
>
>     Thank you,
>
>     Rui Barradas
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
> In God we trust, all others bring data.


From b.rowlingson at lancaster.ac.uk  Wed Apr 29 17:02:03 2015
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 29 Apr 2015 16:02:03 +0100
Subject: [R-sig-Geo] Interactive maps
In-Reply-To: <14d05645fb5-2933-bb0@webprd-a62.mail.aol.com>
References: <14d05645fb5-2933-bb0@webprd-a62.mail.aol.com>
Message-ID: <CANVKczNa_ejfb4HS+O=a9=j3OtAiVDMtRsn3P5-GV7nH9snq6Q@mail.gmail.com>

On Wed, Apr 29, 2015 at 2:36 PM, Antonio Serrano via R-sig-Geo
<r-sig-geo at r-project.org> wrote:

I suspect we may need some clarification...

>     I have a map which has been produced by a Fortran program. I have the sources of this Fortran program and can produce the map in many formats: eps, ps, png, jpeg, svg, etc.

 So the "map" is an image file, and every pixel is the same
rectangular (not necessarily square) size in degrees of latitude and
longitude? And you know those coordinates? Or equivalently you know
the limits of the map in lat-long and how many pixels it is?

>     And the point is: what format and metainformation has to have the map to be correctly read by R and to retrieve longitude and latitude when the user clicks, and not "figure" coordinates?.
>
>     I am thinking on inoculating some metainformation into the map, from the fortran program, and read and interpret it from R, but there is perhaps a more "correct" way to do this.

You can georeference any image by creating a companion "world" file.
This is usually the image file with a "w" on the extension, so the
world file for foo.png is foo.pngw. Details of the world file format
are in various places, try here:

https://en.wikipedia.org/wiki/World_file

Its a simple text file with only a few lines.

Once you have created that, then the image and its world file make up
a GDAL-compatible raster data source. Which means you can read it in
once you have the `raster` and `rgdal` packages installed, and its
location is known. When you plot it, it will plot at that location,
and if you do locator(type="p") and click somewhere you will get a
returned value in the image's geographic coordinates system.

The big problem will be if the assumptions I mention above are not
true. If you have a grid of 100km squares, then those grid cells have
different sizes in degrees as you go north-south. If that's not the
case then the above will work fine.

Barry




>
> Antonio Serrano
> aasdelat at aim.com
> ?
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jari.oksanen at oulu.fi  Wed Apr 29 17:33:22 2015
From: jari.oksanen at oulu.fi (Jari Oksanen)
Date: Wed, 29 Apr 2015 15:33:22 +0000
Subject: [R-sig-Geo] Maps of continents
In-Reply-To: <5540EBDF.50400@sapo.pt>
References: <1fc8-5540bf00-24b-22498880@235915451> <5540EBDF.50400@sapo.pt>
Message-ID: <7D3FB4C3-C138-4A6E-9011-85A6D4D12AF5@oulu.fi>

Dear Rui Barradas,

I'm sure you can get this work and get excellent results. However, I think the *easiest* solution is to get rworldmap package (like suggested earlier in this thread), where you do not need to do so many tricks to do what you try to do. For instance, plotting continents is much easier with rworldmap if you want to define the continent by geographical areas instead of a longitude/latitude ranges containing the continent plus other areas in that range.

Cheers, Jari Oksanen
On 29/04/2015, at 17:34 PM, Rui Barradas wrote:

> Hello,
> 
> Thank you. Now I have another problem, when I run the code you've provided error messages occur.
> 
> > library(maptools)
> > bordures<-readShapeSpatial("10m_cultural/ne_10m_admin_0_countries.shp")
> Error in getinfo.shape(fn) : Error opening SHP file
> >
> > library(rgdal)
> > readOGR(dsn="10m_cultural", layer="ne_10m_admin_0_countries")->bordures
> Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv,  :
>  Cannot open file
> 
> 
> How can I solve this?
> 
> Rui Barradas
> 
> 
> > sessionInfo()
> R version 3.2.0 (2015-04-16)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
> 
> locale:
> [1] LC_COLLATE=Portuguese_Portugal.1252 LC_CTYPE=Portuguese_Portugal.1252
> [3] LC_MONETARY=Portuguese_Portugal.1252 LC_NUMERIC=C 
> [5] LC_TIME=Portuguese_Portugal.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] maps_2.3-9      rworldmap_1.3-1 rgdal_0.9-2     maptools_0.8-36
> [5] sp_1.1-0
> 
> loaded via a namespace (and not attached):
> [1] tools_3.2.0     foreign_0.8-63  fields_8.2-1    grid_3.2.0
> [5] spam_1.0-1      lattice_0.20-31
> 
> 
> 
> Em 29-04-2015 12:23, Gilles Benjamin Leduc escreveu:
>> Hi
>> 
>> So, I would advise you: Find nice shapefiles of the world:
>> http://www.diva-gis.org/datadown
>> http://spatialanalysis.co.uk/
>> 
>> Then you load it, either :
>>  library(maptools)
>> bordures<-readShapeSpatial("10m_cultural/ne_10m_admin_0_countries.shp")
>> 
>> Or better:
>> library(rgdal)
>> readOGR(dsn="10m_cultural", layer="ne_10m_admin_0_countries")->bordures
>> 
>> then plot with good limits (here France)
>> plot(bordures,xlim=c( -4.3,9.1),ylim=c(41,51),axes = TRUE, col="grey")
>> 
>> I hope it helps
>> 
>> Benjamin
>> 
>> 
>> On Wednesday, April 29, 2015 09:18 GMT, Rui Barradas <ruipbarradas at sapo.pt> wrote:
>> 
>>> Hello,
>>> 
>>> This is a really basic question. I'm an R user but completely ignorant
>>> on geographical applications.
>>> I need to graph the 5 Continents, one on each graph. How can I do it?
>>> Which packages do I need to have installed and use?.
>>> 
>>> Thank you,
>>> 
>>> Rui Barradas
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
>> 
>> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From basille.web at ase-research.org  Wed Apr 29 23:04:46 2015
From: basille.web at ase-research.org (Mathieu Basille)
Date: Wed, 29 Apr 2015 17:04:46 -0400
Subject: [R-sig-Geo] Summer School: Next Generation Data Management in
	Movement Ecology
Message-ID: <5541476E.3080903@ase-research.org>

[My apologies for cross-posting: sent to both 'eco' and 'Geo' lists]


*Next Generation Data Management in Movement Ecology*

When:  July 1?3 & 6?10 2015
Where: Fondazione Edmund Mach, Trento, Italy

An intense, two stages-course, with a mix of technical and theoretical 
lectures and hands-on exercises. The first module (three days) will provide 
an introduction to spatial databases and SQL (using PostgreSQL/PostGIS as 
reference database system). The second module (five days) will focus onto 
wildlife tracking data management, with ample reference to use and 
integration of remote sensing datasets, and statistical analysis through R. 
The two modules can be joined independently, or in combination. Basic 
knowledge of SQL and spatial databases are however essential to follow the 
second part.

*Detailed information*

http://ase-research.org/school2015/info.pdf

There is little time left to apply for it (deadline is April 30), but there 
is still room for applicants! Late applications will be considered in the 
limit of available space.

Mathieu Basille.


-- 

~$ whoami
Mathieu Basille
http://ase-research.org/basille

~$ locate --details
University of Florida \\
Fort Lauderdale Research and Education Center
(+1) 954-577-6314

~$ fortune
? Le tout est de tout dire, et je manque de mots
Et je manque de temps, et je manque d'audace. ?
    -- Paul ?luard


From jaonyango at yahoo.com  Thu Apr 30 12:00:50 2015
From: jaonyango at yahoo.com (Joshua Onyango)
Date: Thu, 30 Apr 2015 10:00:50 +0000 (UTC)
Subject: [R-sig-Geo] spatial statistics/regional factors analysis
Message-ID: <126611475.1154157.1430388050107.JavaMail.yahoo@mail.yahoo.com>

Hello all,
I am new to this site and also learning on how to use R?
I have disease data with several variables as risk factors
I want to see if the factors could be used to explain the variations on disease distribution in 8 Regions of England?
I have tried to come up with code on how to do this in R but not sure if I am on the right track.
I have used breed as example here thus thinking of doing the following:
region=glm(formula=as.factor(orf.no.orf2012)~factor(Region.Coding)*factor(Breed),family= binomial("logit"))

Any advise would be highly appreciated.?
Many thanks
Josh

	[[alternative HTML version deleted]]


From alaios at yahoo.com  Thu Apr 30 12:09:08 2015
From: alaios at yahoo.com (Alaios)
Date: Thu, 30 Apr 2015 10:09:08 +0000 (UTC)
Subject: [R-sig-Geo] Kriging with basis functions representation
Message-ID: <1098044366.1130479.1430388548857.JavaMail.yahoo@mail.yahoo.com>

(I am sorry if you have received this mail twice)
Dear all,I have some spatial measurements over the area and I would like to make kriging to see the measurement points are more important points in the whole region. 
That would influence a lot the reported error on the predictions.
I am trying to find a packet that has tools for specifying bases and allowing me to set weights or other way of importance.
The most relevant I have find so far? is the packet R-INLA that does though bayesian spatial modelling but it has the basic tols for basis functions representations.
Any ideas?I would like to thank you for your replyRegardsAlex



	[[alternative HTML version deleted]]


From carlo.innocenti at isprambiente.it  Thu Apr 30 14:16:57 2015
From: carlo.innocenti at isprambiente.it (Carlo Innocenti)
Date: Thu, 30 Apr 2015 14:16:57 +0200
Subject: [R-sig-Geo] Gaussian transformation
In-Reply-To: <alpine.DEB.2.10.1504291011160.12289@macalan.c3sl.ufpr.br>
References: <CAGOAjXPkRuD-a1yEkFcAE85jRss2vwdZts1fuKPviYg=MD8o_g@mail.gmail.com>
	<553FEE47.2030501@uni-muenster.de>
	<CAGOAjXPKDFRWavuVAiJbAQ0yYAdMXPPNdvm-=sHQcLt24fsHFg@mail.gmail.com>
	<alpine.DEB.2.10.1504291011160.12289@macalan.c3sl.ufpr.br>
Message-ID: <CAGOAjXNfEfMUZz7CceO68pkUtZT3Z1tpcq6iA37vhZMAXkNb9A@mail.gmail.com>

Thank you for your answers.

In the meantime, I found the package RGeostats developed by Geosciences
Research Center of MINES ParisTech on http://rgeostats.free.fr and at the
moment I'm studying it.
It seems promising with 3D geostatistics capability and function for
gaussian anamorphosis transformation and back transformation.

Carlo




2015-04-29 15:11 GMT+02:00 Paulo Justiniano Ribeiro Jr <
paulojus at c3sl.ufpr.br>:

> Perhaps you can also look at the Box-Cox family of transformation for
>> which some cases such as log is a particular case
>>
>> You may look at MASS::boxcox()
>> and/or boxcox related functions in geoR
>>
>> If log works well you benefit from the results of log-normal kriging.
>>
>>
>
> Paulo Justiniano Ribeiro Jr
> LEG (Laboratorio de Estatistica e Geoinformacao)
> Universidade Federal do Parana
> Caixa Postal 19.081
> CEP 81.531-990
> Curitiba, PR  -  Brasil
> Tel: (+55) 41 3361 3573
> VOIP: (+55) (41) (3361 3600) 1053 1066
> Fax: (+55) 41 3361 3141
> e-mail: paulojus AT  ufpr  br
> http://www.leg.ufpr.br/~paulojus
>
>
> On Wed, 29 Apr 2015, Carlo Innocenti wrote:
>
>  Thank you Edzer.
>>
>> It works, but I need the back transformation as well.
>> What about the gaussian anamorphosis with hermite polynomials? I know that
>> is a method used to normalize the data before to apply the conditional
>> gaussian simulation.
>> There is a package in R to transform and back transform with this method?
>> Another method that is used in these cases should be the normal scores
>> transformation: is it implemented in some package?
>>
>> Carlo
>>
>>
>>
>>
>> 2015-04-28 22:32 GMT+02:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
>>
>>  one way is the rank transform:
>>>
>>> x = rgamma(100, 0.1)
>>> hist(x)
>>> y = qnorm((order(x)/(length(x) + 0.5)))
>>> qqnorm(y)
>>>
>>> but transforming your conditionally simulated values back will be
>>> tricky. And I'm not sure about the 0.5.
>>>
>>> On 04/28/2015 06:09 PM, Carlo Innocenti wrote:
>>> > I would like to perform a gaussian conditional simulation on a variable
>>> > that is highly skewed.
>>> > Could someone suggest me how to transform my variable in a gaussian
>>> > distribution?
>>> >
>>> > Thanks,
>>> > Carlo
>>> >
>>> >
>>>
>>> --
>>> Edzer Pebesma
>>> Institute for Geoinformatics (ifgi),  University of M?nster,
>>> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
>>> Journal of Statistical Software:   http://www.jstatsoft.org/
>>> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>>> Spatial Statistics Society http://www.spatialstatistics.info
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>
>> --
>>
>>
>> Carlo Innocenti, PhD
>>
>> ISPRA
>> Istituto Superiore per la Protezione e la Ricerca Ambientale
>> High Institute for Environmental Protection and Research
>>
>> Via Vitaliano Brancati, 60
>> 00144 Roma
>> Italy
>>
>> phone: +39 06 5007 4639
>> email: carlo.innocenti at isprambiente.it
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 


Carlo Innocenti, PhD

ISPRA
Istituto Superiore per la Protezione e la Ricerca Ambientale
High Institute for Environmental Protection and Research

Via Vitaliano Brancati, 60
00144 Roma
Italy

phone: +39 06 5007 4639
email: carlo.innocenti at isprambiente.it

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Thu Apr 30 17:30:36 2015
From: mtreglia at gmail.com (Michael Treglia)
Date: Thu, 30 Apr 2015 10:30:36 -0500
Subject: [R-sig-Geo] A simple correlogram using sp.correlogram with
	data(meuse)
In-Reply-To: <CAPKp32sBuHLQyK3P72yv3OuT3h1Z9cUO9NXKZv03uu_7Hx=H3w@mail.gmail.com>
References: <D164608C.393F8%andy.bunn@wwu.edu>
	<alpine.LFD.2.11.1504280838400.19394@reclus.nhh.no>
	<CAPKp32v+XBJWs+_RAseTs3zsnnAefi-AtjBHWbWfy3fgioK=jg@mail.gmail.com>
	<alpine.LFD.2.11.1504281944470.11469@reclus.nhh.no>
	<CAPKp32sBuHLQyK3P72yv3OuT3h1Z9cUO9NXKZv03uu_7Hx=H3w@mail.gmail.com>
Message-ID: <CAPKp32tsX7eY1Gy_CnbCfWenvHpfRFebQLqZsTteLjbRk4F8hw@mail.gmail.com>

Just to follow up, I corresponded with the author of pgirmess (Patrick
Giraudoux), and he committed the necessary changes in the correlog function
to CRAN
(updated version of pgirmess is 1.6.0)
http://cran.r-project.org/web/packages/pgirmess/index.html

[if you have trouble getting it through CRAN yet, updated versions of
source or compiled package is available here:
http://giraudoux.pagesperso-orange.fr/]

Best,
Mike

On Tue, Apr 28, 2015 at 1:46 PM, Michael Treglia <mtreglia at gmail.com> wrote:

> Thanks Roger! That solves it.
> Best,
> Mike
>
> On Tue, Apr 28, 2015 at 12:49 PM, Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
>
>> On Tue, 28 Apr 2015, Michael Treglia wrote:
>>
>>  Hi all,
>>>
>>> This is a bit a tangential to the question, but related to
>>> pgirmess::correlog used in this thread, so I thought it appropriate to
>>> follow-up here [if not, apologies - I can start a new thread if that's
>>> preferred].
>>>
>>> In recent exploration with the pgirmess::correlog, I was unable to change
>>> the alternative hypothesis being tested. Since pgirmess::correlog uses
>>> spdep::moran.test, the alternative hypothesis being tested is by default
>>> "greater" (confirmed in the documentation). The help for the function
>>> indicates pgirmess::correlog should also be able to take arguments from
>>> 'moran.test' within it. Thus, users should be able to use the
>>> 'alternative'
>>> argument to change the alternative hypothesis being tested.  When trying
>>> to
>>> use "alternative='less'" (or 'two.sided'), an error is returned:
>>>
>>> Error in try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]], style =
>>> "W")),
>>> :
>>>  unused argument (alternative = "less")
>>>
>>
>> The problem is that the ... is passed to try(), not moran.test() or
>> geary.test() in:
>>
>> xt <- switch(pmatch(method, c("Moran", "Geary"), nomatch = 3),
>>     try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]],
>>         style = "W")), silent = TRUE, ...), try(geary.test(lst.z1[[i]],
>>         nb2listw(lst.nb1[[i]], style = "W")), silent = TRUE,
>>         ...), stop("Method must be 'Moran' or 'Geary'"))
>>
>> With:
>>
>> xt <- switch(pmatch(method, c("Moran", "Geary"), nomatch = 3),
>>     try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]],
>>         style = "W"), ...), silent = TRUE), try(geary.test(lst.z1[[i]],
>>         nb2listw(lst.nb1[[i]], style = "W"), ...), silent = TRUE),
>>         stop("Method must be 'Moran' or 'Geary'"))
>>
>> via for example correlog1 <- edit(correlog), it works. You can save the
>> function for later use too.
>>
>> Hope this helps,
>>
>> Roger
>>
>>
>>
>>
>>> Reproducible Code (based on the example from help for
>>> pgirmess::correlog):
>>>
>>> library(spdep)
>>> library(pgirmess)
>>> data(oldcol)
>>> attach(COL.OLD)
>>> coords<-cbind(X,Y)
>>> res<-correlog(coords,CRIME, method="Moran",
>>> nbclass=NULL,alternative="less")
>>> ## Error in try(moran.test(lst.z1[[i]], nb2listw(lst.nb1[[i]], style =
>>> "W")),  :
>>> ##  unused argument (alternative = "less")
>>>
>>> I corresponded with the author of pgirmess and he did not have a solution
>>> nor much time to work on it. I was hoping to give a go at
>>> trouble-shooting
>>> myself, but haven't had a chance, so this thread seemed like a relevant
>>> place to bring up the issue, so others are at least aware of it.
>>>
>>> Best,
>>> Mike Treglia
>>>
>>>
>>>
>>>
>>>
>>>
>>> On Tue, Apr 28, 2015 at 2:05 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>> wrote:
>>>
>>>  On Tue, 28 Apr 2015, Andy Bunn wrote:
>>>>
>>>>  Hi all, This seems trivial easy but being a bear of very little
>>>> brain...
>>>>
>>>>>
>>>>> I'm looking to build a correlogram using Moran's I and the function
>>>>> sp.correlogram() with data(meuse) as a SpatialPointsDataFrame. I've
>>>>> done
>>>>> so with the ncf library using correlog() but getting the equivalent
>>>>> out of
>>>>> library sp is eluding me. Can somebody help me out?
>>>>>
>>>>>
>>>> require(ncf)
>>>> ncf.cor <- ncf::correlog(x=coordinates(meuse)[,1],
>>>>  y=coordinates(meuse)[,2], z=meuse$zinc, increment=200, resamp=100)
>>>>
>>>> ncf::correlog() chooses bins based on increment. Alternatively,
>>>> pgirmess::correlog() uses by default an optimal number of bins, but can
>>>> use
>>>> a bin count:
>>>>
>>>> library(pgirmess)
>>>> pgir.cor <- pgirmess::correlog(coordinates(meuse), z=meuse$zinc,
>>>> "Moran",
>>>>   nbclass=23)
>>>> plot(pgir.cor[,1], pgir.cor[,2], type="b")
>>>> cbind(pgir.cor[,1], ncf.cor$mean.of.class)
>>>> cbind(pgir.cor[,4], ncf.cor$n)
>>>>
>>>> The differences come from ncf::correlog() constructing the spatial
>>>> weights
>>>> itself, while pgirmess::correlog() uses spdep::dnearneigh() to construct
>>>> them for the distance bins and then spdep::nb2listw() and
>>>> spdep::moran.test() internally in a loop, once for each bin.
>>>>
>>>> spdep::sp.correlogram() follows the original Cliff & Ord understanding
>>>> of
>>>> a spatial correlogram - like time series lags - of order 1, order 2,
>>>> etc.
>>>> The input spatial weights define the weighted graph, so order 2
>>>> neighbours
>>>> are neighbours of order 1 neighbours by stepping out on the graph.
>>>> pgirmess::correlog() was written to use distance rather than graph edge
>>>> count distance:
>>>>
>>>> library(spdep)
>>>> nb200 <- dnearneigh(meuse, 0, 200)
>>>> spdep.cor <- spdep::sp.correlogram(nb200, meuse$zinc, order=23,
>>>>  method="I", zero.policy=TRUE)
>>>> plot(spdep.cor)
>>>>
>>>> To get the implied mean distances for lags of nb200:
>>>>
>>>> nb200_23 <- nblag(nb200, 23)
>>>> mdbins <- sapply(nb200_23, function(x) mean(unlist(nbdists(x, meuse))))
>>>> mdbins
>>>>
>>>> There are two different understandings of this spatial correlogram, the
>>>> C&O one based on time series and counting distance in graph edges, and
>>>> another using distance bands, also found in globalG.test, etc.
>>>>
>>>> Hope this clarifies,
>>>>
>>>> Roger
>>>>
>>>>
>>>>
>>>>  -Andy
>>>>>
>>>>> require(sp)
>>>>> require(ncf)
>>>>> data(meuse)
>>>>> coordinates(meuse) <- ~x+y
>>>>> proj4string(meuse) <- CRS("+init=epsg:28992")
>>>>> ncf.cor <- correlog(x=coordinates(meuse)[,1], y=coordinates(meuse)[,2],
>>>>> z=meuse at data$zinc, increment=200, resamp=100)
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>>  --
>>>> Roger Bivand
>>>> Department of Economics, Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

	[[alternative HTML version deleted]]


