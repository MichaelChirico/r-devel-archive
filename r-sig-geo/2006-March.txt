From Koen.Hufkens at ua.ac.be  Fri Mar  3 14:35:20 2006
From: Koen.Hufkens at ua.ac.be (Hufkens Koen)
Date: Fri, 3 Mar 2006 14:35:20 +0100
Subject: [R-sig-Geo] Fractional brownian surfaces
Message-ID: <6F4167A3F15BC8448499A824129D67E2049DD8A2@xmail04.ad.ua.ac.be>

Hi list,

I'm trying to generate fractional brownian surfaces in R.

[A detailed description with respect to various techniques to generating
these neutral landscapes has been described by Timothy Keitt (spectral
representation of neutral landscapes, Landscape Ecology, 2000) and
probably various other authours.]

Are there any packages that deal with this or related items? I've been
searching and looking at various packages but I only found fSeries to
generate fractional brownian motion time series (1D), but no reference
to 2D applications.

Theoretical papers suggestions to code it myself are welcome as well,
although the previously mentioned paper explains it rather detailed I
still have some loose ends.

So all input would be appreciated.

Best regards,
Koen



From hi_ono2001 at ybb.ne.jp  Fri Mar  3 18:04:05 2006
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Sat, 4 Mar 2006 02:04:05 +0900 (JST)
Subject: [R-sig-Geo] Natural Breaks Classification
In-Reply-To: <71c3c6c50602241428g4f722449p26e59c3839e4f63b@mail.gmail.com>
Message-ID: <20060303170405.24736.qmail@web10702.mail.bbt.yahoo.co.jp>

Hi.

 As you might know, most of Jenks' optimization method
depends on Fischer's "EXACT OPTIMIZATION" METHOD in
(Fisher, W. D., 1958, On grouping for maximum homogeneity.
Journal of the American Statistical Association, 53, 789
?98.).

 This source code is available from following CMU's
statlib site in fortran code.

 http://lib.stat.cmu.edu/cmlib/src/cluster/fish.f

 Jenks' one is available in following paper media.
Probably its in Basic.

 Jenks, G. F. (1977). Optimal data classification for
choropleth maps, Occasional paper No. 2. Lawrence, Kansas:
University of Kansas, Department of Geography. 

 I've ported above code into
Geotools-lite(http://sourceforge.net/project/showfiles.php?group_id=4091)
in Java by modified by J. Macgill.

 Most of Jenks'
code(uk.ac.leeds.ccg.geotools.classification.NaturalBreaks.java)
as follows.

 /**
     * @return int[]
     * @param list com.sun.java.util.collections.ArrayList
     * @param numclass int
     */
    public int[] getJenksBreaks(ArrayList list, int
numclass) {
        
        
        //int numclass;
        int numdata = list.size();
        
        
        double[][] mat1 = new double[numdata + 1][numclass
+ 1];
        double[][] mat2 = new double[numdata + 1][numclass
+ 1];
        double[] st = new double[numdata];
        
        
        for (int i = 1; i <= numclass; i++) {
            mat1[1][i] = 1;
            mat2[1][i] = 0;
            for (int j = 2; j <= numdata; j++)
                mat2[j][i] = Double.MAX_VALUE;
        }
        double v = 0;
        for (int l = 2; l <= numdata; l++) {
            double s1 = 0;
            double s2 = 0;
            double w = 0;
            for (int m = 1; m <= l; m++) {
                int i3 = l - m + 1;

                double val = ((Double)list.get(i3
-1)).doubleValue();
                
                
                s2 += val * val;
                s1 += val;
                
                
                w++;
                v = s2 - (s1 * s1) / w;
                int i4 = i3 - 1;
                if (i4 != 0) {
                    for (int j = 2; j <= numclass; j++) {
                        if (mat2[l][j] >= (v + mat2[i4][j
- 1])) {
                            mat1[l][j] = i3;
                            mat2[l][j] = v + mat2[i4][j -
1];

                        };
                    };
                };
            };
            mat1[l][1] = 1;
            mat2[l][1] = v;
        };
        int k = numdata;
        
        
        int[] kclass = new int[numclass];
        
        
        kclass[numclass - 1] = list.size() - 1;
        
        
        for (int j = numclass; j >= 2; j--) {
            System.out.println("rank = " + mat1[k][j]);
            int id =  (int) (mat1[k][j]) - 2;
            System.out.println("val = " + list.get(id));
            //System.out.println(mat2[k][j]);
            
            
            kclass[j - 2] = id;
            
            
            k = (int) mat1[k][j] - 1;
            
            
        };
        return kclass;
    }
    
    class doubleComp implements Comparator {
    public int compare(Object a, Object b) {
     if (((Double) a).doubleValue() < ((Double)
b).doubleValue())
      return -1;
     if (((Double) a).doubleValue() > ((Double)
b).doubleValue())
      return 1;
     return 0;
    }
    }

 Regards.



From drcarbon at gmail.com  Mon Mar  6 21:35:45 2006
From: drcarbon at gmail.com (Dr Carbon)
Date: Mon, 6 Mar 2006 15:35:45 -0500
Subject: [R-sig-Geo] correlogram from x,y,z data
Message-ID: <e89bb7ac0603061235y237dcb8co3b6bf7b95c028563@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060306/2a1b67c5/attachment.pl>

From gregor.gorjanc at gmail.com  Mon Mar  6 21:50:59 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Mon, 06 Mar 2006 21:50:59 +0100
Subject: [R-sig-Geo] Adding some data as colors to world map
Message-ID: <440CA0B3.8000703@bfro.uni-lj.si>

Hello!

I am a total newbie to map handling, but a keen R user. I have some
estimates by numbers per country (in names, such as Germany, France,
...) and would like to add this information with use of color on world
and perhaps additionally to Europe map. How can this be achieved in R?
Any pointers to relevant literature/tutorials would be fine.

Many thanks!

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From Roger.Bivand at nhh.no  Mon Mar  6 21:58:59 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 6 Mar 2006 21:58:59 +0100 (CET)
Subject: [R-sig-Geo] correlogram from x,y,z data
In-Reply-To: <e89bb7ac0603061235y237dcb8co3b6bf7b95c028563@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0603062141440.26258-100000@reclus.nhh.no>

On Mon, 6 Mar 2006, Dr Carbon wrote:

> HI all: Imagine I have a non sp object. How can I make a correlogram of data
> z that are located by x and y? I'm finding the examples in spdep totally
> opaque since I'm starting from coordinate data. Thanks in advance, DrC.
> 

This is a case where a totally non-informative user name and address, and 
the lack of an affiliation, make it very difficult to respond sensibly. 
Ecologists do these things differently from criminologists, 
epidemiologists, and economists. Knowing your affiliation would be very 
informative.

The function in spdep constructs a correlogram from running the moran() 
function along successive lags from nblags(). If distance is not a 
sensible metric and/or if points are not a sensible representation of your 
objects, this is OK. 

If distance is sensible and points are a sensible representation of your
spatial objects, how you proceed will depend on whether your points are
more or less uniformly spread or not. knearneigh()  will adapt better to
non-uniform spreads, otherwise dnearneigh() may suit you better, for a
first distance band ensuring at least that all points have at least one
neighbour. To get the maximum nearest neighbour distance:

x <- runif(100)
y <- runif(100)
k1 <- knn2nb(knearneigh(cbind(x,y)))
k1dists <- nbdists(k1, cbind(x,y))
max(unlist(k1dists))
d_all <- dnearneigh(cbind(x,y), 0, max(unlist(k1dists)))
summary(d_all)

If sp.correlogam() starts with no-neighbour objects, they stay isolated.

Off-CRAN you can find an implementation using distance bands directly in 
the ncf package at:

http://asi23.ent.psu.edu/onb1/software.html

which may suit you better (if a point representation and just distance 
make sense in your research setting).

> library(spdep)
> x <- runif(100)
> y <- runif(100)
> z <- runif(100)
> k1 <- knn2nb(knearneigh(cbind(x,y)))
> m1 <- moran.test(z,nb2listw(k1))
> sp.correlogram(k1, z, .........)
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon Mar  6 22:40:01 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 6 Mar 2006 22:40:01 +0100 (CET)
Subject: [R-sig-Geo] Adding some data as colors to world map
In-Reply-To: <440CA0B3.8000703@bfro.uni-lj.si>
Message-ID: <Pine.LNX.4.44.0603062231060.26258-100000@reclus.nhh.no>

On Mon, 6 Mar 2006, Gregor Gorjanc wrote:

> Hello!
> 
> I am a total newbie to map handling, but a keen R user. I have some
> estimates by numbers per country (in names, such as Germany, France,
> ...) and would like to add this information with use of color on world
> and perhaps additionally to Europe map. How can this be achieved in R?
> Any pointers to relevant literature/tutorials would be fine.
> 

Welcome! The answer depends on how you want to represent the countries 
graphically. Do you want to display the formatted numbers on a map of 
country borders, to fill the country polygons with colour or shading 
representing the values of the numbers, or maybe to put a filled bubble at 
some point representing the countries?

Which countries? Are they already in the maps package (maybe not, some of 
the borders there are rather out-of-date)?

library(maps)
map("world", xlim=c(-12,35), ylim=c(35,65))

shows you a pretty old version of Europe! There are plenty of sources of 
border maps, but getting something matching the borders you need may 
require a bit of googling (usually looking for a vector representation).

Does anybody have recommended websites for current European national 
border data (preferably in a format we can read)?

Roger

> Many thanks!
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From gregor.gorjanc at gmail.com  Mon Mar  6 23:41:14 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Mon, 06 Mar 2006 23:41:14 +0100
Subject: [R-sig-Geo] Adding some data as colors to world map
In-Reply-To: <Pine.LNX.4.44.0603062231060.26258-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0603062231060.26258-100000@reclus.nhh.no>
Message-ID: <440CBA8A.9020306@bfro.uni-lj.si>

Roger Bivand wrote:
> On Mon, 6 Mar 2006, Gregor Gorjanc wrote:
> 
> 
>>Hello!
>>
>>I am a total newbie to map handling, but a keen R user. I have some
>>estimates by numbers per country (in names, such as Germany, France,
>>...) and would like to add this information with use of color on world
>>and perhaps additionally to Europe map. How can this be achieved in R?
>>Any pointers to relevant literature/tutorials would be fine.
>>
>  
> Welcome! The answer depends on how you want to represent the countries 
> graphically. Do you want to display the formatted numbers on a map of 
> country borders, to fill the country polygons with colour or shading 
> representing the values of the numbers, or maybe to put a filled bubble at 
> some point representing the countries?

Filling country polygons with different colors would be just fine.
Perhaps also filled bubble, but that one might not be so good since our
eyes are bad at interpreting circles. Are there any examples where I
could start with? Say I would like to color Australia with blue, states
with red, Argentina with green etc. I will rather play with some color
palette, but that would be more than great for the start.

> Which countries? Are they already in the maps package (maybe not, some of 
> the borders there are rather out-of-date)?
> 
> library(maps)
> map("world", xlim=c(-12,35), ylim=c(35,65))
> 
> shows you a pretty old version of Europe! There are plenty of sources of 
> border maps, but getting something matching the borders you need may 
> require a bit of googling (usually looking for a vector representation).

Yes, my country is missing ;)

> Does anybody have recommended websites for current European national 
> border data (preferably in a format we can read)?

Hmm, this is then the main bottleneck - the maps.

> 
>>Many thanks!
>>
>>
> 
> 


-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From yong.li at unimelb.edu.au  Tue Mar  7 05:42:00 2006
From: yong.li at unimelb.edu.au (Yong Li)
Date: Tue, 07 Mar 2006 15:42:00 +1100
Subject: [R-sig-Geo] help on "non-square" problem when using write.asciigrid
Message-ID: <6.2.5.6.2.20060307135936.0334cc80@unimelb.edu.au>

Dear Friends,

Can anybody help me for the subject?
When I tried to use write.asciigrid to export a spatialgrid to esri 
ascii grid, I always failed because of the message "non-square grid 
is not support" even I knew my grid is 100% squared.
Yong



From e.pebesma at geo.uu.nl  Tue Mar  7 08:55:00 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 07 Mar 2006 08:55:00 +0100
Subject: [R-sig-Geo] help on "non-square" problem when using
	write.asciigrid
In-Reply-To: <6.2.5.6.2.20060307135936.0334cc80@unimelb.edu.au>
References: <6.2.5.6.2.20060307135936.0334cc80@unimelb.edu.au>
Message-ID: <440D3C54.3050107@geo.uu.nl>

Yong Li wrote:

>Dear Friends,
>
>Can anybody help me for the subject?
>When I tried to use write.asciigrid to export a spatialgrid to esri 
>ascii grid, I always failed because of the message "non-square grid 
>is not support" even I knew my grid is 100% squared.
>Yong
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>
It means that your grid cells are not square, i.e.
they have a different size in x and y direction. Such
a feature is not supported by the asciigrid format.
As an example,

 > library(sp)
 > data(meuse.grid)
 > gridded(meuse.grid) = ~x+y
 > diff(gridparameters(meuse.grid)$cellsize)
[1] 0

--
Edzer



From Roger.Bivand at nhh.no  Tue Mar  7 09:01:35 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Mar 2006 09:01:35 +0100 (CET)
Subject: [R-sig-Geo] Adding some data as colors to world map
In-Reply-To: <440CBA8A.9020306@bfro.uni-lj.si>
Message-ID: <Pine.LNX.4.44.0603070807530.27097-100000@reclus.nhh.no>

On Mon, 6 Mar 2006, Gregor Gorjanc wrote:

> Roger Bivand wrote:
> > On Mon, 6 Mar 2006, Gregor Gorjanc wrote:
> > 
> > 
> >>Hello!
> >>
> >>I am a total newbie to map handling, but a keen R user. I have some
> >>estimates by numbers per country (in names, such as Germany, France,
> >>...) and would like to add this information with use of color on world
> >>and perhaps additionally to Europe map. How can this be achieved in R?
> >>Any pointers to relevant literature/tutorials would be fine.
> >>
> >  
> > Welcome! The answer depends on how you want to represent the countries 
> > graphically. Do you want to display the formatted numbers on a map of 
> > country borders, to fill the country polygons with colour or shading 
> > representing the values of the numbers, or maybe to put a filled bubble at 
> > some point representing the countries?
> 
> Filling country polygons with different colors would be just fine.
> Perhaps also filled bubble, but that one might not be so good since our
> eyes are bad at interpreting circles. Are there any examples where I
> could start with? Say I would like to color Australia with blue, states
> with red, Argentina with green etc. I will rather play with some color
> palette, but that would be more than great for the start.
> 
> > Which countries? Are they already in the maps package (maybe not, some of 
> > the borders there are rather out-of-date)?
> > 
> > library(maps)
> > map("world", xlim=c(-12,35), ylim=c(35,65))
> > 
> > shows you a pretty old version of Europe! There are plenty of sources of 
> > border maps, but getting something matching the borders you need may 
> > require a bit of googling (usually looking for a vector representation).
> 
> Yes, my country is missing ;)
> 
> > Does anybody have recommended websites for current European national 
> > border data (preferably in a format we can read)?
> 
> Hmm, this is then the main bottleneck - the maps.

First hit on google: "world" "shapefile" is:

http://aprsworld.net/gisdata/world/

leading to:

http://data.geocomm.com/editorspicks/data_world11.html

in geographical coordinates and the WGS84 datum; using the MapInfo files 
rather than the derived shapefile without spatial reference system 
metadata:

> library(rgdal)
> world <- readOGR("country_col.TAB", "country_col")
  # takes some considerable time to check the polygons,
  # but save(world, ...) makes this a once only cost
> summary(world)
Object of class SpatialPolygonsDataFrame
Coordinates:
         min       max
r1 -180.0000 180.00000
r2  -59.4409  83.67473
Is projected: FALSE 
proj4string : [+proj=longlat +ellps=WGS84 +towgs84=0,0,0,-0,-0,-0,0 
+no_defs]
Data attributes:
           Country_Name             Capital    Population_approx  
                 :  3                   : 12   Min.   :0.000e+00  
 CANADA          :  2   AVARUA          :  2   1st Qu.:1.715e+05  
 MARSHALL ISLANDS:  2   CHARLOTTE AMALIE:  2   Median :3.819e+06  
 AFGHANISTAN     :  1   KINGSTON        :  2   Mean   :2.535e+07  
 ALBANIA         :  1   MAJURO          :  2   3rd Qu.:1.392e+07  
 ALGERIA         :  1   OTTAWA          :  2   Max.   :1.179e+09  
 (Other)         :233   (Other)         :221                      
      Area         
 Min.   :       0  
 1st Qu.:    2530  
 Median :   78149  
 Mean   :  677622  
 3rd Qu.:  409047  
 Max.   :16631081  

The Country_Name factor isn't quite clean, there are three objects with no 
name, CANADA is included twice, and the MARSHALL ISLANDS entry appears to 
be messed up (appears to be partly the same as the no-name objects).

> world$uCountry_Name <- make.names(as.character(world$Country_Name), 
+ unique=TRUE)

gives something to match against. So now the next thing is to add ISO 
country codes (or other suitable codes) to this dataset, and drop rows 
(and polygons) not present. This looks promising:

http://www.iso.org/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html

and from the left navbar, there's a link to download for TXT, semicolon 
delimited, 5 KB,    XML, zipped file, 3 KB versions. Maybe library(XML) or 
read.csv2()?

> plot(world, xlim=c(-12,35), ylim=c(35,65))

certainly looks much better!

So now we need match these spatial objects to an index, to know which
indexed countries you have in your data, and how to add NAs to country
rows present on the map for which you have no data.

Roger

> 
> > 
> >>Many thanks!
> >>
> >>
> > 
> > 
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Tue Mar  7 09:21:10 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Mar 2006 09:21:10 +0100 (CET)
Subject: [R-sig-Geo] help on "non-square" problem when using
	write.asciigrid
In-Reply-To: <440D3C54.3050107@geo.uu.nl>
Message-ID: <Pine.LNX.4.44.0603070908531.27097-100000@reclus.nhh.no>

On Tue, 7 Mar 2006, Edzer J. Pebesma wrote:

> Yong Li wrote:
> 
> >Dear Friends,
> >
> >Can anybody help me for the subject?
> >When I tried to use write.asciigrid to export a spatialgrid to esri 
> >ascii grid, I always failed because of the message "non-square grid 
> >is not support" even I knew my grid is 100% squared.
> >Yong
> >
> It means that your grid cells are not square, i.e.
> they have a different size in x and y direction. Such
> a feature is not supported by the asciigrid format.
> As an example,
> 
>  > library(sp)
>  > data(meuse.grid)
>  > gridded(meuse.grid) = ~x+y
>  > diff(gridparameters(meuse.grid)$cellsize)
> [1] 0

The line in writeAsciiGrid() in the maptools package is:

	gp = gridparameters(x)
	if (gp$cellsize[1] != gp$cellsize[2])
		stop("Asciigrid does not support grids with non-square cells")

which might be misled by numeric fuzz. (This is the same as 
write.asciigrid() in the sp package). If x is your SpatialGridDataFrame 
object, what does:

print(slot(slot(x, "grid"), "cellsize"), digits=20)

say? If they differ only by fuzz, you could use brute force and say:

slot(slot(x, "grid"), "cellsize") <- 
  rep(mean(slot(slot(x, "grid"), "cellsize")), 2)

or round them to equality (not tried, only for exporting, the bounding 
box will get messed up by this).

As far as I know from the GDAL list, in fact the restriction may be 
spurious, that is while GDAL drivers for Arc ASCII grids required square 
cells, recent Arc software requires rectangular cells, but I'm not sure, 
not checked against Arc documentation.

> 
> --
> Edzer
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mihastaut at yahoo.co.uk  Tue Mar  7 09:22:21 2006
From: mihastaut at yahoo.co.uk (Miha Staut)
Date: Tue, 7 Mar 2006 08:22:21 +0000 (GMT)
Subject: [R-sig-Geo] Adding some data as colors to world map
In-Reply-To: <440CBA8A.9020306@bfro.uni-lj.si>
Message-ID: <20060307082221.87648.qmail@web25412.mail.ukl.yahoo.com>

> > There are plenty of sources of 
> > border maps, but getting something matching the borders you need may 
> > require a bit of googling (usually looking for a vector representation).
> 
> Yes, my country is missing ;)
> 
> > Does anybody have recommended websites for current European national 
> > border data (preferably in a format we can read)?
> 
> Hmm, this is then the main bottleneck - the maps.
> 
> > 
> >>Many thanks!
> >>
> >>

Try this link http://thuban.intevation.org/download.html and search for the
freegis_worlddata either simplified or the detailed map. You may find Slovenia
on both of them. Import the shapefiles with the command read.shape from the
maptools library. The data you want to display in colour are stored in
imported.shp$att.data. So add the column with your data to this data.frame and
plot it with plot as explained in help pages of plot.Map. 

library(maptools)
w.data <- read.shape("countries.shp")
# edit data in w.data$att.data
plot(w.data, auxvar=w.data$att.data$your.variable) 
# play with aditional arguments of plot.Map as "recs" to plot only the european
part, either "fg" or "color" for the color ramp, "type" etc. 

All best, Lep pozdrav,
Miha Staut



From wouter at paramo.be  Tue Mar  7 11:32:21 2006
From: wouter at paramo.be (Wouter Buytaert)
Date: Tue, 7 Mar 2006 10:32:21 +0000 (GMT)
Subject: [R-sig-Geo] C API for sp classes?
Message-ID: <Pine.LNX.4.64.0603071021310.8545@localhost>


Hi,

I want to write some R functions for calculating hydrological 
catchment characteristics from a DEM (topographic index, overland flow 
delay function etc.).

Looks like using a DEM with SpatialGridDataFrame class as an input is a 
good idea.

Then what is the best way to extract the data matrix from this class to 
pass it on to a .C() function which does the actual calculations?

cheers,

wouter



From e.pebesma at geo.uu.nl  Tue Mar  7 16:45:29 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 07 Mar 2006 15:45:29 +0000
Subject: [R-sig-Geo] C API for sp classes?
In-Reply-To: <Pine.LNX.4.64.0603071021310.8545@localhost>
References: <Pine.LNX.4.64.0603071021310.8545@localhost>
Message-ID: <440DAA99.9060804@geo.uu.nl>

Wouter, if you want to use the .C interface, you need to pass
the maps as simple vectors. I would pass one with the map
values, and one with the topology. Below is some example
code how to get them. An R function should be used to do
the coercion to double arrays, and wrap the .C call.

Please note that a SpatialGridDataFrame can actually hold
more than one attribute (map).
--
Edzer

For getting the values:

 > library(sp)
 > data(meuse.grid)
 > gridded(meuse.grid)=~x+y
 > fullgrid(meuse.grid)=T
 > meuse.grid at data@att[[1]] # first attribute
 [1] NA NA NA NA NA NA NA NA NA NA ...
 >

Getting the topology:

 > meuse.grid at grid
                       x      y
cellcentre.offset 178460 329620
cellsize              40     40
cells.dim             78    104
 > class(meuse.grid at grid)
[1] "GridTopology"
attr(,"package")
[1] "sp"
 > unlist(gridtopology(meuse.grid))
Error in unlist(gridtopology(meuse.grid)) :
        couldn't find function "gridtopology"
 > unlist(gridparameters(meuse.grid))
cellcentre.offset1 cellcentre.offset2          cellsize1          cellsize2
            178460             329620                 40                 40
        cells.dim1         cells.dim2
                78                104
 > as.double(unlist(gridparameters(meuse.grid)))
[1] 178460 329620     40     40     78    104
 >


Wouter Buytaert wrote:

>Hi,
>
>I want to write some R functions for calculating hydrological 
>catchment characteristics from a DEM (topographic index, overland flow 
>delay function etc.).
>
>Looks like using a DEM with SpatialGridDataFrame class as an input is a 
>good idea.
>
>Then what is the best way to extract the data matrix from this class to 
>pass it on to a .C() function which does the actual calculations?
>
>cheers,
>
>wouter
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>



From Roger.Bivand at nhh.no  Tue Mar  7 16:15:17 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Mar 2006 16:15:17 +0100 (CET)
Subject: [R-sig-Geo] C API for sp classes?
In-Reply-To: <440DAA99.9060804@geo.uu.nl>
Message-ID: <Pine.LNX.4.44.0603071608080.27232-100000@reclus.nhh.no>

On Tue, 7 Mar 2006, Edzer J. Pebesma wrote:

> Wouter, if you want to use the .C interface, you need to pass
> the maps as simple vectors. I would pass one with the map
> values, and one with the topology. Below is some example
> code how to get them. An R function should be used to do
> the coercion to double arrays, and wrap the .C call.

Is the overhead of learning and using the .Call() interface too great? As 
Edzer says, since the AttributeList can contain multiple vectors of 
possibly different types, it may be helpful to get a better grip on them 
that way. The geometry slots are more complicated, and would need more 
thought, though, but would be needed to make a raster, as Edzer shows.

Interesting issue. What would be returned? I guess in fact that a .C() 
interface with a more complicated R function to pick everything apart and 
check types is the way to go for prototyping. What would you use as 
baseline for comparison to see if your output is plausible?

Roger

> 
> Please note that a SpatialGridDataFrame can actually hold
> more than one attribute (map).
> --
> Edzer
> 
> For getting the values:
> 
>  > library(sp)
>  > data(meuse.grid)
>  > gridded(meuse.grid)=~x+y
>  > fullgrid(meuse.grid)=T
>  > meuse.grid at data@att[[1]] # first attribute
>  [1] NA NA NA NA NA NA NA NA NA NA ...
>  >
> 
> Getting the topology:
> 
>  > meuse.grid at grid
>                        x      y
> cellcentre.offset 178460 329620
> cellsize              40     40
> cells.dim             78    104
>  > class(meuse.grid at grid)
> [1] "GridTopology"
> attr(,"package")
> [1] "sp"
>  > unlist(gridtopology(meuse.grid))
> Error in unlist(gridtopology(meuse.grid)) :
>         couldn't find function "gridtopology"
>  > unlist(gridparameters(meuse.grid))
> cellcentre.offset1 cellcentre.offset2          cellsize1          cellsize2
>             178460             329620                 40                 40
>         cells.dim1         cells.dim2
>                 78                104
>  > as.double(unlist(gridparameters(meuse.grid)))
> [1] 178460 329620     40     40     78    104
>  >
> 
> 
> Wouter Buytaert wrote:
> 
> >Hi,
> >
> >I want to write some R functions for calculating hydrological 
> >catchment characteristics from a DEM (topographic index, overland flow 
> >delay function etc.).
> >
> >Looks like using a DEM with SpatialGridDataFrame class as an input is a 
> >good idea.
> >
> >Then what is the best way to extract the data matrix from this class to 
> >pass it on to a .C() function which does the actual calculations?
> >
> >cheers,
> >
> >wouter
> >
> >_______________________________________________
> >R-sig-Geo mailing list
> >R-sig-Geo at stat.math.ethz.ch
> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >  
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Giovanni_Millo at generali.com  Tue Mar  7 16:26:05 2006
From: Giovanni_Millo at generali.com (Millo Giovanni)
Date: Tue, 7 Mar 2006 16:26:05 +0100
Subject: [R-sig-Geo] R: Adding some data as colors to world map
Message-ID: <74F2D4ED68558643B63A6CC21746040D056F08A9@BEMAILEXTS1.ad.generali.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060307/3bb47978/attachment.pl>

From wouter at paramo.be  Tue Mar  7 17:04:11 2006
From: wouter at paramo.be (Wouter Buytaert)
Date: Tue, 7 Mar 2006 16:04:11 +0000 (GMT)
Subject: [R-sig-Geo] C API for sp classes?
In-Reply-To: <Pine.LNX.4.44.0603071608080.27232-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0603071608080.27232-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.64.0603071541340.8545@localhost>


Thanks for the info!

Learning the .Call interface is certainly no problem of course. I just 
thought about going with .C() because:

- the "writing R extensions" manual says you should consider .C before 
using .Call
- it is easy to pass the map values as a double vector, and only a few 
additional parameters have to be passed on (resolution, number of 
rows/cols etc...), so using .C() is quite straightforward.
- I prefer doing a datacheck in R before passing the data to .C()

The resulting R function doesn't seem very complicated. I'm a newbie 
though, so all recommendations welcome:

topidx <- function(map) {

if(!(class(map) == "SpatialGridDataFrame"))
 	printf("Map should be of SpatialGridDataFrame class")

values <- map at data@att[[1]]
ew_res <- map at grid@cellsize[1]
ns_res <- map at grid@cellsize[2]
cols <- map at grid@cells.dim[1]
rows <- map at grid@cells.dim[2]

# here comes al sorts of data check and NA handling...

   .C("topidx",
 	PACKAGE = "mypackage",
 	as.double(values),
 	as.integer(rows),
 	as.integer(cols),
 	as.double(ew_res),
 	as.double(ns_res),
 	topidxmap = double(rows*cols))$topidxmap

# return is a double vector which can be postprocessed here...
}

cheers
wouter

On Tue, 7 Mar 2006, Roger Bivand wrote:

> On Tue, 7 Mar 2006, Edzer J. Pebesma wrote:
>
>> Wouter, if you want to use the .C interface, you need to pass
>> the maps as simple vectors. I would pass one with the map
>> values, and one with the topology. Below is some example
>> code how to get them. An R function should be used to do
>> the coercion to double arrays, and wrap the .C call.
>
> Is the overhead of learning and using the .Call() interface too great? As
> Edzer says, since the AttributeList can contain multiple vectors of
> possibly different types, it may be helpful to get a better grip on them
> that way. The geometry slots are more complicated, and would need more
> thought, though, but would be needed to make a raster, as Edzer shows.
>
> Interesting issue. What would be returned? I guess in fact that a .C()
> interface with a more complicated R function to pick everything apart and
> check types is the way to go for prototyping. What would you use as
> baseline for comparison to see if your output is plausible?
>
> Roger
>
>>
>> Please note that a SpatialGridDataFrame can actually hold
>> more than one attribute (map).
>> --
>> Edzer
>>
>> For getting the values:
>>
>> > library(sp)
>> > data(meuse.grid)
>> > gridded(meuse.grid)=~x+y
>> > fullgrid(meuse.grid)=T
>> > meuse.grid at data@att[[1]] # first attribute
>>  [1] NA NA NA NA NA NA NA NA NA NA ...
>> >
>>
>> Getting the topology:
>>
>> > meuse.grid at grid
>>                        x      y
>> cellcentre.offset 178460 329620
>> cellsize              40     40
>> cells.dim             78    104
>> > class(meuse.grid at grid)
>> [1] "GridTopology"
>> attr(,"package")
>> [1] "sp"
>> > unlist(gridtopology(meuse.grid))
>> Error in unlist(gridtopology(meuse.grid)) :
>>         couldn't find function "gridtopology"
>> > unlist(gridparameters(meuse.grid))
>> cellcentre.offset1 cellcentre.offset2          cellsize1          cellsize2
>>             178460             329620                 40                 40
>>         cells.dim1         cells.dim2
>>                 78                104
>> > as.double(unlist(gridparameters(meuse.grid)))
>> [1] 178460 329620     40     40     78    104
>> >
>>
>>
>> Wouter Buytaert wrote:
>>
>>> Hi,
>>>
>>> I want to write some R functions for calculating hydrological
>>> catchment characteristics from a DEM (topographic index, overland flow
>>> delay function etc.).
>>>
>>> Looks like using a DEM with SpatialGridDataFrame class as an input is a
>>> good idea.
>>>
>>> Then what is the best way to extract the data matrix from this class to
>>> pass it on to a .C() function which does the actual calculations?
>>>
>>> cheers,
>>>
>>> wouter
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>



From b.rowlingson at lancaster.ac.uk  Tue Mar  7 17:24:12 2006
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 07 Mar 2006 16:24:12 +0000
Subject: [R-sig-Geo] C API for sp classes?
In-Reply-To: <Pine.LNX.4.64.0603071541340.8545@localhost>
References: <Pine.LNX.4.44.0603071608080.27232-100000@reclus.nhh.no>
	<Pine.LNX.4.64.0603071541340.8545@localhost>
Message-ID: <440DB3AC.2000503@lancaster.ac.uk>

Wouter Buytaert wrote:

> The resulting R function doesn't seem very complicated. I'm a newbie 
> though, so all recommendations welcome:
> 
> topidx <- function(map) {
> 
> if(!(class(map) == "SpatialGridDataFrame"))
>  	printf("Map should be of SpatialGridDataFrame class")
>

  Recommendation number 1 - read all about Object-Oriented Programming!

  You shouldn't have a function that tests the class of an object, you 
should write a generic function and a method for your class.

  With S3 methods this was easy, you wrote a generic function called 
'topidx' and then a method for SpatialWhateverObject called 
topidx.SpatialWhateverObject. Then your topidx.SpatialWhateverObject() 
function could be pretty sure it was getting something that was a 
SpatialWhateverObject. I've never got my head round the new S4 class 
stuff, but sp uses it widely so check out Edzer's code, he's a master :)

  The reason explicit checks for class(foo) are wrong is because your 
object might not be of that class, but might inherit from that class, ie 
be a superclass of SpatialGridDataFrame. Add to that the fact that 
class() can be a vector:

  > class(glm(y~x))
  [1] "glm" "lm"

  If you really have to check to see if the object you are being passed 
is of the right sort, use 'inherits':

  > inherits(glm(y~x),'lm')
  [1] TRUE
  > inherits(glm(y~x),'glm')
  [1] TRUE

This should be sufficient to guarantee that the object implements the 
functionality you need to do your work.

Otherwise, I vote for .Call() :)

  Barry



From tkeitt at mail.utexas.edu  Tue Mar  7 17:55:13 2006
From: tkeitt at mail.utexas.edu (Tim Keitt)
Date: Tue, 07 Mar 2006 10:55:13 -0600
Subject: [R-sig-Geo] C API for sp classes?
In-Reply-To: <440DB3AC.2000503@lancaster.ac.uk>
References: <Pine.LNX.4.44.0603071608080.27232-100000@reclus.nhh.no>
	<Pine.LNX.4.64.0603071541340.8545@localhost>
	<440DB3AC.2000503@lancaster.ac.uk>
Message-ID: <1141750513.31888.34.camel@patagonicus.keittlab.net>

On Tue, 2006-03-07 at 16:24 +0000, Barry Rowlingson wrote:
> Wouter Buytaert wrote:
> 
> > The resulting R function doesn't seem very complicated. I'm a newbie 
> > though, so all recommendations welcome:
> > 
> > topidx <- function(map) {
> > 
> > if(!(class(map) == "SpatialGridDataFrame"))
> >  	printf("Map should be of SpatialGridDataFrame class")
> >
> 
>   Recommendation number 1 - read all about Object-Oriented Programming!
> 
>   You shouldn't have a function that tests the class of an object, you 
> should write a generic function and a method for your class.

That's a rather odd aspect of S methods -- even if you only want to call
the function for a single class, you have to create a generic function.
In cases where I'm not wanting polymorphic behavior (the function really
only makes sense for a single class), I tend to write ordinary functions
and either test for class membership or just document that the passed
object should be of the appropriate class. When the function will be
called on multiple classes, then it is worth defining a generic
function. Making everything generic is too much overhead.

THK


-- 
Timothy H. Keitt
Assistant Professor
http://www.keittlab.org/
http://www.utexas.edu/directory/index.php?q=Keitt



From b.rowlingson at lancaster.ac.uk  Tue Mar  7 18:39:59 2006
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 07 Mar 2006 17:39:59 +0000
Subject: [R-sig-Geo] C API for sp classes?
In-Reply-To: <1141750513.31888.34.camel@patagonicus.keittlab.net>
References: <Pine.LNX.4.44.0603071608080.27232-100000@reclus.nhh.no>	<Pine.LNX.4.64.0603071541340.8545@localhost>	<440DB3AC.2000503@lancaster.ac.uk>
	<1141750513.31888.34.camel@patagonicus.keittlab.net>
Message-ID: <440DC56F.60503@lancaster.ac.uk>

Tim Keitt wrote:

> That's a rather odd aspect of S methods 

  one of many :)

>-- even if you only want to call
> the function for a single class, you have to create a generic function.
> In cases where I'm not wanting polymorphic behavior (the function really
> only makes sense for a single class), I tend to write ordinary functions
> and either test for class membership or just document that the passed
> object should be of the appropriate class. When the function will be
> called on multiple classes, then it is worth defining a generic
> function. Making everything generic is too much overhead.

  I think this stems from the S3 way that what other languages call 
"methods of objects", R has as global namespace functions. In Python for 
example, the method name is tied to the object, so you do: foo.bar() 
instead of bar(foo). S3 shoe-horned the OO paradigm into the existing 
functional syntax instead of extending the syntax such that methods were 
true properties of objects. S4 methods continue this (IMHO) poor design 
choice, and then tries to tidy up by having 'namespaces' declared in 
packages - but at least it has a more formal method for declaring 
methods instead of S3's reliance on <generic>.<class> naming scheme!

  If I could transparently bind all the statistical and graphical 
functionality of R with the Python language I'd be happy :)[1]

Barry

[1] Yeah, I know there are R-Python links but they're not quite 
transparent enough....



From tkeitt at mail.utexas.edu  Tue Mar  7 20:01:17 2006
From: tkeitt at mail.utexas.edu (Tim Keitt)
Date: Tue, 07 Mar 2006 13:01:17 -0600
Subject: [R-sig-Geo] C API for sp classes?
In-Reply-To: <440DC56F.60503@lancaster.ac.uk>
References: <Pine.LNX.4.44.0603071608080.27232-100000@reclus.nhh.no>
	<Pine.LNX.4.64.0603071541340.8545@localhost>
	<440DB3AC.2000503@lancaster.ac.uk>
	<1141750513.31888.34.camel@patagonicus.keittlab.net>
	<440DC56F.60503@lancaster.ac.uk>
Message-ID: <1141758077.8868.8.camel@patagonicus.keittlab.net>

On Tue, 2006-03-07 at 17:39 +0000, Barry Rowlingson wrote:
> Tim Keitt wrote:
> 
> > That's a rather odd aspect of S methods 
> 
>   one of many :)
> 
>   I think this stems from the S3 way that what other languages call 
> "methods of objects", R has as global namespace functions. In Python for 
> example, the method name is tied to the object, so you do: foo.bar() 
> instead of bar(foo). S3 shoe-horned the OO paradigm into the existing 
> functional syntax instead of extending the syntax such that methods were 
> true properties of objects. S4 methods continue this (IMHO) poor design 
> choice, and then tries to tidy up by having 'namespaces' declared in 
> packages - but at least it has a more formal method for declaring 

I couldn't agree more. It seems namespaces in R confuse binding names to
namespaces with encapsulation (hiding symbols within packages). For
efficiency reasons, your forced to export all your public symbols into
the global namespace anyway. Ugh!

As you point out, it would be nice if classes defined namespaces so that
methods could be attached to the class as in C++ and Python. Of course
programming S/R would not be nearly so much fun if it didn't have so
many quirks... :-)

> methods instead of S3's reliance on <generic>.<class> naming scheme!

I do prefer S4 methods. On the other hand, I found they really slowed my
rate of programming. Several of my packaging projects (DBI.PgSQL) got
derailed while I came up to speed with S4 methods.

THK

> 
>   If I could transparently bind all the statistical and graphical 
> functionality of R with the Python language I'd be happy :)[1]
> 
> Barry
> 
> [1] Yeah, I know there are R-Python links but they're not quite 
> transparent enough....
-- 
Timothy H. Keitt
Assistant Professor
http://www.keittlab.org/
http://www.utexas.edu/directory/index.php?q=Keitt



From e.pebesma at geo.uu.nl  Tue Mar  7 22:52:06 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 07 Mar 2006 21:52:06 +0000
Subject: [R-sig-Geo] C API for sp classes?
In-Reply-To: <440DB3AC.2000503@lancaster.ac.uk>
References: <Pine.LNX.4.44.0603071608080.27232-100000@reclus.nhh.no>	<Pine.LNX.4.64.0603071541340.8545@localhost>
	<440DB3AC.2000503@lancaster.ac.uk>
Message-ID: <440E0086.2010809@geo.uu.nl>

Barry Rowlingson wrote:

>Wouter Buytaert wrote:
>
>  
>
>>The resulting R function doesn't seem very complicated. I'm a newbie 
>>though, so all recommendations welcome:
>>
>>topidx <- function(map) {
>>
>>if(!(class(map) == "SpatialGridDataFrame"))
>> 	printf("Map should be of SpatialGridDataFrame class")
>>
>>    
>>
>
>  Recommendation number 1 - read all about Object-Oriented Programming!
>
>  
>
Wouter, I have never completely understood Barry's reservations against
the S4 object orientation framework, which he never managed (or wanted?) to
get a real grip on; please don't let it intimidate you. There are many 
ways of
checking for classes; I would prefer is(map, "SpatialGridDataFrame") because
it will then work as well for classes that are derived from 
SpatialGridDataFrame.

Another issue in this thread: R namespaces and S4 classes are two rather
different issues; at some areas they even seem not to work together too 
well.
Ask Roger (in private, please!) for details, or search through r-devel.

>Otherwise, I vote for .Call() :)
>
>  
>

I managed to have package gstat using exclusively .Call() at some
stage, but had to work into poorly documented areas of this interface:
R has quite a different way of dealing with strings than that documented
in the green book (Programming with data, J. Chambers).

The final pleasure was mostly that of aesthetics, and had nothing
to do with "good code".
--
Edzer



From Roger.Bivand at nhh.no  Wed Mar  8 18:54:23 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 8 Mar 2006 18:54:23 +0100 (CET)
Subject: [R-sig-Geo] Adding some data as colors to world map
In-Reply-To: <440CBA8A.9020306@bfro.uni-lj.si>
Message-ID: <Pine.LNX.4.44.0603081847290.31842-100001@reclus.nhh.no>

On Mon, 6 Mar 2006, Gregor Gorjanc wrote:

> Roger Bivand wrote:
> > On Mon, 6 Mar 2006, Gregor Gorjanc wrote:
> > 
> > 
> >>Hello!
> >>
> >>I am a total newbie to map handling, but a keen R user. I have some
> >>estimates by numbers per country (in names, such as Germany, France,
> >>...) and would like to add this information with use of color on world
> >>and perhaps additionally to Europe map. How can this be achieved in R?
> >>Any pointers to relevant literature/tutorials would be fine.
> >>
> >  
> > Welcome! The answer depends on how you want to represent the countries 
> > graphically. Do you want to display the formatted numbers on a map of 
> > country borders, to fill the country polygons with colour or shading 
> > representing the values of the numbers, or maybe to put a filled bubble at 
> > some point representing the countries?
> 
> Filling country polygons with different colors would be just fine.
> Perhaps also filled bubble, but that one might not be so good since our
> eyes are bad at interpreting circles. Are there any examples where I
> could start with? Say I would like to color Australia with blue, states
> with red, Argentina with green etc. I will rather play with some color
> palette, but that would be more than great for the start.
> 
> > Which countries? Are they already in the maps package (maybe not, some of 
> > the borders there are rather out-of-date)?
> > 
> > library(maps)
> > map("world", xlim=c(-12,35), ylim=c(35,65))
> > 
> > shows you a pretty old version of Europe! There are plenty of sources of 
> > border maps, but getting something matching the borders you need may 
> > require a bit of googling (usually looking for a vector representation).
> 
> Yes, my country is missing ;)
> 
> > Does anybody have recommended websites for current European national 
> > border data (preferably in a format we can read)?
> 
> Hmm, this is then the main bottleneck - the maps.

I've produced a world map with ISO3166 two-letter codes. To get your codes 
right - this lists out country names and codes:

as(world_countries, "data.frame")

then

countries <- c("AU", "US", "AR")
colours <- c("blue", "red", "green")
plot(world_countries, col=colours[match(world_countries$ISO3166, countries)])

gives the attached PNG. Shall I make an .RData file of the
SpatialPolygonsDataFrame object available?

Roger


> 
> > 
> >>Many thanks!
> >>
> >>
> > 
> > 
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

-------------- next part --------------
A non-text attachment was scrubbed...
Name: coloured_countries.png
Type: image/png
Size: 5492 bytes
Desc: 
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060308/df991255/attachment.png>

From spluque at gmail.com  Thu Mar  9 13:49:32 2006
From: spluque at gmail.com (Sebastian Luque)
Date: Thu, 09 Mar 2006 06:49:32 -0600
Subject: [R-sig-Geo] function for bearing
Message-ID: <87pskv236r.fsf@arctocephalus.homelinux.org>

Hello,

I have searched the archives and other sources, but cannot find an R
function that would calculate the bearing of a pair of points (lat, lon).
It wouldn't be difficult to write such a function, but has this already
been done in a package?


Thanks in advance,

-- 
Sebastian P. Luque



From tkeitt at mail.utexas.edu  Thu Mar  9 17:05:02 2006
From: tkeitt at mail.utexas.edu (Tim Keitt)
Date: Thu, 09 Mar 2006 10:05:02 -0600
Subject: [R-sig-Geo] function for bearing
In-Reply-To: <87pskv236r.fsf@arctocephalus.homelinux.org>
References: <87pskv236r.fsf@arctocephalus.homelinux.org>
Message-ID: <1141920303.7249.13.camel@patagonicus.keittlab.net>

I believe this can be done in PROJ by simply dumping the points as ASCII
and then calling 'geod' on the command line.

THK

On Thu, 2006-03-09 at 06:49 -0600, Sebastian Luque wrote:
> Hello,
> 
> I have searched the archives and other sources, but cannot find an R
> function that would calculate the bearing of a pair of points (lat, lon).
> It wouldn't be difficult to write such a function, but has this already
> been done in a package?
> 
> 
> Thanks in advance,
> 
-- 
Timothy H. Keitt
Assistant Professor
http://www.keittlab.org/
http://www.utexas.edu/directory/index.php?q=Keitt



From Roger.Bivand at nhh.no  Thu Mar  9 18:06:48 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Mar 2006 18:06:48 +0100 (CET)
Subject: [R-sig-Geo] function for bearing
In-Reply-To: <87pskv236r.fsf@arctocephalus.homelinux.org>
Message-ID: <Pine.LNX.4.44.0603091620250.951-100000@reclus.nhh.no>

On Thu, 9 Mar 2006, Sebastian Luque wrote:

> Hello,
> 
> I have searched the archives and other sources, but cannot find an R
> function that would calculate the bearing of a pair of points (lat, lon).
> It wouldn't be difficult to write such a function, but has this already
> been done in a package?

I've an implementation that I will add to sp or maptools. It calculates 
the azimuth using Snyder's spherical equations (p. 30), or an equivalent 
solution by Abdali:

gzAzimuth <- function(from, to, type="snyder_sphere") {
  deg2rad <- function(x) x*pi/180
  rad2deg <- function(x) x*180/pi
# note negative longitudes
  if (is.matrix(from)) {
    lon <- -deg2rad(from[,1])
    lat <- deg2rad(from[,2])
  } else {
    lon <- -deg2rad(from[1])
    lat <- deg2rad(from[2])
  }
  if (is.matrix(to)) {
    if (nrow(to) > 1) stop("to: single coordinate")
    to <- c(to)
  } else {
    lon0 <- -deg2rad(to[1])
    lat0 <- deg2rad(to[2])
  }
  dflon = lon-lon0
# results in degrees from N, negative west
  if (type == "abdali") res <- atan2(sin(dflon), ((cos(lat)*tan(lat0)) -
    (sin(lat)*cos(dflon))))
  else if (type == "snyder_sphere") res <- atan2((cos(lat0)*sin(dflon)), 
    (cos(lat)*sin(lat0)) - (sin(lat)*cos(lat0)*cos(dflon)))
  else stop("type unkown")
  is.na(res) <- lon == lon0 & lat == lat0 
  rad2deg(res)
}

There is a very interesting discussion of the centrality of 
azimuth-finding in the development of mathematics and mathematical 
geography in: http://patriot.net/users/abdali/ftp/qibla.pdf. Among others, 
al-Khwarizmi was an important contributor.

It seems to work like Tim Keitt's suggestion:

> gzAzimuth(c(10,50), c(70,20))
[1] 99.76647
> 99 + (45 + (59.287/60))/60
[1] 99.76647

$ geod +ellps=sphere << EOF -I
> 50N 10E 20N 70E
> EOF
99d45'59.287"   -42d23'10.939"  6189790.454

The first argument to the function can be a matrix of coordinates, the 
second is a single coordinate.

Roger

> 
> 
> Thanks in advance,
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From yong.li at unimelb.edu.au  Fri Mar 10 00:17:37 2006
From: yong.li at unimelb.edu.au (Yong Li)
Date: Fri, 10 Mar 2006 10:17:37 +1100
Subject: [R-sig-Geo] Convert esri shape files to esri ascii grid from R
Message-ID: <6.2.5.6.2.20060310101330.033976f0@unimelb.edu.au>

Hi R spatial experts,

Has anybody done the conversion of esri shape files to esri ascii 
grid based on field values in R?
I knew it can be done easily in Arcview using avenue. But if it can 
be done in R, that will fly my daily work loads.

Regards

Yong



From Tom.Mulholland at dpi.wa.gov.au  Fri Mar 10 02:13:58 2006
From: Tom.Mulholland at dpi.wa.gov.au (Mulholland, Tom)
Date: Fri, 10 Mar 2006 09:13:58 +0800
Subject: [R-sig-Geo] Convert esri shape files to esri ascii grid from R
Message-ID: <4702645135092E4497088F71D9C8F51A0224E4DA@afhex01.dpi.wa.gov.au>

I didn't know how to do this offhand, but a little research soon found a way. So I think you need to search the existing resources before asking your question as my basic search from R 

>RSiteSearch("esri grid") 

returned write.asciigrid as the first response. Since I routinely read shapefiles into sp classes (readShapePoints in maptools) it's the conversion of one to another. 

The overview PDF file in the sp package gives an example on converting points to grids ("5.2 Creating grids from points".)

It would appear that you just need to familarise yourself with what's in sp and maptools. I would suggest looking through previous posts on this list with regard to shapefiles which will give you an understanding of some of the limitations that you might bump into. For example (I don't know if it is still true) I have some point shapefiles that don't seem to be currently supported.

Tom

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]On Behalf Of Yong Li
> Sent: Friday, 10 March 2006 7:18 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Convert esri shape files to esri ascii 
> grid from R
> 
> 
> Hi R spatial experts,
> 
> Has anybody done the conversion of esri shape files to esri ascii 
> grid based on field values in R?
> I knew it can be done easily in Arcview using avenue. But if it can 
> be done in R, that will fly my daily work loads.
> 
> Regards
> 
> Yong
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From spluque at gmail.com  Fri Mar 10 02:51:31 2006
From: spluque at gmail.com (Sebastian Luque)
Date: Thu, 09 Mar 2006 19:51:31 -0600
Subject: [R-sig-Geo] function for bearing
References: <87pskv236r.fsf@arctocephalus.homelinux.org>
	<Pine.LNX.4.44.0603091620250.951-100000@reclus.nhh.no>
Message-ID: <871wxbgj8c.fsf@arctocephalus.homelinux.org>

Thank you all for your suggestions and reference (very interesting
indeed).


Cheers,

-- 
Sebastian P. Luque



From Roger.Bivand at nhh.no  Fri Mar 10 11:08:39 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Mar 2006 11:08:39 +0100 (CET)
Subject: [R-sig-Geo] Convert esri shape files to esri ascii grid from R
In-Reply-To: <4702645135092E4497088F71D9C8F51A0224E4DA@afhex01.dpi.wa.gov.au>
Message-ID: <Pine.LNX.4.44.0603100957410.4653-100000@reclus.nhh.no>

On Fri, 10 Mar 2006, Mulholland, Tom wrote:

> I didn't know how to do this offhand, but a little research soon found a
> way. So I think you need to search the existing resources before asking
> your question as my basic search from R
> 
> >RSiteSearch("esri grid") 
> 
> returned write.asciigrid as the first response. Since I routinely read
> shapefiles into sp classes (readShapePoints in maptools) it's the
> conversion of one to another.
> 
> The overview PDF file in the sp package gives an example on converting
> points to grids ("5.2 Creating grids from points".)
> 
> It would appear that you just need to familarise yourself with what's in
> sp and maptools. I would suggest looking through previous posts on this
> list with regard to shapefiles which will give you an understanding of
> some of the limitations that you might bump into. For example (I don't
> know if it is still true) I have some point shapefiles that don't seem
> to be currently supported.

Thanks, Tom, there are ways in sp/maptools, but not all of the 
possibilities have been explored - it turns out that there are (many) more 
than we thought of in developing sp classes.

Some notes from trying this out:

library(maptools)
nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
  IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
ncbb <- bbox(nc)
xymin <- ncbb[,1]
r_xy <- apply(ncbb, 1, diff)
resol <- 0.1 # here taken as ew=ns
ncells <- ceiling(r_xy/resol)
grd <- GridTopology(cellcentre.offset=xymin, cellsize=c(resol, resol), 
  cells.dim=ncells)
pts <- SpatialPoints(coordinates(grd), proj4string=CRS(proj4string(nc)))
pts_polys <- overlay(pts, nc)
pts_BIR74 <- nc$BIR74[pts_polys]
pts1 <- SpatialPointsDataFrame(pts, data=as(data.frame(BIR74=pts_BIR74), 
  "AttributeList"))
gridded(pts1) <- TRUE
pal <- colorRampPalette(c("wheat1", "red3"))(4)
brks <- quantile(nc$BIR74)
par(mfrow=c(3,1))
plot(nc, col=pal[findInterval(nc$BIR74, brks, all.inside=TRUE)], 
  axes=TRUE)
image(pts1, col=pal, breaks=brks, axes=TRUE)
plot(nc, add=TRUE)
fname <- tempfile()
writeAsciiGrid(pts1, fname) # note that this will not work now because
  # machine fuzz in the calculated resolution gets in the way, fixed in 
  # next maptools release, for now, the kludge is:
  # slot(slot(pts1, "grid"), "cellsize") <- rep(mean(slot(slot(pts1, 
  # "grid"), "cellsize")), 2)
rpts1 <- readAsciiGrid(fname, proj4string=CRS(proj4string(pts1)))
image(rpts1, col=pal, breaks=brks, axes=TRUE)
par(mfrow=c(1,1))

The steps are to make a GridTopology object from the input 
SpatialPolygons, get its coordinates, overlay() the coordinates on the 
polygons, retrieve the required data - could be multiple variables, adding 
it to the SpatialPoints object, grid the object, and write out.

In the new version of rgdal, you'll find that writing out rasters in other 
formats is well-supported, including their spatial reference system 
metadata - the same applies to reading vector data (but not yet writing 
vector data).

I guess that a function to make GridTopology objects from SpatialPolygons 
may enter maptools before long.

Comments, suggestions?

Roger


> 
> Tom
> 
> > -----Original Message-----
> > From: r-sig-geo-bounces at stat.math.ethz.ch
> > [mailto:r-sig-geo-bounces at stat.math.ethz.ch]On Behalf Of Yong Li
> > Sent: Friday, 10 March 2006 7:18 AM
> > To: r-sig-geo at stat.math.ethz.ch
> > Subject: [R-sig-Geo] Convert esri shape files to esri ascii 
> > grid from R
> > 
> > 
> > Hi R spatial experts,
> > 
> > Has anybody done the conversion of esri shape files to esri ascii 
> > grid based on field values in R?
> > I knew it can be done easily in Arcview using avenue. But if it can 
> > be done in R, that will fly my daily work loads.
> > 
> > Regards
> > 
> > Yong
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Fri Mar 10 11:10:06 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Fri, 10 Mar 2006 11:10:06 +0100
Subject: [R-sig-Geo] Convert esri shape files to esri ascii grid from R
In-Reply-To: <Pine.LNX.4.44.0603100957410.4653-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0603100957410.4653-100000@reclus.nhh.no>
Message-ID: <4411507E.5050808@geo.uu.nl>

Roger Bivand wrote:

>On Fri, 10 Mar 2006, Mulholland, Tom wrote:
>
>  
>
>>I didn't know how to do this offhand, but a little research soon found a
>>way. So I think you need to search the existing resources before asking
>>your question as my basic search from R
>>
>>    
>>
>>>RSiteSearch("esri grid") 
>>>      
>>>
>>returned write.asciigrid as the first response. Since I routinely read
>>shapefiles into sp classes (readShapePoints in maptools) it's the
>>conversion of one to another.
>>
>>The overview PDF file in the sp package gives an example on converting
>>points to grids ("5.2 Creating grids from points".)
>>
>>It would appear that you just need to familarise yourself with what's in
>>sp and maptools. I would suggest looking through previous posts on this
>>list with regard to shapefiles which will give you an understanding of
>>some of the limitations that you might bump into. For example (I don't
>>know if it is still true) I have some point shapefiles that don't seem
>>to be currently supported.
>>    
>>
>
>Thanks, Tom, there are ways in sp/maptools, but not all of the 
>possibilities have been explored - it turns out that there are (many) more 
>than we thought of in developing sp classes.
>
>Some notes from trying this out:
>
>library(maptools)
>nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
>  IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
>ncbb <- bbox(nc)
>xymin <- ncbb[,1]
>r_xy <- apply(ncbb, 1, diff)
>resol <- 0.1 # here taken as ew=ns
>ncells <- ceiling(r_xy/resol)
>grd <- GridTopology(cellcentre.offset=xymin, cellsize=c(resol, resol), 
>  cells.dim=ncells)
>pts <- SpatialPoints(coordinates(grd), proj4string=CRS(proj4string(nc)))
>pts_polys <- overlay(pts, nc)
>pts_BIR74 <- nc$BIR74[pts_polys]
>pts1 <- SpatialPointsDataFrame(pts, data=as(data.frame(BIR74=pts_BIR74), 
>  "AttributeList"))
>gridded(pts1) <- TRUE
>pal <- colorRampPalette(c("wheat1", "red3"))(4)
>brks <- quantile(nc$BIR74)
>par(mfrow=c(3,1))
>plot(nc, col=pal[findInterval(nc$BIR74, brks, all.inside=TRUE)], 
>  axes=TRUE)
>image(pts1, col=pal, breaks=brks, axes=TRUE)
>plot(nc, add=TRUE)
>fname <- tempfile()
>writeAsciiGrid(pts1, fname) # note that this will not work now because
>  # machine fuzz in the calculated resolution gets in the way, fixed in 
>  # next maptools release, for now, the kludge is:
>  # slot(slot(pts1, "grid"), "cellsize") <- rep(mean(slot(slot(pts1, 
>  # "grid"), "cellsize")), 2)
>rpts1 <- readAsciiGrid(fname, proj4string=CRS(proj4string(pts1)))
>image(rpts1, col=pal, breaks=brks, axes=TRUE)
>par(mfrow=c(1,1))
>
>The steps are to make a GridTopology object from the input 
>SpatialPolygons, get its coordinates, overlay() the coordinates on the 
>polygons, retrieve the required data - could be multiple variables, adding 
>it to the SpatialPoints object, grid the object, and write out.
>
>In the new version of rgdal, you'll find that writing out rasters in other 
>formats is well-supported, including their spatial reference system 
>metadata - the same applies to reading vector data (but not yet writing 
>vector data).
>
>I guess that a function to make GridTopology objects from SpatialPolygons 
>may enter maptools before long.
>
>Comments, suggestions?
>
>Roger
>  
>
Two comments: first the step "grid the object" sounds obsolete
somehow, second: the function you mention should perhaps
enter sp, not maptools.
--
Edzer



From Roger.Bivand at nhh.no  Fri Mar 10 11:19:44 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 10 Mar 2006 11:19:44 +0100 (CET)
Subject: [R-sig-Geo] Convert esri shape files to esri ascii grid from R
In-Reply-To: <4411507E.5050808@geo.uu.nl>
Message-ID: <Pine.LNX.4.44.0603101117440.4653-100000@reclus.nhh.no>

On Fri, 10 Mar 2006, Edzer J. Pebesma wrote:

> Roger Bivand wrote:
> 
> >On Fri, 10 Mar 2006, Mulholland, Tom wrote:
> >
> >  
> >
> >>I didn't know how to do this offhand, but a little research soon found a
> >>way. So I think you need to search the existing resources before asking
> >>your question as my basic search from R
> >>
> >>    
> >>
> >>>RSiteSearch("esri grid") 
> >>>      
> >>>
> >>returned write.asciigrid as the first response. Since I routinely read
> >>shapefiles into sp classes (readShapePoints in maptools) it's the
> >>conversion of one to another.
> >>
> >>The overview PDF file in the sp package gives an example on converting
> >>points to grids ("5.2 Creating grids from points".)
> >>
> >>It would appear that you just need to familarise yourself with what's in
> >>sp and maptools. I would suggest looking through previous posts on this
> >>list with regard to shapefiles which will give you an understanding of
> >>some of the limitations that you might bump into. For example (I don't
> >>know if it is still true) I have some point shapefiles that don't seem
> >>to be currently supported.
> >>    
> >>
> >
> >Thanks, Tom, there are ways in sp/maptools, but not all of the 
> >possibilities have been explored - it turns out that there are (many) more 
> >than we thought of in developing sp classes.
> >
> >Some notes from trying this out:
> >
> >library(maptools)
> >nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
> >  IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
> >ncbb <- bbox(nc)
> >xymin <- ncbb[,1]
> >r_xy <- apply(ncbb, 1, diff)
> >resol <- 0.1 # here taken as ew=ns
> >ncells <- ceiling(r_xy/resol)
> >grd <- GridTopology(cellcentre.offset=xymin, cellsize=c(resol, resol), 
> >  cells.dim=ncells)
> >pts <- SpatialPoints(coordinates(grd), proj4string=CRS(proj4string(nc)))
> >pts_polys <- overlay(pts, nc)
> >pts_BIR74 <- nc$BIR74[pts_polys]
> >pts1 <- SpatialPointsDataFrame(pts, data=as(data.frame(BIR74=pts_BIR74), 
> >  "AttributeList"))
> >gridded(pts1) <- TRUE

pts1 <- SpatialPixelsDataFrame(pts, data=as(data.frame(BIR74=pts_BIR74), 
  "AttributeList"))

does it in one step, yes.

> >pal <- colorRampPalette(c("wheat1", "red3"))(4)
> >brks <- quantile(nc$BIR74)
> >par(mfrow=c(3,1))
> >plot(nc, col=pal[findInterval(nc$BIR74, brks, all.inside=TRUE)], 
> >  axes=TRUE)
> >image(pts1, col=pal, breaks=brks, axes=TRUE)
> >plot(nc, add=TRUE)
> >fname <- tempfile()
> >writeAsciiGrid(pts1, fname) # note that this will not work now because
> >  # machine fuzz in the calculated resolution gets in the way, fixed in 
> >  # next maptools release, for now, the kludge is:
> >  # slot(slot(pts1, "grid"), "cellsize") <- rep(mean(slot(slot(pts1, 
> >  # "grid"), "cellsize")), 2)
> >rpts1 <- readAsciiGrid(fname, proj4string=CRS(proj4string(pts1)))
> >image(rpts1, col=pal, breaks=brks, axes=TRUE)
> >par(mfrow=c(1,1))
> >
> >The steps are to make a GridTopology object from the input 
> >SpatialPolygons, get its coordinates, overlay() the coordinates on the 
> >polygons, retrieve the required data - could be multiple variables, adding 
> >it to the SpatialPoints object, grid the object, and write out.
> >
> >In the new version of rgdal, you'll find that writing out rasters in other 
> >formats is well-supported, including their spatial reference system 
> >metadata - the same applies to reading vector data (but not yet writing 
> >vector data).
> >
> >I guess that a function to make GridTopology objects from SpatialPolygons 
> >may enter maptools before long.
> >
> >Comments, suggestions?
> >
> >Roger
> >  
> >
> Two comments: first the step "grid the object" sounds obsolete
> somehow, second: the function you mention should perhaps
> enter sp, not maptools.

That's fair, I agree.

Thanks,

Roger

> --
> Edzer
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From gregor.gorjanc at gmail.com  Sat Mar 11 01:11:20 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Sat, 11 Mar 2006 01:11:20 +0100
Subject: [R-sig-Geo] Adding some data as colors to world map
In-Reply-To: <Pine.LNX.4.44.0603081847290.31842-100001@reclus.nhh.no>
References: <Pine.LNX.4.44.0603081847290.31842-100001@reclus.nhh.no>
Message-ID: <441215A8.9060402@bfro.uni-lj.si>

Hello!

I appologize for my absence but I was completely stuffed with my work in
last days. I would like to express thanks to all who took their time and
showed various ways how to accomplish my task. I did not expect to get
so many valuable responses. I will plot data from FAOSTAT database
http://faostat.fao.org/faostat/collections?subset=agriculture

...
> 
> 
> I've produced a world map with ISO3166 two-letter codes. To get your
> codes right - this lists out country names and codes:
> 
> as(world_countries, "data.frame")
> 

OK, I will need to do the mapping, since FAO uses full names for
countries, but that is a minor problem. I will just create a list of
mappings and apply it.

> then
> 
> countries <- c("AU", "US", "AR") colours <- c("blue", "red", "green")
>  plot(world_countries, col=colours[match(world_countries$ISO3166,
> countries)])
> 

Very clean and nice solution. I like it. If I would also go for bubbles,
how can I determine the position where to put the bubble on i.e. "the
center" of the country?

> gives the attached PNG. Shall I make an .RData file of the 
> SpatialPolygonsDataFrame object available?

Yes, please do.

Many thanks again!!!

P.S. In one of previous posts you mentioned
> The advantage of the sp class representation here is that we can
> project the data to make areas more comparable if you need that,
> otherwise Greenland, Russia, and Canada dominate totally!
Can you please elaborate a bit further on this topic since I do not
follow it fully. Perhaps you can show on above example.

P.P.S. Did you "get any further" with Giovanni's tutorial and recent
changes in maptools?

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From mdsumner at utas.edu.au  Sat Mar 11 05:41:15 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Sat, 11 Mar 2006 15:41:15 +1100
Subject: [R-sig-Geo] function for bearing
In-Reply-To: <Pine.LNX.4.44.0603091620250.951-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0603091620250.951-100000@reclus.nhh.no>
Message-ID: <441254EB.9030900@utas.edu.au>


>
> There is a very interesting discussion of the centrality of 
> azimuth-finding in the development of mathematics and mathematical 
> geography in: http://patriot.net/users/abdali/ftp/qibla.pdf. Among others, 
> al-Khwarizmi was an important contributor.
>
>   
Thanks Roger - that is a really excellent resource. A similar one by 
Sudipto Banerjee for distance that I learnt a lot from is here:

http://www.biostat.umn.edu/~sudiptob/ResearchPapers/Geodesics.pdf



From pedro at dpi.inpe.br  Mon Mar 13 19:08:36 2006
From: pedro at dpi.inpe.br (pedro at dpi.inpe.br)
Date: Mon, 13 Mar 2006 15:08:36 -0300
Subject: [R-sig-Geo] SpatialGrid from matrix
Message-ID: <20060313150836.1940wfo6tuaoog48@agenda.dpi.inpe.br>

Hi,

I would like to know how to create a SpatialGrid(DataFrame) using 
directly one matrix as input. I tried to use grid.topology (as shown in 
            the manual), but I got a memory allocation problem (it 
tries to alloc a
vector of size 390Mb using the following script:

require(splancs)
data(bodmin)
x= kernel2d(as.points(bodmin), bodmin$poly, h0=2, nx=100, ny=100)
require(sp)
g=expand.grid(x$x,x$y,x$z)

The last line gives the following error:
Error: cannot allocate vector of size 390625 Kb

Just to show that the data is not so large:
> class(x$z);length(x$z)
[1] "matrix"
[1] 10000

Is there any other way to create a SpatialGrid without using so much memory?

Thanks,

Pedro Andrade



From mdsumner at utas.edu.au  Tue Mar 14 01:16:00 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Tue, 14 Mar 2006 11:16:00 +1100
Subject: [R-sig-Geo] SpatialGrid from matrix
In-Reply-To: <20060313150836.1940wfo6tuaoog48@agenda.dpi.inpe.br>
References: <20060313150836.1940wfo6tuaoog48@agenda.dpi.inpe.br>
Message-ID: <44160B40.4050304@utas.edu.au>


> require(splancs)
> data(bodmin)
> x= kernel2d(as.points(bodmin), bodmin$poly, h0=2, nx=100, ny=100)
> require(sp)
> g=expand.grid(x$x,x$y,x$z)
>
> The last line gives the following error:
> Error: cannot allocate vector of size 390625 Kb
>   

You are expanding your grid for every cell in the matrix, per every grid 
location - which *really is* a lot of memory.  You really want something 
like this:

g <- cbind(expand.grid(x = x$x, y = x$y), as.vector(x$z))
coordinates(g) <- c("x", "y")
gridded(g) <- TRUE
image(g)
contour(x, add = T)  ## just to be sure

I'm pretty sure the ordering is right for this case, but be sure to check.

Cheers, Mike.



From e.pebesma at geo.uu.nl  Tue Mar 14 10:38:44 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 14 Mar 2006 10:38:44 +0100
Subject: [R-sig-Geo] SpatialGrid from matrix
In-Reply-To: <44160B40.4050304@utas.edu.au>
References: <20060313150836.1940wfo6tuaoog48@agenda.dpi.inpe.br>
	<44160B40.4050304@utas.edu.au>
Message-ID: <44168F24.7070803@geo.uu.nl>

Michael Sumner wrote:

>>require(splancs)
>>data(bodmin)
>>x= kernel2d(as.points(bodmin), bodmin$poly, h0=2, nx=100, ny=100)
>>require(sp)
>>g=expand.grid(x$x,x$y,x$z)
>>
>>The last line gives the following error:
>>Error: cannot allocate vector of size 390625 Kb
>>  
>>    
>>
>
>You are expanding your grid for every cell in the matrix, per every grid 
>location - which *really is* a lot of memory.  You really want something 
>like this:
>
>g <- cbind(expand.grid(x = x$x, y = x$y), as.vector(x$z))
>coordinates(g) <- c("x", "y")
>gridded(g) <- TRUE
>image(g)
>contour(x, add = T)  ## just to be sure
>
>I'm pretty sure the ordering is right for this case, but be sure to check.
>
>Cheers, Mike.
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  
>
Thanks, Mike, that's an excellent solution.

In this way g is of

 > class(g)
[1] "SpatialPixelsDataFrame"
attr(,"package")
[1] "sp"

meaning that it stores x and y coordinates. To save this
space, you could store it as SpatialGridDataFrame:
 > object.size(g)
[1] 283528
 > fullgrid(g)=T
 > object.size(g)
[1] 83476
 > class(g)
[1] "SpatialGridDataFrame"
attr(,"package")
[1] "sp"

A direct way to create a SpatialGridDataFrame without
using expand.grid() would use GridTopology() and
SpatialGridDataFrame(). You'd have to reorder x$z
for that, too.
--
Edzer



From pedro at dpi.inpe.br  Tue Mar 14 19:17:32 2006
From: pedro at dpi.inpe.br (pedro at dpi.inpe.br)
Date: Tue, 14 Mar 2006 15:17:32 -0300
Subject: [R-sig-Geo] SpatialGrid from matrix
In-Reply-To: <44168F24.7070803@geo.uu.nl>
References: <20060313150836.1940wfo6tuaoog48@agenda.dpi.inpe.br>
	<44160B40.4050304@utas.edu.au> <44168F24.7070803@geo.uu.nl>
Message-ID: <20060314151732.mqll7xrfw0ckoocc@agenda.dpi.inpe.br>

Very nice! Also now the size of the Spatial object is almost the same 
of the kernel's result:

> object.size(g)
[1] 83476
> object.size(x)
[1] 82224

Thanks!

Pedro Andrade

Quoting "Edzer J. Pebesma" <e.pebesma at geo.uu.nl>:

> Michael Sumner wrote:
>
>>> require(splancs)
>>> data(bodmin)
>>> x= kernel2d(as.points(bodmin), bodmin$poly, h0=2, nx=100, ny=100)
>>> require(sp)
>>> g=expand.grid(x$x,x$y,x$z)
>>>
>>> The last line gives the following error:
>>> Error: cannot allocate vector of size 390625 Kb
>>>
>>>
>>>
>>
>> You are expanding your grid for every cell in the matrix, per every grid
>> location - which *really is* a lot of memory.  You really want something
>> like this:
>>
>> g <- cbind(expand.grid(x = x$x, y = x$y), as.vector(x$z))
>> coordinates(g) <- c("x", "y")
>> gridded(g) <- TRUE
>> image(g)
>> contour(x, add = T)  ## just to be sure
>>
>> I'm pretty sure the ordering is right for this case, but be sure to check.
>>
>> Cheers, Mike.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> Thanks, Mike, that's an excellent solution.
>
> In this way g is of
>
> > class(g)
> [1] "SpatialPixelsDataFrame"
> attr(,"package")
> [1] "sp"
>
> meaning that it stores x and y coordinates. To save this
> space, you could store it as SpatialGridDataFrame:
> > object.size(g)
> [1] 283528
> > fullgrid(g)=T
> > object.size(g)
> [1] 83476
> > class(g)
> [1] "SpatialGridDataFrame"
> attr(,"package")
> [1] "sp"
>
> A direct way to create a SpatialGridDataFrame without
> using expand.grid() would use GridTopology() and
> SpatialGridDataFrame(). You'd have to reorder x$z
> for that, too.
> --
> Edzer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Roger.Bivand at nhh.no  Tue Mar 14 22:05:24 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 14 Mar 2006 22:05:24 +0100 (CET)
Subject: [R-sig-Geo] Adding some data as colors to world map
In-Reply-To: <441215A8.9060402@bfro.uni-lj.si>
Message-ID: <Pine.LNX.4.44.0603142144220.12264-100000@reclus.nhh.no>

On Sat, 11 Mar 2006, Gregor Gorjanc wrote:

> Hello!
> 
> I appologize for my absence but I was completely stuffed with my work in
> last days. I would like to express thanks to all who took their time and
> showed various ways how to accomplish my task. I did not expect to get
> so many valuable responses. I will plot data from FAOSTAT database
> http://faostat.fao.org/faostat/collections?subset=agriculture
> 

Using world_countries.rda (see below for access) and matching against a 
short sample csv from FAO (they don't seem to give access to more than 25 
line samples without registration) - sample for Oceania:

> world_countries$ISO3166[match(toupper(as.character(oc_aa$Country)), 
as.character(world_countries$names))]
 [1] AS   AU   CK   <NA> PF   GU   KI   MH   <NA> NC   NZ   NU   NF   <NA> PW  
[16] PG   WS   SB   TO   TV   VU   <NA>
230 Levels: AD AE AF AG AI AL AM AN AO AR AS AT AU AW AZ BA BB BD BE BF ... ZW

looks promising - you'll still have a bit of manual editing to add the 
ISO3166 codes to the FAO data. But it can be done once-off, I guess, as 
you said.


> ...
> > 
> > 
> > I've produced a world map with ISO3166 two-letter codes. To get your
> > codes right - this lists out country names and codes:
> > 
> > as(world_countries, "data.frame")
> > 
> 
> OK, I will need to do the mapping, since FAO uses full names for
> countries, but that is a minor problem. I will just create a list of
> mappings and apply it.
> 
> > then
> > 
> > countries <- c("AU", "US", "AR") colours <- c("blue", "red", "green")
> >  plot(world_countries, col=colours[match(world_countries$ISO3166,
> > countries)])
> > 

The classInt package new on CRAN can help, if you like, with choosing 
colours for the polygons or bubbles.

> 
> Very clean and nice solution. I like it. If I would also go for bubbles,
> how can I determine the position where to put the bubble on i.e. "the
> center" of the country?

symbols(coordinates(world_countries), ...)

should do it. Have a look at Susumu Tanimura et al. in JSS 2006 for a nice 
discussion of symbol size.

> 
> > gives the attached PNG. Shall I make an .RData file of the 
> > SpatialPolygonsDataFrame object available?
> 
> Yes, please do.

On:

http://spatial.nhh.no/R/etc/world_countries.rda

now, please let me know if it works for you. Please use library(sp) to 
define the loaded object.

> 
> Many thanks again!!!
> 
> P.S. In one of previous posts you mentioned
> > The advantage of the sp class representation here is that we can
> > project the data to make areas more comparable if you need that,
> > otherwise Greenland, Russia, and Canada dominate totally!
> Can you please elaborate a bit further on this topic since I do not
> follow it fully. Perhaps you can show on above example.
> 

The specific choice of the projection depends on which part of the world 
you want to present, and on other cartographic criteria. This is a good 
reference:

http://www.colorado.edu/geography/gcraft/notes/mapproj/mapproj_f.html

but there are thousands of interesting choices, I'm afraid. Projection is 
supported in the newest version of rgdal on CRAN using the transform() 
method, but you need to know which coordinate reference system to go to. 
If there is a typical projection used in your field, it should be 
identifiable, and can then be done to make a projected basemap.

> P.P.S. Did you "get any further" with Giovanni's tutorial and recent
> changes in maptools?
> 

Not yet, but it'll come before too long!

Best wishes,

Roger

> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From gregor.gorjanc at gmail.com  Wed Mar 15 22:18:58 2006
From: gregor.gorjanc at gmail.com (Gregor Gorjanc)
Date: Wed, 15 Mar 2006 22:18:58 +0100
Subject: [R-sig-Geo] Adding some data as colors to world map
In-Reply-To: <Pine.LNX.4.44.0603142144220.12264-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0603142144220.12264-100000@reclus.nhh.no>
Message-ID: <441884C2.5050906@bfro.uni-lj.si>

Hi!

Roger, many thanks for all this. I installed package sp and successfully
loaded object you provided and ploted the image you attached last time.
This is really nice. Thanks also for other comments for R and projections.

Btw. will you remove that world_countries.rda object or will it be
accessible in an R package or ???

Good luck!

Roger Bivand wrote:
> On Sat, 11 Mar 2006, Gregor Gorjanc wrote:
> 
> 
>>Hello!
>>
>>I appologize for my absence but I was completely stuffed with my work in
>>last days. I would like to express thanks to all who took their time and
>>showed various ways how to accomplish my task. I did not expect to get
>>so many valuable responses. I will plot data from FAOSTAT database
>>http://faostat.fao.org/faostat/collections?subset=agriculture
>>
> 
> 
> Using world_countries.rda (see below for access) and matching against a 
> short sample csv from FAO (they don't seem to give access to more than 25 
> line samples without registration) - sample for Oceania:
> 
> 
>>world_countries$ISO3166[match(toupper(as.character(oc_aa$Country)), 
> 
> as.character(world_countries$names))]
>  [1] AS   AU   CK   <NA> PF   GU   KI   MH   <NA> NC   NZ   NU   NF   <NA> PW  
> [16] PG   WS   SB   TO   TV   VU   <NA>
> 230 Levels: AD AE AF AG AI AL AM AN AO AR AS AT AU AW AZ BA BB BD BE BF ... ZW
> 
> looks promising - you'll still have a bit of manual editing to add the 
> ISO3166 codes to the FAO data. But it can be done once-off, I guess, as 
> you said.
> 
> 
> 
>>...
>>
>>>
>>>I've produced a world map with ISO3166 two-letter codes. To get your
>>>codes right - this lists out country names and codes:
>>>
>>>as(world_countries, "data.frame")
>>>
>>
>>OK, I will need to do the mapping, since FAO uses full names for
>>countries, but that is a minor problem. I will just create a list of
>>mappings and apply it.
>>
>>
>>>then
>>>
>>>countries <- c("AU", "US", "AR") colours <- c("blue", "red", "green")
>>> plot(world_countries, col=colours[match(world_countries$ISO3166,
>>>countries)])
>>>
> 
> 
> The classInt package new on CRAN can help, if you like, with choosing 
> colours for the polygons or bubbles.
> 
> 
>>Very clean and nice solution. I like it. If I would also go for bubbles,
>>how can I determine the position where to put the bubble on i.e. "the
>>center" of the country?
> 
> 
> symbols(coordinates(world_countries), ...)
> 
> should do it. Have a look at Susumu Tanimura et al. in JSS 2006 for a nice 
> discussion of symbol size.
> 
> 
>>>gives the attached PNG. Shall I make an .RData file of the 
>>>SpatialPolygonsDataFrame object available?
>>
>>Yes, please do.
> 
> 
> On:
> 
> http://spatial.nhh.no/R/etc/world_countries.rda
> 
> now, please let me know if it works for you. Please use library(sp) to 
> define the loaded object.
> 
> 
>>Many thanks again!!!
>>
>>P.S. In one of previous posts you mentioned
>>
>>>The advantage of the sp class representation here is that we can
>>>project the data to make areas more comparable if you need that,
>>>otherwise Greenland, Russia, and Canada dominate totally!
>>
>>Can you please elaborate a bit further on this topic since I do not
>>follow it fully. Perhaps you can show on above example.
>>
> 
> 
> The specific choice of the projection depends on which part of the world 
> you want to present, and on other cartographic criteria. This is a good 
> reference:
> 
> http://www.colorado.edu/geography/gcraft/notes/mapproj/mapproj_f.html
> 
> but there are thousands of interesting choices, I'm afraid. Projection is 
> supported in the newest version of rgdal on CRAN using the transform() 
> method, but you need to know which coordinate reference system to go to. 
> If there is a typical projection used in your field, it should be 
> identifiable, and can then be done to make a projected basemap.
> 
> 
>>P.P.S. Did you "get any further" with Giovanni's tutorial and recent
>>changes in maptools?
>>
> 
> 
> Not yet, but it'll come before too long!
> 
> Best wishes,
> 
> Roger
> 
> 
> 


-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.



From twgriffi at purdue.edu  Thu Mar 16 22:55:26 2006
From: twgriffi at purdue.edu (Griffin, Terry W)
Date: Thu, 16 Mar 2006 16:55:26 -0500
Subject: [R-sig-Geo] inverse distance weights matrix
Message-ID: <CD7951A61CF9644B8FC63A55CED4194B86A615@EXCH03.purdue.lcl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060316/6a739ff0/attachment.pl>

From Roger.Bivand at nhh.no  Fri Mar 17 20:42:44 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 17 Mar 2006 20:42:44 +0100 (CET)
Subject: [R-sig-Geo] inverse distance weights matrix
In-Reply-To: <CD7951A61CF9644B8FC63A55CED4194B86A615@EXCH03.purdue.lcl>
Message-ID: <Pine.LNX.4.44.0603172035310.19771-100000@reclus.nhh.no>

On Thu, 16 Mar 2006, Griffin, Terry W wrote:

> Greetings,
> 
>  
> 
> I'm migrating from MATLAB to R and am having trouble converting inverse
> distance weights matrix into a form usable by R.  I've created the
> matrix in SpaceStat (in *.FMT format) and converted to *.GWT format and
> also have it in MATLAB *.m format.
> 

I wonder whether your Matlab data are in the Spatial Econometrics Toolbox 
format - if they are, you could try the read.dat2listw() function 
mentioned on the read.gwt2nb function help page.
>  
> 
> I've tried using the read.gwt2nb in R, but without success.  There are
> nearly 2,451 observations with an average of 482 linkages.  About 20 %
> have nonzero weights.  Any suggestions are appreciated.

Without details of what you mean by "without success", it's hard to offer 
any advice. Could you create a small example of the problems you are 
seeing, and repost with copies of the commands you give and any error 
messages? 

If you are seeing errors ("Error in ..." messages from R), please also
type traceback() at the prompt and report the output. You could also put
the uncooperative GWT file on a website for others to try to see what is
going on.

> 
>  
> 
> Thank you,
> 
> Terry
> 
>  
> 
>  
> 
> Terry W. Griffin
> 
> Graduate Research Assistant
> 
> Agricultural Economics
> 
> Purdue University
> 
> 403 W State St
> 
> West Lafayette, IN 47907
> 
> 765-494-4257
> 
> http://web.ics.purdue.edu/~twgriffi/
> <http://web.ics.purdue.edu/~twgriffi/> 
> 
>  
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From twgriffi at purdue.edu  Fri Mar 17 22:39:06 2006
From: twgriffi at purdue.edu (Griffin, Terry W)
Date: Fri, 17 Mar 2006 16:39:06 -0500
Subject: [R-sig-Geo] inverse distance weights matrix
Message-ID: <CD7951A61CF9644B8FC63A55CED4194B86A627@EXCH03.purdue.lcl>


The MATLAB routines are the Spatial Econometrics Toolbox format.  I
tried the read.dat2listw() in R; the code and error message for a small
matrix example is below; this uses a full matrix from MATLAB (realizing
that "read.dat2listw" is intended for sparse matrices). 

> mattry<-read.dat2listw("mat4rf")
Error in "[.default"(sn, , 1) : incorrect number of dimensions
> traceback()
5: NextMethod("[")
4: "[.factor"(sn, , 1)
3: sn[, 1]
2: unique(sn[, 1])
1: read.dat2listw("mat4rf")


I'm not able to use dlmwrite in MATLAB to export the sparse matrix so I
tried to import the full matrix into R (code is above).  The MATLAB code
I'm using came from this listserve archive.  The MATLAB code and error
message are below.  I'm able to use dlmwrite to create the MATLAB full
matrix (used above in the R code).

load testmat.GWT; A = (spconvert(testmat)); %have to change name in two
locations on this line
n=size(A); nobs=n(1);
 % Normalize matrix (adapted form LeSage 1999)
wt = sparse(A);
 [i1,j1,s1]=find(wt);
rsum=sum(wt);
for i=1:nobs;
            ind=find(i1==i);
s1(ind,1)=s1(ind,1)/rsum(1,i);
end;
[m,n] = size(wt);
W = sparse(i1,j1,s1,m,n);
S = sparse(W);
dlmwrite('mat4rst', S); %give the new sparse weight matrix a permanent
name for R 
??? Error using ==> sprintf
Function is not defined for sparse inputs.

Error in ==> dlmwrite at 172
        str = sprintf(format,m(i,:));

If anyone wants to give it a try, I've put the small example matrices
and the "real" matrix up on my website at:
http://web.ics.purdue.edu/~twgriffi/R_matrix.htm

My objective is to use R for my spatial data analysis using inverse
distance weights matrices.  I'm struggling with the inverse distance
matrices.  I hope to either create these inverse distance matrices in
SpaceStat then import into R or create the matrices in R.  

Thank you,

Terry




-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Friday, March 17, 2006 2:43 PM
To: Griffin, Terry W
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] inverse distance weights matrix

On Thu, 16 Mar 2006, Griffin, Terry W wrote:

> Greetings,
> 
>  
> 
> I'm migrating from MATLAB to R and am having trouble converting
inverse
> distance weights matrix into a form usable by R.  I've created the
> matrix in SpaceStat (in *.FMT format) and converted to *.GWT format
and
> also have it in MATLAB *.m format.
> 

I wonder whether your Matlab data are in the Spatial Econometrics
Toolbox 
format - if they are, you could try the read.dat2listw() function 
mentioned on the read.gwt2nb function help page.
>  
> 
> I've tried using the read.gwt2nb in R, but without success.  There are
> nearly 2,451 observations with an average of 482 linkages.  About 20 %
> have nonzero weights.  Any suggestions are appreciated.

Without details of what you mean by "without success", it's hard to
offer 
any advice. Could you create a small example of the problems you are 
seeing, and repost with copies of the commands you give and any error 
messages? 

If you are seeing errors ("Error in ..." messages from R), please also
type traceback() at the prompt and report the output. You could also put
the uncooperative GWT file on a website for others to try to see what is
going on.

> 
>  
> 
> Thank you,
> 
> Terry
> 
>  
> 
>  
> 
> Terry W. Griffin
> 
> Graduate Research Assistant
> 
> Agricultural Economics
> 
> Purdue University
> 
> 403 W State St
> 
> West Lafayette, IN 47907
> 
> 765-494-4257
> 
> http://web.ics.purdue.edu/~twgriffi/
> <http://web.ics.purdue.edu/~twgriffi/> 
> 
>  
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Mar 17 23:49:41 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 17 Mar 2006 23:49:41 +0100 (CET)
Subject: [R-sig-Geo] inverse distance weights matrix
In-Reply-To: <CD7951A61CF9644B8FC63A55CED4194B86A627@EXCH03.purdue.lcl>
Message-ID: <Pine.LNX.4.44.0603172325010.19771-100000@reclus.nhh.no>

Terry:

http://web.ics.purdue.edu/~twgriffi/mat4rf

and 

http://web.ics.purdue.edu/~twgriffi/mat4rs

throw access errors.

Do you have the coordinates and your specifications for the inverse 
weighted neighbours (distance threshold, power if any)? 

inMAT <- matrix(scan("cottonID75wm", sep=","), nrow=2451, ncol=2451, 
  byrow=TRUE)

does read the matrix - the weights aren't symmetric, are they?

>From the weights matrix I get:

inMATlw <- mat2listw(inMAT)

print(is.symmetric.nb(inMATlw$neighbours))
[1] TRUE

print(inMATlw$neighbours)
Neighbour list object:
Number of regions: 2451 
Number of nonzero links: 1182982 
Percentage nonzero weights: 19.69208 
Average number of links: 482.6528 

If you could post the coordinates and your specifications, I could see how 
to reproduce the weights within R if you like.

Roger


On Fri, 17 Mar 2006, Griffin, Terry W wrote:

> 
> The MATLAB routines are the Spatial Econometrics Toolbox format.  I
> tried the read.dat2listw() in R; the code and error message for a small
> matrix example is below; this uses a full matrix from MATLAB (realizing
> that "read.dat2listw" is intended for sparse matrices). 
> 
> > mattry<-read.dat2listw("mat4rf")
> Error in "[.default"(sn, , 1) : incorrect number of dimensions
> > traceback()
> 5: NextMethod("[")
> 4: "[.factor"(sn, , 1)
> 3: sn[, 1]
> 2: unique(sn[, 1])
> 1: read.dat2listw("mat4rf")
> 
> 
> I'm not able to use dlmwrite in MATLAB to export the sparse matrix so I
> tried to import the full matrix into R (code is above).  The MATLAB code
> I'm using came from this listserve archive.  The MATLAB code and error
> message are below.  I'm able to use dlmwrite to create the MATLAB full
> matrix (used above in the R code).
> 
> load testmat.GWT; A = (spconvert(testmat)); %have to change name in two
> locations on this line
> n=size(A); nobs=n(1);
>  % Normalize matrix (adapted form LeSage 1999)
> wt = sparse(A);
>  [i1,j1,s1]=find(wt);
> rsum=sum(wt);
> for i=1:nobs;
>             ind=find(i1==i);
> s1(ind,1)=s1(ind,1)/rsum(1,i);
> end;
> [m,n] = size(wt);
> W = sparse(i1,j1,s1,m,n);
> S = sparse(W);
> dlmwrite('mat4rst', S); %give the new sparse weight matrix a permanent
> name for R 
> ??? Error using ==> sprintf
> Function is not defined for sparse inputs.
> 
> Error in ==> dlmwrite at 172
>         str = sprintf(format,m(i,:));
> 
> If anyone wants to give it a try, I've put the small example matrices
> and the "real" matrix up on my website at:
> http://web.ics.purdue.edu/~twgriffi/R_matrix.htm
> 
> My objective is to use R for my spatial data analysis using inverse
> distance weights matrices.  I'm struggling with the inverse distance
> matrices.  I hope to either create these inverse distance matrices in
> SpaceStat then import into R or create the matrices in R.  
> 
> Thank you,
> 
> Terry
> 
> 
> 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Friday, March 17, 2006 2:43 PM
> To: Griffin, Terry W
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] inverse distance weights matrix
> 
> On Thu, 16 Mar 2006, Griffin, Terry W wrote:
> 
> > Greetings,
> > 
> >  
> > 
> > I'm migrating from MATLAB to R and am having trouble converting
> inverse
> > distance weights matrix into a form usable by R.  I've created the
> > matrix in SpaceStat (in *.FMT format) and converted to *.GWT format
> and
> > also have it in MATLAB *.m format.
> > 
> 
> I wonder whether your Matlab data are in the Spatial Econometrics
> Toolbox 
> format - if they are, you could try the read.dat2listw() function 
> mentioned on the read.gwt2nb function help page.
> >  
> > 
> > I've tried using the read.gwt2nb in R, but without success.  There are
> > nearly 2,451 observations with an average of 482 linkages.  About 20 %
> > have nonzero weights.  Any suggestions are appreciated.
> 
> Without details of what you mean by "without success", it's hard to
> offer 
> any advice. Could you create a small example of the problems you are 
> seeing, and repost with copies of the commands you give and any error 
> messages? 
> 
> If you are seeing errors ("Error in ..." messages from R), please also
> type traceback() at the prompt and report the output. You could also put
> the uncooperative GWT file on a website for others to try to see what is
> going on.
> 
> > 
> >  
> > 
> > Thank you,
> > 
> > Terry
> > 
> >  
> > 
> >  
> > 
> > Terry W. Griffin
> > 
> > Graduate Research Assistant
> > 
> > Agricultural Economics
> > 
> > Purdue University
> > 
> > 403 W State St
> > 
> > West Lafayette, IN 47907
> > 
> > 765-494-4257
> > 
> > http://web.ics.purdue.edu/~twgriffi/
> > <http://web.ics.purdue.edu/~twgriffi/> 
> > 
> >  
> > 
> >  
> > 
> > 
> > 	[[alternative HTML version deleted]]
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From twgriffi at purdue.edu  Sat Mar 18 17:35:14 2006
From: twgriffi at purdue.edu (Griffin, Terry W)
Date: Sat, 18 Mar 2006 11:35:14 -0500
Subject: [R-sig-Geo] inverse distance weights matrix
Message-ID: <CD7951A61CF9644B8FC63A55CED4194B86A62B@EXCH03.purdue.lcl>

Thank you Roger,

I've posted the original shape file for the dataset on the website at:
http://web.ics.purdue.edu/~twgriffi/R_matrix.htm

One shape file is projected while the other is not; however both sets of
*.dbf are identical and contain both decimal degrees and Northing and
Easting in meters.  

I chose a <=75 meter distance threshold and a power=1.  

The final inverse distance matrix was row standardized so it is not
symmetric. The weight characteristics you list below are nearly
identical to those that SpaceStat provides.  

I really appreciate this.  Thank you,

Terry



-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Friday, March 17, 2006 5:50 PM
To: Griffin, Terry W
Cc: r-sig-geo at stat.math.ethz.ch
Subject: RE: [R-sig-Geo] inverse distance weights matrix

Terry:

http://web.ics.purdue.edu/~twgriffi/mat4rf

and 

http://web.ics.purdue.edu/~twgriffi/mat4rs

throw access errors.

Do you have the coordinates and your specifications for the inverse 
weighted neighbours (distance threshold, power if any)? 

inMAT <- matrix(scan("cottonID75wm", sep=","), nrow=2451, ncol=2451, 
  byrow=TRUE)

does read the matrix - the weights aren't symmetric, are they?

>From the weights matrix I get:

inMATlw <- mat2listw(inMAT)

print(is.symmetric.nb(inMATlw$neighbours))
[1] TRUE

print(inMATlw$neighbours)
Neighbour list object:
Number of regions: 2451 
Number of nonzero links: 1182982 
Percentage nonzero weights: 19.69208 
Average number of links: 482.6528 

If you could post the coordinates and your specifications, I could see
how 
to reproduce the weights within R if you like.

Roger


On Fri, 17 Mar 2006, Griffin, Terry W wrote:

> 
> The MATLAB routines are the Spatial Econometrics Toolbox format.  I
> tried the read.dat2listw() in R; the code and error message for a
small
> matrix example is below; this uses a full matrix from MATLAB
(realizing
> that "read.dat2listw" is intended for sparse matrices). 
> 
> > mattry<-read.dat2listw("mat4rf")
> Error in "[.default"(sn, , 1) : incorrect number of dimensions
> > traceback()
> 5: NextMethod("[")
> 4: "[.factor"(sn, , 1)
> 3: sn[, 1]
> 2: unique(sn[, 1])
> 1: read.dat2listw("mat4rf")
> 
> 
> I'm not able to use dlmwrite in MATLAB to export the sparse matrix so
I
> tried to import the full matrix into R (code is above).  The MATLAB
code
> I'm using came from this listserve archive.  The MATLAB code and error
> message are below.  I'm able to use dlmwrite to create the MATLAB full
> matrix (used above in the R code).
> 
> load testmat.GWT; A = (spconvert(testmat)); %have to change name in
two
> locations on this line
> n=size(A); nobs=n(1);
>  % Normalize matrix (adapted form LeSage 1999)
> wt = sparse(A);
>  [i1,j1,s1]=find(wt);
> rsum=sum(wt);
> for i=1:nobs;
>             ind=find(i1==i);
> s1(ind,1)=s1(ind,1)/rsum(1,i);
> end;
> [m,n] = size(wt);
> W = sparse(i1,j1,s1,m,n);
> S = sparse(W);
> dlmwrite('mat4rst', S); %give the new sparse weight matrix a permanent
> name for R 
> ??? Error using ==> sprintf
> Function is not defined for sparse inputs.
> 
> Error in ==> dlmwrite at 172
>         str = sprintf(format,m(i,:));
> 
> If anyone wants to give it a try, I've put the small example matrices
> and the "real" matrix up on my website at:
> http://web.ics.purdue.edu/~twgriffi/R_matrix.htm
> 
> My objective is to use R for my spatial data analysis using inverse
> distance weights matrices.  I'm struggling with the inverse distance
> matrices.  I hope to either create these inverse distance matrices in
> SpaceStat then import into R or create the matrices in R.  
> 
> Thank you,
> 
> Terry
> 
> 
> 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Friday, March 17, 2006 2:43 PM
> To: Griffin, Terry W
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] inverse distance weights matrix
> 
> On Thu, 16 Mar 2006, Griffin, Terry W wrote:
> 
> > Greetings,
> > 
> >  
> > 
> > I'm migrating from MATLAB to R and am having trouble converting
> inverse
> > distance weights matrix into a form usable by R.  I've created the
> > matrix in SpaceStat (in *.FMT format) and converted to *.GWT format
> and
> > also have it in MATLAB *.m format.
> > 
> 
> I wonder whether your Matlab data are in the Spatial Econometrics
> Toolbox 
> format - if they are, you could try the read.dat2listw() function 
> mentioned on the read.gwt2nb function help page.
> >  
> > 
> > I've tried using the read.gwt2nb in R, but without success.  There
are
> > nearly 2,451 observations with an average of 482 linkages.  About 20
%
> > have nonzero weights.  Any suggestions are appreciated.
> 
> Without details of what you mean by "without success", it's hard to
> offer 
> any advice. Could you create a small example of the problems you are 
> seeing, and repost with copies of the commands you give and any error 
> messages? 
> 
> If you are seeing errors ("Error in ..." messages from R), please also
> type traceback() at the prompt and report the output. You could also
put
> the uncooperative GWT file on a website for others to try to see what
is
> going on.
> 
> > 
> >  
> > 
> > Thank you,
> > 
> > Terry
> > 
> >  
> > 
> >  
> > 
> > Terry W. Griffin
> > 
> > Graduate Research Assistant
> > 
> > Agricultural Economics
> > 
> > Purdue University
> > 
> > 403 W State St
> > 
> > West Lafayette, IN 47907
> > 
> > 765-494-4257
> > 
> > http://web.ics.purdue.edu/~twgriffi/
> > <http://web.ics.purdue.edu/~twgriffi/> 
> > 
> >  
> > 
> >  
> > 
> > 
> > 	[[alternative HTML version deleted]]
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sat Mar 18 21:06:32 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 18 Mar 2006 21:06:32 +0100 (CET)
Subject: [R-sig-Geo] inverse distance weights matrix
In-Reply-To: <CD7951A61CF9644B8FC63A55CED4194B86A62B@EXCH03.purdue.lcl>
Message-ID: <Pine.LNX.4.44.0603182043220.20393-100000@reclus.nhh.no>

On Sat, 18 Mar 2006, Griffin, Terry W wrote:

> Thank you Roger,
> 
> I've posted the original shape file for the dataset on the website at:
> http://web.ics.purdue.edu/~twgriffi/R_matrix.htm
> 
> One shape file is projected while the other is not; however both sets of
> *.dbf are identical and contain both decimal degrees and Northing and
> Easting in meters.  
> 
> I chose a <=75 meter distance threshold and a power=1.  
> 
> The final inverse distance matrix was row standardized so it is not
> symmetric. The weight characteristics you list below are nearly
> identical to those that SpaceStat provides.  

OK - it looks like this at the moment:

library(rgdal)
cotton_proj <- readOGR(".", "cotton_proj") # for shapefiles in the current
			# working directory, first argument
plot(cotton_proj, cex=0.2, axes=TRUE)
library(spdep)
d75 <- dnearneigh(coordinates(cotton_proj), 0, 75)
dlist <- nbdists(d75, coordinates(cotton_proj))
idlist <- lapply(dlist, function(x) 1/x)
w75 <- nb2listw(d75, glist=idlist, style="W")

Characteristics of d75:

> d75
Neighbour list object:
Number of regions: 2451 
Number of nonzero links: 1182994 
Percentage nonzero weights: 19.69228 
Average number of links: 482.6577 

But:

> inMAT <- matrix(scan("cottonID75wm", sep=","), nrow=2451, ncol=2451, 
+ byrow=TRUE)
> range(rowSums(inMAT))
[1] 0.8159028 1.9115231
> d75MAT <- nb2mat(d75, glist=idlist, style="W")
> range(rowSums(d75MAT))
[1] 1 1
> w75 <- nb2listw(d75, glist=idlist, style="W")
> range(sapply(w75$weights, sum))
[1] 1 1

So something in the construction of your matrix wasn't securing row 
standardisation. The values do differ, this is the upper left corner:

> d75MAT[1:5,1:5]
        [,1]       [,2]       [,3]       [,4]       [,5]
1 0.00000000 0.06735710 0.03227068 0.02182278 0.01660474
2 0.05975093 0.00000000 0.05493976 0.02863058 0.01954588
3 0.02615210 0.05019078 0.00000000 0.05461937 0.02771729
4 0.01639324 0.02424508 0.05062943 0.00000000 0.05216365
5 0.01172946 0.01556467 0.02416008 0.04905229 0.00000000
> inMAT[1:5,1:5]
         [,1]     [,2]     [,3]     [,4]     [,5]
[1,] 0.000000 0.131420 0.061844 0.041726 0.031848
[2,] 0.101440 0.000000 0.090156 0.047180 0.032441
[3,] 0.040305 0.076122 0.000000 0.083545 0.042787
[4,] 0.023708 0.034730 0.072836 0.000000 0.076431
[5,] 0.016296 0.021506 0.033593 0.068830 0.000000
> rowSums(inMAT[1:5,])
[1] 1.911523 1.658689 1.533153 1.440908 1.379051
> rowSums(d75MAT[1:5,])
1 2 3 4 5 
1 1 1 1 1 

They are not the same matrices, although the differences are very small - 
here I've used the shapefile points, which are stored as binary floating 
point, rather than using the DBF values, which are a possibly rounded 
character representation, and that might be enough to cause the 
difference. I think you should be able to generate w75, and that it should 
do what you need, but I'd be grateful for feedback on how you get on.

Best wishes,

Roger

PS: with numbers of neighbours between 177 and 678 (both in your matrix 
and in d75), even allowing for the dampening effect of inverse distance, 
most analyses will be slow. 75m means that many sites are related to many 
in your case. Doing:

symbols(408725, 3660800, circles=75, inches=FALSE, fg="red", add=TRUE)

on top of the earlier plot shows your chosen neighbourhood for an 
arbitrary point.

> 
> I really appreciate this.  Thank you,
> 
> Terry
> 
> 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Friday, March 17, 2006 5:50 PM
> To: Griffin, Terry W
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] inverse distance weights matrix
> 
> Terry:
> 
> http://web.ics.purdue.edu/~twgriffi/mat4rf
> 
> and 
> 
> http://web.ics.purdue.edu/~twgriffi/mat4rs
> 
> throw access errors.
> 
> Do you have the coordinates and your specifications for the inverse 
> weighted neighbours (distance threshold, power if any)? 
> 
> inMAT <- matrix(scan("cottonID75wm", sep=","), nrow=2451, ncol=2451, 
>   byrow=TRUE)
> 
> does read the matrix - the weights aren't symmetric, are they?
> 
> From the weights matrix I get:
> 
> inMATlw <- mat2listw(inMAT)
> 
> print(is.symmetric.nb(inMATlw$neighbours))
> [1] TRUE
> 
> print(inMATlw$neighbours)
> Neighbour list object:
> Number of regions: 2451 
> Number of nonzero links: 1182982 
> Percentage nonzero weights: 19.69208 
> Average number of links: 482.6528 
> 
> If you could post the coordinates and your specifications, I could see
> how 
> to reproduce the weights within R if you like.
> 
> Roger
> 
> 
> On Fri, 17 Mar 2006, Griffin, Terry W wrote:
> 
> > 
> > The MATLAB routines are the Spatial Econometrics Toolbox format.  I
> > tried the read.dat2listw() in R; the code and error message for a
> small
> > matrix example is below; this uses a full matrix from MATLAB
> (realizing
> > that "read.dat2listw" is intended for sparse matrices). 
> > 
> > > mattry<-read.dat2listw("mat4rf")
> > Error in "[.default"(sn, , 1) : incorrect number of dimensions
> > > traceback()
> > 5: NextMethod("[")
> > 4: "[.factor"(sn, , 1)
> > 3: sn[, 1]
> > 2: unique(sn[, 1])
> > 1: read.dat2listw("mat4rf")
> > 
> > 
> > I'm not able to use dlmwrite in MATLAB to export the sparse matrix so
> I
> > tried to import the full matrix into R (code is above).  The MATLAB
> code
> > I'm using came from this listserve archive.  The MATLAB code and error
> > message are below.  I'm able to use dlmwrite to create the MATLAB full
> > matrix (used above in the R code).
> > 
> > load testmat.GWT; A = (spconvert(testmat)); %have to change name in
> two
> > locations on this line
> > n=size(A); nobs=n(1);
> >  % Normalize matrix (adapted form LeSage 1999)
> > wt = sparse(A);
> >  [i1,j1,s1]=find(wt);
> > rsum=sum(wt);
> > for i=1:nobs;
> >             ind=find(i1==i);
> > s1(ind,1)=s1(ind,1)/rsum(1,i);
> > end;
> > [m,n] = size(wt);
> > W = sparse(i1,j1,s1,m,n);
> > S = sparse(W);
> > dlmwrite('mat4rst', S); %give the new sparse weight matrix a permanent
> > name for R 
> > ??? Error using ==> sprintf
> > Function is not defined for sparse inputs.
> > 
> > Error in ==> dlmwrite at 172
> >         str = sprintf(format,m(i,:));
> > 
> > If anyone wants to give it a try, I've put the small example matrices
> > and the "real" matrix up on my website at:
> > http://web.ics.purdue.edu/~twgriffi/R_matrix.htm
> > 
> > My objective is to use R for my spatial data analysis using inverse
> > distance weights matrices.  I'm struggling with the inverse distance
> > matrices.  I hope to either create these inverse distance matrices in
> > SpaceStat then import into R or create the matrices in R.  
> > 
> > Thank you,
> > 
> > Terry
> > 
> > 
> > 
> > 
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> > Sent: Friday, March 17, 2006 2:43 PM
> > To: Griffin, Terry W
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Subject: Re: [R-sig-Geo] inverse distance weights matrix
> > 
> > On Thu, 16 Mar 2006, Griffin, Terry W wrote:
> > 
> > > Greetings,
> > > 
> > >  
> > > 
> > > I'm migrating from MATLAB to R and am having trouble converting
> > inverse
> > > distance weights matrix into a form usable by R.  I've created the
> > > matrix in SpaceStat (in *.FMT format) and converted to *.GWT format
> > and
> > > also have it in MATLAB *.m format.
> > > 
> > 
> > I wonder whether your Matlab data are in the Spatial Econometrics
> > Toolbox 
> > format - if they are, you could try the read.dat2listw() function 
> > mentioned on the read.gwt2nb function help page.
> > >  
> > > 
> > > I've tried using the read.gwt2nb in R, but without success.  There
> are
> > > nearly 2,451 observations with an average of 482 linkages.  About 20
> %
> > > have nonzero weights.  Any suggestions are appreciated.
> > 
> > Without details of what you mean by "without success", it's hard to
> > offer 
> > any advice. Could you create a small example of the problems you are 
> > seeing, and repost with copies of the commands you give and any error 
> > messages? 
> > 
> > If you are seeing errors ("Error in ..." messages from R), please also
> > type traceback() at the prompt and report the output. You could also
> put
> > the uncooperative GWT file on a website for others to try to see what
> is
> > going on.
> > 
> > > 
> > >  
> > > 
> > > Thank you,
> > > 
> > > Terry
> > > 
> > >  
> > > 
> > >  
> > > 
> > > Terry W. Griffin
> > > 
> > > Graduate Research Assistant
> > > 
> > > Agricultural Economics
> > > 
> > > Purdue University
> > > 
> > > 403 W State St
> > > 
> > > West Lafayette, IN 47907
> > > 
> > > 765-494-4257
> > > 
> > > http://web.ics.purdue.edu/~twgriffi/
> > > <http://web.ics.purdue.edu/~twgriffi/> 
> > > 
> > >  
> > > 
> > >  
> > > 
> > > 
> > > 	[[alternative HTML version deleted]]
> > > 
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon Mar 20 08:41:51 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 20 Mar 2006 08:41:51 +0100 (CET)
Subject: [R-sig-Geo] [R] Map archives
In-Reply-To: <BAY106-F119997C7D9815E6517BC74BBDB0@phx.gbl>
Message-ID: <Pine.LNX.4.44.0603200809580.7028-100000@reclus.nhh.no>

On Mon, 20 Mar 2006, Alexander Nervedi wrote:

> 
> Hi R Map packages users.
> 
> I just drew my first few plots using map() and am trying to see if I can 
> configure it to my needs. Are there any known archives out there from where 
> I can get additional data files for the map library to read? I am 
> specifically look for sub-district level administrative boundary lines for 
> Madhya Pradesh, India. Kind of like county lines I guess.

The short answer is that you need access to the data first, there are no 
repositories of this kind.

Geospatial data are generally available only for the US in the public 
domain, and so could be made into geographical databases for the map 
package. So for the US, you get county lines for a specific date. The 
functions in the map package are specifically suited to the representation 
of borders used in the cited references under ?map, by Becker and Wilks, 
1993 and 1995, and do not integrate well with contemporary GIS data 
formats. 

The main question is whether you can find or purchase suitable boundary 
files in any format. That will likely absorb 95% of the effort, I'm 
afraid.

Once you've done that, you can consider converting them to map package
format, which can be done but involves jumping through the hoops described
by Becker and Wilks. We don't yet have a convenient way of priming the
Becker/Wilks build train with external data from the sp package
SpatialPolygons class, but it is quite possible that this could be done if
there was enough interest.

Alternatively, you can use the maptools or shapefiles packages to read
shapefiles, RArcInfo to read ArcINFO v7 binary vector files, or rgdal to
read a wide selection of formats (extra drivers can be compiled in if you
install from source). 

You can also convert the data you have found to suit a format that can be
read into R externally, using either open source or proprietary software.
Quite often the data formats are also specific to the providing
organisations.  

It remains the case that digitising heads-up on-screen from a scanned
paper map is the only practical solution in many cases, especially when
historical boundaries are needed.

Googling on Madhya Pradesh shapefile got to the gisindia list, where a 
correspondent replies:

"u can write to Survey of India, Dehradun, they have shape files of all
states of India along with district boundary."

which looks hopeful (if district them probably also sub-district), but
you'd need to talk to people probably locally to try to get hold of
suitable shapefiles.

The next hurdle is to match the spatial representation to your observation 
units - are all the sub-polygons of a sub-district level authority 
separate objects, or grouped together? How are they tagged with unique 
IDs? This matters, because GIS data is collected for many purposes, and 
complete polygon sets for thematic mapping is not the most important.

It would be really nice if there was a repository of these kinds of data, 
especially if they were not limited in use, but there is a long way to go 
before everywhere else catches up with the US.

Roger

> 
> thanks.
> Aleks
> 
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From neteler at itc.it  Mon Mar 20 13:58:19 2006
From: neteler at itc.it (Markus Neteler)
Date: Mon, 20 Mar 2006 13:58:19 +0100
Subject: [R-sig-Geo] [R] Map archives
In-Reply-To: <Pine.LNX.4.44.0603200809580.7028-100000@reclus.nhh.no>
References: <BAY106-F119997C7D9815E6517BC74BBDB0@phx.gbl>
	<Pine.LNX.4.44.0603200809580.7028-100000@reclus.nhh.no>
Message-ID: <20060320125819.GB24298@bartok.itc.it>

On Mon, Mar 20, 2006 at 08:41:51AM +0100, Roger Bivand wrote:
> On Mon, 20 Mar 2006, Alexander Nervedi wrote:
...
> It would be really nice if there was a repository of these kinds of data, 
> especially if they were not limited in use, but there is a long way to go 
> before everywhere else catches up with the US.

The OSGeo Foundation will try to work on this:

http://wiki.osgeo.org/index.php/Public_Geospatial_Data_Project

We are currently forming this project into a committee
of the foundation. Feel free to join us, and/or contribute
your suggestions.

 Markus

-- 
Markus Neteler     <neteler itc it>       http://mpa.itc.it
ITC-irst -  Centro per la Ricerca Scientifica e Tecnologica
MPBA - Predictive Models for Biol. & Environ. Data Analysis
Via Sommarive, 18        -       38050 Povo (Trento), Italy



From jason at veracis.net  Mon Mar 20 14:14:58 2006
From: jason at veracis.net (Jason Dalton)
Date: Mon, 20 Mar 2006 08:14:58 -0500
Subject: [R-sig-Geo] Indian GIS data
In-Reply-To: <mailman.13.1142852403.31725.r-sig-geo@stat.math.ethz.ch>
Message-ID: <001001c64c20$4a2a52f0$8201a8c0@spadac.com>

There is a small repository of geodata for India at:
http://data.geocomm.com/catalog/IN/datalist.html



-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
r-sig-geo-request at stat.math.ethz.ch
Sent: Monday, March 20, 2006 6:00 AM
To: r-sig-geo at stat.math.ethz.ch
Subject: R-sig-Geo Digest, Vol 31, Issue 13

Send R-sig-Geo mailing list submissions to
	r-sig-geo at stat.math.ethz.ch

To subscribe or unsubscribe via the World Wide Web, visit
	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
or, via email, send a message with subject or body 'help' to
	r-sig-geo-request at stat.math.ethz.ch

You can reach the person managing the list at
	r-sig-geo-owner at stat.math.ethz.ch

When replying, please edit your Subject line so it is more specific
than "Re: Contents of R-sig-Geo digest..."


Today's Topics:

   1. Re: [R] Map archives (Roger Bivand)


----------------------------------------------------------------------

Message: 1
Date: Mon, 20 Mar 2006 08:41:51 +0100 (CET)
From: Roger Bivand <Roger.Bivand at nhh.no>
Subject: Re: [R-sig-Geo] [R] Map archives
To: Alexander Nervedi <alexnerdy at hotmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Message-ID: <Pine.LNX.4.44.0603200809580.7028-100000 at reclus.nhh.no>
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 20 Mar 2006, Alexander Nervedi wrote:

> 
> Hi R Map packages users.
> 
> I just drew my first few plots using map() and am trying to see if I can 
> configure it to my needs. Are there any known archives out there from
where 
> I can get additional data files for the map library to read? I am 
> specifically look for sub-district level administrative boundary lines for

> Madhya Pradesh, India. Kind of like county lines I guess.

The short answer is that you need access to the data first, there are no 
repositories of this kind.

Geospatial data are generally available only for the US in the public 
domain, and so could be made into geographical databases for the map 
package. So for the US, you get county lines for a specific date. The 
functions in the map package are specifically suited to the representation 
of borders used in the cited references under ?map, by Becker and Wilks, 
1993 and 1995, and do not integrate well with contemporary GIS data 
formats. 

The main question is whether you can find or purchase suitable boundary 
files in any format. That will likely absorb 95% of the effort, I'm 
afraid.

Once you've done that, you can consider converting them to map package
format, which can be done but involves jumping through the hoops described
by Becker and Wilks. We don't yet have a convenient way of priming the
Becker/Wilks build train with external data from the sp package
SpatialPolygons class, but it is quite possible that this could be done if
there was enough interest.

Alternatively, you can use the maptools or shapefiles packages to read
shapefiles, RArcInfo to read ArcINFO v7 binary vector files, or rgdal to
read a wide selection of formats (extra drivers can be compiled in if you
install from source). 

You can also convert the data you have found to suit a format that can be
read into R externally, using either open source or proprietary software.
Quite often the data formats are also specific to the providing
organisations.  

It remains the case that digitising heads-up on-screen from a scanned
paper map is the only practical solution in many cases, especially when
historical boundaries are needed.

Googling on Madhya Pradesh shapefile got to the gisindia list, where a 
correspondent replies:

"u can write to Survey of India, Dehradun, they have shape files of all
states of India along with district boundary."

which looks hopeful (if district them probably also sub-district), but
you'd need to talk to people probably locally to try to get hold of
suitable shapefiles.

The next hurdle is to match the spatial representation to your observation 
units - are all the sub-polygons of a sub-district level authority 
separate objects, or grouped together? How are they tagged with unique 
IDs? This matters, because GIS data is collected for many purposes, and 
complete polygon sets for thematic mapping is not the most important.

It would be really nice if there was a repository of these kinds of data, 
especially if they were not limited in use, but there is a long way to go 
before everywhere else catches up with the US.

Roger

> 
> thanks.
> Aleks
> 
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide!
http://www.R-project.org/posting-guide.html
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



------------------------------

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


End of R-sig-Geo Digest, Vol 31, Issue 13



From Roger.Bivand at nhh.no  Mon Mar 20 14:33:30 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 20 Mar 2006 14:33:30 +0100 (CET)
Subject: [R-sig-Geo] [R] Map archives
In-Reply-To: <20060320125819.GB24298@bartok.itc.it>
Message-ID: <Pine.LNX.4.44.0603201420540.7028-100000@reclus.nhh.no>

On Mon, 20 Mar 2006, Markus Neteler wrote:

> On Mon, Mar 20, 2006 at 08:41:51AM +0100, Roger Bivand wrote:
> > On Mon, 20 Mar 2006, Alexander Nervedi wrote:
> ...
> > It would be really nice if there was a repository of these kinds of data, 
> > especially if they were not limited in use, but there is a long way to go 
> > before everywhere else catches up with the US.
> 
> The OSGeo Foundation will try to work on this:
> 
> http://wiki.osgeo.org/index.php/Public_Geospatial_Data_Project
> 
> We are currently forming this project into a committee
> of the foundation. Feel free to join us, and/or contribute
> your suggestions.

Thanks for a very useful link, I'm sure that users of geospatial data in R
will be supportive. Unfortunately, it looked as though India is in the
European position - no free access - from the google hits on Indian data
that I found. I would encourage list readers to bookmark the link Markus
provided, I'm sure it is worth not just watching, but also being
pro-active. 

<rant> I'll mention the petition on open geodata of relevance for EU
residents again, I posted it on R-help last week:

http://okfn.org/geo/manifesto.php

because we all have a significant interest in more open access to data in 
order to carry out our work! </rant>

Roger

> 
>  Markus
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Tue Mar 21 19:23:23 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 21 Mar 2006 19:23:23 +0100 (CET)
Subject: [R-sig-Geo] [R] transform shapefiles in UTM to lat/long
In-Reply-To: <616571dc0603210813i73dee31fra7cc21f9cd39d7b1@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0603211917470.11775-100000@reclus.nhh.no>

On Tue, 21 Mar 2006, Fredy O. Mejia wrote:

> Dear all:
> 
> I have a shapefile in UTM coordinate system and I would like to transform it
> to Lat/Log coordinates (WSG84).  The package PBSmapping contains function
> convUL to transform between the two coordinate systems when data is in the
> form of a data frame with attributes specifying the coordinate system.
> However, when shapefiles are imported using function read.shape (package
> maptools), a list instead of a data frame is generated.  I could extract all
> the polygons in the list and transform them, individually, but I hope there
> is an easier way of doing that.  Besides, the shapefile i'm trying to
> convert has two different UTM zones (is from Guatemala, and it covers zones
> 15 and 16).  Any sugestions would be greatly appreciated.

My suggestion would be to read the shapefiles using the readOGR() function 
in the rgdal package, and then use the transform() method in that package 
to change from the appropriate UTM to geographical coordinates. 

Because I think your question involves more than that (I don't understand
how a single shapefile can use two UTM zones), I suggest moving this
thread to the R-sig-geo mailing list, and have cc-ed this reply there.

Please also say which platform and version of R you are using.

> 
> Thanks,
> 
> Fredy
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From neteler at itc.it  Tue Mar 21 23:35:56 2006
From: neteler at itc.it (Markus Neteler)
Date: Tue, 21 Mar 2006 23:35:56 +0100
Subject: [R-sig-Geo] [R] Map archives
In-Reply-To: <20060320125819.GB24298@bartok.itc.it>
References: <BAY106-F119997C7D9815E6517BC74BBDB0@phx.gbl>
	<Pine.LNX.4.44.0603200809580.7028-100000@reclus.nhh.no>
	<20060320125819.GB24298@bartok.itc.it>
Message-ID: <20060321223556.GC14682@bartok.itc.it>

On Mon, Mar 20, 2006 at 01:58:19PM +0100, Markus Neteler wrote:
> On Mon, Mar 20, 2006 at 08:41:51AM +0100, Roger Bivand wrote:
> > On Mon, 20 Mar 2006, Alexander Nervedi wrote:
> ...
> > It would be really nice if there was a repository of these kinds of data, 
> > especially if they were not limited in use, but there is a long way to go 
> > before everywhere else catches up with the US.
> 
> The OSGeo Foundation will try to work on this:
> 
> http://wiki.osgeo.org/index.php/Public_Geospatial_Data_Project
> 
> We are currently forming this project into a committee
> of the foundation. Feel free to join us, and/or contribute
> your suggestions.


Meanwhile the Foundation committee on Public Geospatial Data
is established:

 http://wiki.osgeo.org/index.php/Public_Geospatial_Data_Committee

There is also a dedicated mailing list and an IRC meeting
in #osgeo on freenode tomorrow (see there for details).

You are welcome to join,

 Markus
-- 
Markus Neteler     <neteler itc it>       http://mpa.itc.it
ITC-irst -  Centro per la Ricerca Scientifica e Tecnologica
MPBA - Predictive Models for Biol. & Environ. Data Analysis
Via Sommarive, 18        -       38050 Povo (Trento), Italy



From mdsumner at utas.edu.au  Wed Mar 22 07:13:43 2006
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Wed, 22 Mar 2006 17:13:43 +1100
Subject: [R-sig-Geo] suppress projection string in rgdal "project"
In-Reply-To: <20060321223556.GC14682@bartok.itc.it>
References: <BAY106-F119997C7D9815E6517BC74BBDB0@phx.gbl><Pine.LNX.4.44.0603	200809580.7028-100000@reclus.nhh.no><20060320125819.GB24298@bartok.itc.it>
	<20060321223556.GC14682@bartok.itc.it>
Message-ID: <4420EB17.1020906@utas.edu.au>

Hello, I was delighted to find that the PROJ.4 functionality comes 
embedded right into the rgdal package on the Windows platform.

R 2.2.1, rgdal  0.4-3

I'm using it to convert back and forth from lon/lat to projected 
coordinates - basically I want to sample points from the projected 
coordinate space, but I need to perform calculations using lon/lat - so 
I can't save up the coordinates for one big conversion etc.

I'd like to suppress the printing of the PROJ.4 string when calling 
project(), I guess it's due to this line in projectit.c

Rprintf("%s\n", pj_get_def(pj, 0));

My question is, what's the easiest way to suppress the printing of the 
string in each call?  (Apart from editing and recompiling from source 
myself, that is). 

Is this a simple and sensible feature request?

Cheers, Mike.



From Roger.Bivand at nhh.no  Wed Mar 22 09:40:11 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 22 Mar 2006 09:40:11 +0100 (CET)
Subject: [R-sig-Geo] suppress projection string in rgdal "project"
In-Reply-To: <4420EB17.1020906@utas.edu.au>
Message-ID: <Pine.LNX.4.44.0603220925370.12469-100000@reclus.nhh.no>

On Wed, 22 Mar 2006, Michael Sumner wrote:

> Hello, I was delighted to find that the PROJ.4 functionality comes 
> embedded right into the rgdal package on the Windows platform.
> 
> R 2.2.1, rgdal  0.4-3

Right, rgdal is definitely on vitamins, now including the old rgdal, 
spGDAL, spproj, and Rmap, and a regular Windows online install. The 
changes are noted on the Rgeo website, but I hadn't announced here yet to 
see if bugs emerged in my use in teaching. There are some rough edges, 
like the debugging code you found.

> 
> I'm using it to convert back and forth from lon/lat to projected 
> coordinates - basically I want to sample points from the projected 
> coordinate space, but I need to perform calculations using lon/lat - so 
> I can't save up the coordinates for one big conversion etc.
> 
> I'd like to suppress the printing of the PROJ.4 string when calling 
> project(), I guess it's due to this line in projectit.c
> 
> Rprintf("%s\n", pj_get_def(pj, 0));
> 
> My question is, what's the easiest way to suppress the printing of the 
> string in each call?  (Apart from editing and recompiling from source 
> myself, that is). 
> 
> Is this a simple and sensible feature request?
> 

Absolutely, the print out from C will be removed at the next release, but 
until then maybe capture.output() can help:

rubbish <- capture.output(res <- project(cbind(state.center$x, 
    state.center$y), "+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100"))

seems to suppress the message.

Other suggestions for changes needed for a next release are very welcome!

Roger

> Cheers, Mike.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From epistat at gmail.com  Thu Mar 23 02:55:10 2006
From: epistat at gmail.com (zhijie zhang)
Date: Thu, 23 Mar 2006 09:55:10 +0800
Subject: [R-sig-Geo] questions on simulation
Message-ID: <2fc17e30603221755t7ba40f3et4043f65fc882e8d0@mail.gmail.com>

hi,friends
i'm a newer in using R, thank u for your help in advance!
i want to generate some spatial data (normality,non-normality,etc)and
then calculate the Moran's I index, How should i do it , anybody could
give me some hints?
By the way, i have some  spatial data  with latitude/longitude, how
can i calculate the distances among them?
thanks very much!
--
Kind Regards,Zhi Jie,Zhang ,PHDDepartment of EpidemiologySchool of
Public HealthFudan UniversityTel:86-21-54237149



From Giovanni_Millo at generali.com  Thu Mar 23 15:21:42 2006
From: Giovanni_Millo at generali.com (Millo Giovanni)
Date: Thu, 23 Mar 2006 15:21:42 +0100
Subject: [R-sig-Geo] R: questions on simulation
Message-ID: <74F2D4ED68558643B63A6CC21746040D056F08CB@BEMAILEXTS1.ad.generali.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060323/b716554b/attachment.pl>

From kkrivoruchko at esri.com  Thu Mar 23 22:55:08 2006
From: kkrivoruchko at esri.com (Konstantin Krivoruchko)
Date: Thu, 23 Mar 2006 13:55:08 -0800
Subject: [R-sig-Geo] documentation on  mcmc.input parameters, package geoRglm
Message-ID: <D7BFFE348C53EF4E8AA0698B1E395FA90287ADBD@flybywire.esri.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20060323/b84fcabd/attachment.pl>

From mi2kelgrum at yahoo.com  Sun Mar 26 20:57:43 2006
From: mi2kelgrum at yahoo.com (Mikkel Grum)
Date: Sun, 26 Mar 2006 10:57:43 -0800 (PST)
Subject: [R-sig-Geo] plotting unequal contiguous spatial grids
Message-ID: <20060326185744.82166.qmail@web60223.mail.yahoo.com>

# Is there a way to plot contiguous spatial grids on
# the same plot, even when the grids have 
# unequal spacing? An example would be:

df1 <- data.frame(expand.grid(x = 1:3, y = 1:4), z =
rnorm(12, 1, 0.01))
df2 <- data.frame(expand.grid(x = 1:3, y = 5:7), z =
rnorm(9, 2, 0.01))
df3 <- data.frame(expand.grid(x = 4:6, y = seq(1, 7,
1.5)), z = rnorm(15, 3, 0.01))

# If I just wanted points, I would do the following:
plot(df1[, 1:2], xlim = c(0, 7), ylim = c(0, 8), type
= "n")
points(df1, col = "blue")
points(df2, col = "red")
points(df3, col = "grey")

# If the grids had equal spacing, the following would
# work (in this case it doesn't):
library(sp)
df <- rbind(df1, df2, df3)
coordinates(df) <- ~x+y
gridded(df) <- TRUE
spplot(df)

# I had hoped that I could do something like: 
coordinates(df1) <- ~x+y
gridded(df1) <- TRUE
coordinates(df2) <- ~x+y
gridded(df2) <- TRUE
coordinates(df3) <- ~x+y
gridded(df3) <- TRUE

spplot(df1, xlim = c(0, 7), ylim = c(0, 8))
spplot(df2, add = TRUE)
spplot(df3, add = TRUE)
# but that doesn't work, so I tried:

spplot(xlim = c(0, 6), ylim = c(0, 7),
    panel = function(x, y, subscripts, . . .) {
        panel.spplot(df1),
        panel.spplot(df2),
        panel.spplot(df3)
    }
)
# which doesn't work either. 
# Is there any way round this?

Regards,
Mikkel Grum

Genetic Diversity
International Plant Genetic Resources Institute



From e.pebesma at geo.uu.nl  Mon Mar 27 10:24:10 2006
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 27 Mar 2006 10:24:10 +0200
Subject: [R-sig-Geo] plotting unequal contiguous spatial grids
In-Reply-To: <20060326185744.82166.qmail@web60223.mail.yahoo.com>
References: <20060326185744.82166.qmail@web60223.mail.yahoo.com>
Message-ID: <4427A12A.6020409@geo.uu.nl>

Mikkel, I've looked at it for a while but can't see an easy
solution to this, apart from using

image(df1, xlim = c(0, 6), ylim = c(0, 7))
image(df2, add = T)
image(df3, add = T)

spplot basically wraps levelplot for grids, and I don't see an
easy way out using that for multiple grids with different cell
sizes; see what happens if you join the grid cell centres as
points and feed them to levelplot as a data.frame, probably
the grid cell sizes levelplot will choose will not suit you.

A solution might be to try to do it on the level of package
grid, but my skills are not sufficient for that. Another would
be to consult Deepayan (through R-help).
--
Edzer

Mikkel Grum wrote:
> # Is there a way to plot contiguous spatial grids on
> # the same plot, even when the grids have 
> # unequal spacing? An example would be:
>
> df1 <- data.frame(expand.grid(x = 1:3, y = 1:4), z =
> rnorm(12, 1, 0.01))
> df2 <- data.frame(expand.grid(x = 1:3, y = 5:7), z =
> rnorm(9, 2, 0.01))
> df3 <- data.frame(expand.grid(x = 4:6, y = seq(1, 7,
> 1.5)), z = rnorm(15, 3, 0.01))
>
> # If I just wanted points, I would do the following:
> plot(df1[, 1:2], xlim = c(0, 7), ylim = c(0, 8), type
> = "n")
> points(df1, col = "blue")
> points(df2, col = "red")
> points(df3, col = "grey")
>
> # If the grids had equal spacing, the following would
> # work (in this case it doesn't):
> library(sp)
> df <- rbind(df1, df2, df3)
> coordinates(df) <- ~x+y
> gridded(df) <- TRUE
> spplot(df)
>
> # I had hoped that I could do something like: 
> coordinates(df1) <- ~x+y
> gridded(df1) <- TRUE
> coordinates(df2) <- ~x+y
> gridded(df2) <- TRUE
> coordinates(df3) <- ~x+y
> gridded(df3) <- TRUE
>
> spplot(df1, xlim = c(0, 7), ylim = c(0, 8))
> spplot(df2, add = TRUE)
> spplot(df3, add = TRUE)
> # but that doesn't work, so I tried:
>
> spplot(xlim = c(0, 6), ylim = c(0, 7),
>     panel = function(x, y, subscripts, . . .) {
>         panel.spplot(df1),
>         panel.spplot(df2),
>         panel.spplot(df3)
>     }
> )
> # which doesn't work either. 
> # Is there any way round this?
>
> Regards,
> Mikkel Grum
>
> Genetic Diversity
> International Plant Genetic Resources Institute
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From sorincheval at yahoo.com  Tue Mar 28 14:36:03 2006
From: sorincheval at yahoo.com (Sorin Cheval)
Date: Tue, 28 Mar 2006 04:36:03 -0800 (PST)
Subject: [R-sig-Geo] homogenity test in R
In-Reply-To: <mailman.11.1143453604.6564.r-sig-geo@stat.math.ethz.ch>
Message-ID: <20060328123603.88702.qmail@web31703.mail.mud.yahoo.com>

Hi everebody

I am quite a beginner in R, and I would be grateful if
somebody could provide me some assistance in a
specific problem. I am trying to test the homogenity
of some climatic data using RHTest. The slide 14 of
the presentation that can be accessed at

http://rmtc.meteor.gov.tr/v5/filesFaaliyet/2004,10,04/Presentations/Enric2.ppt

gives some hints, and some documentation can be found
at http://cccma.seos.uvic.ca/ETCCDMI/software.html

I am stucked at a point where probably my knowledges
of R are not enough at the moment, so that I would be
grateful if somebody has some minutes for answerring
few specific questions. Please contact me on my
personal address: sorincheval at yahoo.com

Thanks in advance,
Sorin Cheval



From mi2kelgrum at yahoo.com  Tue Mar 28 16:07:25 2006
From: mi2kelgrum at yahoo.com (Mikkel Grum)
Date: Tue, 28 Mar 2006 06:07:25 -0800 (PST)
Subject: [R-sig-Geo] plotting unequal contiguous spatial grids
In-Reply-To: <4427A12A.6020409@geo.uu.nl>
Message-ID: <20060328140725.7952.qmail@web60212.mail.yahoo.com>

Edzer, Thanks for your help. For some reason I had it
that you couldn't use add = TRUE with image(). I
thought I had tested it. It will work for me.

Using the grid centres to create a new grid with
levelplot would in some cases give me problems with
grid sizes (many more grids cells).

I'll have a look at whether I need to reformulate my
query and send it to R-help, or whether the image
function will be adequate for all that I need to do.

Mikkel


--- "Edzer J. Pebesma" <e.pebesma at geo.uu.nl> wrote:

> Mikkel, I've looked at it for a while but can't see
> an easy
> solution to this, apart from using
> 
> image(df1, xlim = c(0, 6), ylim = c(0, 7))
> image(df2, add = T)
> image(df3, add = T)
> 
> spplot basically wraps levelplot for grids, and I
> don't see an
> easy way out using that for multiple grids with
> different cell
> sizes; see what happens if you join the grid cell
> centres as
> points and feed them to levelplot as a data.frame,
> probably
> the grid cell sizes levelplot will choose will not
> suit you.
> 
> A solution might be to try to do it on the level of
> package
> grid, but my skills are not sufficient for that.
> Another would
> be to consult Deepayan (through R-help).
> --
> Edzer
> 
> Mikkel Grum wrote:
> > # Is there a way to plot contiguous spatial grids
> on
> > # the same plot, even when the grids have 
> > # unequal spacing? An example would be:
> >
> > df1 <- data.frame(expand.grid(x = 1:3, y = 1:4), z
> =
> > rnorm(12, 1, 0.01))
> > df2 <- data.frame(expand.grid(x = 1:3, y = 5:7), z
> =
> > rnorm(9, 2, 0.01))
> > df3 <- data.frame(expand.grid(x = 4:6, y = seq(1,
> 7,
> > 1.5)), z = rnorm(15, 3, 0.01))
> >
> > # If I just wanted points, I would do the
> following:
> > plot(df1[, 1:2], xlim = c(0, 7), ylim = c(0, 8),
> type
> > = "n")
> > points(df1, col = "blue")
> > points(df2, col = "red")
> > points(df3, col = "grey")
> >
> > # If the grids had equal spacing, the following
> would
> > # work (in this case it doesn't):
> > library(sp)
> > df <- rbind(df1, df2, df3)
> > coordinates(df) <- ~x+y
> > gridded(df) <- TRUE
> > spplot(df)
> >
> > # I had hoped that I could do something like: 
> > coordinates(df1) <- ~x+y
> > gridded(df1) <- TRUE
> > coordinates(df2) <- ~x+y
> > gridded(df2) <- TRUE
> > coordinates(df3) <- ~x+y
> > gridded(df3) <- TRUE
> >
> > spplot(df1, xlim = c(0, 7), ylim = c(0, 8))
> > spplot(df2, add = TRUE)
> > spplot(df3, add = TRUE)
> > # but that doesn't work, so I tried:
> >
> > spplot(xlim = c(0, 6), ylim = c(0, 7),
> >     panel = function(x, y, subscripts, . . .) {
> >         panel.spplot(df1),
> >         panel.spplot(df2),
> >         panel.spplot(df3)
> >     }
> > )
> > # which doesn't work either. 
> > # Is there any way round this?
> >
> > Regards,
> > Mikkel Grum
> >
> > Genetic Diversity
> > International Plant Genetic Resources Institute
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >   
> 
>



