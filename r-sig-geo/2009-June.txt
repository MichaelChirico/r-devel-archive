From jean-paul.kibambe at uclouvain.be  Mon Jun  1 11:16:45 2009
From: jean-paul.kibambe at uclouvain.be (Jean-Paul Kibambe Lubamba)
Date: Mon, 1 Jun 2009 11:16:45 +0200 (CEST)
Subject: [R-sig-Geo] Forcing GWR to the origin
Message-ID: <e3b95ebcb3e3f766e00a9b83fc3afdbe.squirrel@mmp.sipr-dc.ucl.ac.be>

Hi all,

I am running the following which is meaningfull for my purposes than an
OLS with Intercept and gives me better results:

datalm<- lm(y~x1 + x2 + x3 + x4 -1, data=data)

I know wonder if I can run a gwr of the model above, forcing the Intercept
coefficients to be zero at all locations. That is to say:

data.bw <- gwr.sel(y ~ x1 + x2 + x3 + x4 -1 , data=data,
coords=cbind(data$x, data$y))

data.gwr <- gwr(y ~ x1 + x2 + x3 + x4 -1, data=data, coords=cbind(data$x,
data$y), bandwidth=data.bw, longlat=FALSE, hatmatrix=TRUE)

Does GWR still meaningfull when it ran with 0 as the Intercept?

Any comment is welcome and thanks in advance!


Jean-Paul Kibambe


From Nicholas.Nagle at Colorado.EDU  Mon Jun  1 18:55:45 2009
From: Nicholas.Nagle at Colorado.EDU (Nicholas N Nagle)
Date: Mon,  1 Jun 2009 10:55:45 -0600 (MDT)
Subject: [R-sig-Geo] Forcing GWR to the origin
In-Reply-To: <mailman.17.1243850404.2121.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1243850404.2121.r-sig-geo@stat.math.ethz.ch>
Message-ID: <20090601105545.AJK54514@riddler.int.colorado.edu>

Jean-Paul-
I am not sure why you would want to force the intercept to 0, unless perhaps you can explain near 100% of the variance.  If there is any error, then leaving out an intercept forces the expected error to be zero.  I don't know what is in the error term in your model, but why should it have exactly mean zero?

But, moving forward...
I don't know if gwr can do this, but you should be able to get the same effect with the gam function in the mgcv package.

If the linear model you want is:
datalm<- lm(y~x1 + x2 -1, data=data)

Then the gam model would be something like:
library(mgcv)
datagam <- gam(y~s(x,y)*x1+s(x,y)*x2,data=data,family='gaussian')

where x,y are spatial coordinates
The smooth terms are the spatially-varying coeffients, and, with a little effort,  they can be mapped just as in gwr. 

The model with intercept is 
datagam2 <- gam(y~s(x,y)+s(x,y)*x1+s(x,y)*x2,data=data,family='gaussian')

One additional advantage of gam over gwr is that you have the flexibility to let some coefficients be spatially varying and others be fixed: for example

datagam3 <- gam(y~s(x,y)+x1+s(x,y)*x2,data=data,family='gaussian')


Hope this helps.

Nicholas




Nicholas N. Nagle, Assistant Professor
University of Colorado
Department of Geography
UCB 260, Guggenheim 110
Boulder, CO 80309-0260
phone: 303-492-4794


---- Original message ----
>Date: Mon, 01 Jun 2009 12:00:04 +0200
>From: r-sig-geo-bounces at stat.math.ethz.ch (on behalf of r-sig-geo-request at stat.math.ethz.ch)
>Subject: R-sig-Geo Digest, Vol 70, Issue 1  
>To: r-sig-geo at stat.math.ethz.ch
>
>Send R-sig-Geo mailing list submissions to
>	r-sig-geo at stat.math.ethz.ch
>
>To subscribe or unsubscribe via the World Wide Web, visit
>	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>or, via email, send a message with subject or body 'help' to
>	r-sig-geo-request at stat.math.ethz.ch
>
>You can reach the person managing the list at
>	r-sig-geo-owner at stat.math.ethz.ch
>
>When replying, please edit your Subject line so it is more specific
>than "Re: Contents of R-sig-Geo digest..."
>
>
>Today's Topics:
>
>   1. Forcing GWR to the origin (Jean-Paul Kibambe Lubamba)
>
>
>----------------------------------------------------------------------
>
>Message: 1
>Date: Mon, 1 Jun 2009 11:16:45 +0200 (CEST)
>From: "Jean-Paul Kibambe Lubamba" <jean-paul.kibambe at uclouvain.be>
>Subject: [R-sig-Geo] Forcing GWR to the origin
>To: r-sig-geo at stat.math.ethz.ch
>Message-ID:
>	<e3b95ebcb3e3f766e00a9b83fc3afdbe.squirrel at mmp.sipr-dc.ucl.ac.be>
>Content-Type: text/plain;charset=iso-8859-1
>
>Hi all,
>
>I am running the following which is meaningfull for my purposes than an
>OLS with Intercept and gives me better results:
>
>datalm<- lm(y~x1 + x2 + x3 + x4 -1, data=data)
>
>I know wonder if I can run a gwr of the model above, forcing the Intercept
>coefficients to be zero at all locations. That is to say:
>
>data.bw <- gwr.sel(y ~ x1 + x2 + x3 + x4 -1 , data=data,
>coords=cbind(data$x, data$y))
>
>data.gwr <- gwr(y ~ x1 + x2 + x3 + x4 -1, data=data, coords=cbind(data$x,
>data$y), bandwidth=data.bw, longlat=FALSE, hatmatrix=TRUE)
>
>Does GWR still meaningfull when it ran with 0 as the Intercept?
>
>Any comment is welcome and thanks in advance!
>
>
>Jean-Paul Kibambe
>
>
>
>------------------------------
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>End of R-sig-Geo Digest, Vol 70, Issue 1
>****************************************


From debeaudette at ucdavis.edu  Mon Jun  1 20:14:05 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Mon, 1 Jun 2009 11:14:05 -0700
Subject: [R-sig-Geo] spgrass6 and R 2.9
In-Reply-To: <200905300002.23063.torleif.lunde@cih.uib.no>
References: <200905291426.56291.dylan.beaudette@gmail.com>
	<200905300002.23063.torleif.lunde@cih.uib.no>
Message-ID: <200906011114.05035.dylan.beaudette@gmail.com>

On Friday 29 May 2009, Torleif Markussen Lunde wrote:
> Hi
>
> First try updating glibc, and install spgrass6 again. If this does not work
> you could try
>
> export MALLOC_CHECK_=0
>
> before you start R. The error might be related to "somewhere something" is
> trying to free memory that has already been unallocated. I don't know the
> details here, but it could be worth a try?
>
> Best wishes
> Torleif

Hi Torleif, thanks for the tips.

I just updated my libc, and tried the MALLOC_CHECK trick-- neither fixed the 
problem. Still get the same error... Very strange, as I did not encounter 
this problem on a very similar machine.

Could this have anything to do with configure arguments such as -march ?

Cheers,
Dylan


> On Friday 29 May 2009 11:26:56 pm Dylan Beaudette wrote:
> > Hi,
> >
> > Just upgraded to R 2.9.0 this morning, and tried to update all of my
> > packages. Everyhing seemed to work, except spgrass6. Manually removing
> > the old packing and installing fresh resulted in:
> >
> > install.packages('spgrass6', dep=TRUE)
> > trying URL
> > 'http://cran.cnr.Berkeley.edu/src/contrib/spgrass6_0.6-6.tar.gz' Content
> > type 'application/x-gzip' length 332298 bytes (324 Kb)
> > opened URL
> > ==================================================
> > downloaded 324 Kb
> >
> > * Installing *source* package 'spgrass6' ...
> > ** R
> > ** inst
> > ** preparing package for lazy loading
> > Geospatial Data Abstraction Library extensions to R successfully loaded
> > Loaded GDAL runtime: GDAL 1.7.0dev, released 2008/11/26
> > Path to GDAL shared files: /usr/local/share/gdal
> > Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
> > Path to PROJ.4 shared files: (autodetected)
> > ** help
> > *** installing help indices
> >
> >  >>> Building/Updating help pages for package 'spgrass6'
> >
> >      Formats: text html latex example
> >   execGRASS                         text    html    latex   example
> >   gmeta6                            text    html    latex   example
> >   initGRASS                         text    html    latex   example
> >   readRAST6                         text    html    latex   example
> >   readVECT6                         text    html    latex   example
> >   spgrass6                          text    html    latex   example
> > ** building package indices ...
> > * DONE (spgrass6)
> > *** glibc detected *** /usr/local/lib/R/bin/exec/R: double free or
> > corruption (fasttop): 0x096ac2b0 ***
> >
> >
> > At this point R stops responding, and I have to issue a `kill -9` to make
> > regain control of the shell.
> >
> > Any ideas?
> >
> > Dylan



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From Roger.Bivand at nhh.no  Mon Jun  1 23:51:49 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Jun 2009 23:51:49 +0200 (CEST)
Subject: [R-sig-Geo] spgrass6 and R 2.9
In-Reply-To: <200906011114.05035.dylan.beaudette@gmail.com>
References: <200905291426.56291.dylan.beaudette@gmail.com>
	<200905300002.23063.torleif.lunde@cih.uib.no>
	<200906011114.05035.dylan.beaudette@gmail.com>
Message-ID: <alpine.LRH.2.00.0906012345540.31055@reclus.nhh.no>

On Mon, 1 Jun 2009, Dylan Beaudette wrote:

> On Friday 29 May 2009, Torleif Markussen Lunde wrote:
>> Hi
>>
>> First try updating glibc, and install spgrass6 again. If this does not work
>> you could try
>>
>> export MALLOC_CHECK_=0
>>
>> before you start R. The error might be related to "somewhere something" is
>> trying to free memory that has already been unallocated. I don't know the
>> details here, but it could be worth a try?
>>
>> Best wishes
>> Torleif
>
> Hi Torleif, thanks for the tips.
>
> I just updated my libc, and tried the MALLOC_CHECK trick-- neither fixed the
> problem. Still get the same error... Very strange, as I did not encounter
> this problem on a very similar machine.
>
> Could this have anything to do with configure arguments such as -march ?

You haven't told us what your underlying system is, or how you installed 
R. If you built R from source, did you run "make check"? Does the problem 
arise installing other packages? It most likely is something on your 
system, otherwise there would be lots of reports of the same.

Roger

>
> Cheers,
> Dylan
>
>
>> On Friday 29 May 2009 11:26:56 pm Dylan Beaudette wrote:
>>> Hi,
>>>
>>> Just upgraded to R 2.9.0 this morning, and tried to update all of my
>>> packages. Everyhing seemed to work, except spgrass6. Manually removing
>>> the old packing and installing fresh resulted in:
>>>
>>> install.packages('spgrass6', dep=TRUE)
>>> trying URL
>>> 'http://cran.cnr.Berkeley.edu/src/contrib/spgrass6_0.6-6.tar.gz' Content
>>> type 'application/x-gzip' length 332298 bytes (324 Kb)
>>> opened URL
>>> ==================================================
>>> downloaded 324 Kb
>>>
>>> * Installing *source* package 'spgrass6' ...
>>> ** R
>>> ** inst
>>> ** preparing package for lazy loading
>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>> Loaded GDAL runtime: GDAL 1.7.0dev, released 2008/11/26
>>> Path to GDAL shared files: /usr/local/share/gdal
>>> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
>>> Path to PROJ.4 shared files: (autodetected)
>>> ** help
>>> *** installing help indices
>>>
>>> >>> Building/Updating help pages for package 'spgrass6'
>>>
>>>      Formats: text html latex example
>>>   execGRASS                         text    html    latex   example
>>>   gmeta6                            text    html    latex   example
>>>   initGRASS                         text    html    latex   example
>>>   readRAST6                         text    html    latex   example
>>>   readVECT6                         text    html    latex   example
>>>   spgrass6                          text    html    latex   example
>>> ** building package indices ...
>>> * DONE (spgrass6)
>>> *** glibc detected *** /usr/local/lib/R/bin/exec/R: double free or
>>> corruption (fasttop): 0x096ac2b0 ***
>>>
>>>
>>> At this point R stops responding, and I have to issue a `kill -9` to make
>>> regain control of the shell.
>>>
>>> Any ideas?
>>>
>>> Dylan
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From ct357 at cam.ac.uk  Tue Jun  2 16:48:04 2009
From: ct357 at cam.ac.uk (Claire Tancell)
Date: 02 Jun 2009 15:48:04 +0100
Subject: [R-sig-Geo] Trip - time spent plot
Message-ID: <Prayer.1.3.1.0906021548040.5766@hermes-2.csi.cam.ac.uk>

I am trying to use the "trip" package to generate a map of time spent from 
a SpatialPointsDataFrame object using the tripGrid function and am having 
difficulty generating the final plot. The documentation seems to say that 
tripGrid generates a grid, carries out an interpolation, bins these 
interpolated points, and then counts the points allocated to each grid but 
it is not clear how to generate the final plot. Plotting the output of 
tripGrid just plots the grid itself. Does anyone have experience of using 
this package and advise me on how to generate the final time-spent plot?


From mdsumner at utas.edu.au  Tue Jun  2 17:19:11 2009
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Wed, 03 Jun 2009 1:19:11 +1000
Subject: [R-sig-Geo] Trip - time spent plot
Message-ID: <200906021519.n52FJBKH018907@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090603/cfcac114/attachment.pl>

From jli at mi.fu-berlin.de  Wed Jun  3 00:56:05 2009
From: jli at mi.fu-berlin.de (Jian Li)
Date: Wed, 3 Jun 2009 00:56:05 +0200
Subject: [R-sig-Geo] =?windows-1252?q?how_to_show_polygons_from_e00_file_?=
 =?windows-1252?q?=28Grauss-Kr=FCger_coordinatensystem=29_in_Google_map=3F?=
Message-ID: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090603/6283726e/attachment.pl>

From p.hiemstra at geo.uu.nl  Wed Jun  3 09:45:45 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 03 Jun 2009 09:45:45 +0200
Subject: [R-sig-Geo]
 =?windows-1252?q?how_to_show_polygons_from_e00_file_?=
 =?windows-1252?q?=28Grauss-Kr=FCger_coordinatensystem=29_in_Google_map=3F?=
In-Reply-To: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>
Message-ID: <4A262A29.6070400@geo.uu.nl>

Hi,

You have to do two things, read your data and export it to a format for 
Google Earth.

The Cran Spatial Taskview suggests the RArcInfo package to read the e00 
files into R. I'm not sure into what format they are loaded. Maybe 
readOGR from the rgdal package can also read e00 files, depending on the 
GDAL/OGR version you have available.

If you have your vector file in an R session in a SpatialPolygons object 
(see the sp-package), the following code shows an example how to export 
the data to a format that Google Earth can read:

library(rgdal)
data(meuse)
coordinates(meuse) = ~x+y
proj4string(meuse) = CRS("+init=epsg:28992")
proj4string(meuse)
meuse.ll = spTransform(meuse, CRS("+proj=longlat"))
writeOGR(meuse.ll, "meuse.kml", "meuse.kml", driver="KML")

I'm not sure if the RArcInfo reads the e00 file into a SpatialPolygons 
object (Virgillio?), or if it is easy to convert the output from 
RArcInfo to an sp-class. rgdal always reads data into an sp-class, but 
I'm not sure if this supports the e00 format.

I hope this e-mail provides you with some clues to work with,

cheers and good luck with your thesis,
Paul

Jian Li wrote:
>
>
>
>
>
> Dear r-sig-geo Members,
>
> recently, I've been trying to display the information from a e00 file (Grauss-Kr?ger coordinatensystem) in Google map but until now no success.    
>
> I would be very appreciated if anyone can help me to solve the problem which directly concerns my master thesis.
>
> e00 file is under http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/nat.e00 available
>
> Thank you in Advanced
>
> Best Regards,
> Jian  
>
> check out the rest of the Windows Live?.
> More than mail?Windows Live? goes way beyond your inbox.
>  More than messages
> _________________________________________________________________
> Show them the way! Add maps and directions to your party invites. 
> http://www.microsoft.com/windows/windowslive/products/events.aspx
> 	[[alternative HTML version deleted]]
>
>   
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From torleif.lunde at cih.uib.no  Wed Jun  3 11:29:19 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Wed, 3 Jun 2009 11:29:19 +0200
Subject: [R-sig-Geo]
	=?windows-1252?q?how_to_show_polygons_from_e00_file_?=
	=?windows-1252?q?=28_Grauss-Kr=FCger_coordinatensystem=29_in_Googl?=
	=?windows-1252?q?e_map=3F?=
In-Reply-To: <4A262A29.6070400@geo.uu.nl>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>
	<4A262A29.6070400@geo.uu.nl>
Message-ID: <200906031129.19780.torleif.lunde@cih.uib.no>

Hi

Like Paul says there are two steps required to accomplish what you want. Below 
you will find two options on how to do this. The import routine is the same 
for both of these, but the first export as png, while the other export 
polygons (better if you are zooming). I recommend you read the documentation 
for all functions, and remember to use citation("package") in your thesis;-)

########################
##Export e00 to Google Earth (png)##
########################

#1: import using RArcInfo

#Set the working directory to where you stored your nat.e00 data
setwd('~/e00data') #Use your own path

#load the RArcInfo library (for functions e00toavc, get.xxx)
require(RArcInfo)

#Convert the e00 to SpatialPolygons
e00toavc('nat.e00', './nat2')
nat.arc <- get.arcdata("./", "nat2")
nat.pal <- get.paldata("./", "nat2")
require(maptools) #Needed for pal2SpatialPolygons
nat.sp <- pal2SpatialPolygons(nat.arc, 
	      nat.pal, 
	      nat.pal[[1]]$PolygonId[-1], 
	      dropPoly1=TRUE, 
	      proj4string=CRS("+init=epsg:2166"))

#Transform to longlat, WGS84
require(rgdal)
nat2.sp <- spTransform(nat.sp, CRS("+proj=longlat +ellps=WGS84"))

#Set up metadata
GSG <- GE_SpatialGrid(nat2.sp)

#Ask for the tempdir
tmp.dir <- tempdir()

#To change the resolution (and line width), change res
res <- 5
#Make png-file
png(file=paste(tmp.dir, "/", "nat.png", sep=""), width=GSG$width*res, 
height=GSG$height*res,
bg="transparent")
     par(mar=c(0,0,0,0), xaxs="i", yaxs="i")
     plot(nat2.sp, xlim=GSG$xlim, ylim=GSG$ylim, lwd = res)
dev.off()

#And make the Google earth kml-file
kmlOverlay(SGqk, paste(tmp.dir, "/",  "nat.kml", sep=""), 
paste(tmp.dir, "/", "nat.png", sep=""))

#Now, see in td, and you have your kml and png.


###########################################
##Export the same data as polygons (still to Google earth)
#The second option is to export as polygons
#(See ?kmlPolygon in maptools)

out <- sapply(slot(nat2.sp, "polygons"), function(x) { kmlPolygon(x,
    name=paste(slot(x, "ID")), 
    col="transparent", lwd=5, border='black', 
    description=paste(slot(x, "ID"))) })

tf <- tempfile()

kmlFile <- file(paste(tf, ".kml", sep=""), "w")
cat(kmlPolygon(kmlname="MyGPoly", 
kmldescription="<i>Masterthesis</i>")$header, 
    file=kmlFile, sep="\n")
cat(unlist(out["style",]), file=kmlFile, sep="\n")
cat(unlist(out["content",]), file=kmlFile, sep="\n")
cat(kmlPolygon()$footer, file=kmlFile, sep="\n")
close(kmlFile)
#################

Best wishes
Torleif


On Wednesday 03 June 2009 09:45:45 am Paul Hiemstra wrote:
> Hi,
>
> You have to do two things, read your data and export it to a format for
> Google Earth.
>
> The Cran Spatial Taskview suggests the RArcInfo package to read the e00
> files into R. I'm not sure into what format they are loaded. Maybe
> readOGR from the rgdal package can also read e00 files, depending on the
> GDAL/OGR version you have available.
>
> If you have your vector file in an R session in a SpatialPolygons object
> (see the sp-package), the following code shows an example how to export
> the data to a format that Google Earth can read:
>
> library(rgdal)
> data(meuse)
> coordinates(meuse) = ~x+y
> proj4string(meuse) = CRS("+init=epsg:28992")
> proj4string(meuse)
> meuse.ll = spTransform(meuse, CRS("+proj=longlat"))
> writeOGR(meuse.ll, "meuse.kml", "meuse.kml", driver="KML")
>
> I'm not sure if the RArcInfo reads the e00 file into a SpatialPolygons
> object (Virgillio?), or if it is easy to convert the output from
> RArcInfo to an sp-class. rgdal always reads data into an sp-class, but
> I'm not sure if this supports the e00 format.
>
> I hope this e-mail provides you with some clues to work with,
>
> cheers and good luck with your thesis,
> Paul
>
> Jian Li wrote:
> > Dear r-sig-geo Members,
> >
> > recently, I've been trying to display the information from a e00 file
> > (Grauss-Kr?ger coordinatensystem) in Google map but until now no success.
> >
> > I would be very appreciated if anyone can help me to solve the problem
> > which directly concerns my master thesis.
> >
> > e00 file is under
> > http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/nat.e00
> > available
> >
> > Thank you in Advanced
> >
> > Best Regards,
> > Jian
> >
> > check out the rest of the Windows Live?.
> > More than mail?Windows Live? goes way beyond your inbox.
> >  More than messages
> > _________________________________________________________________
> > Show them the way! Add maps and directions to your party invites.
> > http://www.microsoft.com/windows/windowslive/products/events.aspx
> > 	[[alternative HTML version deleted]]
> >
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From torleif.lunde at cih.uib.no  Wed Jun  3 15:55:05 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Wed, 3 Jun 2009 15:55:05 +0200
Subject: [R-sig-Geo]
	=?utf-8?q?how_to_show_polygons_from_e00_file_=28_Grau?=
	=?utf-8?q?ss-Kr=C3=BCger_coordinatensystem=29_in_Google_map=3F?=
In-Reply-To: <BLU123-W21C4DDCA32686F29F7B2CE94A0@phx.gbl>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>
	<200906031129.19780.torleif.lunde@cih.uib.no>
	<BLU123-W21C4DDCA32686F29F7B2CE94A0@phx.gbl>
Message-ID: <200906031555.05275.torleif.lunde@cih.uib.no>

Hi Jian

I am happy it helped. 

1. Try to compress the kml file as a zip-file and rename it to .kmz. In the 
case of a kml and png image, add both to a zip archive and rename to .kmz. 

2. upload the kmz to somewhere, go to http://maps.google.com/ and in the 
search field type something like
http://open.uib.no/R/RGnat.kmz

Best wishes
Torleif

On Wednesday 03 June 2009 03:11:19 pm Jian Li wrote:
> Dear Torleif,
>
> Thank you for your valuable information.
> I have used this R code successfully produced kml file that can be
> flawlessly displayed in Google Earth, but with Google Map it doesn't show
> anything. Could you please explain it to me?
>
> Best Regards,
> Jian
>
> > From: torleif.lunde at cih.uib.no
> > To: r-sig-geo at stat.math.ethz.ch
> > Subject: Re: [R-sig-Geo] how to show polygons from e00 file
> > (Grauss-Kr?ger coordinatensystem) in Google map? Date: Wed, 3 Jun 2009
> > 11:29:19 +0200
> > CC: p.hiemstra at geo.uu.nl; jli at mi.fu-berlin.de
> >
> > Hi
> >
> > Like Paul says there are two steps required to accomplish what you want.
> > Below you will find two options on how to do this. The import routine is
> > the same for both of these, but the first export as png, while the other
> > export polygons (better if you are zooming). I recommend you read the
> > documentation for all functions, and remember to use citation("package")
> > in your thesis;-)
> >
> > ########################
> > ##Export e00 to Google Earth (png)##
> > ########################
> >
> > #1: import using RArcInfo
> >
> > #Set the working directory to where you stored your nat.e00 data
> > setwd('~/e00data') #Use your own path
> >
> > #load the RArcInfo library (for functions e00toavc, get.xxx)
> > require(RArcInfo)
> >
> > #Convert the e00 to SpatialPolygons
> > e00toavc('nat.e00', './nat2')
> > nat.arc <- get.arcdata("./", "nat2")
> > nat.pal <- get.paldata("./", "nat2")
> > require(maptools) #Needed for pal2SpatialPolygons
> > nat.sp <- pal2SpatialPolygons(nat.arc,
> > 	      nat.pal,
> > 	      nat.pal[[1]]$PolygonId[-1],
> > 	      dropPoly1=TRUE,
> > 	      proj4string=CRS("+init=epsg:2166"))
> >
> > #Transform to longlat, WGS84
> > require(rgdal)
> > nat2.sp <- spTransform(nat.sp, CRS("+proj=longlat +ellps=WGS84"))
> >
> > #Set up metadata
> > GSG <- GE_SpatialGrid(nat2.sp)
> >
> > #Ask for the tempdir
> > tmp.dir <- tempdir()
> >
> > #To change the resolution (and line width), change res
> > res <- 5
> > #Make png-file
> > png(file=paste(tmp.dir, "/", "nat.png", sep=""), width=GSG$width*res,
> > height=GSG$height*res,
> > bg="transparent")
> >      par(mar=c(0,0,0,0), xaxs="i", yaxs="i")
> >      plot(nat2.sp, xlim=GSG$xlim, ylim=GSG$ylim, lwd = res)
> > dev.off()
> >
> > #And make the Google earth kml-file
> > kmlOverlay(SGqk, paste(tmp.dir, "/",  "nat.kml", sep=""),
> > paste(tmp.dir, "/", "nat.png", sep=""))
> >
> > #Now, see in td, and you have your kml and png.
> >
> >
> > ###########################################
> > ##Export the same data as polygons (still to Google earth)
> > #The second option is to export as polygons
> > #(See ?kmlPolygon in maptools)
> >
> > out <- sapply(slot(nat2.sp, "polygons"), function(x) { kmlPolygon(x,
> >     name=paste(slot(x, "ID")),
> >     col="transparent", lwd=5, border='black',
> >     description=paste(slot(x, "ID"))) })
> >
> > tf <- tempfile()
> >
> > kmlFile <- file(paste(tf, ".kml", sep=""), "w")
> > cat(kmlPolygon(kmlname="MyGPoly",
> > kmldescription="<i>Masterthesis</i>")$header,
> >     file=kmlFile, sep="\n")
> > cat(unlist(out["style",]), file=kmlFile, sep="\n")
> > cat(unlist(out["content",]), file=kmlFile, sep="\n")
> > cat(kmlPolygon()$footer, file=kmlFile, sep="\n")
> > close(kmlFile)
> > #################
> >
> > Best wishes
> > Torleif
> >
> > On Wednesday 03 June 2009 09:45:45 am Paul Hiemstra wrote:
> > > Hi,
> > >
> > > You have to do two things, read your data and export it to a format for
> > > Google Earth.
> > >
> > > The Cran Spatial Taskview suggests the RArcInfo package to read the e00
> > > files into R. I'm not sure into what format they are loaded. Maybe
> > > readOGR from the rgdal package can also read e00 files, depending on
> > > the GDAL/OGR version you have available.
> > >
> > > If you have your vector file in an R session in a SpatialPolygons
> > > object (see the sp-package), the following code shows an example how to
> > > export the data to a format that Google Earth can read:
> > >
> > > library(rgdal)
> > > data(meuse)
> > > coordinates(meuse) = ~x+y
> > > proj4string(meuse) = CRS("+init=epsg:28992")
> > > proj4string(meuse)
> > > meuse.ll = spTransform(meuse, CRS("+proj=longlat"))
> > > writeOGR(meuse.ll, "meuse.kml", "meuse.kml", driver="KML")
> > >
> > > I'm not sure if the RArcInfo reads the e00 file into a SpatialPolygons
> > > object (Virgillio?), or if it is easy to convert the output from
> > > RArcInfo to an sp-class. rgdal always reads data into an sp-class, but
> > > I'm not sure if this supports the e00 format.
> > >
> > > I hope this e-mail provides you with some clues to work with,
> > >
> > > cheers and good luck with your thesis,
> > > Paul
> > >
> > > Jian Li wrote:
> > > > Dear r-sig-geo Members,
> > > >
> > > > recently, I've been trying to display the information from a e00 file
> > > > (Grauss-Kr?ger coordinatensystem) in Google map but until now no
> > > > success.
> > > >
> > > > I would be very appreciated if anyone can help me to solve the
> > > > problem which directly concerns my master thesis.
> > > >
> > > > e00 file is under
> > > > http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/nat.e00
> > > > available
> > > >
> > > > Thank you in Advanced
> > > >
> > > > Best Regards,
> > > > Jian
> > > >
> > > > check out the rest of the Windows Live?.
> > > > More than mail?Windows Live? goes way beyond your inbox.
> > > >  More than messages
> > > > _________________________________________________________________
> > > > Show them the way! Add maps and directions to your party invites.
> > > > http://www.microsoft.com/windows/windowslive/products/events.aspx
> > > > 	[[alternative HTML version deleted]]
> > > >
> > > >
> > > > ---------------------------------------------------------------------
> > > >---
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _________________________________________________________________
> Windows Live?: Keep your life in sync. Check it out!
> http://windowslive.com/explore?ocid=TXT_TAGLM_WL_t1_allup_explore_012009


From stubben at lanl.gov  Thu Jun  4 04:51:38 2009
From: stubben at lanl.gov (stubben)
Date: Wed, 3 Jun 2009 20:51:38 -0600
Subject: [R-sig-Geo] missing county in maps
Message-ID: <7F5B301C-E690-4309-95B1-548D2EE618BB@lanl.gov>

Hi,

I 'm trying to color a county map of New Mexico based on some data I  
have - however, I have one extra county, Cibola, which is not in the  
county maps (v 2.1-0) database.  This county was created in 1981 by  
splitting the existing Valencia county in two.  Is there an easy way  
to  split the existing polygon in the county database or some other  
workaround?

#32 counties (Cibola is missing)
map.text("county", "new mexico")

Thanks,

Chris Stubben


From yong.li at unimelb.edu.au  Thu Jun  4 04:54:10 2009
From: yong.li at unimelb.edu.au (Yong Li)
Date: Thu, 04 Jun 2009 12:54:10 +1000
Subject: [R-sig-Geo] How to generate the probability map of a variable under
 a threshold using gstat?
In-Reply-To: <mailman.11.1244023203.25931.r-sig-geo@stat.math.ethz.ch>
Message-ID: <86DBA0678E017341B449A62F258E295602D9D7B0@IS-EX-BEV3.unimelb.edu.au>

Hi All,

I want to produce a probability map of a soil variable under a
threshold. I know I can make it in ArcGIS, but not sure using gstat. Any
tips are highly appreciated.

Regards,

Yong Li


From michael.n at usyd.edu.au  Thu Jun  4 07:53:57 2009
From: michael.n at usyd.edu.au (Michael Nelson)
Date: Thu, 4 Jun 2009 15:53:57 +1000
Subject: [R-sig-Geo] Parameter Standard Errors geoRglm
Message-ID: <77F138F56A7E3745987B92D88F2958F10FE069@EXPRSV04.mcs.usyd.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090604/3ce13ad6/attachment.pl>

From M.Anyadike-Danes at erini.ac.uk  Thu Jun  4 10:56:11 2009
From: M.Anyadike-Danes at erini.ac.uk (Michael Anyadike-Danes)
Date: Thu, 4 Jun 2009 09:56:11 +0100
Subject: [R-sig-Geo] map comparison
Message-ID: <C9328F0EEDC3BC439FDABD12060E9109695770@erini1.ERINI.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090604/08750841/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Jun  4 11:58:21 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 04 Jun 2009 11:58:21 +0200
Subject: [R-sig-Geo] map comparison
In-Reply-To: <C9328F0EEDC3BC439FDABD12060E9109695770@erini1.ERINI.local>
References: <C9328F0EEDC3BC439FDABD12060E9109695770@erini1.ERINI.local>
Message-ID: <4A279ABD.6070500@uni-muenster.de>

It has been quite a while back (5 years?) that I looked at the map
comparison kit. Have any of the new  ideas presented there been taken up
in other statistics or GIS environments, or are they only living in
their own environment?
--
Edzer

Michael Anyadike-Danes wrote:
> sig-geo list members
>
>  
>
> I am interested in applying map comparison methods as (for example)
> implemented in the 'map comparison kit' from riks in the Netherlands. 
>
>  
>
> I have tried the most obvious search terms in RSiteSearch but haven't
> turned up any R-interest.
>
>  
>
> Is there somewhere else I should look?
>
>  
>
> Any comments/suggestions welcome.
>
>  
>
> Michael Anyadike-Danes
>
>  
>
> Economic Research Institute of Northern Ireland
>
> Floral Buildings
>
> 2-14 East Bridge Street
>
> Belfast BT1 3NQ
>
> Tel:  (028) 90727362
>
> Fax: (028) 90319003
>
>  
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From jli at mi.fu-berlin.de  Thu Jun  4 15:02:44 2009
From: jli at mi.fu-berlin.de (Jian Li)
Date: Thu, 4 Jun 2009 15:02:44 +0200
Subject: [R-sig-Geo] how to show polygons from SHP file in Google map?
In-Reply-To: <200906031129.19780.torleif.lunde@cih.uib.no>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>
	<4A262A29.6070400@geo.uu.nl>
	<200906031129.19780.torleif.lunde@cih.uib.no>
Message-ID: <BLU123-W2453191A9B974B3E202BBBE94B0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090604/3b8ee323/attachment.pl>

From torleif.lunde at cih.uib.no  Thu Jun  4 15:23:17 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 4 Jun 2009 15:23:17 +0200
Subject: [R-sig-Geo] how to show polygons from SHP file in Google map?
In-Reply-To: <BLU123-W2453191A9B974B3E202BBBE94B0@phx.gbl>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>
	<200906031129.19780.torleif.lunde@cih.uib.no>
	<BLU123-W2453191A9B974B3E202BBBE94B0@phx.gbl>
Message-ID: <200906041523.17873.torleif.lunde@cih.uib.no>

Yes

First: type ?readShapePoly
If it does not help, use Google, Bing, RSiteSearch, etc.
Third: ask R-sig-geo

natSHP.sp <- readShapePoly("nro2.shp", proj4string=CRS("+init=epsg:2166"))
spplot(natSHP.sp, "NATURRAUMO")

To understand the error, try:
system.file("package="maptools")
system.file("shapes/sids.shp", package="maptools")
and
system.file("nro2.shp", package="maptools")

Best
Torleif

On Thursday 04 June 2009 03:02:44 pm Jian Li wrote:
> Dear Torleif,
>
> I just tried to produce another SpatialPolygons like nat.sp from SHP file
> like this following: natSHP.sp <- readShapePoly(system.file("nro2.shp",
> package="maptools")[1], proj4string=CRS("+init=epsg:2166"))
>
> in order to approach it in the same way for saving the information in KML
> file
>
> But it doesn't work. Do you know what's going wrong or do you have any
> better idea?
>
> The nro2.shp is under
> http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/arcViewNro2/
> available.
>
> greeting,
> Jian
>
> > ########################
> > ##Export e00 to Google Earth (png)##
> > ########################
> >
> > #1: import using RArcInfo
> >
> > #Set the working directory to where you stored your nat.e00 data
> > setwd('~/e00data') #Use your own path
> >
> > #load the RArcInfo library (for functions e00toavc, get.xxx)
> > require(RArcInfo)
> >
> > #Convert the e00 to SpatialPolygons
> > e00toavc('nat.e00', './nat2')
> > nat.arc <- get.arcdata("./", "nat2")
> > nat.pal <- get.paldata("./", "nat2")
> > require(maptools) #Needed for pal2SpatialPolygons
> > nat.sp <- pal2SpatialPolygons(nat.arc,
> > 	      nat.pal,
> > 	      nat.pal[[1]]$PolygonId[-1],
> > 	      dropPoly1=TRUE,
> > 	      proj4string=CRS("+init=epsg:2166"))
> >
> > #Transform to longlat, WGS84
> > require(rgdal)
> > nat2.sp <- spTransform(nat.sp, CRS("+proj=longlat +ellps=WGS84"))
> >
> > #Set up metadata
> > GSG <- GE_SpatialGrid(nat2.sp)
> >
> > #Ask for the tempdir
> > tmp.dir <- tempdir()
> >
> > #To change the resolution (and line width), change res
> > res <- 5
> > #Make png-file
> > png(file=paste(tmp.dir, "/", "nat.png", sep=""), width=GSG$width*res,
> > height=GSG$height*res,
> > bg="transparent")
> >      par(mar=c(0,0,0,0), xaxs="i", yaxs="i")
> >      plot(nat2.sp, xlim=GSG$xlim, ylim=GSG$ylim, lwd = res)
> > dev.off()
> >
> > #And make the Google earth kml-file
> > kmlOverlay(SGqk, paste(tmp.dir, "/",  "nat.kml", sep=""),
> > paste(tmp.dir, "/", "nat.png", sep=""))
> >
> > #Now, see in td, and you have your kml and png.
> >
> >
> > ###########################################
> > ##Export the same data as polygons (still to Google earth)
> > #The second option is to export as polygons
> > #(See ?kmlPolygon in maptools)
> >
> > out <- sapply(slot(nat2.sp, "polygons"), function(x) { kmlPolygon(x,
> >     name=paste(slot(x, "ID")),
> >     col="transparent", lwd=5, border='black',
> >     description=paste(slot(x, "ID"))) })
> >
> > tf <- tempfile()
> >
> > kmlFile <- file(paste(tf, ".kml", sep=""), "w")
> > cat(kmlPolygon(kmlname="MyGPoly",
> > kmldescription="<i>Masterthesis</i>")$header,
> >     file=kmlFile, sep="\n")
> > cat(unlist(out["style",]), file=kmlFile, sep="\n")
> > cat(unlist(out["content",]), file=kmlFile, sep="\n")
> > cat(kmlPolygon()$footer, file=kmlFile, sep="\n")
> > close(kmlFile)
> > #################
> >
> > Best wishes
> > Torleif
> >
> > On Wednesday 03 June 2009 09:45:45 am Paul Hiemstra wrote:
> > > Hi,
> > >
> > > You have to do two things, read your data and export it to a format for
> > > Google Earth.
> > >
> > > The Cran Spatial Taskview suggests the RArcInfo package to read the e00
> > > files into R. I'm not sure into what format they are loaded. Maybe
> > > readOGR from the rgdal package can also read e00 files, depending on
> > > the GDAL/OGR version you have available.
> > >
> > > If you have your vector file in an R session in a SpatialPolygons
> > > object (see the sp-package), the following code shows an example how to
> > > export the data to a format that Google Earth can read:
> > >
> > > library(rgdal)
> > > data(meuse)
> > > coordinates(meuse) = ~x+y
> > > proj4string(meuse) = CRS("+init=epsg:28992")
> > > proj4string(meuse)
> > > meuse.ll = spTransform(meuse, CRS("+proj=longlat"))
> > > writeOGR(meuse.ll, "meuse.kml", "meuse.kml", driver="KML")
> > >
> > > I'm not sure if the RArcInfo reads the e00 file into a SpatialPolygons
> > > object (Virgillio?), or if it is easy to convert the output from
> > > RArcInfo to an sp-class. rgdal always reads data into an sp-class, but
> > > I'm not sure if this supports the e00 format.
> > >
> > > I hope this e-mail provides you with some clues to work with,
> > >
> > > cheers and good luck with your thesis,
> > > Paul
> > >
> > > Jian Li wrote:
> > > > Dear r-sig-geo Members,
> > > >
> > > > recently, I've been trying to display the information from a e00 file
> > > > (Grauss-Kr?ger coordinatensystem) in Google map but until now no
> > > > success.
> > > >
> > > > I would be very appreciated if anyone can help me to solve the
> > > > problem which directly concerns my master thesis.
> > > >
> > > > e00 file is under
> > > > http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/nat.e00
> > > > available
> > > >
> > > > Thank you in Advanced
> > > >
> > > > Best Regards,
> > > > Jian
> > > >
> > > > check out the rest of the Windows Live?.
> > > > More than mail?Windows Live? goes way beyond your inbox.
> > > >  More than messages
> > > > _________________________________________________________________
> > > > Show them the way! Add maps and directions to your party invites.
> > > > http://www.microsoft.com/windows/windowslive/products/events.aspx
> > > > 	[[alternative HTML version deleted]]
> > > >
> > > >
> > > > ---------------------------------------------------------------------
> > > >---
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at stat.math.ethz.ch
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _________________________________________________________________
> Invite your mail contacts to join your friends list with Windows Live
> Spaces. It's easy!
> http://spaces.live.com/spacesapi.aspx?wx_action=create&wx_url=/friends.aspx
>&mkt=en-us


From wroberts at csir.co.za  Thu Jun  4 15:29:39 2009
From: wroberts at csir.co.za (Wesley Roberts)
Date: Thu, 04 Jun 2009 15:29:39 +0200
Subject: [R-sig-Geo] how to show polygons from SHP file in Google	map?
In-Reply-To: <BLU123-W2453191A9B974B3E202BBBE94B0@phx.gbl>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>
	<4A262A29.6070400@geo.uu.nl>
	<200906031129.19780.torleif.lunde@cih.uib.no>
	<BLU123-W2453191A9B974B3E202BBBE94B0@phx.gbl>
Message-ID: <4A27E862.8E3B.0073.0@csir.co.za>

Hi Jian,

Just noticing that you are using system.file, as I understand it this
command / switch is used for internally available data shipped with R
and the associated R-spatial packages. Your data, I believe will be
available on your hard disk and not from internal data packages
provided. I think the following should work, although I cant be 100%
sure

natSHP.sp <- readShapePoly("nro2.shp", package="maptools",
proj4string=CRS("+init=epsg:2166"))

Make sure that your working directory is set to the location of your
"nro2.shp" file and that you have the required packages loaded.

Hope this helps
Wesley

Wesley Roberts MSc.
Researcher: Earth Observation
Natural Resources & the Environment (NRE)
CSIR
Tel: +27 (0)21 888-2490
Fax: +27 (0)21 888-2693
"To know the road ahead, ask those coming back."
- Chinese proverb


>>> Jian Li <jli at mi.fu-berlin.de> 04/06/2009 15:02 >>>



Dear Torleif,

I just tried to produce another SpatialPolygons like nat.sp from SHP
file like this following: 
natSHP.sp <- readShapePoly(system.file("nro2.shp",
package="maptools")[1], proj4string=CRS("+init=epsg:2166"))

in order to approach it in the same way for saving the information in
KML file

But it doesn't work. Do you know what's going wrong or do you have any
better idea?

The nro2.shp is under
http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/arcViewNro2/
available.

greeting,
Jian


 
> ########################
> ##Export e00 to Google Earth (png)##
> ########################
> 
> #1: import using RArcInfo
> 
> #Set the working directory to where you stored your nat.e00 data
> setwd('~/e00data') #Use your own path
> 
> #load the RArcInfo library (for functions e00toavc, get.xxx)
> require(RArcInfo)
> 
> #Convert the e00 to SpatialPolygons
> e00toavc('nat.e00', './nat2')
> nat.arc <- get.arcdata("./", "nat2")
> nat.pal <- get.paldata("./", "nat2")
> require(maptools) #Needed for pal2SpatialPolygons
> nat.sp <- pal2SpatialPolygons(nat.arc, 
> 	      nat.pal, 
> 	      nat.pal[[1]]$PolygonId[-1], 
> 	      dropPoly1=TRUE, 
> 	      proj4string=CRS("+init=epsg:2166"))
> 
> #Transform to longlat, WGS84
> require(rgdal)
> nat2.sp <- spTransform(nat.sp, CRS("+proj=longlat +ellps=WGS84"))
> 
> #Set up metadata
> GSG <- GE_SpatialGrid(nat2.sp)
> 
> #Ask for the tempdir
> tmp.dir <- tempdir()
> 
> #To change the resolution (and line width), change res
> res <- 5
> #Make png-file
> png(file=paste(tmp.dir, "/", "nat.png", sep=""), width=GSG$width*res,

> height=GSG$height*res,
> bg="transparent")
>      par(mar=c(0,0,0,0), xaxs="i", yaxs="i")
>      plot(nat2.sp, xlim=GSG$xlim, ylim=GSG$ylim, lwd = res)
> dev.off()
> 
> #And make the Google earth kml-file
> kmlOverlay(SGqk, paste(tmp.dir, "/",  "nat.kml", sep=""), 
> paste(tmp.dir, "/", "nat.png", sep=""))
> 
> #Now, see in td, and you have your kml and png.
> 
> 
> ###########################################
> ##Export the same data as polygons (still to Google earth)
> #The second option is to export as polygons
> #(See ?kmlPolygon in maptools)
> 
> out <- sapply(slot(nat2.sp, "polygons"), function(x) { kmlPolygon(x,
>     name=paste(slot(x, "ID")), 
>     col="transparent", lwd=5, border='black', 
>     description=paste(slot(x, "ID"))) })
> 
> tf <- tempfile()
> 
> kmlFile <- file(paste(tf, ".kml", sep=""), "w")
> cat(kmlPolygon(kmlname="MyGPoly", 
> kmldescription="<i>Masterthesis</i>")$header, 
>     file=kmlFile, sep="\n")
> cat(unlist(out["style",]), file=kmlFile, sep="\n")
> cat(unlist(out["content",]), file=kmlFile, sep="\n")
> cat(kmlPolygon()$footer, file=kmlFile, sep="\n")
> close(kmlFile)
> #################
> 
> Best wishes
> Torleif
> 
> 
> On Wednesday 03 June 2009 09:45:45 am Paul Hiemstra wrote:
> > Hi,
> >
> > You have to do two things, read your data and export it to a format
for
> > Google Earth.
> >
> > The Cran Spatial Taskview suggests the RArcInfo package to read the
e00
> > files into R. I'm not sure into what format they are loaded. Maybe
> > readOGR from the rgdal package can also read e00 files, depending
on the
> > GDAL/OGR version you have available.
> >
> > If you have your vector file in an R session in a SpatialPolygons
object
> > (see the sp-package), the following code shows an example how to
export
> > the data to a format that Google Earth can read:
> >
> > library(rgdal)
> > data(meuse)
> > coordinates(meuse) = ~x+y
> > proj4string(meuse) = CRS("+init=epsg:28992")
> > proj4string(meuse)
> > meuse.ll = spTransform(meuse, CRS("+proj=longlat"))
> > writeOGR(meuse.ll, "meuse.kml", "meuse.kml", driver="KML")
> >
> > I'm not sure if the RArcInfo reads the e00 file into a
SpatialPolygons
> > object (Virgillio?), or if it is easy to convert the output from
> > RArcInfo to an sp-class. rgdal always reads data into an sp-class,
but
> > I'm not sure if this supports the e00 format.
> >
> > I hope this e-mail provides you with some clues to work with,
> >
> > cheers and good luck with your thesis,
> > Paul
> >
> > Jian Li wrote:
> > > Dear r-sig-geo Members,
> > >
> > > recently, I've been trying to display the information from a e00
file
> > > (Grauss-Kr?ger coordinatensystem) in Google map but until now no
success.
> > >
> > > I would be very appreciated if anyone can help me to solve the
problem
> > > which directly concerns my master thesis.
> > >
> > > e00 file is under
> > > http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/nat.e00

> > > available
> > >
> > > Thank you in Advanced
> > >
> > > Best Regards,
> > > Jian
> > >
> > > check out the rest of the Windows Live?.
> > > More than mail?Windows Live? goes way beyond your inbox.
> > >  More than messages
> > >
_________________________________________________________________
> > > Show them the way! Add maps and directions to your party
invites.
> > > http://www.microsoft.com/windows/windowslive/products/events.aspx

> > > 	[[alternative HTML version deleted]]
> > >
> > >
> > >
------------------------------------------------------------------------
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch 
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
> 
> 

_________________________________________________________________
Invite your mail contacts to join your friends list with Windows Live
Spaces. It's easy!
http://spaces.live.com/spacesapi.aspx?wx_action=create&wx_url=/friends.aspx&mkt=en-us

	[[alternative HTML version deleted]]


-- 
This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard. 
The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.


From j.burke at earthlink.net  Thu Jun  4 15:59:47 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Thu, 04 Jun 2009 08:59:47 -0500
Subject: [R-sig-Geo] how to show polygons from SHP file in Google map?
In-Reply-To: <200906041523.17873.torleif.lunde@cih.uib.no>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>	<200906031129.19780.torleif.lunde@cih.uib.no>	<BLU123-W2453191A9B974B3E202BBBE94B0@phx.gbl>
	<200906041523.17873.torleif.lunde@cih.uib.no>
Message-ID: <4A27D353.7020909@earthlink.net>

Jian,

First realize where your R code was trying to
find your shapefile. In your code below you
are searching maptools\shapes and not your code
subdirectory. Maptools is the domain of that
package and you should not put your shapefiles
there but in your own separate user subdirectory.

natSHP.sp <- readShapePoly(system.file("nro2.shp", package="maptools")[1], proj4string=CRS("+init=epsg:2166"))

Then in R, make sure R is pointing to the
directory where your nro2.shp file exists.

This can be done by selecting in R, File,
Change Directory.

Good luck,
Jim Burke

Torleif Markussen Lunde wrote:
> Yes
>
> First: type ?readShapePoly
> If it does not help, use Google, Bing, RSiteSearch, etc.
> Third: ask R-sig-geo
>
> natSHP.sp <- readShapePoly("nro2.shp", proj4string=CRS("+init=epsg:2166"))
> spplot(natSHP.sp, "NATURRAUMO")
>
> To understand the error, try:
> system.file("package="maptools")
> system.file("shapes/sids.shp", package="maptools")
> and
> system.file("nro2.shp", package="maptools")
>
> Best
> Torleif
>
> On Thursday 04 June 2009 03:02:44 pm Jian Li wrote:
>   
>> Dear Torleif,
>>
>> I just tried to produce another SpatialPolygons like nat.sp from SHP file
>> like this following: natSHP.sp <- readShapePoly(system.file("nro2.shp",
>> package="maptools")[1], proj4string=CRS("+init=epsg:2166"))
>>
>> in order to approach it in the same way for saving the information in KML
>> file
>>
>> But it doesn't work. Do you know what's going wrong or do you have any
>> better idea?
>>
>> The nro2.shp is under
>> http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/arcViewNro2/
>> available.
>>
>> greeting,
>> Jian
>>
>>     
>>> ########################
>>> ##Export e00 to Google Earth (png)##
>>> ########################
>>>
>>> #1: import using RArcInfo
>>>
>>> #Set the working directory to where you stored your nat.e00 data
>>> setwd('~/e00data') #Use your own path
>>>
>>> #load the RArcInfo library (for functions e00toavc, get.xxx)
>>> require(RArcInfo)
>>>
>>> #Convert the e00 to SpatialPolygons
>>> e00toavc('nat.e00', './nat2')
>>> nat.arc <- get.arcdata("./", "nat2")
>>> nat.pal <- get.paldata("./", "nat2")
>>> require(maptools) #Needed for pal2SpatialPolygons
>>> nat.sp <- pal2SpatialPolygons(nat.arc,
>>> 	      nat.pal,
>>> 	      nat.pal[[1]]$PolygonId[-1],
>>> 	      dropPoly1=TRUE,
>>> 	      proj4string=CRS("+init=epsg:2166"))
>>>
>>> #Transform to longlat, WGS84
>>> require(rgdal)
>>> nat2.sp <- spTransform(nat.sp, CRS("+proj=longlat +ellps=WGS84"))
>>>
>>> #Set up metadata
>>> GSG <- GE_SpatialGrid(nat2.sp)
>>>
>>> #Ask for the tempdir
>>> tmp.dir <- tempdir()
>>>
>>> #To change the resolution (and line width), change res
>>> res <- 5
>>> #Make png-file
>>> png(file=paste(tmp.dir, "/", "nat.png", sep=""), width=GSG$width*res,
>>> height=GSG$height*res,
>>> bg="transparent")
>>>      par(mar=c(0,0,0,0), xaxs="i", yaxs="i")
>>>      plot(nat2.sp, xlim=GSG$xlim, ylim=GSG$ylim, lwd = res)
>>> dev.off()
>>>
>>> #And make the Google earth kml-file
>>> kmlOverlay(SGqk, paste(tmp.dir, "/",  "nat.kml", sep=""),
>>> paste(tmp.dir, "/", "nat.png", sep=""))
>>>
>>> #Now, see in td, and you have your kml and png.
>>>
>>>
>>> ###########################################
>>> ##Export the same data as polygons (still to Google earth)
>>> #The second option is to export as polygons
>>> #(See ?kmlPolygon in maptools)
>>>
>>> out <- sapply(slot(nat2.sp, "polygons"), function(x) { kmlPolygon(x,
>>>     name=paste(slot(x, "ID")),
>>>     col="transparent", lwd=5, border='black',
>>>     description=paste(slot(x, "ID"))) })
>>>
>>> tf <- tempfile()
>>>
>>> kmlFile <- file(paste(tf, ".kml", sep=""), "w")
>>> cat(kmlPolygon(kmlname="MyGPoly",
>>> kmldescription="<i>Masterthesis</i>")$header,
>>>     file=kmlFile, sep="\n")
>>> cat(unlist(out["style",]), file=kmlFile, sep="\n")
>>> cat(unlist(out["content",]), file=kmlFile, sep="\n")
>>> cat(kmlPolygon()$footer, file=kmlFile, sep="\n")
>>> close(kmlFile)
>>> #################
>>>
>>> Best wishes
>>> Torleif
>>>
>>> On Wednesday 03 June 2009 09:45:45 am Paul Hiemstra wrote:
>>>       
>>>> Hi,
>>>>
>>>> You have to do two things, read your data and export it to a format for
>>>> Google Earth.
>>>>
>>>> The Cran Spatial Taskview suggests the RArcInfo package to read the e00
>>>> files into R. I'm not sure into what format they are loaded. Maybe
>>>> readOGR from the rgdal package can also read e00 files, depending on
>>>> the GDAL/OGR version you have available.
>>>>
>>>> If you have your vector file in an R session in a SpatialPolygons
>>>> object (see the sp-package), the following code shows an example how to
>>>> export the data to a format that Google Earth can read:
>>>>
>>>> library(rgdal)
>>>> data(meuse)
>>>> coordinates(meuse) = ~x+y
>>>> proj4string(meuse) = CRS("+init=epsg:28992")
>>>> proj4string(meuse)
>>>> meuse.ll = spTransform(meuse, CRS("+proj=longlat"))
>>>> writeOGR(meuse.ll, "meuse.kml", "meuse.kml", driver="KML")
>>>>
>>>> I'm not sure if the RArcInfo reads the e00 file into a SpatialPolygons
>>>> object (Virgillio?), or if it is easy to convert the output from
>>>> RArcInfo to an sp-class. rgdal always reads data into an sp-class, but
>>>> I'm not sure if this supports the e00 format.
>>>>
>>>> I hope this e-mail provides you with some clues to work with,
>>>>
>>>> cheers and good luck with your thesis,
>>>> Paul
>>>>
>>>> Jian Li wrote:
>>>>         
>>>>> Dear r-sig-geo Members,
>>>>>
>>>>> recently, I've been trying to display the information from a e00 file
>>>>> (Grauss-Kr?ger coordinatensystem) in Google map but until now no
>>>>> success.
>>>>>
>>>>> I would be very appreciated if anyone can help me to solve the
>>>>> problem which directly concerns my master thesis.
>>>>>
>>>>> e00 file is under
>>>>> http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/nat.e00
>>>>> available
>>>>>
>>>>> Thank you in Advanced
>>>>>
>>>>> Best Regards,
>>>>> Jian
>>>>>
>>>>> check out the rest of the Windows Live?.
>>>>> More than mail?Windows Live? goes way beyond your inbox.
>>>>>  More than messages
>>>>> _________________________________________________________________
>>>>> Show them the way! Add maps and directions to your party invites.
>>>>> http://www.microsoft.com/windows/windowslive/products/events.aspx
>>>>> 	[[alternative HTML version deleted]]
>>>>>
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> ---
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>           
>> _________________________________________________________________
>> Invite your mail contacts to join your friends list with Windows Live
>> Spaces. It's easy!
>> http://spaces.live.com/spacesapi.aspx?wx_action=create&wx_url=/friends.aspx
>> &mkt=en-us
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From j.burke at earthlink.net  Thu Jun  4 16:59:27 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Thu, 04 Jun 2009 09:59:27 -0500
Subject: [R-sig-Geo] how to show polygons from SHP file in Google map?
In-Reply-To: <4A27D353.7020909@earthlink.net>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>	<200906031129.19780.torleif.lunde@cih.uib.no>	<BLU123-W2453191A9B974B3E202BBBE94B0@phx.gbl>	<200906041523.17873.torleif.lunde@cih.uib.no>
	<4A27D353.7020909@earthlink.net>
Message-ID: <4A27E14F.5050700@earthlink.net>

This is for future people with "filen" issues.  An attempt to read
an invalid location will produce the error shown below.  Please
read the attached email below or the previous email in this thread
for cause and solution.

 > natSHP.sp <- readShapePoly(system.file("nro2.shp", 
package="maptools")[1], proj4string=CRS("+init=epsg:2166"))
Error in getinfo.shape(filen) : Error opening SHP file

Good luck,
Jim Burke


Jim Burke wrote:
> Jian,
>
> First realize where your R code was trying to
> find your shapefile. In your code below you
> are searching maptools\shapes and not your code
> subdirectory. Maptools is the domain of that
> package and you should not put your shapefiles
> there but in your own separate user subdirectory.
>
> natSHP.sp <- readShapePoly(system.file("nro2.shp", 
> package="maptools")[1], proj4string=CRS("+init=epsg:2166"))
>
> Then in R, make sure R is pointing to the
> directory where your nro2.shp file exists.
>
> This can be done by selecting in R, File,
> Change Directory.
>
> Good luck,
> Jim Burke
>
> Torleif Markussen Lunde wrote:
>> Yes
>>
>> First: type ?readShapePoly
>> If it does not help, use Google, Bing, RSiteSearch, etc.
>> Third: ask R-sig-geo
>>
>> natSHP.sp <- readShapePoly("nro2.shp", 
>> proj4string=CRS("+init=epsg:2166"))
>> spplot(natSHP.sp, "NATURRAUMO")
>>
>> To understand the error, try:
>> system.file("package="maptools")
>> system.file("shapes/sids.shp", package="maptools")
>> and
>> system.file("nro2.shp", package="maptools")
>>
>> Best
>> Torleif
>>
>> On Thursday 04 June 2009 03:02:44 pm Jian Li wrote:
>>  
>>> Dear Torleif,
>>>
>>> I just tried to produce another SpatialPolygons like nat.sp from SHP 
>>> file
>>> like this following: natSHP.sp <- readShapePoly(system.file("nro2.shp",
>>> package="maptools")[1], proj4string=CRS("+init=epsg:2166"))
>>>
>>> in order to approach it in the same way for saving the information 
>>> in KML
>>> file
>>>
>>> But it doesn't work. Do you know what's going wrong or do you have any
>>> better idea?
>>>
>>> The nro2.shp is under
>>> http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/arcViewNro2/
>>> available.
>>>
>>> greeting,
>>> Jian
>>>
>>>    
>>>> ########################
>>>> ##Export e00 to Google Earth (png)##
>>>> ########################
>>>>
>>>> #1: import using RArcInfo
>>>>
>>>> #Set the working directory to where you stored your nat.e00 data
>>>> setwd('~/e00data') #Use your own path
>>>>
>>>> #load the RArcInfo library (for functions e00toavc, get.xxx)
>>>> require(RArcInfo)
>>>>
>>>> #Convert the e00 to SpatialPolygons
>>>> e00toavc('nat.e00', './nat2')
>>>> nat.arc <- get.arcdata("./", "nat2")
>>>> nat.pal <- get.paldata("./", "nat2")
>>>> require(maptools) #Needed for pal2SpatialPolygons
>>>> nat.sp <- pal2SpatialPolygons(nat.arc,
>>>>           nat.pal,
>>>>           nat.pal[[1]]$PolygonId[-1],
>>>>           dropPoly1=TRUE,
>>>>           proj4string=CRS("+init=epsg:2166"))
>>>>
>>>> #Transform to longlat, WGS84
>>>> require(rgdal)
>>>> nat2.sp <- spTransform(nat.sp, CRS("+proj=longlat +ellps=WGS84"))
>>>>
>>>> #Set up metadata
>>>> GSG <- GE_SpatialGrid(nat2.sp)
>>>>
>>>> #Ask for the tempdir
>>>> tmp.dir <- tempdir()
>>>>
>>>> #To change the resolution (and line width), change res
>>>> res <- 5
>>>> #Make png-file
>>>> png(file=paste(tmp.dir, "/", "nat.png", sep=""), width=GSG$width*res,
>>>> height=GSG$height*res,
>>>> bg="transparent")
>>>>      par(mar=c(0,0,0,0), xaxs="i", yaxs="i")
>>>>      plot(nat2.sp, xlim=GSG$xlim, ylim=GSG$ylim, lwd = res)
>>>> dev.off()
>>>>
>>>> #And make the Google earth kml-file
>>>> kmlOverlay(SGqk, paste(tmp.dir, "/",  "nat.kml", sep=""),
>>>> paste(tmp.dir, "/", "nat.png", sep=""))
>>>>
>>>> #Now, see in td, and you have your kml and png.
>>>>
>>>>
>>>> ###########################################
>>>> ##Export the same data as polygons (still to Google earth)
>>>> #The second option is to export as polygons
>>>> #(See ?kmlPolygon in maptools)
>>>>
>>>> out <- sapply(slot(nat2.sp, "polygons"), function(x) { kmlPolygon(x,
>>>>     name=paste(slot(x, "ID")),
>>>>     col="transparent", lwd=5, border='black',
>>>>     description=paste(slot(x, "ID"))) })
>>>>
>>>> tf <- tempfile()
>>>>
>>>> kmlFile <- file(paste(tf, ".kml", sep=""), "w")
>>>> cat(kmlPolygon(kmlname="MyGPoly",
>>>> kmldescription="<i>Masterthesis</i>")$header,
>>>>     file=kmlFile, sep="\n")
>>>> cat(unlist(out["style",]), file=kmlFile, sep="\n")
>>>> cat(unlist(out["content",]), file=kmlFile, sep="\n")
>>>> cat(kmlPolygon()$footer, file=kmlFile, sep="\n")
>>>> close(kmlFile)
>>>> #################
>>>>
>>>> Best wishes
>>>> Torleif
>>>>
>>>> On Wednesday 03 June 2009 09:45:45 am Paul Hiemstra wrote:
>>>>      
>>>>> Hi,
>>>>>
>>>>> You have to do two things, read your data and export it to a 
>>>>> format for
>>>>> Google Earth.
>>>>>
>>>>> The Cran Spatial Taskview suggests the RArcInfo package to read 
>>>>> the e00
>>>>> files into R. I'm not sure into what format they are loaded. Maybe
>>>>> readOGR from the rgdal package can also read e00 files, depending on
>>>>> the GDAL/OGR version you have available.
>>>>>
>>>>> If you have your vector file in an R session in a SpatialPolygons
>>>>> object (see the sp-package), the following code shows an example 
>>>>> how to
>>>>> export the data to a format that Google Earth can read:
>>>>>
>>>>> library(rgdal)
>>>>> data(meuse)
>>>>> coordinates(meuse) = ~x+y
>>>>> proj4string(meuse) = CRS("+init=epsg:28992")
>>>>> proj4string(meuse)
>>>>> meuse.ll = spTransform(meuse, CRS("+proj=longlat"))
>>>>> writeOGR(meuse.ll, "meuse.kml", "meuse.kml", driver="KML")
>>>>>
>>>>> I'm not sure if the RArcInfo reads the e00 file into a 
>>>>> SpatialPolygons
>>>>> object (Virgillio?), or if it is easy to convert the output from
>>>>> RArcInfo to an sp-class. rgdal always reads data into an sp-class, 
>>>>> but
>>>>> I'm not sure if this supports the e00 format.
>>>>>
>>>>> I hope this e-mail provides you with some clues to work with,
>>>>>
>>>>> cheers and good luck with your thesis,
>>>>> Paul
>>>>>
>>>>> Jian Li wrote:
>>>>>        
>>>>>> Dear r-sig-geo Members,
>>>>>>
>>>>>> recently, I've been trying to display the information from a e00 
>>>>>> file
>>>>>> (Grauss-Kr?ger coordinatensystem) in Google map but until now no
>>>>>> success.
>>>>>>
>>>>>> I would be very appreciated if anyone can help me to solve the
>>>>>> problem which directly concerns my master thesis.
>>>>>>
>>>>>> e00 file is under
>>>>>> http://jaguar.biologie.hu-berlin.de/~jian/phpMysqlGoogle/nat.e00
>>>>>> available
>>>>>>
>>>>>> Thank you in Advanced
>>>>>>
>>>>>> Best Regards,
>>>>>> Jian
>>>>>>
>>>>>> check out the rest of the Windows Live?.
>>>>>> More than mail?Windows Live? goes way beyond your inbox.
>>>>>>  More than messages
>>>>>> _________________________________________________________________
>>>>>> Show them the way! Add maps and directions to your party invites.
>>>>>> http://www.microsoft.com/windows/windowslive/products/events.aspx
>>>>>>     [[alternative HTML version deleted]]
>>>>>>
>>>>>>
>>>>>> --------------------------------------------------------------------- 
>>>>>>
>>>>>> ---
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>           
>>> _________________________________________________________________
>>> Invite your mail contacts to join your friends list with Windows Live
>>> Spaces. It's easy!
>>> http://spaces.live.com/spacesapi.aspx?wx_action=create&wx_url=/friends.aspx 
>>>
>>> &mkt=en-us
>>>     
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Greg.Snow at imail.org  Thu Jun  4 18:05:15 2009
From: Greg.Snow at imail.org (Greg Snow)
Date: Thu, 4 Jun 2009 10:05:15 -0600
Subject: [R-sig-Geo] missing county in maps
In-Reply-To: <7F5B301C-E690-4309-95B1-548D2EE618BB@lanl.gov>
References: <7F5B301C-E690-4309-95B1-548D2EE618BB@lanl.gov>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC61D21665ED@LP-EXMBVS10.CO.IHC.COM>

I don't know how to change the map for the maps package.  But the maptools package (and sp) will read and plot shape files.  2 possible sources for shapefiles that may have the more current counties are:

http://www.census.gov/geo/www/maps/ (http://www.census.gov/geo/cob/bdy/co/co00shp/co35_d00_shp.zip)
http://www.cloudmade.com/ (http://downloads.cloudmade.com/north_america/united_states/new_mexico/new_mexico.shapefiles.zip)

hope this helps,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] On Behalf Of stubben
> Sent: Wednesday, June 03, 2009 8:52 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] missing county in maps
> 
> Hi,
> 
> I 'm trying to color a county map of New Mexico based on some data I
> have - however, I have one extra county, Cibola, which is not in the
> county maps (v 2.1-0) database.  This county was created in 1981 by
> splitting the existing Valencia county in two.  Is there an easy way
> to  split the existing polygon in the county database or some other
> workaround?
> 
> #32 counties (Cibola is missing)
> map.text("county", "new mexico")
> 
> Thanks,
> 
> Chris Stubben
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From etiennebr at gmail.com  Thu Jun  4 20:15:53 2009
From: etiennebr at gmail.com (Etienne Bellemare)
Date: Thu, 4 Jun 2009 14:15:53 -0400
Subject: [R-sig-Geo] Keep dimensions with dilate.owin
Message-ID: <6e10ffb0906041115g7779cb4eyb5d281a4d57de5d0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090604/047cad68/attachment.pl>

From debeaudette at ucdavis.edu  Fri Jun  5 02:27:41 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Thu, 4 Jun 2009 17:27:41 -0700
Subject: [R-sig-Geo] spgrass6 and R 2.9
In-Reply-To: <alpine.LRH.2.00.0906012345540.31055@reclus.nhh.no>
References: <200905291426.56291.dylan.beaudette@gmail.com>
	<200906011114.05035.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.0906012345540.31055@reclus.nhh.no>
Message-ID: <200906041727.41457.dylan.beaudette@gmail.com>

On Monday 01 June 2009, Roger Bivand wrote:
> On Mon, 1 Jun 2009, Dylan Beaudette wrote:
> > On Friday 29 May 2009, Torleif Markussen Lunde wrote:
> >> Hi
> >>
> >> First try updating glibc, and install spgrass6 again. If this does not
> >> work you could try
> >>
> >> export MALLOC_CHECK_=0
> >>
> >> before you start R. The error might be related to "somewhere something"
> >> is trying to free memory that has already been unallocated. I don't know
> >> the details here, but it could be worth a try?
> >>
> >> Best wishes
> >> Torleif
> >
> > Hi Torleif, thanks for the tips.
> >
> > I just updated my libc, and tried the MALLOC_CHECK trick-- neither fixed
> > the problem. Still get the same error... Very strange, as I did not
> > encounter this problem on a very similar machine.
> >
> > Could this have anything to do with configure arguments such as -march ?
>
> You haven't told us what your underlying system is, or how you installed
> R. If you built R from source, did you run "make check"? Does the problem
> arise installing other packages? It most likely is something on your
> system, otherwise there would be lots of reports of the same.
>
> Roger

Right. Should have been a little less hasty about posting to the list. R has 
been built from source, spgrass6 was accessed from CRAN via 
install.packages(). This problems has not occurred at anyother time while 
updating packages that were installed under R 2.7. 

1. make check (R 2.9.0): OK

2. sessionInfo()
R version 2.9.0 (2009-04-17) 
i686-pc-linux-gnu 

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=C;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base 

Is there any way that I can do a 'make check' type of operation with the 
latest spgrass6 from CRAN?

Note that trying to manually install the package, like this:
sudo R CMD INSTALL spgrass6_0.6-6.tar.gz

results in:
* Installing to library '/usr/local/lib/R/library'
* Installing *source* package 'spgrass6' ...
** R
** inst
** preparing package for lazy loading
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.0dev, released 2008/11/26
Path to GDAL shared files: /usr/local/share/gdal
Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
Path to PROJ.4 shared files: (autodetected)
** help
*** installing help indices
 >>> Building/Updating help pages for package 'spgrass6'
     Formats: text html latex example 
  execGRASS                         text    html    latex   example
  gmeta6                            text    html    latex   example
  initGRASS                         text    html    latex   example
  readRAST6                         text    html    latex   example
  readVECT6                         text    html    latex   example
  spgrass6                          text    html    latex   example
** building package indices ...
* DONE (spgrass6)
*** glibc detected *** /usr/local/lib/R/bin/exec/R: double free or corruption 
(fasttop): 0x0857d880 ***

hope that is enough information.

Cheers,
Dylan


> > Cheers,
> > Dylan
> >
> >> On Friday 29 May 2009 11:26:56 pm Dylan Beaudette wrote:
> >>> Hi,
> >>>
> >>> Just upgraded to R 2.9.0 this morning, and tried to update all of my
> >>> packages. Everyhing seemed to work, except spgrass6. Manually removing
> >>> the old packing and installing fresh resulted in:
> >>>
> >>> install.packages('spgrass6', dep=TRUE)
> >>> trying URL
> >>> 'http://cran.cnr.Berkeley.edu/src/contrib/spgrass6_0.6-6.tar.gz'
> >>> Content type 'application/x-gzip' length 332298 bytes (324 Kb)
> >>> opened URL
> >>> ==================================================
> >>> downloaded 324 Kb
> >>>
> >>> * Installing *source* package 'spgrass6' ...
> >>> ** R
> >>> ** inst
> >>> ** preparing package for lazy loading
> >>> Geospatial Data Abstraction Library extensions to R successfully loaded
> >>> Loaded GDAL runtime: GDAL 1.7.0dev, released 2008/11/26
> >>> Path to GDAL shared files: /usr/local/share/gdal
> >>> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
> >>> Path to PROJ.4 shared files: (autodetected)
> >>> ** help
> >>> *** installing help indices
> >>>
> >>> >>> Building/Updating help pages for package 'spgrass6'
> >>>
> >>>      Formats: text html latex example
> >>>   execGRASS                         text    html    latex   example
> >>>   gmeta6                            text    html    latex   example
> >>>   initGRASS                         text    html    latex   example
> >>>   readRAST6                         text    html    latex   example
> >>>   readVECT6                         text    html    latex   example
> >>>   spgrass6                          text    html    latex   example
> >>> ** building package indices ...
> >>> * DONE (spgrass6)
> >>> *** glibc detected *** /usr/local/lib/R/bin/exec/R: double free or
> >>> corruption (fasttop): 0x096ac2b0 ***
> >>>
> >>>
> >>> At this point R stops responding, and I have to issue a `kill -9` to
> >>> make regain control of the shell.
> >>>
> >>> Any ideas?
> >>>
> >>> Dylan



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From Roger.Bivand at nhh.no  Fri Jun  5 10:55:30 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Jun 2009 10:55:30 +0200 (CEST)
Subject: [R-sig-Geo] spgrass6 and R 2.9
In-Reply-To: <200906041727.41457.dylan.beaudette@gmail.com>
References: <200905291426.56291.dylan.beaudette@gmail.com>
	<200906011114.05035.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.0906012345540.31055@reclus.nhh.no>
	<200906041727.41457.dylan.beaudette@gmail.com>
Message-ID: <alpine.LRH.2.00.0906051051340.10307@reclus.nhh.no>

On Thu, 4 Jun 2009, Dylan Beaudette wrote:

> On Monday 01 June 2009, Roger Bivand wrote:
>> On Mon, 1 Jun 2009, Dylan Beaudette wrote:
>>> On Friday 29 May 2009, Torleif Markussen Lunde wrote:
>>>> Hi
>>>>
>>>> First try updating glibc, and install spgrass6 again. If this does not
>>>> work you could try
>>>>
>>>> export MALLOC_CHECK_=0
>>>>
>>>> before you start R. The error might be related to "somewhere something"
>>>> is trying to free memory that has already been unallocated. I don't know
>>>> the details here, but it could be worth a try?
>>>>
>>>> Best wishes
>>>> Torleif
>>>
>>> Hi Torleif, thanks for the tips.
>>>
>>> I just updated my libc, and tried the MALLOC_CHECK trick-- neither fixed
>>> the problem. Still get the same error... Very strange, as I did not
>>> encounter this problem on a very similar machine.
>>>
>>> Could this have anything to do with configure arguments such as -march ?
>>
>> You haven't told us what your underlying system is, or how you installed
>> R. If you built R from source, did you run "make check"? Does the problem
>> arise installing other packages? It most likely is something on your
>> system, otherwise there would be lots of reports of the same.
>>
>> Roger
>
> Right. Should have been a little less hasty about posting to the list. R has
> been built from source, spgrass6 was accessed from CRAN via
> install.packages(). This problems has not occurred at anyother time while
> updating packages that were installed under R 2.7.
>
> 1. make check (R 2.9.0): OK
>
> 2. sessionInfo()
> R version 2.9.0 (2009-04-17)
> i686-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=C;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> Is there any way that I can do a 'make check' type of operation with the
> latest spgrass6 from CRAN?

Yes, do R CMD check spgrass6_0.6-6.tar.gz. When building R, are you 
setting the architecture flags manually? Have you tried letting R sort 
things out for itself? Could you try R CMD check rgdal (from the source 
tarball)? Could you try:

R -d gbd

and then a traceback after install fails? Otherwise we are left with 
non-random cosmic rays as the explanation?

Roger

>
> Note that trying to manually install the package, like this:
> sudo R CMD INSTALL spgrass6_0.6-6.tar.gz
>
> results in:
> * Installing to library '/usr/local/lib/R/library'
> * Installing *source* package 'spgrass6' ...
> ** R
> ** inst
> ** preparing package for lazy loading
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.0dev, released 2008/11/26
> Path to GDAL shared files: /usr/local/share/gdal
> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
> Path to PROJ.4 shared files: (autodetected)
> ** help
> *** installing help indices
> >>> Building/Updating help pages for package 'spgrass6'
>     Formats: text html latex example
>  execGRASS                         text    html    latex   example
>  gmeta6                            text    html    latex   example
>  initGRASS                         text    html    latex   example
>  readRAST6                         text    html    latex   example
>  readVECT6                         text    html    latex   example
>  spgrass6                          text    html    latex   example
> ** building package indices ...
> * DONE (spgrass6)
> *** glibc detected *** /usr/local/lib/R/bin/exec/R: double free or corruption
> (fasttop): 0x0857d880 ***
>
> hope that is enough information.
>
> Cheers,
> Dylan
>
>
>>> Cheers,
>>> Dylan
>>>
>>>> On Friday 29 May 2009 11:26:56 pm Dylan Beaudette wrote:
>>>>> Hi,
>>>>>
>>>>> Just upgraded to R 2.9.0 this morning, and tried to update all of my
>>>>> packages. Everyhing seemed to work, except spgrass6. Manually removing
>>>>> the old packing and installing fresh resulted in:
>>>>>
>>>>> install.packages('spgrass6', dep=TRUE)
>>>>> trying URL
>>>>> 'http://cran.cnr.Berkeley.edu/src/contrib/spgrass6_0.6-6.tar.gz'
>>>>> Content type 'application/x-gzip' length 332298 bytes (324 Kb)
>>>>> opened URL
>>>>> ==================================================
>>>>> downloaded 324 Kb
>>>>>
>>>>> * Installing *source* package 'spgrass6' ...
>>>>> ** R
>>>>> ** inst
>>>>> ** preparing package for lazy loading
>>>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>>>> Loaded GDAL runtime: GDAL 1.7.0dev, released 2008/11/26
>>>>> Path to GDAL shared files: /usr/local/share/gdal
>>>>> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
>>>>> Path to PROJ.4 shared files: (autodetected)
>>>>> ** help
>>>>> *** installing help indices
>>>>>
>>>>>>>> Building/Updating help pages for package 'spgrass6'
>>>>>
>>>>>      Formats: text html latex example
>>>>>   execGRASS                         text    html    latex   example
>>>>>   gmeta6                            text    html    latex   example
>>>>>   initGRASS                         text    html    latex   example
>>>>>   readRAST6                         text    html    latex   example
>>>>>   readVECT6                         text    html    latex   example
>>>>>   spgrass6                          text    html    latex   example
>>>>> ** building package indices ...
>>>>> * DONE (spgrass6)
>>>>> *** glibc detected *** /usr/local/lib/R/bin/exec/R: double free or
>>>>> corruption (fasttop): 0x096ac2b0 ***
>>>>>
>>>>>
>>>>> At this point R stops responding, and I have to issue a `kill -9` to
>>>>> make regain control of the shell.
>>>>>
>>>>> Any ideas?
>>>>>
>>>>> Dylan
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Adrian.Baddeley at csiro.au  Fri Jun  5 12:19:42 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Fri, 5 Jun 2009 18:19:42 +0800
Subject: [R-sig-Geo] Keep dimensions with dilate.owin
Message-ID: <57DC18C299094D4299F837570C5DF1C502A3E5F337@EXWA-MBX01.nexus.csiro.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090605/e0935482/attachment.pl>

From jli at mi.fu-berlin.de  Fri Jun  5 12:26:18 2009
From: jli at mi.fu-berlin.de (Jian Li)
Date: Fri, 5 Jun 2009 12:26:18 +0200
Subject: [R-sig-Geo] How to using polygon from SHP file to cover the whole
 germany in Google map
In-Reply-To: <200906031129.19780.torleif.lunde@cih.uib.no>
References: <BLU123-W60C80E955C29F6167FCB3E94D0@phx.gbl>
	<4A262A29.6070400@geo.uu.nl>
	<200906031129.19780.torleif.lunde@cih.uib.no> 
Message-ID: <BLU123-W1088224B3B38A9F300F652E9480@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090605/5c4bfaf6/attachment.pl>

From j.struve at imperial.ac.uk  Fri Jun  5 12:55:46 2009
From: j.struve at imperial.ac.uk (Struve, Juliane)
Date: Fri, 5 Jun 2009 11:55:46 +0100
Subject: [R-sig-Geo] matching points to a raster
Message-ID: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090605/66881145/attachment.pl>

From vetter at pik-potsdam.de  Fri Jun  5 14:58:54 2009
From: vetter at pik-potsdam.de (Tobias Vetter)
Date: Fri, 05 Jun 2009 14:58:54 +0200
Subject: [R-sig-Geo] matching points to a raster
In-Reply-To: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>
References: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>
Message-ID: <4A29168E.9010408@pik-potsdam.de>

I am not sure if I undersood your problem. Do you like to get 
rastervalues for a point theme? If yes, then
overlay()
might be helpful.
Tobias
> Dear list,
>
> I am trying to incoporate spatial information (for example distance) into a movement model by reading an ascii -b converted raster and matching the raster with points of a movement path (for example fishmove$coord[fishmove$day==1]. Below is a section of my code to explain the problem. This code does not work because the coordinates of the movement path are not the same as those in the raster. Rounding the coordinates does not seem to solve the problem. Maybe the closest point would have to be found, but i am not sure how to approach this.  Is there another perhaps easier way ?
>
> Dist_DF=data.frame(readAsciiGrid("distance.txt"))
> Dist_shoreDF$coord = paste(round(Dist_DF$s1),round(Dist_DF$s2),sep=",")
> names(Dist_DF)[1]="Dist"
> Dist_DF$Dist[Dist_shoreDF$coord==fishmove$coord[fishmove$day==1]]
>
> I would be grateful for any help.
>
> Many thanks,
>
> Juliane
>
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From lchihara at carleton.edu  Fri Jun  5 16:33:39 2009
From: lchihara at carleton.edu (Laura Chihara)
Date: Fri, 05 Jun 2009 09:33:39 -0500
Subject: [R-sig-Geo] geoR: variofit question
Message-ID: <4A292CC3.8040001@carleton.edu>


I'm reading some papers that compare various
theoretical semi-variogram models to data using
weighted least squares. In the papers, the authors
look at the root mean square error. I would like
to try to replicate the results.

Is there a way to extract the RMSE when
using weighted least squares for fitting
(the option="cressie" in variofit)?

Thank you.

-- Laura Chihara

*******************************************
Laura Chihara
Professor of Mathematics   507-222-4065 (office)
Dept of Mathematics        507-222-4312 (fax)
Carleton College
1 North College Street
Northfield MN 55057


From a.ghisla at gmail.com  Fri Jun  5 16:52:10 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 05 Jun 2009 16:52:10 +0200
Subject: [R-sig-Geo] [Report #2] Kriging with GRASS and R: v.autokrige port
 to wxPython and more
Message-ID: <4A29311A.3010801@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello all,

here's second report for my project. See wiki page for more detail [0].

= Done =

- - Ended "An Introduction to Applied Geostatistics", great source of
information of what the module is supposed to do. Now I can be both
developer and user, not discarding any of the hints of other users.
- - Some progress on the interface: I'm getting used of wxWidgets, even if
the lack of a graphical designer slows down my work. wxDesigner seems
good, but I think it is also good for me to learn the meaning of each
line of code. The interface is quite ready for automap and GRASS
integration.

= Planned for next week =

End of interface essential features and integration of automap most
automated functions - ideally, the user will pick up the point layer
containing data and press OK.

= Bottleneck(s) =

The only bottleneck is wxWidgets handling, but not so much as one week ago.

best regards and happy coding to everyone!

Anne

[0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAkopMRoACgkQzZ3g4YwFFgYiHgCfTqHHTSGM6UUI3C1oh8NNIRaJ
Dx4An1IRzzNHwhLJlcBUTqjB9nVZR4Vf
=Sy9X
-----END PGP SIGNATURE-----


From dylan.beaudette at gmail.com  Fri Jun  5 17:08:12 2009
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Fri, 5 Jun 2009 08:08:12 -0700
Subject: [R-sig-Geo] spgrass6 and R 2.9
In-Reply-To: <alpine.LRH.2.00.0906051051340.10307@reclus.nhh.no>
References: <200905291426.56291.dylan.beaudette@gmail.com>
	<200906011114.05035.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.0906012345540.31055@reclus.nhh.no>
	<200906041727.41457.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.0906051051340.10307@reclus.nhh.no>
Message-ID: <3c5546140906050808l15290a86ja487c4428af196b8@mail.gmail.com>

On Fri, Jun 5, 2009 at 1:55 AM, Roger Bivand<Roger.Bivand at nhh.no> wrote:
> On Thu, 4 Jun 2009, Dylan Beaudette wrote:
>
>> On Monday 01 June 2009, Roger Bivand wrote:
>>>
>>> On Mon, 1 Jun 2009, Dylan Beaudette wrote:
>>>>
>>>> On Friday 29 May 2009, Torleif Markussen Lunde wrote:
>>>>>
>>>>> Hi
>>>>>
>>>>> First try updating glibc, and install spgrass6 again. If this does not
>>>>> work you could try
>>>>>
>>>>> export MALLOC_CHECK_=0
>>>>>
>>>>> before you start R. The error might be related to "somewhere something"
>>>>> is trying to free memory that has already been unallocated. I don't
>>>>> know
>>>>> the details here, but it could be worth a try?
>>>>>
>>>>> Best wishes
>>>>> Torleif
>>>>
>>>> Hi Torleif, thanks for the tips.
>>>>
>>>> I just updated my libc, and tried the MALLOC_CHECK trick-- neither fixed
>>>> the problem. Still get the same error... Very strange, as I did not
>>>> encounter this problem on a very similar machine.
>>>>
>>>> Could this have anything to do with configure arguments such as -march ?
>>>
>>> You haven't told us what your underlying system is, or how you installed
>>> R. If you built R from source, did you run "make check"? Does the problem
>>> arise installing other packages? It most likely is something on your
>>> system, otherwise there would be lots of reports of the same.
>>>
>>> Roger
>>
>> Right. Should have been a little less hasty about posting to the list. R
>> has
>> been built from source, spgrass6 was accessed from CRAN via
>> install.packages(). This problems has not occurred at anyother time while
>> updating packages that were installed under R 2.7.
>>
>> 1. make check (R 2.9.0): OK
>>
>> 2. sessionInfo()
>> R version 2.9.0 (2009-04-17)
>> i686-pc-linux-gnu
>>
>> locale:
>>
>> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=C;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> Is there any way that I can do a 'make check' type of operation with the
>> latest spgrass6 from CRAN?
>
> Yes, do R CMD check spgrass6_0.6-6.tar.gz. When building R, are you setting
> the architecture flags manually? Have you tried letting R sort things out
> for itself? Could you try R CMD check rgdal (from the source tarball)? Could
> you try:
>
> R -d gbd
>
> and then a traceback after install fails? Otherwise we are left with
> non-random cosmic rays as the explanation?
>
> Roger
>

Thanks Roger.

I usually set the march flag to -march=opteron ... and seem to recall
setting that as as system wide configure option, but cannot recall
what file that is in... I'll check. How exactly does the R -d gdb
approach work?

Thanks!
Dylan



Here is the check on spgrass6:

---------------------------------------------------------------------------------------------------------------------
R CMD check spgrass6_0.6-6.tar.gz
* checking for working pdflatex ... OK
* using log directory '/home/dylan/src/spgrass6.Rcheck'
* using R version 2.9.0 (2009-04-17)
* using session charset: ISO8859-1
* checking for file 'spgrass6/DESCRIPTION' ... OK
* this is package 'spgrass6' version '0.6-6'
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking for .dll and .exe files ... OK
* checking whether package 'spgrass6' can be installed ...*** glibc
detected *** /usr/local/lib/R/bin/exec/R: double free or corruption
(fasttop): 0x09568348 ***
---------------------------------------------------------------------------------------------------------------------

Now rgdal:
---------------------------------------------------------------------------------------------------------------------
R CMD check rgdal_0.6-8.tar.gz
* checking for working pdflatex ... OK
* using log directory '/home/dylan/src/rgdal.Rcheck'
* using R version 2.9.0 (2009-04-17)
* using session charset: ISO8859-1
* checking for file 'rgdal/DESCRIPTION' ... OK
* this is package 'rgdal' version '0.6-8'
* checking package name space information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking for .dll and .exe files ... OK
* checking whether package 'rgdal' can be installed ...*** glibc
detected *** ./proj_conf_test: double free or corruption (fasttop):
0x08c5bec0 ***
======= Backtrace: =========
/lib/i686/cmov/libc.so.6[0xb75a31d4]
/lib/i686/cmov/libc.so.6(cfree+0x96)[0xb75a5186]
/usr/lib/libstdc++.so.6(_ZdlPv+0x21)[0xb6db3101]
/usr/lib/libstdc++.so.6(_ZNSs4_Rep10_M_destroyERKSaIcE+0x1d)[0xb6d907fd]
/usr/lib/libstdc++.so.6(_ZNSsD1Ev+0x4c)[0xb6d9221c]
/lib/i686/cmov/libc.so.6(__cxa_finalize+0xc1)[0xb7564c21]
/usr/local/lib/libgeos-3.1.0.so[0xb6b61734]
/usr/local/lib/libgeos-3.1.0.so[0xb6c5a200]
/lib/ld-linux.so.2[0xb7fbaa23]
/lib/i686/cmov/libc.so.6(exit+0x89)[0xb7564889]
./proj_conf_test[0x8048565]
/lib/i686/cmov/libc.so.6(__libc_start_main+0xe5)[0xb754a775]
./proj_conf_test[0x8048481]
======= Memory map: ========
08048000-08049000 r-xp 00000000 08:11 26624192
/home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
08049000-0804a000 rw-p 00000000 08:11 26624192
/home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
08c5b000-08c7c000 rw-p 08c5b000 00:00 0          [heap]
b5900000-b5921000 rw-p b5900000 00:00 0
b5921000-b5a00000 ---p b5921000 00:00 0
b5a3f000-b5a41000 rw-p b5a3f000 00:00 0
b5a41000-b6786000 r--p 00000000 08:11 3146351    /usr/lib/libicudata.so.40.1
b6786000-b6787000 rw-p 00d44000 08:11 3146351    /usr/lib/libicudata.so.40.1
b6787000-b6788000 rw-p b6787000 00:00 0
b6788000-b68ad000 r-xp 00000000 08:11 3151434    /usr/lib/libicuuc.so.40.1
b68ad000-b68b6000 rw-p 00124000 08:11 3151434    /usr/lib/libicuuc.so.40.1
b68b6000-b68b8000 rw-p b68b6000 00:00 0
b68b8000-b6a3c000 r-xp 00000000 08:11 3146355    /usr/lib/libicui18n.so.40.1
b6a3c000-b6a43000 rw-p 00184000 08:11 3146355    /usr/lib/libicui18n.so.40.1
b6a43000-b6c9e000 r-xp 00000000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
b6c9e000-b6ca9000 rw-p 0025b000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
b6ca9000-b6cd4000 r-xp 00000000 08:11 8437815    /lib/libgcc_s.so.1
b6cd4000-b6cd5000 rw-p 0002a000 08:11 8437815    /lib/libgcc_s.so.1
b6cd5000-b6cd6000 rw-p b6cd5000 00:00 0
b6cd6000-b6cfa000 r-xp 00000000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
b6cfa000-b6cfb000 r--p 00023000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
b6cfb000-b6cfc000 rw-p 00024000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
b6cfc000-b6de1000 r-xp 00000000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
b6de1000-b6de5000 r--p 000e4000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
b6de5000-b6de6000 rw-p 000e8000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
b6de6000-b6ded000 rw-p b6de6000 00:00 0
b6ded000-b6e01000 r-xp 00000000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
b6e01000-b6e02000 rw-p 00013000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
b6e02000-b6e17000 r-xp 00000000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
b6e17000-b6e18000 r--p 00014000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
b6e18000-b6e19000 rw-p 00015000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
b6e19000-b6e1b000 rw-p b6e19000 00:00 0
b6e1b000-b6e24000 r-xp 00000000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
b6e24000-b6e25000 r--p 00008000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
b6e25000-b6e26000 rw-p 00009000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
b6e26000-b6e4d000 rw-p b6e26000 00:00 0
b6e4d000-b6e62000 r-xp 00000000 08:11 8437975
/lib/i686/cmov/libpthread-2.9.so
b6e62000-b6e63000 r--p 00014000 08:11 8437975
/lib/i686/cmov/libpthread-2.9.so
b6e63000-b6e64000 rw-p 00015000 08:11 8437975
/lib/i686/cmov/libpthread-2.9.so
b6e64000-b6e67000 rw-p b6e64000 00:00 0
b6e67000-b700b000 r-xp 00000000 08:11 3154222
/usr/lib/libmysqlclient.so.15.0.0
b700b000-b704f000 rw-p 001a3000 08:11 3154222
/usr/lib/libmysqlclient.so.15.0.0
b704f000-b7050000 rw-p b704f000 00:00 0
b7050000-b7052000 r-xp 00000000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
b7052000-b7053000 r--p 00001000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
b7053000-b7054000 rw-p 00002000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
b7054000-b705b000 r-xp 00000000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
b705b000-b705c000 r--p 00006000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
b705c000-b705d000 rw-p 00007000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
b705d000-b7079000 r-xp 00000000 08:11 3541773
/usr/local/pgsql/lib/libpq.so.5.1
b7079000-b707a000 rw-p 0001c000 08:11 3541773
/usr/local/pgsql/lib/libpq.so.5.1
b707a000-b7177000 r-xp 00000000 08:11 3151596    /usr/lib/libcfitsio.so.2.510
b7177000-b7179000 rw-p 000fc000 08:11 3151596    /usr/lib/libcfitsio.so.2.510
b7179000-b71ed000 rw-p b7179000 00:00 0
b71ed000-b721c000 r-xp 00000000 08:11 8274101    /usr/lib/libnetcdf.so.4.0.0
b721c000-b721d000 rw-p 0002f000 08:11 8274101    /usr/lib/libnetcdf.so.4.0.0
b721d000-b721f000 rw-p b721d000 00:00 0
b721f000-b7243000 r-xp 00000000 08:11 3146201    /usr/lib/libexpat.so.1.5.2
b7243000-b7245000 rw-p 00023000 08:11 3146201    /usr/lib/libexpat.so.1.5.2
b7245000-b72c6000 r-xp 00000000 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6
b72c6000-b72c8000 rw-p 00081000 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6
b72c8000-b750c000 r-xp 00000000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
b750c000-b7516000 rw-p 00244000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
b7516000-b7533000 r-xp 00000000 08:11 3163292
/usr/local/lib/libgeos_c.so.1.5.0
b7533000-b7534000 rw-p 0001c000 08:11 3163292
/usr/local/lib/libgeos_c.so.1.5.0
b7534000-b768e000 r-xp 00000000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
b768e000-b7690000 r--p 0015a000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
b7690000-b7691000 rw-p 0015c000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
b7691000-b7695000 rw-p b7691000 00:00 0
b76b1000-b76ec000 r-xp 00000000 08:11 3162172    /usr/local/lib/libproj.so.0.5.4
b76ec000-b76ee000 rw-p 0003b000 08:11 3162172    /usr/local/lib/libproj.so.0.5.4
b76ee000-b7f0a000 r-xp 00000000 08:11 3162145
/usr/local/lib/libgdal.so.1.13.0
b7f0a000-b7fa4000 rw-p 0081c000 08:11 3162145
/usr/local/lib/libgdal.so.1.13.0
b7fa4000-b7fab000 rw-p b7fa4000 00:00 0
b7fab000-b7fac000 r-xp b7fab000 00:00 0          [vdso]
b7fac000-b7fc8000 r-xp 00000000 08:11 8437905    /lib/ld-2.9.so
b7fc8000-b7fc9000 r--p 0001b000 08:11 8437905    /lib/ld-2.9.so
b7fc9000-b7fca000 rw-p 0001c000 08:11 8437905    /lib/ld-2.9.so
bfbb5000-bfbca000 rw-p bffeb000 00:00 0          [stack]
*** glibc detected *** ./proj_conf_test: double free or corruption
(fasttop): 0x09e6aec0 ***
======= Backtrace: =========
/lib/i686/cmov/libc.so.6[0xb75641d4]
/lib/i686/cmov/libc.so.6(cfree+0x96)[0xb7566186]
/usr/lib/libstdc++.so.6(_ZdlPv+0x21)[0xb6d74101]
/usr/lib/libstdc++.so.6(_ZNSs4_Rep10_M_destroyERKSaIcE+0x1d)[0xb6d517fd]
/usr/lib/libstdc++.so.6(_ZNSsD1Ev+0x4c)[0xb6d5321c]
/lib/i686/cmov/libc.so.6(__cxa_finalize+0xc1)[0xb7525c21]
/usr/local/lib/libgeos-3.1.0.so[0xb6b22734]
/usr/local/lib/libgeos-3.1.0.so[0xb6c1b200]
/lib/ld-linux.so.2[0xb7f7ba23]
/lib/i686/cmov/libc.so.6(exit+0x89)[0xb7525889]
./proj_conf_test[0x8048565]
/lib/i686/cmov/libc.so.6(__libc_start_main+0xe5)[0xb750b775]
./proj_conf_test[0x8048481]
======= Memory map: ========
08048000-08049000 r-xp 00000000 08:11 26624192
/home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
08049000-0804a000 rw-p 00000000 08:11 26624192
/home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
09e6a000-09e8b000 rw-p 09e6a000 00:00 0          [heap]
b5800000-b5821000 rw-p b5800000 00:00 0
b5821000-b5900000 ---p b5821000 00:00 0
b5a00000-b5a02000 rw-p b5a00000 00:00 0
b5a02000-b6747000 r--p 00000000 08:11 3146351    /usr/lib/libicudata.so.40.1
b6747000-b6748000 rw-p 00d44000 08:11 3146351    /usr/lib/libicudata.so.40.1
b6748000-b6749000 rw-p b6748000 00:00 0
b6749000-b686e000 r-xp 00000000 08:11 3151434    /usr/lib/libicuuc.so.40.1
b686e000-b6877000 rw-p 00124000 08:11 3151434    /usr/lib/libicuuc.so.40.1
b6877000-b6879000 rw-p b6877000 00:00 0
b6879000-b69fd000 r-xp 00000000 08:11 3146355    /usr/lib/libicui18n.so.40.1
b69fd000-b6a04000 rw-p 00184000 08:11 3146355    /usr/lib/libicui18n.so.40.1
b6a04000-b6c5f000 r-xp 00000000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
b6c5f000-b6c6a000 rw-p 0025b000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
b6c6a000-b6c95000 r-xp 00000000 08:11 8437815    /lib/libgcc_s.so.1
b6c95000-b6c96000 rw-p 0002a000 08:11 8437815    /lib/libgcc_s.so.1
b6c96000-b6c97000 rw-p b6c96000 00:00 0
b6c97000-b6cbb000 r-xp 00000000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
b6cbb000-b6cbc000 r--p 00023000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
b6cbc000-b6cbd000 rw-p 00024000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
b6cbd000-b6da2000 r-xp 00000000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
b6da2000-b6da6000 r--p 000e4000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
b6da6000-b6da7000 rw-p 000e8000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
b6da7000-b6dae000 rw-p b6da7000 00:00 0
b6dae000-b6dc2000 r-xp 00000000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
b6dc2000-b6dc3000 rw-p 00013000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
b6dc3000-b6dd8000 r-xp 00000000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
b6dd8000-b6dd9000 r--p 00014000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
b6dd9000-b6dda000 rw-p 00015000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
b6dda000-b6ddc000 rw-p b6dda000 00:00 0
b6ddc000-b6de5000 r-xp 00000000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
b6de5000-b6de6000 r--p 00008000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
b6de6000-b6de7000 rw-p 00009000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
b6de7000-b6e0e000 rw-p b6de7000 00:00 0
b6e0e000-b6e23000 r-xp 00000000 08:11 8437975
/lib/i686/cmov/libpthread-2.9.so
b6e23000-b6e24000 r--p 00014000 08:11 8437975
/lib/i686/cmov/libpthread-2.9.so
b6e24000-b6e25000 rw-p 00015000 08:11 8437975
/lib/i686/cmov/libpthread-2.9.so
b6e25000-b6e28000 rw-p b6e25000 00:00 0
b6e28000-b6fcc000 r-xp 00000000 08:11 3154222
/usr/lib/libmysqlclient.so.15.0.0
b6fcc000-b7010000 rw-p 001a3000 08:11 3154222
/usr/lib/libmysqlclient.so.15.0.0
b7010000-b7011000 rw-p b7010000 00:00 0
b7011000-b7013000 r-xp 00000000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
b7013000-b7014000 r--p 00001000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
b7014000-b7015000 rw-p 00002000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
b7015000-b701c000 r-xp 00000000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
b701c000-b701d000 r--p 00006000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
b701d000-b701e000 rw-p 00007000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
b701e000-b703a000 r-xp 00000000 08:11 3541773
/usr/local/pgsql/lib/libpq.so.5.1
b703a000-b703b000 rw-p 0001c000 08:11 3541773
/usr/local/pgsql/lib/libpq.so.5.1
b703b000-b7138000 r-xp 00000000 08:11 3151596    /usr/lib/libcfitsio.so.2.510
b7138000-b713a000 rw-p 000fc000 08:11 3151596    /usr/lib/libcfitsio.so.2.510
b713a000-b71ae000 rw-p b713a000 00:00 0
b71ae000-b71dd000 r-xp 00000000 08:11 8274101    /usr/lib/libnetcdf.so.4.0.0
b71dd000-b71de000 rw-p 0002f000 08:11 8274101    /usr/lib/libnetcdf.so.4.0.0
b71de000-b71e0000 rw-p b71de000 00:00 0
b71e0000-b7204000 r-xp 00000000 08:11 3146201    /usr/lib/libexpat.so.1.5.2
b7204000-b7206000 rw-p 00023000 08:11 3146201    /usr/lib/libexpat.so.1.5.2
b7206000-b7287000 r-xp 00000000 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6
b7287000-b7289000 rw-p 00081000 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6
b7289000-b74cd000 r-xp 00000000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
b74cd000-b74d7000 rw-p 00244000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
b74d7000-b74f4000 r-xp 00000000 08:11 3163292
/usr/local/lib/libgeos_c.so.1.5.0
b74f4000-b74f5000 rw-p 0001c000 08:11 3163292
/usr/local/lib/libgeos_c.so.1.5.0
b74f5000-b764f000 r-xp 00000000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
b764f000-b7651000 r--p 0015a000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
b7651000-b7652000 rw-p 0015c000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
b7652000-b7656000 rw-p b7652000 00:00 0
b7672000-b76ad000 r-xp 00000000 08:11 3162172    /usr/local/lib/libproj.so.0.5.4
b76ad000-b76af000 rw-p 0003b000 08:11 3162172    /usr/local/lib/libproj.so.0.5.4
b76af000-b7ecb000 r-xp 00000000 08:11 3162145
/usr/local/lib/libgdal.so.1.13.0
b7ecb000-b7f65000 rw-p 0081c000 08:11 3162145
/usr/local/lib/libgdal.so.1.13.0
b7f65000-b7f6c000 rw-p b7f65000 00:00 0
b7f6c000-b7f6d000 r-xp b7f6c000 00:00 0          [vdso]
b7f6d000-b7f89000 r-xp 00000000 08:11 8437905    /lib/ld-2.9.so
b7f89000-b7f8a000 r--p 0001b000 08:11 8437905    /lib/ld-2.9.so
b7f8a000-b7f8b000 rw-p 0001c000 08:11 8437905    /lib/ld-2.9.so
bfa75000-bfa8a000 rw-p bffeb000 00:00 0          [stack]
 OK
* checking package directory ... OK
* checking for portable file names ... OK
* checking for sufficient/correct file permissions ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* checking whether the package can be loaded ...*** glibc detected ***
/usr/local/lib/R/bin/exec/R: double free or corruption (fasttop):
0x08dff5c0 ***


From T.Hengl at uva.nl  Fri Jun  5 17:53:41 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Fri, 5 Jun 2009 17:53:41 +0200
Subject: [R-sig-Geo] From the GEOSTAT 2009 Summer School for PhD students
	(report)
Message-ID: <00C40F0701B04606845E1C75262495C2@pcibed193>


FYI: The official report from the GEOSTAT 2009 Summer School for PhD students:

http://spatial-accuracy.org/FromGEOSTAT2009 

TITLE: "Spatio-temporal data analysis with R+SAGA+Google Earth"
LOCATION: Mediterranean Institute for Life Sciences, Split, Croatia
PERIOD: 3-10 May 2009
LECTURERS: R. Bivand, T. Hengl and O. Conrad

I have also started maintaining a small list of the upcoming training courses (R and spatial data
analysis) and people involved:

http://spatial-analyst.net/wiki/index.php?title=Training_in_R 

Let me know if you think that I have missed some important event/institution/person.


Tom Hengl
http://spatial-analyst.net 

(Maybe R-sig-geo should consider starting a newsletter?)


From reeves at nceas.ucsb.edu  Fri Jun  5 19:15:17 2009
From: reeves at nceas.ucsb.edu (rick reeves)
Date: Fri, 05 Jun 2009 10:15:17 -0700
Subject: [R-sig-Geo] matching points to a raster
In-Reply-To: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>
References: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>
Message-ID: <4A2952A5.5040909@nceas.ucsb.edu>

Hi Juliane:

I see that you are STILL pushing the outer limits of R - :}

I have been working a lot with combining point/vector and raster files 
using the overlay() method in the sp package.
I suspect that if you want to have two spatially registered layers 
(raster and point vector) and want to get the raster cell
underlying a spatially corresponding point, then overlay might be of use.

If you can more precisely specify your task (with an example), and 
possibly send a sample data set, I could give
a more specific answer...Meanwhile, as a starting point, here is an 
example of extracting values from a raster grid.
This might be a partial solution to your question -
#
# read vector point and raster files, both in unprojected geographic  
coordinates,
# covering the same area
#
  WaterSourcePoints <- 
readOGR("WaterSourcePointsLatLong.shp","WaterSourcePointsLatLong") # 
point shape file
  DEMImg     <- readGDAL("NevadaSiteDEMSub.tif")  # raster elevation map
#
# Extract from raster file the elevations 'underneath' each point in the 
file
#
  PointElevations = overlay(DEMImg,as(WaterSourcePoints,"SpatialPoints"))
#
# append the point file attributes with the elevation value vector
#
  StationsWithElev = cbind(WaterSourcePoints at data,PointElevations at data[,1])
#
# update the column names in the point shape file
#
  nc = ncol(StationsWithElev) 
  colnames(StationsWithElev) = 
c(colnames(StationsWithElev[1:nc-1]),"Elevation")    

Hope this helps, pls feel free to send more information!
Rick Reeves

Struve, Juliane wrote:
> Dear list,
>
> I am trying to incoporate spatial information (for example distance) into a movement model by reading an ascii -b converted raster and matching the raster with points of a movement path (for example fishmove$coord[fishmove$day==1]. Below is a section of my code to explain the problem. This code does not work because the coordinates of the movement path are not the same as those in the raster. Rounding the coordinates does not seem to solve the problem. Maybe the closest point would have to be found, but i am not sure how to approach this.  Is there another perhaps easier way ?
>
> Dist_DF=data.frame(readAsciiGrid("distance.txt"))
> Dist_shoreDF$coord = paste(round(Dist_DF$s1),round(Dist_DF$s2),sep=",")
> names(Dist_DF)[1]="Dist"
> Dist_DF$Dist[Dist_shoreDF$coord==fishmove$coord[fishmove$day==1]]
>
> I would be grateful for any help.
>
> Many thanks,
>
> Juliane
>
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>   


-- 
Rick Reeves
Scientific Programmer/Analyst and Data Manager
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
www.nceas.ucsb.edu
805 892 2533


From ksafi at orn.mpg.de  Fri Jun  5 20:49:55 2009
From: ksafi at orn.mpg.de (Kamran Safi)
Date: Fri, 05 Jun 2009 20:49:55 +0200
Subject: [R-sig-Geo] matching points to a raster
In-Reply-To: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>
References: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>
Message-ID: <4A2968D3.8050808@orn.mpg.de>

Hi,

I am not sure this is trivial. I think the simplest solution would be to 
find the closest grid cell centre (maybe using spDistN1 or simple vector 
length) and get the closest grid cell with environmental data and assign 
it to your animals' position. You can further complicate things by not 
taking simply the next closest point, but calculate the weighted mean 
(using the inverse of distance of the cell centres to the animals' 
location as weighing variable) or maybe most elegantly use kriging (or 
linear models), and extrapolate the value for the location. This is a 
classical geographers' problem of interpolation and not simply done by 
overlay(), which probably mimics the first solution of getting the next 
best grid cell (I am also not entirely sure whether overlay works with 
spatialPoints and spatialPixels).
Weighted mean maybe a straightforward solution.

Hope this helps,

Kami

Struve, Juliane wrote:
> Dear list,
>
> I am trying to incoporate spatial information (for example distance) into a movement model by reading an ascii -b converted raster and matching the raster with points of a movement path (for example fishmove$coord[fishmove$day==1]. Below is a section of my code to explain the problem. This code does not work because the coordinates of the movement path are not the same as those in the raster. Rounding the coordinates does not seem to solve the problem. Maybe the closest point would have to be found, but i am not sure how to approach this.  Is there another perhaps easier way ?
>
> Dist_DF=data.frame(readAsciiGrid("distance.txt"))
> Dist_shoreDF$coord = paste(round(Dist_DF$s1),round(Dist_DF$s2),sep=",")
> names(Dist_DF)[1]="Dist"
> Dist_DF$Dist[Dist_shoreDF$coord==fishmove$coord[fishmove$day==1]]
>
> I would be grateful for any help.
>
> Many thanks,
>
> Juliane
>
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3275 bytes
Desc: S/MIME Cryptographic Signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090605/3c46d7c3/attachment.bin>

From Roger.Bivand at nhh.no  Fri Jun  5 20:59:31 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Jun 2009 20:59:31 +0200 (CEST)
Subject: [R-sig-Geo] spgrass6 and R 2.9
In-Reply-To: <3c5546140906050808l15290a86ja487c4428af196b8@mail.gmail.com>
References: <200905291426.56291.dylan.beaudette@gmail.com>
	<200906011114.05035.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.0906012345540.31055@reclus.nhh.no>
	<200906041727.41457.dylan.beaudette@gmail.com>
	<alpine.LRH.2.00.0906051051340.10307@reclus.nhh.no>
	<3c5546140906050808l15290a86ja487c4428af196b8@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0906052050480.3166@reclus.nhh.no>

On Fri, 5 Jun 2009, Dylan Beaudette wrote:

> On Fri, Jun 5, 2009 at 1:55 AM, Roger Bivand<Roger.Bivand at nhh.no> wrote:
>> On Thu, 4 Jun 2009, Dylan Beaudette wrote:
>>
>>> On Monday 01 June 2009, Roger Bivand wrote:
>>>>
>>>> On Mon, 1 Jun 2009, Dylan Beaudette wrote:
>>>>>
>>>>> On Friday 29 May 2009, Torleif Markussen Lunde wrote:
>>>>>>
>>>>>> Hi
>>>>>>
>>>>>> First try updating glibc, and install spgrass6 again. If this does not
>>>>>> work you could try
>>>>>>
>>>>>> export MALLOC_CHECK_=0
>>>>>>
>>>>>> before you start R. The error might be related to "somewhere something"
>>>>>> is trying to free memory that has already been unallocated. I don't
>>>>>> know
>>>>>> the details here, but it could be worth a try?
>>>>>>
>>>>>> Best wishes
>>>>>> Torleif
>>>>>
>>>>> Hi Torleif, thanks for the tips.
>>>>>
>>>>> I just updated my libc, and tried the MALLOC_CHECK trick-- neither fixed
>>>>> the problem. Still get the same error... Very strange, as I did not
>>>>> encounter this problem on a very similar machine.
>>>>>
>>>>> Could this have anything to do with configure arguments such as -march ?
>>>>
>>>> You haven't told us what your underlying system is, or how you installed
>>>> R. If you built R from source, did you run "make check"? Does the problem
>>>> arise installing other packages? It most likely is something on your
>>>> system, otherwise there would be lots of reports of the same.
>>>>
>>>> Roger
>>>
>>> Right. Should have been a little less hasty about posting to the list. R
>>> has
>>> been built from source, spgrass6 was accessed from CRAN via
>>> install.packages(). This problems has not occurred at anyother time while
>>> updating packages that were installed under R 2.7.
>>>
>>> 1. make check (R 2.9.0): OK
>>>
>>> 2. sessionInfo()
>>> R version 2.9.0 (2009-04-17)
>>> i686-pc-linux-gnu
>>>
>>> locale:
>>>
>>> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=C;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> Is there any way that I can do a 'make check' type of operation with the
>>> latest spgrass6 from CRAN?
>>
>> Yes, do R CMD check spgrass6_0.6-6.tar.gz. When building R, are you setting
>> the architecture flags manually? Have you tried letting R sort things out
>> for itself? Could you try R CMD check rgdal (from the source tarball)? Could
>> you try:
>>
>> R -d gbd
>>
>> and then a traceback after install fails? Otherwise we are left with
>> non-random cosmic rays as the explanation?
>>
>> Roger
>>
>
> Thanks Roger.
>
> I usually set the march flag to -march=opteron ... and seem to recall
> setting that as as system wide configure option, but cannot recall
> what file that is in... I'll check.

Dylan,

Your post on R-help about problems with R and PostgreSQL may suggest a 
systemic problem, unless you are sure that your alias fix there is not 
system specific (try on another machine). Architectures ought to be found 
automatically.

> How exactly does the R -d gdb approach work?

Well, when you run it, you get the GDB interface, and type run to run R. 
Then do install.packages(), possibly from a local tarball, and use GDB 
commands to interrogate the crash.

I find it very hard to credit that this is not specific to your machine. 
Do you have an equivalent AMD (or Intel) x86 box you can try this on? It 
is very hard to help if nobody else can reproduce it (I run 2 x86 Intel 
Linux, 1 64-bit Intel Linux, with R built from source, and see nothing 
untoward in installing spgrass6. Did you try to run R CMD check on other 
packages?

Roger

>
> Thanks!
> Dylan
>
>
>
> Here is the check on spgrass6:
>
> ---------------------------------------------------------------------------------------------------------------------
> R CMD check spgrass6_0.6-6.tar.gz
> * checking for working pdflatex ... OK
> * using log directory '/home/dylan/src/spgrass6.Rcheck'
> * using R version 2.9.0 (2009-04-17)
> * using session charset: ISO8859-1
> * checking for file 'spgrass6/DESCRIPTION' ... OK
> * this is package 'spgrass6' version '0.6-6'
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking for .dll and .exe files ... OK
> * checking whether package 'spgrass6' can be installed ...*** glibc
> detected *** /usr/local/lib/R/bin/exec/R: double free or corruption
> (fasttop): 0x09568348 ***
> ---------------------------------------------------------------------------------------------------------------------
>
> Now rgdal:
> ---------------------------------------------------------------------------------------------------------------------
> R CMD check rgdal_0.6-8.tar.gz
> * checking for working pdflatex ... OK
> * using log directory '/home/dylan/src/rgdal.Rcheck'
> * using R version 2.9.0 (2009-04-17)
> * using session charset: ISO8859-1
> * checking for file 'rgdal/DESCRIPTION' ... OK
> * this is package 'rgdal' version '0.6-8'
> * checking package name space information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking for .dll and .exe files ... OK
> * checking whether package 'rgdal' can be installed ...*** glibc
> detected *** ./proj_conf_test: double free or corruption (fasttop):
> 0x08c5bec0 ***
> ======= Backtrace: =========
> /lib/i686/cmov/libc.so.6[0xb75a31d4]
> /lib/i686/cmov/libc.so.6(cfree+0x96)[0xb75a5186]
> /usr/lib/libstdc++.so.6(_ZdlPv+0x21)[0xb6db3101]
> /usr/lib/libstdc++.so.6(_ZNSs4_Rep10_M_destroyERKSaIcE+0x1d)[0xb6d907fd]
> /usr/lib/libstdc++.so.6(_ZNSsD1Ev+0x4c)[0xb6d9221c]
> /lib/i686/cmov/libc.so.6(__cxa_finalize+0xc1)[0xb7564c21]
> /usr/local/lib/libgeos-3.1.0.so[0xb6b61734]
> /usr/local/lib/libgeos-3.1.0.so[0xb6c5a200]
> /lib/ld-linux.so.2[0xb7fbaa23]
> /lib/i686/cmov/libc.so.6(exit+0x89)[0xb7564889]
> ./proj_conf_test[0x8048565]
> /lib/i686/cmov/libc.so.6(__libc_start_main+0xe5)[0xb754a775]
> ./proj_conf_test[0x8048481]
> ======= Memory map: ========
> 08048000-08049000 r-xp 00000000 08:11 26624192
> /home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
> 08049000-0804a000 rw-p 00000000 08:11 26624192
> /home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
> 08c5b000-08c7c000 rw-p 08c5b000 00:00 0          [heap]
> b5900000-b5921000 rw-p b5900000 00:00 0
> b5921000-b5a00000 ---p b5921000 00:00 0
> b5a3f000-b5a41000 rw-p b5a3f000 00:00 0
> b5a41000-b6786000 r--p 00000000 08:11 3146351    /usr/lib/libicudata.so.40.1
> b6786000-b6787000 rw-p 00d44000 08:11 3146351    /usr/lib/libicudata.so.40.1
> b6787000-b6788000 rw-p b6787000 00:00 0
> b6788000-b68ad000 r-xp 00000000 08:11 3151434    /usr/lib/libicuuc.so.40.1
> b68ad000-b68b6000 rw-p 00124000 08:11 3151434    /usr/lib/libicuuc.so.40.1
> b68b6000-b68b8000 rw-p b68b6000 00:00 0
> b68b8000-b6a3c000 r-xp 00000000 08:11 3146355    /usr/lib/libicui18n.so.40.1
> b6a3c000-b6a43000 rw-p 00184000 08:11 3146355    /usr/lib/libicui18n.so.40.1
> b6a43000-b6c9e000 r-xp 00000000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
> b6c9e000-b6ca9000 rw-p 0025b000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
> b6ca9000-b6cd4000 r-xp 00000000 08:11 8437815    /lib/libgcc_s.so.1
> b6cd4000-b6cd5000 rw-p 0002a000 08:11 8437815    /lib/libgcc_s.so.1
> b6cd5000-b6cd6000 rw-p b6cd5000 00:00 0
> b6cd6000-b6cfa000 r-xp 00000000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
> b6cfa000-b6cfb000 r--p 00023000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
> b6cfb000-b6cfc000 rw-p 00024000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
> b6cfc000-b6de1000 r-xp 00000000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
> b6de1000-b6de5000 r--p 000e4000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
> b6de5000-b6de6000 rw-p 000e8000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
> b6de6000-b6ded000 rw-p b6de6000 00:00 0
> b6ded000-b6e01000 r-xp 00000000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
> b6e01000-b6e02000 rw-p 00013000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
> b6e02000-b6e17000 r-xp 00000000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
> b6e17000-b6e18000 r--p 00014000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
> b6e18000-b6e19000 rw-p 00015000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
> b6e19000-b6e1b000 rw-p b6e19000 00:00 0
> b6e1b000-b6e24000 r-xp 00000000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
> b6e24000-b6e25000 r--p 00008000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
> b6e25000-b6e26000 rw-p 00009000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
> b6e26000-b6e4d000 rw-p b6e26000 00:00 0
> b6e4d000-b6e62000 r-xp 00000000 08:11 8437975
> /lib/i686/cmov/libpthread-2.9.so
> b6e62000-b6e63000 r--p 00014000 08:11 8437975
> /lib/i686/cmov/libpthread-2.9.so
> b6e63000-b6e64000 rw-p 00015000 08:11 8437975
> /lib/i686/cmov/libpthread-2.9.so
> b6e64000-b6e67000 rw-p b6e64000 00:00 0
> b6e67000-b700b000 r-xp 00000000 08:11 3154222
> /usr/lib/libmysqlclient.so.15.0.0
> b700b000-b704f000 rw-p 001a3000 08:11 3154222
> /usr/lib/libmysqlclient.so.15.0.0
> b704f000-b7050000 rw-p b704f000 00:00 0
> b7050000-b7052000 r-xp 00000000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
> b7052000-b7053000 r--p 00001000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
> b7053000-b7054000 rw-p 00002000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
> b7054000-b705b000 r-xp 00000000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
> b705b000-b705c000 r--p 00006000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
> b705c000-b705d000 rw-p 00007000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
> b705d000-b7079000 r-xp 00000000 08:11 3541773
> /usr/local/pgsql/lib/libpq.so.5.1
> b7079000-b707a000 rw-p 0001c000 08:11 3541773
> /usr/local/pgsql/lib/libpq.so.5.1
> b707a000-b7177000 r-xp 00000000 08:11 3151596    /usr/lib/libcfitsio.so.2.510
> b7177000-b7179000 rw-p 000fc000 08:11 3151596    /usr/lib/libcfitsio.so.2.510
> b7179000-b71ed000 rw-p b7179000 00:00 0
> b71ed000-b721c000 r-xp 00000000 08:11 8274101    /usr/lib/libnetcdf.so.4.0.0
> b721c000-b721d000 rw-p 0002f000 08:11 8274101    /usr/lib/libnetcdf.so.4.0.0
> b721d000-b721f000 rw-p b721d000 00:00 0
> b721f000-b7243000 r-xp 00000000 08:11 3146201    /usr/lib/libexpat.so.1.5.2
> b7243000-b7245000 rw-p 00023000 08:11 3146201    /usr/lib/libexpat.so.1.5.2
> b7245000-b72c6000 r-xp 00000000 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6
> b72c6000-b72c8000 rw-p 00081000 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6
> b72c8000-b750c000 r-xp 00000000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
> b750c000-b7516000 rw-p 00244000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
> b7516000-b7533000 r-xp 00000000 08:11 3163292
> /usr/local/lib/libgeos_c.so.1.5.0
> b7533000-b7534000 rw-p 0001c000 08:11 3163292
> /usr/local/lib/libgeos_c.so.1.5.0
> b7534000-b768e000 r-xp 00000000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
> b768e000-b7690000 r--p 0015a000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
> b7690000-b7691000 rw-p 0015c000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
> b7691000-b7695000 rw-p b7691000 00:00 0
> b76b1000-b76ec000 r-xp 00000000 08:11 3162172    /usr/local/lib/libproj.so.0.5.4
> b76ec000-b76ee000 rw-p 0003b000 08:11 3162172    /usr/local/lib/libproj.so.0.5.4
> b76ee000-b7f0a000 r-xp 00000000 08:11 3162145
> /usr/local/lib/libgdal.so.1.13.0
> b7f0a000-b7fa4000 rw-p 0081c000 08:11 3162145
> /usr/local/lib/libgdal.so.1.13.0
> b7fa4000-b7fab000 rw-p b7fa4000 00:00 0
> b7fab000-b7fac000 r-xp b7fab000 00:00 0          [vdso]
> b7fac000-b7fc8000 r-xp 00000000 08:11 8437905    /lib/ld-2.9.so
> b7fc8000-b7fc9000 r--p 0001b000 08:11 8437905    /lib/ld-2.9.so
> b7fc9000-b7fca000 rw-p 0001c000 08:11 8437905    /lib/ld-2.9.so
> bfbb5000-bfbca000 rw-p bffeb000 00:00 0          [stack]
> *** glibc detected *** ./proj_conf_test: double free or corruption
> (fasttop): 0x09e6aec0 ***
> ======= Backtrace: =========
> /lib/i686/cmov/libc.so.6[0xb75641d4]
> /lib/i686/cmov/libc.so.6(cfree+0x96)[0xb7566186]
> /usr/lib/libstdc++.so.6(_ZdlPv+0x21)[0xb6d74101]
> /usr/lib/libstdc++.so.6(_ZNSs4_Rep10_M_destroyERKSaIcE+0x1d)[0xb6d517fd]
> /usr/lib/libstdc++.so.6(_ZNSsD1Ev+0x4c)[0xb6d5321c]
> /lib/i686/cmov/libc.so.6(__cxa_finalize+0xc1)[0xb7525c21]
> /usr/local/lib/libgeos-3.1.0.so[0xb6b22734]
> /usr/local/lib/libgeos-3.1.0.so[0xb6c1b200]
> /lib/ld-linux.so.2[0xb7f7ba23]
> /lib/i686/cmov/libc.so.6(exit+0x89)[0xb7525889]
> ./proj_conf_test[0x8048565]
> /lib/i686/cmov/libc.so.6(__libc_start_main+0xe5)[0xb750b775]
> ./proj_conf_test[0x8048481]
> ======= Memory map: ========
> 08048000-08049000 r-xp 00000000 08:11 26624192
> /home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
> 08049000-0804a000 rw-p 00000000 08:11 26624192
> /home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
> 09e6a000-09e8b000 rw-p 09e6a000 00:00 0          [heap]
> b5800000-b5821000 rw-p b5800000 00:00 0
> b5821000-b5900000 ---p b5821000 00:00 0
> b5a00000-b5a02000 rw-p b5a00000 00:00 0
> b5a02000-b6747000 r--p 00000000 08:11 3146351    /usr/lib/libicudata.so.40.1
> b6747000-b6748000 rw-p 00d44000 08:11 3146351    /usr/lib/libicudata.so.40.1
> b6748000-b6749000 rw-p b6748000 00:00 0
> b6749000-b686e000 r-xp 00000000 08:11 3151434    /usr/lib/libicuuc.so.40.1
> b686e000-b6877000 rw-p 00124000 08:11 3151434    /usr/lib/libicuuc.so.40.1
> b6877000-b6879000 rw-p b6877000 00:00 0
> b6879000-b69fd000 r-xp 00000000 08:11 3146355    /usr/lib/libicui18n.so.40.1
> b69fd000-b6a04000 rw-p 00184000 08:11 3146355    /usr/lib/libicui18n.so.40.1
> b6a04000-b6c5f000 r-xp 00000000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
> b6c5f000-b6c6a000 rw-p 0025b000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
> b6c6a000-b6c95000 r-xp 00000000 08:11 8437815    /lib/libgcc_s.so.1
> b6c95000-b6c96000 rw-p 0002a000 08:11 8437815    /lib/libgcc_s.so.1
> b6c96000-b6c97000 rw-p b6c96000 00:00 0
> b6c97000-b6cbb000 r-xp 00000000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
> b6cbb000-b6cbc000 r--p 00023000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
> b6cbc000-b6cbd000 rw-p 00024000 08:11 8437843    /lib/i686/cmov/libm-2.9.so
> b6cbd000-b6da2000 r-xp 00000000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
> b6da2000-b6da6000 r--p 000e4000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
> b6da6000-b6da7000 rw-p 000e8000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
> b6da7000-b6dae000 rw-p b6da7000 00:00 0
> b6dae000-b6dc2000 r-xp 00000000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
> b6dc2000-b6dc3000 rw-p 00013000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
> b6dc3000-b6dd8000 r-xp 00000000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
> b6dd8000-b6dd9000 r--p 00014000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
> b6dd9000-b6dda000 rw-p 00015000 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so
> b6dda000-b6ddc000 rw-p b6dda000 00:00 0
> b6ddc000-b6de5000 r-xp 00000000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
> b6de5000-b6de6000 r--p 00008000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
> b6de6000-b6de7000 rw-p 00009000 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so
> b6de7000-b6e0e000 rw-p b6de7000 00:00 0
> b6e0e000-b6e23000 r-xp 00000000 08:11 8437975
> /lib/i686/cmov/libpthread-2.9.so
> b6e23000-b6e24000 r--p 00014000 08:11 8437975
> /lib/i686/cmov/libpthread-2.9.so
> b6e24000-b6e25000 rw-p 00015000 08:11 8437975
> /lib/i686/cmov/libpthread-2.9.so
> b6e25000-b6e28000 rw-p b6e25000 00:00 0
> b6e28000-b6fcc000 r-xp 00000000 08:11 3154222
> /usr/lib/libmysqlclient.so.15.0.0
> b6fcc000-b7010000 rw-p 001a3000 08:11 3154222
> /usr/lib/libmysqlclient.so.15.0.0
> b7010000-b7011000 rw-p b7010000 00:00 0
> b7011000-b7013000 r-xp 00000000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
> b7013000-b7014000 r--p 00001000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
> b7014000-b7015000 rw-p 00002000 08:11 8437977    /lib/i686/cmov/libdl-2.9.so
> b7015000-b701c000 r-xp 00000000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
> b701c000-b701d000 r--p 00006000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
> b701d000-b701e000 rw-p 00007000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
> b701e000-b703a000 r-xp 00000000 08:11 3541773
> /usr/local/pgsql/lib/libpq.so.5.1
> b703a000-b703b000 rw-p 0001c000 08:11 3541773
> /usr/local/pgsql/lib/libpq.so.5.1
> b703b000-b7138000 r-xp 00000000 08:11 3151596    /usr/lib/libcfitsio.so.2.510
> b7138000-b713a000 rw-p 000fc000 08:11 3151596    /usr/lib/libcfitsio.so.2.510
> b713a000-b71ae000 rw-p b713a000 00:00 0
> b71ae000-b71dd000 r-xp 00000000 08:11 8274101    /usr/lib/libnetcdf.so.4.0.0
> b71dd000-b71de000 rw-p 0002f000 08:11 8274101    /usr/lib/libnetcdf.so.4.0.0
> b71de000-b71e0000 rw-p b71de000 00:00 0
> b71e0000-b7204000 r-xp 00000000 08:11 3146201    /usr/lib/libexpat.so.1.5.2
> b7204000-b7206000 rw-p 00023000 08:11 3146201    /usr/lib/libexpat.so.1.5.2
> b7206000-b7287000 r-xp 00000000 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6
> b7287000-b7289000 rw-p 00081000 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6
> b7289000-b74cd000 r-xp 00000000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
> b74cd000-b74d7000 rw-p 00244000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
> b74d7000-b74f4000 r-xp 00000000 08:11 3163292
> /usr/local/lib/libgeos_c.so.1.5.0
> b74f4000-b74f5000 rw-p 0001c000 08:11 3163292
> /usr/local/lib/libgeos_c.so.1.5.0
> b74f5000-b764f000 r-xp 00000000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
> b764f000-b7651000 r--p 0015a000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
> b7651000-b7652000 rw-p 0015c000 08:11 8437821    /lib/i686/cmov/libc-2.9.so
> b7652000-b7656000 rw-p b7652000 00:00 0
> b7672000-b76ad000 r-xp 00000000 08:11 3162172    /usr/local/lib/libproj.so.0.5.4
> b76ad000-b76af000 rw-p 0003b000 08:11 3162172    /usr/local/lib/libproj.so.0.5.4
> b76af000-b7ecb000 r-xp 00000000 08:11 3162145
> /usr/local/lib/libgdal.so.1.13.0
> b7ecb000-b7f65000 rw-p 0081c000 08:11 3162145
> /usr/local/lib/libgdal.so.1.13.0
> b7f65000-b7f6c000 rw-p b7f65000 00:00 0
> b7f6c000-b7f6d000 r-xp b7f6c000 00:00 0          [vdso]
> b7f6d000-b7f89000 r-xp 00000000 08:11 8437905    /lib/ld-2.9.so
> b7f89000-b7f8a000 r--p 0001b000 08:11 8437905    /lib/ld-2.9.so
> b7f8a000-b7f8b000 rw-p 0001c000 08:11 8437905    /lib/ld-2.9.so
> bfa75000-bfa8a000 rw-p bffeb000 00:00 0          [stack]
> OK
> * checking package directory ... OK
> * checking for portable file names ... OK
> * checking for sufficient/correct file permissions ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * checking whether the package can be loaded ...*** glibc detected ***
> /usr/local/lib/R/bin/exec/R: double free or corruption (fasttop):
> 0x08dff5c0 ***
> ---------------------------------------------------------------------------------------------------------------------
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From brenning at uwaterloo.ca  Fri Jun  5 21:39:59 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Fri, 05 Jun 2009 15:39:59 -0400
Subject: [R-sig-Geo] matching points to a raster
In-Reply-To: <4A2968D3.8050808@orn.mpg.de>
References: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>
	<4A2968D3.8050808@orn.mpg.de>
Message-ID: <4A29748F.30803@uwaterloo.ca>

Hi Juliane,

may I also suggest having a look at the pick.from.ascii.grid function 
(and the like) in the RSAGA package. This will use nearest neighbour 
interpolation (or, for reasonably small grids, may also use an ad hoc 
local kriging interpolation) to pick grid values (from grids with 
numeric data).

http://cran.r-project.org/web/packages/RSAGA/RSAGA.pdf

There are some more suggestions in the R-sig-geo archives:

https://stat.ethz.ch/pipermail/r-sig-geo/2008-October/004469.html

http://www.mail-archive.com/r-sig-geo at stat.math.ethz.ch/msg04662.html

I hope this helps
  Alex



> Struve, Juliane wrote:
>> Dear list,
>>
>> I am trying to incoporate spatial information (for example distance) 
>> into a movement model by reading an ascii -b converted raster and 
>> matching the raster with points of a movement path (for example 
>> fishmove$coord[fishmove$day==1]. Below is a section of my code to 
>> explain the problem. This code does not work because the coordinates 
>> of the movement path are not the same as those in the raster. Rounding 
>> the coordinates does not seem to solve the problem. Maybe the closest 
>> point would have to be found, but i am not sure how to approach this.  
>> Is there another perhaps easier way ?
>>
>> Dist_DF=data.frame(readAsciiGrid("distance.txt"))
>> Dist_shoreDF$coord = paste(round(Dist_DF$s1),round(Dist_DF$s2),sep=",")
>> names(Dist_DF)[1]="Dist"
>> Dist_DF$Dist[Dist_shoreDF$coord==fishmove$coord[fishmove$day==1]]
>>
>> I would be grateful for any help.
>>
>> Many thanks,
>>
>> Juliane

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From milton.ruser at gmail.com  Fri Jun  5 22:03:15 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Fri, 5 Jun 2009 16:03:15 -0400
Subject: [R-sig-Geo] matching points to a raster
In-Reply-To: <4A2968D3.8050808@orn.mpg.de>
References: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4A2@ICEXM5.ic.ac.uk>
	<4A2968D3.8050808@orn.mpg.de>
Message-ID: <3aaf1a030906051303j764e3f03gfc90fd4cab12987e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090605/80d50763/attachment.pl>

From debeaudette at ucdavis.edu  Fri Jun  5 22:04:21 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Fri, 5 Jun 2009 13:04:21 -0700
Subject: [R-sig-Geo] spgrass6 and R 2.9
In-Reply-To: <alpine.LRH.2.00.0906052050480.3166@reclus.nhh.no>
References: <200905291426.56291.dylan.beaudette@gmail.com>
	<3c5546140906050808l15290a86ja487c4428af196b8@mail.gmail.com>
	<alpine.LRH.2.00.0906052050480.3166@reclus.nhh.no>
Message-ID: <200906051304.21694.dylan.beaudette@gmail.com>

On Friday 05 June 2009, Roger Bivand wrote:
> On Fri, 5 Jun 2009, Dylan Beaudette wrote:
> > On Fri, Jun 5, 2009 at 1:55 AM, Roger Bivand<Roger.Bivand at nhh.no> wrote:
> >> On Thu, 4 Jun 2009, Dylan Beaudette wrote:
> >>> On Monday 01 June 2009, Roger Bivand wrote:
> >>>> On Mon, 1 Jun 2009, Dylan Beaudette wrote:
> >>>>> On Friday 29 May 2009, Torleif Markussen Lunde wrote:
> >>>>>> Hi
> >>>>>>
> >>>>>> First try updating glibc, and install spgrass6 again. If this does
> >>>>>> not work you could try
> >>>>>>
> >>>>>> export MALLOC_CHECK_=0
> >>>>>>
> >>>>>> before you start R. The error might be related to "somewhere
> >>>>>> something" is trying to free memory that has already been
> >>>>>> unallocated. I don't know
> >>>>>> the details here, but it could be worth a try?
> >>>>>>
> >>>>>> Best wishes
> >>>>>> Torleif
> >>>>>
> >>>>> Hi Torleif, thanks for the tips.
> >>>>>
> >>>>> I just updated my libc, and tried the MALLOC_CHECK trick-- neither
> >>>>> fixed the problem. Still get the same error... Very strange, as I did
> >>>>> not encounter this problem on a very similar machine.
> >>>>>
> >>>>> Could this have anything to do with configure arguments such as
> >>>>> -march ?
> >>>>
> >>>> You haven't told us what your underlying system is, or how you
> >>>> installed R. If you built R from source, did you run "make check"?
> >>>> Does the problem arise installing other packages? It most likely is
> >>>> something on your system, otherwise there would be lots of reports of
> >>>> the same.
> >>>>
> >>>> Roger
> >>>
> >>> Right. Should have been a little less hasty about posting to the list.
> >>> R has
> >>> been built from source, spgrass6 was accessed from CRAN via
> >>> install.packages(). This problems has not occurred at anyother time
> >>> while updating packages that were installed under R 2.7.
> >>>
> >>> 1. make check (R 2.9.0): OK
> >>>
> >>> 2. sessionInfo()
> >>> R version 2.9.0 (2009-04-17)
> >>> i686-pc-linux-gnu
> >>>
> >>> locale:
> >>>
> >>> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=
> >>>C;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C
> >>>;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C
> >>>
> >>> attached base packages:
> >>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
> >>>
> >>> Is there any way that I can do a 'make check' type of operation with
> >>> the latest spgrass6 from CRAN?
> >>
> >> Yes, do R CMD check spgrass6_0.6-6.tar.gz. When building R, are you
> >> setting the architecture flags manually? Have you tried letting R sort
> >> things out for itself? Could you try R CMD check rgdal (from the source
> >> tarball)? Could you try:
> >>
> >> R -d gbd
> >>
> >> and then a traceback after install fails? Otherwise we are left with
> >> non-random cosmic rays as the explanation?
> >>
> >> Roger
> >
> > Thanks Roger.
> >
> > I usually set the march flag to -march=opteron ... and seem to recall
> > setting that as as system wide configure option, but cannot recall
> > what file that is in... I'll check.

Hi Roger thanks for the response.

> Dylan,
>
> Your post on R-help about problems with R and PostgreSQL may suggest a
> systemic problem, unless you are sure that your alias fix there is not
> system specific (try on another machine). Architectures ought to be found
> automatically.

This is the strange part. I have 2 nearly identical setups: one is xeon-based 
the other is opteron-based, both running Debian unstable with R-2.9.0 
compiled from source. The post regarding PostgreSQL was actually related to 
problems on the xeon-based machine.

The opteron-based machine has a slightly newer set of packages:

opteron-machine:
gcc                                          4:4.3.3-8
libc6-i686                                   2.9-13

xeon-machine:
gcc                                    4:4.3.3-2
libc6-i686                             2.9-6


Another strange thing: I haven't had any other problems with the opteron-based 
machine, at least with respect to compiling related packages such as GRASS, 
GDAL, PROJ, PostGIS, PostgreSQL, etc.


I started R with the debugger like this:

# start R
sudo R -d /usr/bin/gdb

# start R from within gdb
(gdb) run

# install local copy of package:
install.packages('spgrass6_0.6-6.tar.gz')
inferring 'repos = NULL' from the file name
* Installing *source* package 'spgrass6' ...
** R
** inst

# run backtrace
(gdb) bt
#0  0xb7f86424 in __kernel_vsyscall ()
#1  0xb7d4ae73 in waitpid () from /lib/i686/cmov/libc.so.6
#2  0xb7ce6f6b in ?? () from /lib/i686/cmov/libc.so.6
#3  0x080e9423 in R_system ()
#4  0x081035c5 in do_system ()
#5  0x0806c2c7 in do_internal ()
#6  0x081999aa in Rf_eval ()
#7  0x0819b7a4 in do_begin ()
#8  0x081999aa in Rf_eval ()
#9  0x0819a130 in Rf_applyClosure ()
#10 0x08199c26 in Rf_eval ()
#11 0x0819c518 in Rf_evalList ()
#12 0x08199a94 in Rf_eval ()
#13 0x0819aaad in do_if ()
#14 0x081999aa in Rf_eval ()
#15 0x0819b7a4 in do_begin ()
#16 0x081999aa in Rf_eval ()
#17 0x0819b2c8 in do_for ()
#18 0x081999aa in Rf_eval ()
#19 0x0819b7a4 in do_begin ()
#20 0x081999aa in Rf_eval ()
#21 0x0819aaf5 in do_if ()
#22 0x081999aa in Rf_eval ()
#23 0x0819b7a4 in do_begin ()
#24 0x081999aa in Rf_eval ()
#25 0x0819a130 in Rf_applyClosure ()
#26 0x08199c26 in Rf_eval ()
#27 0x080593c3 in Rf_ReplIteration ()
#28 0x08059585 in R_ReplConsole ()
#29 0x0805a7bb in run_Rmainloop ()
#30 0x0805a7d2 in Rf_mainloop ()
#31 0x08058f95 in main ()
#32 0xb7cc2775 in __libc_start_main () from /lib/i686/cmov/libc.so.6
#33 0x08058ed1 in _start () at ../sysdeps/i386/elf/start.S:119


I don't really understand this output, but I wouldn't be surprised if it isn't 
something specific to this machine.

Any ideas?

Cheers,
Dylan




>
> > How exactly does the R -d gdb approach work?
>
> Well, when you run it, you get the GDB interface, and type run to run R.
> Then do install.packages(), possibly from a local tarball, and use GDB
> commands to interrogate the crash.
>
> I find it very hard to credit that this is not specific to your machine.
> Do you have an equivalent AMD (or Intel) x86 box you can try this on? It
> is very hard to help if nobody else can reproduce it (I run 2 x86 Intel
> Linux, 1 64-bit Intel Linux, with R built from source, and see nothing
> untoward in installing spgrass6. Did you try to run R CMD check on other
> packages?
>
> Roger
>
> > Thanks!
> > Dylan
> >
> >
> >
> > Here is the check on spgrass6:
> >
> > -------------------------------------------------------------------------
> >-------------------------------------------- R CMD check
> > spgrass6_0.6-6.tar.gz
> > * checking for working pdflatex ... OK
> > * using log directory '/home/dylan/src/spgrass6.Rcheck'
> > * using R version 2.9.0 (2009-04-17)
> > * using session charset: ISO8859-1
> > * checking for file 'spgrass6/DESCRIPTION' ... OK
> > * this is package 'spgrass6' version '0.6-6'
> > * checking package dependencies ... OK
> > * checking if this is a source package ... OK
> > * checking for .dll and .exe files ... OK
> > * checking whether package 'spgrass6' can be installed ...*** glibc
> > detected *** /usr/local/lib/R/bin/exec/R: double free or corruption
> > (fasttop): 0x09568348 ***
> > -------------------------------------------------------------------------
> >--------------------------------------------
> >
> > Now rgdal:
> > -------------------------------------------------------------------------
> >-------------------------------------------- R CMD check
> > rgdal_0.6-8.tar.gz
> > * checking for working pdflatex ... OK
> > * using log directory '/home/dylan/src/rgdal.Rcheck'
> > * using R version 2.9.0 (2009-04-17)
> > * using session charset: ISO8859-1
> > * checking for file 'rgdal/DESCRIPTION' ... OK
> > * this is package 'rgdal' version '0.6-8'
> > * checking package name space information ... OK
> > * checking package dependencies ... OK
> > * checking if this is a source package ... OK
> > * checking for .dll and .exe files ... OK
> > * checking whether package 'rgdal' can be installed ...*** glibc
> > detected *** ./proj_conf_test: double free or corruption (fasttop):
> > 0x08c5bec0 ***
> > ======= Backtrace: =========
> > /lib/i686/cmov/libc.so.6[0xb75a31d4]
> > /lib/i686/cmov/libc.so.6(cfree+0x96)[0xb75a5186]
> > /usr/lib/libstdc++.so.6(_ZdlPv+0x21)[0xb6db3101]
> > /usr/lib/libstdc++.so.6(_ZNSs4_Rep10_M_destroyERKSaIcE+0x1d)[0xb6d907fd]
> > /usr/lib/libstdc++.so.6(_ZNSsD1Ev+0x4c)[0xb6d9221c]
> > /lib/i686/cmov/libc.so.6(__cxa_finalize+0xc1)[0xb7564c21]
> > /usr/local/lib/libgeos-3.1.0.so[0xb6b61734]
> > /usr/local/lib/libgeos-3.1.0.so[0xb6c5a200]
> > /lib/ld-linux.so.2[0xb7fbaa23]
> > /lib/i686/cmov/libc.so.6(exit+0x89)[0xb7564889]
> > ./proj_conf_test[0x8048565]
> > /lib/i686/cmov/libc.so.6(__libc_start_main+0xe5)[0xb754a775]
> > ./proj_conf_test[0x8048481]
> > ======= Memory map: ========
> > 08048000-08049000 r-xp 00000000 08:11 26624192
> > /home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
> > 08049000-0804a000 rw-p 00000000 08:11 26624192
> > /home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
> > 08c5b000-08c7c000 rw-p 08c5b000 00:00 0          [heap]
> > b5900000-b5921000 rw-p b5900000 00:00 0
> > b5921000-b5a00000 ---p b5921000 00:00 0
> > b5a3f000-b5a41000 rw-p b5a3f000 00:00 0
> > b5a41000-b6786000 r--p 00000000 08:11 3146351   
> > /usr/lib/libicudata.so.40.1 b6786000-b6787000 rw-p 00d44000 08:11 3146351
> >    /usr/lib/libicudata.so.40.1 b6787000-b6788000 rw-p b6787000 00:00 0
> > b6788000-b68ad000 r-xp 00000000 08:11 3151434   
> > /usr/lib/libicuuc.so.40.1 b68ad000-b68b6000 rw-p 00124000 08:11 3151434  
> >  /usr/lib/libicuuc.so.40.1 b68b6000-b68b8000 rw-p b68b6000 00:00 0
> > b68b8000-b6a3c000 r-xp 00000000 08:11 3146355   
> > /usr/lib/libicui18n.so.40.1 b6a3c000-b6a43000 rw-p 00184000 08:11 3146355
> >    /usr/lib/libicui18n.so.40.1 b6a43000-b6c9e000 r-xp 00000000 08:11
> > 3163289    /usr/local/lib/libgeos-3.1.0.so b6c9e000-b6ca9000 rw-p
> > 0025b000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
> > b6ca9000-b6cd4000 r-xp 00000000 08:11 8437815    /lib/libgcc_s.so.1
> > b6cd4000-b6cd5000 rw-p 0002a000 08:11 8437815    /lib/libgcc_s.so.1
> > b6cd5000-b6cd6000 rw-p b6cd5000 00:00 0
> > b6cd6000-b6cfa000 r-xp 00000000 08:11 8437843   
> > /lib/i686/cmov/libm-2.9.so b6cfa000-b6cfb000 r--p 00023000 08:11 8437843 
> >   /lib/i686/cmov/libm-2.9.so b6cfb000-b6cfc000 rw-p 00024000 08:11
> > 8437843    /lib/i686/cmov/libm-2.9.so b6cfc000-b6de1000 r-xp 00000000
> > 08:11 3146421    /usr/lib/libstdc++.so.6.0.12 b6de1000-b6de5000 r--p
> > 000e4000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12 b6de5000-b6de6000
> > rw-p 000e8000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
> > b6de6000-b6ded000 rw-p b6de6000 00:00 0
> > b6ded000-b6e01000 r-xp 00000000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
> > b6e01000-b6e02000 rw-p 00013000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
> > b6e02000-b6e17000 r-xp 00000000 08:11 8437891   
> > /lib/i686/cmov/libnsl-2.9.so b6e17000-b6e18000 r--p 00014000 08:11
> > 8437891    /lib/i686/cmov/libnsl-2.9.so b6e18000-b6e19000 rw-p 00015000
> > 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so b6e19000-b6e1b000 rw-p
> > b6e19000 00:00 0
> > b6e1b000-b6e24000 r-xp 00000000 08:11 8437976   
> > /lib/i686/cmov/libcrypt-2.9.so b6e24000-b6e25000 r--p 00008000 08:11
> > 8437976    /lib/i686/cmov/libcrypt-2.9.so b6e25000-b6e26000 rw-p 00009000
> > 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so b6e26000-b6e4d000 rw-p
> > b6e26000 00:00 0
> > b6e4d000-b6e62000 r-xp 00000000 08:11 8437975
> > /lib/i686/cmov/libpthread-2.9.so
> > b6e62000-b6e63000 r--p 00014000 08:11 8437975
> > /lib/i686/cmov/libpthread-2.9.so
> > b6e63000-b6e64000 rw-p 00015000 08:11 8437975
> > /lib/i686/cmov/libpthread-2.9.so
> > b6e64000-b6e67000 rw-p b6e64000 00:00 0
> > b6e67000-b700b000 r-xp 00000000 08:11 3154222
> > /usr/lib/libmysqlclient.so.15.0.0
> > b700b000-b704f000 rw-p 001a3000 08:11 3154222
> > /usr/lib/libmysqlclient.so.15.0.0
> > b704f000-b7050000 rw-p b704f000 00:00 0
> > b7050000-b7052000 r-xp 00000000 08:11 8437977   
> > /lib/i686/cmov/libdl-2.9.so b7052000-b7053000 r--p 00001000 08:11 8437977
> >    /lib/i686/cmov/libdl-2.9.so b7053000-b7054000 rw-p 00002000 08:11
> > 8437977    /lib/i686/cmov/libdl-2.9.so b7054000-b705b000 r-xp 00000000
> > 08:11 8437904    /lib/i686/cmov/librt-2.9.so b705b000-b705c000 r--p
> > 00006000 08:11 8437904    /lib/i686/cmov/librt-2.9.so b705c000-b705d000
> > rw-p 00007000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
> > b705d000-b7079000 r-xp 00000000 08:11 3541773
> > /usr/local/pgsql/lib/libpq.so.5.1
> > b7079000-b707a000 rw-p 0001c000 08:11 3541773
> > /usr/local/pgsql/lib/libpq.so.5.1
> > b707a000-b7177000 r-xp 00000000 08:11 3151596   
> > /usr/lib/libcfitsio.so.2.510 b7177000-b7179000 rw-p 000fc000 08:11
> > 3151596    /usr/lib/libcfitsio.so.2.510 b7179000-b71ed000 rw-p b7179000
> > 00:00 0
> > b71ed000-b721c000 r-xp 00000000 08:11 8274101   
> > /usr/lib/libnetcdf.so.4.0.0 b721c000-b721d000 rw-p 0002f000 08:11 8274101
> >    /usr/lib/libnetcdf.so.4.0.0 b721d000-b721f000 rw-p b721d000 00:00 0
> > b721f000-b7243000 r-xp 00000000 08:11 3146201   
> > /usr/lib/libexpat.so.1.5.2 b7243000-b7245000 rw-p 00023000 08:11 3146201 
> >   /usr/lib/libexpat.so.1.5.2 b7245000-b72c6000 r-xp 00000000 08:11
> > 3145848    /usr/lib/libsqlite3.so.0.8.6 b72c6000-b72c8000 rw-p 00081000
> > 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6 b72c8000-b750c000 r-xp
> > 00000000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
> > b750c000-b7516000 rw-p 00244000 08:11 3162687   
> > /usr/local/lib/libgeos-3.0.0.so b7516000-b7533000 r-xp 00000000 08:11
> > 3163292
> > /usr/local/lib/libgeos_c.so.1.5.0
> > b7533000-b7534000 rw-p 0001c000 08:11 3163292
> > /usr/local/lib/libgeos_c.so.1.5.0
> > b7534000-b768e000 r-xp 00000000 08:11 8437821   
> > /lib/i686/cmov/libc-2.9.so b768e000-b7690000 r--p 0015a000 08:11 8437821 
> >   /lib/i686/cmov/libc-2.9.so b7690000-b7691000 rw-p 0015c000 08:11
> > 8437821    /lib/i686/cmov/libc-2.9.so b7691000-b7695000 rw-p b7691000
> > 00:00 0
> > b76b1000-b76ec000 r-xp 00000000 08:11 3162172   
> > /usr/local/lib/libproj.so.0.5.4 b76ec000-b76ee000 rw-p 0003b000 08:11
> > 3162172    /usr/local/lib/libproj.so.0.5.4 b76ee000-b7f0a000 r-xp
> > 00000000 08:11 3162145
> > /usr/local/lib/libgdal.so.1.13.0
> > b7f0a000-b7fa4000 rw-p 0081c000 08:11 3162145
> > /usr/local/lib/libgdal.so.1.13.0
> > b7fa4000-b7fab000 rw-p b7fa4000 00:00 0
> > b7fab000-b7fac000 r-xp b7fab000 00:00 0          [vdso]
> > b7fac000-b7fc8000 r-xp 00000000 08:11 8437905    /lib/ld-2.9.so
> > b7fc8000-b7fc9000 r--p 0001b000 08:11 8437905    /lib/ld-2.9.so
> > b7fc9000-b7fca000 rw-p 0001c000 08:11 8437905    /lib/ld-2.9.so
> > bfbb5000-bfbca000 rw-p bffeb000 00:00 0          [stack]
> > *** glibc detected *** ./proj_conf_test: double free or corruption
> > (fasttop): 0x09e6aec0 ***
> > ======= Backtrace: =========
> > /lib/i686/cmov/libc.so.6[0xb75641d4]
> > /lib/i686/cmov/libc.so.6(cfree+0x96)[0xb7566186]
> > /usr/lib/libstdc++.so.6(_ZdlPv+0x21)[0xb6d74101]
> > /usr/lib/libstdc++.so.6(_ZNSs4_Rep10_M_destroyERKSaIcE+0x1d)[0xb6d517fd]
> > /usr/lib/libstdc++.so.6(_ZNSsD1Ev+0x4c)[0xb6d5321c]
> > /lib/i686/cmov/libc.so.6(__cxa_finalize+0xc1)[0xb7525c21]
> > /usr/local/lib/libgeos-3.1.0.so[0xb6b22734]
> > /usr/local/lib/libgeos-3.1.0.so[0xb6c1b200]
> > /lib/ld-linux.so.2[0xb7f7ba23]
> > /lib/i686/cmov/libc.so.6(exit+0x89)[0xb7525889]
> > ./proj_conf_test[0x8048565]
> > /lib/i686/cmov/libc.so.6(__libc_start_main+0xe5)[0xb750b775]
> > ./proj_conf_test[0x8048481]
> > ======= Memory map: ========
> > 08048000-08049000 r-xp 00000000 08:11 26624192
> > /home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
> > 08049000-0804a000 rw-p 00000000 08:11 26624192
> > /home/dylan/src/rgdal.Rcheck/00_pkg_src/rgdal/proj_conf_test
> > 09e6a000-09e8b000 rw-p 09e6a000 00:00 0          [heap]
> > b5800000-b5821000 rw-p b5800000 00:00 0
> > b5821000-b5900000 ---p b5821000 00:00 0
> > b5a00000-b5a02000 rw-p b5a00000 00:00 0
> > b5a02000-b6747000 r--p 00000000 08:11 3146351   
> > /usr/lib/libicudata.so.40.1 b6747000-b6748000 rw-p 00d44000 08:11 3146351
> >    /usr/lib/libicudata.so.40.1 b6748000-b6749000 rw-p b6748000 00:00 0
> > b6749000-b686e000 r-xp 00000000 08:11 3151434   
> > /usr/lib/libicuuc.so.40.1 b686e000-b6877000 rw-p 00124000 08:11 3151434  
> >  /usr/lib/libicuuc.so.40.1 b6877000-b6879000 rw-p b6877000 00:00 0
> > b6879000-b69fd000 r-xp 00000000 08:11 3146355   
> > /usr/lib/libicui18n.so.40.1 b69fd000-b6a04000 rw-p 00184000 08:11 3146355
> >    /usr/lib/libicui18n.so.40.1 b6a04000-b6c5f000 r-xp 00000000 08:11
> > 3163289    /usr/local/lib/libgeos-3.1.0.so b6c5f000-b6c6a000 rw-p
> > 0025b000 08:11 3163289    /usr/local/lib/libgeos-3.1.0.so
> > b6c6a000-b6c95000 r-xp 00000000 08:11 8437815    /lib/libgcc_s.so.1
> > b6c95000-b6c96000 rw-p 0002a000 08:11 8437815    /lib/libgcc_s.so.1
> > b6c96000-b6c97000 rw-p b6c96000 00:00 0
> > b6c97000-b6cbb000 r-xp 00000000 08:11 8437843   
> > /lib/i686/cmov/libm-2.9.so b6cbb000-b6cbc000 r--p 00023000 08:11 8437843 
> >   /lib/i686/cmov/libm-2.9.so b6cbc000-b6cbd000 rw-p 00024000 08:11
> > 8437843    /lib/i686/cmov/libm-2.9.so b6cbd000-b6da2000 r-xp 00000000
> > 08:11 3146421    /usr/lib/libstdc++.so.6.0.12 b6da2000-b6da6000 r--p
> > 000e4000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12 b6da6000-b6da7000
> > rw-p 000e8000 08:11 3146421    /usr/lib/libstdc++.so.6.0.12
> > b6da7000-b6dae000 rw-p b6da7000 00:00 0
> > b6dae000-b6dc2000 r-xp 00000000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
> > b6dc2000-b6dc3000 rw-p 00013000 08:11 3146202    /usr/lib/libz.so.1.2.3.3
> > b6dc3000-b6dd8000 r-xp 00000000 08:11 8437891   
> > /lib/i686/cmov/libnsl-2.9.so b6dd8000-b6dd9000 r--p 00014000 08:11
> > 8437891    /lib/i686/cmov/libnsl-2.9.so b6dd9000-b6dda000 rw-p 00015000
> > 08:11 8437891    /lib/i686/cmov/libnsl-2.9.so b6dda000-b6ddc000 rw-p
> > b6dda000 00:00 0
> > b6ddc000-b6de5000 r-xp 00000000 08:11 8437976   
> > /lib/i686/cmov/libcrypt-2.9.so b6de5000-b6de6000 r--p 00008000 08:11
> > 8437976    /lib/i686/cmov/libcrypt-2.9.so b6de6000-b6de7000 rw-p 00009000
> > 08:11 8437976    /lib/i686/cmov/libcrypt-2.9.so b6de7000-b6e0e000 rw-p
> > b6de7000 00:00 0
> > b6e0e000-b6e23000 r-xp 00000000 08:11 8437975
> > /lib/i686/cmov/libpthread-2.9.so
> > b6e23000-b6e24000 r--p 00014000 08:11 8437975
> > /lib/i686/cmov/libpthread-2.9.so
> > b6e24000-b6e25000 rw-p 00015000 08:11 8437975
> > /lib/i686/cmov/libpthread-2.9.so
> > b6e25000-b6e28000 rw-p b6e25000 00:00 0
> > b6e28000-b6fcc000 r-xp 00000000 08:11 3154222
> > /usr/lib/libmysqlclient.so.15.0.0
> > b6fcc000-b7010000 rw-p 001a3000 08:11 3154222
> > /usr/lib/libmysqlclient.so.15.0.0
> > b7010000-b7011000 rw-p b7010000 00:00 0
> > b7011000-b7013000 r-xp 00000000 08:11 8437977   
> > /lib/i686/cmov/libdl-2.9.so b7013000-b7014000 r--p 00001000 08:11 8437977
> >    /lib/i686/cmov/libdl-2.9.so b7014000-b7015000 rw-p 00002000 08:11
> > 8437977    /lib/i686/cmov/libdl-2.9.so b7015000-b701c000 r-xp 00000000
> > 08:11 8437904    /lib/i686/cmov/librt-2.9.so b701c000-b701d000 r--p
> > 00006000 08:11 8437904    /lib/i686/cmov/librt-2.9.so b701d000-b701e000
> > rw-p 00007000 08:11 8437904    /lib/i686/cmov/librt-2.9.so
> > b701e000-b703a000 r-xp 00000000 08:11 3541773
> > /usr/local/pgsql/lib/libpq.so.5.1
> > b703a000-b703b000 rw-p 0001c000 08:11 3541773
> > /usr/local/pgsql/lib/libpq.so.5.1
> > b703b000-b7138000 r-xp 00000000 08:11 3151596   
> > /usr/lib/libcfitsio.so.2.510 b7138000-b713a000 rw-p 000fc000 08:11
> > 3151596    /usr/lib/libcfitsio.so.2.510 b713a000-b71ae000 rw-p b713a000
> > 00:00 0
> > b71ae000-b71dd000 r-xp 00000000 08:11 8274101   
> > /usr/lib/libnetcdf.so.4.0.0 b71dd000-b71de000 rw-p 0002f000 08:11 8274101
> >    /usr/lib/libnetcdf.so.4.0.0 b71de000-b71e0000 rw-p b71de000 00:00 0
> > b71e0000-b7204000 r-xp 00000000 08:11 3146201   
> > /usr/lib/libexpat.so.1.5.2 b7204000-b7206000 rw-p 00023000 08:11 3146201 
> >   /usr/lib/libexpat.so.1.5.2 b7206000-b7287000 r-xp 00000000 08:11
> > 3145848    /usr/lib/libsqlite3.so.0.8.6 b7287000-b7289000 rw-p 00081000
> > 08:11 3145848    /usr/lib/libsqlite3.so.0.8.6 b7289000-b74cd000 r-xp
> > 00000000 08:11 3162687    /usr/local/lib/libgeos-3.0.0.so
> > b74cd000-b74d7000 rw-p 00244000 08:11 3162687   
> > /usr/local/lib/libgeos-3.0.0.so b74d7000-b74f4000 r-xp 00000000 08:11
> > 3163292
> > /usr/local/lib/libgeos_c.so.1.5.0
> > b74f4000-b74f5000 rw-p 0001c000 08:11 3163292
> > /usr/local/lib/libgeos_c.so.1.5.0
> > b74f5000-b764f000 r-xp 00000000 08:11 8437821   
> > /lib/i686/cmov/libc-2.9.so b764f000-b7651000 r--p 0015a000 08:11 8437821 
> >   /lib/i686/cmov/libc-2.9.so b7651000-b7652000 rw-p 0015c000 08:11
> > 8437821    /lib/i686/cmov/libc-2.9.so b7652000-b7656000 rw-p b7652000
> > 00:00 0
> > b7672000-b76ad000 r-xp 00000000 08:11 3162172   
> > /usr/local/lib/libproj.so.0.5.4 b76ad000-b76af000 rw-p 0003b000 08:11
> > 3162172    /usr/local/lib/libproj.so.0.5.4 b76af000-b7ecb000 r-xp
> > 00000000 08:11 3162145
> > /usr/local/lib/libgdal.so.1.13.0
> > b7ecb000-b7f65000 rw-p 0081c000 08:11 3162145
> > /usr/local/lib/libgdal.so.1.13.0
> > b7f65000-b7f6c000 rw-p b7f65000 00:00 0
> > b7f6c000-b7f6d000 r-xp b7f6c000 00:00 0          [vdso]
> > b7f6d000-b7f89000 r-xp 00000000 08:11 8437905    /lib/ld-2.9.so
> > b7f89000-b7f8a000 r--p 0001b000 08:11 8437905    /lib/ld-2.9.so
> > b7f8a000-b7f8b000 rw-p 0001c000 08:11 8437905    /lib/ld-2.9.so
> > bfa75000-bfa8a000 rw-p bffeb000 00:00 0          [stack]
> > OK
> > * checking package directory ... OK
> > * checking for portable file names ... OK
> > * checking for sufficient/correct file permissions ... OK
> > * checking DESCRIPTION meta-information ... OK
> > * checking top-level files ... OK
> > * checking index information ... OK
> > * checking package subdirectories ... OK
> > * checking R files for non-ASCII characters ... OK
> > * checking R files for syntax errors ... OK
> > * checking whether the package can be loaded ...*** glibc detected ***
> > /usr/local/lib/R/bin/exec/R: double free or corruption (fasttop):
> > 0x08dff5c0 ***
> > -------------------------------------------------------------------------
> >--------------------------------------------



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From moor0554 at umn.edu  Sat Jun  6 18:44:44 2009
From: moor0554 at umn.edu (Christopher Moore)
Date: Sat, 6 Jun 2009 11:44:44 -0500
Subject: [R-sig-Geo] geoR: variofit question
In-Reply-To: <mailman.13.1244282405.17361.r-sig-geo@stat.math.ethz.ch>
References: <mailman.13.1244282405.17361.r-sig-geo@stat.math.ethz.ch>
Message-ID: <2181FBC307C24A6FBA83B4C7667B37C4@T60>

Hi Laura,

Not sure if this is correct, but it might help you replicate the published
results:

library(geoR)
?variofit
?variog
vario100 <- variog(s100, max.dist=1)
ini.vals <- expand.grid(seq(0,1,l=5), seq(0,1,l=5))
(wls <- variofit(vario100, ini=ini.vals, fix.nug=TRUE, weights="cressie"))
plot(vario100); lines(wls)
(wls.sum <- summary(wls))
(sse <- wls.sum$sum.of.squares)
(n <- length(s100$data))
(p <- length(wls.sum$estimated.pars))
(df <- n-p-1)
(mse <- sse/df)
(rmse <- sqrt(mse))

Could you follow up and let me know if this approach worked?

-Chris

--
Christopher Moore, M.P.P.
Doctoral Student
Quantitative Methods in Education
University of Minnesota
44.9785?, -93.2396?
moor0554 at umn.edu
http://umn.edu/~moor0554

-----Original Message-----
Date: Fri, 05 Jun 2009 09:33:39 -0500
From: Laura Chihara <lchihara at carleton.edu>
Subject: [R-sig-Geo] geoR: variofit question
To: r-sig-geo at stat.math.ethz.ch
Message-ID: <4A292CC3.8040001 at carleton.edu>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed


I'm reading some papers that compare various
theoretical semi-variogram models to data using
weighted least squares. In the papers, the authors
look at the root mean square error. I would like
to try to replicate the results.

Is there a way to extract the RMSE when
using weighted least squares for fitting
(the option="cressie" in variofit)?

Thank you.

-- Laura Chihara

*******************************************
Laura Chihara
Professor of Mathematics   507-222-4065 (office)
Dept of Mathematics        507-222-4312 (fax)
Carleton College
1 North College Street
Northfield MN 55057


From Roger.Bivand at nhh.no  Sat Jun  6 18:49:39 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 6 Jun 2009 18:49:39 +0200 (CEST)
Subject: [R-sig-Geo] nearest neighbour list from distance matrix, etc.
In-Reply-To: <28C15D104A882F47954DEE56148152CC015A20AB99@nerckwmb1.ad.nerc.ac.uk>
References: <28C15D104A882F47954DEE56148152CC015A20AB99@nerckwmb1.ad.nerc.ac.uk>
Message-ID: <alpine.LRH.2.00.0906061832030.8949@reclus.nhh.no>

On Tue, 26 May 2009, Wakefield, Ewan wrote:

> Hi everyone,
>
> I have been constructing simple linear models of seabird colony size as 
> a function of habitat availability. Given that my data obviously contain 
> a spatial component, I would like to check whether both my response and 
> residuals exhibit any spatial auto-correlation. I understand that I can 
> test for this using Moran's I, calculated for pairs of colonies 
> separated into different distance classes. However, this presents a 
> number of problems:
>
> 1. All of the distance based methods I have come across for defining 
> nearest neighbours require a matrix of point coordinates. The species I 
> am working with do not fly over land, so the Euclidean or greater circle 
> distance between colonies is not really appropriate. Hence, I have 
> computed a matrix of the 'at sea' distance between all colonies. Is 
> there any way to pass this to a function that defines nearest 
> neighbours?

No, you cannot pass it to for example dnearneigh() in spdep. You would 
need to construct an "nb" neighbours object manually, something like:

library(spdep)
example(columbus)
col_d <- as.matrix(dist(coordinates(columbus)))
# create a distance matrix
nb_d062 <- dnearneigh(coordinates(columbus), 0, 0.62)
# to set a benchmark example using the same coordinates
col_d062 <- apply(col_d, 1, function(x) which(x <= 0.62 & x > 0))
# extract the column indices for the same criteria, dropping self
any(sapply(col_d052, length) < 1)
which(sapply(col_d052, length) < 1)
# check that every entity included (case not treated here, but empty
# vector needs replacing with integer value of 0)
col_d062a <- lapply(col_d062, function(x) {names(x) <- NULL; x})
names(col_d062a) <- NULL
# remove index names
class(col_d062a) <- "nb"
attr(col_d062a, "region.id") <- as.character(1:nrow(col_d))
col_d062a
n.comp.nb(col_d062a)$nc
nb_d062
n.comp.nb(nb_d062)$nc

The neighbour objects are the same, both with two components. This case is 
for a single distance band, you could use different intervals in the 
selection command for alternative bands.

>
> 2. I only have data for 48 colonies and they are clustered in space. As 
> such, I suspect I will end up with either many distance classes with 
> none or very few pairs of colonies in them or just one or two distance 
> classes with a larger number of pairs of colonies. Is there any rule of 
> thumb for how many data are required for a reasonable estimate of 
> Moran's I? Indeed, is Moran's I even appropriate in this case?

All observations ought to be included, but can form multiple graph 
components, so you most likely do not have to worry about this problem.

With regard to Moran correlograms, it could well be that including a 
couple of pairs of observations will make the estimated variance of the 
statistic very large, so it will not be significant. Note that 
correlograms also suffer from multiple comparisons, so adjustments may be 
required anyway. If only one or two bands have many pairs, why not go with 
those (or a single band and avoid adjustment)?

Hope this helps,

Roger

>
> Sorry not to include any code, but that doesn't seem appropriate to my 
> question.
>
> Kind regards,
>
> Ewan Wakefield (PhD Student)
> British Antarctic Survey
> High Cross
> Madingley Road
> Cambridge
> CB3 0ET
> UK
>
> tel. +44(0)1223 221215
> website www.antarctica.ac.uk
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sat Jun  6 19:24:24 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 6 Jun 2009 19:24:24 +0200 (CEST)
Subject: [R-sig-Geo] Spatial regression
In-Reply-To: <d8e1ff280905291127g2d4a13f6ie985782faa13f659@mail.gmail.com>
References: <d8e1ff280905291127g2d4a13f6ie985782faa13f659@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0906061913260.8949@reclus.nhh.no>

On Fri, 29 May 2009, Adrian Toti wrote:

> Hi everyone,
>
> In R, the function lm.LMtests is used to select which spatial model fits
> better the data, an error or lag one. It looks to me that there are some
> ?limitations? using this function like being constraint to use only
> row-standardized spatial weights and it does not support weighted lm object
> as argument. Also it is not helpful when both LM tests (LMerr and LMlag) are
> significant (let?s say their robust forms are not).
>
> So my question is: is there another way or approach to select between a
> spatial error and lag model?
>

As you appreciate, the two models are not nested, so an LR test is not 
appropriate, and comparing the AIC values probably not either (although a 
large difference in AIC should not be disregarded). Neither errorsarlm() 
not lagsarlm() use weights - this is only possible in spautolm(), which is 
an alternative implementation of the same model as errorsarlm(). So I'm 
not sure how you could fit a weighted lag model.

There is a paper by Kelejian in Letters in Spatial and Resource Sciences 
in 2008 on a spatial J-test, but this relies on feasible GM and spatial 
TSLS estimates, which most often also assume row standardisation and do 
not permit weights. A recent paper by Burridge and Fingleton (from a 
meeting earlier this week) discusses some alternatives:

http://sew2009.univ-fcomte.fr/english/Burridge_Fingleton.pdf

but these are too fresh to be coded and packaged yet (and are also in the 
spatial econometrics view of the world).

Hope this helps,

Roger

>
>
> Thanks for your time.
>
>
>
> Adrian
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jli at mi.fu-berlin.de  Sat Jun  6 23:26:36 2009
From: jli at mi.fu-berlin.de (Jian Li)
Date: Sat, 6 Jun 2009 23:26:36 +0200
Subject: [R-sig-Geo] how to rotate polygon after reading SHP file
Message-ID: <BLU123-W283CC72EE91B50770CD449E9490@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090606/48309e3f/attachment.pl>

From milton.ruser at gmail.com  Sun Jun  7 00:44:27 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Sat, 6 Jun 2009 18:44:27 -0400
Subject: [R-sig-Geo] how to rotate polygon after reading SHP file
In-Reply-To: <BLU123-W283CC72EE91B50770CD449E9490@phx.gbl>
References: <BLU123-W283CC72EE91B50770CD449E9490@phx.gbl>
Message-ID: <3aaf1a030906061544i735548e2j2bcd27db948950b4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090606/0b2df8af/attachment.pl>

From Roger.Bivand at nhh.no  Sun Jun  7 12:02:25 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 7 Jun 2009 12:02:25 +0200 (CEST)
Subject: [R-sig-Geo] how to rotate polygon after reading SHP file
In-Reply-To: <BLU123-W283CC72EE91B50770CD449E9490@phx.gbl>
References: <BLU123-W283CC72EE91B50770CD449E9490@phx.gbl>
Message-ID: <alpine.LRH.2.00.0906071142050.16276@reclus.nhh.no>

On Sat, 6 Jun 2009, Jian Li wrote:

>
>
> Dear Members,
>
> if I am using readShapePoly and spTransform for producing polygons, but the result polygons are not in right position.
> How can I rotate it clockwise for example like 5??
>
> natSHP.sp <- readShapePoly("nro2.shp", proj4string=CRS("+init=epsg:26978") )
> nat2.sp <- spTransform(natSHP.sp, CRS("+proj=longlat +ellps=WGS84"))
>
> Where can I get more detail information about the different options of 
> CRS("+init=????")

IIRC, epsg:26978 appeared on analysis to be the correct description for 
your e00 file (but possibly with the wrong datum). There is absolutely no 
guarantee that this description applies to other files. Knowing the 
correct description is like knowing the correct time zone for temporal 
data, or which patient which lab slide should be associated with. It is an 
absolute requirement for the correct use of spatial data when you need to 
integrate the data with other positional information, here to align with 
Google Maps.

See:

http://spatialreference.org/

http://www.asprs.org/resources/GRIDS/

for further hints. If the original second zone Gau?-Kr?ger doesn't work, 
find the correct description.

Roger

PS: hint - nro2 is centred in Eastings on 0, while your earlier nat has 
its centre on 3600000; the northings differ a lot too. It doesn't feel 
like Gau?-Kr?ger or UTM, I'm afraid. Ask the originators of the file, and 
ask why they did not provide adequate metadata, or the nro2.prj file.

>
> Best Regards,
> Jian
>
> _________________________________________________________________
> More than messages?check out the rest of the Windows Live?.
> http://www.microsoft.com/windows/windowslive/
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From j.struve at imperial.ac.uk  Mon Jun  8 15:35:29 2009
From: j.struve at imperial.ac.uk (Struve, Juliane)
Date: Mon, 8 Jun 2009 14:35:29 +0100
Subject: [R-sig-Geo] matching points to a raster - resolved
Message-ID: <5D1820C78E313F42AF9CD1C3DA84628205E7A0A4AA@ICEXM5.ic.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090608/69516bba/attachment.pl>

From adriantoti at gmail.com  Mon Jun  8 19:29:17 2009
From: adriantoti at gmail.com (Adrian Toti)
Date: Mon, 8 Jun 2009 13:29:17 -0400
Subject: [R-sig-Geo] Spatial regression
In-Reply-To: <alpine.LRH.2.00.0906061913260.8949@reclus.nhh.no>
References: <d8e1ff280905291127g2d4a13f6ie985782faa13f659@mail.gmail.com>
	<alpine.LRH.2.00.0906061913260.8949@reclus.nhh.no>
Message-ID: <d8e1ff280906081029jd20c0a0pfcc6084d52f287d8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090608/b73b4e00/attachment.pl>

From zhukov.yuri at gmail.com  Tue Jun  9 05:54:08 2009
From: zhukov.yuri at gmail.com (Yuri Zhukov)
Date: Mon, 8 Jun 2009 23:54:08 -0400
Subject: [R-sig-Geo] Join Spatial Polygons to data.frame in R?
Message-ID: <2603A54E14894922B3E56D3D45AC72E8@LENOVO803A039C>

All,

Is there a function in R similar to "Join attributes from a table" in ArcGIS
9x? I am trying to join a SpatialPolygonsDataFrame (created from an ESRI
shapefile) to a data.frame which has the same unique ID, but contains some
missing values. As a result of the missing data issues, neighbor objects
created from the SpatialPolygonsDataFrame  -- particularly contiguity
neighbors that require polygons to remain intact -- are of different length
than the number of rows in the data.frame and spatially lagged terms cannot
be created. 

The merge() command from the base package allows one to join information
from the two objects, but treats both inputs as standard data.frame objects
and produces a data.frame as the joined output. What I need is a function
that yields a SpatialPolygonsDataFrame object as the output.

Any help would be greatly appreciated.

Thank you in advance,
Yuri 

---
Yuri M. Zhukov
Ph.D. Student
Department of Government
Harvard University
zhukov at fas.harvard.edu


From Roger.Bivand at nhh.no  Tue Jun  9 09:01:03 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 9 Jun 2009 09:01:03 +0200 (CEST)
Subject: [R-sig-Geo] Join Spatial Polygons to data.frame in R?
In-Reply-To: <2603A54E14894922B3E56D3D45AC72E8@LENOVO803A039C>
References: <2603A54E14894922B3E56D3D45AC72E8@LENOVO803A039C>
Message-ID: <alpine.LRH.2.00.0906090851440.23627@reclus.nhh.no>

On Mon, 8 Jun 2009, Yuri Zhukov wrote:

> All,
>
> Is there a function in R similar to "Join attributes from a table" in ArcGIS
> 9x? I am trying to join a SpatialPolygonsDataFrame (created from an ESRI
> shapefile) to a data.frame which has the same unique ID, but contains some
> missing values. As a result of the missing data issues, neighbor objects
> created from the SpatialPolygonsDataFrame  -- particularly contiguity
> neighbors that require polygons to remain intact -- are of different length
> than the number of rows in the data.frame and spatially lagged terms cannot
> be created.

Please see the spCbind methods in maptools, ?spCbind. Note that you will 
need to insert the missing rows into the data frame first, and ensure that 
the row names of the data frame in the data slot of the spatial object are 
identical with those of the data frame being added. If this is awkward, 
consider extracting a skeleton data frame from the spatial object first, 
using merge() next, then using spCbind() finally to add it back. The chief 
reason for this being harder than just using merge() is that merge() can 
reorder rows, something that would not be helpful here.

You can look at the code of the spCbind method with:

getMethod("spCbind", c("SpatialPolygonsDataFrame", "data.frame"))

if you want to see what it is doing.

Hope this helps,

Roger

>
> The merge() command from the base package allows one to join information
> from the two objects, but treats both inputs as standard data.frame objects
> and produces a data.frame as the joined output. What I need is a function
> that yields a SpatialPolygonsDataFrame object as the output.
>
> Any help would be greatly appreciated.
>
> Thank you in advance,
> Yuri
>
> ---
> Yuri M. Zhukov
> Ph.D. Student
> Department of Government
> Harvard University
> zhukov at fas.harvard.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Jun  9 09:05:53 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 9 Jun 2009 09:05:53 +0200 (CEST)
Subject: [R-sig-Geo] Spatial regression
In-Reply-To: <d8e1ff280906081029jd20c0a0pfcc6084d52f287d8@mail.gmail.com>
References: <d8e1ff280905291127g2d4a13f6ie985782faa13f659@mail.gmail.com>
	<alpine.LRH.2.00.0906061913260.8949@reclus.nhh.no>
	<d8e1ff280906081029jd20c0a0pfcc6084d52f287d8@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0906090901310.23627@reclus.nhh.no>

On Mon, 8 Jun 2009, Adrian Toti wrote:

> Thank you Roger,
>
> In a paper (
> http://www.ssc.wisc.edu/cde/methodology/statcore/Balleretal2001.pdf) that
> uses spatial regression in homicide rates analysis (and discusses the
> difference between spatial and lag models) there is a case where over time
> there is a switch between the best model that fits the data, from a lag
> model to an error one.
>
> In this context ? a switch over time between an error to lag or vice versa ?
> using just lm.LMtests function might not be very helpful in understanding
> what is behind the change.
>
> If, as an example, there is a change in better fit from an error to a lag
> model what would be the steps to understand what caused the change.
>
> So may question is: is it comparing spatial Durbin model (lagsarlm() type =
> ?mixed?) with spatial lag model (lagsarlm()) and also comparing Durbin model
> with errorsarlm() a more structured approach?
>

Yes, doing likelihood ratio tests between the nesting spatial Durbin model 
and either of the nested spatial error (test on Common Factor) or lag 
(test on coefficients on lagged X) models should be OK. However, 
lagsarlm() does not (yet) support weights, I'm afraid.

Roger

>
>
> Thanks again.
>
>
>
> Adrian
>
>
>
>
> On Sat, Jun 6, 2009 at 1:24 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>>  On Fri, 29 May 2009, Adrian Toti wrote:
>>
>> Hi everyone,
>>>
>>> In R, the function lm.LMtests is used to select which spatial model fits
>>> better the data, an error or lag one. It looks to me that there are some
>>> ?limitations? using this function like being constraint to use only
>>> row-standardized spatial weights and it does not support weighted lm
>>> object
>>> as argument. Also it is not helpful when both LM tests (LMerr and LMlag)
>>> are
>>> significant (let?s say their robust forms are not).
>>>
>>> So my question is: is there another way or approach to select between a
>>> spatial error and lag model?
>>>
>>>
>> As you appreciate, the two models are not nested, so an LR test is not
>> appropriate, and comparing the AIC values probably not either (although a
>> large difference in AIC should not be disregarded). Neither errorsarlm() not
>> lagsarlm() use weights - this is only possible in spautolm(), which is an
>> alternative implementation of the same model as errorsarlm(). So I'm not
>> sure how you could fit a weighted lag model.
>>
>> There is a paper by Kelejian in Letters in Spatial and Resource Sciences in
>> 2008 on a spatial J-test, but this relies on feasible GM and spatial TSLS
>> estimates, which most often also assume row standardisation and do not
>> permit weights. A recent paper by Burridge and Fingleton (from a meeting
>> earlier this week) discusses some alternatives:
>>
>> http://sew2009.univ-fcomte.fr/english/Burridge_Fingleton.pdf
>>
>> but these are too fresh to be coded and packaged yet (and are also in the
>> spatial econometrics view of the world).
>>
>> Hope this helps,
>>
>> Roger
>>
>>
>>>
>>> Thanks for your time.
>>>
>>>
>>>
>>> Adrian
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Mark.Trinder at rpsgroup.com  Wed Jun 10 12:29:55 2009
From: Mark.Trinder at rpsgroup.com (Mark Trinder)
Date: Wed, 10 Jun 2009 11:29:55 +0100
Subject: [R-sig-Geo] opening .gdb files
Message-ID: <605F55D8070C094AA2E2A9CBA2767A3C04A25BBA@EXMB1.eur.rpsgroup.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090610/6c3c206e/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Jun 10 12:40:49 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 10 Jun 2009 11:40:49 +0100
Subject: [R-sig-Geo] opening .gdb files
In-Reply-To: <605F55D8070C094AA2E2A9CBA2767A3C04A25BBA@EXMB1.eur.rpsgroup.com>
References: <605F55D8070C094AA2E2A9CBA2767A3C04A25BBA@EXMB1.eur.rpsgroup.com>
Message-ID: <d8ad40b50906100340v37ab76fdub7d32091913bb092@mail.gmail.com>

On Wed, Jun 10, 2009 at 11:29 AM, Mark Trinder<Mark.Trinder at rpsgroup.com> wrote:

> Is it possible to open gdb files in R?
>
> If so what is the best package to use?
>
> I simply want to extract the location data from some gdb files, so
> nothing fancy!
>

 What's a gdb file? It could be a "GardenBoss Design" file apparently
(maybe you want to do kriging in your vegetable patch?). More likely
it's an "MapSource GPS Waypoint Database" or a "ArcView Geodatabase".

 Also, it seems that Garmin use .gdb for some of their data, but maybe
that's the same as a MapSource GPS Waypoint Database....

 A file extension is not a unique identifier of a file's type!

 Barry


From Mark.Trinder at rpsgroup.com  Wed Jun 10 12:49:26 2009
From: Mark.Trinder at rpsgroup.com (Mark Trinder)
Date: Wed, 10 Jun 2009 11:49:26 +0100
Subject: [R-sig-Geo] opening .gdb files
In-Reply-To: <f18f305fbba62c5b8620ca37d143dde3698d2daa@localhost>
References: <605F55D8070C094AA2E2A9CBA2767A3C04A25BBA@EXMB1.eur.rpsgroup.com>
	<f18f305fbba62c5b8620ca37d143dde3698d2daa@localhost>
Message-ID: <605F55D8070C094AA2E2A9CBA2767A3C04A25C46@EXMB1.eur.rpsgroup.com>

Sorry - just illustrating my ignorance of such things. I had assumed it
was a standard extension.

These are some form of GIS file ('geographic database'?), but I don't
know what program produced them. I think they can be opened in ARCGIS,
but I don't have access to that.

Mark


-----Original Message-----
From: b.rowlingson at googlemail.com [mailto:b.rowlingson at googlemail.com]
On Behalf Of Barry Rowlingson
Sent: 10 June 2009 11:41
To: Mark Trinder
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] opening .gdb files

On Wed, Jun 10, 2009 at 11:29 AM, Mark
Trinder<Mark.Trinder at rpsgroup.com> wrote:

> Is it possible to open gdb files in R?
>
> If so what is the best package to use?
>
> I simply want to extract the location data from some gdb files, so
> nothing fancy!
>

 What's a gdb file? It could be a "GardenBoss Design" file apparently
(maybe you want to do kriging in your vegetable patch?). More likely
it's an "MapSource GPS Waypoint Database" or a "ArcView Geodatabase".

 Also, it seems that Garmin use .gdb for some of their data, but maybe
that's the same as a MapSource GPS Waypoint Database....

 A file extension is not a unique identifier of a file's type!

 Barry
This e-mail message and any attached file is the property of the sender and is sent in confidence to the addressee only. The contents are not to be disclosed to anyone other than
the addressee. Unauthorised recipients are requested to preserve this confidentiality and to advise the sender immediately of any error in transmission. If you experience difficulty 
with opening any attachments to this message, or with sending a reply by email, please telephone on + 44-(0)1235 438151 or fax on + 44-(0)1235 438188. 
Any advice contained in this e-mail or any accompanying file attached hereto is for information purposes only. RPS do not take any responsibility for differences between the original 
and the transmission copy or any amendments made thereafter. If the addressee requires RPS to be responsible for the contents of this e-mail, RPS will be pleased to issue a signed 
hard copy of the document upon request.
RPS Planning and Development Limited, company number: 02947164 (England). Registered office: Centurion Court, 85 Milton Park Abingdon Oxfordshire OX14 4RY.
RPS Group Plc web link: <http://www.rpsgroup.com>


From b.rowlingson at lancaster.ac.uk  Wed Jun 10 13:02:59 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 10 Jun 2009 12:02:59 +0100
Subject: [R-sig-Geo] opening .gdb files
In-Reply-To: <605F55D8070C094AA2E2A9CBA2767A3C04A25C46@EXMB1.eur.rpsgroup.com>
References: <605F55D8070C094AA2E2A9CBA2767A3C04A25BBA@EXMB1.eur.rpsgroup.com>
	<f18f305fbba62c5b8620ca37d143dde3698d2daa@localhost>
	<605F55D8070C094AA2E2A9CBA2767A3C04A25C46@EXMB1.eur.rpsgroup.com>
Message-ID: <d8ad40b50906100402i2fad4e8v662201a09084246d@mail.gmail.com>

On Wed, Jun 10, 2009 at 11:49 AM, Mark Trinder<Mark.Trinder at rpsgroup.com> wrote:
> Sorry - just illustrating my ignorance of such things. I had assumed it
> was a standard extension.
>
> These are some form of GIS file ('geographic database'?), but I don't
> know what program produced them. I think they can be opened in ARCGIS,
> but I don't have access to that.

 I suspect 'gdb' to most people here means 'GNU debugger' :)

 The easiest thing is to get back to the source and ask for it in a
format you can deal with - shapefile for vectors, geoTIFF for rasters.

 It's also possibly possible to read it with OGR:

 http://www.gdal.org/ogr/drv_pgeo.html

 If it really is just an MS Access database with some extra tables,
try loading into Access if you have that. You might want to rename it
'.mdb' first though. OpenOffice might even read it in.

 Some stuff on the ESRI web site talks about XML versions of
geodatabases. If what you've got is an XML file (open in a text
editor, should be full of <tag>this</tag> and <tag>that</tag>, then
you might be able to get your coordinates out with a bit of editing...

Barry


From mdsumner at utas.edu.au  Wed Jun 10 13:14:06 2009
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Wed, 10 Jun 2009 21:14:06 +1000
Subject: [R-sig-Geo] opening .gdb files
Message-ID: <200906101114.n5ABE6wP019875@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090610/d80a5ae0/attachment.pl>

From Hurlbert at bio.unc.edu  Wed Jun 10 15:18:24 2009
From: Hurlbert at bio.unc.edu (Hurlbert, Allen H. (Biology))
Date: Wed, 10 Jun 2009 09:18:24 -0400
Subject: [R-sig-Geo] error in readShapePoly
Message-ID: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4477@email.bio.unc.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090610/1a497eee/attachment.pl>

From Roger.Bivand at nhh.no  Wed Jun 10 15:37:47 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Jun 2009 15:37:47 +0200 (CEST)
Subject: [R-sig-Geo] error in readShapePoly
In-Reply-To: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4477@email.bio.unc.edu>
References: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4477@email.bio.unc.edu>
Message-ID: <alpine.LRH.2.00.0906101529000.27720@reclus.nhh.no>

On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:

> Hello list,
>
>
>
> I'm new to GIS in R, so I appreciate any pointers with my problem.
>
>
>
> I have code that uses readShapePoly to read in shapefiles in a loop and
> does some basic operations. This code appeared to be working great for
> twenty or so files, but then on one shapefile bonked with the following
> error:   Error in from[j]:to[j] : NA/NaN argument.
>
>
>
> The problem shapefile opens fine in ArcGIS and there is nothing readily
> different about its attribute table or source information that I can see
> (and furthermore, all shapefiles are from the same standardized source,
> although of course that doesn't mean one of them didn't get messed up
> somewhere along the way). I am running 2.7.2 on Windows XP x64.
>

Could you 1) try readOGR() in rgdal instead of readShapePoly() in maptools 
if possible, and see if the problem is repeated; 2) post either the output 
of traceback() run immediately after the error occurs (will show where, 
more or less, the problem is in code) here and/or the shapefile(s) all 3-4 
files in a zip archive on a website and post the URL here so that others 
can debug this? The problem seems to be a shot Pstart vector putting an 
invalid value into the range from which to extract ring coordinates, but 
the question is why it is shot.

If you can say something about the origin of the file, this may also help 
(what software wrote it), some have broken *.shx files.

Roger

>
>
> Thanks in advance,
>
> Allen
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From T.Hengl at uva.nl  Wed Jun 10 16:40:59 2009
From: T.Hengl at uva.nl (Hengl, T.)
Date: Wed, 10 Jun 2009 16:40:59 +0200
Subject: [R-sig-Geo] Problems with loading the "mgcv" package
Message-ID: <37382E8DCB905042969BA78541F65706754316@kwek.ic.uva.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090610/0a8c1aec/attachment.pl>

From Hurlbert at bio.unc.edu  Wed Jun 10 16:49:25 2009
From: Hurlbert at bio.unc.edu (Hurlbert, Allen H. (Biology))
Date: Wed, 10 Jun 2009 10:49:25 -0400
Subject: [R-sig-Geo] error in readShapePoly
In-Reply-To: <alpine.LRH.2.00.0906101609280.27720@reclus.nhh.no>
References: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4477@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101529000.27720@reclus.nhh.no>
	<5805338EEBC6DB4AB6F96B9693F2ABDB05ED4498@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101609280.27720@reclus.nhh.no>
Message-ID: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED44BE@email.bio.unc.edu>

Thanks Roger!

Are there any instances in which one would want delete_null_obj=FALSE?

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Wednesday, June 10, 2009 10:36 AM
To: Hurlbert, Allen H. (Biology)
Subject: RE: [R-sig-Geo] error in readShapePoly

On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:

> Hi Roger,
>
> Here is the result of the traceback():
>
> 4: .shp2srsI(shapes[[belongs[[i]][j]]],
> .nParts.shpI(shapes[[belongs[[i]][j]]]),
>       force_ring = force_ring)
> 3: .asSpatialPolygonsShapes(Map$Shapes, IDs, proj4string =
proj4string,
>       force_ring = force_ring)
> 2: .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring
=
> force_ring,
>       delete_null_obj = delete_null_obj, retrieve_ABS_null =
> retrieve_ABS_null)
> 1:
>
readShapePoly(paste("\\\\Bioark.bio.unc.edu\\hurlbertallen\\GIS\\BirdRan
> geMaps\\NatureServe3.0\\",
>       as.character(families[f]), "\\", as.character(spp.list[s2,
>           1]), sep = ""), proj4string = CRS("+proj=latlong
> +datum=NAD83"))
>
> The shapefiles are bird range maps available online from NatureServe
> here: http://www.natureserve.org/getData/birdMaps.jsp. The problem
file
> is trin_inca_pl.shp which is included in the zipped 'Scolopacidae'
file
> on that page.
>
> Unfortunately, I am unfamiliar with the syntax of readOGR() and can't
> quite figure out how I'm supposed to use it to read in a shapefile.

It is a bit more revealing:

> trin_inca_pl <- readOGR("Scolopacidae", "trin_inca_pl")
Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = 
input_field_name_encoding) :
   NULL geometry found

and suggests using the fix in:

> trin_inca_pl <- readShapePoly("Scolopacidae/trin_inca_pl.shp", 
+  delete_null_obj=TRUE)
Warning message:
In .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring =

force_ring,  :
   Null objects with the following indices deleted: 134

So the data provider has inserted a NULL geometry into the data - they 
shouldn't do it, but it has been seen before. Could you summarise to the

list, please? I'll see if I can add a test in readShapePoly to point
users 
to the optional argument.

Roger

>
> Thanks!
> Allen
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Wednesday, June 10, 2009 9:38 AM
> To: Hurlbert, Allen H. (Biology)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] error in readShapePoly
>
> On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:
>
>> Hello list,
>>
>>
>>
>> I'm new to GIS in R, so I appreciate any pointers with my problem.
>>
>>
>>
>> I have code that uses readShapePoly to read in shapefiles in a loop
> and
>> does some basic operations. This code appeared to be working great
for
>> twenty or so files, but then on one shapefile bonked with the
> following
>> error:   Error in from[j]:to[j] : NA/NaN argument.
>>
>>
>>
>> The problem shapefile opens fine in ArcGIS and there is nothing
> readily
>> different about its attribute table or source information that I can
> see
>> (and furthermore, all shapefiles are from the same standardized
> source,
>> although of course that doesn't mean one of them didn't get messed up
>> somewhere along the way). I am running 2.7.2 on Windows XP x64.
>>
>
> Could you 1) try readOGR() in rgdal instead of readShapePoly() in
> maptools
> if possible, and see if the problem is repeated; 2) post either the
> output
> of traceback() run immediately after the error occurs (will show
where,
> more or less, the problem is in code) here and/or the shapefile(s) all
> 3-4
> files in a zip archive on a website and post the URL here so that
others
>
> can debug this? The problem seems to be a shot Pstart vector putting
an
> invalid value into the range from which to extract ring coordinates,
but
>
> the question is why it is shot.
>
> If you can say something about the origin of the file, this may also
> help
> (what software wrote it), some have broken *.shx files.
>
> Roger
>
>>
>>
>> Thanks in advance,
>>
>> Allen
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Wed Jun 10 18:43:34 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Jun 2009 18:43:34 +0200 (CEST)
Subject: [R-sig-Geo] error in readShapePoly
In-Reply-To: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED44BE@email.bio.unc.edu>
References: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4477@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101529000.27720@reclus.nhh.no>
	<5805338EEBC6DB4AB6F96B9693F2ABDB05ED4498@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101609280.27720@reclus.nhh.no>
	<5805338EEBC6DB4AB6F96B9693F2ABDB05ED44BE@email.bio.unc.edu>
Message-ID: <alpine.LRH.2.00.0906101836150.27720@reclus.nhh.no>

On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:

> Thanks Roger!
>
> Are there any instances in which one would want delete_null_obj=FALSE?

Well, they shouldn't be there, really. When I release maptools, with 
default delete_null_obj=FALSE, it will report which one, and then:

library(foreign)
tip <- read.dbf("trin_inca_pl.dbf")
tip[134,]

would show the contents of the DBF for the offending NULL geometry. 
Setting it to TRUE by default wouldn't warn the user that there was 
anything untoward. In this case, the file originator might want to know 
that a geometry has gone away, perhaps. In an earlier case, Statistics 
Australia was squirrelling data with no spatial position away in a NULL 
geometry, which is OK for the DBF, but not OK if the files are (as they 
are) intended to contain geometries with attributes.

Roger

>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Wednesday, June 10, 2009 10:36 AM
> To: Hurlbert, Allen H. (Biology)
> Subject: RE: [R-sig-Geo] error in readShapePoly
>
> On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:
>
>> Hi Roger,
>>
>> Here is the result of the traceback():
>>
>> 4: .shp2srsI(shapes[[belongs[[i]][j]]],
>> .nParts.shpI(shapes[[belongs[[i]][j]]]),
>>       force_ring = force_ring)
>> 3: .asSpatialPolygonsShapes(Map$Shapes, IDs, proj4string =
> proj4string,
>>       force_ring = force_ring)
>> 2: .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring
> =
>> force_ring,
>>       delete_null_obj = delete_null_obj, retrieve_ABS_null =
>> retrieve_ABS_null)
>> 1:
>>
> readShapePoly(paste("\\\\Bioark.bio.unc.edu\\hurlbertallen\\GIS\\BirdRan
>> geMaps\\NatureServe3.0\\",
>>       as.character(families[f]), "\\", as.character(spp.list[s2,
>>           1]), sep = ""), proj4string = CRS("+proj=latlong
>> +datum=NAD83"))
>>
>> The shapefiles are bird range maps available online from NatureServe
>> here: http://www.natureserve.org/getData/birdMaps.jsp. The problem
> file
>> is trin_inca_pl.shp which is included in the zipped 'Scolopacidae'
> file
>> on that page.
>>
>> Unfortunately, I am unfamiliar with the syntax of readOGR() and can't
>> quite figure out how I'm supposed to use it to read in a shapefile.
>
> It is a bit more revealing:
>
>> trin_inca_pl <- readOGR("Scolopacidae", "trin_inca_pl")
> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding) :
>   NULL geometry found
>
> and suggests using the fix in:
>
>> trin_inca_pl <- readShapePoly("Scolopacidae/trin_inca_pl.shp",
> +  delete_null_obj=TRUE)
> Warning message:
> In .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring =
>
> force_ring,  :
>   Null objects with the following indices deleted: 134
>
> So the data provider has inserted a NULL geometry into the data - they
> shouldn't do it, but it has been seen before. Could you summarise to the
>
> list, please? I'll see if I can add a test in readShapePoly to point
> users
> to the optional argument.
>
> Roger
>
>>
>> Thanks!
>> Allen
>>
>> -----Original Message-----
>> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>> Sent: Wednesday, June 10, 2009 9:38 AM
>> To: Hurlbert, Allen H. (Biology)
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] error in readShapePoly
>>
>> On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:
>>
>>> Hello list,
>>>
>>>
>>>
>>> I'm new to GIS in R, so I appreciate any pointers with my problem.
>>>
>>>
>>>
>>> I have code that uses readShapePoly to read in shapefiles in a loop
>> and
>>> does some basic operations. This code appeared to be working great
> for
>>> twenty or so files, but then on one shapefile bonked with the
>> following
>>> error:   Error in from[j]:to[j] : NA/NaN argument.
>>>
>>>
>>>
>>> The problem shapefile opens fine in ArcGIS and there is nothing
>> readily
>>> different about its attribute table or source information that I can
>> see
>>> (and furthermore, all shapefiles are from the same standardized
>> source,
>>> although of course that doesn't mean one of them didn't get messed up
>>> somewhere along the way). I am running 2.7.2 on Windows XP x64.
>>>
>>
>> Could you 1) try readOGR() in rgdal instead of readShapePoly() in
>> maptools
>> if possible, and see if the problem is repeated; 2) post either the
>> output
>> of traceback() run immediately after the error occurs (will show
> where,
>> more or less, the problem is in code) here and/or the shapefile(s) all
>> 3-4
>> files in a zip archive on a website and post the URL here so that
> others
>>
>> can debug this? The problem seems to be a shot Pstart vector putting
> an
>> invalid value into the range from which to extract ring coordinates,
> but
>>
>> the question is why it is shot.
>>
>> If you can say something about the origin of the file, this may also
>> help
>> (what software wrote it), some have broken *.shx files.
>>
>> Roger
>>
>>>
>>>
>>> Thanks in advance,
>>>
>>> Allen
>>>
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From marcelino.delacruz at upm.es  Wed Jun 10 19:14:25 2009
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Wed, 10 Jun 2009 19:14:25 +0200
Subject: [R-sig-Geo] Problems with loading the "mgcv" package
In-Reply-To: <37382E8DCB905042969BA78541F65706754316@kwek.ic.uva.nl>
References: <37382E8DCB905042969BA78541F65706754316@kwek.ic.uva.nl>
Message-ID: <200906101714.n5AHEKIq017329@edison.ccupm.upm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090610/ff7fec6e/attachment.pl>

From debeaudette at ucdavis.edu  Wed Jun 10 19:39:56 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Wed, 10 Jun 2009 10:39:56 -0700
Subject: [R-sig-Geo] Problems with loading the "mgcv" package
In-Reply-To: <200906101714.n5AHEKIq017329@edison.ccupm.upm.es>
References: <37382E8DCB905042969BA78541F65706754316@kwek.ic.uva.nl>
	<200906101714.n5AHEKIq017329@edison.ccupm.upm.es>
Message-ID: <200906101039.56315.dylan.beaudette@gmail.com>

works for me:

library(spatstat)
sessionInfo()

Loading required package: mgcv
This is mgcv  1.5-5 . For overview type `help("mgcv-package")'.
Loading required package: gpclib
General Polygon Clipper Library for R (version 1.4-4)
        Type 'class ? gpc.poly' for help

Loading required package: deldir
deldir 0.0-8 

spatstat 1.15-3 


R version 2.9.0 (2009-04-17) 
i686-pc-linux-gnu 

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=e                   
n_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-4    mgcv_1.5-5     

loaded via a namespace (and not attached):
[1] grid_2.9.0      lattice_0.17-25 nlme_3.1-92 

On Wednesday 10 June 2009, Marcelino de la Cruz wrote:
> Hi Tom,
>
> I can load sptastat and mgcv without problem (see below).
>
> Could you please send us information about your environment?
>
>
> Cheers,
>
> Marcelino
>
>  > library(spatstat)
>
> Loading required package: mgcv
> This is mgcv  1.5-5 . For overview type `help("mgcv-package")'.
> Loading required package: gpclib
> General Polygon Clipper Library for R (version 1.4-3)
>          Type 'class ? gpc.poly' for help
> Loading required package: deldir
> deldir 0.0-8
>
> spatstat 1.15-3
> Type 'help(spatstat)' for information
>
>  > sessionInfo()
>
> R version 2.9.0 (2009-04-17)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spani
>sh_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-3    mgcv_1.5-5
>
> loaded via a namespace (and not attached):
> [1] grid_2.9.0      lattice_0.17-22 nlme_3.1-90     tools_2.9.0
>
> At 16:40 10/06/2009, Hengl, T. wrote:
> >Hi,
> >
> >I am having problems with loading the mgcv package, which is used by
> >the spatstat package. I did not have similar problems with the
> >latest version of the spatstat, so I imagine that the problem could
> >lay with the mgcv package (new parameters).
> >
> > > library(spatstat)
> >
> >Loading required package: mgcv
> >Error in formatDL(nm, txt, indent = max(nchar(nm, "w")) + 3) :
> >   incorrect values of 'indent' and 'width'
> >Error : .onAttach failed in 'attachNamespace'
> >Error: package 'mgcv' could not be loaded
> >
> >How could we fix this?
> >
> >
> >thanks,
> >
> >T. Hengl
> >http://home.medewerker.uva.nl/t.hengl/
> >
> >         [[alternative HTML version deleted]]
> >
> >_______________________________________________
> >R-sig-Geo mailing list
> >R-sig-Geo at stat.math.ethz.ch
> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> ***************************************
> Marcelino de la Cruz Rot
> Depto. Biologia Vegetal
> EUIT Agricola
> Universidad Politecnica de Madrid
> 28040-Madrid
> SPAIN
> ***************************************
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From Hurlbert at bio.unc.edu  Wed Jun 10 20:02:06 2009
From: Hurlbert at bio.unc.edu (Hurlbert, Allen H. (Biology))
Date: Wed, 10 Jun 2009 14:02:06 -0400
Subject: [R-sig-Geo] error in readShapePoly
In-Reply-To: <alpine.LRH.2.00.0906101836150.27720@reclus.nhh.no>
References: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4477@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101529000.27720@reclus.nhh.no>
	<5805338EEBC6DB4AB6F96B9693F2ABDB05ED4498@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101609280.27720@reclus.nhh.no>
	<5805338EEBC6DB4AB6F96B9693F2ABDB05ED44BE@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101836150.27720@reclus.nhh.no>
Message-ID: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4543@email.bio.unc.edu>

Is there an equivalent argument in readOGR() to read in a shapefile with
a NULL geometry, or can this only be done with readShapePoly?

Thanks,
Allen

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Wednesday, June 10, 2009 12:44 PM
To: Hurlbert, Allen H. (Biology)
Cc: r-sig-geo at stat.math.ethz.ch
Subject: RE: [R-sig-Geo] error in readShapePoly

On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:

> Thanks Roger!
>
> Are there any instances in which one would want delete_null_obj=FALSE?

Well, they shouldn't be there, really. When I release maptools, with 
default delete_null_obj=FALSE, it will report which one, and then:

library(foreign)
tip <- read.dbf("trin_inca_pl.dbf")
tip[134,]

would show the contents of the DBF for the offending NULL geometry. 
Setting it to TRUE by default wouldn't warn the user that there was 
anything untoward. In this case, the file originator might want to know 
that a geometry has gone away, perhaps. In an earlier case, Statistics 
Australia was squirrelling data with no spatial position away in a NULL 
geometry, which is OK for the DBF, but not OK if the files are (as they 
are) intended to contain geometries with attributes.

Roger

>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Wednesday, June 10, 2009 10:36 AM
> To: Hurlbert, Allen H. (Biology)
> Subject: RE: [R-sig-Geo] error in readShapePoly
>
> On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:
>
>> Hi Roger,
>>
>> Here is the result of the traceback():
>>
>> 4: .shp2srsI(shapes[[belongs[[i]][j]]],
>> .nParts.shpI(shapes[[belongs[[i]][j]]]),
>>       force_ring = force_ring)
>> 3: .asSpatialPolygonsShapes(Map$Shapes, IDs, proj4string =
> proj4string,
>>       force_ring = force_ring)
>> 2: .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string,
force_ring
> =
>> force_ring,
>>       delete_null_obj = delete_null_obj, retrieve_ABS_null =
>> retrieve_ABS_null)
>> 1:
>>
>
readShapePoly(paste("\\\\Bioark.bio.unc.edu\\hurlbertallen\\GIS\\BirdRan
>> geMaps\\NatureServe3.0\\",
>>       as.character(families[f]), "\\", as.character(spp.list[s2,
>>           1]), sep = ""), proj4string = CRS("+proj=latlong
>> +datum=NAD83"))
>>
>> The shapefiles are bird range maps available online from NatureServe
>> here: http://www.natureserve.org/getData/birdMaps.jsp. The problem
> file
>> is trin_inca_pl.shp which is included in the zipped 'Scolopacidae'
> file
>> on that page.
>>
>> Unfortunately, I am unfamiliar with the syntax of readOGR() and can't
>> quite figure out how I'm supposed to use it to read in a shapefile.
>
> It is a bit more revealing:
>
>> trin_inca_pl <- readOGR("Scolopacidae", "trin_inca_pl")
> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding) :
>   NULL geometry found
>
> and suggests using the fix in:
>
>> trin_inca_pl <- readShapePoly("Scolopacidae/trin_inca_pl.shp",
> +  delete_null_obj=TRUE)
> Warning message:
> In .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring
=
>
> force_ring,  :
>   Null objects with the following indices deleted: 134
>
> So the data provider has inserted a NULL geometry into the data - they
> shouldn't do it, but it has been seen before. Could you summarise to
the
>
> list, please? I'll see if I can add a test in readShapePoly to point
> users
> to the optional argument.
>
> Roger
>
>>
>> Thanks!
>> Allen
>>
>> -----Original Message-----
>> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>> Sent: Wednesday, June 10, 2009 9:38 AM
>> To: Hurlbert, Allen H. (Biology)
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] error in readShapePoly
>>
>> On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:
>>
>>> Hello list,
>>>
>>>
>>>
>>> I'm new to GIS in R, so I appreciate any pointers with my problem.
>>>
>>>
>>>
>>> I have code that uses readShapePoly to read in shapefiles in a loop
>> and
>>> does some basic operations. This code appeared to be working great
> for
>>> twenty or so files, but then on one shapefile bonked with the
>> following
>>> error:   Error in from[j]:to[j] : NA/NaN argument.
>>>
>>>
>>>
>>> The problem shapefile opens fine in ArcGIS and there is nothing
>> readily
>>> different about its attribute table or source information that I can
>> see
>>> (and furthermore, all shapefiles are from the same standardized
>> source,
>>> although of course that doesn't mean one of them didn't get messed
up
>>> somewhere along the way). I am running 2.7.2 on Windows XP x64.
>>>
>>
>> Could you 1) try readOGR() in rgdal instead of readShapePoly() in
>> maptools
>> if possible, and see if the problem is repeated; 2) post either the
>> output
>> of traceback() run immediately after the error occurs (will show
> where,
>> more or less, the problem is in code) here and/or the shapefile(s)
all
>> 3-4
>> files in a zip archive on a website and post the URL here so that
> others
>>
>> can debug this? The problem seems to be a shot Pstart vector putting
> an
>> invalid value into the range from which to extract ring coordinates,
> but
>>
>> the question is why it is shot.
>>
>> If you can say something about the origin of the file, this may also
>> help
>> (what software wrote it), some have broken *.shx files.
>>
>> Roger
>>
>>>
>>>
>>> Thanks in advance,
>>>
>>> Allen
>>>
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Wed Jun 10 20:18:40 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Jun 2009 20:18:40 +0200 (CEST)
Subject: [R-sig-Geo] error in readShapePoly
In-Reply-To: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4543@email.bio.unc.edu>
References: <5805338EEBC6DB4AB6F96B9693F2ABDB05ED4477@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101529000.27720@reclus.nhh.no>
	<5805338EEBC6DB4AB6F96B9693F2ABDB05ED4498@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101609280.27720@reclus.nhh.no>
	<5805338EEBC6DB4AB6F96B9693F2ABDB05ED44BE@email.bio.unc.edu>
	<alpine.LRH.2.00.0906101836150.27720@reclus.nhh.no>
	<5805338EEBC6DB4AB6F96B9693F2ABDB05ED4543@email.bio.unc.edu>
Message-ID: <alpine.LRH.2.00.0906102012460.27720@reclus.nhh.no>

On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:

> Is there an equivalent argument in readOGR() to read in a shapefile with
> a NULL geometry, or can this only be done with readShapePoly?

No, readOGR() uses drivers for multiple vector formats, and as it is now 
written, it stops when a NULL geometry is found. This isn't likely to 
change very soon, but will go on the TODO list.

Roger

>
> Thanks,
> Allen
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Wednesday, June 10, 2009 12:44 PM
> To: Hurlbert, Allen H. (Biology)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: RE: [R-sig-Geo] error in readShapePoly
>
> On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:
>
>> Thanks Roger!
>>
>> Are there any instances in which one would want delete_null_obj=FALSE?
>
> Well, they shouldn't be there, really. When I release maptools, with
> default delete_null_obj=FALSE, it will report which one, and then:
>
> library(foreign)
> tip <- read.dbf("trin_inca_pl.dbf")
> tip[134,]
>
> would show the contents of the DBF for the offending NULL geometry.
> Setting it to TRUE by default wouldn't warn the user that there was
> anything untoward. In this case, the file originator might want to know
> that a geometry has gone away, perhaps. In an earlier case, Statistics
> Australia was squirrelling data with no spatial position away in a NULL
> geometry, which is OK for the DBF, but not OK if the files are (as they
> are) intended to contain geometries with attributes.
>
> Roger
>
>>
>> -----Original Message-----
>> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>> Sent: Wednesday, June 10, 2009 10:36 AM
>> To: Hurlbert, Allen H. (Biology)
>> Subject: RE: [R-sig-Geo] error in readShapePoly
>>
>> On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:
>>
>>> Hi Roger,
>>>
>>> Here is the result of the traceback():
>>>
>>> 4: .shp2srsI(shapes[[belongs[[i]][j]]],
>>> .nParts.shpI(shapes[[belongs[[i]][j]]]),
>>>       force_ring = force_ring)
>>> 3: .asSpatialPolygonsShapes(Map$Shapes, IDs, proj4string =
>> proj4string,
>>>       force_ring = force_ring)
>>> 2: .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string,
> force_ring
>> =
>>> force_ring,
>>>       delete_null_obj = delete_null_obj, retrieve_ABS_null =
>>> retrieve_ABS_null)
>>> 1:
>>>
>>
> readShapePoly(paste("\\\\Bioark.bio.unc.edu\\hurlbertallen\\GIS\\BirdRan
>>> geMaps\\NatureServe3.0\\",
>>>       as.character(families[f]), "\\", as.character(spp.list[s2,
>>>           1]), sep = ""), proj4string = CRS("+proj=latlong
>>> +datum=NAD83"))
>>>
>>> The shapefiles are bird range maps available online from NatureServe
>>> here: http://www.natureserve.org/getData/birdMaps.jsp. The problem
>> file
>>> is trin_inca_pl.shp which is included in the zipped 'Scolopacidae'
>> file
>>> on that page.
>>>
>>> Unfortunately, I am unfamiliar with the syntax of readOGR() and can't
>>> quite figure out how I'm supposed to use it to read in a shapefile.
>>
>> It is a bit more revealing:
>>
>>> trin_inca_pl <- readOGR("Scolopacidae", "trin_inca_pl")
>> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
>> input_field_name_encoding) :
>>   NULL geometry found
>>
>> and suggests using the fix in:
>>
>>> trin_inca_pl <- readShapePoly("Scolopacidae/trin_inca_pl.shp",
>> +  delete_null_obj=TRUE)
>> Warning message:
>> In .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring
> =
>>
>> force_ring,  :
>>   Null objects with the following indices deleted: 134
>>
>> So the data provider has inserted a NULL geometry into the data - they
>> shouldn't do it, but it has been seen before. Could you summarise to
> the
>>
>> list, please? I'll see if I can add a test in readShapePoly to point
>> users
>> to the optional argument.
>>
>> Roger
>>
>>>
>>> Thanks!
>>> Allen
>>>
>>> -----Original Message-----
>>> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
>>> Sent: Wednesday, June 10, 2009 9:38 AM
>>> To: Hurlbert, Allen H. (Biology)
>>> Cc: r-sig-geo at stat.math.ethz.ch
>>> Subject: Re: [R-sig-Geo] error in readShapePoly
>>>
>>> On Wed, 10 Jun 2009, Hurlbert, Allen H. (Biology) wrote:
>>>
>>>> Hello list,
>>>>
>>>>
>>>>
>>>> I'm new to GIS in R, so I appreciate any pointers with my problem.
>>>>
>>>>
>>>>
>>>> I have code that uses readShapePoly to read in shapefiles in a loop
>>> and
>>>> does some basic operations. This code appeared to be working great
>> for
>>>> twenty or so files, but then on one shapefile bonked with the
>>> following
>>>> error:   Error in from[j]:to[j] : NA/NaN argument.
>>>>
>>>>
>>>>
>>>> The problem shapefile opens fine in ArcGIS and there is nothing
>>> readily
>>>> different about its attribute table or source information that I can
>>> see
>>>> (and furthermore, all shapefiles are from the same standardized
>>> source,
>>>> although of course that doesn't mean one of them didn't get messed
> up
>>>> somewhere along the way). I am running 2.7.2 on Windows XP x64.
>>>>
>>>
>>> Could you 1) try readOGR() in rgdal instead of readShapePoly() in
>>> maptools
>>> if possible, and see if the problem is repeated; 2) post either the
>>> output
>>> of traceback() run immediately after the error occurs (will show
>> where,
>>> more or less, the problem is in code) here and/or the shapefile(s)
> all
>>> 3-4
>>> files in a zip archive on a website and post the URL here so that
>> others
>>>
>>> can debug this? The problem seems to be a shot Pstart vector putting
>> an
>>> invalid value into the range from which to extract ring coordinates,
>> but
>>>
>>> the question is why it is shot.
>>>
>>> If you can say something about the origin of the file, this may also
>>> help
>>> (what software wrote it), some have broken *.shx files.
>>>
>>> Roger
>>>
>>>>
>>>>
>>>> Thanks in advance,
>>>>
>>>> Allen
>>>>
>>>>
>>>> 	[[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Hollister.Jeff at epamail.epa.gov  Wed Jun 10 21:27:19 2009
From: Hollister.Jeff at epamail.epa.gov (Hollister.Jeff at epamail.epa.gov)
Date: Wed, 10 Jun 2009 15:27:19 -0400
Subject: [R-sig-Geo] Interpolation or TIN with break lines/barriers
Message-ID: <OF1979B93E.9F7EF488-ON852575D1.0069E44F-852575D1.006ACCFD@epamail.epa.gov>


All,

I am attempting to try various methods for calculating lake volume from
a bathymetry survey of a lake (x, y, and depth).

As a long time ESRI user who is now trying to cut the cord, I would
normally do this with, IDW with barriers, a TIN with masspoints (depth
soundings) and a hardline (lake shoreline), etc.

Is there currently an R analog for this?

Thanks,
Jeff

***************************
Dr. Jeffrey W. Hollister
US EPA
Atlantic Ecology Division
27 Tarzwell Drive
Narragansett, RI 02882
(401) 782-9655


From debeaudette at ucdavis.edu  Wed Jun 10 22:08:13 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Wed, 10 Jun 2009 13:08:13 -0700
Subject: [R-sig-Geo] Interpolation or TIN with break lines/barriers
In-Reply-To: <OF1979B93E.9F7EF488-ON852575D1.0069E44F-852575D1.006ACCFD@epamail.epa.gov>
References: <OF1979B93E.9F7EF488-ON852575D1.0069E44F-852575D1.006ACCFD@epamail.epa.gov>
Message-ID: <200906101308.13815.dylan.beaudette@gmail.com>

On Wednesday 10 June 2009, Hollister.Jeff at epamail.epa.gov wrote:
> All,
>
> I am attempting to try various methods for calculating lake volume from
> a bathymetry survey of a lake (x, y, and depth).
>
> As a long time ESRI user who is now trying to cut the cord, I would
> normally do this with, IDW with barriers, a TIN with masspoints (depth
> soundings) and a hardline (lake shoreline), etc.
>
> Is there currently an R analog for this?
>
> Thanks,
> Jeff

Not sure about R, but the r.lake module in GRASS may be of interest.

Cheers,
Dylan


>
> ***************************
> Dr. Jeffrey W. Hollister
> US EPA
> Atlantic Ecology Division
> 27 Tarzwell Drive
> Narragansett, RI 02882
> (401) 782-9655
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From meutges at ege.fcen.uba.ar  Wed Jun 10 22:21:23 2009
From: meutges at ege.fcen.uba.ar (=?iso-8859-1?Q?Mar=EDa_Eugenia_Utg=E9s?=)
Date: Wed, 10 Jun 2009 17:21:23 -0300 (ART)
Subject: [R-sig-Geo] Presentation and a "few" Questions (geoR)
In-Reply-To: <mailman.31197.1244660346.4467.r-sig-geo@stat.math.ethz.ch>
References: <mailman.31197.1244660346.4467.r-sig-geo@stat.math.ethz.ch>
Message-ID: <eed5c6a9282b5fa5a8e96f86f9e3db82.squirrel@webmail.ege.fcen.uba.ar>

 Hello Everyone
I am making my doctorate in biology at the University of Buenos Aires,
Argentina.
I am working on survival and dispersal of the south american fruit fly
(Diptera: Tephritidae), a fruit pest mainly of citrics.
To do so I have field dispersal data (with its x,y coordinates) and have
already perform some spatial analysis with geoR.
My specific questions are:
1- Data must show normality?  What to do if even transformed data does not
adjust?
2- How do I interpret the cross-validation results?
3- How do I know if I need to take into account anisotropy?
4- When to end the iteration of likfit? till stable values of estimated
parameters?
5- Is it recommended to present the image of the kriging AND the one
representing variances? how do I generate the latter?
6- Do the kriging image values have a unit, or are they arbitrary?
7- Finally, if you had to present the results (in a paper for example)
what results/data/graphics would you choose?

Hoping to recieve lots(!) of answers,
Mar?a Eugenia



Lic. Mar?a Eugenia Utg?s
Bi?loga
Lab. Gen?tica de Poblaciones Aplicada (GPA), Pab. 2, 4to piso, Lab. 105,
Depto. Ecolog?a, Gen?tica y Evoluci?n (EGE)
Fac. Cs. Exactas y Naturales (FCEyN)
Universidad de Buenos Aires (UBA)
Ciudad Universitaria,
Buenos Aires, Argentina

Tel.: 4576-3300, int 218


From karlafalk at trentu.ca  Thu Jun 11 01:56:41 2009
From: karlafalk at trentu.ca (Karla  Falk)
Date: Wed, 10 Jun 2009 19:56:41 -0400
Subject: [R-sig-Geo] convert point data to count data
Message-ID: <1244678201.ad3feabckarlafalk@trentu.ca>


Hi,

  I have a data set of points that I would like to convert to grid cell counts.  Ultimately I would like to end up with a table that has an x-y coordinate for each grid cell, and the count of the # of points falling in each grid cell.  Does anyone know a way to do this in R?  I have been playing around with using quadratcounts in spatstat, and the overlay methods in sp, but with both I can't figure out how to get an output table of the cell counts (including counts of zero's) with the corresponding x-y utm of the grid cell.  Any help would be greatly appreciated!

Thanks,
Karla


From basille at biomserv.univ-lyon1.fr  Thu Jun 11 08:11:33 2009
From: basille at biomserv.univ-lyon1.fr (Mathieu Basille)
Date: Thu, 11 Jun 2009 08:11:33 +0200
Subject: [R-sig-Geo] convert point data to count data
In-Reply-To: <1244678201.ad3feabckarlafalk@trentu.ca>
References: <1244678201.ad3feabckarlafalk@trentu.ca>
Message-ID: <4A30A015.7030200@biomserv.univ-lyon1.fr>

Hi Karla,

Appart from spatstat/sp, you might give a try to adehabitat: there's a 
function called 'ascgen' which does exactly what you want: create a grid 
of a given resolution according to the points you have, with the number 
of points in each cell. Check ?ascgen (and especially the example) for 
further details. There are eventually functions to convert maps from 
adehabitat to sp if needed.

Hope this helps,
Mathieu.


Karla Falk a ?crit :
> Hi,
> 
>   I have a data set of points that I would like to convert to grid cell counts.  Ultimately I would like to end up with a table that has an x-y coordinate for each grid cell, and the count of the # of points falling in each grid cell.  Does anyone know a way to do this in R?  I have been playing around with using quadratcounts in spatstat, and the overlay methods in sp, but with both I can't figure out how to get an output table of the cell counts (including counts of zero's) with the corresponding x-y utm of the grid cell.  Any help would be greatly appreciated!
> 
> Thanks,
> Karla


-- 

mathieu at lbbe:~$ whoami
 > Mathieu Basille, PhD

mathieu at lbbe:~$ locate
 > Laboratoire de Biom?trie et Biologie ?volutive
 > Universit? Claude Bernard Lyon 1 - France
 > http://lbbe.univ-lyon1.fr/

mathieu at lbbe:~$ info
 > http://ase-research.org/basille

mathieu at lbbe:~$ fortune
 > ``If you can't win by reason, go for volume.''
 > Calvin, by Bill Watterson.


From Roger.Bivand at nhh.no  Thu Jun 11 08:54:34 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 11 Jun 2009 08:54:34 +0200 (CEST)
Subject: [R-sig-Geo] convert point data to count data
In-Reply-To: <1244678201.ad3feabckarlafalk@trentu.ca>
References: <1244678201.ad3feabckarlafalk@trentu.ca>
Message-ID: <alpine.LRH.2.00.0906110828310.31253@reclus.nhh.no>

On Wed, 10 Jun 2009, Karla  Falk wrote:

>
> Hi,
>
>  I have a data set of points that I would like to convert to grid cell 
> counts.  Ultimately I would like to end up with a table that has an x-y 
> coordinate for each grid cell, and the count of the # of points falling 
> in each grid cell.  Does anyone know a way to do this in R?  I have been 
> playing around with using quadratcounts in spatstat, and the overlay 
> methods in sp, but with both I can't figure out how to get an output 
> table of the cell counts (including counts of zero's) with the 
> corresponding x-y utm of the grid cell.  Any help would be greatly 
> appreciated!

Something like:

library(sp)
data(meuse)
coordinates(meuse) <- c("x", "y")
grid <- spsample(meuse, n=2000, type="regular")
gridded(grid) <- TRUE
# make a SpatialPixels grid to count into
data(meuse.grid)
coordinates(meuse.grid) <- c("x", "y")
gridded(meuse.grid) <- TRUE
pts <- spsample(meuse.grid, n=5000, type="random")
# SpatialPoints sample of points within meusse.grid
o <- overlay(grid, pts)
to <- table(o)
# use table() to do the counting
counts <- rep(as.integer(0), nrow(coordinates(grid)))
counts[as.integer(names(to))] <- to
# assign to an output vector by cell index
grid_df <- SpatialPixelsDataFrame(grid, data=data.frame(counts=counts))
summary(grid_df)
hist(grid_df$counts)
spplot(grid_df)

OK?

Roger

>
> Thanks,
> Karla
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From T.Hengl at uva.nl  Thu Jun 11 10:13:45 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Thu, 11 Jun 2009 10:13:45 +0200
Subject: [R-sig-Geo] Problems with loading the "mgcv" package
In-Reply-To: <200906101039.56315.dylan.beaudette@gmail.com>
References: <37382E8DCB905042969BA78541F65706754316@kwek.ic.uva.nl>
	<200906101714.n5AHEKIq017329@edison.ccupm.upm.es>
	<200906101039.56315.dylan.beaudette@gmail.com>
Message-ID: <F02DECDD2E014F6BAA2C3ABE90DE4B24@pcibed193>


Hi guys,

Thanks for your reply (and apologies for a delay - it was night time in Europe).

I am running Windows XP, R version 2.9.0. I have just reinstalled spatstat with dependencies:

> install.packages("spatstat", dependencies=TRUE)

Then I tried:

> library(spatstat)

and I get the same error:

>Loading required package: mgcv
>Error in formatDL(nm, txt, indent = max(nchar(nm, "w")) + 3) :
...

then I tried to re-install the mgcv package but this gives me an error:

>Warning: cannot remove prior installation of package 'mgcv'
*this is version 1.5-5

When I look under my \library\mgcv\

I can still see a dll file which can not be removed.

Maybe there is a problem that I am using a customized Rprofile? My Rprofile is available at:

http://spatial-analyst.net/scripts/Rprofile.site


Thanx!

Tom Hengl
http://home.medewerker.uva.nl/t.hengl/



> -----Original Message-----
> From: Dylan Beaudette [mailto:debeaudette at ucdavis.edu]
> Sent: Wednesday, June 10, 2009 7:40 PM
> To: r-sig-geo at stat.math.ethz.ch
> Cc: Hengl, T.
> Subject: Re: [R-sig-Geo] Problems with loading the "mgcv" package
> 
> works for me:
> 
> library(spatstat)
> sessionInfo()
> 
> Loading required package: mgcv
> This is mgcv  1.5-5 . For overview type `help("mgcv-package")'.
> Loading required package: gpclib
> General Polygon Clipper Library for R (version 1.4-4)
>         Type 'class ? gpc.poly' for help
> 
> Loading required package: deldir
> deldir 0.0-8
> 
> spatstat 1.15-3
> 
> 
> R version 2.9.0 (2009-04-17)
> i686-pc-linux-gnu
> 
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-
> 8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=e
> n_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-4    mgcv_1.5-5
> 
> loaded via a namespace (and not attached):
> [1] grid_2.9.0      lattice_0.17-25 nlme_3.1-92
> 
> On Wednesday 10 June 2009, Marcelino de la Cruz wrote:
> > Hi Tom,
> >
> > I can load sptastat and mgcv without problem (see below).
> >
> > Could you please send us information about your environment?
> >
> >
> > Cheers,
> >
> > Marcelino
> >
> >  > library(spatstat)
> >
> > Loading required package: mgcv
> > This is mgcv  1.5-5 . For overview type `help("mgcv-package")'.
> > Loading required package: gpclib
> > General Polygon Clipper Library for R (version 1.4-3)
> >          Type 'class ? gpc.poly' for help
> > Loading required package: deldir
> > deldir 0.0-8
> >
> > spatstat 1.15-3
> > Type 'help(spatstat)' for information
> >
> >  > sessionInfo()
> >
> > R version 2.9.0 (2009-04-17)
> > i386-pc-mingw32
> >
> > locale:
> > LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spani
> >sh_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > other attached packages:
> > [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-3    mgcv_1.5-5
> >
> > loaded via a namespace (and not attached):
> > [1] grid_2.9.0      lattice_0.17-22 nlme_3.1-90     tools_2.9.0
> >
> > At 16:40 10/06/2009, Hengl, T. wrote:
> > >Hi,
> > >
> > >I am having problems with loading the mgcv package, which is used by
> > >the spatstat package. I did not have similar problems with the
> > >latest version of the spatstat, so I imagine that the problem could
> > >lay with the mgcv package (new parameters).
> > >
> > > > library(spatstat)
> > >
> > >Loading required package: mgcv
> > >Error in formatDL(nm, txt, indent = max(nchar(nm, "w")) + 3) :
> > >   incorrect values of 'indent' and 'width'
> > >Error : .onAttach failed in 'attachNamespace'
> > >Error: package 'mgcv' could not be loaded
> > >
> > >How could we fix this?
> > >
> > >
> > >thanks,
> > >
> > >T. Hengl
> > >http://home.medewerker.uva.nl/t.hengl/
> > >
> > >         [[alternative HTML version deleted]]
> > >
> > >_______________________________________________
> > >R-sig-Geo mailing list
> > >R-sig-Geo at stat.math.ethz.ch
> > >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > ***************************************
> > Marcelino de la Cruz Rot
> > Depto. Biologia Vegetal
> > EUIT Agricola
> > Universidad Politecnica de Madrid
> > 28040-Madrid
> > SPAIN
> > ***************************************
> > 	[[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
> --
> Dylan Beaudette
> Soil Resource Laboratory
> http://casoilresource.lawr.ucdavis.edu/
> University of California at Davis
> 530.754.7341


From edzer.pebesma at uni-muenster.de  Thu Jun 11 11:01:56 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 11 Jun 2009 11:01:56 +0200
Subject: [R-sig-Geo] Problems with loading the "mgcv" package
In-Reply-To: <F02DECDD2E014F6BAA2C3ABE90DE4B24@pcibed193>
References: <37382E8DCB905042969BA78541F65706754316@kwek.ic.uva.nl>	<200906101714.n5AHEKIq017329@edison.ccupm.upm.es>	<200906101039.56315.dylan.beaudette@gmail.com>
	<F02DECDD2E014F6BAA2C3ABE90DE4B24@pcibed193>
Message-ID: <4A30C804.2090308@uni-muenster.de>

In general, before you post questions of this kind to the list, it makes
sense to see if the packages load on your platform in a clean session,
e.g. started with R --vanilla. (Or, anyhow, without automatically
loading a data base or Rprofile type modified local configurations).
Then you know where to search!
--
Edzer

Tomislav Hengl wrote:
> Hi guys,
>
> Thanks for your reply (and apologies for a delay - it was night time in Europe).
>
> I am running Windows XP, R version 2.9.0. I have just reinstalled spatstat with dependencies:
>
>   
>> install.packages("spatstat", dependencies=TRUE)
>>     
>
> Then I tried:
>
>   
>> library(spatstat)
>>     
>
> and I get the same error:
>
>   
>> Loading required package: mgcv
>> Error in formatDL(nm, txt, indent = max(nchar(nm, "w")) + 3) :
>>     
> ...
>
> then I tried to re-install the mgcv package but this gives me an error:
>
>   
>> Warning: cannot remove prior installation of package 'mgcv'
>>     
> *this is version 1.5-5
>
> When I look under my \library\mgcv\
>
> I can still see a dll file which can not be removed.
>
> Maybe there is a problem that I am using a customized Rprofile? My Rprofile is available at:
>
> http://spatial-analyst.net/scripts/Rprofile.site
>
>
> Thanx!
>
> Tom Hengl
> http://home.medewerker.uva.nl/t.hengl/
>
>
>
>   
>> -----Original Message-----
>> From: Dylan Beaudette [mailto:debeaudette at ucdavis.edu]
>> Sent: Wednesday, June 10, 2009 7:40 PM
>> To: r-sig-geo at stat.math.ethz.ch
>> Cc: Hengl, T.
>> Subject: Re: [R-sig-Geo] Problems with loading the "mgcv" package
>>
>> works for me:
>>
>> library(spatstat)
>> sessionInfo()
>>
>> Loading required package: mgcv
>> This is mgcv  1.5-5 . For overview type `help("mgcv-package")'.
>> Loading required package: gpclib
>> General Polygon Clipper Library for R (version 1.4-4)
>>         Type 'class ? gpc.poly' for help
>>
>> Loading required package: deldir
>> deldir 0.0-8
>>
>> spatstat 1.15-3
>>
>>
>> R version 2.9.0 (2009-04-17)
>> i686-pc-linux-gnu
>>
>> locale:
>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-
>> 8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=e
>> n_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-4    mgcv_1.5-5
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.9.0      lattice_0.17-25 nlme_3.1-92
>>
>> On Wednesday 10 June 2009, Marcelino de la Cruz wrote:
>>     
>>> Hi Tom,
>>>
>>> I can load sptastat and mgcv without problem (see below).
>>>
>>> Could you please send us information about your environment?
>>>
>>>
>>> Cheers,
>>>
>>> Marcelino
>>>
>>>  > library(spatstat)
>>>
>>> Loading required package: mgcv
>>> This is mgcv  1.5-5 . For overview type `help("mgcv-package")'.
>>> Loading required package: gpclib
>>> General Polygon Clipper Library for R (version 1.4-3)
>>>          Type 'class ? gpc.poly' for help
>>> Loading required package: deldir
>>> deldir 0.0-8
>>>
>>> spatstat 1.15-3
>>> Type 'help(spatstat)' for information
>>>
>>>  > sessionInfo()
>>>
>>> R version 2.9.0 (2009-04-17)
>>> i386-pc-mingw32
>>>
>>> locale:
>>> LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spani
>>> sh_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> other attached packages:
>>> [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-3    mgcv_1.5-5
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.9.0      lattice_0.17-22 nlme_3.1-90     tools_2.9.0
>>>
>>> At 16:40 10/06/2009, Hengl, T. wrote:
>>>       
>>>> Hi,
>>>>
>>>> I am having problems with loading the mgcv package, which is used by
>>>> the spatstat package. I did not have similar problems with the
>>>> latest version of the spatstat, so I imagine that the problem could
>>>> lay with the mgcv package (new parameters).
>>>>
>>>>         
>>>>> library(spatstat)
>>>>>           
>>>> Loading required package: mgcv
>>>> Error in formatDL(nm, txt, indent = max(nchar(nm, "w")) + 3) :
>>>>   incorrect values of 'indent' and 'width'
>>>> Error : .onAttach failed in 'attachNamespace'
>>>> Error: package 'mgcv' could not be loaded
>>>>
>>>> How could we fix this?
>>>>
>>>>
>>>> thanks,
>>>>
>>>> T. Hengl
>>>> http://home.medewerker.uva.nl/t.hengl/
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>         
>>> ***************************************
>>> Marcelino de la Cruz Rot
>>> Depto. Biologia Vegetal
>>> EUIT Agricola
>>> Universidad Politecnica de Madrid
>>> 28040-Madrid
>>> SPAIN
>>> ***************************************
>>> 	[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>       
>>
>> --
>> Dylan Beaudette
>> Soil Resource Laboratory
>> http://casoilresource.lawr.ucdavis.edu/
>> University of California at Davis
>> 530.754.7341
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From T.Hengl at uva.nl  Thu Jun 11 11:32:27 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Thu, 11 Jun 2009 11:32:27 +0200
Subject: [R-sig-Geo] Problems with loading the "mgcv" package
In-Reply-To: <4A30C804.2090308@uni-muenster.de>
References: <37382E8DCB905042969BA78541F65706754316@kwek.ic.uva.nl>	<200906101714.n5AHEKIq017329@edison.ccupm.upm.es>	<200906101039.56315.dylan.beaudette@gmail.com>
	<F02DECDD2E014F6BAA2C3ABE90DE4B24@pcibed193>
	<4A30C804.2090308@uni-muenster.de>
Message-ID: <8A259FF699BC4540BA1C690AC734E67B@pcibed193>


Hi Edzer,

I am sorry about that. I have been using exclusively Tinn-R to write R scripts now over a year (once
you install Tinn-R over R, you do need to set-up the Rprofile; Tinn-R works only with the MDI mode
of Rgui).

I have just installed a somewhat older version of R (2.7) and tried loading the package "spatstat"
in a "clean session" and it does load without a problem.

I assume that the problem might be with my Rprofile and/or the Tinn-R integration. Tinn-R does need
to load some packages:

> library(TinnR) 
> library(svSocket)

which might conflict with "mgcv". I did not have problems with Tinn-R with the latest version of
R/Tinn-R, so it is a new thing.

I will try to contact also the Tinn-R people (http://www.sciviews.org/Tinn-R/). 

thanks,

Tom Hengl 
http://home.medewerker.uva.nl/t.hengl/

> -----Original Message-----
> From: Edzer Pebesma [mailto:edzer.pebesma at uni-muenster.de]
> Sent: Thursday, June 11, 2009 11:02 AM
> To: Tomislav Hengl
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Problems with loading the "mgcv" package
> 
> In general, before you post questions of this kind to the list, it makes
> sense to see if the packages load on your platform in a clean session,
> e.g. started with R --vanilla. (Or, anyhow, without automatically
> loading a data base or Rprofile type modified local configurations).
> Then you know where to search!
> --
> Edzer
> 
> Tomislav Hengl wrote:
> > Hi guys,
> >
> > Thanks for your reply (and apologies for a delay - it was night time in Europe).
> >
> > I am running Windows XP, R version 2.9.0. I have just reinstalled spatstat with dependencies:
> >
> >
> >> install.packages("spatstat", dependencies=TRUE)
> >>
> >
> > Then I tried:
> >
> >
> >> library(spatstat)
> >>
> >
> > and I get the same error:
> >
> >
> >> Loading required package: mgcv
> >> Error in formatDL(nm, txt, indent = max(nchar(nm, "w")) + 3) :
> >>
> > ...
> >
> > then I tried to re-install the mgcv package but this gives me an error:
> >
> >
> >> Warning: cannot remove prior installation of package 'mgcv'
> >>
> > *this is version 1.5-5
> >
> > When I look under my \library\mgcv\
> >
> > I can still see a dll file which can not be removed.
> >
> > Maybe there is a problem that I am using a customized Rprofile? My Rprofile is available at:
> >
> > http://spatial-analyst.net/scripts/Rprofile.site
> >
> >
> > Thanx!
> >
> > Tom Hengl
> > http://home.medewerker.uva.nl/t.hengl/
> >
> >
> >
> >
> >> -----Original Message-----
> >> From: Dylan Beaudette [mailto:debeaudette at ucdavis.edu]
> >> Sent: Wednesday, June 10, 2009 7:40 PM
> >> To: r-sig-geo at stat.math.ethz.ch
> >> Cc: Hengl, T.
> >> Subject: Re: [R-sig-Geo] Problems with loading the "mgcv" package
> >>
> >> works for me:
> >>
> >> library(spatstat)
> >> sessionInfo()
> >>
> >> Loading required package: mgcv
> >> This is mgcv  1.5-5 . For overview type `help("mgcv-package")'.
> >> Loading required package: gpclib
> >> General Polygon Clipper Library for R (version 1.4-4)
> >>         Type 'class ? gpc.poly' for help
> >>
> >> Loading required package: deldir
> >> deldir 0.0-8
> >>
> >> spatstat 1.15-3
> >>
> >>
> >> R version 2.9.0 (2009-04-17)
> >> i686-pc-linux-gnu
> >>
> >> locale:
> >> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-
> >> 8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=e
> >> n_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> >>
> >> attached base packages:
> >> [1] stats     graphics  grDevices utils     datasets  methods   base
> >>
> >> other attached packages:
> >> [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-4    mgcv_1.5-5
> >>
> >> loaded via a namespace (and not attached):
> >> [1] grid_2.9.0      lattice_0.17-25 nlme_3.1-92
> >>
> >> On Wednesday 10 June 2009, Marcelino de la Cruz wrote:
> >>
> >>> Hi Tom,
> >>>
> >>> I can load sptastat and mgcv without problem (see below).
> >>>
> >>> Could you please send us information about your environment?
> >>>
> >>>
> >>> Cheers,
> >>>
> >>> Marcelino
> >>>
> >>>  > library(spatstat)
> >>>
> >>> Loading required package: mgcv
> >>> This is mgcv  1.5-5 . For overview type `help("mgcv-package")'.
> >>> Loading required package: gpclib
> >>> General Polygon Clipper Library for R (version 1.4-3)
> >>>          Type 'class ? gpc.poly' for help
> >>> Loading required package: deldir
> >>> deldir 0.0-8
> >>>
> >>> spatstat 1.15-3
> >>> Type 'help(spatstat)' for information
> >>>
> >>>  > sessionInfo()
> >>>
> >>> R version 2.9.0 (2009-04-17)
> >>> i386-pc-mingw32
> >>>
> >>> locale:
> >>> LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spani
> >>> sh_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252
> >>>
> >>> attached base packages:
> >>> [1] stats     graphics  grDevices utils     datasets  methods   base
> >>>
> >>> other attached packages:
> >>> [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-3    mgcv_1.5-5
> >>>
> >>> loaded via a namespace (and not attached):
> >>> [1] grid_2.9.0      lattice_0.17-22 nlme_3.1-90     tools_2.9.0
> >>>
> >>> At 16:40 10/06/2009, Hengl, T. wrote:
> >>>
> >>>> Hi,
> >>>>
> >>>> I am having problems with loading the mgcv package, which is used by
> >>>> the spatstat package. I did not have similar problems with the
> >>>> latest version of the spatstat, so I imagine that the problem could
> >>>> lay with the mgcv package (new parameters).
> >>>>
> >>>>
> >>>>> library(spatstat)
> >>>>>
> >>>> Loading required package: mgcv
> >>>> Error in formatDL(nm, txt, indent = max(nchar(nm, "w")) + 3) :
> >>>>   incorrect values of 'indent' and 'width'
> >>>> Error : .onAttach failed in 'attachNamespace'
> >>>> Error: package 'mgcv' could not be loaded
> >>>>
> >>>> How could we fix this?
> >>>>
> >>>>
> >>>> thanks,
> >>>>
> >>>> T. Hengl
> >>>> http://home.medewerker.uva.nl/t.hengl/
> >>>>
> >>>>         [[alternative HTML version deleted]]
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at stat.math.ethz.ch
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>> ***************************************
> >>> Marcelino de la Cruz Rot
> >>> Depto. Biologia Vegetal
> >>> EUIT Agricola
> >>> Universidad Politecnica de Madrid
> >>> 28040-Madrid
> >>> SPAIN
> >>> ***************************************
> >>> 	[[alternative HTML version deleted]]
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at stat.math.ethz.ch
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>
> >> --
> >> Dylan Beaudette
> >> Soil Resource Laboratory
> >> http://casoilresource.lawr.ucdavis.edu/
> >> University of California at Davis
> >> 530.754.7341
> >>
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
> http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From J.Demmler at swansea.ac.uk  Thu Jun 11 13:05:35 2009
From: J.Demmler at swansea.ac.uk (Demmler J.)
Date: Thu, 11 Jun 2009 12:05:35 +0100
Subject: [R-sig-Geo] confusing format of shapefile,
	change coordinate system to long/lat
Message-ID: <7B320B507C445840BD72C998A0B871DB04EC32DF@CCS-EXCHANGE1.brynmill.swan.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090611/835692d6/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jun 11 14:16:40 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 11 Jun 2009 14:16:40 +0200 (CEST)
Subject: [R-sig-Geo] confusing format of shapefile,
 change coordinate system to long/lat
In-Reply-To: <7B320B507C445840BD72C998A0B871DB04EC32DF@CCS-EXCHANGE1.brynmill.swan.ac.uk>
References: <7B320B507C445840BD72C998A0B871DB04EC32DF@CCS-EXCHANGE1.brynmill.swan.ac.uk>
Message-ID: <alpine.LRH.2.00.0906111403420.32024@reclus.nhh.no>

On Thu, 11 Jun 2009, Demmler J. wrote:

> Dear R fellow-users,
>
> I'm new to using the "maptools" and "rgdal" libraries in R, so I'm very 
> sorry if this is something really obvious. I'm trying to get an ESRI 
> shape file (Wales lower super output areas) into the right format. I 
> think a "proper" shapefile should just have two columns with the 
> coordinates, so this one is a bit odd. I'm not quite sure what the 
> problem is, if it is the dimensions or the class of the dataset (or 
> both).

Your shapefile contains 1935 observations, and the geometric form 
(support) of the observations is as polygons. As read, they are in the 
OSGB National Grid coordinate reference system. It seems that you believe 
that the data is in geographical coordinates, but it is not. If the two 
attributes GEOEAST and GEONORTH are geographical coordinates, you need to 
extract them, cbind() them to make a two column matrix, then make a 
SpatialPoints object - watch the datum of the CRS(), it will bite - and 
spTransform() that.

But it isn't obvious that you want to do that, or that GEOEAST, GEONORTH 
are in geographical coordinates (or POPEAST, POPNORTH for that matter) - 
do summary() of the object you have read and look at those variables. Find 
out from the data provider what they are, I suspect that the GEOEAST, 
GEONORTH pair is the centroid of the polygon, and that POPEAST, POPNORTH 
is the population-weighted centroid of the polygon for the population 
distribution at a known date.

Hope this helps,

Roger

>
> library(maptools)
> library(rgdal)
>
>> ogrInfo(".","Wales_low_soa_2001")
> Driver: ESRI Shapefile number of rows 1935
> Feature type: wkbPolygon with 2 dimensions
> Number of fields: 7
>      name type length typeName
> 1 GEONORTH    2     31     Real
> 2 POPNORTH    2     31     Real
> 3  GEOEAST    2     31     Real
> 4     NAME    4    254   String
> 5    LABEL    4    254   String
> 6  POPEAST    2     31     Real
> 7 ZONECODE    4    254   String
>
>> wales_ll <- readOGR(".","Wales_low_soa_2001")
> OGR data source with driver: ESRI Shapefile
> Source: ".", layer: "Wales_low_soa_2001"
> with  1935  rows and  7  columns
> Feature type: wkbPolygon with 2 dimensions
>
> I also tried ReadShapePoly, but I can't see any noticable difference.
>
>> class(wales_ll)
> [1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
>
> I would like to do something like this (I also tried to just use the GEONORTH and GEOEAST columns, but wasn't very successful either):
>
>> proj4string(wales_ll) <- CRS("+proj=longlat ellps=WGS84")
> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>  Geographical CRS given to non-conformant data
>
>> summary(wales_ll)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>        min      max
> r1 146597.1 355312.8
> r2 164538.4 395994.1
> Is projected: TRUE
> proj4string :
> [+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
> +y_0=-100000 +ellps=airy +units=m +no_defs]
> etc.
>
>
> and then later I would like to do:
>
>> EPSG <- make_EPSG()
>> EPSG[grep("British National Grid", EPSG$note), 1:2]
>      code                                note
> 2791 27700 # OSGB 1936 / British National Grid
>
>> wales.gb <- spTransform(wales_ll, CRS("+init=epsg:27700"))
>
> and possibly at some point writeOGR to kml...
>
> Any help with this is highly appreciated!
>
> Thanks  Joanne
>
> -------------------------------------------------------------------
> Linux (Ubuntu 9.04), installed from pre-compiled binary
>
>> sessionInfo()
> R version 2.8.1 (2008-12-22)
> i486-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=en_GB.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.6-8     maptools_0.7-23 sp_0.9-37       foreign_0.8-30
>
> loaded via a namespace (and not attached):
> [1] grid_2.8.1      lattice_0.17-25
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Bjarke.Christensen at sydbank.dk  Thu Jun 11 15:02:28 2009
From: Bjarke.Christensen at sydbank.dk (Bjarke Christensen)
Date: Thu, 11 Jun 2009 15:02:28 +0200
Subject: [R-sig-Geo] plotting a polygon with holes
Message-ID: <OFA562A269.6AC9D141-ONC12575D2.0039EFA2-C12575D2.0047A3D5@bdpnet.dk>


Hi,

I have a shapefile/SpatialPolygonsDataFrame of coastlines. Each polygon
corresponds to an island, and there are no holes. I can plot this so that
the islands are shaded by using
> plot(islands, col="gray")

What I now want, is to plot the same information so that the ocean is blue
and the islands are transparent. Something like:
>image(myDEM)
>plot(ocean, col="lightblue", add=T)

which I would hope would allow the DEM to be visible on the islands, but
not in the ocean.

The approach I have been taking does not seem to work, so I would like to
as for your suggestions. My approach is to make a new map, with one, big
rectangular polygon containing all the islands as holes.
I do this by making another shapefile, containing one polygon which
consists of the (slightly expanded) bounding box of the first shapefile. I
then import both shapefiles into GRASS, run

       v.overlay ainput=boundingbox at PERMANENT binput=islands at PERMANENT
output=ocean operator=not

and export the resulting vector shape to a shapefile. Plotting ocean in
GRASS

      d.vect map=ocean at PERMANENT type=area fcolor=indigo

yields the image shown on
http://www.flickr.com/photos/39340925 at N07/3616682800 (which looks exactly
like what I was looking for).

However after importing it into R with rgdal and plotting
> ocean <- readOGR("myfolder", "myfilename")
> plot(ocean, col="lightblue")

I get an image where the entire background is blue - not just the ocean,
but the islands as well.

Looking at the SpatialPolygonsDataFrame, I see that the polygons are not
marked as holes. But changing this does not seem to make any difference:

> boundary <- which.max(sapply(ocean at polygons, function(x)
x at Polygons[[1]]@area))
> for (i in ((1:length(ocean at polygons))[-boundary]))
ocean at polygons[[i]]@Polygons[[1]]@hole <- T

It appears as if the non-hole polygon is drawn fully filled, irrespective
of any holes, and then the 'holes' are drawn on top. How might i get around
that?

Thanks in advance for any suggestions,
Bjarke Christensen


From Roger.Bivand at nhh.no  Thu Jun 11 15:21:44 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 11 Jun 2009 15:21:44 +0200 (CEST)
Subject: [R-sig-Geo] plotting a polygon with holes
In-Reply-To: <OFA562A269.6AC9D141-ONC12575D2.0039EFA2-C12575D2.0047A3D5@bdpnet.dk>
References: <OFA562A269.6AC9D141-ONC12575D2.0039EFA2-C12575D2.0047A3D5@bdpnet.dk>
Message-ID: <alpine.LRH.2.00.0906111511490.32546@reclus.nhh.no>

On Thu, 11 Jun 2009, Bjarke Christensen wrote:

>
> Hi,
>
> I have a shapefile/SpatialPolygonsDataFrame of coastlines. Each polygon
> corresponds to an island, and there are no holes. I can plot this so that
> the islands are shaded by using
>> plot(islands, col="gray")
>
> What I now want, is to plot the same information so that the ocean is blue
> and the islands are transparent. Something like:
>> image(myDEM)
>> plot(ocean, col="lightblue", add=T)
>
> which I would hope would allow the DEM to be visible on the islands, but
> not in the ocean.

As you observe, the approach you are taking does not work, as the R 
graphics devices work by over-painting in layers. To see the image, it has 
to be painted after the enclosing rectangle. Holes are painted by 
re-painting the hole in a chosen background colour, which by default is 
"transparent", so you just get lots of blue.

Why not do something like

o <- overlay(myDEM, islands)

(untried) to get just the raster cells within the island polygons as a 
SpatialPixelsDataFrame object and image() that, possibly setting the 
background to a suitable colour (NAs will get transparent by default). 
This works with the graphics system, rather than trying to work round it - 
it doesn't "remember" that there is anything on the canvas that should be 
protected from overpainting, so it is safer just to paint what needs 
painting. I can also imagine painting first with reduced opacity (or 
intensity) in a different palette, then overpainting just the islands with 
full intensity in the target palette, which might be more visually 
pleasing than just flat blue sea.

Hope this helps,

Roger

>
> The approach I have been taking does not seem to work, so I would like to
> as for your suggestions. My approach is to make a new map, with one, big
> rectangular polygon containing all the islands as holes.
> I do this by making another shapefile, containing one polygon which
> consists of the (slightly expanded) bounding box of the first shapefile. I
> then import both shapefiles into GRASS, run
>
>       v.overlay ainput=boundingbox at PERMANENT binput=islands at PERMANENT
> output=ocean operator=not
>
> and export the resulting vector shape to a shapefile. Plotting ocean in
> GRASS
>
>      d.vect map=ocean at PERMANENT type=area fcolor=indigo
>
> yields the image shown on
> http://www.flickr.com/photos/39340925 at N07/3616682800 (which looks exactly
> like what I was looking for).
>
> However after importing it into R with rgdal and plotting
>> ocean <- readOGR("myfolder", "myfilename")
>> plot(ocean, col="lightblue")
>
> I get an image where the entire background is blue - not just the ocean,
> but the islands as well.
>
> Looking at the SpatialPolygonsDataFrame, I see that the polygons are not
> marked as holes. But changing this does not seem to make any difference:
>
>> boundary <- which.max(sapply(ocean at polygons, function(x)
> x at Polygons[[1]]@area))
>> for (i in ((1:length(ocean at polygons))[-boundary]))
> ocean at polygons[[i]]@Polygons[[1]]@hole <- T
>
> It appears as if the non-hole polygon is drawn fully filled, irrespective
> of any holes, and then the 'holes' are drawn on top. How might i get around
> that?
>
> Thanks in advance for any suggestions,
> Bjarke Christensen
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.m.krug at gmail.com  Thu Jun 11 15:38:39 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Thu, 11 Jun 2009 15:38:39 +0200
Subject: [R-sig-Geo] Converting SpatialPointsDataFrame to
	SpatialGridDataFrame
Message-ID: <fb7c7e870906110638y2709d8cen67d21a9101ba322e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090611/57bbbe3c/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jun 11 15:50:52 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 11 Jun 2009 15:50:52 +0200 (CEST)
Subject: [R-sig-Geo] Converting SpatialPointsDataFrame to
 SpatialGridDataFrame
In-Reply-To: <fb7c7e870906110638y2709d8cen67d21a9101ba322e@mail.gmail.com>
References: <fb7c7e870906110638y2709d8cen67d21a9101ba322e@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0906111546360.32546@reclus.nhh.no>

On Thu, 11 Jun 2009, Rainer M Krug wrote:

> Hi
>
> I spend the whole day with it, trying grass, gdal, R, but was not successful
> (and I know it can be done...).
>
> I have a shape file and a raster file, both in the same projection and in
> thew same area (shape file completely overlapping the raster) and I want to
> "burn" the values from one column in the attribute table of the shape file
> (DNSTY) into the raster.
>
> I am doing the following:
>
> ####
> library(sp)
> library(maptools)
> library(raster) # <- this might work as well. I also have the shape file as
> a .csv file, including coordinates and DNSTY
>
> s <- readShapePoints("./plants.shp")
> r <- readAsciiGrid("./plants.asc")
>
> ## and now?
> ####
>
> I seem to remember that it works by using overlay(), but I don't remember
> how.\

Please see the thread started by Karla Falk yesterday. overlay() will tell 
you which raster cells the points fall in, but you cannot just "burn" 
across unless you know definitely that hit raster cells have only one hit, 
otherwise you'll need tapply (or table for counting) to tally the point 
values by hit cell. I think that is the step you need to add. It'll take 
some attempts to find a recipe that works for your specific case, it 
usually does, but then works.

Roger

> Also, it should be working with pointsToRaster() from the package raster,
> but I also was not successful.
>
> Cheers,
>
> Rainer
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.m.krug at gmail.com  Thu Jun 11 16:53:21 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Thu, 11 Jun 2009 16:53:21 +0200
Subject: [R-sig-Geo] Converting SpatialPointsDataFrame to
	SpatialGridDataFrame
In-Reply-To: <alpine.LRH.2.00.0906111546360.32546@reclus.nhh.no>
References: <fb7c7e870906110638y2709d8cen67d21a9101ba322e@mail.gmail.com>
	<alpine.LRH.2.00.0906111546360.32546@reclus.nhh.no>
Message-ID: <fb7c7e870906110753s6ea23a22h77995310a5320706@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090611/c73da786/attachment.pl>

From a.ghisla at gmail.com  Thu Jun 11 18:50:36 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Thu, 11 Jun 2009 18:50:36 +0200
Subject: [R-sig-Geo] [Report #2] Kriging with GRASS and R: v.autokrige port
 to wxPython and more
Message-ID: <4A3135DC.901@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello all,

there are some important news about the module!

First of all, the interface is almost finished. See a screenshot on the
wiki page [0].
The layout includes a notebook with a page for each R package (automap,
gstat and geoR), with the available options. Another layout could be a
chiocebox wht the three packages on the top of Kriging section, that
redraws the section accourding to the user's choice.
Let me know which one do you prefer, feel free also to suggest something
new.

The R-GRASS integration is on its way: autofitting the variogram on a
map obtained from a DEM sample [1] works in the proof of concept.  rpy2
is extremely helpful and does not require much more code than the
original R code. More to come in the next days.

The idea for variogram fitting is to plot the variogram in a new frame
and add some controls like sliders and/or text boxes to fill up with
nugget, sill and range values. This will involve Python graphics, not R,
as the former is more flexible.

Comments, suggestions, critics are welcome!

best regards and happy coding to everyone,

Anne

[0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
[1] http://casoilresource.lawr.ucdavis.edu/drupal/node/442
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAkoxNdwACgkQzZ3g4YwFFgZ2xgCgmIVL34wnuAD3MIPxLGoKmCE+
yMUAn1Nzf2jzSn9T2jGCaAeKgnD7SV3u
=UaBU
-----END PGP SIGNATURE-----


From etiennebr at gmail.com  Thu Jun 11 22:30:24 2009
From: etiennebr at gmail.com (Etienne Bellemare)
Date: Thu, 11 Jun 2009 16:30:24 -0400
Subject: [R-sig-Geo] Keep dimensions with dilate.owin
In-Reply-To: <57DC18C299094D4299F837570C5DF1C502A3E5F337@EXWA-MBX01.nexus.csiro.au>
References: <57DC18C299094D4299F837570C5DF1C502A3E5F337@EXWA-MBX01.nexus.csiro.au>
Message-ID: <6e10ffb0906111330i7537b595se7c9e9b628e72ea7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090611/96cbec48/attachment.pl>

From Thomas.Adams at noaa.gov  Thu Jun 11 23:33:27 2009
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Thu, 11 Jun 2009 17:33:27 -0400
Subject: [R-sig-Geo] [Report #2] Kriging with GRASS and R: v.autokrige
 port to wxPython and more
In-Reply-To: <4A3135DC.901@gmail.com>
References: <4A3135DC.901@gmail.com>
Message-ID: <4A317827.6050105@noaa.gov>

Anne,

Will this be scriptable? I guess it's not a huge deal since it would be using a script that included GRASS and R using automap?

Tom


Anne Ghisla wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hello all,
>
> there are some important news about the module!
>
> First of all, the interface is almost finished. See a screenshot on the
> wiki page [0].
> The layout includes a notebook with a page for each R package (automap,
> gstat and geoR), with the available options. Another layout could be a
> chiocebox wht the three packages on the top of Kriging section, that
> redraws the section accourding to the user's choice.
> Let me know which one do you prefer, feel free also to suggest something
> new.
>
> The R-GRASS integration is on its way: autofitting the variogram on a
> map obtained from a DEM sample [1] works in the proof of concept.  rpy2
> is extremely helpful and does not require much more code than the
> original R code. More to come in the next days.
>
> The idea for variogram fitting is to plot the variogram in a new frame
> and add some controls like sliders and/or text boxes to fill up with
> nugget, sill and range values. This will involve Python graphics, not R,
> as the former is more flexible.
>
> Comments, suggestions, critics are welcome!
>
> best regards and happy coding to everyone,
>
> Anne
>
> [0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
> [1] http://casoilresource.lawr.ucdavis.edu/drupal/node/442
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.9 (MingW32)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
>
> iEYEARECAAYFAkoxNdwACgkQzZ3g4YwFFgZ2xgCgmIVL34wnuAD3MIPxLGoKmCE+
> yMUAn1Nzf2jzSn9T2jGCaAeKgnD7SV3u
> =UaBU
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033


From saiful_ku at yahoo.com  Fri Jun 12 07:26:15 2009
From: saiful_ku at yahoo.com (Kazi Saiful Islam)
Date: Thu, 11 Jun 2009 22:26:15 -0700 (PDT)
Subject: [R-sig-Geo] Spatial switching regression
Message-ID: <81856.21069.qm@web53308.mail.re2.yahoo.com>


Hello list,

I am a new user of R (still learning). I am trying
to develop Spatial switching regression (for point data) using R. Could you please
provide me any algorithm, script or URL? I'd be really grateful to you
if you please help me in this regard. 

Thanks in advance
KSI


From Bjarke.Christensen at sydbank.dk  Fri Jun 12 10:01:59 2009
From: Bjarke.Christensen at sydbank.dk (Bjarke Christensen)
Date: Fri, 12 Jun 2009 10:01:59 +0200
Subject: [R-sig-Geo] Vedr.: Re:  plotting a polygon with holes
In-Reply-To: <alpine.LRH.2.00.0906111511490.32546@reclus.nhh.no>
Message-ID: <OF7BC5413A.073328AF-ONC12575D3.002B642B-C12575D3.002C20DE@bdpnet.dk>

That works like a charm:

> myDEM.pix <- as(myDEM, 'SpatialPixelsDataFrame')
> idx <- overlay(myDEM.pix, islands)
> plot(oceans, col="blue")
> plot(islands, col="white, add=T)
> image(myDEM.pix[!is.na(idx),], add=T)

Thank you very much, once again.

Bjarke Christensen.



                                                                           
             Roger Bivand                                                  
             <Roger.Bivand at nhh                                             
             .no>                                                      Til 
                                       Bjarke Christensen                  
             11-06-2009 15:21          <Bjarke.Christensen at sydbank.dk>     
                                                                        cc 
                                       r-sig-geo at stat.math.ethz.ch         
              Besvar venligst                                         Emne 
                    til                Re: [R-sig-Geo] plotting a polygon  
             Roger.Bivand at nhh.         with holes                          
                    no                                                     
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           




On Thu, 11 Jun 2009, Bjarke Christensen wrote:

>
> Hi,
>
> I have a shapefile/SpatialPolygonsDataFrame of coastlines. Each polygon
> corresponds to an island, and there are no holes. I can plot this so that
> the islands are shaded by using
>> plot(islands, col="gray")
>
> What I now want, is to plot the same information so that the ocean is
blue
> and the islands are transparent. Something like:
>> image(myDEM)
>> plot(ocean, col="lightblue", add=T)
>
> which I would hope would allow the DEM to be visible on the islands, but
> not in the ocean.

As you observe, the approach you are taking does not work, as the R
graphics devices work by over-painting in layers. To see the image, it has
to be painted after the enclosing rectangle. Holes are painted by
re-painting the hole in a chosen background colour, which by default is
"transparent", so you just get lots of blue.

Why not do something like

o <- overlay(myDEM, islands)

(untried) to get just the raster cells within the island polygons as a
SpatialPixelsDataFrame object and image() that, possibly setting the
background to a suitable colour (NAs will get transparent by default).
This works with the graphics system, rather than trying to work round it -
it doesn't "remember" that there is anything on the canvas that should be
protected from overpainting, so it is safer just to paint what needs
painting. I can also imagine painting first with reduced opacity (or
intensity) in a different palette, then overpainting just the islands with
full intensity in the target palette, which might be more visually
pleasing than just flat blue sea.

Hope this helps,

Roger


--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From a.ghisla at gmail.com  Fri Jun 12 10:28:05 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 12 Jun 2009 10:28:05 +0200
Subject: [R-sig-Geo] [Report #2] Kriging with GRASS and R: v.autokrige
 port to wxPython and more
In-Reply-To: <4A317827.6050105@noaa.gov>
References: <4A3135DC.901@gmail.com> <4A317827.6050105@noaa.gov>
Message-ID: <4A321195.1040203@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Thomas Adams ha scritto:
> Anne,
> 
> Will this be scriptable? I guess it's not a huge deal since it would be
> using a script that included GRASS and R using automap?

Sure it will! I'll have a look at how to add this functionality in the
next weeks.

regards,
Anne

> Tom
> 
> 
> Anne Ghisla wrote:
> Hello all,
> 
> there are some important news about the module!
> 
> First of all, the interface is almost finished. See a screenshot on the
> wiki page [0].
> The layout includes a notebook with a page for each R package (automap,
> gstat and geoR), with the available options. Another layout could be a
> chiocebox wht the three packages on the top of Kriging section, that
> redraws the section accourding to the user's choice.
> Let me know which one do you prefer, feel free also to suggest something
> new.
> 
> The R-GRASS integration is on its way: autofitting the variogram on a
> map obtained from a DEM sample [1] works in the proof of concept.  rpy2
> is extremely helpful and does not require much more code than the
> original R code. More to come in the next days.
> 
> The idea for variogram fitting is to plot the variogram in a new frame
> and add some controls like sliders and/or text boxes to fill up with
> nugget, sill and range values. This will involve Python graphics, not R,
> as the former is more flexible.
> 
> Comments, suggestions, critics are welcome!
> 
> best regards and happy coding to everyone,
> 
> Anne
> 
> [0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
> [1] http://casoilresource.lawr.ucdavis.edu/drupal/node/442
>>
_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAkoyEZUACgkQzZ3g4YwFFgbywwCfUqEQ4DFLG7PQGP1I4+aGV+Jq
pQYAniQ2OZ3fCx8huAY1uFyto7/L0KcR
=Q+wU
-----END PGP SIGNATURE-----


From a.ghisla at gmail.com  Fri Jun 12 16:54:32 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 12 Jun 2009 16:54:32 +0200
Subject: [R-sig-Geo] [SoC v.autokrige2.py] autoKrige() and projected data
Message-ID: <4A326C28.20108@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello Paul, Edzer,

the integration of automap package in v.autokrige2 is quite completed
[0], thanks Paul for this clean interface to gstat!
Sadly, I'm getting an error when autoKrige() receives no new_data
argument. Examples in documentation all involve meuse dataset, that has
no projection information. I browsed the Web for this situation with
little success. I don't know precisely where the error occurs, so I send
this report to Edzer too.

Here is the code and a traceback of the error:

- ---code---
require(spgrass6)
require(automap)

# rs in a vector map containing locations with relative elevation value,
in GRASS spearfish60 dataset. Obtained following this tutorial [1]
> rsmap <- readVECT6('rs', type='point')
Exporting 300 points/lines...
 100%
300 features written
OGR data source with driver: ESRI Shapefile
Source: "/home/anne/gis/spearfish60/PERMANENT/.tmp/galadriel", layer: "rs"
with  300  rows and  2  columns
Feature type: wkbPoint with 2 dimensions

> str(rsmap)
Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
[cut]
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr " +proj=utm +zone=13 +ellps=clrk66
+datum=NAD27 +units=m +no_defs
+nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat"

# not shown: meuse object has the same structure and contents but
projargs==NA.

> autoKrige(elev~1, rsmap)
Errore in predict.gstat(g, newdata = newdata, block = block, nsim =
nsim,  :
  var1 : data item in gstat object and newdata have different coordinate
reference systems

Then I had a look into autoKrige code and found these lines:

    if (missing(new_data))
        new_data = create_new_data(input_data)
    krige_result = krige(formula, input_data, new_data,
variogram_object$var_model,
        block = block, ...)

My guess is that create_new_data() creates non-projected grid, and
krige() calls predict.gstat() with input_ and new_data, checks if they
have the same projection and in this case fails.

In v.autokrige.py code, Mathieu Grelier workarounded this autogeneration
of new_data creating a correctly projected grid and passing it as parameter.

Shall I do the same or is it possible to get create_new_data() to keep
input_data's projection?

many thanks in advance,
Anne

[0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
[1] http://casoilresource.lawr.ucdavis.edu/drupal/node/438
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAkoybCgACgkQzZ3g4YwFFgZ/+QCeOSkqOSQ7sqdCrLuGZtbkqZib
LAAAn3b5zqpAB1F/nGZDZw9HrhGdA95P
=HAAU
-----END PGP SIGNATURE-----


From edzer.pebesma at uni-muenster.de  Fri Jun 12 17:02:55 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 12 Jun 2009 17:02:55 +0200
Subject: [R-sig-Geo] [SoC v.autokrige2.py] autoKrige() and projected data
In-Reply-To: <4A326C28.20108@gmail.com>
References: <4A326C28.20108@gmail.com>
Message-ID: <4A326E1F.8090309@uni-muenster.de>

If newdata is created automatically (and this makes sense), it should
recieve the projection information of data.

On another issue: what happens if both are provided but have different
projection attributes?

And what happens if data has long/lat coordinates (is.projected(data) ==
FALSE)? In that case I would prefer an error -- the current
interpolation methods (covariances) used are not appropriate.

Best regards,
--
Edzer

Anne Ghisla wrote:
> Hello Paul, Edzer,
>
> the integration of automap package in v.autokrige2 is quite completed
> [0], thanks Paul for this clean interface to gstat!
> Sadly, I'm getting an error when autoKrige() receives no new_data
> argument. Examples in documentation all involve meuse dataset, that has
> no projection information. I browsed the Web for this situation with
> little success. I don't know precisely where the error occurs, so I send
> this report to Edzer too.
>
> Here is the code and a traceback of the error:
>
> ---code---
> require(spgrass6)
> require(automap)
>
> # rs in a vector map containing locations with relative elevation value,
> in GRASS spearfish60 dataset. Obtained following this tutorial [1]
> > rsmap <- readVECT6('rs', type='point')
> Exporting 300 points/lines...
>  100%
> 300 features written
> OGR data source with driver: ESRI Shapefile
> Source: "/home/anne/gis/spearfish60/PERMANENT/.tmp/galadriel", layer: "rs"
> with  300  rows and  2  columns
> Feature type: wkbPoint with 2 dimensions
>
> > str(rsmap)
> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
> [cut]
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr " +proj=utm +zone=13 +ellps=clrk66
> +datum=NAD27 +units=m +no_defs
> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat"
>
> # not shown: meuse object has the same structure and contents but
> projargs==NA.
>
> > autoKrige(elev~1, rsmap)
> Errore in predict.gstat(g, newdata = newdata, block = block, nsim =
> nsim,  :
>   var1 : data item in gstat object and newdata have different coordinate
> reference systems
>
> Then I had a look into autoKrige code and found these lines:
>
>     if (missing(new_data))
>         new_data = create_new_data(input_data)
>     krige_result = krige(formula, input_data, new_data,
> variogram_object$var_model,
>         block = block, ...)
>
> My guess is that create_new_data() creates non-projected grid, and
> krige() calls predict.gstat() with input_ and new_data, checks if they
> have the same projection and in this case fails.
>
> In v.autokrige.py code, Mathieu Grelier workarounded this autogeneration
> of new_data creating a correctly projected grid and passing it as
> parameter.
>
> Shall I do the same or is it possible to get create_new_data() to keep
> input_data's projection?
>
> many thanks in advance,
> Anne
>
> [0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
> [1] http://casoilresource.lawr.ucdavis.edu/drupal/node/438

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From a.ghisla at gmail.com  Fri Jun 12 17:09:33 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 12 Jun 2009 17:09:33 +0200
Subject: [R-sig-Geo] [Report #3] Kriging with GRASS and R: v.autokrige port
 to wxPython and more
Message-ID: <4A326FAD.3040107@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello all,

this weekly report will be very short, as yesterday I sent this email
[0] and made little progress.

I'm having some problems in using autoKrige() function work, AFAIK
because of projection information handling [1].

best regards and happy coding,
Anne

Homepage of the module:
http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009

[0] https://stat.ethz.ch/pipermail/r-sig-geo/2009-June/005919.html
[1] https://stat.ethz.ch/pipermail/r-sig-geo/2009-June/005925.html
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAkoyb6wACgkQzZ3g4YwFFgaLqgCgq3QvqbZwQ8ho1Aux82D4nhie
DH4AoItfbNTC9A7sLa8eSn0UTUxbIpVf
=2NoY
-----END PGP SIGNATURE-----


From Adrian.Baddeley at csiro.au  Fri Jun 12 17:36:30 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Fri, 12 Jun 2009 23:36:30 +0800
Subject: [R-sig-Geo]  convert point data to count data
Message-ID: <57DC18C299094D4299F837570C5DF1C502A3DF2D8D@EXWA-MBX01.nexus.csiro.au>

Karla Falk writes:

> I have a data set of points that I would like to convert to grid cell counts.

> Ultimately I would like to end up with a table that has an x-y coordinate for each grid cell,

> and the count of the # of points falling in each grid cell.  Does anyone know a way to do this in R?

> I have been playing around with using quadratcounts in spatstat, and the overlay methods in sp,

> but with both I can't figure out how to get an output table of the cell counts (including counts of zero's)

> with the corresponding x-y utm of the grid cell.


You can use the command 'pixellate' in spatstat.

library(spatstat)

data(redwood)

Z <- pixellate(redwood, eps=0.1, padzero=TRUE)

df <- data.frame(x=rasterx.im(Z), y=rastery.im(Z), count=as.vector(as.matrix(Z)))



Then 'df' is the output table you wanted. To display it,



plot(Z)

with(df, text(x,y,count))



The size of the grid cells can be controlled using 'eps' (for squares of side length 'eps')

or 'dimyx' (specifying the number of rows and columns of cells).



Adrian Baddeley


From Adrian.Baddeley at csiro.au  Fri Jun 12 17:59:51 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Fri, 12 Jun 2009 23:59:51 +0800
Subject: [R-sig-Geo] convert point data to count data
In-Reply-To: <57DC18C299094D4299F837570C5DF1C502A3DF2D8D@EXWA-MBX01.nexus.csiro.au>
References: <57DC18C299094D4299F837570C5DF1C502A3DF2D8D@EXWA-MBX01.nexus.csiro.au>
Message-ID: <57DC18C299094D4299F837570C5DF1C502A3DF2D8E@EXWA-MBX01.nexus.csiro.au>

Sorry, that should have been

df <- data.frame(x=as.vector(rasterx.im(Z)),
                         y=as.vector(rastery.im(Z)),
                         count=as.vector(as.matrix(Z)))

Adrian


From a.ghisla at gmail.com  Fri Jun 12 18:25:26 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 12 Jun 2009 18:25:26 +0200
Subject: [R-sig-Geo] [SoC v.autokrige2.py] autoKrige() and projected data
In-Reply-To: <4A326E1F.8090309@uni-muenster.de>
References: <4A326C28.20108@gmail.com> <4A326E1F.8090309@uni-muenster.de>
Message-ID: <4A328176.9080904@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Edzer Pebesma ha scritto:
> If newdata is created automatically (and this makes sense), it should
> recieve the projection information of data.

hello all,

@Paul: I added the projection of obj to new_data before return. Please
test if it works as part of the package.

create_new_data <- function (obj)
{
    convex_hull = chull(coordinates(obj)[, 1], coordinates(obj)[,
        2])
    convex_hull = c(convex_hull, convex_hull[1])
    d = Polygon(obj[convex_hull, ])
    new_data = spsample(d, 5000, type = "regular")
    gridded(new_data) = TRUE
    attr(new_data, "proj4string") <-obj at proj4string
    return(new_data)
}

> On another issue: what happens if both are provided but have different
> projection attributes?
> 
> And what happens if data has long/lat coordinates (is.projected(data) ==
> FALSE)? In that case I would prefer an error -- the current
> interpolation methods (covariances) used are not appropriate.

Totally agree. The tests on projection are mandatory.

best regards,
Anne

> 
> Best regards,
> --
> Edzer
> 
> Anne Ghisla wrote:
>> Hello Paul, Edzer,
>>
>> the integration of automap package in v.autokrige2 is quite completed
>> [0], thanks Paul for this clean interface to gstat!
>> Sadly, I'm getting an error when autoKrige() receives no new_data
>> argument. Examples in documentation all involve meuse dataset, that has
>> no projection information. I browsed the Web for this situation with
>> little success. I don't know precisely where the error occurs, so I send
>> this report to Edzer too.
>>
>> Here is the code and a traceback of the error:
>>
>> ---code---
>> require(spgrass6)
>> require(automap)
>>
>> # rs in a vector map containing locations with relative elevation value,
>> in GRASS spearfish60 dataset. Obtained following this tutorial [1]
>>> rsmap <- readVECT6('rs', type='point')
>> Exporting 300 points/lines...
>>  100%
>> 300 features written
>> OGR data source with driver: ESRI Shapefile
>> Source: "/home/anne/gis/spearfish60/PERMANENT/.tmp/galadriel", layer: "rs"
>> with  300  rows and  2  columns
>> Feature type: wkbPoint with 2 dimensions
>>
>>> str(rsmap)
>> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>> [cut]
>>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>   .. .. ..@ projargs: chr " +proj=utm +zone=13 +ellps=clrk66
>> +datum=NAD27 +units=m +no_defs
>> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat"
>>
>> # not shown: meuse object has the same structure and contents but
>> projargs==NA.
>>
>>> autoKrige(elev~1, rsmap)
>> Errore in predict.gstat(g, newdata = newdata, block = block, nsim =
>> nsim,  :
>>   var1 : data item in gstat object and newdata have different coordinate
>> reference systems
>>
>> Then I had a look into autoKrige code and found these lines:
>>
>>     if (missing(new_data))
>>         new_data = create_new_data(input_data)
>>     krige_result = krige(formula, input_data, new_data,
>> variogram_object$var_model,
>>         block = block, ...)
>>
>> My guess is that create_new_data() creates non-projected grid, and
>> krige() calls predict.gstat() with input_ and new_data, checks if they
>> have the same projection and in this case fails.
>>
>> In v.autokrige.py code, Mathieu Grelier workarounded this autogeneration
>> of new_data creating a correctly projected grid and passing it as
>> parameter.
>>
>> Shall I do the same or is it possible to get create_new_data() to keep
>> input_data's projection?
>>
>> many thanks in advance,
>> Anne
>>
>> [0] http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009
>> [1] http://casoilresource.lawr.ucdavis.edu/drupal/node/438
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iEYEARECAAYFAkoygXYACgkQzZ3g4YwFFgZgDACeL7kQFjQGNqgz4mePX/nnCUkU
bzUAn37iRTmTsYAGiEWIOFWgM5P3UszT
=HqBt
-----END PGP SIGNATURE-----


From meutges at ege.fcen.uba.ar  Fri Jun 12 18:57:59 2009
From: meutges at ege.fcen.uba.ar (=?iso-8859-1?Q?Mar=EDa_Eugenia_Utg=E9s?=)
Date: Fri, 12 Jun 2009 13:57:59 -0300 (ART)
Subject: [R-sig-Geo] geoR questions
Message-ID: <b0de636fe7c6378e2d7c9eaeaa831a76.squirrel@webmail.ege.fcen.uba.ar>

---------------------------- Original Message ----------------------------
Subject: Presentation and a "few" Questions (geoR)
From:    Mar?a Eugenia Utg?s <meutges at ege.fcen.uba.ar>
Date:    Wed, June 10, 2009 5:21 pm
To:      r-sig-geo at stat.math.ethz.ch
--------------------------------------------------------------------------

 Hello Everyone
I am making my doctorate in biology at the University of Buenos Aires,
Argentina.
I am working on survival and dispersal of the south american fruit fly
(Diptera: Tephritidae), a fruit pest mainly of citrics.
To do so I have field dispersal data (with its x,y coordinates) and have
already perform some spatial analysis with geoR.
My specific questions are:
1- Data must show normality?  What to do if even transformed data does not
adjust?
2- How do I interpret the cross-validation results?
3- How do I know if I need to take into account anisotropy?
4- When to end the iteration of likfit? till stable values of estimated
parameters?
5- Is it recommended to present the image of the kriging AND the one
representing variances? how do I generate the latter?
6- Do the kriging image values have a unit, or are they arbitrary?
7- Finally, if you had to present the results (in a paper for example)
what results/data/graphics would you choose?

Hoping to recieve lots(!) of answers,
Mar?a Eugenia



Lic. Mar?a Eugenia Utg?s
Bi?loga
Lab. Gen?tica de Poblaciones Aplicada (GPA), Pab. 2, 4to piso, Lab. 105,
Depto. Ecolog?a, Gen?tica y Evoluci?n (EGE)
Fac. Cs. Exactas y Naturales (FCEyN)
Universidad de Buenos Aires (UBA)
Ciudad Universitaria,
Buenos Aires, Argentina

Tel.: 4576-3300, int 218


From paulojus at c3sl.ufpr.br  Fri Jun 12 19:12:35 2009
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Fri, 12 Jun 2009 14:12:35 -0300 (BRT)
Subject: [R-sig-Geo] geoR questions
In-Reply-To: <b0de636fe7c6378e2d7c9eaeaa831a76.squirrel@webmail.ege.fcen.uba.ar>
References: <b0de636fe7c6378e2d7c9eaeaa831a76.squirrel@webmail.ege.fcen.uba.ar>
Message-ID: <alpine.DEB.1.10.0906121401420.14806@talisker.c3sl.ufpr.br>

Mar?a

I will try to answer some of your questions.
Ohters will depend on the intended resulkts and may not be suitable for 
discussions hers.

> Hello Everyone
> I am making my doctorate in biology at the University of Buenos Aires,
> Argentina.
> I am working on survival and dispersal of the south american fruit fly
> (Diptera: Tephritidae), a fruit pest mainly of citrics.
> To do so I have field dispersal data (with its x,y coordinates) and have
> already perform some spatial analysis with geoR.
> My specific questions are:
> 1- Data must show normality?  What to do if even transformed data does not
> adjust?

geoR (and "standard" geostatistical practices)
assumes data with are at least nearly normally distributed
(maybe after transformation)
Counts or binary data can be modelled by other models/alternatives.
An alternative for Poisson and Binomial data is implemented in geoRglm 
package

> 2- How do I interpret the cross-validation results?

cross-validation is **one of the methods** for judging or comparing models
based on comparing observed versus prediced values.
geostats literature is quite extensive on this topic

> 3- How do I know if I need to take into account anisotropy?

In my view anisotropy parameters are higly uncertain for most applications
and should be considered specially if you have good reasons to do so.
Adittionally you can compare fitted models with and without anisotropy to
assess the  tis relevance

> 4- When to end the iteration of likfit? till stable values of estimated
> parameters?

according to the convergance criteria in the optimization functions used
and the associated methids.
The default is optim() with L-BFGS-B but others can be set
see ?optim, ?nlminb

> 5- Is it recommended to present the image of the kriging AND the one
> representing variances? how do I generate the latter?

image() methods in geoR (as for persp and contour) have a "values"
argument which can point to the kriging variances.
See exemples in ?image.kriging and also in the tutorials
available at geoR page (www.leg.ufpr.br/geoR)

> 6- Do the kriging image values have a unit, or are they arbitrary?

dependes on the model but in general in geoR the same as you variable 
being modelled (this will depend if you have set a trabsformation 
parameter for the data)

> 7- Finally, if you had to present the results (in a paper for example)
> what results/data/graphics would you choose?
>


> Hoping to recieve lots(!) of answers,
> Mar?a Eugenia
>
>
>
> Lic. Mar?a Eugenia Utg?s
> Bi?loga
> Lab. Gen?tica de Poblaciones Aplicada (GPA), Pab. 2, 4to piso, Lab. 105,
> Depto. Ecolog?a, Gen?tica y Evoluci?n (EGE)
> Fac. Cs. Exactas y Naturales (FCEyN)
> Universidad de Buenos Aires (UBA)
> Ciudad Universitaria,
> Buenos Aires, Argentina
>
> Tel.: 4576-3300, int 218
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus


From rroa at udec.cl  Fri Jun 12 21:46:27 2009
From: rroa at udec.cl (=?windows-1252?Q?Rub=E9n_Roa_Ureta?=)
Date: Fri, 12 Jun 2009 15:46:27 -0400
Subject: [R-sig-Geo] geoR questions
In-Reply-To: <b0de636fe7c6378e2d7c9eaeaa831a76.squirrel@webmail.ege.fcen.uba.ar>
References: <b0de636fe7c6378e2d7c9eaeaa831a76.squirrel@webmail.ege.fcen.uba.ar>
Message-ID: <4A32B093.9000203@udec.cl>

Mar?a Eugenia Utg?s wrote:
> ---------------------------- Original Message ----------------------------
> Subject: Presentation and a "few" Questions (geoR)
> From:    Mar?a Eugenia Utg?s <meutges at ege.fcen.uba.ar>
> Date:    Wed, June 10, 2009 5:21 pm
> To:      r-sig-geo at stat.math.ethz.ch
> --------------------------------------------------------------------------
>
>  Hello Everyone
> I am making my doctorate in biology at the University of Buenos Aires,
> Argentina.
> I am working on survival and dispersal of the south american fruit fly
> (Diptera: Tephritidae), a fruit pest mainly of citrics.
> To do so I have field dispersal data (with its x,y coordinates) and have
> already perform some spatial analysis with geoR.
> My specific questions are:
> 1- Data must show normality?  What to do if even transformed data does not
> adjust?
>   
geoR has the option to carry out a Box-Cox transform of your data so it 
will be as close to normal as data allows.
The transformation is controlled by the lambda parameter and this can be 
one of the arguments of the likelihood function.
> 2- How do I interpret the cross-validation results?
>   
What was your question?
> 3- How do I know if I need to take into account anisotropy?
>   
First, do the anysotropic variogram plot, function variog4.

> 4- When to end the iteration of likfit? till stable values of estimated
> parameters?
>   
It will end by itself, last time I checked.
> 5- Is it recommended to present the image of the kriging AND the one
> representing variances? how do I generate the latter?
>   
Krigins is only necessary if you want to make prediction, but it doesn't 
hurt to present your predictions.
What do you mean by variances? Do you mean the kriging variances?
If so, do the normal kirging and ask geoR to predict variances instead 
of predictions in the function krige.conv
> 6- Do the kriging image values have a unit, or are they arbitrary?
>   
Predictions are back-transformed from Box-Cox so they have your original 
units.
> 7- Finally, if you had to present the results (in a paper for example)
> what results/data/graphics would you choose?
>   
You can check the many papers on the subject. One of them is mine, 
Roa-Ureta and Niklitschek, 2007,
ICES Journal of Marine Science 64: 1723?1734.

Rub?n


From BRWIN338 at aol.com  Sat Jun 13 18:31:35 2009
From: BRWIN338 at aol.com (BRWIN338 at aol.com)
Date: Sat, 13 Jun 2009 12:31:35 EDT
Subject: [R-sig-Geo] Editing a shapefile
Message-ID: <c9a.2c0ca3b5.37652e67@aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090613/43eccbd2/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sat Jun 13 18:53:29 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 13 Jun 2009 17:53:29 +0100
Subject: [R-sig-Geo] Editing a shapefile
In-Reply-To: <c9a.2c0ca3b5.37652e67@aol.com>
References: <c9a.2c0ca3b5.37652e67@aol.com>
Message-ID: <d8ad40b50906130953x10e844fbr99c0d397574ad13d@mail.gmail.com>

On Sat, Jun 13, 2009 at 5:31 PM, <BRWIN338 at aol.com> wrote:
> Good Morning:
> I would like to edit the county warning area boundaries ?shapefile
> "w_15jl09.shp" downloaded from:
> _http://www.weather.gov/geodata/catalog/wsom/html/cwa.htm_
> (http://www.weather.gov/geodata/catalog/wsom/html/cwa.htm)
>
> Several of the shapefile's polygons contain extremely small "holes" that I
> would like to exclude from my plots. For example, I would like to remove
> slot 2 from the polygon for area 'RIW' ?(see below) and save the ?results in
> a new shapefile.

 You could either spend ages fiddling about manipulating sp spatial
data objects (which are lists of objects which are lists of vectors of
lists of coordinates, or similar), or you could download and install a
desktop GIS package and do it with a few clicks.

 With Quantum GIS for example, you can load a shapefile, enable
editing, click on points and delete them, even move them around
interactively, then save as a shapefile again.

 Quantum GIS is free, open-source, and crossplatform - www.qgis.org
for info. Other desktop GIS packages are available.

Barry


From moliver at udel.edu  Sat Jun 13 20:18:53 2009
From: moliver at udel.edu (Matt Oliver)
Date: Sat, 13 Jun 2009 14:18:53 -0400
Subject: [R-sig-Geo] efficiently searching surfaces
Message-ID: <6d4aad460906131118ha0088f9ja6538450110585fd@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090613/ffcaf134/attachment.pl>

From Roger.Bivand at nhh.no  Sun Jun 14 18:51:41 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 14 Jun 2009 18:51:41 +0200 (CEST)
Subject: [R-sig-Geo] Editing a shapefile
In-Reply-To: <d8ad40b50906130953x10e844fbr99c0d397574ad13d@mail.gmail.com>
References: <c9a.2c0ca3b5.37652e67@aol.com>
	<d8ad40b50906130953x10e844fbr99c0d397574ad13d@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0906141823070.22786@reclus.nhh.no>

On Sat, 13 Jun 2009, Barry Rowlingson wrote:

> On Sat, Jun 13, 2009 at 5:31 PM, <BRWIN338 at aol.com> wrote:
>> Good Morning:
>> I would like to edit the county warning area boundaries ?shapefile
>> "w_15jl09.shp" downloaded from:
>> _http://www.weather.gov/geodata/catalog/wsom/html/cwa.htm_
>> (http://www.weather.gov/geodata/catalog/wsom/html/cwa.htm)
>>
>> Several of the shapefile's polygons contain extremely small "holes" that I
>> would like to exclude from my plots. For example, I would like to remove
>> slot 2 from the polygon for area 'RIW' ?(see below) and save the ?results in
>> a new shapefile.
>
> You could either spend ages fiddling about manipulating sp spatial
> data objects (which are lists of objects which are lists of vectors of
> lists of coordinates, or similar), or you could download and install a
> desktop GIS package and do it with a few clicks.

Well, doing things programmatically rather than by editing vector data by 
hand does have its attractions, as in this case with hundreds of small 
holes in a global US data set. The recipe isn't visually attractive, but 
just uses [ls]apply() on lists, and slot() to get at the slots. I've 
chosen an area cutoff as 1.0-e07 here, which isn't very satisfactory, as 
these are geographical coordinates, so the area metric varies with 
latitude.

In addition, I haven't checked back to make sure that there were no 
islands in the lakes that we're draining. Deleting all polygons less than 
this area will possibly remove "strategic assets" in the Pacific and 
elsewhere, but for display may be justified - do you need all those 
islands? Another consideration is that the rings defined not to be holes 
might be holes, or artefacts of some kind - you'd be pushed to land a 
seagull on an island of area 6.530e-12?

# read in data and establish baseline:
library(rgdal)
w_15jl09 <- readOGR(".", "w_15jl09")
summary(w_15jl09)
polypick <- which(w_15jl09$WFO == "RIW")
holes <- sapply(slot(w_15jl09, "polygons"), function(i) sapply(slot(i,
  "Polygons"), function(j) slot(j, "hole")))
areas <- sapply(slot(w_15jl09, "polygons"), function(i) sapply(slot(i,
  "Polygons"), function(j) slot(j, "area")))
by(unlist(areas), unlist(holes), summary)
table(unlist(holes))
areas[[polypick]]
holes[[polypick]]


# the actual work begins here
# get the top-level list of Polygons objects
pls <- slot(w_15jl09, "polygons")
# run lapply along it, checking the "Polygons" slot of each for
# candidates for deletion; if any, remove:
pls1 <- lapply(pls, function(i) {
     ipls <- slot(i, "Polygons")
     holes <- sapply(ipls, slot, "hole")
     areas <- sapply(ipls, slot, "area")
     ipls1 <- !(holes & (areas < 1.0e-07))
     if(all(ipls1)) res <- i
     else res <- Polygons(ipls[ipls1], ID=slot(i, "ID"))
     res
   }
)
# reassemble
oSP <- SpatialPolygons(pls1, proj4string=CRS(proj4string(w_15jl09)))
out <- SpatialPolygonsDataFrame(oSP, data=as(w_15jl09, "data.frame"))
# export out with writeOGR, end of work

# check where we landed - does it look OK?
oholes <- sapply(slot(out, "polygons"), function(i) sapply(slot(i,
  "Polygons"), function(j) slot(j, "hole")))
oareas <- sapply(slot(out, "polygons"), function(i) sapply(slot(i,
  "Polygons"), function(j) slot(j, "area")))
by(unlist(oareas), unlist(oholes), summary)
table(unlist(oholes))
oareas[[polypick]]
oholes[[polypick]]

- for RIW certainly, but the flattened representation used for Polygon 
objects within Polygons objects doesn't let us drop lakes together with 
their possibly contained islands (but not, I think, would Simple 
Features). If need be, the Polygon objects for dropping could be checked 
to see whether other Polygon objects' label points (centroids) fall within 
them, not bullet-proof, but could be done.

I've tried to anticipate line breaks in the code example, it runs with 
this formatting for me on the specified file, but mailers do odd things, 
so line breaks may need adjusting. [ls]apply() and slot() only look 
forbidding until they save you hours, then they become really good 
friends!

Roger

>
> With Quantum GIS for example, you can load a shapefile, enable
> editing, click on points and delete them, even move them around
> interactively, then save as a shapefile again.
>
> Quantum GIS is free, open-source, and crossplatform - www.qgis.org
> for info. Other desktop GIS packages are available.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From BRWIN338 at aol.com  Mon Jun 15 07:27:42 2009
From: BRWIN338 at aol.com (BRWIN338 at aol.com)
Date: Mon, 15 Jun 2009 01:27:42 EDT
Subject: [R-sig-Geo] Editing a shapefile
Message-ID: <c83.3cc511ca.376735ce@aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090615/503619bd/attachment.pl>

From vega_l at yahoo.com  Mon Jun 15 16:16:40 2009
From: vega_l at yahoo.com (vega_l at yahoo.com)
Date: Mon, 15 Jun 2009 07:16:40 -0700 (PDT)
Subject: [R-sig-Geo] Using ME() of spdep: Is there a way to make the process
	step by step?
Message-ID: <873283.35444.qm@web110312.mail.gq1.yahoo.com>


Hello everyone, sorry for posting this besides the ecology related r list, is the first and last time I will do it. (But in the last digest of the ecology list, only my lonely message was posted, kind of discouraging)

We are trying to remove the spatial structure of our data by employing Moran Eigen Vectors with the spdep package. Our dataset is kind of large, 3694 samples and 13 variables.

The bad news: my Dual Core 2.0 MHz laptop with Ubuntu 9.04 (2.0 Gb RAM) halted after almost 4 days of continuous processing, and all the effort was lost. (Why the calculations took so much time??)

I wonder if there is a way to accelerate the calculations with ME() and to save the resulting eigenvalues as they get calculated. Or if it is possible to make the calculation process of ME() step by step.

The code in R is a follows:

taimin.xy = taimin[c("dy", "dx")];
coordinates(taimin.xy) <- ~dy+dx; #dy, dx, name of the respective
coordinate columns
coords<-coordinates(taimin.xy);
library(spdep);
TaiminGabrielGraph<-gabrielneigh(coords, nnmult = 12);
tai.gab.nb<-graph2nb(TaiminGabrielGraph,sym=TRUE);
nbtaim_distsg <- nbdists(tai.gab.nb, coords);
nbtaim_simsg <- lapply(nbtaim_distsg, function(x) (1-((x/(4*50))^2)) );
MEtaig.listw <- nb2listw(tai.gab.nb, glist=nbtaim_simsg, style="B");
sevmtaig <- ME(Presabs
~Age+Curv+Zon2005+ZoneMeiji+Wi+Sol+Slope+Seadist+Elev+Basin,data=taimin,
family=binomial,listw=MEtaig.listw)

I hope someone can give me some help.

Thank you in advance!


      ____________________________________________________________________________________
?Obt?n la mejor experiencia en la web!
Descarga gratis el nuevo Internet Explorer 8. 
http://downloads.yahoo.com/ieak8/?l=e1


From Roger.Bivand at nhh.no  Wed Jun 17 09:15:22 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 17 Jun 2009 09:15:22 +0200 (CEST)
Subject: [R-sig-Geo] Using ME() of spdep: Is there a way to make the
 process step by step?
In-Reply-To: <873283.35444.qm@web110312.mail.gq1.yahoo.com>
References: <873283.35444.qm@web110312.mail.gq1.yahoo.com>
Message-ID: <alpine.LRH.2.00.0906170850570.32691@reclus.nhh.no>

On Mon, 15 Jun 2009, vega_l at yahoo.com wrote:

>
> Hello everyone, sorry for posting this besides the ecology related r 
> list, is the first and last time I will do it. (But in the last digest 
> of the ecology list, only my lonely message was posted, kind of 
> discouraging)

(Things take time, maybe the participants were waiting for someone else 
to reply)

>
> We are trying to remove the spatial structure of our data by employing 
> Moran Eigen Vectors with the spdep package. Our dataset is kind of 
> large, 3694 samples and 13 variables.
>
> The bad news: my Dual Core 2.0 MHz laptop with Ubuntu 9.04 (2.0 Gb RAM) 
> halted after almost 4 days of continuous processing, and all the effort 
> was lost. (Why the calculations took so much time??)
>

If you read the references, you'll see that ME does a brute-force search 
among the eigenvectors, choosing them one at a time depending on the 
degree to which they reduce autocorrelation in the residuals. Solving the 
eigenproblem for a dense 3700 by 3700 matrix takes some time, but is done 
once only. However, each loop (of a maximum of 3700 loops) is doing up to 
3700 regressions and autocorrelation tests (numbers reduce as eigenvectors 
are chosen). The method has never been claimed to scale well to larger 
numbers of observations. Almost certainly, it is trying to include many 
hundred eigenvectors. In addition, the autocorrelation test is being done 
by permutation bootstrap, adding lots of extra pain. This is the was ME 
was written in the underlying papers, so this is the way it is done. The 
alternatives are any of a large variety of GLMM fits, though you probably 
have too much data for WinBUGS to help. Other GLMM will use a spatial 
correlation structured effect. Maybe look at gamm(), or gam() with a 
spline in observation coordinates from mgcv? Why use ME() with a data set 
that is too large for the method?

> I wonder if there is a way to accelerate the calculations with ME() and 
> to save the resulting eigenvalues as they get calculated. Or if it is 
> possible to make the calculation process of ME() step by step.

You can try to fake it by running ME() under debug(), saving the eV matrix 
once it has been created to the global environment (not for the 
faint-hearted). Then just run glm() in the normal way, adding combinations 
of columns of eV, and testing the results with lm.morantest(), which will 
accept a glm object, but treat it as an lm object. Whether your choice of 
colmns will be a good choice is unknown.

If you prefer to stay with ME, make sure that verbose=TRUE (default) so 
that you can see that it is running, change nsim to say 49 (questionable), 
and tighten alpha to say 0.001. Tighten alpha first a lot (1e-8) so that 
you get an error message: base correlation larger than alpha (if you don't 
get the message, stop the function), then slacken it a little, so that 
ME() stops after selecting the first few eigenvectors that reduce 
autocorrelation most. This has the disadvantage that there will be a lot 
of residual autocorrelation.

Have you tried just using the Gabriel graph for neighbours - why do you 
believe that the inverse distances should be used (apart from their use in 
the literature)? Would ME() work faster with a less informative neighbour 
definition?

Hope this helps,

Roger

>
> The code in R is a follows:
>
> taimin.xy = taimin[c("dy", "dx")];
> coordinates(taimin.xy) <- ~dy+dx; #dy, dx, name of the respective
> coordinate columns
> coords<-coordinates(taimin.xy);
> library(spdep);
> TaiminGabrielGraph<-gabrielneigh(coords, nnmult = 12);
> tai.gab.nb<-graph2nb(TaiminGabrielGraph,sym=TRUE);
> nbtaim_distsg <- nbdists(tai.gab.nb, coords);
> nbtaim_simsg <- lapply(nbtaim_distsg, function(x) (1-((x/(4*50))^2)) );
> MEtaig.listw <- nb2listw(tai.gab.nb, glist=nbtaim_simsg, style="B");
> sevmtaig <- ME(Presabs
> ~Age+Curv+Zon2005+ZoneMeiji+Wi+Sol+Slope+Seadist+Elev+Basin,data=taimin,
> family=binomial,listw=MEtaig.listw)
>
> I hope someone can give me some help.
>
> Thank you in advance!
>
>
>      ____________________________________________________________________________________
> ?Obt?n la mejor experiencia en la web!
> Descarga gratis el nuevo Internet Explorer 8.
> http://downloads.yahoo.com/ieak8/?l=e1
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From markus.loecher at gmail.com  Thu Jun 18 15:40:47 2009
From: markus.loecher at gmail.com (Markus Loecher)
Date: Thu, 18 Jun 2009 09:40:47 -0400
Subject: [R-sig-Geo] is.convex, is.monotone for polygons
Message-ID: <bf460e020906180640m66d4fff9o55177e1d525c4163@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090618/5f98d80e/attachment.pl>

From alobolistas at gmail.com  Fri Jun 19 10:42:50 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 19 Jun 2009 10:42:50 +0200
Subject: [R-sig-Geo] coordinates
Message-ID: <4A3B4F8A.9080503@gmail.com>

Hi!

When using

 > coordinates(VEGPROimas20090409punts) <- c("xc","yc")

where VEGPROimas20090409punts is a dataframe and xc, yc
column variables in the dataframe,
xc and yc are deleted from the @data table of the resultinf spdf.
I mean:

 > VEGPROimas20090409punts[1,]
   site           image     xc      yc        g    h       hg    v     N  Z
1    1 SDIM0380_L1.TIF 444088 4624897 1166.573 1340 173.4269 39.5 307.6 66
       Qh   Qv1   Qv2
1 13.182 1.415 0.667

 > coordinates(VEGPROimas20090409punts) <- c("xc","yc")

 > VEGPROimas20090409punts at data[1,]
   site           image        g    h       hg    v     N  Z     Qh   Qv1   Qv2
1    1 SDIM0380_L1.TIF 1166.573 1340 173.4269 39.5 307.6 66 13.182 1.415 0.667

Is there any way
to keep xc and yc in the @data table of the resulting spdf?
I know I can put them back, but often forget. An option might be
useful.

Thanks

Agus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090619/ee991fdc/attachment.vcf>

From Roger.Bivand at nhh.no  Fri Jun 19 11:22:34 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 19 Jun 2009 11:22:34 +0200 (CEST)
Subject: [R-sig-Geo] coordinates
In-Reply-To: <4A3B4F8A.9080503@gmail.com>
References: <4A3B4F8A.9080503@gmail.com>
Message-ID: <alpine.LRH.2.00.0906191116200.12458@reclus.nhh.no>

On Fri, 19 Jun 2009, Agustin Lobo wrote:

> Hi!
>
> When using
>
>> coordinates(VEGPROimas20090409punts) <- c("xc","yc")
>
> where VEGPROimas20090409punts is a dataframe and xc, yc
> column variables in the dataframe,
> xc and yc are deleted from the @data table of the resultinf spdf.

This is by design - they get re-instated when you coerce to data.frame. 
The obvious alternative is:

library(sp)
data(meuse)
meuse[1,]
meuse <- SpatialPointsDataFrame(SpatialPoints(cbind(meuse$x, meuse$y)),
   data=meuse)
meuse[1,]

which you could can as a function with 3 or more arguments if you like.

Roger


> I mean:
>
>> VEGPROimas20090409punts[1,]
>  site           image     xc      yc        g    h       hg    v     N  Z
> 1    1 SDIM0380_L1.TIF 444088 4624897 1166.573 1340 173.4269 39.5 307.6 66
>      Qh   Qv1   Qv2
> 1 13.182 1.415 0.667
>
>> coordinates(VEGPROimas20090409punts) <- c("xc","yc")
>
>> VEGPROimas20090409punts at data[1,]
>  site           image        g    h       hg    v     N  Z     Qh   Qv1 
> Qv2
> 1    1 SDIM0380_L1.TIF 1166.573 1340 173.4269 39.5 307.6 66 13.182 1.415 
> 0.667
>
> Is there any way
> to keep xc and yc in the @data table of the resulting spdf?
> I know I can put them back, but often forget. An option might be
> useful.
>
> Thanks
>
> Agus
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From youngbin at ua.t.u-tokyo.ac.jp  Fri Jun 19 15:00:49 2009
From: youngbin at ua.t.u-tokyo.ac.jp (youngbin)
Date: Fri, 19 Jun 2009 22:00:49 +0900
Subject: [R-sig-Geo]  Spatial Regression
In-Reply-To: <mailman.9.1245405603.19938.r-sig-geo@stat.math.ethz.ch>
Message-ID: <1245416449814402.436848963@ms004.ecc.u-tokyo.ac.jp>

Hi,

1. While conducting spatial regression models, R does not directly provide
the Rsquared values. Does anybody have an idea how to get the Pseudo
Rsquared values in spatial regression models? 

2. Regarding spatial regression models, how to conduct the general spatial
model which both the lag and error are included?

Thanks 

youngbin


From a.ghisla at gmail.com  Fri Jun 19 15:43:46 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 19 Jun 2009 15:43:46 +0200
Subject: [R-sig-Geo] [Report #4] Kriging with GRASS and R: v.autokrige port
 to wxPython and more
Message-ID: <1245419026.4106.32.camel@galadriel.uagra.net>

Hello all,

this week I made steady progress on the module.
What I've done:
* renamed the module v.krige, as its features will go beyond automatic
kriging.
* addition of choicebox with only numerical columns, as interpolation
will be based on such variables
* refactoring on interface population - more to come
* started documentation page

Next week I plan to create the splashscreen during dependencies check
and data load, and examine how to integrate gstat functions.

best regards,

Anne

http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Questa ? una parte del messaggio	firmata digitalmente
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090619/cc58149e/attachment.bin>

From nikko at hailmail.net  Fri Jun 19 17:48:20 2009
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Fri, 19 Jun 2009 08:48:20 -0700
Subject: [R-sig-Geo] is.convex, is.monotone for polygons
In-Reply-To: <mailman.9.1245405603.19938.r-sig-geo@stat.math.ethz.ch>
References: <mailman.9.1245405603.19938.r-sig-geo@stat.math.ethz.ch>
Message-ID: <1245426500.14822.1321217373@webmail.messagingengine.com>

Hi Markus,
I don't know of any packages that have an exported test for this,
but it would not be hard to write. For monotone it would probably be
better to write something a little more general that could test
if a polygon is x-monotone, y-monotone or rotationally monotone.
I would offer to write this, but I won't be able to get to it for a
while
since we are in the process of moving, and my computer will soon be
dismantled.

Nicholas

> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Thu, 18 Jun 2009 09:40:47 -0400
> From: Markus Loecher <markus.loecher at gmail.com>
> Subject: [R-sig-Geo] is.convex, is.monotone for polygons
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID:
> 	<bf460e020906180640m66d4fff9o55177e1d525c4163 at mail.gmail.com>
> Content-Type: text/plain
> 
> Dear Rgeo users,
> I am looking for a package/function which computes whether a given
> polygon
> is monotone, does that exist ?
> I'd also be interested in a function which returns TRUE if the polygon is
> convex, though that is probably very simple to code up (check every angle
> ?)
> 
> Thanks,
> 
> Markus
> 
> 	[[alternative HTML version deleted]]
> 
> 
>


From markus.loecher at gmail.com  Fri Jun 19 17:54:24 2009
From: markus.loecher at gmail.com (Markus Loecher)
Date: Fri, 19 Jun 2009 11:54:24 -0400
Subject: [R-sig-Geo] is.convex, is.monotone for polygons
In-Reply-To: <1245426500.14822.1321217373@webmail.messagingengine.com>
References: <mailman.9.1245405603.19938.r-sig-geo@stat.math.ethz.ch>
	<1245426500.14822.1321217373@webmail.messagingengine.com>
Message-ID: <bf460e020906190854l34ccaa30h37d05f11a1ff937@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090619/013be290/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jun 19 18:29:51 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 19 Jun 2009 18:29:51 +0200 (CEST)
Subject: [R-sig-Geo] Spatial Regression
In-Reply-To: <1245416449814402.436848963@ms004.ecc.u-tokyo.ac.jp>
References: <1245416449814402.436848963@ms004.ecc.u-tokyo.ac.jp>
Message-ID: <alpine.LRH.2.00.0906191630420.20869@reclus.nhh.no>

On Fri, 19 Jun 2009, youngbin wrote:

> Hi,
>
> 1. While conducting spatial regression models, R does not directly provide
> the Rsquared values. Does anybody have an idea how to get the Pseudo
> Rsquared values in spatial regression models?

The models are fitted with maximum likelihood, so R squared is not a very 
suitable measure, although I'm sure you can find various ways of computing 
them. On the other hand, you can also get the AIC and log-likelihood for 
OLS and some other models, and they also provide a way of comparing 
models.

>
> 2. Regarding spatial regression models, how to conduct the general spatial
> model which both the lag and error are included?
>

This is not provided, and is not even well understood in spatial 
statistics (there are very complicated interactions between the lag and 
error components). Spatial Durbin models do provide a general structure 
within which both lag and error models nest. If both spatial coefficients 
are significant in a general model, you know with little chance of mistake 
that your model is badly misspecified, I'm afraid. The only possible 
alternative is that you have well-motivated behavioural models for both 
processes and their interactions.

Hope this helps,

Roger

> Thanks
>
> youngbin
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Fri Jun 19 18:48:33 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 19 Jun 2009 18:48:33 +0200
Subject: [R-sig-Geo] col,row coordinates from utmx,utmy coordinates
Message-ID: <4A3BC161.8080100@gmail.com>

Hi!
Given a jpg + jpgw files I would like
to get the col,row coordinates of the jpg file
that correspond to a set of projected
utmx, utmy coordinates, best
not having to import the jpg file into R because of its size.
Does this exist within R (in raster package or any other)?
Or should I use spgrass and/or rsaga?

Thanks

Agus


-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090619/0ca76a97/attachment.vcf>

From yud at mail.montclair.edu  Sat Jun 20 04:13:22 2009
From: yud at mail.montclair.edu (Danlin Yu)
Date: Sat, 20 Jun 2009 10:13:22 +0800
Subject: [R-sig-Geo] Spatial Regression
In-Reply-To: <alpine.LRH.2.00.0906191630420.20869@reclus.nhh.no>
References: <1245416449814402.436848963@ms004.ecc.u-tokyo.ac.jp>
	<alpine.LRH.2.00.0906191630420.20869@reclus.nhh.no>
Message-ID: <fc7b9accb4d.4a3cb642@montclair.edu>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090620/60bfa6ce/attachment.html>

From alobolistas at gmail.com  Sat Jun 20 12:14:37 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sat, 20 Jun 2009 12:14:37 +0200
Subject: [R-sig-Geo] rgdal not correctly reading world file?
Message-ID: <4A3CB68D.5010008@gmail.com>

Hi!

I have a tif file along with a tifw file, the
last one stating a rotation. If I display the
tif file with a gis (i.e., qgis), the image
is correctly displayed with its rotation,
but if I use
> r <- raster("SDIM0413_L1.TIF")
> image(r)
or
> x <- GDAL.open("SDIM0413_L1.TIF")
> displayDataset(x, band=1)

the image is not rotated. Does this imply
that rgdal is ignoring the second and third
entries in the world file (thus assuming 0)?

(I've aslo done:
> r <- readGDAL("SDIM0413_L1.TIF")
SDIM0413_L1.TIF has GDAL driver GTiff
and has 1760 rows and 2640 columns

but, as r is large, cannot use image(r) )

Thanks

Agus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090620/5ca58255/attachment.vcf>

From Roger.Bivand at nhh.no  Sat Jun 20 12:26:34 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 20 Jun 2009 12:26:34 +0200 (CEST)
Subject: [R-sig-Geo] rgdal not correctly reading world file?
In-Reply-To: <4A3CB68D.5010008@gmail.com>
References: <4A3CB68D.5010008@gmail.com>
Message-ID: <alpine.LRH.2.00.0906201223330.30041@reclus.nhh.no>

On Sat, 20 Jun 2009, Agustin Lobo wrote:

> Hi!
>
> I have a tif file along with a tifw file, the
> last one stating a rotation. If I display the
> tif file with a gis (i.e., qgis), the image
> is correctly displayed with its rotation,
> but if I use
>> r <- raster("SDIM0413_L1.TIF")
>> image(r)
> or
>> x <- GDAL.open("SDIM0413_L1.TIF")
>> displayDataset(x, band=1)
>
> the image is not rotated. Does this imply
> that rgdal is ignoring the second and third
> entries in the world file (thus assuming 0)?

The underlying assumption is no rotation, so it is discarded. A new class 
would be needed for holding the data, and for display the rotated raster 
cells would have to be constructed as polygons, not the unrotated 
rectangles expected by image() or levelplot().

Roger

>
> (I've aslo done:
>> r <- readGDAL("SDIM0413_L1.TIF")
> SDIM0413_L1.TIF has GDAL driver GTiff
> and has 1760 rows and 2640 columns
>
> but, as r is large, cannot use image(r) )
>
> Thanks
>
> Agus
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Sat Jun 20 12:34:09 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sat, 20 Jun 2009 12:34:09 +0200
Subject: [R-sig-Geo] col,row coordinates from utmx,utmy coordinates
In-Reply-To: <mailman.4559.1245430185.4468.r-sig-geo@stat.math.ethz.ch>
References: <mailman.4559.1245430185.4468.r-sig-geo@stat.math.ethz.ch>
Message-ID: <4A3CBB21.3030700@gmail.com>

Solved this way:
 > comando <- "echo '443000 4626600' | gdaltransform -i SDIM0413_L1.TIF"
 > system(comando,int=T)
[1] "47.9567375239776 1012.20115995043 0"

Agus

> Hi!
> Given a jpg + jpgw files I would like
> to get the col,row coordinates of the jpg file
> that correspond to a set of projected
> utmx, utmy coordinates, best
> not having to import the jpg file into R because of its size.
> Does this exist within R (in raster package or any other)?
> Or should I use spgrass and/or rsaga?
> 
> Thanks
> 
> Agus
> 
> 
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090620/76ddd6dd/attachment.vcf>

From Roger.Bivand at nhh.no  Sat Jun 20 12:39:35 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 20 Jun 2009 12:39:35 +0200 (CEST)
Subject: [R-sig-Geo] col,row coordinates from utmx,utmy coordinates
In-Reply-To: <4A3BC161.8080100@gmail.com>
References: <4A3BC161.8080100@gmail.com>
Message-ID: <alpine.LRH.2.00.0906201233300.30041@reclus.nhh.no>

On Fri, 19 Jun 2009, Agustin Lobo wrote:

> Hi!
> Given a jpg + jpgw files I would like
> to get the col,row coordinates of the jpg file
> that correspond to a set of projected
> utmx, utmy coordinates, best
> not having to import the jpg file into R because of its size.

Try this:

library(sp)
getRowCol <- function(SG, pts) {
  o <- overlay(SG, pts)
  cd <- slot(slot(SG, "grid"), "cells.dim")
  cols <- o %% cd[1]
  rows <- cd[2] - o %/% cd[1]
  list(cols=cols, rows=rows)
}
GT <- GridTopology(c(1,1), c(1,1), c(20000, 10000))
SG <- SpatialGrid(GT)
pts <- spsample(SG, n=20, type="random")
pts
getRowCol(SG, pts)

which just depends on the definition of the raster. Watch the row numbers 
- here they follow the coordinates (lowest number at south), but maybe 
ought to have lowest number at north. This is not memory intensive.

Hope this helps,

Roger

> Does this exist within R (in raster package or any other)?
> Or should I use spgrass and/or rsaga?
>
> Thanks
>
> Agus
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Sat Jun 20 12:39:41 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sat, 20 Jun 2009 12:39:41 +0200
Subject: [R-sig-Geo] rgdal not correctly reading world file?
In-Reply-To: <alpine.LRH.2.00.0906201223330.30041@reclus.nhh.no>
References: <4A3CB68D.5010008@gmail.com>
	<alpine.LRH.2.00.0906201223330.30041@reclus.nhh.no>
Message-ID: <4A3CBC6D.3060105@gmail.com>

I see, sounds complicated. And not sure this would be of general interest.

I've been able to solve the problem
using gdaltransform through system().
Using the world files and not actually
rewriting the rotated images to disk saves
a lot of disk and time, I'm processing hundreds
of UAV images. Just adding the correct
tfw file is the best solution for an initial
positioning.

Thanks

Agus

Roger Bivand wrote:
> On Sat, 20 Jun 2009, Agustin Lobo wrote:
> 
>> Hi!
>>
>> I have a tif file along with a tifw file, the
>> last one stating a rotation. If I display the
>> tif file with a gis (i.e., qgis), the image
>> is correctly displayed with its rotation,
>> but if I use
>>> r <- raster("SDIM0413_L1.TIF")
>>> image(r)
>> or
>>> x <- GDAL.open("SDIM0413_L1.TIF")
>>> displayDataset(x, band=1)
>>
>> the image is not rotated. Does this imply
>> that rgdal is ignoring the second and third
>> entries in the world file (thus assuming 0)?
> 
> The underlying assumption is no rotation, so it is discarded. A new 
> class would be needed for holding the data, and for display the rotated 
> raster cells would have to be constructed as polygons, not the unrotated 
> rectangles expected by image() or levelplot().
> 
> Roger
> 
>>
>> (I've aslo done:
>>> r <- readGDAL("SDIM0413_L1.TIF")
>> SDIM0413_L1.TIF has GDAL driver GTiff
>> and has 1760 rows and 2640 columns
>>
>> but, as r is large, cannot use image(r) )
>>
>> Thanks
>>
>> Agus
>>
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090620/3661e3f9/attachment.vcf>

From e.jahanshiri at gmail.com  Sun Jun 21 11:20:13 2009
From: e.jahanshiri at gmail.com (Ebrahim Jahanshiri)
Date: Sun, 21 Jun 2009 13:50:13 +0430
Subject: [R-sig-Geo] Kriging with GRASS and R: Automatic trend detection
Message-ID: <b0a6ce470906210220o6cfa1afcjc9fc20d4e2787db9@mail.gmail.com>

It has been long that I wanted to suggets this for automatic trend
detection based on our previous conversations with Edzer and Anne. I
found two ways that seem to be reasonable and have potential for
automizing the trend detection ( I got these from my conversations
with Margaret Oliver and Dick Bruc both prominent soil scientists):

1-If we fit some 2D surfaces and look at the percentage variance
accounted for by the surface  . If it is much more than 25% then you
have trend that needs to be dealt with for geostatistics.

[By "fitting a surface" I think means we can use the default
parameters for just creating a surface. i dont know if we could use
other methods lik IDW for just checking]

this can be done pretty well in ArcGIS but I am sure that we could
come up with something to do it automatically and give the user the
result...

2- For detecting the order, If we fit the trend by Ordinary Least
Squares (which implies that  we assume the residuals are independent)
we can test whether the regression coefficients differ significantly
from 0.

 linear trend:

model z
fit  x, y


second order polynomial:

model z
fit x, y, xy, x2, y2

or any other order.



-- 
Ebrahim Jahanshiri


From pierces1 at msu.edu  Mon Jun 22 07:11:06 2009
From: pierces1 at msu.edu (Steven J. Pierce)
Date: Mon, 22 Jun 2009 01:11:06 -0400
Subject: [R-sig-Geo] Problem reading in polygon shapefile with readShapePoly
Message-ID: <1386A5237EB04E11A6A105F7F06B9F25@TheVoid>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090622/4ea8ad06/attachment.pl>

From Roger.Bivand at nhh.no  Mon Jun 22 08:58:57 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 22 Jun 2009 08:58:57 +0200 (CEST)
Subject: [R-sig-Geo] Problem reading in polygon shapefile with
 readShapePoly
In-Reply-To: <1386A5237EB04E11A6A105F7F06B9F25@TheVoid>
References: <1386A5237EB04E11A6A105F7F06B9F25@TheVoid>
Message-ID: <alpine.LRH.2.00.0906220840330.11267@reclus.nhh.no>

On Mon, 22 Jun 2009, Steven J. Pierce wrote:

> Hi folks,
>
> I've been trying to read a polygon shapefile I received from an ArcGIS user
> into R with the tools provided in the maptools and rgdal packages. When I
> tried reading in a file with boundaries for parcels of land, I get an error
> message that reads "Error in from[j]:to[j] : NA/NaN argument" and the
> parcels object is not created. This is similar to a situation recently
> discussed on this list (on June 10th), so I tried adding the option
> delete_null_obj=TRUE to the readShapePoly() command, but then just get a
> different error message after doing that and the object still does not get
> created. Based on the mention of rings not being closed in the new error
> message, I took a guess that maybe adding force_ring = TRUE would help, but
> that also has not solved the problem. The parcels object is still not being
> created.
>
> The shapefile seems to work just fine in ArcGIS and as part of a published
> map I can open in ArcReader.  In fact, I've got access to couple different
> parcel shapefiles and all of them generate this error, whereas all the other
> polygon shapefiles I've got access to (e.g., Census block boundaries) work
> just fine. I'd really like to get this parcel shapefile imported into R and
> stored as a SpatialPolygonsDataFrame object, so I would appreciate any
> insight you can provide on what's going wrong or suggestions on how to
> diagnose and fix the problem, whether it that requires changing my code, or
> even modifying the shapefile back in ArcGIS.
>
> Below is an excerpt from my console, with traceback() and sessionInfo()
> output at the end.

Thanks for a full report. What this is saying is that there are both 
NULL geometries that are being removed, and in addition there appear 
to be non-closed rings even when the force_ring policy is being used.

Without access to the file, I'm afraid that finding a solution is not 
feasible. If you can zip the parcel_mast_20050802.* files (and possibly 
others with the same problem) and put them online, and send me the URL 
off-list, or attach the zip archive if < 2MB, I'll have a look. I have an 
as-yet unreleased version of maptools that may be able to handle this 
case, but seeing the offending files would be very useful.

Hope this helps,

Roger

>
>> parcels <- readShapePoly("Parcels Shapefile/parcel_mast_20050802.shp",
> +                        proj4string = CRS(parcels.proj4), verbose=TRUE,
> +                        delete_null_obj=TRUE, force_ring=TRUE)
> Shapefile type: Polygon, (5), # of Shapes: 21842
> Error in validityMethod(object) : ring not closed
> In addition: Warning message:
> In .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring =
> force_ring,  :
>  Null objects with the following indices deleted: 8519, 9096, 9528, 13665,
> 15880
>> traceback()
> 13: stop("ring not closed")
> 12: validityMethod(object)
> 11: identical(x, TRUE)
> 10: anyStrings(validityMethod(object))
> 9: validObject(.Object)
> 8: initialize(value, ...)
> 7: initialize(value, ...)
> 6: new("Polygon", sl, labpt = cG$cents, area = cG$area, hole =
> as.logical(hole),
>       ringDir = as.integer(rD))
> 5: Polygon(coords = crds)
> 4: .shp2srsI(shapes[[belongs[[i]][j]]],
> .nParts.shpI(shapes[[belongs[[i]][j]]]),
>       force_ring = force_ring)
> 3: .asSpatialPolygonsShapes(Map$Shapes, IDs, proj4string = proj4string,
>       force_ring = force_ring)
> 2: .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring =
> force_ring,
>       delete_null_obj = delete_null_obj, retrieve_ABS_null =
> retrieve_ABS_null)
> 1: readShapePoly("Parcels Shapefile/parcel_mast_20050802.shp", proj4string =
> CRS(parcels.proj4),
>       verbose = TRUE, delete_null_obj = TRUE, force_ring = TRUE)
>> is.projected(parcels)
> Error in extends(class(sd), "Spatial") : object 'parcels' not found
>>
>> sessionInfo()
> R version 2.9.0 (2009-04-17)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-4    mgcv_1.5-5
> [5] rgdal_0.6-8     maptools_0.7-23 sp_0.9-37       foreign_0.8-36
>
> loaded via a namespace (and not attached):
> [1] grid_2.9.0      lattice_0.17-25 nlme_3.1-92
>
>
> Steven J. Pierce
> Center for Statistical Training & Consulting (CSTAT)
> Michigan State University
> Web: http://www.cstat.msu.edu
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Mon Jun 22 11:23:41 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 22 Jun 2009 11:23:41 +0200
Subject: [R-sig-Geo] coordinates
In-Reply-To: <4A3B4F8A.9080503@gmail.com>
References: <4A3B4F8A.9080503@gmail.com>
Message-ID: <4A3F4D9D.3040007@uni-muenster.de>

I think the construction

coordinates(VEGPROimas20090409punts) <-
VEGPROimas20090409punts[c("xc","yc")]

does replicate them, instead of moving them from the data.frame to the
coords slot.

also, the back-transform,

as.data.frame(VEGPROimas20090409punts)

should put them back.
--
Edzer

Agustin Lobo wrote:
> Hi!
>
> When using
>
> > coordinates(VEGPROimas20090409punts) <- c("xc","yc")
>
> where VEGPROimas20090409punts is a dataframe and xc, yc
> column variables in the dataframe,
> xc and yc are deleted from the @data table of the resultinf spdf.
> I mean:
>
> > VEGPROimas20090409punts[1,]
>   site           image     xc      yc        g    h       hg    v    
> N  Z
> 1    1 SDIM0380_L1.TIF 444088 4624897 1166.573 1340 173.4269 39.5
> 307.6 66
>       Qh   Qv1   Qv2
> 1 13.182 1.415 0.667
>
> > coordinates(VEGPROimas20090409punts) <- c("xc","yc")
>
> > VEGPROimas20090409punts at data[1,]
>   site           image        g    h       hg    v     N  Z     Qh  
> Qv1   Qv2
> 1    1 SDIM0380_L1.TIF 1166.573 1340 173.4269 39.5 307.6 66 13.182
> 1.415 0.667
>
> Is there any way
> to keep xc and yc in the @data table of the resulting spdf?
> I know I can put them back, but often forget. An option might be
> useful.
>
> Thanks
>
> Agus
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From p.w.van.horssen at buwa.nl  Mon Jun 22 16:12:09 2009
From: p.w.van.horssen at buwa.nl (Peter van Horssen)
Date: Mon, 22 Jun 2009 16:12:09 +0200
Subject: [R-sig-Geo] Question raster package
Message-ID: <4A3F9139.7040408@buwa.nl>

I have a raster object with 3 bands:
(How) Can I obtain the info for each different band ?
Can I use a command like reclass on all three bands (with different 
classification definitions
for each band) ?

thanks in advance,

Peter


-- 
================================
Peter van Horssen
Bureau Waardenburg bv
Adviseurs voor ecologie & milieu
Postbus 365
4100 AJ Culemborg
Tel: 0345-512710
Fax: 0345-519849
e-mail: p.w.van.horssen at buwa.nl
================================

---------------------------- DISCLAIMER -------------------------- 
De informatie verzonden met dit e-mail bericht is uitsluitend bestemd voor de geadresseerde. Openbaarmaking, vermenigvuldiging, verspreiding en/of verstrekking aan derden is niet toegestaan. Gebruik van deze informatie door anderen dan de geadresseerde is verboden. U wordt verzocht bij onjuiste adressering de afzender direct te informeren door het bericht te retourneren.


From pierces1 at msu.edu  Mon Jun 22 16:15:20 2009
From: pierces1 at msu.edu (Steven J. Pierce)
Date: Mon, 22 Jun 2009 10:15:20 -0400
Subject: [R-sig-Geo] Problem reading in polygon shapefile with
	readShapePoly
In-Reply-To: <alpine.LRH.2.00.0906220840330.11267@reclus.nhh.no>
References: <1386A5237EB04E11A6A105F7F06B9F25@TheVoid>
	<alpine.LRH.2.00.0906220840330.11267@reclus.nhh.no>
Message-ID: <B5E27866C35D4AB69E8D98F0A800DDB8@TheVoid>

Roger,

I'll send you a link off-list to where you can download a zip file with
those files. In the meantime, here's a bit of context about the source of
the data: The parcel data originates from the office of a small city's tax
assessor. The PIN column in the .DBF file contains what is supposed to be a
unique ID for each parcel of land. The rest of the data largely contain the
info about the address of the property represented by the parcel, the zoning
codes and property class for the parcel, and info about the taxpayer
responsible for the property taxes on that parcel.

Thank you for your assistance. 


Steven J. Pierce
Center for Statistical Training & Consulting (CSTAT)
Michigan State University
Web: http://www.cstat.msu.edu


-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Monday, June 22, 2009 2:59 AM
To: Steven J. Pierce
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Problem reading in polygon shapefile with
readShapePoly

On Mon, 22 Jun 2009, Steven J. Pierce wrote:

> Hi folks,
>
> I've been trying to read a polygon shapefile I received from an ArcGIS 
> user into R with the tools provided in the maptools and rgdal 
> packages. When I tried reading in a file with boundaries for parcels 
> of land, I get an error message that reads "Error in from[j]:to[j] : 
> NA/NaN argument" and the parcels object is not created. This is 
> similar to a situation recently discussed on this list (on June 10th), 
> so I tried adding the option delete_null_obj=TRUE to the 
> readShapePoly() command, but then just get a different error message 
> after doing that and the object still does not get created. Based on 
> the mention of rings not being closed in the new error message, I took 
> a guess that maybe adding force_ring = TRUE would help, but that also 
> has not solved the problem. The parcels object is still not being created.
>
> The shapefile seems to work just fine in ArcGIS and as part of a 
> published map I can open in ArcReader.  In fact, I've got access to 
> couple different parcel shapefiles and all of them generate this 
> error, whereas all the other polygon shapefiles I've got access to 
> (e.g., Census block boundaries) work just fine. I'd really like to get 
> this parcel shapefile imported into R and stored as a 
> SpatialPolygonsDataFrame object, so I would appreciate any insight you 
> can provide on what's going wrong or suggestions on how to diagnose 
> and fix the problem, whether it that requires changing my code, or even
modifying the shapefile back in ArcGIS.
>
> Below is an excerpt from my console, with traceback() and 
> sessionInfo() output at the end.

Thanks for a full report. What this is saying is that there are both NULL
geometries that are being removed, and in addition there appear to be
non-closed rings even when the force_ring policy is being used.

Without access to the file, I'm afraid that finding a solution is not
feasible. If you can zip the parcel_mast_20050802.* files (and possibly
others with the same problem) and put them online, and send me the URL
off-list, or attach the zip archive if < 2MB, I'll have a look. I have an
as-yet unreleased version of maptools that may be able to handle this case,
but seeing the offending files would be very useful.

Hope this helps,

Roger

>
>> parcels <- readShapePoly("Parcels 
>> Shapefile/parcel_mast_20050802.shp",
> +                        proj4string = CRS(parcels.proj4), verbose=TRUE,
> +                        delete_null_obj=TRUE, force_ring=TRUE)
> Shapefile type: Polygon, (5), # of Shapes: 21842 Error in 
> validityMethod(object) : ring not closed In addition: Warning message:
> In .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring 
> = force_ring,  :
>  Null objects with the following indices deleted: 8519, 9096, 9528, 
> 13665, 15880
>> traceback()
> 13: stop("ring not closed")
> 12: validityMethod(object)
> 11: identical(x, TRUE)
> 10: anyStrings(validityMethod(object))
> 9: validObject(.Object)
> 8: initialize(value, ...)
> 7: initialize(value, ...)
> 6: new("Polygon", sl, labpt = cG$cents, area = cG$area, hole = 
> as.logical(hole),
>       ringDir = as.integer(rD))
> 5: Polygon(coords = crds)
> 4: .shp2srsI(shapes[[belongs[[i]][j]]],
> .nParts.shpI(shapes[[belongs[[i]][j]]]),
>       force_ring = force_ring)
> 3: .asSpatialPolygonsShapes(Map$Shapes, IDs, proj4string = proj4string,
>       force_ring = force_ring)
> 2: .Map2PolyDF(Map, IDs = IDvar, proj4string = proj4string, force_ring 
> = force_ring,
>       delete_null_obj = delete_null_obj, retrieve_ABS_null =
> retrieve_ABS_null)
> 1: readShapePoly("Parcels Shapefile/parcel_mast_20050802.shp", 
> proj4string = CRS(parcels.proj4),
>       verbose = TRUE, delete_null_obj = TRUE, force_ring = TRUE)
>> is.projected(parcels)
> Error in extends(class(sd), "Spatial") : object 'parcels' not found
>>
>> sessionInfo()
> R version 2.9.0 (2009-04-17)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spatstat_1.15-3 deldir_0.0-8    gpclib_1.4-4    mgcv_1.5-5
> [5] rgdal_0.6-8     maptools_0.7-23 sp_0.9-37       foreign_0.8-36
>
> loaded via a namespace (and not attached):
> [1] grid_2.9.0      lattice_0.17-25 nlme_3.1-92
>
>
> Steven J. Pierce
> Center for Statistical Training & Consulting (CSTAT) Michigan State 
> University
> Web: http://www.cstat.msu.edu
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Mon Jun 22 17:23:19 2009
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Mon, 22 Jun 2009 17:23:19 +0200
Subject: [R-sig-Geo] Question raster package
In-Reply-To: <4A3F9139.7040408@buwa.nl>
References: <4A3F9139.7040408@buwa.nl>
Message-ID: <dc22b2570906220823l66273de4pa1c9b49cea2dba0d@mail.gmail.com>

Peter,

You can create a separate RasterLayer object for each band:

fn <- 'myfile.ext'
r1 <- raster(fn, band=1)
r2 <- raster(fn, band=2)
r3 <- raster(fn, band=3)


you can also first create a RasterStack of all bands
s <- stack(fn, bands=-1)
and then extract a RasterLayer whenever you want it
r <- raster(s, layer=1)

Robert



2009/6/22 Peter van Horssen <p.w.van.horssen at buwa.nl>:
> I have a raster object with 3 bands:
> (How) Can I obtain the info for each different band ?
> Can I use a command like reclass on all three bands (with different
> classification definitions
> for each band) ?
>
> thanks in advance,
>
> Peter
>
>
> --
> ================================
> Peter van Horssen
> Bureau Waardenburg bv
> Adviseurs voor ecologie & milieu
> Postbus 365
> 4100 AJ Culemborg
> Tel: 0345-512710
> Fax: 0345-519849
> e-mail: p.w.van.horssen at buwa.nl
> ================================
>
> ---------------------------- DISCLAIMER -------------------------- De
> informatie verzonden met dit e-mail bericht is uitsluitend bestemd voor de
> geadresseerde. Openbaarmaking, vermenigvuldiging, verspreiding en/of
> verstrekking aan derden is niet toegestaan. Gebruik van deze informatie door
> anderen dan de geadresseerde is verboden. U wordt verzocht bij onjuiste
> adressering de afzender direct te informeren door het bericht te
> retourneren.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From debeaudette at ucdavis.edu  Mon Jun 22 17:57:19 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Mon, 22 Jun 2009 08:57:19 -0700
Subject: [R-sig-Geo] Kriging with GRASS and R: Automatic trend detection
In-Reply-To: <b0a6ce470906210220o6cfa1afcjc9fc20d4e2787db9@mail.gmail.com>
References: <b0a6ce470906210220o6cfa1afcjc9fc20d4e2787db9@mail.gmail.com>
Message-ID: <200906220857.19891.dylan.beaudette@gmail.com>

On Sunday 21 June 2009, Ebrahim Jahanshiri wrote:
> It has been long that I wanted to suggets this for automatic trend
> detection based on our previous conversations with Edzer and Anne. I
> found two ways that seem to be reasonable and have potential for
> automizing the trend detection ( I got these from my conversations
> with Margaret Oliver and Dick Bruc both prominent soil scientists):
>
> 1-If we fit some 2D surfaces and look at the percentage variance
> accounted for by the surface  . If it is much more than 25% then you
> have trend that needs to be dealt with for geostatistics.
>
> [By "fitting a surface" I think means we can use the default
> parameters for just creating a surface. i dont know if we could use
> other methods lik IDW for just checking]
>
> this can be done pretty well in ArcGIS but I am sure that we could
> come up with something to do it automatically and give the user the
> result...
>
> 2- For detecting the order, If we fit the trend by Ordinary Least
> Squares (which implies that  we assume the residuals are independent)
> we can test whether the regression coefficients differ significantly
> from 0.
>
>  linear trend:
>
> model z
> fit  x, y
>
>
> second order polynomial:
>
> model z
> fit x, y, xy, x2, y2
>
> or any other order.

Good ideas and nice to see prominent soil scientists contributing to the 
conversation!

As for an approach towards automatic trend detection: we may be able to skip 
parametric specification of the trend (i.e. poly(2,3,4,5, ...)) by using some 
kind of smoother: restricted cubic splines comes to mind (see rcs() in the 
Design package). The script could then check the various elements of an RCS 
fit for a pre-defined amount of variance explained in order to suggest 
trend-removal.

Cheers,
Dylan

-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From jean-paul.kibambe at uclouvain.be  Mon Jun 22 18:32:56 2009
From: jean-paul.kibambe at uclouvain.be (Jean-Paul Kibambe Lubamba)
Date: Mon, 22 Jun 2009 18:32:56 +0200
Subject: [R-sig-Geo] Any idea to do the following?
Message-ID: <37eec726675da6017933ac4fc8adc80f.squirrel@mmp.sipr-dc.ucl.ac.be>

Hi All,

Does anyone could help me to find the right way to do the following:

I fixed this linear model: lm(Obs~ A1 + A2  + A3 + A4 -1, data=data);
where Ai are land cover classes areas.

I have then the Ai coefficients, the structure of the residuals (it can be
approximated by a normal distribution), the confidence intervals, etc.

As a second step, given the results of the regression model, I want to
find for each 'Obs' the better combination of Ai coefficients which
minimize the residuals. My thoughts are to use the distribution of the
residuals of the regression model and the confidence intervals to do that.
Does anyone could tell me how I could manage that? Any help is welcomed !

I am right now try to solve this using the lme function, but may be I am
getting wrong!

Thanks in advance,


Jean-Paul


From pierces1 at msu.edu  Mon Jun 22 20:02:59 2009
From: pierces1 at msu.edu (Steven J. Pierce)
Date: Mon, 22 Jun 2009 14:02:59 -0400
Subject: [R-sig-Geo] Problem reading in polygon shapefile with
	readShapePoly
In-Reply-To: <alpine.LRH.2.00.0906221923580.12168@reclus.nhh.no>
References: <1386A5237EB04E11A6A105F7F06B9F25@TheVoid>
	<alpine.LRH.2.00.0906220840330.11267@reclus.nhh.no>
	<1F9F6D8CDEC94B328C0E066F6F843D33@TheVoid>
	<alpine.LRH.2.00.0906221923580.12168@reclus.nhh.no>
Message-ID: <EA9960BC49C3445F9FE02D4FEA9447FB@TheVoid>

Roger,

That worked. I successfully read in the file and plotted the resulting
parcels object. Onward with my dissertation work! Thanks for responding so
rapidly and for generously sharing your time and expertise. 


Steven J. Pierce
Center for Statistical Training & Consulting (CSTAT)
Michigan State University
Web: http://www.cstat.msu.edu


-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Monday, June 22, 2009 1:29 PM
To: Steven J. Pierce
Subject: RE: [R-sig-Geo] Problem reading in polygon shapefile with
readShapePoly

On Mon, 22 Jun 2009, Steven J. Pierce wrote:

> Roger,
>
> I posted a zip file containing that set of shapefiles at 
> [link removed]. Thank you 
> so much for taking a look at this.

Steven,

Please try this draft package:

http://spatial.nhh.no/R/Devel/maptools_0.7-25.zip

It worked for me on your example file. The tests inside readShapePoly were
for ring closure using all.equal(), which permits a very small amount of
machine fuzz, but in the Polygon class are identical(); this in addition to
changes made after the reports about June 10. I've imposed identical() in
both places, so the forcing policy now also forces ring closure on rings
that were closed within machine precision, but not bit-identical first and
last coordinates.

Please let me know if this resolves your problem, if so, I'll release.

Best wishes,

Roger

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Jun 22 20:06:22 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 22 Jun 2009 20:06:22 +0200 (CEST)
Subject: [R-sig-Geo] Problem reading in polygon shapefile with
 readShapePoly
In-Reply-To: <EA9960BC49C3445F9FE02D4FEA9447FB@TheVoid>
References: <1386A5237EB04E11A6A105F7F06B9F25@TheVoid>
	<alpine.LRH.2.00.0906220840330.11267@reclus.nhh.no>
	<1F9F6D8CDEC94B328C0E066F6F843D33@TheVoid>
	<alpine.LRH.2.00.0906221923580.12168@reclus.nhh.no>
	<EA9960BC49C3445F9FE02D4FEA9447FB@TheVoid>
Message-ID: <alpine.LRH.2.00.0906222004510.12861@reclus.nhh.no>

On Mon, 22 Jun 2009, Steven J. Pierce wrote:

> Roger,
>
> That worked. I successfully read in the file and plotted the resulting
> parcels object. Onward with my dissertation work! Thanks for responding so
> rapidly and for generously sharing your time and expertise.

Steven,

Your report was very thorough, making the data available helped too. The 
revised version of maptools will be submitted to CRAN this evening.

Best wishes,

Roger

>
>
> Steven J. Pierce
> Center for Statistical Training & Consulting (CSTAT)
> Michigan State University
> Web: http://www.cstat.msu.edu
>
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Monday, June 22, 2009 1:29 PM
> To: Steven J. Pierce
> Subject: RE: [R-sig-Geo] Problem reading in polygon shapefile with
> readShapePoly
>
> On Mon, 22 Jun 2009, Steven J. Pierce wrote:
>
>> Roger,
>>
>> I posted a zip file containing that set of shapefiles at
>> [link removed]. Thank you
>> so much for taking a look at this.
>
> Steven,
>
> Please try this draft package:
>
> http://spatial.nhh.no/R/Devel/maptools_0.7-25.zip
>
> It worked for me on your example file. The tests inside readShapePoly were
> for ring closure using all.equal(), which permits a very small amount of
> machine fuzz, but in the Polygon class are identical(); this in addition to
> changes made after the reports about June 10. I've imposed identical() in
> both places, so the forcing policy now also forces ring closure on rings
> that were closed within machine precision, but not bit-identical first and
> last coordinates.
>
> Please let me know if this resolves your problem, if so, I'll release.
>
> Best wishes,
>
> Roger
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gylcheong at gmail.com  Tue Jun 23 07:54:43 2009
From: gylcheong at gmail.com (cheong yoon ling)
Date: Mon, 22 Jun 2009 22:54:43 -0700
Subject: [R-sig-Geo] Reading Shapefile from 600 directories
Message-ID: <e396db730906222254m5b5f7a7cn20c1a65ec9a619f@mail.gmail.com>

Hi!

I am wondering how to read shapefiles from 600 respective folders at
one shot? The name of the shapefile is the same thoroughly. The name
of the 600 folders is indexed in a main autocad .dwg file.

Thanks a lot

Grace


From Roger.Bivand at nhh.no  Tue Jun 23 11:22:20 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 23 Jun 2009 11:22:20 +0200 (CEST)
Subject: [R-sig-Geo] Reading Shapefile from 600 directories
In-Reply-To: <e396db730906222254m5b5f7a7cn20c1a65ec9a619f@mail.gmail.com>
References: <e396db730906222254m5b5f7a7cn20c1a65ec9a619f@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0906231117050.20739@reclus.nhh.no>

On Mon, 22 Jun 2009, cheong yoon ling wrote:

> Hi!
>
> I am wondering how to read shapefiles from 600 respective folders at
> one shot? The name of the shapefile is the same thoroughly. The name
> of the 600 folders is indexed in a main autocad .dwg file.

If you can read the list of folders in appropriate software, and pass it 
into R as a character vector, yes, of course. Note that the .dwg formats 
are proprietary and cannot be read in R - can you discover the folder 
names in any other way? Are there shapefiles with the same name in other 
folders, or can you just search the file system for the target shapefile 
name? Once you have the vector of folder names, just loop over them using 
your choice of shapefile reading function and prefered object class in R 
(packages rgdal, maptools, maybe others too). Your choice will depend on 
why you want to read them in.

Roger


>
> Thanks a lot
>
> Grace
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From p.w.van.horssen at buwa.nl  Tue Jun 23 12:24:40 2009
From: p.w.van.horssen at buwa.nl (Peter van Horssen)
Date: Tue, 23 Jun 2009 12:24:40 +0200
Subject: [R-sig-Geo] Question raster package
In-Reply-To: <dc22b2570906220823l66273de4pa1c9b49cea2dba0d@mail.gmail.com>
References: <4A3F9139.7040408@buwa.nl>
	<dc22b2570906220823l66273de4pa1c9b49cea2dba0d@mail.gmail.com>
Message-ID: <4A40AD68.7070101@buwa.nl>

Thanks Robert,
so actualy bands ~ layers .... ;-)

I tried your 2nd example ; raster(s, layer = 1 ) but this failes.
-----------------
 > raster(s, layer=1)
Error in .local(x, ...) : unused argument(s) (layer = 1)
-----------------

however raster(s,c(1)) works:

-------------------------
 > raster(s,c(1))
class       : RasterLayer
filename    : test
band        : 1
nrow        : 1024
ncol        : 1280
ncells      : 1310720
min value   : 0
max value   : 255
projection  : NA
xmin        : 0
xmax        : 1280
ymin        : 1
ymax        : 1025
xres        : 1
yres        : 1
-------------------------


(raster version 0.8.9-21 (23-May-2009);  R 2.8.1 on win XP)

I guess commands (like reclass etc) need to be applied seperately to 
each layer.

Peter


Robert Hijmans schreef:
> Peter,
>
> You can create a separate RasterLayer object for each band:
>
> fn <- 'myfile.ext'
> r1 <- raster(fn, band=1)
> r2 <- raster(fn, band=2)
> r3 <- raster(fn, band=3)
>
>
> you can also first create a RasterStack of all bands
> s <- stack(fn, bands=-1)
> and then extract a RasterLayer whenever you want it
> r <- raster(s, layer=1)
>
> Robert
>
>
>
> 2009/6/22 Peter van Horssen <p.w.van.horssen at buwa.nl>:
>   
>> I have a raster object with 3 bands:
>> (How) Can I obtain the info for each different band ?
>> Can I use a command like reclass on all three bands (with different
>> classification definitions
>> for each band) ?
>>
>> thanks in advance,
>>
>> Peter
>>
>>
>> --
>> ================================
>> Peter van Horssen
>> Bureau Waardenburg bv
>> Adviseurs voor ecologie & milieu
>> Postbus 365
>> 4100 AJ Culemborg
>> Tel: 0345-512710
>> Fax: 0345-519849
>> e-mail: p.w.van.horssen at buwa.nl
>> ================================
>>
>> ---------------------------- DISCLAIMER -------------------------- De
>> informatie verzonden met dit e-mail bericht is uitsluitend bestemd voor de
>> geadresseerde. Openbaarmaking, vermenigvuldiging, verspreiding en/of
>> verstrekking aan derden is niet toegestaan. Gebruik van deze informatie door
>> anderen dan de geadresseerde is verboden. U wordt verzocht bij onjuiste
>> adressering de afzender direct te informeren door het bericht te
>> retourneren.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>
>   


-- 
================================
Peter van Horssen
Bureau Waardenburg bv
Adviseurs voor ecologie & milieu
Postbus 365
4100 AJ Culemborg
Tel: 0345-512710
Fax: 0345-519849
e-mail: p.w.van.horssen at buwa.nl
================================

---------------------------- DISCLAIMER -------------------------- 
De informatie verzonden met dit e-mail bericht is uitsluitend bestemd voor de geadresseerde. Openbaarmaking, vermenigvuldiging, verspreiding en/of verstrekking aan derden is niet toegestaan. Gebruik van deze informatie door anderen dan de geadresseerde is verboden. U wordt verzocht bij onjuiste adressering de afzender direct te informeren door het bericht te retourneren.


From milton.ruser at gmail.com  Tue Jun 23 17:18:31 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Tue, 23 Jun 2009 11:18:31 -0400
Subject: [R-sig-Geo] Question raster package
In-Reply-To: <4A40AD68.7070101@buwa.nl>
References: <4A3F9139.7040408@buwa.nl>
	<dc22b2570906220823l66273de4pa1c9b49cea2dba0d@mail.gmail.com>
	<4A40AD68.7070101@buwa.nl>
Message-ID: <3aaf1a030906230818k68e0a9fbide2377360143a509@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090623/8946fdb5/attachment.pl>

From adriantoti at gmail.com  Tue Jun 23 20:56:38 2009
From: adriantoti at gmail.com (Adrian Toti)
Date: Tue, 23 Jun 2009 14:56:38 -0400
Subject: [R-sig-Geo] Spatial Regression
In-Reply-To: <alpine.LRH.2.00.0906191630420.20869@reclus.nhh.no>
References: <1245416449814402.436848963@ms004.ecc.u-tokyo.ac.jp>
	<alpine.LRH.2.00.0906191630420.20869@reclus.nhh.no>
Message-ID: <d8e1ff280906231156j2eef8dc7y8d239cd4dd91c1cc@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090623/38d4a908/attachment.pl>

From Roger.Bivand at nhh.no  Tue Jun 23 22:53:48 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 23 Jun 2009 22:53:48 +0200 (CEST)
Subject: [R-sig-Geo] Spatial Regression
In-Reply-To: <d8e1ff280906231156j2eef8dc7y8d239cd4dd91c1cc@mail.gmail.com>
References: <1245416449814402.436848963@ms004.ecc.u-tokyo.ac.jp>
	<alpine.LRH.2.00.0906191630420.20869@reclus.nhh.no>
	<d8e1ff280906231156j2eef8dc7y8d239cd4dd91c1cc@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0906232241220.29471@reclus.nhh.no>

On Tue, 23 Jun 2009, Adrian Toti wrote:

> Hi Roger,
>
> You wrote: "If both spatial coefficients are significant in a general model,
> you know with little chance of mistake that your model is badly
> misspecified".
> I am assuming that you mean the Rho coefficient (lagged dependent) and the
> lagged coefficients (for the independent variables) in the spatial Durbin
> model.

No, the original questioner was thinking of a model like:

y = \rho W y + X \beta + u

u = \lambda W u + e

with both a lag coefficient \rho and an error coefficient \lambda. You end 
up with a messy interaction between the \rho and \lambda terms, something 
like:

(I - \rho W) (I - \lambda W) y = (I - \lambda W) X \beta + e

or

y = (I - \rho W)^{-1} X \beta + (I - \rho W)^{-1} (I - \lambda W)^{-1} e

> What about a situation where using lm.LMtests function one can make a
> decision for a lag or error model but using spatial Durbin model in any
> situation (meaning when error or lag is a better fit) the lagged dependent
> and some of the lagged independent are significant?  So does that still mean
> that the model is misspecified?
>
> Another information if it can be helpful: when I compare the spatial Durbin
> fit with with the error or lag and use LR.sarlm to compare the
> models, Durbin model shows always a better fit.
>

Yes, they often do, but comparing the AIC values may prefer the lag or 
error models because adding extra variables is penalised.

Roger

> Thanks,
>
> Adrian
>
>
> On Fri, Jun 19, 2009 at 12:29 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Fri, 19 Jun 2009, youngbin wrote:
>>
>> Hi,
>>>
>>> 1. While conducting spatial regression models, R does not directly provide
>>> the Rsquared values. Does anybody have an idea how to get the Pseudo
>>> Rsquared values in spatial regression models?
>>>
>>
>> The models are fitted with maximum likelihood, so R squared is not a very
>> suitable measure, although I'm sure you can find various ways of computing
>> them. On the other hand, you can also get the AIC and log-likelihood for OLS
>> and some other models, and they also provide a way of comparing models.
>>
>>
>>> 2. Regarding spatial regression models, how to conduct the general spatial
>>> model which both the lag and error are included?
>>>
>>>
>> This is not provided, and is not even well understood in spatial statistics
>> (there are very complicated interactions between the lag and error
>> components). Spatial Durbin models do provide a general structure within
>> which both lag and error models nest. If both spatial coefficients are
>> significant in a general model, you know with little chance of mistake that
>> your model is badly misspecified, I'm afraid. The only possible alternative
>> is that you have well-motivated behavioural models for both processes and
>> their interactions.
>>
>> Hope this helps,
>>
>> Roger
>>
>> Thanks
>>>
>>> youngbin
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From adriantoti at gmail.com  Thu Jun 25 17:30:03 2009
From: adriantoti at gmail.com (Adrian Toti)
Date: Thu, 25 Jun 2009 11:30:03 -0400
Subject: [R-sig-Geo] Spatial regression
In-Reply-To: <alpine.LRH.2.00.0906090901310.23627@reclus.nhh.no>
References: <d8e1ff280905291127g2d4a13f6ie985782faa13f659@mail.gmail.com>
	<alpine.LRH.2.00.0906061913260.8949@reclus.nhh.no>
	<d8e1ff280906081029jd20c0a0pfcc6084d52f287d8@mail.gmail.com>
	<alpine.LRH.2.00.0906090901310.23627@reclus.nhh.no>
Message-ID: <d8e1ff280906250830v66a666d8kb6b054746f7d2c92@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090625/73144201/attachment.pl>

From reyman64 at gmail.com  Thu Jun 25 23:50:42 2009
From: reyman64 at gmail.com (reyman)
Date: Thu, 25 Jun 2009 23:50:42 +0200
Subject: [R-sig-Geo] Problem with data and representation of a complex
	timeseries ( R + Postgress + Rpy)
Message-ID: <e4d374230906251450m57c6d2a9m6bfdee802a92e63f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090625/177d42fd/attachment.pl>

From marburga at landcareresearch.co.nz  Fri Jun 26 03:39:53 2009
From: marburga at landcareresearch.co.nz (Anna Marburg)
Date: Fri, 26 Jun 2009 13:39:53 +1200
Subject: [R-sig-Geo] Can you recommend a geostatistics text?
Message-ID: <F79A9994-7EAF-4122-8A38-F35C25C44D23@landcareresearch.co.nz>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090626/da7ab1c7/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jun 26 08:40:42 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 26 Jun 2009 08:40:42 +0200 (CEST)
Subject: [R-sig-Geo] Problem with data and representation of a complex
 timeseries ( R + Postgress + Rpy)
In-Reply-To: <e4d374230906251450m57c6d2a9m6bfdee802a92e63f@mail.gmail.com>
References: <e4d374230906251450m57c6d2a9m6bfdee802a92e63f@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0906260835500.8603@reclus.nhh.no>

On Thu, 25 Jun 2009, reyman wrote:

> Hey guys,
>
> I have problem with data stockage of timeline series. I'm trying to explain
> you...

Please try reshape() after studying its help page carefully. Try a small 
example first. It will let you switch between your long representation 
where pop (and rank) vary by year, and a wide representation, with 
pop_year and rank_year with cities as rows. This question could have been 
sent to R-help, and it would be (much) easier to follow if you dropped 
PostgreSQL and rpy, they are not your problem - your problem is reshaping 
the data to run T years' analyses on data which are now in the long 
representation.

Alternatively, select each time slice separately and analyse just that.

Roger

>
> *At the end, i want a rank-size by date (1600 - 2000) for the 1000 biggest
> city of a simulation*
>
> First in my db have two columns wich interest me : population, date
>
> With "Rpy" and "rdbiPgSql" , i make this query (for example) :
>> Select v_date, v_pop from data where date = 1650 order by v_pop limit 1000
> So i want in first time the 1000 biggest city for one date ..
>
> In result, i have a dataframe like this :
>
> v_pop      | v_date
> 15000      1650
> 10000      1650
> 5000        1650
> .....etc
>
> For the rank size, i need to create a rank, so i use the rank(
> MyDataframe$v_pop ) function in R
>
> v_pop      | v_date     | rank
> 15000      1650         1
> 10000       1650        2
> 5000         1650        3
>
> Next, i have many problem to resolve (for a beginer like me ... ouch)
>
> a) i need to create a timeline serie with this dataframe, in this order ...
> but v_date existe already ..
> b) i need to complete this dataframe with all of the 1000 biggest city and
> rank for each date ( with an iteration on the query, date change to 10 by 10
> years , condition is date < 2000 ).. like this
>
> v_pop      | v_date     | rank
> 15000      1650         1
> 10000       1650        2
> 5000         1650        3
> 18000        1700       1
> 12000        1700       2
> 9500          1700       3
> ...etc...
> 50000        2000       1
> 48000        2000       2
> 18000        2000       3
>
> For each date the same query and rank function with result to concatenate,
> but how ?
> I need other dataframe (one by date) or not ? an how i can represent this
> data ? i need to use timeseries or not ?
>
> c) Representation of the data
>
> I need y log population, x log rank and one line/plot by timeline series...
> a lot ... (1650 to 2000 by 10 year > 1650 1660 1670 ... etc)
> I need to use maplot or there are an other tools to represente  each data
> above of other ?? *So, in fact i want only one graphics with all timeline
> series present ...*
>
> Thanks a lot in advance for you help !!
> Sebastien.
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pecardoso at netcabo.pt  Fri Jun 26 11:08:33 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Fri, 26 Jun 2009 10:08:33 +0100
Subject: [R-sig-Geo] GPS data - Remove points below a given distance of
	reference locations
In-Reply-To: <9fb1ae890904010953l7a48b331vad1679b3085bfa3b@mail.gmail.com>
References: <9fb1ae890904010953l7a48b331vad1679b3085bfa3b@mail.gmail.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAANEv23ofMUREldZSbxUGlBkBAAAAAA==@netcabo.pt>

HI,

I have a two layers, 1) cloud of points and 2) reference point sites. I'd
like to remove from cloud data all those points located bellow a given
distance of reference sites. Any clue?

Thanks in advance
____________
Paulo E. Cardoso


From reyman64 at gmail.com  Fri Jun 26 11:17:59 2009
From: reyman64 at gmail.com (reyman)
Date: Fri, 26 Jun 2009 11:17:59 +0200
Subject: [R-sig-Geo] Problem with data and representation of a complex
	timeseries ( R + Postgress + Rpy)
In-Reply-To: <alpine.LRH.2.00.0906260835500.8603@reclus.nhh.no>
References: <e4d374230906251450m57c6d2a9m6bfdee802a92e63f@mail.gmail.com> 
	<alpine.LRH.2.00.0906260835500.8603@reclus.nhh.no>
Message-ID: <e4d374230906260217wcf39806i457ab33ed3f365e3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090626/a22d6593/attachment.pl>

From pecardoso at netcabo.pt  Fri Jun 26 13:55:59 2009
From: pecardoso at netcabo.pt (Paulo E. Cardoso)
Date: Fri, 26 Jun 2009 12:55:59 +0100
Subject: [R-sig-Geo]  Create Buffers to SpatialPointsDataFrame
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAK2N38q7o51Ejb8q0JfvLrBiggAAEAAAAGzFdeFgbXlCpPjdhoPiOlsBAAAAAA==@netcabo.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090626/e54d51bd/attachment.pl>

From a.ghisla at gmail.com  Fri Jun 26 17:02:24 2009
From: a.ghisla at gmail.com (Anne Ghisla)
Date: Fri, 26 Jun 2009 17:02:24 +0200
Subject: [R-sig-Geo] [Report #5] Kriging with GRASS and R: v.autokrige port
 to wxPython and more
Message-ID: <1246028544.4157.8.camel@galadriel.uagra.net>

Hello all, and sorry for cross-posting,

just few minutes ago I succeded in completing the kriging procedure with
gstat functions. It runs with a proof-of-concept dataset based on
spearfish data, see this tutorial [0].
Martin helped me a lot in getting the standard wxGUI comboboxes to run
properly with filters.

Next week I plan to adapt the interface to each R package's available
options and consider how to solve lag issues in populating interface.

The blocking issue about autoKrige() and projections is no more valid as
I create the grid myself based on GRASS region.

best regards,

Anne

[0] http://casoilresource.lawr.ucdavis.edu/drupal/node/438
http://grass.osgeo.org/wiki/V.autokrige_GSoC_2009

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: Questa ? una parte del messaggio	firmata digitalmente
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090626/91bf58ac/attachment.bin>

From Roger.Bivand at nhh.no  Sat Jun 27 12:49:38 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 27 Jun 2009 12:49:38 +0200 (CEST)
Subject: [R-sig-Geo] Release of rgdal_0.6-9
Message-ID: <alpine.LRH.2.00.0906271228560.12554@reclus.nhh.no>

I would like to draw the attention of users of the vector import functions 
readOGR() and ogrInfo() in the rgdal package to a number of changes in the 
0.6-9 update. In addition, users of the Windows binary rgdal package from 
CRAN (thanks to Uwe Ligges) now have functioning read drivers for GPX and 
KML vector formats.

The first user-visible change in readOGR() and friends is that instead of 
dropping DateTime, Time, and Date fields, they are now returned as 
strings, and converted into factors in the data slots of Spatial*DataFrame 
objects. If users wish to process them from there, casting first to 
character, then to a chosen R date-time class representation is now 
possible.

The second change is that NULL and empty geometries are now handled 
better. Previously, NULL geometries caused an error, while empty 
geometries (lines and polygons with no coordinates) were not detected but 
caused errors because they were invalid as Line or Polygon objects. Now 
NULL geometries are detected and skipped by default - they are reported by 
ogrInfo(). In addition, readOGR() detects empty line and polygon 
geometries, and adds then to the list og NULL geometries to skip.

These changes should mean that users who were obliged to read shapefiles 
using functions in the maptools package may now use readOGR(), with the 
remaining differences that they still need to coerce to a date-time 
representation themselves, and that the maptools functions do not (yet) 
handle empty geometries.

I'm planning to make further improvements to readOGR(), one to try to 
speed up reading data using the GRASS vector driver, another to speed up 
reading large vector data sets irrespective of driver.

Roger

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sat Jun 27 13:36:52 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 27 Jun 2009 13:36:52 +0200 (CEST)
Subject: [R-sig-Geo] spgwr 0.6-2 update
Message-ID: <alpine.LRH.2.00.0906271249450.12554@reclus.nhh.no>

Users of spgwr should note a number of changes in the values returned by 
the gwr() function. In spgwr <= 0.5, the local R-squared, local 
coefficient standard errors, and local prediction standard errors were 
reported for GWR seen as many local regressions. In addition, the reported 
effective number of parameters was given in full (2*v1 - v2 on p. 55, eq. 
2.16 in the GWR book).

The first change is that sigma is now reported in three variants, against 
two previously. The former two were either ML (rss/n) or full effective 
degrees of freedom (rss/(n - (2*v1 - v2))), which do not agree with GWR3 
output; a third using the approximation of 2*v1 - v2 by v1 noted on p. 55 
of the GWR book is added (rss/(n - v1)). This value, AICc, and residual 
sum of squares now agree with GWR3.

The other changes relate to seeing GWR not as a collection of local 
models, but rather as a single locally varying coefficients model of the 
data points. If fit.points are not given, and hatmatrix is TRUE, se.fit 
and predictions are set TRUE. Local standard errors are then calculated 
using eq. 2.14-2.15, p.55 in the GWR book (may be suppressed using 
se.fit.CCT=FALSE), and the approximate normalised sigma as given above is 
used to complete. In addition, extra standard errors using the full 
effective number of parameters (2*v1 - v2) are also provided. The 
approximate sigma local standard errors agree with GWR3 and the 
development version of GWR4.

If fit.points are given, then a pre-computed gwr model for just the data 
points with hatmatrix=TRUE should be given in the fittedGWRobject 
argument. The normalised sigmas will be taken from this fitted model.

The same procedure applies to local R-squared, where locally weighted 
residuals from the whole pre-computed gwr model are compared with locally 
weighted deviances between the response variable and its locally weighted 
mean - thanks for clarification to Tomoki Nakaya. These local R-squared 
values agree with those in the development version of GWR4. If fit.points 
are given, then a fittedGWRobject must be given in order for the residuals 
from the whole pre-computed gwr model at the data points to be available.

This changes the reported values of local coefficient standard errors and 
of local R-squared - the change is from seeing the GWR local models as 
many local models to seeing GWR on data points as a single model with 
locally varying coefficients. There is no change in the coefficients 
themselves, in AICc, in the residual sum of squares, or the hat matrix.

In addition, an anova() method for gwr model fits (with hatmatrix=TRUE) 
has been provided, reproducing the ANOVA table in GWR3 output (note that 
you need to choose approx=TRUE to get the GWR3 values).

Hopefully, for the same bandwidth and data, GWR3/4 and gwr() should now 
provide the same output (R-squared only GWR4), and gwr() should also let 
the user examine the closeness in value of v1 and v2 used in computing 
the effective number of parameters.

Roger

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Sun Jun 28 11:00:15 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 28 Jun 2009 11:00:15 +0200
Subject: [R-sig-Geo] Directions to get mrsid support in GQIS (and other
 packages using gdal) on Ubuntu
Message-ID: <4A47311F.3010709@gmail.com>

Thanks to Alan Boudreault and the rest
of the ubuntugis team, and, of course, to the gdal team, we can add mrsid support
for QGIS that has been installed from binaries for ubuntu (from 8.04  to 9.04).
This support extends to other software relying on gdal, like package rgdal
for R.

An equivalent package exists for ecw support, I'll send directions for it
in few days.

We have tested these directions on several machines, but we cannot guarantee 
that you will not find other problems. Nevertheless, I do think this
is an small risk.

1. Include the ubuntugis unstable repository according to
https://launchpad.net/~ubuntugis/+archive/ubuntugis-unstable

2. sudo apt-get install gdal-mrsid-src gdal-bin

3. Go to http://www.lizardtech.com/developer
login (or register if you have not done it yet)  and  only then you'll see
*Download SDKs*
<http://www.lizardtech.com/developer/members/license.php>
on the left panel. Select  *Download SDKs*
<http://www.lizardtech.com/developer/members/license.php>,
accept the agreement and select the appropriate
*GeoExpress SDK for Linux (x86)
(I think that you can use either the version **gcc 3.2 or*
*gcc 4.1 for ubuntu 8.04 - 9.04, but actually don't know for sure)*
(Micha and I have tested the version for  gcc 4.1)

In the following I assume that you copy the file to /usr/local (you'll need sudo cp)

4.  cd /usr/local
sudo gunzip Geo_DSDK-7.0.0.2167.linux.x86.gcc32.tar.gz
sudo tar -xf Geo_DSDK-7.0.0.2167.linux.x86.gcc32.tar

5. Now you use the gdal-mrsid-build that got made in step 2:
sudo /usr/bin/gdal-mrsid-build /usr/local/Geo_DSDK-7.0.0.2167
Copy  and paste the output to a txt file just in case.
Note that this process makes  /usr/lib/gdal16plugins/gdal_MrSID.so

6. Re-install grass   support if you had it for  previous versions of  gdal:
apt-get install libgdal1-1.6.0-grass

7. Check  the available formats:
gdalinfo --formats

If gdal-mrsid works, you'll see a long list of supported formats with MrSID 
listed near the
top. QGIS will be able to display sid images.



Note: in some machines we get
~$ gdalinfo --formats
ERROR 1: /usr/lib/gdal16plugins/gdal_MrSID.so: undefined symbol:
_ZNSs20_S_empty_rep_storageE
ERROR 1: /usr/lib/gdal16plugins/gdal_MrSID.so: undefined symbol:
_ZNSs20_S_empty_rep_storageE
Supported Formats:
   VRT (rw+): Virtual Raster
   GTiff (rw+): GeoTIFF
   NITF (rw+): National Imagery Transmission Format
etc

In this case, you'll also have an error for package rgdal in R:
  > require(rgdal)

Loading required package: rgdal
Error in fun(...) :
     GDAL Error 1: /usr/lib/gdal16plugins/gdal_MrSID.so: undefined
symbol: _ZNSs20_S_empty_rep_storageE

Error : .onLoad failed in 'loadNamespace' for 'rgdal'

but this error goes away just by deleting
/usr/lib/gdal16plugins/gdal_MrSID.so

Hope this helps!

Agus

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster
-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090628/075a0e5a/attachment.vcf>

From alexandre.villers at cebc.cnrs.fr  Mon Jun 29 16:09:55 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Mon, 29 Jun 2009 16:09:55 +0200
Subject: [R-sig-Geo] SPATSTAT: converting owin(mask) to owin (polygon)
Message-ID: <4A48CB33.6090602@cebc.cnrs.fr>

Good afternoon,

I would like to create a new window for a point pattern in order to get 
a tess object (dirichlet tessellation) from that same point pattern.
For the moment, here is an example of what I do:

PPP<-  rpoispp(100) #generate a point pattern
wind1<-density(PPP, sigma=0.1) #smoothed object of class im
wind2<-wind1 #copy the object
wind2$v<-ifelse(wind2$v<150,  NA, wind1$v) #replace with NAs the value 
of pixel I don't want to keep (those whose intensity is < 150)
plot(wind2)
M<-as.owin(wind2) #convert the im object to a window
PPPd<-ppp(PPP$x,PPP$y, window=M) #the new point pattern with the new window
plot(dirichlet(PPPd)) #the result which did not cinvince me !

The problem is that the window generated by as.owin (on a im object) is 
a binary mask and I guess a polygonal window would be more appropriate 
if a tesselation is then computed.
Did I miss something ? Is there a way of converting the binary window 
into a polygonal window in spatstat (even if I went through the 
documentation) ? With package sp (which I don't know well).

Any help, even a rude "read the manual at page XX" would be appreciated...

Best regards



Alex


-- 
Alexandre Villers
PhD Student
Team "Biodiversity"
Centre d'Etudes Biologiques de Chiz?-CNRS UPR1934
79360 Beauvoir sur Niort

Phone +33 (0)5 49 09 96 13
Fax   +33 (0)5 49 09 65 26




__________ Information from ESET Mail Security, version of virus signature database 4196 (20090629) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From Adrian.Baddeley at csiro.au  Tue Jun 30 12:58:15 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Tue, 30 Jun 2009 18:58:15 +0800
Subject: [R-sig-Geo] SPATSTAT: converting owin(mask) to owin (polygon)
In-Reply-To: <mailman.17.1246356004.21217.r-sig-geo@stat.math.ethz.ch>
References: <mailman.17.1246356004.21217.r-sig-geo@stat.math.ethz.ch>
Message-ID: <57DC18C299094D4299F837570C5DF1C502AA3B9522@EXWA-MBX01.nexus.csiro.au>

Alexandre VILLERS wrote:

> I would like to create a new window for a point pattern in order to get 
> a tess object (dirichlet tessellation) from that same point pattern.
> For the moment, here is an example of what I do:

> PPP<-  rpoispp(100) #generate a point pattern
> wind1<-density(PPP, sigma=0.1) #smoothed object of class im
> wind2<-wind1 #copy the object
> wind2$v<-ifelse(wind2$v<150,  NA, wind1$v) #replace with NAs the value 
> # of pixel I don't want to keep (those whose intensity is < 150)
>  M<-as.owin(wind2) #convert the im object to a window
> PPPd<-ppp(PPP$x,PPP$y, window=M) #the new point pattern with the new window
> plot(dirichlet(PPPd)) #the result which did not convince me !

This is a bug in plot.tess. The dirichlet command has correctly computed a tessellation, but the plot method for tessellations has included some strange black lines. To suppress the lines, use
    plot(dirichlet(PPPd), axes=FALSE)
However it will take some more work to get a nice appearance for this plot. I will repair plot.tess in the next version (1.16-0) which will be out soon.

Incidentally, the following lines ...

> wind2 <- wind1
> wind2$v<-ifelse(wind2$v<150,  NA, wind1$v) 
> M<-as.owin(wind2) #convert the im object to a window

... could be replaced by

  M <- levelset(wind1, 150, "<")

Adrian Baddeley


From Maxime.Pauwels at univ-lille1.fr  Tue Jun 30 14:33:11 2009
From: Maxime.Pauwels at univ-lille1.fr (Maxime Pauwels)
Date: Tue, 30 Jun 2009 14:33:11 +0200
Subject: [R-sig-Geo] spplot point coordinates
Message-ID: <4A4A0607.4050209@univ-lille1.fr>

Dear all,

I think there is a function in the sp package to get the coordinates of 
a point on a sp plot (~equivalent to "locator").
Could someone remember me its name?

Many thanks,

max

-- 
Maxime Pauwels
Researcher ID: http://www.researcherid.com/rid/A-1745-2009

Laboratoire de G?n?tique et Evolution des Populations V?g?tales
UMR CNRS 8016
Universit? de Lille, USTL-Lille1
http://www.univ-lille1.fr/gepv
Tel  : +33 3 20 43 40 76
Fax  : +33 3 20 43 69 79
			
?Impose ta chance, serre ton bonheur et va vers ton risque. A te regarder, ils s?habitueront.?
Ren? Char


From p.hiemstra at geo.uu.nl  Tue Jun 30 15:04:48 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 30 Jun 2009 15:04:48 +0200
Subject: [R-sig-Geo] spplot point coordinates
In-Reply-To: <4A4A0607.4050209@univ-lille1.fr>
References: <4A4A0607.4050209@univ-lille1.fr>
Message-ID: <4A4A0D70.3050404@geo.uu.nl>

Hi Maxime,

You need the grid.locator() function from the grid package in 
combination with the trellis.focus() command from the lattice pacakge. 
The following function I wrote has a syntax similar to spplot but allow 
the user to click screen. The output of the function is either a 
SpatialPoints object if attach_data is FALSE or a SpatialPointsDataFrame 
otherwise, the data is extracted from spatial_object using overlay(). 
This function only works if spatial_object is a grid or a polygon. An 
example script plus the code for the function:

library(sp)
data(meuse.grid)
gridded(meuse.grid) = ~x+y
# Be sure to paste the function into the session before using this command
CreateSpatialPointsFromGraphicDevice(meuse.grid, "dist")

CreateSpatialPointsFromGraphicDevice = function(spatial_object, ..., 
proj4string = NA, attach_data = TRUE) {
        require(grid)
        require(lattice)
        cat("Exit with right mouse-click...\n")
        print(spplot(spatial_object, ...))
        trellis.focus()
        x_list = vector()
        y_list = vector()
        data = data.frame()
        while(TRUE) {
                dum = grid.locator()
                if(is.null(dum)) break
                ptdf = data.frame(x = as.numeric(dum$x), y = 
as.numeric(dum$y))
                x_list = c(x_list, as.numeric(dum$x))
                y_list = c(y_list, as.numeric(dum$y))
                lpoints(ptdf, pch = 3)

                if(attach_data) {
                        ovr = overlay(spatial_object, SpatialPoints(ptdf))
                        if(is(spatial_object, "SpatialPolygonsDataFrame")) {
                                data = rbind(data, ovr)
                        }
                        if(is(spatial_object, "SpatialGridDataFrame") || 
is(spatial_object, "SpatialPixelsDataFrame")) {
                                data = rbind(data, 
spatial_object at data[ovr,])
                        }
                        #if(length(data) == 0) stop("No data could be 
extract, input object does not contain data")
                }
        }
        trellis.unfocus()
        #print(data)
        if(length(data) == 0) {
                warning("No data could be extracted, reverting to a 
SpatialPoints object")
                attach_data = FALSE
        }
        if(attach_data) {
                return(SpatialPointsDataFrame(data.frame(x = x_list, y = 
y_list),
                                                                          
data = data, proj4string = CRS(as.character(proj4string))))
        } else {
                return(SpatialPoints(data.frame(x = x_list, y = y_list), 
proj4string = CRS(as.character(proj4string))))
        }
}

cheers and hth,
Paul

Maxime Pauwels wrote:
> Dear all,
>
> I think there is a function in the sp package to get the coordinates 
> of a point on a sp plot (~equivalent to "locator").
> Could someone remember me its name?
>
> Many thanks,
>
> max
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From b.rowlingson at lancaster.ac.uk  Tue Jun 30 15:13:38 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 30 Jun 2009 14:13:38 +0100
Subject: [R-sig-Geo] spplot point coordinates
In-Reply-To: <4A4A0607.4050209@univ-lille1.fr>
References: <4A4A0607.4050209@univ-lille1.fr>
Message-ID: <d8ad40b50906300613v690c9c26jeb811782edff83da@mail.gmail.com>

On Tue, Jun 30, 2009 at 1:33 PM, Maxime
Pauwels<Maxime.Pauwels at univ-lille1.fr> wrote:
> Dear all,
>
> I think there is a function in the sp package to get the coordinates of a
> point on a sp plot (~equivalent to "locator").
> Could someone remember me its name?
>

spplot.locator would seem to be it!

library(sp)
ls("package:sp")

 will show it, and help(spplot) lists it with some other useful spplot
functions.

Barry


From Maxime.Pauwels at univ-lille1.fr  Tue Jun 30 15:57:14 2009
From: Maxime.Pauwels at univ-lille1.fr (Maxime Pauwels)
Date: Tue, 30 Jun 2009 15:57:14 +0200
Subject: [R-sig-Geo] spplot point coordinates
In-Reply-To: <4A4A0D70.3050404@geo.uu.nl>
References: <4A4A0607.4050209@univ-lille1.fr> <4A4A0D70.3050404@geo.uu.nl>
Message-ID: <4A4A19BA.3030006@univ-lille1.fr>

Dear Paul,

This function looks very great!
I work on a grid and it could be very useful. However, before clicking 
on the screen, I have to add a SpatialLinesDataFrame and a list of 
points on the spplot (previously using sp.layout). Is it possible with 
your function?
Thank you

Maxime

Paul Hiemstra a ?crit :
> Hi Maxime,
>
> You need the grid.locator() function from the grid package in 
> combination with the trellis.focus() command from the lattice pacakge. 
> The following function I wrote has a syntax similar to spplot but 
> allow the user to click screen. The output of the function is either a 
> SpatialPoints object if attach_data is FALSE or a 
> SpatialPointsDataFrame otherwise, the data is extracted from 
> spatial_object using overlay(). This function only works if 
> spatial_object is a grid or a polygon. An example script plus the code 
> for the function:
>
> library(sp)
> data(meuse.grid)
> gridded(meuse.grid) = ~x+y
> # Be sure to paste the function into the session before using this 
> command
> CreateSpatialPointsFromGraphicDevice(meuse.grid, "dist")
>
> CreateSpatialPointsFromGraphicDevice = function(spatial_object, ..., 
> proj4string = NA, attach_data = TRUE) {
> require(grid)
> require(lattice)
> cat("Exit with right mouse-click...\n")
> print(spplot(spatial_object, ...))
> trellis.focus()
> x_list = vector()
> y_list = vector()
> data = data.frame()
> while(TRUE) {
> dum = grid.locator()
> if(is.null(dum)) break
> ptdf = data.frame(x = as.numeric(dum$x), y = as.numeric(dum$y))
> x_list = c(x_list, as.numeric(dum$x))
> y_list = c(y_list, as.numeric(dum$y))
> lpoints(ptdf, pch = 3)
>
> if(attach_data) {
> ovr = overlay(spatial_object, SpatialPoints(ptdf))
> if(is(spatial_object, "SpatialPolygonsDataFrame")) {
> data = rbind(data, ovr)
> }
> if(is(spatial_object, "SpatialGridDataFrame") || is(spatial_object, 
> "SpatialPixelsDataFrame")) {
> data = rbind(data, spatial_object at data[ovr,])
> }
> #if(length(data) == 0) stop("No data could be extract, input object 
> does not contain data")
> }
> }
> trellis.unfocus()
> #print(data)
> if(length(data) == 0) {
> warning("No data could be extracted, reverting to a SpatialPoints 
> object")
> attach_data = FALSE
> }
> if(attach_data) {
> return(SpatialPointsDataFrame(data.frame(x = x_list, y = y_list),
> data = data, proj4string = CRS(as.character(proj4string))))
> } else {
> return(SpatialPoints(data.frame(x = x_list, y = y_list), proj4string = 
> CRS(as.character(proj4string))))
> }
> }
>
> cheers and hth,
> Paul
>
> Maxime Pauwels wrote:
>> Dear all,
>>
>> I think there is a function in the sp package to get the coordinates 
>> of a point on a sp plot (~equivalent to "locator").
>> Could someone remember me its name?
>>
>> Many thanks,
>>
>> max
>>
>
>


-- 
Maxime Pauwels
Researcher ID: http://www.researcherid.com/rid/A-1745-2009

Laboratoire de G?n?tique et Evolution des Populations V?g?tales
UMR CNRS 8016
Universit? de Lille, USTL-Lille1
http://www.univ-lille1.fr/gepv
Tel  : +33 3 20 43 40 76
Fax  : +33 3 20 43 69 79
			
?Impose ta chance, serre ton bonheur et va vers ton risque. A te regarder, ils s?habitueront.?
Ren? Char


From p.hiemstra at geo.uu.nl  Tue Jun 30 15:55:03 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 30 Jun 2009 15:55:03 +0200
Subject: [R-sig-Geo] spplot point coordinates
In-Reply-To: <4A4A19BA.3030006@univ-lille1.fr>
References: <4A4A0607.4050209@univ-lille1.fr> <4A4A0D70.3050404@geo.uu.nl>
	<4A4A19BA.3030006@univ-lille1.fr>
Message-ID: <4A4A1937.3060405@geo.uu.nl>

Hi Maxime,

Just add the sp.layout argument as you would normally do.

cheers,
Paul

Maxime Pauwels wrote:
> Dear Paul,
>
> This function looks very great!
> I work on a grid and it could be very useful. However, before clicking 
> on the screen, I have to add a SpatialLinesDataFrame and a list of 
> points on the spplot (previously using sp.layout). Is it possible with 
> your function?
> Thank you
>
> Maxime
>
> Paul Hiemstra a ?crit :
>> Hi Maxime,
>>
>> You need the grid.locator() function from the grid package in 
>> combination with the trellis.focus() command from the lattice 
>> pacakge. The following function I wrote has a syntax similar to 
>> spplot but allow the user to click screen. The output of the function 
>> is either a SpatialPoints object if attach_data is FALSE or a 
>> SpatialPointsDataFrame otherwise, the data is extracted from 
>> spatial_object using overlay(). This function only works if 
>> spatial_object is a grid or a polygon. An example script plus the 
>> code for the function:
>>
>> library(sp)
>> data(meuse.grid)
>> gridded(meuse.grid) = ~x+y
>> # Be sure to paste the function into the session before using this 
>> command
>> CreateSpatialPointsFromGraphicDevice(meuse.grid, "dist")
>>
>> CreateSpatialPointsFromGraphicDevice = function(spatial_object, ..., 
>> proj4string = NA, attach_data = TRUE) {
>> require(grid)
>> require(lattice)
>> cat("Exit with right mouse-click...\n")
>> print(spplot(spatial_object, ...))
>> trellis.focus()
>> x_list = vector()
>> y_list = vector()
>> data = data.frame()
>> while(TRUE) {
>> dum = grid.locator()
>> if(is.null(dum)) break
>> ptdf = data.frame(x = as.numeric(dum$x), y = as.numeric(dum$y))
>> x_list = c(x_list, as.numeric(dum$x))
>> y_list = c(y_list, as.numeric(dum$y))
>> lpoints(ptdf, pch = 3)
>>
>> if(attach_data) {
>> ovr = overlay(spatial_object, SpatialPoints(ptdf))
>> if(is(spatial_object, "SpatialPolygonsDataFrame")) {
>> data = rbind(data, ovr)
>> }
>> if(is(spatial_object, "SpatialGridDataFrame") || is(spatial_object, 
>> "SpatialPixelsDataFrame")) {
>> data = rbind(data, spatial_object at data[ovr,])
>> }
>> #if(length(data) == 0) stop("No data could be extract, input object 
>> does not contain data")
>> }
>> }
>> trellis.unfocus()
>> #print(data)
>> if(length(data) == 0) {
>> warning("No data could be extracted, reverting to a SpatialPoints 
>> object")
>> attach_data = FALSE
>> }
>> if(attach_data) {
>> return(SpatialPointsDataFrame(data.frame(x = x_list, y = y_list),
>> data = data, proj4string = CRS(as.character(proj4string))))
>> } else {
>> return(SpatialPoints(data.frame(x = x_list, y = y_list), proj4string 
>> = CRS(as.character(proj4string))))
>> }
>> }
>>
>> cheers and hth,
>> Paul
>>
>> Maxime Pauwels wrote:
>>> Dear all,
>>>
>>> I think there is a function in the sp package to get the coordinates 
>>> of a point on a sp plot (~equivalent to "locator").
>>> Could someone remember me its name?
>>>
>>> Many thanks,
>>>
>>> max
>>>
>>
>>
>
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From alexandre.villers at cebc.cnrs.fr  Tue Jun 30 16:10:30 2009
From: alexandre.villers at cebc.cnrs.fr (Alexandre VILLERS)
Date: Tue, 30 Jun 2009 16:10:30 +0200
Subject: [R-sig-Geo] SPATSTAT: converting owin(mask) to owin (polygon) PART
	II
In-Reply-To: <57DC18C299094D4299F837570C5DF1C502AA3B9522@EXWA-MBX01.nexus.csiro.au>
References: <mailman.17.1246356004.21217.r-sig-geo@stat.math.ethz.ch>
	<57DC18C299094D4299F837570C5DF1C502AA3B9522@EXWA-MBX01.nexus.csiro.au>
Message-ID: <4A4A1CD6.4030309@cebc.cnrs.fr>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090630/81a78837/attachment.html>

From gledson.picharski at yahoo.com.br  Tue Jun 30 16:25:09 2009
From: gledson.picharski at yahoo.com.br (Gledson Picharski)
Date: Tue, 30 Jun 2009 07:25:09 -0700 (PDT)
Subject: [R-sig-Geo] Res:  spplot point coordinates
In-Reply-To: <4A4A0607.4050209@univ-lille1.fr>
References: <4A4A0607.4050209@univ-lille1.fr>
Message-ID: <372970.42861.qm@web63103.mail.re1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090630/fff4009d/attachment.pl>

