From mdsumner at gmail.com  Mon Nov  1 00:09:26 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 1 Nov 2010 10:09:26 +1100
Subject: [R-sig-Geo] Open grd files in R
In-Reply-To: <4CCDE0EA.6050106@gmail.com>
References: <AANLkTinU3joDPuVHinB+tfvbTvuBLDX1EgJ03HPT_HD+@mail.gmail.com>
	<4CCD71BA.1040609@uni-muenster.de> <4CCDB7A6.8080708@gmail.com>
	<89A84F9C-9390-451C-A252-EA80C3216E2A@auckland.ac.nz>
	<AANLkTim_XmcSvWZSuHjt3ozCZkOYge2irvD7LiW2onic@mail.gmail.com>
	<4CCDE0EA.6050106@gmail.com>
Message-ID: <AANLkTincdsFp=Mam1Uoe2RPfwFGSHuf3ih7RhTrTHaiF@mail.gmail.com>

There are multiple file types that might use the .grd extension,
including NetCDF and some Surfer files. Do you know what kind of file
it is?

Try opening the file with rgdal, or raster,  e.g.:

library(rgdal)
GDALinfo("file.grd")

library(raster)
r <- raster("file.grd")


If neither of those you work you may need a GDAL/rgdal build with the
appropriate drivers, so next I would investigate with GDAL itself
which can auto-detect if it knows the file type - but again your build
needs the appropriate drivers:

gdalinfo file.grd

What operating system are you using?

Cheers, Mike.




On Mon, Nov 1, 2010 at 8:34 AM, Peter Larson <pslarson2 at gmail.com> wrote:
> Hello again,
>
> Next question. Does anyone know how to open grd files in R? Or how to
> convert them into ascii? I find some info, but what I find doesn't work for
> me, or requires that I buy something.
>
> Any ideas?
>
> Pete
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From pslarson2 at gmail.com  Mon Nov  1 00:31:03 2010
From: pslarson2 at gmail.com (Peter Larson)
Date: Sun, 31 Oct 2010 19:31:03 -0400
Subject: [R-sig-Geo] Open grd files in R
In-Reply-To: <AANLkTincdsFp=Mam1Uoe2RPfwFGSHuf3ih7RhTrTHaiF@mail.gmail.com>
References: <AANLkTinU3joDPuVHinB+tfvbTvuBLDX1EgJ03HPT_HD+@mail.gmail.com>	<4CCD71BA.1040609@uni-muenster.de>	<4CCDB7A6.8080708@gmail.com>	<89A84F9C-9390-451C-A252-EA80C3216E2A@auckland.ac.nz>	<AANLkTim_XmcSvWZSuHjt3ozCZkOYge2irvD7LiW2onic@mail.gmail.com>	<4CCDE0EA.6050106@gmail.com>
	<AANLkTincdsFp=Mam1Uoe2RPfwFGSHuf3ih7RhTrTHaiF@mail.gmail.com>
Message-ID: <4CCDFC37.8080206@gmail.com>

Robert's previous solution worked well.

Thanks for your help!

Pete


On 2010/10/31 19:09, Michael Sumner wrote:
> There are multiple file types that might use the .grd extension,
> including NetCDF and some Surfer files. Do you know what kind of file
> it is?
>
> Try opening the file with rgdal, or raster,  e.g.:
>
> library(rgdal)
> GDALinfo("file.grd")
>
> library(raster)
> r<- raster("file.grd")
>
>
> If neither of those you work you may need a GDAL/rgdal build with the
> appropriate drivers, so next I would investigate with GDAL itself
> which can auto-detect if it knows the file type - but again your build
> needs the appropriate drivers:
>
> gdalinfo file.grd
>
> What operating system are you using?
>
> Cheers, Mike.
>
>
>
>
> On Mon, Nov 1, 2010 at 8:34 AM, Peter Larson<pslarson2 at gmail.com>  wrote:
>> Hello again,
>>
>> Next question. Does anyone know how to open grd files in R? Or how to
>> convert them into ascii? I find some info, but what I find doesn't work for
>> me, or requires that I buy something.
>>
>> Any ideas?
>>
>> Pete
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>


From mdsumner at gmail.com  Mon Nov  1 00:38:00 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 1 Nov 2010 10:38:00 +1100
Subject: [R-sig-Geo] grd files PROBLEM SOLVED
In-Reply-To: <AANLkTinVexX32TT2ykwLYFgioRBx6NQPn0kd6Y_zGhCf@mail.gmail.com>
References: <AANLkTinU3joDPuVHinB+tfvbTvuBLDX1EgJ03HPT_HD+@mail.gmail.com>
	<4CCD71BA.1040609@uni-muenster.de> <4CCDB7A6.8080708@gmail.com>
	<89A84F9C-9390-451C-A252-EA80C3216E2A@auckland.ac.nz>
	<AANLkTim_XmcSvWZSuHjt3ozCZkOYge2irvD7LiW2onic@mail.gmail.com>
	<4CCDE2B7.4060002@gmail.com>
	<AANLkTinVexX32TT2ykwLYFgioRBx6NQPn0kd6Y_zGhCf@mail.gmail.com>
Message-ID: <AANLkTin3zXtLhsKquncyY+sdfNVv3zADNAdNaG-xT7ij@mail.gmail.com>

I missed this previously, just note that this depends on the actual
file format - it should always work the same if it's NetCDF, but
otherwise willl depend on the available GDAL drivers to rgdal.

It might be worth finding out.

Cheers, Mike.

On Mon, Nov 1, 2010 at 9:23 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Perhaps easier to access them in R:
>
> library(raster)
> r <- raster(filename.grd)
>
> and then, e.g.,
>
> plot(r)
> spg <- as(r, 'SpatialGridDataFrame')
>
> Robert
>
>
>
> On Sun, Oct 31, 2010 at 2:42 PM, Peter Larson <pslarson2 at gmail.com> wrote:
>> Hello,
>>
>> grd file problem solved.
>>
>> I used DIVA to convert the file to an ASCII.
>>
>> Thanks,
>>
>> Pete
>>
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From mspinola10 at gmail.com  Mon Nov  1 12:39:04 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Mon, 01 Nov 2010 05:39:04 -0600
Subject: [R-sig-Geo] How to make a raster with distances to lines or point
	features
Message-ID: <4CCEA6D8.8010002@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101101/77cdb8eb/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Nov  1 16:36:48 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 01 Nov 2010 16:36:48 +0100
Subject: [R-sig-Geo] rgeos distances
Message-ID: <4CCEDE90.2070205@uni-muenster.de>

I tried rgeos to compute distances between a set of points and a
polygon, but don't get values I expected. Full output below; below my
signature is the clean script. Any ideas?

> library(sp)
> library(rgeos)
Loading required package: stringr
rgeos: (SVN revision (unknown))
GEOS runtime version: 3.2.2-CAPI-1.6.2
>
> data(meuse.riv)
> meuse.sr =
SpatialPolygons(list(Polygons(list(Polygon(meuse.riv)),"meuse.riv")))
>
> data(meuse.grid)
> coordinates(meuse.grid) = c("x", "y")
> # gridded(meuse.grid) = TRUE
>
> crs = CRS(paste("+init=epsg:28992",
+
"+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812"))
>
> proj4string(meuse.grid) = crs
> proj4string(meuse.sr) = crs
>
> ret = gDistance(meuse.sr, meuse.grid, byid=F, hausdorff=TRUE)
Warning message:
In RGEOSDistanceFunc(spgeom1, spgeom2, byid, "rgeos_hausdorffdistance") :
  Polygons object missing comment attribute ignoring hole(s). See
function createSPComment.
> summary(ret)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
      0       0       0       0       0       0
> ret = gDistance(meuse.sr, meuse.grid, byid=T, hausdorff=FALSE)
Warning message:
In RGEOSDistanceFunc(spgeom1, spgeom2, byid, "rgeos_distance") :
  Polygons object missing comment attribute ignoring hole(s). See
function createSPComment.
> summary(ret)
   meuse.riv
 Min.   :1.798e+308
 1st Qu.:1.798e+308
 Median :1.798e+308
 Mean   :1.798e+308
 3rd Qu.:1.798e+308
 Max.   :1.798e+308
>
>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


library(sp)
library(rgeos)

data(meuse.riv)
meuse.riv = meuse.riv[nrow(meuse.riv):1,]
meuse.sr =
SpatialPolygons(list(Polygons(list(Polygon(meuse.riv)),"meuse.riv")))

data(meuse.grid)
coordinates(meuse.grid) = c("x", "y")
# gridded(meuse.grid) = TRUE

crs = CRS(paste("+init=epsg:28992",

"+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812"))

proj4string(meuse.grid) = crs
proj4string(meuse.sr) = crs

ret = gDistance(meuse.sr, meuse.grid, byid=F, hausdorff=TRUE)
summary(ret)
ret = gDistance(meuse.sr, meuse.grid, byid=T, hausdorff=FALSE)
summary(ret)


From rundel at gmail.com  Mon Nov  1 19:04:08 2010
From: rundel at gmail.com (rundel)
Date: Mon, 1 Nov 2010 11:04:08 -0700 (PDT)
Subject: [R-sig-Geo] rgeos distances
In-Reply-To: <4CCEDE90.2070205@uni-muenster.de>
References: <4CCEDE90.2070205@uni-muenster.de>
Message-ID: <1288634648481-5694568.post@n2.nabble.com>


Hi Edzer,

There was a bug in how rgeos was translating polygons that lacked commenting
indicating hole ownership. I have fixed the issue and revision 204 up on
rforge should work properly. If there are any other issues please let me
know.

-Colin
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/rgeos-distances-tp5694108p5694568.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Mon Nov  1 19:38:59 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 01 Nov 2010 19:38:59 +0100
Subject: [R-sig-Geo] rgeos distances
In-Reply-To: <1288634648481-5694568.post@n2.nabble.com>
References: <4CCEDE90.2070205@uni-muenster.de>
	<1288634648481-5694568.post@n2.nabble.com>
Message-ID: <4CCF0943.1070106@uni-muenster.de>

Indeed, it works now.

Thanks!


On 11/01/2010 07:04 PM, rundel wrote:
> 
> Hi Edzer,
> 
> There was a bug in how rgeos was translating polygons that lacked commenting
> indicating hole ownership. I have fixed the issue and revision 204 up on
> rforge should work properly. If there are any other issues please let me
> know.
> 
> -Colin

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From pslarson2 at gmail.com  Mon Nov  1 19:42:09 2010
From: pslarson2 at gmail.com (Peter Larson)
Date: Mon, 1 Nov 2010 20:42:09 +0200
Subject: [R-sig-Geo] subsetting polygon display
Message-ID: <AANLkTinKqpqZQd5L4Pm33yVb+k3xx8qoQE-P-x_G5VMx@mail.gmail.com>

Hello all,

This is probably a completely stupid question, but how does one subset
a polygon data set for display?

I have a file of states of a country and just want to display one of them.

Pete


From edzer.pebesma at uni-muenster.de  Mon Nov  1 20:16:00 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 01 Nov 2010 20:16:00 +0100
Subject: [R-sig-Geo] subsetting polygon display
In-Reply-To: <AANLkTinKqpqZQd5L4Pm33yVb+k3xx8qoQE-P-x_G5VMx@mail.gmail.com>
References: <AANLkTinKqpqZQd5L4Pm33yVb+k3xx8qoQE-P-x_G5VMx@mail.gmail.com>
Message-ID: <4CCF11F0.5000801@uni-muenster.de>

if object states is of class "SpatialPolygons" or of class
"SpatialPolygonsDataFrame", use

plot(states[1,])

you can find out by asking

class(states)

On 11/01/2010 07:42 PM, Peter Larson wrote:
> Hello all,
> 
> This is probably a completely stupid question, but how does one subset
> a polygon data set for display?
> 
> I have a file of states of a country and just want to display one of them.
> 
> Pete
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From pslarson2 at gmail.com  Mon Nov  1 20:55:09 2010
From: pslarson2 at gmail.com (Peter Larson)
Date: Mon, 1 Nov 2010 21:55:09 +0200
Subject: [R-sig-Geo] subsetting polygon display
In-Reply-To: <4CCF11F0.5000801@uni-muenster.de>
References: <AANLkTinKqpqZQd5L4Pm33yVb+k3xx8qoQE-P-x_G5VMx@mail.gmail.com>
	<4CCF11F0.5000801@uni-muenster.de>
Message-ID: <AANLkTikp4-t65EXEhWcCHeB41NiWfrx9JES9gYfOiEkn@mail.gmail.com>

Lyndon/Edzer,

Excellent! So simple and thank you for all your help.

Thanks you!

Pete

On 11/1/10, Edzer Pebesma <edzer.pebesma at uni-muenster.de> wrote:
> if object states is of class "SpatialPolygons" or of class
> "SpatialPolygonsDataFrame", use
>
> plot(states[1,])
>
> you can find out by asking
>
> class(states)
>
> On 11/01/2010 07:42 PM, Peter Larson wrote:
>> Hello all,
>>
>> This is probably a completely stupid question, but how does one subset
>> a polygon data set for display?
>>
>> I have a file of states of a country and just want to display one of them.
>>
>> Pete
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From muenchen at utk.edu  Mon Nov  1 21:53:18 2010
From: muenchen at utk.edu (Muenchen, Robert A (Bob))
Date: Mon, 1 Nov 2010 20:53:18 +0000
Subject: [R-sig-Geo] Bubble plot from SpatialPolygons object
Message-ID: <81D92650D162664791CB7C482A878412265869@kmbx1.utk.tennessee.edu>

Hi All,

I'm having great fun learning the vast array of mapping options in R. I'm now working on a teaching example (below) that will step slowly through creating a tiny map, converting it to  SpatialPolygons and then plotting a choropleth and bubble plots in several ways (to be simplified to just one way when I'm done learning.)

The first place I'm stuck is getting a legend to handle both size and color at the same time on the bubble plot (2nd from bottom). Either one works by itself, but not both together.

My second problem is using plot twice with "add=TRUE" (bottom example). When I run the book example though it works fine, so I've got to be doing something truly inane.

Finally, I'm plotting the bubbles in the centers of the regions that I entered into a dataframe. That seems silly since these are created automatically when I convert from a map object to a SpatialPolygons object, and stored in the labpt slots. There must be an easy way to call them from there, but I haven't figured it out.

Thanks!
Bob

Here's what I've got so far:

#----------------------------------------
# Create a "map" class object of Tinyland
#----------------------------------------
long <- c(
20, 25, 32, 30, 27, 18, 20, NA,
35, 42, 42, 32, 25, 29, 35, NA,
30, 35, 35, 29, 25, 20, 20, 24, 30)
lat <- c(
30, 30, 35, 39, 39, 34, 30, NA,
21, 25, 33, 35, 30, 23, 21, NA,
18, 18, 21, 23, 30, 30, 25, 20, 18)
range <- c(18, 42, 18, 39)
names=c("A","B","C")
TinylandMap <- list(
  x=long,
  y=lat,
  names=names,
  range=range)
class(TinylandMap) <- "map"

TinylandMap
map(TinylandMap)

# Now convert it to a SpatialPolygon object

library("maptools")
TinylandSP <- map2SpatialPolygons( TinylandMap, 
  IDs=TinylandMap$names,
  proj4string=CRS("+proj=longlat +ellps=WGS84") ) 
str(TinylandSP, max.level=2)
plot(TinylandSP)

# Create some "pop"ulation data
region <- c("A","B","C")
pop <- c(271828, 314159, 195996) 
labptX <- c(25,34,26) #X-value of center of each region
labptY <- c(34,28,23) #Y-value of center of each region
myPopData <- data.frame(region,labptX,labptY,pop)
myPopData

# Get some grey shades
# could automate this: myGreys <- grey( (1-( pop / max(pop) ) ) ) 
# but these look nicer:
myGreys <- c("gray60","gray30","gray90")
myGreys

# Choroploth plot from SpatialPolygons
plot(TinylandSP, col = myGreys  )
legend( 37, 38 ,
  pop,
  fill = myGreys  )
text( 37, 38.5, pos=4, "pop")

# Create some Character EXpansion values
myCexValues <- 5*pop/max(pop)

# This works and has a nice legend:
library(PBSmapping)
plot(TinylandSP)
addBubbles(labptX, labptY, pop,
  legend.type="nested", col="grey")

# This almost works but legend bubbles are not black
# and overlap quite a bit. Is the legend function
# capable of making the points black?

plot(TinylandSP)
symbols(labptX, labptY, circles=pop, inches=1/5, bg="black", add=TRUE)
legend( 37, 38, legend=pop, 
  pch=1, pt.cex=myCexValues)
  
# Here I'm trying to follow the example from 
# Applied Spatial Data Analysis with R
# page 67 bottom by using plot twice.
# But the 2nd plot says "add is not a graphical parameter"
# so the bubbles start over on a blank map
# I'm also trying fill="black" in the legend & getting squares

plot(TinylandSP)
plot( labptX, labptY, pch=1, bg="black", cex=myCexValues, add=TRUE )
legend( "topright", legend=pop, 
  pch=1, pt.cex=myCexValues, fill="black")

=========================================================
  Bob Muenchen (pronounced Min'-chen), Manager  
  Research Computing Support
  Voice: (865) 974-5230  
  Email: muenchen at utk.edu
  Web:   http://oit.utk.edu/research, 
  News:  http://oit.utk.edu/research/news.php
========================================================


From yan_boulanger at hotmail.com  Tue Nov  2 03:03:12 2010
From: yan_boulanger at hotmail.com (Yan Boulanger)
Date: Tue, 2 Nov 2010 02:03:12 +0000
Subject: [R-sig-Geo] problems with points2grid
In-Reply-To: <AANLkTin3zXtLhsKquncyY+sdfNVv3zADNAdNaG-xT7ij@mail.gmail.com>
References: <AANLkTinU3joDPuVHinB+tfvbTvuBLDX1EgJ03HPT_HD+@mail.gmail.com>,
	<4CCD71BA.1040609@uni-muenster.de> <4CCDB7A6.8080708@gmail.com>,
	<89A84F9C-9390-451C-A252-EA80C3216E2A@auckland.ac.nz>,
	<AANLkTim_XmcSvWZSuHjt3ozCZkOYge2irvD7LiW2onic@mail.gmail.com>,
	<4CCDE2B7.4060002@gmail.com>,
	<AANLkTinVexX32TT2ykwLYFgioRBx6NQPn0kd6Y_zGhCf@mail.gmail.com>,
	<AANLkTin3zXtLhsKquncyY+sdfNVv3zADNAdNaG-xT7ij@mail.gmail.com>
Message-ID: <SNT124-W257A0741D1B54C14A174138D490@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101102/5a31fb69/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Nov  2 07:55:18 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 02 Nov 2010 07:55:18 +0100
Subject: [R-sig-Geo] problems with points2grid
In-Reply-To: <SNT124-W257A0741D1B54C14A174138D490@phx.gbl>
References: <AANLkTinU3joDPuVHinB+tfvbTvuBLDX1EgJ03HPT_HD+@mail.gmail.com>,
	<4CCD71BA.1040609@uni-muenster.de> <4CCDB7A6.8080708@gmail.com>,
	<89A84F9C-9390-451C-A252-EA80C3216E2A@auckland.ac.nz>,
	<AANLkTim_XmcSvWZSuHjt3ozCZkOYge2irvD7LiW2onic@mail.gmail.com>,
	<4CCDE2B7.4060002@gmail.com>,
	<AANLkTinVexX32TT2ykwLYFgioRBx6NQPn0kd6Y_zGhCf@mail.gmail.com>,
	<AANLkTin3zXtLhsKquncyY+sdfNVv3zADNAdNaG-xT7ij@mail.gmail.com>
	<SNT124-W257A0741D1B54C14A174138D490@phx.gbl>
Message-ID: <4CCFB5D6.1030009@uni-muenster.de>

There is a difference between visual perception of points being on a
grid, and the numerical confirmation of this.

Have you tried

grid_new <- points2grid(SpatialPoints(coord_nficentroid),
    tolerance= 0.41, round=NULL, fuzz.tol=3)

as the message sugggested?

On 11/02/2010 03:03 AM, Yan Boulanger wrote:
> 
> 
> 
> Hi
> everyone,
> 
>  
> 
> This seems
> (again) a very simple question but I?m not able to get this work. I have point
> data from the Canadian National Forest Inventory. This inventory was realized
> using a grid of 20 regularly spaced points. Even though I have access to the
> point data, I don?t have the grid data. Actually, I would like to use the grid
> data in order to do some moving window analyses. Plotting the point makes it
> obvious that these were generated using a grid. I used the points2grid in order
> to convert Grid. However, I get this error message : 
> 
>  
> 
> library(rgdal)
> 
> nfi_centroid
> <- readOGR(".", "nbie")
> 
> coord_nficentroid<-coordinates(nfi_centroid)
> 
> grid_new
> <- points2grid(SpatialPoints(coord_nficentroid),
> tolerance=sqrt(.Machine$double.eps), round=NULL, fuzz.tol=3)
> 
>  
> 
> suggested
> tolerance minimum: 0.40961317562634 
> 
> Erreur dans
> points2grid(SpatialPoints(coord_nficentroid), tolerance =
> sqrt(.Machine$double.eps),  : 
> 
>   dimension 1 : coordinate intervals are not
> constant
> 
>  
> 
> However,
> one could see that intervals are constant except, of course, when points fall
> in water. I tried with a subset of points that excluded any point skipping due
> to water and got that same result. I?m a little bit puzzled? I?m surely missing
> something!
> 
>  
> 
> Thanks for
> the help!
> 
>  
> 
> Yan
> 
>  
> 
> Using R
> 2.11.1
> 
>  
> 
> The original
> projection was :
> 
> Projected
> Coordinate System: NAD_1983_Albers
> 
> Projection:
> Albers
> 
> False_Easting:
> 0,00000000
> 
> False_Northing:
> 0,00000000
> 
> Central_Meridian:
> -95,00000000
> 
> Standard_Parallel_1:
> 49,00000000
> 
> Standard_Parallel_2:
> 77,00000000
> 
> Latitude_Of_Origin:
> 49,00000000
> 
> Linear
> Unit: Meter
> 
>  
> 
> Geographic
> Coordinate System: GCS_North_American_1983
> 
> Datum:
> D_North_American_1983
> 
> Prime
> Meridian: Greenwich
> 
> Angular
> Unit: Degree
> 
>  
> 
>   Here?s
> a subset of the point data for New Brunswick.
> 
>             coordinates Id
> 
> 1     (2200320, 384479)  0
> 
> 2     (2192230, 366274)  0
> 
> 3     (2095010, 343514)  0
> 
> 4     (2165910, 356022)  0
> 
> 5     (2076780, 351499)  0
> 
> 6     (2184140, 348078)  0
> 
> 7     (2202370, 340149)  0
> 
> 8     (2157810, 337828)  0
> 
> 9     (2113240, 335544)  0
> 
> 10    (2149700, 319642)  0
> 
> 11    (2068680, 333298)  0
> 
> 12    (2176040, 329890)  0
> 
> 13    (2131470, 327586)  0
> 
> 14    (2105140, 317356)  0
> 
> 15    (2060570, 315108)  0
> 
> 16    (2167930, 311709)  0
> 
> 17    (2086910, 325320)  0
> 
> 18    (2194270, 321966)  0
> 
> 19    (2042340, 323093)  0
> 
> 20    (2078790, 307135)  0
> 
> 21    (2186160, 303791)  0
> 
> 22    (2123360, 309404)  0
> 
> 23    (2159810, 293539)  0
> 
> 24    (1981530, 284526)  0
> 
> 25    (2034220, 304904)  0
> 
> 26    (2141590, 301465)  0
> 
> 27    (1989650, 302709)  0
> 
> 28    (2222600, 287994)  0
> 
> 29    (2070670, 288956)  0
> 
> 30    (2097020, 299175)  0
> 
> 31    (2052450, 296924)  0
> 
> 32    (2007870, 294710)  0
> 
> 33    (2115250, 291229)  0
> 
> 34    (2088900, 281003)  0
> 
> 35    (2151690, 275374)  0
> 
> 36    (1963300, 292533)  0
> 
> 37    (2178040, 285625)  0
> 
> 38    (2026100, 286723)  0
> 
> 39    (1973390, 266350)  0
> 
> 40    (2206340, 251692)  0
> 
> 41    (2133470, 283295)  0
> 
> 42    (2169910, 267467)  0
> 
> 43    (2017970, 268551)  0
> 
> 44    (2196260, 277725)  0
> 
> 45    (2044320, 278750)  0
> 
> 46    (1999750, 276532)  0
> 
> 47    (2188130, 259573)  0
> 
> 48    (2036190, 260582)  0
> 
> 49    (2054410, 252625)  0
> 
> 50    (2107120, 273062)  0
> 
> 51    (1955170, 274350)  0
> 
> 52    (2214470, 269839)  0
> 
> 53    (2062550, 270788)  0
> 
> 54    (2125340, 265134)  0
> 
> 55    (2143560, 257219)  0
> 
> 56    (1991610, 258362)  0
> 
> 57    (2232690, 261965)  0
> 
> 58    (2080770, 262838)  0
> 
> 59    (2250900, 254106)  0
> 
> 60    (1965250, 248184)  0
> 
> 61    (2224550, 243825)  0
> 
> 62    (2072630, 244684)  0
> 
> 63    (2098990, 254904)  0
> 
> 64    (2109060, 228836)  0
> 
> 65    (2161770, 249317)  0
> 
> 66    (2009830, 250387)  0
> 
> 67    (2269110, 246260)  0
> 
> 68    (2117200, 246982)  0
> 
> 69    (2331860, 240924)  0
> 
> 70    (2179990, 241429)  0
> 
> 71    (2028050, 242424)  0
> 
> 72    (2135420, 239072)  0
> 
> 73    (1983470, 240202)  0
> 
> 74    (2242760, 235970)  0
> 
> 75    (2090840, 236753)  0
> 
> 76    (2198200, 233554)  0
> 
> 77    (2046270, 234474)  0
> 
> 78    (2305520, 230608)  0
> 
> 79    (2260960, 228130)  0
> 
> 80    (1957100, 230026)  0
> 
> 81    (2234610, 217843)  0
> 
> 82    (2315560, 204691)  0
> 
> 83    (2163690, 205166)  0
> 
> 84    (2216410, 225692)  0
> 
> 85    (2064480, 226536)  0
> 
> 86    (2323720, 222803)  0
> 
> 87    (2171840, 223293)  0
> 
> 88    (2019900, 224274)  0
> 
> 89    (2279170, 220303)  0
> 
> 90    (2153630, 231176)  0
> 
> 91    (2001690, 232232)  0
> 
> 92    (2100910, 210701)  0
> 
> 93    (1948950, 211877)  0
> 
> 94    (2127270, 220933)  0
> 
> 95    (1975320, 222049)  0
> 
> 96    (2082690, 218612)  0
> 
> 97    (2190050, 215424)  0
> 
> 98    (2038110, 216330)  0
> 
> 99    (2297370, 212490)  0
> 
> 100   (2145480, 213043)  0
> 
> 101   (2252810, 210010)  0
> 
> 102   (2208250, 207567)  0
> 
> 103   (2056330, 208398)  0
> 
> 104   (2165550, 161088)  0
> 
> 105   (2281040, 176281)  0
> 
> 106   (2129150, 176804)  0
> 
> 107   (2272870, 158190)  0
> 
> 108   (2271010, 202188)  0
> 
> 109   (2119110, 202803)  0
> 
> 110   (2074540, 200480)  0
> 
> 111   (2226450, 199725)  0
> 
> 112   (2066370, 182357)  0
> 
> 113   (2147350, 168939)  0
> 
> 114   (2254680, 165986)  0
> 
> 115   (2181890, 197303)  0
> 
> 116   (2029960, 198195)  0
> 
> 117   (2289210, 194380)  0
> 
> 118   (2137320, 194919)  0
> 
> 119   (2244650, 191898)  0
> 
> 120   (2092740, 192575)  0
> 
> 121   (1940780, 193737)  0
> 
> 122   (2200090, 189452)  0
> 
> 123   (2048160, 190269)  0
> 
> 124   (2155520, 187049)  0
> 
> 125   (2262850, 184082)  0
> 
> 126   (2110950, 184683)  0
> 
> 127   (2218290, 181616)  0
> 
> 128   (2173720, 179191)  0
> 
> 129   (2120980, 158699)  0
> 
> 130   (2236480, 173795)  0
> 
> 131   (2084580, 174458)  0
> 
> 132   (2191920, 171347)  0
> 
> 133   (2039990, 172149)  0
> 
> 134   (2299230, 168494)  0
> 
> 135   (2102780, 166572)  0
> 
> 136   (2210120, 163517)  0
> 
> 137   (2058200, 164243)  0
> 
> 138   (2228310, 155700)  0
> 
> 139   (2094600, 148470)  0
> 
> 140   (2076400, 156350)  0
> 
> 141   (2220130, 137616)  0
> 
> 142   (2068220, 138252)  0
> 
> 143   (2183750, 153250)  0
> 
> 144   (2112800, 140604)  0
> 
> 145   (2139170, 150840)  0
> 
> 146   (2246500, 147898)  0
> 
> 147   (2201940, 145427)  0
> 
> 148   (2050020, 146139)  0
> 
> 149   (2157370, 142996)  0
> 
> 150   (2264680, 140109)  0
> 
> 151   (2193750, 127345)  0
> 
> 152   (2203740, 101476)  0
> 
> 153   (2175560, 135164)  0
> 
> 154   (2130990, 132751)  0
> 
> 155   (2238310, 129820)  0
> 
> 156   (2086410, 130378)  0
> 
> 157   (2149180, 124911)  0
> 
> 158   (2256490, 122037)  0
> 
> 159   (2104610, 122518)  0
> 
> 160   (2211930, 119542)  0
> 
> 161   (2060020, 120164)  0
> 
> 162   (2167370, 117086)  0
> 
> 163   (2122800, 114671)  0
> 
> 164   (2230120, 111751)  0
> 
> 165   (2078220, 112296)  0
> 
> 166  (2187320, 65377.6)  0
> 
> 167  (2160920, 55121.2)  0
> 
> 168   (2185550, 109274)  0
> 
> 169   (2140980, 106838)  0
> 
> 170   (2248300, 103974)  0
> 
> 171   (2096410, 104442)  0
> 
> 172  (2240090, 85921.7)  0
> 
> 173    (2088200, 86376)  0
> 
> 174  (2124570, 70720.6)  0
> 
> 175    (2159170, 99019)  0
> 
> 176  (2114600, 96602.2)  0
> 
> 177  (2221920, 93691.9)  0
> 
> 178  (2070010, 94223.2)  0
> 
> 179  (2177350, 91213.9)  0
> 
> 180  (2132780, 88774.2)  0
> 
> 181  (2195530, 83422.5)  0
> 
> 182  (2150960, 80962.3)  0
> 
> 183  (2106390, 78541.3)  0
> 
> 184  (2213710, 75643.1)  0
> 
> 185  (2169140, 73162.6)  0
> 
> 186  (2205490, 57605.4)  0
> 
> 187    (2079990, 68319)  0
> 
> 188  (2142750, 62914.6)  0
> 
> 189  (2116350, 52677.1)  0
> 
> 190  (2179100, 47343.4)  0
> 
> 191  (2134520, 44877.3)  0
> 
> 192  (2170870, 29318.1)  0
> 
> 193  (2152700, 37090.6)  0
> 
> 194
> (2198950, -4186.01)  0  
> 
> 
> 
> Yan Boulanger 
> Dendrolab - Datation de b?timents patrimoniaux par dendrochronologie
> www.dendrolab.ca
> info at dendrolab.ca
> 
>  
> 
> Universit? du Qu?bec ? Rimouski 
> D?partement de Biologie 
> Centre d'?tudes nordiques 
> 300, all?e des Ursulines 
> Rimouski, PQ G5L 3A1 
> (418) 723-1986 poste 1482
>  
> 
>  		 	   		  
> 	[[alternative HTML version deleted]]
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Tue Nov  2 08:05:13 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 02 Nov 2010 08:05:13 +0100
Subject: [R-sig-Geo] Bubble plot from SpatialPolygons object
In-Reply-To: <81D92650D162664791CB7C482A878412265869@kmbx1.utk.tennessee.edu>
References: <81D92650D162664791CB7C482A878412265869@kmbx1.utk.tennessee.edu>
Message-ID: <4CCFB829.30501@uni-muenster.de>



On 11/01/2010 09:53 PM, Muenchen, Robert A (Bob) wrote:
> Hi All,
> 
> I'm having great fun learning the vast array of mapping options in R. I'm now working on a teaching example (below) that will step slowly through creating a tiny map, converting it to  SpatialPolygons and then plotting a choropleth and bubble plots in several ways (to be simplified to just one way when I'm done learning.)
> 
> The first place I'm stuck is getting a legend to handle both size and color at the same time on the bubble plot (2nd from bottom). Either one works by itself, but not both together.
> 
> My second problem is using plot twice with "add=TRUE" (bottom example). When I run the book example though it works fine, so I've got to be doing something truly inane.
> 
> Finally, I'm plotting the bubbles in the centers of the regions that I entered into a dataframe. That seems silly since these are created automatically when I convert from a map object to a SpatialPolygons object, and stored in the labpt slots. There must be an easy way to call them from there, but I haven't figured it out.
> 
> Thanks!
> Bob
> 
> Here's what I've got so far:
> 
> #----------------------------------------
> # Create a "map" class object of Tinyland
> #----------------------------------------
> long <- c(
> 20, 25, 32, 30, 27, 18, 20, NA,
> 35, 42, 42, 32, 25, 29, 35, NA,
> 30, 35, 35, 29, 25, 20, 20, 24, 30)
> lat <- c(
> 30, 30, 35, 39, 39, 34, 30, NA,
> 21, 25, 33, 35, 30, 23, 21, NA,
> 18, 18, 21, 23, 30, 30, 25, 20, 18)
> range <- c(18, 42, 18, 39)
> names=c("A","B","C")
> TinylandMap <- list(
>   x=long,
>   y=lat,
>   names=names,
>   range=range)
> class(TinylandMap) <- "map"
> 
> TinylandMap
> map(TinylandMap)
> 
> # Now convert it to a SpatialPolygon object
> 
> library("maptools")
> TinylandSP <- map2SpatialPolygons( TinylandMap, 
>   IDs=TinylandMap$names,
>   proj4string=CRS("+proj=longlat +ellps=WGS84") ) 
> str(TinylandSP, max.level=2)
> plot(TinylandSP)
> 
> # Create some "pop"ulation data
> region <- c("A","B","C")
> pop <- c(271828, 314159, 195996) 
> labptX <- c(25,34,26) #X-value of center of each region
> labptY <- c(34,28,23) #Y-value of center of each region
> myPopData <- data.frame(region,labptX,labptY,pop)
> myPopData
> 
> # Get some grey shades
> # could automate this: myGreys <- grey( (1-( pop / max(pop) ) ) ) 
> # but these look nicer:
> myGreys <- c("gray60","gray30","gray90")
> myGreys
> 
> # Choroploth plot from SpatialPolygons
> plot(TinylandSP, col = myGreys  )
> legend( 37, 38 ,
>   pop,
>   fill = myGreys  )
> text( 37, 38.5, pos=4, "pop")
> 
> # Create some Character EXpansion values
> myCexValues <- 5*pop/max(pop)
> 
> # This works and has a nice legend:
> library(PBSmapping)
> plot(TinylandSP)
> addBubbles(labptX, labptY, pop,
>   legend.type="nested", col="grey")
> 
> # This almost works but legend bubbles are not black
> # and overlap quite a bit. Is the legend function
> # capable of making the points black?
> 
> plot(TinylandSP)
> symbols(labptX, labptY, circles=pop, inches=1/5, bg="black", add=TRUE)
> legend( 37, 38, legend=pop, 
>   pch=1, pt.cex=myCexValues)

use

pch = 16, y.intersp=2

in the legend command.

> # Here I'm trying to follow the example from 
> # Applied Spatial Data Analysis with R
> # page 67 bottom by using plot twice.
> # But the 2nd plot says "add is not a graphical parameter"
> # so the bubbles start over on a blank map
> # I'm also trying fill="black" in the legend & getting squares
> 
> plot(TinylandSP)
> plot( labptX, labptY, pch=1, bg="black", cex=myCexValues, add=TRUE )
> legend( "topright", legend=pop, 
>   pch=1, pt.cex=myCexValues, fill="black")

instead of the second plot, use:

points(labptX, labptY, pch=1, bg="black", cex=myCexValues)
> 
> =========================================================
>   Bob Muenchen (pronounced Min'-chen), Manager  
>   Research Computing Support
>   Voice: (865) 974-5230  
>   Email: muenchen at utk.edu
>   Web:   http://oit.utk.edu/research, 
>   News:  http://oit.utk.edu/research/news.php
> ========================================================
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From zenlines at gmail.com  Tue Nov  2 11:00:01 2010
From: zenlines at gmail.com (Brian Oney)
Date: Tue, 02 Nov 2010 11:00:01 +0100
Subject: [R-sig-Geo] Reassigning coordinates?
Message-ID: <4CCFE121.8080804@gmail.com>

Hello List,
I need to reassign coordinates of a few points to have coordinates of 
the nearest raster cell. I KNOW that this is BAD practice but for the 
time being I  assume that it does not affect my analysis (species 
distribution analysis). I think the datum of the point data is different 
than that of my raster data, but for now it is not important.

I have already perused the "sp" and "raster" packages extensively.
I guess I just need to be pointed in the right (WRONG) direction. I had 
a few thoughts with the distance function but I am now stuck. Maybe use 
"distance" then "which.min" then take the coordinates?

Best Regards,
Brian


From Roger.Bivand at nhh.no  Tue Nov  2 11:13:36 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 2 Nov 2010 11:13:36 +0100 (CET)
Subject: [R-sig-Geo] Reassigning coordinates?
In-Reply-To: <4CCFE121.8080804@gmail.com>
References: <4CCFE121.8080804@gmail.com>
Message-ID: <alpine.LRH.2.00.1011021111270.9651@reclus.nhh.no>

On Tue, 2 Nov 2010, Brian Oney wrote:

> Hello List,
> I need to reassign coordinates of a few points to have coordinates of the 
> nearest raster cell. I KNOW that this is BAD practice but for the time being 
> I  assume that it does not affect my analysis (species distribution 
> analysis). I think the datum of the point data is different than that of my 
> raster data, but for now it is not important.
>
> I have already perused the "sp" and "raster" packages extensively.
> I guess I just need to be pointed in the right (WRONG) direction. I had a few 
> thoughts with the distance function but I am now stuck. Maybe use "distance" 
> then "which.min" then take the coordinates?

Maybe try nn2() in the RANN package with k=1 to find the nearest neighbour 
for each query point, with - I think - grid as data and points to move as 
query?

Roger

>
> Best Regards,
> Brian
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From muenchen at utk.edu  Tue Nov  2 13:15:46 2010
From: muenchen at utk.edu (Muenchen, Robert A (Bob))
Date: Tue, 2 Nov 2010 12:15:46 +0000
Subject: [R-sig-Geo] Bubble plot from SpatialPolygons object
In-Reply-To: <4CCFB829.30501@uni-muenster.de>
References: <81D92650D162664791CB7C482A878412265869@kmbx1.utk.tennessee.edu>
	<4CCFB829.30501@uni-muenster.de>
Message-ID: <81D92650D162664791CB7C482A878412266CFF@kmbx1.utk.tennessee.edu>

That did it, thanks. Love your book!

Cheers,
Bob

>-----Original Message-----
>From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
>bounces at stat.math.ethz.ch] On Behalf Of Edzer Pebesma
>Sent: Tuesday, November 02, 2010 3:05 AM
>To: r-sig-geo at stat.math.ethz.ch
>Subject: Re: [R-sig-Geo] Bubble plot from SpatialPolygons object
>
>
>
>On 11/01/2010 09:53 PM, Muenchen, Robert A (Bob) wrote:
>> Hi All,
>>
>> I'm having great fun learning the vast array of mapping options in R.
>I'm now working on a teaching example (below) that will step slowly
>through creating a tiny map, converting it to  SpatialPolygons and then
>plotting a choropleth and bubble plots in several ways (to be simplified
>to just one way when I'm done learning.)
>>
>> The first place I'm stuck is getting a legend to handle both size and
>color at the same time on the bubble plot (2nd from bottom). Either one
>works by itself, but not both together.
>>
>> My second problem is using plot twice with "add=TRUE" (bottom
>example). When I run the book example though it works fine, so I've got
>to be doing something truly inane.
>>
>> Finally, I'm plotting the bubbles in the centers of the regions that I
>entered into a dataframe. That seems silly since these are created
>automatically when I convert from a map object to a SpatialPolygons
>object, and stored in the labpt slots. There must be an easy way to call
>them from there, but I haven't figured it out.
>>
>> Thanks!
>> Bob
>>
>> Here's what I've got so far:
>>
>> #----------------------------------------
>> # Create a "map" class object of Tinyland
>> #----------------------------------------
>> long <- c(
>> 20, 25, 32, 30, 27, 18, 20, NA,
>> 35, 42, 42, 32, 25, 29, 35, NA,
>> 30, 35, 35, 29, 25, 20, 20, 24, 30)
>> lat <- c(
>> 30, 30, 35, 39, 39, 34, 30, NA,
>> 21, 25, 33, 35, 30, 23, 21, NA,
>> 18, 18, 21, 23, 30, 30, 25, 20, 18)
>> range <- c(18, 42, 18, 39)
>> names=c("A","B","C")
>> TinylandMap <- list(
>>   x=long,
>>   y=lat,
>>   names=names,
>>   range=range)
>> class(TinylandMap) <- "map"
>>
>> TinylandMap
>> map(TinylandMap)
>>
>> # Now convert it to a SpatialPolygon object
>>
>> library("maptools")
>> TinylandSP <- map2SpatialPolygons( TinylandMap,
>>   IDs=TinylandMap$names,
>>   proj4string=CRS("+proj=longlat +ellps=WGS84") )
>> str(TinylandSP, max.level=2)
>> plot(TinylandSP)
>>
>> # Create some "pop"ulation data
>> region <- c("A","B","C")
>> pop <- c(271828, 314159, 195996)
>> labptX <- c(25,34,26) #X-value of center of each region
>> labptY <- c(34,28,23) #Y-value of center of each region
>> myPopData <- data.frame(region,labptX,labptY,pop)
>> myPopData
>>
>> # Get some grey shades
>> # could automate this: myGreys <- grey( (1-( pop / max(pop) ) ) )
>> # but these look nicer:
>> myGreys <- c("gray60","gray30","gray90")
>> myGreys
>>
>> # Choroploth plot from SpatialPolygons
>> plot(TinylandSP, col = myGreys  )
>> legend( 37, 38 ,
>>   pop,
>>   fill = myGreys  )
>> text( 37, 38.5, pos=4, "pop")
>>
>> # Create some Character EXpansion values
>> myCexValues <- 5*pop/max(pop)
>>
>> # This works and has a nice legend:
>> library(PBSmapping)
>> plot(TinylandSP)
>> addBubbles(labptX, labptY, pop,
>>   legend.type="nested", col="grey")
>>
>> # This almost works but legend bubbles are not black
>> # and overlap quite a bit. Is the legend function
>> # capable of making the points black?
>>
>> plot(TinylandSP)
>> symbols(labptX, labptY, circles=pop, inches=1/5, bg="black", add=TRUE)
>> legend( 37, 38, legend=pop,
>>   pch=1, pt.cex=myCexValues)
>
>use
>
>pch = 16, y.intersp=2
>
>in the legend command.
>
>> # Here I'm trying to follow the example from
>> # Applied Spatial Data Analysis with R
>> # page 67 bottom by using plot twice.
>> # But the 2nd plot says "add is not a graphical parameter"
>> # so the bubbles start over on a blank map
>> # I'm also trying fill="black" in the legend & getting squares
>>
>> plot(TinylandSP)
>> plot( labptX, labptY, pch=1, bg="black", cex=myCexValues, add=TRUE )
>> legend( "topright", legend=pop,
>>   pch=1, pt.cex=myCexValues, fill="black")
>
>instead of the second plot, use:
>
>points(labptX, labptY, pch=1, bg="black", cex=myCexValues)
>>
>> =========================================================
>>   Bob Muenchen (pronounced Min'-chen), Manager
>>   Research Computing Support
>>   Voice: (865) 974-5230
>>   Email: muenchen at utk.edu
>>   Web:   http://oit.utk.edu/research,
>>   News:  http://oit.utk.edu/research/news.php
>> ========================================================
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>--
>Edzer Pebesma
>Institute for Geoinformatics (ifgi), University of M?nster
>Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Tue Nov  2 13:21:58 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 2 Nov 2010 12:21:58 +0000
Subject: [R-sig-Geo] Reassigning coordinates?
In-Reply-To: <4CCFE121.8080804@gmail.com>
References: <4CCFE121.8080804@gmail.com>
Message-ID: <AANLkTikyGT8BGSR47XtMpoy=kO_jpw-Um2o1Dj75ieBR@mail.gmail.com>

On Tue, Nov 2, 2010 at 10:00 AM, Brian Oney <zenlines at gmail.com> wrote:
> Hello List,
> I need to reassign coordinates of a few points to have coordinates of the
> nearest raster cell. I KNOW that this is BAD practice but for the time being
> I ?assume that it does not affect my analysis (species distribution
> analysis). I think the datum of the point data is different than that of my
> raster data, but for now it is not important.
>
> I have already perused the "sp" and "raster" packages extensively.
> I guess I just need to be pointed in the right (WRONG) direction. I had a
> few thoughts with the distance function but I am now stuck. Maybe use
> "distance" then "which.min" then take the coordinates?
>

 If you have some points in a SpatialPointsDataFrame and a grid as a
SpatialPixelsDataFrame then you can do an overlay. So for example,
using 'm' from help(SpatialPixelsDataFrame) and 'pts' as some random
clicking points:

 > pts[1:10,]
        coordinates         zz
1  (179333, 330803) 0.76290682
2  (179600, 331026) 0.38275344
3  (180462, 331370) 0.75330357
...

 > overlay(m,pts)
 [1] 1930 1737 1434 1093 1115 1495 1705 2025 2146 2386 1780  728  487 1056 1256
[16] 1567 1778 1039  819 2465

 - gives the index in 'm' where each point in pts is, hence something like:

> cbind(coordinates(pts),coordinates(m)[overlay(m,pts),])
             x        y      x      y
 [1,] 179332.9 330802.6 179340 330820
 [2,] 179599.7 331025.5 179580 331020
 [3,] 180461.9 331369.9 180460 331380
 [4,] 180533.7 331785.2 180540 331780
 [5,] 180010.3 331734.6 180020 331740

 gives the original and grid cell coordinates.

 something similar might work with package:raster objects...

Barry


From Antoine.Gardarin at u-psud.fr  Tue Nov  2 16:07:02 2010
From: Antoine.Gardarin at u-psud.fr (Antoine Gardarin)
Date: Tue, 02 Nov 2010 16:07:02 +0100
Subject: [R-sig-Geo] Error when reading shapefiles (readOGR) with rgdal
Message-ID: <4CD02916.2050105@u-psud.fr>

Dear all

I am having problems when reading shapefiles using readOGR with the 
rgdal package. I have read several times these files in the past without 
any problem. Since a few days, while I apparently did not change 
anything (no update, similar version of R, same shapefiles), I always 
have this error with the following statement:

 > sol <- readOGR(dsn = ".", "sol")

 >> Erreur dans ogrInfo(dsn = dsn, layer = layer, 
input_field_name_encoding = input_field_name_encoding) :
 >> GDAL Error 4: Record count in .shp header is -3, which seems 
unreasonable. Assuming header is corrupt.

This error initially occurred with version 2.11.0 of R. I uninstalled R, 
installed the version 2.12.0 for Windows, I updated all the packages, 
but the trouble persists. The same files can be read on other computers 
of my colleagues, whatever the version of R and rgdal.

How can I solve this? Many thanks in advance.


Antoine


From r.hijmans at gmail.com  Tue Nov  2 17:46:58 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 2 Nov 2010 09:46:58 -0700
Subject: [R-sig-Geo] How to make a raster with distances to lines or
	point features
In-Reply-To: <4CCEA6D8.8010002@gmail.com>
References: <4CCEA6D8.8010002@gmail.com>
Message-ID: <AANLkTikWmeqkUHdAPuqcSGd-Y53TR7t+rqqufga29zUN@mail.gmail.com>

Manuel,

You can have a look at:

library(raster)
?distance

Robert

On Mon, Nov 1, 2010 at 4:39 AM, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
> Dear list members,
>
> I am interested in knowing how to make a raster with distance to lines
> or point features. ?For example distance to rivers or villages. ?My
> source file will be a shapefile.
> Best,
>
> Manuel
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From r.hijmans at gmail.com  Tue Nov  2 17:53:18 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 2 Nov 2010 09:53:18 -0700
Subject: [R-sig-Geo] problems with points2grid
In-Reply-To: <SNT124-W257A0741D1B54C14A174138D490@phx.gbl>
References: <AANLkTinU3joDPuVHinB+tfvbTvuBLDX1EgJ03HPT_HD+@mail.gmail.com>
	<4CCD71BA.1040609@uni-muenster.de> <4CCDB7A6.8080708@gmail.com>
	<89A84F9C-9390-451C-A252-EA80C3216E2A@auckland.ac.nz>
	<AANLkTim_XmcSvWZSuHjt3ozCZkOYge2irvD7LiW2onic@mail.gmail.com>
	<4CCDE2B7.4060002@gmail.com>
	<AANLkTinVexX32TT2ykwLYFgioRBx6NQPn0kd6Y_zGhCf@mail.gmail.com>
	<AANLkTin3zXtLhsKquncyY+sdfNVv3zADNAdNaG-xT7ij@mail.gmail.com>
	<SNT124-W257A0741D1B54C14A174138D490@phx.gbl>
Message-ID: <AANLkTi=Y+OLUUOm93W2mADEEcvURuwr1b_GmhU6hMjwC@mail.gmail.com>

Yan,

An alternative approach, if you want to force regularly spaced points
to a grid that you know the parameters of, you could first create that
grid and then link the values by cell numbers

library(raster)
r <- raster(ncol=10, nrow=10, xmn=..  xmx=  etc)
cells <- cellFromXY(r, xy)
r[cells] <- value

(not to be confused with pointsToRaster for random like distributions
with perhaps multiple points per cell).

Robert




On Mon, Nov 1, 2010 at 7:03 PM, Yan Boulanger <yan_boulanger at hotmail.com> wrote:
>
>
>
> Hi
> everyone,
>
>
>
> This seems
> (again) a very simple question but I?m not able to get this work. I have point
> data from the Canadian National Forest Inventory. This inventory was realized
> using a grid of 20 regularly spaced points. Even though I have access to the
> point data, I don?t have the grid data. Actually, I would like to use the grid
> data in order to do some moving window analyses. Plotting the point makes it
> obvious that these were generated using a grid. I used the points2grid in order
> to convert Grid. However, I get this error message :
>
>
>
> library(rgdal)
>
> nfi_centroid
> <- readOGR(".", "nbie")
>
> coord_nficentroid<-coordinates(nfi_centroid)
>
> grid_new
> <- points2grid(SpatialPoints(coord_nficentroid),
> tolerance=sqrt(.Machine$double.eps), round=NULL, fuzz.tol=3)
>
>
>
> suggested
> tolerance minimum: 0.40961317562634
>
> Erreur dans
> points2grid(SpatialPoints(coord_nficentroid), tolerance =
> sqrt(.Machine$double.eps), ?:
>
> ?dimension 1 : coordinate intervals are not
> constant
>
>
>
> However,
> one could see that intervals are constant except, of course, when points fall
> in water. I tried with a subset of points that excluded any point skipping due
> to water and got that same result. I?m a little bit puzzled? I?m surely missing
> something!
>
>
>
> Thanks for
> the help!
>
>
>
> Yan
>
>
>
> Using R
> 2.11.1
>
>
>
> The original
> projection was :
>
> Projected
> Coordinate System: NAD_1983_Albers
>
> Projection:
> Albers
>
> False_Easting:
> 0,00000000
>
> False_Northing:
> 0,00000000
>
> Central_Meridian:
> -95,00000000
>
> Standard_Parallel_1:
> 49,00000000
>
> Standard_Parallel_2:
> 77,00000000
>
> Latitude_Of_Origin:
> 49,00000000
>
> Linear
> Unit: Meter
>
>
>
> Geographic
> Coordinate System: GCS_North_American_1983
>
> Datum:
> D_North_American_1983
>
> Prime
> Meridian: Greenwich
>
> Angular
> Unit: Degree
>
>
>
> ?Here?s
> a subset of the point data for New Brunswick.
>
> ? ? ? ? ? ?coordinates Id
>
> 1 ? ? (2200320, 384479) ?0
>
> 2 ? ? (2192230, 366274) ?0
>
> 3 ? ? (2095010, 343514) ?0
>
> 4 ? ? (2165910, 356022) ?0
>
> 5 ? ? (2076780, 351499) ?0
>
> 6 ? ? (2184140, 348078) ?0
>
> 7 ? ? (2202370, 340149) ?0
>
> 8 ? ? (2157810, 337828) ?0
>
> 9 ? ? (2113240, 335544) ?0
>
> 10 ? ?(2149700, 319642) ?0
>
> 11 ? ?(2068680, 333298) ?0
>
> 12 ? ?(2176040, 329890) ?0
>
> 13 ? ?(2131470, 327586) ?0
>
> 14 ? ?(2105140, 317356) ?0
>
> 15 ? ?(2060570, 315108) ?0
>
> 16 ? ?(2167930, 311709) ?0
>
> 17 ? ?(2086910, 325320) ?0
>
> 18 ? ?(2194270, 321966) ?0
>
> 19 ? ?(2042340, 323093) ?0
>
> 20 ? ?(2078790, 307135) ?0
>
> 21 ? ?(2186160, 303791) ?0
>
> 22 ? ?(2123360, 309404) ?0
>
> 23 ? ?(2159810, 293539) ?0
>
> 24 ? ?(1981530, 284526) ?0
>
> 25 ? ?(2034220, 304904) ?0
>
> 26 ? ?(2141590, 301465) ?0
>
> 27 ? ?(1989650, 302709) ?0
>
> 28 ? ?(2222600, 287994) ?0
>
> 29 ? ?(2070670, 288956) ?0
>
> 30 ? ?(2097020, 299175) ?0
>
> 31 ? ?(2052450, 296924) ?0
>
> 32 ? ?(2007870, 294710) ?0
>
> 33 ? ?(2115250, 291229) ?0
>
> 34 ? ?(2088900, 281003) ?0
>
> 35 ? ?(2151690, 275374) ?0
>
> 36 ? ?(1963300, 292533) ?0
>
> 37 ? ?(2178040, 285625) ?0
>
> 38 ? ?(2026100, 286723) ?0
>
> 39 ? ?(1973390, 266350) ?0
>
> 40 ? ?(2206340, 251692) ?0
>
> 41 ? ?(2133470, 283295) ?0
>
> 42 ? ?(2169910, 267467) ?0
>
> 43 ? ?(2017970, 268551) ?0
>
> 44 ? ?(2196260, 277725) ?0
>
> 45 ? ?(2044320, 278750) ?0
>
> 46 ? ?(1999750, 276532) ?0
>
> 47 ? ?(2188130, 259573) ?0
>
> 48 ? ?(2036190, 260582) ?0
>
> 49 ? ?(2054410, 252625) ?0
>
> 50 ? ?(2107120, 273062) ?0
>
> 51 ? ?(1955170, 274350) ?0
>
> 52 ? ?(2214470, 269839) ?0
>
> 53 ? ?(2062550, 270788) ?0
>
> 54 ? ?(2125340, 265134) ?0
>
> 55 ? ?(2143560, 257219) ?0
>
> 56 ? ?(1991610, 258362) ?0
>
> 57 ? ?(2232690, 261965) ?0
>
> 58 ? ?(2080770, 262838) ?0
>
> 59 ? ?(2250900, 254106) ?0
>
> 60 ? ?(1965250, 248184) ?0
>
> 61 ? ?(2224550, 243825) ?0
>
> 62 ? ?(2072630, 244684) ?0
>
> 63 ? ?(2098990, 254904) ?0
>
> 64 ? ?(2109060, 228836) ?0
>
> 65 ? ?(2161770, 249317) ?0
>
> 66 ? ?(2009830, 250387) ?0
>
> 67 ? ?(2269110, 246260) ?0
>
> 68 ? ?(2117200, 246982) ?0
>
> 69 ? ?(2331860, 240924) ?0
>
> 70 ? ?(2179990, 241429) ?0
>
> 71 ? ?(2028050, 242424) ?0
>
> 72 ? ?(2135420, 239072) ?0
>
> 73 ? ?(1983470, 240202) ?0
>
> 74 ? ?(2242760, 235970) ?0
>
> 75 ? ?(2090840, 236753) ?0
>
> 76 ? ?(2198200, 233554) ?0
>
> 77 ? ?(2046270, 234474) ?0
>
> 78 ? ?(2305520, 230608) ?0
>
> 79 ? ?(2260960, 228130) ?0
>
> 80 ? ?(1957100, 230026) ?0
>
> 81 ? ?(2234610, 217843) ?0
>
> 82 ? ?(2315560, 204691) ?0
>
> 83 ? ?(2163690, 205166) ?0
>
> 84 ? ?(2216410, 225692) ?0
>
> 85 ? ?(2064480, 226536) ?0
>
> 86 ? ?(2323720, 222803) ?0
>
> 87 ? ?(2171840, 223293) ?0
>
> 88 ? ?(2019900, 224274) ?0
>
> 89 ? ?(2279170, 220303) ?0
>
> 90 ? ?(2153630, 231176) ?0
>
> 91 ? ?(2001690, 232232) ?0
>
> 92 ? ?(2100910, 210701) ?0
>
> 93 ? ?(1948950, 211877) ?0
>
> 94 ? ?(2127270, 220933) ?0
>
> 95 ? ?(1975320, 222049) ?0
>
> 96 ? ?(2082690, 218612) ?0
>
> 97 ? ?(2190050, 215424) ?0
>
> 98 ? ?(2038110, 216330) ?0
>
> 99 ? ?(2297370, 212490) ?0
>
> 100 ? (2145480, 213043) ?0
>
> 101 ? (2252810, 210010) ?0
>
> 102 ? (2208250, 207567) ?0
>
> 103 ? (2056330, 208398) ?0
>
> 104 ? (2165550, 161088) ?0
>
> 105 ? (2281040, 176281) ?0
>
> 106 ? (2129150, 176804) ?0
>
> 107 ? (2272870, 158190) ?0
>
> 108 ? (2271010, 202188) ?0
>
> 109 ? (2119110, 202803) ?0
>
> 110 ? (2074540, 200480) ?0
>
> 111 ? (2226450, 199725) ?0
>
> 112 ? (2066370, 182357) ?0
>
> 113 ? (2147350, 168939) ?0
>
> 114 ? (2254680, 165986) ?0
>
> 115 ? (2181890, 197303) ?0
>
> 116 ? (2029960, 198195) ?0
>
> 117 ? (2289210, 194380) ?0
>
> 118 ? (2137320, 194919) ?0
>
> 119 ? (2244650, 191898) ?0
>
> 120 ? (2092740, 192575) ?0
>
> 121 ? (1940780, 193737) ?0
>
> 122 ? (2200090, 189452) ?0
>
> 123 ? (2048160, 190269) ?0
>
> 124 ? (2155520, 187049) ?0
>
> 125 ? (2262850, 184082) ?0
>
> 126 ? (2110950, 184683) ?0
>
> 127 ? (2218290, 181616) ?0
>
> 128 ? (2173720, 179191) ?0
>
> 129 ? (2120980, 158699) ?0
>
> 130 ? (2236480, 173795) ?0
>
> 131 ? (2084580, 174458) ?0
>
> 132 ? (2191920, 171347) ?0
>
> 133 ? (2039990, 172149) ?0
>
> 134 ? (2299230, 168494) ?0
>
> 135 ? (2102780, 166572) ?0
>
> 136 ? (2210120, 163517) ?0
>
> 137 ? (2058200, 164243) ?0
>
> 138 ? (2228310, 155700) ?0
>
> 139 ? (2094600, 148470) ?0
>
> 140 ? (2076400, 156350) ?0
>
> 141 ? (2220130, 137616) ?0
>
> 142 ? (2068220, 138252) ?0
>
> 143 ? (2183750, 153250) ?0
>
> 144 ? (2112800, 140604) ?0
>
> 145 ? (2139170, 150840) ?0
>
> 146 ? (2246500, 147898) ?0
>
> 147 ? (2201940, 145427) ?0
>
> 148 ? (2050020, 146139) ?0
>
> 149 ? (2157370, 142996) ?0
>
> 150 ? (2264680, 140109) ?0
>
> 151 ? (2193750, 127345) ?0
>
> 152 ? (2203740, 101476) ?0
>
> 153 ? (2175560, 135164) ?0
>
> 154 ? (2130990, 132751) ?0
>
> 155 ? (2238310, 129820) ?0
>
> 156 ? (2086410, 130378) ?0
>
> 157 ? (2149180, 124911) ?0
>
> 158 ? (2256490, 122037) ?0
>
> 159 ? (2104610, 122518) ?0
>
> 160 ? (2211930, 119542) ?0
>
> 161 ? (2060020, 120164) ?0
>
> 162 ? (2167370, 117086) ?0
>
> 163 ? (2122800, 114671) ?0
>
> 164 ? (2230120, 111751) ?0
>
> 165 ? (2078220, 112296) ?0
>
> 166 ?(2187320, 65377.6) ?0
>
> 167 ?(2160920, 55121.2) ?0
>
> 168 ? (2185550, 109274) ?0
>
> 169 ? (2140980, 106838) ?0
>
> 170 ? (2248300, 103974) ?0
>
> 171 ? (2096410, 104442) ?0
>
> 172 ?(2240090, 85921.7) ?0
>
> 173 ? ?(2088200, 86376) ?0
>
> 174 ?(2124570, 70720.6) ?0
>
> 175 ? ?(2159170, 99019) ?0
>
> 176 ?(2114600, 96602.2) ?0
>
> 177 ?(2221920, 93691.9) ?0
>
> 178 ?(2070010, 94223.2) ?0
>
> 179 ?(2177350, 91213.9) ?0
>
> 180 ?(2132780, 88774.2) ?0
>
> 181 ?(2195530, 83422.5) ?0
>
> 182 ?(2150960, 80962.3) ?0
>
> 183 ?(2106390, 78541.3) ?0
>
> 184 ?(2213710, 75643.1) ?0
>
> 185 ?(2169140, 73162.6) ?0
>
> 186 ?(2205490, 57605.4) ?0
>
> 187 ? ?(2079990, 68319) ?0
>
> 188 ?(2142750, 62914.6) ?0
>
> 189 ?(2116350, 52677.1) ?0
>
> 190 ?(2179100, 47343.4) ?0
>
> 191 ?(2134520, 44877.3) ?0
>
> 192 ?(2170870, 29318.1) ?0
>
> 193 ?(2152700, 37090.6) ?0
>
> 194
> (2198950, -4186.01) ?0
>
>
>
> Yan Boulanger
> Dendrolab - Datation de b?timents patrimoniaux par dendrochronologie
> www.dendrolab.ca
> info at dendrolab.ca
>
>
>
> Universit? du Qu?bec ? Rimouski
> D?partement de Biologie
> Centre d'?tudes nordiques
> 300, all?e des Ursulines
> Rimouski, PQ G5L 3A1
> (418) 723-1986 poste 1482
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From zenlines at gmail.com  Tue Nov  2 19:04:57 2010
From: zenlines at gmail.com (Brian Oney)
Date: Tue, 02 Nov 2010 19:04:57 +0100
Subject: [R-sig-Geo] Reassigning coordinates?
In-Reply-To: <AANLkTikyGT8BGSR47XtMpoy=kO_jpw-Um2o1Dj75ieBR@mail.gmail.com>
References: <4CCFE121.8080804@gmail.com>
	<AANLkTikyGT8BGSR47XtMpoy=kO_jpw-Um2o1Dj75ieBR@mail.gmail.com>
Message-ID: <4CD052C9.7030708@gmail.com>

Hello Barry and Roger,

Thank you for the suggestions.
I got the nn2() function to work and took the coordinates of the nearest 
non-NA raster cell and assigned them to the points. I forgot to mention 
that I have raster cells that are non-NA and some that are not and my 
point lay in the NA zone (just barely). In this case, I set k=6 to get 
all surrounding raster cells (because some  of the nearest cells still 
have an NA value) that selected the coordinate set from the raster cell 
whose nn distance to the next non-na cell was minimal.
It was dirty but it worked.

Thanks for the help,

Brian

# Code
# rast.coords are a subset of relevant coodinates from the center of 
relevant raster cells. 'pc.na' is the xy-matrix of the coordinates 
needing reassigning.
near <- data.frame(nn2(rast.coords, pc.nan, k=6))
na.near.cell1 <- near$nn.idx.2
reassign.coords <- xyFromCell(pc.clime, cell=na.near.cell)
# Put them where they belong and voile.


On 11/2/2010 1:21 PM, Barry Rowlingson wrote:
> On Tue, Nov 2, 2010 at 10:00 AM, Brian Oney<zenlines at gmail.com>  wrote:
>> Hello List,
>> I need to reassign coordinates of a few points to have coordinates of the
>> nearest raster cell. I KNOW that this is BAD practice but for the time being
>> I  assume that it does not affect my analysis (species distribution
>> analysis). I think the datum of the point data is different than that of my
>> raster data, but for now it is not important.
>>
>> I have already perused the "sp" and "raster" packages extensively.
>> I guess I just need to be pointed in the right (WRONG) direction. I had a
>> few thoughts with the distance function but I am now stuck. Maybe use
>> "distance" then "which.min" then take the coordinates?
>>
>   If you have some points in a SpatialPointsDataFrame and a grid as a
> SpatialPixelsDataFrame then you can do an overlay. So for example,
> using 'm' from help(SpatialPixelsDataFrame) and 'pts' as some random
> clicking points:
>
>   >  pts[1:10,]
>          coordinates         zz
> 1  (179333, 330803) 0.76290682
> 2  (179600, 331026) 0.38275344
> 3  (180462, 331370) 0.75330357
> ...
>
>   >  overlay(m,pts)
>   [1] 1930 1737 1434 1093 1115 1495 1705 2025 2146 2386 1780  728  487 1056 1256
> [16] 1567 1778 1039  819 2465
>
>   - gives the index in 'm' where each point in pts is, hence something like:
>
>> cbind(coordinates(pts),coordinates(m)[overlay(m,pts),])
>               x        y      x      y
>   [1,] 179332.9 330802.6 179340 330820
>   [2,] 179599.7 331025.5 179580 331020
>   [3,] 180461.9 331369.9 180460 331380
>   [4,] 180533.7 331785.2 180540 331780
>   [5,] 180010.3 331734.6 180020 331740
>
>   gives the original and grid cell coordinates.
>
>   something similar might work with package:raster objects...
>
> Barry


From breitbach at uni-mainz.de  Wed Nov  3 17:43:08 2010
From: breitbach at uni-mainz.de (Breitbach, Nils)
Date: Wed, 3 Nov 2010 16:43:08 +0000
Subject: [R-sig-Geo] Projections and Transformations with Garmin GPS
	Coordinates?
Message-ID: <E7F1EF063B11DA4DAD16374549B879E82AE06266@e14mdb-03.zdv.Uni-Mainz.DE>

Dear Community,

I am faced with the problem of using coordinates downloaded from a Garmin GPS receiver in R using different projections (WGS1984, Gauss Krueger Zone 2 and Zone 3, UTM 32 N). The receiver preferences are as follows:

Grid	Breite/L?nge hddd.ddddd?
Datum	WGS 84

As I said above it is a Garmin receiver, as it is somehow important to judge what the receiver is using internally. Coordinates should be unprojected in decimal degrees.


I am already at the point where I have the coordinates in a data frame:

# create data frame with coordinates
map <- data.frame(x = Fielddata$Longitude, y = Fieldata$Lattitude, s = 1:length(rownames(Fielddata)))

# convert numbers in "real" coordinates; still without spatial reference
coordinates(map) <- ~ x + y


I now need to project the data correctly, but I am not sure if I did it in the right way (there are many EPSG codes available). Here is my version:

# assign spatial reference; via EPSG code set to WGS84
proj4string(map)<- CRS("+init=epsg:4326")

Does anybody of you know if this is the same definition as in the Garmin GPS receivers? Should result in correct WGS1984 coordinates.


I now tried to reproject the WGS1984 coordinates into the different other datums and projections that I need:

# transform/reproject from WGS84 to UTM32N
map2 <- spTransform(map,CRS("+init=epsg:32632"))

Is 32632 the correct ESPG code for "WGS 1984 / UTM Zone 32N" ? Or is should I use something differnt?
And now I also need some more conversions for land-use data sets (CORINE 2006 and German ATKIS) that I use and which were delivered in different datums and transformations. It is easier to convert my point coodrinates than the spatial polygons of the huge land-use data sets, so here is my version for that:

# transform/reproject from WGS84 to Gauss Krueger Zone 3 (for use with CORINE land-use data)
map3a <- spTransform(map,CRS("+init=epsg:2166"))

Again, is 2166 the correct ESPG code for "Gauss Kruger zone 3"? I did not find anything for Gauss Krueger Zone 2 on http://spatialreference.org/ref/ (you need to serch for Gauss Kruger)?! This fact lets me also doubt that my Zone 3 code is correct?! But I found an alternative for the two Gauss Krueger Zones --> "DHDN / 3-degree gauss-kruger zone 2 and 3":

# transform/reproject from WGS84 to Gauss Krueger Zone 3 (for use with CORINE land-use data); DHDN means Deutsches Hauptdreiecksnetz
map3b <- spTransform(map,CRS("+init=epsg:31467"))

# transform/reproject from WGS84 to Gauss Krueger Zone 2 (for use with ATKIS land-use data); DHDN means Deutsches Hauptdreiecksnetz
map4 <- spTransform(map,CRS("+init=epsg:31466")) 

I am almost sure, that this is the better/correct one. Which is the better suited transformation? Any comments on this?
Is it okay with spTransform to simply give the new datum/projection and use the unprojected WGS 1984 data as input? Or do I need to do anything with the input data or give some information to the function?

Many questions ... thanks a lot ...!
Best wishes,

Nils Breitbach

_________________________________________________________

Nils Breitbach, Dipl.-Biol.
Institut f?r Zoologie, Abt. 5: ?kologie
J.-J.-Becher-Weg 13
Johannes Gutenberg-Universit?t
55128 Mainz
Germany

phone: +49 6131 39-22718
fax:   +49 6131 39-23731
WWW: www.community-ecology.uni-mainz.de/126_ENG_HTML.php


From ricardorodot02 at gmail.com  Wed Nov  3 20:19:06 2010
From: ricardorodot02 at gmail.com (=?ISO-8859-1?Q?Ricardo_Rodr=EDguez?=)
Date: Wed, 3 Nov 2010 14:19:06 -0500
Subject: [R-sig-Geo] reclasssify a SpatialGrid
Message-ID: <AANLkTim+5KU1Nz0uqsxFjZEC1b2kUVmjAWtEiAMuwK1+@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101103/83142558/attachment.pl>

From ricardorodot02 at gmail.com  Wed Nov  3 20:28:23 2010
From: ricardorodot02 at gmail.com (=?ISO-8859-1?Q?Ricardo_Rodr=EDguez?=)
Date: Wed, 3 Nov 2010 14:28:23 -0500
Subject: [R-sig-Geo] printing error SpatialGrid plus poligons
Message-ID: <AANLkTimqhb5ktQVhBJoKwFdx0acYWLu_0BKB6kFchh1Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101103/d627b0fc/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Nov  3 21:54:51 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 03 Nov 2010 21:54:51 +0100
Subject: [R-sig-Geo] printing error SpatialGrid plus poligons
In-Reply-To: <AANLkTimqhb5ktQVhBJoKwFdx0acYWLu_0BKB6kFchh1Q@mail.gmail.com>
References: <AANLkTimqhb5ktQVhBJoKwFdx0acYWLu_0BKB6kFchh1Q@mail.gmail.com>
Message-ID: <4CD1CC1B.8070506@uni-muenster.de>



On 11/03/2010 08:28 PM, Ricardo Rodr?guez wrote:
> hello.
> Need, plotting in pdf, a result of an interpolation SpatialGrid and
> additionally some sites above, but with the following statement:
> 
> *pol <- list("sp.polygons", pol, fill="transparent")
> test.layout <- list(pol)

please try

test.layout = list("sp.polygons", pol, fill="transparent", first = FALSE)
> 
> spplot(test1["var1.pred"], AXES = TRUE,scale= TRUE,
> col.regions=bpy.colors(20),xlab="E-O",ylab="N-S",scales=list(draw=T),sp.layout
> =test.layout)*

you could as well omit the AXES = TRUE, it doesn't do anything.
> 
> 
> 
>  Something happens and a blue spot print, or print the below sites, that
> would fail to be ideal printing.
> 
> thanks for your answers and help
> 
> Ricardo Rodr?guez
> Univalle
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From karl at huftis.org  Thu Nov  4 08:58:16 2010
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Thu, 04 Nov 2010 08:58:16 +0100
Subject: [R-sig-Geo] Projections and Transformations with Garmin GPS
	Coordinates?
References: <E7F1EF063B11DA4DAD16374549B879E82AE06266@e14mdb-03.zdv.Uni-Mainz.DE>
Message-ID: <iatp2o$4a2$1@dough.gmane.org>

Breitbach, Nils wrote:

> # assign spatial reference; via EPSG code set to WGS84
> proj4string(map)<- CRS("+init=epsg:4326")
> 
> Does anybody of you know if this is the same definition as in the Garmin
> GPS receivers? Should result in correct WGS1984 coordinates.

Yes, that?s the correct EPSG code for longitude and latitude in WGS 84.
 
> I now tried to reproject the WGS1984 coordinates into the different other
> datums and projections that I need:
> 
> # transform/reproject from WGS84 to UTM32N
> map2 <- spTransform(map,CRS("+init=epsg:32632"))
> 
> Is 32632 the correct ESPG code for "WGS 1984 / UTM Zone 32N" ?

Yes.

> # transform/reproject from WGS84 to Gauss Krueger Zone 3 (for use with
> # CORINE land-use data)
> map3a <- spTransform(map,CRS("+init=epsg:2166"))
> 
> Again, is 2166 the correct ESPG code for "Gauss Kruger zone 3"?

It?s deprecated. http://spatialreference.org/ref/epsg/2166/ says to use 2397 
instead. But as you mention, there are several EPSG codes for Gauss-Kruger 
zone 3. You can try all of them, and see which fits best with yout data 
(note that some of them have an identical proj4string, and will therefore 
give the same output).

Note that the list of codes is also available inside R:

library(rgdal)
epsg=make_EPSG()
epsg[grepl("Gauss.*zone 3(\\D|$)", epsg$note), 1:2]

I find this easier to use than the search engine at Spatial Reference.

-- 
Karl Ove Hufthammer


From Christoph.Hauser at uibk.ac.at  Thu Nov  4 09:19:27 2010
From: Christoph.Hauser at uibk.ac.at (Hauser, Christoph)
Date: Thu, 4 Nov 2010 09:19:27 +0100
Subject: [R-sig-Geo] problem nblag_cumul and centroid computation
Message-ID: <A7E98C2BA8986D41B47ED5BDC95B25700C3CDCA3@VEX01.uibk.ac.at>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/3e221f63/attachment.pl>

From mspinola10 at gmail.com  Thu Nov  4 11:16:44 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 04 Nov 2010 04:16:44 -0600
Subject: [R-sig-Geo] Saving a spatial point object into a shapefile
Message-ID: <4CD2880C.5030406@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/21d07290/attachment.pl>

From villers.alexandre at gmail.com  Thu Nov  4 11:22:49 2010
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Thu, 04 Nov 2010 12:22:49 +0200
Subject: [R-sig-Geo] Saving a spatial point object into a shapefile
In-Reply-To: <4CD2880C.5030406@gmail.com>
References: <4CD2880C.5030406@gmail.com>
Message-ID: <4CD28979.2080101@gmail.com>

Hey,

The writeOGR function specifies (?writeOGR)
|obj| a SpatialPointsDataFrame, SpatialLinesDataFrame, or a 
SpatialPolygonsDataFrame object.

You need to convert first your SpatialPoints into spgdf

Best regards


Alex

On 04/11/2010 12:16, Manuel Sp?nola wrote:
> Dear list members,
>
> I am trying to save a spatial point object as a shapefile, but I got an
> error that I do not have the right object class, why?
>
>   >  sitiosMikeCRTM05
> SpatialPoints:
>                x       y
>    [1,] 480244.6 1181636
>    [2,] 480651.1 1184371
>    [3,] 477555.2 1181189
>    [4,] 486482.8 1167946
>    [5,] 483764.4 1164624
>    [6,] 477301.6 1192979
>    [7,] 483737.4 1192048
>    [8,] 480760.2 1192652
>    [9,] 479985.8 1150756
> [10,] 481748.5 1148902
> [11,] 476126.6 1165617
> [12,] 464735.7 1167079
> [13,] 481182.4 1185941
> [14,] 500632.8 1132727
> Coordinate Reference System (CRS) arguments: +proj=tmerc +lon_0=-84
> +lat_0=0 +x_0=500000 +k=0.9999 +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>
>   >  writeOGR(sitiosMikeCRTM05,
> dsn="C:/ProyectosRespacial/CBSS/Shapefiles_proyectados",
> layer="sitiosMikeCRTM05", driver="ESRI Shapefile")
> Error en writeOGR(sitiosMikeCRTM05, dsn =
> "C:/ProyectosRespacial/CBSS/Shapefiles_proyectados",  :
>     obj of wrong class
>
> Best,
>
> Manuel
>
>
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Alexandre Villers, PhD.
Postdoc researcher
Spatial Ecology & Population Dynamics
Section of Ecology, Department of Biology
University of Turku
FIN-20014 Turku
Finland

@mail: alexandre.villers at utu.fi
phone: 00358 (0)2 333 5049

Skype You can skype me (but think of using Ekiga instead !) 
<skype:aquila06?call>


*Use open source and free softwares*
<http://cran.r-project.org/> <http://grass.itc.it/> 
<http://www.qgis.org/> <http://fr.openoffice.org/> 
<http://www.mozilla-europe.org/fr/> <http://www.mozilla-europe.org/fr/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/59f5840c/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Skypelogo.jpg
Type: image/jpeg
Size: 5395 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/59f5840c/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rlogo.jpg
Type: image/jpeg
Size: 1753 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/59f5840c/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: GRASSlogo.png
Type: image/png
Size: 3277 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/59f5840c/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: QGIS.png
Type: image/png
Size: 4144 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/59f5840c/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OOlogo.gif
Type: image/gif
Size: 4246 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/59f5840c/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: TBlogo.jpg
Type: image/jpeg
Size: 1385 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/59f5840c/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: FFlogo.jpg
Type: image/jpeg
Size: 1686 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/59f5840c/attachment-0003.jpg>

From edzer.pebesma at uni-muenster.de  Thu Nov  4 11:25:21 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 04 Nov 2010 11:25:21 +0100
Subject: [R-sig-Geo] Saving a spatial point object into a shapefile
In-Reply-To: <4CD2880C.5030406@gmail.com>
References: <4CD2880C.5030406@gmail.com>
Message-ID: <4CD28A11.4000607@uni-muenster.de>



On 11/04/2010 11:16 AM, Manuel Sp?nola wrote:
> Dear list members,
> 
> I am trying to save a spatial point object as a shapefile, but I got an 
> error that I do not have the right object class, why?

Because the documentation sais so. ?writeOGR tells me:

Usage:

     writeOGR(obj, dsn, layer, driver, dataset_options = NULL,
layer_options=NULL, verbose = FALSE)

Arguments:

     obj: a SpatialPointsDataFrame, SpatialLinesDataFrame, or a
          SpatialPolygonsDataFrame object.
...

you can create a SpatialPointsDataFrame with dummy attributes from your
object by:

x = SpatialPointsDataFrame(sitiosMikeCRTM05, data.frame(dummy = rep(1,14))

> 
>  > sitiosMikeCRTM05
> SpatialPoints:
>               x       y
>   [1,] 480244.6 1181636
>   [2,] 480651.1 1184371
>   [3,] 477555.2 1181189
>   [4,] 486482.8 1167946
>   [5,] 483764.4 1164624
>   [6,] 477301.6 1192979
>   [7,] 483737.4 1192048
>   [8,] 480760.2 1192652
>   [9,] 479985.8 1150756
> [10,] 481748.5 1148902
> [11,] 476126.6 1165617
> [12,] 464735.7 1167079
> [13,] 481182.4 1185941
> [14,] 500632.8 1132727
> Coordinate Reference System (CRS) arguments: +proj=tmerc +lon_0=-84 
> +lat_0=0 +x_0=500000 +k=0.9999 +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> 
>  > writeOGR(sitiosMikeCRTM05, 
> dsn="C:/ProyectosRespacial/CBSS/Shapefiles_proyectados", 
> layer="sitiosMikeCRTM05", driver="ESRI Shapefile")
> Error en writeOGR(sitiosMikeCRTM05, dsn = 
> "C:/ProyectosRespacial/CBSS/Shapefiles_proyectados",  :
>    obj of wrong class
> 
> Best,
> 
> Manuel
> 
> 
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From b.rowlingson at lancaster.ac.uk  Thu Nov  4 11:34:12 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 4 Nov 2010 10:34:12 +0000
Subject: [R-sig-Geo] Saving a spatial point object into a shapefile
In-Reply-To: <4CD28A11.4000607@uni-muenster.de>
References: <4CD2880C.5030406@gmail.com>
	<4CD28A11.4000607@uni-muenster.de>
Message-ID: <AANLkTik4ZZ6Uw=6izzreYqxS5t93YME_w1xQPX7VLx7g@mail.gmail.com>

On Thu, Nov 4, 2010 at 10:25 AM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:

> Because the documentation sais so. ?writeOGR tells me:
>
> Usage:
>
> ? ? writeOGR(obj, dsn, layer, driver, dataset_options = NULL,
> layer_options=NULL, verbose = FALSE)
>
> Arguments:
>
> ? ? obj: a SpatialPointsDataFrame, SpatialLinesDataFrame, or a
> ? ? ? ? ?SpatialPolygonsDataFrame object.

Although that's not what the code says:

 if (!"data" %in% names(getSlots(class(obj))))
        stop("obj of wrong class")

 - it just looks to see if there's a 'data' slot in the argument, and
then carries on, stumbling blindly into all sorts of problems if one
is dumb enough to create a class with a data slot:

 > setClass("foo",representation(data="numeric"))
 > z=new("foo")
 > writeOGR(z,dsn="/tmp",layer="pts",driver="ESRI Shapefile")
Error in writeOGR(z, dsn = "/tmp", layer = "pts", driver = "ESRI Shapefile") :
  NULL NULL unknown data type

Surely there should be _methods_ for writeOGR for classes that it
supports, such as SpatialPointsDataFrame. Explicitly testing for the
presence of a slot/member is worse than explicitly testing for the
name of a class when you should really use 'inherits' which is worse
than the correct approach which is writing methods...

 *end mini-rant* :)

Barry


From edzer.pebesma at uni-muenster.de  Thu Nov  4 11:43:07 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 04 Nov 2010 11:43:07 +0100
Subject: [R-sig-Geo] Saving a spatial point object into a shapefile
In-Reply-To: <AANLkTik4ZZ6Uw=6izzreYqxS5t93YME_w1xQPX7VLx7g@mail.gmail.com>
References: <4CD2880C.5030406@gmail.com>	<4CD28A11.4000607@uni-muenster.de>
	<AANLkTik4ZZ6Uw=6izzreYqxS5t93YME_w1xQPX7VLx7g@mail.gmail.com>
Message-ID: <4CD28E3B.8080603@uni-muenster.de>



On 11/04/2010 11:34 AM, Barry Rowlingson wrote:
> On Thu, Nov 4, 2010 at 10:25 AM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
> 
>> Because the documentation sais so. ?writeOGR tells me:
>>
>> Usage:
>>
>>     writeOGR(obj, dsn, layer, driver, dataset_options = NULL,
>> layer_options=NULL, verbose = FALSE)
>>
>> Arguments:
>>
>>     obj: a SpatialPointsDataFrame, SpatialLinesDataFrame, or a
>>          SpatialPolygonsDataFrame object.
> 
> Although that's not what the code says:
> 
>  if (!"data" %in% names(getSlots(class(obj))))
>         stop("obj of wrong class")
> 
>  - it just looks to see if there's a 'data' slot in the argument, and
> then carries on, stumbling blindly into all sorts of problems if one
> is dumb enough to create a class with a data slot:
> 
>  > setClass("foo",representation(data="numeric"))
>  > z=new("foo")
>  > writeOGR(z,dsn="/tmp",layer="pts",driver="ESRI Shapefile")
> Error in writeOGR(z, dsn = "/tmp", layer = "pts", driver = "ESRI Shapefile") :
>   NULL NULL unknown data type
> 
> Surely there should be _methods_ for writeOGR for classes that it
> supports, such as SpatialPointsDataFrame. Explicitly testing for the
> presence of a slot/member is worse than explicitly testing for the
> name of a class when you should really use 'inherits' which is worse
> than the correct approach which is writing methods...
> 
>  *end mini-rant* :)

Although you're the first one to bring up this feature (bug?) of
writeOGR, I fully agree. Using methods would also allow e.g. package
raster to define a writeGDAL method for Raster, stacks, bricks, and the
like. In that case we might have to define the method first in sp (rgdal
depends on sp), so that other package don't require rgdal - CRAN still
does not provide OS-X and solaris ports.

> 
> Barry

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mspinola10 at gmail.com  Thu Nov  4 13:43:58 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 04 Nov 2010 06:43:58 -0600
Subject: [R-sig-Geo] how to dismiss points outside of my area of interest in
	a raster
Message-ID: <4CD2AA8E.7090804@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/ffd9d3f4/attachment.pl>

From pelt at knmi.nl  Thu Nov  4 14:24:46 2010
From: pelt at knmi.nl (pelt)
Date: Thu, 04 Nov 2010 13:24:46 +0000
Subject: [R-sig-Geo] [R-sig-geo]: Plot spatial data with spplot and maps
Message-ID: <4CD2B41E.9050807@knmi.nl>

Hi all,

I have made a plot with ssplot, using a SpatialPointsDataFrame. The
content is quite simple, as I have 9 grid points with lon/lat
coordinates and 9 values attached to these coordinates. They are in a
square area of 3 by 3 gridboxes.
I would like to lay a map from maps() over these values, but when I try
this, the grids of the maps  do not overlap with the grids I have
already created with spplot(). I would like shaded gridboxes, the boxes
should be filled with colour. Can anyone help me with this problem?
Thank you in advance!
This is part of my code:

lonlim <-c(4.5,12)
latlim <-c(46.5,52.5)

map(xlim=lonlim, ylim=latlim,col='white')

gt=GridTopology(cellcentre.offset=c(5.75,47.5),cellsize=c(2.5,2),cells.dim=c(3,3)) 

grd=SpatialGrid(gt,proj4string = CRS(as.character(NA)))
gridparameters(grd)
gd<-as.data.frame(grd,"SpatialGrid")
h<-season_djf  # which are 9 values
h<-as.data.frame(h)
djf.att=SpatialPointsDataFrame(gd,h)
gridded(djf.att)=TRUE

spplot(djf.att, col.regions = colorRampPalette(c("red","orange",
"yellow", "lightblue", "blue",
"purple")), xlab="Longitude(?)",
ylab="Latitude(?)",add=T,scales=list(draw=T),main="Seasonal change",
font.main=4)

map('rivers',add=T)
map('worldHires',add=T)

Regards,
Saskia van Pelt


From karl at huftis.org  Thu Nov  4 15:32:25 2010
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Thu, 04 Nov 2010 15:32:25 +0100
Subject: [R-sig-Geo] [R-sig-geo]: Plot spatial data with spplot and maps
References: <4CD2B41E.9050807@knmi.nl>
Message-ID: <iaug5p$fpe$1@dough.gmane.org>

pelt wrote:

> I have made a plot with ssplot, using a SpatialPointsDataFrame. The
> content is quite simple, as I have 9 grid points with lon/lat
> coordinates and 9 values attached to these coordinates. They are in a
> square area of 3 by 3 gridboxes.
> I would like to lay a map from maps() over these values, but when I try
> this, the grids of the maps  do not overlap with the grids I have
> already created with spplot().

You?re trying to mix ?base? graphics and ?grid? graphics, which doesn?t work.
?spplot? use ?lattice? graphics (based on ?grid?), so you?ll have to modify
its ?panel? function. Here?s a very simple example.

BTW, I recommend reading the ?lattice? book to understand how to use ?panel? 
functions: http://lmdvr.r-forge.r-project.org/figures/figures.html

library(sp)
library(lattice)
library(maps)
library(maptools)
n=100

d=data.frame(x=rnorm(n,0,20),y=rnorm(n,0,20),z=1:n)
xl=range(d$x)
yl=range(d$y)
coordinates(d)=~x+y
spplot(d, panel=function(...) {
  panel.fill("lightblue3")
  wmap=map("world", fill=TRUE, plot=FALSE,
           xlim=xl, ylim=yl, resolution=0)
  wmap[c("x", "y")]=mapthin(wmap[c("x", "y")],1)
  wmap.sp=map2SpatialPolygons(wmap, wmap$names)
  sp.polygons(wmap.sp,fill="khaki", col=NA,lwd=2)
  panel.pointsplot(...)
}, xlim=xl, ylim=yl )

The reason for the slow drawing is that each polygon is plotted separately,
and the map polygon also contains areas outside ?xl? and ?yl?. (This is easy
enough to fix by merging and clipping the polygons.)

-- 
Karl Ove Hufthammer


From odonnems at yahoo.com  Thu Nov  4 15:34:28 2010
From: odonnems at yahoo.com (Michael ODonnell)
Date: Thu, 4 Nov 2010 07:34:28 -0700 (PDT)
Subject: [R-sig-Geo] raster package and predict for GBM models
Message-ID: <519902.86587.qm@web58007.mail.re3.yahoo.com>

Hello, 

I have little experience using the raster package and I am currently trying to develop a predicted surface based on a gradient boosted model (gbm package).

The basic steps I am using include the following:

# Creating a raster stack of independent variables
USHGT <- raster("ushgt.asc", package="raster")
... (other variables omitted for post)
ras_stk <- stack(USHGT, HYELB, T1TO5LE, URBD_D, SG_UNIT, MINTEMP, ANNPCP, TC_B04, TC_B07)

# Create the prediction model
... I am using a separate script that creates the gbm object and due to the length I will not include. The outcome is a gbm object.

.. Now I use the following, which fails:
r <- predict(ras_stk, myData, filename=OutFile, na.rm=TRUE, overwrite=TRUE, n.trees=myData$n.trees, type="response", progress="window")

Error:
Error in model.frame.default(terms(reformulate(object$var.names)), newdata,  :object is not a matrix

The raster package manual states that the predict function will work on any model that a predict method has been implemented.

Does anyone have experience with this or possibly an idea on how I might solve the issue.

Thank you,
mike


From r.hijmans at gmail.com  Thu Nov  4 17:46:15 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 4 Nov 2010 09:46:15 -0700
Subject: [R-sig-Geo] how to dismiss points outside of my area of
 interest in a raster
In-Reply-To: <4CD2AA8E.7090804@gmail.com>
References: <4CD2AA8E.7090804@gmail.com>
Message-ID: <AANLkTi=7LEC_wLjJSdrQLpkhaC7yRCnEO+sCr2bO9nxF@mail.gmail.com>

Manuel,

library(raster)
# Assuming you have matrix of points (or SpatialPoints*)
pt <- (cbind(runif(100), runif(100)) -0.5) * 500
spt <- SpatialPoints(pt)
# and a RasterLayer
r <- raster()

# you can do

e <- polygonFromExtent(r)
o <- overlay(e, spt)
o <- which(!is.na(o))
pts <- pt[o,]


# show that it worked
plot(pt)
r[] = 1
plot(r, add=TRUE, legend=FALSE)
points(pt, col='blue')
points(pts, col='red', pch=20)


Robert

On Thu, Nov 4, 2010 at 5:43 AM, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
> Dear list members,
>
> How can eliminate or dismiss points that do not "touch" my raster file?
> This mean those points that are outside of the raster area.
> When I have my plot of the rester and I draw the points:
>
> points (villages)
>
> some of them are outside of the raster not because an error but just
> because the point file is bigger in extent than the raster.
>
> Thank you very much in advance.
> Best,
>
> Manuel
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From r.hijmans at gmail.com  Thu Nov  4 17:58:37 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 4 Nov 2010 09:58:37 -0700
Subject: [R-sig-Geo] raster package and predict for GBM models
In-Reply-To: <519902.86587.qm@web58007.mail.re3.yahoo.com>
References: <519902.86587.qm@web58007.mail.re3.yahoo.com>
Message-ID: <AANLkTi=7TBsyUVWcOLiGqEi_tTRwDNSDcjaRVXODKV-t@mail.gmail.com>

Hi Mike,

I cannot know from what you send, but the second argument should be
your gbm object, and from your name "myData" I am guessing it is not
(unless it really is referring to youModel).
One of the two vignettes of the 'dismo' package is about 'gbm'
(boosted regression trees) and 'raster' . So in principle it should
work.

Robert


On Thu, Nov 4, 2010 at 7:34 AM, Michael ODonnell <odonnems at yahoo.com> wrote:
> Hello,
>
> I have little experience using the raster package and I am currently trying to develop a predicted surface based on a gradient boosted model (gbm package).
>
> The basic steps I am using include the following:
>
> # Creating a raster stack of independent variables
> USHGT <- raster("ushgt.asc", package="raster")
> ... (other variables omitted for post)
> ras_stk <- stack(USHGT, HYELB, T1TO5LE, URBD_D, SG_UNIT, MINTEMP, ANNPCP, TC_B04, TC_B07)
>
> # Create the prediction model
> ... I am using a separate script that creates the gbm object and due to the length I will not include. The outcome is a gbm object.
>
> .. Now I use the following, which fails:
> r <- predict(ras_stk, myData, filename=OutFile, na.rm=TRUE, overwrite=TRUE, n.trees=myData$n.trees, type="response", progress="window")
>
> Error:
> Error in model.frame.default(terms(reformulate(object$var.names)), newdata, ?:object is not a matrix
>
> The raster package manual states that the predict function will work on any model that a predict method has been implemented.
>
> Does anyone have experience with this or possibly an idea on how I might solve the issue.
>
> Thank you,
> mike
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mspinola10 at gmail.com  Thu Nov  4 18:21:30 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 04 Nov 2010 11:21:30 -0600
Subject: [R-sig-Geo] how to dismiss points outside of my area of
 interest in a raster
In-Reply-To: <AANLkTi=7LEC_wLjJSdrQLpkhaC7yRCnEO+sCr2bO9nxF@mail.gmail.com>
References: <4CD2AA8E.7090804@gmail.com>
	<AANLkTi=7LEC_wLjJSdrQLpkhaC7yRCnEO+sCr2bO9nxF@mail.gmail.com>
Message-ID: <4CD2EB9A.5040602@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/11769278/attachment.pl>

From mspinola10 at gmail.com  Thu Nov  4 18:25:51 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 04 Nov 2010 11:25:51 -0600
Subject: [R-sig-Geo] Convert from spatialpointsdataframe to spatialpoints
Message-ID: <4CD2EC9F.2050000@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/d5b7be75/attachment.pl>

From r.hijmans at gmail.com  Thu Nov  4 18:41:15 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 4 Nov 2010 10:41:15 -0700
Subject: [R-sig-Geo] Convert from spatialpointsdataframe to spatialpoints
In-Reply-To: <4CD2EC9F.2050000@gmail.com>
References: <4CD2EC9F.2050000@gmail.com>
Message-ID: <AANLkTikub6cdL3R5WGssPikcOUah0+MedPwqERXPDvme@mail.gmail.com>

Manuel.

Did you try it without converting? The help file in raster says it
needs a SpatialPoints* object. The '*' is a wild card that in this
case stands for 'DataFrame'.

The answer to your question:

as(x, 'SpatialPoints')

You could find the answer to many of this type of questions by reading
the vignettes of sp and raster, and by searching the R-sig-geo help
archives, and looking at the R spatial wiki.

Robert

On Thu, Nov 4, 2010 at 10:25 AM, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
> Dear list members,
>
>
> I am trying to create a raster from points, but I read the points from a
> shapfile, so I have the points object as a SpatialPointsDataFrame.
> To use the function pointsToRaster I need the points as SpatialPoints.
>
> How to convert a SpatialPointsDataFrame object to a SpatialPoints?
> Best,
>
> Manuel
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From mspinola10 at gmail.com  Thu Nov  4 19:02:30 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 04 Nov 2010 12:02:30 -0600
Subject: [R-sig-Geo] Convert from spatialpointsdataframe to spatialpoints
In-Reply-To: <AANLkTikub6cdL3R5WGssPikcOUah0+MedPwqERXPDvme@mail.gmail.com>
References: <4CD2EC9F.2050000@gmail.com>
	<AANLkTikub6cdL3R5WGssPikcOUah0+MedPwqERXPDvme@mail.gmail.com>
Message-ID: <4CD2F536.9050102@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/c3628355/attachment.pl>

From r.hijmans at gmail.com  Thu Nov  4 20:16:47 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 4 Nov 2010 12:16:47 -0700
Subject: [R-sig-Geo] Convert from spatialpointsdataframe to spatialpoints
In-Reply-To: <4CD2F536.9050102@gmail.com>
References: <4CD2EC9F.2050000@gmail.com>
	<AANLkTikub6cdL3R5WGssPikcOUah0+MedPwqERXPDvme@mail.gmail.com>
	<4CD2F536.9050102@gmail.com>
Message-ID: <AANLkTimW+bPp3v05DfCK1+WbbmbR64c8517YjJXxJizm@mail.gmail.com>

Manuel,

I think this is wrong:
>> r = pointsToRaster(poblados, r)

Try:
r <- pointsToRaster(r, poblados)


Robert

On Thu, Nov 4, 2010 at 11:02 AM, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
> Thank you very much Robert.
>
> I am reading the raster vignette right now.
>
> I got this error:
>
>> r = raster(corredor)
>> res(r) = 50
>> r = pointsToRaster(poblados, r)
> Error en .pointsToMatrix(xy) :
> ? points should be vectors of length 2, matrices with 2 columns, or a
> SpatialPoints* object
>> poblados at data
> ????????? x?????? y
> 1? 500577.8 1155145
> 2? 495470.2 1164700
> 3? 489082.0 1152228
> 4? 494559.3 1171489
> 5? 492094.0 1157327
> 6? 490937.9 1155423
> 7? 488748.0 1153979
> 8? 491910.8 1154378
> 9? 485430.7 1148051
> 10 500060.9 1148109
> 11 491212.5 1159109
> 12 487253.9 1151491
> 13 480244.6 1181636
> 14 480651.1 1184371
> 15 477555.2 1181189
> 16 486482.8 1167946
> 17 483764.4 1164624
> 18 477301.6 1192979
> 19 483737.4 1192048
> 20 480760.2 1192652
> 21 476126.6 1165617
> 22 481182.4 1185941
>
>
> Best,
>
> Manuel
>
> On 04/11/2010 11:41 a.m., Robert J. Hijmans wrote:
>
> Manuel.
>
> Did you try it without converting? The help file in raster says it
> needs a SpatialPoints* object. The '*' is a wild card that in this
> case stands for 'DataFrame'.
>
> The answer to your question:
>
> as(x, 'SpatialPoints')
>
> You could find the answer to many of this type of questions by reading
> the vignettes of sp and raster, and by searching the R-sig-geo help
> archives, and looking at the R spatial wiki.
>
> Robert
>
> On Thu, Nov 4, 2010 at 10:25 AM, Manuel Sp?nola <mspinola10 at gmail.com>
> wrote:
>
> Dear list members,
>
>
> I am trying to create a raster from points, but I read the points from a
> shapfile, so I have the points object as a SpatialPointsDataFrame.
> To use the function pointsToRaster I need the points as SpatialPoints.
>
> How to convert a SpatialPointsDataFrame object to a SpatialPoints?
> Best,
>
> Manuel
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
> Manuel Sp?nola, Ph.D.
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> Institutional website: ICOMVIS


From govindas at msu.edu  Thu Nov  4 20:18:53 2010
From: govindas at msu.edu (govindas at msu.edu)
Date: Thu, 04 Nov 2010 15:18:53 -0400
Subject: [R-sig-Geo] plotting time series for particular months!
Message-ID: <20101104151853.93076j1dwbv9pwrh@mail.msu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/e354b4b7/attachment.pl>

From odonnems at yahoo.com  Thu Nov  4 20:26:45 2010
From: odonnems at yahoo.com (Michael ODonnell)
Date: Thu, 4 Nov 2010 12:26:45 -0700 (PDT)
Subject: [R-sig-Geo] raster package and predict for GBM models
In-Reply-To: <AANLkTi=7TBsyUVWcOLiGqEi_tTRwDNSDcjaRVXODKV-t@mail.gmail.com>
Message-ID: <468619.42773.qm@web58003.mail.re3.yahoo.com>

Robert, sorry. Yes, myData is my gbm object. 

Also, I figured out what I had done wrong. The raster stack I created specified a data set name that was lowercase and the the gbm model was specifying upper case for the same raster layer. Once I use the correct name, it worked.

Thank you for the response.
Mike


--- On Thu, 11/4/10, Robert J. Hijmans <r.hijmans at gmail.com> wrote:

> From: Robert J. Hijmans <r.hijmans at gmail.com>
> Subject: Re: [R-sig-Geo] raster package and predict for GBM models
> To: "Michael ODonnell" <odonnems at yahoo.com>
> Cc: r-sig-geo at stat.math.ethz.ch
> Date: Thursday, November 4, 2010, 10:58 AM
> Hi Mike,
> 
> I cannot know from what you send, but the second argument
> should be
> your gbm object, and from your name "myData" I am guessing
> it is not
> (unless it really is referring to youModel).
> One of the two vignettes of the 'dismo' package is about
> 'gbm'
> (boosted regression trees) and 'raster' . So in principle
> it should
> work.
> 
> Robert
> 
> 
> On Thu, Nov 4, 2010 at 7:34 AM, Michael ODonnell <odonnems at yahoo.com>
> wrote:
> > Hello,
> >
> > I have little experience using the raster package and
> I am currently trying to develop a predicted surface based
> on a gradient boosted model (gbm package).
> >
> > The basic steps I am using include the following:
> >
> > # Creating a raster stack of independent variables
> > USHGT <- raster("ushgt.asc", package="raster")
> > ... (other variables omitted for post)
> > ras_stk <- stack(USHGT, HYELB, T1TO5LE, URBD_D,
> SG_UNIT, MINTEMP, ANNPCP, TC_B04, TC_B07)
> >
> > # Create the prediction model
> > ... I am using a separate script that creates the gbm
> object and due to the length I will not include. The outcome
> is a gbm object.
> >
> > .. Now I use the following, which fails:
> > r <- predict(ras_stk, myData, filename=OutFile,
> na.rm=TRUE, overwrite=TRUE, n.trees=myData$n.trees,
> type="response", progress="window")
> >
> > Error:
> > Error in
> model.frame.default(terms(reformulate(object$var.names)),
> newdata, ?:object is not a matrix
> >
> > The raster package manual states that the predict
> function will work on any model that a predict method has
> been implemented.
> >
> > Does anyone have experience with this or possibly an
> idea on how I might solve the issue.
> >
> > Thank you,
> > mike
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 





From moshersteven at gmail.com  Thu Nov  4 20:33:04 2010
From: moshersteven at gmail.com (steven mosher)
Date: Thu, 4 Nov 2010 12:33:04 -0700
Subject: [R-sig-Geo] plotting time series for particular months!
In-Reply-To: <20101104151853.93076j1dwbv9pwrh@mail.msu.edu>
References: <20101104151853.93076j1dwbv9pwrh@mail.msu.edu>
Message-ID: <AANLkTinWf+hi+y_8bpZ8znk5-WNWyTY6Y3JSAQOvD01u@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/a26274fc/attachment.pl>

From mspinola10 at gmail.com  Thu Nov  4 21:07:27 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 04 Nov 2010 14:07:27 -0600
Subject: [R-sig-Geo] Convert from spatialpointsdataframe to spatialpoints
In-Reply-To: <AANLkTimW+bPp3v05DfCK1+WbbmbR64c8517YjJXxJizm@mail.gmail.com>
References: <4CD2EC9F.2050000@gmail.com>	<AANLkTikub6cdL3R5WGssPikcOUah0+MedPwqERXPDvme@mail.gmail.com>	<4CD2F536.9050102@gmail.com>
	<AANLkTimW+bPp3v05DfCK1+WbbmbR64c8517YjJXxJizm@mail.gmail.com>
Message-ID: <4CD3127F.9040309@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/105e7f57/attachment.pl>

From govindas at msu.edu  Thu Nov  4 22:36:22 2010
From: govindas at msu.edu (govindas at msu.edu)
Date: Thu, 04 Nov 2010 17:36:22 -0400
Subject: [R-sig-Geo] plotting time series for particular months!
In-Reply-To: <AANLkTinWf+hi+y_8bpZ8znk5-WNWyTY6Y3JSAQOvD01u@mail.gmail.com>
References: <20101104151853.93076j1dwbv9pwrh@mail.msu.edu>
	<AANLkTinWf+hi+y_8bpZ8znk5-WNWyTY6Y3JSAQOvD01u@mail.gmail.com>
Message-ID: <20101104173622.327465q203o894k6@mail.msu.edu>



thanks .. and it did work! but i see some jagged lines in between the years, typically like the one? joining dec of previous year and oct of the successive year. Is this how it would look like? can it be made better?

have included the plot!

heres the code..!

x.date <- as.Date(paste(chn.arr[,1], chn.arr[,2], chn.arr[,3], sep="-"))
ts.chn <- ts(chn.arr[1:2386,4])
z.chn <- zoo(ts.chn, x.date)
plot(z.chn, main = "Rainfall variations", xlab = "Year", ylab="Daily rainfall (mm)")

-- 
Regards,
Mahalakshmi
Graduate Student
#20, Department of Geography
Michigan State University
East Lansing, MI 48824 Quoting steven mosher <moshersteven at gmail.com>:

> I would look at using? the package 'zoo' your time series data would be a
> zoo object
> and then your date data? would be coerced as well,
>
> zoo, is very slick.
>
> On Thu, Nov 4, 2010 at 12:18 PM, <govindas at msu.edu> wrote:
>
>>
>>
>> Hi all,
>>
>> I have a matrix as given below...
>>
>> year month day prec
>> 1? ?1980? ? 10? ?1 13.4
>> 2? ?1980? ? 10? ?2? 0.0
>> 3? ?1980? ? 10? ?3? 0.0
>> 4? ?1980? ? 10? ?4? 0.0
>> 5? ?1980? ? 10? ?5? 0.0
>> 6? ?1980? ? 10? ?6? 0.0
>> 7? ?1980? ? 10? ?7? 0.0
>> 8? ?1980? ? 10? ?8? 0.0
>> 9? ?1980? ? 10? ?9? 0.0
>> 10? 1980? ? 10? 10? 0.0
>> 11? 1980? ? 10? 11? 7.4
>> 12? 1980? ? 10? 12? 5.4
>> 13? 1980? ? 10? 13? 7.2
>> 14? 1980? ? 10? 14? 0.0
>> 15? 1980? ? 10? 15? 0.0
>> 16? 1980? ? 10? 16? 0.0
>> 17? 1980? ? 10? 17 41.2
>> 18? 1980? ? 10? 18? 0.0
>> 19? 1980? ? 10? 19? 0.0
>> 20? 1980? ? 10? 20? 0.0
>> 21? 1980? ? 10? 21? 0.0
>> 22? 1980? ? 10? 22? 0.0
>> 23? 1980? ? 10? 23? 0.0
>> 24? 1980? ? 10? 24? 0.0
>> 25? 1980? ? 10? 25? 0.0
>> 26? 1980? ? 10? 26? 0.0
>> 27? 1980? ? 10? 27? 2.0
>> 28? 1980? ? 10? 28? 0.0
>> 29? 1980? ? 10? 29? 0.0
>> 30? 1980? ? 10? 30? 0.0
>> 31? 1980? ? 10? 31? 0.0
>> 32? 1980? ? 11? ?1? 0.0
>> 33? 1980? ? 11? ?2? 0.0
>> 34? 1980? ? 11? ?3? 0.0
>> 35? 1980? ? 11? ?4? 0.0
>> 36? 1980? ? 11? ?5 12.4
>>
>> the precipitation values extend from 1980 to 2005, but only for october,
>> november and december. I would? like to plot just these 3 months for the
>> given time period (1980 -? 2005). Is there a way to get these values in the
>> x-axis. i.e. i need a? plot with its axis reading "1980, 1981, 1982 .. 2005"
>> (even if the? months are specified then it should be of more use). for now,
>> i get an? axis like .. "0, 500, ... 2000" (the plot is giving the index
>> values).
>>
>> i tried changing the freq as given below, but did not work!
>> ts.chn <- ts(chn.arr[1:2386,4], start=c(1980, 10), end=c(2005, 12),
>> freq=365)
>> plot(ts.chn)
>>
>> --
>> Regards,
>> Mahalakshmi
>> Graduate Student
>> #20, Department of Geography
>> Michigan State University
>> East Lansing, MI 48824
>>? ? ? ? [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/f6396585/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RF_zoo.jpeg
Type: image/jpeg
Size: 79123 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/f6396585/attachment.jpeg>

From moshersteven at gmail.com  Thu Nov  4 23:25:05 2010
From: moshersteven at gmail.com (steven mosher)
Date: Thu, 4 Nov 2010 15:25:05 -0700
Subject: [R-sig-Geo] plotting time series for particular months!
In-Reply-To: <20101104173622.327465q203o894k6@mail.msu.edu>
References: <20101104151853.93076j1dwbv9pwrh@mail.msu.edu>
	<AANLkTinWf+hi+y_8bpZ8znk5-WNWyTY6Y3JSAQOvD01u@mail.gmail.com>
	<20101104173622.327465q203o894k6@mail.msu.edu>
Message-ID: <AANLkTimgiRAHchqE361VRRk8u6SeZYeddhWobM+Lgabw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/cc563a26/attachment.pl>

From osoong+r at gmail.com  Fri Nov  5 00:05:11 2010
From: osoong+r at gmail.com (Oliver Soong)
Date: Thu, 4 Nov 2010 16:05:11 -0700
Subject: [R-sig-Geo] rgdal, multiband CCITT compression
Message-ID: <AANLkTinVFAEBzfmjUZL84h7GMWpVjZtudfYrZ8dg264k@mail.gmail.com>

Hello,

I can't seem to write a multi-band 1-bit CCITT-compressed GeoTIFF
(using any of the CCITT compression methods).  The file writes, but
when reloaded the data are wrong (I can't tell for sure whether this
is a read or write problem).  I can write a 1-band 1-bit
CCITT-compressed GeoTIFF fine, and I can write a multi-band 1-bit
deflate-compressed GeoTIFF fine.  This is on Windows XP x86, R 2.12.0,
rgdal 0.6-28, sp 0.9-72, GDAL 1.7.1, PROJ.4 4.7.1.

On a similar note, only GDAL seems to be able to handle any multi-band
1-bit GeoTIFFs it produces.  ArcGIS 10 explicitly states (somewhere
deep in their documentation) that multi-band 1-bit TIFFs are not
supported.  Even without compression, ENVI throws an error about an
array with a corrupted descriptor, then crashes out.

Is this a bug, or a limitation of TIFF, CCITT, or GDAL that I'm not aware of?

Thoughts are appreciated,
Oliver


-- 
Oliver Soong
Donald Bren School of Environmental Science & Management
University of California, Santa Barbara
Santa Barbara, CA 93106-5131
805-893-7044 (office)
610-291-9706 (cell)


From mdsumner at gmail.com  Fri Nov  5 00:18:34 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 5 Nov 2010 10:18:34 +1100
Subject: [R-sig-Geo] rgdal, multiband CCITT compression
In-Reply-To: <AANLkTinVFAEBzfmjUZL84h7GMWpVjZtudfYrZ8dg264k@mail.gmail.com>
References: <AANLkTinVFAEBzfmjUZL84h7GMWpVjZtudfYrZ8dg264k@mail.gmail.com>
Message-ID: <AANLkTi=SYUAuBQELQVesssJfrxXfqdLhdcwAt_L8kxNU@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/96977592/attachment.pl>

From Craig.Mundy at utas.edu.au  Fri Nov  5 00:50:49 2010
From: Craig.Mundy at utas.edu.au (Craig Mundy)
Date: Thu, 4 Nov 2010 23:50:49 +0000
Subject: [R-sig-Geo] Is there a function for counting polygons within a
 multi-polygon SpatialPolygonDataFrame class
Message-ID: <5504936889E8F947B474AFF792016B5D0353CC@MBXSBYN3.utas.ad.internal>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/edce0ad3/attachment.pl>

From osoong+r at gmail.com  Fri Nov  5 01:00:42 2010
From: osoong+r at gmail.com (Oliver Soong)
Date: Thu, 4 Nov 2010 17:00:42 -0700
Subject: [R-sig-Geo] rgdal, multiband CCITT compression
In-Reply-To: <AANLkTi=SYUAuBQELQVesssJfrxXfqdLhdcwAt_L8kxNU@mail.gmail.com>
References: <AANLkTinVFAEBzfmjUZL84h7GMWpVjZtudfYrZ8dg264k@mail.gmail.com>
	<AANLkTi=SYUAuBQELQVesssJfrxXfqdLhdcwAt_L8kxNU@mail.gmail.com>
Message-ID: <AANLkTi=A33QZZMtn4vyC1ycH52MSd_rORKTU-LM5uR9+@mail.gmail.com>

Here's an example:




require(rgdal)
formals(paste)$sep <- ""

SP27GTIF <- readGDAL(
  system.file("pictures/SP27GTIF.TIF", package = "rgdal")[1],
  output.dim=c(100,100)
)
img_1bit_1band <- SP27GTIF
img_1bit_1band at data$band1 <- as.integer(SP27GTIF at data$band1 > 85)
img_1bit_2band <- SP27GTIF
img_1bit_2band at data <- data.frame(
  band1 = img_1bit_1band at data$band1,
  band2 = as.integer(SP27GTIF at data$band1 > 170)
)

for(img in c("img_1bit_1band", "img_1bit_2band")) {
  cat(paste("*** Correct Stats: ", img, "\n"))
  print(sapply(get(img)@data, table))
  for(compress in c("NONE", "DEFLATE", "LZW", "CCITTRLE",
                    "CCITTFAX3", "CCITTFAX4")) {
    file <- paste(img, "_", compress, ".tif")
    writeGDAL(get(img), file, type = "Byte",
      options = c("NBITS=1", paste("COMPRESS=", compress)))
    cat(paste("Compression: ", compress, " from ", file, "\n"))
    reread <- readGDAL(file, silent = TRUE)
    print(sapply(reread at data, table))
  }
  cat("\n")
}





The expected output is:

*** Correct Stats: img_1bit_1band
  band1
0  3086
1  6914
Compression: NONE from img_1bit_1band_NONE.tif
  band1
0  3086
1  6914
Compression: DEFLATE from img_1bit_1band_DEFLATE.tif
  band1
0  3086
1  6914
Compression: LZW from img_1bit_1band_LZW.tif
  band1
0  3086
1  6914
Compression: CCITTRLE from img_1bit_1band_CCITTRLE.tif
  band1
0  3086
1  6914
Compression: CCITTFAX3 from img_1bit_1band_CCITTFAX3.tif
  band1
0  3086
1  6914
Compression: CCITTFAX4 from img_1bit_1band_CCITTFAX4.tif
  band1
0  3086
1  6914

*** Correct Stats: img_1bit_2band
  band1 band2
0  3086  8353
1  6914  1647
Compression: NONE from img_1bit_2band_NONE.tif
  band1 band2
0  3086  8353
1  6914  1647
Compression: DEFLATE from img_1bit_2band_DEFLATE.tif
  band1 band2
0  3086  8353
1  6914  1647
Compression: LZW from img_1bit_2band_LZW.tif
  band1 band2
0  3086  8353
1  6914  1647
Compression: CCITTRLE from img_1bit_2band_CCITTRLE.tif
  band1 band2
0  6131  8783
1  3869  1217
Compression: CCITTFAX3 from img_1bit_2band_CCITTFAX3.tif
  band1 band2
0  6131  8783
1  3869  1217
Compression: CCITTFAX4 from img_1bit_2band_CCITTFAX4.tif
  band1 band2
0  6131  8783
1  3869  1217



Everything looks fine except CCITT compression with 2 bands.

I wasn't able to dig up Windows GDAL 1.7.1 binaries, and the 1.7.0
binaries from FW_Tools seem to give similar behavior, although it's a
little hard to check because neither ArcGIS nor ENVI seems to like any
of the multi-band files.


From mdsumner at gmail.com  Fri Nov  5 01:14:51 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 5 Nov 2010 11:14:51 +1100
Subject: [R-sig-Geo] rgdal, multiband CCITT compression
In-Reply-To: <AANLkTi=A33QZZMtn4vyC1ycH52MSd_rORKTU-LM5uR9+@mail.gmail.com>
References: <AANLkTinVFAEBzfmjUZL84h7GMWpVjZtudfYrZ8dg264k@mail.gmail.com>
	<AANLkTi=SYUAuBQELQVesssJfrxXfqdLhdcwAt_L8kxNU@mail.gmail.com>
	<AANLkTi=A33QZZMtn4vyC1ycH52MSd_rORKTU-LM5uR9+@mail.gmail.com>
Message-ID: <AANLkTin9vVU1T-_ucmPMxr2yOVpRWcxj5tfStXSHNT-j@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/79589d8f/attachment.pl>

From mdsumner at gmail.com  Fri Nov  5 01:15:27 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 5 Nov 2010 11:15:27 +1100
Subject: [R-sig-Geo] rgdal, multiband CCITT compression
In-Reply-To: <AANLkTin9vVU1T-_ucmPMxr2yOVpRWcxj5tfStXSHNT-j@mail.gmail.com>
References: <AANLkTinVFAEBzfmjUZL84h7GMWpVjZtudfYrZ8dg264k@mail.gmail.com>
	<AANLkTi=SYUAuBQELQVesssJfrxXfqdLhdcwAt_L8kxNU@mail.gmail.com>
	<AANLkTi=A33QZZMtn4vyC1ycH52MSd_rORKTU-LM5uR9+@mail.gmail.com>
	<AANLkTin9vVU1T-_ucmPMxr2yOVpRWcxj5tfStXSHNT-j@mail.gmail.com>
Message-ID: <AANLkTi=7G1dK-o-_yqOOc5KHyNjJRq-c5NgYFe9hMAWA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/ec98d6c2/attachment.pl>

From mdsumner at gmail.com  Fri Nov  5 01:33:43 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 5 Nov 2010 11:33:43 +1100
Subject: [R-sig-Geo] Is there a function for counting polygons within a
 multi-polygon SpatialPolygonDataFrame class
In-Reply-To: <5504936889E8F947B474AFF792016B5D0353CC@MBXSBYN3.utas.ad.internal>
References: <5504936889E8F947B474AFF792016B5D0353CC@MBXSBYN3.utas.ad.internal>
Message-ID: <AANLkTimgrHqFNSwqns3_Y_BFYR_LHyrX0hf5KYq-jjgF@mail.gmail.com>

This will give you the number of separate "rings", but that won't
allow you to differentiate between separate simple polygons, and rings
that represent "holes":

sapply(SrDf at polygons, function(x) length(slot(x, "Polygons")))

It needs more work to check each individual "Polygon" in "x" to see if
slot(x[[i]], "hole") is TRUE. I think this will do it:

sapply(SrDf at polygons, function(x) sum( !sapply(slot(x, "Polygons"),
slot, "hole")))

Note that use slot(x, "name") is more verbose that x at name, but either
is not recommended for normal use and should be bundled into methods,
or helper functions.

I think it's worth delving into the structure of these objects, as
it's fairly simple once you get used to it and writing summary
functions is not hard.

Cheers, Mike.

On Fri, Nov 5, 2010 at 10:50 AM, Craig Mundy <Craig.Mundy at utas.edu.au> wrote:
>
> Hi All,
>
> I have searched for (but not found), a function for counting polygons within each record of a multi-polygon SpatialPolygonDataFrame class? I had thought of sifting through the slot information, but thought I would check if there was a function I had overlooked before I embarked on that. I can easily do this in SQL Server but would prefer to batch process in R along with some other tasks.
>
> Thanks
>
> Craig
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



--
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From osoong+r at gmail.com  Fri Nov  5 01:40:27 2010
From: osoong+r at gmail.com (Oliver Soong)
Date: Thu, 4 Nov 2010 17:40:27 -0700
Subject: [R-sig-Geo] rgdal, multiband CCITT compression
In-Reply-To: <AANLkTin9vVU1T-_ucmPMxr2yOVpRWcxj5tfStXSHNT-j@mail.gmail.com>
References: <AANLkTinVFAEBzfmjUZL84h7GMWpVjZtudfYrZ8dg264k@mail.gmail.com>
	<AANLkTi=SYUAuBQELQVesssJfrxXfqdLhdcwAt_L8kxNU@mail.gmail.com>
	<AANLkTi=A33QZZMtn4vyC1ycH52MSd_rORKTU-LM5uR9+@mail.gmail.com>
	<AANLkTin9vVU1T-_ucmPMxr2yOVpRWcxj5tfStXSHNT-j@mail.gmail.com>
Message-ID: <AANLkTimcNKFC4exW1KjYyJq1DxR1aTka+VqUbTvquosk@mail.gmail.com>

Sorry, the word "expected" was a bad choice.  The output is what I
get.  I'm highlighting two tables that should be the same, but aren't.
 I appreciate you taking the time to poke around with me.

*** Correct Stats: img_1bit_2band
 band1 band2
0  3086  8353
1  6914  1647
Compression: CCITTRLE from img_1bit_2band_CCITTRLE.tif
 band1 band2
0  6131  8783
1  3869  1217




On Thu, Nov 4, 2010 at 5:14 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> Ok, thanks. I can try later today with Manifold System, which may be. I'm
> not sure of other non-GDAL tools to double check TIFFs with. (ArcGIS 10 uses
> GDAL but I don't know to what extent).
>
> Is the output above what you expect, or what you get? That's what I get.
> Sorry to be dim, but I don't see where you've specified what's actually
> wrong (and I haven't explored enough to see if that's easy to determine from
> the code).
>
> That's a?cunning use of formals() to?change defaults for a function?- a bit
> radical for my taste, but I like it.
>
> Cheers, Mike.
>
> On Fri, Nov 5, 2010 at 11:00 AM, Oliver Soong <osoong+r at gmail.com> wrote:
>>
>> Here's an example:
>>
>>
>>
>>
>> require(rgdal)
>> formals(paste)$sep <- ""
>>
>> SP27GTIF <- readGDAL(
>> ?system.file("pictures/SP27GTIF.TIF", package = "rgdal")[1],
>> ?output.dim=c(100,100)
>> )
>> img_1bit_1band <- SP27GTIF
>> img_1bit_1band at data$band1 <- as.integer(SP27GTIF at data$band1 > 85)
>> img_1bit_2band <- SP27GTIF
>> img_1bit_2band at data <- data.frame(
>> ?band1 = img_1bit_1band at data$band1,
>> ?band2 = as.integer(SP27GTIF at data$band1 > 170)
>> )
>>
>> for(img in c("img_1bit_1band", "img_1bit_2band")) {
>> ?cat(paste("*** Correct Stats: ", img, "\n"))
>> ?print(sapply(get(img)@data, table))
>> ?for(compress in c("NONE", "DEFLATE", "LZW", "CCITTRLE",
>> ? ? ? ? ? ? ? ? ? ?"CCITTFAX3", "CCITTFAX4")) {
>> ? ?file <- paste(img, "_", compress, ".tif")
>> ? ?writeGDAL(get(img), file, type = "Byte",
>> ? ? ?options = c("NBITS=1", paste("COMPRESS=", compress)))
>> ? ?cat(paste("Compression: ", compress, " from ", file, "\n"))
>> ? ?reread <- readGDAL(file, silent = TRUE)
>> ? ?print(sapply(reread at data, table))
>> ?}
>> ?cat("\n")
>> }
>>
>>
>>
>>
>>
>> The expected output is:
>>
>> *** Correct Stats: img_1bit_1band
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: NONE from img_1bit_1band_NONE.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: DEFLATE from img_1bit_1band_DEFLATE.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: LZW from img_1bit_1band_LZW.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: CCITTRLE from img_1bit_1band_CCITTRLE.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: CCITTFAX3 from img_1bit_1band_CCITTFAX3.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: CCITTFAX4 from img_1bit_1band_CCITTFAX4.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>>
>> *** Correct Stats: img_1bit_2band
>> ?band1 band2
>> 0 ?3086 ?8353
>> 1 ?6914 ?1647
>> Compression: NONE from img_1bit_2band_NONE.tif
>> ?band1 band2
>> 0 ?3086 ?8353
>> 1 ?6914 ?1647
>> Compression: DEFLATE from img_1bit_2band_DEFLATE.tif
>> ?band1 band2
>> 0 ?3086 ?8353
>> 1 ?6914 ?1647
>> Compression: LZW from img_1bit_2band_LZW.tif
>> ?band1 band2
>> 0 ?3086 ?8353
>> 1 ?6914 ?1647
>> Compression: CCITTRLE from img_1bit_2band_CCITTRLE.tif
>> ?band1 band2
>> 0 ?6131 ?8783
>> 1 ?3869 ?1217
>> Compression: CCITTFAX3 from img_1bit_2band_CCITTFAX3.tif
>> ?band1 band2
>> 0 ?6131 ?8783
>> 1 ?3869 ?1217
>> Compression: CCITTFAX4 from img_1bit_2band_CCITTFAX4.tif
>> ?band1 band2
>> 0 ?6131 ?8783
>> 1 ?3869 ?1217
>>
>>
>>
>> Everything looks fine except CCITT compression with 2 bands.
>>
>> I wasn't able to dig up Windows GDAL 1.7.1 binaries, and the 1.7.0
>> binaries from FW_Tools seem to give similar behavior, although it's a
>> little hard to check because neither ArcGIS nor ENVI seems to like any
>> of the multi-band files.
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>



-- 
Oliver Soong
Donald Bren School of Environmental Science & Management
University of California, Santa Barbara
Santa Barbara, CA 93106-5131
805-893-7044 (office)
610-291-9706 (cell)


From r.aluizio at gmail.com  Fri Nov  5 10:15:32 2010
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Fri, 5 Nov 2010 07:15:32 -0200
Subject: [R-sig-Geo] Defining Holes Inside a Polygon
Message-ID: <000001cb7cca$02076c30$06164490$@gmail.com>

Hi List.

I?m trying to solve an issue here, but it?s getting tricky.

I have an MapGen .dat file (attached) that contains about 39 closed lines.
Three of them (the largest ones) will be my main polygons and the rest of
them must become holes inside one of the three major areas. I?m able to
transform all the closed lines into SpatialPolygons and even create
shapefiles with them, but how can I modify the ?hole? slot of the smaller
polygons so I can keep them transparent when overlaying another map (those
holes will overlay islands of a raster image)?

 

Thank you for the attention and help.

Regards.

 

-------------------------------------------------------------------

MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio

Centro de Estudos do Mar/UFPR
Laborat?rio de Foramin?feros e Micropaleontologia Ambiental
Avenida Beira Mar s/n - CEP 83255-971
Pontal do Paran? - PR - Brazil



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/1d7fee34/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PCForams.dat
Type: application/octet-stream
Size: 133962 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/1d7fee34/attachment.obj>

From Roger.Bivand at nhh.no  Fri Nov  5 11:01:05 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Nov 2010 11:01:05 +0100 (CET)
Subject: [R-sig-Geo] Defining Holes Inside a Polygon
In-Reply-To: <000001cb7cca$02076c30$06164490$@gmail.com>
References: <000001cb7cca$02076c30$06164490$@gmail.com>
Message-ID: <alpine.LRH.2.00.1011051048370.27156@reclus.nhh.no>

On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:

> Hi List.
>
> I?m trying to solve an issue here, but it?s getting tricky.
>
> I have an MapGen .dat file (attached) that contains about 39 closed lines.
> Three of them (the largest ones) will be my main polygons and the rest of
> them must become holes inside one of the three major areas. I?m able to
> transform all the closed lines into SpatialPolygons and even create
> shapefiles with them, but how can I modify the ?hole? slot of the smaller
> polygons so I can keep them transparent when overlaying another map (those
> holes will overlay islands of a raster image)?
>

Next time avoid sending 200K to over 1700 people, please, we have a planet 
to protect! Put any desired attachments on a website and provide a link.

You should also have provided the code (in your message) to get from:

library(maptools)
l1 <- MapGen2SL("PCForams.dat")

to your problem - as those choices may be the cause of the problem; you 
have not provided the output of sessionInfo() either. Once things are 
lined up, you should - if you may - say:

gpclibPermit() # very restrictive license
pls_out <- lapply(slot(SpPols0, "polygons"), checkPolygonsHoles)
SpPols1 <- SpatialPolygons(pls_out)

Or if you can install rgeos from source on R-Forge, equivalently:

library(rgeos)
SpPols1 <- createSPComment(SpPols0)

Hope this helps,

Roger

>
>
> Thank you for the attention and help.
>
> Regards.
>
>
>
> -------------------------------------------------------------------
>
> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>
> Centro de Estudos do Mar/UFPR
> Laborat?rio de Foramin?feros e Micropaleontologia Ambiental
> Avenida Beira Mar s/n - CEP 83255-971
> Pontal do Paran? - PR - Brazil
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From r.aluizio at gmail.com  Fri Nov  5 12:48:07 2010
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Fri, 5 Nov 2010 09:48:07 -0200
Subject: [R-sig-Geo] RES:  Defining Holes Inside a Polygon
In-Reply-To: <alpine.LRH.2.00.1011051048370.27156@reclus.nhh.no>
References: <000001cb7cca$02076c30$06164490$@gmail.com>
	<alpine.LRH.2.00.1011051048370.27156@reclus.nhh.no>
Message-ID: <003a01cb7cdf$52538e70$f6faab50$@gmail.com>

Very sorry about the attached file, I'm not used to mailing lists, won't
happen again.
Well, I've already tried the checkPolygonsHoles function as specified in a
book of Yours, and even then nothing changes in the final Shapefiles, all
the polygons remain with FALSE "hole" slots.

Below are the code and sessionInfo(). 

# Required Packages
library(rgdal)
library(RODBC)
library(maptools)
gpclibPermit()

#Loading Data
Data<-odbcConnectExcel2007('Sub-Provincias-Forams-Dados.xlsx',readOnly=T)
PCdata<-sqlFetch(Data,'PC',rownames='ID')
odbcCloseAll()

# Loading Lines
PC<-MapGen2SL('PCForams.dat',proj4string=CRS('+proj=longlat +ellps=WGS84'))

# Verifing closed Lines
PCP<-sapply(slot(PC,'lines'),function (x) {
  crds<-slot(slot(x,'Lines')[[1]],'coords')
  identical(crds[1,],crds[nrow(crds),])
})

# Preparing the Poligons
PCP2<-PC[PCP==T]
lista_de_pols<-slot(PCP2,'lines')
PCSP<-SpatialPolygons(lapply(lista_de_pols, function(x) {
  Polygons(list(Polygon(slot(slot(x,'Lines')[[1]],
  'coords'))),ID=slot(x,'ID'))
}),proj4string=CRS('+proj=longlat +ellps=WGS84'))

# Defining the Holes
pls_out<-lapply(slot(PCSP,"polygons"),checkPolygonsHoles)
PCSPH<-SpatialPolygons(pls_out,proj4string=CRS('+proj=longlat
+ellps=WGS84'))
PCSPDF<-SpatialPolygonsDataFrame(PCSPH,PCdata)
writeOGR(PCSPDF,dsn='.',layer='PCForams',driver='ESRI Shapefile')

# Session Info
R version 2.12.0 (2010-10-15)
Platform: x86_64-pc-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=Portuguese_Brazil.1252 
[2] LC_CTYPE=Portuguese_Brazil.1252   
[3] LC_MONETARY=Portuguese_Brazil.1252
[4] LC_NUMERIC=C                      
[5] LC_TIME=Portuguese_Brazil.1252    

attached base packages:
[1] grDevices datasets  splines   graphics  stats    
[6] tcltk     utils     methods   base     

other attached packages:
 [1] gpclib_1.5-1    maptools_0.7-38 lattice_0.19-13
 [4] foreign_0.8-41  RODBC_1.3-2     rgdal_0.6-28   
 [7] sp_0.9-72       svSocket_0.9-50 TinnR_1.0.3    
[10] R2HTML_2.2      Hmisc_3.8-3     survival_2.35-8

loaded via a namespace (and not attached):
[1] cluster_1.13.1 grid_2.12.0    svMisc_0.9-60 
[4] tools_2.12.0

Thanks.
Rodrigo.

-----Mensagem original-----
De: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Enviada em: sexta-feira, 5 de novembro de 2010 08:01
Para: Rodrigo Aluizio
Cc: R Help
Assunto: Re: [R-sig-Geo] Defining Holes Inside a Polygon

On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:

> Hi List.
>
> I?m trying to solve an issue here, but it?s getting tricky.
>
> I have an MapGen .dat file (attached) that contains about 39 closed lines.
> Three of them (the largest ones) will be my main polygons and the rest 
> of them must become holes inside one of the three major areas. I?m 
> able to transform all the closed lines into SpatialPolygons and even 
> create shapefiles with them, but how can I modify the ?hole? slot of 
> the smaller polygons so I can keep them transparent when overlaying 
> another map (those holes will overlay islands of a raster image)?
>

Next time avoid sending 200K to over 1700 people, please, we have a planet
to protect! Put any desired attachments on a website and provide a link.

You should also have provided the code (in your message) to get from:

library(maptools)
l1 <- MapGen2SL("PCForams.dat")

to your problem - as those choices may be the cause of the problem; you have
not provided the output of sessionInfo() either. Once things are lined up,
you should - if you may - say:

gpclibPermit() # very restrictive license pls_out <- lapply(slot(SpPols0,
"polygons"), checkPolygonsHoles)
SpPols1 <- SpatialPolygons(pls_out)

Or if you can install rgeos from source on R-Forge, equivalently:

library(rgeos)
SpPols1 <- createSPComment(SpPols0)

Hope this helps,

Roger

>
>
> Thank you for the attention and help.
>
> Regards.
>
>
>
> -------------------------------------------------------------------
>
> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>
> Centro de Estudos do Mar/UFPR
> Laborat?rio de Foramin?feros e Micropaleontologia Ambiental Avenida 
> Beira Mar s/n - CEP 83255-971 Pontal do Paran? - PR - Brazil
>
>
>
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alexandresantosbr at yahoo.com.br  Fri Nov  5 12:58:56 2010
From: alexandresantosbr at yahoo.com.br (Alexandre dos Santos)
Date: Fri, 5 Nov 2010 09:58:56 -0200
Subject: [R-sig-Geo] 8. Convert from spatialpointsdataframe to spatialpoints
In-Reply-To: <mailman.15.1288954804.1668.r-sig-geo@stat.math.ethz.ch>
References: <mailman.15.1288954804.1668.r-sig-geo@stat.math.ethz.ch>
Message-ID: <000901cb7ce0$d4dbe350$7e93a9f0$@com.br>

Dr.Manuel Spimnola,

     For create SpatialPoints in shapfile format with
SpatialPointsDataFrame, I use de arguments below, 

require(sp)
     pontos<-data.frame(p_internos)
     head(pontos)
     class(pontos)
     dim(pontos)
     coordinates(pontos) <- c("N_S","L_O") 
     class(pontos)
     dim(pontos)
     getSlots("SpatialPointsDataFrame")
     slot(pontos, "bbox")
require(maptools)
writePointsShape(pontos,"AMOSTRAGEM", factor2char = TRUE, max_nchar=254) 
readShapePoints("AMOSTRAGEM", proj4string = CRS(as.character(NA)),verbose =
FALSE,repair=FALSE)


I will expected help you, 
Best regards,

Alexandre dos Santos
Engenheiro Florestal, Msc.
Doutorando em Entomologia
Manejo Integrado de Pragas Florestais
Universidade Federal de Lavras
Departamento de Entomologia
Caixa Postal 3037
37200-000 - Lavras - MG - Brasil
Telefones: +55(35)3829-5122/+55(35)9182-0709







-----Mensagem original-----
De: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] Em nome de
r-sig-geo-request at stat.math.ethz.ch
Enviada em: sexta-feira, 5 de novembro de 2010 09:00
Para: r-sig-geo at stat.math.ethz.ch
Assunto: R-sig-Geo Digest, Vol 87, Issue 5

Send R-sig-Geo mailing list submissions to
	r-sig-geo at stat.math.ethz.ch

To subscribe or unsubscribe via the World Wide Web, visit
	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
or, via email, send a message with subject or body 'help' to
	r-sig-geo-request at stat.math.ethz.ch

You can reach the person managing the list at
	r-sig-geo-owner at stat.math.ethz.ch

When replying, please edit your Subject line so it is more specific
than "Re: Contents of R-sig-Geo digest..."


Today's Topics:

   1. how to dismiss points outside of my area of interest in	a
      raster (Manuel Sp?nola)
   2. [R-sig-geo]: Plot spatial data with spplot and maps (pelt)
   3. Re: [R-sig-geo]: Plot spatial data with spplot and maps
      (Karl Ove Hufthammer)
   4. raster package and predict for GBM models (Michael ODonnell)
   5. Re: how to dismiss points outside of my area of interest in a
      raster (Robert J. Hijmans)
   6. Re: raster package and predict for GBM models (Robert J. Hijmans)
   7. Re: how to dismiss points outside of my area of interest in a
      raster (Manuel Sp?nola)
   8. Convert from spatialpointsdataframe to spatialpoints
      (Manuel Sp?nola)
   9. Re: Convert from spatialpointsdataframe to spatialpoints
      (Robert J. Hijmans)
  10. Re: Convert from spatialpointsdataframe to spatialpoints
      (Manuel Sp?nola)
  11. Re: Convert from spatialpointsdataframe to spatialpoints
      (Robert J. Hijmans)
  12. plotting time series for particular months! (govindas at msu.edu)
  13. Re: raster package and predict for GBM models (Michael ODonnell)
  14. Re: plotting time series for particular months! (steven mosher)
  15. Re: Convert from spatialpointsdataframe to spatialpoints
      (Manuel Sp?nola)
  16. Re: plotting time series for particular months! (govindas at msu.edu)
  17. Re: plotting time series for particular months! (steven mosher)
  18. rgdal, multiband CCITT compression (Oliver Soong)
  19. Re: rgdal, multiband CCITT compression (Michael Sumner)
  20. Is there a function for counting polygons within a
      multi-polygon SpatialPolygonDataFrame class (Craig Mundy)
  21. Re: rgdal, multiband CCITT compression (Oliver Soong)
  22. Re: rgdal, multiband CCITT compression (Michael Sumner)
  23. Re: rgdal, multiband CCITT compression (Michael Sumner)
  24. Re: Is there a function for counting polygons within a
      multi-polygon SpatialPolygonDataFrame class (Michael Sumner)
  25. Re: rgdal, multiband CCITT compression (Oliver Soong)
  26. Defining Holes Inside a Polygon (Rodrigo Aluizio)
  27. Re: Defining Holes Inside a Polygon (Roger Bivand)


----------------------------------------------------------------------

Message: 1
Date: Thu, 04 Nov 2010 06:43:58 -0600
From: Manuel Sp?nola <mspinola10 at gmail.com>
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] how to dismiss points outside of my area of
	interest in	a raster
Message-ID: <4CD2AA8E.7090804 at gmail.com>
Content-Type: text/plain

Dear list members,

How can eliminate or dismiss points that do not "touch" my raster file?  
This mean those points that are outside of the raster area.
When I have my plot of the rester and I draw the points:

points (villages)

some of them are outside of the raster not because an error but just 
because the point file is bigger in extent than the raster.

Thank you very much in advance.
Best,

Manuel


-- 
*Manuel Spmnola, Ph.D.*
Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Telifono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de rmo 
<https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]



------------------------------

Message: 2
Date: Thu, 04 Nov 2010 13:24:46 +0000
From: pelt <pelt at knmi.nl>
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] [R-sig-geo]: Plot spatial data with spplot and
	maps
Message-ID: <4CD2B41E.9050807 at knmi.nl>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

Hi all,

I have made a plot with ssplot, using a SpatialPointsDataFrame. The
content is quite simple, as I have 9 grid points with lon/lat
coordinates and 9 values attached to these coordinates. They are in a
square area of 3 by 3 gridboxes.
I would like to lay a map from maps() over these values, but when I try
this, the grids of the maps  do not overlap with the grids I have
already created with spplot(). I would like shaded gridboxes, the boxes
should be filled with colour. Can anyone help me with this problem?
[[elided Yahoo spam]]
This is part of my code:

lonlim <-c(4.5,12)
latlim <-c(46.5,52.5)

map(xlim=lonlim, ylim=latlim,col='white')

gt=GridTopology(cellcentre.offset=c(5.75,47.5),cellsize=c(2.5,2),cells.dim=c
(3,3)) 

grd=SpatialGrid(gt,proj4string = CRS(as.character(NA)))
gridparameters(grd)
gd<-as.data.frame(grd,"SpatialGrid")
h<-season_djf  # which are 9 values
h<-as.data.frame(h)
djf.att=SpatialPointsDataFrame(gd,h)
gridded(djf.att)=TRUE

spplot(djf.att, col.regions = colorRampPalette(c("red","orange",
"yellow", "lightblue", "blue",
"purple")), xlab="Longitude(?)",
ylab="Latitude(?)",add=T,scales=list(draw=T),main="Seasonal change",
font.main=4)

map('rivers',add=T)
map('worldHires',add=T)

Regards,
Saskia van Pelt



------------------------------

Message: 3
Date: Thu, 04 Nov 2010 15:32:25 +0100
From: Karl Ove Hufthammer <karl at huftis.org>
To: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] [R-sig-geo]: Plot spatial data with spplot
	and maps
Message-ID: <iaug5p$fpe$1 at dough.gmane.org>
Content-Type: text/plain; charset="UTF-8"

pelt wrote:

> I have made a plot with ssplot, using a SpatialPointsDataFrame. The
> content is quite simple, as I have 9 grid points with lon/lat
> coordinates and 9 values attached to these coordinates. They are in a
> square area of 3 by 3 gridboxes.
> I would like to lay a map from maps() over these values, but when I try
> this, the grids of the maps  do not overlap with the grids I have
> already created with spplot().

You?re trying to mix ?base? graphics and ?grid? graphics, which doesn?t
work.
?spplot? use ?lattice? graphics (based on ?grid?), so you?ll have to modify
its ?panel? function. Here?s a very simple example.

BTW, I recommend reading the ?lattice? book to understand how to use ?panel?

functions: http://lmdvr.r-forge.r-project.org/figures/figures.html

library(sp)
library(lattice)
library(maps)
library(maptools)
n=100

d=data.frame(x=rnorm(n,0,20),y=rnorm(n,0,20),z=1:n)
xl=range(d$x)
yl=range(d$y)
coordinates(d)=~x+y
spplot(d, panel=function(...) {
  panel.fill("lightblue3")
  wmap=map("world", fill=TRUE, plot=FALSE,
           xlim=xl, ylim=yl, resolution=0)
  wmap[c("x", "y")]=mapthin(wmap[c("x", "y")],1)
  wmap.sp=map2SpatialPolygons(wmap, wmap$names)
  sp.polygons(wmap.sp,fill="khaki", col=NA,lwd=2)
  panel.pointsplot(...)
}, xlim=xl, ylim=yl )

The reason for the slow drawing is that each polygon is plotted separately,
and the map polygon also contains areas outside ?xl? and ?yl?. (This is easy
enough to fix by merging and clipping the polygons.)

-- 
Karl Ove Hufthammer



------------------------------

Message: 4
Date: Thu, 4 Nov 2010 07:34:28 -0700 (PDT)
From: Michael ODonnell <odonnems at yahoo.com>
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] raster package and predict for GBM models
Message-ID: <519902.86587.qm at web58007.mail.re3.yahoo.com>
Content-Type: text/plain; charset=us-ascii

Hello, 

I have little experience using the raster package and I am currently trying
to develop a predicted surface based on a gradient boosted model (gbm
package).

The basic steps I am using include the following:

# Creating a raster stack of independent variables
USHGT <- raster("ushgt.asc", package="raster")
... (other variables omitted for post)
ras_stk <- stack(USHGT, HYELB, T1TO5LE, URBD_D, SG_UNIT, MINTEMP, ANNPCP,
TC_B04, TC_B07)

# Create the prediction model
... I am using a separate script that creates the gbm object and due to the
length I will not include. The outcome is a gbm object.

.. Now I use the following, which fails:
r <- predict(ras_stk, myData, filename=OutFile, na.rm=TRUE, overwrite=TRUE,
n.trees=myData$n.trees, type="response", progress="window")

Error:
Error in model.frame.default(terms(reformulate(object$var.names)), newdata,
:object is not a matrix

The raster package manual states that the predict function will work on any
model that a predict method has been implemented.

Does anyone have experience with this or possibly an idea on how I might
solve the issue.

Thank you,
mike



------------------------------

Message: 5
Date: Thu, 4 Nov 2010 09:46:15 -0700
From: "Robert J. Hijmans" <r.hijmans at gmail.com>
To: Manuel Sp?nola <mspinola10 at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] how to dismiss points outside of my area of
	interest in a raster
Message-ID:
	<AANLkTi=7LEC_wLjJSdrQLpkhaC7yRCnEO+sCr2bO9nxF at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Manuel,

library(raster)
# Assuming you have matrix of points (or SpatialPoints*)
pt <- (cbind(runif(100), runif(100)) -0.5) * 500
spt <- SpatialPoints(pt)
# and a RasterLayer
r <- raster()

# you can do

e <- polygonFromExtent(r)
o <- overlay(e, spt)
o <- which(!is.na(o))
pts <- pt[o,]


# show that it worked
plot(pt)
r[] = 1
plot(r, add=TRUE, legend=FALSE)
points(pt, col='blue')
points(pts, col='red', pch=20)


Robert

On Thu, Nov 4, 2010 at 5:43 AM, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
> Dear list members,
>
> How can eliminate or dismiss points that do not "touch" my raster file?
> This mean those points that are outside of the raster area.
> When I have my plot of the rester and I draw the points:
>
> points (villages)
>
> some of them are outside of the raster not because an error but just
> because the point file is bigger in extent than the raster.
>
> Thank you very much in advance.
> Best,
>
> Manuel
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



------------------------------

Message: 6
Date: Thu, 4 Nov 2010 09:58:37 -0700
From: "Robert J. Hijmans" <r.hijmans at gmail.com>
To: Michael ODonnell <odonnems at yahoo.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] raster package and predict for GBM models
Message-ID:
	<AANLkTi=7TBsyUVWcOLiGqEi_tTRwDNSDcjaRVXODKV-t at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Hi Mike,

I cannot know from what you send, but the second argument should be
your gbm object, and from your name "myData" I am guessing it is not
(unless it really is referring to youModel).
One of the two vignettes of the 'dismo' package is about 'gbm'
(boosted regression trees) and 'raster' . So in principle it should
work.

Robert


On Thu, Nov 4, 2010 at 7:34 AM, Michael ODonnell <odonnems at yahoo.com> wrote:
> Hello,
>
> I have little experience using the raster package and I am currently
trying to develop a predicted surface based on a gradient boosted model (gbm
package).
>
> The basic steps I am using include the following:
>
> # Creating a raster stack of independent variables
> USHGT <- raster("ushgt.asc", package="raster")
> ... (other variables omitted for post)
> ras_stk <- stack(USHGT, HYELB, T1TO5LE, URBD_D, SG_UNIT, MINTEMP, ANNPCP,
TC_B04, TC_B07)
>
> # Create the prediction model
> ... I am using a separate script that creates the gbm object and due to
the length I will not include. The outcome is a gbm object.
>
> .. Now I use the following, which fails:
> r <- predict(ras_stk, myData, filename=OutFile, na.rm=TRUE,
overwrite=TRUE, n.trees=myData$n.trees, type="response", progress="window")
>
> Error:
> Error in model.frame.default(terms(reformulate(object$var.names)),
newdata, ?:object is not a matrix
>
> The raster package manual states that the predict function will work on
any model that a predict method has been implemented.
>
> Does anyone have experience with this or possibly an idea on how I might
solve the issue.
>
> Thank you,
> mike
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



------------------------------

Message: 7
Date: Thu, 04 Nov 2010 11:21:30 -0600
From: Manuel Sp?nola <mspinola10 at gmail.com>
To: "Robert J. Hijmans" <r.hijmans at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] how to dismiss points outside of my area of
	interest in a raster
Message-ID: <4CD2EB9A.5040602 at gmail.com>
Content-Type: text/plain

Thank you very much Robert.

Best,

Manuel

On 04/11/2010 10:46 a.m., Robert J. Hijmans wrote:
> Manuel,
>
> library(raster)
> # Assuming you have matrix of points (or SpatialPoints*)
> pt<- (cbind(runif(100), runif(100)) -0.5) * 500
> spt<- SpatialPoints(pt)
> # and a RasterLayer
> r<- raster()
>
> # you can do
>
> e<- polygonFromExtent(r)
> o<- overlay(e, spt)
> o<- which(!is.na(o))
> pts<- pt[o,]
>
>
> # show that it worked
> plot(pt)
> r[] = 1
> plot(r, add=TRUE, legend=FALSE)
> points(pt, col='blue')
> points(pts, col='red', pch=20)
>
>
> Robert
>
> On Thu, Nov 4, 2010 at 5:43 AM, Manuel Spmnola<mspinola10 at gmail.com>
wrote:
>> Dear list members,
>>
>> How can eliminate or dismiss points that do not "touch" my raster file?
>> This mean those points that are outside of the raster area.
>> When I have my plot of the rester and I draw the points:
>>
>> points (villages)
>>
>> some of them are outside of the raster not because an error but just
>> because the point file is bigger in extent than the raster.
>>
>> Thank you very much in advance.
>> Best,
>>
>> Manuel
>>
>>
>> --
>> *Manuel Spmnola, Ph.D.*
>> Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.ac.cr
>> mspinola10 at gmail.com
>> Telifono: (506) 2277-3598
>> Fax: (506) 2237-7036
>> Personal website: Lobito de rmo
>> <https://sites.google.com/site/lobitoderio/>
>> Institutional website: ICOMVIS<http://www.icomvis.una.ac.cr/>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>


-- 
*Manuel Spmnola, Ph.D.*
Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Telifono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de rmo 
<https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]



------------------------------

Message: 8
Date: Thu, 04 Nov 2010 11:25:51 -0600
From: Manuel Sp?nola <mspinola10 at gmail.com>
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] Convert from spatialpointsdataframe to
	spatialpoints
Message-ID: <4CD2EC9F.2050000 at gmail.com>
Content-Type: text/plain

Dear list members,


I am trying to create a raster from points, but I read the points from a 
shapfile, so I have the points object as a SpatialPointsDataFrame.
To use the function pointsToRaster I need the points as SpatialPoints.

How to convert a SpatialPointsDataFrame object to a SpatialPoints?
Best,

Manuel


-- 
*Manuel Spmnola, Ph.D.*
Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Telifono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de rmo 
<https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]



------------------------------

Message: 9
Date: Thu, 4 Nov 2010 10:41:15 -0700
From: "Robert J. Hijmans" <r.hijmans at gmail.com>
To: Manuel Sp?nola <mspinola10 at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Convert from spatialpointsdataframe to
	spatialpoints
Message-ID:
	<AANLkTikub6cdL3R5WGssPikcOUah0+MedPwqERXPDvme at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Manuel.

Did you try it without converting? The help file in raster says it
needs a SpatialPoints* object. The '*' is a wild card that in this
case stands for 'DataFrame'.

The answer to your question:

as(x, 'SpatialPoints')

You could find the answer to many of this type of questions by reading
the vignettes of sp and raster, and by searching the R-sig-geo help
archives, and looking at the R spatial wiki.

Robert

On Thu, Nov 4, 2010 at 10:25 AM, Manuel Sp?nola <mspinola10 at gmail.com>
wrote:
> Dear list members,
>
>
> I am trying to create a raster from points, but I read the points from a
> shapfile, so I have the points object as a SpatialPointsDataFrame.
> To use the function pointsToRaster I need the points as SpatialPoints.
>
> How to convert a SpatialPointsDataFrame object to a SpatialPoints?
> Best,
>
> Manuel
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



------------------------------

Message: 10
Date: Thu, 04 Nov 2010 12:02:30 -0600
From: Manuel Sp?nola <mspinola10 at gmail.com>
To: "Robert J. Hijmans" <r.hijmans at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Convert from spatialpointsdataframe to
	spatialpoints
Message-ID: <4CD2F536.9050102 at gmail.com>
Content-Type: text/plain

Thank you very much Robert.

I am reading the raster vignette right now.

I got this error:

 > r = raster(corredor)
 > res(r) = 50
 > r = pointsToRaster(poblados, r)
Error en .pointsToMatrix(xy) :
   points should be vectors of length 2, matrices with 2 columns, or a 
SpatialPoints* object
 > poblados at data
           x       y
1  500577.8 1155145
2  495470.2 1164700
3  489082.0 1152228
4  494559.3 1171489
5  492094.0 1157327
6  490937.9 1155423
7  488748.0 1153979
8  491910.8 1154378
9  485430.7 1148051
10 500060.9 1148109
11 491212.5 1159109
12 487253.9 1151491
13 480244.6 1181636
14 480651.1 1184371
15 477555.2 1181189
16 486482.8 1167946
17 483764.4 1164624
18 477301.6 1192979
19 483737.4 1192048
20 480760.2 1192652
21 476126.6 1165617
22 481182.4 1185941


Best,

Manuel

On 04/11/2010 11:41 a.m., Robert J. Hijmans wrote:
> Manuel.
>
> Did you try it without converting? The help file in raster says it
> needs a SpatialPoints* object. The '*' is a wild card that in this
> case stands for 'DataFrame'.
>
> The answer to your question:
>
> as(x, 'SpatialPoints')
>
> You could find the answer to many of this type of questions by reading
> the vignettes of sp and raster, and by searching the R-sig-geo help
> archives, and looking at the R spatial wiki.
>
> Robert
>
> On Thu, Nov 4, 2010 at 10:25 AM, Manuel Spmnola<mspinola10 at gmail.com>
wrote:
>> Dear list members,
>>
>>
>> I am trying to create a raster from points, but I read the points from a
>> shapfile, so I have the points object as a SpatialPointsDataFrame.
>> To use the function pointsToRaster I need the points as SpatialPoints.
>>
>> How to convert a SpatialPointsDataFrame object to a SpatialPoints?
>> Best,
>>
>> Manuel
>>
>>
>> --
>> *Manuel Spmnola, Ph.D.*
>> Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.ac.cr
>> mspinola10 at gmail.com
>> Telifono: (506) 2277-3598
>> Fax: (506) 2237-7036
>> Personal website: Lobito de rmo
>> <https://sites.google.com/site/lobitoderio/>
>> Institutional website: ICOMVIS<http://www.icomvis.una.ac.cr/>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>


-- 
*Manuel Spmnola, Ph.D.*
Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Telifono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de rmo 
<https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]



------------------------------

Message: 11
Date: Thu, 4 Nov 2010 12:16:47 -0700
From: "Robert J. Hijmans" <r.hijmans at gmail.com>
To: Manuel Sp?nola <mspinola10 at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Convert from spatialpointsdataframe to
	spatialpoints
Message-ID:
	<AANLkTimW+bPp3v05DfCK1+WbbmbR64c8517YjJXxJizm at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Manuel,

I think this is wrong:
>> r = pointsToRaster(poblados, r)

Try:
r <- pointsToRaster(r, poblados)


Robert

On Thu, Nov 4, 2010 at 11:02 AM, Manuel Sp?nola <mspinola10 at gmail.com>
wrote:
> Thank you very much Robert.
>
> I am reading the raster vignette right now.
>
> I got this error:
>
>> r = raster(corredor)
>> res(r) = 50
>> r = pointsToRaster(poblados, r)
> Error en .pointsToMatrix(xy) :
> ? points should be vectors of length 2, matrices with 2 columns, or a
> SpatialPoints* object
>> poblados at data
> ????????? x?????? y
> 1? 500577.8 1155145
> 2? 495470.2 1164700
> 3? 489082.0 1152228
> 4? 494559.3 1171489
> 5? 492094.0 1157327
> 6? 490937.9 1155423
> 7? 488748.0 1153979
> 8? 491910.8 1154378
> 9? 485430.7 1148051
> 10 500060.9 1148109
> 11 491212.5 1159109
> 12 487253.9 1151491
> 13 480244.6 1181636
> 14 480651.1 1184371
> 15 477555.2 1181189
> 16 486482.8 1167946
> 17 483764.4 1164624
> 18 477301.6 1192979
> 19 483737.4 1192048
> 20 480760.2 1192652
> 21 476126.6 1165617
> 22 481182.4 1185941
>
>
> Best,
>
> Manuel
>
> On 04/11/2010 11:41 a.m., Robert J. Hijmans wrote:
>
> Manuel.
>
> Did you try it without converting? The help file in raster says it
> needs a SpatialPoints* object. The '*' is a wild card that in this
> case stands for 'DataFrame'.
>
> The answer to your question:
>
> as(x, 'SpatialPoints')
>
> You could find the answer to many of this type of questions by reading
> the vignettes of sp and raster, and by searching the R-sig-geo help
> archives, and looking at the R spatial wiki.
>
> Robert
>
> On Thu, Nov 4, 2010 at 10:25 AM, Manuel Sp?nola <mspinola10 at gmail.com>
> wrote:
>
> Dear list members,
>
>
> I am trying to create a raster from points, but I read the points from a
> shapfile, so I have the points object as a SpatialPointsDataFrame.
> To use the function pointsToRaster I need the points as SpatialPoints.
>
> How to convert a SpatialPointsDataFrame object to a SpatialPoints?
> Best,
>
> Manuel
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
> Manuel Sp?nola, Ph.D.
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> Institutional website: ICOMVIS



------------------------------

Message: 12
Date: Thu, 04 Nov 2010 15:18:53 -0400
From: govindas at msu.edu
To: r-sig-geo at stat.math.ethz.ch
[[elided Yahoo spam]]
Message-ID: <20101104151853.93076j1dwbv9pwrh at mail.msu.edu>
Content-Type: text/plain



Hi all, 

I have a matrix as given below...

year month day prec
1   1980    10   1 13.4
2   1980    10   2  0.0
3   1980    10   3  0.0
4   1980    10   4  0.0
5   1980    10   5  0.0
6   1980    10   6  0.0
7   1980    10   7  0.0
8   1980    10   8  0.0
9   1980    10   9  0.0
10  1980    10  10  0.0
11  1980    10  11  7.4
12  1980    10  12  5.4
13  1980    10  13  7.2
14  1980    10  14  0.0
15  1980    10  15  0.0
16  1980    10  16  0.0
17  1980    10  17 41.2
18  1980    10  18  0.0
19  1980    10  19  0.0
20  1980    10  20  0.0
21  1980    10  21  0.0
22  1980    10  22  0.0
23  1980    10  23  0.0
24  1980    10  24  0.0
25  1980    10  25  0.0
26  1980    10  26  0.0
27  1980    10  27  2.0
28  1980    10  28  0.0
29  1980    10  29  0.0
30  1980    10  30  0.0
31  1980    10  31  0.0
32  1980    11   1  0.0
33  1980    11   2  0.0
34  1980    11   3  0.0
35  1980    11   4  0.0
36  1980    11   5 12.4

the precipitation values extend from 1980 to 2005, but only for october,
november and december. I would  like to plot just these 3 months for the
given time period (1980 -  2005). Is there a way to get these values in the
x-axis. i.e. i need a  plot with its axis reading "1980, 1981, 1982 .. 2005"
(even if the  months are specified then it should be of more use). for now,
i get an  axis like .. "0, 500, ... 2000" (the plot is giving the index
values).

[[elided Yahoo spam]]
ts.chn <- ts(chn.arr[1:2386,4], start=c(1980, 10), end=c(2005, 12),
freq=365)
plot(ts.chn)

-- 
Regards,
Mahalakshmi
Graduate Student
#20, Department of Geography
Michigan State University
East Lansing, MI 48824
	[[alternative HTML version deleted]]



------------------------------

Message: 13
Date: Thu, 4 Nov 2010 12:26:45 -0700 (PDT)
From: Michael ODonnell <odonnems at yahoo.com>
To: "Robert J. Hijmans" <r.hijmans at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] raster package and predict for GBM models
Message-ID: <468619.42773.qm at web58003.mail.re3.yahoo.com>
Content-Type: text/plain; charset=iso-8859-1

Robert, sorry. Yes, myData is my gbm object. 

Also, I figured out what I had done wrong. The raster stack I created
specified a data set name that was lowercase and the the gbm model was
specifying upper case for the same raster layer. Once I use the correct
name, it worked.

Thank you for the response.
Mike


--- On Thu, 11/4/10, Robert J. Hijmans <r.hijmans at gmail.com> wrote:

> From: Robert J. Hijmans <r.hijmans at gmail.com>
> Subject: Re: [R-sig-Geo] raster package and predict for GBM models
> To: "Michael ODonnell" <odonnems at yahoo.com>
> Cc: r-sig-geo at stat.math.ethz.ch
> Date: Thursday, November 4, 2010, 10:58 AM
> Hi Mike,
> 
> I cannot know from what you send, but the second argument
> should be
> your gbm object, and from your name "myData" I am guessing
> it is not
> (unless it really is referring to youModel).
> One of the two vignettes of the 'dismo' package is about
> 'gbm'
> (boosted regression trees) and 'raster' . So in principle
> it should
> work.
> 
> Robert
> 
> 
> On Thu, Nov 4, 2010 at 7:34 AM, Michael ODonnell <odonnems at yahoo.com>
> wrote:
> > Hello,
> >
> > I have little experience using the raster package and
> I am currently trying to develop a predicted surface based
> on a gradient boosted model (gbm package).
> >
> > The basic steps I am using include the following:
> >
> > # Creating a raster stack of independent variables
> > USHGT <- raster("ushgt.asc", package="raster")
> > ... (other variables omitted for post)
> > ras_stk <- stack(USHGT, HYELB, T1TO5LE, URBD_D,
> SG_UNIT, MINTEMP, ANNPCP, TC_B04, TC_B07)
> >
> > # Create the prediction model
> > ... I am using a separate script that creates the gbm
> object and due to the length I will not include. The outcome
> is a gbm object.
> >
> > .. Now I use the following, which fails:
> > r <- predict(ras_stk, myData, filename=OutFile,
> na.rm=TRUE, overwrite=TRUE, n.trees=myData$n.trees,
> type="response", progress="window")
> >
> > Error:
> > Error in
> model.frame.default(terms(reformulate(object$var.names)),
> newdata, ?:object is not a matrix
> >
> > The raster package manual states that the predict
> function will work on any model that a predict method has
> been implemented.
> >
> > Does anyone have experience with this or possibly an
> idea on how I might solve the issue.
> >
> > Thank you,
> > mike
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 






------------------------------

Message: 14
Date: Thu, 4 Nov 2010 12:33:04 -0700
From: steven mosher <moshersteven at gmail.com>
To: govindas at msu.edu
Cc: r-sig-geo at stat.math.ethz.ch
[[elided Yahoo spam]]
Message-ID:
	<AANLkTinWf+hi+y_8bpZ8znk5-WNWyTY6Y3JSAQOvD01u at mail.gmail.com>
Content-Type: text/plain

I would look at using  the package 'zoo' your time series data would be a
zoo object
and then your date data  would be coerced as well,

zoo, is very slick.

On Thu, Nov 4, 2010 at 12:18 PM, <govindas at msu.edu> wrote:

>
>
> Hi all,
>
> I have a matrix as given below...
>
> year month day prec
> 1   1980    10   1 13.4
> 2   1980    10   2  0.0
> 3   1980    10   3  0.0
> 4   1980    10   4  0.0
> 5   1980    10   5  0.0
> 6   1980    10   6  0.0
> 7   1980    10   7  0.0
> 8   1980    10   8  0.0
> 9   1980    10   9  0.0
> 10  1980    10  10  0.0
> 11  1980    10  11  7.4
> 12  1980    10  12  5.4
> 13  1980    10  13  7.2
> 14  1980    10  14  0.0
> 15  1980    10  15  0.0
> 16  1980    10  16  0.0
> 17  1980    10  17 41.2
> 18  1980    10  18  0.0
> 19  1980    10  19  0.0
> 20  1980    10  20  0.0
> 21  1980    10  21  0.0
> 22  1980    10  22  0.0
> 23  1980    10  23  0.0
> 24  1980    10  24  0.0
> 25  1980    10  25  0.0
> 26  1980    10  26  0.0
> 27  1980    10  27  2.0
> 28  1980    10  28  0.0
> 29  1980    10  29  0.0
> 30  1980    10  30  0.0
> 31  1980    10  31  0.0
> 32  1980    11   1  0.0
> 33  1980    11   2  0.0
> 34  1980    11   3  0.0
> 35  1980    11   4  0.0
> 36  1980    11   5 12.4
>
> the precipitation values extend from 1980 to 2005, but only for october,
> november and december. I would  like to plot just these 3 months for the
> given time period (1980 -  2005). Is there a way to get these values in
the
> x-axis. i.e. i need a  plot with its axis reading "1980, 1981, 1982 ..
2005"
> (even if the  months are specified then it should be of more use). for
now,
> i get an  axis like .. "0, 500, ... 2000" (the plot is giving the index
> values).
>
[[elided Yahoo spam]]
> ts.chn <- ts(chn.arr[1:2386,4], start=c(1980, 10), end=c(2005, 12),
> freq=365)
> plot(ts.chn)
>
> --
> Regards,
> Mahalakshmi
> Graduate Student
> #20, Department of Geography
> Michigan State University
> East Lansing, MI 48824
>        [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

	[[alternative HTML version deleted]]



------------------------------

Message: 15
Date: Thu, 04 Nov 2010 14:07:27 -0600
From: Manuel Sp?nola <mspinola10 at gmail.com>
To: "Robert J. Hijmans" <r.hijmans at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Convert from spatialpointsdataframe to
	spatialpoints
Message-ID: <4CD3127F.9040309 at gmail.com>
Content-Type: text/plain

Thank you very much Robert,

It works but it looks empty.
I don't have values, is only xy values (the locations for villages).

I did:

r = pointsToRaster(r, poblados, values=1)

but still looks empty.

Best,

Manuel



On 04/11/2010 01:16 p.m., Robert J. Hijmans wrote:
> Manuel,
>
> I think this is wrong:
>>> r = pointsToRaster(poblados, r)
> Try:
> r<- pointsToRaster(r, poblados)
>
>
> Robert
>
> On Thu, Nov 4, 2010 at 11:02 AM, Manuel Spmnola<mspinola10 at gmail.com>
wrote:
>> Thank you very much Robert.
>>
>> I am reading the raster vignette right now.
>>
>> I got this error:
>>
>>> r = raster(corredor)
>>> res(r) = 50
>>> r = pointsToRaster(poblados, r)
>> Error en .pointsToMatrix(xy) :
>>    points should be vectors of length 2, matrices with 2 columns, or a
>> SpatialPoints* object
>>> poblados at data
>>            x       y
>> 1  500577.8 1155145
>> 2  495470.2 1164700
>> 3  489082.0 1152228
>> 4  494559.3 1171489
>> 5  492094.0 1157327
>> 6  490937.9 1155423
>> 7  488748.0 1153979
>> 8  491910.8 1154378
>> 9  485430.7 1148051
>> 10 500060.9 1148109
>> 11 491212.5 1159109
>> 12 487253.9 1151491
>> 13 480244.6 1181636
>> 14 480651.1 1184371
>> 15 477555.2 1181189
>> 16 486482.8 1167946
>> 17 483764.4 1164624
>> 18 477301.6 1192979
>> 19 483737.4 1192048
>> 20 480760.2 1192652
>> 21 476126.6 1165617
>> 22 481182.4 1185941
>>
>>
>> Best,
>>
>> Manuel
>>
>> On 04/11/2010 11:41 a.m., Robert J. Hijmans wrote:
>>
>> Manuel.
>>
>> Did you try it without converting? The help file in raster says it
>> needs a SpatialPoints* object. The '*' is a wild card that in this
>> case stands for 'DataFrame'.
>>
>> The answer to your question:
>>
>> as(x, 'SpatialPoints')
>>
>> You could find the answer to many of this type of questions by reading
>> the vignettes of sp and raster, and by searching the R-sig-geo help
>> archives, and looking at the R spatial wiki.
>>
>> Robert
>>
>> On Thu, Nov 4, 2010 at 10:25 AM, Manuel Spmnola<mspinola10 at gmail.com>
>> wrote:
>>
>> Dear list members,
>>
>>
>> I am trying to create a raster from points, but I read the points from a
>> shapfile, so I have the points object as a SpatialPointsDataFrame.
>> To use the function pointsToRaster I need the points as SpatialPoints.
>>
>> How to convert a SpatialPointsDataFrame object to a SpatialPoints?
>> Best,
>>
>> Manuel
>>
>>
>> --
>> *Manuel Spmnola, Ph.D.*
>> Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.ac.cr
>> mspinola10 at gmail.com
>> Telifono: (506) 2277-3598
>> Fax: (506) 2237-7036
>> Personal website: Lobito de rmo
>> <https://sites.google.com/site/lobitoderio/>
>> Institutional website: ICOMVIS<http://www.icomvis.una.ac.cr/>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>>
>> --
>> Manuel Spmnola, Ph.D.
>> Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.ac.cr
>> mspinola10 at gmail.com
>> Telifono: (506) 2277-3598
>> Fax: (506) 2237-7036
>> Personal website: Lobito de rmo
>> Institutional website: ICOMVIS


-- 
*Manuel Spmnola, Ph.D.*
Instituto Internacional en Conservacisn y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Telifono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de rmo 
<https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]



------------------------------

Message: 16
Date: Thu, 04 Nov 2010 17:36:22 -0400
From: govindas at msu.edu
To: steven mosher <moshersteven at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
[[elided Yahoo spam]]
Message-ID: <20101104173622.327465q203o894k6 at mail.msu.edu>
Content-Type: text/plain; charset="iso-8859-1"



thanks .. and it did work! but i see some jagged lines in between the years,
typically like the one? joining dec of previous year and oct of the
successive year. Is this how it would look like? can it be made better?

[[elided Yahoo spam]]

heres the code..!

x.date <- as.Date(paste(chn.arr[,1], chn.arr[,2], chn.arr[,3], sep="-"))
ts.chn <- ts(chn.arr[1:2386,4])
z.chn <- zoo(ts.chn, x.date)
plot(z.chn, main = "Rainfall variations", xlab = "Year", ylab="Daily
rainfall (mm)")

-- 
Regards,
Mahalakshmi
Graduate Student
#20, Department of Geography
Michigan State University
East Lansing, MI 48824 Quoting steven mosher <moshersteven at gmail.com>:

> I would look at using? the package 'zoo' your time series data would be a
> zoo object
> and then your date data? would be coerced as well,
>
> zoo, is very slick.
>
> On Thu, Nov 4, 2010 at 12:18 PM, <govindas at msu.edu> wrote:
>
>>
>>
>> Hi all,
>>
>> I have a matrix as given below...
>>
>> year month day prec
>> 1? ?1980? ? 10? ?1 13.4
>> 2? ?1980? ? 10? ?2? 0.0
>> 3? ?1980? ? 10? ?3? 0.0
>> 4? ?1980? ? 10? ?4? 0.0
>> 5? ?1980? ? 10? ?5? 0.0
>> 6? ?1980? ? 10? ?6? 0.0
>> 7? ?1980? ? 10? ?7? 0.0
>> 8? ?1980? ? 10? ?8? 0.0
>> 9? ?1980? ? 10? ?9? 0.0
>> 10? 1980? ? 10? 10? 0.0
>> 11? 1980? ? 10? 11? 7.4
>> 12? 1980? ? 10? 12? 5.4
>> 13? 1980? ? 10? 13? 7.2
>> 14? 1980? ? 10? 14? 0.0
>> 15? 1980? ? 10? 15? 0.0
>> 16? 1980? ? 10? 16? 0.0
>> 17? 1980? ? 10? 17 41.2
>> 18? 1980? ? 10? 18? 0.0
>> 19? 1980? ? 10? 19? 0.0
>> 20? 1980? ? 10? 20? 0.0
>> 21? 1980? ? 10? 21? 0.0
>> 22? 1980? ? 10? 22? 0.0
>> 23? 1980? ? 10? 23? 0.0
>> 24? 1980? ? 10? 24? 0.0
>> 25? 1980? ? 10? 25? 0.0
>> 26? 1980? ? 10? 26? 0.0
>> 27? 1980? ? 10? 27? 2.0
>> 28? 1980? ? 10? 28? 0.0
>> 29? 1980? ? 10? 29? 0.0
>> 30? 1980? ? 10? 30? 0.0
>> 31? 1980? ? 10? 31? 0.0
>> 32? 1980? ? 11? ?1? 0.0
>> 33? 1980? ? 11? ?2? 0.0
>> 34? 1980? ? 11? ?3? 0.0
>> 35? 1980? ? 11? ?4? 0.0
>> 36? 1980? ? 11? ?5 12.4
>>
>> the precipitation values extend from 1980 to 2005, but only for october,
>> november and december. I would? like to plot just these 3 months for the
>> given time period (1980 -? 2005). Is there a way to get these values in
the
>> x-axis. i.e. i need a? plot with its axis reading "1980, 1981, 1982 ..
2005"
>> (even if the? months are specified then it should be of more use). for
now,
>> i get an? axis like .. "0, 500, ... 2000" (the plot is giving the index
>> values).
>>
[[elided Yahoo spam]]
>> ts.chn <- ts(chn.arr[1:2386,4], start=c(1980, 10), end=c(2005, 12),
>> freq=365)
>> plot(ts.chn)
>>
>> --
>> Regards,
>> Mahalakshmi
>> Graduate Student
>> #20, Department of Geography
>> Michigan State University
>> East Lansing, MI 48824
>>? ? ? ? [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL:
<https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/f6396585/atta
chment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RF_zoo.jpeg
Type: image/jpeg
Size: 79123 bytes
Desc: not available
URL:
<https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101104/f6396585/atta
chment-0001.jpeg>

------------------------------

Message: 17
Date: Thu, 4 Nov 2010 15:25:05 -0700
From: steven mosher <moshersteven at gmail.com>
To: govindas at msu.edu
Cc: r-sig-geo at stat.math.ethz.ch
[[elided Yahoo spam]]
Message-ID:
	<AANLkTimgiRAHchqE361VRRk8u6SeZYeddhWobM+Lgabw at mail.gmail.com>
Content-Type: text/plain

Hmm,

Suggests you might have some missing data as opposed to having zeros for
those days.

something about your number of days for oct/nov/dec from 1980-2005  doesnt
seem right either

so double check that.


On Thu, Nov 4, 2010 at 2:36 PM, <govindas at msu.edu> wrote:

> thanks .. and it did work! but i see some jagged lines in between the
> years, typically like the one  joining dec of previous year and oct of the
> successive year. Is this how it would look like? can it be made better?
>
[[elided Yahoo spam]]
>
> heres the code..!
>
> x.date <- as.Date(paste(chn.arr[,1], chn.arr[,2], chn.arr[,3], sep="-"))
> ts.chn <- ts(chn.arr[1:2386,4])
> z.chn <- zoo(ts.chn, x.date)
> plot(z.chn, main = "Rainfall variations", xlab = "Year", ylab="Daily
> rainfall (mm)")
>
> --
> Regards,
> Mahalakshmi
> Graduate Student
> #20, Department of Geography
> Michigan State University
> East Lansing, MI 48824
> Quoting steven mosher <moshersteven at gmail.com>:
>
> > I would look at using  the package 'zoo' your time series data would be
a
> > zoo object
> > and then your date data  would be coerced as well,
> >
> > zoo, is very slick.
> >
> > On Thu, Nov 4, 2010 at 12:18 PM, <govindas at msu.edu> wrote:
> >
> >>
> >>
> >> Hi all,
> >>
> >> I have a matrix as given below...
> >>
> >> year month day prec
> >> 1   1980    10   1 13.4
> >> 2   1980    10   2  0.0
> >> 3   1980    10   3  0.0
> >> 4   1980    10   4  0.0
> >> 5   1980    10   5  0.0
> >> 6   1980    10   6  0.0
> >> 7   1980    10   7  0.0
> >> 8   1980    10   8  0.0
> >> 9   1980    10   9  0.0
> >> 10  1980    10  10  0.0
> >> 11  1980    10  11  7.4
> >> 12  1980    10  12  5.4
> >> 13  1980    10  13  7.2
> >> 14  1980    10  14  0.0
> >> 15  1980    10  15  0.0
> >> 16  1980    10  16  0.0
> >> 17  1980    10  17 41.2
> >> 18  1980    10  18  0.0
> >> 19  1980    10  19  0.0
> >> 20  1980    10  20  0.0
> >> 21  1980    10  21  0.0
> >> 22  1980    10  22  0.0
> >> 23  1980    10  23  0.0
> >> 24  1980    10  24  0.0
> >> 25  1980    10  25  0.0
> >> 26  1980    10  26  0.0
> >> 27  1980    10  27  2.0
> >> 28  1980    10  28  0.0
> >> 29  1980    10  29  0.0
> >> 30  1980    10  30  0.0
> >> 31  1980    10  31  0.0
> >> 32  1980    11   1  0.0
> >> 33  1980    11   2  0.0
> >> 34  1980    11   3  0.0
> >> 35  1980    11   4  0.0
> >> 36  1980    11   5 12.4
> >>
> >> the precipitation values extend from 1980 to 2005, but only for
october,
> >> november and december. I would  like to plot just these 3 months for
the
> >> given time period (1980 -  2005). Is there a way to get these values in
> the
> >> x-axis. i.e. i need a  plot with its axis reading "1980, 1981, 1982 ..
> 2005"
> >> (even if the  months are specified then it should be of more use). for
> now,
> >> i get an  axis like .. "0, 500, ... 2000" (the plot is giving the index
> >> values).
> >>
[[elided Yahoo spam]]
> >> ts.chn <- ts(chn.arr[1:2386,4], start=c(1980, 10), end=c(2005, 12),
> >> freq=365)
> >> plot(ts.chn)
> >>
> >> --
> >> Regards,
> >> Mahalakshmi
> >> Graduate Student
> >> #20, Department of Geography
> >> Michigan State University
> >> East Lansing, MI 48824
> >>        [[alternative HTML version deleted]]
> >>
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >>
> >
>

	[[alternative HTML version deleted]]



------------------------------

Message: 18
Date: Thu, 4 Nov 2010 16:05:11 -0700
From: Oliver Soong <osoong+r at gmail.com>
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] rgdal, multiband CCITT compression
Message-ID:
	<AANLkTinVFAEBzfmjUZL84h7GMWpVjZtudfYrZ8dg264k at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Hello,

I can't seem to write a multi-band 1-bit CCITT-compressed GeoTIFF
(using any of the CCITT compression methods).  The file writes, but
when reloaded the data are wrong (I can't tell for sure whether this
is a read or write problem).  I can write a 1-band 1-bit
CCITT-compressed GeoTIFF fine, and I can write a multi-band 1-bit
deflate-compressed GeoTIFF fine.  This is on Windows XP x86, R 2.12.0,
rgdal 0.6-28, sp 0.9-72, GDAL 1.7.1, PROJ.4 4.7.1.

On a similar note, only GDAL seems to be able to handle any multi-band
1-bit GeoTIFFs it produces.  ArcGIS 10 explicitly states (somewhere
deep in their documentation) that multi-band 1-bit TIFFs are not
supported.  Even without compression, ENVI throws an error about an
array with a corrupted descriptor, then crashes out.

Is this a bug, or a limitation of TIFF, CCITT, or GDAL that I'm not aware
of?

Thoughts are appreciated,
Oliver


-- 
Oliver Soong
Donald Bren School of Environmental Science & Management
University of California, Santa Barbara
Santa Barbara, CA 93106-5131
805-893-7044 (office)
610-291-9706 (cell)



------------------------------

Message: 19
Date: Fri, 5 Nov 2010 10:18:34 +1100
From: Michael Sumner <mdsumner at gmail.com>
To: Oliver Soong <osoong+r at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] rgdal, multiband CCITT compression
Message-ID:
	<AANLkTi=SYUAuBQELQVesssJfrxXfqdLhdcwAt_L8kxNU at mail.gmail.com>
Content-Type: text/plain

Could you please provide an example of the problem with R code, so we have
something concrete to experiment with?

I could work out the required options and a sample dataset etc. but
presumably that is something you can do with less effort.

You should be able to investigate the generated file with the gdal command
line tools to figure out the problem.

Cheers, Mike.

On Fri, Nov 5, 2010 at 10:05 AM, Oliver Soong
<osoong+r at gmail.com<osoong%2Br at gmail.com>
> wrote:

> Hello,
>
> I can't seem to write a multi-band 1-bit CCITT-compressed GeoTIFF
> (using any of the CCITT compression methods).  The file writes, but
> when reloaded the data are wrong (I can't tell for sure whether this
> is a read or write problem).  I can write a 1-band 1-bit
> CCITT-compressed GeoTIFF fine, and I can write a multi-band 1-bit
> deflate-compressed GeoTIFF fine.  This is on Windows XP x86, R 2.12.0,
> rgdal 0.6-28, sp 0.9-72, GDAL 1.7.1, PROJ.4 4.7.1.
>
> On a similar note, only GDAL seems to be able to handle any multi-band
> 1-bit GeoTIFFs it produces.  ArcGIS 10 explicitly states (somewhere
> deep in their documentation) that multi-band 1-bit TIFFs are not
> supported.  Even without compression, ENVI throws an error about an
> array with a corrupted descriptor, then crashes out.
>
> Is this a bug, or a limitation of TIFF, CCITT, or GDAL that I'm not aware
> of?
>
> Thoughts are appreciated,
> Oliver
>
>
> --
> Oliver Soong
> Donald Bren School of Environmental Science & Management
> University of California, Santa Barbara
> Santa Barbara, CA 93106-5131
> 805-893-7044 (office)
> 610-291-9706 (cell)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]



------------------------------

Message: 20
Date: Thu, 4 Nov 2010 23:50:49 +0000
From: Craig Mundy <Craig.Mundy at utas.edu.au>
To: "r-sig-geo at stat.math.ethz.ch" <r-sig-geo at stat.math.ethz.ch>
Subject: [R-sig-Geo] Is there a function for counting polygons within
	a multi-polygon SpatialPolygonDataFrame class
Message-ID:
	<5504936889E8F947B474AFF792016B5D0353CC at MBXSBYN3.utas.ad.internal>
Content-Type: text/plain

Hi All,

I have searched for (but not found), a function for counting polygons within
each record of a multi-polygon SpatialPolygonDataFrame class? I had thought
of sifting through the slot information, but thought I would check if there
was a function I had overlooked before I embarked on that. I can easily do
this in SQL Server but would prefer to batch process in R along with some
other tasks.

Thanks

Craig

	[[alternative HTML version deleted]]



------------------------------

Message: 21
Date: Thu, 4 Nov 2010 17:00:42 -0700
From: Oliver Soong <osoong+r at gmail.com>
To: Michael Sumner <mdsumner at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] rgdal, multiband CCITT compression
Message-ID:
	<AANLkTi=A33QZZMtn4vyC1ycH52MSd_rORKTU-LM5uR9+ at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Here's an example:




require(rgdal)
formals(paste)$sep <- ""

SP27GTIF <- readGDAL(
  system.file("pictures/SP27GTIF.TIF", package = "rgdal")[1],
  output.dim=c(100,100)
)
img_1bit_1band <- SP27GTIF
img_1bit_1band at data$band1 <- as.integer(SP27GTIF at data$band1 > 85)
img_1bit_2band <- SP27GTIF
img_1bit_2band at data <- data.frame(
  band1 = img_1bit_1band at data$band1,
  band2 = as.integer(SP27GTIF at data$band1 > 170)
)

for(img in c("img_1bit_1band", "img_1bit_2band")) {
  cat(paste("*** Correct Stats: ", img, "\n"))
  print(sapply(get(img)@data, table))
  for(compress in c("NONE", "DEFLATE", "LZW", "CCITTRLE",
                    "CCITTFAX3", "CCITTFAX4")) {
    file <- paste(img, "_", compress, ".tif")
    writeGDAL(get(img), file, type = "Byte",
      options = c("NBITS=1", paste("COMPRESS=", compress)))
    cat(paste("Compression: ", compress, " from ", file, "\n"))
    reread <- readGDAL(file, silent = TRUE)
    print(sapply(reread at data, table))
  }
  cat("\n")
}





The expected output is:

*** Correct Stats: img_1bit_1band
  band1
0  3086
1  6914
Compression: NONE from img_1bit_1band_NONE.tif
  band1
0  3086
1  6914
Compression: DEFLATE from img_1bit_1band_DEFLATE.tif
  band1
0  3086
1  6914
Compression: LZW from img_1bit_1band_LZW.tif
  band1
0  3086
1  6914
Compression: CCITTRLE from img_1bit_1band_CCITTRLE.tif
  band1
0  3086
1  6914
Compression: CCITTFAX3 from img_1bit_1band_CCITTFAX3.tif
  band1
0  3086
1  6914
Compression: CCITTFAX4 from img_1bit_1band_CCITTFAX4.tif
  band1
0  3086
1  6914

*** Correct Stats: img_1bit_2band
  band1 band2
0  3086  8353
1  6914  1647
Compression: NONE from img_1bit_2band_NONE.tif
  band1 band2
0  3086  8353
1  6914  1647
Compression: DEFLATE from img_1bit_2band_DEFLATE.tif
  band1 band2
0  3086  8353
1  6914  1647
Compression: LZW from img_1bit_2band_LZW.tif
  band1 band2
0  3086  8353
1  6914  1647
Compression: CCITTRLE from img_1bit_2band_CCITTRLE.tif
  band1 band2
0  6131  8783
1  3869  1217
Compression: CCITTFAX3 from img_1bit_2band_CCITTFAX3.tif
  band1 band2
0  6131  8783
1  3869  1217
Compression: CCITTFAX4 from img_1bit_2band_CCITTFAX4.tif
  band1 band2
0  6131  8783
1  3869  1217



Everything looks fine except CCITT compression with 2 bands.

I wasn't able to dig up Windows GDAL 1.7.1 binaries, and the 1.7.0
binaries from FW_Tools seem to give similar behavior, although it's a
little hard to check because neither ArcGIS nor ENVI seems to like any
of the multi-band files.



------------------------------

Message: 22
Date: Fri, 5 Nov 2010 11:14:51 +1100
From: Michael Sumner <mdsumner at gmail.com>
To: Oliver Soong <osoong+r at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] rgdal, multiband CCITT compression
Message-ID:
	<AANLkTin9vVU1T-_ucmPMxr2yOVpRWcxj5tfStXSHNT-j at mail.gmail.com>
Content-Type: text/plain

Ok, thanks. I can try later today with Manifold System, which may be. I'm
not sure of other non-GDAL tools to double check TIFFs with. (ArcGIS 10 uses
GDAL but I don't know to what extent).

Is the output above what you expect, or what you get? That's what I get.
Sorry to be dim, but I don't see where you've specified what's actually
wrong (and I haven't explored enough to see if that's easy to determine from
the code).

That's a cunning use of formals() to change defaults for a function - a bit
radical for my taste, but I like it.

Cheers, Mike.

On Fri, Nov 5, 2010 at 11:00 AM, Oliver Soong
<osoong+r at gmail.com<osoong%2Br at gmail.com>
> wrote:

> Here's an example:
>
>
>
>
> require(rgdal)
> formals(paste)$sep <- ""
>
> SP27GTIF <- readGDAL(
>  system.file("pictures/SP27GTIF.TIF", package = "rgdal")[1],
>  output.dim=c(100,100)
> )
> img_1bit_1band <- SP27GTIF
> img_1bit_1band at data$band1 <- as.integer(SP27GTIF at data$band1 > 85)
> img_1bit_2band <- SP27GTIF
> img_1bit_2band at data <- data.frame(
>  band1 = img_1bit_1band at data$band1,
>  band2 = as.integer(SP27GTIF at data$band1 > 170)
> )
>
> for(img in c("img_1bit_1band", "img_1bit_2band")) {
>  cat(paste("*** Correct Stats: ", img, "\n"))
>  print(sapply(get(img)@data, table))
>  for(compress in c("NONE", "DEFLATE", "LZW", "CCITTRLE",
>                    "CCITTFAX3", "CCITTFAX4")) {
>    file <- paste(img, "_", compress, ".tif")
>    writeGDAL(get(img), file, type = "Byte",
>      options = c("NBITS=1", paste("COMPRESS=", compress)))
>    cat(paste("Compression: ", compress, " from ", file, "\n"))
>    reread <- readGDAL(file, silent = TRUE)
>    print(sapply(reread at data, table))
>  }
>  cat("\n")
> }
>
>
>
>
>
> The expected output is:
>
> *** Correct Stats: img_1bit_1band
>  band1
> 0  3086
> 1  6914
> Compression: NONE from img_1bit_1band_NONE.tif
>  band1
> 0  3086
> 1  6914
> Compression: DEFLATE from img_1bit_1band_DEFLATE.tif
>  band1
> 0  3086
> 1  6914
> Compression: LZW from img_1bit_1band_LZW.tif
>  band1
> 0  3086
> 1  6914
> Compression: CCITTRLE from img_1bit_1band_CCITTRLE.tif
>  band1
> 0  3086
> 1  6914
> Compression: CCITTFAX3 from img_1bit_1band_CCITTFAX3.tif
>  band1
> 0  3086
> 1  6914
> Compression: CCITTFAX4 from img_1bit_1band_CCITTFAX4.tif
>  band1
> 0  3086
> 1  6914
>
> *** Correct Stats: img_1bit_2band
>  band1 band2
> 0  3086  8353
> 1  6914  1647
> Compression: NONE from img_1bit_2band_NONE.tif
>  band1 band2
> 0  3086  8353
> 1  6914  1647
> Compression: DEFLATE from img_1bit_2band_DEFLATE.tif
>  band1 band2
> 0  3086  8353
> 1  6914  1647
> Compression: LZW from img_1bit_2band_LZW.tif
>  band1 band2
> 0  3086  8353
> 1  6914  1647
> Compression: CCITTRLE from img_1bit_2band_CCITTRLE.tif
>  band1 band2
> 0  6131  8783
> 1  3869  1217
> Compression: CCITTFAX3 from img_1bit_2band_CCITTFAX3.tif
>  band1 band2
> 0  6131  8783
> 1  3869  1217
> Compression: CCITTFAX4 from img_1bit_2band_CCITTFAX4.tif
>  band1 band2
> 0  6131  8783
> 1  3869  1217
>
>
>
> Everything looks fine except CCITT compression with 2 bands.
>
> I wasn't able to dig up Windows GDAL 1.7.1 binaries, and the 1.7.0
> binaries from FW_Tools seem to give similar behavior, although it's a
> little hard to check because neither ArcGIS nor ENVI seems to like any
> of the multi-band files.
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]



------------------------------

Message: 23
Date: Fri, 5 Nov 2010 11:15:27 +1100
From: Michael Sumner <mdsumner at gmail.com>
To: Oliver Soong <osoong+r at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] rgdal, multiband CCITT compression
Message-ID:
	<AANLkTi=7G1dK-o-_yqOOc5KHyNjJRq-c5NgYFe9hMAWA at mail.gmail.com>
Content-Type: text/plain

Sorry, I meant:

"I can try later today with Manifold System, which may be helpful as an
independent tool, maybe".

On Fri, Nov 5, 2010 at 11:14 AM, Michael Sumner <mdsumner at gmail.com> wrote:

> Ok, thanks. I can try later today with Manifold System, which may be. I'm
> not sure of other non-GDAL tools to double check TIFFs with. (ArcGIS 10
uses
> GDAL but I don't know to what extent).
>
> Is the output above what you expect, or what you get? That's what I get.
> Sorry to be dim, but I don't see where you've specified what's actually
> wrong (and I haven't explored enough to see if that's easy to determine
from
> the code).
>
> That's a cunning use of formals() to change defaults for a function - a
bit
> radical for my taste, but I like it.
>
> Cheers, Mike.
>
>   On Fri, Nov 5, 2010 at 11:00 AM, Oliver Soong
<osoong+r at gmail.com<osoong%2Br at gmail.com>
> > wrote:
>
>> Here's an example:
>>
>>
>>
>>
>> require(rgdal)
>> formals(paste)$sep <- ""
>>
>> SP27GTIF <- readGDAL(
>>  system.file("pictures/SP27GTIF.TIF", package = "rgdal")[1],
>>  output.dim=c(100,100)
>> )
>> img_1bit_1band <- SP27GTIF
>> img_1bit_1band at data$band1 <- as.integer(SP27GTIF at data$band1 > 85)
>> img_1bit_2band <- SP27GTIF
>> img_1bit_2band at data <- data.frame(
>>  band1 = img_1bit_1band at data$band1,
>>  band2 = as.integer(SP27GTIF at data$band1 > 170)
>> )
>>
>> for(img in c("img_1bit_1band", "img_1bit_2band")) {
>>  cat(paste("*** Correct Stats: ", img, "\n"))
>>  print(sapply(get(img)@data, table))
>>  for(compress in c("NONE", "DEFLATE", "LZW", "CCITTRLE",
>>                    "CCITTFAX3", "CCITTFAX4")) {
>>    file <- paste(img, "_", compress, ".tif")
>>    writeGDAL(get(img), file, type = "Byte",
>>      options = c("NBITS=1", paste("COMPRESS=", compress)))
>>    cat(paste("Compression: ", compress, " from ", file, "\n"))
>>    reread <- readGDAL(file, silent = TRUE)
>>    print(sapply(reread at data, table))
>>  }
>>  cat("\n")
>> }
>>
>>
>>
>>
>>
>> The expected output is:
>>
>> *** Correct Stats: img_1bit_1band
>>  band1
>> 0  3086
>> 1  6914
>> Compression: NONE from img_1bit_1band_NONE.tif
>>  band1
>> 0  3086
>> 1  6914
>> Compression: DEFLATE from img_1bit_1band_DEFLATE.tif
>>  band1
>> 0  3086
>> 1  6914
>> Compression: LZW from img_1bit_1band_LZW.tif
>>  band1
>> 0  3086
>> 1  6914
>> Compression: CCITTRLE from img_1bit_1band_CCITTRLE.tif
>>  band1
>> 0  3086
>> 1  6914
>> Compression: CCITTFAX3 from img_1bit_1band_CCITTFAX3.tif
>>  band1
>> 0  3086
>> 1  6914
>> Compression: CCITTFAX4 from img_1bit_1band_CCITTFAX4.tif
>>  band1
>> 0  3086
>> 1  6914
>>
>> *** Correct Stats: img_1bit_2band
>>  band1 band2
>> 0  3086  8353
>> 1  6914  1647
>> Compression: NONE from img_1bit_2band_NONE.tif
>>  band1 band2
>> 0  3086  8353
>> 1  6914  1647
>> Compression: DEFLATE from img_1bit_2band_DEFLATE.tif
>>  band1 band2
>> 0  3086  8353
>> 1  6914  1647
>> Compression: LZW from img_1bit_2band_LZW.tif
>>  band1 band2
>> 0  3086  8353
>> 1  6914  1647
>> Compression: CCITTRLE from img_1bit_2band_CCITTRLE.tif
>>  band1 band2
>> 0  6131  8783
>> 1  3869  1217
>> Compression: CCITTFAX3 from img_1bit_2band_CCITTFAX3.tif
>>  band1 band2
>> 0  6131  8783
>> 1  3869  1217
>> Compression: CCITTFAX4 from img_1bit_2band_CCITTFAX4.tif
>>  band1 band2
>> 0  6131  8783
>> 1  3869  1217
>>
>>
>>
>> Everything looks fine except CCITT compression with 2 bands.
>>
>> I wasn't able to dig up Windows GDAL 1.7.1 binaries, and the 1.7.0
>> binaries from FW_Tools seem to give similar behavior, although it's a
>> little hard to check because neither ArcGIS nor ENVI seems to like any
>> of the multi-band files.
>>
>
>
>
>  --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]



------------------------------

Message: 24
Date: Fri, 5 Nov 2010 11:33:43 +1100
From: Michael Sumner <mdsumner at gmail.com>
To: Craig Mundy <Craig.Mundy at utas.edu.au>
Cc: "r-sig-geo at stat.math.ethz.ch" <r-sig-geo at stat.math.ethz.ch>
Subject: Re: [R-sig-Geo] Is there a function for counting polygons
	within a multi-polygon SpatialPolygonDataFrame class
Message-ID:
	<AANLkTimgrHqFNSwqns3_Y_BFYR_LHyrX0hf5KYq-jjgF at mail.gmail.com>
Content-Type: text/plain; charset=UTF-8

This will give you the number of separate "rings", but that won't
allow you to differentiate between separate simple polygons, and rings
that represent "holes":

sapply(SrDf at polygons, function(x) length(slot(x, "Polygons")))

It needs more work to check each individual "Polygon" in "x" to see if
slot(x[[i]], "hole") is TRUE. I think this will do it:

sapply(SrDf at polygons, function(x) sum( !sapply(slot(x, "Polygons"),
slot, "hole")))

Note that use slot(x, "name") is more verbose that x at name, but either
is not recommended for normal use and should be bundled into methods,
or helper functions.

I think it's worth delving into the structure of these objects, as
it's fairly simple once you get used to it and writing summary
functions is not hard.

Cheers, Mike.

On Fri, Nov 5, 2010 at 10:50 AM, Craig Mundy <Craig.Mundy at utas.edu.au>
wrote:
>
> Hi All,
>
> I have searched for (but not found), a function for counting polygons
within each record of a multi-polygon SpatialPolygonDataFrame class? I had
thought of sifting through the slot information, but thought I would check
if there was a function I had overlooked before I embarked on that. I can
easily do this in SQL Server but would prefer to batch process in R along
with some other tasks.
>
> Thanks
>
> Craig
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



--
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com



------------------------------

Message: 25
Date: Thu, 4 Nov 2010 17:40:27 -0700
From: Oliver Soong <osoong+r at gmail.com>
To: Michael Sumner <mdsumner at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] rgdal, multiband CCITT compression
Message-ID:
	<AANLkTimcNKFC4exW1KjYyJq1DxR1aTka+VqUbTvquosk at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Sorry, the word "expected" was a bad choice.  The output is what I
get.  I'm highlighting two tables that should be the same, but aren't.
 I appreciate you taking the time to poke around with me.

*** Correct Stats: img_1bit_2band
 band1 band2
0  3086  8353
1  6914  1647
Compression: CCITTRLE from img_1bit_2band_CCITTRLE.tif
 band1 band2
0  6131  8783
1  3869  1217




On Thu, Nov 4, 2010 at 5:14 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> Ok, thanks. I can try later today with Manifold System, which may be. I'm
> not sure of other non-GDAL tools to double check TIFFs with. (ArcGIS 10
uses
> GDAL but I don't know to what extent).
>
> Is the output above what you expect, or what you get? That's what I get.
> Sorry to be dim, but I don't see where you've specified what's actually
> wrong (and I haven't explored enough to see if that's easy to determine
from
> the code).
>
> That's a?cunning use of formals() to?change defaults for a function?- a
bit
> radical for my taste, but I like it.
>
> Cheers, Mike.
>
> On Fri, Nov 5, 2010 at 11:00 AM, Oliver Soong <osoong+r at gmail.com> wrote:
>>
>> Here's an example:
>>
>>
>>
>>
>> require(rgdal)
>> formals(paste)$sep <- ""
>>
>> SP27GTIF <- readGDAL(
>> ?system.file("pictures/SP27GTIF.TIF", package = "rgdal")[1],
>> ?output.dim=c(100,100)
>> )
>> img_1bit_1band <- SP27GTIF
>> img_1bit_1band at data$band1 <- as.integer(SP27GTIF at data$band1 > 85)
>> img_1bit_2band <- SP27GTIF
>> img_1bit_2band at data <- data.frame(
>> ?band1 = img_1bit_1band at data$band1,
>> ?band2 = as.integer(SP27GTIF at data$band1 > 170)
>> )
>>
>> for(img in c("img_1bit_1band", "img_1bit_2band")) {
>> ?cat(paste("*** Correct Stats: ", img, "\n"))
>> ?print(sapply(get(img)@data, table))
>> ?for(compress in c("NONE", "DEFLATE", "LZW", "CCITTRLE",
>> ? ? ? ? ? ? ? ? ? ?"CCITTFAX3", "CCITTFAX4")) {
>> ? ?file <- paste(img, "_", compress, ".tif")
>> ? ?writeGDAL(get(img), file, type = "Byte",
>> ? ? ?options = c("NBITS=1", paste("COMPRESS=", compress)))
>> ? ?cat(paste("Compression: ", compress, " from ", file, "\n"))
>> ? ?reread <- readGDAL(file, silent = TRUE)
>> ? ?print(sapply(reread at data, table))
>> ?}
>> ?cat("\n")
>> }
>>
>>
>>
>>
>>
>> The expected output is:
>>
>> *** Correct Stats: img_1bit_1band
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: NONE from img_1bit_1band_NONE.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: DEFLATE from img_1bit_1band_DEFLATE.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: LZW from img_1bit_1band_LZW.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: CCITTRLE from img_1bit_1band_CCITTRLE.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: CCITTFAX3 from img_1bit_1band_CCITTFAX3.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>> Compression: CCITTFAX4 from img_1bit_1band_CCITTFAX4.tif
>> ?band1
>> 0 ?3086
>> 1 ?6914
>>
>> *** Correct Stats: img_1bit_2band
>> ?band1 band2
>> 0 ?3086 ?8353
>> 1 ?6914 ?1647
>> Compression: NONE from img_1bit_2band_NONE.tif
>> ?band1 band2
>> 0 ?3086 ?8353
>> 1 ?6914 ?1647
>> Compression: DEFLATE from img_1bit_2band_DEFLATE.tif
>> ?band1 band2
>> 0 ?3086 ?8353
>> 1 ?6914 ?1647
>> Compression: LZW from img_1bit_2band_LZW.tif
>> ?band1 band2
>> 0 ?3086 ?8353
>> 1 ?6914 ?1647
>> Compression: CCITTRLE from img_1bit_2band_CCITTRLE.tif
>> ?band1 band2
>> 0 ?6131 ?8783
>> 1 ?3869 ?1217
>> Compression: CCITTFAX3 from img_1bit_2band_CCITTFAX3.tif
>> ?band1 band2
>> 0 ?6131 ?8783
>> 1 ?3869 ?1217
>> Compression: CCITTFAX4 from img_1bit_2band_CCITTFAX4.tif
>> ?band1 band2
>> 0 ?6131 ?8783
>> 1 ?3869 ?1217
>>
>>
>>
>> Everything looks fine except CCITT compression with 2 bands.
>>
>> I wasn't able to dig up Windows GDAL 1.7.1 binaries, and the 1.7.0
>> binaries from FW_Tools seem to give similar behavior, although it's a
>> little hard to check because neither ArcGIS nor ENVI seems to like any
>> of the multi-band files.
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>



-- 
Oliver Soong
Donald Bren School of Environmental Science & Management
University of California, Santa Barbara
Santa Barbara, CA 93106-5131
805-893-7044 (office)
610-291-9706 (cell)



------------------------------

Message: 26
Date: Fri, 5 Nov 2010 07:15:32 -0200
From: "Rodrigo Aluizio" <r.aluizio at gmail.com>
To: "R Help" <r-sig-geo at stat.math.ethz.ch>
Subject: [R-sig-Geo] Defining Holes Inside a Polygon
Message-ID: <000001cb7cca$02076c30$06164490$@gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi List.

I?m trying to solve an issue here, but it?s getting tricky.

I have an MapGen .dat file (attached) that contains about 39 closed lines.
Three of them (the largest ones) will be my main polygons and the rest of
them must become holes inside one of the three major areas. I?m able to
transform all the closed lines into SpatialPolygons and even create
shapefiles with them, but how can I modify the ?hole? slot of the smaller
polygons so I can keep them transparent when overlaying another map (those
holes will overlay islands of a raster image)?

 

Thank you for the attention and help.

Regards.

 

-------------------------------------------------------------------

MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio

Centro de Estudos do Mar/UFPR
Laborat?rio de Foramin?feros e Micropaleontologia Ambiental
Avenida Beira Mar s/n - CEP 83255-971
Pontal do Paran? - PR - Brazil



-------------- next part --------------
An HTML attachment was scrubbed...
URL:
<https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/1d7fee34/atta
chment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PCForams.dat
Type: application/octet-stream
Size: 133962 bytes
Desc: not available
URL:
<https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/1d7fee34/atta
chment-0001.obj>

------------------------------

Message: 27
Date: Fri, 5 Nov 2010 11:01:05 +0100 (CET)
From: Roger Bivand <Roger.Bivand at nhh.no>
To: Rodrigo Aluizio <r.aluizio at gmail.com>
Cc: R Help <r-sig-geo at stat.math.ethz.ch>
Subject: Re: [R-sig-Geo] Defining Holes Inside a Polygon
Message-ID: <alpine.LRH.2.00.1011051048370.27156 at reclus.nhh.no>
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"

On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:

> Hi List.
>
> I?m trying to solve an issue here, but it?s getting tricky.
>
> I have an MapGen .dat file (attached) that contains about 39 closed lines.
> Three of them (the largest ones) will be my main polygons and the rest of
> them must become holes inside one of the three major areas. I?m able to
> transform all the closed lines into SpatialPolygons and even create
> shapefiles with them, but how can I modify the ?hole? slot of the smaller
> polygons so I can keep them transparent when overlaying another map (those
> holes will overlay islands of a raster image)?
>

Next time avoid sending 200K to over 1700 people, please, we have a planet 
to protect! Put any desired attachments on a website and provide a link.

You should also have provided the code (in your message) to get from:

library(maptools)
l1 <- MapGen2SL("PCForams.dat")

to your problem - as those choices may be the cause of the problem; you 
have not provided the output of sessionInfo() either. Once things are 
lined up, you should - if you may - say:

gpclibPermit() # very restrictive license
pls_out <- lapply(slot(SpPols0, "polygons"), checkPolygonsHoles)
SpPols1 <- SpatialPolygons(pls_out)

Or if you can install rgeos from source on R-Forge, equivalently:

library(rgeos)
SpPols1 <- createSPComment(SpPols0)

Hope this helps,

Roger

>
>
> Thank you for the attention and help.
>
> Regards.
>
>
>
> -------------------------------------------------------------------
>
> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>
> Centro de Estudos do Mar/UFPR
> Laborat?rio de Foramin?feros e Micropaleontologia Ambiental
> Avenida Beira Mar s/n - CEP 83255-971
> Pontal do Paran? - PR - Brazil
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

------------------------------

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


End of R-sig-Geo Digest, Vol 87, Issue 5


From Roger.Bivand at nhh.no  Fri Nov  5 14:42:13 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Nov 2010 14:42:13 +0100 (CET)
Subject: [R-sig-Geo] RES:  Defining Holes Inside a Polygon
In-Reply-To: <003a01cb7cdf$52538e70$f6faab50$@gmail.com>
References: <000001cb7cca$02076c30$06164490$@gmail.com>
	<alpine.LRH.2.00.1011051048370.27156@reclus.nhh.no>
	<003a01cb7cdf$52538e70$f6faab50$@gmail.com>
Message-ID: <alpine.LRH.2.00.1011051323010.27156@reclus.nhh.no>

On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:

> Very sorry about the attached file, I'm not used to mailing lists, won't
> happen again.
> Well, I've already tried the checkPolygonsHoles function as specified in a
> book of Yours, and even then nothing changes in the final Shapefiles, all
> the polygons remain with FALSE "hole" slots.
>
> Below are the code and sessionInfo().
>
> # Required Packages
> library(rgdal)
> library(RODBC)
> library(maptools)
> gpclibPermit()
>
> #Loading Data
> Data<-odbcConnectExcel2007('Sub-Provincias-Forams-Dados.xlsx',readOnly=T)
> PCdata<-sqlFetch(Data,'PC',rownames='ID')
> odbcCloseAll()
>
> # Loading Lines
> PC<-MapGen2SL('PCForams.dat',proj4string=CRS('+proj=longlat +ellps=WGS84'))
>
> # Verifing closed Lines
> PCP<-sapply(slot(PC,'lines'),function (x) {
>  crds<-slot(slot(x,'Lines')[[1]],'coords')
>  identical(crds[1,],crds[nrow(crds),])
> })
>
> # Preparing the Poligons
> PCP2<-PC[PCP==T]
> lista_de_pols<-slot(PCP2,'lines')
> PCSP<-SpatialPolygons(lapply(lista_de_pols, function(x) {
>  Polygons(list(Polygon(slot(slot(x,'Lines')[[1]],
>  'coords'))),ID=slot(x,'ID'))
> }),proj4string=CRS('+proj=longlat +ellps=WGS84'))

The problem is that you had 39 Lines objects, and now have 39 Polygons 
objects, each with a single outer ring by definition. The 
checkPolygonsHoles() function checks multiple rings in a Polygons object. 
What you need to do from here will depend on whether you know which 
inner rings belong to which outer rings or not. If you do not, you could 
try something like:

crds <- coordinates(PCSP)
pips <- lapply(slot(PCSP, "polygons"), function(x)
  sp:::pointsInPolygons(crds, x))
ipips <-sapply(pips, which)
which(sapply(ipips, length) > 1)
nipips <- which(sapply(ipips, length) > 1)
npips <- ipips[nipips]
ors <- integer(length(slot(PCSP, "polygons")))
ors[npips[[1]]] <- 1
ors[npips[[2]]] <- 2
ors
ors[2] <- 3
ors[3] <- 4
ors

to get a candidate vector by seeing which rings contain more than one 
centroid.

In one case, we can use unionSpatialPolygons() to combine three external 
"islands", which are not holes, and in two cases there are no multi-rings:

pls <- vector(mode="list", length=4)
oo2 <- PCSP[which(ors == 2)]
gpclibPermit()
pls[2] <- slot(unionSpatialPolygons(oo2, rep("2", 3)), "polygons")[[1]]
pls[3] <- slot(PCSP[2], "polygons")[[1]]
pls[4] <- slot(PCSP[3], "polygons")[[1]]

The final collection is harder:

oo1 <- PCSP[which(ors == 1)]
oo1pls <- slot(oo1, "polygons")
areas <- sapply(oo1pls, function(x) sapply(slot(x, "Polygons"), slot,
  "area"))
marea <- which.max(areas)
o1lst <- vector(mode="list", length=length(oo1pls))
for (i in 1:length(oo1pls)) {
   oi <- slot(slot(oo1pls[[i]], "Polygons")[[1]], "coords")
   hole <- ifelse(i == marea, FALSE, TRUE)
   o1lst[[i]] <- Polygon(oi, hole=hole)
}
pls[1] <- Polygons(o1lst, ID="1")
PCSPH <- SpatialPolygons(pls)
plot(PCSPH, axes=TRUE, col="grey", pbg="white")

now works. You'll need to revisit the data, however, as you only have four 
Polygons objects now, so will need a PCdata object with 4 rows. You'll 
probably also need to set the row.names of both PCSPH and PCdata to match 
exactly too, as they may no longer do so. You'll also need to make sure 
that the proj4string is properly set - I've ignored it here.

Hope this helps,

Roger

>
> # Defining the Holes
> pls_out<-lapply(slot(PCSP,"polygons"),checkPolygonsHoles)
> PCSPH<-SpatialPolygons(pls_out,proj4string=CRS('+proj=longlat
> +ellps=WGS84'))
> PCSPDF<-SpatialPolygonsDataFrame(PCSPH,PCdata)
> writeOGR(PCSPDF,dsn='.',layer='PCForams',driver='ESRI Shapefile')
>
> # Session Info
> R version 2.12.0 (2010-10-15)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=Portuguese_Brazil.1252
> [2] LC_CTYPE=Portuguese_Brazil.1252
> [3] LC_MONETARY=Portuguese_Brazil.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=Portuguese_Brazil.1252
>
> attached base packages:
> [1] grDevices datasets  splines   graphics  stats
> [6] tcltk     utils     methods   base
>
> other attached packages:
> [1] gpclib_1.5-1    maptools_0.7-38 lattice_0.19-13
> [4] foreign_0.8-41  RODBC_1.3-2     rgdal_0.6-28
> [7] sp_0.9-72       svSocket_0.9-50 TinnR_1.0.3
> [10] R2HTML_2.2      Hmisc_3.8-3     survival_2.35-8
>
> loaded via a namespace (and not attached):
> [1] cluster_1.13.1 grid_2.12.0    svMisc_0.9-60
> [4] tools_2.12.0
>
> Thanks.
> Rodrigo.
>
> -----Mensagem original-----
> De: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Enviada em: sexta-feira, 5 de novembro de 2010 08:01
> Para: Rodrigo Aluizio
> Cc: R Help
> Assunto: Re: [R-sig-Geo] Defining Holes Inside a Polygon
>
> On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:
>
>> Hi List.
>>
>> I?m trying to solve an issue here, but it?s getting tricky.
>>
>> I have an MapGen .dat file (attached) that contains about 39 closed lines.
>> Three of them (the largest ones) will be my main polygons and the rest
>> of them must become holes inside one of the three major areas. I?m
>> able to transform all the closed lines into SpatialPolygons and even
>> create shapefiles with them, but how can I modify the ?hole? slot of
>> the smaller polygons so I can keep them transparent when overlaying
>> another map (those holes will overlay islands of a raster image)?
>>
>
> Next time avoid sending 200K to over 1700 people, please, we have a planet
> to protect! Put any desired attachments on a website and provide a link.
>
> You should also have provided the code (in your message) to get from:
>
> library(maptools)
> l1 <- MapGen2SL("PCForams.dat")
>
> to your problem - as those choices may be the cause of the problem; you have
> not provided the output of sessionInfo() either. Once things are lined up,
> you should - if you may - say:
>
> gpclibPermit() # very restrictive license pls_out <- lapply(slot(SpPols0,
> "polygons"), checkPolygonsHoles)
> SpPols1 <- SpatialPolygons(pls_out)
>
> Or if you can install rgeos from source on R-Forge, equivalently:
>
> library(rgeos)
> SpPols1 <- createSPComment(SpPols0)
>
> Hope this helps,
>
> Roger
>
>>
>>
>> Thank you for the attention and help.
>>
>> Regards.
>>
>>
>>
>> -------------------------------------------------------------------
>>
>> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>
>> Centro de Estudos do Mar/UFPR
>> Laborat?rio de Foramin?feros e Micropaleontologia Ambiental Avenida
>> Beira Mar s/n - CEP 83255-971 Pontal do Paran? - PR - Brazil
>>
>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From r.aluizio at gmail.com  Fri Nov  5 15:23:18 2010
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Fri, 5 Nov 2010 12:23:18 -0200
Subject: [R-sig-Geo]  Defining Holes Inside a Polygon
Message-ID: <004401cb7cf5$000f5e30$002e1a90$@gmail.com>

Thank you very much Roger. But , unfortunately it's was almost there. Like I
told before, I'll plot this Shapefiles over a raster map, and even if I set
the pbg='transparent' the color of the layer below (another polygon) will
still appear over my raster image. That's why I'm trying to turn these
'islands' (that will be represented by the background raster image) into
'holes' of my new shapefile.

Anyway, thank you very much for the effort. I won't be able to figure
something like out that so fast. 

Rodrigo.

-----Mensagem original-----
De: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Enviada em: sexta-feira, 5 de novembro de 2010 11:42
Para: Rodrigo Aluizio
Cc: 'R Help'
Assunto: Re: RES: [R-sig-Geo] Defining Holes Inside a Polygon

On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:

> Very sorry about the attached file, I'm not used to mailing lists, 
> won't happen again.
> Well, I've already tried the checkPolygonsHoles function as specified 
> in a book of Yours, and even then nothing changes in the final 
> Shapefiles, all the polygons remain with FALSE "hole" slots.
>
> Below are the code and sessionInfo().
>
> # Required Packages
> library(rgdal)
> library(RODBC)
> library(maptools)
> gpclibPermit()
>
> #Loading Data
> Data<-odbcConnectExcel2007('Sub-Provincias-Forams-Dados.xlsx',readOnly
> =T)
> PCdata<-sqlFetch(Data,'PC',rownames='ID')
> odbcCloseAll()
>
> # Loading Lines
> PC<-MapGen2SL('PCForams.dat',proj4string=CRS('+proj=longlat 
> +ellps=WGS84'))
>
> # Verifing closed Lines
> PCP<-sapply(slot(PC,'lines'),function (x) {
>  crds<-slot(slot(x,'Lines')[[1]],'coords')
>  identical(crds[1,],crds[nrow(crds),])
> })
>
> # Preparing the Poligons
> PCP2<-PC[PCP==T]
> lista_de_pols<-slot(PCP2,'lines')
> PCSP<-SpatialPolygons(lapply(lista_de_pols, function(x) {  
> Polygons(list(Polygon(slot(slot(x,'Lines')[[1]],
>  'coords'))),ID=slot(x,'ID'))
> }),proj4string=CRS('+proj=longlat +ellps=WGS84'))

The problem is that you had 39 Lines objects, and now have 39 Polygons
objects, each with a single outer ring by definition. The
checkPolygonsHoles() function checks multiple rings in a Polygons object. 
What you need to do from here will depend on whether you know which inner
rings belong to which outer rings or not. If you do not, you could try
something like:

crds <- coordinates(PCSP)
pips <- lapply(slot(PCSP, "polygons"), function(x)
  sp:::pointsInPolygons(crds, x))
ipips <-sapply(pips, which)
which(sapply(ipips, length) > 1)
nipips <- which(sapply(ipips, length) > 1) npips <- ipips[nipips] ors <-
integer(length(slot(PCSP, "polygons"))) ors[npips[[1]]] <- 1 ors[npips[[2]]]
<- 2 ors ors[2] <- 3 ors[3] <- 4 ors

to get a candidate vector by seeing which rings contain more than one
centroid.

In one case, we can use unionSpatialPolygons() to combine three external
"islands", which are not holes, and in two cases there are no multi-rings:

pls <- vector(mode="list", length=4)
oo2 <- PCSP[which(ors == 2)]
gpclibPermit()
pls[2] <- slot(unionSpatialPolygons(oo2, rep("2", 3)), "polygons")[[1]]
pls[3] <- slot(PCSP[2], "polygons")[[1]] pls[4] <- slot(PCSP[3],
"polygons")[[1]]

The final collection is harder:

oo1 <- PCSP[which(ors == 1)]
oo1pls <- slot(oo1, "polygons")
areas <- sapply(oo1pls, function(x) sapply(slot(x, "Polygons"), slot,
  "area"))
marea <- which.max(areas)
o1lst <- vector(mode="list", length=length(oo1pls)) for (i in
1:length(oo1pls)) {
   oi <- slot(slot(oo1pls[[i]], "Polygons")[[1]], "coords")
   hole <- ifelse(i == marea, FALSE, TRUE)
   o1lst[[i]] <- Polygon(oi, hole=hole)
}
pls[1] <- Polygons(o1lst, ID="1")
PCSPH <- SpatialPolygons(pls)
plot(PCSPH, axes=TRUE, col="grey", pbg="white")

now works. You'll need to revisit the data, however, as you only have four
Polygons objects now, so will need a PCdata object with 4 rows. You'll
probably also need to set the row.names of both PCSPH and PCdata to match
exactly too, as they may no longer do so. You'll also need to make sure that
the proj4string is properly set - I've ignored it here.

Hope this helps,

Roger

>
> # Defining the Holes
> pls_out<-lapply(slot(PCSP,"polygons"),checkPolygonsHoles)
> PCSPH<-SpatialPolygons(pls_out,proj4string=CRS('+proj=longlat
> +ellps=WGS84'))
> PCSPDF<-SpatialPolygonsDataFrame(PCSPH,PCdata)
> writeOGR(PCSPDF,dsn='.',layer='PCForams',driver='ESRI Shapefile')
>
> # Session Info
> R version 2.12.0 (2010-10-15)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=Portuguese_Brazil.1252
> [2] LC_CTYPE=Portuguese_Brazil.1252
> [3] LC_MONETARY=Portuguese_Brazil.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=Portuguese_Brazil.1252
>
> attached base packages:
> [1] grDevices datasets  splines   graphics  stats
> [6] tcltk     utils     methods   base
>
> other attached packages:
> [1] gpclib_1.5-1    maptools_0.7-38 lattice_0.19-13
> [4] foreign_0.8-41  RODBC_1.3-2     rgdal_0.6-28
> [7] sp_0.9-72       svSocket_0.9-50 TinnR_1.0.3
> [10] R2HTML_2.2      Hmisc_3.8-3     survival_2.35-8
>
> loaded via a namespace (and not attached):
> [1] cluster_1.13.1 grid_2.12.0    svMisc_0.9-60
> [4] tools_2.12.0
>
> Thanks.
> Rodrigo.
>
> -----Mensagem original-----
> De: Roger Bivand [mailto:Roger.Bivand at nhh.no] Enviada em: sexta-feira, 
> 5 de novembro de 2010 08:01
> Para: Rodrigo Aluizio
> Cc: R Help
> Assunto: Re: [R-sig-Geo] Defining Holes Inside a Polygon
>
> On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:
>
>> Hi List.
>>
>> I?m trying to solve an issue here, but it?s getting tricky.
>>
>> I have an MapGen .dat file (attached) that contains about 39 closed
lines.
>> Three of them (the largest ones) will be my main polygons and the 
>> rest of them must become holes inside one of the three major areas. 
>> I?m able to transform all the closed lines into SpatialPolygons and 
>> even create shapefiles with them, but how can I modify the ?hole? 
>> slot of the smaller polygons so I can keep them transparent when 
>> overlaying another map (those holes will overlay islands of a raster
image)?
>>
>
> Next time avoid sending 200K to over 1700 people, please, we have a 
> planet to protect! Put any desired attachments on a website and provide a
link.
>
> You should also have provided the code (in your message) to get from:
>
> library(maptools)
> l1 <- MapGen2SL("PCForams.dat")
>
> to your problem - as those choices may be the cause of the problem; 
> you have not provided the output of sessionInfo() either. Once things 
> are lined up, you should - if you may - say:
>
> gpclibPermit() # very restrictive license pls_out <- 
> lapply(slot(SpPols0, "polygons"), checkPolygonsHoles)
> SpPols1 <- SpatialPolygons(pls_out)
>
> Or if you can install rgeos from source on R-Forge, equivalently:
>
> library(rgeos)
> SpPols1 <- createSPComment(SpPols0)
>
> Hope this helps,
>
> Roger
>
>>
>>
>> Thank you for the attention and help.
>>
>> Regards.
>>
>>
>>
>> -------------------------------------------------------------------
>>
>> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>
>> Centro de Estudos do Mar/UFPR
>> Laborat?rio de Foramin?feros e Micropaleontologia Ambiental Avenida 
>> Beira Mar s/n - CEP 83255-971 Pontal do Paran? - PR - Brazil
>>
>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School 
> of Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Fri Nov  5 15:45:05 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Nov 2010 15:45:05 +0100 (CET)
Subject: [R-sig-Geo] Defining Holes Inside a Polygon
In-Reply-To: <004401cb7cf5$000f5e30$002e1a90$@gmail.com>
References: <004401cb7cf5$000f5e30$002e1a90$@gmail.com>
Message-ID: <alpine.LRH.2.00.1011051532440.27156@reclus.nhh.no>

On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:

> Thank you very much Roger. But , unfortunately it's was almost there. Like I
> told before, I'll plot this Shapefiles over a raster map, and even if I set
> the pbg='transparent' the color of the layer below (another polygon) will
> still appear over my raster image. That's why I'm trying to turn these
> 'islands' (that will be represented by the background raster image) into
> 'holes' of my new shapefile.

The SpatialPolygons object will be exported with the "hole" statuses set 
correctly to the shapefile. If you are plotting externally, you depend on 
the facilities there. In R, you are using 2.12.0, which is the first 
release to handle polygon holes repectfully. Try:

plot(as(PCSPH, "Spatial"), axes=TRUE, bg="azure")
plot(PCSPH, add=TRUE, col="grey", usePolypath=TRUE)

to "see through" the holes. You are right that with usePolypath=FALSE, and 
in earlier versions of R, inner ring holes were painted over the filled 
outer rings with a background colour. We probably should make usePolypath 
TRUE by default now, and check the R version in use.

Roger

>
> Anyway, thank you very much for the effort. I won't be able to figure
> something like out that so fast.
>
> Rodrigo.
>
> -----Mensagem original-----
> De: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Enviada em: sexta-feira, 5 de novembro de 2010 11:42
> Para: Rodrigo Aluizio
> Cc: 'R Help'
> Assunto: Re: RES: [R-sig-Geo] Defining Holes Inside a Polygon
>
> On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:
>
>> Very sorry about the attached file, I'm not used to mailing lists,
>> won't happen again.
>> Well, I've already tried the checkPolygonsHoles function as specified
>> in a book of Yours, and even then nothing changes in the final
>> Shapefiles, all the polygons remain with FALSE "hole" slots.
>>
>> Below are the code and sessionInfo().
>>
>> # Required Packages
>> library(rgdal)
>> library(RODBC)
>> library(maptools)
>> gpclibPermit()
>>
>> #Loading Data
>> Data<-odbcConnectExcel2007('Sub-Provincias-Forams-Dados.xlsx',readOnly
>> =T)
>> PCdata<-sqlFetch(Data,'PC',rownames='ID')
>> odbcCloseAll()
>>
>> # Loading Lines
>> PC<-MapGen2SL('PCForams.dat',proj4string=CRS('+proj=longlat
>> +ellps=WGS84'))
>>
>> # Verifing closed Lines
>> PCP<-sapply(slot(PC,'lines'),function (x) {
>>  crds<-slot(slot(x,'Lines')[[1]],'coords')
>>  identical(crds[1,],crds[nrow(crds),])
>> })
>>
>> # Preparing the Poligons
>> PCP2<-PC[PCP==T]
>> lista_de_pols<-slot(PCP2,'lines')
>> PCSP<-SpatialPolygons(lapply(lista_de_pols, function(x) {
>> Polygons(list(Polygon(slot(slot(x,'Lines')[[1]],
>>  'coords'))),ID=slot(x,'ID'))
>> }),proj4string=CRS('+proj=longlat +ellps=WGS84'))
>
> The problem is that you had 39 Lines objects, and now have 39 Polygons
> objects, each with a single outer ring by definition. The
> checkPolygonsHoles() function checks multiple rings in a Polygons object.
> What you need to do from here will depend on whether you know which inner
> rings belong to which outer rings or not. If you do not, you could try
> something like:
>
> crds <- coordinates(PCSP)
> pips <- lapply(slot(PCSP, "polygons"), function(x)
>  sp:::pointsInPolygons(crds, x))
> ipips <-sapply(pips, which)
> which(sapply(ipips, length) > 1)
> nipips <- which(sapply(ipips, length) > 1) npips <- ipips[nipips] ors <-
> integer(length(slot(PCSP, "polygons"))) ors[npips[[1]]] <- 1 ors[npips[[2]]]
> <- 2 ors ors[2] <- 3 ors[3] <- 4 ors
>
> to get a candidate vector by seeing which rings contain more than one
> centroid.
>
> In one case, we can use unionSpatialPolygons() to combine three external
> "islands", which are not holes, and in two cases there are no multi-rings:
>
> pls <- vector(mode="list", length=4)
> oo2 <- PCSP[which(ors == 2)]
> gpclibPermit()
> pls[2] <- slot(unionSpatialPolygons(oo2, rep("2", 3)), "polygons")[[1]]
> pls[3] <- slot(PCSP[2], "polygons")[[1]] pls[4] <- slot(PCSP[3],
> "polygons")[[1]]
>
> The final collection is harder:
>
> oo1 <- PCSP[which(ors == 1)]
> oo1pls <- slot(oo1, "polygons")
> areas <- sapply(oo1pls, function(x) sapply(slot(x, "Polygons"), slot,
>  "area"))
> marea <- which.max(areas)
> o1lst <- vector(mode="list", length=length(oo1pls)) for (i in
> 1:length(oo1pls)) {
>   oi <- slot(slot(oo1pls[[i]], "Polygons")[[1]], "coords")
>   hole <- ifelse(i == marea, FALSE, TRUE)
>   o1lst[[i]] <- Polygon(oi, hole=hole)
> }
> pls[1] <- Polygons(o1lst, ID="1")
> PCSPH <- SpatialPolygons(pls)
> plot(PCSPH, axes=TRUE, col="grey", pbg="white")
>
> now works. You'll need to revisit the data, however, as you only have four
> Polygons objects now, so will need a PCdata object with 4 rows. You'll
> probably also need to set the row.names of both PCSPH and PCdata to match
> exactly too, as they may no longer do so. You'll also need to make sure that
> the proj4string is properly set - I've ignored it here.
>
> Hope this helps,
>
> Roger
>
>>
>> # Defining the Holes
>> pls_out<-lapply(slot(PCSP,"polygons"),checkPolygonsHoles)
>> PCSPH<-SpatialPolygons(pls_out,proj4string=CRS('+proj=longlat
>> +ellps=WGS84'))
>> PCSPDF<-SpatialPolygonsDataFrame(PCSPH,PCdata)
>> writeOGR(PCSPDF,dsn='.',layer='PCForams',driver='ESRI Shapefile')
>>
>> # Session Info
>> R version 2.12.0 (2010-10-15)
>> Platform: x86_64-pc-mingw32/x64 (64-bit)
>>
>> locale:
>> [1] LC_COLLATE=Portuguese_Brazil.1252
>> [2] LC_CTYPE=Portuguese_Brazil.1252
>> [3] LC_MONETARY=Portuguese_Brazil.1252
>> [4] LC_NUMERIC=C
>> [5] LC_TIME=Portuguese_Brazil.1252
>>
>> attached base packages:
>> [1] grDevices datasets  splines   graphics  stats
>> [6] tcltk     utils     methods   base
>>
>> other attached packages:
>> [1] gpclib_1.5-1    maptools_0.7-38 lattice_0.19-13
>> [4] foreign_0.8-41  RODBC_1.3-2     rgdal_0.6-28
>> [7] sp_0.9-72       svSocket_0.9-50 TinnR_1.0.3
>> [10] R2HTML_2.2      Hmisc_3.8-3     survival_2.35-8
>>
>> loaded via a namespace (and not attached):
>> [1] cluster_1.13.1 grid_2.12.0    svMisc_0.9-60
>> [4] tools_2.12.0
>>
>> Thanks.
>> Rodrigo.
>>
>> -----Mensagem original-----
>> De: Roger Bivand [mailto:Roger.Bivand at nhh.no] Enviada em: sexta-feira,
>> 5 de novembro de 2010 08:01
>> Para: Rodrigo Aluizio
>> Cc: R Help
>> Assunto: Re: [R-sig-Geo] Defining Holes Inside a Polygon
>>
>> On Fri, 5 Nov 2010, Rodrigo Aluizio wrote:
>>
>>> Hi List.
>>>
>>> I?m trying to solve an issue here, but it?s getting tricky.
>>>
>>> I have an MapGen .dat file (attached) that contains about 39 closed
> lines.
>>> Three of them (the largest ones) will be my main polygons and the
>>> rest of them must become holes inside one of the three major areas.
>>> I?m able to transform all the closed lines into SpatialPolygons and
>>> even create shapefiles with them, but how can I modify the ?hole?
>>> slot of the smaller polygons so I can keep them transparent when
>>> overlaying another map (those holes will overlay islands of a raster
> image)?
>>>
>>
>> Next time avoid sending 200K to over 1700 people, please, we have a
>> planet to protect! Put any desired attachments on a website and provide a
> link.
>>
>> You should also have provided the code (in your message) to get from:
>>
>> library(maptools)
>> l1 <- MapGen2SL("PCForams.dat")
>>
>> to your problem - as those choices may be the cause of the problem;
>> you have not provided the output of sessionInfo() either. Once things
>> are lined up, you should - if you may - say:
>>
>> gpclibPermit() # very restrictive license pls_out <-
>> lapply(slot(SpPols0, "polygons"), checkPolygonsHoles)
>> SpPols1 <- SpatialPolygons(pls_out)
>>
>> Or if you can install rgeos from source on R-Forge, equivalently:
>>
>> library(rgeos)
>> SpPols1 <- createSPComment(SpPols0)
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>>
>>> Thank you for the attention and help.
>>>
>>> Regards.
>>>
>>>
>>>
>>> -------------------------------------------------------------------
>>>
>>> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>>
>>> Centro de Estudos do Mar/UFPR
>>> Laborat?rio de Foramin?feros e Micropaleontologia Ambiental Avenida
>>> Beira Mar s/n - CEP 83255-971 Pontal do Paran? - PR - Brazil
>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School
>> of Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From mspinola10 at gmail.com  Fri Nov  5 19:17:25 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Fri, 05 Nov 2010 12:17:25 -0600
Subject: [R-sig-Geo] error message in function kriege
Message-ID: <4CD44A35.4040302@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/3af6545f/attachment.pl>

From frostygoat at gmail.com  Fri Nov  5 19:45:26 2010
From: frostygoat at gmail.com (frosty goat)
Date: Fri, 5 Nov 2010 11:45:26 -0700 (PDT)
Subject: [R-sig-Geo] Map duo with lines connecting them
Message-ID: <1288982726852-5710206.post@n2.nabble.com>


Hi, I wish to combine two maps on a single plot so that I can draw lines that
interact with each map. The maps are easily plotted side by side with
par(mfrow=c(1,2) or layout(matrix(c(1,2,1,2),2,2,byrow=T), BUT I don't think
there is a way to plot the lines that interact with each. 

Here is the code that will give you the idea of what I want to do:

library(maps)
#layout(matrix(c(1,2,1,2),2,2,byrow=T))
#par(mfrow=c(1,2))
##Map 1: State with counties that are the study region
map("state","washington",fill=T,col="white",names=TRUE,plot=T)
co=map("county",region=c("washington,chelan","washington,douglas","washington,okanogan","washington,grant"),col="gray",bg="gray",fill=T,plot=F)
polygon(co$x,co$y,col="darkgray",border="darkgray")
##Map 2: The study region, large in order to plot some study sites from lat
& long
c2=map("county",region=c("washington,chelan","washington,douglas","washington,okanogan","washington,grant"),fill=T,col="white",names=TRUE,plot=F)


So, I would like lines to go from the corners of the study region on the
state (overview) map to the corners on the bigger detailed study regions on
the second map, so it looks like it is popping out.

This seems to require the two maps to be one single map unified by the
coordinates, but clearly the state map covers a much broader lat and long
range.

Thanks for any ideas.  




-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Map-duo-with-lines-connecting-them-tp5710206p5710206.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Greg.Snow at imail.org  Fri Nov  5 19:59:21 2010
From: Greg.Snow at imail.org (Greg Snow)
Date: Fri, 5 Nov 2010 12:59:21 -0600
Subject: [R-sig-Geo] Map duo with lines connecting them
In-Reply-To: <1288982726852-5710206.post@n2.nabble.com>
References: <1288982726852-5710206.post@n2.nabble.com>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC633EC5FC95@LP-EXMBVS10.CO.IHC.COM>

Here is one way:

library(maps)
par(mfrow=c(1,2))
##Map 1: State with counties that are the study region
map("state","washington",fill=T,col="white",names=TRUE,plot=T)
co=map("county",region=c("washington,chelan","washington,douglas","washington,okanogan","washington,grant"),col="gray",bg="gray",fill=T,plot=F)
polygon(co$x,co$y,col="darkgray",border="darkgray")
##Map 2: The study region, large in order to plot some study sites from lat & long

x1 <- rep(range(co$x, na.rm=TRUE),2)
y1 <- rep(range(co$y, na.rm=TRUE),each=2)

xt1 <- grconvertX(x1, to='ndc')
yt1 <- grconvertY(y1, to='ndc')

c2=map("county",region=c("washington,chelan","washington,douglas","washington,okanogan","washington,grant"),fill=T,col="white",names=TRUE,plot=F)

map("county",region=c("washington,chelan","washington,douglas","washington,okanogan","washington,grant"),fill=T,col="white")

xtt1 <- grconvertX(xt1, from='ndc')
ytt1 <- grconvertY(yt1, from='ndc')
par(xpd=NA)
segments(x1,y1,xtt1,ytt1, col='red')

This draws from the corners of the bounding box, change x1 and y1 for different points to connect.



-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] On Behalf Of frosty goat
> Sent: Friday, November 05, 2010 12:45 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Map duo with lines connecting them
> 
> 
> Hi, I wish to combine two maps on a single plot so that I can draw
> lines that
> interact with each map. The maps are easily plotted side by side with
> par(mfrow=c(1,2) or layout(matrix(c(1,2,1,2),2,2,byrow=T), BUT I don't
> think
> there is a way to plot the lines that interact with each.
> 
> Here is the code that will give you the idea of what I want to do:
> 
> library(maps)
> #layout(matrix(c(1,2,1,2),2,2,byrow=T))
> #par(mfrow=c(1,2))
> ##Map 1: State with counties that are the study region
> map("state","washington",fill=T,col="white",names=TRUE,plot=T)
> co=map("county",region=c("washington,chelan","washington,douglas","wash
> ington,okanogan","washington,grant"),col="gray",bg="gray",fill=T,plot=F
> )
> polygon(co$x,co$y,col="darkgray",border="darkgray")
> ##Map 2: The study region, large in order to plot some study sites from
> lat
> & long
> c2=map("county",region=c("washington,chelan","washington,douglas","wash
> ington,okanogan","washington,grant"),fill=T,col="white",names=TRUE,plot
> =F)
> 
> 
> So, I would like lines to go from the corners of the study region on
> the
> state (overview) map to the corners on the bigger detailed study
> regions on
> the second map, so it looks like it is popping out.
> 
> This seems to require the two maps to be one single map unified by the
> coordinates, but clearly the state map covers a much broader lat and
> long
> range.
> 
> Thanks for any ideas.
> 
> 
> 
> 
> --
> View this message in context: http://r-sig-
> geo.2731867.n2.nabble.com/Map-duo-with-lines-connecting-them-
> tp5710206p5710206.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From frostygoat at gmail.com  Fri Nov  5 20:10:01 2010
From: frostygoat at gmail.com (frosty goat)
Date: Fri, 5 Nov 2010 12:10:01 -0700 (PDT)
Subject: [R-sig-Geo] Map duo with lines connecting them
In-Reply-To: <B37C0A15B8FB3C468B5BC7EBC7DA14CC633EC5FC95@LP-EXMBVS10.CO.IHC.COM>
References: <1288982726852-5710206.post@n2.nabble.com>
	<B37C0A15B8FB3C468B5BC7EBC7DA14CC633EC5FC95@LP-EXMBVS10.CO.IHC.COM>
Message-ID: <1288984201361-5710278.post@n2.nabble.com>


Awesome Greg.  Thank you.
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Map-duo-with-lines-connecting-them-tp5710206p5710278.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mspinola10 at gmail.com  Fri Nov  5 21:13:25 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Fri, 05 Nov 2010 14:13:25 -0600
Subject: [R-sig-Geo] 8. Convert from spatialpointsdataframe to
	spatialpoints
In-Reply-To: <000901cb7ce0$d4dbe350$7e93a9f0$@com.br>
References: <mailman.15.1288954804.1668.r-sig-geo@stat.math.ethz.ch>
	<000901cb7ce0$d4dbe350$7e93a9f0$@com.br>
Message-ID: <4CD46565.6040209@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/25334915/attachment.pl>

From edzer.pebesma at uni-muenster.de  Fri Nov  5 21:53:23 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 05 Nov 2010 21:53:23 +0100
Subject: [R-sig-Geo] error message in function kriege
In-Reply-To: <4CD44A35.4040302@gmail.com>
References: <4CD44A35.4040302@gmail.com>
Message-ID: <4CD46EC3.2010902@uni-muenster.de>

Maybe you could try:

 rich.kriged = krige(N~1, rich, as(r, "SpatialGridDataFrame"),
    model = rich.fit)

and, if needed, convert rich.kriged back to raster.

On 11/05/2010 07:17 PM, Manuel Sp?nola wrote:
> Dear list members,
> 
> I am doing a kriging and I got this error message.
> 
>  > rich.kriged = krige(N~1, rich, r, model = rich.fit)
> Error en proj4string(newdata) :
>    proj4string only works for class(es extending) Spatial
> 
> "rich" is SpatialPointsDataFrame
> "r" is a projected raster
> 
> Any help will be appreciatedr?
> 
> Best,
> 
> Manuel
> 
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mspinola10 at gmail.com  Fri Nov  5 22:01:19 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Fri, 05 Nov 2010 15:01:19 -0600
Subject: [R-sig-Geo] xyValues on raster with distances
Message-ID: <4CD4709F.4080501@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/f63627d0/attachment.pl>

From govindas at msu.edu  Fri Nov  5 23:58:46 2010
From: govindas at msu.edu (govindas at msu.edu)
Date: Fri, 05 Nov 2010 18:58:46 -0400
Subject: [R-sig-Geo] prob with legend in my plots!
Message-ID: <20101105185846.120825am1r4o0t9i@mail.msu.edu>



Hi,

I have a problem with the appearance of legend in my plots. If I specify the legend positions in characters like "topright"..etc, it appears, if i specify it in terms of coordinates like "-1, 1" .. etc, it does not appear. Can anyone help me with this?

script - 
x.date <- as.Date(paste(year, month, day, sep="-"))
ts1.n.e3 <- ts(data.nemr.e3[,3])
z1.n.e3 <- zoo(ts1.n.e3, x.date)
plot(z1.n.e3, ylim = c(min(data.nemr.e3[,3]), max(data.nemr.e3[,5])), col="orange",
main = "Monthly variations of SST in El-Nino3", xlab = "Year", ylab="SST (deg C)")
lines(z2.n.e3, lty = 2, col="red2")
lines(z3.n.e3, lty = 3, col="maroon3", lwd=1)
legend(-0.1, -0.1, legend=c("min", "mean", "max"), lty=c(1,2,3),
col=c("orange", "red2", "maroon3"))

attached is my plot!?suggestions are welcome! thanks in advance! 

-- 
Regards,
Maha!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/5fb78524/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SST_ElN3.jpeg
Type: image/jpeg
Size: 114045 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/5fb78524/attachment.jpeg>

From ricardorodot02 at gmail.com  Sat Nov  6 00:21:40 2010
From: ricardorodot02 at gmail.com (=?ISO-8859-1?Q?Ricardo_Rodr=EDguez?=)
Date: Fri, 5 Nov 2010 18:21:40 -0500
Subject: [R-sig-Geo] reports with Sweave and gis data examples or templates
Message-ID: <AANLkTik3bopFerRwv80u91JbNYTMWH0D5jvO2T7wK_oK@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/978f9ba6/attachment.pl>

From ricardorodot02 at gmail.com  Sat Nov  6 00:33:08 2010
From: ricardorodot02 at gmail.com (=?ISO-8859-1?Q?Ricardo_Rodr=EDguez?=)
Date: Fri, 5 Nov 2010 18:33:08 -0500
Subject: [R-sig-Geo] method of "natural break" or percentiles of an image
Message-ID: <AANLkTikxOUqPEoycOkaQeOv9HatptJRCS4tpGcUeV=zV@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/5c7f0e12/attachment.pl>

From ricardorodot02 at gmail.com  Sat Nov  6 00:40:11 2010
From: ricardorodot02 at gmail.com (=?ISO-8859-1?Q?Ricardo_Rodr=EDguez?=)
Date: Fri, 5 Nov 2010 18:40:11 -0500
Subject: [R-sig-Geo] print error
Message-ID: <AANLkTi=YmtJnkGhKLdN5kF0efmX1MeOd_zDYKT9nvt4s@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101105/3f018f4d/attachment.pl>

From matzke at berkeley.edu  Sat Nov  6 01:37:03 2010
From: matzke at berkeley.edu (Nick Matzke)
Date: Fri, 05 Nov 2010 17:37:03 -0700
Subject: [R-sig-Geo] adding points to spplot grid
Message-ID: <4CD4A32F.9080306@berkeley.edu>

Hi,

I have been working with spplot.  I can get continuous grids 
to plot with spplot, but what do I do if I want to plot some 
points with x,y coordinates on top of the image?

Cheers!
Nick


-- 
====================================================
Nicholas J. Matzke
Ph.D. Candidate, Graduate Student Researcher
Huelsenbeck Lab
Center for Theoretical Evolutionary Genomics
4151 VLSB (Valley Life Sciences Building)
Department of Integrative Biology
University of California, Berkeley

Graduate Student Instructor, IB200A
Principles of Phylogenetics: Systematics
http://ib.berkeley.edu/courses/ib200a/index.shtml

Lab websites:
http://ib.berkeley.edu/people/lab_detail.php?lab=54
http://fisher.berkeley.edu/cteg/hlab.html
Dept. personal page: 
http://ib.berkeley.edu/people/students/person_detail.php?person=370
Lab personal page: 
http://fisher.berkeley.edu/cteg/members/matzke.html
Lab phone: 510-643-6299
Dept. fax: 510-643-6264
Cell phone: 510-301-0179
Email: matzke at berkeley.edu

Mailing address:
Department of Integrative Biology
3060 VLSB #3140
Berkeley, CA 94720-3140

-----------------------------------------------------
"[W]hen people thought the earth was flat, they were wrong. 
When people thought the earth was spherical, they were 
wrong. But if you think that thinking the earth is spherical 
is just as wrong as thinking the earth is flat, then your 
view is wronger than both of them put together."

Isaac Asimov (1989). "The Relativity of Wrong." The 
Skeptical Inquirer, 14(1), 35-44. Fall 1989.
http://chem.tufts.edu/AnswersInScience/RelativityofWrong.htm


From carson.farmer at gmail.com  Sat Nov  6 02:09:45 2010
From: carson.farmer at gmail.com (Carson J Q Farmer)
Date: Sat, 6 Nov 2010 01:09:45 +0000
Subject: [R-sig-Geo] method of "natural break" or percentiles of an image
In-Reply-To: <AANLkTikxOUqPEoycOkaQeOv9HatptJRCS4tpGcUeV=zV@mail.gmail.com>
References: <AANLkTikxOUqPEoycOkaQeOv9HatptJRCS4tpGcUeV=zV@mail.gmail.com>
Message-ID: <6691E27C-5B68-44C7-A84B-E13497E6D2B1@gmail.com>

Have a look at the classInt package, it has functions for various classification algorithms, including jerks.

Cheers,

Carson

On 5 Nov 2010, at 11:33 p.m., Ricardo Rodr?guez <ricardorodot02 at gmail.com> wrote:

> hello.
> 
> I need to make an automatic classification of values by the method of
> "natural break" or percentiles of an image. tiff or spatialgrid, R is
> possible, that package might do the job or in what form it might do (I've
> asked before but not I got info)
> 
> Thanks for your answers
> 
> Ricardo Rodr?guez
> Univalle
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From carson.farmer at gmail.com  Sat Nov  6 02:13:51 2010
From: carson.farmer at gmail.com (Carson J Q Farmer)
Date: Sat, 6 Nov 2010 01:13:51 +0000
Subject: [R-sig-Geo] method of "natural break" or percentiles of an image
In-Reply-To: <6691E27C-5B68-44C7-A84B-E13497E6D2B1@gmail.com>
References: <AANLkTikxOUqPEoycOkaQeOv9HatptJRCS4tpGcUeV=zV@mail.gmail.com>
	<6691E27C-5B68-44C7-A84B-E13497E6D2B1@gmail.com>
Message-ID: <19A398F6-E126-427C-A524-C9C879C4534A@gmail.com>

Apologies, I meant Jenks, not jerks!

Regards,

Carson

On 6 Nov 2010, at 01:09 a.m., Carson J Q Farmer <carson.farmer at gmail.com> wrote:

> Have a look at the classInt package, it has functions for various classification algorithms, including jerks.
> 
> Cheers,
> 
> Carson
> 
> On 5 Nov 2010, at 11:33 p.m., Ricardo Rodr?guez <ricardorodot02 at gmail.com> wrote:
> 
>> hello.
>> 
>> I need to make an automatic classification of values by the method of
>> "natural break" or percentiles of an image. tiff or spatialgrid, R is
>> possible, that package might do the job or in what form it might do (I've
>> asked before but not I got info)
>> 
>> Thanks for your answers
>> 
>> Ricardo Rodr?guez
>> Univalle
>> 
>>   [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From lists at remoteinformation.com.au  Sat Nov  6 05:31:33 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Sat, 6 Nov 2010 15:31:33 +1100
Subject: [R-sig-Geo] prob with legend in my plots!
In-Reply-To: <20101105185846.120825am1r4o0t9i@mail.msu.edu>
References: <20101105185846.120825am1r4o0t9i@mail.msu.edu>
Message-ID: <9817BBA3-802B-4678-8402-E0F85355EAB8@remoteinformation.com.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/524c230f/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sat Nov  6 11:01:15 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 06 Nov 2010 11:01:15 +0100
Subject: [R-sig-Geo] print error
In-Reply-To: <AANLkTi=YmtJnkGhKLdN5kF0efmX1MeOd_zDYKT9nvt4s@mail.gmail.com>
References: <AANLkTi=YmtJnkGhKLdN5kF0efmX1MeOd_zDYKT9nvt4s@mail.gmail.com>
Message-ID: <4CD5276B.7080704@uni-muenster.de>

As a guesture towards those who tend to listen and answer your
questions, could you please take a bit more time to explain to us in
detail what your question is, and illustrate it with an example that is
reproducable to us, especially when the output is graphical?

Please also use a more descriptive subject.

Please also use the list and its archives as a source to learn from: I
seem to remember that very similar questions have been answered recently.

On 11/06/2010 12:40 AM, Ricardo Rodr?guez wrote:
> hello.
> spplot need to print with an interpolation and a polygon overlay on top but
> only spots of color I get someone knows why this happens
> 
> Thanks for your answers
> 
> Ricardo Rodr?guez
> Univalle
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Sat Nov  6 11:03:26 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 06 Nov 2010 11:03:26 +0100
Subject: [R-sig-Geo] adding points to spplot grid
In-Reply-To: <4CD4A32F.9080306@berkeley.edu>
References: <4CD4A32F.9080306@berkeley.edu>
Message-ID: <4CD527EE.7000107@uni-muenster.de>



On 11/06/2010 01:37 AM, Nick Matzke wrote:
> Hi,
> 
> I have been working with spplot.  I can get continuous grids to plot
> with spplot, but what do I do if I want to plot some points with x,y
> coordinates on top of the image?
> 
> Cheers!
> Nick
> 
> 
http://r-spatial.sourceforge.net/gallery/
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mspinola10 at gmail.com  Sat Nov  6 11:15:35 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sat, 06 Nov 2010 04:15:35 -0600
Subject: [R-sig-Geo] Plotting a tif file
Message-ID: <4CD52AC7.6050501@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/4acc4388/attachment.pl>

From p.hiemstra at geo.uu.nl  Sat Nov  6 13:46:38 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sat, 06 Nov 2010 13:46:38 +0100
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD52AC7.6050501@gmail.com>
References: <4CD52AC7.6050501@gmail.com>
Message-ID: <4CD54E2E.8020002@geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/27e8e970/attachment.pl>

From p.hiemstra at geo.uu.nl  Sat Nov  6 13:47:22 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sat, 06 Nov 2010 13:47:22 +0100
Subject: [R-sig-Geo] adding points to spplot grid
In-Reply-To: <4CD4A32F.9080306@berkeley.edu>
References: <4CD4A32F.9080306@berkeley.edu>
Message-ID: <4CD54E5A.1000203@geo.uu.nl>

On 11/06/2010 01:37 AM, Nick Matzke wrote:
> Hi,
>
> I have been working with spplot.  I can get continuous grids to plot 
> with spplot, but what do I do if I want to plot some points with x,y 
> coordinates on top of the image?
>
> Cheers!
> Nick
>
>
?spplot, look at the sp.layout argument.

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770


From mspinola10 at gmail.com  Sat Nov  6 14:28:24 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sat, 06 Nov 2010 07:28:24 -0600
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD54E2E.8020002@geo.uu.nl>
References: <4CD52AC7.6050501@gmail.com> <4CD54E2E.8020002@geo.uu.nl>
Message-ID: <4CD557F8.4000309@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/533eca9e/attachment.pl>

From p.hiemstra at geo.uu.nl  Sat Nov  6 14:26:42 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sat, 06 Nov 2010 14:26:42 +0100
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD557F8.4000309@gmail.com>
References: <4CD52AC7.6050501@gmail.com> <4CD54E2E.8020002@geo.uu.nl>
	<4CD557F8.4000309@gmail.com>
Message-ID: <4CD55792.8070402@geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/e7bcfa9d/attachment.pl>

From p.hiemstra at geo.uu.nl  Sat Nov  6 15:03:22 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sat, 06 Nov 2010 15:03:22 +0100
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD557F8.4000309@gmail.com>
References: <4CD52AC7.6050501@gmail.com> <4CD54E2E.8020002@geo.uu.nl>
	<4CD557F8.4000309@gmail.com>
Message-ID: <4CD5602A.70106@geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/cecf9127/attachment.pl>

From advaitgodbole at gmail.com  Sat Nov  6 15:19:47 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sat, 6 Nov 2010 10:19:47 -0400
Subject: [R-sig-Geo] netCDF to raster
Message-ID: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/4ef7a950/attachment.pl>

From mdsumner at gmail.com  Sat Nov  6 15:31:16 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 7 Nov 2010 01:31:16 +1100
Subject: [R-sig-Geo] netCDF to raster
In-Reply-To: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>
References: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>
Message-ID: <AANLkTikGZX+RgUmUceta2XUntVxMhO7j5Cx2On9tnSi9@mail.gmail.com>

How about this? Requires raster, ncdf, rgdal, and sp packages at least
so they must be installed.

library(raster)
## you will need to set some options here, but there are prompts
r <- raster("ncfile.nc")

sgdf <- as(r, "SpatialGridDataFrame")

writeGDAL(sgdf, "geotiff.tif")

See gdalDrivers() for the available formats, which can be set using
options to writeGDAL.

No doubt there will be variations and extra digging for you particular
data, but not far from this. Can you share the file?

Cheers, Mike.

On Sun, Nov 7, 2010 at 1:19 AM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> Dear Members,
>
> I want to convert a 356 x 507 (lat,lon) 2D ?netcdf file into a raster so
> that I can read it in to image analysis/GIS programs. I initially adopted an
> approach whereby I first used NCL to convert it to a Fortran unformatted
> binary and then convert it to a formatted sequential format using Fortran.
> This was then read in to ENVI as a "flt" file. I would like to know if there
> is an elegant way in R to directly convert to a geospatial raster, more so
> because I recently switched to using a different cluster and am running into
> i/o problems with all those binary conversions.
>
> Regards,
>
> --
> Advait Godbole, BE Mech
> Doctoral Student, Global Carbon Cycle Lab
> Earth and Atmospheric Sciences
> Purdue University
> West Lafayette, IN 47906
> USA
> voice: +1 317 730 5235
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From sdveloz at ucdavis.edu  Sat Nov  6 16:30:24 2010
From: sdveloz at ucdavis.edu (Samuel Veloz)
Date: Sat, 6 Nov 2010 08:30:24 -0700
Subject: [R-sig-Geo] netCDF to raster
In-Reply-To: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>
References: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>
Message-ID: <AANLkTi=zruQzzaabHObTLgcQh0JxNyvCbrz9zVHqR5ot@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/43b77423/attachment.pl>

From advaitgodbole at gmail.com  Sat Nov  6 19:16:02 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sat, 6 Nov 2010 14:16:02 -0400
Subject: [R-sig-Geo] netCDF to raster
In-Reply-To: <AANLkTi=zruQzzaabHObTLgcQh0JxNyvCbrz9zVHqR5ot@mail.gmail.com>
References: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>
	<AANLkTi=zruQzzaabHObTLgcQh0JxNyvCbrz9zVHqR5ot@mail.gmail.com>
Message-ID: <AANLkTi=Q3X6nGpjVvJb8SW_SQKMcfPBYVpfRYNNhFVN6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/6fe150af/attachment.pl>

From advaitgodbole at gmail.com  Sat Nov  6 20:51:51 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sat, 6 Nov 2010 15:51:51 -0400
Subject: [R-sig-Geo] netCDF to raster
In-Reply-To: <AANLkTi=Q3X6nGpjVvJb8SW_SQKMcfPBYVpfRYNNhFVN6@mail.gmail.com>
References: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>
	<AANLkTi=zruQzzaabHObTLgcQh0JxNyvCbrz9zVHqR5ot@mail.gmail.com>
	<AANLkTi=Q3X6nGpjVvJb8SW_SQKMcfPBYVpfRYNNhFVN6@mail.gmail.com>
Message-ID: <AANLkTin-mye2-MqqTGE=ToE2A5vWf0NSHLXc4FKej613@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/306deea5/attachment.pl>

From r.hijmans at gmail.com  Sat Nov  6 23:11:17 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 6 Nov 2010 15:11:17 -0700
Subject: [R-sig-Geo] netCDF to raster
In-Reply-To: <AANLkTin-mye2-MqqTGE=ToE2A5vWf0NSHLXc4FKej613@mail.gmail.com>
References: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>
	<AANLkTi=zruQzzaabHObTLgcQh0JxNyvCbrz9zVHqR5ot@mail.gmail.com>
	<AANLkTi=Q3X6nGpjVvJb8SW_SQKMcfPBYVpfRYNNhFVN6@mail.gmail.com>
	<AANLkTin-mye2-MqqTGE=ToE2A5vWf0NSHLXc4FKej613@mail.gmail.com>
Message-ID: <AANLkTi=BwXJ8tCYxt9rsp9wLrjWtALzhN9Cwtq-Aisu5@mail.gmail.com>

Dear Advait,

"netcdf does not really have a "projection" in GIS parlance". netcdf
is flexible file format in which you can store all kinds of data in
different ways. Climatologists and some others tend to follow the "CF"
(NetCDF Climate and Forecast Metadata Convention) conventions.
Unfortunately, they do not make use one of the standard projections
description formats. I have not taken the time yet to parse the CF
descriptions and into a proj.4 string. However, the projection
metadata is stored in the raster object that you create from a nc (CF)
file in the slot "prj"

r <- raster('ncfile')
r at prj

>From that you can construct a proj.4, in your case probably:

prj <- "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=40 +lon_0=-96"

(see http://www.remotesensing.org/geotiff/proj_list/lambert_conic_conformal_2sp.html
)

and do:

projection(r) <- prj

and save the file.

Robert

On Sat, Nov 6, 2010 at 12:51 PM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> Ok, so I was able to convert and visualize everything but the projections
> are skewed. Do I have to define a projection when reading it in via raster
> or using writeGDAL? I have a custom co-ordinate system which is a modified
> North American Lambert Conformal Conic (NAD 1983 datum) like so:
> False_Easting: 0.00000000
> False_Northing: 0.00000000
> Central_Meridian: -96.00000000
> Standard_Parallel_1: 33.00000000
> Standard_Parallel_2: 45.00000000
> Latitude_Of_Origin: 40.00000000
> Linear Unit: Meter
>
> I would presume that writeGDAL takes care of the projection but my hunch
> says otherwise since the netcdf does not really have a "projection" in GIS
> parlance if I am not mistaken.
>
> Thanks!
>
>
> On Sat, Nov 6, 2010 at 2:16 PM, Advait Godbole <advaitgodbole at gmail.com>wrote:
>
>> Thanks Mike and Sam. This worked perfectly - I am only now realizing how
>> powerful R and these libraries are. Very elegant and smooth!
>>
>> cheers,
>>
>> adv
>>
>>
>> On Sat, Nov 6, 2010 at 11:30 AM, Samuel Veloz <sdveloz at ucdavis.edu> wrote:
>>
>>> You can skip the second step in Michael's code and just write to a tif
>>> file using raster:
>>>
>>> r <- raster("ncfile.nc") #you may need to specify varname here (which
>>> band you are using)
>>> writeRaster(r,"r.tif")
>>>
>>> Sam
>>>
>>>
>>> On Sat, Nov 6, 2010 at 7:19 AM, Advait Godbole <advaitgodbole at gmail.com>wrote:
>>>
>>>> Dear Members,
>>>>
>>>> I want to convert a 356 x 507 (lat,lon) 2D ?netcdf file into a raster so
>>>> that I can read it in to image analysis/GIS programs. I initially adopted
>>>> an
>>>> approach whereby I first used NCL to convert it to a Fortran unformatted
>>>> binary and then convert it to a formatted sequential format using
>>>> Fortran.
>>>> This was then read in to ENVI as a "flt" file. I would like to know if
>>>> there
>>>> is an elegant way in R to directly convert to a geospatial raster, more
>>>> so
>>>> because I recently switched to using a different cluster and am running
>>>> into
>>>> i/o problems with all those binary conversions.
>>>>
>>>> Regards,
>>>>
>>>> --
>>>> Advait Godbole, BE Mech
>>>> Doctoral Student, Global Carbon Cycle Lab
>>>> Earth and Atmospheric Sciences
>>>> Purdue University
>>>> West Lafayette, IN 47906
>>>> USA
>>>> voice: +1 317 730 5235
>>>>
>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>
>>
>> --
>> advait godbole
>>
>
>
>
> --
> advait godbole
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Sat Nov  6 23:17:08 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 6 Nov 2010 15:17:08 -0700
Subject: [R-sig-Geo] xyValues on raster with distances
In-Reply-To: <4CD4709F.4080501@gmail.com>
References: <4CD4709F.4080501@gmail.com>
Message-ID: <AANLkTim4HO-W5W_==2F7FS6fiehjGE2Kbgc_=Y+gPV5s@mail.gmail.com>

Dear Manuel,

If you are using the same village points to extract values that would
make sense. The distance from a village to the nearest village
(itself) is zero. You can visually investigate what is going using
these functions:

plot(distpob)
points(poblados)
click(distpob)
zoom(distpob)
plot(poblados)

Also, rather than this
> rp = pointsToRaster(r, poblados, values=1)
> distpob <- distance(rp)

you could consider
dispob <- distanceFromPoints(r, poblados)


Robert

On Fri, Nov 5, 2010 at 2:01 PM, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
> Dear list members,
>
> I created a raster with distances to villages and when I tried to obtain
> the values form the raster for several points (using function xyValues)
> I got all 0 values. ?Any help will be appreciated.
>
> r = raster(corredor)
>
> res(r) = 300
>
> rp = pointsToRaster(r, poblados, values=1)
>
> distpob <- distance(rp)
>
> distpob
> class ? ? ? : RasterLayer
> filename ? ?:
> nrow ? ? ? ?: 314
> ncol ? ? ? ?: 236
> ncell ? ? ? : 74104
> min value ? : 0
> max value ? : 46013.58
> projection ?: NA
> xmin ? ? ? ?: 447165.1
> xmax ? ? ? ?: 517965.1
> ymin ? ? ? ?: 1122216
> ymax ? ? ? ?: 1216416
> xres ? ? ? ?: 300
> yres ? ? ? ?: 300
>
>
> Best,
>
> Manuel
>
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From advaitgodbole at gmail.com  Sun Nov  7 02:31:16 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sat, 6 Nov 2010 21:31:16 -0400
Subject: [R-sig-Geo] netCDF to raster
In-Reply-To: <AANLkTi=BwXJ8tCYxt9rsp9wLrjWtALzhN9Cwtq-Aisu5@mail.gmail.com>
References: <AANLkTingUL4Cq-VB0znWTVdPewqfUvL2dC=YDyXQo_we@mail.gmail.com>
	<AANLkTi=zruQzzaabHObTLgcQh0JxNyvCbrz9zVHqR5ot@mail.gmail.com>
	<AANLkTi=Q3X6nGpjVvJb8SW_SQKMcfPBYVpfRYNNhFVN6@mail.gmail.com>
	<AANLkTin-mye2-MqqTGE=ToE2A5vWf0NSHLXc4FKej613@mail.gmail.com>
	<AANLkTi=BwXJ8tCYxt9rsp9wLrjWtALzhN9Cwtq-Aisu5@mail.gmail.com>
Message-ID: <AANLkTimbhfvyg99_idDSaSRWYYUx5407km2=TB=_Jb0V@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101106/c12f524e/attachment.pl>

From alexandru.dumitrescu at gmail.com  Sun Nov  7 09:02:46 2010
From: alexandru.dumitrescu at gmail.com (Alexandru Dumitrescu)
Date: Sun, 7 Nov 2010 10:02:46 +0200
Subject: [R-sig-Geo] sp.text background
Message-ID: <AANLkTinfhuDmrCP57+2PrQzEvcomn1G8YUQrPvgjNk7Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/24828531/attachment.pl>

From lists at remoteinformation.com.au  Sun Nov  7 10:52:58 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Sun, 7 Nov 2010 20:52:58 +1100
Subject: [R-sig-Geo] adding points to spplot grid
In-Reply-To: <4CD527EE.7000107@uni-muenster.de>
References: <4CD4A32F.9080306@berkeley.edu> <4CD527EE.7000107@uni-muenster.de>
Message-ID: <9761E8A9-C472-4BF9-858B-67D40AB94536@remoteinformation.com.au>


On 06/11/2010, at 9:03 PM, Edzer Pebesma wrote:

> http://r-spatial.sourceforge.net/gallery/

Nice resource, thanks for the heads up.

cheers

Ben




> -- 
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From p.hiemstra at geo.uu.nl  Sun Nov  7 10:54:17 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sun, 07 Nov 2010 10:54:17 +0100
Subject: [R-sig-Geo] sp.text background
In-Reply-To: <AANLkTinfhuDmrCP57+2PrQzEvcomn1G8YUQrPvgjNk7Q@mail.gmail.com>
References: <AANLkTinfhuDmrCP57+2PrQzEvcomn1G8YUQrPvgjNk7Q@mail.gmail.com>
Message-ID: <4CD67749.1020407@geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/5ee98de2/attachment.pl>

From p.hiemstra at geo.uu.nl  Sun Nov  7 11:00:30 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sun, 07 Nov 2010 11:00:30 +0100
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD5602A.70106@geo.uu.nl>
References: <4CD52AC7.6050501@gmail.com>
	<4CD54E2E.8020002@geo.uu.nl>	<4CD557F8.4000309@gmail.com>
	<4CD5602A.70106@geo.uu.nl>
Message-ID: <4CD678BE.8040201@geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/7deb89df/attachment.pl>

From mspinola10 at gmail.com  Sun Nov  7 12:45:25 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 07 Nov 2010 05:45:25 -0600
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD678BE.8040201@geo.uu.nl>
References: <4CD52AC7.6050501@gmail.com>
	<4CD54E2E.8020002@geo.uu.nl>	<4CD557F8.4000309@gmail.com>
	<4CD5602A.70106@geo.uu.nl> <4CD678BE.8040201@geo.uu.nl>
Message-ID: <4CD69155.7040804@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/b08572e5/attachment.pl>

From p.hiemstra at geo.uu.nl  Sun Nov  7 13:46:35 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sun, 07 Nov 2010 13:46:35 +0100
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD69155.7040804@gmail.com>
References: <4CD52AC7.6050501@gmail.com>
	<4CD54E2E.8020002@geo.uu.nl>	<4CD557F8.4000309@gmail.com>
	<4CD5602A.70106@geo.uu.nl> <4CD678BE.8040201@geo.uu.nl>
	<4CD69155.7040804@gmail.com>
Message-ID: <4CD69FAB.7040404@geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/3a3a297c/attachment.pl>

From mspinola10 at gmail.com  Sun Nov  7 14:06:12 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 07 Nov 2010 07:06:12 -0600
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD69FAB.7040404@geo.uu.nl>
References: <4CD52AC7.6050501@gmail.com>
	<4CD54E2E.8020002@geo.uu.nl>	<4CD557F8.4000309@gmail.com>
	<4CD5602A.70106@geo.uu.nl> <4CD678BE.8040201@geo.uu.nl>
	<4CD69155.7040804@gmail.com> <4CD69FAB.7040404@geo.uu.nl>
Message-ID: <4CD6A444.3020109@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/30831708/attachment.pl>

From p.hiemstra at geo.uu.nl  Sun Nov  7 14:03:35 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sun, 07 Nov 2010 14:03:35 +0100
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD6A444.3020109@gmail.com>
References: <4CD52AC7.6050501@gmail.com>
	<4CD54E2E.8020002@geo.uu.nl>	<4CD557F8.4000309@gmail.com>
	<4CD5602A.70106@geo.uu.nl> <4CD678BE.8040201@geo.uu.nl>
	<4CD69155.7040804@gmail.com> <4CD69FAB.7040404@geo.uu.nl>
	<4CD6A444.3020109@gmail.com>
Message-ID: <4CD6A3A7.3050703@geo.uu.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/b3854437/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Nov  7 18:00:00 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 07 Nov 2010 18:00:00 +0100
Subject: [R-sig-Geo] sp.text background
In-Reply-To: <AANLkTinfhuDmrCP57+2PrQzEvcomn1G8YUQrPvgjNk7Q@mail.gmail.com>
References: <AANLkTinfhuDmrCP57+2PrQzEvcomn1G8YUQrPvgjNk7Q@mail.gmail.com>
Message-ID: <4CD6DB10.6070108@uni-muenster.de>

There might be multiple ways of doing this. The following stays in the
realm of using spatial elements, here a rectangular polygon which is
colored white and drawn after the grid map has been drawn.

library(sp)
data(meuse.grid)
gridded(meuse.grid) = ~x+y
x = c(179500,331000)
bx = cbind(c(x[1],x[1]+300,x[1]+300,x[1],x[1]),
    c(x[2],x[2],x[2]+200,x[2]+200,x[2]))
p = SpatialPolygons(list(Polygons(list(Polygon(bx)), "ID")))
spl1 =list("sp.polygons", p, col = 0, fill='white',first=F)
spl2 =list("sp.text", x+150,"hello")
spplot(meuse.grid[3], sp.layout=list(spl1,spl2))


On 11/07/2010 09:02 AM, Alexandru Dumitrescu wrote:
> Dear list,
> 
> For my daily precipitation maps I need to put on the spplot map the first
> maximum tree precipitation values.
> The only space left for that element it overlaps the border of
> a neighboring country.
>  I am wondering if is there a way to add a background to sp.text element; I
> searched
>  through all the sp.text args but I didn?t find a solution for adding a
> colored (white) background.
> 
> 
> Thank you,
> Alexandru Dumitrescu
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mspinola10 at gmail.com  Sun Nov  7 20:29:53 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 07 Nov 2010 13:29:53 -0600
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD6A3A7.3050703@geo.uu.nl>
References: <4CD52AC7.6050501@gmail.com>
	<4CD54E2E.8020002@geo.uu.nl>	<4CD557F8.4000309@gmail.com>
	<4CD5602A.70106@geo.uu.nl> <4CD678BE.8040201@geo.uu.nl>
	<4CD69155.7040804@gmail.com> <4CD69FAB.7040404@geo.uu.nl>
	<4CD6A444.3020109@gmail.com> <4CD6A3A7.3050703@geo.uu.nl>
Message-ID: <4CD6FE31.2060607@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/0f93e1ca/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Nov  7 20:55:20 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 07 Nov 2010 20:55:20 +0100
Subject: [R-sig-Geo] fix color scale
In-Reply-To: <4CCD4594.5030400@geo.uu.nl>
References: <AANLkTikJuBD3tySpX=dwzo0vKX9NAb0Cz2=SdSn6Jr49@mail.gmail.com>
	<4CCD4594.5030400@geo.uu.nl>
Message-ID: <4CD70428.40306@uni-muenster.de>

Paul, this nicely illustrates the power of ggplot2.

In the resulting plot, however, it seems to me that the

+ opts(aspect.ratio = 1)

does not result in the desired effect that 1 m in the x direction equals
1 m in the y direction. Standard plot (asp = 1), and lattice plots (asp
= "iso") have this; what does ggplot2 need?

On 10/31/2010 11:31 AM, Paul Hiemstra wrote:
> Hi Peter,
> 
> When creating such a large amount of illustrations with the same
> colorscale, I automatically think of lattice graphics. Under the hood
> spplot also uses lattice graphics. Take a look at the levelplot()
> function from lattice which produces the grid plots for spplot (if I'm
> correct). Alternatively, I've been using ggplot now for quite a while to
> make plots of a lot of grids. A small example says more than a thousand
> words:
> 
> library(ggplot2)
> library(sp)
> 
> data(meuse.grid)
> summary(meuse.grid)
> 
> # Note that I do not transform meuse.grid to SpatialPixelsDataFrame
> # Let's make a simple grid plot
> dum = meuse.grid[c("x","y","dist")]
> ggplot(aes(x = x, y = y, fill = dist), data = dum) + geom_tile()
> 
> # Let's make a few more attributes to the grid
> # could be measurements on other dates for example
> new_atts = do.call("cbind", lapply(1:100, function(num) dum$dist +
> runif(dum$dist)))
> summary(new_atts)
> dum = data.frame(cbind(dum, new_atts))
> 
> # Important step now is to
> # restructure the data
> dum_ggplot = melt(dum, id.vars = c("x","y"))
> 
> # Now make a plot using dum_ggplot
> # of 'x' and 'y' using value as a 'fill'
> # with a plot per 'variable', can take a minute to plot
> ggplot(aes(x = x, y = y, fill = value), data = dum_ggplot) + geom_tile()
> + facet_wrap(~variable) +
>       scale_x_continuous('', labels = NA, breaks = NA) +
>       scale_y_continuous('', labels = NA, breaks = NA) +
> opts(aspect.ratio = 1)
> # These last two lines get rid of the labels on the axes and set aspect
> ratio to 1
> 
> Now you have a plot with 101 maps with the same colorscale, with ggplot
> doing all the hard work. It takes some time to get the hang of ggplot,
> but I think it is worth the investment, also for spatial plots.
> 
> cheers and hope this helps,
> Paul
> 
> On 10/28/2010 09:12 PM, Peter Larson wrote:
>> Hello!
>>
>> I have a problem.
>>
>> I am using IDW to interpolate a daily series of geospatial
>> observations. Thus, I want to produce a large number of sequential
>> maps.
>>
>> I want them to all represent the same color scale. Is there any way to
>> fix the color scale so that it is the same for all the plots?
>>
>> Thanks,
>>
>> Pete
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>    
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From hadley at rice.edu  Sun Nov  7 21:09:07 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Sun, 7 Nov 2010 14:09:07 -0600
Subject: [R-sig-Geo] fix color scale
In-Reply-To: <4CD70428.40306@uni-muenster.de>
References: <AANLkTikJuBD3tySpX=dwzo0vKX9NAb0Cz2=SdSn6Jr49@mail.gmail.com>
	<4CCD4594.5030400@geo.uu.nl> <4CD70428.40306@uni-muenster.de>
Message-ID: <AANLkTinyQagmQnoFbYWJckZy92NuDWNs4voG1sDZTgkh@mail.gmail.com>

+ coord_equal()

Or if x and y are long and lat, + coord_map()

Hadley

On Sun, Nov 7, 2010 at 1:55 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Paul, this nicely illustrates the power of ggplot2.
>
> In the resulting plot, however, it seems to me that the
>
> + opts(aspect.ratio = 1)
>
> does not result in the desired effect that 1 m in the x direction equals
> 1 m in the y direction. Standard plot (asp = 1), and lattice plots (asp
> = "iso") have this; what does ggplot2 need?
>
> On 10/31/2010 11:31 AM, Paul Hiemstra wrote:
>> Hi Peter,
>>
>> When creating such a large amount of illustrations with the same
>> colorscale, I automatically think of lattice graphics. Under the hood
>> spplot also uses lattice graphics. Take a look at the levelplot()
>> function from lattice which produces the grid plots for spplot (if I'm
>> correct). Alternatively, I've been using ggplot now for quite a while to
>> make plots of a lot of grids. A small example says more than a thousand
>> words:
>>
>> library(ggplot2)
>> library(sp)
>>
>> data(meuse.grid)
>> summary(meuse.grid)
>>
>> # Note that I do not transform meuse.grid to SpatialPixelsDataFrame
>> # Let's make a simple grid plot
>> dum = meuse.grid[c("x","y","dist")]
>> ggplot(aes(x = x, y = y, fill = dist), data = dum) + geom_tile()
>>
>> # Let's make a few more attributes to the grid
>> # could be measurements on other dates for example
>> new_atts = do.call("cbind", lapply(1:100, function(num) dum$dist +
>> runif(dum$dist)))
>> summary(new_atts)
>> dum = data.frame(cbind(dum, new_atts))
>>
>> # Important step now is to
>> # restructure the data
>> dum_ggplot = melt(dum, id.vars = c("x","y"))
>>
>> # Now make a plot using dum_ggplot
>> # of 'x' and 'y' using value as a 'fill'
>> # with a plot per 'variable', can take a minute to plot
>> ggplot(aes(x = x, y = y, fill = value), data = dum_ggplot) + geom_tile()
>> + facet_wrap(~variable) +
>> ? ? ? scale_x_continuous('', labels = NA, breaks = NA) +
>> ? ? ? scale_y_continuous('', labels = NA, breaks = NA) +
>> opts(aspect.ratio = 1)
>> # These last two lines get rid of the labels on the axes and set aspect
>> ratio to 1
>>
>> Now you have a plot with 101 maps with the same colorscale, with ggplot
>> doing all the hard work. It takes some time to get the hang of ggplot,
>> but I think it is worth the investment, also for spatial plots.
>>
>> cheers and hope this helps,
>> Paul
>>
>> On 10/28/2010 09:12 PM, Peter Larson wrote:
>>> Hello!
>>>
>>> I have a problem.
>>>
>>> I am using IDW to interpolate a daily series of geospatial
>>> observations. Thus, I want to produce a large number of sequential
>>> maps.
>>>
>>> I want them to all represent the same color scale. Is there any way to
>>> fix the color scale so that it is the same for all the plots?
>>>
>>> Thanks,
>>>
>>> Pete
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From p.hiemstra at geo.uu.nl  Sun Nov  7 21:14:01 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sun, 7 Nov 2010 21:14:01 +0100
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <4CD6FE31.2060607@gmail.com>
References: <4CD52AC7.6050501@gmail.com> <4CD54E2E.8020002@geo.uu.nl>
	<4CD557F8.4000309@gmail.com> <4CD5602A.70106@geo.uu.nl>
	<4CD678BE.8040201@geo.uu.nl> <4CD69155.7040804@gmail.com>
	<4CD69FAB.7040404@geo.uu.nl> <4CD6A444.3020109@gmail.com>
	<4CD6A3A7.3050703@geo.uu.nl> <4CD6FE31.2060607@gmail.com>
Message-ID: <d71b30e6f98a31af9eb3cccac361f649.squirrel@webmail.geo.uu.nl>

Then take a better look at the export function of QGIS and see what it
spits out. If you do not know what is in the data, how can we help you in
which column to plot. My guess is that the first column is the kriging
prediction, the second the kriging variance and the third the kriging
standard deviation. Primarily because the third column is the square root
of the second.

You could also import the point data into R and do the interpolation
there, which gives you more control over what is happening. It might even
be that QGis uses R (packages gstat+automap) under the hood.

good luck,
Paul

> Honestly Paul, I don't know.  The tif is a result from the kriging in
> Quantum GIS.
> Is very strange, right?
>
> Manuel
>
> On 07/11/2010 07:03 a.m., Paul Hiemstra wrote:
>> So what is in the three bands?
>>
>> Paul
>>
>> On 11/07/2010 02:06 PM, Manuel Sp?nola wrote:
>>> Species richness (from 3 to 20 more or less)
>>>
>>> On 07/11/2010 06:46 a.m., Paul Hiemstra wrote:
>>>> What is the data captured by the tif file?
>>>>
>>>> Paul
>>>>
>>>> On 11/07/2010 12:45 PM, Manuel Sp?nola wrote:
>>>>> Thank you very much Paul.
>>>>>
>>>>> This is the data frame that I created
>>>>>
>>>>> > head(riquezakrig_df)
>>>>>         band1    band2    band3        x       y
>>>>> 269  1.760396 1.620212 1.272875 460590.1 1216391
>>>>> 1686 1.760396 1.620212 1.272875 460540.1 1216341
>>>>> 1687 1.760396 1.620212 1.272875 460590.1 1216341
>>>>> 3103 1.760396 1.620212 1.272875 460490.1 1216291
>>>>> 3104 1.760396 1.620212 1.272875 460540.1 1216291
>>>>> 3105 1.760396 1.620212 1.272875 460590.1 1216291
>>>>>
>>>>>
>>>>> You suggest to make a new column with the color, but I don't
>>>>> understand which information should I provide to the new column.
>>>>>
>>>>> Best,
>>>>>
>>>>> Manuel
>>>>>
>>>>>
>>>>> On 07/11/2010 04:00 a.m., Paul Hiemstra wrote:
>>>>>> Hi Manuel,
>>>>>>
>>>>>> Please do not respond to me alone, include the mailing list in the
>>>>>> cc. You waste the option of someone else answering your question
>>>>>> and the answers are not stored in the archives for other people.
>>>>>>
>>>>>> But back to your question. The tiff file has 3 bands, rgb bands.
>>>>>> Probably the contents in those bands is a number between 0 and
>>>>>> 255, but you do not specify this in your mail. In this case the
>>>>>> tiff file does not contain the 'real' values but is a picture. So
>>>>>> drawing individual bands does not make sense. What you could try
>>>>>> is to construct a new column in the dataset with the color and try
>>>>>> to use in the aes() argument (col = col, where col is the name of
>>>>>> the column with the color).
>>>>>>
>>>>>> cheers,
>>>>>> Paul
>>>>>>
>>>>>>
>>>>>> On 11/06/2010 03:03 PM, Paul Hiemstra wrote:
>>>>>>> Gpplot cannot plot SpatialPixelsDataFrame's in one go. You need to
>>>>>>> convert the grid to a data frame.
>>>>>>>
>>>>>>> An example using the meuse dataset:
>>>>>>>
>>>>>>> library(sp)
>>>>>>> library(ggplot2)
>>>>>>> data(meuse.grid)
>>>>>>> gridded(meuse.grid) = ~x+y
>>>>>>> summary(meuse.grid)
>>>>>>>
>>>>>>> meuse.grid_df = as(meuse.grid, "data.frame")
>>>>>>>
>>>>>>> # Now make a plot with ggplot
>>>>>>> p = ggplot(aes(x = x, y = y, fill = dist), data = meuse.grid_df) +
>>>>>>>     geom_tile()
>>>>>>> print(p)
>>>>>>>
>>>>>>> # Add some tricks specially suitable for
>>>>>>> # spatial plots
>>>>>>> print(p +
>>>>>>>        scale_x_continuous('', labels = NA, breaks = NA) +
>>>>>>>        scale_y_continuous('', labels = NA, breaks = NA) +
>>>>>>>       opts(aspect.ratio = 1, alpha = 0.5))
>>>>>>>
>>>>>>> cheers,
>>>>>>> Paul
>>>>>>>
>>>>>>> On 11/06/2010 02:28 PM, Manuel Sp?nola wrote:
>>>>>>>
>>>>>>>> Thank you very much Paul.
>>>>>>>>
>>>>>>>> With plot I got a black polygon and with spplpot I got:
>>>>>>>>
>>>>>>>>
>>>>>>>>> spplot(riquezakrig)
>>>>>>>>>
>>>>>>>> Error: cannot allocate vector of size 22.6 Mb
>>>>>>>>
>>>>>>>> with image show me what I want but no legend.
>>>>>>>>
>>>>>>>> Any specific geom to plot with ggplot?
>>>>>>>>
>>>>>>>> Best,
>>>>>>>>
>>>>>>>> Manuel
>>>>>>>>
>>>>>>>> On 06/11/2010 06:46 a.m., Paul Hiemstra wrote:
>>>>>>>>
>>>>>>>>> On 11/06/2010 11:15 AM, Manuel Sp?nola wrote:
>>>>>>>>>
>>>>>>>>>> Dear list members,
>>>>>>>>>>
>>>>>>>>>> I read a .tif file with readGDAL.
>>>>>>>>>> What is the best way to display it?.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>> spplot or ggplot
>>>>>>>>>
>>>>>>>>>> I tried function image but there is no legend.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>> true
>>>>>>>>>
>>>>>>>>>> I tried plot and spplot but I couldn't get them to work.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>> why not? What error? What version of R and sp? You're not giving
>>>>>>>>> us
>>>>>>>>> any information that could give us a clue to what's going wrong.
>>>>>>>>>
>>>>>>>>> cheers,
>>>>>>>>> Paul
>>>>>>>>>
>>>>>>>>>> Any help will be appreciated.
>>>>>>>>>>
>>>>>>>>>> Best,
>>>>>>>>>>
>>>>>>>>>> Manuel
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>> --
>>>>>>>>> Drs. Paul Hiemstra
>>>>>>>>> Department of Physical Geography
>>>>>>>>> Faculty of Geosciences
>>>>>>>>> University of Utrecht
>>>>>>>>> Heidelberglaan 2
>>>>>>>>> P.O. Box 80.115
>>>>>>>>> 3508 TC Utrecht
>>>>>>>>> Phone:  +3130 253 5773
>>>>>>>>> http://intamap.geo.uu.nl/~paul
>>>>>>>>> http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770
>>>>>>>>>
>>>>>>>> --
>>>>>>>> *Manuel Sp?nola, Ph.D.*
>>>>>>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>>>>>>> Universidad Nacional
>>>>>>>> Apartado 1350-3000
>>>>>>>> Heredia
>>>>>>>> COSTA RICA
>>>>>>>> mspinola at una.ac.cr
>>>>>>>> mspinola10 at gmail.com
>>>>>>>> Tel?fono: (506) 2277-3598
>>>>>>>> Fax: (506) 2237-7036
>>>>>>>> Personal website: Lobito de r?o
>>>>>>>> <https://sites.google.com/site/lobitoderio/>
>>>>>>>> Institutional website: ICOMVIS<http://www.icomvis.una.ac.cr/>
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Drs. Paul Hiemstra
>>>>>> Department of Physical Geography
>>>>>> Faculty of Geosciences
>>>>>> University of Utrecht
>>>>>> Heidelberglaan 2
>>>>>> P.O. Box 80.115
>>>>>> 3508 TC Utrecht
>>>>>> Phone:  +3130 253 5773
>>>>>> http://intamap.geo.uu.nl/~paul
>>>>>> http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770
>>>>>
>>>>>
>>>>> --
>>>>> *Manuel Sp?nola, Ph.D.*
>>>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>>>> Universidad Nacional
>>>>> Apartado 1350-3000
>>>>> Heredia
>>>>> COSTA RICA
>>>>> mspinola at una.ac.cr
>>>>> mspinola10 at gmail.com
>>>>> Tel?fono: (506) 2277-3598
>>>>> Fax: (506) 2237-7036
>>>>> Personal website: Lobito de r?o
>>>>> <https://sites.google.com/site/lobitoderio/>
>>>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>>>
>>>>
>>>> --
>>>> Drs. Paul Hiemstra
>>>> Department of Physical Geography
>>>> Faculty of Geosciences
>>>> University of Utrecht
>>>> Heidelberglaan 2
>>>> P.O. Box 80.115
>>>> 3508 TC Utrecht
>>>> Phone:  +3130 253 5773
>>>> http://intamap.geo.uu.nl/~paul
>>>> http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770
>>>
>>>
>>> --
>>> *Manuel Sp?nola, Ph.D.*
>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>> Universidad Nacional
>>> Apartado 1350-3000
>>> Heredia
>>> COSTA RICA
>>> mspinola at una.ac.cr
>>> mspinola10 at gmail.com
>>> Tel?fono: (506) 2277-3598
>>> Fax: (506) 2237-7036
>>> Personal website: Lobito de r?o
>>> <https://sites.google.com/site/lobitoderio/>
>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>
>>
>> --
>> Drs. Paul Hiemstra
>> Department of Physical Geography
>> Faculty of Geosciences
>> University of Utrecht
>> Heidelberglaan 2
>> P.O. Box 80.115
>> 3508 TC Utrecht
>> Phone:  +3130 253 5773
>> http://intamap.geo.uu.nl/~paul
>> http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>


From matevz.pavlic at gi-zrmk.si  Sun Nov  7 22:49:03 2010
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Sun, 7 Nov 2010 22:49:03 +0100
Subject: [R-sig-Geo] multiple regression analysis
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B9EB5101@gi-zrmk.si>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/cd93a20b/attachment.pl>

From mspinola10 at gmail.com  Sun Nov  7 23:58:28 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 07 Nov 2010 16:58:28 -0600
Subject: [R-sig-Geo] Error with krige function
Message-ID: <4CD72F14.6010706@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/ec9e8104/attachment.pl>

From zenlines at gmail.com  Mon Nov  8 01:40:45 2010
From: zenlines at gmail.com (Brian Oney)
Date: Mon, 08 Nov 2010 01:40:45 +0100
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
Message-ID: <4CD7470D.1080203@gmail.com>

Hello All,

I am attempting to reproduce the bioclimatic (Worldclim, Hijmans et al
2005) variables with the raster package and I am stuck on the group
"temp of driest quarter" etc. variables.
I am attempting it with the function "overlay" ("raster" package).

Here is how it looks:
# To know the first month of the wettest quarter
maxmonth<- function(a,b,d,e,f,g,i,j,k,l,m,n){
                     o<- sum(c(a,b,d))
                     p<- sum(c(b,d,e))
                     r<- sum(c(d,e,f))
                     u<- sum(c(e,f,g))
                     v<- sum(c(f,g,i))
                     w<- sum(c(g,i,j))
                     x<- sum(c(i,j,k))
                     y<- sum(c(j,k,l))
                     z<- sum(c(k,l,m))
                     aa<- sum(c(l,m,n))
                     ab<- sum(c(m,n,a))
                     ac<- sum(c(n,a,b))
                     ad<- which.max(c(o,p,r,u,v,w,x,y,z,aa,ab,ac))
                     return(ad)}
>  maxmonth(a=13,b=16,d=41,e=61,f=41,g=16,i=15,j=14,k=13,l=11,m=31,n=11)
# works: 2nd element (month) is the beginning of the wettest quarter
[1] 2
mon_stac<- stack(paste(pc_clim,"",y,"_prec",1:12,".asc", sep=""))
# Now attempt it
avg<- overlay(mon_stac, fun=maxmonth)
Error in .overlayList(rasters, fun = fun, filename = filename, ...) :
   cannot use this formula; lenghts do not match

# How about manually?
a<- raster(paste(pc_clim,"",y,"_prec",1,".asc", sep=""))
b<- raster(paste(pc_clim,"",y,"_prec",2,".asc", sep=""))
d<- raster(paste(pc_clim,"",y,"_prec",3,".asc", sep=""))
e<- raster(paste(pc_clim,"",y,"_prec",4,".asc", sep=""))
f<- raster(paste(pc_clim,"",y,"_prec",5,".asc", sep=""))
g<- raster(paste(pc_clim,"",y,"_prec",6,".asc", sep=""))
i<- raster(paste(pc_clim,"",y,"_prec",7,".asc", sep=""))
j<- raster(paste(pc_clim,"",y,"_prec",8,".asc", sep=""))
k<- raster(paste(pc_clim,"",y,"_prec",9,".asc", sep=""))
l<- raster(paste(pc_clim,"",y,"_prec",10,".asc", sep=""))
m<- raster(paste(pc_clim,"",y,"_prec",11,".asc", sep=""))
n<- raster(paste(pc_clim,"",y,"_prec",12,".asc", sep=""))

avg<- overlay(a,b,d,e,f,g,i,j,k,l,m,n, fun=maxmonth)
Error in .overlayList(rasters, fun = fun, filename = filename, datatype
= datatype,  :
   cannot use this formula; lenghts do not match

Also doesn't work...
>  length(mon_stac[1])
[1] 12
I have 12 rasters being fed into overlay, but it won't buy it.
I think that my first step is to know the first month of the wettest
month. Once I can do that I can do it for temperature as well.

Thanks and Regards,
Brian


From mspinola10 at gmail.com  Mon Nov  8 02:50:41 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 07 Nov 2010 19:50:41 -0600
Subject: [R-sig-Geo] Plotting a tif file
In-Reply-To: <d71b30e6f98a31af9eb3cccac361f649.squirrel@webmail.geo.uu.nl>
References: <4CD52AC7.6050501@gmail.com> <4CD54E2E.8020002@geo.uu.nl>
	<4CD557F8.4000309@gmail.com> <4CD5602A.70106@geo.uu.nl>
	<4CD678BE.8040201@geo.uu.nl> <4CD69155.7040804@gmail.com>
	<4CD69FAB.7040404@geo.uu.nl> <4CD6A444.3020109@gmail.com>
	<4CD6A3A7.3050703@geo.uu.nl> <4CD6FE31.2060607@gmail.com>
	<d71b30e6f98a31af9eb3cccac361f649.squirrel@webmail.geo.uu.nl>
Message-ID: <4CD75771.7030706@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101107/45a2c1ee/attachment.pl>

From matzke at berkeley.edu  Mon Nov  8 04:13:31 2010
From: matzke at berkeley.edu (Nick Matzke)
Date: Sun, 07 Nov 2010 19:13:31 -0800
Subject: [R-sig-Geo] adding points to spplot grid
In-Reply-To: <4CD527EE.7000107@uni-muenster.de>
References: <4CD4A32F.9080306@berkeley.edu> <4CD527EE.7000107@uni-muenster.de>
Message-ID: <4CD76ADB.4080200@berkeley.edu>

On 11/6/10 3:03 AM, Edzer Pebesma wrote:
 >
 >
 > On 11/06/2010 01:37 AM, Nick Matzke wrote:
 >> Hi,
 >>
 >> I have been working with spplot.  I can get continuous 
grids to plot
 >> with spplot, but what do I do if I want to plot some 
points with x,y
 >> coordinates on top of the image?
 >>
 >> Cheers!
 >> Nick
 >>
 >>
 > http://r-spatial.sourceforge.net/gallery/


Thanks! This helped although it took some digging.  For 
others with this question:

=================================
# I start with some (randomly generated for now)
# * TRUE/FALSE values (samp_hits)
# * x & y columns giving sample locations (sample_locs)

# generate the tmpdata for species #1 (samp_hits, column #1)
tmpdata = as.data.frame(cbind(sample_locs[,1], 
sample_locs[,2], samp_hits[,1]))

names(tmpdata) = c("x", "y", "sp1")
coordinates(tmpdata) = ~x+y
# set projection to lon (x) & lat (y), i.e. unprojected;
# find projections with Terminal: proj -lp
proj4string(tmpdata) = CRS("lonlat")

hits = tmpdata[tmpdata$sp1 == 1, ]
misses = tmpdata[tmpdata$sp1 == 0, ]


#plot points for kicks
plot(0,0, xlim=minmax_literal(sample_locs[, 1]), 
ylim=minmax_literal(sample_locs[, 2]) )

points(hits, col="blue", pch=19)
points(misses, col="blue", pch=1)


# Make variogram

default_vgm = vgm(0.15, "Exp", 80, 0)
gs = gstat(id="sp001", formula=sp1~1, data=tmpdata, beta = 
0.1,  model=default_vgm)
vg = variogram(gs)
plot(vg)


# Make a tmpgrid
xs=xmin:xmax
ys=ymin:ymax

# use expand.grid to make all possible combinations of inputs
tmpgrid = expand.grid(xs, ys)
names(tmpgrid) = c("x", "y")
gridded(tmpgrid) = ~x+y
# set projection to lon (x) & lat (y), i.e. unprojected;
# find projections with Terminal: proj -lp
proj4string(tmpgrid) = CRS("lonlat")



# Fit a variogram model to the empirical variogram
# for single variogram
sp1_vgm = fit.variogram(vg, model=default_vgm)

plot(vg, model=default_vgm)
plot(vg, model=sp1_vgm)

# simple kriging
sk = krige(sp1~1, tmpdata, tmpgrid, sp1_vgm, nsim=0, 
indicators = TRUE, nmax = 40)

# plot the result
print(spplot(sk, cuts=1, col.regions=grey.colors(2, 0.6, 
0.90, 2.2)))
print(spplot(sk))


alphaChannelSupported = function()
	{
	!is.na(match(names(dev.cur()), c("pdf")))
	}

spplot_hits = list("sp.points", hits, pch=19, col="black", 
alpha = ifelse(alphaChannelSupported(), .5, 1))
spplot_misses = list("sp.points", misses, pch=21, cex=0.75, 
col="black", alpha = ifelse(alphaChannelSupported(), .5, 1))

# col.regions does color scale for grid
# sp.layout contains a list of the various points, text, 
etc. to plot
# at=seq() does limits of the color bar
spplot(sk["var1.pred"], scales=list(draw = TRUE), 
col.regions=rev(rainbow(100)[1:75]), 
sp.layout=list(spplot_hits, spplot_misses), at=seq(0, 1, 1/75))

=================================





-- 
====================================================
Nicholas J. Matzke
Ph.D. Candidate, Graduate Student Researcher
Huelsenbeck Lab
Center for Theoretical Evolutionary Genomics
4151 VLSB (Valley Life Sciences Building)
Department of Integrative Biology
University of California, Berkeley

Graduate Student Instructor, IB200A
Principles of Phylogenetics: Systematics
http://ib.berkeley.edu/courses/ib200a/index.shtml

Lab websites:
http://ib.berkeley.edu/people/lab_detail.php?lab=54
http://fisher.berkeley.edu/cteg/hlab.html
Dept. personal page: 
http://ib.berkeley.edu/people/students/person_detail.php?person=370
Lab personal page: 
http://fisher.berkeley.edu/cteg/members/matzke.html
Lab phone: 510-643-6299
Dept. fax: 510-643-6264
Cell phone: 510-301-0179
Email: matzke at berkeley.edu

Mailing address:
Department of Integrative Biology
3060 VLSB #3140
Berkeley, CA 94720-3140

-----------------------------------------------------
"[W]hen people thought the earth was flat, they were wrong. 
When people thought the earth was spherical, they were 
wrong. But if you think that thinking the earth is spherical 
is just as wrong as thinking the earth is flat, then your 
view is wronger than both of them put together."

Isaac Asimov (1989). "The Relativity of Wrong." The 
Skeptical Inquirer, 14(1), 35-44. Fall 1989.
http://chem.tufts.edu/AnswersInScience/RelativityofWrong.htm


From dylan.beaudette at gmail.com  Mon Nov  8 05:00:21 2010
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Sun, 7 Nov 2010 20:00:21 -0800
Subject: [R-sig-Geo] fix color scale
In-Reply-To: <4CD70428.40306@uni-muenster.de>
References: <AANLkTikJuBD3tySpX=dwzo0vKX9NAb0Cz2=SdSn6Jr49@mail.gmail.com>
	<4CCD4594.5030400@geo.uu.nl> <4CD70428.40306@uni-muenster.de>
Message-ID: <AANLkTin0qviF3pKdUa4PgJJyrZd1Z88dROdf7ZihUV3w@mail.gmail.com>

Interesting demonstration. However, it seems like sp objects and
spplot are still more efficient at storing / plotting large grids. The
example listed below required over 2 minutes to complete on a 2.4 Ghz
Intel processor. Also, storing the coordinates + data in long format
could easily fill available memory with large rasters. I have found
that storing multiple raster attributes as columns in the @data slot
of a SpatialGridDataFrame object give me flexibility to plot images
with a consistent color scheme, without needing to store the data in
long format. Also with lattice, the plots are generated in a couple of
seconds (500x700 px grid). I would be very interested in knowing how
to make ggplot() any faster.

Cheers!
Dylan

On Sun, Nov 7, 2010 at 11:55 AM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Paul, this nicely illustrates the power of ggplot2.
>
> In the resulting plot, however, it seems to me that the
>
> + opts(aspect.ratio = 1)
>
> does not result in the desired effect that 1 m in the x direction equals
> 1 m in the y direction. Standard plot (asp = 1), and lattice plots (asp
> = "iso") have this; what does ggplot2 need?
>
> On 10/31/2010 11:31 AM, Paul Hiemstra wrote:
>> Hi Peter,
>>
>> When creating such a large amount of illustrations with the same
>> colorscale, I automatically think of lattice graphics. Under the hood
>> spplot also uses lattice graphics. Take a look at the levelplot()
>> function from lattice which produces the grid plots for spplot (if I'm
>> correct). Alternatively, I've been using ggplot now for quite a while to
>> make plots of a lot of grids. A small example says more than a thousand
>> words:
>>
>> library(ggplot2)
>> library(sp)
>>
>> data(meuse.grid)
>> summary(meuse.grid)
>>
>> # Note that I do not transform meuse.grid to SpatialPixelsDataFrame
>> # Let's make a simple grid plot
>> dum = meuse.grid[c("x","y","dist")]
>> ggplot(aes(x = x, y = y, fill = dist), data = dum) + geom_tile()
>>
>> # Let's make a few more attributes to the grid
>> # could be measurements on other dates for example
>> new_atts = do.call("cbind", lapply(1:100, function(num) dum$dist +
>> runif(dum$dist)))
>> summary(new_atts)
>> dum = data.frame(cbind(dum, new_atts))
>>
>> # Important step now is to
>> # restructure the data
>> dum_ggplot = melt(dum, id.vars = c("x","y"))
>>
>> # Now make a plot using dum_ggplot
>> # of 'x' and 'y' using value as a 'fill'
>> # with a plot per 'variable', can take a minute to plot
>> ggplot(aes(x = x, y = y, fill = value), data = dum_ggplot) + geom_tile()
>> + facet_wrap(~variable) +
>> ? ? ? scale_x_continuous('', labels = NA, breaks = NA) +
>> ? ? ? scale_y_continuous('', labels = NA, breaks = NA) +
>> opts(aspect.ratio = 1)
>> # These last two lines get rid of the labels on the axes and set aspect
>> ratio to 1
>>
>> Now you have a plot with 101 maps with the same colorscale, with ggplot
>> doing all the hard work. It takes some time to get the hang of ggplot,
>> but I think it is worth the investment, also for spatial plots.
>>
>> cheers and hope this helps,
>> Paul
>>
>> On 10/28/2010 09:12 PM, Peter Larson wrote:
>>> Hello!
>>>
>>> I have a problem.
>>>
>>> I am using IDW to interpolate a daily series of geospatial
>>> observations. Thus, I want to produce a large number of sequential
>>> maps.
>>>
>>> I want them to all represent the same color scale. Is there any way to
>>> fix the color scale so that it is the same for all the plots?
>>>
>>> Thanks,
>>>
>>> Pete
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From govindas at msu.edu  Mon Nov  8 07:20:04 2010
From: govindas at msu.edu (govindas at msu.edu)
Date: Mon, 08 Nov 2010 01:20:04 -0500
Subject: [R-sig-Geo] prob with legend in my plots!
In-Reply-To: <9817BBA3-802B-4678-8402-E0F85355EAB8@remoteinformation.com.au>
References: <20101105185846.120825am1r4o0t9i@mail.msu.edu>
	<9817BBA3-802B-4678-8402-E0F85355EAB8@remoteinformation.com.au>
Message-ID: <20101108012004.14048uvq6wc37b10@mail.msu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/4f552aa8/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Nov  8 07:53:25 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 08 Nov 2010 07:53:25 +0100
Subject: [R-sig-Geo] fix color scale
In-Reply-To: <AANLkTin0qviF3pKdUa4PgJJyrZd1Z88dROdf7ZihUV3w@mail.gmail.com>
References: <AANLkTikJuBD3tySpX=dwzo0vKX9NAb0Cz2=SdSn6Jr49@mail.gmail.com>	<4CCD4594.5030400@geo.uu.nl>	<4CD70428.40306@uni-muenster.de>
	<AANLkTin0qviF3pKdUa4PgJJyrZd1Z88dROdf7ZihUV3w@mail.gmail.com>
Message-ID: <4CD79E65.3090401@uni-muenster.de>

Dylan, I believe that lattice (grid) recently improved the plotting of
rasters quite a bit, by using panel.levelplot.raster instead of
panel.levelplot - some function in grid now renders rasters faster on
devices for which this is optimed.

spplot also has to transform the data to long format, by calling
sp:::spmap.to.lev, which in turn uses a stack method for
SpatialPointsDataFrame objects; this in turn uses stack.data.frame

Bests,


On 11/08/2010 05:00 AM, Dylan Beaudette wrote:
> Interesting demonstration. However, it seems like sp objects and
> spplot are still more efficient at storing / plotting large grids. The
> example listed below required over 2 minutes to complete on a 2.4 Ghz
> Intel processor. Also, storing the coordinates + data in long format
> could easily fill available memory with large rasters. I have found
> that storing multiple raster attributes as columns in the @data slot
> of a SpatialGridDataFrame object give me flexibility to plot images
> with a consistent color scheme, without needing to store the data in
> long format. Also with lattice, the plots are generated in a couple of
> seconds (500x700 px grid). I would be very interested in knowing how
> to make ggplot() any faster.
> 
> Cheers!
> Dylan
> 
> On Sun, Nov 7, 2010 at 11:55 AM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
>> Paul, this nicely illustrates the power of ggplot2.
>>
>> In the resulting plot, however, it seems to me that the
>>
>> + opts(aspect.ratio = 1)
>>
>> does not result in the desired effect that 1 m in the x direction equals
>> 1 m in the y direction. Standard plot (asp = 1), and lattice plots (asp
>> = "iso") have this; what does ggplot2 need?
>>
>> On 10/31/2010 11:31 AM, Paul Hiemstra wrote:
>>> Hi Peter,
>>>
>>> When creating such a large amount of illustrations with the same
>>> colorscale, I automatically think of lattice graphics. Under the hood
>>> spplot also uses lattice graphics. Take a look at the levelplot()
>>> function from lattice which produces the grid plots for spplot (if I'm
>>> correct). Alternatively, I've been using ggplot now for quite a while to
>>> make plots of a lot of grids. A small example says more than a thousand
>>> words:
>>>
>>> library(ggplot2)
>>> library(sp)
>>>
>>> data(meuse.grid)
>>> summary(meuse.grid)
>>>
>>> # Note that I do not transform meuse.grid to SpatialPixelsDataFrame
>>> # Let's make a simple grid plot
>>> dum = meuse.grid[c("x","y","dist")]
>>> ggplot(aes(x = x, y = y, fill = dist), data = dum) + geom_tile()
>>>
>>> # Let's make a few more attributes to the grid
>>> # could be measurements on other dates for example
>>> new_atts = do.call("cbind", lapply(1:100, function(num) dum$dist +
>>> runif(dum$dist)))
>>> summary(new_atts)
>>> dum = data.frame(cbind(dum, new_atts))
>>>
>>> # Important step now is to
>>> # restructure the data
>>> dum_ggplot = melt(dum, id.vars = c("x","y"))
>>>
>>> # Now make a plot using dum_ggplot
>>> # of 'x' and 'y' using value as a 'fill'
>>> # with a plot per 'variable', can take a minute to plot
>>> ggplot(aes(x = x, y = y, fill = value), data = dum_ggplot) + geom_tile()
>>> + facet_wrap(~variable) +
>>>       scale_x_continuous('', labels = NA, breaks = NA) +
>>>       scale_y_continuous('', labels = NA, breaks = NA) +
>>> opts(aspect.ratio = 1)
>>> # These last two lines get rid of the labels on the axes and set aspect
>>> ratio to 1
>>>
>>> Now you have a plot with 101 maps with the same colorscale, with ggplot
>>> doing all the hard work. It takes some time to get the hang of ggplot,
>>> but I think it is worth the investment, also for spatial plots.
>>>
>>> cheers and hope this helps,
>>> Paul
>>>
>>> On 10/28/2010 09:12 PM, Peter Larson wrote:
>>>> Hello!
>>>>
>>>> I have a problem.
>>>>
>>>> I am using IDW to interpolate a daily series of geospatial
>>>> observations. Thus, I want to produce a large number of sequential
>>>> maps.
>>>>
>>>> I want them to all represent the same color scale. Is there any way to
>>>> fix the color scale so that it is the same for all the plots?
>>>>
>>>> Thanks,
>>>>
>>>> Pete
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Mon Nov  8 07:55:36 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 08 Nov 2010 07:55:36 +0100
Subject: [R-sig-Geo] Error with krige function
In-Reply-To: <4CD72F14.6010706@gmail.com>
References: <4CD72F14.6010706@gmail.com>
Message-ID: <4CD79EE8.9020003@uni-muenster.de>



On 11/07/2010 11:58 PM, Manuel Sp?nola wrote:
> Dear list members,
> 
> I got this error when running function krige:
> 
> rich.vgm = variogram(N ~ 1, data = rich)
> 
> rich.fit = fit.variogram(rich.vgm, model = vgm(8.8, "Ste", 0.003))
> 
>  > rich.kriged = krige(N~1, rich, as(r, "SpatialGridDataFrame"), model = 
> rich.fit)
> Error in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  :
>    var1 : data item in gstat object and newdata have different 
> coordinate reference systems
> 

First thing I would do after seeing this error message is to compare
their respective projections:

proj4string(rich)
proj4string(as(r, "SpatialGridDataFrame"))

as krige apparently would like these two to be identical.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matevz.pavlic at gi-zrmk.si  Mon Nov  8 08:24:38 2010
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Mon, 8 Nov 2010 08:24:38 +0100
Subject: [R-sig-Geo] multiple regression analysis
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B9EB5115@gi-zrmk.si>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/cd5ca51f/attachment.pl>

From mdsumner at gmail.com  Mon Nov  8 09:34:30 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 8 Nov 2010 19:34:30 +1100
Subject: [R-sig-Geo] fix color scale
In-Reply-To: <4CD79E65.3090401@uni-muenster.de>
References: <AANLkTikJuBD3tySpX=dwzo0vKX9NAb0Cz2=SdSn6Jr49@mail.gmail.com>
	<4CCD4594.5030400@geo.uu.nl> <4CD70428.40306@uni-muenster.de>
	<AANLkTin0qviF3pKdUa4PgJJyrZd1Z88dROdf7ZihUV3w@mail.gmail.com>
	<4CD79E65.3090401@uni-muenster.de>
Message-ID: <AANLkTinzXTisHZD=cGXD7icXF=K4iq59PkgA6boBA9Fx@mail.gmail.com>

To add to Edzer's answer, I had written this earlier - I just don't
know anything about the way grid/lattice can handle rasters.

The image/grid handling with sp/raster can be fast for two main reasons:

- image.SpatialGridDataFrame now can use rasterImage() to plot grids,
so the graphics-memory footprint is minimized, though the full grid is
still in R memory

- the raster package adds memory-management for grids, reading only
what is required on demand for plotting - I think raster still uses
image() for plotting, but it's only ever reading the required data for
a given level of detail, saving the graphics engine from the full
overhead demanded by image()

Those are good improvements that both provide different implications
for grid/lattice and thereby ggplot images.

Cheers, Mike.

On Mon, Nov 8, 2010 at 5:53 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> Dylan, I believe that lattice (grid) recently improved the plotting of
> rasters quite a bit, by using panel.levelplot.raster instead of
> panel.levelplot - some function in grid now renders rasters faster on
> devices for which this is optimed.
>
> spplot also has to transform the data to long format, by calling
> sp:::spmap.to.lev, which in turn uses a stack method for
> SpatialPointsDataFrame objects; this in turn uses stack.data.frame
>
> Bests,
>
>
> On 11/08/2010 05:00 AM, Dylan Beaudette wrote:
>> Interesting demonstration. However, it seems like sp objects and
>> spplot are still more efficient at storing / plotting large grids. The
>> example listed below required over 2 minutes to complete on a 2.4 Ghz
>> Intel processor. Also, storing the coordinates + data in long format
>> could easily fill available memory with large rasters. I have found
>> that storing multiple raster attributes as columns in the @data slot
>> of a SpatialGridDataFrame object give me flexibility to plot images
>> with a consistent color scheme, without needing to store the data in
>> long format. Also with lattice, the plots are generated in a couple of
>> seconds (500x700 px grid). I would be very interested in knowing how
>> to make ggplot() any faster.
>>
>> Cheers!
>> Dylan
>>
>> On Sun, Nov 7, 2010 at 11:55 AM, Edzer Pebesma
>> <edzer.pebesma at uni-muenster.de> wrote:
>>> Paul, this nicely illustrates the power of ggplot2.
>>>
>>> In the resulting plot, however, it seems to me that the
>>>
>>> + opts(aspect.ratio = 1)
>>>
>>> does not result in the desired effect that 1 m in the x direction equals
>>> 1 m in the y direction. Standard plot (asp = 1), and lattice plots (asp
>>> = "iso") have this; what does ggplot2 need?
>>>
>>> On 10/31/2010 11:31 AM, Paul Hiemstra wrote:
>>>> Hi Peter,
>>>>
>>>> When creating such a large amount of illustrations with the same
>>>> colorscale, I automatically think of lattice graphics. Under the hood
>>>> spplot also uses lattice graphics. Take a look at the levelplot()
>>>> function from lattice which produces the grid plots for spplot (if I'm
>>>> correct). Alternatively, I've been using ggplot now for quite a while to
>>>> make plots of a lot of grids. A small example says more than a thousand
>>>> words:
>>>>
>>>> library(ggplot2)
>>>> library(sp)
>>>>
>>>> data(meuse.grid)
>>>> summary(meuse.grid)
>>>>
>>>> # Note that I do not transform meuse.grid to SpatialPixelsDataFrame
>>>> # Let's make a simple grid plot
>>>> dum = meuse.grid[c("x","y","dist")]
>>>> ggplot(aes(x = x, y = y, fill = dist), data = dum) + geom_tile()
>>>>
>>>> # Let's make a few more attributes to the grid
>>>> # could be measurements on other dates for example
>>>> new_atts = do.call("cbind", lapply(1:100, function(num) dum$dist +
>>>> runif(dum$dist)))
>>>> summary(new_atts)
>>>> dum = data.frame(cbind(dum, new_atts))
>>>>
>>>> # Important step now is to
>>>> # restructure the data
>>>> dum_ggplot = melt(dum, id.vars = c("x","y"))
>>>>
>>>> # Now make a plot using dum_ggplot
>>>> # of 'x' and 'y' using value as a 'fill'
>>>> # with a plot per 'variable', can take a minute to plot
>>>> ggplot(aes(x = x, y = y, fill = value), data = dum_ggplot) + geom_tile()
>>>> + facet_wrap(~variable) +
>>>> ? ? ? scale_x_continuous('', labels = NA, breaks = NA) +
>>>> ? ? ? scale_y_continuous('', labels = NA, breaks = NA) +
>>>> opts(aspect.ratio = 1)
>>>> # These last two lines get rid of the labels on the axes and set aspect
>>>> ratio to 1
>>>>
>>>> Now you have a plot with 101 maps with the same colorscale, with ggplot
>>>> doing all the hard work. It takes some time to get the hang of ggplot,
>>>> but I think it is worth the investment, also for spatial plots.
>>>>
>>>> cheers and hope this helps,
>>>> Paul
>>>>
>>>> On 10/28/2010 09:12 PM, Peter Larson wrote:
>>>>> Hello!
>>>>>
>>>>> I have a problem.
>>>>>
>>>>> I am using IDW to interpolate a daily series of geospatial
>>>>> observations. Thus, I want to produce a large number of sequential
>>>>> maps.
>>>>>
>>>>> I want them to all represent the same color scale. Is there any way to
>>>>> fix the color scale so that it is the same for all the plots?
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Pete
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>>
>>>
>>> --
>>> Edzer Pebesma
>>> Institute for Geoinformatics (ifgi), University of M?nster
>>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>>> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
>>> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From jacobvanetten at yahoo.com  Mon Nov  8 10:59:29 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Mon, 8 Nov 2010 09:59:29 +0000 (GMT)
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <4CD7470D.1080203@gmail.com>
Message-ID: <12350.54329.qm@web29716.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/339ac86e/attachment.pl>

From lists at remoteinformation.com.au  Mon Nov  8 12:17:06 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Mon, 8 Nov 2010 22:17:06 +1100
Subject: [R-sig-Geo] prob with legend in my plots!
In-Reply-To: <20101108012004.14048uvq6wc37b10@mail.msu.edu>
References: <20101105185846.120825am1r4o0t9i@mail.msu.edu>
	<9817BBA3-802B-4678-8402-E0F85355EAB8@remoteinformation.com.au>
	<20101108012004.14048uvq6wc37b10@mail.msu.edu>
Message-ID: <EF364035-CCBD-43C4-AA21-C6697DBC13DF@remoteinformation.com.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/b8987435/attachment.pl>

From mspinola10 at gmail.com  Mon Nov  8 14:48:54 2010
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Mon, 08 Nov 2010 07:48:54 -0600
Subject: [R-sig-Geo] Error with krige function
In-Reply-To: <4CD79EE8.9020003@uni-muenster.de>
References: <4CD72F14.6010706@gmail.com> <4CD79EE8.9020003@uni-muenster.de>
Message-ID: <4CD7FFC6.6030704@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/ba382dba/attachment.pl>

From zenlines at gmail.com  Mon Nov  8 14:48:27 2010
From: zenlines at gmail.com (Brian Oney)
Date: Mon, 08 Nov 2010 14:48:27 +0100
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <12350.54329.qm@web29716.mail.ird.yahoo.com>
References: <12350.54329.qm@web29716.mail.ird.yahoo.com>
Message-ID: <4CD7FFAB.7010408@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/d6d40023/attachment.pl>

From jacobvanetten at yahoo.com  Mon Nov  8 16:58:01 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Mon, 8 Nov 2010 15:58:01 +0000 (GMT)
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <4CD7FFAB.7010408@gmail.com>
Message-ID: <665110.4693.qm@web29701.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/2de933a5/attachment.pl>

From ricsouzabh at yahoo.com.br  Mon Nov  8 16:59:58 2010
From: ricsouzabh at yahoo.com.br (ricardo souza)
Date: Mon, 8 Nov 2010 07:59:58 -0800 (PST)
Subject: [R-sig-Geo] [R-sig-Debian] R memory allocation in Linux
In-Reply-To: <AANLkTimqozFG15DkC0DwDHy+0yoW63yGWopsQ8bWRMGf@mail.gmail.com>
Message-ID: <113281.49452.qm@web57311.mail.re1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/d8c99859/attachment.pl>

From jacobvanetten at yahoo.com  Mon Nov  8 17:44:46 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Mon, 8 Nov 2010 16:44:46 +0000 (GMT)
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <665110.4693.qm@web29701.mail.ird.yahoo.com>
Message-ID: <201402.90430.qm@web29708.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101108/3d877ab8/attachment.pl>

From r.hijmans at gmail.com  Mon Nov  8 17:46:51 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 8 Nov 2010 08:46:51 -0800
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <4CD7470D.1080203@gmail.com>
References: <4CD7470D.1080203@gmail.com>
Message-ID: <AANLkTikkdNR0JKGQ6=3LLGVDNZatxc9ZB76FzTBF6g_Y@mail.gmail.com>

Brian,

The problem is that the the function needs to be either vectorized
(return a vector when the input consists of vectors), or appropriate
for apply (e.g. 'max'). I shall make this clearer in the help file.

You could make your function work by doing

 o<- a + b + d
 p<- b + d + e
 etc.
?ad <- calc(stack(o,p,r,u,v,w,x,y,z,aa,ab,ac), fun= which.max)
 return(ad)

or avoid the overlay function: and use map algebra

 o<- sum(a,b,d)
 p<- sum(b,d,e)
 r<- sum(d,e,f)
etc.
 s <- stack(o,p,r,u,v,w,x,y,z,aa,ab,ac)
 x <- calc(s, which.max)

Finally, the computation of bioclimatic variables has been implemented
(but not extensively tested; please provide feedback if you use it) in
the 'biovars' function in the 'dismo' package.

see
getMethod(biovars, c('Raster', 'Raster', 'Raster'))
getMethod(biovars, c('matrix', 'matrix', 'matrix'))

for its implenentation

Robert


On Sun, Nov 7, 2010 at 4:40 PM, Brian Oney <zenlines at gmail.com> wrote:
> Hello All,
>
> I am attempting to reproduce the bioclimatic (Worldclim, Hijmans et al
> 2005) variables with the raster package and I am stuck on the group
> "temp of driest quarter" etc. variables.
> I am attempting it with the function "overlay" ("raster" package).
>
> Here is how it looks:
> # To know the first month of the wettest quarter
> maxmonth<- function(a,b,d,e,f,g,i,j,k,l,m,n){
> ? ? ? ? ? ? ? ? ? ?o<- sum(c(a,b,d))
> ? ? ? ? ? ? ? ? ? ?p<- sum(c(b,d,e))
> ? ? ? ? ? ? ? ? ? ?r<- sum(c(d,e,f))
> ? ? ? ? ? ? ? ? ? ?u<- sum(c(e,f,g))
> ? ? ? ? ? ? ? ? ? ?v<- sum(c(f,g,i))
> ? ? ? ? ? ? ? ? ? ?w<- sum(c(g,i,j))
> ? ? ? ? ? ? ? ? ? ?x<- sum(c(i,j,k))
> ? ? ? ? ? ? ? ? ? ?y<- sum(c(j,k,l))
> ? ? ? ? ? ? ? ? ? ?z<- sum(c(k,l,m))
> ? ? ? ? ? ? ? ? ? ?aa<- sum(c(l,m,n))
> ? ? ? ? ? ? ? ? ? ?ab<- sum(c(m,n,a))
> ? ? ? ? ? ? ? ? ? ?ac<- sum(c(n,a,b))
> ? ? ? ? ? ? ? ? ? ?ad<- which.max(c(o,p,r,u,v,w,x,y,z,aa,ab,ac))
> ? ? ? ? ? ? ? ? ? ?return(ad)}
>>
>> ?maxmonth(a=13,b=16,d=41,e=61,f=41,g=16,i=15,j=14,k=13,l=11,m=31,n=11)
>
> # works: 2nd element (month) is the beginning of the wettest quarter
> [1] 2
> mon_stac<- stack(paste(pc_clim,"",y,"_prec",1:12,".asc", sep=""))
> # Now attempt it
> avg<- overlay(mon_stac, fun=maxmonth)
> Error in .overlayList(rasters, fun = fun, filename = filename, ...) :
> ?cannot use this formula; lenghts do not match
>
> # How about manually?
> a<- raster(paste(pc_clim,"",y,"_prec",1,".asc", sep=""))
> b<- raster(paste(pc_clim,"",y,"_prec",2,".asc", sep=""))
> d<- raster(paste(pc_clim,"",y,"_prec",3,".asc", sep=""))
> e<- raster(paste(pc_clim,"",y,"_prec",4,".asc", sep=""))
> f<- raster(paste(pc_clim,"",y,"_prec",5,".asc", sep=""))
> g<- raster(paste(pc_clim,"",y,"_prec",6,".asc", sep=""))
> i<- raster(paste(pc_clim,"",y,"_prec",7,".asc", sep=""))
> j<- raster(paste(pc_clim,"",y,"_prec",8,".asc", sep=""))
> k<- raster(paste(pc_clim,"",y,"_prec",9,".asc", sep=""))
> l<- raster(paste(pc_clim,"",y,"_prec",10,".asc", sep=""))
> m<- raster(paste(pc_clim,"",y,"_prec",11,".asc", sep=""))
> n<- raster(paste(pc_clim,"",y,"_prec",12,".asc", sep=""))
>
> avg<- overlay(a,b,d,e,f,g,i,j,k,l,m,n, fun=maxmonth)
> Error in .overlayList(rasters, fun = fun, filename = filename, datatype
> = datatype, ?:
> ?cannot use this formula; lenghts do not match
>
> Also doesn't work...
>>
>> ?length(mon_stac[1])
>
> [1] 12
> I have 12 rasters being fed into overlay, but it won't buy it.
> I think that my first step is to know the first month of the wettest
> month. Once I can do that I can do it for temperature as well.
>
> Thanks and Regards,
> Brian
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From debeaudette at ucdavis.edu  Mon Nov  8 18:00:07 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Mon, 8 Nov 2010 09:00:07 -0800
Subject: [R-sig-Geo] fix color scale
In-Reply-To: <4CD79E65.3090401@uni-muenster.de>
References: <AANLkTikJuBD3tySpX=dwzo0vKX9NAb0Cz2=SdSn6Jr49@mail.gmail.com>
	<AANLkTin0qviF3pKdUa4PgJJyrZd1Z88dROdf7ZihUV3w@mail.gmail.com>
	<4CD79E65.3090401@uni-muenster.de>
Message-ID: <201011080900.07300.dylan.beaudette@gmail.com>

Ah,

Thanks for the clarification. I'll review the changelog before giving my 
opinions!

Cheers,
Dylan

On Sunday, November 07, 2010, Edzer Pebesma wrote:
> Dylan, I believe that lattice (grid) recently improved the plotting of
> rasters quite a bit, by using panel.levelplot.raster instead of
> panel.levelplot - some function in grid now renders rasters faster on
> devices for which this is optimed.
> 
> spplot also has to transform the data to long format, by calling
> sp:::spmap.to.lev, which in turn uses a stack method for
> SpatialPointsDataFrame objects; this in turn uses stack.data.frame
> 
> Bests,
> 
> 
> On 11/08/2010 05:00 AM, Dylan Beaudette wrote:
> > Interesting demonstration. However, it seems like sp objects and
> > spplot are still more efficient at storing / plotting large grids. The
> > example listed below required over 2 minutes to complete on a 2.4 Ghz
> > Intel processor. Also, storing the coordinates + data in long format
> > could easily fill available memory with large rasters. I have found
> > that storing multiple raster attributes as columns in the @data slot
> > of a SpatialGridDataFrame object give me flexibility to plot images
> > with a consistent color scheme, without needing to store the data in
> > long format. Also with lattice, the plots are generated in a couple of
> > seconds (500x700 px grid). I would be very interested in knowing how
> > to make ggplot() any faster.
> > 
> > Cheers!
> > Dylan
> > 
> > On Sun, Nov 7, 2010 at 11:55 AM, Edzer Pebesma
> > <edzer.pebesma at uni-muenster.de> wrote:
> >> Paul, this nicely illustrates the power of ggplot2.
> >>
> >> In the resulting plot, however, it seems to me that the
> >>
> >> + opts(aspect.ratio = 1)
> >>
> >> does not result in the desired effect that 1 m in the x direction equals
> >> 1 m in the y direction. Standard plot (asp = 1), and lattice plots (asp
> >> = "iso") have this; what does ggplot2 need?
> >>
> >> On 10/31/2010 11:31 AM, Paul Hiemstra wrote:
> >>> Hi Peter,
> >>>
> >>> When creating such a large amount of illustrations with the same
> >>> colorscale, I automatically think of lattice graphics. Under the hood
> >>> spplot also uses lattice graphics. Take a look at the levelplot()
> >>> function from lattice which produces the grid plots for spplot (if I'm
> >>> correct). Alternatively, I've been using ggplot now for quite a while to
> >>> make plots of a lot of grids. A small example says more than a thousand
> >>> words:
> >>>
> >>> library(ggplot2)
> >>> library(sp)
> >>>
> >>> data(meuse.grid)
> >>> summary(meuse.grid)
> >>>
> >>> # Note that I do not transform meuse.grid to SpatialPixelsDataFrame
> >>> # Let's make a simple grid plot
> >>> dum = meuse.grid[c("x","y","dist")]
> >>> ggplot(aes(x = x, y = y, fill = dist), data = dum) + geom_tile()
> >>>
> >>> # Let's make a few more attributes to the grid
> >>> # could be measurements on other dates for example
> >>> new_atts = do.call("cbind", lapply(1:100, function(num) dum$dist +
> >>> runif(dum$dist)))
> >>> summary(new_atts)
> >>> dum = data.frame(cbind(dum, new_atts))
> >>>
> >>> # Important step now is to
> >>> # restructure the data
> >>> dum_ggplot = melt(dum, id.vars = c("x","y"))
> >>>
> >>> # Now make a plot using dum_ggplot
> >>> # of 'x' and 'y' using value as a 'fill'
> >>> # with a plot per 'variable', can take a minute to plot
> >>> ggplot(aes(x = x, y = y, fill = value), data = dum_ggplot) + geom_tile()
> >>> + facet_wrap(~variable) +
> >>>       scale_x_continuous('', labels = NA, breaks = NA) +
> >>>       scale_y_continuous('', labels = NA, breaks = NA) +
> >>> opts(aspect.ratio = 1)
> >>> # These last two lines get rid of the labels on the axes and set aspect
> >>> ratio to 1
> >>>
> >>> Now you have a plot with 101 maps with the same colorscale, with ggplot
> >>> doing all the hard work. It takes some time to get the hang of ggplot,
> >>> but I think it is worth the investment, also for spatial plots.
> >>>
> >>> cheers and hope this helps,
> >>> Paul
> >>>
> >>> On 10/28/2010 09:12 PM, Peter Larson wrote:
> >>>> Hello!
> >>>>
> >>>> I have a problem.
> >>>>
> >>>> I am using IDW to interpolate a daily series of geospatial
> >>>> observations. Thus, I want to produce a large number of sequential
> >>>> maps.
> >>>>
> >>>> I want them to all represent the same color scale. Is there any way to
> >>>> fix the color scale so that it is the same for all the plots?
> >>>>
> >>>> Thanks,
> >>>>
> >>>> Pete
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at stat.math.ethz.ch
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>>
> >>>
> >>
> >> --
> >> Edzer Pebesma
> >> Institute for Geoinformatics (ifgi), University of M?nster
> >> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> >> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> >> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> 
> -- 
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 


From zenlines at gmail.com  Tue Nov  9 02:11:49 2010
From: zenlines at gmail.com (Brian Oney)
Date: Tue, 09 Nov 2010 02:11:49 +0100
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <665110.4693.qm@web29701.mail.ird.yahoo.com>
References: <665110.4693.qm@web29701.mail.ird.yahoo.com>
Message-ID: <4CD89FD5.6020405@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101109/5c1fe621/attachment.pl>

From zenlines at gmail.com  Tue Nov  9 02:29:17 2010
From: zenlines at gmail.com (Brian Oney)
Date: Tue, 09 Nov 2010 02:29:17 +0100
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <AANLkTikkdNR0JKGQ6=3LLGVDNZatxc9ZB76FzTBF6g_Y@mail.gmail.com>
References: <4CD7470D.1080203@gmail.com>
	<AANLkTikkdNR0JKGQ6=3LLGVDNZatxc9ZB76FzTBF6g_Y@mail.gmail.com>
Message-ID: <4CD8A3ED.5080202@gmail.com>

Hello Robert,

Thank you for the suggestions.
The first one:
mon_stac <- stack(paste(pc_clim,"1975_prec",1:12,".asc", sep=""))
plot(mon_stac * 10) # gives me twelve plots of horrendous amounts of rain
  maxmonth <- function(a,b,d,e,f,g,i,j,k,l,m,n){
+                     o <- a + b + d
+                     p <- b + d + e
+                     r <- d + e + f
+                     u <- e + f + g
+                     v <- f + g + i
+                     w <- g + i + j
+                     x <- i + j + k
+                     y <- j + k + l
+                     z <- k + l + m
+                     aa <- l + m + n
+                     ab <- m + n + a
+                     ac <- n + a + b
+                     #ad <- which.max(c(o,p,r,u,v,w,x,y,z,aa,ab,ac))
+                     ad <- calc(stack(o,p,r,u,v,w,x,y,z,aa,ab,ac), fun= 
which.max)
+                     return(ad)}
 >
 > avg <- overlay(mon_stac, fun=maxmonth)
Error in rep.int(names(x), lapply(x, length)) :
   no function to return from, jumping to top level
Error in .overlayList(rasters, fun = fun, filename = filename, ...) :
   cannot use this formula

When I use uncomment the which.max attempt above, I still get the same
"Error in .overlayList(rasters, fun = fun, filename = filename, ...) :
   cannot use this formula; lenghts do not match" error.


In trying it manually, with map algebra:

a <- raster(paste(pc_clim,"1975_prec",1,".asc", sep=""))
b <- raster(paste(pc_clim,"1975_prec",2,".asc", sep=""))
d <- raster(paste(pc_clim,"1975_prec",3,".asc", sep=""))
e <- raster(paste(pc_clim,"1975_prec",4,".asc", sep=""))
f <- raster(paste(pc_clim,"1975_prec",5,".asc", sep=""))
g <- raster(paste(pc_clim,"1975_prec",6,".asc", sep=""))
i <- raster(paste(pc_clim,"1975_prec",7,".asc", sep=""))
j <- raster(paste(pc_clim,"1975_prec",8,".asc", sep=""))
k <- raster(paste(pc_clim,"1975_prec",9,".asc", sep=""))
l <- raster(paste(pc_clim,"1975_prec",10,".asc", sep=""))
m <- raster(paste(pc_clim,"1975_prec",11,".asc", sep=""))
n <- raster(paste(pc_clim,"1975_prec",12,".asc", sep=""))

o <- a + b + d
p <- b + d + e
r <- d + e + f
u <- e + f + g
v <- f + g + i
w <- g + i + j
x <- i + j + k
y <- j + k + l
z <- k + l + m
# Try it this this to see if the double character object name are the 
problem.
A <- l + m + n
B <- m + n + a
E <- n + a + b
# I get the following:
ad <- calc(stack(o,p,r,u,v,w,x,y,z,A,B,E), fun= which.max)
#Error in .local(x, values) : values must be numeric, integer or logical.

# Try stacking it:
G <- stack(o,p,r,u,v,w,x,y,z,A,B,E)
ad <- calc(G, fun=which.max)
#Error in .local(x, values) : values must be numeric, integer or logical.

Jacob made some suggestions that also produced a similar error.

Just in case:
 > sessionInfo()
R version 2.11.0 (2010-04-22)
i386-pc-mingw32

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United 
States.1252    LC_MONETARY=English_United States.1252 LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
  [1] rgdal_0.6-27    dismo_0.5-6     rJava_0.8-7     raster_1.6-10   
maps_2.1-3      gpclib_1.5-1    maptools_0.7-34 lattice_0.18-5  
sp_0.9-64       foreign_0.8-40

loaded via a namespace (and not attached):
[1] grid_2.11.0  tools_2.11.0

My extent is western North America from Canada to Mexico with a huge 
amount of NA cells over the ocean, if this helps.
Thank you for the help.

Cheers,
Brian


From jacobvanetten at yahoo.com  Tue Nov  9 10:32:43 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Tue, 9 Nov 2010 09:32:43 +0000 (GMT)
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <4CD89FD5.6020405@gmail.com>
Message-ID: <682332.44819.qm@web29712.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101109/0bb6f42c/attachment.pl>

From Gericke.L.Cook at aphis.usda.gov  Tue Nov  9 12:22:27 2010
From: Gericke.L.Cook at aphis.usda.gov (Gericke.L.Cook at aphis.usda.gov)
Date: Tue, 9 Nov 2010 04:22:27 -0700
Subject: [R-sig-Geo] Gericke L Cook is on annual leave
Message-ID: <OFB2859687.948DDE68-ON872577D6.003E7AF4-872577D6.003E7AF5@aphis.usda.gov>


I will be out of the office starting  11/09/2010 and will not return until
11/18/2010.

Please contact my backup, Justin Shepard, if you are in need of GIS
assistance during my absence: Justin.H.Shepard at aphis.usda.gov


From roman.lustrik at gmail.com  Tue Nov  9 15:42:17 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Tue, 9 Nov 2010 15:42:17 +0100
Subject: [R-sig-Geo] stack() and lapply
Message-ID: <AANLkTim1HZnAeNBBp4nhfnbJgoXqzXRxZ0W6zEbxBFr9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101109/a777e7dc/attachment.pl>

From patrick.giraudoux at univ-fcomte.fr  Tue Nov  9 16:55:09 2010
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Tue, 09 Nov 2010 16:55:09 +0100
Subject: [R-sig-Geo] spatial point pattern with correlation structure
Message-ID: <4CD96EDD.9030308@univ-fcomte.fr>

Dear all,

I was wondering if there is an easy way to generate coordinates of 
clustered spatial point pattern.(possibly with variations on the degree 
of aggregation).

So far one can easily generate random patterns (splancs: csr; sp: 
spsample) or regular (sp: spsample or some simple lines of programme), 
but I cannot find out if there is some existing function in R capable of 
generating some points clustering...

Any suggestion welcome,

Best,

Patrick


From bastien.ferland-raymond.1 at ulaval.ca  Tue Nov  9 17:46:47 2010
From: bastien.ferland-raymond.1 at ulaval.ca (Bastien Ferland-Raymond)
Date: Tue, 9 Nov 2010 11:46:47 -0500
Subject: [R-sig-Geo] write NA with writeRaster
Message-ID: <8149A8736D1A6E40ADE6328890200A2CE03817F20B@EXCH-MBX-E.ulaval.ca>

Dear R-user,

I'm not new in R but I'm new dealing with images with R.  I checked over google and the help files of the Raster package but I couldn't find my answer.  Sorry if it's simple.

I have a matrix 100x100 that I want to transfert into a tif image.  That's pretty easy with writeRaster, however I have some NaN in my image that I want to keep as NaN in the Tif image.  

Here is my code:
###
make.tiff <- function(NV=newValues,TT=Type,img=imgRaster,nom){
 pixelNDVIMatrix <- calculate_NDVI(TT,img,NV[c(1,2,3)])
 newRaster <- raster(pixelNDVIMatrix)
 NAvalue(newRaster)<- NaN
 nnom<-nom[NV[4]]
 writeRaster(newRaster, filename=nnom,datatype="INT1U",format="GTiff", overwrite=FALSE)  
}
###

pixelNDVIMatrix is the matrix I want to make as tif.  It looks similar to:

 NaN      NaN      NaN  177
NaN       NaN      160    172
 NaN      212       163      179
 230       211        166       174

In that example, the top left of the image in missing.  When I use writeRaster on that, it changes my NaN to 0, which is a problem.  Do you know how can I make the NaN bocome NODATA on the final image?

My final objective is to create tif image in R that I would export to ENVI to calculate textural variables.  Having NODATA instead of 0 is important as I don't want ENVI to evaluate the texture of the "black" area created with the NODATA.  If tif image is the problem, I could probably change to another format.

I'm using R 2.12 with the most recent packages

Thanks for you help,
Bastien Ferland-Raymond

From pkirchner at ucmerced.edu  Tue Nov  9 19:02:52 2010
From: pkirchner at ucmerced.edu (Peter Kirchner)
Date: Tue, 09 Nov 2010 10:02:52 -0800
Subject: [R-sig-Geo] multiple regression analysis
Message-ID: <e0e0a81a34df999fe695cc95b0aff31e@ucmerced.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101109/e385c017/attachment.pl>

From debeaudette at ucdavis.edu  Tue Nov  9 19:15:23 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Tue, 9 Nov 2010 10:15:23 -0800
Subject: [R-sig-Geo] multiple regression analysis
In-Reply-To: <e0e0a81a34df999fe695cc95b0aff31e@ucmerced.edu>
References: <e0e0a81a34df999fe695cc95b0aff31e@ucmerced.edu>
Message-ID: <201011091015.23829.dylan.beaudette@gmail.com>

Hi,

Or, you could include additional variables into the model structure that 
describe vertical patterns. If you choose to do this, then it would also be 
wise to account for correlation between observations with depth and in space. 
Assuming that you can describe your response variable with some covariates 
that you have measured in space, I would start looking at models such as:

# this might help
library(rms)

# account for patterns in depth + covatiates:
# y is the response
# x is one of your covariates
# rcs(depth) is a set of restricted cubic spline basis functions
# that can accommodate just about any smooth shape with depth
ols(y ~ x * rcs(depth))


# you can account for correlation between observations in depth with 
# generalized least squares
# correlation structure is modeled with a continuous AR(1) process
Gls(y ~ x * rcs(depth), cor=corCAR1(form= ~ depth | bore_hole_id))


# this can be further extended to account for spatial correlation...


Cheers,
Dylan


On Tuesday, November 09, 2010, Peter Kirchner wrote:
> 
> Hi Matev??,
> 
> If I understand you correctly and your goal is to conduct a
> spatial analysis of the variables of parent material, and particle size
> e.g. clay, based on depth you will first need to make some decisions on how
> to classify your data based on depth. Then you could create a 2d raster
> file representation of their relationship by kriging or co-kriging your
> classified point data using each variable of interest. Stacking these
> rasters will then allow an analysis on a 3d basis, allowing the data to be
> further analyzed using regression, principal components, or other methods.
> 
> 
> Hope this helps,
> Peter
> 
> ************************************
> Peter
> Kirchner, Graduate Research Scientist 
> 
> University of California, Merced
> 
> 
> pkirchner at ucmerced.edu (209) 834-7628 
> 
> -----Original Message-----
> From:
> r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]
> On Behalf Of Matev?? Pavlic
> Sent: Sunday, November 07, 2010 11:25 PM
> To:
> r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] multiple regression
> analysis
> 
> Hi all, 
> 
> This is more a help on ideas that on actuall R code.
> Those of you which are geologist or work with boreholes woudl understand
> that i would like to achieve. 
> 
> I'll tr to explain as good as I can...so
> here it goes..
> 
> I have around 1000 geomechanical (geological) borehole logs
> in a database.
> The logs contain staial info, lithology and some laboratory
> data. My initial goal is 
> 
> compare the boreholes that are closer together
> (ie.e closer that 50 meters) to see if they are similiar lithologicaly. I
> thought maybe this can be done with some kind of multiple 
> 
> regression
> analysis where one would test if layers (ie. Clayey layer in Bhole 1 in
> depth 5m and in Bhole2 this layer is in depth 7 meters) are in same depth
> and if geology on 
> 
> that depth is the same in Bhole1 as in Bhole 2. For
> example if boreholes would have similiar lithology on similar depth that
> the regresion R^2 would be 1 and if not that it would be less than 1.
> 
> This
> is of course my idealized way of approaching the problem. The idea is to
> get a general a feel for the heterogenity of the changing geology (in depth
> profile) over and area and to create a map 
> 
> of heterogenity of geology of
> the observed area. Does any of this make sense are i am way off?
> 
> Any ideas
> and/or experiences with such a problem is greatly appreciated, 
> 
> Regards, m
> 	[[alternative HTML version deleted]]
> 
> 


-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From Roger.Bivand at nhh.no  Tue Nov  9 19:21:55 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 9 Nov 2010 19:21:55 +0100 (CET)
Subject: [R-sig-Geo] spatial point pattern with correlation structure
In-Reply-To: <4CD96EDD.9030308@univ-fcomte.fr>
References: <4CD96EDD.9030308@univ-fcomte.fr>
Message-ID: <alpine.LRH.2.00.1011091912550.13638@reclus.nhh.no>

On Tue, 9 Nov 2010, Patrick Giraudoux wrote:

> Dear all,
>
> I was wondering if there is an easy way to generate coordinates of clustered 
> spatial point pattern.(possibly with variations on the degree of 
> aggregation).
>
> So far one can easily generate random patterns (splancs: csr; sp: spsample) 
> or regular (sp: spsample or some simple lines of programme), but I cannot 
> find out if there is some existing function in R capable of generating some 
> points clustering...

In splancs, the pcp.sim() function is one possibility. However, there are 
many more in spatstat, with rpoispp() as a very interesting possibility to 
use an image to introduce inhomogeneity into the pattern.

Hope this helps,

Roger

>
> Any suggestion welcome,
>
> Best,
>
> Patrick
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From govindas at msu.edu  Tue Nov  9 19:49:39 2010
From: govindas at msu.edu (govindas at msu.edu)
Date: Tue, 09 Nov 2010 13:49:39 -0500
Subject: [R-sig-Geo] prob with legend in my plots!
In-Reply-To: <EF364035-CCBD-43C4-AA21-C6697DBC13DF@remoteinformation.com.au>
References: <20101105185846.120825am1r4o0t9i@mail.msu.edu>
	<9817BBA3-802B-4678-8402-E0F85355EAB8@remoteinformation.com.au>
	<20101108012004.14048uvq6wc37b10@mail.msu.edu>
	<EF364035-CCBD-43C4-AA21-C6697DBC13DF@remoteinformation.com.au>
Message-ID: <20101109134939.472930g3vhdr6pxf@mail.msu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101109/bb41e496/attachment.pl>

From Lee.Hachadoorian+L at gmail.com  Tue Nov  9 19:51:59 2010
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Tue, 09 Nov 2010 13:51:59 -0500
Subject: [R-sig-Geo] How to neighbours list functions match coords?
Message-ID: <4CD9984F.7080709@gmail.com>

The example from the documentation for nbdists() uses two predefined
objects (columbus and col.gal.nb), so it's not clear to me how
coordinates are being matched (see below)

library(spdep)
example(columbus)
coords <- coordinates(columbus)
dlist <- nbdists(col.gal.nb, coords)

Does nbdists() match coordinates via location or row name? Or does it
rely on the ordering of the objects? What I would like to do is go from
a SpatialPolygonsDataFrame to neighbourslist to nbdist as follows:

nb = poly2nb(columbus, row.names = columbus$COLUMBUS_I, queen = FALSE)
nbdist = nbdists(nb, coords = coordinates(columbus), longlat = TRUE)

Is this reliable?

This question would apply similarly to any neighbours list function with
a coords parameter, e.g. plot.nb or nb2lines.

Thanks,
--Lee

-- 
Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences
CUNY Graduate Center


From Roger.Bivand at nhh.no  Tue Nov  9 20:12:36 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 9 Nov 2010 20:12:36 +0100 (CET)
Subject: [R-sig-Geo] How to neighbours list functions match coords?
In-Reply-To: <4CD9984F.7080709@gmail.com>
References: <4CD9984F.7080709@gmail.com>
Message-ID: <alpine.LRH.2.00.1011092010050.13638@reclus.nhh.no>

On Tue, 9 Nov 2010, Lee Hachadoorian wrote:

> The example from the documentation for nbdists() uses two predefined
> objects (columbus and col.gal.nb), so it's not clear to me how
> coordinates are being matched (see below)
>
> library(spdep)
> example(columbus)
> coords <- coordinates(columbus)
> dlist <- nbdists(col.gal.nb, coords)
>
> Does nbdists() match coordinates via location or row name? Or does it
> rely on the ordering of the objects? What I would like to do is go from
> a SpatialPolygonsDataFrame to neighbourslist to nbdist as follows:
>
> nb = poly2nb(columbus, row.names = columbus$COLUMBUS_I, queen = FALSE)
> nbdist = nbdists(nb, coords = coordinates(columbus), longlat = TRUE)
>
> Is this reliable?

Good question. None of these functions check by matching, they assume that 
the order is correct, and it is the user's responsibility to make sure 
that it is. I'll try to revise the help pages to make this clearer.

Do you think that the functions should check? If so, how, given that by 
default matrices do not have row names?

Roger

>
> This question would apply similarly to any neighbours list function with
> a coords parameter, e.g. plot.nb or nb2lines.
>
> Thanks,
> --Lee
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From zenlines at gmail.com  Tue Nov  9 20:46:44 2010
From: zenlines at gmail.com (Brian Oney)
Date: Tue, 09 Nov 2010 20:46:44 +0100
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <201402.90430.qm@web29708.mail.ird.yahoo.com>
References: <201402.90430.qm@web29708.mail.ird.yahoo.com>
Message-ID: <4CD9A524.9010201@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101109/cb7ed917/attachment.pl>

From r.turner at auckland.ac.nz  Tue Nov  9 20:48:36 2010
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Wed, 10 Nov 2010 08:48:36 +1300
Subject: [R-sig-Geo] spatial point pattern with correlation structure
In-Reply-To: <alpine.LRH.2.00.1011091912550.13638@reclus.nhh.no>
References: <4CD96EDD.9030308@univ-fcomte.fr>
	<alpine.LRH.2.00.1011091912550.13638@reclus.nhh.no>
Message-ID: <286B62DF-C838-426D-993B-43FD1242AE14@auckland.ac.nz>


On 10/11/2010, at 7:21 AM, Roger Bivand wrote:

> On Tue, 9 Nov 2010, Patrick Giraudoux wrote:
> 
>> Dear all,
>> 
>> I was wondering if there is an easy way to generate coordinates of clustered 
>> spatial point pattern.(possibly with variations on the degree of 
>> aggregation).
>> 
>> So far one can easily generate random patterns (splancs: csr; sp: spsample) 
>> or regular (sp: spsample or some simple lines of programme), but I cannot 
>> find out if there is some existing function in R capable of generating some 
>> points clustering...
> 
> In splancs, the pcp.sim() function is one possibility. However, there are 
> many more in spatstat, with rpoispp() as a very interesting possibility to 
> use an image to introduce inhomogeneity into the pattern.
> 
> Hope this helps,

There are quite a few tools for generating clustered point patterns in spatstat,
including rMatClust, rThomas, and rNeymanScott.  The spatstat package is referred
to under "Point pattern analysis" in the CRAN "Task View: Analysis of Spatial Data",
so I'm surprised that M. Giraudoux overlooked it.

	cheers,

		Rolf Turner

From Lee.Hachadoorian+L at gmail.com  Tue Nov  9 21:05:17 2010
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Tue, 09 Nov 2010 15:05:17 -0500
Subject: [R-sig-Geo] How to neighbours list functions match coords?
In-Reply-To: <alpine.LRH.2.00.1011092010050.13638@reclus.nhh.no>
References: <4CD9984F.7080709@gmail.com>
	<alpine.LRH.2.00.1011092010050.13638@reclus.nhh.no>
Message-ID: <4CD9A97D.1040308@gmail.com>



On 11/09/2010 02:12 PM, Roger Bivand wrote:
> On Tue, 9 Nov 2010, Lee Hachadoorian wrote:
>
>> The example from the documentation for nbdists() uses two predefined
>> objects (columbus and col.gal.nb), so it's not clear to me how
>> coordinates are being matched (see below)
> Good question. None of these functions check by matching, they assume
> that the order is correct, and it is the user's responsibility to make
> sure that it is. I'll try to revise the help pages to make this clearer.
>
> Do you think that the functions should check? If so, how, given that
> by default matrices do not have row names?

This probably isn't too well thought out, but perhaps

(1) coordinates() could have a row.names parameter which, like poly2nb()
would default to NULL. Then I would generate a matrix with row names using

> coords = coordinates(columbus, row.names = columbus$COLUMBUS_I)

(2) nbdists() and related functions would match based on row name,
either automatically IF both the nb object and the coordinates matrix
had row names, or with a parameter like match.ID = TRUE.

The background here is that I am a recent R convert coming from the SQL
world, so I am used to matching things based on key columns rather that
the "reorder the vectors and stick them next each other" approach that
is common in the R world. So, for example to join attribute data to a
SpatialPolygonsDataFrame, instead of the approach you use in your book
of using match to generate an ordering vector then spCbind the attribute
data frame, I will

row.names(spdf) = as.character(spdf$key_field)
sp = as(spdf, "SpatialPolygons")
row.names(df) = df$key_field
spdfNew = SpatialPolygonsDataFrame(sp, df, match.ID = TRUE)

Partially my own limitations, but it does seem to use fewer lines of
code when joining several different data frames of attribute data when
I'm doing exploratory visualization.

--Lee

-- 
Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences
CUNY Graduate Center


From edzer.pebesma at uni-muenster.de  Tue Nov  9 21:19:45 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 09 Nov 2010 21:19:45 +0100
Subject: [R-sig-Geo] How to neighbours list functions match coords?
In-Reply-To: <4CD9A97D.1040308@gmail.com>
References: <4CD9984F.7080709@gmail.com>	<alpine.LRH.2.00.1011092010050.13638@reclus.nhh.no>
	<4CD9A97D.1040308@gmail.com>
Message-ID: <4CD9ACE1.7070500@uni-muenster.de>

On 11/09/2010 09:05 PM, Lee Hachadoorian wrote:
> 
> 
> On 11/09/2010 02:12 PM, Roger Bivand wrote:
>> On Tue, 9 Nov 2010, Lee Hachadoorian wrote:
>>
>>> The example from the documentation for nbdists() uses two predefined
>>> objects (columbus and col.gal.nb), so it's not clear to me how
>>> coordinates are being matched (see below)
>> Good question. None of these functions check by matching, they assume
>> that the order is correct, and it is the user's responsibility to make
>> sure that it is. I'll try to revise the help pages to make this clearer.
>>
>> Do you think that the functions should check? If so, how, given that
>> by default matrices do not have row names?
> 
> This probably isn't too well thought out, but perhaps
> 
> (1) coordinates() could have a row.names parameter which, like poly2nb()
> would default to NULL. Then I would generate a matrix with row names using
> 
>> coords = coordinates(columbus, row.names = columbus$COLUMBUS_I)
> 
> (2) nbdists() and related functions would match based on row name,
> either automatically IF both the nb object and the coordinates matrix
> had row names, or with a parameter like match.ID = TRUE.
> 
> The background here is that I am a recent R convert coming from the SQL
> world, so I am used to matching things based on key columns rather that
> the "reorder the vectors and stick them next each other" approach that
> is common in the R world. So, for example to join attribute data to a
> SpatialPolygonsDataFrame, instead of the approach you use in your book
> of using match to generate an ordering vector then spCbind the attribute
> data frame, I will
> 
> row.names(spdf) = as.character(spdf$key_field)
> sp = as(spdf, "SpatialPolygons")
> row.names(df) = df$key_field
> spdfNew = SpatialPolygonsDataFrame(sp, df, match.ID = TRUE)

It would be rather trivial to make the following work:

spdfNew = SpatialPolygonsDataFrame(sp, df, match.ID = "key_field")

which would do the same as the last two of your commands.

> Partially my own limitations, but it does seem to use fewer lines of
> code when joining several different data frames of attribute data when
> I'm doing exploratory visualization.
> 
> --Lee
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Lee.Hachadoorian+L at gmail.com  Tue Nov  9 22:03:54 2010
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Tue, 09 Nov 2010 16:03:54 -0500
Subject: [R-sig-Geo] How to neighbours list functions match coords?
In-Reply-To: <alpine.LRH.2.00.1011092010050.13638@reclus.nhh.no>
References: <4CD9984F.7080709@gmail.com>
	<alpine.LRH.2.00.1011092010050.13638@reclus.nhh.no>
Message-ID: <4CD9B73A.80000@gmail.com>

On Tue, 09 Nov 2010 21:19:45 +0100, Edzer Pebesma wrote:

> On 11/09/2010 09:05 PM, Lee Hachadoorian wrote:
>>
>> row.names(spdf) = as.character(spdf$key_field) sp = as(spdf,
>> "SpatialPolygons")
>> row.names(df) = df$key_field
>> spdfNew = SpatialPolygonsDataFrame(sp, df, match.ID = TRUE)
>
> It would be rather trivial to make the following work:
>
> spdfNew = SpatialPolygonsDataFrame(sp, df, match.ID = "key_field")
>
> which would do the same as the last two of your commands.

match.ID is a logical, not a field name, so that doesn't work. From the
documentation:

"match.ID   logical: (default TRUE): match SpatialPolygons member
Polygons ID slot values with data frame row names, and re-order the data
frame rows if necessary"

--Lee

-- 
Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences
CUNY Graduate Center


-- 
Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences
CUNY Graduate Center


From edzer.pebesma at uni-muenster.de  Tue Nov  9 22:12:25 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 09 Nov 2010 22:12:25 +0100
Subject: [R-sig-Geo] How to neighbours list functions match coords?
In-Reply-To: <4CD9B73A.80000@gmail.com>
References: <4CD9984F.7080709@gmail.com>	<alpine.LRH.2.00.1011092010050.13638@reclus.nhh.no>
	<4CD9B73A.80000@gmail.com>
Message-ID: <4CD9B939.3030807@uni-muenster.de>



On 11/09/2010 10:03 PM, Lee Hachadoorian wrote:
> On Tue, 09 Nov 2010 21:19:45 +0100, Edzer Pebesma wrote:
> 
>> On 11/09/2010 09:05 PM, Lee Hachadoorian wrote:
>>>
>>> row.names(spdf) = as.character(spdf$key_field) sp = as(spdf,
>>> "SpatialPolygons")
>>> row.names(df) = df$key_field
>>> spdfNew = SpatialPolygonsDataFrame(sp, df, match.ID = TRUE)
>>
>> It would be rather trivial to make the following work:
>>
>> spdfNew = SpatialPolygonsDataFrame(sp, df, match.ID = "key_field")
>>
>> which would do the same as the last two of your commands.
> 
> match.ID is a logical, not a field name, so that doesn't work. From the
> documentation:
> 
> "match.ID   logical: (default TRUE): match SpatialPolygons member
> Polygons ID slot values with data frame row names, and re-order the data
> frame rows if necessary"
> 

You're right of course, sorry for the misunderstanding, I meant to say
"to modify sp such that ... works"
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Wed Nov 10 02:38:54 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 9 Nov 2010 17:38:54 -0800
Subject: [R-sig-Geo] write NA with writeRaster
In-Reply-To: <8149A8736D1A6E40ADE6328890200A2CE03817F20B@EXCH-MBX-E.ulaval.ca>
References: <8149A8736D1A6E40ADE6328890200A2CE03817F20B@EXCH-MBX-E.ulaval.ca>
Message-ID: <AANLkTin7f1A0T770u24FD2E8BoR3HSb8bjWa=AmH5QcY@mail.gmail.com>

Bastien,

The way it currently works with Byte type files is that all values
below zero become zero, and all values >= 255 become NA. That, is 255
is the "missing value flag"

What is clearly wrong, is that NA (and NaN) become zero, rather than
NA. I can solve this in raster, but it seems that is also a feature of
rgdal, where it could also be fixed.

Further, what you try here should not work. This to set the NA flag
for reading, not writing.
> ?NAvalue(newRaster)<- NaN
To set the NA flag for writing (from raster version 1.6-16 and
onwards) you can use the argument NAflag=  in writeRaster (and other
functions that write files).

To use NaN as a NA flag is also questionable, because it is not really
a flag. It is (in most cases) equivalent, unless you want to
distinguish in your file between NaN and NA. And you can save NaN
values to disk with floating point values because you can store NaN
(invalid numbers) on disk. However, with byte values all you have is 8
bits and any combination is a valid number, so all you have is
0...255.

GeoTiff has "Internal nodata masks" that I have not explored. Not sure
if that will work (http://www.gdal.org/frmt_gtiff.html)

For now, this might work:

make.tiff <- function(NV=newValues,TT=Type,img=imgRaster,nom){
 pixelNDVIMatrix <- calculate_NDVI(TT,img,NV[c(1,2,3)])
 pixelNDVIMatrix[pixelNDVIMatrix == 255] <- 254
 pixelNDVIMatrix[is.na(pixelNDVIMatrix)] <- 255
 newRaster <- raster(pixelNDVIMatrix)
 NAvalue(newRaster)<- NaN
 nnom<-nom[NV[4]]
 writeRaster(newRaster, filename=nnom,datatype="INT1U",format="GTiff",
overwrite=FALSE)
}


Best, Robert


On Tue, Nov 9, 2010 at 8:46 AM, Bastien Ferland-Raymond
<bastien.ferland-raymond.1 at ulaval.ca> wrote:
> Dear R-user,
>
> I'm not new in R but I'm new dealing with images with R. ?I checked over google and the help files of the Raster package but I couldn't find my answer. ?Sorry if it's simple.
>
> I have a matrix 100x100 that I want to transfert into a tif image. ?That's pretty easy with writeRaster, however I have some NaN in my image that I want to keep as NaN in the Tif image.
>
> Here is my code:
> ###
> make.tiff <- function(NV=newValues,TT=Type,img=imgRaster,nom){
> ?pixelNDVIMatrix <- calculate_NDVI(TT,img,NV[c(1,2,3)])
> ?newRaster <- raster(pixelNDVIMatrix)
> ?NAvalue(newRaster)<- NaN
> ?nnom<-nom[NV[4]]
> ?writeRaster(newRaster, filename=nnom,datatype="INT1U",format="GTiff", overwrite=FALSE)
> }
> ###
>
> pixelNDVIMatrix is the matrix I want to make as tif. ?It looks similar to:
>
> ?NaN ? ? ?NaN ? ? ?NaN ?177
> NaN ? ? ? NaN ? ? ?160 ? ?172
> ?NaN ? ? ?212 ? ? ? 163 ? ? ?179
> ?230 ? ? ? 211 ? ? ? ?166 ? ? ? 174
>
> In that example, the top left of the image in missing. ?When I use writeRaster on that, it changes my NaN to 0, which is a problem. ?Do you know how can I make the NaN bocome NODATA on the final image?
>
> My final objective is to create tif image in R that I would export to ENVI to calculate textural variables. ?Having NODATA instead of 0 is important as I don't want ENVI to evaluate the texture of the "black" area created with the NODATA. ?If tif image is the problem, I could probably change to another format.
>
> I'm using R 2.12 with the most recent packages
>
> Thanks for you help,
> Bastien Ferland-Raymond
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Lee.Hachadoorian+L at gmail.com  Wed Nov 10 04:11:22 2010
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Tue, 09 Nov 2010 22:11:22 -0500
Subject: [R-sig-Geo] How to neighbours list functions match coords?
Message-ID: <4CDA0D5A.2040700@gmail.com>

On Tue, 09 Nov 2010 22:12:25 +0100, Edzer Pebesma wrote:

> You're right of course, sorry for the misunderstanding, I meant to say
> "to modify sp such that ... works"

My bad, sorry for replying with the obvious.

--Lee

-- 
Lee Hachadoorian
PhD Student, Geography
Program in Earth & Environmental Sciences
CUNY Graduate Center


From r.hijmans at gmail.com  Wed Nov 10 05:53:50 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 9 Nov 2010 20:53:50 -0800
Subject: [R-sig-Geo] Bioclimatic variables - wettest quarter
In-Reply-To: <4CD8A3ED.5080202@gmail.com>
References: <4CD7470D.1080203@gmail.com>
	<AANLkTikkdNR0JKGQ6=3LLGVDNZatxc9ZB76FzTBF6g_Y@mail.gmail.com>
	<4CD8A3ED.5080202@gmail.com>
Message-ID: <AANLkTinMV7LYmydN1UZExg2sKHdC0awPiW9W0SV2nY0W@mail.gmail.com>

Hi Brian,

This:

>> avg <- overlay(mon_stac, fun=maxmonth)

 does not work because overlay requires multiple (at least 2) Raster
objects. In your case RasterLayer objects

avg <- overlay(a, b, c, etc... , fun=maxmonth)

An alternative would be to use the list of RasterLayers in the
RasterStack and the do.call mechanism:

avg <- do.call(overlay, c(mon_stack at layers, fun=maxmonth))

After fixing the which.max problem as Jacob indicated. I have also
fixed dismo::biovars to deal with that.

Robert


On Mon, Nov 8, 2010 at 5:29 PM, Brian Oney <zenlines at gmail.com> wrote:
> Hello Robert,
>
> Thank you for the suggestions.
> The first one:
> mon_stac <- stack(paste(pc_clim,"1975_prec",1:12,".asc", sep=""))
> plot(mon_stac * 10) # gives me twelve plots of horrendous amounts of rain
> ?maxmonth <- function(a,b,d,e,f,g,i,j,k,l,m,n){
> + ? ? ? ? ? ? ? ? ? ? o <- a + b + d
> + ? ? ? ? ? ? ? ? ? ? p <- b + d + e
> + ? ? ? ? ? ? ? ? ? ? r <- d + e + f
> + ? ? ? ? ? ? ? ? ? ? u <- e + f + g
> + ? ? ? ? ? ? ? ? ? ? v <- f + g + i
> + ? ? ? ? ? ? ? ? ? ? w <- g + i + j
> + ? ? ? ? ? ? ? ? ? ? x <- i + j + k
> + ? ? ? ? ? ? ? ? ? ? y <- j + k + l
> + ? ? ? ? ? ? ? ? ? ? z <- k + l + m
> + ? ? ? ? ? ? ? ? ? ? aa <- l + m + n
> + ? ? ? ? ? ? ? ? ? ? ab <- m + n + a
> + ? ? ? ? ? ? ? ? ? ? ac <- n + a + b
> + ? ? ? ? ? ? ? ? ? ? #ad <- which.max(c(o,p,r,u,v,w,x,y,z,aa,ab,ac))
> + ? ? ? ? ? ? ? ? ? ? ad <- calc(stack(o,p,r,u,v,w,x,y,z,aa,ab,ac), fun=
> which.max)
> + ? ? ? ? ? ? ? ? ? ? return(ad)}
>>
>> avg <- overlay(mon_stac, fun=maxmonth)
> Error in rep.int(names(x), lapply(x, length)) :
> ?no function to return from, jumping to top level
> Error in .overlayList(rasters, fun = fun, filename = filename, ...) :
> ?cannot use this formula
>
> When I use uncomment the which.max attempt above, I still get the same
> "Error in .overlayList(rasters, fun = fun, filename = filename, ...) :
> ?cannot use this formula; lenghts do not match" error.
>
>
> In trying it manually, with map algebra:
>
> a <- raster(paste(pc_clim,"1975_prec",1,".asc", sep=""))
> b <- raster(paste(pc_clim,"1975_prec",2,".asc", sep=""))
> d <- raster(paste(pc_clim,"1975_prec",3,".asc", sep=""))
> e <- raster(paste(pc_clim,"1975_prec",4,".asc", sep=""))
> f <- raster(paste(pc_clim,"1975_prec",5,".asc", sep=""))
> g <- raster(paste(pc_clim,"1975_prec",6,".asc", sep=""))
> i <- raster(paste(pc_clim,"1975_prec",7,".asc", sep=""))
> j <- raster(paste(pc_clim,"1975_prec",8,".asc", sep=""))
> k <- raster(paste(pc_clim,"1975_prec",9,".asc", sep=""))
> l <- raster(paste(pc_clim,"1975_prec",10,".asc", sep=""))
> m <- raster(paste(pc_clim,"1975_prec",11,".asc", sep=""))
> n <- raster(paste(pc_clim,"1975_prec",12,".asc", sep=""))
>
> o <- a + b + d
> p <- b + d + e
> r <- d + e + f
> u <- e + f + g
> v <- f + g + i
> w <- g + i + j
> x <- i + j + k
> y <- j + k + l
> z <- k + l + m
> # Try it this this to see if the double character object name are the
> problem.
> A <- l + m + n
> B <- m + n + a
> E <- n + a + b
> # I get the following:
> ad <- calc(stack(o,p,r,u,v,w,x,y,z,A,B,E), fun= which.max)
> #Error in .local(x, values) : values must be numeric, integer or logical.
>
> # Try stacking it:
> G <- stack(o,p,r,u,v,w,x,y,z,A,B,E)
> ad <- calc(G, fun=which.max)
> #Error in .local(x, values) : values must be numeric, integer or logical.
>
> Jacob made some suggestions that also produced a similar error.
>
> Just in case:
>> sessionInfo()
> R version 2.11.0 (2010-04-22)
> i386-pc-mingw32
>
> locale:
> [1] LC_COLLATE=English_United States.1252 ?LC_CTYPE=English_United
> States.1252 ? ?LC_MONETARY=English_United States.1252 LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> ?[1] rgdal_0.6-27 ? ?dismo_0.5-6 ? ? rJava_0.8-7 ? ? raster_1.6-10
> maps_2.1-3 ? ? ?gpclib_1.5-1 ? ?maptools_0.7-34 lattice_0.18-5 ?sp_0.9-64
> ? ? foreign_0.8-40
>
> loaded via a namespace (and not attached):
> [1] grid_2.11.0 ?tools_2.11.0
>
> My extent is western North America from Canada to Mexico with a huge amount
> of NA cells over the ocean, if this helps.
> Thank you for the help.
>
> Cheers,
> Brian
>
>
>
>
>


From gianni.lavaredo at gmail.com  Wed Nov 10 12:31:15 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Wed, 10 Nov 2010 12:31:15 +0100
Subject: [R-sig-Geo] NOT easy ID selection and split data.frame
Message-ID: <AANLkTinsorfJiOy2oQDBqyHGpnX-dxpy974uT84eHo8e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101110/681ed916/attachment.pl>

From bart at njn.nl  Wed Nov 10 12:39:25 2010
From: bart at njn.nl (bart)
Date: Wed, 10 Nov 2010 12:39:25 +0100
Subject: [R-sig-Geo] NOT easy ID selection and split data.frame
In-Reply-To: <AANLkTinsorfJiOy2oQDBqyHGpnX-dxpy974uT84eHo8e@mail.gmail.com>
References: <AANLkTinsorfJiOy2oQDBqyHGpnX-dxpy974uT84eHo8e@mail.gmail.com>
Message-ID: <4CDA846D.9080003@njn.nl>

This will do:
 > split(mydata,substr( as.character(mydata$ID),1,8))
It will return a list of dataframes

Bart

On 11/10/2010 12:31 PM, gianni lavaredo wrote:
> Dear Researcher,
>
> I have a problem and I don't know is possible to resolve with R
>
>
> mydata<-
> data.frame(ID=c(1015344101,1015344102,1015344103,1015344104,1015344105,1015344106,1015344107,1015344108,1015344109,1015344110,
>
> 1015344201,1015344202,1015344203,1015344204,1015344205,1015344206,1015344207,1015344208,1015344209,1015344210,1015353001,
>
> 1015353002,1015353003,1015353004,1015353005,1015353006,1015353007,1015353008,1015353009,1015353010),
> value=c(146.5,87.1,211.5,152.0,183.0,104.7,92.2,157.2,116.0,168.0,158.7,78.2,89.3,77.7,108.7,108.5,104.4,101.1,
>
>    91.7,124.0,143.4,158.7,223.4,174.0,243.0,274.6,133.8,147.5,218.3,210.8))
>
>
>
>
> i wish to split in htis way:
>
> data.frame A
>
>             ID value
> 1  1015344101 146.5
> 2  1015344102  87.1
> 3  1015344103 211.5
> 4  1015344104 152.0
> 5  1015344105 183.0
> 6  1015344106 104.7
> 7  1015344107  92.2
> 8  1015344108 157.2
> 9  1015344109 116.0
> 10 1015344110 168.0
>
> data.farme B
> 11 1015344201 158.7
> 12 1015344202  78.2
> 13 1015344203  89.3
> 14 1015344204  77.7
> 15 1015344205 108.7
> 16 1015344206 108.5
> 17 1015344207 104.4
> 18 1015344208 101.1
> 19 1015344209  91.7
> 20 1015344210 124.0
>
>
> data.frame C
> 21 1015353001 143.4
> 22 1015353002 158.7
> 23 1015353003 223.4
> 24 1015353004 174.0
> 25 1015353005 243.0
> 26 1015353006 274.6
> 27 1015353007 133.8
> 28 1015353008 147.5
> 29 1015353009 218.3
> 30 1015353010 210.8
>
>
>
> the first 8 numers (ex: 10153441) give the location of plot and the last the
> ID number of plot (ex: 01)
>
> thanks
> Gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From roman.lustrik at gmail.com  Wed Nov 10 13:33:21 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Wed, 10 Nov 2010 13:33:21 +0100
Subject: [R-sig-Geo] stack() and lapply
In-Reply-To: <AANLkTim1HZnAeNBBp4nhfnbJgoXqzXRxZ0W6zEbxBFr9@mail.gmail.com>
References: <AANLkTim1HZnAeNBBp4nhfnbJgoXqzXRxZ0W6zEbxBFr9@mail.gmail.com>
Message-ID: <AANLkTin8c7dwNv=SpqmcYVQWKE5Px4cQZLZDrNLdN0o3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101110/276e655a/attachment.pl>

From bastien.ferland-raymond.1 at ulaval.ca  Wed Nov 10 15:36:17 2010
From: bastien.ferland-raymond.1 at ulaval.ca (Bastien Ferland-Raymond)
Date: Wed, 10 Nov 2010 09:36:17 -0500
Subject: [R-sig-Geo] RE :  write NA with writeRaster
In-Reply-To: <AANLkTin7f1A0T770u24FD2E8BoR3HSb8bjWa=AmH5QcY@mail.gmail.com>
References: <8149A8736D1A6E40ADE6328890200A2CE03817F20B@EXCH-MBX-E.ulaval.ca>,
	<AANLkTin7f1A0T770u24FD2E8BoR3HSb8bjWa=AmH5QcY@mail.gmail.com>
Message-ID: <8149A8736D1A6E40ADE6328890200A2CE03817F20F@EXCH-MBX-E.ulaval.ca>

Hello Robert,

Thank you very much for your help, it's working perfectly with your code.

Thanks for the quick and complet answer

Bastien


________________________________________
De : Robert J. Hijmans [r.hijmans at gmail.com]
Date d'envoi : 9 novembre 2010 20:38
? : Bastien Ferland-Raymond
Cc : r-sig-geo at stat.math.ethz.ch
Objet : Re: [R-sig-Geo] write NA with writeRaster

Bastien,

The way it currently works with Byte type files is that all values
below zero become zero, and all values >= 255 become NA. That, is 255
is the "missing value flag"

What is clearly wrong, is that NA (and NaN) become zero, rather than
NA. I can solve this in raster, but it seems that is also a feature of
rgdal, where it could also be fixed.

Further, what you try here should not work. This to set the NA flag
for reading, not writing.
>  NAvalue(newRaster)<- NaN
To set the NA flag for writing (from raster version 1.6-16 and
onwards) you can use the argument NAflag=  in writeRaster (and other
functions that write files).

To use NaN as a NA flag is also questionable, because it is not really
a flag. It is (in most cases) equivalent, unless you want to
distinguish in your file between NaN and NA. And you can save NaN
values to disk with floating point values because you can store NaN
(invalid numbers) on disk. However, with byte values all you have is 8
bits and any combination is a valid number, so all you have is
0...255.

GeoTiff has "Internal nodata masks" that I have not explored. Not sure
if that will work (http://www.gdal.org/frmt_gtiff.html)

For now, this might work:

make.tiff <- function(NV=newValues,TT=Type,img=imgRaster,nom){
 pixelNDVIMatrix <- calculate_NDVI(TT,img,NV[c(1,2,3)])
 pixelNDVIMatrix[pixelNDVIMatrix == 255] <- 254
 pixelNDVIMatrix[is.na(pixelNDVIMatrix)] <- 255
 newRaster <- raster(pixelNDVIMatrix)
 NAvalue(newRaster)<- NaN
 nnom<-nom[NV[4]]
 writeRaster(newRaster, filename=nnom,datatype="INT1U",format="GTiff",
overwrite=FALSE)
}


Best, Robert


On Tue, Nov 9, 2010 at 8:46 AM, Bastien Ferland-Raymond
<bastien.ferland-raymond.1 at ulaval.ca> wrote:
> Dear R-user,
>
> I'm not new in R but I'm new dealing with images with R.  I checked over google and the help files of the Raster package but I couldn't find my answer.  Sorry if it's simple.
>
> I have a matrix 100x100 that I want to transfert into a tif image.  That's pretty easy with writeRaster, however I have some NaN in my image that I want to keep as NaN in the Tif image.
>
> Here is my code:
> ###
> make.tiff <- function(NV=newValues,TT=Type,img=imgRaster,nom){
>  pixelNDVIMatrix <- calculate_NDVI(TT,img,NV[c(1,2,3)])
>  newRaster <- raster(pixelNDVIMatrix)
>  NAvalue(newRaster)<- NaN
>  nnom<-nom[NV[4]]
>  writeRaster(newRaster, filename=nnom,datatype="INT1U",format="GTiff", overwrite=FALSE)
> }
> ###
>
> pixelNDVIMatrix is the matrix I want to make as tif.  It looks similar to:
>
>  NaN      NaN      NaN  177
> NaN       NaN      160    172
>  NaN      212       163      179
>  230       211        166       174
>
> In that example, the top left of the image in missing.  When I use writeRaster on that, it changes my NaN to 0, which is a problem.  Do you know how can I make the NaN bocome NODATA on the final image?
>
> My final objective is to create tif image in R that I would export to ENVI to calculate textural variables.  Having NODATA instead of 0 is important as I don't want ENVI to evaluate the texture of the "black" area created with the NODATA.  If tif image is the problem, I could probably change to another format.
>
> I'm using R 2.12 with the most recent packages
>
> Thanks for you help,
> Bastien Ferland-Raymond
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

From Tobias.Reiners at bio.uni-giessen.de  Wed Nov 10 19:28:35 2010
From: Tobias.Reiners at bio.uni-giessen.de (Tobias Reiners)
Date: Wed, 10 Nov 2010 19:28:35 +0100
Subject: [R-sig-Geo] Handling many large ASCII files and make predictions
	based on valuelocations
Message-ID: <4CDAE453.1000705@bio.uni-giessen.de>

Hi,

I'm working on german wide species distribution models.
I'm quite familiar with R but nowadays I'm running out of ideas.
As we mostly work with ArcGIS large Rasterfiles were no problem for us.

But since we use Boosted Regression Trees I'm not able to get my 
suitability values with
simple map algepra. We have to make predictions based on a data.frame.
In the Beginning we used the code from Elith et al.:
http://onlinelibrary.wiley.com/doi/10.1111/j.1365-2656.2008.01390.x/full
in appendix 3 you get help how to handle larger maps.
The code is quite long...it is based mainly on scan() and reading in the 
map values
in tiles, assign() it to an object and building a data.frame for prediction.
After creating the header of the ASCII file you repeat the procedure and 
append it
loop by loop.-->script at the and of the mail

Some useful infos.
I have 22 predictors as maps saved as ASCII files.
Each is on a resolution of 25mx25m for hole germany.
This makes 22 files with 840.618.425 values.
I will take weeks to handle that.

What is the best way to handle my Grids and  get fast access to all values.

I hope somebody had similar experiences and I can hopefully tell
my boss next week that I have a solution.

Thanks in advance

N<-371
rep.rows <- c(rep(90,371))
for(i in 1:length(grid.names)){
                                cat("starting loop with 
Dataset",i,grid.names[i],"\n")
                                
assign(variable.names[i],scan(file=grid.names[i],dec =",",
                                skip=6, na.string = "-9999",nlines = 
rep.rows[1]),pos=1)
                                }

preddat1                          
<-data.frame(land_de,iji,p1,p3,p4,p5,p6,p7,p8,p9,p10,p11,p21,p22,dist_wa,dist_ge,shdi,dgm_d,prec_a1,tmit_a1,X) 

preddat1$land_de            <- factor(preddat1$land_de, levels 
=levels(model.data1$land_de))
preddat                            <- preddat1[!is.na(mask),]

gbm.predict.grids(hamster.tc5.lr005.simp, preddat, want.grids = T,
                                sp.name ="Vogel_pred",pred.vec = 
rep(-9999,25175*rep.rows[1]), filepath = "F:/out/",
                                num.col = 25175, num.row = 33390, xll = 
5234506, yll = 3277362, cell.size = 25, no.data = -9999,
                                plot=T, full.grid = F, part.number = 1, 
part.row = rep.rows[1],preds2R = F)







N<-371
rep.rows <- c(rep(90,371))
for(i in 1:length(grid.names)){
    cat("starting loop with Dataset",i,grid.names[i],"\n")
    assign(variable.names[i],scan(file=input,dec =",",
    skip=6, na.string = "-9999",nlines = rep.rows[1]),pos=1)}

preddat1                     
<-data.frame(land_de,iji,p1,p3,p4,p5,p6,p7,p8,p9,p10,p11,p21,p22,dist_wa,dist_ge,shdi,dgm_d,prec_a1,tmit_a1,X) 

preddat1$land_de        <- factor(preddat1$land_de, levels 
=levels(model.data1$land_de))
preddat                            <- preddat1[!is.na(mask),]

gbm.predict.grids(hamster.tc5.lr005.simp, preddat, want.grids = T, sp.name =
"Vogel_pred2",pred.vec = rep(-9999,25175*rep.rows[1]), filepath = "F:/out/",
num.col = 25175, num.row = 33390, xll = 5234506, yll = 3277362, 
cell.size = 25, no.data = -9999,
plot=T, full.grid = F, part.number = 1, part.row = rep.rows[1],preds2R = F)

for(i in 2:N){
    cat("starting loop with part",i,"Processed: 
",round((((i/N)*100))),"%  \n")
    for(j in 1:length(grid.names)){
        cat("Processed: 
",round((((i/N)*100)))+round((j/length(grid.names)/10),2),grid.names[j],"%  
\n")
        
assign(variable.names[j],scan(file=paste("F:/Bird_Climate/",grid.names[j],sep=""),dec 
= ",",
        skip=(6 +sum(rep.rows[1:(i-1)])),quiet = TRUE, na.string = 
"-9999", nlines = rep.rows[i]),
        pos=1)}
    preddat1                 
<-data.frame(land_de,iji,p1,p3,p4,p5,p6,p7,p8,p9,p10,p11,p21,p22,dist_wa,dist_ge,shdi,dgm_d,prec_a1,tmit_a1,X) 

    preddat1$land_de     <- factor(preddat1$land_de, levels 
=levels(model.data1$land_de))
    preddat                    <- preddat1[!is.na(mask),]
    gbm.predict.grids(hamster.tc5.lr005.simp, preddat, want.grids = T, 
sp.name =
    "Vogel_pred2",pred.vec = rep(-9999,25175*rep.rows[i]), filepath = 
"F:/out/",
    num.col = 25175, full.grid = F, part.number = i,part.row = 
rep.rows[i],header = F,preds2R = F)
                }

-- 
Tobias Erik Reiners
Mammalian Ecology Group

Justus-Liebig-University
IFZ - Department of Animal Ecology
Heinrich-Buff-Ring 26
D-35392 Giessen
Germany

Phone:        +49 (0) 641 / 99 - 35761
Fax.:         +49 (0) 641 / 99 - 35709

www.uni-giessen.de/cms/mammalian-ecology


From daniel.nuest at gmail.com  Wed Nov 10 19:52:26 2010
From: daniel.nuest at gmail.com (=?ISO-8859-1?Q?Daniel_N=FCst?=)
Date: Wed, 10 Nov 2010 19:52:26 +0100
Subject: [R-sig-Geo] Handling many large ASCII files and make
 predictions based on valuelocations
In-Reply-To: <4CDAE453.1000705@bio.uni-giessen.de>
References: <4CDAE453.1000705@bio.uni-giessen.de>
Message-ID: <AANLkTin2bCS24e_kjP0Bae2bQEHGG-AXh-uMeq2X9r=4@mail.gmail.com>

Hello Tobias!

2010/11/10 Tobias Reiners <Tobias.Reiners at bio.uni-giessen.de>:
> I will take weeks to handle that.
>
> What is the best way to handle my Grids and ?get fast access to all values.

Independent from any algorithmic optimizations, did you check out the
existing packages for handling large data sets? For example bigmemory
or ff.

I wrote a little paper about that a while back for a seminar, maybe it
can give you a start in that direction:
http://ifgi.uni-muenster.de/~d_nues01/pub/bredel-nuest_handling-large-image-data-in-R.pdf

/Daniel


From r.hijmans at gmail.com  Wed Nov 10 19:59:09 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 10 Nov 2010 10:59:09 -0800
Subject: [R-sig-Geo] stack() and lapply
In-Reply-To: <AANLkTin8c7dwNv=SpqmcYVQWKE5Px4cQZLZDrNLdN0o3@mail.gmail.com>
References: <AANLkTim1HZnAeNBBp4nhfnbJgoXqzXRxZ0W6zEbxBFr9@mail.gmail.com>
	<AANLkTin8c7dwNv=SpqmcYVQWKE5Px4cQZLZDrNLdN0o3@mail.gmail.com>
Message-ID: <AANLkTim2VUD92_RL=wEE0DqQ2FC4-Z68m+YmYp=66ODi@mail.gmail.com>

Hi Roman,

If I understand you well, you have a list of vectors of filenames, and
you would like to make RasterStack objects for each list element.

> library(raster)
> f <- system.file("external/test.grd", package="raster")
> files <- list(c(f,f,f,f), c(f,f,f,f), c(f,f,f,f))
> x = lapply(files, stack)

# I think this works as you can see here:

> x[[1]]
class       : RasterStack
nlayers     : 4
nrow        : 115
ncol        : 80
ncell       : 9200


# What failed was this because it calls the list elements are
apparently displayed using 'print', which fails for a RasterStack,
rather than 'show' which works. Fixed 'print' in next version...
> x
[[1]]
Error in print(<S4 object of class "RasterStack">) :
  no slot of name "file" for this object of class "RasterStack"
>

Robert


On Wed, Nov 10, 2010 at 4:33 AM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:
> I have solved the issue by checking that the number of layers is bigger than
> one. It looks to me like stack() has some problems when being fed only one
> layer.
>
> x = character vector
>
> ? ?list.of.files <- lapply(X = list.of.files, FUN = function(x) {
> ? ? ? ? ? ? ? ?if (length(x) > 1) {
> ? ? ? ? ? ? ? ? ? ?c1 <- raster::stack(x)
> ? ? ? ? ? ? ? ? ? ?c1 <- sum(c1, na.rm = TRUE)
> ? ? ? ? ? ? ? ? ? ?c1[c1 == 0] <- NA
> ? ? ? ? ? ? ? ?}
> ? ? ? ? ? ? ? ?if (length(x) == 1) {
> ? ? ? ? ? ? ? ? ? ?c1 <- raster(x)
> ? ? ? ? ? ? ? ?}
> ? ? ? ? ? ? ? ?return(c1)
> ? ? ? ? ? ?})
>
> Cheers,
> Roman
>
>
>
> On Tue, Nov 9, 2010 at 3:42 PM, Roman Lu?trik <roman.lustrik at gmail.com>wrote:
>
>> Dear Listers,
>>
>> I have a list (list.of.files) of file names (character vector) with n
>> number of elements.
>>
>> List of 9
>> ?$ 1: chr [1:5] "binned_walker1_1.grd" ...
>> ?$ 2: chr [1:2] "binned_walker2_1.grd" ...
>> ?$ 3: chr [1:3] "binned_walker3_1.grd" ...
>> ?$ 4: chr [1:6] "binned_walker4_1.grd" ...
>> ?$ 5: chr "binned_walker5_1.grd" ...
>> ?$ 6: chr [1:4] "binned_walker6_1.grd" ...
>> ?$ 7: chr [1:6] "binned_walker7_1.grd" ...
>> ?$ 8: chr [1:4] "binned_walker8_1.grd" ...
>> ?$ 9: chr [1:3] "binned_walker9_1.grd" ...
>>
>> If I call stack() on list elements using, for example
>>
>> stack(list.of.files[[1]])
>>
>> I get a RasterStack object with appropriate number of layers.
>>
>> If I call lapply on list.of.files with
>>
>> lapply(list.of.files, FUN = function(x) stack(x))
>>
>> I get an error
>>
>> $`1`
>> Error in print(<S4 object of class "RasterStack">) :
>> ? no slot of name "file" for this object of class "RasterStack"
>>
>> Can anyone elucidate why the method works "by hand" and not using lapply?
>>
>> Cheers,
>> Roman
>>
>>
>>
>> --
>> In God we trust, all others bring data.
>>
>
>
>
> --
> In God we trust, all others bring data.
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From r.hijmans at gmail.com  Wed Nov 10 20:04:30 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 10 Nov 2010 11:04:30 -0800
Subject: [R-sig-Geo] Handling many large ASCII files and make
 predictions based on valuelocations
In-Reply-To: <4CDAE453.1000705@bio.uni-giessen.de>
References: <4CDAE453.1000705@bio.uni-giessen.de>
Message-ID: <AANLkTin=g5YZDdSA4g_ynCvfDMvLoWTB3mogQLBtFVRr@mail.gmail.com>

Tobias,
Please have a look at the 'dismo' package. It has a vignette about
boosted regression trees and the functions from the Elith et al paper,
but using the 'raster' package to make it memory safe (note that you
should avoid using ASCII files; just use the binary files you use in
ArcGIS, that makes for much faster processing).  'dismo' implements
species distribution modeling functions. 'BIOMOD' is another package
in this realm.
Robert



On Wed, Nov 10, 2010 at 10:28 AM, Tobias Reiners
<Tobias.Reiners at bio.uni-giessen.de> wrote:
> Hi,
>
> I'm working on german wide species distribution models.
> I'm quite familiar with R but nowadays I'm running out of ideas.
> As we mostly work with ArcGIS large Rasterfiles were no problem for us.
>
> But since we use Boosted Regression Trees I'm not able to get my suitability
> values with
> simple map algepra. We have to make predictions based on a data.frame.
> In the Beginning we used the code from Elith et al.:
> http://onlinelibrary.wiley.com/doi/10.1111/j.1365-2656.2008.01390.x/full
> in appendix 3 you get help how to handle larger maps.
> The code is quite long...it is based mainly on scan() and reading in the map
> values
> in tiles, assign() it to an object and building a data.frame for prediction.
> After creating the header of the ASCII file you repeat the procedure and
> append it
> loop by loop.-->script at the and of the mail
>
> Some useful infos.
> I have 22 predictors as maps saved as ASCII files.
> Each is on a resolution of 25mx25m for hole germany.
> This makes 22 files with 840.618.425 values.
> I will take weeks to handle that.
>
> What is the best way to handle my Grids and ?get fast access to all values.
>
> I hope somebody had similar experiences and I can hopefully tell
> my boss next week that I have a solution.
>
> Thanks in advance
>
> N<-371
> rep.rows <- c(rep(90,371))
> for(i in 1:length(grid.names)){
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? cat("starting loop with
> Dataset",i,grid.names[i],"\n")
>
> assign(variable.names[i],scan(file=grid.names[i],dec =",",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? skip=6, na.string = "-9999",nlines =
> rep.rows[1]),pos=1)
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? }
>
> preddat1
> ?<-data.frame(land_de,iji,p1,p3,p4,p5,p6,p7,p8,p9,p10,p11,p21,p22,dist_wa,dist_ge,shdi,dgm_d,prec_a1,tmit_a1,X)
> preddat1$land_de ? ? ? ? ? ?<- factor(preddat1$land_de, levels
> =levels(model.data1$land_de))
> preddat ? ? ? ? ? ? ? ? ? ? ? ? ? ?<- preddat1[!is.na(mask),]
>
> gbm.predict.grids(hamster.tc5.lr005.simp, preddat, want.grids = T,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? sp.name ="Vogel_pred",pred.vec =
> rep(-9999,25175*rep.rows[1]), filepath = "F:/out/",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? num.col = 25175, num.row = 33390, xll =
> 5234506, yll = 3277362, cell.size = 25, no.data = -9999,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? plot=T, full.grid = F, part.number = 1,
> part.row = rep.rows[1],preds2R = F)
>
>
>
>
>
>
>
> N<-371
> rep.rows <- c(rep(90,371))
> for(i in 1:length(grid.names)){
> ? cat("starting loop with Dataset",i,grid.names[i],"\n")
> ? assign(variable.names[i],scan(file=input,dec =",",
> ? skip=6, na.string = "-9999",nlines = rep.rows[1]),pos=1)}
>
> preddat1
> <-data.frame(land_de,iji,p1,p3,p4,p5,p6,p7,p8,p9,p10,p11,p21,p22,dist_wa,dist_ge,shdi,dgm_d,prec_a1,tmit_a1,X)
> preddat1$land_de ? ? ? ?<- factor(preddat1$land_de, levels
> =levels(model.data1$land_de))
> preddat ? ? ? ? ? ? ? ? ? ? ? ? ? ?<- preddat1[!is.na(mask),]
>
> gbm.predict.grids(hamster.tc5.lr005.simp, preddat, want.grids = T, sp.name =
> "Vogel_pred2",pred.vec = rep(-9999,25175*rep.rows[1]), filepath = "F:/out/",
> num.col = 25175, num.row = 33390, xll = 5234506, yll = 3277362, cell.size =
> 25, no.data = -9999,
> plot=T, full.grid = F, part.number = 1, part.row = rep.rows[1],preds2R = F)
>
> for(i in 2:N){
> ? cat("starting loop with part",i,"Processed: ",round((((i/N)*100))),"%
> ?\n")
> ? for(j in 1:length(grid.names)){
> ? ? ? cat("Processed:
> ",round((((i/N)*100)))+round((j/length(grid.names)/10),2),grid.names[j],"%
> ?\n")
>
> assign(variable.names[j],scan(file=paste("F:/Bird_Climate/",grid.names[j],sep=""),dec
> = ",",
> ? ? ? skip=(6 +sum(rep.rows[1:(i-1)])),quiet = TRUE, na.string = "-9999",
> nlines = rep.rows[i]),
> ? ? ? pos=1)}
> ? preddat1
> <-data.frame(land_de,iji,p1,p3,p4,p5,p6,p7,p8,p9,p10,p11,p21,p22,dist_wa,dist_ge,shdi,dgm_d,prec_a1,tmit_a1,X)
> ? preddat1$land_de ? ? <- factor(preddat1$land_de, levels
> =levels(model.data1$land_de))
> ? preddat ? ? ? ? ? ? ? ? ? ?<- preddat1[!is.na(mask),]
> ? gbm.predict.grids(hamster.tc5.lr005.simp, preddat, want.grids = T, sp.name
> =
> ? "Vogel_pred2",pred.vec = rep(-9999,25175*rep.rows[i]), filepath =
> "F:/out/",
> ? num.col = 25175, full.grid = F, part.number = i,part.row =
> rep.rows[i],header = F,preds2R = F)
> ? ? ? ? ? ? ? }
>
> --
> Tobias Erik Reiners
> Mammalian Ecology Group
>
> Justus-Liebig-University
> IFZ - Department of Animal Ecology
> Heinrich-Buff-Ring 26
> D-35392 Giessen
> Germany
>
> Phone: ? ? ? ?+49 (0) 641 / 99 - 35761
> Fax.: ? ? ? ? +49 (0) 641 / 99 - 35709
>
> www.uni-giessen.de/cms/mammalian-ecology
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From tylerdeanrudolph at gmail.com  Thu Nov 11 01:35:52 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Wed, 10 Nov 2010 19:35:52 -0500
Subject: [R-sig-Geo] raster() not reading in discrete values
Message-ID: <AANLkTi=0+1b_A5tNQ30MrwbkYb3W9bEyPrAY3FunQZJo@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101110/fd719038/attachment.pl>

From mdsumner at gmail.com  Thu Nov 11 01:54:39 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 11 Nov 2010 11:54:39 +1100
Subject: [R-sig-Geo] raster() not reading in discrete values
In-Reply-To: <AANLkTi=0+1b_A5tNQ30MrwbkYb3W9bEyPrAY3FunQZJo@mail.gmail.com>
References: <AANLkTi=0+1b_A5tNQ30MrwbkYb3W9bEyPrAY3FunQZJo@mail.gmail.com>
Message-ID: <AANLkTimoBKJDVbhGJaZQz_gYHET4X6X3=i4HU92Tn9zC@mail.gmail.com>

What are the kinds of values that you  see in ArcGIS?  Is this an ADF
raster, i.e. a folder of many files like "w000001.adf" etc. ?

This is a just a guess, so sorry if it's off-base - I don't know of
any non-ESRI tool to get at these values.
If this is an ADF raster I know that you won't be able to access the
descriptive/categorical values you would use in Arc, you'll just get
the underlying integer index.  (BTW, this lookup type with an
underlying integer mapped to a 'descriptive value' is like the factor
type in R - does that sound like what you have?).

The raster is read via the GDAL library, which does not provide the
"categorical values" you assign in Arc. It's just a part of the format
that hasn't been reverse engineered by the GDAL developers, but
further, if your descriptive values are actually text then GDAL cannot
represent them - only numeric types are supported, even though the
rasters in R can have text/character types.

Cheers, Mike.

On Thu, Nov 11, 2010 at 11:35 AM, Tyler Dean Rudolph
<tylerdeanrudolph at gmail.com> wrote:
> I have a pretty simple code to extract cell values from a habitat map
> (RasterLayer) based on xy coordinates. ?I recently updated habitat
> information with a new raster image but for some reason now when I read in
> the values it's as though they are no longer being interpreted as discrete
> values, so instead of select, discrete classes I am getting new arbitrary
> groupings that I didn't create. ?The input file is a standard
> ArcGIS-configured GRID raster layer. ?The attribute table in ArcCatalogue
> displays the data as expected, and I've ensured the raster has been classed
> as containing discrete values prior to opening it in R.
>
> Perhaps something in the packages have changed since I ran this last? ?I'm
> currently trying to assess in the raster documentation what kind of
> additional arguments I might have at my disposal in order to clarify how I
> want the data to be read....
>
> Tyler
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.hijmans at gmail.com  Thu Nov 11 02:12:46 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 10 Nov 2010 17:12:46 -0800
Subject: [R-sig-Geo] raster() not reading in discrete values
In-Reply-To: <AANLkTimoBKJDVbhGJaZQz_gYHET4X6X3=i4HU92Tn9zC@mail.gmail.com>
References: <AANLkTi=0+1b_A5tNQ30MrwbkYb3W9bEyPrAY3FunQZJo@mail.gmail.com>
	<AANLkTimoBKJDVbhGJaZQz_gYHET4X6X3=i4HU92Tn9zC@mail.gmail.com>
Message-ID: <AANLkTi=8-oh3Bwo4hceWPAON9Bvvm+n9teFrJ1Ntjh06@mail.gmail.com>

Well, GDALinfo in the latest 'rgdal' does in fact return the
attributes table, upon request, and 'raster' does request it (Roger
implemented this last week). You can see it (if it exists) when you do
print(x) with a RasterLayer (and when using the latest rgdal and
raster). But I have not (consciously) done anything with this that
might change how values are returned. So I think (hope) it has nothing
to do with this. What are your versions  ( sessionInfo() ) ? I may
need to see the arc grid file or a small subset of it. Can you read
the values correctly with rgdal ?
Robert

On Wed, Nov 10, 2010 at 4:54 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> What are the kinds of values that you ?see in ArcGIS? ?Is this an ADF
> raster, i.e. a folder of many files like "w000001.adf" etc. ?
>
> This is a just a guess, so sorry if it's off-base - I don't know of
> any non-ESRI tool to get at these values.
> If this is an ADF raster I know that you won't be able to access the
> descriptive/categorical values you would use in Arc, you'll just get
> the underlying integer index. ?(BTW, this lookup type with an
> underlying integer mapped to a 'descriptive value' is like the factor
> type in R - does that sound like what you have?).
>
> The raster is read via the GDAL library, which does not provide the
> "categorical values" you assign in Arc. It's just a part of the format
> that hasn't been reverse engineered by the GDAL developers, but
> further, if your descriptive values are actually text then GDAL cannot
> represent them - only numeric types are supported, even though the
> rasters in R can have text/character types.
>
> Cheers, Mike.
>
> On Thu, Nov 11, 2010 at 11:35 AM, Tyler Dean Rudolph
> <tylerdeanrudolph at gmail.com> wrote:
>> I have a pretty simple code to extract cell values from a habitat map
>> (RasterLayer) based on xy coordinates. ?I recently updated habitat
>> information with a new raster image but for some reason now when I read in
>> the values it's as though they are no longer being interpreted as discrete
>> values, so instead of select, discrete classes I am getting new arbitrary
>> groupings that I didn't create. ?The input file is a standard
>> ArcGIS-configured GRID raster layer. ?The attribute table in ArcCatalogue
>> displays the data as expected, and I've ensured the raster has been classed
>> as containing discrete values prior to opening it in R.
>>
>> Perhaps something in the packages have changed since I ran this last? ?I'm
>> currently trying to assess in the raster documentation what kind of
>> additional arguments I might have at my disposal in order to clarify how I
>> want the data to be read....
>>
>> Tyler
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From tylerdeanrudolph at gmail.com  Thu Nov 11 21:52:34 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Thu, 11 Nov 2010 15:52:34 -0500
Subject: [R-sig-Geo] raster() not reading in discrete values
In-Reply-To: <AANLkTi=8-oh3Bwo4hceWPAON9Bvvm+n9teFrJ1Ntjh06@mail.gmail.com>
References: <AANLkTi=0+1b_A5tNQ30MrwbkYb3W9bEyPrAY3FunQZJo@mail.gmail.com>
	<AANLkTimoBKJDVbhGJaZQz_gYHET4X6X3=i4HU92Tn9zC@mail.gmail.com>
	<AANLkTi=8-oh3Bwo4hceWPAON9Bvvm+n9teFrJ1Ntjh06@mail.gmail.com>
Message-ID: <AANLkTikX65OUssuUCMWtjxZK3MUBbJnXM7W0Ci8HBOjt@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101111/44d582ce/attachment.pl>

From aleksandr.andreev at gmail.com  Thu Nov 11 23:13:05 2010
From: aleksandr.andreev at gmail.com (Aleksandr Andreev)
Date: Thu, 11 Nov 2010 17:13:05 -0500
Subject: [R-sig-Geo] Plot mean of variable on a map
Message-ID: <AANLkTik2r3P5+m68BTORzgeDcAyshA06M-H74qZx9SZv@mail.gmail.com>

Hello folks!

I'm trying to create some nice graphs for summary statistics in a
paper. Here is the issue.

I have shapefiles of St Petersburg, Russia, which I can import via

spb <- readShapePoly("/home/sasha/Documents/maps/spb.shp")

I also have data on apartments in the city. For each apartment, I have
the latitude, longitude, and the price.

I would like to plot the price on the map in a "heat" style plot. The
natural way to do this by computing a local average price for a
specified neighborhood around (Lat, Lon) (say, of 0.01 of a degree
across -- I have enough data to make this as fine as I need).

Does anyone have suggestions on the best way to do this?

Thanks!

Aleks

---------------
Aleksandr Andreev
Graduate Student -- Department of Economics
University of North Carolina at Chapel Hill


From greenberg at ucdavis.edu  Thu Nov 11 23:20:20 2010
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Thu, 11 Nov 2010 14:20:20 -0800
Subject: [R-sig-Geo] Projection question...
Message-ID: <AANLkTim6dB1gUciVTTDSSrenJNLCrh_YUQEB40vNUb59@mail.gmail.com>

Folks:

Robert has a version of this email concerning the implementation in
raster, but I'm wondering if there's something going on with rgdal or
proj?  Can anyone think of a reason why reprojecting a file of North
America with the following projection info:

"+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107 +x_0=5632642
+y_0=4612546 +ellps=WGS84"

to

"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0"

would be losing all data north of latitude = 46.63769 (even if there
is clearly data above this latitude)?  Here's the raster info of the
file I'm trying to reproject:

> unsynced
class       : RasterLayer
filename    :
nrow        : 277
ncol        : 349
ncell       : 96673
min value   : 0
max value   : 10.1305
projection  : +proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107
+x_0=5632642 +y_0=4612546 +ellps=WGS84
xmin        : -16231.49
xmax        : 11313351
ymin        : -16231.5
ymax        : 8976020
xres        : 32462.99
yres        : 32463

A reprojection works in the sense that all data south of latitude =
46.63769 is placed in the right location.  Thoughts?  If there isn't
any obvious answer from this non-code post, I'll append some code
based on a new R package I've been developing so the specific datasets
can be examined more closely.

--j




-- 
Jonathan A. Greenberg, PhD
Assistant Project Scientist
Center for Spatial Technologies and Remote Sensing (CSTARS)
Department of Land, Air and Water Resources
University of California, Davis
One Shields Avenue
Davis, CA 95616
Phone: 415-763-5476
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From paulojus at c3sl.ufpr.br  Thu Nov 11 23:23:05 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Thu, 11 Nov 2010 20:23:05 -0200 (BRST)
Subject: [R-sig-Geo] Plot mean of variable on a map
In-Reply-To: <AANLkTik2r3P5+m68BTORzgeDcAyshA06M-H74qZx9SZv@mail.gmail.com>
References: <AANLkTik2r3P5+m68BTORzgeDcAyshA06M-H74qZx9SZv@mail.gmail.com>
Message-ID: <alpine.DEB.2.00.1011112021580.14526@macalan.c3sl.ufpr.br>

Uma laternativa soimples para visualizacao descrituicva sem modelagem 
alguma seria o sufo da funcao interpp() do pacote akima para griar um grid 
recular para visualizacao com image()

anternativa sao muitsas , opor exemplo suar um ajuste com GAM



Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
VOIP: (+55) (41) (3361 3600) 1053 1066
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Thu, 11 Nov 2010, Aleksandr Andreev wrote:

> Hello folks!
>
> I'm trying to create some nice graphs for summary statistics in a
> paper. Here is the issue.
>
> I have shapefiles of St Petersburg, Russia, which I can import via
>
> spb <- readShapePoly("/home/sasha/Documents/maps/spb.shp")
>
> I also have data on apartments in the city. For each apartment, I have
> the latitude, longitude, and the price.
>
> I would like to plot the price on the map in a "heat" style plot. The
> natural way to do this by computing a local average price for a
> specified neighborhood around (Lat, Lon) (say, of 0.01 of a degree
> across -- I have enough data to make this as fine as I need).
>
> Does anyone have suggestions on the best way to do this?
>
> Thanks!
>
> Aleks
>
> ---------------
> Aleksandr Andreev
> Graduate Student -- Department of Economics
> University of North Carolina at Chapel Hill
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From paulojus at c3sl.ufpr.br  Fri Nov 12 10:50:55 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Fri, 12 Nov 2010 07:50:55 -0200 (BRST)
Subject: [R-sig-Geo] Plot mean of variable on a map
In-Reply-To: <alpine.DEB.2.00.1011112021580.14526@macalan.c3sl.ufpr.br>
References: <AANLkTik2r3P5+m68BTORzgeDcAyshA06M-H74qZx9SZv@mail.gmail.com>
	<alpine.DEB.2.00.1011112021580.14526@macalan.c3sl.ufpr.br>
Message-ID: <alpine.DEB.2.00.1011120749260.25138@macalan.c3sl.ufpr.br>

Dear all

apologies for my post in Portuguese.
I got confused between email lists and replying as this was
the Brazilian R list

sorry for my mistake


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
VOIP: (+55) (41) (3361 3600) 1053 1066
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Thu, 11 Nov 2010, Paulo Justiniano Ribeiro Jr wrote:

> Uma laternativa soimples para visualizacao descrituicva sem modelagem alguma 
> seria o sufo da funcao interpp() do pacote akima para griar um grid recular 
> para visualizacao com image()
>
> anternativa sao muitsas , opor exemplo suar um ajuste com GAM
>
>
>
> Paulo Justiniano Ribeiro Jr
> LEG (Laboratorio de Estatistica e Geoinformacao)
> Universidade Federal do Parana
> Caixa Postal 19.081
> CEP 81.531-990
> Curitiba, PR  -  Brasil
> Tel: (+55) 41 3361 3573
> VOIP: (+55) (41) (3361 3600) 1053 1066
> Fax: (+55) 41 3361 3141
> e-mail: paulojus AT  ufpr  br
> http://www.leg.ufpr.br/~paulojus
>
> On Thu, 11 Nov 2010, Aleksandr Andreev wrote:
>
>> Hello folks!
>> 
>> I'm trying to create some nice graphs for summary statistics in a
>> paper. Here is the issue.
>> 
>> I have shapefiles of St Petersburg, Russia, which I can import via
>> 
>> spb <- readShapePoly("/home/sasha/Documents/maps/spb.shp")
>> 
>> I also have data on apartments in the city. For each apartment, I have
>> the latitude, longitude, and the price.
>> 
>> I would like to plot the price on the map in a "heat" style plot. The
>> natural way to do this by computing a local average price for a
>> specified neighborhood around (Lat, Lon) (say, of 0.01 of a degree
>> across -- I have enough data to make this as fine as I need).
>> 
>> Does anyone have suggestions on the best way to do this?
>> 
>> Thanks!
>> 
>> Aleks
>> 
>> ---------------
>> Aleksandr Andreev
>> Graduate Student -- Department of Economics
>> University of North Carolina at Chapel Hill
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>


From franziska.schulze at wiwi.hu-berlin.de  Fri Nov 12 12:27:31 2010
From: franziska.schulze at wiwi.hu-berlin.de (Franziska Schulze)
Date: Fri, 12 Nov 2010 12:27:31 +0100
Subject: [R-sig-Geo] problem with adding data to spatialpolygonsdataframe
Message-ID: <4A2D640417064127BEDFD6065DC23D4B@FranziDell>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101112/38bd6403/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Fri Nov 12 16:25:04 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 12 Nov 2010 15:25:04 +0000
Subject: [R-sig-Geo] Projection question...
In-Reply-To: <AANLkTim6dB1gUciVTTDSSrenJNLCrh_YUQEB40vNUb59@mail.gmail.com>
References: <AANLkTim6dB1gUciVTTDSSrenJNLCrh_YUQEB40vNUb59@mail.gmail.com>
Message-ID: <AANLkTimaudR9jJ0=gxb6g=fZ4iQN2=wK3T-ygSCe4-6T@mail.gmail.com>

On Thu, Nov 11, 2010 at 10:20 PM, Jonathan Greenberg
<greenberg at ucdavis.edu> wrote:
> Folks:
>
> Robert has a version of this email concerning the implementation in
> raster, but I'm wondering if there's something going on with rgdal or
> proj? ?Can anyone think of a reason why reprojecting a file of North
> America with the following projection info:
>
> "+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107 +x_0=5632642
> +y_0=4612546 +ellps=WGS84"
>
> to
>
> "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0"
>
> would be losing all data north of latitude = 46.63769 (even if there
> is clearly data above this latitude)? ?Here's the raster info of the
> file I'm trying to reproject:
>
>> unsynced
> class ? ? ? : RasterLayer
> filename ? ?:
> nrow ? ? ? ?: 277
> ncol ? ? ? ?: 349
> ncell ? ? ? : 96673
> min value ? : 0
> max value ? : 10.1305
> projection ?: +proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107
> +x_0=5632642 +y_0=4612546 +ellps=WGS84
> xmin ? ? ? ?: -16231.49
> xmax ? ? ? ?: 11313351
> ymin ? ? ? ?: -16231.5
> ymax ? ? ? ?: 8976020
> xres ? ? ? ?: 32462.99
> yres ? ? ? ?: 32463
>
> A reprojection works in the sense that all data south of latitude =
> 46.63769 is placed in the right location. ?Thoughts? ?If there isn't
> any obvious answer from this non-code post, I'll append some code
> based on a new R package I've been developing so the specific datasets
> can be examined more closely.

 What do you mean by the raster losing data north of 46.6379 degrees?
And what are you using to reproject? (Because a raster normally needs
transforming to a new grid in the new CRS, spTransform wont do it).

 I see no problems doing an spTransform on a set of points in the
range of your raster summary:

pts=data.frame(x=seq(-16231.49,11313351,len=30),y=seq(-16231.5,8976020,len=30),z=1:30)
coordinates(pts)=~x+y
proj4string(pts)="+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107
+x_0=5632642 +y_0=4612546 +ellps=WGS84"
spTransform(pts,CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
+towgs84=0,0,0"))

gives me 30 points with no NA's or anything unexpected...

Barry


From b.rowlingson at lancaster.ac.uk  Fri Nov 12 16:28:00 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 12 Nov 2010 15:28:00 +0000
Subject: [R-sig-Geo] problem with adding data to spatialpolygonsdataframe
In-Reply-To: <4A2D640417064127BEDFD6065DC23D4B@FranziDell>
References: <4A2D640417064127BEDFD6065DC23D4B@FranziDell>
Message-ID: <AANLkTi=Pi3y8FxfC2gijQ3B9+hqmieaqgAUHiv88qKW0@mail.gmail.com>

On Fri, Nov 12, 2010 at 11:27 AM, Franziska Schulze
<franziska.schulze at wiwi.hu-berlin.de> wrote:
> Dear all,
>
> I have a SpatialPolygonsDataFrame and I want to add data to the regions, i.e. I want to assign to every region in my data a value of a certain variable. I tried using spCbind, but after using this, the dimensions of my SpatialPolygonsDataFrame changed. What went wrong? Do I have to create a matrix with the region's IDs and the values of my variable?

 You can for the most part treat it like a data frame. For example,
using the spdf created in help("SpatialPolygonsDataFrame-class")

> summary(ex_1.7)
Object of class SpatialPolygonsDataFrame
Coordinates:
  min  max
x 0.5 10.5
y 0.5 10.5
Is projected: NA
proj4string : [NA]
Data attributes:
       x              y              z
 Min.   : 1.0   Min.   : 1.0   Min.   :1.702
 1st Qu.: 3.0   1st Qu.: 3.0   1st Qu.:2.626
 Median : 5.5   Median : 5.5   Median :3.123
 Mean   : 5.5   Mean   : 5.5   Mean   :3.127
 3rd Qu.: 8.0   3rd Qu.: 8.0   3rd Qu.:3.614
 Max.   :10.0   Max.   :10.0   Max.   :4.600
> ex_1.7$FOO=99
> summary(ex_1.7)
Object of class SpatialPolygonsDataFrame
Coordinates:
  min  max
x 0.5 10.5
y 0.5 10.5
Is projected: NA
proj4string : [NA]
Data attributes:
       x              y              z              FOO
 Min.   : 1.0   Min.   : 1.0   Min.   :1.702   Min.   :99
 1st Qu.: 3.0   1st Qu.: 3.0   1st Qu.:2.626   1st Qu.:99
 Median : 5.5   Median : 5.5   Median :3.123   Median :99
 Mean   : 5.5   Mean   : 5.5   Mean   :3.127   Mean   :99
 3rd Qu.: 8.0   3rd Qu.: 8.0   3rd Qu.:3.614   3rd Qu.:99
 Max.   :10.0   Max.   :10.0   Max.   :4.600   Max.   :99
>

The dimension will change because you are adding a new column - if the
number of rows have changed then something is going wrong...

Post some code?

Barry


From a.mosnier at gmail.com  Fri Nov 12 16:51:05 2010
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Fri, 12 Nov 2010 10:51:05 -0500
Subject: [R-sig-Geo] Phase shift for the periodic model ... fit.variogram,
	vgm
Message-ID: <AANLkTimXE7CqFX=UjNZngRK1_OAedHcH+67W43J6V4Pi@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101112/0361f6aa/attachment.pl>

From A.Lam at geo.uu.nl  Fri Nov 12 17:34:06 2010
From: A.Lam at geo.uu.nl (Arien Lam)
Date: Fri, 12 Nov 2010 17:34:06 +0100
Subject: [R-sig-Geo] Plot mean of variable on a map
In-Reply-To: <AANLkTik2r3P5+m68BTORzgeDcAyshA06M-H74qZx9SZv@mail.gmail.com>
References: <AANLkTik2r3P5+m68BTORzgeDcAyshA06M-H74qZx9SZv@mail.gmail.com>
Message-ID: <4CDD6C7E.6020308@geo.uu.nl>

Hi,

loessmodel <- loess(price ~ lat*lon, options) # fiddle with the options
locations <- expand.grid() # to make a prediction grid
averageprice <- predict(loessmodel, newdata = locations) # not a grid
locations$averageprice <- averageprice # to maka it a grid again

Or something along those lines. Of course there are also "better" ways to interpolate.

Hope this helps,

Arien


Aleksandr Andreev wrote:
> Hello folks!
>
> I'm trying to create some nice graphs for summary statistics in a
> paper. Here is the issue.
>
> I have shapefiles of St Petersburg, Russia, which I can import via
>
> spb<- readShapePoly("/home/sasha/Documents/maps/spb.shp")
>
> I also have data on apartments in the city. For each apartment, I have
> the latitude, longitude, and the price.
>
> I would like to plot the price on the map in a "heat" style plot. The
> natural way to do this by computing a local average price for a
> specified neighborhood around (Lat, Lon) (say, of 0.01 of a degree
> across -- I have enough data to make this as fine as I need).
>
> Does anyone have suggestions on the best way to do this?
>
> Thanks!
>
> Aleks
>
> ---------------
> Aleksandr Andreev
> Graduate Student -- Department of Economics
> University of North Carolina at Chapel Hill
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Arien Lam
Dept. of Physical Geography
Utrecht University, NL


From lestes at princeton.edu  Fri Nov 12 18:12:41 2010
From: lestes at princeton.edu (Lyndon Estes)
Date: Fri, 12 Nov 2010 12:12:41 -0500
Subject: [R-sig-Geo] Pixel reference location?
Message-ID: <AANLkTinjcN+j3hKW=Aejd7VtXsE1ViUjF-SLTB49_aDC@mail.gmail.com>

Dear R-Sig-Geo,

I have a question regarding pixel referencing with the raster package,
from which I am using the crop function to resize MODIS imagery.  I
was under the impression that raster refers to the upper left of the
upper left pixel in defining the spatial extent, but I am getting
results that seem to suggest that the center of the pixel is being
used.

What I am doing: I have written a function that calls the MODIS
HEGtools to read-in, stitch, and reproject the image into an Albers
Equal Area Conic projection.  The HEGtool has the capacity to subset
the image, but the resulting subset image is not well rectified with
the result one gets when stitching two full size images together
(probably because of how I have defined projection parameters), so I
am instead adding an extra step that resizes the image with the crop
function, using a subset of the image that I created using ENVI.

Here are the values for the crop image:

crop.img
class       : RasterLayer
filename    : MOD250m_extenttemplate
nrow        : 6116
ncol        : 4200
ncell       : 25687200
min value   : ?
max value   : ?
projection  : +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
+x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
+nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
xmin        : -120863.9
xmax        : 852092.8
ymin        : -497022.6
ymax        : 919787.6
xres        : 231.6564
yres        : 231.6564

(Note the seemingly bizarre projection parameters, which is another
story, and is created by the HEGtool, which is supposed to use WGS4,
but instead seems to spit out NAD27).

Now, after the crop function is run, my resulting cropped MODIS image
ends up with the following parameters:

raster(out.name)
class       : RasterLayer
filename    : MOD13Q1.A2005225.h20v11.mosaic4.NDVI.tif
nrow        : 6116
ncol        : 4200
ncell       : 25687200
min value   : ?
max value   : ?
projection  : +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
+x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
+nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
xmin        : -120748.1
xmax        : 852208.6
ymin        : -496906.8
ymax        : 919903.5
xres        : 231.6564
yres        : 231.6564

Looking at the xmins of the two images, -120863.9 - -120748.1 =
-115.8, which is equal to half a pixel.  Same for the ymaxs.

So, is this an issue of where in the pixel raster assigns the UL
reference coordinate, and, if so, is there a way to specify how the
reference is being done?  If not, am I doing something else wrong?

Thanks in advance for any advice (function code follows).

Cheers, Lyndon


ModStitch <- function(modpath, hegpath, modnames, cropimage) {
# Uses the HEGtool from MODIS LPDAAC to read in, stitch, and reproject
the MODIS NDVI and VI quality bands
# References: http://spatial-analyst.net/book/MODIS_download_HR.R
# Args:
#   modpath: Path to directory holding MODIS data
#   hegpath: Path to the HEGtool installation
#   modnames: Vector containing MODIS image names to process
#   crop image: A raster defining the extent to which the images
should be resized
# Returns:
#   Separate stitched MODIS NDVI and VI Quality bands, reprojected to
Albers Equal Area conic (for South
#   Africa), saved as a GEOtiff

  # Set tool and environment variables
  hegtool         <- paste(hegpath, "/heg/bin/hegtool", sep = "")
  grd.stitch.tool <- paste(hegpath, "/heg/bin/subset_stitch_grid", sep = "")
  pgs.loc         <- paste(hegpath, "/heg/TOOLKIT_MTD", sep = "")
  mrt.data.loc    <- paste(hegpath, "/heg/data", sep = "")
  Sys.setenv(PGSHOME = pgs.loc)  # Environment variable for HEGtool
  Sys.setenv(MRTDATADIR = mrt.data.loc)  # Environment variable for HEGtool

  # Set path to MODIS data directory
  setwd(modpath)

  # And process the specified MODIS images using hegtool to capture
header file information
  mod.list <- vector("list", length(modnames))  # List to capture
header file output

  # Call crop image
  crop.img <- raster(cropimage)

  # Create and capture HegHdr.hdr files
  for (i in 1:length(mod.list)) {
      system(paste(hegtool, "-h", modnames[i]), intern = FALSE, wait = TRUE)
      mod.list[[i]] <- scan("HegHdr.hdr", what = "character", sep = "\n",)
      names(mod.list)[i] <- modnames[i]
  }

  # Then stitch and reproject both the NDVI layers and the error flag layers

  # Set up a couple of variables
  which.var <- c("250m 16 days NDVI|", "250m 16 days VI Quality|")
  which.abb <- c("NDVI", "qual")

  for(k in 1:length(which.var)) {  # Loop through NDVI, then VI

    # First write the stitch parameters file

    # Stitch parameter file name
    pr.name  <- paste("stitch_", k, ".prm", sep = "")  # 1 = stitch
for NDVI, 2 for VI quality
    out.name <- paste(substr(modnames[1], 1, 23), ".mosaic4.",
which.abb[k],".tif", sep = "")

    # Open connection to write stitch file
    filename <- file(pr.name, open = "wt")
    write("", filename, append = TRUE)
    write("NUM_RUNS = 1", filename, append = TRUE)  # Not sure if this
needs to be a variable
    write("", filename, append = TRUE)
    write("BEGIN", filename, append = TRUE)
    write("NUMBER_INPUTFILES = 2",filename, append = TRUE)  # Alter
this if more than 1 file is to be stitched
    write(paste("INPUT_FILENAMES = ", modnames[1], "|", modnames[2],
sep = ""), filename, append = TRUE)
    write("OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|", filename,
append = TRUE)
    write(paste("FIELD_NAME = ", which.var[k], sep = ""), filename,
append = TRUE)
    write("BAND_NUMBER = 1", filename, append = TRUE)

    # Pulls coordinates for upper left from first header file
    write(paste("SPATIAL_SUBSET_UL_CORNER = ", "( ",
                substr(mod.list[[1]][grep("GRID_UL_CORNER_LATLON=",
mod.list[[1]])], 23, 48), " )", sep = ""),
          filename, append = TRUE)

    # Pulls coordinates for lower right from last header file
    write(paste("SPATIAL_SUBSET_LR_CORNER = ", "( ",

substr(mod.list[[length(mod.list)]][grep("GRID_LR_CORNER_LATLON=",
                  mod.list[[length(mod.list)]])], 23, 48), " )", sep = ""),
          filename, append = TRUE)

    write("OUTPUT_OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|",
filename, append = TRUE)
    write(paste("OUTGRID_X_PIXELSIZE = ",
                substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
mod.list[[1]])], 17, 26), sep = ""),
          filename, append = TRUE)
    write(paste("OUTGRID_Y_PIXELSIZE = ",
                substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
mod.list[[1]])], 17, 26), sep = ""),
          filename, append = TRUE)
    write(paste("OUTPUT_FILENAME = ", out.name, sep = ""), filename,
append = TRUE)
    write("SAVE_STITCHED_FILE = NO", filename, append = TRUE)
    write(paste("OUTPUT_STITCHED_FILENAME = sasquatch", k, ".hdf", sep
= ""), filename, append = TRUE)
    write("OUTPUT_TYPE = GEO", filename, append = TRUE)
    write("RESAMPLING_TYPE = NN", filename, append = TRUE)
    write("OUTPUT_PROJECTION_TYPE = ALBERS", filename, append = TRUE)
    write("OUTPUT_PROJECTION_PARAMETERS = ( 0.0 0.0 -18.0 -32.0 24.0
0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0  )",
          filename, append = TRUE)
    write("END", filename, append = TRUE)
    write("", filename, append = TRUE)
    close(filename)

    # Then call the stitch tool and process it
    stitch.com <- paste(grd.stitch.tool, "-P", pr.name)
    system(stitch.com)  # Works

    # Then use Raster function to resize because subsetting with MODIS
tool results in offset
    to.crop <- raster(out.name)
    cropped <- crop(to.crop, crop.img, filename = out.name, overwrite
= TRUE)  # Overwrites existing images
  }  # Close loop
}  # End function

ModStitch(modpath = path.ndvi.dat, hegpath = hegpath, modnames =
modnames, cropimage = envi.img)










-- 
Lyndon Estes
Research Associate
Woodrow Wilson School
Princeton University
+1-609-258-2392 (o)
+1-609-258-6082 (f)
+1-202-431-0496 (m)
lestes at princeton.edu


From zua3 at cornell.edu  Fri Nov 12 19:11:26 2010
From: zua3 at cornell.edu (Zia Ahmed)
Date: Fri, 12 Nov 2010 13:11:26 -0500
Subject: [R-sig-Geo] Help: PROBABILITY INTERVAL maps in gstat
In-Reply-To: <201002230945.45053.dylan.beaudette@gmail.com>
References: <20100222104952.34483up1tk6v5f7k@webmail.ugent.be>	<201002220941.38559.dylan.beaudette@gmail.com>	<4B82D598.6070004@uni-muenster.de>
	<201002230945.45053.dylan.beaudette@gmail.com>
Message-ID: <4CDD834E.1080700@cornell.edu>

  I like to  create a  probability interval map  of soil  salinity  (for 
example  from 2 to 4 dS/cm)  using IK  or from ordinary kriging,   How 
do I wrote the code in gstat? Help will be appreciated.
Thanks
Zia
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101112/f7a12bc2/attachment.vcf>

From moshersteven at gmail.com  Fri Nov 12 20:28:27 2010
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 12 Nov 2010 11:28:27 -0800
Subject: [R-sig-Geo] Why I can't install RGDAL after R 2.12.0 release?
In-Reply-To: <1C99CC51-68A6-4295-A209-A4CFBB438057@ecotoxicology.de>
References: <1C99CC51-68A6-4295-A209-A4CFBB438057@ecotoxicology.de>
Message-ID: <AANLkTimqJ7ztMyiV-Aeb-0WvWV7_+szG=7UPLDn-0nVn@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101112/dac61e0a/attachment.pl>

From Roger.Bivand at nhh.no  Fri Nov 12 23:01:16 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 12 Nov 2010 23:01:16 +0100 (CET)
Subject: [R-sig-Geo] Why I can't install RGDAL after R 2.12.0 release?
In-Reply-To: <AANLkTimqJ7ztMyiV-Aeb-0WvWV7_+szG=7UPLDn-0nVn@mail.gmail.com>
References: <1C99CC51-68A6-4295-A209-A4CFBB438057@ecotoxicology.de>
	<AANLkTimqJ7ztMyiV-Aeb-0WvWV7_+szG=7UPLDn-0nVn@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1011122256490.2214@reclus.nhh.no>

On Fri, 12 Nov 2010, steven mosher wrote:

> well, That didnt work.

Did you check the configure arguments carefully, or is your mailer that 
has catenated:

.../unix/include-with-proj-lib=/Library/Frameworks/...

instead of:

.../unix/include --with-proj-lib=/Library/Frameworks/...

Do you need to install from source because of drivers, or would the 
standard OSX install of:

setRepositories(ind=1:2)
install.packages("rgdal")

be sufficient, with only standard drivers?

Roger


>
> I upgraded to  R 2.12  and sure enough GDAL is broken.  I downloaded the
> latest framework
> from KngChaos and did a standard install.
>
> I tried the code provided here and Got the following
>
>> install.packages("rgdal",
> configure.args='--with-gdal-config=/Library/Frameworks/GDAL.Framework/Unix/bin/gdal-config
> --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include-with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib/',dependencies=TRUE,
> type="source")
> Installing package(s) into ?/Users/mosher/Library/R/2.12/library?
> (as ?lib? is unspecified)
> trying URL 'http://cran.cnr.Berkeley.edu/src/contrib/rgdal_0.6-30.tar.gz'
> Content type 'application/x-gzip' length 1431492 bytes (1.4 Mb)
> opened URL
> ==================================================
> downloaded 1.4 Mb
>
> * installing *source* package ?rgdal? ...
> gdal-config: /Library/Frameworks/GDAL.Framework/Unix/bin/gdal-config
> checking for gcc... gcc -arch x86_64 -std=gnu99
> checking for C compiler default output file name... a.out
> checking whether the C compiler works... yes
> checking whether we are cross compiling... no
> checking for suffix of executables...
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether gcc -arch x86_64 -std=gnu99 accepts -g... yes
> checking for gcc -arch x86_64 -std=gnu99 option to accept ANSI C... none
> needed
> checking how to run the C preprocessor... gcc -arch x86_64 -std=gnu99 -E
> checking for egrep... grep -E
> checking for ANSI C header files... rm: conftest.dSYM: is a directory
> rm: conftest.dSYM: is a directory
> yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking proj_api.h usability... no
> checking proj_api.h presence... no
> checking for proj_api.h... no
> Error: proj_api.h not found.
> If the PROJ.4 library is installed in a non-standard location,
> use --configure-args='--with-proj-include=/opt/local/include'
> for example, replacing /opt/local/* with appropriate values
> for your installation. If PROJ.4 is not installed, install it.
> ERROR: configuration failed for package ?rgdal?
> * removing ?/Users/mosher/Library/R/2.12/library/rgdal?
>
> The downloaded packages are in
>
> ?/private/var/folders/ea/eaXeR9KIEZSbgaDPdoLSwU+++TI/-Tmp-/Rtmpt5Nycy/downloaded_packages?
> Warning messages:
> 1: In install.packages(c("rgdal"), lib =
> "/Users/mosher/Library/R/2.12/library",  :
>  installation of package 'rgdal' had non-zero exit status
> 2: In install.packages(c("rgdal"), lib =
> "/Users/mosher/Library/R/2.12/library",  :
>  installation of package 'rgdal' had non-zero exit status
> 3: In install.packages(c("rgdal"), lib =
> "/Users/mosher/Library/R/2.12/library",  :
>  installation of package 'rgdal' had non-zero exit status
> 4: In install.packages("rgdal", configure.args =
> "--with-gdal-config=/Library/Frameworks/GDAL.Framework/Unix/bin/gdal-config
> --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include-with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib/",
> :
>  installation of package 'rgdal' had non-zero exit status
>
> 2010/10/27 Ralf Sch?fer <senator at ecotoxicology.de>
>
>> Hello,
>>
>> don`t know if this issue is already fixed given that Roger posted an
>> answer.
>> However, I just installed from source with the command:
>>
>> install.packages("rgdal",
>> configure.args='--with-gdal-config=/Library/Frameworks/GDAL.Framework/Unix/bin/gdal-config
>> --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include-with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib/',dependencies=TRUE,
>> type="source")
>>
>> R version 2.12.0 (2010-10-15)
>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>
>> The frameworks provided on Kyngchaos do not work for me under 2.12.
>>
>> Regards,
>> Ralf
>>
>> ------------------------------------------------------------
>>
>> Prof. Dr. rer. nat. Ralf Bernhard Sch?fer
>> Juniorprofessor Quantitative Landscape Ecology
>> Environmental Scientist (M.Sc.)
>> Institute for Environmental Sciences
>> University Koblenz-Landau
>> Forststrasse 7
>> 76829 Landau
>> Germany
>> Mail: schaefer-ralf at uni-landau.de
>> Phone: ++49 (0) 6341 280-31536
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From moshersteven at gmail.com  Fri Nov 12 23:11:39 2010
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 12 Nov 2010 14:11:39 -0800
Subject: [R-sig-Geo] Why I can't install RGDAL after R 2.12.0 release?
In-Reply-To: <alpine.LRH.2.00.1011122256490.2214@reclus.nhh.no>
References: <1C99CC51-68A6-4295-A209-A4CFBB438057@ecotoxicology.de>
	<AANLkTimqJ7ztMyiV-Aeb-0WvWV7_+szG=7UPLDn-0nVn@mail.gmail.com>
	<alpine.LRH.2.00.1011122256490.2214@reclus.nhh.no>
Message-ID: <AANLkTinkWtiiPA3q9+1xfoJn0__JoLjHbFw2Go0KXnHv@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101112/549762c3/attachment.pl>

From moshersteven at gmail.com  Fri Nov 12 23:28:43 2010
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 12 Nov 2010 14:28:43 -0800
Subject: [R-sig-Geo] Why I can't install RGDAL after R 2.12.0 release?
In-Reply-To: <alpine.LRH.2.00.1011122256490.2214@reclus.nhh.no>
References: <1C99CC51-68A6-4295-A209-A4CFBB438057@ecotoxicology.de>
	<AANLkTimqJ7ztMyiV-Aeb-0WvWV7_+szG=7UPLDn-0nVn@mail.gmail.com>
	<alpine.LRH.2.00.1011122256490.2214@reclus.nhh.no>
Message-ID: <AANLkTi=PGf0sNCJjSorJsotDMR0KWOrku3Z7QJgw6M8G@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101112/a08e8e88/attachment.pl>

From r.hijmans at gmail.com  Sat Nov 13 07:39:52 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 12 Nov 2010 22:39:52 -0800
Subject: [R-sig-Geo] Projection question...
In-Reply-To: <AANLkTimaudR9jJ0=gxb6g=fZ4iQN2=wK3T-ygSCe4-6T@mail.gmail.com>
References: <AANLkTim6dB1gUciVTTDSSrenJNLCrh_YUQEB40vNUb59@mail.gmail.com>
	<AANLkTimaudR9jJ0=gxb6g=fZ4iQN2=wK3T-ygSCe4-6T@mail.gmail.com>
Message-ID: <AANLkTikhMKmsUULqq2XXALr=wqWdyaJnz6dOnaZTEtTN@mail.gmail.com>

Jonathan,

Hard to say what is going on. This example works for me:

r <- raster(nrow=277, ncol=349, xmn=-16231.49, xmx=11313351,
ymn=-16231.5, ymx=8976020, crs="+proj=lcc +lat_1=50 +lat_2=50
+lat_0=50 +lon_0=-107 +x_0=5632642 +y_0=4612546 +ellps=WGS84")

r[] = 1:ncell(r)

pr <- projectRaster(r, crs="+proj=longlat +ellps=WGS84 +datum=WGS84
+no_defs +towgs84=0,0,0", res=5)

Using a low resolution because this thing crossed the date line. In
any case, something like the below, where you specify the output
raster you want, is generally more sensible.

pr = raster(xmn=-168, xmx=-40, ymn=40, ymx=75)
res(pr) = 0.2
pr <- projectRaster(r, pr, progress='window')

Robert


On Fri, Nov 12, 2010 at 7:25 AM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Thu, Nov 11, 2010 at 10:20 PM, Jonathan Greenberg
> <greenberg at ucdavis.edu> wrote:
>> Folks:
>>
>> Robert has a version of this email concerning the implementation in
>> raster, but I'm wondering if there's something going on with rgdal or
>> proj? ?Can anyone think of a reason why reprojecting a file of North
>> America with the following projection info:
>>
>> "+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107 +x_0=5632642
>> +y_0=4612546 +ellps=WGS84"
>>
>> to
>>
>> "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0"
>>
>> would be losing all data north of latitude = 46.63769 (even if there
>> is clearly data above this latitude)? ?Here's the raster info of the
>> file I'm trying to reproject:
>>
>>> unsynced
>> class ? ? ? : RasterLayer
>> filename ? ?:
>> nrow ? ? ? ?: 277
>> ncol ? ? ? ?: 349
>> ncell ? ? ? : 96673
>> min value ? : 0
>> max value ? : 10.1305
>> projection ?: +proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107
>> +x_0=5632642 +y_0=4612546 +ellps=WGS84
>> xmin ? ? ? ?: -16231.49
>> xmax ? ? ? ?: 11313351
>> ymin ? ? ? ?: -16231.5
>> ymax ? ? ? ?: 8976020
>> xres ? ? ? ?: 32462.99
>> yres ? ? ? ?: 32463
>>
>> A reprojection works in the sense that all data south of latitude =
>> 46.63769 is placed in the right location. ?Thoughts? ?If there isn't
>> any obvious answer from this non-code post, I'll append some code
>> based on a new R package I've been developing so the specific datasets
>> can be examined more closely.
>
> ?What do you mean by the raster losing data north of 46.6379 degrees?
> And what are you using to reproject? (Because a raster normally needs
> transforming to a new grid in the new CRS, spTransform wont do it).
>
> ?I see no problems doing an spTransform on a set of points in the
> range of your raster summary:
>
> pts=data.frame(x=seq(-16231.49,11313351,len=30),y=seq(-16231.5,8976020,len=30),z=1:30)
> coordinates(pts)=~x+y
> proj4string(pts)="+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107
> +x_0=5632642 +y_0=4612546 +ellps=WGS84"
> spTransform(pts,CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
> +towgs84=0,0,0"))
>
> gives me 30 points with no NA's or anything unexpected...
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Sat Nov 13 07:44:51 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 12 Nov 2010 22:44:51 -0800
Subject: [R-sig-Geo] Pixel reference location?
In-Reply-To: <AANLkTinjcN+j3hKW=Aejd7VtXsE1ViUjF-SLTB49_aDC@mail.gmail.com>
References: <AANLkTinjcN+j3hKW=Aejd7VtXsE1ViUjF-SLTB49_aDC@mail.gmail.com>
Message-ID: <AANLkTi=VZu3MdA-mzjPqP2SgqNNAuDMeRGy9TPF3tCL0@mail.gmail.com>

Lyndon,

This is where I see that you use crop

to.crop <- raster(out.name)
cropped <- crop(to.crop, crop.img, filename = out.name, overwrite = TRUE)

You show crop.img and raster(out.name) _after_ this is run (so I do
not know what "to.crop" looks like; and that matters; I find what you
do confusing because your output is overwriting your input file
out.name). Anyway, you are surprised that the extent of the output and
crop.img not the same, right? I am guessing that this is as it should
be. Crop takes a subset (columns and rows) of an existing raster,
given an 'Extent' object you provide (in your case the Extent object
is extracted form the RasterLayer). If you provide an Exent that does
not match the coordinates of the rows and columns of a RasterLayer, it
is adjusted to the nearest rows/columns, as you can not have half
cells. So I am assuming that raster(out.name) (after the function) has
the same extent as "to.crop", and that it should be, because crop.img
is within half a cell.

Given all this, it also seems that what you really want is something
much simpler, rather than crop, just set the Extent to what it should
be:

extent(to.crop) <- extent(crop.img)

Other cases might use resample, but it seems that here all you need to
do is just set the values of the object's extent to what they should
be.

> was under the impression that raster refers to the upper left of the
> upper left pixel in defining the spatial extent, but I am getting

That is correct. raster uses the upper left, lower left, upper right,
and lower right of the entire structure (the extreme pixels if you
like).

Best, Robert

On Fri, Nov 12, 2010 at 9:12 AM, Lyndon Estes <lestes at princeton.edu> wrote:
> Dear R-Sig-Geo,
>
> I have a question regarding pixel referencing with the raster package,
> from which I am using the crop function to resize MODIS imagery. ?I
> was under the impression that raster refers to the upper left of the
> upper left pixel in defining the spatial extent, but I am getting
> results that seem to suggest that the center of the pixel is being
> used.
>
> What I am doing: I have written a function that calls the MODIS
> HEGtools to read-in, stitch, and reproject the image into an Albers
> Equal Area Conic projection. ?The HEGtool has the capacity to subset
> the image, but the resulting subset image is not well rectified with
> the result one gets when stitching two full size images together
> (probably because of how I have defined projection parameters), so I
> am instead adding an extra step that resizes the image with the crop
> function, using a subset of the image that I created using ENVI.
>
> Here are the values for the crop image:
>
> crop.img
> class ? ? ? : RasterLayer
> filename ? ?: MOD250m_extenttemplate
> nrow ? ? ? ?: 6116
> ncol ? ? ? ?: 4200
> ncell ? ? ? : 25687200
> min value ? : ?
> max value ? : ?
> projection ?: +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
> xmin ? ? ? ?: -120863.9
> xmax ? ? ? ?: 852092.8
> ymin ? ? ? ?: -497022.6
> ymax ? ? ? ?: 919787.6
> xres ? ? ? ?: 231.6564
> yres ? ? ? ?: 231.6564
>
> (Note the seemingly bizarre projection parameters, which is another
> story, and is created by the HEGtool, which is supposed to use WGS4,
> but instead seems to spit out NAD27).
>
> Now, after the crop function is run, my resulting cropped MODIS image
> ends up with the following parameters:
>
> raster(out.name)
> class ? ? ? : RasterLayer
> filename ? ?: MOD13Q1.A2005225.h20v11.mosaic4.NDVI.tif
> nrow ? ? ? ?: 6116
> ncol ? ? ? ?: 4200
> ncell ? ? ? : 25687200
> min value ? : ?
> max value ? : ?
> projection ?: +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
> xmin ? ? ? ?: -120748.1
> xmax ? ? ? ?: 852208.6
> ymin ? ? ? ?: -496906.8
> ymax ? ? ? ?: 919903.5
> xres ? ? ? ?: 231.6564
> yres ? ? ? ?: 231.6564
>
> Looking at the xmins of the two images, -120863.9 - -120748.1 =
> -115.8, which is equal to half a pixel. ?Same for the ymaxs.
>
> So, is this an issue of where in the pixel raster assigns the UL
> reference coordinate, and, if so, is there a way to specify how the
> reference is being done? ?If not, am I doing something else wrong?
>
> Thanks in advance for any advice (function code follows).
>
> Cheers, Lyndon
>
>
> ModStitch <- function(modpath, hegpath, modnames, cropimage) {
> # Uses the HEGtool from MODIS LPDAAC to read in, stitch, and reproject
> the MODIS NDVI and VI quality bands
> # References: http://spatial-analyst.net/book/MODIS_download_HR.R
> # Args:
> # ? modpath: Path to directory holding MODIS data
> # ? hegpath: Path to the HEGtool installation
> # ? modnames: Vector containing MODIS image names to process
> # ? crop image: A raster defining the extent to which the images
> should be resized
> # Returns:
> # ? Separate stitched MODIS NDVI and VI Quality bands, reprojected to
> Albers Equal Area conic (for South
> # ? Africa), saved as a GEOtiff
>
> ?# Set tool and environment variables
> ?hegtool ? ? ? ? <- paste(hegpath, "/heg/bin/hegtool", sep = "")
> ?grd.stitch.tool <- paste(hegpath, "/heg/bin/subset_stitch_grid", sep = "")
> ?pgs.loc ? ? ? ? <- paste(hegpath, "/heg/TOOLKIT_MTD", sep = "")
> ?mrt.data.loc ? ?<- paste(hegpath, "/heg/data", sep = "")
> ?Sys.setenv(PGSHOME = pgs.loc) ?# Environment variable for HEGtool
> ?Sys.setenv(MRTDATADIR = mrt.data.loc) ?# Environment variable for HEGtool
>
> ?# Set path to MODIS data directory
> ?setwd(modpath)
>
> ?# And process the specified MODIS images using hegtool to capture
> header file information
> ?mod.list <- vector("list", length(modnames)) ?# List to capture
> header file output
>
> ?# Call crop image
> ?crop.img <- raster(cropimage)
>
> ?# Create and capture HegHdr.hdr files
> ?for (i in 1:length(mod.list)) {
> ? ? ?system(paste(hegtool, "-h", modnames[i]), intern = FALSE, wait = TRUE)
> ? ? ?mod.list[[i]] <- scan("HegHdr.hdr", what = "character", sep = "\n",)
> ? ? ?names(mod.list)[i] <- modnames[i]
> ?}
>
> ?# Then stitch and reproject both the NDVI layers and the error flag layers
>
> ?# Set up a couple of variables
> ?which.var <- c("250m 16 days NDVI|", "250m 16 days VI Quality|")
> ?which.abb <- c("NDVI", "qual")
>
> ?for(k in 1:length(which.var)) { ?# Loop through NDVI, then VI
>
> ? ?# First write the stitch parameters file
>
> ? ?# Stitch parameter file name
> ? ?pr.name ?<- paste("stitch_", k, ".prm", sep = "") ?# 1 = stitch
> for NDVI, 2 for VI quality
> ? ?out.name <- paste(substr(modnames[1], 1, 23), ".mosaic4.",
> which.abb[k],".tif", sep = "")
>
> ? ?# Open connection to write stitch file
> ? ?filename <- file(pr.name, open = "wt")
> ? ?write("", filename, append = TRUE)
> ? ?write("NUM_RUNS = 1", filename, append = TRUE) ?# Not sure if this
> needs to be a variable
> ? ?write("", filename, append = TRUE)
> ? ?write("BEGIN", filename, append = TRUE)
> ? ?write("NUMBER_INPUTFILES = 2",filename, append = TRUE) ?# Alter
> this if more than 1 file is to be stitched
> ? ?write(paste("INPUT_FILENAMES = ", modnames[1], "|", modnames[2],
> sep = ""), filename, append = TRUE)
> ? ?write("OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|", filename,
> append = TRUE)
> ? ?write(paste("FIELD_NAME = ", which.var[k], sep = ""), filename,
> append = TRUE)
> ? ?write("BAND_NUMBER = 1", filename, append = TRUE)
>
> ? ?# Pulls coordinates for upper left from first header file
> ? ?write(paste("SPATIAL_SUBSET_UL_CORNER = ", "( ",
> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_UL_CORNER_LATLON=",
> mod.list[[1]])], 23, 48), " )", sep = ""),
> ? ? ? ? ?filename, append = TRUE)
>
> ? ?# Pulls coordinates for lower right from last header file
> ? ?write(paste("SPATIAL_SUBSET_LR_CORNER = ", "( ",
>
> substr(mod.list[[length(mod.list)]][grep("GRID_LR_CORNER_LATLON=",
> ? ? ? ? ? ? ? ? ?mod.list[[length(mod.list)]])], 23, 48), " )", sep = ""),
> ? ? ? ? ?filename, append = TRUE)
>
> ? ?write("OUTPUT_OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|",
> filename, append = TRUE)
> ? ?write(paste("OUTGRID_X_PIXELSIZE = ",
> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
> mod.list[[1]])], 17, 26), sep = ""),
> ? ? ? ? ?filename, append = TRUE)
> ? ?write(paste("OUTGRID_Y_PIXELSIZE = ",
> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
> mod.list[[1]])], 17, 26), sep = ""),
> ? ? ? ? ?filename, append = TRUE)
> ? ?write(paste("OUTPUT_FILENAME = ", out.name, sep = ""), filename,
> append = TRUE)
> ? ?write("SAVE_STITCHED_FILE = NO", filename, append = TRUE)
> ? ?write(paste("OUTPUT_STITCHED_FILENAME = sasquatch", k, ".hdf", sep
> = ""), filename, append = TRUE)
> ? ?write("OUTPUT_TYPE = GEO", filename, append = TRUE)
> ? ?write("RESAMPLING_TYPE = NN", filename, append = TRUE)
> ? ?write("OUTPUT_PROJECTION_TYPE = ALBERS", filename, append = TRUE)
> ? ?write("OUTPUT_PROJECTION_PARAMETERS = ( 0.0 0.0 -18.0 -32.0 24.0
> 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ?)",
> ? ? ? ? ?filename, append = TRUE)
> ? ?write("END", filename, append = TRUE)
> ? ?write("", filename, append = TRUE)
> ? ?close(filename)
>
> ? ?# Then call the stitch tool and process it
> ? ?stitch.com <- paste(grd.stitch.tool, "-P", pr.name)
> ? ?system(stitch.com) ?# Works
>
> ? ?# Then use Raster function to resize because subsetting with MODIS
> tool results in offset
> ? ?to.crop <- raster(out.name)
> ? ?cropped <- crop(to.crop, crop.img, filename = out.name, overwrite
> = TRUE) ?# Overwrites existing images
> ?} ?# Close loop
> } ?# End function
>
> ModStitch(modpath = path.ndvi.dat, hegpath = hegpath, modnames =
> modnames, cropimage = envi.img)
>
>
>
>
>
>
>
>
>
>
> --
> Lyndon Estes
> Research Associate
> Woodrow Wilson School
> Princeton University
> +1-609-258-2392 (o)
> +1-609-258-6082 (f)
> +1-202-431-0496 (m)
> lestes at princeton.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From kevinummel at gmail.com  Sat Nov 13 12:58:42 2010
From: kevinummel at gmail.com (Kevin Ummel)
Date: Sat, 13 Nov 2010 11:58:42 +0000
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
Message-ID: <6CA7EEF6-4B56-4CE8-9006-2DE3F00E015B@gmail.com>

Hello,

I came across the 'animate' package, and I'm wondering if anyone has successfully adapted it to create animations of multi-layered spatial data.

This seems like a logical advance of R's spatial data visualization, especially given the prominence of NetCDF and HDR file types, but I don't want to replicate if someone else already has a function in working order...

Cheers,
Kevin

Kevin Ummel
Senior Visiting Associate, Center for Global Development
MESPOM Candidate, University of Manchester


From brwin338 at aol.com  Sat Nov 13 20:52:29 2010
From: brwin338 at aol.com (brwin338 at aol.com)
Date: Sat, 13 Nov 2010 14:52:29 -0500
Subject: [R-sig-Geo] merging polygons from two shapefiles and generating new
 polygons for intersecting areas
Message-ID: <8CD51836FE2911B-124C-C1D7@webmail-m048.sysops.aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101113/2ae026f5/attachment.pl>

From lestes at princeton.edu  Sat Nov 13 20:58:23 2010
From: lestes at princeton.edu (Lyndon Estes)
Date: Sat, 13 Nov 2010 14:58:23 -0500
Subject: [R-sig-Geo] Pixel reference location?
In-Reply-To: <AANLkTi=VZu3MdA-mzjPqP2SgqNNAuDMeRGy9TPF3tCL0@mail.gmail.com>
References: <AANLkTinjcN+j3hKW=Aejd7VtXsE1ViUjF-SLTB49_aDC@mail.gmail.com>
	<AANLkTi=VZu3MdA-mzjPqP2SgqNNAuDMeRGy9TPF3tCL0@mail.gmail.com>
Message-ID: <AANLkTimBOe82XMzmujU5GJ_y9J8iu-J6DN3sv57D=TiC@mail.gmail.com>

Hi Robert,

Thanks for your response, and I am sorry I did not post the values for
"to.crop". Please see my responses below interspersed with your text.

> Lyndon,
>
> This is where I see that you use crop
>
> to.crop <- raster(out.name)
> cropped <- crop(to.crop, crop.img, filename = out.name, overwrite = TRUE)
>
> You show crop.img and raster(out.name) _after_ this is run (so I do
> not know what "to.crop" looks like; and that matters;

Here are to.crop's values:

to.crop
class       : RasterLayer
filename    MOD13Q1.A2005225.h20v11.mosaic4.NDVI.tif
nrow        : 9872
ncol        : 6976
ncell       : 68867072
min value   : ?
max value   : ?
projection  : +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
+x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
+nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
xmin        : -283139.2
xmax        : 1332896
ymin        : -1172417
ymax        : 1114495
xres        : 231.6564
yres        : 231.6564

Interestingly, in both ENVI and ArcGIS the coordinate pair for the
upper left is listed as:

-283255.040, 1114610.641

In ArcGIS, I can tell that ArcGIS ascribes these coordinates to the
upper left corner of the pixel, where the o's below roughly describe
the outline of a pixel (in the hopes that the formatting makes it
through clearly):

xoooooo
ooooooo
ooooooo

where the x is located.

In ENVI, when I open the image in question, it tells me that the
Albers coordinate pair -283255.040, 1114610.641 is tied to the image
coordinates of 1.5, 1.5, which should be the center of the pixel.

ooooooo
oooxooo
ooooooo

I find what you
> do confusing because your output is overwriting your input file
> out.name).

Yes, I suppose that is bad practice.  I was trying to cut down on disk
storage space, but I probably should write a new file and then use
file.remove to get rid of the larger image (which is about 1/3 ocean).

Anyway, you are surprised that the extent of the output and
> crop.img not the same, right? I am guessing that this is as it should
> be. Crop takes a subset (columns and rows) of an existing raster,
> given an 'Extent' object you provide (in your case the Extent object
> is extracted form the RasterLayer). If you provide an Exent that does
> not match the coordinates of the rows and columns of a RasterLayer, it
> is adjusted to the nearest rows/columns, as you can not have half
> cells. So I am assuming that raster(out.name) (after the function) has
> the same extent as "to.crop", and that it should be, because crop.img
> is within half a cell.

I actually made the extent image out of "to.crop", by specifying
certain pixel coordinates in ENVI, but I now see that after making the
extent image, ENVI says that its image tie coordinates are 1, 1,
whereas to.crop's tie coordinates are 1.5, 1.5 (I had assumed that
they were at 1,1).  I suspect that it is this problem that I am seeing
after cropping with R. However, please see my last question below:

> That is correct. raster uses the upper left, lower left, upper right,
> and lower right of the entire structure (the extreme pixels if you
> like).

My question on this subject relates to the rough pixels I have
sketched above and the image tie coordinates (sorry if I was unclear).
 What I was curious to know is whether raster "thinks" that the
coordinate pair of

-283139.2, 1114495

is where the x is here (image coordinate 1,1, in case this doesn't
display well):

xoooooo
ooooooo
ooooooo

or here (image coordinate 1.5, 1.5)?

ooooooo
oooxooo
ooooooo

>
> Given all this, it also seems that what you really want is something
> much simpler, rather than crop, just set the Extent to what it should
> be:
>
> extent(to.crop) <- extent(crop.img)
>

Thanks, "extent" sounds much better, and I wasn't aware of it.

Thanks again for your help, and will appreciate any further
information on this last point of clarification regarding where R
references pixels (upper left or middle of pixel)?


Cheers, Lyndon



>
> On Fri, Nov 12, 2010 at 9:12 AM, Lyndon Estes <lestes at princeton.edu> wrote:
>> Dear R-Sig-Geo,
>>
>> I have a question regarding pixel referencing with the raster package,
>> from which I am using the crop function to resize MODIS imagery. ?I
>> was under the impression that raster refers to the upper left of the
>> upper left pixel in defining the spatial extent, but I am getting
>> results that seem to suggest that the center of the pixel is being
>> used.
>>
>> What I am doing: I have written a function that calls the MODIS
>> HEGtools to read-in, stitch, and reproject the image into an Albers
>> Equal Area Conic projection. ?The HEGtool has the capacity to subset
>> the image, but the resulting subset image is not well rectified with
>> the result one gets when stitching two full size images together
>> (probably because of how I have defined projection parameters), so I
>> am instead adding an extra step that resizes the image with the crop
>> function, using a subset of the image that I created using ENVI.
>>
>> Here are the values for the crop image:
>>
>> crop.img
>> class ? ? ? : RasterLayer
>> filename ? ?: MOD250m_extenttemplate
>> nrow ? ? ? ?: 6116
>> ncol ? ? ? ?: 4200
>> ncell ? ? ? : 25687200
>> min value ? : ?
>> max value ? : ?
>> projection ?: +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
>> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
>> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
>> xmin ? ? ? ?: -120863.9
>> xmax ? ? ? ?: 852092.8
>> ymin ? ? ? ?: -497022.6
>> ymax ? ? ? ?: 919787.6
>> xres ? ? ? ?: 231.6564
>> yres ? ? ? ?: 231.6564
>>
>> (Note the seemingly bizarre projection parameters, which is another
>> story, and is created by the HEGtool, which is supposed to use WGS4,
>> but instead seems to spit out NAD27).
>>
>> Now, after the crop function is run, my resulting cropped MODIS image
>> ends up with the following parameters:
>>
>> raster(out.name)
>> class ? ? ? : RasterLayer
>> filename ? ?: MOD13Q1.A2005225.h20v11.mosaic4.NDVI.tif
>> nrow ? ? ? ?: 6116
>> ncol ? ? ? ?: 4200
>> ncell ? ? ? : 25687200
>> min value ? : ?
>> max value ? : ?
>> projection ?: +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
>> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
>> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
>> xmin ? ? ? ?: -120748.1
>> xmax ? ? ? ?: 852208.6
>> ymin ? ? ? ?: -496906.8
>> ymax ? ? ? ?: 919903.5
>> xres ? ? ? ?: 231.6564
>> yres ? ? ? ?: 231.6564
>>
>> Looking at the xmins of the two images, -120863.9 - -120748.1 =
>> -115.8, which is equal to half a pixel. ?Same for the ymaxs.
>>
>> So, is this an issue of where in the pixel raster assigns the UL
>> reference coordinate, and, if so, is there a way to specify how the
>> reference is being done? ?If not, am I doing something else wrong?
>>
>> Thanks in advance for any advice (function code follows).
>>
>> Cheers, Lyndon
>>
>>
>> ModStitch <- function(modpath, hegpath, modnames, cropimage) {
>> # Uses the HEGtool from MODIS LPDAAC to read in, stitch, and reproject
>> the MODIS NDVI and VI quality bands
>> # References: http://spatial-analyst.net/book/MODIS_download_HR.R
>> # Args:
>> # ? modpath: Path to directory holding MODIS data
>> # ? hegpath: Path to the HEGtool installation
>> # ? modnames: Vector containing MODIS image names to process
>> # ? crop image: A raster defining the extent to which the images
>> should be resized
>> # Returns:
>> # ? Separate stitched MODIS NDVI and VI Quality bands, reprojected to
>> Albers Equal Area conic (for South
>> # ? Africa), saved as a GEOtiff
>>
>> ?# Set tool and environment variables
>> ?hegtool ? ? ? ? <- paste(hegpath, "/heg/bin/hegtool", sep = "")
>> ?grd.stitch.tool <- paste(hegpath, "/heg/bin/subset_stitch_grid", sep = "")
>> ?pgs.loc ? ? ? ? <- paste(hegpath, "/heg/TOOLKIT_MTD", sep = "")
>> ?mrt.data.loc ? ?<- paste(hegpath, "/heg/data", sep = "")
>> ?Sys.setenv(PGSHOME = pgs.loc) ?# Environment variable for HEGtool
>> ?Sys.setenv(MRTDATADIR = mrt.data.loc) ?# Environment variable for HEGtool
>>
>> ?# Set path to MODIS data directory
>> ?setwd(modpath)
>>
>> ?# And process the specified MODIS images using hegtool to capture
>> header file information
>> ?mod.list <- vector("list", length(modnames)) ?# List to capture
>> header file output
>>
>> ?# Call crop image
>> ?crop.img <- raster(cropimage)
>>
>> ?# Create and capture HegHdr.hdr files
>> ?for (i in 1:length(mod.list)) {
>> ? ? ?system(paste(hegtool, "-h", modnames[i]), intern = FALSE, wait = TRUE)
>> ? ? ?mod.list[[i]] <- scan("HegHdr.hdr", what = "character", sep = "\n",)
>> ? ? ?names(mod.list)[i] <- modnames[i]
>> ?}
>>
>> ?# Then stitch and reproject both the NDVI layers and the error flag layers
>>
>> ?# Set up a couple of variables
>> ?which.var <- c("250m 16 days NDVI|", "250m 16 days VI Quality|")
>> ?which.abb <- c("NDVI", "qual")
>>
>> ?for(k in 1:length(which.var)) { ?# Loop through NDVI, then VI
>>
>> ? ?# First write the stitch parameters file
>>
>> ? ?# Stitch parameter file name
>> ? ?pr.name ?<- paste("stitch_", k, ".prm", sep = "") ?# 1 = stitch
>> for NDVI, 2 for VI quality
>> ? ?out.name <- paste(substr(modnames[1], 1, 23), ".mosaic4.",
>> which.abb[k],".tif", sep = "")
>>
>> ? ?# Open connection to write stitch file
>> ? ?filename <- file(pr.name, open = "wt")
>> ? ?write("", filename, append = TRUE)
>> ? ?write("NUM_RUNS = 1", filename, append = TRUE) ?# Not sure if this
>> needs to be a variable
>> ? ?write("", filename, append = TRUE)
>> ? ?write("BEGIN", filename, append = TRUE)
>> ? ?write("NUMBER_INPUTFILES = 2",filename, append = TRUE) ?# Alter
>> this if more than 1 file is to be stitched
>> ? ?write(paste("INPUT_FILENAMES = ", modnames[1], "|", modnames[2],
>> sep = ""), filename, append = TRUE)
>> ? ?write("OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|", filename,
>> append = TRUE)
>> ? ?write(paste("FIELD_NAME = ", which.var[k], sep = ""), filename,
>> append = TRUE)
>> ? ?write("BAND_NUMBER = 1", filename, append = TRUE)
>>
>> ? ?# Pulls coordinates for upper left from first header file
>> ? ?write(paste("SPATIAL_SUBSET_UL_CORNER = ", "( ",
>> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_UL_CORNER_LATLON=",
>> mod.list[[1]])], 23, 48), " )", sep = ""),
>> ? ? ? ? ?filename, append = TRUE)
>>
>> ? ?# Pulls coordinates for lower right from last header file
>> ? ?write(paste("SPATIAL_SUBSET_LR_CORNER = ", "( ",
>>
>> substr(mod.list[[length(mod.list)]][grep("GRID_LR_CORNER_LATLON=",
>> ? ? ? ? ? ? ? ? ?mod.list[[length(mod.list)]])], 23, 48), " )", sep = ""),
>> ? ? ? ? ?filename, append = TRUE)
>>
>> ? ?write("OUTPUT_OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|",
>> filename, append = TRUE)
>> ? ?write(paste("OUTGRID_X_PIXELSIZE = ",
>> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
>> mod.list[[1]])], 17, 26), sep = ""),
>> ? ? ? ? ?filename, append = TRUE)
>> ? ?write(paste("OUTGRID_Y_PIXELSIZE = ",
>> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
>> mod.list[[1]])], 17, 26), sep = ""),
>> ? ? ? ? ?filename, append = TRUE)
>> ? ?write(paste("OUTPUT_FILENAME = ", out.name, sep = ""), filename,
>> append = TRUE)
>> ? ?write("SAVE_STITCHED_FILE = NO", filename, append = TRUE)
>> ? ?write(paste("OUTPUT_STITCHED_FILENAME = sasquatch", k, ".hdf", sep
>> = ""), filename, append = TRUE)
>> ? ?write("OUTPUT_TYPE = GEO", filename, append = TRUE)
>> ? ?write("RESAMPLING_TYPE = NN", filename, append = TRUE)
>> ? ?write("OUTPUT_PROJECTION_TYPE = ALBERS", filename, append = TRUE)
>> ? ?write("OUTPUT_PROJECTION_PARAMETERS = ( 0.0 0.0 -18.0 -32.0 24.0
>> 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ?)",
>> ? ? ? ? ?filename, append = TRUE)
>> ? ?write("END", filename, append = TRUE)
>> ? ?write("", filename, append = TRUE)
>> ? ?close(filename)
>>
>> ? ?# Then call the stitch tool and process it
>> ? ?stitch.com <- paste(grd.stitch.tool, "-P", pr.name)
>> ? ?system(stitch.com) ?# Works
>>
>> ? ?# Then use Raster function to resize because subsetting with MODIS
>> tool results in offset
>> ? ?to.crop <- raster(out.name)
>> ? ?cropped <- crop(to.crop, crop.img, filename = out.name, overwrite
>> = TRUE) ?# Overwrites existing images
>> ?} ?# Close loop
>> } ?# End function
>>
>> ModStitch(modpath = path.ndvi.dat, hegpath = hegpath, modnames =
>> modnames, cropimage = envi.img)
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> --
>> Lyndon Estes
>> Research Associate
>> Woodrow Wilson School
>> Princeton University
>> +1-609-258-2392 (o)
>> +1-609-258-6082 (f)
>> +1-202-431-0496 (m)
>> lestes at princeton.edu
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>



-- 
Lyndon Estes
Research Associate
Woodrow Wilson School
Princeton University
+1-609-258-2392 (o)
+1-609-258-6082 (f)
+1-202-431-0496 (m)
lestes at princeton.edu


From kmcoulib at gmail.com  Sun Nov 14 00:19:54 2010
From: kmcoulib at gmail.com (kapo coulibaly)
Date: Sat, 13 Nov 2010 18:19:54 -0500
Subject: [R-sig-Geo] geoR interpolation with log transform
Message-ID: <AANLkTimV_zfK_9G1RxLHJFZ+irZUMNujYj_sGnSyccmP@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101113/aef6ed61/attachment.pl>

From moshersteven at gmail.com  Sun Nov 14 01:24:07 2010
From: moshersteven at gmail.com (steven mosher)
Date: Sat, 13 Nov 2010 16:24:07 -0800
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <6CA7EEF6-4B56-4CE8-9006-2DE3F00E015B@gmail.com>
References: <6CA7EEF6-4B56-4CE8-9006-2DE3F00E015B@gmail.com>
Message-ID: <AANLkTikL-ni0A1-o2OHTUDYUTBB6a3veSp6rFGZT15cc@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101113/9816f9b5/attachment.pl>

From carson.farmer at gmail.com  Sun Nov 14 01:41:03 2010
From: carson.farmer at gmail.com (Carson J Q Farmer)
Date: Sun, 14 Nov 2010 00:41:03 +0000
Subject: [R-sig-Geo] merging polygons from two shapefiles and generating
	new polygons for intersecting areas
In-Reply-To: <8CD51836FE2911B-124C-C1D7@webmail-m048.sysops.aol.com>
References: <8CD51836FE2911B-124C-C1D7@webmail-m048.sysops.aol.com>
Message-ID: <A7383A8E-7F51-4E30-AB06-3AB23A0367C8@gmail.com>

Does this operation *have* to be done in R? Sounds an awful lot like a GIS would have no problem with this type of operation... Try QGIS, it's free, and has several overlay functions. Plus there are plugins available to connect it with R.

Carson

On 13 Nov 2010, at 07:52 p.m., brwin338 at aol.com wrote:

> 
> 
> 
> Good Afternoon:
> 
> I have spent a good part of today searching the discussion list and reading "Applied Spatial Data Analysis with R" and can't seem to find how to do the following:
> 
> One of my colleague's grad students has two shapefiles.  The first shapefile contains local polygons with associated local attribute data.  The second shapefile consists of US county polygons and attribute data for each county.   The first shapefile's polygon boundaries do not correspond to county boundaries i.e. the local polygon be a subset of one county or may overlay more than one county.  The student's immediate needs are to be able to compute how many square miles each local polygon has in each county.  For example local polygon 1 might have 10, 5, and 2.5 square miles in counties 12,15, and 24 respectively. 
> 
> This brings me to my larger question.  Does anyone have R code or know of an R package that would allow us to merge the polygons from the two shapefiles into a new set of polygons (and eventually create a new shapefile) that preserves all the polygon boundaries of both original shapefiles?  We would also like to have an associated attribute data file that preserves all the original attribute data.
> 
> Suppose that attribute data for the first and second shapefiles looks like:
> 
> shapefile1 (plots of land):
> polygon,  name
> 1,              A
> 2,              B
> 3,              C
> ....
> 
> 
> shapefile2 (California counties):
> polygon,  sfips,   cfips,   name
> 1,                6,    06051,  Mono
> 2,                6,    06019,  Fresno
> 3,                6,    06107,  Tulare
> 4,                6,    06027,   Inyo
> ?.
> 
> I want to merge or overlay shapefile 1 onto shapefile2
> 
> Assume that plot A's land is a subset of Mono county, plot B has land in Mono, Fresno, and Inyo counties in California as well as land in Nevada that does not overlay any of my California shapes. Plot C has land in Inyo and Tulare counties.  I would like to have a new shapefile with merged polygons and with merged attribute data like:
> 
> polygon,   polygon.x,   name.x,   polygon.y,    sfips.y,    cfips.y,    name.y
> 1,              1,                A,            1,                  6,             06051,    Mono
> 2,              2,                B,            1,                  6,             06051,    Mono
> 3,              2,                B,            2,                  6,             06019,    Fresno
> 4,              2,                B,            4,                  6,             06027,    Inyo
> 5,              2,                B,          NA,               NA,                 NA,    NA
> 6,              3,                C,            3,                  6,             06107,    Tulare
> 7,              3,                C,            4,                  6,             06027,    Inyo
> ?.
> 
> If I can create and save the such a new shapefile, I know how to use the geosphere package to calculate the areas of each of my new polygons and hence can compute the area that each local polygon has in any given county.
> 
> Does anyone know how I can merge the two shapefiles like this?  
> Thanks
> Joe
> 
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Sun Nov 14 01:48:20 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 13 Nov 2010 16:48:20 -0800
Subject: [R-sig-Geo] Pixel reference location?
In-Reply-To: <AANLkTimBOe82XMzmujU5GJ_y9J8iu-J6DN3sv57D=TiC@mail.gmail.com>
References: <AANLkTinjcN+j3hKW=Aejd7VtXsE1ViUjF-SLTB49_aDC@mail.gmail.com>
	<AANLkTi=VZu3MdA-mzjPqP2SgqNNAuDMeRGy9TPF3tCL0@mail.gmail.com>
	<AANLkTimBOe82XMzmujU5GJ_y9J8iu-J6DN3sv57D=TiC@mail.gmail.com>
Message-ID: <AANLkTineoPxkp3rDLfGC_6SMohPFkUEJdVTG6QD7UqAR@mail.gmail.com>

Hi Lyndon,

That clarifies what happens with 'crop' I think; but the different
georeferencing info you get from Arc and ENVI is puzzling. Your
question about georeferencing was clear, but my answer was not.
Another try: raster uses the extreme of the extreme cells for
georeferencing as in:

xoooo
ooooo
ooooo

i.e. (1,1), not (1.5, 1.5)

However, you say that Arc & ENVI put the coordinates half a cell
beyond where raster puts them (and now I understand where your
question came from), this is pretty serious as it suggest that they
are reading something different in the file. Could you send me the
file?


The cropping part:

to.crop <- raster(nrow=9872, ncol=6976, xmn = -283139.2, xmx =
1332896, ymn = -1172417, ymx = 1114495)
crop.img <- raster(nrow=6116, ncol=4200,  xmn = -120863.9, xmx =
852092.8, ymn = -497022.6, ymx = 919787.6)

# What happens here:
cropped <- crop(to.crop, crop.img)
# is:
#1) get the intersection of to.crop and crop.img
e = intersectExtent(to.crop, crop.img)
#2) align the intersection with the raster that needs to be cropped
ee = alignExtent(e, to.crop)
cropped <- crop(to.crop, ee)

I suggested to use the extent function but I am now less sure about
that because there seems to be something else going on.

Best, Robert


On Sat, Nov 13, 2010 at 11:58 AM, Lyndon Estes <lestes at princeton.edu> wrote:
> Hi Robert,
>
> Thanks for your response, and I am sorry I did not post the values for
> "to.crop". Please see my responses below interspersed with your text.
>
>> Lyndon,
>>
>> This is where I see that you use crop
>>
>> to.crop <- raster(out.name)
>> cropped <- crop(to.crop, crop.img, filename = out.name, overwrite = TRUE)
>>
>> You show crop.img and raster(out.name) _after_ this is run (so I do
>> not know what "to.crop" looks like; and that matters;
>
> Here are to.crop's values:
>
> to.crop
> class ? ? ? : RasterLayer
> filename ? ?MOD13Q1.A2005225.h20v11.mosaic4.NDVI.tif
> nrow ? ? ? ?: 9872
> ncol ? ? ? ?: 6976
> ncell ? ? ? : 68867072
> min value ? : ?
> max value ? : ?
> projection ?: +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
> xmin ? ? ? ?: -283139.2
> xmax ? ? ? ?: 1332896
> ymin ? ? ? ?: -1172417
> ymax ? ? ? ?: 1114495
> xres ? ? ? ?: 231.6564
> yres ? ? ? ?: 231.6564
>
> Interestingly, in both ENVI and ArcGIS the coordinate pair for the
> upper left is listed as:
>
> -283255.040, 1114610.641
>
> In ArcGIS, I can tell that ArcGIS ascribes these coordinates to the
> upper left corner of the pixel, where the o's below roughly describe
> the outline of a pixel (in the hopes that the formatting makes it
> through clearly):
>
> xoooooo
> ooooooo
> ooooooo
>
> where the x is located.
>
> In ENVI, when I open the image in question, it tells me that the
> Albers coordinate pair -283255.040, 1114610.641 is tied to the image
> coordinates of 1.5, 1.5, which should be the center of the pixel.
>
> ooooooo
> oooxooo
> ooooooo
>
> I find what you
>> do confusing because your output is overwriting your input file
>> out.name).
>
> Yes, I suppose that is bad practice. ?I was trying to cut down on disk
> storage space, but I probably should write a new file and then use
> file.remove to get rid of the larger image (which is about 1/3 ocean).

It was just confusing to debug, if it all works it might be OK

>
> Anyway, you are surprised that the extent of the output and
>> crop.img not the same, right? I am guessing that this is as it should
>> be. Crop takes a subset (columns and rows) of an existing raster,
>> given an 'Extent' object you provide (in your case the Extent object
>> is extracted form the RasterLayer). If you provide an Exent that does
>> not match the coordinates of the rows and columns of a RasterLayer, it
>> is adjusted to the nearest rows/columns, as you can not have half
>> cells. So I am assuming that raster(out.name) (after the function) has
>> the same extent as "to.crop", and that it should be, because crop.img
>> is within half a cell.
>
> I actually made the extent image out of "to.crop", by specifying
> certain pixel coordinates in ENVI, but I now see that after making the
> extent image, ENVI says that its image tie coordinates are 1, 1,
> whereas to.crop's tie coordinates are 1.5, 1.5 (I had assumed that
> they were at 1,1). ?I suspect that it is this problem that I am seeing
> after cropping with R. However, please see my last question below:
>
>> That is correct. raster uses the upper left, lower left, upper right,
>> and lower right of the entire structure (the extreme pixels if you
>> like).
>
> My question on this subject relates to the rough pixels I have
> sketched above and the image tie coordinates (sorry if I was unclear).
> ?What I was curious to know is whether raster "thinks" that the
> coordinate pair of
>
> -283139.2, 1114495
>
> is where the x is here (image coordinate 1,1, in case this doesn't
> display well):
>
> xoooooo
> ooooooo
> ooooooo
>
> or here (image coordinate 1.5, 1.5)?
>
> ooooooo
> oooxooo
> ooooooo
>
>>
>> Given all this, it also seems that what you really want is something
>> much simpler, rather than crop, just set the Extent to what it should
>> be:
>>
>> extent(to.crop) <- extent(crop.img)
>>
>
> Thanks, "extent" sounds much better, and I wasn't aware of it.
>
> Thanks again for your help, and will appreciate any further
> information on this last point of clarification regarding where R
> references pixels (upper left or middle of pixel)?
>
>
> Cheers, Lyndon
>
>
>
>>
>> On Fri, Nov 12, 2010 at 9:12 AM, Lyndon Estes <lestes at princeton.edu> wrote:
>>> Dear R-Sig-Geo,
>>>
>>> I have a question regarding pixel referencing with the raster package,
>>> from which I am using the crop function to resize MODIS imagery. ?I
>>> was under the impression that raster refers to the upper left of the
>>> upper left pixel in defining the spatial extent, but I am getting
>>> results that seem to suggest that the center of the pixel is being
>>> used.
>>>
>>> What I am doing: I have written a function that calls the MODIS
>>> HEGtools to read-in, stitch, and reproject the image into an Albers
>>> Equal Area Conic projection. ?The HEGtool has the capacity to subset
>>> the image, but the resulting subset image is not well rectified with
>>> the result one gets when stitching two full size images together
>>> (probably because of how I have defined projection parameters), so I
>>> am instead adding an extra step that resizes the image with the crop
>>> function, using a subset of the image that I created using ENVI.
>>>
>>> Here are the values for the crop image:
>>>
>>> crop.img
>>> class ? ? ? : RasterLayer
>>> filename ? ?: MOD250m_extenttemplate
>>> nrow ? ? ? ?: 6116
>>> ncol ? ? ? ?: 4200
>>> ncell ? ? ? : 25687200
>>> min value ? : ?
>>> max value ? : ?
>>> projection ?: +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
>>> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
>>> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
>>> xmin ? ? ? ?: -120863.9
>>> xmax ? ? ? ?: 852092.8
>>> ymin ? ? ? ?: -497022.6
>>> ymax ? ? ? ?: 919787.6
>>> xres ? ? ? ?: 231.6564
>>> yres ? ? ? ?: 231.6564
>>>
>>> (Note the seemingly bizarre projection parameters, which is another
>>> story, and is created by the HEGtool, which is supposed to use WGS4,
>>> but instead seems to spit out NAD27).
>>>
>>> Now, after the crop function is run, my resulting cropped MODIS image
>>> ends up with the following parameters:
>>>
>>> raster(out.name)
>>> class ? ? ? : RasterLayer
>>> filename ? ?: MOD13Q1.A2005225.h20v11.mosaic4.NDVI.tif
>>> nrow ? ? ? ?: 6116
>>> ncol ? ? ? ?: 4200
>>> ncell ? ? ? : 25687200
>>> min value ? : ?
>>> max value ? : ?
>>> projection ?: +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
>>> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
>>> +nadgrids=@conus, at alaska, at ntv2_0.gsb, at ntv1_can.dat
>>> xmin ? ? ? ?: -120748.1
>>> xmax ? ? ? ?: 852208.6
>>> ymin ? ? ? ?: -496906.8
>>> ymax ? ? ? ?: 919903.5
>>> xres ? ? ? ?: 231.6564
>>> yres ? ? ? ?: 231.6564
>>>
>>> Looking at the xmins of the two images, -120863.9 - -120748.1 =
>>> -115.8, which is equal to half a pixel. ?Same for the ymaxs.
>>>
>>> So, is this an issue of where in the pixel raster assigns the UL
>>> reference coordinate, and, if so, is there a way to specify how the
>>> reference is being done? ?If not, am I doing something else wrong?
>>>
>>> Thanks in advance for any advice (function code follows).
>>>
>>> Cheers, Lyndon
>>>
>>>
>>> ModStitch <- function(modpath, hegpath, modnames, cropimage) {
>>> # Uses the HEGtool from MODIS LPDAAC to read in, stitch, and reproject
>>> the MODIS NDVI and VI quality bands
>>> # References: http://spatial-analyst.net/book/MODIS_download_HR.R
>>> # Args:
>>> # ? modpath: Path to directory holding MODIS data
>>> # ? hegpath: Path to the HEGtool installation
>>> # ? modnames: Vector containing MODIS image names to process
>>> # ? crop image: A raster defining the extent to which the images
>>> should be resized
>>> # Returns:
>>> # ? Separate stitched MODIS NDVI and VI Quality bands, reprojected to
>>> Albers Equal Area conic (for South
>>> # ? Africa), saved as a GEOtiff
>>>
>>> ?# Set tool and environment variables
>>> ?hegtool ? ? ? ? <- paste(hegpath, "/heg/bin/hegtool", sep = "")
>>> ?grd.stitch.tool <- paste(hegpath, "/heg/bin/subset_stitch_grid", sep = "")
>>> ?pgs.loc ? ? ? ? <- paste(hegpath, "/heg/TOOLKIT_MTD", sep = "")
>>> ?mrt.data.loc ? ?<- paste(hegpath, "/heg/data", sep = "")
>>> ?Sys.setenv(PGSHOME = pgs.loc) ?# Environment variable for HEGtool
>>> ?Sys.setenv(MRTDATADIR = mrt.data.loc) ?# Environment variable for HEGtool
>>>
>>> ?# Set path to MODIS data directory
>>> ?setwd(modpath)
>>>
>>> ?# And process the specified MODIS images using hegtool to capture
>>> header file information
>>> ?mod.list <- vector("list", length(modnames)) ?# List to capture
>>> header file output
>>>
>>> ?# Call crop image
>>> ?crop.img <- raster(cropimage)
>>>
>>> ?# Create and capture HegHdr.hdr files
>>> ?for (i in 1:length(mod.list)) {
>>> ? ? ?system(paste(hegtool, "-h", modnames[i]), intern = FALSE, wait = TRUE)
>>> ? ? ?mod.list[[i]] <- scan("HegHdr.hdr", what = "character", sep = "\n",)
>>> ? ? ?names(mod.list)[i] <- modnames[i]
>>> ?}
>>>
>>> ?# Then stitch and reproject both the NDVI layers and the error flag layers
>>>
>>> ?# Set up a couple of variables
>>> ?which.var <- c("250m 16 days NDVI|", "250m 16 days VI Quality|")
>>> ?which.abb <- c("NDVI", "qual")
>>>
>>> ?for(k in 1:length(which.var)) { ?# Loop through NDVI, then VI
>>>
>>> ? ?# First write the stitch parameters file
>>>
>>> ? ?# Stitch parameter file name
>>> ? ?pr.name ?<- paste("stitch_", k, ".prm", sep = "") ?# 1 = stitch
>>> for NDVI, 2 for VI quality
>>> ? ?out.name <- paste(substr(modnames[1], 1, 23), ".mosaic4.",
>>> which.abb[k],".tif", sep = "")
>>>
>>> ? ?# Open connection to write stitch file
>>> ? ?filename <- file(pr.name, open = "wt")
>>> ? ?write("", filename, append = TRUE)
>>> ? ?write("NUM_RUNS = 1", filename, append = TRUE) ?# Not sure if this
>>> needs to be a variable
>>> ? ?write("", filename, append = TRUE)
>>> ? ?write("BEGIN", filename, append = TRUE)
>>> ? ?write("NUMBER_INPUTFILES = 2",filename, append = TRUE) ?# Alter
>>> this if more than 1 file is to be stitched
>>> ? ?write(paste("INPUT_FILENAMES = ", modnames[1], "|", modnames[2],
>>> sep = ""), filename, append = TRUE)
>>> ? ?write("OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|", filename,
>>> append = TRUE)
>>> ? ?write(paste("FIELD_NAME = ", which.var[k], sep = ""), filename,
>>> append = TRUE)
>>> ? ?write("BAND_NUMBER = 1", filename, append = TRUE)
>>>
>>> ? ?# Pulls coordinates for upper left from first header file
>>> ? ?write(paste("SPATIAL_SUBSET_UL_CORNER = ", "( ",
>>> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_UL_CORNER_LATLON=",
>>> mod.list[[1]])], 23, 48), " )", sep = ""),
>>> ? ? ? ? ?filename, append = TRUE)
>>>
>>> ? ?# Pulls coordinates for lower right from last header file
>>> ? ?write(paste("SPATIAL_SUBSET_LR_CORNER = ", "( ",
>>>
>>> substr(mod.list[[length(mod.list)]][grep("GRID_LR_CORNER_LATLON=",
>>> ? ? ? ? ? ? ? ? ?mod.list[[length(mod.list)]])], 23, 48), " )", sep = ""),
>>> ? ? ? ? ?filename, append = TRUE)
>>>
>>> ? ?write("OUTPUT_OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|",
>>> filename, append = TRUE)
>>> ? ?write(paste("OUTGRID_X_PIXELSIZE = ",
>>> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
>>> mod.list[[1]])], 17, 26), sep = ""),
>>> ? ? ? ? ?filename, append = TRUE)
>>> ? ?write(paste("OUTGRID_Y_PIXELSIZE = ",
>>> ? ? ? ? ? ? ? ?substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
>>> mod.list[[1]])], 17, 26), sep = ""),
>>> ? ? ? ? ?filename, append = TRUE)
>>> ? ?write(paste("OUTPUT_FILENAME = ", out.name, sep = ""), filename,
>>> append = TRUE)
>>> ? ?write("SAVE_STITCHED_FILE = NO", filename, append = TRUE)
>>> ? ?write(paste("OUTPUT_STITCHED_FILENAME = sasquatch", k, ".hdf", sep
>>> = ""), filename, append = TRUE)
>>> ? ?write("OUTPUT_TYPE = GEO", filename, append = TRUE)
>>> ? ?write("RESAMPLING_TYPE = NN", filename, append = TRUE)
>>> ? ?write("OUTPUT_PROJECTION_TYPE = ALBERS", filename, append = TRUE)
>>> ? ?write("OUTPUT_PROJECTION_PARAMETERS = ( 0.0 0.0 -18.0 -32.0 24.0
>>> 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ?)",
>>> ? ? ? ? ?filename, append = TRUE)
>>> ? ?write("END", filename, append = TRUE)
>>> ? ?write("", filename, append = TRUE)
>>> ? ?close(filename)
>>>
>>> ? ?# Then call the stitch tool and process it
>>> ? ?stitch.com <- paste(grd.stitch.tool, "-P", pr.name)
>>> ? ?system(stitch.com) ?# Works
>>>
>>> ? ?# Then use Raster function to resize because subsetting with MODIS
>>> tool results in offset
>>> ? ?to.crop <- raster(out.name)
>>> ? ?cropped <- crop(to.crop, crop.img, filename = out.name, overwrite
>>> = TRUE) ?# Overwrites existing images
>>> ?} ?# Close loop
>>> } ?# End function
>>>
>>> ModStitch(modpath = path.ndvi.dat, hegpath = hegpath, modnames =
>>> modnames, cropimage = envi.img)
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> --
>>> Lyndon Estes
>>> Research Associate
>>> Woodrow Wilson School
>>> Princeton University
>>> +1-609-258-2392 (o)
>>> +1-609-258-6082 (f)
>>> +1-202-431-0496 (m)
>>> lestes at princeton.edu
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
>
>
> --
> Lyndon Estes
> Research Associate
> Woodrow Wilson School
> Princeton University
> +1-609-258-2392 (o)
> +1-609-258-6082 (f)
> +1-202-431-0496 (m)
> lestes at princeton.edu
>


From paulojus at c3sl.ufpr.br  Sun Nov 14 02:18:52 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Sat, 13 Nov 2010 23:18:52 -0200 (BRST)
Subject: [R-sig-Geo] geoR interpolation with log transform
In-Reply-To: <AANLkTimV_zfK_9G1RxLHJFZ+irZUMNujYj_sGnSyccmP@mail.gmail.com>
References: <AANLkTimV_zfK_9G1RxLHJFZ+irZUMNujYj_sGnSyccmP@mail.gmail.com>
Message-ID: <alpine.DEB.2.00.1011132316190.23861@macalan.c3sl.ufpr.br>

Dear Kapo

I've replied your private message with some details
Let me add the "honouring the points" will dependes on which 
interpretation is given to the nugget (micro-scale variation measurement 
error or a combination of these)

In geoR there are arguments micro.scale and signal in n
krige.control() and output.control() respectivelly, to control such 
behaviour

Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
VOIP: (+55) (41) (3361 3600) 1053 1066
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Sat, 13 Nov 2010, kapo coulibaly wrote:

> I?m using geoR to interpolate hydraulic conductivities. I constructed the
> variogram using the log transform as follows:
>
> dummy.var<-variog(dummy.geo,max.dist=40000,uvec=25,lambda=0)   # Then I
> fitted a spherical model using eyefit parameters as starting parameters
>
> dummy.param<-eyefit(dummy.var)
>
> param1<-variofit(vario=dummy.var, ini.cov.pars=dummy.param[[1]]$cov.pars,
>
> cov.model = dummy.param[[1]]$cov.model,nugget=dummy.param[[1]]$nugget)
>
> spatPara<-krige.control(type.krige="ok",obj.model=param1)
>
> # I then interpolate across the map
>
> InterMap<-krige.conv(dummy.geo,loc=loc,krige=spatPara)
>
>
> Ma question is why are my interpolated values higher than the actual
> measurements. I expected the interpolation to honour measurement points at
> least. Am I missing something?
>
>
>
> Thanks
>
> 	[[alternative HTML version deleted]]
>
>


From lestes at princeton.edu  Sun Nov 14 05:54:01 2010
From: lestes at princeton.edu (Lyndon Estes)
Date: Sat, 13 Nov 2010 23:54:01 -0500
Subject: [R-sig-Geo] Pixel reference location?
In-Reply-To: <AANLkTineoPxkp3rDLfGC_6SMohPFkUEJdVTG6QD7UqAR@mail.gmail.com>
References: <AANLkTinjcN+j3hKW=Aejd7VtXsE1ViUjF-SLTB49_aDC@mail.gmail.com>
	<AANLkTi=VZu3MdA-mzjPqP2SgqNNAuDMeRGy9TPF3tCL0@mail.gmail.com>
	<AANLkTimBOe82XMzmujU5GJ_y9J8iu-J6DN3sv57D=TiC@mail.gmail.com>
	<AANLkTineoPxkp3rDLfGC_6SMohPFkUEJdVTG6QD7UqAR@mail.gmail.com>
Message-ID: <AANLkTinWqD+h33W9gkz=jhRqynNwO3ce6fuL2XX27N8D@mail.gmail.com>

Hi Robert,

Many thanks for helping further with this.

To send you files I produced, I setup a shared folder for you on our
webspace, which will have generated an email notification with a link
in it.  This should work for downloading.  This contains the image
that served as "to.crop" (MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif) and
"crop.img" (MOD250m_extenttemplate).

The original MODIS images can be obtained here.

f1 <- "ftp://e4ftl01.cr.usgs.gov/MOLT/MOD13Q1.005/2005.08.13/MOD13Q1.A2005225.h20v11.005.2008213005356.hdf"
f2 <- "ftp://e4ftl01.cr.usgs.gov/MOLT/MOD13Q1.005/2005.08.13/MOD13Q1.A2005225.h20v12.005.2008213055406.hdf"

download.file(f1, destfile = paste(testpath, BLOCK1, sep = ""))
download.file(f2, destfile = paste(testpath, BLOCK2, sep = ""))

If you want to try and recreate what I have done, the HEGtool for
MODIS is here:

# Download for HEGtool, should you want to use it
http://newsroom.gsfc.nasa.gov/sdptoolkit/HEG/HEGDownload.html

And then the code I used to process the data together with the HEGtool
follows.

# Conversion code

#ModStitch <- function(hegpath, modnames, cropimage) {
ModStitch <- function(hegpath, modnames) {
# Uses the HEGtool from MODIS LPDAAC to read in, stitch, and reproject
the MODIS NDVI and VI quality bands
# References: http://spatial-analyst.net/book/MODIS_download_HR.R
# Args:
#   modpath: Path to directory holding MODIS data
#   hegpath: Path to the HEGtool installation
#   modnames: Vector containing MODIS image names to process
#   ###crop image: A raster defining the extent to which the images
should be resized
# Returns:
#   Separate stitched MODIS NDVI and VI Quality bands, reprojected to
Albers Equal Area conic (for South
#   Africa), saved as a GEOtiff

  library(raster)

  # Set tool and environment variables
  hegtool         <- paste(hegpath, "/heg/bin/hegtool", sep = "")
  grd.stitch.tool <- paste(hegpath, "/heg/bin/subset_stitch_grid", sep = "")
  pgs.loc         <- paste(hegpath, "/heg/TOOLKIT_MTD", sep = "")
  mrt.data.loc    <- paste(hegpath, "/heg/data", sep = "")
  Sys.setenv(PGSHOME = pgs.loc)  # Environment variable for HEGtool
  Sys.setenv(MRTDATADIR = mrt.data.loc)  # Environment variable for HEGtool

  # Set path to MODIS data directory
  #setwd(modpath)

  # And process the specified MODIS images using hegtool to capture
header file information
  mod.list <- vector("list", length(modnames))  # List to capture
header file output

  # Call crop image
  #crop.img <- raster(cropimage)

  # Create and capture HegHdr.hdr files
  for (i in 1:length(mod.list)) {
      system(paste(hegtool, "-h", modnames[i]), intern = FALSE, wait = TRUE)
      mod.list[[i]] <- scan("HegHdr.hdr", what = "character", sep = "\n",)
      names(mod.list)[i] <- modnames[i]
  }

  # Then stitch and reproject both the NDVI layers and the error flag layers

  # Set up a couple of variables
  which.var <- c("250m 16 days NDVI|", "250m 16 days VI Quality|")
  which.abb <- c("NDVI", "qual")

  for(k in 1:length(which.var)) {  # Loop through NDVI, then VI

    # First write the stitch parameters file

    # Stitch parameter file name
    pr.name  <- paste("stitch_", k, ".prm", sep = "")  # 1 = stitch
for NDVI, 2 for VI quality
    out.name <- paste(substr(modnames[1], 1, 23), ".mosaic.",
which.abb[k],".tif", sep = "")

    # Open connection to write stitch file
    filename <- file(pr.name, open = "wt")
    write("", filename, append = TRUE)
    write("NUM_RUNS = 1", filename, append = TRUE)  # Not sure if this
needs to be a variable
    write("", filename, append = TRUE)
    write("BEGIN", filename, append = TRUE)
    write("NUMBER_INPUTFILES = 2",filename, append = TRUE)  # Alter
this if more than 1 file is to be stitched
    write(paste("INPUT_FILENAMES = ", modnames[1], "|", modnames[2],
sep = ""), filename, append = TRUE)
    write("OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|", filename,
append = TRUE)
    write(paste("FIELD_NAME = ", which.var[k], sep = ""), filename,
append = TRUE)
    write("BAND_NUMBER = 1", filename, append = TRUE)

    # Pulls coordinates for upper left from first header file (turn on
if want the whole image)
    write(paste("SPATIAL_SUBSET_UL_CORNER = ", "( ",
                substr(mod.list[[1]][grep("GRID_UL_CORNER_LATLON=",
mod.list[[1]])], 23, 48), " )", sep = ""),
          filename, append = TRUE)

    # Specified upper left corner pair (UL -21.74814913, 22.82538048)
    #write("SPATIAL_SUBSET_UL_CORNER = ( -21.74814913 22.82538048 )",
filename, append = TRUE)

    # Pulls coordinates for lower right from last header file (turn
this on if you want entire image)
    write(paste("SPATIAL_SUBSET_LR_CORNER = ", "( ",

substr(mod.list[[length(mod.list)]][grep("GRID_LR_CORNER_LATLON=",
                  mod.list[[length(mod.list)]])], 23, 48), " )", sep = ""),
          filename, append = TRUE)

    # Specified lower right coordinate pair (LR  -34.22328403,  33.19532794)
    #write("SPATIAL_SUBSET_LR_CORNER = ( -34.22328403 33.19532794 )",
filename, append = TRUE)

    write("OUTPUT_OBJECT_NAME = MODIS_Grid_16DAY_250m_500m_VI|",
filename, append = TRUE)
    write(paste("OUTGRID_X_PIXELSIZE = ",
                substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
mod.list[[1]])], 17, 26), sep = ""),
          filename, append = TRUE)
    write(paste("OUTGRID_Y_PIXELSIZE = ",
                substr(mod.list[[1]][grep("GRID_PIXEL_SIZE=",
mod.list[[1]])], 17, 26), sep = ""),
          filename, append = TRUE)
    write(paste("OUTPUT_FILENAME = ", out.name, sep = ""), filename,
append = TRUE)
    write("SAVE_STITCHED_FILE = NO", filename, append = TRUE)
    write(paste("OUTPUT_STITCHED_FILENAME = sasquatch", k, ".hdf", sep
= ""), filename, append = TRUE)
    write("OUTPUT_TYPE = GEO", filename, append = TRUE)
    write("RESAMPLING_TYPE = NN", filename, append = TRUE)
    write("OUTPUT_PROJECTION_TYPE = ALBERS", filename, append = TRUE)
    write("OUTPUT_PROJECTION_PARAMETERS = ( 0.0 0.0 -18.0 -32.0 24.0
0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0  )",
          filename, append = TRUE)
    write("END", filename, append = TRUE)
    write("", filename, append = TRUE)
    close(filename)

    # Then call the stitch tool and process it
    stitch.com <- paste(grd.stitch.tool, "-P", pr.name)
    system(stitch.com)  # Works

    # Turning this off for now because it appears to be shifting the
output image by referencing the center of
    # the pixel.
    # Then use Raster function to resize because subsetting with MODIS
tool results in offset
    #to.crop <- raster(out.name)
    #cropped <- crop(to.crop, crop.img, filename = out.name, overwrite
= TRUE)  # Overwrites existing images

    # Try trim the image instead (doesn't work')
    #to.trim <- raster(out.name)
    #NAvalue(to.trim) <- -1  # Define NA values as less than 0
    #print(paste("Starting raster trim for", which.var[k]))
    #out.name2 <- paste("trim", out.name, sep = "")
    #trim(to.trim, filename = out.name2, overwrite = TRUE, format = "GTiff")
    #print(paste("Finished raster trim for", which.var[k]))
  }  # Close loop
}  # End function

setwd(testpath)  # Set to directory where MODIS imagery is.
ModStitch(hegpath = hegpath, modnames = modnames)  # Crop component turned off

Many thanks, and I look forward to hearing what you find.

Cheers, Lyndon

-- 
Lyndon Estes
Research Associate
Woodrow Wilson School
Princeton University
+1-609-258-2392 (o)
+1-609-258-6082 (f)
+1-202-431-0496 (m)
lestes at princeton.edu


From r.hijmans at gmail.com  Sun Nov 14 08:27:09 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 13 Nov 2010 23:27:09 -0800
Subject: [R-sig-Geo] Georerferncing in Arc vs rgdal (and raster):
	AREA_OR_POINT=Point
Message-ID: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>

List,

Lyndon Estes asked questions about georeferencing and the use of
'crop' in raster, while pointing out differences in georeferencing
between Arc (and ENVI) vs raster (and rgdal). I start a new thread to
focus on the georeferencing issue. I think there is something going
seriously wrong.

GDAL supports metadata ( http://www.gdal.org/gdal_datamodel.html ).
One of the items is "AREA_OR_POINT" which may be either "Area" (the
default) or "Point". This "Indicates whether a pixel value should be
assumed to represent a sampling over the region of the pixel or a
point sample at the center of the pixel. This is not intended to
influence interpretation of georeferencing which remains area
oriented."

The file Lyndon send me ("MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif")
has AREA_OR_POINT=Point (reported by rgdal, see further below). This
is ignored by rgdal and raster (as it should). However, it appears
that ArcMap version 9.3 (and ENVI?) does not ignore this flag and
changes the georeference.

> #this is what arc reports
> arc <- extent(-283255.039878, 1332779.71537, -1172300.9282, 1114610.64058)
> extent(arc)
class       : Extent
xmin        : -283255.0
xmax        : 1332780
ymin        : -1172301
ymax        : 1114611
>
> # make a RasterLayer of the file
> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
> extent(r1)
class       : Extent
xmin        : -283139.2
xmax        : 1332896
ymin        : -1172417
ymax        : 1114495
>
> # different by half a cell
> res(r1)
[1] 231.6564 231.6564
>

The weird thing is that Arc seems to correct (which I think it should
not) and then makes a mistake in the correction. This is how you can
get the georeference that Arc has:

> xmin(r1) - 0.5 * xres(r1)
[1] -283255.0
> xmax(r1) - 0.5 * xres(r1)
[1] 1332780
> ymin(r1) + 0.5 * yres(r1)
[1] -1172301
> ymax(r1) + 0.5 * yres(r1)
[1] 1114611
>

I.e., shifting the xmin AND xmax half a cell to the left, and the ymin
AND ymax half a cell up. It makes no sense to do that as you would
want to shift the xmin to the left and the xmax to the right to go
from center-of-cell georeferencing to extreme-of -cell georeferencing.

With recent versions of raster, you can do this correction like this (
not documented, sorry ):

> r2 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif', fixGeoref=TRUE)
> extent(r2)
class       : Extent
xmin        : -283255.1
xmax        : 1333011
ymin        : -1172533
ymax        : 1114611
>

And now we have the same xmin and ymax as Arc, but the xmax and ymin
are different (and I believe raster is right here)

When I save the data as a new geotiff file, and by default, with no
AREA_OR_POINT=Area

r3 <- writeRaster(r1, filename='test.tif')

Arc and rgdal/raster agree again. That suggests that it is this flag
that matters, but perhaps there is something else in the file to which
Arc responds?

Does anyone have any insights, thoughts? Did I miss something simple?
Or does Arc have a "standard" (perhaps shared with many others?) that
we should be aware of?

More details below

Robert


> GDALinfo('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
rows        9872
columns     6976
bands       1
origin.x        -283139.2
origin.y        -1172417
res.x       231.6564
res.y       231.6564
ysign       -1
oblique.x   0
oblique.y   0
driver      GTiff
projection  +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
+x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
file        MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif
apparent band summary:
  GDType   Bmin  Bmax Bmean Bsd
1  Int16 -32768 32767     0   0
Metadata:
TIFFTAG_SOFTWARE=HEG-Modis Reprojection Tool  Nov 4, 2004
AREA_OR_POINT=Point
Warning message:
statistics not supported by this driver
>



# this is how the I fix the georeferences to go from centre to extreme
based, with x being a Raster object
	if (fixGeoref) {
		xx <- x
		nrow(xx) <- nrow(xx) - 1
		ncol(xx) <- ncol(xx) - 1
		rs <- res(xx)
		xmin(x) <- xmin(x) - 0.5 * rs[1]
		xmax(x) <- xmax(x) + 0.5 * rs[1]
		ymin(x) <- ymin(x) - 0.5 * rs[2]
		ymax(x) <- ymax(x) + 0.5 * rs[2]
	}


From rundel at gmail.com  Sun Nov 14 09:53:12 2010
From: rundel at gmail.com (rundel)
Date: Sun, 14 Nov 2010 00:53:12 -0800 (PST)
Subject: [R-sig-Geo] merging polygons from two shapefiles and generating
 new polygons for intersecting areas
In-Reply-To: <8CD51836FE2911B-124C-C1D7@webmail-m048.sysops.aol.com>
References: <8CD51836FE2911B-124C-C1D7@webmail-m048.sysops.aol.com>
Message-ID: <1289724792745-5737105.post@n2.nabble.com>


You should be able to achieve all of this using the rgeos package, it has
functionality to create new polygons based on the intersection, union, etc
of other polygons. 

Currently you can download the source from r-forge and install the package
manually, but it will also be available on cran in the very near future. If
you run into any difficulties or have questions, please let me know.

-Colin
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/merging-polygons-from-two-shapefiles-and-generating-new-polygons-for-intersecting-areas-tp5736049p5737105.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From lestes at princeton.edu  Sun Nov 14 21:01:46 2010
From: lestes at princeton.edu (Lyndon Estes)
Date: Sun, 14 Nov 2010 15:01:46 -0500
Subject: [R-sig-Geo] Georerferncing in Arc vs rgdal (and raster):
	AREA_OR_POINT=Point
In-Reply-To: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>
References: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>
Message-ID: <AANLkTimE9JJo_CY5p+=L+yNkxxPQWW3LNgR+5G4vVswQ@mail.gmail.com>

Hi Robert,

In case this adds a piece to the puzzle, here is the version information :

R version 2.11.1 (2010-05-31)
x86_64-apple-darwin9.8.0

raster_1.5-16
sp_0.9-71

Thanks, Lyndon


On Sun, Nov 14, 2010 at 2:27 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> List,
>
> Lyndon Estes asked questions about georeferencing and the use of
> 'crop' in raster, while pointing out differences in georeferencing
> between Arc (and ENVI) vs raster (and rgdal). I start a new thread to
> focus on the georeferencing issue. I think there is something going
> seriously wrong.
>
> GDAL supports metadata ( http://www.gdal.org/gdal_datamodel.html ).
> One of the items is "AREA_OR_POINT" which may be either "Area" (the
> default) or "Point". This "Indicates whether a pixel value should be
> assumed to represent a sampling over the region of the pixel or a
> point sample at the center of the pixel. This is not intended to
> influence interpretation of georeferencing which remains area
> oriented."
>
> The file Lyndon send me ("MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif")
> has AREA_OR_POINT=Point (reported by rgdal, see further below). This
> is ignored by rgdal and raster (as it should). However, it appears
> that ArcMap version 9.3 (and ENVI?) does not ignore this flag and
> changes the georeference.
>
>> #this is what arc reports
>> arc <- extent(-283255.039878, 1332779.71537, -1172300.9282, 1114610.64058)
>> extent(arc)
> class ? ? ? : Extent
> xmin ? ? ? ?: -283255.0
> xmax ? ? ? ?: 1332780
> ymin ? ? ? ?: -1172301
> ymax ? ? ? ?: 1114611
>>
>> # make a RasterLayer of the file
>> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>> extent(r1)
> class ? ? ? : Extent
> xmin ? ? ? ?: -283139.2
> xmax ? ? ? ?: 1332896
> ymin ? ? ? ?: -1172417
> ymax ? ? ? ?: 1114495
>>
>> # different by half a cell
>> res(r1)
> [1] 231.6564 231.6564
>>
>
> The weird thing is that Arc seems to correct (which I think it should
> not) and then makes a mistake in the correction. This is how you can
> get the georeference that Arc has:
>
>> xmin(r1) - 0.5 * xres(r1)
> [1] -283255.0
>> xmax(r1) - 0.5 * xres(r1)
> [1] 1332780
>> ymin(r1) + 0.5 * yres(r1)
> [1] -1172301
>> ymax(r1) + 0.5 * yres(r1)
> [1] 1114611
>>
>
> I.e., shifting the xmin AND xmax half a cell to the left, and the ymin
> AND ymax half a cell up. It makes no sense to do that as you would
> want to shift the xmin to the left and the xmax to the right to go
> from center-of-cell georeferencing to extreme-of -cell georeferencing.
>
> With recent versions of raster, you can do this correction like this (
> not documented, sorry ):
>
>> r2 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif', fixGeoref=TRUE)
>> extent(r2)
> class ? ? ? : Extent
> xmin ? ? ? ?: -283255.1
> xmax ? ? ? ?: 1333011
> ymin ? ? ? ?: -1172533
> ymax ? ? ? ?: 1114611
>>
>
> And now we have the same xmin and ymax as Arc, but the xmax and ymin
> are different (and I believe raster is right here)
>
> When I save the data as a new geotiff file, and by default, with no
> AREA_OR_POINT=Area
>
> r3 <- writeRaster(r1, filename='test.tif')
>
> Arc and rgdal/raster agree again. That suggests that it is this flag
> that matters, but perhaps there is something else in the file to which
> Arc responds?
>
> Does anyone have any insights, thoughts? Did I miss something simple?
> Or does Arc have a "standard" (perhaps shared with many others?) that
> we should be aware of?
>
> More details below
>
> Robert
>
>
>> GDALinfo('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
> rows ? ? ? ?9872
> columns ? ? 6976
> bands ? ? ? 1
> origin.x ? ? ? ?-283139.2
> origin.y ? ? ? ?-1172417
> res.x ? ? ? 231.6564
> res.y ? ? ? 231.6564
> ysign ? ? ? -1
> oblique.x ? 0
> oblique.y ? 0
> driver ? ? ?GTiff
> projection ?+proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
> file ? ? ? ?MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif
> apparent band summary:
> ?GDType ? Bmin ?Bmax Bmean Bsd
> 1 ?Int16 -32768 32767 ? ? 0 ? 0
> Metadata:
> TIFFTAG_SOFTWARE=HEG-Modis Reprojection Tool ?Nov 4, 2004
> AREA_OR_POINT=Point
> Warning message:
> statistics not supported by this driver
>>
>
>
>
> # this is how the I fix the georeferences to go from centre to extreme
> based, with x being a Raster object
> ? ? ? ?if (fixGeoref) {
> ? ? ? ? ? ? ? ?xx <- x
> ? ? ? ? ? ? ? ?nrow(xx) <- nrow(xx) - 1
> ? ? ? ? ? ? ? ?ncol(xx) <- ncol(xx) - 1
> ? ? ? ? ? ? ? ?rs <- res(xx)
> ? ? ? ? ? ? ? ?xmin(x) <- xmin(x) - 0.5 * rs[1]
> ? ? ? ? ? ? ? ?xmax(x) <- xmax(x) + 0.5 * rs[1]
> ? ? ? ? ? ? ? ?ymin(x) <- ymin(x) - 0.5 * rs[2]
> ? ? ? ? ? ? ? ?ymax(x) <- ymax(x) + 0.5 * rs[2]
> ? ? ? ?}
>



-- 
Lyndon Estes
Research Associate
Woodrow Wilson School
Princeton University
+1-609-258-2392 (o)
+1-609-258-6082 (f)
+1-202-431-0496 (m)
lestes at princeton.edu


From lestes at princeton.edu  Sun Nov 14 22:45:00 2010
From: lestes at princeton.edu (Lyndon Estes)
Date: Sun, 14 Nov 2010 16:45:00 -0500
Subject: [R-sig-Geo] writeRaster error
Message-ID: <AANLkTikXoBYQ0dAvb4r=cf4RFR2Xju7rBOqhdoTu_+Qr@mail.gmail.com>

Hello List,

I am using R 2.11.1 on a Macbook Pro.

R version 2.11.1 (2010-05-31)
[R.app GUI 1.34 (5589) x86_64-apple-darwin9.8.0]

Following steps on another thread:

http://permalink.gmane.org/gmane.comp.lang.r.geo/9480

I upgraded to raster 1.6-16 from 1.5-16 so that I could perform some
of the steps there.

Now, when I try to write out a GeoTiff:

r3 <- writeRaster(r1, filename='MOD_extent_test1.tif', type = "GTiff")

I get:
Error in .stopGDALwriting(x) : object 'nl' not found

The Geotiff appears to be written, and is plottable and viewable in
QGIS, but it is half the size in MB (61.2 mb) of the original that was
read in:

r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')  # 131.4 mb

I tried upgrading rgdal (to rgdal_0.6-27) just in case that helped the problem:

setRepositories(ind=1:2)
install.packages("rgdal")

But it remains the same.

Does anyone know what might be throwing this error?

Many thanks, Lyndon






-- 
Lyndon Estes
Research Associate
Woodrow Wilson School
Princeton University
+1-609-258-2392 (o)
+1-609-258-6082 (f)
+1-202-431-0496 (m)
lestes at princeton.edu


From kmcoulib at gmail.com  Mon Nov 15 01:22:30 2010
From: kmcoulib at gmail.com (kapo coulibaly)
Date: Sun, 14 Nov 2010 19:22:30 -0500
Subject: [R-sig-Geo] geoR interpolation with log transform
In-Reply-To: <alpine.DEB.2.00.1011132316190.23861@macalan.c3sl.ufpr.br>
References: <AANLkTimV_zfK_9G1RxLHJFZ+irZUMNujYj_sGnSyccmP@mail.gmail.com>
	<alpine.DEB.2.00.1011132316190.23861@macalan.c3sl.ufpr.br>
Message-ID: <AANLkTinbb4bH1Q8roBe9JgK-H5s5Uqdk_GqaAcNF7auP@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101114/a444aafc/attachment.pl>

From r.hijmans at gmail.com  Mon Nov 15 02:23:27 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 14 Nov 2010 19:23:27 -0600
Subject: [R-sig-Geo] writeRaster error
In-Reply-To: <AANLkTikXoBYQ0dAvb4r=cf4RFR2Xju7rBOqhdoTu_+Qr@mail.gmail.com>
References: <AANLkTikXoBYQ0dAvb4r=cf4RFR2Xju7rBOqhdoTu_+Qr@mail.gmail.com>
Message-ID: <AANLkTik7=rKO6167mPFEvQmaDkzjy4cbn_7gt+gBsJXX@mail.gmail.com>

Oops. Fixed in raster version 1.6-19 which should be on CRAN tomorrow.
Updating to rgdal 0.6-28 would also work (but won't be necessary with
raster 1.6-19.
Robert


On Sun, Nov 14, 2010 at 3:45 PM, Lyndon Estes <lestes at princeton.edu> wrote:
> Hello List,
>
> I am using R 2.11.1 on a Macbook Pro.
>
> R version 2.11.1 (2010-05-31)
> [R.app GUI 1.34 (5589) x86_64-apple-darwin9.8.0]
>
> Following steps on another thread:
>
> http://permalink.gmane.org/gmane.comp.lang.r.geo/9480
>
> I upgraded to raster 1.6-16 from 1.5-16 so that I could perform some
> of the steps there.
>
> Now, when I try to write out a GeoTiff:
>
> r3 <- writeRaster(r1, filename='MOD_extent_test1.tif', type = "GTiff")
>
> I get:
> Error in .stopGDALwriting(x) : object 'nl' not found
>
> The Geotiff appears to be written, and is plottable and viewable in
> QGIS, but it is half the size in MB (61.2 mb) of the original that was
> read in:
>
> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif') ?# 131.4 mb
>
> I tried upgrading rgdal (to rgdal_0.6-27) just in case that helped the problem:
>
> setRepositories(ind=1:2)
> install.packages("rgdal")
>
> But it remains the same.
>
> Does anyone know what might be throwing this error?
>
> Many thanks, Lyndon
>
>
>
>
>
>
> --
> Lyndon Estes
> Research Associate
> Woodrow Wilson School
> Princeton University
> +1-609-258-2392 (o)
> +1-609-258-6082 (f)
> +1-202-431-0496 (m)
> lestes at princeton.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From dustin.duncan at post.harvard.edu  Mon Nov 15 02:55:51 2010
From: dustin.duncan at post.harvard.edu (Dustin Duncan)
Date: Sun, 14 Nov 2010 20:55:51 -0500
Subject: [R-sig-Geo] Assessing residual spatial autocorrelation in non-OLS
 models (eg Poisson or Negative Binomial models)
Message-ID: <AANLkTim8d_DU8tjeM=M5Uj2Twoa0hip79sqcdHZhNYj2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101114/9a16c17e/attachment.pl>

From lestes at princeton.edu  Mon Nov 15 03:59:49 2010
From: lestes at princeton.edu (Lyndon Estes)
Date: Sun, 14 Nov 2010 21:59:49 -0500
Subject: [R-sig-Geo] writeRaster error
In-Reply-To: <AANLkTik7=rKO6167mPFEvQmaDkzjy4cbn_7gt+gBsJXX@mail.gmail.com>
References: <AANLkTikXoBYQ0dAvb4r=cf4RFR2Xju7rBOqhdoTu_+Qr@mail.gmail.com>
	<AANLkTik7=rKO6167mPFEvQmaDkzjy4cbn_7gt+gBsJXX@mail.gmail.com>
Message-ID: <AANLkTimtDYpn5WBV0cfPmiHfQm1ZKMuN5+02RFkWJ7Am@mail.gmail.com>

Hi Robert,

Thanks for that.

FYI, I upgraded to rgdal 0.6-28 but am still getting the same error,
in case anyone else tries this approach. I upgraded the entire GDAL
framework from http://www.kyngchaos.com/software/frameworks (moving me
from GDAL 1.7.2 to 1.7.3), which bundles in the rgdal 0.6-28.

So, I will try raster 1.6-19 tomorrow.

Thanks, Lyndon

On Sun, Nov 14, 2010 at 8:23 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Oops. Fixed in raster version 1.6-19 which should be on CRAN tomorrow.
> Updating to rgdal 0.6-28 would also work (but won't be necessary with
> raster 1.6-19.
> Robert
>
>
> On Sun, Nov 14, 2010 at 3:45 PM, Lyndon Estes <lestes at princeton.edu> wrote:
>> Hello List,
>>
>> I am using R 2.11.1 on a Macbook Pro.
>>
>> R version 2.11.1 (2010-05-31)
>> [R.app GUI 1.34 (5589) x86_64-apple-darwin9.8.0]
>>
>> Following steps on another thread:
>>
>> http://permalink.gmane.org/gmane.comp.lang.r.geo/9480
>>
>> I upgraded to raster 1.6-16 from 1.5-16 so that I could perform some
>> of the steps there.
>>
>> Now, when I try to write out a GeoTiff:
>>
>> r3 <- writeRaster(r1, filename='MOD_extent_test1.tif', type = "GTiff")
>>
>> I get:
>> Error in .stopGDALwriting(x) : object 'nl' not found
>>
>> The Geotiff appears to be written, and is plottable and viewable in
>> QGIS, but it is half the size in MB (61.2 mb) of the original that was
>> read in:
>>
>> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif') ?# 131.4 mb
>>
>> I tried upgrading rgdal (to rgdal_0.6-27) just in case that helped the problem:
>>
>> setRepositories(ind=1:2)
>> install.packages("rgdal")
>>
>> But it remains the same.
>>
>> Does anyone know what might be throwing this error?
>>
>> Many thanks, Lyndon
>>
>>
>>
>>
>>
>>
>> --
>> Lyndon Estes
>> Research Associate
>> Woodrow Wilson School
>> Princeton University
>> +1-609-258-2392 (o)
>> +1-609-258-6082 (f)
>> +1-202-431-0496 (m)
>> lestes at princeton.edu
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>



-- 
Lyndon Estes
Research Associate
Woodrow Wilson School
Princeton University
+1-609-258-2392 (o)
+1-609-258-6082 (f)
+1-202-431-0496 (m)
lestes at princeton.edu


From franziska.schulze at wiwi.hu-berlin.de  Mon Nov 15 09:26:39 2010
From: franziska.schulze at wiwi.hu-berlin.de (Franziska Schulze)
Date: Mon, 15 Nov 2010 09:26:39 +0100
Subject: [R-sig-Geo] problem with adding data to spatialpolygonsdataframe
In-Reply-To: <AANLkTi=Pi3y8FxfC2gijQ3B9+hqmieaqgAUHiv88qKW0@mail.gmail.com>
References: <4A2D640417064127BEDFD6065DC23D4B@FranziDell>
	<AANLkTi=Pi3y8FxfC2gijQ3B9+hqmieaqgAUHiv88qKW0@mail.gmail.com>
Message-ID: <C9FED3E6BC7B4DA1B8E3367D88A399B7@FranziDell>

It works now. Am I sure that it puts my new variable as last column in my 
frame? Is it possible to sort the spatial polygons data frame with respect 
to one variable?


----- Original Message ----- 
From: "Barry Rowlingson" <b.rowlingson at lancaster.ac.uk>
To: "Franziska Schulze" <franziska.schulze at wiwi.hu-berlin.de>
Cc: <r-sig-geo at stat.math.ethz.ch>
Sent: Friday, November 12, 2010 4:28 PM
Subject: Re: [R-sig-Geo] problem with adding data to 
spatialpolygonsdataframe


On Fri, Nov 12, 2010 at 11:27 AM, Franziska Schulze
<franziska.schulze at wiwi.hu-berlin.de> wrote:
> Dear all,
>
> I have a SpatialPolygonsDataFrame and I want to add data to the regions, 
> i.e. I want to assign to every region in my data a value of a certain 
> variable. I tried using spCbind, but after using this, the dimensions of 
> my SpatialPolygonsDataFrame changed. What went wrong? Do I have to create 
> a matrix with the region's IDs and the values of my variable?

 You can for the most part treat it like a data frame. For example,
using the spdf created in help("SpatialPolygonsDataFrame-class")

> summary(ex_1.7)
Object of class SpatialPolygonsDataFrame
Coordinates:
  min  max
x 0.5 10.5
y 0.5 10.5
Is projected: NA
proj4string : [NA]
Data attributes:
       x              y              z
 Min.   : 1.0   Min.   : 1.0   Min.   :1.702
 1st Qu.: 3.0   1st Qu.: 3.0   1st Qu.:2.626
 Median : 5.5   Median : 5.5   Median :3.123
 Mean   : 5.5   Mean   : 5.5   Mean   :3.127
 3rd Qu.: 8.0   3rd Qu.: 8.0   3rd Qu.:3.614
 Max.   :10.0   Max.   :10.0   Max.   :4.600
> ex_1.7$FOO=99
> summary(ex_1.7)
Object of class SpatialPolygonsDataFrame
Coordinates:
  min  max
x 0.5 10.5
y 0.5 10.5
Is projected: NA
proj4string : [NA]
Data attributes:
       x              y              z              FOO
 Min.   : 1.0   Min.   : 1.0   Min.   :1.702   Min.   :99
 1st Qu.: 3.0   1st Qu.: 3.0   1st Qu.:2.626   1st Qu.:99
 Median : 5.5   Median : 5.5   Median :3.123   Median :99
 Mean   : 5.5   Mean   : 5.5   Mean   :3.127   Mean   :99
 3rd Qu.: 8.0   3rd Qu.: 8.0   3rd Qu.:3.614   3rd Qu.:99
 Max.   :10.0   Max.   :10.0   Max.   :4.600   Max.   :99
>

The dimension will change because you are adding a new column - if the
number of rows have changed then something is going wrong...

Post some code?

Barry


From edzer.pebesma at uni-muenster.de  Mon Nov 15 09:35:08 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 15 Nov 2010 09:35:08 +0100
Subject: [R-sig-Geo] problem with adding data to spatialpolygonsdataframe
In-Reply-To: <C9FED3E6BC7B4DA1B8E3367D88A399B7@FranziDell>
References: <4A2D640417064127BEDFD6065DC23D4B@FranziDell>	<AANLkTi=Pi3y8FxfC2gijQ3B9+hqmieaqgAUHiv88qKW0@mail.gmail.com>
	<C9FED3E6BC7B4DA1B8E3367D88A399B7@FranziDell>
Message-ID: <4CE0F0BC.2030906@uni-muenster.de>



On 11/15/2010 09:26 AM, Franziska Schulze wrote:
> It works now. Am I sure that it puts my new variable as last column in
> my frame? 

I think you can be sure.

> Is it possible to sort the spatial polygons data frame with
> respect to one variable?

my_spdf[order(my_spdf$my_column),]

> 
> 
> ----- Original Message ----- From: "Barry Rowlingson"
> <b.rowlingson at lancaster.ac.uk>
> To: "Franziska Schulze" <franziska.schulze at wiwi.hu-berlin.de>
> Cc: <r-sig-geo at stat.math.ethz.ch>
> Sent: Friday, November 12, 2010 4:28 PM
> Subject: Re: [R-sig-Geo] problem with adding data to
> spatialpolygonsdataframe
> 
> 
> On Fri, Nov 12, 2010 at 11:27 AM, Franziska Schulze
> <franziska.schulze at wiwi.hu-berlin.de> wrote:
>> Dear all,
>>
>> I have a SpatialPolygonsDataFrame and I want to add data to the
>> regions, i.e. I want to assign to every region in my data a value of a
>> certain variable. I tried using spCbind, but after using this, the
>> dimensions of my SpatialPolygonsDataFrame changed. What went wrong? Do
>> I have to create a matrix with the region's IDs and the values of my
>> variable?
> 
> You can for the most part treat it like a data frame. For example,
> using the spdf created in help("SpatialPolygonsDataFrame-class")
> 
>> summary(ex_1.7)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>  min  max
> x 0.5 10.5
> y 0.5 10.5
> Is projected: NA
> proj4string : [NA]
> Data attributes:
>       x              y              z
> Min.   : 1.0   Min.   : 1.0   Min.   :1.702
> 1st Qu.: 3.0   1st Qu.: 3.0   1st Qu.:2.626
> Median : 5.5   Median : 5.5   Median :3.123
> Mean   : 5.5   Mean   : 5.5   Mean   :3.127
> 3rd Qu.: 8.0   3rd Qu.: 8.0   3rd Qu.:3.614
> Max.   :10.0   Max.   :10.0   Max.   :4.600
>> ex_1.7$FOO=99
>> summary(ex_1.7)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>  min  max
> x 0.5 10.5
> y 0.5 10.5
> Is projected: NA
> proj4string : [NA]
> Data attributes:
>       x              y              z              FOO
> Min.   : 1.0   Min.   : 1.0   Min.   :1.702   Min.   :99
> 1st Qu.: 3.0   1st Qu.: 3.0   1st Qu.:2.626   1st Qu.:99
> Median : 5.5   Median : 5.5   Median :3.123   Median :99
> Mean   : 5.5   Mean   : 5.5   Mean   :3.127   Mean   :99
> 3rd Qu.: 8.0   3rd Qu.: 8.0   3rd Qu.:3.614   3rd Qu.:99
> Max.   :10.0   Max.   :10.0   Max.   :4.600   Max.   :99
>>
> 
> The dimension will change because you are adding a new column - if the
> number of rows have changed then something is going wrong...
> 
> Post some code?
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Mon Nov 15 10:51:56 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 15 Nov 2010 10:51:56 +0100 (CET)
Subject: [R-sig-Geo] Georerferncing in Arc vs rgdal (and raster):
 AREA_OR_POINT=Point
In-Reply-To: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>
References: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1011151029220.17573@reclus.nhh.no>

On Sat, 13 Nov 2010, Robert J. Hijmans wrote:

> List,
>
> Lyndon Estes asked questions about georeferencing and the use of
> 'crop' in raster, while pointing out differences in georeferencing
> between Arc (and ENVI) vs raster (and rgdal). I start a new thread to
> focus on the georeferencing issue. I think there is something going
> seriously wrong.
>
> GDAL supports metadata ( http://www.gdal.org/gdal_datamodel.html ).
> One of the items is "AREA_OR_POINT" which may be either "Area" (the
> default) or "Point". This "Indicates whether a pixel value should be
> assumed to represent a sampling over the region of the pixel or a
> point sample at the center of the pixel. This is not intended to
> influence interpretation of georeferencing which remains area
> oriented."

Exactly. The metadata records and reports the support of the grid 
representation, that is whether the data "represent" only the central 
point of the pixel (like a bore core), or "represent" the surface area of 
the pixel (like a remote sensing pixel). In GTiff and GDAL more generally, 
it has nothing whatsoever to do with GDALDataset::GetGeoTransform(), which 
returns the upper left corner of the upper left pixel, and pixel width and 
height for a dataset, and is where the georeferencing happens.

For example, users might like to set the metadata to "Area" for the output 
of block kriging, and "point" for ordinary kriging, to record the support 
of the data.

Whether ESRI adheres to this simple distinction is unknown (I have no such 
software, even if I was motivated to check, which I am afraid isn't the 
case). It is possible that they, unlike GDAL, have two raster cell models, 
which do not fit the simple GDALDataset::GetGeoTransform() model, and are 
using this support metadata item in a non-standard way to switch between 
models. Software should not try to handle (too many cases of) odd 
behaviour - these remain the user's responsibility to handle. If 
GDALDataset::GetGeoTransform() from ESRI-generated (which version? only 
9.3?) GTiff give non-standard results depending on the setting of this 
metadata item, this isn't our problem, it is ESRI's problem.

Can someone please post a full set of use cases (files someone sent 
someone are no use) with complete lineages (where the data started and 
what they've been through along the way), preferably with copies of all 
the rasters all the way along the workflow? Then maybe someone with access 
to a range of versions of ESRI software can undertake to do due diligence. 
In addition, we can ask the gdal-dev list to comment - although I think 
that the documentation cited by Robert is conclusive - this has nothing to 
do with georeference.

Roger

>
> The file Lyndon send me ("MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif")
> has AREA_OR_POINT=Point (reported by rgdal, see further below). This
> is ignored by rgdal and raster (as it should). However, it appears
> that ArcMap version 9.3 (and ENVI?) does not ignore this flag and
> changes the georeference.
>
>> #this is what arc reports
>> arc <- extent(-283255.039878, 1332779.71537, -1172300.9282, 1114610.64058)
>> extent(arc)
> class       : Extent
> xmin        : -283255.0
> xmax        : 1332780
> ymin        : -1172301
> ymax        : 1114611
>>
>> # make a RasterLayer of the file
>> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>> extent(r1)
> class       : Extent
> xmin        : -283139.2
> xmax        : 1332896
> ymin        : -1172417
> ymax        : 1114495
>>
>> # different by half a cell
>> res(r1)
> [1] 231.6564 231.6564
>>
>
> The weird thing is that Arc seems to correct (which I think it should
> not) and then makes a mistake in the correction. This is how you can
> get the georeference that Arc has:
>
>> xmin(r1) - 0.5 * xres(r1)
> [1] -283255.0
>> xmax(r1) - 0.5 * xres(r1)
> [1] 1332780
>> ymin(r1) + 0.5 * yres(r1)
> [1] -1172301
>> ymax(r1) + 0.5 * yres(r1)
> [1] 1114611
>>
>
> I.e., shifting the xmin AND xmax half a cell to the left, and the ymin
> AND ymax half a cell up. It makes no sense to do that as you would
> want to shift the xmin to the left and the xmax to the right to go
> from center-of-cell georeferencing to extreme-of -cell georeferencing.
>
> With recent versions of raster, you can do this correction like this (
> not documented, sorry ):
>
>> r2 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif', fixGeoref=TRUE)
>> extent(r2)
> class       : Extent
> xmin        : -283255.1
> xmax        : 1333011
> ymin        : -1172533
> ymax        : 1114611
>>
>
> And now we have the same xmin and ymax as Arc, but the xmax and ymin
> are different (and I believe raster is right here)
>
> When I save the data as a new geotiff file, and by default, with no
> AREA_OR_POINT=Area
>
> r3 <- writeRaster(r1, filename='test.tif')
>
> Arc and rgdal/raster agree again. That suggests that it is this flag
> that matters, but perhaps there is something else in the file to which
> Arc responds?
>
> Does anyone have any insights, thoughts? Did I miss something simple?
> Or does Arc have a "standard" (perhaps shared with many others?) that
> we should be aware of?
>
> More details below
>
> Robert
>
>
>> GDALinfo('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
> rows        9872
> columns     6976
> bands       1
> origin.x        -283139.2
> origin.y        -1172417
> res.x       231.6564
> res.y       231.6564
> ysign       -1
> oblique.x   0
> oblique.y   0
> driver      GTiff
> projection  +proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
> file        MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif
> apparent band summary:
>  GDType   Bmin  Bmax Bmean Bsd
> 1  Int16 -32768 32767     0   0
> Metadata:
> TIFFTAG_SOFTWARE=HEG-Modis Reprojection Tool  Nov 4, 2004
> AREA_OR_POINT=Point
> Warning message:
> statistics not supported by this driver
>>
>
>
>
> # this is how the I fix the georeferences to go from centre to extreme
> based, with x being a Raster object
> 	if (fixGeoref) {
> 		xx <- x
> 		nrow(xx) <- nrow(xx) - 1
> 		ncol(xx) <- ncol(xx) - 1
> 		rs <- res(xx)
> 		xmin(x) <- xmin(x) - 0.5 * rs[1]
> 		xmax(x) <- xmax(x) + 0.5 * rs[1]
> 		ymin(x) <- ymin(x) - 0.5 * rs[2]
> 		ymax(x) <- ymax(x) + 0.5 * rs[2]
> 	}
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Mon Nov 15 15:22:46 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 15 Nov 2010 08:22:46 -0600
Subject: [R-sig-Geo] Georerferncing in Arc vs rgdal (and raster):
	AREA_OR_POINT=Point
In-Reply-To: <alpine.LRH.2.00.1011151029220.17573@reclus.nhh.no>
References: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>
	<alpine.LRH.2.00.1011151029220.17573@reclus.nhh.no>
Message-ID: <AANLkTinZ970j7LmnjuB83KEYP91QU7qPd8mmd=i-1EHp@mail.gmail.com>

Thanks Roger,

It would indeed be good to have a publicly available file for this.
But I now think that GDAL gets it wrong because the geotiff
specification ( see
http://www.remotesensing.org/geotiff/spec/geotiff2.5.html )
distinguishes between "PixelIsArea" and "PixelIsPoint" (Pixel is
point). The specification also says that these has implications for
georeferencing (shifting half a cell).

If AREA_OR_POINT=Point reflects "PixelIsPoint" then GDAL should not
ignore that (and if it does, we should make the correction ourselves).
Perhaps something (adjustment of coordinates) happens under the
gdal-hood but that does not seem to be the case.

While ArcMap corrects, it appears that they do not correct correctly,
by shifting the whole structure 0.5 cells to the left and up. It seems
to me that it should be that the upper left corner needs to shift 0.5
cells up and left, but the lower right corner needs to shift 0.5 cells
down and to the right.

I submitted a ticket to GDAL http://trac.osgeo.org/gdal/ticket/3837
and a response here: http://trac.osgeo.org/gdal/ticket/3838

Robert



On Mon, Nov 15, 2010 at 3:51 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Sat, 13 Nov 2010, Robert J. Hijmans wrote:
>
>> List,
>>
>> Lyndon Estes asked questions about georeferencing and the use of
>> 'crop' in raster, while pointing out differences in georeferencing
>> between Arc (and ENVI) vs raster (and rgdal). I start a new thread to
>> focus on the georeferencing issue. I think there is something going
>> seriously wrong.
>>
>> GDAL supports metadata ( http://www.gdal.org/gdal_datamodel.html ).
>> One of the items is "AREA_OR_POINT" which may be either "Area" (the
>> default) or "Point". This "Indicates whether a pixel value should be
>> assumed to represent a sampling over the region of the pixel or a
>> point sample at the center of the pixel. This is not intended to
>> influence interpretation of georeferencing which remains area
>> oriented."
>
> Exactly. The metadata records and reports the support of the grid
> representation, that is whether the data "represent" only the central point
> of the pixel (like a bore core), or "represent" the surface area of the
> pixel (like a remote sensing pixel). In GTiff and GDAL more generally, it
> has nothing whatsoever to do with GDALDataset::GetGeoTransform(), which
> returns the upper left corner of the upper left pixel, and pixel width and
> height for a dataset, and is where the georeferencing happens.
>
> For example, users might like to set the metadata to "Area" for the output
> of block kriging, and "point" for ordinary kriging, to record the support of
> the data.
>
> Whether ESRI adheres to this simple distinction is unknown (I have no such
> software, even if I was motivated to check, which I am afraid isn't the
> case). It is possible that they, unlike GDAL, have two raster cell models,
> which do not fit the simple GDALDataset::GetGeoTransform() model, and are
> using this support metadata item in a non-standard way to switch between
> models. Software should not try to handle (too many cases of) odd behaviour
> - these remain the user's responsibility to handle. If
> GDALDataset::GetGeoTransform() from ESRI-generated (which version? only
> 9.3?) GTiff give non-standard results depending on the setting of this
> metadata item, this isn't our problem, it is ESRI's problem.
>
> Can someone please post a full set of use cases (files someone sent someone
> are no use) with complete lineages (where the data started and what they've
> been through along the way), preferably with copies of all the rasters all
> the way along the workflow? Then maybe someone with access to a range of
> versions of ESRI software can undertake to do due diligence. In addition, we
> can ask the gdal-dev list to comment - although I think that the
> documentation cited by Robert is conclusive - this has nothing to do with
> georeference.
>
> Roger
>
>>
>> The file Lyndon send me ("MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif")
>> has AREA_OR_POINT=Point (reported by rgdal, see further below). This
>> is ignored by rgdal and raster (as it should). However, it appears
>> that ArcMap version 9.3 (and ENVI?) does not ignore this flag and
>> changes the georeference.
>>
>>> #this is what arc reports
>>> arc <- extent(-283255.039878, 1332779.71537, -1172300.9282,
>>> 1114610.64058)
>>> extent(arc)
>>
>> class ? ? ? : Extent
>> xmin ? ? ? ?: -283255.0
>> xmax ? ? ? ?: 1332780
>> ymin ? ? ? ?: -1172301
>> ymax ? ? ? ?: 1114611
>>>
>>> # make a RasterLayer of the file
>>> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>>> extent(r1)
>>
>> class ? ? ? : Extent
>> xmin ? ? ? ?: -283139.2
>> xmax ? ? ? ?: 1332896
>> ymin ? ? ? ?: -1172417
>> ymax ? ? ? ?: 1114495
>>>
>>> # different by half a cell
>>> res(r1)
>>
>> [1] 231.6564 231.6564
>>>
>>
>> The weird thing is that Arc seems to correct (which I think it should
>> not) and then makes a mistake in the correction. This is how you can
>> get the georeference that Arc has:
>>
>>> xmin(r1) - 0.5 * xres(r1)
>>
>> [1] -283255.0
>>>
>>> xmax(r1) - 0.5 * xres(r1)
>>
>> [1] 1332780
>>>
>>> ymin(r1) + 0.5 * yres(r1)
>>
>> [1] -1172301
>>>
>>> ymax(r1) + 0.5 * yres(r1)
>>
>> [1] 1114611
>>>
>>
>> I.e., shifting the xmin AND xmax half a cell to the left, and the ymin
>> AND ymax half a cell up. It makes no sense to do that as you would
>> want to shift the xmin to the left and the xmax to the right to go
>> from center-of-cell georeferencing to extreme-of -cell georeferencing.
>>
>> With recent versions of raster, you can do this correction like this (
>> not documented, sorry ):
>>
>>> r2 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif', fixGeoref=TRUE)
>>> extent(r2)
>>
>> class ? ? ? : Extent
>> xmin ? ? ? ?: -283255.1
>> xmax ? ? ? ?: 1333011
>> ymin ? ? ? ?: -1172533
>> ymax ? ? ? ?: 1114611
>>>
>>
>> And now we have the same xmin and ymax as Arc, but the xmax and ymin
>> are different (and I believe raster is right here)
>>
>> When I save the data as a new geotiff file, and by default, with no
>> AREA_OR_POINT=Area
>>
>> r3 <- writeRaster(r1, filename='test.tif')
>>
>> Arc and rgdal/raster agree again. That suggests that it is this flag
>> that matters, but perhaps there is something else in the file to which
>> Arc responds?
>>
>> Does anyone have any insights, thoughts? Did I miss something simple?
>> Or does Arc have a "standard" (perhaps shared with many others?) that
>> we should be aware of?
>>
>> More details below
>>
>> Robert
>>
>>
>>> GDALinfo('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>>
>> rows ? ? ? ?9872
>> columns ? ? 6976
>> bands ? ? ? 1
>> origin.x ? ? ? ?-283139.2
>> origin.y ? ? ? ?-1172417
>> res.x ? ? ? 231.6564
>> res.y ? ? ? 231.6564
>> ysign ? ? ? -1
>> oblique.x ? 0
>> oblique.y ? 0
>> driver ? ? ?GTiff
>> projection ?+proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
>> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
>> file ? ? ? ?MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif
>> apparent band summary:
>> ?GDType ? Bmin ?Bmax Bmean Bsd
>> 1 ?Int16 -32768 32767 ? ? 0 ? 0
>> Metadata:
>> TIFFTAG_SOFTWARE=HEG-Modis Reprojection Tool ?Nov 4, 2004
>> AREA_OR_POINT=Point
>> Warning message:
>> statistics not supported by this driver
>>>
>>
>>
>>
>> # this is how the I fix the georeferences to go from centre to extreme
>> based, with x being a Raster object
>> ? ? ? ?if (fixGeoref) {
>> ? ? ? ? ? ? ? ?xx <- x
>> ? ? ? ? ? ? ? ?nrow(xx) <- nrow(xx) - 1
>> ? ? ? ? ? ? ? ?ncol(xx) <- ncol(xx) - 1
>> ? ? ? ? ? ? ? ?rs <- res(xx)
>> ? ? ? ? ? ? ? ?xmin(x) <- xmin(x) - 0.5 * rs[1]
>> ? ? ? ? ? ? ? ?xmax(x) <- xmax(x) + 0.5 * rs[1]
>> ? ? ? ? ? ? ? ?ymin(x) <- ymin(x) - 0.5 * rs[2]
>> ? ? ? ? ? ? ? ?ymax(x) <- ymax(x) + 0.5 * rs[2]
>> ? ? ? ?}
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From Roger.Bivand at nhh.no  Mon Nov 15 16:11:12 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 15 Nov 2010 16:11:12 +0100 (CET)
Subject: [R-sig-Geo] Georerferncing in Arc vs rgdal (and raster):
 AREA_OR_POINT=Point
In-Reply-To: <AANLkTinZ970j7LmnjuB83KEYP91QU7qPd8mmd=i-1EHp@mail.gmail.com>
References: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>
	<alpine.LRH.2.00.1011151029220.17573@reclus.nhh.no>
	<AANLkTinZ970j7LmnjuB83KEYP91QU7qPd8mmd=i-1EHp@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1011151608020.17573@reclus.nhh.no>

On Mon, 15 Nov 2010, Robert J. Hijmans wrote:

> Thanks Roger,
>
> It would indeed be good to have a publicly available file for this.
> But I now think that GDAL gets it wrong because the geotiff
> specification ( see
> http://www.remotesensing.org/geotiff/spec/geotiff2.5.html )
> distinguishes between "PixelIsArea" and "PixelIsPoint" (Pixel is
> point). The specification also says that these has implications for
> georeferencing (shifting half a cell).
>
> If AREA_OR_POINT=Point reflects "PixelIsPoint" then GDAL should not
> ignore that (and if it does, we should make the correction ourselves).
> Perhaps something (adjustment of coordinates) happens under the
> gdal-hood but that does not seem to be the case.
>
> While ArcMap corrects, it appears that they do not correct correctly,
> by shifting the whole structure 0.5 cells to the left and up. It seems
> to me that it should be that the upper left corner needs to shift 0.5
> cells up and left, but the lower right corner needs to shift 0.5 cells
> down and to the right.
>
> I submitted a ticket to GDAL http://trac.osgeo.org/gdal/ticket/3837
> and a response here: http://trac.osgeo.org/gdal/ticket/3838

Good, thanks Robert.

There is already an indication that someone from ESRI has answered, not on 
your ticket, but on the response you cite. I've replied to 
http://trac.osgeo.org/gdal/ticket/3838, so we'll see what happens. Until 
it is sorted out between ESRI and GDAL, I suggest that we wait - Franks 
immediate response that this should (if necessary) be handled by 
GDALDataset::GetGeoTransform() is sensible.

Roger



>
> Robert
>
>
>
> On Mon, Nov 15, 2010 at 3:51 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Sat, 13 Nov 2010, Robert J. Hijmans wrote:
>>
>>> List,
>>>
>>> Lyndon Estes asked questions about georeferencing and the use of
>>> 'crop' in raster, while pointing out differences in georeferencing
>>> between Arc (and ENVI) vs raster (and rgdal). I start a new thread to
>>> focus on the georeferencing issue. I think there is something going
>>> seriously wrong.
>>>
>>> GDAL supports metadata ( http://www.gdal.org/gdal_datamodel.html ).
>>> One of the items is "AREA_OR_POINT" which may be either "Area" (the
>>> default) or "Point". This "Indicates whether a pixel value should be
>>> assumed to represent a sampling over the region of the pixel or a
>>> point sample at the center of the pixel. This is not intended to
>>> influence interpretation of georeferencing which remains area
>>> oriented."
>>
>> Exactly. The metadata records and reports the support of the grid
>> representation, that is whether the data "represent" only the central point
>> of the pixel (like a bore core), or "represent" the surface area of the
>> pixel (like a remote sensing pixel). In GTiff and GDAL more generally, it
>> has nothing whatsoever to do with GDALDataset::GetGeoTransform(), which
>> returns the upper left corner of the upper left pixel, and pixel width and
>> height for a dataset, and is where the georeferencing happens.
>>
>> For example, users might like to set the metadata to "Area" for the output
>> of block kriging, and "point" for ordinary kriging, to record the support of
>> the data.
>>
>> Whether ESRI adheres to this simple distinction is unknown (I have no such
>> software, even if I was motivated to check, which I am afraid isn't the
>> case). It is possible that they, unlike GDAL, have two raster cell models,
>> which do not fit the simple GDALDataset::GetGeoTransform() model, and are
>> using this support metadata item in a non-standard way to switch between
>> models. Software should not try to handle (too many cases of) odd behaviour
>> - these remain the user's responsibility to handle. If
>> GDALDataset::GetGeoTransform() from ESRI-generated (which version? only
>> 9.3?) GTiff give non-standard results depending on the setting of this
>> metadata item, this isn't our problem, it is ESRI's problem.
>>
>> Can someone please post a full set of use cases (files someone sent someone
>> are no use) with complete lineages (where the data started and what they've
>> been through along the way), preferably with copies of all the rasters all
>> the way along the workflow? Then maybe someone with access to a range of
>> versions of ESRI software can undertake to do due diligence. In addition, we
>> can ask the gdal-dev list to comment - although I think that the
>> documentation cited by Robert is conclusive - this has nothing to do with
>> georeference.
>>
>> Roger
>>
>>>
>>> The file Lyndon send me ("MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif")
>>> has AREA_OR_POINT=Point (reported by rgdal, see further below). This
>>> is ignored by rgdal and raster (as it should). However, it appears
>>> that ArcMap version 9.3 (and ENVI?) does not ignore this flag and
>>> changes the georeference.
>>>
>>>> #this is what arc reports
>>>> arc <- extent(-283255.039878, 1332779.71537, -1172300.9282,
>>>> 1114610.64058)
>>>> extent(arc)
>>>
>>> class ? ? ? : Extent
>>> xmin ? ? ? ?: -283255.0
>>> xmax ? ? ? ?: 1332780
>>> ymin ? ? ? ?: -1172301
>>> ymax ? ? ? ?: 1114611
>>>>
>>>> # make a RasterLayer of the file
>>>> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>>>> extent(r1)
>>>
>>> class ? ? ? : Extent
>>> xmin ? ? ? ?: -283139.2
>>> xmax ? ? ? ?: 1332896
>>> ymin ? ? ? ?: -1172417
>>> ymax ? ? ? ?: 1114495
>>>>
>>>> # different by half a cell
>>>> res(r1)
>>>
>>> [1] 231.6564 231.6564
>>>>
>>>
>>> The weird thing is that Arc seems to correct (which I think it should
>>> not) and then makes a mistake in the correction. This is how you can
>>> get the georeference that Arc has:
>>>
>>>> xmin(r1) - 0.5 * xres(r1)
>>>
>>> [1] -283255.0
>>>>
>>>> xmax(r1) - 0.5 * xres(r1)
>>>
>>> [1] 1332780
>>>>
>>>> ymin(r1) + 0.5 * yres(r1)
>>>
>>> [1] -1172301
>>>>
>>>> ymax(r1) + 0.5 * yres(r1)
>>>
>>> [1] 1114611
>>>>
>>>
>>> I.e., shifting the xmin AND xmax half a cell to the left, and the ymin
>>> AND ymax half a cell up. It makes no sense to do that as you would
>>> want to shift the xmin to the left and the xmax to the right to go
>>> from center-of-cell georeferencing to extreme-of -cell georeferencing.
>>>
>>> With recent versions of raster, you can do this correction like this (
>>> not documented, sorry ):
>>>
>>>> r2 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif', fixGeoref=TRUE)
>>>> extent(r2)
>>>
>>> class ? ? ? : Extent
>>> xmin ? ? ? ?: -283255.1
>>> xmax ? ? ? ?: 1333011
>>> ymin ? ? ? ?: -1172533
>>> ymax ? ? ? ?: 1114611
>>>>
>>>
>>> And now we have the same xmin and ymax as Arc, but the xmax and ymin
>>> are different (and I believe raster is right here)
>>>
>>> When I save the data as a new geotiff file, and by default, with no
>>> AREA_OR_POINT=Area
>>>
>>> r3 <- writeRaster(r1, filename='test.tif')
>>>
>>> Arc and rgdal/raster agree again. That suggests that it is this flag
>>> that matters, but perhaps there is something else in the file to which
>>> Arc responds?
>>>
>>> Does anyone have any insights, thoughts? Did I miss something simple?
>>> Or does Arc have a "standard" (perhaps shared with many others?) that
>>> we should be aware of?
>>>
>>> More details below
>>>
>>> Robert
>>>
>>>
>>>> GDALinfo('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>>>
>>> rows ? ? ? ?9872
>>> columns ? ? 6976
>>> bands ? ? ? 1
>>> origin.x ? ? ? ?-283139.2
>>> origin.y ? ? ? ?-1172417
>>> res.x ? ? ? 231.6564
>>> res.y ? ? ? 231.6564
>>> ysign ? ? ? -1
>>> oblique.x ? 0
>>> oblique.y ? 0
>>> driver ? ? ?GTiff
>>> projection ?+proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
>>> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
>>> file ? ? ? ?MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif
>>> apparent band summary:
>>> ?GDType ? Bmin ?Bmax Bmean Bsd
>>> 1 ?Int16 -32768 32767 ? ? 0 ? 0
>>> Metadata:
>>> TIFFTAG_SOFTWARE=HEG-Modis Reprojection Tool ?Nov 4, 2004
>>> AREA_OR_POINT=Point
>>> Warning message:
>>> statistics not supported by this driver
>>>>
>>>
>>>
>>>
>>> # this is how the I fix the georeferences to go from centre to extreme
>>> based, with x being a Raster object
>>> ? ? ? ?if (fixGeoref) {
>>> ? ? ? ? ? ? ? ?xx <- x
>>> ? ? ? ? ? ? ? ?nrow(xx) <- nrow(xx) - 1
>>> ? ? ? ? ? ? ? ?ncol(xx) <- ncol(xx) - 1
>>> ? ? ? ? ? ? ? ?rs <- res(xx)
>>> ? ? ? ? ? ? ? ?xmin(x) <- xmin(x) - 0.5 * rs[1]
>>> ? ? ? ? ? ? ? ?xmax(x) <- xmax(x) + 0.5 * rs[1]
>>> ? ? ? ? ? ? ? ?ymin(x) <- ymin(x) - 0.5 * rs[2]
>>> ? ? ? ? ? ? ? ?ymax(x) <- ymax(x) + 0.5 * rs[2]
>>> ? ? ? ?}
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From tom.gottfried at wzw.tum.de  Mon Nov 15 17:43:30 2010
From: tom.gottfried at wzw.tum.de (Tom Gottfried)
Date: Mon, 15 Nov 2010 17:43:30 +0100
Subject: [R-sig-Geo] passing SQL through readOGR()
In-Reply-To: <AANLkTimRwsUTrb=c1jXDEObEicwfrc_8TERhA6mgj7ft@mail.gmail.com>
References: <4AD49E0C.3000404@wzw.tum.de>	<AANLkTime-aRN8OZbapKscQfGDnVPPGFb8-OcGhi=2zBR@mail.gmail.com>	<4CE15553.6090900@wzw.tum.de>
	<AANLkTimRwsUTrb=c1jXDEObEicwfrc_8TERhA6mgj7ft@mail.gmail.com>
Message-ID: <4CE16332.7070002@wzw.tum.de>

Hi Etienne,

so far I only did it with points:

data_frame <- sqlQuery(odbcConnect("yourdatabase"),
	"SELECT attr, ST_X(the_geom) AS x, ST_Y(the_geom) AS y FROM yourtable WHERE ...")
coordinates(data_frame) <- ~x+y

regards,
Tom

Am 15.11.2010 17:01, schrieb Etienne Bellemare:
> Thanks Tom,
>
> But, can I ask how you switch from a data.frame to a spatial feature ? I get
>
> 'data.frame':    17657 obs. of  3 variables:
>   $ gid      : int  11533765 11534718 11535010 11535664 11535802 11535953 11536125 11536126 11536263
> 11536264 ...
>   $ hauteurcm: int  1474 1212 1331 1494 1296 1621 1305 1753 1588 1504 ...
>   $ the_geom : chr "0101000020850B000000000000270D1441000000F0E48C5441"
> "0101000020850B000000000000330D144100000030E48C5441"
>
> Do you have some code to transform the_geom, or are you using st_astext (with, I guess, some code) ?
>
> Thanks,
> Etienne
>
> On Mon, Nov 15, 2010 at 10:44 AM, Tom Gottfried <tom.gottfried at wzw.tum.de
> <mailto:tom.gottfried at wzw.tum.de>> wrote:
>
>     Hi Etienne,
>
>     I still do as described in the mail you answered (through RODBC). An alternative is described
>     here: https://stat.ethz.ch/pipermail/r-sig-geo/2010-May/008256.html
>
>     regards,
>     Tom
>
>     Am 15.11.2010 16:21, schrieb Etienne Bellemare:
>
>         Hi Tom,
>
>         I'd like to know how you finally implemented your solution. I'm facing the same problem.
>
>         Etienne
>
>         On Tue, Oct 13, 2009 at 11:34 AM, Tom Gottfried <tom.gottfried at wzw.tum.de
>         <mailto:tom.gottfried at wzw.tum.de>
>         <mailto:tom.gottfried at wzw.tum.de <mailto:tom.gottfried at wzw.tum.de>>> wrote:
>
>             Hi list,
>
>             is there a way to pass any SQL-statement through readOGR (as with the -sql Option to
>         ogr2ogr). I
>             want to import a subset of a large dataset from PostGIS into R. I know it's possible
>         with for
>             example RODBC and then coercing the resulting data.frame to an sp-class, but I wonder if
>         I can do it
>             directly through readOGR().
>
>             Thanks!
>             Tom
>
>             _______________________________________________
>             R-sig-Geo mailing list
>         R-sig-Geo at stat.math.ethz.ch <mailto:R-sig-Geo at stat.math.ethz.ch>
>         <mailto:R-sig-Geo at stat.math.ethz.ch <mailto:R-sig-Geo at stat.math.ethz.ch>>
>
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Mon Nov 15 18:34:54 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 15 Nov 2010 18:34:54 +0100 (CET)
Subject: [R-sig-Geo] passing SQL through readOGR()
In-Reply-To: <4CE16332.7070002@wzw.tum.de>
References: <4AD49E0C.3000404@wzw.tum.de>
	<AANLkTime-aRN8OZbapKscQfGDnVPPGFb8-OcGhi=2zBR@mail.gmail.com>
	<4CE15553.6090900@wzw.tum.de>
	<AANLkTimRwsUTrb=c1jXDEObEicwfrc_8TERhA6mgj7ft@mail.gmail.com>
	<4CE16332.7070002@wzw.tum.de>
Message-ID: <alpine.LRH.2.00.1011151827030.17573@reclus.nhh.no>

On Mon, 15 Nov 2010, Tom Gottfried wrote:

> Hi Etienne,
>
> so far I only did it with points:
>
> data_frame <- sqlQuery(odbcConnect("yourdatabase"),
> 	"SELECT attr, ST_X(the_geom) AS x, ST_Y(the_geom) AS y FROM yourtable 
> WHERE ...")
> coordinates(data_frame) <- ~x+y

Because "OGR SQL has been reimplemented for GDAL/OGR 1.8.0", see: 
http://www.gdal.org/ogr/ogr_sql.html, and the RFC: 
http://trac.osgeo.org/gdal/wiki/rfc28_sqlfunc, it doesn't seem sensible to 
make changes in readOGR() now for released GDAL/OGR 1.7.3. As rgdal is now 
on R-Forge, I would welcome contributions and other input so that a 
new-generation readOGR() is ready soon after GDAL/OGR 1.8.0 is released, 
perhaps later this year or early next year.

Roger

>
> regards,
> Tom
>
> Am 15.11.2010 17:01, schrieb Etienne Bellemare:
>> Thanks Tom,
>> 
>> But, can I ask how you switch from a data.frame to a spatial feature ? I 
>> get
>> 
>> 'data.frame':    17657 obs. of  3 variables:
>>   $ gid      : int  11533765 11534718 11535010 11535664 11535802 11535953 
>> 11536125 11536126 11536263
>> 11536264 ...
>>   $ hauteurcm: int  1474 1212 1331 1494 1296 1621 1305 1753 1588 1504 ...
>>   $ the_geom : chr "0101000020850B000000000000270D1441000000F0E48C5441"
>> "0101000020850B000000000000330D144100000030E48C5441"
>> 
>> Do you have some code to transform the_geom, or are you using st_astext 
>> (with, I guess, some code) ?
>> 
>> Thanks,
>> Etienne
>> 
>> On Mon, Nov 15, 2010 at 10:44 AM, Tom Gottfried <tom.gottfried at wzw.tum.de
>> <mailto:tom.gottfried at wzw.tum.de>> wrote:
>>
>>     Hi Etienne,
>>
>>     I still do as described in the mail you answered (through RODBC). An 
>> alternative is described
>>     here: https://stat.ethz.ch/pipermail/r-sig-geo/2010-May/008256.html
>>
>>     regards,
>>     Tom
>>
>>     Am 15.11.2010 16:21, schrieb Etienne Bellemare:
>>
>>         Hi Tom,
>>
>>         I'd like to know how you finally implemented your solution. I'm 
>> facing the same problem.
>>
>>         Etienne
>>
>>         On Tue, Oct 13, 2009 at 11:34 AM, Tom Gottfried 
>> <tom.gottfried at wzw.tum.de
>>         <mailto:tom.gottfried at wzw.tum.de>
>>         <mailto:tom.gottfried at wzw.tum.de 
>> <mailto:tom.gottfried at wzw.tum.de>>> wrote:
>>
>>             Hi list,
>>
>>             is there a way to pass any SQL-statement through readOGR (as 
>> with the -sql Option to
>>         ogr2ogr). I
>>             want to import a subset of a large dataset from PostGIS into R. 
>> I know it's possible
>>         with for
>>             example RODBC and then coercing the resulting data.frame to an 
>> sp-class, but I wonder if
>>         I can do it
>>             directly through readOGR().
>>
>>             Thanks!
>>             Tom
>>
>>             _______________________________________________
>>             R-sig-Geo mailing list
>>         R-sig-Geo at stat.math.ethz.ch <mailto:R-sig-Geo at stat.math.ethz.ch>
>>         <mailto:R-sig-Geo at stat.math.ethz.ch 
>> <mailto:R-sig-Geo at stat.math.ethz.ch>>
>>
>>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From lestes at princeton.edu  Mon Nov 15 21:26:00 2010
From: lestes at princeton.edu (Lyndon Estes)
Date: Mon, 15 Nov 2010 15:26:00 -0500
Subject: [R-sig-Geo] writeRaster error
In-Reply-To: <AANLkTimtDYpn5WBV0cfPmiHfQm1ZKMuN5+02RFkWJ7Am@mail.gmail.com>
References: <AANLkTikXoBYQ0dAvb4r=cf4RFR2Xju7rBOqhdoTu_+Qr@mail.gmail.com>
	<AANLkTik7=rKO6167mPFEvQmaDkzjy4cbn_7gt+gBsJXX@mail.gmail.com>
	<AANLkTimtDYpn5WBV0cfPmiHfQm1ZKMuN5+02RFkWJ7Am@mail.gmail.com>
Message-ID: <AANLkTik3pyGT-o7_bQxhnPNwCUKHTETorRbncHJpoVMg@mail.gmail.com>

Hi Robert,

This is just to confirm that raster 1.6-19 solves the reported
problem.  The error:

Error in .stopGDALwriting(x) : object 'nl' not found

No longer occurs.

Thanks, Lyndon



On Sun, Nov 14, 2010 at 9:59 PM, Lyndon Estes <lestes at princeton.edu> wrote:
> Hi Robert,
>
> Thanks for that.
>
> FYI, I upgraded to rgdal 0.6-28 but am still getting the same error,
> in case anyone else tries this approach. I upgraded the entire GDAL
> framework from http://www.kyngchaos.com/software/frameworks (moving me
> from GDAL 1.7.2 to 1.7.3), which bundles in the rgdal 0.6-28.
>
> So, I will try raster 1.6-19 tomorrow.
>
> Thanks, Lyndon
>
> On Sun, Nov 14, 2010 at 8:23 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
>> Oops. Fixed in raster version 1.6-19 which should be on CRAN tomorrow.
>> Updating to rgdal 0.6-28 would also work (but won't be necessary with
>> raster 1.6-19.
>> Robert
>>
>>
>> On Sun, Nov 14, 2010 at 3:45 PM, Lyndon Estes <lestes at princeton.edu> wrote:
>>> Hello List,
>>>
>>> I am using R 2.11.1 on a Macbook Pro.
>>>
>>> R version 2.11.1 (2010-05-31)
>>> [R.app GUI 1.34 (5589) x86_64-apple-darwin9.8.0]
>>>
>>> Following steps on another thread:
>>>
>>> http://permalink.gmane.org/gmane.comp.lang.r.geo/9480
>>>
>>> I upgraded to raster 1.6-16 from 1.5-16 so that I could perform some
>>> of the steps there.
>>>
>>> Now, when I try to write out a GeoTiff:
>>>
>>> r3 <- writeRaster(r1, filename='MOD_extent_test1.tif', type = "GTiff")
>>>
>>> I get:
>>> Error in .stopGDALwriting(x) : object 'nl' not found
>>>
>>> The Geotiff appears to be written, and is plottable and viewable in
>>> QGIS, but it is half the size in MB (61.2 mb) of the original that was
>>> read in:
>>>
>>> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif') ?# 131.4 mb
>>>
>>> I tried upgrading rgdal (to rgdal_0.6-27) just in case that helped the problem:
>>>
>>> setRepositories(ind=1:2)
>>> install.packages("rgdal")
>>>
>>> But it remains the same.
>>>
>>> Does anyone know what might be throwing this error?
>>>
>>> Many thanks, Lyndon
>>>
>>>
>>>
>>>
>>>
>>>
>>> --
>>> Lyndon Estes
>>> Research Associate
>>> Woodrow Wilson School
>>> Princeton University
>>> +1-609-258-2392 (o)
>>> +1-609-258-6082 (f)
>>> +1-202-431-0496 (m)
>>> lestes at princeton.edu
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
>
>
> --
> Lyndon Estes
> Research Associate
> Woodrow Wilson School
> Princeton University
> +1-609-258-2392 (o)
> +1-609-258-6082 (f)
> +1-202-431-0496 (m)
> lestes at princeton.edu
>



-- 
Lyndon Estes
Research Associate
Woodrow Wilson School
Princeton University
+1-609-258-2392 (o)
+1-609-258-6082 (f)
+1-202-431-0496 (m)
lestes at princeton.edu


From jacobvanetten at yahoo.com  Mon Nov 15 21:58:56 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Mon, 15 Nov 2010 20:58:56 +0000 (GMT)
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <6CA7EEF6-4B56-4CE8-9006-2DE3F00E015B@gmail.com>
Message-ID: <203052.43987.qm@web29708.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101115/b10fd543/attachment.pl>

From moshersteven at gmail.com  Mon Nov 15 22:35:08 2010
From: moshersteven at gmail.com (steven mosher)
Date: Mon, 15 Nov 2010 13:35:08 -0800
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <203052.43987.qm@web29708.mail.ird.yahoo.com>
References: <6CA7EEF6-4B56-4CE8-9006-2DE3F00E015B@gmail.com>
	<203052.43987.qm@web29708.mail.ird.yahoo.com>
Message-ID: <AANLkTikKRMeABug-Ka_hOTApSZukuv_fthGM-ejh=1uz@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101115/1eb3daf1/attachment.pl>

From jmburgos at uw.edu  Mon Nov 15 23:01:17 2010
From: jmburgos at uw.edu (Julian Burgos)
Date: Mon, 15 Nov 2010 22:01:17 +0000
Subject: [R-sig-Geo] bug in rasterize (package raster)?
Message-ID: <AANLkTi=WbOsN0Tm5ko=-E6TnE4=6j7K+NNm1MG0qYX-7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101115/7ff4aafb/attachment.pl>

From kevinummel at gmail.com  Mon Nov 15 23:26:03 2010
From: kevinummel at gmail.com (Kevin Ummel)
Date: Mon, 15 Nov 2010 22:26:03 +0000
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <AANLkTikKRMeABug-Ka_hOTApSZukuv_fthGM-ejh=1uz@mail.gmail.com>
References: <6CA7EEF6-4B56-4CE8-9006-2DE3F00E015B@gmail.com>
	<203052.43987.qm@web29708.mail.ird.yahoo.com>
	<AANLkTikKRMeABug-Ka_hOTApSZukuv_fthGM-ejh=1uz@mail.gmail.com>
Message-ID: <2AEFBA3C-3A8E-467A-8A55-04AF5220D2DC@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101115/e98945df/attachment.pl>

From moshersteven at gmail.com  Mon Nov 15 23:33:16 2010
From: moshersteven at gmail.com (steven mosher)
Date: Mon, 15 Nov 2010 14:33:16 -0800
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <2AEFBA3C-3A8E-467A-8A55-04AF5220D2DC@gmail.com>
References: <6CA7EEF6-4B56-4CE8-9006-2DE3F00E015B@gmail.com>
	<203052.43987.qm@web29708.mail.ird.yahoo.com>
	<AANLkTikKRMeABug-Ka_hOTApSZukuv_fthGM-ejh=1uz@mail.gmail.com>
	<2AEFBA3C-3A8E-467A-8A55-04AF5220D2DC@gmail.com>
Message-ID: <AANLkTin-iivjB5Jjnm+SguHG+d5TGbisv=bst1i81GH+@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101115/c53bda50/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Nov 15 23:43:51 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 15 Nov 2010 22:43:51 +0000
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <AANLkTikKRMeABug-Ka_hOTApSZukuv_fthGM-ejh=1uz@mail.gmail.com>
References: <6CA7EEF6-4B56-4CE8-9006-2DE3F00E015B@gmail.com>
	<203052.43987.qm@web29708.mail.ird.yahoo.com>
	<AANLkTikKRMeABug-Ka_hOTApSZukuv_fthGM-ejh=1uz@mail.gmail.com>
Message-ID: <AANLkTim=U4SvQMw0gS+oW86BV5qU=s3tVKcpKXoRh2Rx@mail.gmail.com>

On Mon, Nov 15, 2010 at 9:35 PM, steven mosher <moshersteven at gmail.com> wrote:
> Thanks Jacob,
>
> ?I was unable to get ImageMagick working ( which saveMovie() relies upon..
> as I recall ) so I had to live with the html animation.
>

Just to add my 0.02p, I wrote some code for animating a series of png
images (or jpegs), and here's a little tutorial on how to do it
including how to create some frames from R for animation:

http://www.maths.lancs.ac.uk/~rowlings/Chicas/DIY/

Barry


From jacobvanetten at yahoo.com  Mon Nov 15 23:49:55 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Mon, 15 Nov 2010 22:49:55 +0000 (GMT)
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <2AEFBA3C-3A8E-467A-8A55-04AF5220D2DC@gmail.com>
Message-ID: <777261.37380.qm@web29720.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101115/a018374d/attachment.pl>

From moshersteven at gmail.com  Tue Nov 16 01:32:07 2010
From: moshersteven at gmail.com (steven mosher)
Date: Mon, 15 Nov 2010 16:32:07 -0800
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <777261.37380.qm@web29720.mail.ird.yahoo.com>
References: <2AEFBA3C-3A8E-467A-8A55-04AF5220D2DC@gmail.com>
	<777261.37380.qm@web29720.mail.ird.yahoo.com>
Message-ID: <AANLkTinLdyhM9MBw1XjcQ68ySKMefQQVMKmviZNkoSxB@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101115/f026e096/attachment.pl>

From r.hijmans at gmail.com  Tue Nov 16 05:51:34 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 15 Nov 2010 22:51:34 -0600
Subject: [R-sig-Geo] bug in rasterize (package raster)?
In-Reply-To: <AANLkTi=WbOsN0Tm5ko=-E6TnE4=6j7K+NNm1MG0qYX-7@mail.gmail.com>
References: <AANLkTi=WbOsN0Tm5ko=-E6TnE4=6j7K+NNm1MG0qYX-7@mail.gmail.com>
Message-ID: <AANLkTim2XMdN9nRSp-G8fpjoc7SdsyGQopJ_wmM3m6k-@mail.gmail.com>

Hi Julian,

Yes that is bug. It is a corner-case, literally, with a line leaving a
row exactly where four cells meet. Fixed in version 1.6-20 such that
the below (your example) works.

Robert

library(raster)

cds <- matrix(c(-22.02833, 63.40222, -22.00111, 63.40500, -21.98444,
63.40722, -21.95722, 63.40861, -21.93944, 63.40861, -21.91306,
63.40583, -21.88556, 63.40194, -21.86833, 63.39750, -21.84139,
63.39222, -21.82556, 63.38722, -21.79972, 63.39306, -21.80583,
63.39083, -21.84028, 63.39556, -21.86222, 63.40194, -21.88694,
63.40528, -21.92389, 63.40500, -21.94972, 63.40417, -21.97500,
63.40389, -21.99444, 63.40194, -22.01750, 63.40444), ncol=2,
byrow=TRUE)

my.line <- SpatialLines(list(Lines(list(Line(cds)), "1")))
my.raster <- raster(nrow=10, ncol=52, xmn=-22.04, xmx=-21.785,
ymn=63.375, ymx=63.42)

x <- rasterize(my.line, my.raster)



On Mon, Nov 15, 2010 at 4:01 PM, Julian Burgos <jmburgos at uw.edu> wrote:
> Dear list,
>
> I?m getting the following error when trying to convert a spatial lines
> object into a raster using the rasterize function (package raster):
>
>> my.line
> An object of class "SpatialLines"
> Slot "lines":
> [[1]]
> An object of class "Lines"
> Slot "Lines":
> [[1]]
> An object of class "Line"
> Slot "coords":
> ? ? ? ? ? ?lon ? ? ?lat
> ?[1,] -22.02833 63.40222
> ?[2,] -22.00111 63.40500
> ?[3,] -21.98444 63.40722
> ?[4,] -21.95722 63.40861
> ?[5,] -21.93944 63.40861
> ?[6,] -21.91306 63.40583
> ?[7,] -21.88556 63.40194
> ?[8,] -21.86833 63.39750
> ?[9,] -21.84139 63.39222
> [10,] -21.82556 63.38722
> [11,] -21.79972 63.39306
> [12,] -21.80583 63.39083
> [13,] -21.84028 63.39556
> [14,] -21.86222 63.40194
> [15,] -21.88694 63.40528
> [16,] -21.92389 63.40500
> [17,] -21.94972 63.40417
> [18,] -21.97500 63.40389
> [19,] -21.99444 63.40194
> [20,] -22.01750 63.40444
>
> Slot "ID":
> [1] "a"
>
> Slot "bbox":
> ? ? ? ?min ? ? ? max
> x -22.02833 -21.79972
> y ?63.38722 ?63.40861
>
> Slot "proj4string":
> CRS arguments: +proj=longlat +ellps=WGS84
>
>> my.raster
> class ? ? ? : RasterLayer
> filename ? ?:
> nrow ? ? ? ?: 10
> ncol ? ? ? ?: 52
> ncell ? ? ? : 520
> min value ? : NA
> max value ? : NA
> projection ?: +proj=longlat +ellps=WGS84
> extent ? ? ?: -22.04, -21.785, 63.375, 63.42 ?(xmin, xmax, ymin, ymax)
> resolution ?: 0.004903846, 0.0045 ?(x, y)
>
>> rasterize(my.line,my.raster)
> Error in if (outcol < 1) next : missing value where TRUE/FALSE needed
>
>
> Is this a bug in the raster function? ?Or I am missing something?
> Many thanks,
>
> Juli?n
>
> Juli?n Mariano Burgos
> Hafranns?knastofnunin/Marine Research Institute
> Sk?lagata 4, 121 Reykjav?k, Iceland
> S?mi/Telephone : +354-5752037
> Br?fs?mi/Telefax: ?+354-5752001
> Netfang/Email: julian at hafro.is, jmburgos at uw.edu
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From Roger.Bivand at nhh.no  Tue Nov 16 09:26:58 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 16 Nov 2010 09:26:58 +0100 (CET)
Subject: [R-sig-Geo] Georerferncing in Arc vs rgdal (and raster):
 AREA_OR_POINT=Point
In-Reply-To: <alpine.LRH.2.00.1011151608020.17573@reclus.nhh.no>
References: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>
	<alpine.LRH.2.00.1011151029220.17573@reclus.nhh.no>
	<AANLkTinZ970j7LmnjuB83KEYP91QU7qPd8mmd=i-1EHp@mail.gmail.com>
	<alpine.LRH.2.00.1011151608020.17573@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.1011160914120.3734@reclus.nhh.no>

On Mon, 15 Nov 2010, Roger Bivand wrote:

> On Mon, 15 Nov 2010, Robert J. Hijmans wrote:
>
>> Thanks Roger,
>> 
>> It would indeed be good to have a publicly available file for this.
>> But I now think that GDAL gets it wrong because the geotiff
>> specification ( see
>> http://www.remotesensing.org/geotiff/spec/geotiff2.5.html )
>> distinguishes between "PixelIsArea" and "PixelIsPoint" (Pixel is
>> point). The specification also says that these has implications for
>> georeferencing (shifting half a cell).
>> 
>> If AREA_OR_POINT=Point reflects "PixelIsPoint" then GDAL should not
>> ignore that (and if it does, we should make the correction ourselves).
>> Perhaps something (adjustment of coordinates) happens under the
>> gdal-hood but that does not seem to be the case.
>> 
>> While ArcMap corrects, it appears that they do not correct correctly,
>> by shifting the whole structure 0.5 cells to the left and up. It seems
>> to me that it should be that the upper left corner needs to shift 0.5
>> cells up and left, but the lower right corner needs to shift 0.5 cells
>> down and to the right.
>> 
>> I submitted a ticket to GDAL http://trac.osgeo.org/gdal/ticket/3837
>> and a response here: http://trac.osgeo.org/gdal/ticket/3838
>
> Good, thanks Robert.
>
> There is already an indication that someone from ESRI has answered, not on 
> your ticket, but on the response you cite. I've replied to 
> http://trac.osgeo.org/gdal/ticket/3838, so we'll see what happens. Until it 
> is sorted out between ESRI and GDAL, I suggest that we wait - Franks 
> immediate response that this should (if necessary) be handled by 
> GDALDataset::GetGeoTransform() is sensible.

Update:

See http://trac.osgeo.org/gdal/wiki/rfc33_gtiff_pixelispoint for current 
status. Briefly, the legacy GeoTIFF documentation said one thing and the 
GDAL documentation and implementation said and did another. GDAL behaviour 
will change from 1.6.4, 1.7.4 and 1.8.0 if AREA_OR_POINT has been set to 
its non-default value of POINT, and the new GTIFF_POINT_GEO_IGNORE 
configuration option is TRUE (default for 1.6 and 1.7).

ESRI were following the GeoTIFF documentation, GDAL wasn't, and the RFC 
explains:

"Traditionally GDAL has treated this flag as having no relevance to the 
georeferencing of the image despite disputes from a variety of other 
software developers and data producers. This was based on the authors 
interpretation of something said once by the GeoTIFF author".

Roger


>
> Roger
>
>
>
>> 
>> Robert
>> 
>> 
>> 
>> On Mon, Nov 15, 2010 at 3:51 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> On Sat, 13 Nov 2010, Robert J. Hijmans wrote:
>>> 
>>>> List,
>>>> 
>>>> Lyndon Estes asked questions about georeferencing and the use of
>>>> 'crop' in raster, while pointing out differences in georeferencing
>>>> between Arc (and ENVI) vs raster (and rgdal). I start a new thread to
>>>> focus on the georeferencing issue. I think there is something going
>>>> seriously wrong.
>>>> 
>>>> GDAL supports metadata ( http://www.gdal.org/gdal_datamodel.html ).
>>>> One of the items is "AREA_OR_POINT" which may be either "Area" (the
>>>> default) or "Point". This "Indicates whether a pixel value should be
>>>> assumed to represent a sampling over the region of the pixel or a
>>>> point sample at the center of the pixel. This is not intended to
>>>> influence interpretation of georeferencing which remains area
>>>> oriented."
>>> 
>>> Exactly. The metadata records and reports the support of the grid
>>> representation, that is whether the data "represent" only the central 
>>> point
>>> of the pixel (like a bore core), or "represent" the surface area of the
>>> pixel (like a remote sensing pixel). In GTiff and GDAL more generally, it
>>> has nothing whatsoever to do with GDALDataset::GetGeoTransform(), which
>>> returns the upper left corner of the upper left pixel, and pixel width and
>>> height for a dataset, and is where the georeferencing happens.
>>> 
>>> For example, users might like to set the metadata to "Area" for the output
>>> of block kriging, and "point" for ordinary kriging, to record the support 
>>> of
>>> the data.
>>> 
>>> Whether ESRI adheres to this simple distinction is unknown (I have no such
>>> software, even if I was motivated to check, which I am afraid isn't the
>>> case). It is possible that they, unlike GDAL, have two raster cell models,
>>> which do not fit the simple GDALDataset::GetGeoTransform() model, and are
>>> using this support metadata item in a non-standard way to switch between
>>> models. Software should not try to handle (too many cases of) odd 
>>> behaviour
>>> - these remain the user's responsibility to handle. If
>>> GDALDataset::GetGeoTransform() from ESRI-generated (which version? only
>>> 9.3?) GTiff give non-standard results depending on the setting of this
>>> metadata item, this isn't our problem, it is ESRI's problem.
>>> 
>>> Can someone please post a full set of use cases (files someone sent 
>>> someone
>>> are no use) with complete lineages (where the data started and what 
>>> they've
>>> been through along the way), preferably with copies of all the rasters all
>>> the way along the workflow? Then maybe someone with access to a range of
>>> versions of ESRI software can undertake to do due diligence. In addition, 
>>> we
>>> can ask the gdal-dev list to comment - although I think that the
>>> documentation cited by Robert is conclusive - this has nothing to do with
>>> georeference.
>>> 
>>> Roger
>>> 
>>>> 
>>>> The file Lyndon send me ("MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif")
>>>> has AREA_OR_POINT=Point (reported by rgdal, see further below). This
>>>> is ignored by rgdal and raster (as it should). However, it appears
>>>> that ArcMap version 9.3 (and ENVI?) does not ignore this flag and
>>>> changes the georeference.
>>>> 
>>>>> #this is what arc reports
>>>>> arc <- extent(-283255.039878, 1332779.71537, -1172300.9282,
>>>>> 1114610.64058)
>>>>> extent(arc)
>>>> 
>>>> class ? ? ? : Extent
>>>> xmin ? ? ? ?: -283255.0
>>>> xmax ? ? ? ?: 1332780
>>>> ymin ? ? ? ?: -1172301
>>>> ymax ? ? ? ?: 1114611
>>>>> 
>>>>> # make a RasterLayer of the file
>>>>> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>>>>> extent(r1)
>>>> 
>>>> class ? ? ? : Extent
>>>> xmin ? ? ? ?: -283139.2
>>>> xmax ? ? ? ?: 1332896
>>>> ymin ? ? ? ?: -1172417
>>>> ymax ? ? ? ?: 1114495
>>>>> 
>>>>> # different by half a cell
>>>>> res(r1)
>>>> 
>>>> [1] 231.6564 231.6564
>>>>> 
>>>> 
>>>> The weird thing is that Arc seems to correct (which I think it should
>>>> not) and then makes a mistake in the correction. This is how you can
>>>> get the georeference that Arc has:
>>>> 
>>>>> xmin(r1) - 0.5 * xres(r1)
>>>> 
>>>> [1] -283255.0
>>>>> 
>>>>> xmax(r1) - 0.5 * xres(r1)
>>>> 
>>>> [1] 1332780
>>>>> 
>>>>> ymin(r1) + 0.5 * yres(r1)
>>>> 
>>>> [1] -1172301
>>>>> 
>>>>> ymax(r1) + 0.5 * yres(r1)
>>>> 
>>>> [1] 1114611
>>>>> 
>>>> 
>>>> I.e., shifting the xmin AND xmax half a cell to the left, and the ymin
>>>> AND ymax half a cell up. It makes no sense to do that as you would
>>>> want to shift the xmin to the left and the xmax to the right to go
>>>> from center-of-cell georeferencing to extreme-of -cell georeferencing.
>>>> 
>>>> With recent versions of raster, you can do this correction like this (
>>>> not documented, sorry ):
>>>> 
>>>>> r2 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif', fixGeoref=TRUE)
>>>>> extent(r2)
>>>> 
>>>> class ? ? ? : Extent
>>>> xmin ? ? ? ?: -283255.1
>>>> xmax ? ? ? ?: 1333011
>>>> ymin ? ? ? ?: -1172533
>>>> ymax ? ? ? ?: 1114611
>>>>> 
>>>> 
>>>> And now we have the same xmin and ymax as Arc, but the xmax and ymin
>>>> are different (and I believe raster is right here)
>>>> 
>>>> When I save the data as a new geotiff file, and by default, with no
>>>> AREA_OR_POINT=Area
>>>> 
>>>> r3 <- writeRaster(r1, filename='test.tif')
>>>> 
>>>> Arc and rgdal/raster agree again. That suggests that it is this flag
>>>> that matters, but perhaps there is something else in the file to which
>>>> Arc responds?
>>>> 
>>>> Does anyone have any insights, thoughts? Did I miss something simple?
>>>> Or does Arc have a "standard" (perhaps shared with many others?) that
>>>> we should be aware of?
>>>> 
>>>> More details below
>>>> 
>>>> Robert
>>>> 
>>>> 
>>>>> GDALinfo('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>>>> 
>>>> rows ? ? ? ?9872
>>>> columns ? ? 6976
>>>> bands ? ? ? 1
>>>> origin.x ? ? ? ?-283139.2
>>>> origin.y ? ? ? ?-1172417
>>>> res.x ? ? ? 231.6564
>>>> res.y ? ? ? 231.6564
>>>> ysign ? ? ? -1
>>>> oblique.x ? 0
>>>> oblique.y ? 0
>>>> driver ? ? ?GTiff
>>>> projection ?+proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
>>>> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
>>>> file ? ? ? ?MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif
>>>> apparent band summary:
>>>> ?GDType ? Bmin ?Bmax Bmean Bsd
>>>> 1 ?Int16 -32768 32767 ? ? 0 ? 0
>>>> Metadata:
>>>> TIFFTAG_SOFTWARE=HEG-Modis Reprojection Tool ?Nov 4, 2004
>>>> AREA_OR_POINT=Point
>>>> Warning message:
>>>> statistics not supported by this driver
>>>>> 
>>>> 
>>>> 
>>>> 
>>>> # this is how the I fix the georeferences to go from centre to extreme
>>>> based, with x being a Raster object
>>>> ? ? ? ?if (fixGeoref) {
>>>> ? ? ? ? ? ? ? ?xx <- x
>>>> ? ? ? ? ? ? ? ?nrow(xx) <- nrow(xx) - 1
>>>> ? ? ? ? ? ? ? ?ncol(xx) <- ncol(xx) - 1
>>>> ? ? ? ? ? ? ? ?rs <- res(xx)
>>>> ? ? ? ? ? ? ? ?xmin(x) <- xmin(x) - 0.5 * rs[1]
>>>> ? ? ? ? ? ? ? ?xmax(x) <- xmax(x) + 0.5 * rs[1]
>>>> ? ? ? ? ? ? ? ?ymin(x) <- ymin(x) - 0.5 * rs[2]
>>>> ? ? ? ? ? ? ? ?ymax(x) <- ymax(x) + 0.5 * rs[2]
>>>> ? ? ? ?}
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>> 
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>> 
>>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From jkgibson at mngt.waikato.ac.nz  Tue Nov 16 10:47:29 2010
From: jkgibson at mngt.waikato.ac.nz (John GIBSON)
Date: Tue, 16 Nov 2010 22:47:29 +1300
Subject: [R-sig-Geo] Forming Spatial Weights Matrix with Large Datasets
	(>150, 000	observations)
Message-ID: <4CE30A01020000DF0004E0A8@nazgul.mngt.waikato.ac.nz>

Dear List

I am keen to receive advice from listers on the best strategies in R for forming and using a spatial weights matrix for a large (ca. 150,000) dataset. Is it fastest and most memory-efficient to do the entire analysis in R, or is it better to use GeoDa to form a gal or gwt file and then import that into R and then procedue with commands from spdep?

The background is that I am using R.2.12.0 (64 bit) on a 16-Gb dual core Windows XP setup to run spatial diagnostics (Moran and LM tests) on OLS residuals and estimate spatial error and spatial lag models on an environmental dataset, with 150,000 observations (1 km pixels). To start with more manageable samples I have grid-sampled pixels at the intersection of every 4th, 8th and 16th row and column, giving samples of ca. 9000, 2300 and 600. To ensure no "islands" when using the smallest samples, the neighbourhood for the weights matrix is set as 34 km, and the weights are inverse-distance. In case anyone asks "why are you even bothering to do this" it is to examine the impact of the spatial sampling, since we have previously based our analysis (of impacts of roads on forest cover) on a 1-in-25 sample and now want to see how sensitive inferences might be to this sort of spatial sampling.

Back to my current problem: while R breezes through the small samples (less than a minute for a sample of 600, about 20 minutes for a sample of 2300) it has been running for 3 days now on a sample of 9000 observations, using around about 50% of the CPU and about 5.6 Gb of the 16 Gb available on the machine. I have access to a cluster computer with 128-CPUs to run the analysis for the full population of 150,000 observations, but based on the slow performance with 9000 on a 16-Gb machine I am not optimistic about the ability of the cluster computer to run the data at full 1km scale.

Hopefully it won't colour any answers I receive, but I am primarily a Stata user, and with 64-bit multi-processor stata using our own update of stata's spatwmat program (updated to take advantage of Mata - the matrix programming language that was unavailable when spatwmat was first written) for the sample of 9000 it takes about 2 hours to form the spatial weights, do the Moran and LM tests on OLS and run the spatial lag and spatial error models. So rather faster than we are managing in R (but probably due to our novice R programming, so I am certainly not complaining about R here).  But Stata is not a candidate for running the analysis on the 128-cluster computer because of licencing issues, while R can be installed on each CPU with no licensing issues. So I need to know the most memory-efficient and fastest way to form and use a spatial weights matrix for ca. 150,000 observations.

If people haven't completely lost interest in the question by now, I am pasting a fragment of the code we are using, noting that typically we have found the closest command to what we knew how to do in Stata, and so this may not be the most efficient way in R of forming the weights matrix and then using it. So I would be grateful for pointers, before I end up burning through a lot of computing time on the cluster computer with an inefficient set up..

Thanks,

John Gibson


#  qui nspatwmat, name(W_34km_ds) xcoord(x) ycoord(y) band(0 34000) standardize eigenval(E_34km_ds)

coords <- cbind(rawd$x,rawd$y)
W_34km_nb <- dnearneigh(coords, 0, 34000, row.names = NULL, longlat = NULL)

# Eigen value matrix for the weight matrix - slightly different from Stata results
#E_34km_ds <- eigenw(W_34km_dsls, quiet=NULL)

# Get the Moran stats for -fa00-, call it A
# nspatcorr fa00, bands(0 34000 34000) xcoord(x) ycoord(y) cumul

fa00.moran <- moran.test(rawd$fa00,nb2listw(W_34km_nb,style = "W"))
print(fa00.moran)

# Moran stats for -uhat-, B

uhat.moran <- moran.test(rawd.lm$residuals,nb2listw(W_34km_nb,style = "W"))
print(uhat.moran)

# Weight matrix, inverse distance, standardise
temp <- nbdists(W_34km_nb, coords, longlat = NULL)
W_34km_ivds <-lapply(temp, function(x) 1/x)
W_34km_dsmat <- nb2mat(W_34km_nb, glist=W_34km_ivds, style="W", zero.policy=TRUE)

#W_34km_dsmat[1:5,1:5] - Same as the Stata results

W_34km_dsls <- mat2listw(W_34km_dsmat)

# Spatial diagnose, weight matrix (W_34km_ds)
rawd.lm.diag<-lm.LMtests(rawd.lm, W_34km_dsls, test=c("LMerr", "LMlag", "RLMerr","RLMlag"))
print(rawd.lm.diag)

rm(coords,W_34km_nb, temp,W_34km_ivds,W_34km_dsmat)
rm(rawd.lm)

# spatial lag, weights(W_34km_ds), same RHS as the LM
  rawd.lag <- lagsarlm(fa00 ~
d2roadf+d2nr_ld51_00f+s_ld10_00_10+protectf+non_adjacent+d2pvcapf+slo+dem+pa+ta+soil_n+soil_ap+soil_ph+s_pop_00_10+s_gdp_00_10, data=rawd, W_34km_dsls, method="eigen")


From Roger.Bivand at nhh.no  Tue Nov 16 11:20:20 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 16 Nov 2010 11:20:20 +0100 (CET)
Subject: [R-sig-Geo] Forming Spatial Weights Matrix with Large Datasets
 (>150, 000	observations)
In-Reply-To: <4CE30A01020000DF0004E0A8@nazgul.mngt.waikato.ac.nz>
References: <4CE30A01020000DF0004E0A8@nazgul.mngt.waikato.ac.nz>
Message-ID: <alpine.LRH.2.00.1011161057110.3734@reclus.nhh.no>

On Tue, 16 Nov 2010, John GIBSON wrote:

> Dear List
>
> I am keen to receive advice from listers on the best strategies in R for 
> forming and using a spatial weights matrix for a large (ca. 150,000) 
> dataset. Is it fastest and most memory-efficient to do the entire 
> analysis in R, or is it better to use GeoDa to form a gal or gwt file 
> and then import that into R and then procedue with commands from spdep?
>
> The background is that I am using R.2.12.0 (64 bit) on a 16-Gb dual core 
> Windows XP setup to run spatial diagnostics (Moran and LM tests) on OLS 
> residuals and estimate spatial error and spatial lag models on an 
> environmental dataset, with 150,000 observations (1 km pixels). To start 
> with more manageable samples I have grid-sampled pixels at the 
> intersection of every 4th, 8th and 16th row and column, giving samples 
> of ca. 9000, 2300 and 600. To ensure no "islands" when using the 
> smallest samples, the neighbourhood for the weights matrix is set as 34 
> km, and the weights are inverse-distance. In case anyone asks "why are 
> you even bothering to do this" it is to examine the impact of the 
> spatial sampling, since we have previously based our analysis (of 
> impacts of roads on forest cover) on a 1-in-25 sample and now want to 
> see how sensitive inferences might be to this sort of spatial sampling.
>
> Back to my current problem: while R breezes through the small samples 
> (less than a minute for a sample of 600, about 20 minutes for a sample 
> of 2300) it has been running for 3 days now on a sample of 9000 
> observations, using around about 50% of the CPU and about 5.6 Gb of the 
> 16 Gb available on the machine. I have access to a cluster computer with 
> 128-CPUs to run the analysis for the full population of 150,000 
> observations, but based on the slow performance with 9000 on a 16-Gb 
> machine I am not optimistic about the ability of the cluster computer to 
> run the data at full 1km scale.

If you ran the steps separately, you would see where the bottleneck is. My 
guess is that method="eigen" in the first spatial regression is the 
underlying problem, and that replacing this with sparse matrix techniques 
will resolve the problem: method="Matrix". See also comments inline in 
code below, as you seem to create dense matrices when sparse 
representations are all you need.

Roger

>
> Hopefully it won't colour any answers I receive, but I am primarily a 
> Stata user, and with 64-bit multi-processor stata using our own update 
> of stata's spatwmat program (updated to take advantage of Mata - the 
> matrix programming language that was unavailable when spatwmat was first 
> written) for the sample of 9000 it takes about 2 hours to form the 
> spatial weights, do the Moran and LM tests on OLS and run the spatial 
> lag and spatial error models. So rather faster than we are managing in R 
> (but probably due to our novice R programming, so I am certainly not 
> complaining about R here).  But Stata is not a candidate for running the 
> analysis on the 128-cluster computer because of licencing issues, while 
> R can be installed on each CPU with no licensing issues. So I need to 
> know the most memory-efficient and fastest way to form and use a spatial 
> weights matrix for ca. 150,000 observations.
>
> If people haven't completely lost interest in the question by now, I am 
> pasting a fragment of the code we are using, noting that typically we 
> have found the closest command to what we knew how to do in Stata, and 
> so this may not be the most efficient way in R of forming the weights 
> matrix and then using it. So I would be grateful for pointers, before I 
> end up burning through a lot of computing time on the cluster computer 
> with an inefficient set up..
>
> Thanks,
>
> John Gibson
>
>
> #  qui nspatwmat, name(W_34km_ds) xcoord(x) ycoord(y) band(0 34000) standardize eigenval(E_34km_ds)
>
> coords <- cbind(rawd$x,rawd$y)
> W_34km_nb <- dnearneigh(coords, 0, 34000, row.names = NULL, longlat = NULL)

What does:

print(W_34km_nb)

report as the average number of neighbours? Is it too large for your 
hypothesised processes?

>
> # Eigen value matrix for the weight matrix - slightly different from Stata results
> #E_34km_ds <- eigenw(W_34km_dsls, quiet=NULL)

No, unnecessary, created on the fly, and is dense.

>
> # Get the Moran stats for -fa00-, call it A
> # nspatcorr fa00, bands(0 34000 34000) xcoord(x) ycoord(y) cumul
>

You may save repeated calls to nb2listw() by doing it once and storing the 
listw object for use:

lw <- nb2listw(W_34km_nb,style = "W")
fa00.moran <- moran.test(rawd$fa00, lw)

and so on ...

> fa00.moran <- moran.test(rawd$fa00,nb2listw(W_34km_nb,style = "W"))
> print(fa00.moran)
>
> # Moran stats for -uhat-, B
>

No, use lm.morantest() passing the lm object:

uhat.moran <- moran.test(rawd.lm, lw)

> uhat.moran <- moran.test(rawd.lm$residuals,nb2listw(W_34km_nb,style = "W"))
> print(uhat.moran)
>
> # Weight matrix, inverse distance, standardise
> temp <- nbdists(W_34km_nb, coords, longlat = NULL)
> W_34km_ivds <-lapply(temp, function(x) 1/x)

Why create the dense matrix?

W_34km_dsls <- nb2listw(W_34km_nb, glist=W_34km_ivds, style="W", ...

> W_34km_dsmat <- nb2mat(W_34km_nb, glist=W_34km_ivds, style="W", zero.policy=TRUE)
>
> #W_34km_dsmat[1:5,1:5] - Same as the Stata results
>
> W_34km_dsls <- mat2listw(W_34km_dsmat)
>
> # Spatial diagnose, weight matrix (W_34km_ds)
> rawd.lm.diag<-lm.LMtests(rawd.lm, W_34km_dsls, test=c("LMerr", "LMlag", "RLMerr","RLMlag"))
> print(rawd.lm.diag)
>
> rm(coords,W_34km_nb, temp,W_34km_ivds,W_34km_dsmat)
> rm(rawd.lm)

As stated above, don't use method="eigen" for larger N, use 
method="Matrix", or another exact sparse method, or an approximation, such 
as Monte Carlo or Chebyshev. Running N=25000 on a 1GB laptop isn't a 
problem, with sparse matrix techniques or approximations, everything 
becomes easier.

Note also that you need to use impacts() on the output of lagsarlm() 
because the coefficients should not be interpreted like OLS coefficients - 
see the references in ?impacts.

>
> # spatial lag, weights(W_34km_ds), same RHS as the LM
>  rawd.lag <- lagsarlm(fa00 ~ 
> d2roadf+d2nr_ld51_00f+s_ld10_00_10+protectf+non_adjacent+d2pvcapf+slo+dem+pa+ta+soil_n+soil_ap+soil_ph+s_pop_00_10+s_gdp_00_10, 
> data=rawd, W_34km_dsls, method="eigen")
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Tue Nov 16 15:25:11 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 16 Nov 2010 08:25:11 -0600
Subject: [R-sig-Geo] Georerferncing in Arc vs rgdal (and raster):
	AREA_OR_POINT=Point
In-Reply-To: <alpine.LRH.2.00.1011160914120.3734@reclus.nhh.no>
References: <AANLkTi=UHGy=ZUb-53jjrwLMGHG1tCfs8v0BHiBUPtg0@mail.gmail.com>
	<alpine.LRH.2.00.1011151029220.17573@reclus.nhh.no>
	<AANLkTinZ970j7LmnjuB83KEYP91QU7qPd8mmd=i-1EHp@mail.gmail.com>
	<alpine.LRH.2.00.1011151608020.17573@reclus.nhh.no>
	<alpine.LRH.2.00.1011160914120.3734@reclus.nhh.no>
Message-ID: <AANLkTim+xXVnm9SPNUZxsJqv7t2ETZS58PDYhX1Acb_y@mail.gmail.com>

And I was wrong to think that Arc corrected incorrectly. I now think
they got it right. I have the same correction in raster 1.6-20; with a
warning, partly to remember to turn this correction off again when it
is fixed in gdal. Best, Robert

On Tue, Nov 16, 2010 at 2:26 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Mon, 15 Nov 2010, Roger Bivand wrote:
>
>> On Mon, 15 Nov 2010, Robert J. Hijmans wrote:
>>
>>> Thanks Roger,
>>>
>>> It would indeed be good to have a publicly available file for this.
>>> But I now think that GDAL gets it wrong because the geotiff
>>> specification ( see
>>> http://www.remotesensing.org/geotiff/spec/geotiff2.5.html )
>>> distinguishes between "PixelIsArea" and "PixelIsPoint" (Pixel is
>>> point). The specification also says that these has implications for
>>> georeferencing (shifting half a cell).
>>>
>>> If AREA_OR_POINT=Point reflects "PixelIsPoint" then GDAL should not
>>> ignore that (and if it does, we should make the correction ourselves).
>>> Perhaps something (adjustment of coordinates) happens under the
>>> gdal-hood but that does not seem to be the case.
>>>
>>> While ArcMap corrects, it appears that they do not correct correctly,
>>> by shifting the whole structure 0.5 cells to the left and up. It seems
>>> to me that it should be that the upper left corner needs to shift 0.5
>>> cells up and left, but the lower right corner needs to shift 0.5 cells
>>> down and to the right.
>>>
>>> I submitted a ticket to GDAL http://trac.osgeo.org/gdal/ticket/3837
>>> and a response here: http://trac.osgeo.org/gdal/ticket/3838
>>
>> Good, thanks Robert.
>>
>> There is already an indication that someone from ESRI has answered, not on
>> your ticket, but on the response you cite. I've replied to
>> http://trac.osgeo.org/gdal/ticket/3838, so we'll see what happens. Until it
>> is sorted out between ESRI and GDAL, I suggest that we wait - Franks
>> immediate response that this should (if necessary) be handled by
>> GDALDataset::GetGeoTransform() is sensible.
>
> Update:
>
> See http://trac.osgeo.org/gdal/wiki/rfc33_gtiff_pixelispoint for current
> status. Briefly, the legacy GeoTIFF documentation said one thing and the
> GDAL documentation and implementation said and did another. GDAL behaviour
> will change from 1.6.4, 1.7.4 and 1.8.0 if AREA_OR_POINT has been set to its
> non-default value of POINT, and the new GTIFF_POINT_GEO_IGNORE configuration
> option is TRUE (default for 1.6 and 1.7).
>
> ESRI were following the GeoTIFF documentation, GDAL wasn't, and the RFC
> explains:
>
> "Traditionally GDAL has treated this flag as having no relevance to the
> georeferencing of the image despite disputes from a variety of other
> software developers and data producers. This was based on the authors
> interpretation of something said once by the GeoTIFF author".
>
> Roger
>
>
>>
>> Roger
>>
>>
>>
>>>
>>> Robert
>>>
>>>
>>>
>>> On Mon, Nov 15, 2010 at 3:51 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>> wrote:
>>>>
>>>> On Sat, 13 Nov 2010, Robert J. Hijmans wrote:
>>>>
>>>>> List,
>>>>>
>>>>> Lyndon Estes asked questions about georeferencing and the use of
>>>>> 'crop' in raster, while pointing out differences in georeferencing
>>>>> between Arc (and ENVI) vs raster (and rgdal). I start a new thread to
>>>>> focus on the georeferencing issue. I think there is something going
>>>>> seriously wrong.
>>>>>
>>>>> GDAL supports metadata ( http://www.gdal.org/gdal_datamodel.html ).
>>>>> One of the items is "AREA_OR_POINT" which may be either "Area" (the
>>>>> default) or "Point". This "Indicates whether a pixel value should be
>>>>> assumed to represent a sampling over the region of the pixel or a
>>>>> point sample at the center of the pixel. This is not intended to
>>>>> influence interpretation of georeferencing which remains area
>>>>> oriented."
>>>>
>>>> Exactly. The metadata records and reports the support of the grid
>>>> representation, that is whether the data "represent" only the central
>>>> point
>>>> of the pixel (like a bore core), or "represent" the surface area of the
>>>> pixel (like a remote sensing pixel). In GTiff and GDAL more generally,
>>>> it
>>>> has nothing whatsoever to do with GDALDataset::GetGeoTransform(), which
>>>> returns the upper left corner of the upper left pixel, and pixel width
>>>> and
>>>> height for a dataset, and is where the georeferencing happens.
>>>>
>>>> For example, users might like to set the metadata to "Area" for the
>>>> output
>>>> of block kriging, and "point" for ordinary kriging, to record the
>>>> support of
>>>> the data.
>>>>
>>>> Whether ESRI adheres to this simple distinction is unknown (I have no
>>>> such
>>>> software, even if I was motivated to check, which I am afraid isn't the
>>>> case). It is possible that they, unlike GDAL, have two raster cell
>>>> models,
>>>> which do not fit the simple GDALDataset::GetGeoTransform() model, and
>>>> are
>>>> using this support metadata item in a non-standard way to switch between
>>>> models. Software should not try to handle (too many cases of) odd
>>>> behaviour
>>>> - these remain the user's responsibility to handle. If
>>>> GDALDataset::GetGeoTransform() from ESRI-generated (which version? only
>>>> 9.3?) GTiff give non-standard results depending on the setting of this
>>>> metadata item, this isn't our problem, it is ESRI's problem.
>>>>
>>>> Can someone please post a full set of use cases (files someone sent
>>>> someone
>>>> are no use) with complete lineages (where the data started and what
>>>> they've
>>>> been through along the way), preferably with copies of all the rasters
>>>> all
>>>> the way along the workflow? Then maybe someone with access to a range of
>>>> versions of ESRI software can undertake to do due diligence. In
>>>> addition, we
>>>> can ask the gdal-dev list to comment - although I think that the
>>>> documentation cited by Robert is conclusive - this has nothing to do
>>>> with
>>>> georeference.
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> The file Lyndon send me ("MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif")
>>>>> has AREA_OR_POINT=Point (reported by rgdal, see further below). This
>>>>> is ignored by rgdal and raster (as it should). However, it appears
>>>>> that ArcMap version 9.3 (and ENVI?) does not ignore this flag and
>>>>> changes the georeference.
>>>>>
>>>>>> #this is what arc reports
>>>>>> arc <- extent(-283255.039878, 1332779.71537, -1172300.9282,
>>>>>> 1114610.64058)
>>>>>> extent(arc)
>>>>>
>>>>> class ? ? ? : Extent
>>>>> xmin ? ? ? ?: -283255.0
>>>>> xmax ? ? ? ?: 1332780
>>>>> ymin ? ? ? ?: -1172301
>>>>> ymax ? ? ? ?: 1114611
>>>>>>
>>>>>> # make a RasterLayer of the file
>>>>>> r1 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>>>>>> extent(r1)
>>>>>
>>>>> class ? ? ? : Extent
>>>>> xmin ? ? ? ?: -283139.2
>>>>> xmax ? ? ? ?: 1332896
>>>>> ymin ? ? ? ?: -1172417
>>>>> ymax ? ? ? ?: 1114495
>>>>>>
>>>>>> # different by half a cell
>>>>>> res(r1)
>>>>>
>>>>> [1] 231.6564 231.6564
>>>>>>
>>>>>
>>>>> The weird thing is that Arc seems to correct (which I think it should
>>>>> not) and then makes a mistake in the correction. This is how you can
>>>>> get the georeference that Arc has:
>>>>>
>>>>>> xmin(r1) - 0.5 * xres(r1)
>>>>>
>>>>> [1] -283255.0
>>>>>>
>>>>>> xmax(r1) - 0.5 * xres(r1)
>>>>>
>>>>> [1] 1332780
>>>>>>
>>>>>> ymin(r1) + 0.5 * yres(r1)
>>>>>
>>>>> [1] -1172301
>>>>>>
>>>>>> ymax(r1) + 0.5 * yres(r1)
>>>>>
>>>>> [1] 1114611
>>>>>>
>>>>>
>>>>> I.e., shifting the xmin AND xmax half a cell to the left, and the ymin
>>>>> AND ymax half a cell up. It makes no sense to do that as you would
>>>>> want to shift the xmin to the left and the xmax to the right to go
>>>>> from center-of-cell georeferencing to extreme-of -cell georeferencing.
>>>>>
>>>>> With recent versions of raster, you can do this correction like this (
>>>>> not documented, sorry ):
>>>>>
>>>>>> r2 <- raster('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif',
>>>>>> fixGeoref=TRUE)
>>>>>> extent(r2)
>>>>>
>>>>> class ? ? ? : Extent
>>>>> xmin ? ? ? ?: -283255.1
>>>>> xmax ? ? ? ?: 1333011
>>>>> ymin ? ? ? ?: -1172533
>>>>> ymax ? ? ? ?: 1114611
>>>>>>
>>>>>
>>>>> And now we have the same xmin and ymax as Arc, but the xmax and ymin
>>>>> are different (and I believe raster is right here)
>>>>>
>>>>> When I save the data as a new geotiff file, and by default, with no
>>>>> AREA_OR_POINT=Area
>>>>>
>>>>> r3 <- writeRaster(r1, filename='test.tif')
>>>>>
>>>>> Arc and rgdal/raster agree again. That suggests that it is this flag
>>>>> that matters, but perhaps there is something else in the file to which
>>>>> Arc responds?
>>>>>
>>>>> Does anyone have any insights, thoughts? Did I miss something simple?
>>>>> Or does Arc have a "standard" (perhaps shared with many others?) that
>>>>> we should be aware of?
>>>>>
>>>>> More details below
>>>>>
>>>>> Robert
>>>>>
>>>>>
>>>>>> GDALinfo('MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif')
>>>>>
>>>>> rows ? ? ? ?9872
>>>>> columns ? ? 6976
>>>>> bands ? ? ? 1
>>>>> origin.x ? ? ? ?-283139.2
>>>>> origin.y ? ? ? ?-1172417
>>>>> res.x ? ? ? 231.6564
>>>>> res.y ? ? ? 231.6564
>>>>> ysign ? ? ? -1
>>>>> oblique.x ? 0
>>>>> oblique.y ? 0
>>>>> driver ? ? ?GTiff
>>>>> projection ?+proj=aea +lat_1=-18 +lat_2=-32 +lat_0=-30 +lon_0=24
>>>>> +x_0=0 +y_0=0 +ellps=clrk66 +datum=NAD27 +units=m +no_defs
>>>>> file ? ? ? ?MOD13Q1.A2005225.h20v11.mosaic.NDVI.tif
>>>>> apparent band summary:
>>>>> ?GDType ? Bmin ?Bmax Bmean Bsd
>>>>> 1 ?Int16 -32768 32767 ? ? 0 ? 0
>>>>> Metadata:
>>>>> TIFFTAG_SOFTWARE=HEG-Modis Reprojection Tool ?Nov 4, 2004
>>>>> AREA_OR_POINT=Point
>>>>> Warning message:
>>>>> statistics not supported by this driver
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>> # this is how the I fix the georeferences to go from centre to extreme
>>>>> based, with x being a Raster object
>>>>> ? ? ? ?if (fixGeoref) {
>>>>> ? ? ? ? ? ? ? ?xx <- x
>>>>> ? ? ? ? ? ? ? ?nrow(xx) <- nrow(xx) - 1
>>>>> ? ? ? ? ? ? ? ?ncol(xx) <- ncol(xx) - 1
>>>>> ? ? ? ? ? ? ? ?rs <- res(xx)
>>>>> ? ? ? ? ? ? ? ?xmin(x) <- xmin(x) - 0.5 * rs[1]
>>>>> ? ? ? ? ? ? ? ?xmax(x) <- xmax(x) + 0.5 * rs[1]
>>>>> ? ? ? ? ? ? ? ?ymin(x) <- ymin(x) - 0.5 * rs[2]
>>>>> ? ? ? ? ? ? ? ?ymax(x) <- ymax(x) + 0.5 * rs[2]
>>>>> ? ? ? ?}
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From Tom.Richardson at bristol.ac.uk  Tue Nov 16 16:39:38 2010
From: Tom.Richardson at bristol.ac.uk (T.O. Richardson)
Date: Tue, 16 Nov 2010 15:39:38 +0000
Subject: [R-sig-Geo] permutation with geometrical constraints
In-Reply-To: <4C9C277C.2080507@csiro.au>
References: <mailman.17.1285149612.17218.r-sig-geo@stat.math.ethz.ch>
	<4C9C277C.2080507@csiro.au>
Message-ID: <27C48BC8EDFE24480CB4C00C@bio-nfvideo3.bio.bris.ac.uk>

Hi Dr Baddeley,

I have a spatstat query (below & attached .txt). I thought to email you 
first, rather than R-Help or R-Sig-Geo as (I think?) we're supposed to ask 
the package maintainers first...

I wonder if you could please take a look at the code below & offer your 
thoughts or suggestions?

My query regards the creation of a randomised multitype ppp when different 
marks have different sizes. The presence of marks with particular sizes 
introduces geometrical constraints into the randomisation procedure because 
i don't want any overlaps between the points.

Many thanks in advance!!
Tom Richardson


### Load data
multitype_ppp <- ppp(x=x,y=y, marks=type)	##
A <- ppp(x=x[type==A],y=y[type==A])	##  radii for type A ~ 0.6
B <- ppp(x=x[type==B],y=y[type==B])	##  radii for type B ~ 1.64
# etc.... there are other types- excluded here for clarity

## create intensity map for the multitype_ppp & also for those points of 
type A

lambda_dot <- as.im(adaptive.density(multitype_ppp, correction = 
c("translate"), nrep=100, f=0.5  ))
lambda_I   <- as.im(adaptive.density(A, nrep=50, f=0.1  ))

########### Random Labelling, for K-dot function 
###############################
########### Under random labelling, Ki???(r) = K(r), where K, is the 
summary #####
########### function for the point process without marks 
######################

KDIFF <- function (X, ..., i)
	{
	Kidot     <- Kdot.inhom(X, ..., i= i, lambdaI=lambda_I , 
lambdadot=lambda_dot)
	Kinh      <- Kinhom    (X, ...,       lambda=lambda_dot  )
	dif 	  <- eval.fv  (Kidot - Kinh)
	return(dif)		
	}

## Create 95% C.I. envelope for to test random-labelling hypothesis of 
"type_A-to-any"

envelopes_A <- envelope(multitype_ppp, KDIFF, i="mark_A", nsim = 39, 
simulate = expression(rlabel(multitype_ppp)))

## THE END ###

The command "simulate=expression(rlabel(multitype_ppp))" reallocates the 
identities (A or B) amongst all points in 'multitype_ppp'. This would be 
suitable if the marks were something like 'red'/'blue', or 'on'/'off'. 
However, in my data the marks are the radii of the objects (0.6 & 1.64 mm). 
Thus simply shuffling the marks amongst the x,y, coordinates in this way 
sometimes results in the disc associated with each point overlapping other 
discs! This is not realistic. Therefore I need an alternative  procedure to 
generate a randomised multitype_ppp based on the original, but without 
overlaps.

I thought of the following:

## intesnity maps again:
lambda_dot <- as.im(adaptive.density(multitype_ppp, correction = 
c("translate"), nrep=100, f=0.5  ))
lambda_A   <- as.im(adaptive.density(A, nrep=50, f=0.5  ))
lambda_B   <- as.im(adaptive.density(B, nrep=50, f=0.5  ))

## create inhomogeneous ppp's for A & B basaed on the original ones, in 
which there are no A-A or B-B overlaps
Hard_A   <- ppm(points, ~ polynom(x,y,2) + Z , covariates=list(Z=lambda_A), 
Hardcore(0.6) )
## create a ppp in which there are no overlaps between points of type B
Hard_B   <- ppm(points, ~ polynom(x,y,2) + Z , covariates=list(Z=lambda_B), 
Hardcore(1.64) )
## Now combine them
multitype_ppp2 <- superimpose(Hard_A, Hard_B)

HOWEVER, this does not exclude the possibility that there will be A-B & B-A 
overlaps !

Alternatively one could use rshift until the minimum A-B NND is >= 
0.6+1.64. However, if rshift has to be performed multiple times, the 
resulting point patterns may have quite different underlying intensity 
maps, i.e. they will no longer be representative samples from lambda_A or 
lambda_B !!

Basically, I'm stuck...




-------------- next part --------------
Hi Dr Baddeley,

I hope you are well. I have a spatstat query
I wonder if you could take a  look at the below. My query regards the creation of a randomised multitype ppp when different marks have different sizes. The presence of marks with particular sizes introduces geometrical constraints into the randomisation procedure because i don't want any overlaps between the points.
Many tahnks in advance!!
Tom Richardson

### Load data
multitype_ppp <- ppp(x=x,y=y, marks=type)	## 
A <- ppp(x=x[type==A],y=y[type==A])	##  radii for type A ~ 0.6
B <- ppp(x=x[type==B],y=y[type==B])	##  radii for type B ~ 1.64
# etc.... there are other types- excluded here for clarity

## create intensity map for the multitype_ppp & also for those points of type A

lambda_dot <- as.im(adaptive.density(multitype_ppp, correction = c("translate"), nrep=50, f=0.1  ))
lambda_I   <- as.im(adaptive.density(A, nrep=50, f=0.5  ))

########### Random Labelling, for K-dot function ###############################
########### Under random labelling, Ki?(r) = K(r), where K, is the summary #####
########### function for the point process without marks  ######################

KDIFF <- function (X, ..., i)
	{
	Kidot     <- Kdot.inhom(X, ..., i= i, lambdaI=lambda_I , lambdadot=lambda_dot)
	Kinh      <- Kinhom    (X, ...,       lambda=lambda_dot  )
	dif 	  <- eval.fv  (Kidot - Kinh)
	return(dif)		
	}

## Create 95% C.I. envelope for to test random-labelling hypothesis of "type_A-to-any"

envelopes_A <- envelope(multitype_ppp, KDIFF, i="mark_A", nsim = 39,  simulate = expression(rlabel(multitype_ppp)))

## THE END ###

The command "simulate=expression(rlabel(multitype_ppp))" reallocates the identities (A or B) amongst all points in 'multitype_ppp'. This would be suitable if the marks were something like 'red'/'blue', or 'on'/'off'. However, in my data the marks are the radii of the objects (0.6 & 1.64 mm). Thus simply shuffling the marks amongst the x,y, coordinates in this way sometimes results in the disc associated with each point overlapping other discs! This is not realistic. Therefore I need an alternative  procedure to generate a randomised multitype_ppp based on the original, but without overlaps. 

I thought of the following:

## intesnity maps again: 
lambda_dot <- as.im(adaptive.density(multitype_ppp, correction = c("translate"), nrep=50, f=0.1  ))
lambda_A   <- as.im(adaptive.density(A, nrep=50, f=0.1  ))
lambda_B   <- as.im(adaptive.density(B, nrep=50, f=0.1  ))

## create inhomogeneous ppp's for A & B basaed on the original ones, in which there are no A-A or B-B overlaps
Hard_A   <- ppm(points, ~ polynom(x,y,2) + Z , covariates=list(Z=lambda_A), Hardcore(0.6) )
## create a ppp in which there are no overlaps between points of type B
Hard_B   <- ppm(points, ~ polynom(x,y,2) + Z , covariates=list(Z=lambda_B), Hardcore(1.64) )
## Now combine them
multitype_ppp2 <- superimpose(Hard_A, Hard_B)

However, this does not exclude the possibility that there will be A-B & B-A overlaps ! 

Alternatively one could use rshift until the minimum A-B NND is >= 0.6+1.64. However, if rshift has to be performed multiple times, the resulting point patterns may have quite different underlying intensity maps, i.e. they will no longer be representative samples from lambda_A or lambda_B !!

Basically, I'm stuck...




From geomalik at live.com  Tue Nov 16 17:15:35 2010
From: geomalik at live.com (Malik Shahzad)
Date: Tue, 16 Nov 2010 23:15:35 +0700
Subject: [R-sig-Geo] Package for Classification????
Message-ID: <SNT111-W6388FEF745A468F0C6A7E0AC370@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101116/816e8cc7/attachment.pl>

From wmconnol at ncsu.edu  Tue Nov 16 17:40:25 2010
From: wmconnol at ncsu.edu (Mark Connolly)
Date: Tue, 16 Nov 2010 11:40:25 -0500
Subject: [R-sig-Geo] boundaries for variogram
Message-ID: <AANLkTi=6qdP8nk73speukheviu66++8OP9G=76BzS70K@mail.gmail.com>

I noticed that autofitVariogram sets boundaries for the call to
gstat::variogram along the lines of (0.35 * diag(bbox(sp)) /100) *
c(2, 4, 6, 9, 12, 15, 25, 35, 50, 65, 80, 100).  Any idea of the basis
of this method?

Mark


From brwin338 at aol.com  Wed Nov 17 03:46:35 2010
From: brwin338 at aol.com (brwin338 at aol.com)
Date: Tue, 16 Nov 2010 21:46:35 -0500
Subject: [R-sig-Geo] merging polygons from two shapefiles and generating
 new polygons for intersecting areas
Message-ID: <8CD5418C8C694C1-13EC-567C@webmail-d037.sysops.aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101116/e04ffee6/attachment.pl>

From caroline.keef at jbaconsulting.co.uk  Wed Nov 17 11:44:02 2010
From: caroline.keef at jbaconsulting.co.uk (Caroline Keef)
Date: Wed, 17 Nov 2010 10:44:02 +0000
Subject: [R-sig-Geo] projection of degrees to
	North_Pole_Lambert_Azimuthal_Equal_Area
Message-ID: <5503C113FD3EF745927F96031B470A0B390DC74DAC@mail-jba1.jbanorthwest.co.uk>

Dear all,

Ultimately I want to overlay a grid of points in degrees to polygons in a shapefile with projected coordinates.  However to do this I think I need to get them both on the same geographical system.  I'm trying to do this by taking the degrees and projecting them.  I've tried both project in the proj4 library, and mapproject in the mapproj library.  The answers I'm getting are very wrong.  The bit I'm struggling with most is finding out which parameters I actually need to input to these functions.  The R helpfiles don't give any information on this.  I've looked at http://www.remotesensing.org/geotiff/proj_list/lambert_azimuthal_equal_area.html and guessed but it doesn't seem to work.  However it's entirely possible I'm not understanding what I'm doing given the polygons of the shapefile seem to be rotated 90 degrees (North is towards the left in ARCmap), but given I only need to do an overlay this doesn't really matter.  What's most worrying is that when I change the input parameters in project the outputs don't change.

Can anyone help?

Thank you

Caroline


The shapefile was created in ARC and according to the .prj the details of the projection are

PROJCS["North_Pole_Lambert_Azimuthal_Equal_Area",
GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",
SPHEROID["WGS_1984",6378137.0,298.257223563]],
PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],
PROJECTION["Lambert_Azimuthal_Equal_Area"],
PARAMETER["False_Easting",0.0],
PARAMETER["False_Northing",0.0],
PARAMETER["Central_Meridian",0.0],
PARAMETER["Latitude_Of_Origin",90.0],
UNIT["Meter",1.0]]

According to ARC map the coordinates of Mumbai should be (roughly) 7048812, -2172723 the answers I get are

mapproject(x=72.83,y=18.975,proj="azequalarea")
$x
[1] 0

$y
[1] -0.8214892

$range
[1]  0.0000000  0.0000000 -0.8214892 -0.8214892

$error
[1] 0


project(xy=c(72.83,18.975),"+proj=laea +lat_0 = -90 +lon_0=0 +x_0=0 +y_0 = 0")
        [,1]    [,2]
[1,] 7197711 2590300
>        [,1]    [,2]

> project(xy=c(72.83,18.975),"+proj=laea +lat_0 = 0 +lon_0=0 +x_0=0 +y_0 = 0")
        [,1]    [,2]
[1,] 7197711 2590300

http://www.jbaconsulting.co.uk/
 
JBA Consulting
South Barn
Broughton Hall
Skipton
North Yorkshire
BD23 3AE
United Kingdom
http://www.jbaconsulting.co.uk/?q=nce-winner-2010
t: +44 (0)1756 799919 | f: +44 (0)1756 799449 
 
JBA is a Carbon Neutral Company. Please don't print this e-mail unless you really need to.
This email is covered by JBA Consulting's http://www.jbaconsulting.co.uk/emaildisclaimer.
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101117/6118ecba/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 5104 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101117/6118ecba/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 3793 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101117/6118ecba/attachment-0001.gif>

From conservationgis at btinternet.com  Wed Nov 17 11:46:46 2010
From: conservationgis at btinternet.com (Lucy Tallents)
Date: Wed, 17 Nov 2010 10:46:46 -0000
Subject: [R-sig-Geo] Package for Classification????
References: <SNT111-W6388FEF745A468F0C6A7E0AC370@phx.gbl>,
	<000601cb85aa$574f2410$05ed6c30$@com>
	<SNT111-W470FEC4946E4617C0AA1F7AC380@phx.gbl> 
Message-ID: <000801cb8644$bb917000$32b45000$@com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101117/c2699447/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Nov 17 12:08:07 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 17 Nov 2010 11:08:07 +0000
Subject: [R-sig-Geo] projection of degrees to
	North_Pole_Lambert_Azimuthal_Equal_Area
In-Reply-To: <5503C113FD3EF745927F96031B470A0B390DC74DAC@mail-jba1.jbanorthwest.co.uk>
References: <5503C113FD3EF745927F96031B470A0B390DC74DAC@mail-jba1.jbanorthwest.co.uk>
Message-ID: <AANLkTinbCbFZguAEZUA3zZeu2_uHnG=gaNHTPGVaX1CV@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101117/3919b6a2/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Nov 17 13:55:02 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 17 Nov 2010 13:55:02 +0100
Subject: [R-sig-Geo] !SPAM: Re: merging polygons from two shapefiles and
 generating new polygons for intersecting areas
In-Reply-To: <1289724792745-5737105.post@n2.nabble.com>
References: <8CD51836FE2911B-124C-C1D7@webmail-m048.sysops.aol.com>
	<1289724792745-5737105.post@n2.nabble.com>
Message-ID: <4CE3D0A6.5040405@uni-muenster.de>

Colin, given two SpatialPolygonsDataFrame objects a and b, how do I get
the SpatialPolygonsDataFrame with the polygon-polygon overlay? Using the
original poster phrasing, how do I merge these two?

Best regards,

On 11/14/2010 09:53 AM, rundel wrote:
> 
> You should be able to achieve all of this using the rgeos package, it has
> functionality to create new polygons based on the intersection, union, etc
> of other polygons. 
> 
> Currently you can download the source from r-forge and install the package
> manually, but it will also be available on cran in the very near future. If
> you run into any difficulties or have questions, please let me know.
> 
> -Colin

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Wed Nov 17 15:55:57 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 17 Nov 2010 08:55:57 -0600
Subject: [R-sig-Geo] Package for Classification????
In-Reply-To: <000801cb8644$bb917000$32b45000$@com>
References: <SNT111-W6388FEF745A468F0C6A7E0AC370@phx.gbl>
	<000601cb85aa$574f2410$05ed6c30$@com>
	<SNT111-W470FEC4946E4617C0AA1F7AC380@phx.gbl>
	<000801cb8644$bb917000$32b45000$@com>
Message-ID: <AANLkTim12u8xxwHd6zPcRCjbZdjTLRhYO8V=XXHUfiMt@mail.gmail.com>

For supervised classification the advantage of R could be that you
have more a more flexible algorithms available. I know some folks have
been using RandomForest together with 'raster' so that you can do
large files. You can have a look at the 'dismo' package which talks
about species distribution modeling (but the flow of data analysis is
the same for classification).

For unsupervised classification the R algorithms are nice too but they
have data size limitations that cannot be solved by 'raster'.

Robert


On Wed, Nov 17, 2010 at 4:46 AM, Lucy Tallents
<conservationgis at btinternet.com> wrote:
> Dear Malik,
>
>
>
> I'm a newcomer to GRASS and R myself, having recently moved over from
> ArcGIS/Erdas, so I'm probably not the best person to assist you. ?My
> suggestion was merely that it seems sensible to use a GIS software to do a
> GIS task, particularly one such as classification which often requires a
> large degree of interaction with the data to define training samples and
> improve the classification iteratively.
>

Or do data analysis with data analysis software (such as R)?

>
>
> I'm interested to hear opinions from others - is GRASS the best route for
> land-cover classification, or are stand-alone packages in R a viable
> alternative? ?Any advice would be much appreciated - thank you.
>
>
>
> Regarding the use of GRASS and R, my understanding is that you start R
> through the GRASS terminal and then work in the usual R interface. ?This
> presumably allows R to apply GRASS commands to the GIS layers in the
> location & mapset you started GRASS in. ?This booting of R through GRASS is
> briefly described at the end of the
> http://grass.fbk.eu/statsgrass/grass6_r_install.html.
>
>
>
> If you need help in installing the xml package (from the list, not from
> newbie me!), you would need to provide more information about your setup
> (operating system/R version), what method you used to install (download zip
> file, install directly through R?), and the precise error message. ?However,
> I strongly suggest that you use the online help and maillist archives to try
> and find your answer before sending a request to the list.
>
>
>
> I hope that helps - other readers please do feel free to correct any errors
> or omissions of mine.
>
>
>
> Best wishes,
>
>
>
> Lucy
>
>
>
> From: Malik Shahzad [mailto:geomalik at live.com]
> Sent: 17 November 2010 08:24
> To: conservationgis at btinternet.com
> Subject: RE: [R-sig-Geo] Package for Classification????
>
>
>
> Dear Dr. Lucy!
>
>
>
> Thanks for your kind help. As per your instructions I tried to install
> GRASS. Then I tried to load package "spgrass6" in R and found error:
>
> Need "XML" Package and I am unable to install ?XML package for windows...
> from
>
> http://cran.r-project.org/web/packages/XML <http://>
>
>
>
> Second, I will work in R-Interface after loading GRASS package or I have to
> work in GRASS Interface???
>
>
>
> Please help me in this regards, As I am new in both packages... & once again
> thanks...
>
> with Best Regards,
>
> Malik Shahzad
> Visiting Researcher
> National Institute of Informatics (NII)
> Tokyo, Japan
>
> Doctoral Student
> Asian Institute of Technology (AIT)
> Bangkok, Thailand
> +66-8-7676-5616
>
>
>
>
> ?_____
>
> From: conservationgis at btinternet.com
> To: geomalik at live.com
> Subject: RE: [R-sig-Geo] Package for Classification????
> Date: Tue, 16 Nov 2010 16:21:36 +0000
>
> Dear Malik,
>
>
>
> Using the GRASS-R interface would seem to be a sensible route. ?See:
>
>
>
> http://cran.r-project.org/web/packages/spgrass6/index.html
>
> http://grass.fbk.eu/statsgrass/grass6_r_install.html
>
>
>
> Best wishes,
>
>
>
> Lucy
>
>
>
>
>
> Dr Lucy Tallents
>
> Assistant Coordinator, PG Dip in International Wildlife Conservation
> Practice
>
>
>
> Wildlife Conservation Research Unit (WildCRU)
>
> Zoology, University of Oxford
>
> The Recanati-Kaplan Centre
>
> Tubney House, Abingdon Road
>
> Tubney, Abingdon OX13 5QL, UK
>
> T +44 (0) 1865 611125
>
> F +44 (0) 1865 611101
>
> M +44 (0) 7763 378147
>
> ?<http://www.wildcru.org/diploma> www.wildcru.org/diploma
>
>
>
>
>
>
>
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Malik Shahzad
> Sent: 16 November 2010 16:16
> To: R Help
> Subject: [R-sig-Geo] Package for Classification????
>
>
>
>
>
> Dear I want to know a good package for Raster data classification (
> Supervised & Unsupervised).Thanks in Advance...
>
> with Best Regards,
>
>
>
> Malik Shahzad
>
> Visiting Researcher
>
> National Institute of Informatics (NII)
>
> Tokyo, Japan
>
>
>
> Doctoral Student
>
> Asian Institute of Technology (AIT)
>
> Bangkok, Thailand
>
> +66-8-7676-5616
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> ?_____
>
> No virus found in this message.
> Checked by AVG - www.avg.com
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Wed Nov 17 16:24:08 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 17 Nov 2010 16:24:08 +0100 (CET)
Subject: [R-sig-Geo] Package for Classification????
In-Reply-To: <000801cb8644$bb917000$32b45000$@com>
References: <SNT111-W6388FEF745A468F0C6A7E0AC370@phx.gbl>,
	<000601cb85aa$574f2410$05ed6c30$@com>
	<SNT111-W470FEC4946E4617C0AA1F7AC380@phx.gbl>
	<000801cb8644$bb917000$32b45000$@com>
Message-ID: <alpine.LRH.2.00.1011171613540.11297@reclus.nhh.no>

On Wed, 17 Nov 2010, Lucy Tallents wrote:

> Dear Malik,
>
> If you need help in installing the xml package (from the list, not from
> newbie me!), you would need to provide more information about your setup
> (operating system/R version), what method you used to install (download zip
> file, install directly through R?), and the precise error message.  However,
> I strongly suggest that you use the online help and maillist archives to try
> and find your answer before sending a request to the list.
>

When asking a question about R software, please always include the output 
of sessionInfo(), which shows what versions you are using on what 
platform.

In this case, on standard R Windows 2.12.0, install.packages("spgrass6") 
should pick up spgrass6, sp, and rgdal from your chosen CRAN mirror, and 
XML from CRAN extras:

http://www.stats.ox.ac.uk/pub/RWin/bin/windows/contrib/2.12/

which is the second of the enabled repositories on standard Windows 
installs. If this doesn't work for any reason, install sp, rgdal, then 
download and install XML from the address above, finally installing 
spgrass6.

There is also a statsgrass mailing list for interface questions:

http://grass.osgeo.org/statsgrass/index.php

Roger

>
>
> I hope that helps - other readers please do feel free to correct any errors
> or omissions of mine.
>
>
>
> Best wishes,
>
>
>
> Lucy
>
>
>
> From: Malik Shahzad [mailto:geomalik at live.com]
> Sent: 17 November 2010 08:24
> To: conservationgis at btinternet.com
> Subject: RE: [R-sig-Geo] Package for Classification????
>
>
>
> Dear Dr. Lucy!
>
>
>
> Thanks for your kind help. As per your instructions I tried to install
> GRASS. Then I tried to load package "spgrass6" in R and found error:
>
> Need "XML" Package and I am unable to install  XML package for windows...
> from
>
> http://cran.r-project.org/web/packages/XML <http://>
>
>
>
> Second, I will work in R-Interface after loading GRASS package or I have to
> work in GRASS Interface???
>
>
>
> Please help me in this regards, As I am new in both packages... & once again
> thanks...
>
> with Best Regards,
>
> Malik Shahzad
> Visiting Researcher
> National Institute of Informatics (NII)
> Tokyo, Japan
>
> Doctoral Student
> Asian Institute of Technology (AIT)
> Bangkok, Thailand
> +66-8-7676-5616
>
>
>
>
>  _____
>
> From: conservationgis at btinternet.com
> To: geomalik at live.com
> Subject: RE: [R-sig-Geo] Package for Classification????
> Date: Tue, 16 Nov 2010 16:21:36 +0000
>
> Dear Malik,
>
>
>
> Using the GRASS-R interface would seem to be a sensible route.  See:
>
>
>
> http://cran.r-project.org/web/packages/spgrass6/index.html
>
> http://grass.fbk.eu/statsgrass/grass6_r_install.html
>
>
>
> Best wishes,
>
>
>
> Lucy
>
>
>
>
>
> Dr Lucy Tallents
>
> Assistant Coordinator, PG Dip in International Wildlife Conservation
> Practice
>
>
>
> Wildlife Conservation Research Unit (WildCRU)
>
> Zoology, University of Oxford
>
> The Recanati-Kaplan Centre
>
> Tubney House, Abingdon Road
>
> Tubney, Abingdon OX13 5QL, UK
>
> T +44 (0) 1865 611125
>
> F +44 (0) 1865 611101
>
> M +44 (0) 7763 378147
>
> <http://www.wildcru.org/diploma> www.wildcru.org/diploma
>
>
>
>
>
>
>
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Malik Shahzad
> Sent: 16 November 2010 16:16
> To: R Help
> Subject: [R-sig-Geo] Package for Classification????
>
>
>
>
>
> Dear I want to know a good package for Raster data classification (
> Supervised & Unsupervised).Thanks in Advance...
>
> with Best Regards,
>
>
>
> Malik Shahzad
>
> Visiting Researcher
>
> National Institute of Informatics (NII)
>
> Tokyo, Japan
>
>
>
> Doctoral Student
>
> Asian Institute of Technology (AIT)
>
> Bangkok, Thailand
>
> +66-8-7676-5616
>
>
>
>        [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>  _____
>
> No virus found in this message.
> Checked by AVG - www.avg.com
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Wed Nov 17 20:29:12 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 17 Nov 2010 20:29:12 +0100
Subject: [R-sig-Geo] obtaining row indexes from a list of column indexes
Message-ID: <4CE42D08.5080604@uni-muenster.de>

List,

given an arbitrary n x m boolean matrix, say

      [,1]  [,2]  [,3]  [,4]  [,5]
[1,] FALSE FALSE FALSE FALSE FALSE
[2,] FALSE FALSE  TRUE FALSE FALSE
[3,] FALSE FALSE FALSE FALSE FALSE
[4,] FALSE FALSE FALSE  TRUE  TRUE

I have the TRUE entries (indexes) of each column, in a list

[[1]]
integer(0)

[[2]]
integer(0)

[[3]]
[1] 2

[[4]]
[1] 4

[[5]]
[1] 4

How can I, from this list, efficiently obtain the TRUE entries of each
row, in this case

[[1]]
integer(0)

[[2]]
[1] 3

[[3]]
integer(0)

[[4]]
[1] 4 5

without constructing the n x m boolean matrix?
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From caspar.hallmann at gmail.com  Wed Nov 17 20:55:43 2010
From: caspar.hallmann at gmail.com (caspar hallmann)
Date: Wed, 17 Nov 2010 20:55:43 +0100
Subject: [R-sig-Geo] obtaining row indexes from a list of column indexes
In-Reply-To: <4CE42D08.5080604@uni-muenster.de>
References: <4CE42D08.5080604@uni-muenster.de>
Message-ID: <AANLkTinkceSBzKcfYuTFwfGs+UOc7NUSLv45ifkkmTEi@mail.gmail.com>

Edzer,

say m is your matrix of TRUE's and FALSE's, then:

 which(m,arr.ind=TRUE)

will give you the column and row numbers of the matrix satisfying the
conditions supplied to which.

Hope it helps

Caspar


On Wed, Nov 17, 2010 at 8:29 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
> List,
>
> given an arbitrary n x m boolean matrix, say
>
> ? ? ?[,1] ?[,2] ?[,3] ?[,4] ?[,5]
> [1,] FALSE FALSE FALSE FALSE FALSE
> [2,] FALSE FALSE ?TRUE FALSE FALSE
> [3,] FALSE FALSE FALSE FALSE FALSE
> [4,] FALSE FALSE FALSE ?TRUE ?TRUE
>
> I have the TRUE entries (indexes) of each column, in a list
>
> [[1]]
> integer(0)
>
> [[2]]
> integer(0)
>
> [[3]]
> [1] 2
>
> [[4]]
> [1] 4
>
> [[5]]
> [1] 4
>
> How can I, from this list, efficiently obtain the TRUE entries of each
> row, in this case
>
> [[1]]
> integer(0)
>
> [[2]]
> [1] 3
>
> [[3]]
> integer(0)
>
> [[4]]
> [1] 4 5
>
> without constructing the n x m boolean matrix?
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Wed Nov 17 21:00:16 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 17 Nov 2010 21:00:16 +0100
Subject: [R-sig-Geo] obtaining row indexes from a list of column indexes
In-Reply-To: <AANLkTinkceSBzKcfYuTFwfGs+UOc7NUSLv45ifkkmTEi@mail.gmail.com>
References: <4CE42D08.5080604@uni-muenster.de>
	<AANLkTinkceSBzKcfYuTFwfGs+UOc7NUSLv45ifkkmTEi@mail.gmail.com>
Message-ID: <4CE43450.4040602@uni-muenster.de>

Thanks -- I want to retrieve the one list of indexes from the other,
without constructing the matrix. m and n might be 1e6, so constructing
the full matrix is to be avoided.

On 11/17/2010 08:55 PM, caspar hallmann wrote:
> Edzer,
> 
> say m is your matrix of TRUE's and FALSE's, then:
> 
>  which(m,arr.ind=TRUE)
> 
> will give you the column and row numbers of the matrix satisfying the
> conditions supplied to which.
> 
> Hope it helps
> 
> Caspar
> 
> 
> On Wed, Nov 17, 2010 at 8:29 PM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
>> List,
>>
>> given an arbitrary n x m boolean matrix, say
>>
>>      [,1]  [,2]  [,3]  [,4]  [,5]
>> [1,] FALSE FALSE FALSE FALSE FALSE
>> [2,] FALSE FALSE  TRUE FALSE FALSE
>> [3,] FALSE FALSE FALSE FALSE FALSE
>> [4,] FALSE FALSE FALSE  TRUE  TRUE
>>
>> I have the TRUE entries (indexes) of each column, in a list
>>
>> [[1]]
>> integer(0)
>>
>> [[2]]
>> integer(0)
>>
>> [[3]]
>> [1] 2
>>
>> [[4]]
>> [1] 4
>>
>> [[5]]
>> [1] 4
>>
>> How can I, from this list, efficiently obtain the TRUE entries of each
>> row, in this case
>>
>> [[1]]
>> integer(0)
>>
>> [[2]]
>> [1] 3
>>
>> [[3]]
>> integer(0)
>>
>> [[4]]
>> [1] 4 5
>>
>> without constructing the n x m boolean matrix?
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Wed Nov 17 21:05:44 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 17 Nov 2010 21:05:44 +0100 (CET)
Subject: [R-sig-Geo] obtaining row indexes from a list of column indexes
In-Reply-To: <4CE42D08.5080604@uni-muenster.de>
References: <4CE42D08.5080604@uni-muenster.de>
Message-ID: <alpine.LRH.2.00.1011172057190.15826@reclus.nhh.no>

On Wed, 17 Nov 2010, Edzer Pebesma wrote:

> List,
>
> given an arbitrary n x m boolean matrix, say
>
>      [,1]  [,2]  [,3]  [,4]  [,5]
> [1,] FALSE FALSE FALSE FALSE FALSE
> [2,] FALSE FALSE  TRUE FALSE FALSE
> [3,] FALSE FALSE FALSE FALSE FALSE
> [4,] FALSE FALSE FALSE  TRUE  TRUE
>
> I have the TRUE entries (indexes) of each column, in a list
>
> [[1]]
> integer(0)
>
> [[2]]
> integer(0)
>
> [[3]]
> [1] 2
>
> [[4]]
> [1] 4
>
> [[5]]
> [1] 4
>
> How can I, from this list, efficiently obtain the TRUE entries of each
> row, in this case
>
> [[1]]
> integer(0)
>
> [[2]]
> [1] 3
>
> [[3]]
> integer(0)
>
> [[4]]
> [1] 4 5
>
> without constructing the n x m boolean matrix?

Use sparse matrices?

library(Matrix)
i <- c(2, 4, 4)
j <- c(3, 4, 5)
x <- c(TRUE, TRUE, TRUE)
M <- sparseMatrix(i, j, x=x)
here <- which(M, arr.ind=TRUE)
split(here[,2], here[,1])

is almost there, what remains is to insert the empty list elements.

Roger


>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From rundel at gmail.com  Wed Nov 17 23:55:31 2010
From: rundel at gmail.com (rundel)
Date: Wed, 17 Nov 2010 14:55:31 -0800 (PST)
Subject: [R-sig-Geo] merging polygons from two shapefiles and generating
 new polygons for intersecting areas
In-Reply-To: <4CE3D0A6.5040405@uni-muenster.de>
References: <8CD51836FE2911B-124C-C1D7@webmail-m048.sysops.aol.com>
	<1289724792745-5737105.post@n2.nabble.com>
	<4CE3D0A6.5040405@uni-muenster.de>
Message-ID: <1290034531162-5749808.post@n2.nabble.com>


I've put together a simple example below that demonstrates how I would go
about this kind of problem.

As a general note, rgeos as it is currently implemented does not handle sp
DataFrame geometries and will just ignore the data slot and treat the object
as if it was just a geometry. With that said it is still possible to merge
the geometries but a little additional work is necessary because the user
needs to define how the data rows will be merged. 

The example below shows a couple of simple polygons with color strings as
the data. The polygons are merged using gIntersection and I have defined the
function merge_col fuction which figures out which polygons from the parent
geometries are producing the intersection so that it can identify the
relevant data rows which are then merged by averaging the the RGB values.
Obviously this approach is inefficient and I will definitely be trying to
look into ways to handle all of this in the backend in the future but it
should work for the time being.

-Colin




options(stringsAsFactors = FALSE)

x = readWKT("POLYGON ((0 0, 0 10, 10 10, 10 0, 0 0))")
y = readWKT("GEOMETRYCOLLECTION ( POLYGON((5 5, 14 5, 5 14, 5 5)),
POLYGON((15 6, 15 15, 6 15, 15 6)))")


x.df = SpatialPolygonsDataFrame(x,data=data.frame(col="green"))
y.df = SpatialPolygonsDataFrame(y,data=data.frame(col=c("blue","purple") ))

m = gIntersection(x.df,y.df)
class(m)

merge_col = function(m, x, y) {
	
	col = rep(NA, length(m))
	
	for(i in 1:length(m)) {
		
		xi = gIntersects(m[i,],x,byid=T)
		yi = gIntersects(m[i,],y,byid=T)
		
		rgb = col2rgb(c(x$col[xi], y$col[yi]))
		
		mix = round( apply(rgb,1,mean) )
		col[i] = rgb(mix[1],mix[2],mix[3],maxColorValue=255)
	}
	
	return(col)
}

m.df =
SpatialPolygonsDataFrame(m,data=data.frame(col=merge_col(m,x.df,y.df)))


plot(x.df,xlim=c(0,15),ylim=c(0,15),col=x.df$col)
plot(y.df,add=T,col=y.df$col)
plot(m.df,add=T,col=m.df$col)
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/merging-polygons-from-two-shapefiles-and-generating-new-polygons-for-intersecting-areas-tp5736049p5749808.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jimmyjuan1 at hotmail.com  Thu Nov 18 01:22:19 2010
From: jimmyjuan1 at hotmail.com (Jimmy Martina)
Date: Wed, 17 Nov 2010 19:22:19 -0500
Subject: [R-sig-Geo] =?utf-8?q?FW=3A_Please=2C_help_me_with_=27mattern=27_?=
 =?utf-8?b?dmFyaW9ncmFt4oCP?=
In-Reply-To: <BAY110-W47B3371C60A96ECD9E5AAC94390@phx.gbl>
References: <BAY110-W47B3371C60A96ECD9E5AAC94390@phx.gbl>
Message-ID: <BAY110-W307316BCDCC670616AF48B94390@phx.gbl>


 
Hi, R-folks:
 
I have been tryin many combination of parameter to make Matern variogram to work, but I can't find the available one. I'm near to be crazy.
I tiped:
A?o2003Selg.lf<-likfit(A?o2003Selg,cov.model="matern",ini.cov.pars=c(1.5,14),kappa=2.5,fix.kappa=FALSE,nugget=0.08,lambda=0.008,fix.lambda=FALSE,hessian=TRUE)
 
the hessian shows:
 
$hessian
          [,1]           [,2]        [,3]      [,4]
[1,]  9.139986  -8.562736e+00   41.648355 -3.801615
[2,] -8.562736  3.351952e+159 -147.279881 -7.083089
[3,] 41.648355  -1.472799e+02  347.493191 -7.509035
[4,] -3.801615  -7.083089e+00   -7.509035 90.681917

Then, I put:  solve(A?o2003Selg.lf$info.minimisation.function$hessian)
 
...and it's shown as following:
 
Error in solve.default(A?o2003Selg.lf$info.minimisation.function$hessian) : 
  sistem is computationally singular: number of reciprocity condition= 1.05091e-159

on account of I work in Spanish, it's shown:
Error in solve.default(A?o2003Selg.lf$info.minimisation.function$hessian) : 
  sistema es computacionalmente singular: n?mero de condici?n rec?proco = 1.05091e-159
 
I also wander if there is any limit for kappa. Which one would be the maximun. As far as I'm concerned, it must be always major than cero, right?. I also know that its values depend on the tendency of cloud semivariogram, if it flattens slowly (Gaussian) it's major.
 
I'd thank the one available to answer my desperate question.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101117/e3349e06/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Aug2003-S...jpeg
Type: image/pjpeg
Size: 36843 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101117/e3349e06/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Aug2003-Semivariograma_direccional_-_Rel20.jpeg
Type: image/pjpeg
Size: 31470 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101117/e3349e06/attachment-0001.bin>

From paulojus at c3sl.ufpr.br  Thu Nov 18 02:38:31 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 17 Nov 2010 23:38:31 -0200 (BRST)
Subject: [R-sig-Geo]
	=?iso-8859-8?q?FW=3A_Please=2C_help_me_with_=27matter?=
	=?iso-8859-8?q?n=27_variogram=FE?=
In-Reply-To: <BAY110-W307316BCDCC670616AF48B94390@phx.gbl>
References: <BAY110-W47B3371C60A96ECD9E5AAC94390@phx.gbl>
	<BAY110-W307316BCDCC670616AF48B94390@phx.gbl>
Message-ID: <alpine.DEB.2.00.1011172330400.1210@macalan.c3sl.ufpr.br>

Jimmy

can you show the result of
suummary() on your ligfit object.
I'd like to have a hunch on the parameter estimates

Looking at the diagonal of your hessian matrix
we see a very large value (a small variance for the estimator)
relatively to the other
which is probably causing some numerical 
instability

Also in general I'm not it is not always worth running the ML 
estimation on kappa. Sometimes I'd rather
run the several maximization on a grid of meaniful kappa values
seq(0.5, 5, by=0.5) for instance,
like profiling the likelihood.
Small changes is kappa usually does not make material.

Finally in my experience, in general,  it does not make much of a 
diference estimating lambda altogether with other parameters or just 
marginally


best
P.J.


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
VOIP: (+55) (41) (3361 3600) 1053 1066
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Wed, 17 Nov 2010, Jimmy Martina wrote:

>
>
> Hi, R-folks:
>
> I have been tryin many combination of parameter to make Matern variogram to work, but I can't find the available one. I'm near to be crazy.
> I tiped:
> A?o2003Selg.lf<-likfit(A?o2003Selg,cov.model="matern",ini.cov.pars=c(1.5,14),kappa=2.5,fix.kappa=FALSE,nugget=0.08,lambda=0.008,fix.lambda=FALSE,hessian=TRUE)
>
> the hessian shows:
>
> $hessian
>          [,1]           [,2]        [,3]      [,4]
> [1,]  9.139986  -8.562736e+00   41.648355 -3.801615
> [2,] -8.562736  3.351952e+159 -147.279881 -7.083089
> [3,] 41.648355  -1.472799e+02  347.493191 -7.509035
> [4,] -3.801615  -7.083089e+00   -7.509035 90.681917
>
> Then, I put:  solve(A?o2003Selg.lf$info.minimisation.function$hessian)
>
> ...and it's shown as following:
>
> Error in solve.default(A?o2003Selg.lf$info.minimisation.function$hessian) :
>  sistem is computationally singular: number of reciprocity condition= 1.05091e-159
>
> on account of I work in Spanish, it's shown:
> Error in solve.default(A?o2003Selg.lf$info.minimisation.function$hessian) :
>  sistema es computacionalmente singular: n?mero de condici?n rec?proco = 1.05091e-159
>
> I also wander if there is any limit for kappa. Which one would be the maximun. As far as I'm concerned, it must be always major than cero, right?. I also know that its values depend on the tendency of cloud semivariogram, if it flattens slowly (Gaussian) it's major.
>
> I'd thank the one available to answer my desperate question.
>

From arnaudtrousset at hotmail.com  Thu Nov 18 10:38:28 2010
From: arnaudtrousset at hotmail.com (Arnaud Trousset)
Date: Thu, 18 Nov 2010 12:38:28 +0300
Subject: [R-sig-Geo] Help to calculate decay distance coefficient based on
 geocoded survey data
Message-ID: <COL119-W64CC475DC5D9DB4DD323CACF390@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101118/6d792c65/attachment.pl>

From roman.lustrik at gmail.com  Thu Nov 18 12:58:00 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Thu, 18 Nov 2010 12:58:00 +0100
Subject: [R-sig-Geo] help me find a buffer around a polygon
Message-ID: <AANLkTinRqU5D-0TeSO7ki34s5o34cBzM99TFMXV1inJt@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101118/8c8ded1f/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Nov 18 13:13:18 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 18 Nov 2010 12:13:18 +0000
Subject: [R-sig-Geo] help me find a buffer around a polygon
In-Reply-To: <AANLkTinRqU5D-0TeSO7ki34s5o34cBzM99TFMXV1inJt@mail.gmail.com>
References: <AANLkTinRqU5D-0TeSO7ki34s5o34cBzM99TFMXV1inJt@mail.gmail.com>
Message-ID: <AANLkTi=+MXuwA-Nt3iXbvLP=cT1Z6-zAGJGYEnQRMfcR@mail.gmail.com>

On Thu, Nov 18, 2010 at 11:58 AM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:

> The problem is that finding buffers around each cell on a line (second step)
> is pretty RAM greedy. Would there be a more efficient way of "growing" a
> polygon, preferably without using external software?
>

gBuffer in package rgeos:

Description:

     Expands the given geometry to include the area within the
     specified width with specific styling options.

Any good? rgeos is a bit experimental at the moment I think... You
might need to build from source.

Barry


From r.hijmans at gmail.com  Thu Nov 18 15:29:18 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 18 Nov 2010 08:29:18 -0600
Subject: [R-sig-Geo] help me find a buffer around a polygon
In-Reply-To: <AANLkTinRqU5D-0TeSO7ki34s5o34cBzM99TFMXV1inJt@mail.gmail.com>
References: <AANLkTinRqU5D-0TeSO7ki34s5o34cBzM99TFMXV1inJt@mail.gmail.com>
Message-ID: <AANLkTinxGyW19Yxh+Q4T9KF6FjuGqNgFSFq_F_X2CuA8@mail.gmail.com>

Roman, Have you tried combinations of the functions 'edge', and
'distance' (and perhaps adjacency, if the 'amount' is expressed in
cells rather than distance). Robert

On Thu, Nov 18, 2010 at 5:58 AM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:
> Dear list,
>
> I've been searching around and I continue to do so, but in the mean time I'm
> seeking your advice on how to improve my approach.
>
> I'm using raster package and I'm trying to find cells around (let's call it
> a buffer) and inside a polygon. These subsetted cells are used for
> calculations later on. I'm basically trying to "grow" a polygon by a certain
> specified amount.
>
> I have created a raster with values derived as 1:ncell(my.object), where
> each value actually represents cell number and in a sense, position. This is
> the playground for my polygon.
>
> So far, I've approached this by:
> - find cell values inside the polygon (former raster::polygonValues)
> - find cell values within the buffer of SpatialLines object (made from the
> above polygon) (former raster::lineValues)
> - find unique cell values from the above results
>
> The problem is that finding buffers around each cell on a line (second step)
> is pretty RAM greedy. Would there be a more efficient way of "growing" a
> polygon, preferably without using external software?
>
>
> Cheers,
> Roman
>
>
>
> --
> In God we trust, all others bring data.
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From p.hiemstra at geo.uu.nl  Thu Nov 18 21:04:58 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 18 Nov 2010 21:04:58 +0100
Subject: [R-sig-Geo] boundaries for variogram
In-Reply-To: <AANLkTi=6qdP8nk73speukheviu66++8OP9G=76BzS70K@mail.gmail.com>
References: <AANLkTi=6qdP8nk73speukheviu66++8OP9G=76BzS70K@mail.gmail.com>
Message-ID: <4CE586EA.70603@geo.uu.nl>

On 11/16/2010 05:40 PM, Mark Connolly wrote:
> I noticed that autofitVariogram sets boundaries for the call to
> gstat::variogram along the lines of (0.35 * diag(bbox(sp)) /100) *
> c(2, 4, 6, 9, 12, 15, 25, 35, 50, 65, 80, 100).  Any idea of the basis
> of this method?
>
> Mark
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>    
Hi Mark,

Those values are quite a pragmatic choice, as I (and my co-authors) 
write in my paper[1]:

Any of the assumptions made may leave room for improvement of the 
procedures. As a first start, and for the purpose of automated mapping 
of natural ambient dose rates, they seemed appropriate.

But I'm open to a discussion on improving, do you have any concrete 
ideas right now?

Paul
package maintainer of automap

[1] http://dx.doi.org/10.1016/j.cageo.2008.10.011

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770


From p.hiemstra at geo.uu.nl  Thu Nov 18 21:12:57 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 18 Nov 2010 21:12:57 +0100
Subject: [R-sig-Geo] Adding a scale bar and north arrow to a ggplot
Message-ID: <4CE588C9.9090100@geo.uu.nl>

Dear list,

A common addition to any spatial plot are a north arrow and a scale bar. 
I've searched online for a straightforward way to add those to a ggplot 
plot. I then decided to give a go myself. A crude first attempt for an 
automatic scalebar addition function is listed below. The example works 
for the meuse dataset, but a second with a different dataset did yield 
good results.

My question to you is: is there anyone who has some good tips / example 
code to add a north arrow and a scalebar to a ggplot image. Any 
expansions on the code below are also welcome.

cheers,
Paul

ps Some info on my system is listed at the very bottom

library(sp)
library(ggplot2)

data(meuse)
data(meuse.grid)

string.length = function(s) {
#  browser()
   if(!is.character(s)) s = as.character(s)
   length(strsplit(s, "")[[1]])
}

makeNiceNumber = function(num, num.pretty = 1) {
   noNumbers = string.length(as.character(round(num)))
   return(round(num / 10^(noNumbers - num.pretty)) * 10^(noNumbers - 
num.pretty))
}

makeScaleBar = function(obj, plotname, xname = "x", yname = "y", unit = 
"m", placement = "bottomright") {
#     browser()
   range_x = max(obj[[xname]]) - min(obj[[xname]])
   range_y = max(obj[[yname]]) - min(obj[[yname]])
   if(placement == "bottomright") {
     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.05 *range_x ), 
string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
range_x)))
     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), 
string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
range_x)))
     ycoor = min(obj[[yname]]) + (0.05 * range_y)
   } else {
     xcoor.min = makeNiceNumber(max(obj[[xname]]) - (0.95 *range_x ), 
string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
range_x)))
     xcoor.max = makeNiceNumber(max(obj[[xname]]) - (0.5 *range_x ), 
string.length(round(max(obj[[xname]]))) - string.length(round(0.3 * 
range_x)))
     ycoor = min(obj[[yname]]) + (0.95 * range_y)
   }
   scalebar.data = data.frame(x = c(xcoor.max, xcoor.min), y = ycoor, 
lbl = c(paste(xcoor.max - xcoor.min, unit), 0))
   scalebar.data[[plotname]] = min(obj[[plotname]])
   return(list(geom_path(aes(x = x, y = y), data = scalebar.data, lwd = 
2, color = "black"),
           geom_text(aes(x = x, y = y, label = lbl), data = 
scalebar.data, vjust = 1.3)))
}

sb = makeScaleBar(meuse.grid, "dist", placement = "topright")
ggplot(aes(x  = x, y = y, fill = dist), data = meuse.grid) + geom_tile() 
+ sb[[1]] + sb[[2]]

R version 2.12.0 (2010-10-15)
Platform: i486-pc-linux-gnu (32-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] ggplot2_0.8.7 digest_0.4.2  reshape_0.8.3 plyr_0.1.9    proto_0.3-8
[6] sp_0.9-62

loaded via a namespace (and not attached):
[1] lattice_0.19-13

hiemstra at fg-113:~$ uname -a
Linux fg-113 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 
2010 i686 GNU/Linux

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770


From aleksandr.andreev at gmail.com  Fri Nov 19 00:28:32 2010
From: aleksandr.andreev at gmail.com (Aleksandr Andreev)
Date: Thu, 18 Nov 2010 18:28:32 -0500
Subject: [R-sig-Geo] Creating very large spatial weight matrix
Message-ID: <AANLkTin4rjY+3ACL+YdYrA8P6U0pLkLse=9Uq4YYmih5@mail.gmail.com>

Hello list,

I have 120,000 geocoded observations, for which I'm trying to create a
distance-based spatial weighting matrix so that I can perform a Moran
test.

Each observation has Lat and Lon.

Unfortunately, when I run
dists <- as.matrix(dist(cbind(Lon, Lat)))
I get the message:
Error in vector("double", length) : vector size specified is too large

Now I realize that 120,000^2 / 2 is on the order of 6 GB. However, I
seem to be running into software limitations on the vector size before
I hit RAM limitations. Also, in principle, it should be possible
(though slow) to use hard disk space to store this matrix. Does anyone
have any ideas on how to do this in R?

Thanks,

------------------------
Aleksandr Andreev
Graduate Student - Department of Economics
University of North Carolina at Chapel Hill


From mdsumner at gmail.com  Fri Nov 19 00:39:30 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 19 Nov 2010 10:39:30 +1100
Subject: [R-sig-Geo] Creating very large spatial weight matrix
In-Reply-To: <AANLkTin4rjY+3ACL+YdYrA8P6U0pLkLse=9Uq4YYmih5@mail.gmail.com>
References: <AANLkTin4rjY+3ACL+YdYrA8P6U0pLkLse=9Uq4YYmih5@mail.gmail.com>
Message-ID: <AANLkTikzGda2f3crOgt3hvA=PWBBpQdXEEVKfCCoWQPi@mail.gmail.com>

In general you need at least twice the required memory, and it has to
be contiguous. Try with a fresh instance of R and try to create a
single vector of that size, that might show that you *could* do it.

Otherwise, check out the ff package, and see other options in the High
Performance Computing Task View on CRAN.

There may be other techniques you can use to solve the problem, but
those two things are my direct answers to your questions.

Cheers, Mike.

On Fri, Nov 19, 2010 at 10:28 AM, Aleksandr Andreev
<aleksandr.andreev at gmail.com> wrote:
> Hello list,
>
> I have 120,000 geocoded observations, for which I'm trying to create a
> distance-based spatial weighting matrix so that I can perform a Moran
> test.
>
> Each observation has Lat and Lon.
>
> Unfortunately, when I run
> dists <- as.matrix(dist(cbind(Lon, Lat)))
> I get the message:
> Error in vector("double", length) : vector size specified is too large
>
> Now I realize that 120,000^2 / 2 is on the order of 6 GB. However, I
> seem to be running into software limitations on the vector size before
> I hit RAM limitations. Also, in principle, it should be possible
> (though slow) to use hard disk space to store this matrix. Does anyone
> have any ideas on how to do this in R?
>
> Thanks,
>
> ------------------------
> Aleksandr Andreev
> Graduate Student - Department of Economics
> University of North Carolina at Chapel Hill
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From mdsumner at gmail.com  Fri Nov 19 00:40:34 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 19 Nov 2010 10:40:34 +1100
Subject: [R-sig-Geo] Creating very large spatial weight matrix
In-Reply-To: <AANLkTikzGda2f3crOgt3hvA=PWBBpQdXEEVKfCCoWQPi@mail.gmail.com>
References: <AANLkTin4rjY+3ACL+YdYrA8P6U0pLkLse=9Uq4YYmih5@mail.gmail.com>
	<AANLkTikzGda2f3crOgt3hvA=PWBBpQdXEEVKfCCoWQPi@mail.gmail.com>
Message-ID: <AANLkTimmeNh6cThVqzwKG2k+j2vFT0FO04x56t1QMQa7@mail.gmail.com>

And, please report your OS and version of R (64-bit presumably?).



On Fri, Nov 19, 2010 at 10:39 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> In general you need at least twice the required memory, and it has to
> be contiguous. Try with a fresh instance of R and try to create a
> single vector of that size, that might show that you *could* do it.
>
> Otherwise, check out the ff package, and see other options in the High
> Performance Computing Task View on CRAN.
>
> There may be other techniques you can use to solve the problem, but
> those two things are my direct answers to your questions.
>
> Cheers, Mike.
>
> On Fri, Nov 19, 2010 at 10:28 AM, Aleksandr Andreev
> <aleksandr.andreev at gmail.com> wrote:
>> Hello list,
>>
>> I have 120,000 geocoded observations, for which I'm trying to create a
>> distance-based spatial weighting matrix so that I can perform a Moran
>> test.
>>
>> Each observation has Lat and Lon.
>>
>> Unfortunately, when I run
>> dists <- as.matrix(dist(cbind(Lon, Lat)))
>> I get the message:
>> Error in vector("double", length) : vector size specified is too large
>>
>> Now I realize that 120,000^2 / 2 is on the order of 6 GB. However, I
>> seem to be running into software limitations on the vector size before
>> I hit RAM limitations. Also, in principle, it should be possible
>> (though slow) to use hard disk space to store this matrix. Does anyone
>> have any ideas on how to do this in R?
>>
>> Thanks,
>>
>> ------------------------
>> Aleksandr Andreev
>> Graduate Student - Department of Economics
>> University of North Carolina at Chapel Hill
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From aleksandr.andreev at gmail.com  Fri Nov 19 00:42:53 2010
From: aleksandr.andreev at gmail.com (Aleksandr Andreev)
Date: Thu, 18 Nov 2010 18:42:53 -0500
Subject: [R-sig-Geo] Creating very large spatial weight matrix
In-Reply-To: <AANLkTimmeNh6cThVqzwKG2k+j2vFT0FO04x56t1QMQa7@mail.gmail.com>
References: <AANLkTin4rjY+3ACL+YdYrA8P6U0pLkLse=9Uq4YYmih5@mail.gmail.com>
	<AANLkTikzGda2f3crOgt3hvA=PWBBpQdXEEVKfCCoWQPi@mail.gmail.com>
	<AANLkTimmeNh6cThVqzwKG2k+j2vFT0FO04x56t1QMQa7@mail.gmail.com>
Message-ID: <AANLkTi=Zhy1vQ2i1T=1AV5WamdF=e06hn+oVoAhKLaJr@mail.gmail.com>

Yes, sorry, I'm running R 2.12.0 on Ubuntu 64-bit (kernel 2.6.32-25-generic)

Thanks for pointing out ff.


------------------------
Aleksandr Andreev
Graduate Student - Department of Economics
University of North Carolina at Chapel Hill
Mobile: +1 303 507 93 88
Skype: typiconman



2010/11/18 Michael Sumner <mdsumner at gmail.com>:
> And, please report your OS and version of R (64-bit presumably?).
>
>
>
> On Fri, Nov 19, 2010 at 10:39 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> In general you need at least twice the required memory, and it has to
>> be contiguous. Try with a fresh instance of R and try to create a
>> single vector of that size, that might show that you *could* do it.
>>
>> Otherwise, check out the ff package, and see other options in the High
>> Performance Computing Task View on CRAN.
>>
>> There may be other techniques you can use to solve the problem, but
>> those two things are my direct answers to your questions.
>>
>> Cheers, Mike.
>>
>> On Fri, Nov 19, 2010 at 10:28 AM, Aleksandr Andreev
>> <aleksandr.andreev at gmail.com> wrote:
>>> Hello list,
>>>
>>> I have 120,000 geocoded observations, for which I'm trying to create a
>>> distance-based spatial weighting matrix so that I can perform a Moran
>>> test.
>>>
>>> Each observation has Lat and Lon.
>>>
>>> Unfortunately, when I run
>>> dists <- as.matrix(dist(cbind(Lon, Lat)))
>>> I get the message:
>>> Error in vector("double", length) : vector size specified is too large
>>>
>>> Now I realize that 120,000^2 / 2 is on the order of 6 GB. However, I
>>> seem to be running into software limitations on the vector size before
>>> I hit RAM limitations. Also, in principle, it should be possible
>>> (though slow) to use hard disk space to store this matrix. Does anyone
>>> have any ideas on how to do this in R?
>>>
>>> Thanks,
>>>
>>> ------------------------
>>> Aleksandr Andreev
>>> Graduate Student - Department of Economics
>>> University of North Carolina at Chapel Hill
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> Michael Sumner
>> Institute for Marine and Antarctic Studies, University of Tasmania
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>


From mdsumner at gmail.com  Fri Nov 19 00:53:52 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 19 Nov 2010 10:53:52 +1100
Subject: [R-sig-Geo] Creating very large spatial weight matrix
In-Reply-To: <AANLkTimmeNh6cThVqzwKG2k+j2vFT0FO04x56t1QMQa7@mail.gmail.com>
References: <AANLkTin4rjY+3ACL+YdYrA8P6U0pLkLse=9Uq4YYmih5@mail.gmail.com>
	<AANLkTikzGda2f3crOgt3hvA=PWBBpQdXEEVKfCCoWQPi@mail.gmail.com>
	<AANLkTimmeNh6cThVqzwKG2k+j2vFT0FO04x56t1QMQa7@mail.gmail.com>
Message-ID: <AANLkTimTfODPLkpw1J2k=+df7aY2reQMDSO9fxeX94Jr@mail.gmail.com>

Sorry, I also realize that your vector is just too long - R is limited
to a 32-bit index, so it just cannot be done without special tricks in
separate vectors.

The ff package documentation mentions that 64-bit indexing may be
included in a future release, and there have been discussions on this
for base R. (perhaps for R 3.0)

Cheers, Mike


On Fri, Nov 19, 2010 at 10:40 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> And, please report your OS and version of R (64-bit presumably?).
>
>
>
> On Fri, Nov 19, 2010 at 10:39 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> In general you need at least twice the required memory, and it has to
>> be contiguous. Try with a fresh instance of R and try to create a
>> single vector of that size, that might show that you *could* do it.
>>
>> Otherwise, check out the ff package, and see other options in the High
>> Performance Computing Task View on CRAN.
>>
>> There may be other techniques you can use to solve the problem, but
>> those two things are my direct answers to your questions.
>>
>> Cheers, Mike.
>>
>> On Fri, Nov 19, 2010 at 10:28 AM, Aleksandr Andreev
>> <aleksandr.andreev at gmail.com> wrote:
>>> Hello list,
>>>
>>> I have 120,000 geocoded observations, for which I'm trying to create a
>>> distance-based spatial weighting matrix so that I can perform a Moran
>>> test.
>>>
>>> Each observation has Lat and Lon.
>>>
>>> Unfortunately, when I run
>>> dists <- as.matrix(dist(cbind(Lon, Lat)))
>>> I get the message:
>>> Error in vector("double", length) : vector size specified is too large
>>>
>>> Now I realize that 120,000^2 / 2 is on the order of 6 GB. However, I
>>> seem to be running into software limitations on the vector size before
>>> I hit RAM limitations. Also, in principle, it should be possible
>>> (though slow) to use hard disk space to store this matrix. Does anyone
>>> have any ideas on how to do this in R?
>>>
>>> Thanks,
>>>
>>> ------------------------
>>> Aleksandr Andreev
>>> Graduate Student - Department of Economics
>>> University of North Carolina at Chapel Hill
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> Michael Sumner
>> Institute for Marine and Antarctic Studies, University of Tasmania
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From Roger.Bivand at nhh.no  Fri Nov 19 09:08:27 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 19 Nov 2010 09:08:27 +0100 (CET)
Subject: [R-sig-Geo] Creating very large spatial weight matrix
In-Reply-To: <AANLkTi=Zhy1vQ2i1T=1AV5WamdF=e06hn+oVoAhKLaJr@mail.gmail.com>
References: <AANLkTin4rjY+3ACL+YdYrA8P6U0pLkLse=9Uq4YYmih5@mail.gmail.com>
	<AANLkTikzGda2f3crOgt3hvA=PWBBpQdXEEVKfCCoWQPi@mail.gmail.com>
	<AANLkTimmeNh6cThVqzwKG2k+j2vFT0FO04x56t1QMQa7@mail.gmail.com>
	<AANLkTi=Zhy1vQ2i1T=1AV5WamdF=e06hn+oVoAhKLaJr@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1011190859550.28835@reclus.nhh.no>

On Thu, 18 Nov 2010, Aleksandr Andreev wrote:

> Yes, sorry, I'm running R 2.12.0 on Ubuntu 64-bit (kernel 2.6.32-25-generic)

The actual answer is to use the function needed for this operation:

library(spdep)
coords <- cbind(Lon, Lat)
dnb <- dnearneigh(coords, 0, dmax, longlat=TRUE)

where dmax is a small distance in km. Of course, if you really need all 
the distances, all bets are off, but this would be an unusually specified 
picture of the underlying spatial process. I suggest not worrying about 
ensuring that all observations have at least one neighbour - for such a 
global measure as Moran's I for N=120', dropping a few cannot matter much. 
Go with a tight dmax, and it should just work. If dmax is loose, and the 
average number of neighbours creeps up, the nb object (and the following 
listw object) will get denser, with possibly some observations with 
thousands of neighbours, so oversmoothing the process.

If this is continental rather than whole-world, consider projecting to the 
plane and using graph-based neighbours (?graph2nb).

Hope this helps,

Roger


>
> Thanks for pointing out ff.
>
>
> ------------------------
> Aleksandr Andreev
> Graduate Student - Department of Economics
> University of North Carolina at Chapel Hill
> Mobile: +1 303 507 93 88
> Skype: typiconman
>
>
>
> 2010/11/18 Michael Sumner <mdsumner at gmail.com>:
>> And, please report your OS and version of R (64-bit presumably?).
>>
>>
>>
>> On Fri, Nov 19, 2010 at 10:39 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>>> In general you need at least twice the required memory, and it has to
>>> be contiguous. Try with a fresh instance of R and try to create a
>>> single vector of that size, that might show that you *could* do it.
>>>
>>> Otherwise, check out the ff package, and see other options in the High
>>> Performance Computing Task View on CRAN.
>>>
>>> There may be other techniques you can use to solve the problem, but
>>> those two things are my direct answers to your questions.
>>>
>>> Cheers, Mike.
>>>
>>> On Fri, Nov 19, 2010 at 10:28 AM, Aleksandr Andreev
>>> <aleksandr.andreev at gmail.com> wrote:
>>>> Hello list,
>>>>
>>>> I have 120,000 geocoded observations, for which I'm trying to create a
>>>> distance-based spatial weighting matrix so that I can perform a Moran
>>>> test.
>>>>
>>>> Each observation has Lat and Lon.
>>>>
>>>> Unfortunately, when I run
>>>> dists <- as.matrix(dist(cbind(Lon, Lat)))
>>>> I get the message:
>>>> Error in vector("double", length) : vector size specified is too large
>>>>
>>>> Now I realize that 120,000^2 / 2 is on the order of 6 GB. However, I
>>>> seem to be running into software limitations on the vector size before
>>>> I hit RAM limitations. Also, in principle, it should be possible
>>>> (though slow) to use hard disk space to store this matrix. Does anyone
>>>> have any ideas on how to do this in R?
>>>>
>>>> Thanks,
>>>>
>>>> ------------------------
>>>> Aleksandr Andreev
>>>> Graduate Student - Department of Economics
>>>> University of North Carolina at Chapel Hill
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>>
>>> --
>>> Michael Sumner
>>> Institute for Marine and Antarctic Studies, University of Tasmania
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>
>>
>>
>> --
>> Michael Sumner
>> Institute for Marine and Antarctic Studies, University of Tasmania
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From roman.lustrik at gmail.com  Fri Nov 19 11:31:53 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 19 Nov 2010 11:31:53 +0100
Subject: [R-sig-Geo] help me find a buffer around a polygon
In-Reply-To: <AANLkTinxGyW19Yxh+Q4T9KF6FjuGqNgFSFq_F_X2CuA8@mail.gmail.com>
References: <AANLkTinRqU5D-0TeSO7ki34s5o34cBzM99TFMXV1inJt@mail.gmail.com>
	<AANLkTinxGyW19Yxh+Q4T9KF6FjuGqNgFSFq_F_X2CuA8@mail.gmail.com>
Message-ID: <AANLkTinThxnmd=YgoZSpGOOVjxyXHBFhRNhqaezUspao@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101119/c6ba1662/attachment.pl>

From alobolistas at gmail.com  Fri Nov 19 15:50:11 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 19 Nov 2010 15:50:11 +0100
Subject: [R-sig-Geo] calc, overlay and raster stacks
Message-ID: <AANLkTikW3CuUThgnUn_2w-3dQ+n5eHxL++9VsLhGZQAA@mail.gmail.com>

Hi!

I have to set as NA data in a 3D array (time series of images)
according to values in another 3D array of Quality flags

#Example
NDVI = round(array(rnorm(5*5*3,180,10),dim=c(5,5,3)))
SM = array(rep(248,5*5*3),dim=c(5,5,3))
SM[4,3:4,1:2] = 232
SM[2,3:4,1:2] = 243
SM[3,4,1:2] = 243

#The only valid data are the ones for which SM is either 232 or 248, so:
NDVI[SM!=248] <- NA
NDVI[SM!=232] <- NA
#which is the same as
NDVI[SM!=248 & SM!=232] <- NA

#The problem is that what I really have are images 3697 columns x
1905 rows and 360 Bands (and even larger) , so I try package raster

require(rgdal)
require(raster)

#First, I make fake data:
rNDVI = stack(raster(NDVI[,,1]),raster(NDVI[,,2]),raster(NDVI[,,2]))
rSM = stack(raster(SM[,,1]),raster(SM[,,2]),raster(SM[,,2]))

fun <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
> rc <- overlay(rNDVI, rSM, fun)
Error in function (classes, fdef, mtable)  :
  unable to find an inherited method for function "overlay", for
signature "RasterStack", "RasterStack"
Calls: overlay -> <Anonymous>

#It seems that calc() must be used for stacks, but seems to me that calc()
#only accepts one stack, not two. Maybe I should just stack both NDVI and SM?

Thanks!
Agus


From r.hijmans at gmail.com  Fri Nov 19 15:56:32 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 19 Nov 2010 08:56:32 -0600
Subject: [R-sig-Geo] calc, overlay and raster stacks
In-Reply-To: <AANLkTikW3CuUThgnUn_2w-3dQ+n5eHxL++9VsLhGZQAA@mail.gmail.com>
References: <AANLkTikW3CuUThgnUn_2w-3dQ+n5eHxL++9VsLhGZQAA@mail.gmail.com>
Message-ID: <AANLkTi=caMNGhUkc5CJ2Me0h9kz-jDT7ibE2wBk8j1US@mail.gmail.com>

Hi Agus,

Your example with overlay works for me. I think you need to update
'raster' . In earlier versions many functions only worked for
RasterLayer objects, now most functions also support multi-layer
(RasterStack or RasterBrick) objects.

Robert

On Fri, Nov 19, 2010 at 8:50 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
>
> I have to set as NA data in a 3D array (time series of images)
> according to values in another 3D array of Quality flags
>
> #Example
> NDVI = round(array(rnorm(5*5*3,180,10),dim=c(5,5,3)))
> SM = array(rep(248,5*5*3),dim=c(5,5,3))
> SM[4,3:4,1:2] = 232
> SM[2,3:4,1:2] = 243
> SM[3,4,1:2] = 243
>
> #The only valid data are the ones for which SM is either 232 or 248, so:
> NDVI[SM!=248] <- NA
> NDVI[SM!=232] <- NA
> #which is the same as
> NDVI[SM!=248 & SM!=232] <- NA
>
> #The problem is that what I really have are images 3697 columns x
> 1905 rows and 360 Bands (and even larger) , so I try package raster
>
> require(rgdal)
> require(raster)
>
> #First, I make fake data:
> rNDVI = stack(raster(NDVI[,,1]),raster(NDVI[,,2]),raster(NDVI[,,2]))
> rSM = stack(raster(SM[,,1]),raster(SM[,,2]),raster(SM[,,2]))
>
> fun <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
>> rc <- overlay(rNDVI, rSM, fun)
> Error in function (classes, fdef, mtable) ?:
> ?unable to find an inherited method for function "overlay", for
> signature "RasterStack", "RasterStack"
> Calls: overlay -> <Anonymous>
>
> #It seems that calc() must be used for stacks, but seems to me that calc()
> #only accepts one stack, not two. Maybe I should just stack both NDVI and SM?
>
> Thanks!
> Agus
>


From alobolistas at gmail.com  Fri Nov 19 19:04:39 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 19 Nov 2010 19:04:39 +0100
Subject: [R-sig-Geo] calc, overlay and raster stacks
In-Reply-To: <AANLkTi=caMNGhUkc5CJ2Me0h9kz-jDT7ibE2wBk8j1US@mail.gmail.com>
References: <AANLkTikW3CuUThgnUn_2w-3dQ+n5eHxL++9VsLhGZQAA@mail.gmail.com>
	<AANLkTi=caMNGhUkc5CJ2Me0h9kz-jDT7ibE2wBk8j1US@mail.gmail.com>
Message-ID: <AANLkTinihmfAngbt_7JOeSe1eUKtdsjEAdy3cz90Axfc@mail.gmail.com>

Thanks!

It works with raster_1.6-22 and  sp_0.9-72

The last 2 lines must be
fun1 <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
rc <- overlay(rNDVI, rSM, fun=fun1)

Is it required to include datatype and/or format in overlay() to get
the result (rc) written to disk
and not fully loaded in RAM?

Agus

2010/11/19 Robert J. Hijmans <r.hijmans at gmail.com>:
> Hi Agus,
>
> Your example with overlay works for me. I think you need to update
> 'raster' . In earlier versions many functions only worked for
> RasterLayer objects, now most functions also support multi-layer
> (RasterStack or RasterBrick) objects.
>
> Robert
>
> On Fri, Nov 19, 2010 at 8:50 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi!
>>
>> I have to set as NA data in a 3D array (time series of images)
>> according to values in another 3D array of Quality flags
>>
>> #Example
>> NDVI = round(array(rnorm(5*5*3,180,10),dim=c(5,5,3)))
>> SM = array(rep(248,5*5*3),dim=c(5,5,3))
>> SM[4,3:4,1:2] = 232
>> SM[2,3:4,1:2] = 243
>> SM[3,4,1:2] = 243
>>
>> #The only valid data are the ones for which SM is either 232 or 248, so:
>> NDVI[SM!=248] <- NA
>> NDVI[SM!=232] <- NA
>> #which is the same as
>> NDVI[SM!=248 & SM!=232] <- NA
>>
>> #The problem is that what I really have are images 3697 columns x
>> 1905 rows and 360 Bands (and even larger) , so I try package raster
>>
>> require(rgdal)
>> require(raster)
>>
>> #First, I make fake data:
>> rNDVI = stack(raster(NDVI[,,1]),raster(NDVI[,,2]),raster(NDVI[,,2]))
>> rSM = stack(raster(SM[,,1]),raster(SM[,,2]),raster(SM[,,2]))
>>
>> fun <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
>>> rc <- overlay(rNDVI, rSM, fun)
>> Error in function (classes, fdef, mtable) ?:
>> ?unable to find an inherited method for function "overlay", for
>> signature "RasterStack", "RasterStack"
>> Calls: overlay -> <Anonymous>
>>
>> #It seems that calc() must be used for stacks, but seems to me that calc()
>> #only accepts one stack, not two. Maybe I should just stack both NDVI and SM?
>>
>> Thanks!
>> Agus
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Fri Nov 19 20:09:20 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 19 Nov 2010 13:09:20 -0600
Subject: [R-sig-Geo] calc, overlay and raster stacks
In-Reply-To: <AANLkTinihmfAngbt_7JOeSe1eUKtdsjEAdy3cz90Axfc@mail.gmail.com>
References: <AANLkTikW3CuUThgnUn_2w-3dQ+n5eHxL++9VsLhGZQAA@mail.gmail.com>
	<AANLkTi=caMNGhUkc5CJ2Me0h9kz-jDT7ibE2wBk8j1US@mail.gmail.com>
	<AANLkTinihmfAngbt_7JOeSe1eUKtdsjEAdy3cz90Axfc@mail.gmail.com>
Message-ID: <AANLkTimAuXBF_sv3+L-+Sm3-PYnJdtvOxU770WsCX7Rf@mail.gmail.com>

Agus,

There are some variations, but generally the functions in raster
assess if the data can be loaded, processed and kept in memory. And
they do so if possible. If not, and if no filename argument was
provided, the results will be written to a temporary file. If you do
provide a filename argument, the resulting object won't have the
values in memory (only a reference to them). Setting 'format' and
'datatype' is optional. format can be omitted if you provide a known
extension (e.g. filename='abc.tif' )

Robert


On Fri, Nov 19, 2010 at 12:04 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Thanks!
>
> It works with raster_1.6-22 and ?sp_0.9-72
>
> The last 2 lines must be
> fun1 <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
> rc <- overlay(rNDVI, rSM, fun=fun1)
>
> Is it required to include datatype and/or format in overlay() to get
> the result (rc) written to disk
> and not fully loaded in RAM?
>
> Agus
>
> 2010/11/19 Robert J. Hijmans <r.hijmans at gmail.com>:
>> Hi Agus,
>>
>> Your example with overlay works for me. I think you need to update
>> 'raster' . In earlier versions many functions only worked for
>> RasterLayer objects, now most functions also support multi-layer
>> (RasterStack or RasterBrick) objects.
>>
>> Robert
>>
>> On Fri, Nov 19, 2010 at 8:50 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>> Hi!
>>>
>>> I have to set as NA data in a 3D array (time series of images)
>>> according to values in another 3D array of Quality flags
>>>
>>> #Example
>>> NDVI = round(array(rnorm(5*5*3,180,10),dim=c(5,5,3)))
>>> SM = array(rep(248,5*5*3),dim=c(5,5,3))
>>> SM[4,3:4,1:2] = 232
>>> SM[2,3:4,1:2] = 243
>>> SM[3,4,1:2] = 243
>>>
>>> #The only valid data are the ones for which SM is either 232 or 248, so:
>>> NDVI[SM!=248] <- NA
>>> NDVI[SM!=232] <- NA
>>> #which is the same as
>>> NDVI[SM!=248 & SM!=232] <- NA
>>>
>>> #The problem is that what I really have are images 3697 columns x
>>> 1905 rows and 360 Bands (and even larger) , so I try package raster
>>>
>>> require(rgdal)
>>> require(raster)
>>>
>>> #First, I make fake data:
>>> rNDVI = stack(raster(NDVI[,,1]),raster(NDVI[,,2]),raster(NDVI[,,2]))
>>> rSM = stack(raster(SM[,,1]),raster(SM[,,2]),raster(SM[,,2]))
>>>
>>> fun <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
>>>> rc <- overlay(rNDVI, rSM, fun)
>>> Error in function (classes, fdef, mtable) ?:
>>> ?unable to find an inherited method for function "overlay", for
>>> signature "RasterStack", "RasterStack"
>>> Calls: overlay -> <Anonymous>
>>>
>>> #It seems that calc() must be used for stacks, but seems to me that calc()
>>> #only accepts one stack, not two. Maybe I should just stack both NDVI and SM?
>>>
>>> Thanks!
>>> Agus
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From alobolistas at gmail.com  Fri Nov 19 20:24:12 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 19 Nov 2010 20:24:12 +0100
Subject: [R-sig-Geo] get() in raster ?
Message-ID: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>

Hi again!

I'm having problems because cannot use get()  from base once package
raster has been installed:

> v = c("r1","r2","r3")
> v
[1] "r1" "r2" "r3"
> get(v)
Loading required package: raster
Loading required package: sp
raster version 1.6-22 (17-November-2010)
class       : RasterLayer
nrow        : 18
ncol        : 36
ncell       : 648
projection  : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
xmin        : -180
xmax        : 180
ymin        : -90
ymax        : 90
xres        : 10
yres        : 10

Even not having loaded raster, it gets automatically loaded once I
call get(). Is this a bug?
In general, is there a way to force that, in case of conflict, you run
a particular function from a given package?

Thanks!

Agus


From landis at isciences.com  Fri Nov 19 20:31:28 2010
From: landis at isciences.com (Matthew Landis)
Date: Fri, 19 Nov 2010 14:31:28 -0500
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
Message-ID: <4CE6D090.3070807@isciences.com>

On 11/19/2010 2:24 PM, Agustin Lobo wrote:
> Even not having loaded raster, it gets automatically loaded once I
> call get(). Is this a bug?

Agus, that doesn't occur for me.  Here's what happens on my machine (and 
I do have raster installed, but not loaded).   Note the difference in 
behavior between get(v) and get('v') .

 > v = c("r1","r2","r3")
 > v
[1] "r1" "r2" "r3"
 > get(v)
Error in get(v) : object 'r1' not found
 > get('v')
[1] "r1" "r2" "r3"
 > sessionInfo()
R version 2.11.1 (2010-05-31)
x86_64-pc-mingw32

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United 
States.1252
[3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.11.1


-- 
~~~~~~~~~~~~~~~~~~~~~~~~~~
Matthew Landis, Ph.D.
Research Scientist
ISciences, LLC
61 Main St. Suite 200
Burlington VT 05401
802.864.2999
~~~~~~~~~~~~~~~~~~~~~~~~~~


From ckir at vet.dtu.dk  Fri Nov 19 20:32:16 2010
From: ckir at vet.dtu.dk (Carsten Kirkeby)
Date: Fri, 19 Nov 2010 11:32:16 -0800 (PST)
Subject: [R-sig-Geo] neighbour list problem - read.gwt2nb
Message-ID: <1290195136815-5756395.post@n2.nabble.com>


Hi!

I am trying to model local moran?s I with the package spdep. But there are
some hurdles to overcome first..
The first one is to make a neighbours list (by hand, specifying neighbours
in a .txt file)

I have made a .txt file with neighbours (apparently the "old style GWT", but
that should be no problem?) 
The  neighbours list file is quoted below. There are 22 points that should
have neighbours in 8 directions (less in the edge points). According to
"Applied Spatial Data Analysis with R", a neighbour relation should only be
specified one time each (which means that when writing the neighbour
relations in a list, one will write less and less neighbours to each point).
But when I run the summary of the list, the average number of links is
2.818182. This should be around 5. Have I understood this wrong? I
appreciate any help, as I have searched for a long time without results. An
example script is written below:

Sincerely
Carsten Kirkeby

Example:

library(spdep)
test <- read.gwt2nb("neighbours.txt")
summary(test)

#coordinates for the 22 points:
coox <- c(1,2,3,4,5)
cooy <- c(3,1,2,0,3)

#and a plot for illustration:
plot(test,matrix(cbind(coox,cooy),ncol=2))
text(coox,cooy,as.character(1:5),pos=rep(3,5))


Contents of the neighbours.txt file:

22
1 20 1
1 21 1
1 13 1
1 2 1
2 20 1
2 13 1
2 12 1
2 3 1
3 13 1
3 12 1
3 5 1
3 4 1
4 12 1
4 5 1
5 12 1
5 11 1
5 6 1
6 12 1
6 11 1
6 10 1
6 7 1
7 11 1
7 10 1
7 9 1
7 8 1
8 10 1
8 9 1
9 16 1
9 15 1
9 10 1
10 16 1
10 15 1
10 14 1
10 11 1
11 15 1
11 14 1
11 13 1
11 12 1
12 14 1
12 13 1
13 14 1
13 19 1
13 20 1
14 15 1
14 18 1
14 19 1
14 20 1
15 16 1
15 17 1
15 18 1
15 19 1
16 17 1
16 18 1
17 18 1
18 19 1
18 22 1
19 20 1
19 22 1
19 21 1
20 21 1
20 22 1
21 22 1


-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/neighbour-list-problem-read-gwt2nb-tp5756395p5756395.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ckir at vet.dtu.dk  Fri Nov 19 20:39:40 2010
From: ckir at vet.dtu.dk (Carsten Kirkeby)
Date: Fri, 19 Nov 2010 11:39:40 -0800 (PST)
Subject: [R-sig-Geo] neighbour list problem - read.gwt2nb
In-Reply-To: <1290195136815-5756395.post@n2.nabble.com>
References: <1290195136815-5756395.post@n2.nabble.com>
Message-ID: <1290195580339-5756412.post@n2.nabble.com>


Hi again!

I am terribly sorry, I got a couple of wrong lines copied into the question
above. The script example should be this:

test2 <- read.gwt2nb("neighbours.txt")
summary(test2)

#and the coordinates:
coox <- c(5,5,5,5,4,3,2,1,1,2,3,4,4,3,2,1,1,2,3,4,4,3)
cooy <- c(4,3,2,1,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5)

#and a plot for illustration
plot(test2,matrix(cbind(coox,cooy),ncol=2))
text(coox,cooy,as.character(1:22),pos=rep(2,22), col="red", cex=0.8)

The .txt file is the same as above.

Sincerely
Carsten Kirkeby
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/neighbour-list-problem-read-gwt2nb-tp5756395p5756412.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alobolistas at gmail.com  Fri Nov 19 20:41:02 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 19 Nov 2010 20:41:02 +0100
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <4CE6D090.3070807@isciences.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
	<4CE6D090.3070807@isciences.com>
Message-ID: <AANLkTikj=29jUT26bLp6Eq7xw39e8Zh8fFbL+QPNJoYb@mail.gmail.com>

Thanks,
Kind of weird, isn't it?
I don't understand the behavior of get() in your case either. I would
expect get(v) just returning the value of v, not going down to evaluate r1

And you remind me I should have posted the result
of sessionInfo():

> v <- c("r1","r2","r3")
> get(v)
Loading required package: raster
Loading required package: sp
raster version 1.6-22 (17-November-2010)
class       : RasterLayer
nrow        : 18
ncol        : 36
ncell       : 648
projection  : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
xmin        : -180
xmax        : 180
ymin        : -90
ymax        : 90
xres        : 10
yres        : 10
> str(v)
 chr [1:3] "r1" "r2" "r3"
> sessionInfo()
R version 2.12.0 (2010-10-15)
Platform: i486-pc-linux-gnu (32-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] raster_1.6-22 sp_0.9-72

loaded via a namespace (and not attached):
[1] grid_2.12.0     lattice_0.19-13
>



2010/11/19 Matthew Landis <landis at isciences.com>:
> On 11/19/2010 2:24 PM, Agustin Lobo wrote:
>>
>> Even not having loaded raster, it gets automatically loaded once I
>> call get(). Is this a bug?
>
> Agus, that doesn't occur for me. ?Here's what happens on my machine (and I
> do have raster installed, but not loaded). ? Note the difference in behavior
> between get(v) and get('v') .
>
>> v = c("r1","r2","r3")
>> v
> [1] "r1" "r2" "r3"
>> get(v)
> Error in get(v) : object 'r1' not found
>> get('v')
> [1] "r1" "r2" "r3"
>> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-pc-mingw32
>
> locale:
> [1] LC_COLLATE=English_United States.1252 ?LC_CTYPE=English_United
> States.1252
> [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> loaded via a namespace (and not attached):
> [1] tools_2.11.1
>
>
> --
> ~~~~~~~~~~~~~~~~~~~~~~~~~~
> Matthew Landis, Ph.D.
> Research Scientist
> ISciences, LLC
> 61 Main St. Suite 200
> Burlington VT 05401
> 802.864.2999
> ~~~~~~~~~~~~~~~~~~~~~~~~~~
>
>


From carson.farmer at gmail.com  Fri Nov 19 20:53:14 2010
From: carson.farmer at gmail.com (Carson Farmer)
Date: Fri, 19 Nov 2010 19:53:14 +0000
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <AANLkTikj=29jUT26bLp6Eq7xw39e8Zh8fFbL+QPNJoYb@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
	<4CE6D090.3070807@isciences.com>
	<AANLkTikj=29jUT26bLp6Eq7xw39e8Zh8fFbL+QPNJoYb@mail.gmail.com>
Message-ID: <AANLkTikmvLxmgnbbEDFi+0JwYqPR=VrX_VrimDDkgdRj@mail.gmail.com>

Agus, according to ?get, x should be a variable name (given as a
character string). So one *should* expect the behaviour that Matthew
describes:

> v = c("r1","r2","r3")
> v
[1] "r1" "r2" "r3"
> get(v)
Error in get(v) : object 'r1' not found
> get('v')
[1] "r1" "r2" "r3"

Carson


On 19 November 2010 19:41, Agustin Lobo <alobolistas at gmail.com> wrote:
> Thanks,
> Kind of weird, isn't it?
> I don't understand the behavior of get() in your case either. I would
> expect get(v) just returning the value of v, not going down to evaluate r1
>
> And you remind me I should have posted the result
> of sessionInfo():
>
>> v <- c("r1","r2","r3")
>> get(v)
> Loading required package: raster
> Loading required package: sp
> raster version 1.6-22 (17-November-2010)
> class ? ? ? : RasterLayer
> nrow ? ? ? ?: 18
> ncol ? ? ? ?: 36
> ncell ? ? ? : 648
> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> xmin ? ? ? ?: -180
> xmax ? ? ? ?: 180
> ymin ? ? ? ?: -90
> ymax ? ? ? ?: 90
> xres ? ? ? ?: 10
> yres ? ? ? ?: 10
>> str(v)
> ?chr [1:3] "r1" "r2" "r3"
>> sessionInfo()
> R version 2.12.0 (2010-10-15)
> Platform: i486-pc-linux-gnu (32-bit)
>
> locale:
> ?[1] LC_CTYPE=en_US.UTF-8 ? ? ? LC_NUMERIC=C
> ?[3] LC_TIME=en_US.UTF-8 ? ? ? ?LC_COLLATE=en_US.UTF-8
> ?[5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_US.UTF-8
> ?[7] LC_PAPER=en_US.UTF-8 ? ? ? LC_NAME=C
> ?[9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> [1] raster_1.6-22 sp_0.9-72
>
> loaded via a namespace (and not attached):
> [1] grid_2.12.0 ? ? lattice_0.19-13
>>
>
>
>
> 2010/11/19 Matthew Landis <landis at isciences.com>:
>> On 11/19/2010 2:24 PM, Agustin Lobo wrote:
>>>
>>> Even not having loaded raster, it gets automatically loaded once I
>>> call get(). Is this a bug?
>>
>> Agus, that doesn't occur for me. ?Here's what happens on my machine (and I
>> do have raster installed, but not loaded). ? Note the difference in behavior
>> between get(v) and get('v') .
>>
>>> v = c("r1","r2","r3")
>>> v
>> [1] "r1" "r2" "r3"
>>> get(v)
>> Error in get(v) : object 'r1' not found
>>> get('v')
>> [1] "r1" "r2" "r3"
>>> sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> x86_64-pc-mingw32
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252 ?LC_CTYPE=English_United
>> States.1252
>> [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>> [5] LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> loaded via a namespace (and not attached):
>> [1] tools_2.11.1
>>
>>
>> --
>> ~~~~~~~~~~~~~~~~~~~~~~~~~~
>> Matthew Landis, Ph.D.
>> Research Scientist
>> ISciences, LLC
>> 61 Main St. Suite 200
>> Burlington VT 05401
>> 802.864.2999
>> ~~~~~~~~~~~~~~~~~~~~~~~~~~
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Carson J. Q. Farmer
ISSP Doctoral Fellow
National Centre for Geocomputation
National University of Ireland, Maynooth,
http://www.carsonfarmer.com/


From r.hijmans at gmail.com  Fri Nov 19 21:00:44 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 19 Nov 2010 14:00:44 -0600
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
Message-ID: <AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>

This suggest that you have an object "r1" that is a Raster* object.
Perhaps because of a saved session?
Have you looked at
ls()
Robert

On Fri, Nov 19, 2010 at 1:24 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi again!
>
> I'm having problems because cannot use get() ?from base once package
> raster has been installed:
>
>> v = c("r1","r2","r3")
>> v
> [1] "r1" "r2" "r3"
>> get(v)
> Loading required package: raster
> Loading required package: sp
> raster version 1.6-22 (17-November-2010)
> class ? ? ? : RasterLayer
> nrow ? ? ? ?: 18
> ncol ? ? ? ?: 36
> ncell ? ? ? : 648
> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> xmin ? ? ? ?: -180
> xmax ? ? ? ?: 180
> ymin ? ? ? ?: -90
> ymax ? ? ? ?: 90
> xres ? ? ? ?: 10
> yres ? ? ? ?: 10
>
> Even not having loaded raster, it gets automatically loaded once I
> call get(). Is this a bug?
> In general, is there a way to force that, in case of conflict, you run
> a particular function from a given package?
>
> Thanks!
>
> Agus
>


From alobolistas at gmail.com  Sat Nov 20 11:51:01 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sat, 20 Nov 2010 11:51:01 +0100
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
	<AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
Message-ID: <AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>

ok, the problem is that, as noted by Carson,
I must use get("v") and not get(v).

But still have problems to use get() within stack() or brick():
> r1 = raster(SM[,,1])
> r2 = raster(SM[,,2])
> r3 = raster(SM[,,3])
> v = c("r1","r2","r3")
> get("v")
[1] "r1" "r2" "r3"
> bSM = brick(get(v))
Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
  file: r1r2r3 does not exist
Calls: brick -> brick -> .local -> .rasterObjectFromFile

( I'm trying to use get() because have to
create a brick with 360 files that have been read as raster objects within
a loop using assign() )

Agus


2010/11/19 Robert J. Hijmans <r.hijmans at gmail.com>:
> This suggest that you have an object "r1" that is a Raster* object.
> Perhaps because of a saved session?
> Have you looked at
> ls()
> Robert
>
> On Fri, Nov 19, 2010 at 1:24 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi again!
>>
>> I'm having problems because cannot use get() ?from base once package
>> raster has been installed:
>>
>>> v = c("r1","r2","r3")
>>> v
>> [1] "r1" "r2" "r3"
>>> get(v)
>> Loading required package: raster
>> Loading required package: sp
>> raster version 1.6-22 (17-November-2010)
>> class ? ? ? : RasterLayer
>> nrow ? ? ? ?: 18
>> ncol ? ? ? ?: 36
>> ncell ? ? ? : 648
>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>> xmin ? ? ? ?: -180
>> xmax ? ? ? ?: 180
>> ymin ? ? ? ?: -90
>> ymax ? ? ? ?: 90
>> xres ? ? ? ?: 10
>> yres ? ? ? ?: 10
>>
>> Even not having loaded raster, it gets automatically loaded once I
>> call get(). Is this a bug?
>> In general, is there a way to force that, in case of conflict, you run
>> a particular function from a given package?
>>
>> Thanks!
>>
>> Agus
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Sat Nov 20 12:23:57 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 20 Nov 2010 12:23:57 +0100
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>	<AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
	<AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
Message-ID: <4CE7AFCD.2000303@uni-muenster.de>

Agus, maybe what you're looking for is

v = list("r1","r2","r3")
do.call(brick, v)


On 11/20/2010 11:51 AM, Agustin Lobo wrote:
> ok, the problem is that, as noted by Carson,
> I must use get("v") and not get(v).
> 
> But still have problems to use get() within stack() or brick():
>> r1 = raster(SM[,,1])
>> r2 = raster(SM[,,2])
>> r3 = raster(SM[,,3])
>> v = c("r1","r2","r3")
>> get("v")
> [1] "r1" "r2" "r3"
>> bSM = brick(get(v))
> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>   file: r1r2r3 does not exist
> Calls: brick -> brick -> .local -> .rasterObjectFromFile
> 
> ( I'm trying to use get() because have to
> create a brick with 360 files that have been read as raster objects within
> a loop using assign() )
> 
> Agus
> 
> 
> 2010/11/19 Robert J. Hijmans <r.hijmans at gmail.com>:
>> This suggest that you have an object "r1" that is a Raster* object.
>> Perhaps because of a saved session?
>> Have you looked at
>> ls()
>> Robert
>>
>> On Fri, Nov 19, 2010 at 1:24 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>> Hi again!
>>>
>>> I'm having problems because cannot use get()  from base once package
>>> raster has been installed:
>>>
>>>> v = c("r1","r2","r3")
>>>> v
>>> [1] "r1" "r2" "r3"
>>>> get(v)
>>> Loading required package: raster
>>> Loading required package: sp
>>> raster version 1.6-22 (17-November-2010)
>>> class       : RasterLayer
>>> nrow        : 18
>>> ncol        : 36
>>> ncell       : 648
>>> projection  : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>> xmin        : -180
>>> xmax        : 180
>>> ymin        : -90
>>> ymax        : 90
>>> xres        : 10
>>> yres        : 10
>>>
>>> Even not having loaded raster, it gets automatically loaded once I
>>> call get(). Is this a bug?
>>> In general, is there a way to force that, in case of conflict, you run
>>> a particular function from a given package?
>>>
>>> Thanks!
>>>
>>> Agus
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Sat Nov 20 12:25:39 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 20 Nov 2010 12:25:39 +0100
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>	<AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
	<AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
Message-ID: <4CE7B033.5030108@uni-muenster.de>

Just pushed "send" too fast -- try without quotes to pass the objects
instead of their names:

v = list(r1, r2, r3)
do.call(brick, v)


On 11/20/2010 11:51 AM, Agustin Lobo wrote:
> ok, the problem is that, as noted by Carson,
> I must use get("v") and not get(v).
> 
> But still have problems to use get() within stack() or brick():
>> r1 = raster(SM[,,1])
>> r2 = raster(SM[,,2])
>> r3 = raster(SM[,,3])
>> v = c("r1","r2","r3")
>> get("v")
> [1] "r1" "r2" "r3"
>> bSM = brick(get(v))
> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>   file: r1r2r3 does not exist
> Calls: brick -> brick -> .local -> .rasterObjectFromFile
> 
> ( I'm trying to use get() because have to
> create a brick with 360 files that have been read as raster objects within
> a loop using assign() )
> 
> Agus
> 
> 
> 2010/11/19 Robert J. Hijmans <r.hijmans at gmail.com>:
>> This suggest that you have an object "r1" that is a Raster* object.
>> Perhaps because of a saved session?
>> Have you looked at
>> ls()
>> Robert
>>
>> On Fri, Nov 19, 2010 at 1:24 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>> Hi again!
>>>
>>> I'm having problems because cannot use get()  from base once package
>>> raster has been installed:
>>>
>>>> v = c("r1","r2","r3")
>>>> v
>>> [1] "r1" "r2" "r3"
>>>> get(v)
>>> Loading required package: raster
>>> Loading required package: sp
>>> raster version 1.6-22 (17-November-2010)
>>> class       : RasterLayer
>>> nrow        : 18
>>> ncol        : 36
>>> ncell       : 648
>>> projection  : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>> xmin        : -180
>>> xmax        : 180
>>> ymin        : -90
>>> ymax        : 90
>>> xres        : 10
>>> yres        : 10
>>>
>>> Even not having loaded raster, it gets automatically loaded once I
>>> call get(). Is this a bug?
>>> In general, is there a way to force that, in case of conflict, you run
>>> a particular function from a given package?
>>>
>>> Thanks!
>>>
>>> Agus
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matevz.pavlic at gi-zrmk.si  Sat Nov 20 12:29:55 2010
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Sat, 20 Nov 2010 12:29:55 +0100
Subject: [R-sig-Geo] Zerodist
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B9EB59A5@gi-zrmk.si>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101120/a21f4e23/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sat Nov 20 12:38:44 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 20 Nov 2010 12:38:44 +0100
Subject: [R-sig-Geo] Zerodist
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B9EB59A5@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B9EB59A5@gi-zrmk.si>
Message-ID: <4CE7B344.4020008@uni-muenster.de>

if your data are in d, pass d[-zerodist(d)[,1],] as data argument to the
kriging function.

This arbitrarily removes duplicate points, so they are ignored in the
kriging. If you want to do something more sophisticated, zerodist can be
used to identify the duplicate pairs.

On 11/20/2010 12:29 PM, Matev? Pavli? wrote:
> Hi all, 
> 
>  
> 
> I got the 
> 
>> "chfactor.c", line 130: singular matrix in function LDLfactor()
> 
> Error in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  : 
> 
> LDLfactor<
> 
>  
> 
> Error, probably because there are some point pairs with zero distance in the matrix. My question is, how can i delete these duplicate nodes from the data set?
> 
>  
> 
> Thanks, m
> 
>  
> 
>  
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matevz.pavlic at gi-zrmk.si  Sat Nov 20 12:55:34 2010
From: matevz.pavlic at gi-zrmk.si (=?utf-8?B?TWF0ZXbFviBQYXZsacSN?=)
Date: Sat, 20 Nov 2010 12:55:34 +0100
Subject: [R-sig-Geo] Zerodist
References: <AD5CA6183570B54F92AA45CE2619F9B9EB59A5@gi-zrmk.si>
	<4CE7B344.4020008@uni-muenster.de> 
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B9EB59A8@gi-zrmk.si>

Hi Edzer, 

I have this line that i would like to use for kriging :

OK.Res1<-krige(Res1~1, loc=DF, newdata=grd, model=vmf1)

Where should i input d[-zerodist(d)[,1],]?

Thanks, m
-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Edzer Pebesma
Sent: Saturday, November 20, 2010 12:39 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Zerodist

if your data are in d, pass as data argument to the kriging function.

This arbitrarily removes duplicate points, so they are ignored in the kriging. If you want to do something more sophisticated, zerodist can be used to identify the duplicate pairs.

On 11/20/2010 12:29 PM, Matev? Pavli? wrote:
> Hi all,
> 
>  
> 
> I got the
> 
>> "chfactor.c", line 130: singular matrix in function LDLfactor()
> 
> Error in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  : 
> 
> LDLfactor<
> 
>  
> 
> Error, probably because there are some point pairs with zero distance in the matrix. My question is, how can i delete these duplicate nodes from the data set?
> 
>  
> 
> Thanks, m
> 
>  
> 
>  
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From edzer.pebesma at uni-muenster.de  Sat Nov 20 13:44:57 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 20 Nov 2010 13:44:57 +0100
Subject: [R-sig-Geo] Zerodist
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B9EB59A8@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B9EB59A5@gi-zrmk.si>	<4CE7B344.4020008@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B9EB59A8@gi-zrmk.si>
Message-ID: <4CE7C2C9.8080502@uni-muenster.de>

OK.Res1 <- krige(Res1~1, DF[-zerodist(DF)[,1],], grd, vmf1)

On 11/20/2010 12:55 PM, Matev? Pavli? wrote:
> Hi Edzer, 
> 
> I have this line that i would like to use for kriging :
> 
> OK.Res1<-krige(Res1~1, loc=DF, newdata=grd, model=vmf1)
> 
> Where should i input d[-zerodist(d)[,1],]?
> 
> Thanks, m
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Edzer Pebesma
> Sent: Saturday, November 20, 2010 12:39 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Zerodist
> 
> if your data are in d, pass as data argument to the kriging function.
> 
> This arbitrarily removes duplicate points, so they are ignored in the kriging. If you want to do something more sophisticated, zerodist can be used to identify the duplicate pairs.
> 
> On 11/20/2010 12:29 PM, Matev? Pavli? wrote:
>> Hi all,
>>
>>  
>>
>> I got the
>>
>>> "chfactor.c", line 130: singular matrix in function LDLfactor()
>>
>> Error in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  : 
>>
>> LDLfactor<
>>
>>  
>>
>> Error, probably because there are some point pairs with zero distance in the matrix. My question is, how can i delete these duplicate nodes from the data set?
>>
>>  
>>
>> Thanks, m
>>
>>  
>>
>>  
>>
>>  
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matevz.pavlic at gi-zrmk.si  Sat Nov 20 17:19:16 2010
From: matevz.pavlic at gi-zrmk.si (=?utf-8?B?TWF0ZXbFviBQYXZsacSN?=)
Date: Sat, 20 Nov 2010 17:19:16 +0100
Subject: [R-sig-Geo] Zerodist
In-Reply-To: <4CE7C2C9.8080502@uni-muenster.de>
References: <AD5CA6183570B54F92AA45CE2619F9B9EB59A5@gi-zrmk.si>	<4CE7B344.4020008@uni-muenster.de><AD5CA6183570B54F92AA45CE2619F9B9EB59A8@gi-zrmk.si>
	<4CE7C2C9.8080502@uni-muenster.de>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B9EB59AA@gi-zrmk.si>

Hi, 

Thanks for the help, 

m

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Edzer Pebesma
Sent: Saturday, November 20, 2010 1:45 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Zerodist

OK.Res1 <- krige(Res1~1, DF[-zerodist(DF)[,1],], grd, vmf1)

On 11/20/2010 12:55 PM, Matev? Pavli? wrote:
> Hi Edzer,
> 
> I have this line that i would like to use for kriging :
> 
> OK.Res1<-krige(Res1~1, loc=DF, newdata=grd, model=vmf1)
> 
> Where should i input d[-zerodist(d)[,1],]?
> 
> Thanks, m
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Edzer 
> Pebesma
> Sent: Saturday, November 20, 2010 12:39 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Zerodist
> 
> if your data are in d, pass as data argument to the kriging function.
> 
> This arbitrarily removes duplicate points, so they are ignored in the kriging. If you want to do something more sophisticated, zerodist can be used to identify the duplicate pairs.
> 
> On 11/20/2010 12:29 PM, Matev? Pavli? wrote:
>> Hi all,
>>
>>  
>>
>> I got the
>>
>>> "chfactor.c", line 130: singular matrix in function LDLfactor()
>>
>> Error in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  : 
>>
>> LDLfactor<
>>
>>  
>>
>> Error, probably because there are some point pairs with zero distance in the matrix. My question is, how can i delete these duplicate nodes from the data set?
>>
>>  
>>
>> Thanks, m
>>
>>  
>>
>>  
>>
>>  
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From Roger.Bivand at nhh.no  Sat Nov 20 21:47:02 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 20 Nov 2010 21:47:02 +0100 (CET)
Subject: [R-sig-Geo] neighbour list problem - read.gwt2nb
In-Reply-To: <1290195580339-5756412.post@n2.nabble.com>
References: <1290195136815-5756395.post@n2.nabble.com>
	<1290195580339-5756412.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.00.1011202139120.4522@reclus.nhh.no>

On Fri, 19 Nov 2010, Carsten Kirkeby wrote:

>
> Hi again!
>
> I am terribly sorry, I got a couple of wrong lines copied into the question
> above. The script example should be this:
>
> test2 <- read.gwt2nb("neighbours.txt")
> summary(test2)
>
> #and the coordinates:
> coox <- c(5,5,5,5,4,3,2,1,1,2,3,4,4,3,2,1,1,2,3,4,4,3)
> cooy <- c(4,3,2,1,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5)
>
> #and a plot for illustration
> plot(test2,matrix(cbind(coox,cooy),ncol=2))
> text(coox,cooy,as.character(1:22),pos=rep(2,22), col="red", cex=0.8)
>
> The .txt file is the same as above.

I think that you are assuming that nb objects assume that if i is a 
neighbour of j, then j is automatically a neighbour of i. This is not the 
case, and both i, j and j, i neighours must be recorded (GWT also assumes 
that the user must provide all the neighbour links). In your case, try 
also:

test2a <- make.sym.nb(test2)
# to make the object symmetric, assuming this was your intention
summary(test2a)
write.sn2gwt(listw2sn(nb2listw(test2a, style="B")), "neighboursA.txt")
file.show("neighboursA.txt")

to indicate what your input file perhaps should have been. I'm not sure 
where you read this in ASDAR ch. 9 - it is correct that an i, j 
relationship should only be given once (no duplicate directed graph 
edges), but this does not mean that the presence of i, j implies that j, i 
is present too (in k-nearest neighbours objects, this is very unlikely, 
for example).

Hope this helps,

Roger

>
> Sincerely
> Carsten Kirkeby
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From swamp at blarg.net  Sun Nov 21 04:25:43 2010
From: swamp at blarg.net (Mike Marsh)
Date: Sat, 20 Nov 2010 19:25:43 -0800
Subject: [R-sig-Geo] difficulty loading package "sp"
In-Reply-To: <mailman.0.1290280523.13591.r-sig-geo@stat.math.ethz.ch>
References: <mailman.0.1290280523.13591.r-sig-geo@stat.math.ethz.ch>
Message-ID: <4CE89137.9080506@blarg.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101120/29f455f0/attachment.pl>

From kevinummel at gmail.com  Sun Nov 21 12:08:19 2010
From: kevinummel at gmail.com (Kevin Ummel)
Date: Sun, 21 Nov 2010 11:08:19 +0000
Subject: [R-sig-Geo] get() in raster ?
Message-ID: <CEEA5A15-0252-4FE2-AF26-ABBD78916866@gmail.com>

You might also look here:

http://www.mail-archive.com/r-help at r-project.org/msg117045.html

The proposed solution worked for 'stack' but not for 'overlay'

cheers,
Kevin


From Roger.Bivand at nhh.no  Sun Nov 21 12:14:30 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 21 Nov 2010 12:14:30 +0100 (CET)
Subject: [R-sig-Geo] difficulty loading package "sp"
In-Reply-To: <4CE89137.9080506@blarg.net>
References: <mailman.0.1290280523.13591.r-sig-geo@stat.math.ethz.ch>
	<4CE89137.9080506@blarg.net>
Message-ID: <alpine.LRH.2.00.1011211207090.9525@reclus.nhh.no>

On Sat, 20 Nov 2010, Mike Marsh wrote:

> Hello all,
> This is my first message to this list.
> I'm reading "Applied spatial data analysis with R", and trying to
> install "sp".
> I went to http://cran.r-project.org/ then to  Packages, but did not find
> "sp"
> I found and downloaded sp_0.9-72.zip
> <http://cran.r-project.org/bin/windows/contrib/r-release/sp_0.9-72.zip>from
> the page linked to CRAN Task View Analysis of Spatial Data, moved the
> zipped package to my library folder under R-2.8.1, and unzipped it,
> obtaining folder sp_0.9-72 I opened R in folder library, and called

No, this is not how you install binary contributed packages on Windows. 
You use the Packages -> menu item, choosing sp from the (long) list that 
appears after you have chosen a CRAN mirror. Alternatively, you can simply 
enter install.packages("sp") at the console prompt, you will be asked for 
a CRAN mirror. Never mess with the R library folders, its contents and 
index are updated within R, and are not for users to meddle with.

You are also running R 2.8.1 (current is 2.12.0), so installing manually 
(had you done it properly by downloading the correct zip archive and using 
the Packages -> Install from local zip file option) would only work for 
the 2.8 binary build of the package:

http://cran.r-project.org/bin/windows/contrib/2.8/sp_0.9-37.zip

but this should be selected automatically if you use the system correctly.

Hope this helps,

Roger

>
> > library(sp)
> Error in library(sp) : there is no package called 'sp', version 0.9-72
> then I tried
> > library(sp_0.9-72)
> Error in library(sp_0.9 - 72) : 'package' must be of length 1
> then I opened sp 0.9.-72 and moved folder sp to be under the parent
> directory, library
> > > library(sp)
> Error: This is R 2.8.1, package 'sp' needs >= 2.10.0
>
> I tried "update.package"
>
> > update.packages(sp)
> Error in update.packages(sp) : object "sp" not found
> >
> I then tried Update Packages(), which resulted in me updating a bunch of
> other packages, but unfortunately left them in
> C:\WINDOWS\Temp\RtmpmtERQd\downloaded_packages, and considering my
> success so far, I'm afraid to move them or touch them.
> I was running R-2.8.0 last year when I took Jon Bakker's course
> "Analytical methods for community ecology", but upgraded this year to 2.8.1.
> Not knowing where to find a package "sp" that is >= 2.10.0, I turn to
> you for help.
>
> Thanks,
> Mike
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From v8extra at gmail.com  Sun Nov 21 17:48:37 2010
From: v8extra at gmail.com (=?iso-8859-1?Q?S=E9bastien_Durand?=)
Date: Sun, 21 Nov 2010 11:48:37 -0500
Subject: [R-sig-Geo] Triangulation questions
Message-ID: <702495AC-9583-4E2F-ABE7-7E74FB9006F2@gmail.com>


Hello,

I have an irregular data set that I which to map using delaunay triangulation, using vector based representation! 
After spending quite a lot of time in the mailing list and in diverse package library, my discovery is that cannot still find a way to accomplish what I am looking for. 

1- Since most packages allow for 2d triangulation, I have been able to actually layout of each triangles of the convex hull, but how to I get to apply the Z value to all of those triangles?

	Personally, I did the average of all the corner of every triangle, apply that average to the triangle polygons and plotted them.
	My reaction, there must be a better way, there must already have a function that would allow me to do this?

2- Moreover, after looking at Delaunay triangulation information on the web, I found that some software are creating sub triangles (inside every triangle) to provide through the means of interpolation more definition to every triangles. 

Using interpolation, they would generate extra sets of polygons inside the actual triangle, thus giving a smoother map...  Any idea if a function like that exist in R.


3- I am very open regarding the mean by which I am gonna plot those data, I would also be very happy to try out a raster solution... 


So I just can't wait to ear back from you guys...

Thanks


From alobolistas at gmail.com  Sun Nov 21 19:22:47 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 21 Nov 2010 19:22:47 +0100
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <4CE7B033.5030108@uni-muenster.de>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
	<AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
	<AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
	<4CE7B033.5030108@uni-muenster.de>
Message-ID: <AANLkTimYpUbTJBdW=SBnyWDroqxA9cA3-9sAtdR4ZoNg@mail.gmail.com>

Thanks Edzer, but neither work:
> v = list("r1","r2","r3")
> do.call(brick, v)
Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
  file: r1 does not exist
Calls: do.call ... <Anonymous> -> <Anonymous> -> .local -> .rasterObjectFromFile

> v = list(r1, r2, r3)
> bN = do.call(brick, v)
Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
  file: r1r2r3 does not exist
Calls: do.call ... <Anonymous> -> <Anonymous> -> .local -> .rasterObjectFromFile
In addition: Warning messages:
1: In if (x == "" | x == ".") { :
  the condition has length > 1 and only the first element will be used
2: In if (fileext %in% c(".GRD", ".GRI")) { :
  the condition has length > 1 and only the first element will be used
3: In if (!file.exists(x)) { :
  the condition has length > 1 and only the first element will be used
4: In if (file.exists(grdfile) & file.exists(grifile)) { :
  the condition has length > 1 and only the first element will be used

Also, in the real case the raster objects (i.e.,N1, N2 and N3) will
not have values in memory, so I'm not
positive that the list would be the way to go:

> class(N1)
[1] "RasterLayer"
attr(,"package")
[1] "raster"

> inMemory(N1)
[1] FALSE

> v = list(N1, N2, N3)
> bN = do.call(brick, v)
Error in as.matrix(getValues(r)) :
  error in evaluating the argument 'x' in selecting a method for
function 'as.matrix'
Calls: do.call ... <Anonymous> -> addLayer -> addLayer -> .local -> as.matrix

By now I'm editing the output of
paste("N",1:360,sep="")
for a call to brick() including the 360 raster objects. But there has
to be an elegant way of doing this. Not a critical issue though.

Agus

2010/11/20 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
> Just pushed "send" too fast -- try without quotes to pass the objects
> instead of their names:
>
> v = list(r1, r2, r3)
> do.call(brick, v)
>
>
> On 11/20/2010 11:51 AM, Agustin Lobo wrote:
>> ok, the problem is that, as noted by Carson,
>> I must use get("v") and not get(v).
>>
>> But still have problems to use get() within stack() or brick():
>>> r1 = raster(SM[,,1])
>>> r2 = raster(SM[,,2])
>>> r3 = raster(SM[,,3])
>>> v = c("r1","r2","r3")
>>> get("v")
>> [1] "r1" "r2" "r3"
>>> bSM = brick(get(v))
>> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>> ? file: r1r2r3 does not exist
>> Calls: brick -> brick -> .local -> .rasterObjectFromFile
>>
>> ( I'm trying to use get() because have to
>> create a brick with 360 files that have been read as raster objects within
>> a loop using assign() )
>>
>> Agus
>>
>>
>> 2010/11/19 Robert J. Hijmans <r.hijmans at gmail.com>:
>>> This suggest that you have an object "r1" that is a Raster* object.
>>> Perhaps because of a saved session?
>>> Have you looked at
>>> ls()
>>> Robert
>>>
>>> On Fri, Nov 19, 2010 at 1:24 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>>> Hi again!
>>>>
>>>> I'm having problems because cannot use get() ?from base once package
>>>> raster has been installed:
>>>>
>>>>> v = c("r1","r2","r3")
>>>>> v
>>>> [1] "r1" "r2" "r3"
>>>>> get(v)
>>>> Loading required package: raster
>>>> Loading required package: sp
>>>> raster version 1.6-22 (17-November-2010)
>>>> class ? ? ? : RasterLayer
>>>> nrow ? ? ? ?: 18
>>>> ncol ? ? ? ?: 36
>>>> ncell ? ? ? : 648
>>>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>>> xmin ? ? ? ?: -180
>>>> xmax ? ? ? ?: 180
>>>> ymin ? ? ? ?: -90
>>>> ymax ? ? ? ?: 90
>>>> xres ? ? ? ?: 10
>>>> yres ? ? ? ?: 10
>>>>
>>>> Even not having loaded raster, it gets automatically loaded once I
>>>> call get(). Is this a bug?
>>>> In general, is there a way to force that, in case of conflict, you run
>>>> a particular function from a given package?
>>>>
>>>> Thanks!
>>>>
>>>> Agus
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.turner at auckland.ac.nz  Sun Nov 21 20:09:22 2010
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Mon, 22 Nov 2010 08:09:22 +1300
Subject: [R-sig-Geo] difficulty loading package "sp"
In-Reply-To: <4CE89137.9080506@blarg.net>
References: <mailman.0.1290280523.13591.r-sig-geo@stat.math.ethz.ch>
	<4CE89137.9080506@blarg.net>
Message-ID: <436FD42E-E625-4FB4-8898-F5179805D615@auckland.ac.nz>


On 21/11/2010, at 4:25 PM, Mike Marsh wrote:

> Hello all,
> This is my first message to this list.
> I'm reading "Applied spatial data analysis with R", and trying to 
> install "sp".
> I went to http://cran.r-project.org/ then to  Packages, but did not find 
> "sp"

	You can't have looked very hard.

> I found and downloaded sp_0.9-72.zip 
> <http://cran.r-project.org/bin/windows/contrib/r-release/sp_0.9-72.zip>from 
> the page linked to CRAN Task View Analysis of Spatial Data, moved the 
> zipped package to my library folder under R-2.8.1, and unzipped it, 
> obtaining folder sp_0.9-72 I opened R in folder library, and called
> 
>> library(sp)
> Error in library(sp) : there is no package called 'sp', version 0.9-72
> then I tried
>> library(sp_0.9-72)
> Error in library(sp_0.9 - 72) : 'package' must be of length 1
> then I opened sp 0.9.-72 and moved folder sp to be under the parent 
> directory, library
>>> library(sp)
> Error: This is R 2.8.1, package 'sp' needs >= 2.10.0

	You need to install the package before you try to load it.
> 
> I tried "update.package"
> 
>> update.packages(sp)
> Error in update.packages(sp) : object "sp" not found

	Look at the error message.  There is no object named "sp" in your
	search path.  You would need to to update.packages("sp") were this
	the appropriate thing to do.  Which it isn't.  You haven't yet
	(ever) installed sp, so how can you update it?

	Try doing install.packages("sp").
>> 
> I then tried Update Packages(), which resulted in me updating a bunch of 
> other packages, but unfortunately left them in 
> C:\WINDOWS\Temp\RtmpmtERQd\downloaded_packages, and considering my 
> success so far, I'm afraid to move them or touch them.
> I was running R-2.8.0 last year when I took Jon Bakker's course 
> "Analytical methods for community ecology", but upgraded this year to 2.8.1.
> Not knowing where to find a package "sp" that is >= 2.10.0, I turn to 
> you for help.

	The current version of R is 2.12.0.

		cheers,

			Rolf Turner

From alobolistas at gmail.com  Sun Nov 21 23:44:15 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 21 Nov 2010 23:44:15 +0100
Subject: [R-sig-Geo] Problem with format in overlay()
Message-ID: <AANLkTikAGxmNC4ykp4_B27pFhmg2AHpXYUqyDZ+GjZ4=@mail.gmail.com>

Hi!

I do:
> bc <- overlay(sN, sSM, fun=fun1,filename="testoverlay.tif",overwrite=TRUE)

but if I specify the format:
> bc <- overlay(sN, sSM, fun=fun1,filename="testoverlay.tif",overwrite=TRUE,format='GTiff',datatype='INT1U')
Error in .rasterObjectFromFile(x, band = band, objecttype = "RasterLayer",  :
  file: /media/FREECOM_HDD/VGT/SM/GTiff does not exist
Calls: overlay ... raster -> raster -> .local -> .rasterObjectFromFile

writeRaster(bc,
filename="bc.tif",overwrite=TRUE,format="GTiff",datatype='INT2U')
works fine, therefore the error above is not big issue.

Thanks

Agus


From r.hijmans at gmail.com  Mon Nov 22 00:51:23 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 21 Nov 2010 15:51:23 -0800
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <AANLkTimYpUbTJBdW=SBnyWDroqxA9cA3-9sAtdR4ZoNg@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
	<AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
	<AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
	<4CE7B033.5030108@uni-muenster.de>
	<AANLkTimYpUbTJBdW=SBnyWDroqxA9cA3-9sAtdR4ZoNg@mail.gmail.com>
Message-ID: <AANLkTimMvCeju8ncxn5r7NxvxuVMrFMgVTpjkmz5JLiu@mail.gmail.com>

Hi Agus,

This is somewhat puzzling. The general approach works in this example:

r1 <- raster(nrow=10, ncol=10)
r1[] <- 1
r3 <- r2 <- r1
v <- list(r1, r2, r3)
do.call(stack, v)

# or simply:
s <- stack(v)

# or the more convoluted, if you have the object names rather than the
objects themselves:
v <- list(get("r1"), get("r2"), get("r3"))
s <- stack(v)

#And finally, if you want a brick (as you are dealing with large
files, I think it is more efficient to first make a stack and then
write the results to a brick):

b <- brick(s)

# Although in my example, this does also work:
b <- do.call(brick, v)



On Sun, Nov 21, 2010 at 10:22 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Thanks Edzer, but neither work:
>> v = list("r1","r2","r3")
>> do.call(brick, v)
> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
> ?file: r1 does not exist
> Calls: do.call ... <Anonymous> -> <Anonymous> -> .local -> .rasterObjectFromFile

Makes sense, because you are using character arguments, which are
interpreted as filenames.

>> v = list(r1, r2, r3)
>> bN = do.call(brick, v)
> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
> ?file: r1r2r3 does not exist

Strange to have r1r2r3 concatenated.

> Calls: do.call ... <Anonymous> -> <Anonymous> -> .local -> .rasterObjectFromFile
> In addition: Warning messages:
> 1: In if (x == "" | x == ".") { :
> ?the condition has length > 1 and only the first element will be used
> 2: In if (fileext %in% c(".GRD", ".GRI")) { :
> ?the condition has length > 1 and only the first element will be used
> 3: In if (!file.exists(x)) { :
> ?the condition has length > 1 and only the first element will be used
> 4: In if (file.exists(grdfile) & file.exists(grifile)) { :
> ?the condition has length > 1 and only the first element will be used
>
> Also, in the real case the raster objects (i.e.,N1, N2 and N3) will
> not have values in memory, so I'm not
> positive that the list would be the way to go:
>

Should not matter

>> class(N1)
> [1] "RasterLayer"
> attr(,"package")
> [1] "raster"
>
>> inMemory(N1)
> [1] FALSE
>
>> v = list(N1, N2, N3)
>> bN = do.call(brick, v)
> Error in as.matrix(getValues(r)) :
> ?error in evaluating the argument 'x' in selecting a method for
> function 'as.matrix'
> Calls: do.call ... <Anonymous> -> addLayer -> addLayer -> .local -> as.matrix

This may be a real bug. But perhaps you can do
sN = brick( do.call(stack, v) )

>
> By now I'm editing the output of
> paste("N",1:360,sep="")
> for a call to brick() including the 360 raster objects. But there has
> to be an elegant way of doing this. Not a critical issue though.
>
> Agus
>
> 2010/11/20 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
>> Just pushed "send" too fast -- try without quotes to pass the objects
>> instead of their names:
>>
>> v = list(r1, r2, r3)
>> do.call(brick, v)
>>
>>
>> On 11/20/2010 11:51 AM, Agustin Lobo wrote:
>>> ok, the problem is that, as noted by Carson,
>>> I must use get("v") and not get(v).
>>>
>>> But still have problems to use get() within stack() or brick():
>>>> r1 = raster(SM[,,1])
>>>> r2 = raster(SM[,,2])
>>>> r3 = raster(SM[,,3])
>>>> v = c("r1","r2","r3")
>>>> get("v")
>>> [1] "r1" "r2" "r3"
>>>> bSM = brick(get(v))
>>> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>>> ? file: r1r2r3 does not exist
>>> Calls: brick -> brick -> .local -> .rasterObjectFromFile
>>>
>>> ( I'm trying to use get() because have to
>>> create a brick with 360 files that have been read as raster objects within
>>> a loop using assign() )
>>>
>>> Agus
>>>
>>>
>>> 2010/11/19 Robert J. Hijmans <r.hijmans at gmail.com>:
>>>> This suggest that you have an object "r1" that is a Raster* object.
>>>> Perhaps because of a saved session?
>>>> Have you looked at
>>>> ls()
>>>> Robert
>>>>
>>>> On Fri, Nov 19, 2010 at 1:24 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>>>> Hi again!
>>>>>
>>>>> I'm having problems because cannot use get() ?from base once package
>>>>> raster has been installed:
>>>>>
>>>>>> v = c("r1","r2","r3")
>>>>>> v
>>>>> [1] "r1" "r2" "r3"
>>>>>> get(v)
>>>>> Loading required package: raster
>>>>> Loading required package: sp
>>>>> raster version 1.6-22 (17-November-2010)
>>>>> class ? ? ? : RasterLayer
>>>>> nrow ? ? ? ?: 18
>>>>> ncol ? ? ? ?: 36
>>>>> ncell ? ? ? : 648
>>>>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>>>> xmin ? ? ? ?: -180
>>>>> xmax ? ? ? ?: 180
>>>>> ymin ? ? ? ?: -90
>>>>> ymax ? ? ? ?: 90
>>>>> xres ? ? ? ?: 10
>>>>> yres ? ? ? ?: 10
>>>>>
>>>>> Even not having loaded raster, it gets automatically loaded once I
>>>>> call get(). Is this a bug?
>>>>> In general, is there a way to force that, in case of conflict, you run
>>>>> a particular function from a given package?
>>>>>
>>>>> Thanks!
>>>>>
>>>>> Agus
>>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jochen at hunter.cuny.edu  Mon Nov 22 05:52:37 2010
From: jochen at hunter.cuny.edu (Jochen Albrecht)
Date: Sun, 21 Nov 2010 23:52:37 -0500
Subject: [R-sig-Geo] raster values disappear in polygonsToRaster
In-Reply-To: <AANLkTimMvCeju8ncxn5r7NxvxuVMrFMgVTpjkmz5JLiu@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
	<AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
	<AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
	<4CE7B033.5030108@uni-muenster.de>
	<AANLkTimYpUbTJBdW=SBnyWDroqxA9cA3-9sAtdR4ZoNg@mail.gmail.com>
	<AANLkTimMvCeju8ncxn5r7NxvxuVMrFMgVTpjkmz5JLiu@mail.gmail.com>
Message-ID: <4CE9F715.8080201@hunter.cuny.edu>


This is an odd one. I have used polygonsToRaster repeatedly and 
successfully.
But this evening I am stumped by the fact that the raster values are 
properly reported as part of the function output but seem not to make it 
into the raster object. What went wrong here?
Cheers,
     Jochen

 > polygonsToRaster(UE_spdf, UE2rot, field=2, updateRaster=FALSE)
Found 7050 region(s) and 14648 polygon(s)
class       : RasterLayer
filename    : C:/Temp/R_raster_tmp/raster_tmp_56110763822.grd
nrow        : 3600
ncol        : 7200
ncell       : 25920000
min value   : 53
max value   : 94649
projection  : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs 
+towgs84=0,0,0
xmin        : -180
xmax        : 180
ymin        : -90
ymax        : 90
xres        : 0.05
yres        : 0.05

 > plot(UE2rot, col='red')
Error in .plotraster(x, col = col, maxpixels = maxpixels, ...) :
   no values associated with this RasterLayer

 > UE2rot
class       : RasterLayer
filename    :
nrow        : 3600
ncol        : 7200
ncell       : 25920000
min value   :
max value   :
projection  : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs 
+towgs84=0,0,0
xmin        : -180
xmax        : 180
ymin        : -90
ymax        : 90
xres        : 0.05
yres        : 0.05


From r.hijmans at gmail.com  Mon Nov 22 06:44:48 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 21 Nov 2010 21:44:48 -0800
Subject: [R-sig-Geo] raster values disappear in polygonsToRaster
In-Reply-To: <4CE9F715.8080201@hunter.cuny.edu>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
	<AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
	<AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
	<4CE7B033.5030108@uni-muenster.de>
	<AANLkTimYpUbTJBdW=SBnyWDroqxA9cA3-9sAtdR4ZoNg@mail.gmail.com>
	<AANLkTimMvCeju8ncxn5r7NxvxuVMrFMgVTpjkmz5JLiu@mail.gmail.com>
	<4CE9F715.8080201@hunter.cuny.edu>
Message-ID: <AANLkTi=b2UL-pTFbPP=jps8BmPo40cb6=6pyPKLJt4pW@mail.gmail.com>

Jochen,

It seems you forgot to "catch" the result of the function, and that
you want to do something like:

x <- polygonsToRaster(UE_spdf, UE2rot, field=2, updateRaster=FALSE)
plot(x)

Please note that in the current version of 'raster' this function is
deprecated and you will be warned to use the new function 'rasterize'
in stead.

Robert

On Sun, Nov 21, 2010 at 8:52 PM, Jochen Albrecht <jochen at hunter.cuny.edu> wrote:
>
> This is an odd one. I have used polygonsToRaster repeatedly and
> successfully.
> But this evening I am stumped by the fact that the raster values are
> properly reported as part of the function output but seem not to make it
> into the raster object. What went wrong here?
> Cheers,
> ? ?Jochen
>
>> polygonsToRaster(UE_spdf, UE2rot, field=2, updateRaster=FALSE)
> Found 7050 region(s) and 14648 polygon(s)
> class ? ? ? : RasterLayer
> filename ? ?: C:/Temp/R_raster_tmp/raster_tmp_56110763822.grd
> nrow ? ? ? ?: 3600
> ncol ? ? ? ?: 7200
> ncell ? ? ? : 25920000
> min value ? : 53
> max value ? : 94649
> projection ?: +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
> +towgs84=0,0,0
> xmin ? ? ? ?: -180
> xmax ? ? ? ?: 180
> ymin ? ? ? ?: -90
> ymax ? ? ? ?: 90
> xres ? ? ? ?: 0.05
> yres ? ? ? ?: 0.05
>
>> plot(UE2rot, col='red')
> Error in .plotraster(x, col = col, maxpixels = maxpixels, ...) :
> ?no values associated with this RasterLayer
>
>> UE2rot
> class ? ? ? : RasterLayer
> filename ? ?:
> nrow ? ? ? ?: 3600
> ncol ? ? ? ?: 7200
> ncell ? ? ? : 25920000
> min value ? :
> max value ? :
> projection ?: +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
> +towgs84=0,0,0
> xmin ? ? ? ?: -180
> xmax ? ? ? ?: 180
> ymin ? ? ? ?: -90
> ymax ? ? ? ?: 90
> xres ? ? ? ?: 0.05
> yres ? ? ? ?: 0.05
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From ogbos.okike at gmail.com  Mon Nov 22 07:51:17 2010
From: ogbos.okike at gmail.com (ogbos okike)
Date: Mon, 22 Nov 2010 08:51:17 +0200
Subject: [R-sig-Geo] Changing axes of a plot
Message-ID: <AANLkTim=mMKRdyWOz19MLAVvr6xQ8sAcg+qS1-gkQy_a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101122/08b5f67d/attachment.pl>

From elaine.kuo.tw at gmail.com  Mon Nov 22 13:56:59 2010
From: elaine.kuo.tw at gmail.com (elaine kuo)
Date: Mon, 22 Nov 2010 20:56:59 +0800
Subject: [R-sig-Geo] How to calculate squared R of spatial autoregressive
	models
In-Reply-To: <AANLkTimJoRY-i8GoOS_QRwbk4MqrnqsYdZA-nrEt0fGN@mail.gmail.com>
References: <AANLkTimJoRY-i8GoOS_QRwbk4MqrnqsYdZA-nrEt0fGN@mail.gmail.com>
Message-ID: <AANLkTinzjCGLvUhEyQwavNCnOCiwHz9ZtpOzf7TVTUzq@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101122/f9143ef4/attachment.pl>

From Roger.Bivand at nhh.no  Mon Nov 22 14:19:33 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 22 Nov 2010 14:19:33 +0100 (CET)
Subject: [R-sig-Geo] How to calculate squared R of spatial
 autoregressive models
In-Reply-To: <AANLkTinzjCGLvUhEyQwavNCnOCiwHz9ZtpOzf7TVTUzq@mail.gmail.com>
References: <AANLkTimJoRY-i8GoOS_QRwbk4MqrnqsYdZA-nrEt0fGN@mail.gmail.com>
	<AANLkTinzjCGLvUhEyQwavNCnOCiwHz9ZtpOzf7TVTUzq@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1011221414210.13000@reclus.nhh.no>

On Mon, 22 Nov 2010, elaine kuo wrote:

> Dear List,
>
>
>
> I am comparing the squared R values of linear models and its spatial
> autoregressive counterparts. (SARerror)
>
> (1. lm (Y~X1)
>
> 2. lm (Y~ X1+X2)
>
> 3. lm(Y~X1+X2+X3))
>
>
>
> The squared R values of linear models are generated by command summary 
> (lm).
>
>
> Similarly, I tried to produce those of spatial autoregressive models 
> based on the squared Pearson?s correlation of explanatory and response 
> variables. It failed

Don't. There is no direct equivalent to the OLS R-squared, these models 
are fitted by maximum likelihood. You may choose to compare 
likelihood-based measures, so a likelihood ratio test (as reported in the 
output of the summary method for the fitted model) between the fitted 
model and an OLS model with the spatial coefficient fixed at zero is OK. 
If you want something like an R-squared, try the Nagelkerke R-bar-squared, 
based on the likelihood, reported optionally in the summary object - see 
?summary.sarlm. You should then compare this with a Nagelkerke value for 
your OLS model if you feel that this would be helpful.

Roger

>
>
>
> The code is as followed.
>
> Please kindly modify the code and thank you.
>
>
>
> 1. single predictor
>
> sar.x1 <-errorsarlm(Y~X1,data=datam.std,listw=nb8.w, na.action=na.omit,
> method="Matrix", zero.policy=TRUE)
>
> summary(sar.x1)
>
> cor(sar.x1$X1, sar.x1$Y, method = "pearson")
>
>
>
> error message
>
> error in cor(sar.x1$ X1, sar.x1$Y, method = "pearson") :
>
>  supply both 'x' and 'y' or a matrix-like 'x'
>
>
>
> 2. multiple predictors
>
> sar.all <-errorsarlm(Y~X1+X2+X3,data=datam.std,listw=nb8.w,
> na.action=na.omit, method="Matrix", zero.policy=TRUE)
>
> summary(sar.all)
>
> cor(sar.all$X1+ sar.all$X2+ sar.all$X3, sar.x1$Y, method = "pearson")
>
>
>
> error message
>
> error in cor(sar.all$X1+ sar.all$X2+ sar.all$X3, sar.x1$Y, method =
> "pearson") :
>
>  supply both 'x' and 'y' or a matrix-like 'x'
>
>
>
> Elaine
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gianni.lavaredo at gmail.com  Mon Nov 22 15:12:31 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 22 Nov 2010 15:12:31 +0100
Subject: [R-sig-Geo] Help to know a function to count how many elemant
	repeat in a data.farme
Message-ID: <AANLkTincHSRwMoXRm-E7bXrje=5SL=wJVaNN-asgrzDs@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101122/2b59b34a/attachment.pl>

From roman.lustrik at gmail.com  Mon Nov 22 15:23:14 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 22 Nov 2010 15:23:14 +0100
Subject: [R-sig-Geo] Help to know a function to count how many elemant
 repeat in a data.farme
In-Reply-To: <AANLkTincHSRwMoXRm-E7bXrje=5SL=wJVaNN-asgrzDs@mail.gmail.com>
References: <AANLkTincHSRwMoXRm-E7bXrje=5SL=wJVaNN-asgrzDs@mail.gmail.com>
Message-ID: <AANLkTimrmKX6-p60pATg=LM4AWo89Rb4+OS5f5xJFUAp@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101122/6ef85247/attachment.pl>

From jimmyjuan1 at hotmail.com  Mon Nov 22 15:27:08 2010
From: jimmyjuan1 at hotmail.com (Jimmy Martina)
Date: Mon, 22 Nov 2010 09:27:08 -0500
Subject: [R-sig-Geo] What if geoRglm results showed that a non-spacial model
	fits?
In-Reply-To: <BAY110-W307316BCDCC670616AF48B94390@phx.gbl>
References: <BAY110-W47B3371C60A96ECD9E5AAC94390@phx.gbl>,
	<BAY110-W307316BCDCC670616AF48B94390@phx.gbl>
Message-ID: <BAY110-W26A01692A4E820BEE2C8BF943D0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101122/715217eb/attachment.pl>

From r.hijmans at gmail.com  Mon Nov 22 17:43:28 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 22 Nov 2010 08:43:28 -0800
Subject: [R-sig-Geo] Changing axes of a plot
In-Reply-To: <AANLkTim=mMKRdyWOz19MLAVvr6xQ8sAcg+qS1-gkQy_a@mail.gmail.com>
References: <AANLkTim=mMKRdyWOz19MLAVvr6xQ8sAcg+qS1-gkQy_a@mail.gmail.com>
Message-ID: <AANLkTinzY42HHkL6HMa3LdPCoi4X0EQtxO7pPvUHW1vJ@mail.gmail.com>

Ogbos,

You can do this:

library(raster)
xy<-cbind(x, y)
r <- rasterize(xy, raster(nrow=120, ncol=60), fun=sum)

rb <- rev(rainbow(255,s=1,v=1,start=0,end=7/12,gamma=1,alpha=1))
image(r, col=rb, ylab = "Longitude", xlab="Latitude" )


Or, in your code, instead of this
z = t(grid3)

this might work:
z =  <- t(grid3[nrow(grid3):1,])

Robert

On Sun, Nov 21, 2010 at 10:51 PM, ogbos okike <ogbos.okike at gmail.com> wrote:
> Dear all,
> I tried to use the code below to generate 3 X 3 grid of latitude-longitude
> data. I use image to view the grid. However, latitude and longitude are on
> the wrong axes. ?Thus, I want to swap the axes. I tried to swap x and y in:
> image(x, ..) that did not help. I also wish to add color code to the plot.
> Thanks for kind help.
>
> ?portion of the data:
> -3.3851 ?-65.3236
> ?-3.2696 ?-65.2364
> ?-3.2679 ?-65.2349
> -17.6404 ?164.7025
> ?-4.8285 ?148.8214
> ?2.6477 ?-67.6568
> ?-0.2350 ?-73.4833
> -16.8655 ? 40.9587
> ?8.1179 ?-61.6474
> ?-0.2755 ? 93.3401
> -17.1733 ?119.9011
> ?1.1245 ?-69.7640
> -20.0035 -149.3088
> ?-3.4200 ?177.8753
> ?3.0133 ?-67.5590
> ?15.4684 ?-21.9331
> -17.6166 ?120.2656
> -17.3888 ?165.9368
> -17.6953 ?164.7335
> ?-1.8623 ?-74.0017
> ?-3.3562 ?-71.1195
> -11.5775 ?130.1496
>
> code:
> xy<-matrix(c(x, y), ncol=2)
>
> # 3 deg grid for counts
> grid3 <- matrix(0, nrow=120, ncol=60)
>
> # accumulate counts of points in cells
> for (i in 1:nrow(xy)) {
> ?if (xy[i, 1] == 180)
> ?ix = nrow(grid3)
> ?else
> ?ix <- floor((xy[i,1] + 180) / 3) + 1
>
> ?if (xy[i, 2] == 90)
> ?iy = ncol(grid3)
> ?else
> ?iy <- floor((xy[i,2] + 90) / 3) + 1
>
> ?# catch any subscript errors
> ?tryCatch(
> ?grid3[ix, iy] <- grid3[ix, iy] + 1,
> ?error = function(e) cat("Ignoring point out of bounds:", xy[i,], "\n") )
> }
> rb<-rev(rainbow(255,s=1,v=1,start=0,end=7/12,gamma=1,alpha=1))
> image( x = seq(-88.5, 88.5, 3), y = seq(-178.5, 178.5, 3), z = t(grid3),
> col=rb, ylab = "Longitude", xlab="Latitude" )
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From ogbos.okike at gmail.com  Mon Nov 22 20:05:10 2010
From: ogbos.okike at gmail.com (ogbos okike)
Date: Mon, 22 Nov 2010 21:05:10 +0200
Subject: [R-sig-Geo]  Changing axes of a plot: Problem Fixed
Message-ID: <AANLkTikPNjk2uOX2WoRUreJYg8DmrR1ZrP8BcbbidW9j@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101122/b2aa7dbd/attachment.pl>

From janverbesselt at gmail.com  Mon Nov 22 22:38:29 2010
From: janverbesselt at gmail.com (Jan Verbesselt)
Date: Mon, 22 Nov 2010 22:38:29 +0100
Subject: [R-sig-Geo] a problem with g.gisenv while running grass from R via
	spgrass6 on macosx
Message-ID: <AANLkTinMJiuHmbjU9g81_Ls01aCVdY3HZXVYOtEHZmZM@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101122/39717f12/attachment.pl>

From Roger.Bivand at nhh.no  Mon Nov 22 22:49:32 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 22 Nov 2010 22:49:32 +0100 (CET)
Subject: [R-sig-Geo] a problem with g.gisenv while running grass from R
 via spgrass6 on macosx
In-Reply-To: <AANLkTinMJiuHmbjU9g81_Ls01aCVdY3HZXVYOtEHZmZM@mail.gmail.com>
References: <AANLkTinMJiuHmbjU9g81_Ls01aCVdY3HZXVYOtEHZmZM@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1011222243130.14668@reclus.nhh.no>

On Mon, 22 Nov 2010, Jan Verbesselt wrote:

> Hi,
>
> I am trying to run grass from R via the spgrass6 package on MacOSx while
> following this nice Wiki. I have installed the spgrass6 package from source
> on mac. grass-6.4 is also installed via the great website of KingChaos (
> http://www.kyngchaos.com/software/grass).
>
>> library(spgrass6)
> Loading required package: sp
> Loading required package: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.2, released 2010/04/23
> Path to GDAL shared files:
> /Library/Frameworks/GDAL.framework/Versions/1.7/Resources/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: (autodetected)
> Loading required package: XML
> GRASS GIS interface loaded with GRASS version: (GRASS not running)
>
> when trying the following:
>> loc <- initGRASS("/Applications/GRASS-6.4.app", home=tempdir())

What this is saying is that the string is not "the directory path to GRASS 
binaries and libraries" for your platform. For me:

> list.files("/home/rsb/topics/grass/g640/grass-6.4.0")
  [1] "AUTHORS"           "bin"               "bwidget"
  [4] "CHANGES"           "COPYING"           "docs"
  [7] "driver"            "etc"               "fonts"
[10] "GPL.TXT"           "include"           "lib"
[13] "man"               "REQUIREMENTS.html" "scripts"
[16] "tools"

so when you see something similar for the directory path on your system, 
you will have found the incantation.

If you don't make progress, please consider moving this thread to the 
grass-stats list:

http://lists.osgeo.org/mailman/listinfo/grass-stats

where there may be users with the same platform.

Roger

>
> I obtain the following error:
> /bin/sh: g.gisenv: command not found
> /bin/sh: g.gisenv: command not found
> /bin/sh: g.gisenv: command not found
> /bin/sh: g.gisenv: command not found
> /bin/sh: g.gisenv: command not found
> Error in system(cmd0, intern = TRUE) : error in running command
> Error in parseGRASS(cmd) : g.region not found
> sh: g.region: command not found
>
> Is there a solution?
>
> I am learning GRASS at the moment to visualise and explore 3D terrestrial
> point lidar datasets (las format) and analyse subsets via R.
>
> Thanks,
> Jan
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Mon Nov 22 23:39:47 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 22 Nov 2010 23:39:47 +0100
Subject: [R-sig-Geo] get() in raster ?
In-Reply-To: <AANLkTimMvCeju8ncxn5r7NxvxuVMrFMgVTpjkmz5JLiu@mail.gmail.com>
References: <AANLkTik4Yq7TsMKkT2SD350YmgacFWZKOmyqhAkSvM=W@mail.gmail.com>
	<AANLkTi=zbgak431-zSwZU1=9ZLovu2KdKqEwjT9ZkJs9@mail.gmail.com>
	<AANLkTinmaT7Xs0o1z7oWhNfULMtzD4CV0SK7hLp7KZGg@mail.gmail.com>
	<4CE7B033.5030108@uni-muenster.de>
	<AANLkTimYpUbTJBdW=SBnyWDroqxA9cA3-9sAtdR4ZoNg@mail.gmail.com>
	<AANLkTimMvCeju8ncxn5r7NxvxuVMrFMgVTpjkmz5JLiu@mail.gmail.com>
Message-ID: <AANLkTimpg7vNNXwoaS+cj=um0Thjcu9bH=Xe0H7XMOFH@mail.gmail.com>

Works for stack and not for brick:

> inMemory(N1)
[1] FALSE

> v <- list(N1, N2, N3)
> do.call(stack, v)
class       : RasterStack
nlayers     : 3
nrow        : 1905
ncol        : 3697
ncell       : 7042785
projection  : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0
min value   : 0 0 0
max value   : 255 255 255
extent      : -80.00446, -46.99554, -13.00446, 4.004464  (xmin, xmax,
ymin, ymax)
resolution  : 0.008928571, 0.008928571  (x, y)

> do.call(brick, v)
Error in as.matrix(getValues(r)) :
  error in evaluating the argument 'x' in selecting a method for
function 'as.matrix'
Calls: do.call ... <Anonymous> -> addLayer -> addLayer -> .local -> as.matrix

> bn = do.call(stack, v)
> b <- brick(bn)
Error in .readRasterLayerValues(x, 1, x at nrows) :
  could not find function "GDAL.open"
Calls: brick ... getValues -> getValues -> .local -> .readRasterLayerValues


Agus

2010/11/22 Robert J. Hijmans <r.hijmans at gmail.com>:
> Hi Agus,
>
> This is somewhat puzzling. The general approach works in this example:
>
> r1 <- raster(nrow=10, ncol=10)
> r1[] <- 1
> r3 <- r2 <- r1
> v <- list(r1, r2, r3)
> do.call(stack, v)
>
> # or simply:
> s <- stack(v)
>
> # or the more convoluted, if you have the object names rather than the
> objects themselves:
> v <- list(get("r1"), get("r2"), get("r3"))
> s <- stack(v)
>
> #And finally, if you want a brick (as you are dealing with large
> files, I think it is more efficient to first make a stack and then
> write the results to a brick):
>
> b <- brick(s)
>
> # Although in my example, this does also work:
> b <- do.call(brick, v)
>
>
>
> On Sun, Nov 21, 2010 at 10:22 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Thanks Edzer, but neither work:
>>> v = list("r1","r2","r3")
>>> do.call(brick, v)
>> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>> ?file: r1 does not exist
>> Calls: do.call ... <Anonymous> -> <Anonymous> -> .local -> .rasterObjectFromFile
>
> Makes sense, because you are using character arguments, which are
> interpreted as filenames.
>
>>> v = list(r1, r2, r3)
>>> bN = do.call(brick, v)
>> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>> ?file: r1r2r3 does not exist
>
> Strange to have r1r2r3 concatenated.
>
>> Calls: do.call ... <Anonymous> -> <Anonymous> -> .local -> .rasterObjectFromFile
>> In addition: Warning messages:
>> 1: In if (x == "" | x == ".") { :
>> ?the condition has length > 1 and only the first element will be used
>> 2: In if (fileext %in% c(".GRD", ".GRI")) { :
>> ?the condition has length > 1 and only the first element will be used
>> 3: In if (!file.exists(x)) { :
>> ?the condition has length > 1 and only the first element will be used
>> 4: In if (file.exists(grdfile) & file.exists(grifile)) { :
>> ?the condition has length > 1 and only the first element will be used
>>
>> Also, in the real case the raster objects (i.e.,N1, N2 and N3) will
>> not have values in memory, so I'm not
>> positive that the list would be the way to go:
>>
>
> Should not matter
>
>>> class(N1)
>> [1] "RasterLayer"
>> attr(,"package")
>> [1] "raster"
>>
>>> inMemory(N1)
>> [1] FALSE
>>
>>> v = list(N1, N2, N3)
>>> bN = do.call(brick, v)
>> Error in as.matrix(getValues(r)) :
>> ?error in evaluating the argument 'x' in selecting a method for
>> function 'as.matrix'
>> Calls: do.call ... <Anonymous> -> addLayer -> addLayer -> .local -> as.matrix
>
> This may be a real bug. But perhaps you can do
> sN = brick( do.call(stack, v) )
>
>>
>> By now I'm editing the output of
>> paste("N",1:360,sep="")
>> for a call to brick() including the 360 raster objects. But there has
>> to be an elegant way of doing this. Not a critical issue though.
>>
>> Agus
>>
>> 2010/11/20 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
>>> Just pushed "send" too fast -- try without quotes to pass the objects
>>> instead of their names:
>>>
>>> v = list(r1, r2, r3)
>>> do.call(brick, v)
>>>
>>>
>>> On 11/20/2010 11:51 AM, Agustin Lobo wrote:
>>>> ok, the problem is that, as noted by Carson,
>>>> I must use get("v") and not get(v).
>>>>
>>>> But still have problems to use get() within stack() or brick():
>>>>> r1 = raster(SM[,,1])
>>>>> r2 = raster(SM[,,2])
>>>>> r3 = raster(SM[,,3])
>>>>> v = c("r1","r2","r3")
>>>>> get("v")
>>>> [1] "r1" "r2" "r3"
>>>>> bSM = brick(get(v))
>>>> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>>>> ? file: r1r2r3 does not exist
>>>> Calls: brick -> brick -> .local -> .rasterObjectFromFile
>>>>
>>>> ( I'm trying to use get() because have to
>>>> create a brick with 360 files that have been read as raster objects within
>>>> a loop using assign() )
>>>>
>>>> Agus
>>>>
>>>>
>>>> 2010/11/19 Robert J. Hijmans <r.hijmans at gmail.com>:
>>>>> This suggest that you have an object "r1" that is a Raster* object.
>>>>> Perhaps because of a saved session?
>>>>> Have you looked at
>>>>> ls()
>>>>> Robert
>>>>>
>>>>> On Fri, Nov 19, 2010 at 1:24 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>>>>> Hi again!
>>>>>>
>>>>>> I'm having problems because cannot use get() ?from base once package
>>>>>> raster has been installed:
>>>>>>
>>>>>>> v = c("r1","r2","r3")
>>>>>>> v
>>>>>> [1] "r1" "r2" "r3"
>>>>>>> get(v)
>>>>>> Loading required package: raster
>>>>>> Loading required package: sp
>>>>>> raster version 1.6-22 (17-November-2010)
>>>>>> class ? ? ? : RasterLayer
>>>>>> nrow ? ? ? ?: 18
>>>>>> ncol ? ? ? ?: 36
>>>>>> ncell ? ? ? : 648
>>>>>> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>>>>>> xmin ? ? ? ?: -180
>>>>>> xmax ? ? ? ?: 180
>>>>>> ymin ? ? ? ?: -90
>>>>>> ymax ? ? ? ?: 90
>>>>>> xres ? ? ? ?: 10
>>>>>> yres ? ? ? ?: 10
>>>>>>
>>>>>> Even not having loaded raster, it gets automatically loaded once I
>>>>>> call get(). Is this a bug?
>>>>>> In general, is there a way to force that, in case of conflict, you run
>>>>>> a particular function from a given package?
>>>>>>
>>>>>> Thanks!
>>>>>>
>>>>>> Agus
>>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> --
>>> Edzer Pebesma
>>> Institute for Geoinformatics (ifgi), University of M?nster
>>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>>> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
>>> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From massimodisasha at gmail.com  Tue Nov 23 05:06:20 2010
From: massimodisasha at gmail.com (Massimo Di Stefano)
Date: Mon, 22 Nov 2010 23:06:20 -0500
Subject: [R-sig-Geo] a problem with g.gisenv while running grass from R
	via spgrass6 on macosx
In-Reply-To: <alpine.LRH.2.00.1011222243130.14668@reclus.nhh.no>
References: <AANLkTinMJiuHmbjU9g81_Ls01aCVdY3HZXVYOtEHZmZM@mail.gmail.com>
	<alpine.LRH.2.00.1011222243130.14668@reclus.nhh.no>
Message-ID: <12DB32F4-94D7-49BC-B93C-204B2B651803@gmail.com>

the path should be :

/Application/GRASS-6.4.app/Contents/MacOS

epy$ ls
AUTHORS			bin			grass.sh
CHANGES			bwidget			include
COPYING			docs			lib
GPL.TXT			driver			man
GRASS			etc			scripts
REQUIREMENTS.html	fonts




Il giorno 22/nov/2010, alle ore 16.49, Roger Bivand ha scritto:

> On Mon, 22 Nov 2010, Jan Verbesselt wrote:
> 
>> Hi,
>> 
>> I am trying to run grass from R via the spgrass6 package on MacOSx while
>> following this nice Wiki. I have installed the spgrass6 package from source
>> on mac. grass-6.4 is also installed via the great website of KingChaos (
>> http://www.kyngchaos.com/software/grass).
>> 
>>> library(spgrass6)
>> Loading required package: sp
>> Loading required package: rgdal
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>> Loaded GDAL runtime: GDAL 1.7.2, released 2010/04/23
>> Path to GDAL shared files:
>> /Library/Frameworks/GDAL.framework/Versions/1.7/Resources/gdal
>> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
>> Path to PROJ.4 shared files: (autodetected)
>> Loading required package: XML
>> GRASS GIS interface loaded with GRASS version: (GRASS not running)
>> 
>> when trying the following:
>>> loc <- initGRASS("/Applications/GRASS-6.4.app", home=tempdir())
> 
> What this is saying is that the string is not "the directory path to GRASS binaries and libraries" for your platform. For me:
> 
>> list.files("/home/rsb/topics/grass/g640/grass-6.4.0")
> [1] "AUTHORS"           "bin"               "bwidget"
> [4] "CHANGES"           "COPYING"           "docs"
> [7] "driver"            "etc"               "fonts"
> [10] "GPL.TXT"           "include"           "lib"
> [13] "man"               "REQUIREMENTS.html" "scripts"
> [16] "tools"
> 
> so when you see something similar for the directory path on your system, you will have found the incantation.
> 
> If you don't make progress, please consider moving this thread to the grass-stats list:
> 
> http://lists.osgeo.org/mailman/listinfo/grass-stats
> 
> where there may be users with the same platform.
> 
> Roger
> 
>> 
>> I obtain the following error:
>> /bin/sh: g.gisenv: command not found
>> /bin/sh: g.gisenv: command not found
>> /bin/sh: g.gisenv: command not found
>> /bin/sh: g.gisenv: command not found
>> /bin/sh: g.gisenv: command not found
>> Error in system(cmd0, intern = TRUE) : error in running command
>> Error in parseGRASS(cmd) : g.region not found
>> sh: g.region: command not found
>> 
>> Is there a solution?
>> 
>> I am learning GRASS at the moment to visualise and explore 3D terrestrial
>> point lidar datasets (las format) and analyse subsets via R.
>> 
>> Thanks,
>> Jan
>> 
>> 	[[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From kevinummel at gmail.com  Tue Nov 23 12:25:05 2010
From: kevinummel at gmail.com (Kevin Ummel)
Date: Tue, 23 Nov 2010 11:25:05 +0000
Subject: [R-sig-Geo] Using 'overlay' with multi- and single-layers objects
Message-ID: <AAC60FA3-6BCA-4E46-ADA1-E16BBE0F5C1E@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101123/37b4e871/attachment.pl>

From janverbesselt at gmail.com  Tue Nov 23 12:50:51 2010
From: janverbesselt at gmail.com (Jan Verbesselt)
Date: Tue, 23 Nov 2010 12:50:51 +0100
Subject: [R-sig-Geo] a problem with g.gisenv while running grass from R
 via spgrass6 on macosx
In-Reply-To: <12DB32F4-94D7-49BC-B93C-204B2B651803@gmail.com>
References: <AANLkTinMJiuHmbjU9g81_Ls01aCVdY3HZXVYOtEHZmZM@mail.gmail.com>
	<alpine.LRH.2.00.1011222243130.14668@reclus.nhh.no>
	<12DB32F4-94D7-49BC-B93C-204B2B651803@gmail.com>
Message-ID: <AANLkTinsH4+-JnnJzh0MMdpDRqb2sn21ZEsLviEZXyXc@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101123/918bd321/attachment.pl>

From r.hijmans at gmail.com  Tue Nov 23 18:50:06 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 23 Nov 2010 09:50:06 -0800
Subject: [R-sig-Geo] Using 'overlay' with multi- and single-layers
	objects
In-Reply-To: <AAC60FA3-6BCA-4E46-ADA1-E16BBE0F5C1E@gmail.com>
References: <AAC60FA3-6BCA-4E46-ADA1-E16BBE0F5C1E@gmail.com>
Message-ID: <AANLkTimMTBcctkLz28v37R-wv_Qt-51Rb=ywjAbhZHnu@mail.gmail.com>

Hi Kevin,

That's a bug, thanks for reporting it. Fixed in version 1.7-1

A work around for the simple example you provide would be:

x <- stack_r + r

or (not really advisable but it should work while version 1.7-1 is not
yet on CRAN)

x <- raster:::.overlayList( list(stack_r,r), fun=sum)

Robert




On Tue, Nov 23, 2010 at 3:25 AM, Kevin Ummel <kevinummel at gmail.com> wrote:
> Can someone tell me why the following generates an error? The 'overlay' description in the 'raster' package suggests the single-layer object should recycle as needed...
>
> Thanks!
> Kevin
>
>> r <- raster(ncol=10, nrow=10)
>> r <- init(r, fun=runif)
>> stack_r=stack(r,r)
>
>> overlay(stack_r,r,fun=sum)
> Error in function (classes, fdef, mtable) ?:
> ?unable to find an inherited method for function "overlay", for signature "RasterStack", "RasterLayer"
>
> Seems to me that the command above should be able to replicate:
>
>> stack_r+r
> class ? ? ? : RasterBrick
> filename ? ?:
> nlayers ? ? : 2
> nrow ? ? ? ?: 10
> ncol ? ? ? ?: 10
> ncell ? ? ? : 100
> projection ?: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> min value ? : 0.011 0.011
> max value ? : 2 2
> extent ? ? ?: -180, 180, -90, 90 ?(xmin, xmax, ymin, ymax)
> resolution ?: 36, 18 ?(x, y)
>
> I need single-layer objects used as arguments within 'overlay' to recycle for more complex functions that include raster stacks...
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jeanne.vallet at laposte.net  Wed Nov 24 10:54:06 2010
From: jeanne.vallet at laposte.net (jeanne.vallet)
Date: Wed, 24 Nov 2010 01:54:06 -0800 (PST)
Subject: [R-sig-Geo] madifa with qualitative variables
Message-ID: <1290592446927-5769776.post@n2.nabble.com>


Hi, 

I feel that it is not possible to use qualitative variables with madifa i.e.
using a Hill and Smith analysis instead of a principal component analysis on
the environmental table. Indeed, I receive the following error : "Error in
eigen(W) : infinite or missing values in 'x'" whereas the same command line
is ok with enfa. In madifa help, it is only written that the first argument
must be a dudi object not a pca. Is a trick exist to use a dudi.hillsmith
result instead of a dudi.pca as first argument in madifa ?
Thanks,

Jeanne Vallet
Postdoc in ecology
Groupe ESA, 55 rue Rabelais, B.P. 30748, 49007 Angers cedex 01, France.
mail : j.vallet at groupe-esa.com 
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/madifa-with-qualitative-variables-tp5769776p5769776.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From clement.calenge at oncfs.gouv.fr  Wed Nov 24 11:45:20 2010
From: clement.calenge at oncfs.gouv.fr (=?ISO-8859-1?Q?Cl=E9ment_Calenge?=)
Date: Wed, 24 Nov 2010 11:45:20 +0100
Subject: [R-sig-Geo] madifa with qualitative variables
In-Reply-To: <1290592446927-5769776.post@n2.nabble.com>
References: <1290592446927-5769776.post@n2.nabble.com>
Message-ID: <4CECECC0.9020202@oncfs.gouv.fr>

Hello Jeanne,


> I feel that it is not possible to use qualitative variables with madifa i.e.
> using a Hill and Smith analysis instead of a principal component analysis on
> the environmental table. Indeed, I receive the following error : "Error in
> eigen(W) : infinite or missing values in 'x'" whereas the same command line
> is ok with enfa. In madifa help, it is only written that the first argument
> must be a dudi object not a pca. Is a trick exist to use a dudi.hillsmith
> result instead of a dudi.pca as first argument in madifa ?
>    

Indeed, the MADIFA's properties have not been well explored in the case 
of nominal variables... in addition, the current algorithm implemented 
in the function madifa relies on the inversion of the matrix of "used 
covariances", which is not possible in the case where qualitative 
variables are in the data (the matrix is not inversible, explaining the 
error message).
An alternative algorithm to perform the MADIFA is described in

@ARTICLE{,
   author = {Calenge, C. and Basille, M.},
   title = {A general framework for the statistical exploration of the 
ecological niche},
   journal = {Journal of Theoretical Biology},
   year = {2008},
   volume = {252},
   pages = {674-685}
}

and is implemented in the function gnesfa (this method place the ENFA 
and the MADIFA in a more general framework).
Thus, the command:

madifa(toto, pr)

is exactly the same as:

gnesfa(toto, Reference=pr)

though the latter do not rely on matrix inversion.
This solves the technical problem of matrix inversion, but not the 
problem of the meaning of the results, which is an open issue...
HTH,
Best regards,


Cl?ment Calenge

-- 
Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From simon.ohanlon at imperial.ac.uk  Wed Nov 24 14:04:59 2010
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Wed, 24 Nov 2010 13:04:59 +0000
Subject: [R-sig-Geo] geoRglm: sim.predict problems
Message-ID: <BC1C610780300542BA4CBE44AEDE37040CC4841E@icexm6.ic.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101124/c86fa523/attachment.pl>

From ricardorodot02 at gmail.com  Wed Nov 24 16:07:36 2010
From: ricardorodot02 at gmail.com (=?ISO-8859-1?Q?Ricardo_Rodr=EDguez?=)
Date: Wed, 24 Nov 2010 10:07:36 -0500
Subject: [R-sig-Geo] small querys in R
Message-ID: <AANLkTikC5tf972ASNZWaD2LHe+j6h0_EmBkrV1nqJDv8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101124/2db0f2b3/attachment.pl>

From etiennebr at gmail.com  Wed Nov 24 17:00:39 2010
From: etiennebr at gmail.com (etiennebr)
Date: Wed, 24 Nov 2010 08:00:39 -0800 (PST)
Subject: [R-sig-Geo] passing SQL through readOGR()
In-Reply-To: <alpine.LRH.2.00.1011151827030.17573@reclus.nhh.no>
References: <4AD49E0C.3000404@wzw.tum.de> <4CE16332.7070002@wzw.tum.de>
	<alpine.LRH.2.00.1011151827030.17573@reclus.nhh.no>
Message-ID: <1290614439389-5770881.post@n2.nabble.com>


Roger,

I'd be happy to help. If I get it correct, the only missing piece is a WKB
or WKT driver to convert to sp class (and vice-versa)? 

Etienne
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/passing-SQL-through-readOGR-tp3816889p5770881.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Wed Nov 24 17:16:19 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 24 Nov 2010 17:16:19 +0100 (CET)
Subject: [R-sig-Geo] passing SQL through readOGR()
In-Reply-To: <1290614439389-5770881.post@n2.nabble.com>
References: <4AD49E0C.3000404@wzw.tum.de> <4CE16332.7070002@wzw.tum.de>
	<alpine.LRH.2.00.1011151827030.17573@reclus.nhh.no>
	<1290614439389-5770881.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.00.1011241710030.20196@reclus.nhh.no>

On Wed, 24 Nov 2010, etiennebr wrote:

>
> Roger,
>
> I'd be happy to help. If I get it correct, the only missing piece is a WKB
> or WKT driver to convert to sp class (and vice-versa)?

Thanks for the offer, rgdal is now hosted on R-forge for anonymous 
checkout. The prefered approach is to find out how to use:

http://www.gdal.org/ogr/ogr_sql.html

and

http://trac.osgeo.org/gdal/wiki/rfc28_sqlfunc

and its forthcoming extensions in GDAL 1.8.0 in setting an attribute 
filter before importing using OGR, rather than looking at drivers, which 
OGR handles. The same attribute SQL selections should then work across all 
drivers. It may be possible to try a prototype with the existing mixture 
of R and C/C++ in readOGR(), but a fresh prototype with more done in C/C++ 
is probably the best bet, passing the SQL string out to the OGR SQL 
engine directly, and letting it do all the work.

Roger

>
> Etienne
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From ricardorodot02 at gmail.com  Thu Nov 25 01:01:46 2010
From: ricardorodot02 at gmail.com (=?ISO-8859-1?Q?Ricardo_Rodr=EDguez?=)
Date: Wed, 24 Nov 2010 19:01:46 -0500
Subject: [R-sig-Geo] plot normal distribution
Message-ID: <AANLkTi=zRR9f3bjihNw8zbT3+Fk51sjU1iXi1UpgN8h3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101124/30db5e04/attachment.pl>

From ricardorodot02 at gmail.com  Thu Nov 25 01:07:08 2010
From: ricardorodot02 at gmail.com (=?ISO-8859-1?Q?Ricardo_Rodr=EDguez?=)
Date: Wed, 24 Nov 2010 19:07:08 -0500
Subject: [R-sig-Geo] templates for reports in Sweave
Message-ID: <AANLkTinm8p2H1LfpFmvv3gqOeYPt+9x7vy7X1ff7kpM0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101124/535def31/attachment.pl>

From jimmyjuan1 at hotmail.com  Thu Nov 25 15:12:23 2010
From: jimmyjuan1 at hotmail.com (Jimmy Martina)
Date: Thu, 25 Nov 2010 09:12:23 -0500
Subject: [R-sig-Geo] What to do if geoRglm results showed that a non-spacial
 model fits better?
In-Reply-To: <BAY110-W26A01692A4E820BEE2C8BF943D0@phx.gbl>
References: <BAY110-W47B3371C60A96ECD9E5AAC94390@phx.gbl>,
	<BAY110-W307316BCDCC670616AF48B94390@phx.gbl>,
	<BAY110-W26A01692A4E820BEE2C8BF943D0@phx.gbl>
Message-ID: <BAY110-W4726C74CEBBAE8E6BF5FBB94200@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/9a70d73e/attachment.pl>

From ted.rosenbaum at yale.edu  Thu Nov 25 15:25:47 2010
From: ted.rosenbaum at yale.edu (Ted Rosenbaum)
Date: Thu, 25 Nov 2010 09:25:47 -0500
Subject: [R-sig-Geo] maps to PBSmapping conversion
Message-ID: <AANLkTi=HST5VXMMod6+vzA4mLrWToC97qBYYdmVTS8iR@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/c5de5eef/attachment.pl>

From geomalik at live.com  Thu Nov 25 15:42:17 2010
From: geomalik at live.com (Malik Shahzad)
Date: Thu, 25 Nov 2010 21:42:17 +0700
Subject: [R-sig-Geo] ASTER DATA???
Message-ID: <SNT111-W165AAC8D00B1B30BE943BAC200@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/c66ffc78/attachment.pl>

From zenlines at gmail.com  Thu Nov 25 15:52:46 2010
From: zenlines at gmail.com (Brian Oney)
Date: Thu, 25 Nov 2010 15:52:46 +0100
Subject: [R-sig-Geo] Archives Search Suggestion
Message-ID: <4CEE783E.8000702@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/2d477e5b/attachment.pl>

From jacobvanetten at yahoo.com  Thu Nov 25 16:00:28 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Thu, 25 Nov 2010 15:00:28 +0000 (GMT)
Subject: [R-sig-Geo] Archives Search Suggestion
In-Reply-To: <4CEE783E.8000702@gmail.com>
Message-ID: <476299.25170.qm@web29707.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/7fc2b26d/attachment.pl>

From roman.lustrik at gmail.com  Thu Nov 25 16:07:19 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Thu, 25 Nov 2010 16:07:19 +0100
Subject: [R-sig-Geo] Archives Search Suggestion
In-Reply-To: <4CEE783E.8000702@gmail.com>
References: <4CEE783E.8000702@gmail.com>
Message-ID: <AANLkTimA9ETsncV83T5HHmW=SJMEZGby=wJKyh+_xgFr@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/5a2c98c9/attachment.pl>

From Roger.Bivand at nhh.no  Thu Nov 25 16:10:41 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 25 Nov 2010 16:10:41 +0100 (CET)
Subject: [R-sig-Geo] maps to PBSmapping conversion
In-Reply-To: <AANLkTi=HST5VXMMod6+vzA4mLrWToC97qBYYdmVTS8iR@mail.gmail.com>
References: <AANLkTi=HST5VXMMod6+vzA4mLrWToC97qBYYdmVTS8iR@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1011251553430.30032@reclus.nhh.no>

On Thu, 25 Nov 2010, Ted Rosenbaum wrote:

> Hi:
> When I run the following command to convert a US state polygon from the maps
> package to a polyset in PBSmapping, I obtain extra lines that should not be
> in there.
> plotMap(SpatialLines2PolySet(map2SpatialLines(map('state','maryland',interior=FALSE),proj4string=CRS("+proj=longlat
> +datum=wgs84"))))
> Compare to :
> map('state','maryland').
> I appreciate anyone's insight as to why this conversion is not working.

map() and plootMap() have different pen-up and pen-down conventions. The 
easiest correction is:

md <- map('state','maryland',interior=FALSE, plot=FALSE, fill=TRUE)
spmd <- map2SpatialLines(md)
xx <- SpatialLines2PolySet(spmd)
plotMap(xx)

where fill=TRUE reverses those lines that do not connect. I think that a 
PolySet thinks that it is a polygon, with fill=FALSE you get 11 lines, 
which although they are converted correctly with correct PID, seem to be 
closed by plotMap(). Indeed, using plotLines() instead of plotMap() 
achieves the effect you want (but with an odd axis artefact - plotLines() 
probably assumes that it is being added to an existing plot, and doesn't 
seem to set aspect correctly), plotMap() imposes the assumption that you 
have polygons.

Why not just plot(spmd)? Are you sure about the datum in your spatial 
reference (if it matters for you)?

Roger


> Thanks very much!
>
> ---------------------------------------------
> Ted Rosenbaum
> Graduate Student
> Department of Economics
> Yale University
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From zenlines at gmail.com  Thu Nov 25 16:15:06 2010
From: zenlines at gmail.com (Brian Oney)
Date: Thu, 25 Nov 2010 16:15:06 +0100
Subject: [R-sig-Geo] Archives Search Suggestion
In-Reply-To: <AANLkTimA9ETsncV83T5HHmW=SJMEZGby=wJKyh+_xgFr@mail.gmail.com>
References: <4CEE783E.8000702@gmail.com>
	<AANLkTimA9ETsncV83T5HHmW=SJMEZGby=wJKyh+_xgFr@mail.gmail.com>
Message-ID: <4CEE7D7A.90803@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/425288b1/attachment.pl>

From gianni.lavaredo at gmail.com  Thu Nov 25 16:21:30 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Thu, 25 Nov 2010 16:21:30 +0100
Subject: [R-sig-Geo] problem with Expression in a Plot
Message-ID: <AANLkTikL=-bYLs12mX18r8TmHHoVftXpaOgk=aocHq2-@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/ab07a8cc/attachment.pl>

From adiez at uv.es  Thu Nov 25 16:25:42 2010
From: adiez at uv.es (Agustin Diez Castillo)
Date: Thu, 25 Nov 2010 16:25:42 +0100
Subject: [R-sig-Geo] ASTER DATA???
In-Reply-To: <SNT111-W165AAC8D00B1B30BE943BAC200@phx.gbl>
References: <SNT111-W165AAC8D00B1B30BE943BAC200@phx.gbl>
Message-ID: <04873CF8-BC36-42A5-B8E0-4660039A89D2@uv.es>

Do you mean that?


http://gvsigmac.blogspot.com/2009/07/aster-gdem-download-tutorial.html

On Nov 25, 2010, at 3:42 PM, Malik Shahzad wrote:

> 
> Dear How I can download ASTER Data????Your valuable comment will be appreciated.
> Thanks in Advance...Malik
> 
> 		 	   		  
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From ted.rosenbaum at yale.edu  Thu Nov 25 17:17:24 2010
From: ted.rosenbaum at yale.edu (Ted Rosenbaum)
Date: Thu, 25 Nov 2010 11:17:24 -0500
Subject: [R-sig-Geo] maps to PBSmapping conversion
In-Reply-To: <alpine.LRH.2.00.1011251553430.30032@reclus.nhh.no>
References: <AANLkTi=HST5VXMMod6+vzA4mLrWToC97qBYYdmVTS8iR@mail.gmail.com>
	<alpine.LRH.2.00.1011251553430.30032@reclus.nhh.no>
Message-ID: <AANLkTi=zVTcuWeCVuFhK8_7x9x71gXmCvqDWJOQPN3nF@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/5af2d236/attachment.pl>

From djmuser at gmail.com  Thu Nov 25 19:21:58 2010
From: djmuser at gmail.com (Dennis Murphy)
Date: Thu, 25 Nov 2010 10:21:58 -0800
Subject: [R-sig-Geo] problem with Expression in a Plot
In-Reply-To: <AANLkTikL=-bYLs12mX18r8TmHHoVftXpaOgk=aocHq2-@mail.gmail.com>
References: <AANLkTikL=-bYLs12mX18r8TmHHoVftXpaOgk=aocHq2-@mail.gmail.com>
Message-ID: <AANLkTi=z2+Vst73Mg+6F9wvXx24U-mamDS-zgzUsxgH4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/b96ad100/attachment.pl>

From sylvain.willart at gmail.com  Thu Nov 25 23:23:29 2010
From: sylvain.willart at gmail.com (sylvain willart)
Date: Thu, 25 Nov 2010 23:23:29 +0100
Subject: [R-sig-Geo] how to assess spatial randomness of an spp given the
 distribution of another spp
Message-ID: <AANLkTimvYysJ1rDEPmbd5-DG91fXA-sgXvWbyOS+Jy7N@mail.gmail.com>

Dear list members,

I am working with spatstat package to analyse to spatial points data frames:
 - the locations of hospitals in France
 - the location of the population (each 'point' here represents about
3,000 people)
I used quadrat.test and kstest to test for spatial randomness of
hospitals, which, hopefully is not random,
I would like to know if there's a (simple non-bayesian) way of
assessing spatial randomness for hospitals given the distribution of
the population,
and ultimately if it is possible to do so using MarkedPointProcess
package (the hospitals being of different sizes, and populations
having different needs for healthcare)

thx in advance for any suggestion,

Sylvain


From advaitgodbole at gmail.com  Thu Nov 25 23:32:56 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Thu, 25 Nov 2010 17:32:56 -0500
Subject: [R-sig-Geo] gridded time series analysis
Message-ID: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101125/9c56979e/attachment.pl>

From jason.lessels at sydney.edu.au  Fri Nov 26 00:35:13 2010
From: jason.lessels at sydney.edu.au (Jason Lessels)
Date: Fri, 26 Nov 2010 10:35:13 +1100
Subject: [R-sig-Geo] geoRglm: sim.predict problems
In-Reply-To: <BC1C610780300542BA4CBE44AEDE37040CC4841E@icexm6.ic.ac.uk>
References: <BC1C610780300542BA4CBE44AEDE37040CC4841E@icexm6.ic.ac.uk>
Message-ID: <10CB6CF943A22F4FAE5D05F7A115FFA40B9C60@EXPRSV06.mcs.usyd.edu.au>

Hi Simon,
I have been attempting a similar thing as you, but using the glsm.krige 
function, without success. From what i can work out the the 
output.glm.control() settings are sent to the .cond.sim function from 
geoR, which is doing something different to what you are after (I 
believe). I have had a brief look at the binom.krige.bayes function, and 
it appears the median of the values is performed within the sub function 
.pred.quan.aux function on the first line

temp.med <- apply(temp.pred$mean, 1, median)

I assume that it would be possible for you to adjust this function to 
get it to do what you want, but i am unsure about that, as i have been 
using the glsm.krige function.

If you try to re-run your code with a smaller prediction grid (50 
points), the output.glm.control function will most likely work for you, 
however i have waited over a day for 8000 points with no luck.

Jason


On 25/11/10 00:04, O'Hanlon, Simon J wrote:
> Dear List,
> I have been using geoRglm to perform spatial prediction in the binomial-logit spatial model.
>
> I have been able to produce maps of some predicted volumetric quantity (prevalence) over a wide geographic area (2385km * 1375km in 131,175 5km cells) , using covariates in the fixed part of the model. Using the function binom.krige.bayes produces output which includes an estimate of the predictive median for each cell in the map. This is specified when setting 'inference=TRUE' in the control function called 'output.glm.control' which is called by binom.krige.bayes.
>
> However the median is only one map of the posterior distribution of the estimated quantity. I want to look at some of the other maps, including the mean map of the predicted. In order to do this I need to get the posterior prediction of the prevalence for each map cell for each iteration of the simulation. Then for each cell I can calculate the mean etc. In order to do this there is a TRUE/FALSE switch called 'sim.predict' in the control function 'output.glm.control'. When set to false you simply return the predictive median. When set to TRUE you should return the values of the predictied quantity for each iteration of the model. When I set this to true RGui crashes with no warning or error messages (even when verbose mode is turned on). R is not using it vector or stack heaps, and I am only using 8GB out of 16GB of system ram. Also the table which should be dimensioned to hold the predictions is well inside the limits placed by R (i.e. a table with less than 2^31-1 elements!
>   ). I am running 150,000 iterations of a model , predicting over 131,175 map cells, and I have thinning set to 100 (to minimise autocorrelation between simulations), so I should be recording 1500 simulation results (150,000 / 100).
>
> Has this problem happened to anybody else and does anybody know of another way to record the predictive posterior draws of the simulations?
>
> Much obliged and sorry if I have not used appropriate jargon in places - I am relatively new to this.
>
> Cheers,
>
> Simon
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>    


From alobolistas at gmail.com  Fri Nov 26 11:25:16 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 26 Nov 2010 11:25:16 +0100
Subject: [R-sig-Geo] Brick and Stack in package raster
Message-ID: <AANLkTimRzfjHHOH19frTB0KDXzWYYVbWEcEtOV87-qKZ@mail.gmail.com>

Robert,

At some point you made this comment:

>>> (as you are dealing with large
>>> files, I think it is more efficient to first make a stack and then
>>> write the results to a brick)

But I have some doubts:

bN = brick(N1,N2,N3,...,N72)
where
N1 = raster(paste(midir,"NDV_19990101__Extract.img",sep="")) etc
takes a very long time. Is a file on disk being written somewhere?

Is overlay() going to be any faster with brick than with stack objects? ie:
bNv2 <- overlay(bN, bSM,
fun=fun1,filename="bNv2.tif",overwrite=TRUE,NAflag=0) faster than
sNv2 <- overlay(sN, sSM, fun=fun1,filename="sNv2.tif",overwrite=TRUE,NAflag=0) ?
(bN, bSM, brick objects; sN, sSM, stack objects)

When you write a brick to a file, can you control if the resulting
file is going to be BSQ or BIL?

Are the files written by writeRaster() identical for stack and brick objects?
writeRaster(bNv2,
filename="bNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
writeRaster(sNv2,
filename="sNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)

Thanks

Agus


From alobolistas at gmail.com  Fri Nov 26 11:34:43 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 26 Nov 2010 11:34:43 +0100
Subject: [R-sig-Geo] Brick and Stack in package raster
In-Reply-To: <AANLkTimRzfjHHOH19frTB0KDXzWYYVbWEcEtOV87-qKZ@mail.gmail.com>
References: <AANLkTimRzfjHHOH19frTB0KDXzWYYVbWEcEtOV87-qKZ@mail.gmail.com>
Message-ID: <AANLkTik0-bvnmVpx4LocRBLLOt8s23XozebDuW+YROCa@mail.gmail.com>

Sorry the question
"When you write a brick to a file, can you control if the resulting
file is going to be BSQ or BIL?"

is pretty clear in the manual.

Agus

2010/11/26 Agustin Lobo <alobolistas at gmail.com>:
> Robert,
>
> At some point you made this comment:
>
>>>> (as you are dealing with large
>>>> files, I think it is more efficient to first make a stack and then
>>>> write the results to a brick)
>
> But I have some doubts:
>
> bN = brick(N1,N2,N3,...,N72)
> where
> N1 = raster(paste(midir,"NDV_19990101__Extract.img",sep="")) etc
> takes a very long time. Is a file on disk being written somewhere?
>
> Is overlay() going to be any faster with brick than with stack objects? ie:
> bNv2 <- overlay(bN, bSM,
> fun=fun1,filename="bNv2.tif",overwrite=TRUE,NAflag=0) faster than
> sNv2 <- overlay(sN, sSM, fun=fun1,filename="sNv2.tif",overwrite=TRUE,NAflag=0) ?
> (bN, bSM, brick objects; sN, sSM, stack objects)
>
> When you write a brick to a file, can you control if the resulting
> file is going to be BSQ or BIL?
>
> Are the files written by writeRaster() identical for stack and brick objects?
> writeRaster(bNv2,
> filename="bNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
> writeRaster(sNv2,
> filename="sNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
>
> Thanks
>
> Agus
>


From alobolistas at gmail.com  Fri Nov 26 15:46:12 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 26 Nov 2010 15:46:12 +0100
Subject: [R-sig-Geo] raster: apply() in brick objects?
Message-ID: <AANLkTikgHeSA=j+0K2e8YhtRHOJUW_ev41bMN4x1gjJk@mail.gmail.com>

Hi!

Given a brick object (longitude, latitude, time), I need a (lon,lat)
layer with the maximum value of each cell across time.
That's  the equivalent to
> x = array(round(runif(n=3*4*5,min=0,max=10)),dim=c(3,4,5))
> apply(x,c(1,2),max,na.rm=T)

but for x being a brick object. How can I do it with raster?

I've tried

> funmax <- function(x) {apply(x,c(1,2),max,na.rm=T)}
> show(br)
class       : RasterBrick
filename    :
nlayers     : 3
nrow        : 5
ncol        : 5
ncell       : 25
projection  : NA
min value   : ? ? ?
max value   : ? ? ?
extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
resolution  : 0.2, 0.2  (x, y)
> brmax <- calc(br,funmax)

But the result is wrong, as it should be 1 layer and not 3:
> show(brmax)	
class       : RasterBrick
filename    :
nlayers     : 3
nrow        : 5
ncol        : 5
ncell       : 25
projection  : NA
min value   : 232 232 248
max value   : 248 248 248
extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
resolution  : 0.2, 0.2  (x, y)

I've also tried with stackApply(), but do not think that's the way to go.
Also, I'm concerned that apply() is typically very slow in R, and I'm
dealing with a large brick object.

Thanks

Agus


From alobolistas at gmail.com  Fri Nov 26 16:01:20 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 26 Nov 2010 16:01:20 +0100
Subject: [R-sig-Geo] raster: apply() in brick objects?
In-Reply-To: <AANLkTikgHeSA=j+0K2e8YhtRHOJUW_ev41bMN4x1gjJk@mail.gmail.com>
References: <AANLkTikgHeSA=j+0K2e8YhtRHOJUW_ev41bMN4x1gjJk@mail.gmail.com>
Message-ID: <AANLkTik7-gb_f2WYAHRp=R9tDUkpORPoQ=h7VZVsakK7@mail.gmail.com>

...well, it's Friday...

it's actually just
> brmax <- calc(br,max,na.rm=T)
> show(brmax)
class       : RasterBrick
filename    :
nlayers     : 1
nrow        : 5
ncol        : 5
ncell       : 25
projection  : NA
min value   : 248
max value   : 248
extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
resolution  : 0.2, 0.2  (x, y)

that simple.

Agus

2010/11/26 Agustin Lobo <alobolistas at gmail.com>:
> Hi!
>
> Given a brick object (longitude, latitude, time), I need a (lon,lat)
> layer with the maximum value of each cell across time.
> That's ?the equivalent to
>> x = array(round(runif(n=3*4*5,min=0,max=10)),dim=c(3,4,5))
>> apply(x,c(1,2),max,na.rm=T)
>
> but for x being a brick object. How can I do it with raster?
>
> I've tried
>
>> funmax <- function(x) {apply(x,c(1,2),max,na.rm=T)}
>> show(br)
> class ? ? ? : RasterBrick
> filename ? ?:
> nlayers ? ? : 3
> nrow ? ? ? ?: 5
> ncol ? ? ? ?: 5
> ncell ? ? ? : 25
> projection ?: NA
> min value ? : ? ? ?
> max value ? : ? ? ?
> extent ? ? ?: 0, 1, 0, 1 ?(xmin, xmax, ymin, ymax)
> resolution ?: 0.2, 0.2 ?(x, y)
>> brmax <- calc(br,funmax)
>
> But the result is wrong, as it should be 1 layer and not 3:
>> show(brmax)
> class ? ? ? : RasterBrick
> filename ? ?:
> nlayers ? ? : 3
> nrow ? ? ? ?: 5
> ncol ? ? ? ?: 5
> ncell ? ? ? : 25
> projection ?: NA
> min value ? : 232 232 248
> max value ? : 248 248 248
> extent ? ? ?: 0, 1, 0, 1 ?(xmin, xmax, ymin, ymax)
> resolution ?: 0.2, 0.2 ?(x, y)
>
> I've also tried with stackApply(), but do not think that's the way to go.
> Also, I'm concerned that apply() is typically very slow in R, and I'm
> dealing with a large brick object.
>
> Thanks
>
> Agus
>


From jimmyjuan1 at hotmail.com  Fri Nov 26 16:05:06 2010
From: jimmyjuan1 at hotmail.com (Jimmy Martina)
Date: Fri, 26 Nov 2010 10:05:06 -0500
Subject: [R-sig-Geo] Help me with geoRglm results, please
In-Reply-To: <BAY110-W4726C74CEBBAE8E6BF5FBB94200@phx.gbl>
References: <BAY110-W47B3371C60A96ECD9E5AAC94390@phx.gbl>, ,
	<BAY110-W307316BCDCC670616AF48B94390@phx.gbl>, ,
	<BAY110-W26A01692A4E820BEE2C8BF943D0@phx.gbl>,
	<BAY110-W4726C74CEBBAE8E6BF5FBB94200@phx.gbl>
Message-ID: <BAY110-W4292659606B538174E954794210@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101126/969fb3e8/attachment.pl>

From bart at njn.nl  Fri Nov 26 16:49:11 2010
From: bart at njn.nl (bart)
Date: Fri, 26 Nov 2010 16:49:11 +0100
Subject: [R-sig-Geo] Re projecting rasters (projectRaster)
Message-ID: <4CEFD6F7.8030106@njn.nl>

Hi All

I have several rasters in an equal distance projection spread around the
world. My goal is to get them all in one mollweide projection. But there
happens something weird, after using projectRaster i get my raster
replicated in two locations on the world. See the example below. I think
it is not the reprojection because if i do that manually without the
raster i do only get one location/ continues raster.

Bart


require(rgdal)
require(raster)
require(maps)

# create example raster
h<-1000000
a<-raster(matrix(1:100, nrow=10),xmn=-h, xmx=h, ymn=-h,ymx=h,
crs="+proj=aeqd +lon_0=-52.577189655172 +lat_0=21.5126379310345")

# create world wide molllweide raster
grd <- GridTopology(c(-135,-67.5), c(89.99999,44.99999), c(4,4))
polys <- as.SpatialPolygons.GridTopology(grd)
grid <- SpatialPolygonsDataFrame(polys,
data=data.frame(dummy=rep("dummy", length(polys at plotOrder)),
row.names=sapply(slot(polys, "polygons"), function(i) slot(i, "ID"))))
proj4string(grid) <-  CRS("+proj=longlat +datum=WGS84")
#gridProj <- spTransform(grid, CRS("+proj=moll +datum=WGS84"))
gridProj <- spTransform(grid, CRS("+proj=moll +datum=WGS84"))
moll.grid <- spsample(gridProj, type="regular",
offset=bbox(gridProj)[,1]+12500, cellsize=50000)
gridded(moll.grid) <- TRUE
world.raster <- raster(moll.grid)

#show raster before reprojecting
plot(a)
#raster after reprojecting  now in two locations
plot(projectRaster(a, world.raster, method="ngb"))

# add world to show locations (Australia and the atlantic)

mapw<-data.frame(map("world", plot =  FALSE)[c("x","y")])
names(mapw)<-c("location.long", "location.lat")
id<- cumsum(is.na(mapw$location.long))[!is.na(mapw$location.long)]
map<-cbind(mapw[!is.na(mapw$location.lat),], id)
coordinates(map) <- ~location.long+location.lat
proj4string(map)<-CRS("+proj=longlat +datum=WGS84")
map<-as.data.frame(spTransform(map, CRS("+proj=moll +datum=WGS84")))
p<-function(x, col="black")
{
         if(nrow(x)>1)
                 for(i in 1:(nrow(x)-1))
                         lines(x[i:(i+1),]$location.long,
x[i:(i+1),]$location.lat, col=col, lwd=.5)
}
map<-split(map, map$id)
         lapply(map, p)



# only do reprojection
tmp<-as.data.frame(as(a,"SpatialGridDataFrame"))
coordinates(tmp)<- ~s1+s2
proj4string(tmp)<-CRS("+proj=aeqd +lon_0=-52.577189655172
+lat_0=21.5126379310345")
tmp<-spTransform(tmp, CRS("+proj=moll +datum=WGS84"))
plot(tmp)


From r.hijmans at gmail.com  Fri Nov 26 20:09:27 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 26 Nov 2010 11:09:27 -0800
Subject: [R-sig-Geo] Re projecting rasters (projectRaster)
In-Reply-To: <4CEFD6F7.8030106@njn.nl>
References: <4CEFD6F7.8030106@njn.nl>
Message-ID: <AANLkTikntLwq5NRchhJtbhTYFMprfykCrBUruOqnwhiT@mail.gmail.com>

Dear Bart,

You have data NE of the Caribbean, and project these to the whole
world. The below illustrates what goes wrong:

library(raster)
library(maptools)
data(wrld_simpl)

# create example raster
h<-1000000
a<-raster(matrix(1:100, nrow=10),xmn=-h, xmx=h, ymn=-h,ymx=h,
crs="+proj=aeqd +lon_0=-52.577189655172 +lat_0=21.5126379310345")
a[] <- 1:ncell(a)

# project to longlat
ageo <- projectRaster(a, raster())
plot(ageo)
plot(wrld_simpl, add=T)
# Oops a copy of the values in Australia.


This happens because the coordinates of those locations transform to
the same coordinates in the Azimuthal Equidistant projection (going
"through the world";  projectRaster uses the reverse of the projection
you ask it to do, i.e. it transforms coordinates from the output
raster to those of the input raster).

I had not considered that someone would do this type of transfer (from
a small part to the entire world) but there is nothing wrong with this
and I will fix projectRaster for these cases (which should also make
the function much faster too for these cases).

Robert

On Fri, Nov 26, 2010 at 7:49 AM, bart <bart at njn.nl> wrote:
> Hi All
>
> I have several rasters in an equal distance projection spread around the
> world. My goal is to get them all in one mollweide projection. But there
> happens something weird, after using projectRaster i get my raster
> replicated in two locations on the world. See the example below. I think
> it is not the reprojection because if i do that manually without the
> raster i do only get one location/ continues raster.
>
> Bart
>
>
> require(rgdal)
> require(raster)
> require(maps)
>
> # create example raster
> h<-1000000
> a<-raster(matrix(1:100, nrow=10),xmn=-h, xmx=h, ymn=-h,ymx=h,
> crs="+proj=aeqd +lon_0=-52.577189655172 +lat_0=21.5126379310345")
>
> # create world wide molllweide raster
> grd <- GridTopology(c(-135,-67.5), c(89.99999,44.99999), c(4,4))
> polys <- as.SpatialPolygons.GridTopology(grd)
> grid <- SpatialPolygonsDataFrame(polys,
> data=data.frame(dummy=rep("dummy", length(polys at plotOrder)),
> row.names=sapply(slot(polys, "polygons"), function(i) slot(i, "ID"))))
> proj4string(grid) <- ?CRS("+proj=longlat +datum=WGS84")
> #gridProj <- spTransform(grid, CRS("+proj=moll +datum=WGS84"))
> gridProj <- spTransform(grid, CRS("+proj=moll +datum=WGS84"))
> moll.grid <- spsample(gridProj, type="regular",
> offset=bbox(gridProj)[,1]+12500, cellsize=50000)
> gridded(moll.grid) <- TRUE
> world.raster <- raster(moll.grid)
>
> #show raster before reprojecting
> plot(a)
> #raster after reprojecting ?now in two locations
> plot(projectRaster(a, world.raster, method="ngb"))
>
> # add world to show locations (Australia and the atlantic)
>
> mapw<-data.frame(map("world", plot = ?FALSE)[c("x","y")])
> names(mapw)<-c("location.long", "location.lat")
> id<- cumsum(is.na(mapw$location.long))[!is.na(mapw$location.long)]
> map<-cbind(mapw[!is.na(mapw$location.lat),], id)
> coordinates(map) <- ~location.long+location.lat
> proj4string(map)<-CRS("+proj=longlat +datum=WGS84")
> map<-as.data.frame(spTransform(map, CRS("+proj=moll +datum=WGS84")))
> p<-function(x, col="black")
> {
> ? ? ? ?if(nrow(x)>1)
> ? ? ? ? ? ? ? ?for(i in 1:(nrow(x)-1))
> ? ? ? ? ? ? ? ? ? ? ? ?lines(x[i:(i+1),]$location.long,
> x[i:(i+1),]$location.lat, col=col, lwd=.5)
> }
> map<-split(map, map$id)
> ? ? ? ?lapply(map, p)
>
>
>
> # only do reprojection
> tmp<-as.data.frame(as(a,"SpatialGridDataFrame"))
> coordinates(tmp)<- ~s1+s2
> proj4string(tmp)<-CRS("+proj=aeqd +lon_0=-52.577189655172
> +lat_0=21.5126379310345")
> tmp<-spTransform(tmp, CRS("+proj=moll +datum=WGS84"))
> plot(tmp)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Fri Nov 26 20:12:26 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 26 Nov 2010 11:12:26 -0800
Subject: [R-sig-Geo] raster: apply() in brick objects?
In-Reply-To: <AANLkTik7-gb_f2WYAHRp=R9tDUkpORPoQ=h7VZVsakK7@mail.gmail.com>
References: <AANLkTikgHeSA=j+0K2e8YhtRHOJUW_ev41bMN4x1gjJk@mail.gmail.com>
	<AANLkTik7-gb_f2WYAHRp=R9tDUkpORPoQ=h7VZVsakK7@mail.gmail.com>
Message-ID: <AANLkTi=LRj_hdj7QpXPEYWmvV=GrGU9S1RCKiOpRFxDU@mail.gmail.com>

Or this:

brmax <- max(br)


On Fri, Nov 26, 2010 at 7:01 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> ...well, it's Friday...
>
> it's actually just
>> brmax <- calc(br,max,na.rm=T)
>> show(brmax)
> class ? ? ? : RasterBrick
> filename ? ?:
> nlayers ? ? : 1
> nrow ? ? ? ?: 5
> ncol ? ? ? ?: 5
> ncell ? ? ? : 25
> projection ?: NA
> min value ? : 248
> max value ? : 248
> extent ? ? ?: 0, 1, 0, 1 ?(xmin, xmax, ymin, ymax)
> resolution ?: 0.2, 0.2 ?(x, y)
>
> that simple.
>
> Agus
>
> 2010/11/26 Agustin Lobo <alobolistas at gmail.com>:
>> Hi!
>>
>> Given a brick object (longitude, latitude, time), I need a (lon,lat)
>> layer with the maximum value of each cell across time.
>> That's ?the equivalent to
>>> x = array(round(runif(n=3*4*5,min=0,max=10)),dim=c(3,4,5))
>>> apply(x,c(1,2),max,na.rm=T)
>>
>> but for x being a brick object. How can I do it with raster?
>>
>> I've tried
>>
>>> funmax <- function(x) {apply(x,c(1,2),max,na.rm=T)}
>>> show(br)
>> class ? ? ? : RasterBrick
>> filename ? ?:
>> nlayers ? ? : 3
>> nrow ? ? ? ?: 5
>> ncol ? ? ? ?: 5
>> ncell ? ? ? : 25
>> projection ?: NA
>> min value ? : ? ? ?
>> max value ? : ? ? ?
>> extent ? ? ?: 0, 1, 0, 1 ?(xmin, xmax, ymin, ymax)
>> resolution ?: 0.2, 0.2 ?(x, y)
>>> brmax <- calc(br,funmax)
>>
>> But the result is wrong, as it should be 1 layer and not 3:
>>> show(brmax)
>> class ? ? ? : RasterBrick
>> filename ? ?:
>> nlayers ? ? : 3
>> nrow ? ? ? ?: 5
>> ncol ? ? ? ?: 5
>> ncell ? ? ? : 25
>> projection ?: NA
>> min value ? : 232 232 248
>> max value ? : 248 248 248
>> extent ? ? ?: 0, 1, 0, 1 ?(xmin, xmax, ymin, ymax)
>> resolution ?: 0.2, 0.2 ?(x, y)
>>
>> I've also tried with stackApply(), but do not think that's the way to go.
>> Also, I'm concerned that apply() is typically very slow in R, and I'm
>> dealing with a large brick object.
>>
>> Thanks
>>
>> Agus
>>
>


From r.hijmans at gmail.com  Fri Nov 26 20:22:19 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 26 Nov 2010 11:22:19 -0800
Subject: [R-sig-Geo] Brick and Stack in package raster
In-Reply-To: <AANLkTimRzfjHHOH19frTB0KDXzWYYVbWEcEtOV87-qKZ@mail.gmail.com>
References: <AANLkTimRzfjHHOH19frTB0KDXzWYYVbWEcEtOV87-qKZ@mail.gmail.com>
Message-ID: <AANLkTi=r+WdsMFoDrUdRhZzQCfy1JBWoLbXwdH1H-Zzv@mail.gmail.com>

On Fri, Nov 26, 2010 at 2:25 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Robert,
>
> At some point you made this comment:
>
>>>> (as you are dealing with large
>>>> files, I think it is more efficient to first make a stack and then
>>>> write the results to a brick)
>
> But I have some doubts:
>
> bN = brick(N1,N2,N3,...,N72)
> where
> N1 = raster(paste(midir,"NDV_19990101__Extract.img",sep="")) etc
> takes a very long time. Is a file on disk being written somewhere?
>

That is why I am saying that it is better to do

sN = stack(N1,N2,N3,...,N72)

and then, perhaps,

bN <- brick(sN )

But that is probably not worth it. I may change a few things in the
code and manual to make this go smoother.
I think the approach is to always makes a stack if you have separate
files and a brick if it is a single file. Adding a layer to a brick
should perhaps result in a stack. Computations on a stack/brick always
result in a brick (single file if on disk)


> Is overlay() going to be any faster with brick than with stack objects? ie:
> bNv2 <- overlay(bN, bSM,
> fun=fun1,filename="bNv2.tif",overwrite=TRUE,NAflag=0) faster than
> sNv2 <- overlay(sN, sSM, fun=fun1,filename="sNv2.tif",overwrite=TRUE,NAflag=0) ?
> (bN, bSM, brick objects; sN, sSM, stack objects)

Yes, I would think that would be faster with a brick, because the data
need to come out of a single object/file (i.e. 72 times fewer files
need to be opened and closed). But I am not sure if it is worth it to
first make a brick from the stack, because that also takes time.

> When you write a brick to a file, can you control if the resulting
> file is going to be BSQ or BIL?

Yes, but only for the native format (not when writing via rgdal, e.g.
GeoTIFF). BIL is default and should work. BIP is rather inefficient
except for extracting point values. BSQ best for extracting single
layers.

> Are the files written by writeRaster() identical for stack and brick objects?
> writeRaster(bNv2,
> filename="bNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
> writeRaster(sNv2,
> filename="sNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
>

Yes, always writes a single file (brick object).


> Thanks
>
> Agus
>

Cheers, Robert


From martin_brandt at gmx.net  Fri Nov 26 22:35:11 2010
From: martin_brandt at gmx.net (Martin)
Date: Fri, 26 Nov 2010 13:35:11 -0800 (PST)
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>
References: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>
Message-ID: <1290807311630-5778472.post@n2.nabble.com>


this is what I did to perform a regression between two bricks (each brick
represent a time series):

r <- raster(brick1)
for (i in 1:ncell(r)) { 
r[i] = lm(as.ts(cellValues(brick1, i)) ~ as.ts(cellValues(brick2,
i)))$coefficients[2]
}

The result will be a slope raster, but it really takes a lot of time, so
maybe there is a better solution..


-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From moshersteven at gmail.com  Fri Nov 26 23:33:13 2010
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 26 Nov 2010 14:33:13 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <1290807311630-5778472.post@n2.nabble.com>
References: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>
	<1290807311630-5778472.post@n2.nabble.com>
Message-ID: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101126/597334d8/attachment.pl>

From jacobvanetten at yahoo.com  Fri Nov 26 23:51:10 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Fri, 26 Nov 2010 22:51:10 +0000 (GMT)
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
Message-ID: <771411.8321.qm@web29709.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101126/dc1d17aa/attachment.pl>

From r.hijmans at gmail.com  Fri Nov 26 23:56:30 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 26 Nov 2010 14:56:30 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <771411.8321.qm@web29709.mail.ird.yahoo.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
Message-ID: <AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>

It seems that 'calc' does not like this (any more; another thing to
fix) . If your rasters are not very large you can use apply, which
makes it much faster:

library(raster)
#creating some data
r <- raster(nrow=10, ncol=10)
s <- list()
for (i in 1:25) { s[i] <- setValues(r, rnorm(ncell(r), i, 3) ) }
s <- stack(s)

# regression
time <- 1:nlayers(s)
fun <- function(x) { lm(x ~ time)$coefficients[2] }
r[] <- apply(getValues(s), 1, fun)

Robert



On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
<jacobvanetten at yahoo.com> wrote:
> you could try this approach (use calc whenever you can):
>
> (supposing your bricks have 12 layers)
>
> br3 <- stack(brick1, brick2)
> lmS <- function(x) lm(x[1:12] ~ x[13:24)$coefficients[2]
> r <- calc(br3, lmS)
>
> Jacob.
>
> --- On Fri, 26/11/10, steven mosher <moshersteven at gmail.com> wrote:
>
> From: steven mosher <moshersteven at gmail.com>
> Subject: Re: [R-sig-Geo] gridded time series analysis
> To: "Martin" <martin_brandt at gmx.net>
> Cc: r-sig-geo at stat.math.ethz.ch
> Date: Friday, 26 November, 2010, 23:33
>
> that's cool, I'm also interested in a similar problem but just with one
> brick ending up with a slope raster as the output. It may be possible with
> stackApply(). have a look. or maybe robert will chime in
>
>
>
> On Fri, Nov 26, 2010 at 1:35 PM, Martin <martin_brandt at gmx.net> wrote:
>
>>
>> this is what I did to perform a regression between two bricks (each brick
>> represent a time series):
>>
>> r <- raster(brick1)
>> for (i in 1:ncell(r)) {
>> r[i] = lm(as.ts(cellValues(brick1, i)) ~ as.ts(cellValues(brick2,
>> i)))$coefficients[2]
>> }
>>
>> The result will be a slope raster, but it really takes a lot of time, so
>> maybe there is a better solution..
>>
>>
>> --
>> View this message in context:
>> http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> ??? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From r.hijmans at gmail.com  Sat Nov 27 00:25:29 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 26 Nov 2010 15:25:29 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
Message-ID: <AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>

There are some difference in the behavior of 'calc' between functions,
because of attempts to accommodate different functions & intentions.
But in 'raster' 1.7-4 (available from R-Forge in ~ 24 hrs; and from
CRAN soon), the below will work:

library(raster)
#creating some data
r <- raster(nrow=10, ncol=10)
s1 <- s2<- list()
for (i in 1:12) {
	s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
	s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
}
s1 <- stack(s1)
s2 <- stack(s2)

# regression of values in one brick (or stack) with another (Jacob's suggestion)
s <- stack(s1, s2)
# s1 and s2 have 12 layers
fun <- function(x) { lm(x[1:12] ~ x[13:24])$coefficients[2] }
x1 <- calc(s, fun)

# regression of values in one brick (or stack) with 'time'
time <- 1:nlayers(s)
fun <- function(x) { lm(x ~ time)$coefficients[2] }
x2 <- calc(s, fun)

# get multiple layers, e.g. the slope _and_ intercept
fun <- function(x) { lm(x ~ time)$coefficients }
x3 <- calc(s, fun)

If this does not work in your version, you can use apply( ) as in what
I send earlier.

Robert

On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> It seems that 'calc' does not like this (any more; another thing to
> fix) . If your rasters are not very large you can use apply, which
> makes it much faster:
>
> library(raster)
> #creating some data
> r <- raster(nrow=10, ncol=10)
> s <- list()
> for (i in 1:25) { s[i] <- setValues(r, rnorm(ncell(r), i, 3) ) }
> s <- stack(s)
>
> # regression
> time <- 1:nlayers(s)
> fun <- function(x) { lm(x ~ time)$coefficients[2] }
> r[] <- apply(getValues(s), 1, fun)
>
> Robert
>
>
>
> On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
> <jacobvanetten at yahoo.com> wrote:
>> you could try this approach (use calc whenever you can):
>>
>> (supposing your bricks have 12 layers)
>>
>> br3 <- stack(brick1, brick2)
>> lmS <- function(x) lm(x[1:12] ~ x[13:24)$coefficients[2]
>> r <- calc(br3, lmS)
>>
>> Jacob.
>>
>> --- On Fri, 26/11/10, steven mosher <moshersteven at gmail.com> wrote:
>>
>> From: steven mosher <moshersteven at gmail.com>
>> Subject: Re: [R-sig-Geo] gridded time series analysis
>> To: "Martin" <martin_brandt at gmx.net>
>> Cc: r-sig-geo at stat.math.ethz.ch
>> Date: Friday, 26 November, 2010, 23:33
>>
>> that's cool, I'm also interested in a similar problem but just with one
>> brick ending up with a slope raster as the output. It may be possible with
>> stackApply(). have a look. or maybe robert will chime in
>>
>>
>>
>> On Fri, Nov 26, 2010 at 1:35 PM, Martin <martin_brandt at gmx.net> wrote:
>>
>>>
>>> this is what I did to perform a regression between two bricks (each brick
>>> represent a time series):
>>>
>>> r <- raster(brick1)
>>> for (i in 1:ncell(r)) {
>>> r[i] = lm(as.ts(cellValues(brick1, i)) ~ as.ts(cellValues(brick2,
>>> i)))$coefficients[2]
>>> }
>>>
>>> The result will be a slope raster, but it really takes a lot of time, so
>>> maybe there is a better solution..
>>>
>>>
>>> --
>>> View this message in context:
>>> http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> ??? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>


From sabramso at princeton.edu  Sat Nov 27 03:12:10 2010
From: sabramso at princeton.edu (Scott Abramson)
Date: Fri, 26 Nov 2010 21:12:10 -0500
Subject: [R-sig-Geo] OS Grid conversion
Message-ID: <AANLkTinvdtEyV-Miv7wzynM6hxF17Cc8xHr0G2wLzObk@mail.gmail.com>

Hi all,
I have a vector of UK OS National Grid Reference points (ST7475 for
example). I would like to convert them to WSG84  latitude/longitude
but cannot figure out a simple way to do this.

I apologize if there is an immediate answer that I have overlooked.

Thanks in advance for your help.

Best,
Scott


From lufile at 126.com  Sat Nov 27 04:33:43 2010
From: lufile at 126.com (lu)
Date: Sat, 27 Nov 2010 11:33:43 +0800 (CST)
Subject: [R-sig-Geo] How can I add attribute data to map?
Message-ID: <161de1f.17a5.12c8b64bc5b.Coremail.lufile@126.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101127/15c8a425/attachment.pl>

From alobolistas at gmail.com  Sat Nov 27 12:14:54 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sat, 27 Nov 2010 12:14:54 +0100
Subject: [R-sig-Geo] Brick and Stack in package raster
In-Reply-To: <AANLkTi=r+WdsMFoDrUdRhZzQCfy1JBWoLbXwdH1H-Zzv@mail.gmail.com>
References: <AANLkTimRzfjHHOH19frTB0KDXzWYYVbWEcEtOV87-qKZ@mail.gmail.com>
	<AANLkTi=r+WdsMFoDrUdRhZzQCfy1JBWoLbXwdH1H-Zzv@mail.gmail.com>
Message-ID: <AANLkTimcii_1TXpJhmepXi1ojy=r7raiOftEAbm-=_0M@mail.gmail.com>

Thanks
Just noting that you also have BIL for envi format and that
BIP seems to be the default for geotiff (at least that's what gdalinfo
reports for
tif files written by writeRaster() :
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=PIXEL

Also, I understand that the order is BIL also when brick() writes a
file by default (i.e. /tmp/R_raster_tmp/raster_tmp_789131022710.grd)

Agus

2010/11/26 Robert J. Hijmans <r.hijmans at gmail.com>:
> On Fri, Nov 26, 2010 at 2:25 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Robert,
>>
>> At some point you made this comment:
>>
>>>>> (as you are dealing with large
>>>>> files, I think it is more efficient to first make a stack and then
>>>>> write the results to a brick)
>>
>> But I have some doubts:
>>
>> bN = brick(N1,N2,N3,...,N72)
>> where
>> N1 = raster(paste(midir,"NDV_19990101__Extract.img",sep="")) etc
>> takes a very long time. Is a file on disk being written somewhere?
>>
>
> That is why I am saying that it is better to do
>
> sN = stack(N1,N2,N3,...,N72)
>
> and then, perhaps,
>
> bN <- brick(sN )
>
> But that is probably not worth it. I may change a few things in the
> code and manual to make this go smoother.
> I think the approach is to always makes a stack if you have separate
> files and a brick if it is a single file. Adding a layer to a brick
> should perhaps result in a stack. Computations on a stack/brick always
> result in a brick (single file if on disk)
>
>
>> Is overlay() going to be any faster with brick than with stack objects? ie:
>> bNv2 <- overlay(bN, bSM,
>> fun=fun1,filename="bNv2.tif",overwrite=TRUE,NAflag=0) faster than
>> sNv2 <- overlay(sN, sSM, fun=fun1,filename="sNv2.tif",overwrite=TRUE,NAflag=0) ?
>> (bN, bSM, brick objects; sN, sSM, stack objects)
>
> Yes, I would think that would be faster with a brick, because the data
> need to come out of a single object/file (i.e. 72 times fewer files
> need to be opened and closed). But I am not sure if it is worth it to
> first make a brick from the stack, because that also takes time.
>
>> When you write a brick to a file, can you control if the resulting
>> file is going to be BSQ or BIL?
>
> Yes, but only for the native format (not when writing via rgdal, e.g.
> GeoTIFF). BIL is default and should work. BIP is rather inefficient
> except for extracting point values. BSQ best for extracting single
> layers.
>
>> Are the files written by writeRaster() identical for stack and brick objects?
>> writeRaster(bNv2,
>> filename="bNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
>> writeRaster(sNv2,
>> filename="sNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
>>
>
> Yes, always writes a single file (brick object).
>
>
>> Thanks
>>
>> Agus
>>
>
> Cheers, Robert
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From lubinbin220 at gmail.com  Sat Nov 27 15:04:32 2010
From: lubinbin220 at gmail.com (binbin lu)
Date: Sat, 27 Nov 2010 14:04:32 +0000
Subject: [R-sig-Geo] How can I add attribute data to map?
In-Reply-To: <161de1f.17a5.12c8b64bc5b.Coremail.lufile@126.com>
References: <161de1f.17a5.12c8b64bc5b.Coremail.lufile@126.com>
Message-ID: <AANLkTimp=i4BOB4cLHr_R1=vk4T+4G6N2mS6xvNv3TtF@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101127/28f3d776/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sat Nov 27 15:24:24 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 27 Nov 2010 14:24:24 +0000
Subject: [R-sig-Geo] OS Grid conversion
In-Reply-To: <AANLkTinvdtEyV-Miv7wzynM6hxF17Cc8xHr0G2wLzObk@mail.gmail.com>
References: <AANLkTinvdtEyV-Miv7wzynM6hxF17Cc8xHr0G2wLzObk@mail.gmail.com>
Message-ID: <AANLkTikTewOj2DNVuH3K8doFzJAGtURj5hJV7uUxJAk+@mail.gmail.com>

On Sat, Nov 27, 2010 at 2:12 AM, Scott Abramson <sabramso at princeton.edu> wrote:
> Hi all,
> I have a vector of UK OS National Grid Reference points (ST7475 for
> example). I would like to convert them to WSG84 ?latitude/longitude
> but cannot figure out a simple way to do this.
>
> I apologize if there is an immediate answer that I have overlooked.

 No time for a full working answer right now, but the function you
need is spTransform from rgdal (or is it in sp or maptools, I forget -
get all of them). You then need to know the offsets for the letter
codes (see the wikipedia page on OSGB national grid) and then you need
to add offsets to your eastings and northings corresponding to the
letter code. Extract parts of your character coordinate "ST7475" using
the substr function.

 Having done all that, you then need to know that OSGB is EPSG:27700 -
put your points in a SpatialPointsDataFrame with that CRS and then
convert to EPSG:4326 (which is WGS84).

 So for example:

 ST7475

ST is 3 east and 1 north from the origin:
http://en.wikipedia.org/wiki/Ordnance_Survey_National_Grid

 So you have (374, 175) (assuming I've got the order right)

 Now let's see... the letter square is 100km, so you've got 3 digits,
thats 1km references, so multiply by 1000 to get metres:

 (374000,175000)

 those should be epsg:27700 coordinates - here's how we transform:

# make a point:

 > require(rgdal);require(sp)
 > pt = data.frame(x=374000,y=175000)
 > coordinates(pt)=~x+y
 > pt
SpatialPoints:
          x      y
[1,] 374000 175000
Coordinate Reference System (CRS) arguments: NA

 okay, now say its osgb grid coords:

 > proj4string(pt)=CRS("+init=epsg:27700")
 > pt
SpatialPoints:
          x      y
[1,] 374000 175000
Coordinate Reference System (CRS) arguments: +init=epsg:27700
+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
+y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs
+towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894

 now we have a non NA CRS. So we can spTransform:

 > spTransform(pt,CRS("+init=epsg:4326"))
SpatialPoints:
             x        y
[1,] -2.375734 51.47336
Coordinate Reference System (CRS) arguments: +init=epsg:4326
+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0

 How's that? I have to go chop a tree down now before it gets dark...

Barry


From advaitgodbole at gmail.com  Sat Nov 27 17:36:31 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sat, 27 Nov 2010 11:36:31 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
Message-ID: <AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101127/47346f04/attachment.pl>

From carson.farmer at gmail.com  Sat Nov 27 20:04:54 2010
From: carson.farmer at gmail.com (Carson Farmer)
Date: Sat, 27 Nov 2010 19:04:54 +0000
Subject: [R-sig-Geo] How can I add attribute data to map?
In-Reply-To: <161de1f.17a5.12c8b64bc5b.Coremail.lufile@126.com>
References: <161de1f.17a5.12c8b64bc5b.Coremail.lufile@126.com>
Message-ID: <AANLkTi=0gwev+yXAwo_h1GK7Ybif5NS0zzx-S-LajT7u@mail.gmail.com>

Assuming the attribute table you want to join to your county layer is
called new.data, the following might be what you're looking for:

temp.data <- county at data
         # get the data.frame of your county Spatial*DataFrame
temp.data <- merge(temp.data, new.data, by='code', all.x=TRUE) # join
your new.data to your temp.data data.frame

                        # in this case, a left outer join, which is
probably what you want...
county at data <- temp.data
         # now add the data back (along with the new fields)

Hope that helps,

Carson

On 27 November 2010 03:33, lu <lufile at 126.com> wrote:
> Hello,
> ?I have import map data (county) into R and the fields of ?its data are code, name. Now I want to add attribute data to the map. The fields of the attribute data are code,var1,var2,var3,var4,var5,var6,var7 . How can I add the attribute data to the map according to the code fields ?Thanks!
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Carson J. Q. Farmer
ISSP Doctoral Fellow
National Centre for Geocomputation
National University of Ireland, Maynooth,
http://www.carsonfarmer.com/


From r.hijmans at gmail.com  Sat Nov 27 21:16:59 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 27 Nov 2010 12:16:59 -0800
Subject: [R-sig-Geo] Brick and Stack in package raster
In-Reply-To: <AANLkTimcii_1TXpJhmepXi1ojy=r7raiOftEAbm-=_0M@mail.gmail.com>
References: <AANLkTimRzfjHHOH19frTB0KDXzWYYVbWEcEtOV87-qKZ@mail.gmail.com>
	<AANLkTi=r+WdsMFoDrUdRhZzQCfy1JBWoLbXwdH1H-Zzv@mail.gmail.com>
	<AANLkTimcii_1TXpJhmepXi1ojy=r7raiOftEAbm-=_0M@mail.gmail.com>
Message-ID: <AANLkTinofYA6XU2rjfraeZ+UgdbFnafUp2YYY=YghWQr@mail.gmail.com>

Hi Agus,

You are right, thanks for this correction. You can set the band-order
for native formats via the 'bandorder' argument (with BIL as default),
but this is ignored for other formats (that was not in the docs). For
the gdal formats that support different types of band interleaving,
you can use an options=c(" ") argument and pass valid gdal options.
E.g. to write band interleaved GTIFF files (with x being a RasterStack
or RasterBrick)

x <- writeRaster(x, filename='test.tif', options="INTERLEAVE=BAND")

Robert

On Sat, Nov 27, 2010 at 3:14 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Thanks
> Just noting that you also have BIL for envi format and that
> BIP seems to be the default for geotiff (at least that's what gdalinfo
> reports for
> tif files written by writeRaster() :
> Image Structure Metadata:
> ?COMPRESSION=LZW
> ?INTERLEAVE=PIXEL
>
> Also, I understand that the order is BIL also when brick() writes a
> file by default (i.e. /tmp/R_raster_tmp/raster_tmp_789131022710.grd)
>
> Agus
>
> 2010/11/26 Robert J. Hijmans <r.hijmans at gmail.com>:
>> On Fri, Nov 26, 2010 at 2:25 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>> Robert,
>>>
>>> At some point you made this comment:
>>>
>>>>>> (as you are dealing with large
>>>>>> files, I think it is more efficient to first make a stack and then
>>>>>> write the results to a brick)
>>>
>>> But I have some doubts:
>>>
>>> bN = brick(N1,N2,N3,...,N72)
>>> where
>>> N1 = raster(paste(midir,"NDV_19990101__Extract.img",sep="")) etc
>>> takes a very long time. Is a file on disk being written somewhere?
>>>
>>
>> That is why I am saying that it is better to do
>>
>> sN = stack(N1,N2,N3,...,N72)
>>
>> and then, perhaps,
>>
>> bN <- brick(sN )
>>
>> But that is probably not worth it. I may change a few things in the
>> code and manual to make this go smoother.
>> I think the approach is to always makes a stack if you have separate
>> files and a brick if it is a single file. Adding a layer to a brick
>> should perhaps result in a stack. Computations on a stack/brick always
>> result in a brick (single file if on disk)
>>
>>
>>> Is overlay() going to be any faster with brick than with stack objects? ie:
>>> bNv2 <- overlay(bN, bSM,
>>> fun=fun1,filename="bNv2.tif",overwrite=TRUE,NAflag=0) faster than
>>> sNv2 <- overlay(sN, sSM, fun=fun1,filename="sNv2.tif",overwrite=TRUE,NAflag=0) ?
>>> (bN, bSM, brick objects; sN, sSM, stack objects)
>>
>> Yes, I would think that would be faster with a brick, because the data
>> need to come out of a single object/file (i.e. 72 times fewer files
>> need to be opened and closed). But I am not sure if it is worth it to
>> first make a brick from the stack, because that also takes time.
>>
>>> When you write a brick to a file, can you control if the resulting
>>> file is going to be BSQ or BIL?
>>
>> Yes, but only for the native format (not when writing via rgdal, e.g.
>> GeoTIFF). BIL is default and should work. BIP is rather inefficient
>> except for extracting point values. BSQ best for extracting single
>> layers.
>>
>>> Are the files written by writeRaster() identical for stack and brick objects?
>>> writeRaster(bNv2,
>>> filename="bNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
>>> writeRaster(sNv2,
>>> filename="sNv2b.tif",overwrite=TRUE,format="GTiff",datatype='INT2U',NAflag=0)
>>>
>>
>> Yes, always writes a single file (brick object).
>>
>>
>>> Thanks
>>>
>>> Agus
>>>
>>
>> Cheers, Robert
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From r.hijmans at gmail.com  Sat Nov 27 21:48:36 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 27 Nov 2010 12:48:36 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
Message-ID: <AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>

Advait,

That suggests that you have missing values in the lon or lat
dimensions. Is that true? That would be awkward, but perhaps something
else is going on. Can you send me your file? If not can you send the
results of this:

filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
nc <- open.ncdf(filename)
length(nc$dim[[1]]$vals)
length(nc$dim[[2]]$vals)
nc$dim[[1]]$vals
nc$dim[[2]]$vals
close.ncdf(nc)

Thanks, Robert

On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> Thanks everyone for these leads..However, I am running into problems with
> data handling. I used ncdf to extract the two variables (507 x 356 x 120 -
> lon,lat,time) and converted them into array objects. The suggestions
> provided all utilize the raster package, but using "brick" on the file
> returns this error: "rcmraster <- brick("regcm.cumul.hdd.10k.96_05.new.nc")
> Error in if (e at xmin > -400 & e at xmax < 400 & e at ymin > -90.1 & e at ymax < ?:
> missing value where TRUE/FALSE needed"
>
> I have a fair number of NAs (all missing values in the original variables).
> Is there a way to set a flag for that? Or any other workaround?
> Thanks much,
> advait
> On Fri, Nov 26, 2010 at 6:25 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> There are some difference in the behavior of 'calc' between functions,
>> because of attempts to accommodate different functions & intentions.
>> But in 'raster' 1.7-4 (available from R-Forge in ~ 24 hrs; and from
>> CRAN soon), the below will work:
>>
>> library(raster)
>> #creating some data
>> r <- raster(nrow=10, ncol=10)
>> s1 <- s2<- list()
>> for (i in 1:12) {
>> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> }
>> s1 <- stack(s1)
>> s2 <- stack(s2)
>>
>> # regression of values in one brick (or stack) with another (Jacob's
>> suggestion)
>> s <- stack(s1, s2)
>> # s1 and s2 have 12 layers
>> fun <- function(x) { lm(x[1:12] ~ x[13:24])$coefficients[2] }
>> x1 <- calc(s, fun)
>>
>> # regression of values in one brick (or stack) with 'time'
>> time <- 1:nlayers(s)
>> fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> x2 <- calc(s, fun)
>>
>> # get multiple layers, e.g. the slope _and_ intercept
>> fun <- function(x) { lm(x ~ time)$coefficients }
>> x3 <- calc(s, fun)
>>
>> If this does not work in your version, you can use apply( ) as in what
>> I send earlier.
>>
>> Robert
>>
>> On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> wrote:
>> > It seems that 'calc' does not like this (any more; another thing to
>> > fix) . If your rasters are not very large you can use apply, which
>> > makes it much faster:
>> >
>> > library(raster)
>> > #creating some data
>> > r <- raster(nrow=10, ncol=10)
>> > s <- list()
>> > for (i in 1:25) { s[i] <- setValues(r, rnorm(ncell(r), i, 3) ) }
>> > s <- stack(s)
>> >
>> > # regression
>> > time <- 1:nlayers(s)
>> > fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> > r[] <- apply(getValues(s), 1, fun)
>> >
>> > Robert
>> >
>> >
>> >
>> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
>> > <jacobvanetten at yahoo.com> wrote:
>> >> you could try this approach (use calc whenever you can):
>> >>
>> >> (supposing your bricks have 12 layers)
>> >>
>> >> br3 <- stack(brick1, brick2)
>> >> lmS <- function(x) lm(x[1:12] ~ x[13:24)$coefficients[2]
>> >> r <- calc(br3, lmS)
>> >>
>> >> Jacob.
>> >>
>> >> --- On Fri, 26/11/10, steven mosher <moshersteven at gmail.com> wrote:
>> >>
>> >> From: steven mosher <moshersteven at gmail.com>
>> >> Subject: Re: [R-sig-Geo] gridded time series analysis
>> >> To: "Martin" <martin_brandt at gmx.net>
>> >> Cc: r-sig-geo at stat.math.ethz.ch
>> >> Date: Friday, 26 November, 2010, 23:33
>> >>
>> >> that's cool, I'm also interested in a similar problem but just with one
>> >> brick ending up with a slope raster as the output. It may be possible
>> >> with
>> >> stackApply(). have a look. or maybe robert will chime in
>> >>
>> >>
>> >>
>> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin <martin_brandt at gmx.net> wrote:
>> >>
>> >>>
>> >>> this is what I did to perform a regression between two bricks (each
>> >>> brick
>> >>> represent a time series):
>> >>>
>> >>> r <- raster(brick1)
>> >>> for (i in 1:ncell(r)) {
>> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~ as.ts(cellValues(brick2,
>> >>> i)))$coefficients[2]
>> >>> }
>> >>>
>> >>> The result will be a slope raster, but it really takes a lot of time,
>> >>> so
>> >>> maybe there is a better solution..
>> >>>
>> >>>
>> >>> --
>> >>> View this message in context:
>> >>>
>> >>> http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> >>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>> >>>
>> >>> _______________________________________________
>> >>> R-sig-Geo mailing list
>> >>> R-sig-Geo at stat.math.ethz.ch
>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>
>> >>
>> >> ??? [[alternative HTML version deleted]]
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at stat.math.ethz.ch
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>
>> >>
>> >>
>> >>
>> >> ? ? ? ?[[alternative HTML version deleted]]
>> >>
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at stat.math.ethz.ch
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>
>> >>
>> >
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> advait godbole
>


From steven.chiou at uconn.edu  Sat Nov 27 22:55:06 2010
From: steven.chiou at uconn.edu (Steven)
Date: Sat, 27 Nov 2010 13:55:06 -0800 (PST)
Subject: [R-sig-Geo] Weighted Voronoi diagram
Message-ID: <1290894906339-5780523.post@n2.nabble.com>


Hello everyone,

I hope you all enjoyed thanksgiving break.
I am just wondering if there is any R package that allow you to do Weighted
Voronoi diagram?
I figure out how to do the Vornoi diagram with library(deldir) but I like to
weight my coordinates with a third dimension value.

Thank you for any help.
Steven
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Weighted-Voronoi-diagram-tp5780523p5780523.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From martin_brandt at gmx.net  Sun Nov 28 13:33:39 2010
From: martin_brandt at gmx.net (Martin)
Date: Sun, 28 Nov 2010 04:33:39 -0800 (PST)
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
References: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>
	<1290807311630-5778472.post@n2.nabble.com>
	<AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
Message-ID: <1290947619832-5781554.post@n2.nabble.com>


thanks Robert, this works fine.
but could it be that the functions have a problem with NA-values?
your Regression functions return this error:


> x3 <- calc(tt, fun)
error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...) : 
  0 (non-NA) cases

when i use rasters with NA values...it works without problems with rasters
without NAs..

cheers,
Martin




-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5781554.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alobolistas at gmail.com  Sun Nov 28 18:47:34 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 28 Nov 2010 18:47:34 +0100
Subject: [R-sig-Geo] raster::crop
Message-ID: <AANLkTimoHMdp8yAqfp88X6f8k3PPKEAnfbOJJTieQ29r@mail.gmail.com>

Is it possible to crop a raster by selecting rows and cols? i.e. the
equivalent to

subs = bN3[1000:1100,1000:1100]

but subs should remain a raster (or a brick)
(crop seems to require geographic coordinates even if the raster is projected)

Thanks

Agus


From r.hijmans at gmail.com  Mon Nov 29 05:15:42 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 28 Nov 2010 20:15:42 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <1290947619832-5781554.post@n2.nabble.com>
References: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>
	<1290807311630-5778472.post@n2.nabble.com>
	<AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<1290947619832-5781554.post@n2.nabble.com>
Message-ID: <AANLkTi=RmjZMstKsUQiA-Ho9+v=a0L6cbrGnYG3ETYH3@mail.gmail.com>

Martin,

I think the problem is whith the lm function that returns an error
rather than NA:

> a <- rep(NA,10)
> lm(a~a)
Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...) :
  0 (non-NA) cases

#rather than something like this:
> fun=function(x) { lm(x[1]~x[2])$coefficients[2] }
> fun(c(NA,NA))
Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...) :
  0 (non-NA) cases

#you could catch this in your function and do something like:

> fun=function(x) { if (is.na(x[1])){ NA } else { lm(x[1]~x[2])$coefficients[2] }}
> fun(c(NA,NA))
[1] NA


and then:

calc(s, fun=fun)

lm and relatives have an na.action argument but I do not think that
can come to the rescue here.

Roberrt

On Sun, Nov 28, 2010 at 4:33 AM, Martin <martin_brandt at gmx.net> wrote:
>
> thanks Robert, this works fine.
> but could it be that the functions have a problem with NA-values?
> your Regression functions return this error:
>
>
>> x3 <- calc(tt, fun)
> error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...) :
> ?0 (non-NA) cases
>
> when i use rasters with NA values...it works without problems with rasters
> without NAs..
>
> cheers,
> Martin
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5781554.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From adrian at maths.uwa.edu.au  Mon Nov 29 09:45:19 2010
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Mon, 29 Nov 2010 16:45:19 +0800
Subject: [R-sig-Geo] how to assess spatial randomness of an spp given the
 distribution of another spp
In-Reply-To: <mailman.13.1290769204.8375.r-sig-geo@stat.math.ethz.ch>
References: <mailman.13.1290769204.8375.r-sig-geo@stat.math.ethz.ch>
Message-ID: <4CF3681F.2010508@maths.uwa.edu.au>

sylvain willart <sylvain.willart at gmail.com> writes:

  > I am working with spatstat package to analyse two
 > spatial points data frames:
 > - the locations of hospitals in France
 >  - the location of the population (each 'point' here
 > represents about 3,000 people)
 > I used quadrat.test and kstest to test for spatial randomness of
 > hospitals, which, hopefully is not random,
 > I would like to know if there's a (simple non-bayesian) way of
 > assessing spatial randomness for hospitals given the distribution of
 > the population,
 > and ultimately if it is possible to do so using MarkedPointProcess
 > package (the hospitals being of different sizes, and populations
 > having different needs for healthcare)

Suppose X is the point pattern of hospitals and Y the point pattern of 
the reference population. First smooth the reference population to get a 
population density e.g.
        Yden <- density(Y)
(see 'density.ppp' for additional arguments to control the smoothing)
Next rescale this intensity to have the same total as the hospitals

        nn <- npoints(X)/npoints(Y)
        Href <- eval.im(Yden * nn)

Thus Href is (a smooth estimate of) the predicted intensity of hospitals 
under the assumption that hospitals are randomly allocated in proportion 
to population density, independent of one another.

Finally compute the inhomogeneous K-function

        Ki <- Kinhom(X, Href)
        plot(Ki)

The result has an interpretation similar to the usual K-function except 
that it is adjusted for the population density. [In the latest versions 
of spatstat, Href can be replaced by Yden in the last command, because 
Kinhom automatically renormalises]

To generate simulation envelopes,

         e <- expression(rpoispp(Href))
         plot(envelope(X, Kinhom, lambda=Yden, simulate=e, nsim=39))

Adrian Baddeley


From martin_brandt at gmx.net  Mon Nov 29 10:34:22 2010
From: martin_brandt at gmx.net (Martin)
Date: Mon, 29 Nov 2010 01:34:22 -0800 (PST)
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTi=RmjZMstKsUQiA-Ho9+v=a0L6cbrGnYG3ETYH3@mail.gmail.com>
References: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>
	<1290807311630-5778472.post@n2.nabble.com>
	<AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<1290947619832-5781554.post@n2.nabble.com>
	<AANLkTi=RmjZMstKsUQiA-Ho9+v=a0L6cbrGnYG3ETYH3@mail.gmail.com>
Message-ID: <1291023262728-5783724.post@n2.nabble.com>


that works Robert, thanks a lot!
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5783724.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From martin_brandt at gmx.net  Mon Nov 29 10:58:30 2010
From: martin_brandt at gmx.net (Martin)
Date: Mon, 29 Nov 2010 01:58:30 -0800 (PST)
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <1291023262728-5783724.post@n2.nabble.com>
References: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>
	<1290807311630-5778472.post@n2.nabble.com>
	<AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<1290947619832-5781554.post@n2.nabble.com>
	<AANLkTi=RmjZMstKsUQiA-Ho9+v=a0L6cbrGnYG3ETYH3@mail.gmail.com>
	<1291023262728-5783724.post@n2.nabble.com>
Message-ID: <1291024710318-5783798.post@n2.nabble.com>


another thing which might be interesting:

I know I can call the intercept with "coefficients[1]" and the slope with
"coefficients[2]". But is it also possible to get a gridded result with the
other lm regression results (normaly available via "summary()") , like R?,
p-value, or residuals?

Martin


-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5783798.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alobolistas at gmail.com  Mon Nov 29 13:21:31 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 29 Nov 2010 13:21:31 +0100
Subject: [R-sig-Geo] warning at creating SpatialPolygonsDataFrame and error
 at saving through rgdal
Message-ID: <AANLkTi=kZroPuo_iCfKYX_g+iBBz0MWYDtWgLX9HUgQh@mail.gmail.com>

Hi!

I create a SPDF with a function
HypNAr = meta2sppol()

that ends up with:

sitios <- 1:length(noms)
row.names(datos) <- sitios
SpatialPolygonsDataFrame(dummy, data=datos, match.ID = T)

but get:

Warning message:
In data.row.names(row.names, rowsi, i) :
  some row.names duplicated: 2 --> row.names NOT used

I do not understand, as I define the row names as a sequence of
integers, how can they be duplicated?
I can plot the SPDF and the data slot is correct, but when I try to
save as shapefile:

> writeOGR(HypNAr,dsn="HypNAr",layer="HypNAr",driver="ESRI Shapefile",verbose=T)
Error in writeOGR(HypNAr, dsn = "HypNAr", layer = "HypNAr", driver =
"ESRI Shapefile",  :

	GDAL Error 1: Invalid index : -1
Calls: writeOGR -> .Call
In addition: There were 11 warnings (use warnings() to see them)

Is this error related to the previous warning?

Thanks!

Agus


From Roger.Bivand at nhh.no  Mon Nov 29 14:08:49 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 29 Nov 2010 14:08:49 +0100 (CET)
Subject: [R-sig-Geo] warning at creating SpatialPolygonsDataFrame and
 error at saving through rgdal
In-Reply-To: <AANLkTi=kZroPuo_iCfKYX_g+iBBz0MWYDtWgLX9HUgQh@mail.gmail.com>
References: <AANLkTi=kZroPuo_iCfKYX_g+iBBz0MWYDtWgLX9HUgQh@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1011291355450.18309@reclus.nhh.no>

On Mon, 29 Nov 2010, Agustin Lobo wrote:

> Hi!
>
> I create a SPDF with a function
> HypNAr = meta2sppol()
>
> that ends up with:
>
> sitios <- 1:length(noms)
> row.names(datos) <- sitios
> SpatialPolygonsDataFrame(dummy, data=datos, match.ID = T)
>
> but get:
>
> Warning message:
> In data.row.names(row.names, rowsi, i) :
>  some row.names duplicated: 2 --> row.names NOT used

The message is coming from data.frame() in base package. Do

debug(meta2sppol)
debug(data.frame)
HypNAr = meta2sppol()

and see what happens inside the data.frame() call that creates datos, 
which is where the warning is issued (it may be inside a coercion method 
call, such as as.data.frame()); open:

https://svn.r-project.org/R/trunk/src/library/base/R/dataframe.R

and search for "some row.names duplicated".

That is, the problem is in your own function. Please also note that 
providing a reproducible example is crucial to getting precise assistance, 
and usually the exercise of writing such an example reveals the cause, 
thus solving the problem more quickly.

Roger

>
> I do not understand, as I define the row names as a sequence of
> integers, how can they be duplicated?
> I can plot the SPDF and the data slot is correct, but when I try to
> save as shapefile:
>
>> writeOGR(HypNAr,dsn="HypNAr",layer="HypNAr",driver="ESRI Shapefile",verbose=T)
> Error in writeOGR(HypNAr, dsn = "HypNAr", layer = "HypNAr", driver =
> "ESRI Shapefile",  :
>
> 	GDAL Error 1: Invalid index : -1
> Calls: writeOGR -> .Call
> In addition: There were 11 warnings (use warnings() to see them)
>
> Is this error related to the previous warning?
>
> Thanks!
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jimmyjuan1 at hotmail.com  Mon Nov 29 14:46:08 2010
From: jimmyjuan1 at hotmail.com (Jimmy Martina)
Date: Mon, 29 Nov 2010 08:46:08 -0500
Subject: [R-sig-Geo] Modelling a variable which doesn't depend on its
 locality (constant-space-average)
In-Reply-To: <BAY110-W391D741F2AE54B6935EBD394240@phx.gbl>
References: <BAY110-W391D741F2AE54B6935EBD394240@phx.gbl>
Message-ID: <BAY110-W10FF184D288D9301F9B43F94240@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/d604ab0d/attachment.pl>

From jimmyjuan1 at hotmail.com  Mon Nov 29 14:44:52 2010
From: jimmyjuan1 at hotmail.com (Jimmy Martina)
Date: Mon, 29 Nov 2010 08:44:52 -0500
Subject: [R-sig-Geo] Modelling a variable which doesn't depend on its
 locality (constant-space-average)
Message-ID: <BAY110-W391D741F2AE54B6935EBD394240@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/b75f1391/attachment.pl>

From breitbach at uni-mainz.de  Mon Nov 29 15:09:14 2010
From: breitbach at uni-mainz.de (Breitbach, Nils)
Date: Mon, 29 Nov 2010 14:09:14 +0000
Subject: [R-sig-Geo] R solution for distance sampling
Message-ID: <E7F1EF063B11DA4DAD16374549B879E82AE495FD@e14mdb-02.zdv.Uni-Mainz.DE>

Dear community,

in the near future I plan to use distance sampling methods. From a first literature survey I came accross the software DISTANCE. Since this software somehow communicates with R, my question is now: What package or function in R comes close to the mentioned software? Maybe there is something from the same group of authors or even something better? I should mention that the target taxonomic group are birds.

Thank you very much ...
Cheers,

Nils


From advaitgodbole at gmail.com  Mon Nov 29 15:11:01 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Mon, 29 Nov 2010 09:11:01 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
Message-ID: <AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/52056f0a/attachment.pl>

From sylvain.willart at gmail.com  Mon Nov 29 18:03:56 2010
From: sylvain.willart at gmail.com (sylvain willart)
Date: Mon, 29 Nov 2010 18:03:56 +0100
Subject: [R-sig-Geo] how to assess spatial randomness of an spp given
 the distribution of another spp
In-Reply-To: <4CF3681F.2010508@maths.uwa.edu.au>
References: <mailman.13.1290769204.8375.r-sig-geo@stat.math.ethz.ch>
	<4CF3681F.2010508@maths.uwa.edu.au>
Message-ID: <AANLkTik-3CKv4aiSWwvouxLqKJaY-JKiERfpQ4b1_nxu@mail.gmail.com>

well, thanks
it works and is precisely what I needed !
just added some weighting options in the use of density function (Yden)

Sylvain

2010/11/29 Adrian Baddeley <adrian at maths.uwa.edu.au>:
> sylvain willart <sylvain.willart at gmail.com> writes:
>
> ?> I am working with spatstat package to analyse two
>> spatial points data frames:
>> - the locations of hospitals in France
>> ?- the location of the population (each 'point' here
>> represents about 3,000 people)
>> I used quadrat.test and kstest to test for spatial randomness of
>> hospitals, which, hopefully is not random,
>> I would like to know if there's a (simple non-bayesian) way of
>> assessing spatial randomness for hospitals given the distribution of
>> the population,
>> and ultimately if it is possible to do so using MarkedPointProcess
>> package (the hospitals being of different sizes, and populations
>> having different needs for healthcare)
>
> Suppose X is the point pattern of hospitals and Y the point pattern of the
> reference population. First smooth the reference population to get a
> population density e.g.
> ? ? ? Yden <- density(Y)
> (see 'density.ppp' for additional arguments to control the smoothing)
> Next rescale this intensity to have the same total as the hospitals
>
> ? ? ? nn <- npoints(X)/npoints(Y)
> ? ? ? Href <- eval.im(Yden * nn)
>
> Thus Href is (a smooth estimate of) the predicted intensity of hospitals
> under the assumption that hospitals are randomly allocated in proportion to
> population density, independent of one another.
>
> Finally compute the inhomogeneous K-function
>
> ? ? ? Ki <- Kinhom(X, Href)
> ? ? ? plot(Ki)
>
> The result has an interpretation similar to the usual K-function except that
> it is adjusted for the population density. [In the latest versions of
> spatstat, Href can be replaced by Yden in the last command, because Kinhom
> automatically renormalises]
>
> To generate simulation envelopes,
>
> ? ? ? ?e <- expression(rpoispp(Href))
> ? ? ? ?plot(envelope(X, Kinhom, lambda=Yden, simulate=e, nsim=39))
>
> Adrian Baddeley
>
>
>
>


From r.hijmans at gmail.com  Mon Nov 29 19:14:53 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 29 Nov 2010 10:14:53 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
Message-ID: <AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>

Advait,
I do not think I can help you further unless you send me your file;
but this suggests that it is either not following the CF standards, or
something is wrong with the file, or that there is something I have
not understood about these files.
You said you have 507 x 356 x 120 values. I would expect
length(frcm$dim[[1]]$vals) == 507 and length(frcm$dim[[2]]$vals) ==
356
Robert

On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <advaitgodbole at gmail.com> wrote:
> sorry to disrupt the flow of the conversation, but after doing what Robert
> suggested, this is what was returned:
>> length(frcm$dim[[1]]$vals)
> [1] 21659040
>> length(frcm$dim[[2]]$vals)
> [1] 21659040
> the other two functions return the latitude and longitude arrays not
> populated with NAs/missing values. I havent reproduced them here because of
> their number.
> Regards,
> advait
> On Sat, Nov 27, 2010 at 3:48 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> Advait,
>>
>> That suggests that you have missing values in the lon or lat
>> dimensions. Is that true? That would be awkward, but perhaps something
>> else is going on. Can you send me your file? If not can you send the
>> results of this:
>>
>> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>> nc <- open.ncdf(filename)
>> length(nc$dim[[1]]$vals)
>> length(nc$dim[[2]]$vals)
>> nc$dim[[1]]$vals
>> nc$dim[[2]]$vals
>> close.ncdf(nc)
>>
>> Thanks, Robert
>>
>> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole <advaitgodbole at gmail.com>
>> wrote:
>> > Thanks everyone for these leads..However, I am running into problems
>> > with
>> > data handling. I used ncdf to extract the two variables (507 x 356 x 120
>> > -
>> > lon,lat,time) and converted them into array objects. The suggestions
>> > provided all utilize the raster package, but using "brick" on the file
>> > returns this error: "rcmraster <-
>> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>> > Error in if (e at xmin > -400 & e at xmax < 400 & e at ymin > -90.1 & e at ymax < ?:
>> > missing value where TRUE/FALSE needed"
>> >
>> > I have a fair number of NAs (all missing values in the original
>> > variables).
>> > Is there a way to set a flag for that? Or any other workaround?
>> > Thanks much,
>> > advait
>> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> > wrote:
>> >>
>> >> There are some difference in the behavior of 'calc' between functions,
>> >> because of attempts to accommodate different functions & intentions.
>> >> But in 'raster' 1.7-4 (available from R-Forge in ~ 24 hrs; and from
>> >> CRAN soon), the below will work:
>> >>
>> >> library(raster)
>> >> #creating some data
>> >> r <- raster(nrow=10, ncol=10)
>> >> s1 <- s2<- list()
>> >> for (i in 1:12) {
>> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> >> }
>> >> s1 <- stack(s1)
>> >> s2 <- stack(s2)
>> >>
>> >> # regression of values in one brick (or stack) with another (Jacob's
>> >> suggestion)
>> >> s <- stack(s1, s2)
>> >> # s1 and s2 have 12 layers
>> >> fun <- function(x) { lm(x[1:12] ~ x[13:24])$coefficients[2] }
>> >> x1 <- calc(s, fun)
>> >>
>> >> # regression of values in one brick (or stack) with 'time'
>> >> time <- 1:nlayers(s)
>> >> fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> >> x2 <- calc(s, fun)
>> >>
>> >> # get multiple layers, e.g. the slope _and_ intercept
>> >> fun <- function(x) { lm(x ~ time)$coefficients }
>> >> x3 <- calc(s, fun)
>> >>
>> >> If this does not work in your version, you can use apply( ) as in what
>> >> I send earlier.
>> >>
>> >> Robert
>> >>
>> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans
>> >> <r.hijmans at gmail.com>
>> >> wrote:
>> >> > It seems that 'calc' does not like this (any more; another thing to
>> >> > fix) . If your rasters are not very large you can use apply, which
>> >> > makes it much faster:
>> >> >
>> >> > library(raster)
>> >> > #creating some data
>> >> > r <- raster(nrow=10, ncol=10)
>> >> > s <- list()
>> >> > for (i in 1:25) { s[i] <- setValues(r, rnorm(ncell(r), i, 3) ) }
>> >> > s <- stack(s)
>> >> >
>> >> > # regression
>> >> > time <- 1:nlayers(s)
>> >> > fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> >> > r[] <- apply(getValues(s), 1, fun)
>> >> >
>> >> > Robert
>> >> >
>> >> >
>> >> >
>> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
>> >> > <jacobvanetten at yahoo.com> wrote:
>> >> >> you could try this approach (use calc whenever you can):
>> >> >>
>> >> >> (supposing your bricks have 12 layers)
>> >> >>
>> >> >> br3 <- stack(brick1, brick2)
>> >> >> lmS <- function(x) lm(x[1:12] ~ x[13:24)$coefficients[2]
>> >> >> r <- calc(br3, lmS)
>> >> >>
>> >> >> Jacob.
>> >> >>
>> >> >> --- On Fri, 26/11/10, steven mosher <moshersteven at gmail.com> wrote:
>> >> >>
>> >> >> From: steven mosher <moshersteven at gmail.com>
>> >> >> Subject: Re: [R-sig-Geo] gridded time series analysis
>> >> >> To: "Martin" <martin_brandt at gmx.net>
>> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>> >> >> Date: Friday, 26 November, 2010, 23:33
>> >> >>
>> >> >> that's cool, I'm also interested in a similar problem but just with
>> >> >> one
>> >> >> brick ending up with a slope raster as the output. It may be
>> >> >> possible
>> >> >> with
>> >> >> stackApply(). have a look. or maybe robert will chime in
>> >> >>
>> >> >>
>> >> >>
>> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin <martin_brandt at gmx.net>
>> >> >> wrote:
>> >> >>
>> >> >>>
>> >> >>> this is what I did to perform a regression between two bricks (each
>> >> >>> brick
>> >> >>> represent a time series):
>> >> >>>
>> >> >>> r <- raster(brick1)
>> >> >>> for (i in 1:ncell(r)) {
>> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~ as.ts(cellValues(brick2,
>> >> >>> i)))$coefficients[2]
>> >> >>> }
>> >> >>>
>> >> >>> The result will be a slope raster, but it really takes a lot of
>> >> >>> time,
>> >> >>> so
>> >> >>> maybe there is a better solution..
>> >> >>>
>> >> >>>
>> >> >>> --
>> >> >>> View this message in context:
>> >> >>>
>> >> >>>
>> >> >>> http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> >> >>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>> >> >>>
>> >> >>> _______________________________________________
>> >> >>> R-sig-Geo mailing list
>> >> >>> R-sig-Geo at stat.math.ethz.ch
>> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >>>
>> >> >>
>> >> >> ??? [[alternative HTML version deleted]]
>> >> >>
>> >> >> _______________________________________________
>> >> >> R-sig-Geo mailing list
>> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >> ? ? ? ?[[alternative HTML version deleted]]
>> >> >>
>> >> >>
>> >> >> _______________________________________________
>> >> >> R-sig-Geo mailing list
>> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >>
>> >> >>
>> >> >
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at stat.math.ethz.ch
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> >
>> >
>> > --
>> > advait godbole
>> >
>
>
>
> --
> advait godbole
>


From r.hijmans at gmail.com  Mon Nov 29 19:20:57 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 29 Nov 2010 10:20:57 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <1291024710318-5783798.post@n2.nabble.com>
References: <AANLkTim2wUQx4fbQvhVifcsPejLJ60odUhWNMpe0pcA9@mail.gmail.com>
	<1290807311630-5778472.post@n2.nabble.com>
	<AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<1290947619832-5781554.post@n2.nabble.com>
	<AANLkTi=RmjZMstKsUQiA-Ho9+v=a0L6cbrGnYG3ETYH3@mail.gmail.com>
	<1291023262728-5783724.post@n2.nabble.com>
	<1291024710318-5783798.post@n2.nabble.com>
Message-ID: <AANLkTi=+3SAuZY0N_7aHcb14zAV3uvC8NN1RGKSou-09@mail.gmail.com>

You can return anything you like, as long as it is numeric (or a
vector of numerics). R^2 should come out like this:

 fun=function(x) { if (is.na(x[1])){ NA } else { m <-
lm(x[1]~x[2])$coefficients[2]; summary(m)$r.squared  }}


slope and R^2

 fun=function(x) { if (is.na(x[1])){ NA } else { m <-
lm(x[1]~x[2])$coefficients[2]; c(m$coefficients[2],
summary(m)$r.squared  }}

Robert

On Mon, Nov 29, 2010 at 1:58 AM, Martin <martin_brandt at gmx.net> wrote:
>
> another thing which might be interesting:
>
> I know I can call the intercept with "coefficients[1]" and the slope with
> "coefficients[2]". But is it also possible to get a gridded result with the
> other lm regression results (normaly available via "summary()") , like R?,
> p-value, or residuals?
>
> Martin
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5783798.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Mon Nov 29 19:36:49 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 29 Nov 2010 10:36:49 -0800
Subject: [R-sig-Geo] R solution for distance sampling
In-Reply-To: <E7F1EF063B11DA4DAD16374549B879E82AE495FD@e14mdb-02.zdv.Uni-Mainz.DE>
References: <E7F1EF063B11DA4DAD16374549B879E82AE495FD@e14mdb-02.zdv.Uni-Mainz.DE>
Message-ID: <AANLkTingLVwy7mA=waw82k2nwvt6gdbKh523S6W9X_4r@mail.gmail.com>

Nils, I think the 'unmarked' package is a candidate. Robert

On Mon, Nov 29, 2010 at 6:09 AM, Breitbach, Nils <breitbach at uni-mainz.de> wrote:
> Dear community,
>
> in the near future I plan to use distance sampling methods. From a first literature survey I came accross the software DISTANCE. Since this software somehow communicates with R, my question is now: What package or function in R comes close to the mentioned software? Maybe there is something from the same group of authors or even something better? I should mention that the target taxonomic group are birds.
>
> Thank you very much ...
> Cheers,
>
> Nils
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mauro.rossi at irpi.cnr.it  Mon Nov 29 19:56:26 2010
From: mauro.rossi at irpi.cnr.it (Mauro Rossi)
Date: Mon, 29 Nov 2010 19:56:26 +0100
Subject: [R-sig-Geo] Appending data to PostGIS layer
Message-ID: <4CF3F75A.5050007@irpi.cnr.it>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/b0731999/attachment.pl>

From moshersteven at gmail.com  Mon Nov 29 20:04:45 2010
From: moshersteven at gmail.com (steven mosher)
Date: Mon, 29 Nov 2010 11:04:45 -0800
Subject: [R-sig-Geo] raster::crop
In-Reply-To: <AANLkTimoHMdp8yAqfp88X6f8k3PPKEAnfbOJJTieQ29r@mail.gmail.com>
References: <AANLkTimoHMdp8yAqfp88X6f8k3PPKEAnfbOJJTieQ29r@mail.gmail.com>
Message-ID: <AANLkTikZMHVaLACNA7j__rHaQ5Y2wKWxRbrMHonVDVsy@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/e8a0e1a9/attachment.pl>

From lists at remoteinformation.com.au  Mon Nov 29 20:35:57 2010
From: lists at remoteinformation.com.au (Ben Madin)
Date: Tue, 30 Nov 2010 06:35:57 +1100
Subject: [R-sig-Geo] Appending data to PostGIS layer
In-Reply-To: <4CF3F75A.5050007@irpi.cnr.it>
References: <4CF3F75A.5050007@irpi.cnr.it>
Message-ID: <692EB857-56F2-464A-96EF-DF1A74F72973@remoteinformation.com.au>

Mauro,

On 30/11/2010, at 5:56 AM, Mauro Rossi wrote:

>    I have n shapefiles and n .txt files. For each shapefile I need to 
> merge the attributes table with the attributes in the corresponding .txt 
> file. After this I need to put all these new merged spatial layers in 
> the same Postgis layer. Given the high number of shapefiles, I need to 
> add one file at a time. I've completed the part regarding the merging, 
> but I still understand how to append the different spatial layers to the 
> same PostGis layer. Function writeOGR{rgdal} doesn't seem to have this 
> possibility. Does anybody know how I can do this?

If you already have the spatial data in the database, and some key attribute which is common between the two (ie province name or code) just use normal SQL to achieve this - use ALTER TABLE to ADD the required columnsand UPDATE based on the common attribute. 

The advantage to doing this in R is maybe looping to cover all tables, using read.table to load the txt file  - you can make it as complex as you want after that!!

look at library(RPostgreSQL) if you don't already have it.

cheers

Ben





> 
> Mauro
> 
> -- 
> 
> Mauro Rossi
> 
> Istituto di Ricerca per la Protezione Idrogeologica
> 
> Consiglio Nazionale delle Ricerche
> 
> Via della Madonna Alta, 126
> 
> 06128 Perugia
> 
> Italia
> 
> Tel.+39 075 5014421
> 
> Fax +39 075 5014420
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From moshersteven at gmail.com  Mon Nov 29 22:06:37 2010
From: moshersteven at gmail.com (steven mosher)
Date: Mon, 29 Nov 2010 13:06:37 -0800
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <AANLkTikjUW9ZnMGP8=8x_ZMTQYdv0rbdpFZODkmgx_pa@mail.gmail.com>
References: <2AEFBA3C-3A8E-467A-8A55-04AF5220D2DC@gmail.com>
	<777261.37380.qm@web29720.mail.ird.yahoo.com>
	<AANLkTikjUW9ZnMGP8=8x_ZMTQYdv0rbdpFZODkmgx_pa@mail.gmail.com>
Message-ID: <AANLkTinxRWVWcMBHQUzao++wC5qoS5NAgP2c=641pOHb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/95492678/attachment.pl>

From xie at yihui.name  Mon Nov 29 22:36:13 2010
From: xie at yihui.name (Yihui Xie)
Date: Mon, 29 Nov 2010 15:36:13 -0600
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <AANLkTinxRWVWcMBHQUzao++wC5qoS5NAgP2c=641pOHb@mail.gmail.com>
References: <2AEFBA3C-3A8E-467A-8A55-04AF5220D2DC@gmail.com>
	<777261.37380.qm@web29720.mail.ird.yahoo.com>
	<AANLkTikjUW9ZnMGP8=8x_ZMTQYdv0rbdpFZODkmgx_pa@mail.gmail.com>
	<AANLkTinxRWVWcMBHQUzao++wC5qoS5NAgP2c=641pOHb@mail.gmail.com>
Message-ID: <AANLkTikmywLksOO8jSZQHm82PT8G6PvxFkAMop6jeekz@mail.gmail.com>

I have solved the second problem a couple of weeks ago but did not
release it to CRAN; recently I'm in the process of moving my
repository to GitHub: https://github.com/yihui/animation I have
finished it yesterday. If the namespace conflict is a serious problem,
I can push a new version to CRAN soon.

For the first problem, I am not aware of the potential problems, but I
will try to remove these setwd() calls in the next version. I do not
even remember why I needed to change working directories frequently 3
years ago when I wrote these functions... I guess I forgot to add
these comments to my code then:

## When I wrote this, only God and I understood what I was doing
## Now, God only knows

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA



On Mon, Nov 29, 2010 at 3:06 PM, steven mosher <moshersteven at gmail.com> wrote:
> I think GraphicsMagick is superior. ?I have not programmed C since maybe
> 1993, so I am read capable and write limited. I've got the source. It does
> not look easy.
> For sci-vis ( scientific visualization) I am wondering what the best format
> will be for animation.
>
> A couple other notes. It would be nice if animation were modified ?a bit.
> 1. To rewrite the functions so that the api does not change directories when
> doing the
> ?? ? image writing. As it stands now the code changes directories to the
> IMAGE directory
> ?? ? writes images and then changes back ( If I am recalling) This led to
> some problems
> ?? ? with raster. I think Robert Hijmans fixed that problem on the raster
> side, but I would
> ?? ? suggest changing it on the animation side as well.
> ?2. package dependencies. The package loads the MASS package which has a
> namespace
> ?? ?fight with api in raster ?( area). while this is easily fixed, it did
> cost me a couple days to figure out. ? In short, your example code requires
> certain packages to be loaded, but for those
> ?? ?folks who just want to use ani.options, ani.start() and ani.stop(), the
> packages are not required.
> ?I just solved those two problems by hacking up the nice package, and really
> tuning it to my purpose. ?in my perfect world ?it would work like this and
> just be a method one uses on a
> raster "brick" object.
> animate(brick, imageDirectory="tbd", type=c("html","mov" etc....),...)
>
> conceptually..
>
>
>
> On Mon, Nov 29, 2010 at 12:43 PM, Yihui Xie <xie at yihui.name> wrote:
>>
>> Porting ImageMagick or GraphicsMagick into R is not a trivial task,
>> and my knowledge on C is rather limited. I will be very happy if
>> anyone can do this.
>>
>> And thanks Steven for letting me know GraphicsMagick. It looks like a
>> better choice.
>>
>> Regards,
>> Yihui
>> --
>> Yihui Xie <xieyihui at gmail.com>
>> Phone: 515-294-2465 Web: http://yihui.name
>> Department of Statistics, Iowa State University
>> 2215 Snedecor Hall, Ames, IA
>>
>>
>> On Mon, Nov 15, 2010 at 4:49 PM, Jacob van Etten
>> <jacobvanetten at yahoo.com> wrote:
>> >
>> > I got ImageMagick working on Windows. The only problem occurred when I
>> > tried to write the movie file to a directory with subdirectories in it. It
>> > works with an empty directory, though.
>> >
>> > I think it should be possible to incorporate the code from ImageMagick
>> > or GraphicsMagic into an R package, making an external install unnecessary.
>> >
>> > Jacob.
>> >
>> > --- On Mon, 15/11/10, Kevin Ummel <kevinummel at gmail.com> wrote:
>> >
>> > From: Kevin Ummel <kevinummel at gmail.com>
>> > Subject: Re: [R-sig-Geo] Anyone attempted to "animate" multi-layered
>> > rasters?
>> > To: "steven mosher" <moshersteven at gmail.com>
>> > Cc: "Jacob van Etten" <jacobvanetten at yahoo.com>,
>> > R-sig-Geo at stat.math.ethz.ch, xie at yihui.name
>> > Date: Monday, 15 November, 2010, 23:26
>> >
>> > Thanks, Jacob.
>> > For the community: I've successfully installed ImageMagick on Mac OS
>> > 10.6.4 (i.e. the sample commands to verify functionality check
>> > OK:?http://www.imagemagick.org/script/binary-releases.php?ImageMagick=cmdb7qc5snnquootuef90ki645#macosx).
>> > I receive an error running Jacob's example code:
>> > Error in cmd.fun(sprintf("%s --version", convert), intern = TRUE) :
>> > ??error in running command
>> > sh: convert: command not found
>> > I don't believe this is an 'animate' issue, but is a thorny path problem
>> > that apparently plagues ImageMagick installs via MacPorts. I tried some
>> > things based on the message boards at ImageMagick without success. This
>> > isn't the place for ImageMagick troubleshooting, but a heads up for Mac
>> > users trying to implement Jacob's example...
>> > Thanks,
>> > Kevin
>> > On Nov 15, 2010, at 9:35 PM, steven mosher wrote:
>> >
>> > Thanks Jacob,
>> >
>> > ?I was unable to get ImageMagick working ( which saveMovie() relies
>> > upon.. as I recall ) so I had to live with the html animation.
>> >
>> >
>> >
>> > On Mon, Nov 15, 2010 at 12:58 PM, Jacob van Etten
>> > <jacobvanetten at yahoo.com> wrote:
>> >
>> > A function is not really necessary. It?s actually quite simple.
>> >
>> > library(raster)
>> > library(animation)
>> > setwd("c:/empty")
>> >
>> > logo <- raster(system.file("external/rlogo.grd", package="raster"),
>> > values=TRUE)
>> >
>> > saveMovie(
>> > for(i in 1:250)
>> > {
>> > ??? logo1 <- logo
>> > ??? logo1[logo1<i] <- 0
>> > ??? #here you could also extract a RasterLayer from a RasterStack
>> > ??? plot(logo1, main=i)
>> > },
>> > loop=1,
>> > interval= 0.1,
>> > outdir = getwd(),
>> > moviename="logo")
>> >
>> > Cheers,
>> >
>> > Jacob.
>> >
>> > --- On Sat, 13/11/10, Kevin Ummel <kevinummel at gmail.com> wrote:
>> >
>> > From: Kevin Ummel <kevinummel at gmail.com>
>> > Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered
>> > rasters?
>> > To: R-sig-Geo at stat.math.ethz.ch
>> > Date: Saturday, 13 November, 2010, 12:58
>> >
>> > Hello,
>> >
>> > I came across the 'animate' package, and I'm wondering if anyone has
>> > successfully adapted it to create animations of multi-layered spatial data.
>> >
>> > This seems like a logical advance of R's spatial data visualization,
>> > especially given the prominence of NetCDF and HDR file types, but I don't
>> > want to replicate if someone else already has a function in working order...
>> >
>> > Cheers,
>> > Kevin
>> >
>> > Kevin Ummel
>> > Senior Visiting Associate, Center for Global Development
>> > MESPOM Candidate, University of Manchester
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at stat.math.ethz.ch
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> >
>> >
>> >
>> > ? ? ? ?[[alternative HTML version deleted]]
>> >
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at stat.math.ethz.ch
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> >
>> >
>> >
>
>


From jacobvanetten at yahoo.com  Mon Nov 29 23:22:21 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Mon, 29 Nov 2010 22:22:21 +0000 (GMT)
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <AANLkTikmywLksOO8jSZQHm82PT8G6PvxFkAMop6jeekz@mail.gmail.com>
Message-ID: <78403.91766.qm@web29719.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/606a4f86/attachment.pl>

From moshersteven at gmail.com  Mon Nov 29 23:27:02 2010
From: moshersteven at gmail.com (steven mosher)
Date: Mon, 29 Nov 2010 14:27:02 -0800
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <AANLkTikmywLksOO8jSZQHm82PT8G6PvxFkAMop6jeekz@mail.gmail.com>
References: <2AEFBA3C-3A8E-467A-8A55-04AF5220D2DC@gmail.com>
	<777261.37380.qm@web29720.mail.ird.yahoo.com>
	<AANLkTikjUW9ZnMGP8=8x_ZMTQYdv0rbdpFZODkmgx_pa@mail.gmail.com>
	<AANLkTinxRWVWcMBHQUzao++wC5qoS5NAgP2c=641pOHb@mail.gmail.com>
	<AANLkTikmywLksOO8jSZQHm82PT8G6PvxFkAMop6jeekz@mail.gmail.com>
Message-ID: <AANLkTinVvWMxtQtQkV_cRZYdnTT7Au-+fg+LaLjd2Ync@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/e73eb0e6/attachment.pl>

From jacobvanetten at yahoo.com  Tue Nov 30 00:12:10 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Mon, 29 Nov 2010 23:12:10 +0000 (GMT)
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <AANLkTinVvWMxtQtQkV_cRZYdnTT7Au-+fg+LaLjd2Ync@mail.gmail.com>
Message-ID: <835406.52484.qm@web29702.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/4c7ba694/attachment.pl>

From fdbesanto at gmail.com  Tue Nov 30 00:54:47 2010
From: fdbesanto at gmail.com (Fernando Santo)
Date: Mon, 29 Nov 2010 18:54:47 -0500
Subject: [R-sig-Geo] geostatistic memory issue
Message-ID: <4CF43D47.30200@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/7a460e86/attachment.pl>

From fdbesanto at gmail.com  Tue Nov 30 00:59:24 2010
From: fdbesanto at gmail.com (Fernando Santo)
Date: Mon, 29 Nov 2010 18:59:24 -0500
Subject: [R-sig-Geo] geostatistic memory issue
Message-ID: <4CF43E5C.2040103@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/b478cea6/attachment.pl>

From r.hijmans at gmail.com  Tue Nov 30 03:11:37 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 29 Nov 2010 18:11:37 -0800
Subject: [R-sig-Geo] geostatistic memory issue
In-Reply-To: <4CF43D47.30200@gmail.com>
References: <4CF43D47.30200@gmail.com>
Message-ID: <AANLkTi=uFpV2gJCTJviKJo5U9-JGkzf9Aj1oKqrwbOmT@mail.gmail.com>

Fernando,

You can use the raster package for dealing with memory issues like this:

library(fields)
fit <- Krig(ozone$x, ozone$y, theta=20)

library(raster)
# create a target RasterLayer
r <- raster(xmn=min(ozone$x), xmx=max(ozone$x), ymn=min(ozone$y),
ymx=max(ozone$y))
res(r) <- 1/6
x <- interpolate(r, fit)
plot(x)
x


in your case, that would be something like this:
...
r <- raster(xmn=723604,xmx=724904,ymn=9661020,ymx=9662348)
res(r) <- 4
...

Robert

On Mon, Nov 29, 2010 at 3:54 PM, Fernando Santo <fdbesanto at gmail.com> wrote:
> Dear All,
>
> I am running a geostatistical analysis using the package "fields" of
> n=980 and grid of approximately 1x1 km with 4 m of spatial resolution.
> Because the fine grid resolution of 4 meters, which I really need for my
> experiment, I am having problems with memory allocation. ?I am using an
> OS linux 32 bit (i686-pc-linux-gnu) with 4 Gb of memory and 2 Gb of swap
> and R version 2.12.0. ?Running the R command gc() in my computer, I have
> the following:
>
> ?>gc()
> ? ? ? ? ? ? used ? ? ? ?(Mb) ? gc ? ? ?trigger ? ? ?(Mb) ? ? ?max used
> (Mb)
> Ncells ? 147153 ? ? ?4.0 ? ? ? ? ? ? ?350000 ? ? ?9.4 ? ? ? ? ? 350000 ? 9.4
> Vcells ? ?86617 ? ? ? 0.7 ? ? ? ? ? ? ?786432 ? ? ? 6.0
> 434604 ? 3.4
>
> I tried to work around of my memory issue (?Memory) for Linux, start R
> with the command *R --min-vsize=100M --max-vsize=3G --min-nsize=100M
> --max-nsize=3G*, but still I did not saved the problem of memory
> allocation. ?I know that the solution could be: (1) install a OS 64bits
> or (2) reduce the spatial resolution of my grid (e.g. for 10x10 m).
> However, I can not format my computer right now and I need a grid of 4 x
> 4 m.
>
> I would like to ask you the following:
> 1 - How I could increase the memory allocation of my linux? ?Is there
> something wrong with my work around of memory allocation showed above?
> 2 - Is possible to apply the use of the R package ?e.g. "bigmemory" in
> my geostatistic script (please see bellow)? ?If yes, how it could be?
> My problem is only in the last command of my script when I call the
> function "predict" of fields.
>
> My script is bellow:
>
> Any help will be very welcome.
> Thanks for your attention.
> Fernando
>
> ###########################################
> dat <- read.csv("/home/fernando/Desktop/data.csv")
> library(fields)
>
> # set ?x-y ?coordinates of image, considering the center of each pixel
> col_xcoord <- seq(723606,724902,by=4) ? ? ? ? # ?correct: 325
> row_ycoord <- seq(9661022,9662346,by=4) ? # ?correct: 332
> xmin = min(col_xcoord)
> ymin = min(row_ycoord)
> locs.x = col_xcoord-xmin
> locs.y = row_ycoord-ymin
> newlocs = expand.grid(locs.x,locs.y)
>
> locs = data.frame(dat$long-xmin,dat$lat-ymin) ?# adjusted location as
> data frame
> sqrt.gf = sqrt(dat$gap.frac) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? # The
> response variable
>
> #################################################
> # Produce the Kriging estimates using exponential variogram with scale
> parameter 24.15
> #################################################
>
> fit = Krig(locs,sqrt.gf,theta=24.15)
> # I used the range parameter 24.15 estimated earlier
>
> summary(fit) # summary of fit
>
> # HERE I HAD THE ERROR OF MEMORY ALLOCATION
> # "predict" the kriging values
> krig.out = predict(fit,newlocs)
> # Error: cannot allocate vector of size 806.7 Mb
>
> # This takes about 2 minutes on Mac of my friend
> # but it did not work in my linux
>
>
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From moshersteven at gmail.com  Tue Nov 30 07:13:11 2010
From: moshersteven at gmail.com (steven mosher)
Date: Mon, 29 Nov 2010 22:13:11 -0800
Subject: [R-sig-Geo] Anyone attempted to "animate" multi-layered rasters?
In-Reply-To: <835406.52484.qm@web29702.mail.ird.yahoo.com>
References: <AANLkTinVvWMxtQtQkV_cRZYdnTT7Au-+fg+LaLjd2Ync@mail.gmail.com>
	<835406.52484.qm@web29702.mail.ird.yahoo.com>
Message-ID: <AANLkTinLTQDngSfH5ooQOFGrCEWyQ-begHBc-aSus8gd@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101129/5ea2dc26/attachment.pl>

From lufile at 126.com  Tue Nov 30 08:13:37 2010
From: lufile at 126.com (lu)
Date: Tue, 30 Nov 2010 15:13:37 +0800 (CST)
Subject: [R-sig-Geo] How to make a SpatialGrid according to a polygon ?
In-Reply-To: <mailman.13.1291028403.4492.r-sig-geo@r-project.org>
References: <mailman.13.1291028403.4492.r-sig-geo@r-project.org>
Message-ID: <b9d59c.e476.12c9ba1240a.Coremail.lufile@126.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101130/83290287/attachment.pl>

From alobolistas at gmail.com  Tue Nov 30 08:48:04 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 30 Nov 2010 08:48:04 +0100
Subject: [R-sig-Geo] raster::crop
In-Reply-To: <AANLkTikZMHVaLACNA7j__rHaQ5Y2wKWxRbrMHonVDVsy@mail.gmail.com>
References: <AANLkTimoHMdp8yAqfp88X6f8k3PPKEAnfbOJJTieQ29r@mail.gmail.com>
	<AANLkTikZMHVaLACNA7j__rHaQ5Y2wKWxRbrMHonVDVsy@mail.gmail.com>
Message-ID: <AANLkTi=ASSABp5swDz5zmcASU-T-g6L8VrRSmhmVA+9K@mail.gmail.com>

Thanks,

and summarizing messages exchanged with Robert,

subs = bN3[1000:1100,1000:1100, drop=FALSE]

is the easiest, while

e<- extent(c (xFromCol(bN3, 1000), xFromCol(bN3, 1100), yFromRow(bN3,
1100), yFromRow(bN3, 1000)))
x<- crop(bN3, e)

is the fastest. And Robert plans a simplifies syntax for using extent
with row, cols in the future, i.e. like:
extent(x, 1000,1100,1000,1100)

Agus

2010/11/29 steven mosher <moshersteven at gmail.com>:
> ?you should be able to use xFromCol, yFromCol ?etc ?to get the coordinate
> for
> the extent you want to crop. or xyFromCell.
>
>
>
>
>
> On Sun, Nov 28, 2010 at 9:47 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>
>> Is it possible to crop a raster by selecting rows and cols? i.e. the
>> equivalent to
>>
>> subs = bN3[1000:1100,1000:1100]
>>
>> but subs should remain a raster (or a brick)
>> (crop seems to require geographic coordinates even if the raster is
>> projected)
>>
>> Thanks
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Tue Nov 30 08:52:37 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 30 Nov 2010 08:52:37 +0100 (CET)
Subject: [R-sig-Geo] How to make a SpatialGrid according to a polygon ?
In-Reply-To: <b9d59c.e476.12c9ba1240a.Coremail.lufile@126.com>
References: <mailman.13.1291028403.4492.r-sig-geo@r-project.org>
	<b9d59c.e476.12c9ba1240a.Coremail.lufile@126.com>
Message-ID: <alpine.LRH.2.00.1011300849030.21925@reclus.nhh.no>

On Tue, 30 Nov 2010, lu wrote:

> Hellow, I have a polygon and some points, and I want to use the krige 
> method to interpolate the polygon.The first step is to make a 
> SpatialGrid. But how to make a SpatialGrid which has the same figure as 
> the polygon?  Thanks!
> 	[[alternative HTML version deleted]]

Your choice of spsample(..., type="regular") in sp, then convert using 
gridded() and fullgrid(), or Sobj_SpatialGrid() in maptools. If you need 
precise control over the placing of the grid, use GridTopology() to 
construct it by hand before SpatialGrid, based on your choice of the south 
wset cell centre.

Roger

>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From moshersteven at gmail.com  Tue Nov 30 09:33:30 2010
From: moshersteven at gmail.com (steven mosher)
Date: Tue, 30 Nov 2010 00:33:30 -0800
Subject: [R-sig-Geo] raster::crop
In-Reply-To: <AANLkTi=ASSABp5swDz5zmcASU-T-g6L8VrRSmhmVA+9K@mail.gmail.com>
References: <AANLkTimoHMdp8yAqfp88X6f8k3PPKEAnfbOJJTieQ29r@mail.gmail.com>
	<AANLkTikZMHVaLACNA7j__rHaQ5Y2wKWxRbrMHonVDVsy@mail.gmail.com>
	<AANLkTi=ASSABp5swDz5zmcASU-T-g6L8VrRSmhmVA+9K@mail.gmail.com>
Message-ID: <AANLkTi=HCodCqq=6E6Ayi2pBG7EGTwmZxjt1e0xXvp-R@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101130/3f8c31cd/attachment.pl>

From giuseppe.amatulli at gmail.com  Tue Nov 30 09:38:52 2010
From: giuseppe.amatulli at gmail.com (Giuseppe Amatulli)
Date: Tue, 30 Nov 2010 09:38:52 +0100
Subject: [R-sig-Geo] geostatistic memory issue
In-Reply-To: <AANLkTi=uFpV2gJCTJviKJo5U9-JGkzf9Aj1oKqrwbOmT@mail.gmail.com>
References: <4CF43D47.30200@gmail.com>
	<AANLkTi=uFpV2gJCTJviKJo5U9-JGkzf9Aj1oKqrwbOmT@mail.gmail.com>
Message-ID: <AANLkTikbBVN_iG1dTsi-SCPKUdamTdG95dMN+P2DnpcA@mail.gmail.com>

Yes,
in almost all "prediction" command you can apply to a tiles grids, as
is suggested by Robert.

Anyway be sure that you are using all your 4 G. If you have 2
processor of 2 G, and you run R in a shell you will use only the 2 G
of one processor. In this case the  multicore/parallel packages can
help you.
A nice presentation you can find on http://geostat2010.info/node/421

Ciao
Giuseppe

On Tue, Nov 30, 2010 at 3:11 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Fernando,
>
> You can use the raster package for dealing with memory issues like this:
>
> library(fields)
> fit <- Krig(ozone$x, ozone$y, theta=20)
>
> library(raster)
> # create a target RasterLayer
> r <- raster(xmn=min(ozone$x), xmx=max(ozone$x), ymn=min(ozone$y),
> ymx=max(ozone$y))
> res(r) <- 1/6
> x <- interpolate(r, fit)
> plot(x)
> x
>
>
> in your case, that would be something like this:
> ...
> r <- raster(xmn=723604,xmx=724904,ymn=9661020,ymx=9662348)
> res(r) <- 4
> ...
>
> Robert
>
> On Mon, Nov 29, 2010 at 3:54 PM, Fernando Santo <fdbesanto at gmail.com> wrote:
>> Dear All,
>>
>> I am running a geostatistical analysis using the package "fields" of
>> n=980 and grid of approximately 1x1 km with 4 m of spatial resolution.
>> Because the fine grid resolution of 4 meters, which I really need for my
>> experiment, I am having problems with memory allocation. ?I am using an
>> OS linux 32 bit (i686-pc-linux-gnu) with 4 Gb of memory and 2 Gb of swap
>> and R version 2.12.0. ?Running the R command gc() in my computer, I have
>> the following:
>>
>> ?>gc()
>> ? ? ? ? ? ? used ? ? ? ?(Mb) ? gc ? ? ?trigger ? ? ?(Mb) ? ? ?max used
>> (Mb)
>> Ncells ? 147153 ? ? ?4.0 ? ? ? ? ? ? ?350000 ? ? ?9.4 ? ? ? ? ? 350000 ? 9.4
>> Vcells ? ?86617 ? ? ? 0.7 ? ? ? ? ? ? ?786432 ? ? ? 6.0
>> 434604 ? 3.4
>>
>> I tried to work around of my memory issue (?Memory) for Linux, start R
>> with the command *R --min-vsize=100M --max-vsize=3G --min-nsize=100M
>> --max-nsize=3G*, but still I did not saved the problem of memory
>> allocation. ?I know that the solution could be: (1) install a OS 64bits
>> or (2) reduce the spatial resolution of my grid (e.g. for 10x10 m).
>> However, I can not format my computer right now and I need a grid of 4 x
>> 4 m.
>>
>> I would like to ask you the following:
>> 1 - How I could increase the memory allocation of my linux? ?Is there
>> something wrong with my work around of memory allocation showed above?
>> 2 - Is possible to apply the use of the R package ?e.g. "bigmemory" in
>> my geostatistic script (please see bellow)? ?If yes, how it could be?
>> My problem is only in the last command of my script when I call the
>> function "predict" of fields.
>>
>> My script is bellow:
>>
>> Any help will be very welcome.
>> Thanks for your attention.
>> Fernando
>>
>> ###########################################
>> dat <- read.csv("/home/fernando/Desktop/data.csv")
>> library(fields)
>>
>> # set ?x-y ?coordinates of image, considering the center of each pixel
>> col_xcoord <- seq(723606,724902,by=4) ? ? ? ? # ?correct: 325
>> row_ycoord <- seq(9661022,9662346,by=4) ? # ?correct: 332
>> xmin = min(col_xcoord)
>> ymin = min(row_ycoord)
>> locs.x = col_xcoord-xmin
>> locs.y = row_ycoord-ymin
>> newlocs = expand.grid(locs.x,locs.y)
>>
>> locs = data.frame(dat$long-xmin,dat$lat-ymin) ?# adjusted location as
>> data frame
>> sqrt.gf = sqrt(dat$gap.frac) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? # The
>> response variable
>>
>> #################################################
>> # Produce the Kriging estimates using exponential variogram with scale
>> parameter 24.15
>> #################################################
>>
>> fit = Krig(locs,sqrt.gf,theta=24.15)
>> # I used the range parameter 24.15 estimated earlier
>>
>> summary(fit) # summary of fit
>>
>> # HERE I HAD THE ERROR OF MEMORY ALLOCATION
>> # "predict" the kriging values
>> krig.out = predict(fit,newlocs)
>> # Error: cannot allocate vector of size 806.7 Mb
>>
>> # This takes about 2 minutes on Mac of my friend
>> # but it did not work in my linux
>>
>>
>>
>>
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Tue Nov 30 11:36:22 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 30 Nov 2010 11:36:22 +0100
Subject: [R-sig-Geo] warning at creating SpatialPolygonsDataFrame and
 error at saving through rgdal
In-Reply-To: <AANLkTi=spvfTyKfc9P2erX_Lc31mnqks49oNFuu3gt-G@mail.gmail.com>
References: <AANLkTi=kZroPuo_iCfKYX_g+iBBz0MWYDtWgLX9HUgQh@mail.gmail.com>
	<alpine.LRH.2.00.1011291355450.18309@reclus.nhh.no>
	<AANLkTi=spvfTyKfc9P2erX_Lc31mnqks49oNFuu3gt-G@mail.gmail.com>
Message-ID: <AANLkTin9+k7qLerZ1UFubz6r9-t_JtEePxte9OVifyRe@mail.gmail.com>

The error in wirteOGR() was caused by the long names of the variables
in the table
of the SPDF object that were listed in the warnings. Fixed by renaming
some columns in the data slot to shorter names.

The error was not related to the warnings issued at creating the SPDF
object by my function,
those were easily fixed and are of no general interest (and of particular shame)

I wonder if the error  message in writeOGR() could be more
informative. Actually, I initially discarded the long names
as the cause of the error because, according to the warning messages,
those names had been automatically truncated.

Thanks!

Agus

2010/11/29 Agustin Lobo <alobolistas at gmail.com>:
> Roger,
>
> Please find enclosed the function and 3 files such as the ones that
> are processed. Please extract the zip
> into a folder named GLIS_scenes and indicate the path in the call to the
> function.
>
> The function is run just by:
>
> source("meta2sppol.R")
> HypAr <- meta2sppol(midir="../GLIS_scenes")
>
> What I try to do is read each file, extract the 4 pairs of coordinates
> and make a SPDF with the polygons and the data
> from the files.
>
> Thanks
>
> Agus
>
> 2010/11/29 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Mon, 29 Nov 2010, Agustin Lobo wrote:
>>
>>> Hi!
>>>
>>> I create a SPDF with a function
>>> HypNAr = meta2sppol()
>>>
>>> that ends up with:
>>>
>>> sitios <- 1:length(noms)
>>> row.names(datos) <- sitios
>>> SpatialPolygonsDataFrame(dummy, data=datos, match.ID = T)
>>>
>>> but get:
>>>
>>> Warning message:
>>> In data.row.names(row.names, rowsi, i) :
>>> ?some row.names duplicated: 2 --> row.names NOT used
>>
>> The message is coming from data.frame() in base package. Do
>>
>> debug(meta2sppol)
>> debug(data.frame)
>> HypNAr = meta2sppol()
>>
>> and see what happens inside the data.frame() call that creates datos, which
>> is where the warning is issued (it may be inside a coercion method call,
>> such as as.data.frame()); open:
>>
>> https://svn.r-project.org/R/trunk/src/library/base/R/dataframe.R
>>
>> and search for "some row.names duplicated".
>>
>> That is, the problem is in your own function. Please also note that
>> providing a reproducible example is crucial to getting precise assistance,
>> and usually the exercise of writing such an example reveals the cause, thus
>> solving the problem more quickly.
>>
>> Roger
>>
>>>
>>> I do not understand, as I define the row names as a sequence of
>>> integers, how can they be duplicated?
>>> I can plot the SPDF and the data slot is correct, but when I try to
>>> save as shapefile:
>>>
>>>> writeOGR(HypNAr,dsn="HypNAr",layer="HypNAr",driver="ESRI
>>>> Shapefile",verbose=T)
>>>
>>> Error in writeOGR(HypNAr, dsn = "HypNAr", layer = "HypNAr", driver =
>>> "ESRI Shapefile", ?:
>>>
>>> ? ? ? ?GDAL Error 1: Invalid index : -1
>>> Calls: writeOGR -> .Call
>>> In addition: There were 11 warnings (use warnings() to see them)
>>>
>>> Is this error related to the previous warning?
>>>
>>> Thanks!
>>>
>>> Agus
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From everton.emanuel at gmail.com  Tue Nov 30 13:14:36 2010
From: everton.emanuel at gmail.com (Everton Emanuel)
Date: Tue, 30 Nov 2010 10:14:36 -0200
Subject: [R-sig-Geo] How to draw a kernel surface map in R?
Message-ID: <AANLkTi=KojmgaV-1vsmW5XNxnd03tZF28wwkOSp5qsML@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101130/7baca36e/attachment.pl>

From r.hijmans at gmail.com  Tue Nov 30 18:34:32 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 30 Nov 2010 09:34:32 -0800
Subject: [R-sig-Geo] geostatistic memory issue
In-Reply-To: <AANLkTikbBVN_iG1dTsi-SCPKUdamTdG95dMN+P2DnpcA@mail.gmail.com>
References: <4CF43D47.30200@gmail.com>
	<AANLkTi=uFpV2gJCTJviKJo5U9-JGkzf9Aj1oKqrwbOmT@mail.gmail.com>
	<AANLkTikbBVN_iG1dTsi-SCPKUdamTdG95dMN+P2DnpcA@mail.gmail.com>
Message-ID: <AANLkTinuT4VpeTyMLC-KhPOng5haC-fGOP-pkgAuOFqj@mail.gmail.com>

On the multi-core topic: Matteo Matiuzzi and I have started building
multi-core processing into 'raster' functions. Only testing it with a
few functions right now. (see ?beginCluster in the R-Forge version of
raster). 'interpolate' or 'predict' do not have this capacity yet, but
they are very high on the to-do list. Robert

On Tue, Nov 30, 2010 at 12:38 AM, Giuseppe Amatulli
<giuseppe.amatulli at gmail.com> wrote:
> Yes,
> in almost all "prediction" command you can apply to a tiles grids, as
> is suggested by Robert.
>
> Anyway be sure that you are using all your 4 G. If you have 2
> processor of 2 G, and you run R in a shell you will use only the 2 G
> of one processor. In this case the ?multicore/parallel packages can
> help you.
> A nice presentation you can find on http://geostat2010.info/node/421
>
> Ciao
> Giuseppe
>
> On Tue, Nov 30, 2010 at 3:11 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
>> Fernando,
>>
>> You can use the raster package for dealing with memory issues like this:
>>
>> library(fields)
>> fit <- Krig(ozone$x, ozone$y, theta=20)
>>
>> library(raster)
>> # create a target RasterLayer
>> r <- raster(xmn=min(ozone$x), xmx=max(ozone$x), ymn=min(ozone$y),
>> ymx=max(ozone$y))
>> res(r) <- 1/6
>> x <- interpolate(r, fit)
>> plot(x)
>> x
>>
>>
>> in your case, that would be something like this:
>> ...
>> r <- raster(xmn=723604,xmx=724904,ymn=9661020,ymx=9662348)
>> res(r) <- 4
>> ...
>>
>> Robert
>>
>> On Mon, Nov 29, 2010 at 3:54 PM, Fernando Santo <fdbesanto at gmail.com> wrote:
>>> Dear All,
>>>
>>> I am running a geostatistical analysis using the package "fields" of
>>> n=980 and grid of approximately 1x1 km with 4 m of spatial resolution.
>>> Because the fine grid resolution of 4 meters, which I really need for my
>>> experiment, I am having problems with memory allocation. ?I am using an
>>> OS linux 32 bit (i686-pc-linux-gnu) with 4 Gb of memory and 2 Gb of swap
>>> and R version 2.12.0. ?Running the R command gc() in my computer, I have
>>> the following:
>>>
>>> ?>gc()
>>> ? ? ? ? ? ? used ? ? ? ?(Mb) ? gc ? ? ?trigger ? ? ?(Mb) ? ? ?max used
>>> (Mb)
>>> Ncells ? 147153 ? ? ?4.0 ? ? ? ? ? ? ?350000 ? ? ?9.4 ? ? ? ? ? 350000 ? 9.4
>>> Vcells ? ?86617 ? ? ? 0.7 ? ? ? ? ? ? ?786432 ? ? ? 6.0
>>> 434604 ? 3.4
>>>
>>> I tried to work around of my memory issue (?Memory) for Linux, start R
>>> with the command *R --min-vsize=100M --max-vsize=3G --min-nsize=100M
>>> --max-nsize=3G*, but still I did not saved the problem of memory
>>> allocation. ?I know that the solution could be: (1) install a OS 64bits
>>> or (2) reduce the spatial resolution of my grid (e.g. for 10x10 m).
>>> However, I can not format my computer right now and I need a grid of 4 x
>>> 4 m.
>>>
>>> I would like to ask you the following:
>>> 1 - How I could increase the memory allocation of my linux? ?Is there
>>> something wrong with my work around of memory allocation showed above?
>>> 2 - Is possible to apply the use of the R package ?e.g. "bigmemory" in
>>> my geostatistic script (please see bellow)? ?If yes, how it could be?
>>> My problem is only in the last command of my script when I call the
>>> function "predict" of fields.
>>>
>>> My script is bellow:
>>>
>>> Any help will be very welcome.
>>> Thanks for your attention.
>>> Fernando
>>>
>>> ###########################################
>>> dat <- read.csv("/home/fernando/Desktop/data.csv")
>>> library(fields)
>>>
>>> # set ?x-y ?coordinates of image, considering the center of each pixel
>>> col_xcoord <- seq(723606,724902,by=4) ? ? ? ? # ?correct: 325
>>> row_ycoord <- seq(9661022,9662346,by=4) ? # ?correct: 332
>>> xmin = min(col_xcoord)
>>> ymin = min(row_ycoord)
>>> locs.x = col_xcoord-xmin
>>> locs.y = row_ycoord-ymin
>>> newlocs = expand.grid(locs.x,locs.y)
>>>
>>> locs = data.frame(dat$long-xmin,dat$lat-ymin) ?# adjusted location as
>>> data frame
>>> sqrt.gf = sqrt(dat$gap.frac) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? # The
>>> response variable
>>>
>>> #################################################
>>> # Produce the Kriging estimates using exponential variogram with scale
>>> parameter 24.15
>>> #################################################
>>>
>>> fit = Krig(locs,sqrt.gf,theta=24.15)
>>> # I used the range parameter 24.15 estimated earlier
>>>
>>> summary(fit) # summary of fit
>>>
>>> # HERE I HAD THE ERROR OF MEMORY ALLOCATION
>>> # "predict" the kriging values
>>> krig.out = predict(fit,newlocs)
>>> # Error: cannot allocate vector of size 806.7 Mb
>>>
>>> # This takes about 2 minutes on Mac of my friend
>>> # but it did not work in my linux
>>>
>>>
>>>
>>>
>>>
>>> ? ? ? ?[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From burtonshank at gmail.com  Tue Nov 30 19:34:18 2010
From: burtonshank at gmail.com (Burton Shank)
Date: Tue, 30 Nov 2010 13:34:18 -0500
Subject: [R-sig-Geo] back-transforming lognormal kriging
Message-ID: <AANLkTin+Di__pndrBaqo8BkLhMGAKHmFaQ0+3U=16uE3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101130/eb8ffb60/attachment.pl>

From advaitgodbole at gmail.com  Tue Nov 30 19:37:48 2010
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Tue, 30 Nov 2010 13:37:48 -0500
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
Message-ID: <AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20101130/a395581e/attachment.pl>

From fdbesanto at gmail.com  Tue Nov 30 21:32:14 2010
From: fdbesanto at gmail.com (Fernando Santo)
Date: Tue, 30 Nov 2010 15:32:14 -0500
Subject: [R-sig-Geo]  geostatistic memory issue
In-Reply-To: <AANLkTi=uFpV2gJCTJviKJo5U9-JGkzf9Aj1oKqrwbOmT@mail.gmail.com>
References: <4CF43D47.30200@gmail.com>
	<AANLkTi=uFpV2gJCTJviKJo5U9-JGkzf9Aj1oKqrwbOmT@mail.gmail.com>
Message-ID: <4CF55F4E.8060102@gmail.com>

Dear Robert,

Thanks a lot for your attention.  I downloaded the raster package and 
manual.  I am still digesting all this information...
I just tried to do a quick adaptation in my code and it did not worked.  
I am doing something wrong...

Fernando

# read the data
dat <- read.csv("/home/fernando/Desktop/data.csv")

library(fields)

# I just left how as before to make the fitting between the range of x and y
col_xcoord <- seq(723606,724902,by=4)        #  correct: 325
row_ycoord <- seq(9661022,9662346,by=4)   #  correct: 332
xmin = min(col_xcoord)
ymin = min(row_ycoord)
locs.x = col_xcoord - xmin
locs.y = row_ycoord - ymin
newlocs = expand.grid(locs.x,locs.y)

locs = data.frame(dat$long-xmin,dat$lat-ymin)  # adjusted location as 
data frame
sqrt.gf = sqrt(dat$gap.frac)     # response variable

fit = Krig(locs,sqrt.gf,theta=24.15)

#####  then I used your suggestion
library(raster)
# create a target RasterLayer
r <- raster(xmn=723604,xmx=724904,ymn=9661020,ymx=9662348)
res(r) <- 4

# Sure It seems not correct....
x <- interpolate(r, fit)
Error in if (dataclasses != "try-error") { : argument is of length zero




> Fernando,
>
> You can use the raster package for dealing with memory issues like this:
>
> library(fields)
> fit<- Krig(ozone$x, ozone$y, theta=20)
>
> library(raster)
> # create a target RasterLayer
> r<- raster(xmn=min(ozone$x), xmx=max(ozone$x), ymn=min(ozone$y),
> ymx=max(ozone$y))
> res(r)<- 1/6
> x<- interpolate(r, fit)
> plot(x)
> x
>
>
> in your case, that would be something like this:
> ...
> r<- raster(xmn=723604,xmx=724904,ymn=9661020,ymx=9662348)
> res(r)<- 4
> ...
>
> Robert
>
> On Mon, Nov 29, 2010 at 3:54 PM, Fernando Santo<fdbesanto at gmail.com>  wrote:
>> Dear All,
>>
>> I am running a geostatistical analysis using the package "fields" of
>> n=980 and grid of approximately 1x1 km with 4 m of spatial resolution.
>> Because the fine grid resolution of 4 meters, which I really need for my
>> experiment, I am having problems with memory allocation.  I am using an
>> OS linux 32 bit (i686-pc-linux-gnu) with 4 Gb of memory and 2 Gb of swap
>> and R version 2.12.0.  Running the R command gc() in my computer, I have
>> the following:
>>
>>   >gc()
>>              used        (Mb)   gc      trigger      (Mb)      max used
>> (Mb)
>> Ncells   147153      4.0              350000      9.4           350000   9.4
>> Vcells    86617       0.7              786432       6.0
>> 434604   3.4
>>
>> I tried to work around of my memory issue (?Memory) for Linux, start R
>> with the command *R --min-vsize=100M --max-vsize=3G --min-nsize=100M
>> --max-nsize=3G*, but still I did not saved the problem of memory
>> allocation.  I know that the solution could be: (1) install a OS 64bits
>> or (2) reduce the spatial resolution of my grid (e.g. for 10x10 m).
>> However, I can not format my computer right now and I need a grid of 4 x
>> 4 m.
>>
>> I would like to ask you the following:
>> 1 - How I could increase the memory allocation of my linux?  Is there
>> something wrong with my work around of memory allocation showed above?
>> 2 - Is possible to apply the use of the R package  e.g. "bigmemory" in
>> my geostatistic script (please see bellow)?  If yes, how it could be?
>> My problem is only in the last command of my script when I call the
>> function "predict" of fields.
>>
>> My script is bellow:
>>
>> Any help will be very welcome.
>> Thanks for your attention.
>> Fernando
>>
>> ###########################################
>> dat<- read.csv("/home/fernando/Desktop/data.csv")
>> library(fields)
>>
>> # set  x-y  coordinates of image, considering the center of each pixel
>> col_xcoord<- seq(723606,724902,by=4)         #  correct: 325
>> row_ycoord<- seq(9661022,9662346,by=4)   #  correct: 332
>> xmin = min(col_xcoord)
>> ymin = min(row_ycoord)
>> locs.x = col_xcoord-xmin
>> locs.y = row_ycoord-ymin
>> newlocs = expand.grid(locs.x,locs.y)
>>
>> locs = data.frame(dat$long-xmin,dat$lat-ymin)  # adjusted location as
>> data frame
>> sqrt.gf = sqrt(dat$gap.frac)                                   # The
>> response variable
>>
>> #################################################
>> # Produce the Kriging estimates using exponential variogram with scale
>> parameter 24.15
>> #################################################
>>
>> fit = Krig(locs,sqrt.gf,theta=24.15)
>> # I used the range parameter 24.15 estimated earlier
>>
>> summary(fit) # summary of fit
>>
>> # HERE I HAD THE ERROR OF MEMORY ALLOCATION
>> # "predict" the kriging values
>> krig.out = predict(fit,newlocs)
>> # Error: cannot allocate vector of size 806.7 Mb
>>
>> # This takes about 2 minutes on Mac of my friend
>> # but it did not work in my linux
>>
>>
>>
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>


From mdsumner at gmail.com  Tue Nov 30 21:51:21 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 1 Dec 2010 07:51:21 +1100
Subject: [R-sig-Geo] How to draw a kernel surface map in R?
In-Reply-To: <AANLkTi=KojmgaV-1vsmW5XNxnd03tZF28wwkOSp5qsML@mail.gmail.com>
References: <AANLkTi=KojmgaV-1vsmW5XNxnd03tZF28wwkOSp5qsML@mail.gmail.com>
Message-ID: <AANLkTimrhcwStLA2-i+GYtHPGbB6vDeCHDEmuG9Zj7GY@mail.gmail.com>

See ?image, ?persp in the graphics package, ?levelplot and ?wireframe
in the lattice package, and ?surface3d in the rgdal package.

The sp package has methods for the graphics and lattice functions if
you use Spatial objects.

If you want functions for kernel density, see ?kde2d in MASS, and the
spatstat and KernSmooth packages.

Cheers, Mike.

On Tue, Nov 30, 2010 at 11:14 PM, Everton Emanuel
<everton.emanuel at gmail.com> wrote:
> Dear all,
>
> I am writing a paper for publication and I have problems to draw kernel
> surface maps in R. In the descriptive part of the paper I would like to
> place some thematic kernel surface maps, but I don't no how to do it. Is
> there a way to do with the traditional libraries like: spdep or maps?
>
> Kind regards,
> Everton.
> --
> Doctor and Research Scientist at the Centro de Desenvolvimento e
> Planejamento Regional-UFMG.
> Doutor e Pesquisador do Centro de Desenvolvimento e Planejamento
> Regional-UFMG.
> Doctor en onderzoeker van de Centro de Desenvolvimento e Planejamento
> Regional-UFMG.
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From fdbesanto at gmail.com  Tue Nov 30 21:53:58 2010
From: fdbesanto at gmail.com (Fernando Santo)
Date: Tue, 30 Nov 2010 15:53:58 -0500
Subject: [R-sig-Geo]  geostatistic memory issue
In-Reply-To: <AANLkTikbBVN_iG1dTsi-SCPKUdamTdG95dMN+P2DnpcA@mail.gmail.com>
References: <4CF43D47.30200@gmail.com>	<AANLkTi=uFpV2gJCTJviKJo5U9-JGkzf9Aj1oKqrwbOmT@mail.gmail.com>
	<AANLkTikbBVN_iG1dTsi-SCPKUdamTdG95dMN+P2DnpcA@mail.gmail.com>
Message-ID: <4CF56466.9010307@gmail.com>

Dear Giuseppe,

I am using 2 processor of 2 Gb.  I did not know about this problem.  Is 
there a way to allocate more memory in linux?  I believe that the answer 
is in R help ?Memory.  But I did not understand how to do it.  Starting 
R from the shell with R --min-vsize=100M --max-vsize=3G --min-nsize=100M 
--max-nsize=3G did not make difference...

Fernando
> Yes,
> in almost all "prediction" command you can apply to a tiles grids, as
> is suggested by Robert.
>
> Anyway be sure that you are using all your 4 G. If you have 2
> processor of 2 G, and you run R in a shell you will use only the 2 G
> of one processor. In this case the  multicore/parallel packages can
> help you.
> A nice presentation you can find on http://geostat2010.info/node/421
>
> Ciao
> Giuseppe
>
> On Tue, Nov 30, 2010 at 3:11 AM, Robert J. Hijmans<r.hijmans at gmail.com>  wrote:
>> Fernando,
>>
>> You can use the raster package for dealing with memory issues like this:
>>
>> library(fields)
>> fit<- Krig(ozone$x, ozone$y, theta=20)
>>
>> library(raster)
>> # create a target RasterLayer
>> r<- raster(xmn=min(ozone$x), xmx=max(ozone$x), ymn=min(ozone$y),
>> ymx=max(ozone$y))
>> res(r)<- 1/6
>> x<- interpolate(r, fit)
>> plot(x)
>> x
>>
>>
>> in your case, that would be something like this:
>> ...
>> r<- raster(xmn=723604,xmx=724904,ymn=9661020,ymx=9662348)
>> res(r)<- 4
>> ...
>>
>> Robert
>>
>> On Mon, Nov 29, 2010 at 3:54 PM, Fernando Santo<fdbesanto at gmail.com>  wrote:
>>> Dear All,
>>>
>>> I am running a geostatistical analysis using the package "fields" of
>>> n=980 and grid of approximately 1x1 km with 4 m of spatial resolution.
>>> Because the fine grid resolution of 4 meters, which I really need for my
>>> experiment, I am having problems with memory allocation.  I am using an
>>> OS linux 32 bit (i686-pc-linux-gnu) with 4 Gb of memory and 2 Gb of swap
>>> and R version 2.12.0.  Running the R command gc() in my computer, I have
>>> the following:
>>>
>>>   >gc()
>>>              used        (Mb)   gc      trigger      (Mb)      max used
>>> (Mb)
>>> Ncells   147153      4.0              350000      9.4           350000   9.4
>>> Vcells    86617       0.7              786432       6.0
>>> 434604   3.4
>>>
>>> I tried to work around of my memory issue (?Memory) for Linux, start R
>>> with the command *R --min-vsize=100M --max-vsize=3G --min-nsize=100M
>>> --max-nsize=3G*, but still I did not saved the problem of memory
>>> allocation.  I know that the solution could be: (1) install a OS 64bits
>>> or (2) reduce the spatial resolution of my grid (e.g. for 10x10 m).
>>> However, I can not format my computer right now and I need a grid of 4 x
>>> 4 m.
>>>
>>> I would like to ask you the following:
>>> 1 - How I could increase the memory allocation of my linux?  Is there
>>> something wrong with my work around of memory allocation showed above?
>>> 2 - Is possible to apply the use of the R package  e.g. "bigmemory" in
>>> my geostatistic script (please see bellow)?  If yes, how it could be?
>>> My problem is only in the last command of my script when I call the
>>> function "predict" of fields.
>>>
>>> My script is bellow:
>>>
>>> Any help will be very welcome.
>>> Thanks for your attention.
>>> Fernando
>>>
>>> ###########################################
>>> dat<- read.csv("/home/fernando/Desktop/data.csv")
>>> library(fields)
>>>
>>> # set  x-y  coordinates of image, considering the center of each pixel
>>> col_xcoord<- seq(723606,724902,by=4)         #  correct: 325
>>> row_ycoord<- seq(9661022,9662346,by=4)   #  correct: 332
>>> xmin = min(col_xcoord)
>>> ymin = min(row_ycoord)
>>> locs.x = col_xcoord-xmin
>>> locs.y = row_ycoord-ymin
>>> newlocs = expand.grid(locs.x,locs.y)
>>>
>>> locs = data.frame(dat$long-xmin,dat$lat-ymin)  # adjusted location as
>>> data frame
>>> sqrt.gf = sqrt(dat$gap.frac)                                   # The
>>> response variable
>>>
>>> #################################################
>>> # Produce the Kriging estimates using exponential variogram with scale
>>> parameter 24.15
>>> #################################################
>>>
>>> fit = Krig(locs,sqrt.gf,theta=24.15)
>>> # I used the range parameter 24.15 estimated earlier
>>>
>>> summary(fit) # summary of fit
>>>
>>> # HERE I HAD THE ERROR OF MEMORY ALLOCATION
>>> # "predict" the kriging values
>>> krig.out = predict(fit,newlocs)
>>> # Error: cannot allocate vector of size 806.7 Mb
>>>
>>> # This takes about 2 minutes on Mac of my friend
>>> # but it did not work in my linux
>>>
>>>
>>>
>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Tue Nov 30 22:17:35 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 30 Nov 2010 13:17:35 -0800
Subject: [R-sig-Geo] geostatistic memory issue
In-Reply-To: <4CF55F4E.8060102@gmail.com>
References: <4CF43D47.30200@gmail.com>
	<AANLkTi=uFpV2gJCTJviKJo5U9-JGkzf9Aj1oKqrwbOmT@mail.gmail.com>
	<4CF55F4E.8060102@gmail.com>
Message-ID: <AANLkTikEnFhcz7rCHChWOpy9giOfW6jnze6R=0DadZ43@mail.gmail.com>

Oops, that has been fixed on r-forge, but not CRAN. Please try to
install from here (you need the latest version of R for that)  like
this:

install.packages("raster", repos="http://R-Forge.R-project.org")

I will update to CRAN this week.

Robert

On Tue, Nov 30, 2010 at 12:32 PM, Fernando Santo <fdbesanto at gmail.com> wrote:
> Dear Robert,
>
> Thanks a lot for your attention. ?I downloaded the raster package and
> manual. ?I am still digesting all this information...
> I just tried to do a quick adaptation in my code and it did not worked. ?I
> am doing something wrong...
>
> Fernando
>
> # read the data
> dat <- read.csv("/home/fernando/Desktop/data.csv")
>
> library(fields)
>
> # I just left how as before to make the fitting between the range of x and y
> col_xcoord <- seq(723606,724902,by=4) ? ? ? ?# ?correct: 325
> row_ycoord <- seq(9661022,9662346,by=4) ? # ?correct: 332
> xmin = min(col_xcoord)
> ymin = min(row_ycoord)
> locs.x = col_xcoord - xmin
> locs.y = row_ycoord - ymin
> newlocs = expand.grid(locs.x,locs.y)
>
> locs = data.frame(dat$long-xmin,dat$lat-ymin) ?# adjusted location as data
> frame
> sqrt.gf = sqrt(dat$gap.frac) ? ? # response variable
>
> fit = Krig(locs,sqrt.gf,theta=24.15)
>
> ##### ?then I used your suggestion
> library(raster)
> # create a target RasterLayer
> r <- raster(xmn=723604,xmx=724904,ymn=9661020,ymx=9662348)
> res(r) <- 4
>
> # Sure It seems not correct....
> x <- interpolate(r, fit)
> Error in if (dataclasses != "try-error") { : argument is of length zero
>
>
>
>
>> Fernando,
>>
>> You can use the raster package for dealing with memory issues like this:
>>
>> library(fields)
>> fit<- Krig(ozone$x, ozone$y, theta=20)
>>
>> library(raster)
>> # create a target RasterLayer
>> r<- raster(xmn=min(ozone$x), xmx=max(ozone$x), ymn=min(ozone$y),
>> ymx=max(ozone$y))
>> res(r)<- 1/6
>> x<- interpolate(r, fit)
>> plot(x)
>> x
>>
>>
>> in your case, that would be something like this:
>> ...
>> r<- raster(xmn=723604,xmx=724904,ymn=9661020,ymx=9662348)
>> res(r)<- 4
>> ...
>>
>> Robert
>>
>> On Mon, Nov 29, 2010 at 3:54 PM, Fernando Santo<fdbesanto at gmail.com>
>> ?wrote:
>>>
>>> Dear All,
>>>
>>> I am running a geostatistical analysis using the package "fields" of
>>> n=980 and grid of approximately 1x1 km with 4 m of spatial resolution.
>>> Because the fine grid resolution of 4 meters, which I really need for my
>>> experiment, I am having problems with memory allocation. ?I am using an
>>> OS linux 32 bit (i686-pc-linux-gnu) with 4 Gb of memory and 2 Gb of swap
>>> and R version 2.12.0. ?Running the R command gc() in my computer, I have
>>> the following:
>>>
>>> ?>gc()
>>> ? ? ? ? ? ? used ? ? ? ?(Mb) ? gc ? ? ?trigger ? ? ?(Mb) ? ? ?max used
>>> (Mb)
>>> Ncells ? 147153 ? ? ?4.0 ? ? ? ? ? ? ?350000 ? ? ?9.4 ? ? ? ? ? 350000
>>> 9.4
>>> Vcells ? ?86617 ? ? ? 0.7 ? ? ? ? ? ? ?786432 ? ? ? 6.0
>>> 434604 ? 3.4
>>>
>>> I tried to work around of my memory issue (?Memory) for Linux, start R
>>> with the command *R --min-vsize=100M --max-vsize=3G --min-nsize=100M
>>> --max-nsize=3G*, but still I did not saved the problem of memory
>>> allocation. ?I know that the solution could be: (1) install a OS 64bits
>>> or (2) reduce the spatial resolution of my grid (e.g. for 10x10 m).
>>> However, I can not format my computer right now and I need a grid of 4 x
>>> 4 m.
>>>
>>> I would like to ask you the following:
>>> 1 - How I could increase the memory allocation of my linux? ?Is there
>>> something wrong with my work around of memory allocation showed above?
>>> 2 - Is possible to apply the use of the R package ?e.g. "bigmemory" in
>>> my geostatistic script (please see bellow)? ?If yes, how it could be?
>>> My problem is only in the last command of my script when I call the
>>> function "predict" of fields.
>>>
>>> My script is bellow:
>>>
>>> Any help will be very welcome.
>>> Thanks for your attention.
>>> Fernando
>>>
>>> ###########################################
>>> dat<- read.csv("/home/fernando/Desktop/data.csv")
>>> library(fields)
>>>
>>> # set ?x-y ?coordinates of image, considering the center of each pixel
>>> col_xcoord<- seq(723606,724902,by=4) ? ? ? ? # ?correct: 325
>>> row_ycoord<- seq(9661022,9662346,by=4) ? # ?correct: 332
>>> xmin = min(col_xcoord)
>>> ymin = min(row_ycoord)
>>> locs.x = col_xcoord-xmin
>>> locs.y = row_ycoord-ymin
>>> newlocs = expand.grid(locs.x,locs.y)
>>>
>>> locs = data.frame(dat$long-xmin,dat$lat-ymin) ?# adjusted location as
>>> data frame
>>> sqrt.gf = sqrt(dat$gap.frac) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? # The
>>> response variable
>>>
>>> #################################################
>>> # Produce the Kriging estimates using exponential variogram with scale
>>> parameter 24.15
>>> #################################################
>>>
>>> fit = Krig(locs,sqrt.gf,theta=24.15)
>>> # I used the range parameter 24.15 estimated earlier
>>>
>>> summary(fit) # summary of fit
>>>
>>> # HERE I HAD THE ERROR OF MEMORY ALLOCATION
>>> # "predict" the kriging values
>>> krig.out = predict(fit,newlocs)
>>> # Error: cannot allocate vector of size 806.7 Mb
>>>
>>> # This takes about 2 minutes on Mac of my friend
>>> # but it did not work in my linux
>>>
>>>
>>>
>>>
>>>
>>> ? ? ? ?[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>
>


From r.hijmans at gmail.com  Tue Nov 30 23:18:27 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 30 Nov 2010 14:18:27 -0800
Subject: [R-sig-Geo] gridded time series analysis
In-Reply-To: <AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
References: <AANLkTimTdxzoDCfJQOB8bgQRhjLy3YzSbtGtMdijk9sQ@mail.gmail.com>
	<771411.8321.qm@web29709.mail.ird.yahoo.com>
	<AANLkTin2DYocWNOAR-LfGoBP4+gCtA7eVDHmoaQ6wriR@mail.gmail.com>
	<AANLkTimFw1zMH75s+TG+SFkBHfXzpURm2WXskAa8Kp=m@mail.gmail.com>
	<AANLkTim9dBnVkZ0tjvoa1YRpPRr156jJ9zcezMDrtzhX@mail.gmail.com>
	<AANLkTi=vW6NXYXKGNa0gcTfZ8ezEjvegdxU3Dt5SPA4F@mail.gmail.com>
	<AANLkTikqNmC62Pv-n9Dxd1w7fTHJPx8cR72U6YEtWMTV@mail.gmail.com>
	<AANLkTikQsL9opzu1i0mWxtJA6YmcgBbGdbihXFOwPRho@mail.gmail.com>
	<AANLkTinY5+3JbpZfWnriDZNOdmcfic0628Qi0=NDZghK@mail.gmail.com>
Message-ID: <AANLkTikd-PJKWZdWUL2+S9VYAq1QJ4LPwG2==erEs2+Q@mail.gmail.com>

Advait,

The is an error in the file, I think, see below:

> library(ncdf)
> filename = "c:/downloads/regcm.cumul.hdd.10k.96_05.new.nc"
> nc <- open.ncdf(filename)
>
> zvar <- 'hdd'
> nc$var[[zvar]]$dim[[1]]$len
[1] 507
> nc$var[[zvar]]$dim[[2]]$len
[1] 356
>
> xx <- nc$var[[zvar]]$dim[[1]]$vals
> # should be a vector of 507 longitudes but:
> dim(xx)
[1] 507 356 120
>
> # works anyway
> xrange <- c(min(xx), max(xx))
> xrange
[1] -137.25705  -62.18677
>
> yy <- nc$var[[zvar]]$dim[[2]]$vals
> # should be a vector of 356 latitudes but:
> dim(yy)
[1] 507 356 120
>
> # this fails
> yrange <- c(min(yy), max(yy))
> yrange
[1] NaN NaN
> # and that is the only reason why raster failed.
>
> #OK
> yy[,,1][1:10,350:355]
          [,1]     [,2]     [,3]     [,4]     [,5]     [,6]
 [1,] 51.49148 51.57122 51.65092 51.73055 51.81014 51.88967
 [2,] 51.52888 51.60866 51.68839 51.76807 51.84769 51.92727
 [3,] 51.56616 51.64598 51.72575 51.80547 51.88513 51.96474
 [4,] 51.60332 51.68318 51.76299 51.84275 51.92245 52.00210
 [5,] 51.64036 51.72026 51.80011 51.87991 51.95965 52.03934
 [6,] 51.67728 51.75722 51.83711 51.91695 51.99673 52.07646
 [7,] 51.71409 51.79407 51.87399 51.95387 52.03369 52.11345
 [8,] 51.75077 51.83079 51.91076 51.99067 52.07053 52.15033
 [9,] 51.78734 51.86739 51.94740 52.02735 52.10725 52.18709
[10,] 51.82378 51.90388 51.98392 52.06391 52.14385 52.22373
>
> #bad values here (and note the NaN):
> yy[,,120][1:10,350:355]
                [,1]           [,2]           [,3]           [,4]
     [,5]           [,6]
 [1,] -1.313847e-229 -4.895880e-272 -7.553765e-266   1.293814e+58
9.551441e-293  -3.291580e-36
 [2,] -5.321424e+272 -3.076997e-223  -1.515780e-33 -9.895836e+171
3.115686e-149  -4.970539e+92
 [3,]  5.259277e-203   5.980335e-56  2.893449e-212  2.974200e+274
3.186547e-218  2.503689e+296
 [4,] -3.977129e+225 -3.696719e-283   1.284612e+42   1.887923e+28
-2.322520e+268  5.005820e-108
 [5,]  -6.569744e+88   1.824506e-74   7.663356e+39  1.608759e-201
-1.433761e+110 -8.804183e-211
 [6,] -4.237822e-162            NaN  7.405904e-275  5.859877e-258
1.339820e+110  1.631993e+229
 [7,]   5.603325e-64   4.188764e+37 -2.188887e+243 -4.657907e+280
1.795268e-185  1.166057e-175
 [8,] -2.112804e-229  4.536625e+137  2.910322e-278  4.407645e-274
8.886205e-239 -1.913860e+238
 [9,]  -9.126350e+44 -1.866422e+177 -2.578975e+256  3.275379e+208
-2.657457e+75  -1.258259e-90
[10,]  6.698325e+216 -2.958355e+137 -1.058748e-178 -1.776776e+215
-6.368807e+78 -5.337653e+299
>
> # this would have worked
> yrange <- c(min(yy[,,1]), max(yy[,,1]))
> yrange
[1] 22.17641 57.31006
>
> close.ncdf(nc)


Best, Robert


On Tue, Nov 30, 2010 at 10:37 AM, Advait Godbole
<advaitgodbole at gmail.com> wrote:
> Dear Robert,
> here is the link to the file:
> http://dl.dropbox.com/u/4030944/regcm.cumul.hdd.10k.96_05.new.nc. It is a
> large file ~400 MB. Let me know if dropbox is not convenient and you would
> rather do ftp - ?but our machines are down for maintenance and I may not be
> immediately able to get access.
> I was going over the NCL code that processes the files but did not find
> anything glaringly amiss, so I will have to look at it in greater detail
> since it is clear that the number of entries in the variables is not right
> as you've pointed out.?There is a chance that I have not written out the
> co-ordinates properly.
> Thanks,
> Advait
> On Mon, Nov 29, 2010 at 1:14 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> Advait,
>> I do not think I can help you further unless you send me your file;
>> but this suggests that it is either not following the CF standards, or
>> something is wrong with the file, or that there is something I have
>> not understood about these files.
>> You said you have 507 x 356 x 120 values. I would expect
>> length(frcm$dim[[1]]$vals) == 507 and length(frcm$dim[[2]]$vals) ==
>> 356
>> Robert
>>
>> On Mon, Nov 29, 2010 at 6:11 AM, Advait Godbole <advaitgodbole at gmail.com>
>> wrote:
>> > sorry to disrupt the flow of the conversation, but after doing what
>> > Robert
>> > suggested, this is what was returned:
>> >> length(frcm$dim[[1]]$vals)
>> > [1] 21659040
>> >> length(frcm$dim[[2]]$vals)
>> > [1] 21659040
>> > the other two functions return the latitude and longitude arrays not
>> > populated with NAs/missing values. I havent reproduced them here because
>> > of
>> > their number.
>> > Regards,
>> > advait
>> > On Sat, Nov 27, 2010 at 3:48 PM, Robert J. Hijmans <r.hijmans at gmail.com>
>> > wrote:
>> >>
>> >> Advait,
>> >>
>> >> That suggests that you have missing values in the lon or lat
>> >> dimensions. Is that true? That would be awkward, but perhaps something
>> >> else is going on. Can you send me your file? If not can you send the
>> >> results of this:
>> >>
>> >> filename <- "regcm.cumul.hdd.10k.96_05.new.nc"
>> >> nc <- open.ncdf(filename)
>> >> length(nc$dim[[1]]$vals)
>> >> length(nc$dim[[2]]$vals)
>> >> nc$dim[[1]]$vals
>> >> nc$dim[[2]]$vals
>> >> close.ncdf(nc)
>> >>
>> >> Thanks, Robert
>> >>
>> >> On Sat, Nov 27, 2010 at 8:36 AM, Advait Godbole
>> >> <advaitgodbole at gmail.com>
>> >> wrote:
>> >> > Thanks everyone for these leads..However, I am running into problems
>> >> > with
>> >> > data handling. I used ncdf to extract the two variables (507 x 356 x
>> >> > 120
>> >> > -
>> >> > lon,lat,time) and converted them into array objects. The suggestions
>> >> > provided all utilize the raster package, but using "brick" on the
>> >> > file
>> >> > returns this error: "rcmraster <-
>> >> > brick("regcm.cumul.hdd.10k.96_05.new.nc")
>> >> > Error in if (e at xmin > -400 & e at xmax < 400 & e at ymin > -90.1 & e at ymax <
>> >> > ?:
>> >> > missing value where TRUE/FALSE needed"
>> >> >
>> >> > I have a fair number of NAs (all missing values in the original
>> >> > variables).
>> >> > Is there a way to set a flag for that? Or any other workaround?
>> >> > Thanks much,
>> >> > advait
>> >> > On Fri, Nov 26, 2010 at 6:25 PM, Robert J. Hijmans
>> >> > <r.hijmans at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> There are some difference in the behavior of 'calc' between
>> >> >> functions,
>> >> >> because of attempts to accommodate different functions & intentions.
>> >> >> But in 'raster' 1.7-4 (available from R-Forge in ~ 24 hrs; and from
>> >> >> CRAN soon), the below will work:
>> >> >>
>> >> >> library(raster)
>> >> >> #creating some data
>> >> >> r <- raster(nrow=10, ncol=10)
>> >> >> s1 <- s2<- list()
>> >> >> for (i in 1:12) {
>> >> >> ? ? ? ?s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> >> >> ? ? ? ?s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>> >> >> }
>> >> >> s1 <- stack(s1)
>> >> >> s2 <- stack(s2)
>> >> >>
>> >> >> # regression of values in one brick (or stack) with another (Jacob's
>> >> >> suggestion)
>> >> >> s <- stack(s1, s2)
>> >> >> # s1 and s2 have 12 layers
>> >> >> fun <- function(x) { lm(x[1:12] ~ x[13:24])$coefficients[2] }
>> >> >> x1 <- calc(s, fun)
>> >> >>
>> >> >> # regression of values in one brick (or stack) with 'time'
>> >> >> time <- 1:nlayers(s)
>> >> >> fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> >> >> x2 <- calc(s, fun)
>> >> >>
>> >> >> # get multiple layers, e.g. the slope _and_ intercept
>> >> >> fun <- function(x) { lm(x ~ time)$coefficients }
>> >> >> x3 <- calc(s, fun)
>> >> >>
>> >> >> If this does not work in your version, you can use apply( ) as in
>> >> >> what
>> >> >> I send earlier.
>> >> >>
>> >> >> Robert
>> >> >>
>> >> >> On Fri, Nov 26, 2010 at 2:56 PM, Robert J. Hijmans
>> >> >> <r.hijmans at gmail.com>
>> >> >> wrote:
>> >> >> > It seems that 'calc' does not like this (any more; another thing
>> >> >> > to
>> >> >> > fix) . If your rasters are not very large you can use apply, which
>> >> >> > makes it much faster:
>> >> >> >
>> >> >> > library(raster)
>> >> >> > #creating some data
>> >> >> > r <- raster(nrow=10, ncol=10)
>> >> >> > s <- list()
>> >> >> > for (i in 1:25) { s[i] <- setValues(r, rnorm(ncell(r), i, 3) ) }
>> >> >> > s <- stack(s)
>> >> >> >
>> >> >> > # regression
>> >> >> > time <- 1:nlayers(s)
>> >> >> > fun <- function(x) { lm(x ~ time)$coefficients[2] }
>> >> >> > r[] <- apply(getValues(s), 1, fun)
>> >> >> >
>> >> >> > Robert
>> >> >> >
>> >> >> >
>> >> >> >
>> >> >> > On Fri, Nov 26, 2010 at 2:51 PM, Jacob van Etten
>> >> >> > <jacobvanetten at yahoo.com> wrote:
>> >> >> >> you could try this approach (use calc whenever you can):
>> >> >> >>
>> >> >> >> (supposing your bricks have 12 layers)
>> >> >> >>
>> >> >> >> br3 <- stack(brick1, brick2)
>> >> >> >> lmS <- function(x) lm(x[1:12] ~ x[13:24)$coefficients[2]
>> >> >> >> r <- calc(br3, lmS)
>> >> >> >>
>> >> >> >> Jacob.
>> >> >> >>
>> >> >> >> --- On Fri, 26/11/10, steven mosher <moshersteven at gmail.com>
>> >> >> >> wrote:
>> >> >> >>
>> >> >> >> From: steven mosher <moshersteven at gmail.com>
>> >> >> >> Subject: Re: [R-sig-Geo] gridded time series analysis
>> >> >> >> To: "Martin" <martin_brandt at gmx.net>
>> >> >> >> Cc: r-sig-geo at stat.math.ethz.ch
>> >> >> >> Date: Friday, 26 November, 2010, 23:33
>> >> >> >>
>> >> >> >> that's cool, I'm also interested in a similar problem but just
>> >> >> >> with
>> >> >> >> one
>> >> >> >> brick ending up with a slope raster as the output. It may be
>> >> >> >> possible
>> >> >> >> with
>> >> >> >> stackApply(). have a look. or maybe robert will chime in
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >> On Fri, Nov 26, 2010 at 1:35 PM, Martin <martin_brandt at gmx.net>
>> >> >> >> wrote:
>> >> >> >>
>> >> >> >>>
>> >> >> >>> this is what I did to perform a regression between two bricks
>> >> >> >>> (each
>> >> >> >>> brick
>> >> >> >>> represent a time series):
>> >> >> >>>
>> >> >> >>> r <- raster(brick1)
>> >> >> >>> for (i in 1:ncell(r)) {
>> >> >> >>> r[i] = lm(as.ts(cellValues(brick1, i)) ~
>> >> >> >>> as.ts(cellValues(brick2,
>> >> >> >>> i)))$coefficients[2]
>> >> >> >>> }
>> >> >> >>>
>> >> >> >>> The result will be a slope raster, but it really takes a lot of
>> >> >> >>> time,
>> >> >> >>> so
>> >> >> >>> maybe there is a better solution..
>> >> >> >>>
>> >> >> >>>
>> >> >> >>> --
>> >> >> >>> View this message in context:
>> >> >> >>>
>> >> >> >>>
>> >> >> >>>
>> >> >> >>> http://r-sig-geo.2731867.n2.nabble.com/gridded-time-series-analysis-tp5775651p5778472.html
>> >> >> >>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>> >> >> >>>
>> >> >> >>> _______________________________________________
>> >> >> >>> R-sig-Geo mailing list
>> >> >> >>> R-sig-Geo at stat.math.ethz.ch
>> >> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >>>
>> >> >> >>
>> >> >> >> ??? [[alternative HTML version deleted]]
>> >> >> >>
>> >> >> >> _______________________________________________
>> >> >> >> R-sig-Geo mailing list
>> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >> ? ? ? ?[[alternative HTML version deleted]]
>> >> >> >>
>> >> >> >>
>> >> >> >> _______________________________________________
>> >> >> >> R-sig-Geo mailing list
>> >> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >> >>
>> >> >> >>
>> >> >> >
>> >> >>
>> >> >> _______________________________________________
>> >> >> R-sig-Geo mailing list
>> >> >> R-sig-Geo at stat.math.ethz.ch
>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >
>> >> >
>> >> >
>> >> > --
>> >> > advait godbole
>> >> >
>> >
>> >
>> >
>> > --
>> > advait godbole
>> >
>
>
>
> --
> advait godbole
>


