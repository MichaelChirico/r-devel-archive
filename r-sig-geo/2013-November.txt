From r.turner at auckland.ac.nz  Fri Nov  1 00:48:45 2013
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Fri, 1 Nov 2013 12:48:45 +1300
Subject: [R-sig-Geo] Dilation and Window Definition in Spatstat
In-Reply-To: <CAJgfpiisTFKJ3dKZ8udqi+nyTa-gO7=RNpLpECQw4PMNeg2Ahg@mail.gmail.com>
References: <CAJgfpiisTFKJ3dKZ8udqi+nyTa-gO7=RNpLpECQw4PMNeg2Ahg@mail.gmail.com>
Message-ID: <5272EC5D.3040802@auckland.ac.nz>


It is hard to tell without reproducible code, but I suspect (since you 
use the word
"dilate") that you have used the function dilation() and are not getting 
the window
that you think you are getting.  Try:

     W <- owin(poly=as.owin(demopat)$bdry[[1]])
     WD <- dilation(W,100)
     set.seed(42)
     X <- runifpoint(100,WD)
     plot(X)

and you will see what I mean.

You *probably* want to use expand.owin().

     cheers,

     Rolf Turner

On 11/01/13 04:40, Ted Rosenbaum wrote:
> I am using spatstat version 1.34-0 and the pop command is not correctly
> recognizing the interior of a window after I use the dilation command on a
> polygon (i.e., non rectanglular window).
>
> I have window that is a convex hull of the lower 48 states.  I have a set
> of points that are county centroids.  When I make a point pattern (pop)
> using that window, I get expected results (all points, except for some that
> are on a boundary are in the window).  In order to expand the window to
> include those points, I dilate the window with the convex hull by a small
> amount.  After the dilation, I make a point pattern and am informed that
> only one point remains in the window.  Since, as far as I understand it, a
> dilation should only expand the set of points in the window, this should
> not happen.
>
> I apologize for not providing replicable code, but I was having trouble
> creating a polygon to replicate the issue.  If someone needs code to help
> troubleshoot, I can email you some files with code offline.


From adrian.baddeley at uwa.edu.au  Fri Nov  1 02:13:34 2013
From: adrian.baddeley at uwa.edu.au (Adrian Baddeley)
Date: Fri, 1 Nov 2013 09:13:34 +0800
Subject: [R-sig-Geo] Dilation and Window Definition in Spatstat
In-Reply-To: <5272EC5D.3040802@auckland.ac.nz>
References: <CAJgfpiisTFKJ3dKZ8udqi+nyTa-gO7=RNpLpECQw4PMNeg2Ahg@mail.gmail.com>,
	<5272EC5D.3040802@auckland.ac.nz>
Message-ID: <1CEF56CFF7118748AE0FA6C0186D3A312ECDB024@IS-WIN-172.staffad.uwa.edu.au>

In spatstat 1.34-0 there appears to be a bug in union.owin which also affects dilation.owin.

A fix will be distributed shortly.

Until this is fixed, the fastest way to do what you want is to convert the window
 to a pixel mask (using as.mask) before applying the dilation.

Adrian Baddeley 

Prof Adrian Baddeley FAA
University of Western Australia  /and/ CSIRO Mathematics, Informatics & Statistics
Mail: <cet.uwa.edu.au>             Skype: adrian.baddeley
________________________________________

On 11/01/13 04:40, Ted Rosenbaum wrote:
> I am using spatstat version 1.34-0 and the pop command is not correctly
> recognizing the interior of a window after I use the dilation command on a
> polygon (i.e., non rectanglular window).
>
> I have window that is a convex hull of the lower 48 states.  I have a set
> of points that are county centroids.  When I make a point pattern (pop)
> using that window, I get expected results (all points, except for some that
> are on a boundary are in the window).  In order to expand the window to
> include those points, I dilate the window with the convex hull by a small
> amount.  After the dilation, I make a point pattern and am informed that
> only one point remains in the window.  Since, as far as I understand it, a
> dilation should only expand the set of points in the window, this should
> not happen.
>
> I apologize for not providing replicable code, but I was having trouble
> creating a polygon to replicate the issue.  If someone needs code to help
> troubleshoot, I can email you some files with code offline.


From npt_eng at hotmail.com  Fri Nov  1 09:04:57 2013
From: npt_eng at hotmail.com (netra)
Date: Fri, 1 Nov 2013 01:04:57 -0700 (PDT)
Subject: [R-sig-Geo] raster interpolation within shape file
In-Reply-To: <CAGFWpksOdONx9eE6FH711mw-tVSg5Ak0kV=c924+mCs0NoJfVg@mail.gmail.com>
References: <1383227955294-7585003.post@n2.nabble.com>
	<CAGFWpksOdONx9eE6FH711mw-tVSg5Ak0kV=c924+mCs0NoJfVg@mail.gmail.com>
Message-ID: <1383293097039-7585011.post@n2.nabble.com>

Hello Pablo I am fine thanks,

I am bit confuse "interpolation <- interpolate(observations=xyz, # I think
you have to rename 
your "z" field to "value" " in your answer observations =xyz, but it must be
raster isnot it? it complains 

"Error in (function (classes, fdef, mtable)  : 
  unable to find an inherited method for function 'interpolate' for
signature '"data.frame"'.
Netra





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-interpolation-within-shape-file-tp7585003p7585011.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Fri Nov  1 09:41:18 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 1 Nov 2013 09:41:18 +0100
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>

On Mon, 28 Oct 2013, Oliver Soong wrote:

> I've had a long standing struggle with GDAL.close on Windows, and I
> think I might finally have found a fix.  I'm currently running rgdal
> 0.8.11, R 3.0.2, and 32-bit Windows 7.
>
> Currently, writeRaster and writeGDAL create temporary files in the
> tempdir() folder (the final filename prefixed with 3 random [a-z]
> letters).  On my system, these files get left open and orphaned.  When
> doing heavy processing, this can lead to the drive hosting the
> tempdir() folder to become full, even if the data is being ultimately
> written to a much larger drive.  This also means that R cannot clean
> up these files or the tempdir() folder when it closes, causing similar
> bloat in my %TEMP%.
>
> I haven't tested this on other platforms, but I think it might help to
> insert an extra line into GDAL.close:
>
> .setCollectorFun(slot(dataset, "handle"), NULL)
> .Call("RGDAL_CloseHandle", dataset at handle, PACKAGE = "rgdal")
> .Call("RGDAL_CloseDataset", dataset, PACKAGE = "rgdal")
>
> For whatever reason, RGDAL_CloseDataset doesn't seem to actually close
> the C file handle, but it doesn't seem to mind if the file handle was
> closed beforehand.

Could you please provide a working example? I have looked at this, but 
need a baseline to know whether I'm looking at the same thing. I'm very 
unsure that this is a robust solution, and need an instrumented example, 
including listings of the temporary directory during the process, to see 
the consequences. Thanks for looking into this, but I'd prefer to be sure 
that a Windows-specific fix doesn't make things worse for others too. 
Please also report on the source of your Windows rgdal binary - is it from 
CRAN or locally built dynamically linking your own GDAL?

Best wishes,

Roger

>
> Cheers,
> Oliver
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From palfaro at motionsoft.com.uy  Fri Nov  1 14:10:00 2013
From: palfaro at motionsoft.com.uy (Pablo Alfaro)
Date: Fri, 1 Nov 2013 11:10:00 -0200
Subject: [R-sig-Geo] raster interpolation within shape file
In-Reply-To: <1383293097039-7585011.post@n2.nabble.com>
References: <1383227955294-7585003.post@n2.nabble.com>
	<CAGFWpksOdONx9eE6FH711mw-tVSg5Ak0kV=c924+mCs0NoJfVg@mail.gmail.com>
	<1383293097039-7585011.post@n2.nabble.com>
Message-ID: <CAGFWpku54cBXQiAtjAOQ=-VPwB3Mu0C_kPstQ0o1oWOk7Em9Fw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131101/4c327187/attachment.pl>

From southandy at gmail.com  Fri Nov  1 14:15:59 2013
From: southandy at gmail.com (Andy South)
Date: Fri, 1 Nov 2013 13:15:59 +0000
Subject: [R-sig-Geo]
	=?utf-8?q?Projected_SpatialLinesDataFrame_has_a_segme?=
	=?utf-8?q?nt_spanning=09the_globe?=
References: <339F016E-2D5F-464C-B47B-60316ADE512B@gmail.com>
Message-ID: <loom.20131101T141549-749@post.gmane.org>

Ry Guy <rr2box42 <at> gmail.com> writes:

> Hi All,
> 
> I'm trying to use the 'coastsCoarse' dataset from library 'rworldmap' as a 
base map for plotting a global
> dataset. It works fine when I use unprojected data. However, if I project 
the data and base map,
> coastsCoarse ends up with one horizontal line segment that spans the whole 
map. You can see what I mean like this:

Hi Ryan,
I think I've identified the offending segment (see below), but haven't yet 
been able to remove it. I'm sure someone else on the list better at 
manipulating sp objects will be able to help with getting around the error 
below :
'setting coordinates cannot be done on Spatial objects, where they have 
already been set'
Once we've fixed this I'll try fixing in rworldmap by removoing the 
corresponding point in the unprojected file.
Best wishes,
Andy

> 
> # ---------------------------------------
> library(rgdal)
> library(rworldmap)
> 
> data(coastsCoarse)
> plot(coastsCoarse) # Looks good
> 
> mercator.proj4 = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 
+datum=WGS84 +units=m +no_defs"
> coastsMerc = spTransform(coastsCoarse, CRS(mercator.proj4))
> spplot(coastsMerc) # horizontal line across plot connects east and west 
Beringia...

#the problem is with line 94
plot(coastsMerc[94,])

#look at the last and the first point see which is the problem
coordinates(coastsMerc[94,])

#looks like the last point is the problem try removing it
numToRemove <- nrow(coastsMerc[94,]@lines[[1]]@Lines[[1]]@coords) 


coordinates(coastsMerc[94,]) <- 
coastsMerc[94,]@lines[[1]]@Lines[[1]]@coords[-numToRemove,]
#Error in `coordinates<-`(`*tmp*`, value = c(-1809707.97165956, 
-1823151.78413843,  : 
#setting coordinates cannot be done on Spatial objects, where they have 
already been set


> It seems like the boundary of northern Russia didn't get cut off 
correctly. I imagine the fix is
> straightforward, but I've been banging away at it to no avail. Does anyone 
have a simple solution that
> either (a) locates and removes the offending pan-global segment or (b) 
doesn't produce it to begin with?
> 
> Thanks much,
> Ryan
>


From er.rutishauser at gmail.com  Fri Nov  1 14:23:45 2013
From: er.rutishauser at gmail.com (Ervan Rutishauser)
Date: Fri, 1 Nov 2013 14:23:45 +0100
Subject: [R-sig-Geo] Problem with gIntersections {rgeos}
Message-ID: <CAJ7XRocNE19sK84L9bUcYO6-3mi3EZb+SjiHe5DrY=6J8tQabQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131101/dbaa27b3/attachment.pl>

From edzer.pebesma at uni-muenster.de  Fri Nov  1 15:09:42 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 01 Nov 2013 15:09:42 +0100
Subject: [R-sig-Geo] Projected SpatialLinesDataFrame has a segment
 spanning the globe
In-Reply-To: <loom.20131101T141549-749@post.gmane.org>
References: <339F016E-2D5F-464C-B47B-60316ADE512B@gmail.com>
	<loom.20131101T141549-749@post.gmane.org>
Message-ID: <5273B626.2090807@uni-muenster.de>


On 11/01/2013 02:15 PM, Andy South wrote:
> Ry Guy <rr2box42 <at> gmail.com> writes:
> 
>> Hi All,
>>
>> I'm trying to use the 'coastsCoarse' dataset from library 'rworldmap' as a 
> base map for plotting a global
>> dataset. It works fine when I use unprojected data. However, if I project 
> the data and base map,
>> coastsCoarse ends up with one horizontal line segment that spans the whole 
> map. You can see what I mean like this:
> 
> Hi Ryan,
> I think I've identified the offending segment (see below), but haven't yet 
> been able to remove it. I'm sure someone else on the list better at 
> manipulating sp objects will be able to help with getting around the error 
> below :
> 'setting coordinates cannot be done on Spatial objects, where they have 
> already been set'
> Once we've fixed this I'll try fixing in rworldmap by removoing the 
> corresponding point in the unprojected file.

Please let me know where you learned that you could use coordinates() to
assign coordinates to a Spatial* object.

> Best wishes,
> Andy
> 
>>
>> # ---------------------------------------
>> library(rgdal)
>> library(rworldmap)
>>
>> data(coastsCoarse)
>> plot(coastsCoarse) # Looks good
>>
>> mercator.proj4 = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 
> +datum=WGS84 +units=m +no_defs"
>> coastsMerc = spTransform(coastsCoarse, CRS(mercator.proj4))
>> spplot(coastsMerc) # horizontal line across plot connects east and west 
> Beringia...
> 
> #the problem is with line 94
> plot(coastsMerc[94,])
> 
> #look at the last and the first point see which is the problem
> coordinates(coastsMerc[94,])
> 
> #looks like the last point is the problem try removing it
> numToRemove <- nrow(coastsMerc[94,]@lines[[1]]@Lines[[1]]@coords) 
> 
> 
> coordinates(coastsMerc[94,]) <- 
> coastsMerc[94,]@lines[[1]]@Lines[[1]]@coords[-numToRemove,]
> #Error in `coordinates<-`(`*tmp*`, value = c(-1809707.97165956, 
> -1823151.78413843,  : 
> #setting coordinates cannot be done on Spatial objects, where they have 
> already been set

a wild guess, but this might work:

coastsMerc at lines[[94]]@Lines[[1]]@coords <-
 coastsMerc[94,]@lines[[1]]@Lines[[1]]@coords[-numToRemove,,drop=FALSE]

> 
> 
>> It seems like the boundary of northern Russia didn't get cut off 
> correctly. I imagine the fix is
>> straightforward, but I've been banging away at it to no avail. Does anyone 
> have a simple solution that
>> either (a) locates and removes the offending pan-global segment or (b) 
> doesn't produce it to begin with?
>>
>> Thanks much,
>> Ryan
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131101/06d87891/attachment.bin>

From lyndon.estes at gmail.com  Fri Nov  1 15:55:29 2013
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Fri, 1 Nov 2013 10:55:29 -0400
Subject: [R-sig-Geo] Problem with gIntersections {rgeos}
In-Reply-To: <CAJ7XRocNE19sK84L9bUcYO6-3mi3EZb+SjiHe5DrY=6J8tQabQ@mail.gmail.com>
References: <CAJ7XRocNE19sK84L9bUcYO6-3mi3EZb+SjiHe5DrY=6J8tQabQ@mail.gmail.com>
Message-ID: <CALuVVaYrAU_-TGajsQMJ-x6byTOiTQZnfW9DdM8kmW9gC-=bCA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131101/743f9995/attachment.pl>

From rr2box42 at gmail.com  Fri Nov  1 16:21:12 2013
From: rr2box42 at gmail.com (rr2box42)
Date: Fri, 1 Nov 2013 08:21:12 -0700 (PDT)
Subject: [R-sig-Geo] Projected SpatialLinesDataFrame has a segment
 spanning the globe
In-Reply-To: <5273B626.2090807@uni-muenster.de>
References: <339F016E-2D5F-464C-B47B-60316ADE512B@gmail.com>
	<loom.20131101T141549-749@post.gmane.org>
	<5273B626.2090807@uni-muenster.de>
Message-ID: <1383319272186-7585018.post@n2.nabble.com>

Thanks much to you both--Edzer's suggestion does work to remove the offending
vertex. Based on the input I managed an alternative, which is to correct the
original vertex to not pass 180 degrees longitude (it's currently at
180.0000004, which is apparently the problem):

ind = which(coastsCoarse at lines[[94]]@Lines[[1]]@coords[,1] > 180)
coastsCoarse at lines[[94]]@Lines[[1]]@coords[ind,1] = 180

Cheers,
Ryan



Edzer Pebesma-2 wrote
> On 11/01/2013 02:15 PM, Andy South wrote:
>> Ry Guy 
> <rr2box42 <at>
>  gmail.com> writes:
>> 
>>> Hi All,
>>>
>>> I'm trying to use the 'coastsCoarse' dataset from library 'rworldmap' as
>>> a 
>> base map for plotting a global
>>> dataset. It works fine when I use unprojected data. However, if I
>>> project 
>> the data and base map,
>>> coastsCoarse ends up with one horizontal line segment that spans the
>>> whole 
>> map. You can see what I mean like this:
>> 
>> Hi Ryan,
>> I think I've identified the offending segment (see below), but haven't
>> yet 
>> been able to remove it. I'm sure someone else on the list better at 
>> manipulating sp objects will be able to help with getting around the
>> error 
>> below :
>> 'setting coordinates cannot be done on Spatial objects, where they have 
>> already been set'
>> Once we've fixed this I'll try fixing in rworldmap by removoing the 
>> corresponding point in the unprojected file.
> 
> Please let me know where you learned that you could use coordinates() to
> assign coordinates to a Spatial* object.
> 
>> Best wishes,
>> Andy
>> 
>>>
>>> # ---------------------------------------
>>> library(rgdal)
>>> library(rworldmap)
>>>
>>> data(coastsCoarse)
>>> plot(coastsCoarse) # Looks good
>>>
>>> mercator.proj4 = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 
>> +datum=WGS84 +units=m +no_defs"
>>> coastsMerc = spTransform(coastsCoarse, CRS(mercator.proj4))
>>> spplot(coastsMerc) # horizontal line across plot connects east and west 
>> Beringia...
>> 
>> #the problem is with line 94
>> plot(coastsMerc[94,])
>> 
>> #look at the last and the first point see which is the problem
>> coordinates(coastsMerc[94,])
>> 
>> #looks like the last point is the problem try removing it
>> numToRemove <- nrow(coastsMerc[94,]@lines[[1]]@Lines[[1]]@coords) 
>> 
>> 
>> coordinates(coastsMerc[94,]) <- 
>> coastsMerc[94,]@lines[[1]]@Lines[[1]]@coords[-numToRemove,]
>> #Error in `coordinates<-`(`*tmp*`, value = c(-1809707.97165956, 
>> -1823151.78413843,  : 
>> #setting coordinates cannot be done on Spatial objects, where they have 
>> already been set
> 
> a wild guess, but this might work:
> 
> coastsMerc at lines[[94]]@Lines[[1]]@coords <-
>  coastsMerc[94,]@lines[[1]]@Lines[[1]]@coords[-numToRemove,,drop=FALSE]
> 
>> 
>> 
>>> It seems like the boundary of northern Russia didn't get cut off 
>> correctly. I imagine the fix is
>>> straightforward, but I've been banging away at it to no avail. Does
>>> anyone 
>> have a simple solution that
>>> either (a) locates and removes the offending pan-global segment or (b) 
>> doesn't produce it to begin with?
>>>
>>> Thanks much,
>>> Ryan
>>>
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> 

> R-sig-Geo@

>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
> 
> 
> _______________________________________________
> R-sig-Geo mailing list

> R-sig-Geo@

> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> signature.asc (567 bytes)
> &lt;http://r-sig-geo.2731867.n2.nabble.com/attachment/7585016/0/signature.asc&gt;





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Projected-SpatialLinesDataFrame-has-a-segment-spanning-the-globe-tp7585010p7585018.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alexandresantosbr at yahoo.com.br  Fri Nov  1 16:30:58 2013
From: alexandresantosbr at yahoo.com.br (ASANTOS)
Date: Fri, 01 Nov 2013 12:30:58 -0300
Subject: [R-sig-Geo] Create a mask for multiple polygons in spatstat package
Message-ID: <5273C932.6060900@yahoo.com.br>

Dear Members,

          I try to create a mask for multiple polygons in spatstat with 
union.owin that is much quicker than the "mask" type, but I have some 
problems that involves list objects and I ask if is posible to use 
union.owin with matrix object? In my example:

require(spatstat)
require(sp)
require(gpclib)


# Two polygons 
coordinates------------------------------------------------------

#Polygon 1
x.coords1<-c(371299.9,    371266.4,    371205.6,    371111.8, 
371047.6,    371018.2,    371014.0,
               371009.3,    370983.1,    370919.7,    370853.6, 
370785.6,    370748.8,    370711.8,
               370687.8,    370696.4,    370785.9,    370885.5, 
371035.8,    371148.1,    371205.2,
               371231.7,    371236.5,    371240.3,    371285.8, 
371326.5,    371397.2,    371417.1,
               371432.9,    371445.0,    371455.7,    371466.4, 
371476.6,    371502.6,    371536.0,
               371550.0,    371546.8,    371528.3,    371470.0, 
371393.3,    371299.9,    371299.9)

y.coords1<-c(8246589,    8246560,    8246508,    8246428, 8246373,    
8246349,    8246348,
              8246352,    8246385,    8246465,    8246551, 8246638,    
8246685,    8246732,
              8246764,    8246771,    8246846,    8246932, 8247062,    
8247160,    8247209,
              8247230,    8247224,    8247221,    8247160, 8247107,    
8247016,    8246991,
              8246967,    8246939,    8246914,    8246892, 8246875,    
8246846,    8246821,
              8246809,    8246802,    8246785,    8246735, 8246669,    
8246589,    8246589)

#Polygon 2

x.coords2<-c(368382.9,    368399.4,    368394.1,    368464.7, 
368652.2,    368683.7,    368699.7,
              368714.9,    368714.9,    368714.9,    368860.9, 
368932.1,    368994.8,    368994.8,
              369015.7,    369014.5,    369014.5,    369026.8, 
369045.2,    369020.0,    368952.9,
              368951.4,    368952.9,    368951.4,    368936.8, 
368923.4,    368804.1,    368676.0,
              368178.1,    368182.4,    368202.2,    368216.2, 
368233.4,    368251.3,    368270.3,
              368281.7,    368300.6,    368323.8,    368344.8, 
368364.6,    368374.2,    368382.9)



y.coords2<-c(8249120,    8249150,    8249153,    8249244, 8249173,    
8249167,    8249154,
                 8249145,    8249145,    8249145,    8249048, 
8249026,    8249003,    8249003,
              8248993,    8248991,    8248991,    8248984, 8248970,    
8248889,    8248833,
              8248829,    8248833,    8248829,    8248790, 8248765,    
8248626,    8248526,
              8248774,    8248780,    8248815,    8248843, 8248871,    
8248903,    8248934,
              8248952,    8248978,    8249013,    8249049, 8249086,    
8249103,    8249120)


# Mask creation 
---------------------------------------------------------------

mult.poly<-cbind(c(x.coords1,x.coords2),c(y.coords1,y.coords2))

w <- do.call(union.owin,mult.poly)

plot(w)

#-------------------------------------------------------------------------------


Thanks,


-- 
======================================================================
Alexandre dos Santos
Prote??o Florestal
IFMT - Instituto Federal de Educa??o, Ci?ncia e Tecnologia de Mato Grosso
Campus C?ceres
Caixa Postal 244
Avenida dos Ramires, s/n
Bairro: Distrito Industrial
C?ceres - MT                      CEP: 78.200-000
Fone: (+55) 65 8132-8112 (TIM)   (+55) 65 9686-6970 (VIVO)

         alexandre.santos at cas.ifmt.edu.br
Lattes: http://lattes.cnpq.br/1360403201088680


From rundel at gmail.com  Fri Nov  1 17:05:09 2013
From: rundel at gmail.com (Colin Rundel)
Date: Fri, 1 Nov 2013 12:05:09 -0400
Subject: [R-sig-Geo] Problem with gIntersections {rgeos}
In-Reply-To: <CAJ7XRocNE19sK84L9bUcYO6-3mi3EZb+SjiHe5DrY=6J8tQabQ@mail.gmail.com>
References: <CAJ7XRocNE19sK84L9bUcYO6-3mi3EZb+SjiHe5DrY=6J8tQabQ@mail.gmail.com>
Message-ID: <8173E979-71F0-4DDF-9DB8-0737E24DB886@gmail.com>

This issue is occurring because your poly2 object contains a canopy polygon that is also in the poly object, as such when calculating the intersection the resulting geometry contains that canopy polygon as well as the intersection polygon which is not a valid geometry hence the error. You can either remove the offending canopy from poly, or more likely if you are attempting to work with a single set of canopy polygons you can do something like the following to obtain all the canopy intersections:

inter = gIntersects(poly,byid=TRUE)
inter[!lower.tri(inter)] = FALSE

ids = which(inter,arr.ind=TRUE)

results = list()
for(i in 1:nrow(ids))
{
    results[[i]] = gIntersection(poly[ids[i,1],], poly[ids[i,2],])
}

plot(poly)
for(i in 1:length(results))
{
    plot(results[[i]],col='red', add=TRUE)
}

-Colin


On Nov 1, 2013, at 9:23 AM, Ervan Rutishauser <er.rutishauser at gmail.com> wrote:

> Dear R users,
> 
> I am having hard time while computing the intersections (overlaps) among
> tree crowns in a forest stand. I am using gIntersection() from 'rgeos'
> package, but I get the following error message:
> "Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id,
> "rgeos_intersection") :
>  TopologyException: side location conflict at 55.270200771297759
> 44.641891473965337"
> 
> It seems that the function does not allow 2 polygons (within the same
> layer) to be connected (touching each other). Is it a known problem? Any
> way to overcome this issue?
> Below is an example. Many thanks for your suggestion and help.
> Best regards,
> Ervan
> 
> _____________________________________
> 
> library(spatstat)
> library(rgeos)
> library(sp)
> x<- c(37.5, 42, 51, 63, 89.5, 110, 123, 142.5, 143.5, 141.5)  # x
> coordinates
> y <- c(202, 27, 53, 39.5, 59, 25.5, 73.5, 98, 38, 5)  # y coordinates
> crown <- c(11.8, 9.4, 9.4, 9.3, 9.1, 11.2, 9.2, 9.9, 11.1, 10.1)  # the
> crown radius of the trees
> test <- data.frame(x=x,y=y,crown=crown)
> A <- list()
> for (i in 1: nrow(test)) {
> DISC  <-
> disc(test$crown[i],centre=c(test$x[i],test$y[i]),npoly=50)[[4]][[1]][1:2]
> # compute the crown area based on crown radius
> DISC$x[50]<-DISC$x[1]  # Polygons need to be closed -> closed the circle by
> replacing last values by initial one
> DISC$y[50]<-DISC$y[1]
> A[[i]] <- Polygons(list(Polygon(DISC)),i)
> }
> dat <- data.frame(ID=1:nrow(test),crown.radius=test$crown)
> poly <- SpatialPolygons(A,1:nrow(test))
> Poly <- SpatialPolygonsDataFrame(poly,dat)
> plot(poly)
> 
> poly2 <- SpatialPolygons(A[2:3],1:2)
> plot(poly2,border=2,add=T)
> inter <- gIntersection(poly,poly2)
> 
> points(55.27, 44.64,bg=3,pch=21)
> 
> -- 
> _____________________________
> 
> Ervan Rutishauser, PhD
> carboforexpert.ch <http://carboforexpert.ch/index.html>
> LinkedIn <http://www.linkedin.com/pub/ervan-rutishauser/36/463/a>
> Skype: ervan-CH
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From noelia.gonzalezm at gmail.com  Fri Nov  1 19:10:53 2013
From: noelia.gonzalezm at gmail.com (Acacia dealbata)
Date: Fri, 1 Nov 2013 11:10:53 -0700 (PDT)
Subject: [R-sig-Geo] Aggregate raster
In-Reply-To: <1383152610567-7584991.post@n2.nabble.com>
References: <1383152610567-7584991.post@n2.nabble.com>
Message-ID: <1383329453075-7585021.post@n2.nabble.com>

Hi Loic!
Thanks for your answer. I am working on it, but the problem is that I am not
able to finish the first step (aggregate), as it takes hours (3 hours by now
and not finished). I am not sure if it is due to the aggregate code or to a
problem in the original map... I think I am going to make some proofs with
Quantum SIG and GRASS...



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Aggregate-raster-tp7584991p7585021.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From southandy at gmail.com  Fri Nov  1 20:59:31 2013
From: southandy at gmail.com (Andy South)
Date: Fri, 1 Nov 2013 19:59:31 +0000
Subject: [R-sig-Geo] Projected SpatialLinesDataFrame has a segment
	spanning the globe
References: <339F016E-2D5F-464C-B47B-60316ADE512B@gmail.com>
	<loom.20131101T141549-749@post.gmane.org>
	<5273B626.2090807@uni-muenster.de>
	<1383319272186-7585018.post@n2.nabble.com>
Message-ID: <loom.20131101T205233-781@post.gmane.org>

rr2box42 <rr2box42 <at> gmail.com> writes:

> 
> Thanks much to you both--Edzer's suggestion does work to remove the 
offending
> vertex. Based on the input I managed an alternative, which is to correct the
> original vertex to not pass 180 degrees longitude (it's currently at
> 180.0000004, which is apparently the problem):
> 
> ind = which(coastsCoarse <at> lines[[94]] <at> Lines[[1]] <at> coords[,1] > 
180)
> coastsCoarse <at> lines[[94]] <at> Lines[[1]] <at> coords[ind,1] = 180
> 
> Cheers,
> Ryan

Thanks both, I'll fix in the next update to rworldmap.

> Edzer Pebesma-2 wrote

> > Please let me know where you learned that you could use coordinates() to
> > assign coordinates to a Spatial* object.

I was just trying what seemed sensible, in sp help for coordinates() it says :
Description: retrieve (or set) spatial coordinates from (for) spatial data


From r.turner at auckland.ac.nz  Fri Nov  1 23:05:35 2013
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Sat, 02 Nov 2013 11:05:35 +1300
Subject: [R-sig-Geo] Create a mask for multiple polygons in spatstat
	package
In-Reply-To: <5273C932.6060900@yahoo.com.br>
References: <5273C932.6060900@yahoo.com.br>
Message-ID: <527425AF.9000200@auckland.ac.nz>



Your email was admirably structured in terms of providing reproducible code
which was set out very clearly and tidily.  However I am afraid that I 
don't understand
what it is that you are trying to do.

I think perhaps that you are using incorrect or misleading terminology.  
What do you
mean by saying that you are trying to create a *mask*?  Do you mean that 
you are
trying to create a *window*?

Note that union.owin() forms a *window* which is the union of two or 
more window
objects (objects of class "owin").

Since you are apparently dealing with two polygonal windows, there is no 
reason to
invoke the do.call() syntax.

Perhaps the following is what you really want.  Note that there are 
duplicated points
in the coordinates that you provided (which is not allowed) and that the 
coordinates
appear to be given in clockwise order (they must be given in 
anticlockwise order).
The following code remedies these problems:

D1 <- unique(data.frame(x=rev(x.coords1),y=rev(y.coords1))
W1 <- owin(poly=D1)
D2 <- unique(data.frame(x=rev(x.coords2),y=rev(y.coords2))
W2 <- owin(poly=D2)
W   <- union.owin(W1,W2)
plot(W)

Note that "sp" is not needed for any of the operations in your code (or in
mine).

Finally, please note that gpclib is *NOT* used by the latest version of 
spatstat.
It has been replaced by the polyclip package which is not encumbered by the
restrictive license by which gpclib is encumbered.  If you are not using the
latest version of spatstat I suggest that you install it forthwith.

HTH

cheers,

Rolf Turner



On 11/02/13 04:30, ASANTOS wrote:
> Dear Members,
>
>          I try to create a mask for multiple polygons in spatstat with 
> union.owin that is much quicker than the "mask" type, but I have some 
> problems that involves list objects and I ask if is posible to use 
> union.owin with matrix object? In my example:
>
> require(spatstat)
> require(sp)
> require(gpclib)
>
>
> # Two polygons 
> coordinates------------------------------------------------------
>
> #Polygon 1
> x.coords1<-c(371299.9,    371266.4,    371205.6,    371111.8, 
> 371047.6,    371018.2,    371014.0,
>               371009.3,    370983.1,    370919.7,    370853.6, 
> 370785.6,    370748.8,    370711.8,
>               370687.8,    370696.4,    370785.9,    370885.5, 
> 371035.8,    371148.1,    371205.2,
>               371231.7,    371236.5,    371240.3,    371285.8, 
> 371326.5,    371397.2,    371417.1,
>               371432.9,    371445.0,    371455.7,    371466.4, 
> 371476.6,    371502.6,    371536.0,
>               371550.0,    371546.8,    371528.3,    371470.0, 
> 371393.3,    371299.9,    371299.9)
>
> y.coords1<-c(8246589,    8246560,    8246508,    8246428, 8246373,    
> 8246349,    8246348,
>              8246352,    8246385,    8246465,    8246551, 8246638,    
> 8246685,    8246732,
>              8246764,    8246771,    8246846,    8246932, 8247062,    
> 8247160,    8247209,
>              8247230,    8247224,    8247221,    8247160, 8247107,    
> 8247016,    8246991,
>              8246967,    8246939,    8246914,    8246892, 8246875,    
> 8246846,    8246821,
>              8246809,    8246802,    8246785,    8246735, 8246669,    
> 8246589,    8246589)
>
> #Polygon 2
>
> x.coords2<-c(368382.9,    368399.4,    368394.1,    368464.7, 
> 368652.2,    368683.7,    368699.7,
>              368714.9,    368714.9,    368714.9,    368860.9, 
> 368932.1,    368994.8,    368994.8,
>              369015.7,    369014.5,    369014.5,    369026.8, 
> 369045.2,    369020.0,    368952.9,
>              368951.4,    368952.9,    368951.4,    368936.8, 
> 368923.4,    368804.1,    368676.0,
>              368178.1,    368182.4,    368202.2,    368216.2, 
> 368233.4,    368251.3,    368270.3,
>              368281.7,    368300.6,    368323.8,    368344.8, 
> 368364.6,    368374.2,    368382.9)
>
>
>
> y.coords2<-c(8249120,    8249150,    8249153,    8249244, 8249173,    
> 8249167,    8249154,
>                 8249145,    8249145,    8249145,    8249048, 
> 8249026,    8249003,    8249003,
>              8248993,    8248991,    8248991,    8248984, 8248970,    
> 8248889,    8248833,
>              8248829,    8248833,    8248829,    8248790, 8248765,    
> 8248626,    8248526,
>              8248774,    8248780,    8248815,    8248843, 8248871,    
> 8248903,    8248934,
>              8248952,    8248978,    8249013,    8249049, 8249086,    
> 8249103,    8249120)
>
>
> # Mask creation 
> ---------------------------------------------------------------
>
> mult.poly<-cbind(c(x.coords1,x.coords2),c(y.coords1,y.coords2))
>
> w <- do.call(union.owin,mult.poly)
>
> plot(w)
>


From adrian.baddeley at uwa.edu.au  Sat Nov  2 12:45:04 2013
From: adrian.baddeley at uwa.edu.au (Adrian Baddeley)
Date: Sat, 2 Nov 2013 19:45:04 +0800
Subject: [R-sig-Geo]  Dilation and Window Definition in Spatstat
Message-ID: <1CEF56CFF7118748AE0FA6C0186D3A312ECDB02E@IS-WIN-172.staffad.uwa.edu.au>

On 11/01/13 04:40, Ted Rosenbaum wrote:

> I am using spatstat version 1.34-0 and the pop command is not correctly
> recognizing the interior of a window after I use the dilation command on a
> polygon (i.e., non rectanglular window).

This was a bug in 'is.subset.owin' which affected the functions 'union.owin' and 'dilation.owin'.
It has been fixed in spatstat 1.34-1 which has just been submitted to CRAN.

Adrian Baddeley

From jgrn at illinois.edu  Sat Nov  2 18:50:10 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sat, 2 Nov 2013 12:50:10 -0500
Subject: [R-sig-Geo] Major update to spatial.tools on CRAN
Message-ID: <CABG0rfsbCDyYtsXCe8N5JvGq6zELk4BG=q+4W+0jiF+21N1p=g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131102/6ea815d5/attachment.pl>

From jgrn at illinois.edu  Sat Nov  2 18:56:13 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sat, 2 Nov 2013 12:56:13 -0500
Subject: [R-sig-Geo] Aggregate raster
In-Reply-To: <1383329453075-7585021.post@n2.nabble.com>
References: <1383152610567-7584991.post@n2.nabble.com>
	<1383329453075-7585021.post@n2.nabble.com>
Message-ID: <CABG0rfvVT+dWWyECFsyBt9MWcToeOjDzjnG-VcpJO7wyuFwsDQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131102/e7e0bf23/attachment.pl>

From rob.robinson at bto.org  Sat Nov  2 21:45:19 2013
From: rob.robinson at bto.org (Rob Robinson)
Date: Sat, 2 Nov 2013 20:45:19 +0000
Subject: [R-sig-Geo] proj4string in rworldmap
Message-ID: <CAGcXcEaJ1kNpCeVV5TFn-MK8Gr2DB8JL=TaRatoqtRKRf5qwBg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131102/df23a858/attachment.pl>

From osoong+r at gmail.com  Sun Nov  3 21:55:40 2013
From: osoong+r at gmail.com (Oliver Soong)
Date: Sun, 3 Nov 2013 12:55:40 -0800
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
Message-ID: <CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131103/430eb435/attachment.pl>

From noelia.gonzalezm at gmail.com  Mon Nov  4 09:56:53 2013
From: noelia.gonzalezm at gmail.com (Acacia dealbata)
Date: Mon, 4 Nov 2013 00:56:53 -0800 (PST)
Subject: [R-sig-Geo] Aggregate raster
In-Reply-To: <CABG0rfvVT+dWWyECFsyBt9MWcToeOjDzjnG-VcpJO7wyuFwsDQ@mail.gmail.com>
References: <1383152610567-7584991.post@n2.nabble.com>
	<1383329453075-7585021.post@n2.nabble.com>
	<CABG0rfvVT+dWWyECFsyBt9MWcToeOjDzjnG-VcpJO7wyuFwsDQ@mail.gmail.com>
Message-ID: <1383555413455-7585029.post@n2.nabble.com>

Thank you Jonathan. I am running it now. I will let you know if it works!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Aggregate-raster-tp7584991p7585029.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From eddieatr at gmail.com  Mon Nov  4 12:56:47 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Mon, 4 Nov 2013 11:56:47 +0000
Subject: [R-sig-Geo] Fit a sine curve to raster stack
In-Reply-To: <CAB5R0=W4fP6nACWFGGdYAK-7R8xc0o8HRUGDCtiaJYb3-OcmZg@mail.gmail.com>
References: <CAB5R0=W4fP6nACWFGGdYAK-7R8xc0o8HRUGDCtiaJYb3-OcmZg@mail.gmail.com>
Message-ID: <CABaJH79Xjzj7V-YoAEuqrJQ+MsRmkS30fuiV5k1xpTps-n7uqg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131104/f56b3e4c/attachment.pl>

From andre.vanproosdij at wur.nl  Mon Nov  4 12:58:26 2013
From: andre.vanproosdij at wur.nl (Proosdij, Andre van)
Date: Mon, 4 Nov 2013 11:58:26 +0000
Subject: [R-sig-Geo] calculate the area of an alpha shape
Message-ID: <84D737939C16114590DCDD4F003E013B1FEC608D@SCOMP0936.wurnet.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131104/79435138/attachment.pl>

From ashton at msu.edu  Mon Nov  4 14:34:52 2013
From: ashton at msu.edu (Ashton Shortridge)
Date: Mon, 04 Nov 2013 08:34:52 -0500
Subject: [R-sig-Geo] calculate the area of an alpha shape
In-Reply-To: <84D737939C16114590DCDD4F003E013B1FEC608D@SCOMP0936.wurnet.nl>
References: <84D737939C16114590DCDD4F003E013B1FEC608D@SCOMP0936.wurnet.nl>
Message-ID: <4532607.7sYzS8Ceo4@erebus>

Dear Andr?,

There may be a more elegant solution, but this works fine:
library(sp)
bds <- achull.obj$ashape.obj$x  # matrix of coordinates in ashape
bds <- rbind(bds, bds[1,])          # close the ring
ashape <- Polygon(bds)            # convert to sp Polygon  
print(ashape at area)



On Monday, November 04, 2013 11:58:26 AM Proosdij, Andre van wrote:
> Dear colleagues,
> 
> I wish to calculate the area covered by the alpha shape based on a sample of
> points in a 2D plane. For the alpha-convex hull this works fine using the
> function ahull in the alphahull package. However, I want to get the area of
> the slightly different alpha shape. How can I do this? Below a short
> example.
> 
> Many thanks in advance for your answers and ideas!
> 
> 
> Andr?
> 
> 
> 
> x <- c(1,1,1.5,2.8,3,3)
> y <- c(1,3,2,3,4,1)
> z <- cbind(x,y)
> plot(z)
> 
> ### Calculate the alpha-convex hull
> library(alphahull)
> alpha <- 3 # Define alpha > 0
> achull.obj <- ahull(z, alpha = alpha)
> 
> ### Plot the sampled points and the alpha-convex hull object
> plot(achull.obj, add = TRUE, col = "blue")
> 
> ### Get the length of the alpha-convex hull
> achulllength <- achull.obj$length
> achulllength
> 
> ### Get the area of the alpha-convex hull
> achullarea <- areaahull(achull.obj)
> achullarea
> 
> ### Plot the alpha shape
> plot(achull.obj$ashape.obj, add = TRUE, col = "red")
> 
> ### Get the length of the alpha shape
> ashapelength <- achull.obj$ashape.obj$length
> ashapelength
> 
> 
> 
> 
> 
> Ir. A.S.J. van Proosdij
> PhD Student
> t   +31 317 48 1198
> e  andre.vanproosdij at wur.nl<mailto:andre.vanproosdij at wur.nl>
> 
> Naturalis Biodiversity Center, section NHN
> Biosystematics Group, Wageningen University
> Gen. Foulkesweg 37, 6703 BL Wageningen, the Netherlands
> 
> www.bis.wur.nl<http://www.bis.wur.nl/>
> 
> 
> 	[[alternative HTML version deleted]]

-----
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From valentina.lauria at nuigalway.ie  Mon Nov  4 16:03:37 2013
From: valentina.lauria at nuigalway.ie (Lauria, Valentina)
Date: Mon, 4 Nov 2013 15:03:37 +0000
Subject: [R-sig-Geo] Errors when predict a raster with offset
Message-ID: <B11DE93D7F439D4BA1E942572BA750308BC67E6B@UDSMBX01.uds.nuigalway.ie>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131104/349a669c/attachment.pl>

From jan.verbesselt at wur.nl  Mon Nov  4 16:24:52 2013
From: jan.verbesselt at wur.nl (Verbesselt, Jan)
Date: Mon, 4 Nov 2013 15:24:52 +0000
Subject: [R-sig-Geo] Fit a sine curve to raster stack
In-Reply-To: <CAB5R0=W4fP6nACWFGGdYAK-7R8xc0o8HRUGDCtiaJYb3-OcmZg@mail.gmail.com>
Message-ID: <CE9ADA9A.BEE4%jan.verbesselt@wur.nl>

Dear Sofea,

You could try something like this:

fun3 <- function(x){
        time <- 1:length(x)
	xc <-cos(2*pi*t/365)
	xs <-sin(2*pi*t/365)
	fit <- lm(x~xc+xs)
        return(fit$coefficients[1])
        }

s3 <- calc(s,  fun = fun3)


But check for NA's within your time series as these might trigger
errors/warnings. Maybe also check na.action options like na.approx(). Can
you provide a reproducible example in that case?

Best,
Jan Verbesselt
Wageningen University
The Netherlands



On 31/10/13 21:39, "Sofea Wright" <sofeawright at gmail.com> wrote:

>Dear list,
>
>I am trying to fit a sine curve to my data. When dealing with non-raster
>data, it's quite straight forward:
>
># Fit sine curve to describe the data
>temperature<-maxtemp$temperature
>time<-1:n
>xc<-cos(2*pi*time/365)
>xs<-sin(2*pi*time/365)
>fit<-lm(temperature~xc+xs)
>summary(fit)
>
>I am not sure how to do that with rasterstack as I keep on getting error
>message.
> > s
>class       : RasterStack
>dimensions  : 1000, 1621, 1621000, 365  (nrow, ncol, ncell, nlayers)
>resolution  : 0.04166667, 0.04166667  (x, y)
>extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>+towgs84=0,0,0
>
>s <- stack(tif)
>time <- 1:nlayers(s)
>fun1 <- function(x){
>  xc<-cos(2*pi*time/365)
>  xs<-sin(2*pi*time/365)
>          }
>
>fun2 <- function (x) {
>        lm(s~xc+xs)
>        }
>Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
>  cannot use this function
>
>s1 <- calc(s,  fun = fun1)
>s2 <- calc(s,  fun = fun2)
>
>Anybody?
>
>Thank you
>Sofea
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From markpayneatwork at gmail.com  Mon Nov  4 17:28:55 2013
From: markpayneatwork at gmail.com (Mark Payne)
Date: Mon, 4 Nov 2013 17:28:55 +0100
Subject: [R-sig-Geo] Getting started with geostatistics in R
Message-ID: <CAGBzUO9wwjSunKC6pFdjBnJ6dW_Ux+2gZsLPSyapsKSo82o7KA@mail.gmail.com>

Dear R-sig-geo-ers,

I was wondering if anyone could recommend a good entry-level reference
on Geostatistics, particularly with an R flavour. I've read Roger
Bivand's ASDAR book, and found it very useful, but I struggled a lot
with the later chapters that came down to the actual nuts and bolts of
geostatistics - it felt like I was missing a lot of the required
knowledge. Can anyone recommend a good primer to fill in the gaps?

Best wishes,

Mark


From andre.vanproosdij at wur.nl  Mon Nov  4 17:32:42 2013
From: andre.vanproosdij at wur.nl (Proosdij, Andre van)
Date: Mon, 4 Nov 2013 16:32:42 +0000
Subject: [R-sig-Geo] calculate the area of an alpha shape
In-Reply-To: <4532607.7sYzS8Ceo4@erebus>
References: <84D737939C16114590DCDD4F003E013B1FEC608D@SCOMP0936.wurnet.nl>
	<4532607.7sYzS8Ceo4@erebus>
Message-ID: <84D737939C16114590DCDD4F003E013B1FEC8136@SCOMP0936.wurnet.nl>

Many thanks Ashton!

It does help a lot, but I'm afraid, it's not completely correct yet. One would expect that the area of the alpha shape is larger than the area of the alpha-convex hull (straight line segments instead of arcs). However, applying your suggestion, the area is smaller! If I plot the points and the alpha shape, the plot is correct. The area of the alpha shape seems to be calculated a polygon that includes the point (1.5, 2.0). See the updated example below. I don't know what happens, but apparently, the list of points that defines the polygon is incorrect. Any thoughts of how to adjust this?

Best,

Andr?


x <- c(1,1,1.5,2.8,3,3) # original set of points
y <- c(1,3,2,3,4,1) # original set of points
#x <- c(1,1,2.8,3,3) # points without (1.5, 2.0)
#y <- c(1,3,3,4,1) # points without (1.5, 2.0)
z <- cbind(x,y)
plot(z)

### Calculate the alpha convex hull
library(alphahull)
alpha <- 3 # Define alpha > 0
achull.obj <- ahull(z, alpha = alpha)

### Plot the sampled points and the alpha-convex hull object
plot(achull.obj, add = TRUE, col = "blue")

### Get the length of the alpha-convex hull
achulllength <- achull.obj$length
achulllength

### Get the area of the alpha-convex hull
achullarea <- areaahull(achull.obj)
achullarea

### Plot the alpha shape
plot(achull.obj$ashape.obj, add = TRUE, col = "red")

### Get the length of the alpha shape
ashapelength <- achull.obj$ashape.obj$length
ashapelength

### Get the area of the alpha shape
library(sp)
bds <- achull.obj$ashape.obj$x  # matrix of coordinates in ashape
bds <- rbind(bds, bds[1,]) # close the ring
ashape <- Polygon(bds) # convert to sp Polygon
ashapearea <- ashape at area
ashapearea




Ir. A.S.J. van Proosdij
PhD Student
t   +31 317 48 1198?
e? andre.vanproosdij at wur.nl

Naturalis Biodiversity Center, section NHN
Biosystematics Group, Wageningen?University
Gen. Foulkesweg 37, 6703 BL Wageningen,?the Netherlands

www.bis.wur.nl

-----Original Message-----
From: Ashton Shortridge [mailto:ashton at msu.edu] 
Sent: maandag 4 november 2013 14:35
To: r-sig-geo at r-project.org
Cc: Proosdij, Andre van
Subject: Re: [R-sig-Geo] calculate the area of an alpha shape

Dear Andr?,

There may be a more elegant solution, but this works fine:
library(sp)
bds <- achull.obj$ashape.obj$x  # matrix of coordinates in ashape
bds <- rbind(bds, bds[1,])          # close the ring
ashape <- Polygon(bds)            # convert to sp Polygon  
print(ashape at area)



On Monday, November 04, 2013 11:58:26 AM Proosdij, Andre van wrote:
> Dear colleagues,
> 
> I wish to calculate the area covered by the alpha shape based on a 
> sample of points in a 2D plane. For the alpha-convex hull this works 
> fine using the function ahull in the alphahull package. However, I 
> want to get the area of the slightly different alpha shape. How can I 
> do this? Below a short example.
> 
> Many thanks in advance for your answers and ideas!
> 
> 
> Andr?


From rshepard at appl-ecosys.com  Mon Nov  4 18:10:46 2013
From: rshepard at appl-ecosys.com (Rich Shepard)
Date: Mon, 4 Nov 2013 09:10:46 -0800 (PST)
Subject: [R-sig-Geo] Getting started with geostatistics in R
In-Reply-To: <CAGBzUO9wwjSunKC6pFdjBnJ6dW_Ux+2gZsLPSyapsKSo82o7KA@mail.gmail.com>
References: <CAGBzUO9wwjSunKC6pFdjBnJ6dW_Ux+2gZsLPSyapsKSo82o7KA@mail.gmail.com>
Message-ID: <alpine.LNX.2.00.1311040908370.24904@salmo.appl-ecosys.com>

On Mon, 4 Nov 2013, Mark Payne wrote:

> I was wondering if anyone could recommend a good entry-level reference on
> Geostatistics, particularly with an R flavour. I've read Roger Bivand's
> ASDAR book, and found it very useful, but I struggled a lot with the later
> chapters that came down to the actual nuts and bolts of geostatistics - it
> felt like I was missing a lot of the required knowledge. Can anyone
> recommend a good primer to fill in the gaps?

Mark,

   A book I bought and read many years ago was my introduction to
geostatistics: "Geostatistics for Natural Resource Evaluation" by Pierre
Goovaerts. Published by Oxford Univ. Press in 1997.

HTH,

Rich

-- 
Richard B. Shepard, Ph.D.          |      Have knowledge, will travel.
Applied Ecosystem Services, Inc.   |
<http://www.appl-ecosys.com>     Voice: 503-667-4517      Fax: 503-667-8863


From southandy at gmail.com  Mon Nov  4 19:03:13 2013
From: southandy at gmail.com (Andy South)
Date: Mon, 4 Nov 2013 18:03:13 +0000
Subject: [R-sig-Geo] proj4string in rworldmap
References: <CAGcXcEaJ1kNpCeVV5TFn-MK8Gr2DB8JL=TaRatoqtRKRf5qwBg@mail.gmail.com>
Message-ID: <loom.20131104T185118-70@post.gmane.org>

Rob Robinson <rob.robinson <at> bto.org> writes:

> 
> Prompted by a recent post,  I have discovered rworldmap, which look set to
> make my life much easier, apart from a wrinkle I can't get my head round.
> 
> I am writing a function to plot a map clipped to a given extent, and I'd
> like to be able to do so at different resolutions. This is easy to do 
using
> the different datasets (eg countriesCoarse, countriesHigh). I have two
> problems (i) they have (slightly) different proj4strings and (ii) when I
> pick up the proj4string to assign it to my clipping polygon CRS() alters
> it, causing the gDifference (etc) to complain they are different. Any
> thoughts on the best way to straighten this out?
> many thanks
> rob

Hi Rob,

I'm pleased that rworldmap might make your life easier even if that hasn't 
quite been realised yet.
 
I can fix problem (i) in rworldmap. Would someone like to suggest which of 
the 2 proj4strings is preferable ?

Seems likely that (ii) occurs in sp or further back, someone else might like 
to comment.

If you'd like to email me direct about your function, pleased do (I'm only 
just up the road!).

Best wishes,
Andy 




> Example:
> library(rworldmap)
> library(rworldxtra)
> data(countriesCoarse)
> data(countriesHigh)
> 
> proj4string(countriesCoarse)
> # [1] "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
> proj4string(countriesHigh)
> # [1] " +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0"
> 
> clip_poly <- readWKT("POLYGON((-50 40,-50 70,50 70,50 40,-50 40))")
> proj4string(clip_poly) <- CRS(proj4string(countriesCoarse))
> proj4string(clip_poly)
> # [1] "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0"
> # the +towgs84 tag has been added
> 
> res <- gDifference(clip_poly, countriesCoarse)
> # generates Warning: spgeom1 and spgeom2 have different proj4 strings
> 

> Dr Rob Robinson, Principal Ecologist
> British Trust for Ornithology, The Nunnery, Thetford, Norfolk, IP24 2PU
> Ph: +44 (0)1842 750050     E: rob.robinson <at> bto.org
> Fx: +44 (0)1842 750030     W: www.bto.org/about-bto/our-staff/rob-robinson
> 
> ====== "How can anyone be enlightened, when truth is so poorly lit" 
=======
> 
> 	[[alternative HTML version deleted]]
>


From ashton at msu.edu  Mon Nov  4 19:27:36 2013
From: ashton at msu.edu (Ashton Shortridge)
Date: Mon, 04 Nov 2013 13:27:36 -0500
Subject: [R-sig-Geo] calculate the area of an alpha shape
In-Reply-To: <84D737939C16114590DCDD4F003E013B1FEC8136@SCOMP0936.wurnet.nl>
References: <84D737939C16114590DCDD4F003E013B1FEC608D@SCOMP0936.wurnet.nl>
	<4532607.7sYzS8Ceo4@erebus>
	<84D737939C16114590DCDD4F003E013B1FEC8136@SCOMP0936.wurnet.nl>
Message-ID: <2079275.Z1ocBfEm6X@erebus>

Dear Andr?,

You're right! I assumed something that wasn't true - that $x in the ashape.obj 
were the points on the hull. That's what you get for free help, I guess.... 

Fortunately this seems to work. Notice how I index $x by the alpha.extremes 
field to extract just the points I want for bds:

library(sp)
bds <- achull.obj$ashape.obj$x[achull.obj$ashape.obj$alpha.extremes,] 
bds <- rbind(bds, bds[1,])          # close the ring
ashape <- Polygon(bds)            # convert to sp Polygon  
print(ashape at area)

# The following plots the points in ashape superimposed on the hulls
plot(achull.obj, col = "blue")
plot(achull.obj$ashape.obj, add = TRUE, col = "red")
points(coordinates(ashape), pch=16, cex=2, col='gold')


On Monday, November 04, 2013 04:32:42 PM Proosdij, Andre van wrote:
> Many thanks Ashton!
> 
> It does help a lot, but I'm afraid, it's not completely correct yet. One
> would expect that the area of the alpha shape is larger than the area of
> the alpha-convex hull (straight line segments instead of arcs). However,
> applying your suggestion, the area is smaller! If I plot the points and the
> alpha shape, the plot is correct. The area of the alpha shape seems to be
> calculated a polygon that includes the point (1.5, 2.0). See the updated
> example below. I don't know what happens, but apparently, the list of
> points that defines the polygon is incorrect. Any thoughts of how to adjust
> this?
> 
> Best,
> 
> Andr?
> 
> 
> x <- c(1,1,1.5,2.8,3,3) # original set of points
> y <- c(1,3,2,3,4,1) # original set of points
> #x <- c(1,1,2.8,3,3) # points without (1.5, 2.0)
> #y <- c(1,3,3,4,1) # points without (1.5, 2.0)
> z <- cbind(x,y)
> plot(z)
> 
> ### Calculate the alpha convex hull
> library(alphahull)
> alpha <- 3 # Define alpha > 0
> achull.obj <- ahull(z, alpha = alpha)
> 
> ### Plot the sampled points and the alpha-convex hull object
> plot(achull.obj, add = TRUE, col = "blue")
> 
> ### Get the length of the alpha-convex hull
> achulllength <- achull.obj$length
> achulllength
> 
> ### Get the area of the alpha-convex hull
> achullarea <- areaahull(achull.obj)
> achullarea
> 
> ### Plot the alpha shape
> plot(achull.obj$ashape.obj, add = TRUE, col = "red")
> 
> ### Get the length of the alpha shape
> ashapelength <- achull.obj$ashape.obj$length
> ashapelength
> 
> ### Get the area of the alpha shape
> library(sp)
> bds <- achull.obj$ashape.obj$x  # matrix of coordinates in ashape
> bds <- rbind(bds, bds[1,]) # close the ring
> ashape <- Polygon(bds) # convert to sp Polygon
> ashapearea <- ashape at area
> ashapearea
> 
> 
> 
> 
> Ir. A.S.J. van Proosdij
> PhD Student
> t   +31 317 48 1198 
> e  andre.vanproosdij at wur.nl
> 
> Naturalis Biodiversity Center, section NHN
> Biosystematics Group, Wageningen University
> Gen. Foulkesweg 37, 6703 BL Wageningen, the Netherlands
> 
> www.bis.wur.nl
> 
> -----Original Message-----
> From: Ashton Shortridge [mailto:ashton at msu.edu]
> Sent: maandag 4 november 2013 14:35
> To: r-sig-geo at r-project.org
> Cc: Proosdij, Andre van
> Subject: Re: [R-sig-Geo] calculate the area of an alpha shape
> 
> Dear Andr?,
> 
> There may be a more elegant solution, but this works fine:
> library(sp)
> bds <- achull.obj$ashape.obj$x  # matrix of coordinates in ashape
> bds <- rbind(bds, bds[1,])          # close the ring
> ashape <- Polygon(bds)            # convert to sp Polygon
> print(ashape at area)
> 
> On Monday, November 04, 2013 11:58:26 AM Proosdij, Andre van wrote:
> > Dear colleagues,
> > 
> > I wish to calculate the area covered by the alpha shape based on a
> > sample of points in a 2D plane. For the alpha-convex hull this works
> > fine using the function ahull in the alphahull package. However, I
> > want to get the area of the slightly different alpha shape. How can I
> > do this? Below a short example.
> > 
> > Many thanks in advance for your answers and ideas!
> > 
> > 
> > Andr?

-----
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From Roger.Bivand at nhh.no  Mon Nov  4 22:03:25 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 4 Nov 2013 22:03:25 +0100
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>

Which Windows? XP, Vista, 7, 8, 8.1? 32 and 64 bit? If Vista/7/8, run as 
administrator or not? I agree that the code in those parts of rgdal is not 
well-designed - it was well-designed, but has been modified so that it 
works for most people cross-platform, and has had to accommodate changes 
that have taken place in GDAL over more than 10 years, not least the 
error-handler.

The simple solution to your practical problem is to for you to use a 
larger temporary drive under Windows, or change to an operating system 
that does not have these side-effects.

Assisting you is not just a matter of doing what you think works for you, 
but making sure it doesn't break anything else for anybody else 
cross-platform.

Your script does not check for other files in tempdir, so I prepended a 
listing of prior content:

pc <- dir(tempdir())

and dropped them from the list for unlinking:

now <- dir(tempdir())
unlink(paste(tempdir(), now[!(now %in% pc)], sep=.Platform$file.sep))

I do not see how your script exercises the problem. It creates a new 
transient file, but does not close it, which was the behaviour you are 
unhappy with. If I add

GDAL.close(r3)

on Linux, the transient dataset is removed. On Windows 7 64-bit with the 
CRAN rgdal binary run as user, temporary files are left in tempdir for r1, 
r2, and r3. The same three temporary files are left when run as 
administrator.

The earliest version of GDAL.close was:

GDAL.close <- function(dataset) {
             .setCollectorFun(slot(dataset, 'handle'), NULL)
             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
             invisible()
}

with a version in 2007 in the THK branch calling a closeDataset method, 
containing:

             handle <- slot(dataset, "handle")
             unreg.finalizer(handle)
             .Call("RGDAL_DeleteHandle", handle, PACKAGE="rgdal")

with:

unreg.finalizer <- function(obj) reg.finalizer(obj, function(x) x)

and by 2010 was:

GDAL.close <- function(dataset) {
             .setCollectorFun(slot(dataset, 'handle'), NULL)
             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
             invisible(gc())
}

Special handling of GDALTransientDataset was added in revision 433 in 
Janual 2013, and modified in revision 462 in April 2013.

It has seemed IIRC that Windows can treat arbitrary files as open. It is 
also possible that there is an interaction between Windows and 
rgdal:::.setCollectorFun(), which does what it should, when given the NULL 
argument, setting:

.setCollectorFun <- function(object, fun) {

   if (is.null(fun)) fun <- function(obj) obj
   reg.finalizer(object, fun, onexit=TRUE)

}

so incorporating the THK branch logic. It could possibly also vary across 
drivers, so finding a robust fix means setting up a test rig with multiple 
Windows machines and testing for multiple drivers to see why some temprary 
files are being treated as open when other operating systems don't have 
problems in their removal. Windows users with too small temporary 
directories. I welcome contributions from people who understand Windows 
and can actually explain why we see the consequences we see.

One candidate may be to branch to .Call("RGDAL_DeleteHandle", handle, 
PACKAGE="rgdal") for the GDALTransientDataset case; I'll report back once 
the package has gone through win-builder.

Hope this doesn't muddle too much, clarification doesn't seem like the 
right expression.

Roger


On Sun, 3 Nov 2013, Oliver Soong wrote:

> I've been using the CRAN rgdal and raster.  I apologize in advance for all
> the linebreaks that will be broken.  This code should highlight the problem
> and the fix:
>
>
>
> require(rgdal)
> require(raster)
> r1 <- raster(system.file("external/test.grd", package="raster"))
> r2 <- as(r1, "SpatialGridDataFrame")
> r2.dims <- gridparameters(r2)$cells.dim
> r3 <- new("GDALTransientDataset", driver = new("GDALDriver", "GTiff"), rows
> = r2.dims[2], cols = r2.dims[1], bands = 1, type = "Float32", options =
> NULL, fname = file.path(tempdir(), "r3.tif"), handle = NULL)
> print(dir(tempdir()))
> writeRaster(r1, file.path(tempdir(), "r1.tif"))
> writeGDAL(r2, file.path(tempdir(), "r2.tif"))
> print(dir(tempdir()))
> unlink(dir(tempdir(), full.names = TRUE))
> print(dir(tempdir()))
> leftover <- gsub("/", "\\\\", dir(tempdir(), full.names = TRUE))
> invisible(lapply(paste("cmd /c del", leftover), system))
> rm(r1, r2, r3)
> gc()
> unlink(dir(tempdir(), full.names = TRUE))
> print(dir(tempdir()))
> invisible(lapply(paste("cmd /c del", leftover), system))
>
>
>
> Basically, I'm trying to write a standard raster package raster (r1) and an
> sp package SpatialGridDataFrame (r2).  Both of those end up calling
> new("GDALTransientDataset"), hence r3.  At the first print(dir(tempdir())),
> only r3 has an open temporary file, which is expected.  At the second, all
> three have open temporary files, and r1 and r2 have their written final
> outputs, which are closed.  The temporary files for r1 and r2 should have
> been closed at this point.  None of the temporary files can be removed by
> unlink, although the final outputs can, as shown at the third
> print(dir(tempdir())).  Windows can't remove them, either.  However, if I
> remove the GDALTransientDataset r3 and initiate gc(), R can remove that
> temporary file, but this does not work for r1 and r2.  After q(), the
> tempdir() will not be removed by R, but it and the temporary files for r1
> and r2 can now be removed.
>
> It looks like GDAL.close is broken (again/as always), but the collector
> function for GDALTransientDataset seems to at least close the handle.
> GDAL.close relies on RGDAL_CloseDataset, whereas the GDALTransientDataset
> collector just uses RGDAL_CloseHandle.  With the handle closed, I think the
> unlink code in GDAL.close will work (as an aside, I'd use the pattern
> paste0("^[a-z]{3}", basen, "$") to be safer and the argument full.names
> might be simpler than constructing flf separately).  I believe
> RGDAL_CloseDataset checks for NULL handles but just returns early, so it
> should be the same to replace the .Call("RGDAL_CloseDataset", ...) with
> .Call("RGDAL_CloseHandle", ...).
>
> Really, I think RGDAL_DeleteHandle needs to be fixed, but I don't know
> enough about GDALDeleteDataset or the #ifndef OSGEO4W deleteFile business
> or why RGDAL_CloseHandle is commented out to make any useful suggestions
> there.
>
> Cheers,
> Oliver
>
>
>
>
> On Fri, Nov 1, 2013 at 1:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Mon, 28 Oct 2013, Oliver Soong wrote:
>>
>>  I've had a long standing struggle with GDAL.close on Windows, and I
>>> think I might finally have found a fix.  I'm currently running rgdal
>>> 0.8.11, R 3.0.2, and 32-bit Windows 7.
>>>
>>> Currently, writeRaster and writeGDAL create temporary files in the
>>> tempdir() folder (the final filename prefixed with 3 random [a-z]
>>> letters).  On my system, these files get left open and orphaned.  When
>>> doing heavy processing, this can lead to the drive hosting the
>>> tempdir() folder to become full, even if the data is being ultimately
>>> written to a much larger drive.  This also means that R cannot clean
>>> up these files or the tempdir() folder when it closes, causing similar
>>> bloat in my %TEMP%.
>>>
>>> I haven't tested this on other platforms, but I think it might help to
>>> insert an extra line into GDAL.close:
>>>
>>> .setCollectorFun(slot(dataset, "handle"), NULL)
>>> .Call("RGDAL_CloseHandle", dataset at handle, PACKAGE = "rgdal")
>>> .Call("RGDAL_CloseDataset", dataset, PACKAGE = "rgdal")
>>>
>>> For whatever reason, RGDAL_CloseDataset doesn't seem to actually close
>>> the C file handle, but it doesn't seem to mind if the file handle was
>>> closed beforehand.
>>>
>>
>> Could you please provide a working example? I have looked at this, but
>> need a baseline to know whether I'm looking at the same thing. I'm very
>> unsure that this is a robust solution, and need an instrumented example,
>> including listings of the temporary directory during the process, to see
>> the consequences. Thanks for looking into this, but I'd prefer to be sure
>> that a Windows-specific fix doesn't make things worse for others too.
>> Please also report on the source of your Windows rgdal binary - is it from
>> CRAN or locally built dynamically linking your own GDAL?
>>
>> Best wishes,
>>
>> Roger
>>
>>
>>> Cheers,
>>> Oliver
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Nov  4 23:17:40 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 4 Nov 2013 23:17:40 +0100
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
Message-ID: <alpine.LRH.2.03.1311042315001.19757@reclus.nhh.no>

On Mon, 4 Nov 2013, Roger Bivand wrote:

> Which Windows? XP, Vista, 7, 8, 8.1? 32 and 64 bit? If Vista/7/8, run as 
> administrator or not? I agree that the code in those parts of rgdal is not 
> well-designed - it was well-designed, but has been modified so that it works 
> for most people cross-platform, and has had to accommodate changes that have 
> taken place in GDAL over more than 10 years, not least the error-handler.
>
> The simple solution to your practical problem is to for you to use a larger 
> temporary drive under Windows, or change to an operating system that does not 
> have these side-effects.
>
> Assisting you is not just a matter of doing what you think works for you, but 
> making sure it doesn't break anything else for anybody else cross-platform.
>
> Your script does not check for other files in tempdir, so I prepended a 
> listing of prior content:
>
> pc <- dir(tempdir())
>
> and dropped them from the list for unlinking:
>
> now <- dir(tempdir())
> unlink(paste(tempdir(), now[!(now %in% pc)], sep=.Platform$file.sep))
>
> I do not see how your script exercises the problem. It creates a new 
> transient file, but does not close it, which was the behaviour you are 
> unhappy with. If I add
>
> GDAL.close(r3)
>
> on Linux, the transient dataset is removed. On Windows 7 64-bit with the CRAN 
> rgdal binary run as user, temporary files are left in tempdir for r1, r2, and 
> r3. The same three temporary files are left when run as administrator.
>
> The earliest version of GDAL.close was:
>
> GDAL.close <- function(dataset) {
>            .setCollectorFun(slot(dataset, 'handle'), NULL)
>            .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>            invisible()
> }
>
> with a version in 2007 in the THK branch calling a closeDataset method, 
> containing:
>
>            handle <- slot(dataset, "handle")
>            unreg.finalizer(handle)
>            .Call("RGDAL_DeleteHandle", handle, PACKAGE="rgdal")
>
> with:
>
> unreg.finalizer <- function(obj) reg.finalizer(obj, function(x) x)
>
> and by 2010 was:
>
> GDAL.close <- function(dataset) {
>            .setCollectorFun(slot(dataset, 'handle'), NULL)
>            .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>            invisible(gc())
> }
>
> Special handling of GDALTransientDataset was added in revision 433 in Janual 
> 2013, and modified in revision 462 in April 2013.
>
> It has seemed IIRC that Windows can treat arbitrary files as open. It is also 
> possible that there is an interaction between Windows and 
> rgdal:::.setCollectorFun(), which does what it should, when given the NULL 
> argument, setting:
>
> .setCollectorFun <- function(object, fun) {
>
>  if (is.null(fun)) fun <- function(obj) obj
>  reg.finalizer(object, fun, onexit=TRUE)
>
> }
>
> so incorporating the THK branch logic. It could possibly also vary across 
> drivers, so finding a robust fix means setting up a test rig with multiple 
> Windows machines and testing for multiple drivers to see why some temprary 
> files are being treated as open when other operating systems don't have 
> problems in their removal. Windows users with too small temporary 
> directories. I welcome contributions from people who understand Windows and 
> can actually explain why we see the consequences we see.
>
> One candidate may be to branch to .Call("RGDAL_DeleteHandle", handle, 
> PACKAGE="rgdal") for the GDALTransientDataset case; I'll report back once the 
> package has gone through win-builder.

The Windows binary with this modification is at:

http://win-builder.r-project.org/TO95cIM24UVL

but I do not see that it has altered behaviour under Windows 7 running as 
user. For some reason Windows sees the transient files as open. Please try 
other drivers to ensure that this isn't driver-specific.

Roger



>
> Hope this doesn't muddle too much, clarification doesn't seem like the right 
> expression.
>
> Roger
>
>
> On Sun, 3 Nov 2013, Oliver Soong wrote:
>
>> I've been using the CRAN rgdal and raster.  I apologize in advance for all
>> the linebreaks that will be broken.  This code should highlight the problem
>> and the fix:
>> 
>> 
>> 
>> require(rgdal)
>> require(raster)
>> r1 <- raster(system.file("external/test.grd", package="raster"))
>> r2 <- as(r1, "SpatialGridDataFrame")
>> r2.dims <- gridparameters(r2)$cells.dim
>> r3 <- new("GDALTransientDataset", driver = new("GDALDriver", "GTiff"), rows
>> = r2.dims[2], cols = r2.dims[1], bands = 1, type = "Float32", options =
>> NULL, fname = file.path(tempdir(), "r3.tif"), handle = NULL)
>> print(dir(tempdir()))
>> writeRaster(r1, file.path(tempdir(), "r1.tif"))
>> writeGDAL(r2, file.path(tempdir(), "r2.tif"))
>> print(dir(tempdir()))
>> unlink(dir(tempdir(), full.names = TRUE))
>> print(dir(tempdir()))
>> leftover <- gsub("/", "\\\\", dir(tempdir(), full.names = TRUE))
>> invisible(lapply(paste("cmd /c del", leftover), system))
>> rm(r1, r2, r3)
>> gc()
>> unlink(dir(tempdir(), full.names = TRUE))
>> print(dir(tempdir()))
>> invisible(lapply(paste("cmd /c del", leftover), system))
>> 
>> 
>> 
>> Basically, I'm trying to write a standard raster package raster (r1) and an
>> sp package SpatialGridDataFrame (r2).  Both of those end up calling
>> new("GDALTransientDataset"), hence r3.  At the first print(dir(tempdir())),
>> only r3 has an open temporary file, which is expected.  At the second, all
>> three have open temporary files, and r1 and r2 have their written final
>> outputs, which are closed.  The temporary files for r1 and r2 should have
>> been closed at this point.  None of the temporary files can be removed by
>> unlink, although the final outputs can, as shown at the third
>> print(dir(tempdir())).  Windows can't remove them, either.  However, if I
>> remove the GDALTransientDataset r3 and initiate gc(), R can remove that
>> temporary file, but this does not work for r1 and r2.  After q(), the
>> tempdir() will not be removed by R, but it and the temporary files for r1
>> and r2 can now be removed.
>> 
>> It looks like GDAL.close is broken (again/as always), but the collector
>> function for GDALTransientDataset seems to at least close the handle.
>> GDAL.close relies on RGDAL_CloseDataset, whereas the GDALTransientDataset
>> collector just uses RGDAL_CloseHandle.  With the handle closed, I think the
>> unlink code in GDAL.close will work (as an aside, I'd use the pattern
>> paste0("^[a-z]{3}", basen, "$") to be safer and the argument full.names
>> might be simpler than constructing flf separately).  I believe
>> RGDAL_CloseDataset checks for NULL handles but just returns early, so it
>> should be the same to replace the .Call("RGDAL_CloseDataset", ...) with
>> .Call("RGDAL_CloseHandle", ...).
>> 
>> Really, I think RGDAL_DeleteHandle needs to be fixed, but I don't know
>> enough about GDALDeleteDataset or the #ifndef OSGEO4W deleteFile business
>> or why RGDAL_CloseHandle is commented out to make any useful suggestions
>> there.
>> 
>> Cheers,
>> Oliver
>> 
>> 
>> 
>> 
>> On Fri, Nov 1, 2013 at 1:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> 
>>> On Mon, 28 Oct 2013, Oliver Soong wrote:
>>>
>>>  I've had a long standing struggle with GDAL.close on Windows, and I
>>>> think I might finally have found a fix.  I'm currently running rgdal
>>>> 0.8.11, R 3.0.2, and 32-bit Windows 7.
>>>> 
>>>> Currently, writeRaster and writeGDAL create temporary files in the
>>>> tempdir() folder (the final filename prefixed with 3 random [a-z]
>>>> letters).  On my system, these files get left open and orphaned.  When
>>>> doing heavy processing, this can lead to the drive hosting the
>>>> tempdir() folder to become full, even if the data is being ultimately
>>>> written to a much larger drive.  This also means that R cannot clean
>>>> up these files or the tempdir() folder when it closes, causing similar
>>>> bloat in my %TEMP%.
>>>> 
>>>> I haven't tested this on other platforms, but I think it might help to
>>>> insert an extra line into GDAL.close:
>>>> 
>>>> .setCollectorFun(slot(dataset, "handle"), NULL)
>>>> .Call("RGDAL_CloseHandle", dataset at handle, PACKAGE = "rgdal")
>>>> .Call("RGDAL_CloseDataset", dataset, PACKAGE = "rgdal")
>>>> 
>>>> For whatever reason, RGDAL_CloseDataset doesn't seem to actually close
>>>> the C file handle, but it doesn't seem to mind if the file handle was
>>>> closed beforehand.
>>>> 
>>> 
>>> Could you please provide a working example? I have looked at this, but
>>> need a baseline to know whether I'm looking at the same thing. I'm very
>>> unsure that this is a robust solution, and need an instrumented example,
>>> including listings of the temporary directory during the process, to see
>>> the consequences. Thanks for looking into this, but I'd prefer to be sure
>>> that a Windows-specific fix doesn't make things worse for others too.
>>> Please also report on the source of your Windows rgdal binary - is it from
>>> CRAN or locally built dynamically linking your own GDAL?
>>> 
>>> Best wishes,
>>> 
>>> Roger
>>> 
>>> 
>>>> Cheers,
>>>> Oliver
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>> 
>>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From osoong+r at gmail.com  Tue Nov  5 00:05:05 2013
From: osoong+r at gmail.com (Oliver Soong)
Date: Mon, 4 Nov 2013 15:05:05 -0800
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
Message-ID: <CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131104/d97d51fd/attachment.pl>

From osoong+r at gmail.com  Tue Nov  5 00:05:59 2013
From: osoong+r at gmail.com (Oliver Soong)
Date: Mon, 4 Nov 2013 15:05:59 -0800
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
	<CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>
Message-ID: <CAPQ=hV+ZfhOAGPGuGaQUHWHcfSTSxs=ghrDdoMwz=norCvsj+A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131104/92bb6146/attachment.pl>

From osoong+r at gmail.com  Tue Nov  5 00:16:44 2013
From: osoong+r at gmail.com (Oliver Soong)
Date: Mon, 4 Nov 2013 15:16:44 -0800
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <CAPQ=hV+ZfhOAGPGuGaQUHWHcfSTSxs=ghrDdoMwz=norCvsj+A@mail.gmail.com>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
	<CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>
	<CAPQ=hV+ZfhOAGPGuGaQUHWHcfSTSxs=ghrDdoMwz=norCvsj+A@mail.gmail.com>
Message-ID: <CAPQ=hV+OBfLOfiVHiJ1wEupaCtPznhb7x_XQ6p4n63QviWwDHw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131104/aff3629c/attachment.pl>

From Roger.Bivand at nhh.no  Tue Nov  5 14:56:59 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 5 Nov 2013 14:56:59 +0100
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <CAPQ=hV+OBfLOfiVHiJ1wEupaCtPznhb7x_XQ6p4n63QviWwDHw@mail.gmail.com>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
	<CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>
	<CAPQ=hV+ZfhOAGPGuGaQUHWHcfSTSxs=ghrDdoMwz=norCvsj+A@mail.gmail.com>
	<CAPQ=hV+OBfLOfiVHiJ1wEupaCtPznhb7x_XQ6p4n63QviWwDHw@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1311051421590.32569@reclus.nhh.no>

On Tue, 5 Nov 2013, Oliver Soong wrote:

> Hi Roger,
>
> Toggling on GDALTransientDataset in GDAL.close doesn't change anything
> because RGDAL_CloseDataset already toggles on that.  In either case,
> RGDAL_DeleteHandle still doesn't work.  Also, the gc at the end doesn't do
> anything useful because .setCollectorFun has already trivialized the
> finalizer and because dataset still exists at that point, as does the
> source dataset given to GDAL.close in the first place.
>
> The HFA driver has the exact same issue.  From what I see in the code, I
> don't think it's related to the specific driver.

Here is the next version:

http://win-builder.r-project.org/0X0318s8iW0C

with:

             .setCollectorFun(slot(dataset, 'handle'), NULL)
             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
             .Call("RGDAL_CloseHandle", slot(dataset, 'handle'),
                 PACKAGE="rgdal")

Running under Windows, and using:

http://download.sysinternals.com/files/Handle.zip

to check, the three transient datasets are open:

   3B8: File  (RW-)   C:\Users\rsb\AppData\Local\Temp\Rtmp8kZk0N\awlr2.tif
   3C0: File  (RW-)   C:\Users\rsb\AppData\Local\Temp\Rtmp8kZk0N\tfur1.tif
   498: File  (RW-)   C:\Users\rsb\AppData\Local\Temp\Rtmp8kZk0N\mxbr3.tif

I'm assuming that RW- means read and write open, the third character is D, 
which is probably directory.

Roger

>
> Cheers,
> Oliver
>
>
>
>
> On Mon, Nov 4, 2013 at 3:05 PM, Oliver Soong <osoong+r at gmail.com> wrote:
>
>> Er, just saw your recent e-mail.  I'll take a look.
>>
>> Oliver
>>
>>
>> On Mon, Nov 4, 2013 at 3:05 PM, Oliver Soong <osoong+r at gmail.com> wrote:
>>
>>> I do think we've gotten a bit muddled.  I'm probably not helping, but
>>> I'll do my best.
>>>
>>> Windows XP (32-bit), 7 (32-bit), and 2008 R2 (32-bit and 64-bit),
>>> R-3.0.2, sp 1.0.13, rgdal 0.8.11, raster 2.1.49.
>>>
>>> The main problem as seen by end-users is the orphaned temporary files
>>> that you observed were left over for r1 and r2.  They cannot be removed
>>> while R is running.  I seem not to have explained r3 very well, but suffice
>>> it to say that GDAL.close(r3) creates similar orphaned temporary files,
>>> indicating GDAL.close is not functioning properly on GDALTransientDataset
>>> objects under Windows.
>>>
>>> I think RGDAL_DeleteHandle (and hence RGDAL_CloseDataset) is the root of
>>> the problem, and I think it's not properly closing the file handle before
>>> trying and failing to delete the associated files.  Windows automatically
>>> locks open file handles, but linux requires extra steps that are not always
>>> done and are not always respected, which is probably why this isn't
>>> apparent under linux.  The finalizer code and resetting seems appropriate.
>>>
>>> I still hesitate to say much about RGDAL_DeleteHandle, but I will point
>>> out that one is normally supposed to close the file handle before deleting
>>> the file, and it seems backwards in RGDAL_DeleteHandle.  I don't know if
>>> that is intentional.
>>>
>>> After thinking a little more, I think it's better to switch the calls to
>>> RGDAL_CloseHandle and RGDAL_CloseDataset that I suggested originally for
>>> GDAL.close.  That means simply adding the call to RGDAL_CloseHandle after
>>> the call to RGDAL_CloseDataset, rather than before.  With this code, if
>>> RGDAL_CloseDataset behaves as intended, RGDAL_CloseHandle will get a nil
>>> pointer and won't do anything.  However, if RGDAL_CloseDataset fails to
>>> function properly, RGDAL_CloseHandle will close the open handle and the
>>> if(isTrans) cleanup code already in GDAL.close will operate.
>>>
>>> Perhaps I could be more helpful if you explained what you thought my
>>> suggested change might break?  This last one (the existing
>>> RGDAL_CloseDataset followed by an additional RGDAL_CloseHandle) should be
>>> no worse than the current code.
>>>
>>> Is that at all clearer?
>>>
>>> Oliver
>>>
>>>
>>> On Mon, Nov 4, 2013 at 1:03 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>
>>>> Which Windows? XP, Vista, 7, 8, 8.1? 32 and 64 bit? If Vista/7/8, run as
>>>> administrator or not? I agree that the code in those parts of rgdal is not
>>>> well-designed - it was well-designed, but has been modified so that it
>>>> works for most people cross-platform, and has had to accommodate changes
>>>> that have taken place in GDAL over more than 10 years, not least the
>>>> error-handler.
>>>>
>>>> The simple solution to your practical problem is to for you to use a
>>>> larger temporary drive under Windows, or change to an operating system that
>>>> does not have these side-effects.
>>>>
>>>> Assisting you is not just a matter of doing what you think works for
>>>> you, but making sure it doesn't break anything else for anybody else
>>>> cross-platform.
>>>>
>>>> Your script does not check for other files in tempdir, so I prepended a
>>>> listing of prior content:
>>>>
>>>> pc <- dir(tempdir())
>>>>
>>>> and dropped them from the list for unlinking:
>>>>
>>>> now <- dir(tempdir())
>>>> unlink(paste(tempdir(), now[!(now %in% pc)], sep=.Platform$file.sep))
>>>>
>>>> I do not see how your script exercises the problem. It creates a new
>>>> transient file, but does not close it, which was the behaviour you are
>>>> unhappy with. If I add
>>>>
>>>> GDAL.close(r3)
>>>>
>>>> on Linux, the transient dataset is removed. On Windows 7 64-bit with the
>>>> CRAN rgdal binary run as user, temporary files are left in tempdir for r1,
>>>> r2, and r3. The same three temporary files are left when run as
>>>> administrator.
>>>>
>>>> The earliest version of GDAL.close was:
>>>>
>>>> GDAL.close <- function(dataset) {
>>>>             .setCollectorFun(slot(dataset, 'handle'), NULL)
>>>>             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>>>>             invisible()
>>>> }
>>>>
>>>> with a version in 2007 in the THK branch calling a closeDataset method,
>>>> containing:
>>>>
>>>>             handle <- slot(dataset, "handle")
>>>>             unreg.finalizer(handle)
>>>>             .Call("RGDAL_DeleteHandle", handle, PACKAGE="rgdal")
>>>>
>>>> with:
>>>>
>>>> unreg.finalizer <- function(obj) reg.finalizer(obj, function(x) x)
>>>>
>>>> and by 2010 was:
>>>>
>>>> GDAL.close <- function(dataset) {
>>>>             .setCollectorFun(slot(dataset, 'handle'), NULL)
>>>>             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>>>>             invisible(gc())
>>>> }
>>>>
>>>> Special handling of GDALTransientDataset was added in revision 433 in
>>>> Janual 2013, and modified in revision 462 in April 2013.
>>>>
>>>> It has seemed IIRC that Windows can treat arbitrary files as open. It is
>>>> also possible that there is an interaction between Windows and
>>>> rgdal:::.setCollectorFun(), which does what it should, when given the NULL
>>>> argument, setting:
>>>>
>>>> .setCollectorFun <- function(object, fun) {
>>>>
>>>>   if (is.null(fun)) fun <- function(obj) obj
>>>>   reg.finalizer(object, fun, onexit=TRUE)
>>>>
>>>> }
>>>>
>>>> so incorporating the THK branch logic. It could possibly also vary
>>>> across drivers, so finding a robust fix means setting up a test rig with
>>>> multiple Windows machines and testing for multiple drivers to see why some
>>>> temprary files are being treated as open when other operating systems don't
>>>> have problems in their removal. Windows users with too small temporary
>>>> directories. I welcome contributions from people who understand Windows and
>>>> can actually explain why we see the consequences we see.
>>>>
>>>> One candidate may be to branch to .Call("RGDAL_DeleteHandle", handle,
>>>> PACKAGE="rgdal") for the GDALTransientDataset case; I'll report back once
>>>> the package has gone through win-builder.
>>>>
>>>> Hope this doesn't muddle too much, clarification doesn't seem like the
>>>> right expression.
>>>>
>>>> Roger
>>>>
>>>>
>>>>
>>>> On Sun, 3 Nov 2013, Oliver Soong wrote:
>>>>
>>>>  I've been using the CRAN rgdal and raster.  I apologize in advance for
>>>>> all
>>>>> the linebreaks that will be broken.  This code should highlight the
>>>>> problem
>>>>> and the fix:
>>>>>
>>>>>
>>>>>
>>>>> require(rgdal)
>>>>> require(raster)
>>>>> r1 <- raster(system.file("external/test.grd", package="raster"))
>>>>> r2 <- as(r1, "SpatialGridDataFrame")
>>>>> r2.dims <- gridparameters(r2)$cells.dim
>>>>> r3 <- new("GDALTransientDataset", driver = new("GDALDriver", "GTiff"),
>>>>> rows
>>>>> = r2.dims[2], cols = r2.dims[1], bands = 1, type = "Float32", options =
>>>>> NULL, fname = file.path(tempdir(), "r3.tif"), handle = NULL)
>>>>> print(dir(tempdir()))
>>>>> writeRaster(r1, file.path(tempdir(), "r1.tif"))
>>>>> writeGDAL(r2, file.path(tempdir(), "r2.tif"))
>>>>> print(dir(tempdir()))
>>>>> unlink(dir(tempdir(), full.names = TRUE))
>>>>> print(dir(tempdir()))
>>>>> leftover <- gsub("/", "\\\\", dir(tempdir(), full.names = TRUE))
>>>>> invisible(lapply(paste("cmd /c del", leftover), system))
>>>>> rm(r1, r2, r3)
>>>>> gc()
>>>>> unlink(dir(tempdir(), full.names = TRUE))
>>>>> print(dir(tempdir()))
>>>>> invisible(lapply(paste("cmd /c del", leftover), system))
>>>>>
>>>>>
>>>>>
>>>>> Basically, I'm trying to write a standard raster package raster (r1)
>>>>> and an
>>>>> sp package SpatialGridDataFrame (r2).  Both of those end up calling
>>>>> new("GDALTransientDataset"), hence r3.  At the first
>>>>> print(dir(tempdir())),
>>>>> only r3 has an open temporary file, which is expected.  At the second,
>>>>> all
>>>>> three have open temporary files, and r1 and r2 have their written final
>>>>> outputs, which are closed.  The temporary files for r1 and r2 should
>>>>> have
>>>>> been closed at this point.  None of the temporary files can be removed
>>>>> by
>>>>> unlink, although the final outputs can, as shown at the third
>>>>> print(dir(tempdir())).  Windows can't remove them, either.  However, if
>>>>> I
>>>>> remove the GDALTransientDataset r3 and initiate gc(), R can remove that
>>>>> temporary file, but this does not work for r1 and r2.  After q(), the
>>>>> tempdir() will not be removed by R, but it and the temporary files for
>>>>> r1
>>>>> and r2 can now be removed.
>>>>>
>>>>> It looks like GDAL.close is broken (again/as always), but the collector
>>>>> function for GDALTransientDataset seems to at least close the handle.
>>>>> GDAL.close relies on RGDAL_CloseDataset, whereas the
>>>>> GDALTransientDataset
>>>>> collector just uses RGDAL_CloseHandle.  With the handle closed, I think
>>>>> the
>>>>> unlink code in GDAL.close will work (as an aside, I'd use the pattern
>>>>> paste0("^[a-z]{3}", basen, "$") to be safer and the argument full.names
>>>>> might be simpler than constructing flf separately).  I believe
>>>>> RGDAL_CloseDataset checks for NULL handles but just returns early, so it
>>>>> should be the same to replace the .Call("RGDAL_CloseDataset", ...) with
>>>>> .Call("RGDAL_CloseHandle", ...).
>>>>>
>>>>> Really, I think RGDAL_DeleteHandle needs to be fixed, but I don't know
>>>>> enough about GDALDeleteDataset or the #ifndef OSGEO4W deleteFile
>>>>> business
>>>>> or why RGDAL_CloseHandle is commented out to make any useful suggestions
>>>>> there.
>>>>>
>>>>> Cheers,
>>>>> Oliver
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Fri, Nov 1, 2013 at 1:41 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>> wrote:
>>>>>
>>>>>  On Mon, 28 Oct 2013, Oliver Soong wrote:
>>>>>>
>>>>>>  I've had a long standing struggle with GDAL.close on Windows, and I
>>>>>>
>>>>>>> think I might finally have found a fix.  I'm currently running rgdal
>>>>>>> 0.8.11, R 3.0.2, and 32-bit Windows 7.
>>>>>>>
>>>>>>> Currently, writeRaster and writeGDAL create temporary files in the
>>>>>>> tempdir() folder (the final filename prefixed with 3 random [a-z]
>>>>>>> letters).  On my system, these files get left open and orphaned.  When
>>>>>>> doing heavy processing, this can lead to the drive hosting the
>>>>>>> tempdir() folder to become full, even if the data is being ultimately
>>>>>>> written to a much larger drive.  This also means that R cannot clean
>>>>>>> up these files or the tempdir() folder when it closes, causing similar
>>>>>>> bloat in my %TEMP%.
>>>>>>>
>>>>>>> I haven't tested this on other platforms, but I think it might help to
>>>>>>> insert an extra line into GDAL.close:
>>>>>>>
>>>>>>> .setCollectorFun(slot(dataset, "handle"), NULL)
>>>>>>> .Call("RGDAL_CloseHandle", dataset at handle, PACKAGE = "rgdal")
>>>>>>> .Call("RGDAL_CloseDataset", dataset, PACKAGE = "rgdal")
>>>>>>>
>>>>>>> For whatever reason, RGDAL_CloseDataset doesn't seem to actually close
>>>>>>> the C file handle, but it doesn't seem to mind if the file handle was
>>>>>>> closed beforehand.
>>>>>>>
>>>>>>>
>>>>>> Could you please provide a working example? I have looked at this, but
>>>>>> need a baseline to know whether I'm looking at the same thing. I'm very
>>>>>> unsure that this is a robust solution, and need an instrumented
>>>>>> example,
>>>>>> including listings of the temporary directory during the process, to
>>>>>> see
>>>>>> the consequences. Thanks for looking into this, but I'd prefer to be
>>>>>> sure
>>>>>> that a Windows-specific fix doesn't make things worse for others too.
>>>>>> Please also report on the source of your Windows rgdal binary - is it
>>>>>> from
>>>>>> CRAN or locally built dynamically linking your own GDAL?
>>>>>>
>>>>>> Best wishes,
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>>>  Cheers,
>>>>>>> Oliver
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>>
>>>>>>>  --
>>>>>> Roger Bivand
>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>> --
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>
>>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From abdelrazek at uni-bonn.de  Tue Nov  5 15:58:05 2013
From: abdelrazek at uni-bonn.de (Mohammad Abdel-Razek)
Date: Tue, 05 Nov 2013 15:58:05 +0100
Subject: [R-sig-Geo] MODIS EVI time series missing data interpolation
 (linear or whittaker.raster)
In-Reply-To: <526522D2020000270001D1E7@gwia2.boku.ac.at>
References: <525AA3DC.8090609@uni-bonn.de>
	<526522D2020000270001D1E7@gwia2.boku.ac.at>
Message-ID: <5279077D.9030001@uni-bonn.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131105/fdf43193/attachment.pl>

From npt_eng at hotmail.com  Tue Nov  5 16:58:32 2013
From: npt_eng at hotmail.com (netra)
Date: Tue, 5 Nov 2013 07:58:32 -0800 (PST)
Subject: [R-sig-Geo] raster interpolation within shape file
In-Reply-To: <CAGFWpku54cBXQiAtjAOQ=-VPwB3Mu0C_kPstQ0o1oWOk7Em9Fw@mail.gmail.com>
References: <1383227955294-7585003.post@n2.nabble.com>
	<CAGFWpksOdONx9eE6FH711mw-tVSg5Ak0kV=c924+mCs0NoJfVg@mail.gmail.com>
	<1383293097039-7585011.post@n2.nabble.com>
	<CAGFWpku54cBXQiAtjAOQ=-VPwB3Mu0C_kPstQ0o1oWOk7Em9Fw@mail.gmail.com>
Message-ID: <1383667112743-7585048.post@n2.nabble.com>

making spatialPixels form raster is fine. But the interpolation function
accept only raster object. is your interpolation function from "raster
package"?

bets
Netra



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-interpolation-within-shape-file-tp7585003p7585048.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From osoong+r at gmail.com  Tue Nov  5 20:20:28 2013
From: osoong+r at gmail.com (Oliver Soong)
Date: Tue, 5 Nov 2013 11:20:28 -0800
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <alpine.LRH.2.03.1311051421590.32569@reclus.nhh.no>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
	<CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>
	<CAPQ=hV+ZfhOAGPGuGaQUHWHcfSTSxs=ghrDdoMwz=norCvsj+A@mail.gmail.com>
	<CAPQ=hV+OBfLOfiVHiJ1wEupaCtPznhb7x_XQ6p4n63QviWwDHw@mail.gmail.com>
	<alpine.LRH.2.03.1311051421590.32569@reclus.nhh.no>
Message-ID: <CAPQ=hV+1PrAra+50wUtVUTdkKeKV29_Vu+-MCkcYPvwEsbzu1A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131105/d6675325/attachment.pl>

From Roger.Bivand at nhh.no  Tue Nov  5 20:50:45 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 5 Nov 2013 20:50:45 +0100
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <CAPQ=hV+1PrAra+50wUtVUTdkKeKV29_Vu+-MCkcYPvwEsbzu1A@mail.gmail.com>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
	<CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>
	<CAPQ=hV+ZfhOAGPGuGaQUHWHcfSTSxs=ghrDdoMwz=norCvsj+A@mail.gmail.com>
	<CAPQ=hV+OBfLOfiVHiJ1wEupaCtPznhb7x_XQ6p4n63QviWwDHw@mail.gmail.com>
	<alpine.LRH.2.03.1311051421590.32569@reclus.nhh.no>
	<CAPQ=hV+1PrAra+50wUtVUTdkKeKV29_Vu+-MCkcYPvwEsbzu1A@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1311052045160.1859@reclus.nhh.no>

On Tue, 5 Nov 2013, Oliver Soong wrote:

> Hi Roger,
>
> I forgot that RGDAL_CloseDataset nils dataset at handle, which means the
> subsequent RGDAL_CloseHandle can't find the handle to close.  It also means
> that GDAL.close should replace RGDAL_CloseDataset with RGDAL_CloseHandle.
> On linux, this will cause temporary datasets to be removed by the isTrans
> unlink code instead of GDALDeleteDataset, but it should make things work on
> Windows.  I don't know if there are drivers that might create files that
> don't match the unlink pattern.
>
> I do think it would be better to ultimately fix RGDAL_DeleteHandle.  Under
> normal circumstances, I would call RGDAL_CloseHandle (or equivalently call
> GDALClose and R_ClearExternalPtr directly) and then GDALDeleteDataset.  I'm
> still uncertain why the ordering is reversed or what the (commented out)
> #ifndef OSGEO4W deleteFile business is about.

Thanks to Even Rouault on gdal-dev, I think that:

http://win-builder.r-project.org/jJIzeDT1C100

contains a fixed version, with RGDAL_DeleteHandle now closing the dataset 
before deleting it. This worked on Linux and Windows in a rough cut, and 
this one after removing the unneeded unlink() call in GDAL.close() now 
works on Linux, and should also work on Windows. Behaviour on Linux and 
Windows with respect to transient datasets being deleted is now the same. 
It was helpful that you stayed with this, it was far from simple, as Even 
explained on the gdal-dev thread.

Roger

>
> Cheers,
> Oliver
>
>
>
>
> On Tue, Nov 5, 2013 at 5:56 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Tue, 5 Nov 2013, Oliver Soong wrote:
>>
>>  Hi Roger,
>>>
>>> Toggling on GDALTransientDataset in GDAL.close doesn't change anything
>>> because RGDAL_CloseDataset already toggles on that.  In either case,
>>> RGDAL_DeleteHandle still doesn't work.  Also, the gc at the end doesn't do
>>> anything useful because .setCollectorFun has already trivialized the
>>> finalizer and because dataset still exists at that point, as does the
>>> source dataset given to GDAL.close in the first place.
>>>
>>> The HFA driver has the exact same issue.  From what I see in the code, I
>>> don't think it's related to the specific driver.
>>>
>>
>> Here is the next version:
>>
>> http://win-builder.r-project.org/0X0318s8iW0C
>>
>> with:
>>
>>
>>             .setCollectorFun(slot(dataset, 'handle'), NULL)
>>             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>>             .Call("RGDAL_CloseHandle", slot(dataset, 'handle'),
>>                 PACKAGE="rgdal")
>>
>> Running under Windows, and using:
>>
>> http://download.sysinternals.com/files/Handle.zip
>>
>> to check, the three transient datasets are open:
>>
>>   3B8: File  (RW-)   C:\Users\rsb\AppData\Local\Temp\Rtmp8kZk0N\awlr2.tif
>>   3C0: File  (RW-)   C:\Users\rsb\AppData\Local\Temp\Rtmp8kZk0N\tfur1.tif
>>   498: File  (RW-)   C:\Users\rsb\AppData\Local\Temp\Rtmp8kZk0N\mxbr3.tif
>>
>> I'm assuming that RW- means read and write open, the third character is D,
>> which is probably directory.
>>
>> Roger
>>
>>
>>
>>> Cheers,
>>> Oliver
>>>
>>>
>>>
>>>
>>> On Mon, Nov 4, 2013 at 3:05 PM, Oliver Soong <osoong+r at gmail.com> wrote:
>>>
>>>  Er, just saw your recent e-mail.  I'll take a look.
>>>>
>>>> Oliver
>>>>
>>>>
>>>> On Mon, Nov 4, 2013 at 3:05 PM, Oliver Soong <osoong+r at gmail.com> wrote:
>>>>
>>>>  I do think we've gotten a bit muddled.  I'm probably not helping, but
>>>>> I'll do my best.
>>>>>
>>>>> Windows XP (32-bit), 7 (32-bit), and 2008 R2 (32-bit and 64-bit),
>>>>> R-3.0.2, sp 1.0.13, rgdal 0.8.11, raster 2.1.49.
>>>>>
>>>>> The main problem as seen by end-users is the orphaned temporary files
>>>>> that you observed were left over for r1 and r2.  They cannot be removed
>>>>> while R is running.  I seem not to have explained r3 very well, but
>>>>> suffice
>>>>> it to say that GDAL.close(r3) creates similar orphaned temporary files,
>>>>> indicating GDAL.close is not functioning properly on
>>>>> GDALTransientDataset
>>>>> objects under Windows.
>>>>>
>>>>> I think RGDAL_DeleteHandle (and hence RGDAL_CloseDataset) is the root of
>>>>> the problem, and I think it's not properly closing the file handle
>>>>> before
>>>>> trying and failing to delete the associated files.  Windows
>>>>> automatically
>>>>> locks open file handles, but linux requires extra steps that are not
>>>>> always
>>>>> done and are not always respected, which is probably why this isn't
>>>>> apparent under linux.  The finalizer code and resetting seems
>>>>> appropriate.
>>>>>
>>>>> I still hesitate to say much about RGDAL_DeleteHandle, but I will point
>>>>> out that one is normally supposed to close the file handle before
>>>>> deleting
>>>>> the file, and it seems backwards in RGDAL_DeleteHandle.  I don't know if
>>>>> that is intentional.
>>>>>
>>>>> After thinking a little more, I think it's better to switch the calls to
>>>>> RGDAL_CloseHandle and RGDAL_CloseDataset that I suggested originally for
>>>>> GDAL.close.  That means simply adding the call to RGDAL_CloseHandle
>>>>> after
>>>>> the call to RGDAL_CloseDataset, rather than before.  With this code, if
>>>>> RGDAL_CloseDataset behaves as intended, RGDAL_CloseHandle will get a nil
>>>>> pointer and won't do anything.  However, if RGDAL_CloseDataset fails to
>>>>> function properly, RGDAL_CloseHandle will close the open handle and the
>>>>> if(isTrans) cleanup code already in GDAL.close will operate.
>>>>>
>>>>> Perhaps I could be more helpful if you explained what you thought my
>>>>> suggested change might break?  This last one (the existing
>>>>> RGDAL_CloseDataset followed by an additional RGDAL_CloseHandle) should
>>>>> be
>>>>> no worse than the current code.
>>>>>
>>>>> Is that at all clearer?
>>>>>
>>>>> Oliver
>>>>>
>>>>>
>>>>> On Mon, Nov 4, 2013 at 1:03 PM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>> wrote:
>>>>>
>>>>>  Which Windows? XP, Vista, 7, 8, 8.1? 32 and 64 bit? If Vista/7/8, run
>>>>>> as
>>>>>> administrator or not? I agree that the code in those parts of rgdal is
>>>>>> not
>>>>>> well-designed - it was well-designed, but has been modified so that it
>>>>>> works for most people cross-platform, and has had to accommodate
>>>>>> changes
>>>>>> that have taken place in GDAL over more than 10 years, not least the
>>>>>> error-handler.
>>>>>>
>>>>>> The simple solution to your practical problem is to for you to use a
>>>>>> larger temporary drive under Windows, or change to an operating system
>>>>>> that
>>>>>> does not have these side-effects.
>>>>>>
>>>>>> Assisting you is not just a matter of doing what you think works for
>>>>>> you, but making sure it doesn't break anything else for anybody else
>>>>>> cross-platform.
>>>>>>
>>>>>> Your script does not check for other files in tempdir, so I prepended a
>>>>>> listing of prior content:
>>>>>>
>>>>>> pc <- dir(tempdir())
>>>>>>
>>>>>> and dropped them from the list for unlinking:
>>>>>>
>>>>>> now <- dir(tempdir())
>>>>>> unlink(paste(tempdir(), now[!(now %in% pc)], sep=.Platform$file.sep))
>>>>>>
>>>>>> I do not see how your script exercises the problem. It creates a new
>>>>>> transient file, but does not close it, which was the behaviour you are
>>>>>> unhappy with. If I add
>>>>>>
>>>>>> GDAL.close(r3)
>>>>>>
>>>>>> on Linux, the transient dataset is removed. On Windows 7 64-bit with
>>>>>> the
>>>>>> CRAN rgdal binary run as user, temporary files are left in tempdir for
>>>>>> r1,
>>>>>> r2, and r3. The same three temporary files are left when run as
>>>>>> administrator.
>>>>>>
>>>>>> The earliest version of GDAL.close was:
>>>>>>
>>>>>> GDAL.close <- function(dataset) {
>>>>>>             .setCollectorFun(slot(dataset, 'handle'), NULL)
>>>>>>             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>>>>>>             invisible()
>>>>>> }
>>>>>>
>>>>>> with a version in 2007 in the THK branch calling a closeDataset method,
>>>>>> containing:
>>>>>>
>>>>>>             handle <- slot(dataset, "handle")
>>>>>>             unreg.finalizer(handle)
>>>>>>             .Call("RGDAL_DeleteHandle", handle, PACKAGE="rgdal")
>>>>>>
>>>>>> with:
>>>>>>
>>>>>> unreg.finalizer <- function(obj) reg.finalizer(obj, function(x) x)
>>>>>>
>>>>>> and by 2010 was:
>>>>>>
>>>>>> GDAL.close <- function(dataset) {
>>>>>>             .setCollectorFun(slot(dataset, 'handle'), NULL)
>>>>>>             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>>>>>>             invisible(gc())
>>>>>> }
>>>>>>
>>>>>> Special handling of GDALTransientDataset was added in revision 433 in
>>>>>> Janual 2013, and modified in revision 462 in April 2013.
>>>>>>
>>>>>> It has seemed IIRC that Windows can treat arbitrary files as open. It
>>>>>> is
>>>>>> also possible that there is an interaction between Windows and
>>>>>> rgdal:::.setCollectorFun(), which does what it should, when given the
>>>>>> NULL
>>>>>> argument, setting:
>>>>>>
>>>>>> .setCollectorFun <- function(object, fun) {
>>>>>>
>>>>>>   if (is.null(fun)) fun <- function(obj) obj
>>>>>>   reg.finalizer(object, fun, onexit=TRUE)
>>>>>>
>>>>>> }
>>>>>>
>>>>>> so incorporating the THK branch logic. It could possibly also vary
>>>>>> across drivers, so finding a robust fix means setting up a test rig
>>>>>> with
>>>>>> multiple Windows machines and testing for multiple drivers to see why
>>>>>> some
>>>>>> temprary files are being treated as open when other operating systems
>>>>>> don't
>>>>>> have problems in their removal. Windows users with too small temporary
>>>>>> directories. I welcome contributions from people who understand
>>>>>> Windows and
>>>>>> can actually explain why we see the consequences we see.
>>>>>>
>>>>>> One candidate may be to branch to .Call("RGDAL_DeleteHandle", handle,
>>>>>> PACKAGE="rgdal") for the GDALTransientDataset case; I'll report back
>>>>>> once
>>>>>> the package has gone through win-builder.
>>>>>>
>>>>>> Hope this doesn't muddle too much, clarification doesn't seem like the
>>>>>> right expression.
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Sun, 3 Nov 2013, Oliver Soong wrote:
>>>>>>
>>>>>>  I've been using the CRAN rgdal and raster.  I apologize in advance for
>>>>>>
>>>>>>> all
>>>>>>> the linebreaks that will be broken.  This code should highlight the
>>>>>>> problem
>>>>>>> and the fix:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> require(rgdal)
>>>>>>> require(raster)
>>>>>>> r1 <- raster(system.file("external/test.grd", package="raster"))
>>>>>>> r2 <- as(r1, "SpatialGridDataFrame")
>>>>>>> r2.dims <- gridparameters(r2)$cells.dim
>>>>>>> r3 <- new("GDALTransientDataset", driver = new("GDALDriver", "GTiff"),
>>>>>>> rows
>>>>>>> = r2.dims[2], cols = r2.dims[1], bands = 1, type = "Float32", options
>>>>>>> =
>>>>>>> NULL, fname = file.path(tempdir(), "r3.tif"), handle = NULL)
>>>>>>> print(dir(tempdir()))
>>>>>>> writeRaster(r1, file.path(tempdir(), "r1.tif"))
>>>>>>> writeGDAL(r2, file.path(tempdir(), "r2.tif"))
>>>>>>> print(dir(tempdir()))
>>>>>>> unlink(dir(tempdir(), full.names = TRUE))
>>>>>>> print(dir(tempdir()))
>>>>>>> leftover <- gsub("/", "\\\\", dir(tempdir(), full.names = TRUE))
>>>>>>> invisible(lapply(paste("cmd /c del", leftover), system))
>>>>>>> rm(r1, r2, r3)
>>>>>>> gc()
>>>>>>> unlink(dir(tempdir(), full.names = TRUE))
>>>>>>> print(dir(tempdir()))
>>>>>>> invisible(lapply(paste("cmd /c del", leftover), system))
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Basically, I'm trying to write a standard raster package raster (r1)
>>>>>>> and an
>>>>>>> sp package SpatialGridDataFrame (r2).  Both of those end up calling
>>>>>>> new("GDALTransientDataset"), hence r3.  At the first
>>>>>>> print(dir(tempdir())),
>>>>>>> only r3 has an open temporary file, which is expected.  At the second,
>>>>>>> all
>>>>>>> three have open temporary files, and r1 and r2 have their written
>>>>>>> final
>>>>>>> outputs, which are closed.  The temporary files for r1 and r2 should
>>>>>>> have
>>>>>>> been closed at this point.  None of the temporary files can be removed
>>>>>>> by
>>>>>>> unlink, although the final outputs can, as shown at the third
>>>>>>> print(dir(tempdir())).  Windows can't remove them, either.  However,
>>>>>>> if
>>>>>>> I
>>>>>>> remove the GDALTransientDataset r3 and initiate gc(), R can remove
>>>>>>> that
>>>>>>> temporary file, but this does not work for r1 and r2.  After q(), the
>>>>>>> tempdir() will not be removed by R, but it and the temporary files for
>>>>>>> r1
>>>>>>> and r2 can now be removed.
>>>>>>>
>>>>>>> It looks like GDAL.close is broken (again/as always), but the
>>>>>>> collector
>>>>>>> function for GDALTransientDataset seems to at least close the handle.
>>>>>>> GDAL.close relies on RGDAL_CloseDataset, whereas the
>>>>>>> GDALTransientDataset
>>>>>>> collector just uses RGDAL_CloseHandle.  With the handle closed, I
>>>>>>> think
>>>>>>> the
>>>>>>> unlink code in GDAL.close will work (as an aside, I'd use the pattern
>>>>>>> paste0("^[a-z]{3}", basen, "$") to be safer and the argument
>>>>>>> full.names
>>>>>>> might be simpler than constructing flf separately).  I believe
>>>>>>> RGDAL_CloseDataset checks for NULL handles but just returns early, so
>>>>>>> it
>>>>>>> should be the same to replace the .Call("RGDAL_CloseDataset", ...)
>>>>>>> with
>>>>>>> .Call("RGDAL_CloseHandle", ...).
>>>>>>>
>>>>>>> Really, I think RGDAL_DeleteHandle needs to be fixed, but I don't know
>>>>>>> enough about GDALDeleteDataset or the #ifndef OSGEO4W deleteFile
>>>>>>> business
>>>>>>> or why RGDAL_CloseHandle is commented out to make any useful
>>>>>>> suggestions
>>>>>>> there.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Oliver
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On Fri, Nov 1, 2013 at 1:41 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>>>> wrote:
>>>>>>>
>>>>>>>  On Mon, 28 Oct 2013, Oliver Soong wrote:
>>>>>>>
>>>>>>>>
>>>>>>>>  I've had a long standing struggle with GDAL.close on Windows, and I
>>>>>>>>
>>>>>>>>  think I might finally have found a fix.  I'm currently running rgdal
>>>>>>>>> 0.8.11, R 3.0.2, and 32-bit Windows 7.
>>>>>>>>>
>>>>>>>>> Currently, writeRaster and writeGDAL create temporary files in the
>>>>>>>>> tempdir() folder (the final filename prefixed with 3 random [a-z]
>>>>>>>>> letters).  On my system, these files get left open and orphaned.
>>>>>>>>>  When
>>>>>>>>> doing heavy processing, this can lead to the drive hosting the
>>>>>>>>> tempdir() folder to become full, even if the data is being
>>>>>>>>> ultimately
>>>>>>>>> written to a much larger drive.  This also means that R cannot clean
>>>>>>>>> up these files or the tempdir() folder when it closes, causing
>>>>>>>>> similar
>>>>>>>>> bloat in my %TEMP%.
>>>>>>>>>
>>>>>>>>> I haven't tested this on other platforms, but I think it might help
>>>>>>>>> to
>>>>>>>>> insert an extra line into GDAL.close:
>>>>>>>>>
>>>>>>>>> .setCollectorFun(slot(dataset, "handle"), NULL)
>>>>>>>>> .Call("RGDAL_CloseHandle", dataset at handle, PACKAGE = "rgdal")
>>>>>>>>> .Call("RGDAL_CloseDataset", dataset, PACKAGE = "rgdal")
>>>>>>>>>
>>>>>>>>> For whatever reason, RGDAL_CloseDataset doesn't seem to actually
>>>>>>>>> close
>>>>>>>>> the C file handle, but it doesn't seem to mind if the file handle
>>>>>>>>> was
>>>>>>>>> closed beforehand.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>  Could you please provide a working example? I have looked at this,
>>>>>>>> but
>>>>>>>> need a baseline to know whether I'm looking at the same thing. I'm
>>>>>>>> very
>>>>>>>> unsure that this is a robust solution, and need an instrumented
>>>>>>>> example,
>>>>>>>> including listings of the temporary directory during the process, to
>>>>>>>> see
>>>>>>>> the consequences. Thanks for looking into this, but I'd prefer to be
>>>>>>>> sure
>>>>>>>> that a Windows-specific fix doesn't make things worse for others too.
>>>>>>>> Please also report on the source of your Windows rgdal binary - is it
>>>>>>>> from
>>>>>>>> CRAN or locally built dynamically linking your own GDAL?
>>>>>>>>
>>>>>>>> Best wishes,
>>>>>>>>
>>>>>>>> Roger
>>>>>>>>
>>>>>>>>
>>>>>>>>  Cheers,
>>>>>>>>
>>>>>>>>> Oliver
>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>  --
>>>>>>>>>
>>>>>>>> Roger Bivand
>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>  --
>>>>>> Roger Bivand
>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From matteo.mattiuzzi at boku.ac.at  Wed Nov  6 09:32:00 2013
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Wed, 06 Nov 2013 09:32:00 +0100
Subject: [R-sig-Geo] MODIS EVI time series missing data interpolation
 (linear or whittaker.raster)
In-Reply-To: <5279077D.9030001@uni-bonn.de>
References: <525AA3DC.8090609@uni-bonn.de>
	<526522D2020000270001D1E7@gwia2.boku.ac.at>
	<5279077D.9030001@uni-bonn.de>
Message-ID: <527A0C90020000270001D764@gwia2.boku.ac.at>

Mohammad:you still leave open a lot of important details especially on how you processed the data.
The function whittaker.raster() has 3 important data inputs:
vi: vegetation index layer
w: VI qualitiy layer, derivate of it or any custom indicator
t: composite day of the year layer


if you provide 't' the function 'repDoy' generates (internally) a vector where each pixel value is placed on the exact DOY of it acquisition (if not the date in the filename is used), the output is always equally spaced depending on your 'timeInfo' argument. So the linear interpolation should not be needed, and I would also say a less good solution.
I don't know what parameters you have used: lambda? niter? outlier? pillow? 


I have no idea what the problem could be that causes the difference. Maybe post a self containing example (restricted area!) (but I currently have very little time to share).


Matteo

>>> Mohammad Abdel-Razek <abdelrazek at uni-bonn.de> 11/05/13 3:58 PM >>>
Matteo,
Thanks for your reply

1. Yes it is MOD13Q1 series,

2. interpNA function I used is from timeSeries package

3. I re-did the filtering this time with MODIS pixel quality as you 
suggested, which is much easier than my method :)

I used the whittaker on both filtered and raw evi time series, still it 
dosn't give me a clear indication of land use change (compared to 
published papers for the same point coordinates)


What seems to be the problem is the interpolation /before /whittaker. In 
this research 
(http://www.dsr.inpe.br/laf/series/artigos/Freitas_Ramon_M_et_al_2011_JCIS_Virtual_laboratory_of_remote_sensing_time_series.pdf) 
the authors did the following:

"The filtered data were then linear interpolated based on the date of 
the pixel of the image composition to provide equally spaced time series."

They did it with Matlab, is there a way to do it in R?


Thanks again

Mohammad


On 21.10.2013 12:49, Matteo Mattiuzzi wrote:
> Mohammad,read answers inline
>
>>>> Mohammad Abdel-Razek<abdelrazek at uni-bonn.de>  10/13/13 3:46 PM >>>
> Dear All,
> I am analyzing MODIS EVI time sereis for 2004-2010. Preprocessing
> included: reprojecting to WGS84 and export EVI to Geotiff (along with
> blue reflectance and view zenith angel). Then I filtered out cloudy
> (blue reflectance more than 10%) and off-nadir (angel > 32.5) pixels.
> Now, I am trying to interpolate the missing values, so I tried the
> following:
>
> - MODIS EVI (MOD13Q1??) eventually has quality layers with a good cloud info! (see the MODIS:::detectBitinfo function:  detectBitInfo("MOD13Q1") # the VI usefulness. and MODIS:::extractBits to access this info.
>
> #first linear interpolation
> #convert Tiffs to points (rasterToPoints)
>   > r01 <- raster("2004001_evi_filtered.tif")/10000
>   >r01_p <- rasterToPoints(r89,fun=function(x){x>-0.9999})
> #Then bind EVI columns, along with X,Y coordinates:
>   >evi <- rbind ( EVI2004_1_1=r01_p[,3], EVI2004_1_17=r02_p[,3],
> .......,X= r153_p[,1], Y= r153_p[,2] )
> #set 0 values to NA
>   >evi[evi == 0] <- NA
>   >evi=interpNA(evi, method = "linear")
>
> - please be precise, in which package is 'interpNA'
>
> then I transposed the evi to plot it with plotKML
>
>
> Now I am trying to use alternative interpolation method for better
> results. MODIS package offer whittaker.raster filtering algorithm
>
>   >evi2 = preStack(pattern = "*.tif", path = "path/to/file")
>   >timeInfo <- orgTime(evi2,nDays=16,begin="2004001",end="2010241",pillow=40)
>   >evi2 <- preStack(files=evi2,timeInfo=timeInfo)
>   >beginCluster(type="SOCK",exclude="MODIS") # See: ?beginCluster
>   >system.time(whittaker.raster(evi2,timeInfo=timeInfo,lambda=1000))
>
> My questions are:
> 1. Is the modified whittaker filter functionreally suitable for
> interpolation in my case?
> - yes the whittaker implementation in the MODIS package is suitable for all (?) time series where the bias is negative, where you can expect that if data is of bad quality (ie some clouds) the error is negatively biased, or that data with higher values is probably of better quality than lower values. For more details please check the publication in ?whittaker.raster.
>
> 2. How to destack the resulting GeoTiffs (from whittaker.raster)? I want
> to plot the series using plotKML to visualize the results
> - yes I know this should be possible, but isn't implemented, but you could do writeRaster(...,bylayer=T) after filtering.
>
>
> 3. Some researchers suggested wavelet transformation to smooth the data,
> is that comprable to whittaker function?
> - Sorry I don't know, but I think recent publications are going more in direction of spline like methods (whittaker, savitzky-golay, smooth spline,...).
>
> Thank you in advance
>
> Mohammad
>
> p.s. I am new to r and would appreciate simple explanations!
>
> Good luck
> Matteo
>
>
>

-- 
PhD Candidate
Institute of Crop Science and Resource Protection
Crop Science Research Group
Katzenburgweg 5 - 53115 Bonn - Germany
Tel.: +49 (0) 228 73 2030     Fax: +49 (0) 228 73 2870
abdelrazek at uni-bonn.de         http://www.lap.uni-bonn.de


From junhufr at gmail.com  Wed Nov  6 10:18:27 2013
From: junhufr at gmail.com (Jun HU)
Date: Wed, 6 Nov 2013 10:18:27 +0100
Subject: [R-sig-Geo] Prediction with krigeST
Message-ID: <CAALsg422nppb7hYeupsMc6Erzcinma0pBQ76xZiPz8e86iD9fQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131106/c088fb38/attachment.pl>

From noelia.gonzalezm at gmail.com  Wed Nov  6 10:34:06 2013
From: noelia.gonzalezm at gmail.com (Acacia dealbata)
Date: Wed, 6 Nov 2013 01:34:06 -0800 (PST)
Subject: [R-sig-Geo] Aggregate raster
In-Reply-To: <1383555413455-7585029.post@n2.nabble.com>
References: <1383152610567-7584991.post@n2.nabble.com>
	<1383329453075-7585021.post@n2.nabble.com>
	<CABG0rfvVT+dWWyECFsyBt9MWcToeOjDzjnG-VcpJO7wyuFwsDQ@mail.gmail.com>
	<1383555413455-7585029.post@n2.nabble.com>
Message-ID: <1383730446152-7585055.post@n2.nabble.com>

Hi! After one night running I did not get my resampled map, so I  think there
should be a problem with the original maps?



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Aggregate-raster-tp7584991p7585055.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ben.graeler at uni-muenster.de  Wed Nov  6 11:13:43 2013
From: ben.graeler at uni-muenster.de (=?ISO-8859-1?Q?Benedikt_Gr=E4ler?=)
Date: Wed, 06 Nov 2013 11:13:43 +0100
Subject: [R-sig-Geo] Prediction with krigeST
In-Reply-To: <CAALsg422nppb7hYeupsMc6Erzcinma0pBQ76xZiPz8e86iD9fQ@mail.gmail.com>
References: <CAALsg422nppb7hYeupsMc6Erzcinma0pBQ76xZiPz8e86iD9fQ@mail.gmail.com>
Message-ID: <527A1657.6050300@uni-muenster.de>

Dear Jun,

that is hard to tell without knowing the structure of your "data" and
"newdata" objects. I was not able to reproduce your issue with our test
cases and would suspect some NA values to cause it. Please note that the
latest version of gstat (available from r-forge), does as well support
STSDF and STIDF allowing for non regular data sets.

In case the problem persists in the latest version of gstat (1.0-18)
using a STSDF, please provide me (offlist) with some additional
information on your R set-up (sessionInfo()), the structure of your data
and a minimal example reproducing the issue.

Best wishes,

 Ben


On 06.11.2013 10:18, Jun HU wrote:
> Dear all,
> 
> I'm new in R and Spatiotemporal kriging,  I've a naive question, I've
> constructed a STFDF object with the first 4 hours historical data, and want
> to forecast the fifth hour data. By using krigeST in R, I've constructed
> vgm model. But after launching:
> 
> pred = krigeST(formula=values~1, data=mystfdf, newdata = My_pred,
> modelList=myVgm)
> 
> everything seems working fine, but the pred object only contains historical
> data, without prediction data. Any idea? Thank you in advance.
> 
> 
> 
> Sincerely,
> 
> 
> Jun
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Benedikt Gr?ler

ifgi - Institute for Geoinformatics
University of Muenster

http://ifgi.uni-muenster.de/graeler

Phone: +49 251 83-33082
Mail: ben.graeler at uni-muenster.de

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 560 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131106/baf6abc2/attachment.bin>

From junhufr at gmail.com  Wed Nov  6 12:45:39 2013
From: junhufr at gmail.com (Jun HU)
Date: Wed, 6 Nov 2013 12:45:39 +0100
Subject: [R-sig-Geo] Prediction with krigeST
In-Reply-To: <527A1657.6050300@uni-muenster.de>
References: <CAALsg422nppb7hYeupsMc6Erzcinma0pBQ76xZiPz8e86iD9fQ@mail.gmail.com>
	<527A1657.6050300@uni-muenster.de>
Message-ID: <CAALsg407KFgbK_v29sJV9B_oHj5CmoVf06nS0xXeRRXMfrwgfQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131106/5a4aa1d0/attachment.pl>

From eddieatr at gmail.com  Wed Nov  6 12:53:26 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Wed, 6 Nov 2013 11:53:26 +0000
Subject: [R-sig-Geo] Fit a sine curve to raster stack
In-Reply-To: <CE9ADA9A.BEE4%jan.verbesselt@wur.nl>
References: <CAB5R0=W4fP6nACWFGGdYAK-7R8xc0o8HRUGDCtiaJYb3-OcmZg@mail.gmail.com>
	<CE9ADA9A.BEE4%jan.verbesselt@wur.nl>
Message-ID: <CABaJH78P4TPbG4pR4a1kTGABE7jZv-o0C=TuQvnW7LVSgfHDew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131106/2bce905e/attachment.pl>

From larroque.jeremy at gmail.com  Wed Nov  6 16:34:21 2013
From: larroque.jeremy at gmail.com (Jeremy Larroque)
Date: Wed, 6 Nov 2013 16:34:21 +0100
Subject: [R-sig-Geo] Least-cost path in meter
In-Reply-To: <1382625243.24142.YahooMailNeo@web133204.mail.ir2.yahoo.com>
References: <CAGaZB31EY=ieBf5_cZZqU=+E2uiVdhaiHAcRqkjrJE8BVhSJ1A@mail.gmail.com>
	<1382625243.24142.YahooMailNeo@web133204.mail.ir2.yahoo.com>
Message-ID: <CAGaZB333-qmU--cOERveLoks4o81ODhma1GynOqhqC2idthNCg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131106/78b645e1/attachment.pl>

From ben.graeler at uni-muenster.de  Wed Nov  6 17:16:28 2013
From: ben.graeler at uni-muenster.de (=?ISO-8859-1?Q?Benedikt_Gr=E4ler?=)
Date: Wed, 06 Nov 2013 17:16:28 +0100
Subject: [R-sig-Geo] Prediction with krigeST
In-Reply-To: <CAALsg407KFgbK_v29sJV9B_oHj5CmoVf06nS0xXeRRXMfrwgfQ@mail.gmail.com>
References: <CAALsg422nppb7hYeupsMc6Erzcinma0pBQ76xZiPz8e86iD9fQ@mail.gmail.com>	<527A1657.6050300@uni-muenster.de>
	<CAALsg407KFgbK_v29sJV9B_oHj5CmoVf06nS0xXeRRXMfrwgfQ@mail.gmail.com>
Message-ID: <527A6B5C.4080001@uni-muenster.de>

Dear Jun,

the reason why you get a constant map for your forecast is most likely
associated with the temporal range of your model (note that krigeST
might expect a different temporal unit (typically seconds) than was used
in the variogram model definition). If you do not have any locations
within the range, the kriging estimate is the mean of the random field.
To allow for a changing mean with time, you might want to limit the
kriging prediction to few temporal slices. However, extrapolation (i.e
forecasting) is a topic with several challenges and potential pitfalls -
kriging might not be the best choice here.

Hope this helps,

 Ben

On 06.11.2013 12:45, Jun HU wrote:
> Dear Benedikt, 
> 
> Thank a lot for your reply. I found my problem which is associated with
> newdata, actually i've used same time series in newdata. After creating
> the new time series, I got the prediction results, but the values are
> all same, I thought it's the problem of my variogram model. Currently, I
> attempt to apply the spatiotemporal model in predicting mobile network
> traffic.  As i've the historical traffic data for each mobile network
> cells, I attempt to forecast the traffic in following hours.  Here is a
> snapshot of my data:
> 
> 5847 	15056 	8 	0 	121 	117
> 5807 	15065 	1 	3 	131 	131
> 5847 	15035 	22 	18 	898 	1123
> 5830 	15067 	12 	18 	197 	231
> 5861 	15036 	3 	7 	189 	185
> 5874 	15053 	6 	5 	113 	105
> 5859 	15020 	116 	49 	1270 	1493
> 
> 
> 
> First two columns are the position of mobile station (x, y), the
> following four columns are the traffic between (00:00 - 03:00), I've
> converted it into STFDF data, with (x,y) as sp, and a list of four
> columns data as data. Also I'd like to your advices on my approach to
> predict the traffic in mobile network. Thank you in advance. 
> 
> 
> 
> Sincerely, 
> 
> 
> Jun
> 
> 
> 
> 2013/11/6 Benedikt Gr?ler <ben.graeler at uni-muenster.de
> <mailto:ben.graeler at uni-muenster.de>>
> 
>     Dear Jun,
> 
>     that is hard to tell without knowing the structure of your "data" and
>     "newdata" objects. I was not able to reproduce your issue with our test
>     cases and would suspect some NA values to cause it. Please note that the
>     latest version of gstat (available from r-forge), does as well support
>     STSDF and STIDF allowing for non regular data sets.
> 
>     In case the problem persists in the latest version of gstat (1.0-18)
>     using a STSDF, please provide me (offlist) with some additional
>     information on your R set-up (sessionInfo()), the structure of your data
>     and a minimal example reproducing the issue.
> 
>     Best wishes,
> 
>      Ben
> 
> 
>     On 06.11.2013 10:18, Jun HU wrote:
>     > Dear all,
>     >
>     > I'm new in R and Spatiotemporal kriging,  I've a naive question, I've
>     > constructed a STFDF object with the first 4 hours historical data,
>     and want
>     > to forecast the fifth hour data. By using krigeST in R, I've
>     constructed
>     > vgm model. But after launching:
>     >
>     > pred = krigeST(formula=values~1, data=mystfdf, newdata = My_pred,
>     > modelList=myVgm)
>     >
>     > everything seems working fine, but the pred object only contains
>     historical
>     > data, without prediction data. Any idea? Thank you in advance.
>     >
>     >
>     >
>     > Sincerely,
>     >
>     >
>     > Jun
>     >
>     >       [[alternative HTML version deleted]]
>     >
>     > _______________________________________________
>     > R-sig-Geo mailing list
>     > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     >
> 
>     --
>     Benedikt Gr?ler
> 
>     ifgi - Institute for Geoinformatics
>     University of Muenster
> 
>     http://ifgi.uni-muenster.de/graeler
> 
>     Phone: +49 251 83-33082 <tel:%2B49%20251%2083-33082>
>     Mail: ben.graeler at uni-muenster.de <mailto:ben.graeler at uni-muenster.de>
> 
> 
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 

-- 
Benedikt Gr?ler

ifgi - Institute for Geoinformatics
University of Muenster

http://ifgi.uni-muenster.de/graeler

Phone: +49 251 83-33082
Mail: ben.graeler at uni-muenster.de


From osoong+r at gmail.com  Wed Nov  6 20:24:01 2013
From: osoong+r at gmail.com (Oliver Soong)
Date: Wed, 6 Nov 2013 11:24:01 -0800
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <alpine.LRH.2.03.1311052045160.1859@reclus.nhh.no>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
	<CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>
	<CAPQ=hV+ZfhOAGPGuGaQUHWHcfSTSxs=ghrDdoMwz=norCvsj+A@mail.gmail.com>
	<CAPQ=hV+OBfLOfiVHiJ1wEupaCtPznhb7x_XQ6p4n63QviWwDHw@mail.gmail.com>
	<alpine.LRH.2.03.1311051421590.32569@reclus.nhh.no>
	<CAPQ=hV+1PrAra+50wUtVUTdkKeKV29_Vu+-MCkcYPvwEsbzu1A@mail.gmail.com>
	<alpine.LRH.2.03.1311052045160.1859@reclus.nhh.no>
Message-ID: <CAPQ=hV+MMoS1CN0bzjZX-pUm8FUA=dMyAQwzjCEDmyVhiHFNog@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131106/83eff622/attachment.pl>

From Roger.Bivand at nhh.no  Wed Nov  6 20:26:35 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 6 Nov 2013 20:26:35 +0100
Subject: [R-sig-Geo] GDAL.close
In-Reply-To: <CAPQ=hV+MMoS1CN0bzjZX-pUm8FUA=dMyAQwzjCEDmyVhiHFNog@mail.gmail.com>
References: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>
	<alpine.LRH.2.03.1311010936070.13425@reclus.nhh.no>
	<CAPQ=hVLe-cfPFm2zJFyVQy9MGcny7u54VkYi2Htzrb11WDrFXQ@mail.gmail.com>
	<alpine.LRH.2.03.1311042033550.19184@reclus.nhh.no>
	<CAPQ=hVKSUBVtPZc5v9+f-eAmw6ebSfiRO5f-gqhF0VE6Qg7eqg@mail.gmail.com>
	<CAPQ=hV+ZfhOAGPGuGaQUHWHcfSTSxs=ghrDdoMwz=norCvsj+A@mail.gmail.com>
	<CAPQ=hV+OBfLOfiVHiJ1wEupaCtPznhb7x_XQ6p4n63QviWwDHw@mail.gmail.com>
	<alpine.LRH.2.03.1311051421590.32569@reclus.nhh.no>
	<CAPQ=hV+1PrAra+50wUtVUTdkKeKV29_Vu+-MCkcYPvwEsbzu1A@mail.gmail.com>
	<alpine.LRH.2.03.1311052045160.1859@reclus.nhh.no>
	<CAPQ=hV+MMoS1CN0bzjZX-pUm8FUA=dMyAQwzjCEDmyVhiHFNog@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1311062025520.8928@reclus.nhh.no>

On Wed, 6 Nov 2013, Oliver Soong wrote:

> That seems to have done it.  Thanks for your patience.

Good, thanks for checking. The bug fix will be in the next release of 
rgdal on CRAN.

Roger

>
> Oliver
>
>
> On Tue, Nov 5, 2013 at 11:50 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Tue, 5 Nov 2013, Oliver Soong wrote:
>>
>>  Hi Roger,
>>>
>>> I forgot that RGDAL_CloseDataset nils dataset at handle, which means the
>>> subsequent RGDAL_CloseHandle can't find the handle to close.  It also
>>> means
>>> that GDAL.close should replace RGDAL_CloseDataset with RGDAL_CloseHandle.
>>> On linux, this will cause temporary datasets to be removed by the isTrans
>>> unlink code instead of GDALDeleteDataset, but it should make things work
>>> on
>>> Windows.  I don't know if there are drivers that might create files that
>>> don't match the unlink pattern.
>>>
>>> I do think it would be better to ultimately fix RGDAL_DeleteHandle.  Under
>>> normal circumstances, I would call RGDAL_CloseHandle (or equivalently call
>>> GDALClose and R_ClearExternalPtr directly) and then GDALDeleteDataset.
>>>  I'm
>>> still uncertain why the ordering is reversed or what the (commented out)
>>> #ifndef OSGEO4W deleteFile business is about.
>>>
>>
>> Thanks to Even Rouault on gdal-dev, I think that:
>>
>> http://win-builder.r-project.org/jJIzeDT1C100
>>
>> contains a fixed version, with RGDAL_DeleteHandle now closing the dataset
>> before deleting it. This worked on Linux and Windows in a rough cut, and
>> this one after removing the unneeded unlink() call in GDAL.close() now
>> works on Linux, and should also work on Windows. Behaviour on Linux and
>> Windows with respect to transient datasets being deleted is now the same.
>> It was helpful that you stayed with this, it was far from simple, as Even
>> explained on the gdal-dev thread.
>>
>> Roger
>>
>>
>>
>>> Cheers,
>>> Oliver
>>>
>>>
>>>
>>>
>>> On Tue, Nov 5, 2013 at 5:56 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>
>>>  On Tue, 5 Nov 2013, Oliver Soong wrote:
>>>>
>>>>  Hi Roger,
>>>>
>>>>>
>>>>> Toggling on GDALTransientDataset in GDAL.close doesn't change anything
>>>>> because RGDAL_CloseDataset already toggles on that.  In either case,
>>>>> RGDAL_DeleteHandle still doesn't work.  Also, the gc at the end doesn't
>>>>> do
>>>>> anything useful because .setCollectorFun has already trivialized the
>>>>> finalizer and because dataset still exists at that point, as does the
>>>>> source dataset given to GDAL.close in the first place.
>>>>>
>>>>> The HFA driver has the exact same issue.  From what I see in the code, I
>>>>> don't think it's related to the specific driver.
>>>>>
>>>>>
>>>> Here is the next version:
>>>>
>>>> http://win-builder.r-project.org/0X0318s8iW0C
>>>>
>>>> with:
>>>>
>>>>
>>>>             .setCollectorFun(slot(dataset, 'handle'), NULL)
>>>>             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>>>>             .Call("RGDAL_CloseHandle", slot(dataset, 'handle'),
>>>>                 PACKAGE="rgdal")
>>>>
>>>> Running under Windows, and using:
>>>>
>>>> http://download.sysinternals.com/files/Handle.zip
>>>>
>>>> to check, the three transient datasets are open:
>>>>
>>>>   3B8: File  (RW-)   C:\Users\rsb\AppData\Local\
>>>> Temp\Rtmp8kZk0N\awlr2.tif
>>>>   3C0: File  (RW-)   C:\Users\rsb\AppData\Local\
>>>> Temp\Rtmp8kZk0N\tfur1.tif
>>>>   498: File  (RW-)   C:\Users\rsb\AppData\Local\
>>>> Temp\Rtmp8kZk0N\mxbr3.tif
>>>>
>>>> I'm assuming that RW- means read and write open, the third character is
>>>> D,
>>>> which is probably directory.
>>>>
>>>> Roger
>>>>
>>>>
>>>>
>>>>  Cheers,
>>>>> Oliver
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Mon, Nov 4, 2013 at 3:05 PM, Oliver Soong <osoong+r at gmail.com>
>>>>> wrote:
>>>>>
>>>>>  Er, just saw your recent e-mail.  I'll take a look.
>>>>>
>>>>>>
>>>>>> Oliver
>>>>>>
>>>>>>
>>>>>> On Mon, Nov 4, 2013 at 3:05 PM, Oliver Soong <osoong+r at gmail.com>
>>>>>> wrote:
>>>>>>
>>>>>>  I do think we've gotten a bit muddled.  I'm probably not helping, but
>>>>>>
>>>>>>> I'll do my best.
>>>>>>>
>>>>>>> Windows XP (32-bit), 7 (32-bit), and 2008 R2 (32-bit and 64-bit),
>>>>>>> R-3.0.2, sp 1.0.13, rgdal 0.8.11, raster 2.1.49.
>>>>>>>
>>>>>>> The main problem as seen by end-users is the orphaned temporary files
>>>>>>> that you observed were left over for r1 and r2.  They cannot be
>>>>>>> removed
>>>>>>> while R is running.  I seem not to have explained r3 very well, but
>>>>>>> suffice
>>>>>>> it to say that GDAL.close(r3) creates similar orphaned temporary
>>>>>>> files,
>>>>>>> indicating GDAL.close is not functioning properly on
>>>>>>> GDALTransientDataset
>>>>>>> objects under Windows.
>>>>>>>
>>>>>>> I think RGDAL_DeleteHandle (and hence RGDAL_CloseDataset) is the root
>>>>>>> of
>>>>>>> the problem, and I think it's not properly closing the file handle
>>>>>>> before
>>>>>>> trying and failing to delete the associated files.  Windows
>>>>>>> automatically
>>>>>>> locks open file handles, but linux requires extra steps that are not
>>>>>>> always
>>>>>>> done and are not always respected, which is probably why this isn't
>>>>>>> apparent under linux.  The finalizer code and resetting seems
>>>>>>> appropriate.
>>>>>>>
>>>>>>> I still hesitate to say much about RGDAL_DeleteHandle, but I will
>>>>>>> point
>>>>>>> out that one is normally supposed to close the file handle before
>>>>>>> deleting
>>>>>>> the file, and it seems backwards in RGDAL_DeleteHandle.  I don't know
>>>>>>> if
>>>>>>> that is intentional.
>>>>>>>
>>>>>>> After thinking a little more, I think it's better to switch the calls
>>>>>>> to
>>>>>>> RGDAL_CloseHandle and RGDAL_CloseDataset that I suggested originally
>>>>>>> for
>>>>>>> GDAL.close.  That means simply adding the call to RGDAL_CloseHandle
>>>>>>> after
>>>>>>> the call to RGDAL_CloseDataset, rather than before.  With this code,
>>>>>>> if
>>>>>>> RGDAL_CloseDataset behaves as intended, RGDAL_CloseHandle will get a
>>>>>>> nil
>>>>>>> pointer and won't do anything.  However, if RGDAL_CloseDataset fails
>>>>>>> to
>>>>>>> function properly, RGDAL_CloseHandle will close the open handle and
>>>>>>> the
>>>>>>> if(isTrans) cleanup code already in GDAL.close will operate.
>>>>>>>
>>>>>>> Perhaps I could be more helpful if you explained what you thought my
>>>>>>> suggested change might break?  This last one (the existing
>>>>>>> RGDAL_CloseDataset followed by an additional RGDAL_CloseHandle) should
>>>>>>> be
>>>>>>> no worse than the current code.
>>>>>>>
>>>>>>> Is that at all clearer?
>>>>>>>
>>>>>>> Oliver
>>>>>>>
>>>>>>>
>>>>>>> On Mon, Nov 4, 2013 at 1:03 PM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>>>> wrote:
>>>>>>>
>>>>>>>  Which Windows? XP, Vista, 7, 8, 8.1? 32 and 64 bit? If Vista/7/8, run
>>>>>>>
>>>>>>>> as
>>>>>>>> administrator or not? I agree that the code in those parts of rgdal
>>>>>>>> is
>>>>>>>> not
>>>>>>>> well-designed - it was well-designed, but has been modified so that
>>>>>>>> it
>>>>>>>> works for most people cross-platform, and has had to accommodate
>>>>>>>> changes
>>>>>>>> that have taken place in GDAL over more than 10 years, not least the
>>>>>>>> error-handler.
>>>>>>>>
>>>>>>>> The simple solution to your practical problem is to for you to use a
>>>>>>>> larger temporary drive under Windows, or change to an operating
>>>>>>>> system
>>>>>>>> that
>>>>>>>> does not have these side-effects.
>>>>>>>>
>>>>>>>> Assisting you is not just a matter of doing what you think works for
>>>>>>>> you, but making sure it doesn't break anything else for anybody else
>>>>>>>> cross-platform.
>>>>>>>>
>>>>>>>> Your script does not check for other files in tempdir, so I
>>>>>>>> prepended a
>>>>>>>> listing of prior content:
>>>>>>>>
>>>>>>>> pc <- dir(tempdir())
>>>>>>>>
>>>>>>>> and dropped them from the list for unlinking:
>>>>>>>>
>>>>>>>> now <- dir(tempdir())
>>>>>>>> unlink(paste(tempdir(), now[!(now %in% pc)], sep=.Platform$file.sep))
>>>>>>>>
>>>>>>>> I do not see how your script exercises the problem. It creates a new
>>>>>>>> transient file, but does not close it, which was the behaviour you
>>>>>>>> are
>>>>>>>> unhappy with. If I add
>>>>>>>>
>>>>>>>> GDAL.close(r3)
>>>>>>>>
>>>>>>>> on Linux, the transient dataset is removed. On Windows 7 64-bit with
>>>>>>>> the
>>>>>>>> CRAN rgdal binary run as user, temporary files are left in tempdir
>>>>>>>> for
>>>>>>>> r1,
>>>>>>>> r2, and r3. The same three temporary files are left when run as
>>>>>>>> administrator.
>>>>>>>>
>>>>>>>> The earliest version of GDAL.close was:
>>>>>>>>
>>>>>>>> GDAL.close <- function(dataset) {
>>>>>>>>             .setCollectorFun(slot(dataset, 'handle'), NULL)
>>>>>>>>             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>>>>>>>>             invisible()
>>>>>>>> }
>>>>>>>>
>>>>>>>> with a version in 2007 in the THK branch calling a closeDataset
>>>>>>>> method,
>>>>>>>> containing:
>>>>>>>>
>>>>>>>>             handle <- slot(dataset, "handle")
>>>>>>>>             unreg.finalizer(handle)
>>>>>>>>             .Call("RGDAL_DeleteHandle", handle, PACKAGE="rgdal")
>>>>>>>>
>>>>>>>> with:
>>>>>>>>
>>>>>>>> unreg.finalizer <- function(obj) reg.finalizer(obj, function(x) x)
>>>>>>>>
>>>>>>>> and by 2010 was:
>>>>>>>>
>>>>>>>> GDAL.close <- function(dataset) {
>>>>>>>>             .setCollectorFun(slot(dataset, 'handle'), NULL)
>>>>>>>>             .Call('RGDAL_CloseDataset', dataset, PACKAGE="rgdal")
>>>>>>>>             invisible(gc())
>>>>>>>> }
>>>>>>>>
>>>>>>>> Special handling of GDALTransientDataset was added in revision 433 in
>>>>>>>> Janual 2013, and modified in revision 462 in April 2013.
>>>>>>>>
>>>>>>>> It has seemed IIRC that Windows can treat arbitrary files as open. It
>>>>>>>> is
>>>>>>>> also possible that there is an interaction between Windows and
>>>>>>>> rgdal:::.setCollectorFun(), which does what it should, when given the
>>>>>>>> NULL
>>>>>>>> argument, setting:
>>>>>>>>
>>>>>>>> .setCollectorFun <- function(object, fun) {
>>>>>>>>
>>>>>>>>   if (is.null(fun)) fun <- function(obj) obj
>>>>>>>>   reg.finalizer(object, fun, onexit=TRUE)
>>>>>>>>
>>>>>>>> }
>>>>>>>>
>>>>>>>> so incorporating the THK branch logic. It could possibly also vary
>>>>>>>> across drivers, so finding a robust fix means setting up a test rig
>>>>>>>> with
>>>>>>>> multiple Windows machines and testing for multiple drivers to see why
>>>>>>>> some
>>>>>>>> temprary files are being treated as open when other operating systems
>>>>>>>> don't
>>>>>>>> have problems in their removal. Windows users with too small
>>>>>>>> temporary
>>>>>>>> directories. I welcome contributions from people who understand
>>>>>>>> Windows and
>>>>>>>> can actually explain why we see the consequences we see.
>>>>>>>>
>>>>>>>> One candidate may be to branch to .Call("RGDAL_DeleteHandle", handle,
>>>>>>>> PACKAGE="rgdal") for the GDALTransientDataset case; I'll report back
>>>>>>>> once
>>>>>>>> the package has gone through win-builder.
>>>>>>>>
>>>>>>>> Hope this doesn't muddle too much, clarification doesn't seem like
>>>>>>>> the
>>>>>>>> right expression.
>>>>>>>>
>>>>>>>> Roger
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On Sun, 3 Nov 2013, Oliver Soong wrote:
>>>>>>>>
>>>>>>>>  I've been using the CRAN rgdal and raster.  I apologize in advance
>>>>>>>> for
>>>>>>>>
>>>>>>>>  all
>>>>>>>>> the linebreaks that will be broken.  This code should highlight the
>>>>>>>>> problem
>>>>>>>>> and the fix:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> require(rgdal)
>>>>>>>>> require(raster)
>>>>>>>>> r1 <- raster(system.file("external/test.grd", package="raster"))
>>>>>>>>> r2 <- as(r1, "SpatialGridDataFrame")
>>>>>>>>> r2.dims <- gridparameters(r2)$cells.dim
>>>>>>>>> r3 <- new("GDALTransientDataset", driver = new("GDALDriver",
>>>>>>>>> "GTiff"),
>>>>>>>>> rows
>>>>>>>>> = r2.dims[2], cols = r2.dims[1], bands = 1, type = "Float32",
>>>>>>>>> options
>>>>>>>>> =
>>>>>>>>> NULL, fname = file.path(tempdir(), "r3.tif"), handle = NULL)
>>>>>>>>> print(dir(tempdir()))
>>>>>>>>> writeRaster(r1, file.path(tempdir(), "r1.tif"))
>>>>>>>>> writeGDAL(r2, file.path(tempdir(), "r2.tif"))
>>>>>>>>> print(dir(tempdir()))
>>>>>>>>> unlink(dir(tempdir(), full.names = TRUE))
>>>>>>>>> print(dir(tempdir()))
>>>>>>>>> leftover <- gsub("/", "\\\\", dir(tempdir(), full.names = TRUE))
>>>>>>>>> invisible(lapply(paste("cmd /c del", leftover), system))
>>>>>>>>> rm(r1, r2, r3)
>>>>>>>>> gc()
>>>>>>>>> unlink(dir(tempdir(), full.names = TRUE))
>>>>>>>>> print(dir(tempdir()))
>>>>>>>>> invisible(lapply(paste("cmd /c del", leftover), system))
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Basically, I'm trying to write a standard raster package raster (r1)
>>>>>>>>> and an
>>>>>>>>> sp package SpatialGridDataFrame (r2).  Both of those end up calling
>>>>>>>>> new("GDALTransientDataset"), hence r3.  At the first
>>>>>>>>> print(dir(tempdir())),
>>>>>>>>> only r3 has an open temporary file, which is expected.  At the
>>>>>>>>> second,
>>>>>>>>> all
>>>>>>>>> three have open temporary files, and r1 and r2 have their written
>>>>>>>>> final
>>>>>>>>> outputs, which are closed.  The temporary files for r1 and r2 should
>>>>>>>>> have
>>>>>>>>> been closed at this point.  None of the temporary files can be
>>>>>>>>> removed
>>>>>>>>> by
>>>>>>>>> unlink, although the final outputs can, as shown at the third
>>>>>>>>> print(dir(tempdir())).  Windows can't remove them, either.  However,
>>>>>>>>> if
>>>>>>>>> I
>>>>>>>>> remove the GDALTransientDataset r3 and initiate gc(), R can remove
>>>>>>>>> that
>>>>>>>>> temporary file, but this does not work for r1 and r2.  After q(),
>>>>>>>>> the
>>>>>>>>> tempdir() will not be removed by R, but it and the temporary files
>>>>>>>>> for
>>>>>>>>> r1
>>>>>>>>> and r2 can now be removed.
>>>>>>>>>
>>>>>>>>> It looks like GDAL.close is broken (again/as always), but the
>>>>>>>>> collector
>>>>>>>>> function for GDALTransientDataset seems to at least close the
>>>>>>>>> handle.
>>>>>>>>> GDAL.close relies on RGDAL_CloseDataset, whereas the
>>>>>>>>> GDALTransientDataset
>>>>>>>>> collector just uses RGDAL_CloseHandle.  With the handle closed, I
>>>>>>>>> think
>>>>>>>>> the
>>>>>>>>> unlink code in GDAL.close will work (as an aside, I'd use the
>>>>>>>>> pattern
>>>>>>>>> paste0("^[a-z]{3}", basen, "$") to be safer and the argument
>>>>>>>>> full.names
>>>>>>>>> might be simpler than constructing flf separately).  I believe
>>>>>>>>> RGDAL_CloseDataset checks for NULL handles but just returns early,
>>>>>>>>> so
>>>>>>>>> it
>>>>>>>>> should be the same to replace the .Call("RGDAL_CloseDataset", ...)
>>>>>>>>> with
>>>>>>>>> .Call("RGDAL_CloseHandle", ...).
>>>>>>>>>
>>>>>>>>> Really, I think RGDAL_DeleteHandle needs to be fixed, but I don't
>>>>>>>>> know
>>>>>>>>> enough about GDALDeleteDataset or the #ifndef OSGEO4W deleteFile
>>>>>>>>> business
>>>>>>>>> or why RGDAL_CloseHandle is commented out to make any useful
>>>>>>>>> suggestions
>>>>>>>>> there.
>>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Oliver
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Fri, Nov 1, 2013 at 1:41 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>>>>>>>> wrote:
>>>>>>>>>
>>>>>>>>>  On Mon, 28 Oct 2013, Oliver Soong wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>>  I've had a long standing struggle with GDAL.close on Windows, and
>>>>>>>>>> I
>>>>>>>>>>
>>>>>>>>>>  think I might finally have found a fix.  I'm currently running
>>>>>>>>>> rgdal
>>>>>>>>>>
>>>>>>>>>>> 0.8.11, R 3.0.2, and 32-bit Windows 7.
>>>>>>>>>>>
>>>>>>>>>>> Currently, writeRaster and writeGDAL create temporary files in the
>>>>>>>>>>> tempdir() folder (the final filename prefixed with 3 random [a-z]
>>>>>>>>>>> letters).  On my system, these files get left open and orphaned.
>>>>>>>>>>>  When
>>>>>>>>>>> doing heavy processing, this can lead to the drive hosting the
>>>>>>>>>>> tempdir() folder to become full, even if the data is being
>>>>>>>>>>> ultimately
>>>>>>>>>>> written to a much larger drive.  This also means that R cannot
>>>>>>>>>>> clean
>>>>>>>>>>> up these files or the tempdir() folder when it closes, causing
>>>>>>>>>>> similar
>>>>>>>>>>> bloat in my %TEMP%.
>>>>>>>>>>>
>>>>>>>>>>> I haven't tested this on other platforms, but I think it might
>>>>>>>>>>> help
>>>>>>>>>>> to
>>>>>>>>>>> insert an extra line into GDAL.close:
>>>>>>>>>>>
>>>>>>>>>>> .setCollectorFun(slot(dataset, "handle"), NULL)
>>>>>>>>>>> .Call("RGDAL_CloseHandle", dataset at handle, PACKAGE = "rgdal")
>>>>>>>>>>> .Call("RGDAL_CloseDataset", dataset, PACKAGE = "rgdal")
>>>>>>>>>>>
>>>>>>>>>>> For whatever reason, RGDAL_CloseDataset doesn't seem to actually
>>>>>>>>>>> close
>>>>>>>>>>> the C file handle, but it doesn't seem to mind if the file handle
>>>>>>>>>>> was
>>>>>>>>>>> closed beforehand.
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>  Could you please provide a working example? I have looked at
>>>>>>>>>>> this,
>>>>>>>>>>>
>>>>>>>>>> but
>>>>>>>>>> need a baseline to know whether I'm looking at the same thing. I'm
>>>>>>>>>> very
>>>>>>>>>> unsure that this is a robust solution, and need an instrumented
>>>>>>>>>> example,
>>>>>>>>>> including listings of the temporary directory during the process,
>>>>>>>>>> to
>>>>>>>>>> see
>>>>>>>>>> the consequences. Thanks for looking into this, but I'd prefer to
>>>>>>>>>> be
>>>>>>>>>> sure
>>>>>>>>>> that a Windows-specific fix doesn't make things worse for others
>>>>>>>>>> too.
>>>>>>>>>> Please also report on the source of your Windows rgdal binary - is
>>>>>>>>>> it
>>>>>>>>>> from
>>>>>>>>>> CRAN or locally built dynamically linking your own GDAL?
>>>>>>>>>>
>>>>>>>>>> Best wishes,
>>>>>>>>>>
>>>>>>>>>> Roger
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>  Cheers,
>>>>>>>>>>
>>>>>>>>>>  Oliver
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>  --
>>>>>>>>>>>
>>>>>>>>>>>  Roger Bivand
>>>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>   --
>>>>>>>>>
>>>>>>>> Roger Bivand
>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>  --
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Wed Nov  6 20:42:32 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 6 Nov 2013 19:42:32 +0000
Subject: [R-sig-Geo] [R] ascii-grid export
In-Reply-To: <b8f5e82472284afebf58f87571b7a809@EX-0-HT0.lancs.local>
References: <a9f9d52a74ef493c927d218efa052d60@EX-1-HT0.lancs.local>
	<CANVKczMq0L71LMJbiha3iBDxDptwFNNCDCjxcz57iEL-zp9zfw@mail.gmail.com>
	<6f693057937b44eba6bf89a4d0569fa6@EX-0-HT0.lancs.local>
	<CANVKczPuRbS-E7Y4ZpDTPW0xnZdU3vXw4B33qSxno+fEUQ=sSg@mail.gmail.com>
	<b8f5e82472284afebf58f87571b7a809@EX-0-HT0.lancs.local>
Message-ID: <CANVKczObj_JL0gzjud6rz37ELfxsMXuxkXkxcZAOx7hMs4KS0w@mail.gmail.com>

On Wed, Nov 6, 2013 at 6:43 PM, Enzo Cocca <enzo.ccc at gmail.com> wrote:
> hi Barry,
> thanks for your help.
>  Abaut the question why I want  to write a non-geographic
> coordinate-based  I answer that I don't  have my data in geographic
> coordinates but in local coordinates.
> So I want to export the map in local coordinate to overlap on my data

 But the variogram "map" can't overlap on your data! The value of the
variogram map at (x,y) is related to the covariance of data at
*spatial separation* x units apart horizontally and y units apart
vertically. Hence the variogram map is centred on 0,0, and the value
at (0,0) is the 'nugget' variance - the variance at distance zero.

 The local coordinates of your *data* may be in metres, but the axes
of the variogram map is strictly *separation in metres*.

I think further questions really need to go to R-sig-geo - I'm
diverting this there and I've taken r-help off the to: list - if
you're not a member of r-sig-geo then you should probably sign up now!

Barry


From sofeawright at gmail.com  Thu Nov  7 10:19:56 2013
From: sofeawright at gmail.com (Sofea Wright)
Date: Thu, 7 Nov 2013 09:19:56 +0000
Subject: [R-sig-Geo] Fit a sine curve to raster stack
In-Reply-To: <CABaJH78P4TPbG4pR4a1kTGABE7jZv-o0C=TuQvnW7LVSgfHDew@mail.gmail.com>
References: <CAB5R0=W4fP6nACWFGGdYAK-7R8xc0o8HRUGDCtiaJYb3-OcmZg@mail.gmail.com>
	<CE9ADA9A.BEE4%jan.verbesselt@wur.nl>
	<CABaJH78P4TPbG4pR4a1kTGABE7jZv-o0C=TuQvnW7LVSgfHDew@mail.gmail.com>
Message-ID: <CAB5R0=VtqvTFSgD0DUSOxFBOKCHedZHw9fMYHysC8Zk27gFcmg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131107/a8f46c8f/attachment.pl>

From a.mosnier at gmail.com  Thu Nov  7 15:42:12 2013
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Thu, 7 Nov 2013 09:42:12 -0500
Subject: [R-sig-Geo] Fit a sine curve to raster stack
Message-ID: <CANkFkEeYUSH4VbB_je2f=wybf6m1m=wkqtsAx8nrxSEToFfUtQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131107/c17c5448/attachment.pl>

From sofeawright at gmail.com  Thu Nov  7 20:43:05 2013
From: sofeawright at gmail.com (Sofea Wright)
Date: Thu, 7 Nov 2013 19:43:05 +0000
Subject: [R-sig-Geo] Fit a sine curve to raster stack
In-Reply-To: <CANkFkEeYUSH4VbB_je2f=wybf6m1m=wkqtsAx8nrxSEToFfUtQ@mail.gmail.com>
References: <CANkFkEeYUSH4VbB_je2f=wybf6m1m=wkqtsAx8nrxSEToFfUtQ@mail.gmail.com>
Message-ID: <CAB5R0=WodB3kSSnD_Sa=LZbr9Zp4mS1-4ukqYyOcj3c45fqKyg@mail.gmail.com>

Thanks a lot Arnaud Mosnier!

The code is running however, the final output is strange. The minimum
values and maximum values is NA. I would expect it to give me the
slope (coeefficients[2] is the slope). I just could not figure out
where I went wrong.
> e2
class       : RasterLayer
dimensions  : 10, 10, 100  (nrow, ncol, ncell)
resolution  : 36, 18  (x, y)
extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
data source : in memory
names       : layer
values      : NA, NA  (min, max)

The full code(based on Eddie) is now:

#Create 24 dummy raster layers
r <- raster(nrow=10, ncol=10)
s <- stack( sapply(1:24, function(i) setValues(r, rnorm(ncell(r), i, 3) )) )
time <- 1:nlayers(s)

#Throw in NA values to the rasterstack
s[1] <- NA

#Create sine function that deals with NA values base on Robert
fun1 <- function(x) {
if (is.na(x[1])) {
NA
} else {
xcost<-cos(2*pi*time/12)
xsine<-sin(2*pi*time/12)
m = lm(x~xcost+xsine)
m$coefficients[2]
}
}

fun2 <- function(x) {
m <- NA
try( m <- lm(x~xcost+xsine)$coefficients[2] ,silent=T)
m
}

#run
e1 <- calc(s, fun1)
e2 <- calc(s, fun2)



On Thu, Nov 7, 2013 at 2:42 PM, Arnaud Mosnier <a.mosnier at gmail.com> wrote:
> Just change the s for a x in
>
> fun1 <- function(x) {
> if (is.na(x[1])) {
> NA
> } else {
> xcost<-cos(2*pi*time/12)
> xsine<-sin(2*pi*time/12)
> m = lm(s~xcost+xsine)
> m$coefficients[2]
> }
> }
>
> this should work !
>
> fun1 <- function(x) {
> if (is.na(x[1])) {
> NA
> } else {
> xcost<-cos(2*pi*time/12)
> xsine<-sin(2*pi*time/12)
> m = lm(x~xcost+xsine)
> m$coefficients[2]
> }
> }
>
>
>
> Message: 2
> Date: Wed, 6 Nov 2013 11:53:26 +0000
> From: Eddie Smith <eddieatr at gmail.com>
> To: "Verbesselt, Jan" <jan.verbesselt at wur.nl>
> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Fit a sine curve to raster stack
> Message-ID:
>         <
> CABaJH78P4TPbG4pR4a1kTGABE7jZv-o0C=TuQvnW7LVSgfHDew at mail.gmail.com>
> Content-Type: text/plain
>
> Hi list,
>
> Thanks Jan. Yup, I think NA values are really the case here.
>
> I found a reply from Robert here
> http://r-sig-geo.2731867.n2.nabble.com/Problems-with-NA-values-and-lm-in-calc-in-raster-package-td7455990.html
> but
> I think I have mistakenly wrote my code.
>
> Could somebody kindly check this for me?
>
> #Create 24 dummy raster layers
> r <- raster(nrow=10, ncol=10)
> s <- stack( sapply(1:24, function(i) setValues(r, rnorm(ncell(r), i, 3) ))
> )
> time <- 1:nlayers(s)
>
> #Throw in NA values to the rasterstack
> s[1] <- NA
>
> #Create sine function that deals with NA values base on Robert
> fun1 <- function(x) {
> if (is.na(x[1])) {
> NA
> } else {
> xcost<-cos(2*pi*time/12)
> xsine<-sin(2*pi*time/12)
> m = lm(s~xcost+xsine)
> m$coefficients[2]
> }
> }
>
> fun2 <- function(x) {
> m <- NA
> try( m <- lm(s~xcost+xsine)$coefficients[2] ,silent=T)
> m
> }
>
> #run
> e1 <- calc(s, fun1)
> Error in `colnames<-`(`*tmp*`, value = "layer") :
>   length of 'dimnames' [2] not equal to array extent
>
> e2 <- calc(s, fun2)
>
> Thanks in advance
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From vitale232 at gmail.com  Thu Nov  7 21:05:52 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Thu, 7 Nov 2013 12:05:52 -0800
Subject: [R-sig-Geo] Fit a sine curve to raster stack
In-Reply-To: <CAB5R0=WodB3kSSnD_Sa=LZbr9Zp4mS1-4ukqYyOcj3c45fqKyg@mail.gmail.com>
References: <CANkFkEeYUSH4VbB_je2f=wybf6m1m=wkqtsAx8nrxSEToFfUtQ@mail.gmail.com>
	<CAB5R0=WodB3kSSnD_Sa=LZbr9Zp4mS1-4ukqYyOcj3c45fqKyg@mail.gmail.com>
Message-ID: <CAFTcopedjuyccJjrNJ78VAsDZm+PNL2iRWd=zdoWUch-TC4fqg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131107/7e7f7671/attachment.pl>

From larroque.jeremy at gmail.com  Fri Nov  8 10:54:07 2013
From: larroque.jeremy at gmail.com (Jeremy Larroque)
Date: Fri, 8 Nov 2013 10:54:07 +0100
Subject: [R-sig-Geo] Least-cost path in meter
In-Reply-To: <CAGaZB333-qmU--cOERveLoks4o81ODhma1GynOqhqC2idthNCg@mail.gmail.com>
References: <CAGaZB31EY=ieBf5_cZZqU=+E2uiVdhaiHAcRqkjrJE8BVhSJ1A@mail.gmail.com>
	<1382625243.24142.YahooMailNeo@web133204.mail.ir2.yahoo.com>
	<CAGaZB333-qmU--cOERveLoks4o81ODhma1GynOqhqC2idthNCg@mail.gmail.com>
Message-ID: <CAGaZB30GtkW0LZ19N3g2Wq4cGLsnDf6X_PynPVJ8OmS+3ncP=Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131108/df14fea2/attachment.pl>

From rafael.wueest at gmail.com  Fri Nov  8 11:42:22 2013
From: rafael.wueest at gmail.com (=?ISO-8859-1?Q?Rafael_W=FCest?=)
Date: Fri, 08 Nov 2013 11:42:22 +0100
Subject: [R-sig-Geo] Least-cost path in meter
In-Reply-To: <CAGaZB30GtkW0LZ19N3g2Wq4cGLsnDf6X_PynPVJ8OmS+3ncP=Q@mail.gmail.com>
References: <CAGaZB31EY=ieBf5_cZZqU=+E2uiVdhaiHAcRqkjrJE8BVhSJ1A@mail.gmail.com>	<1382625243.24142.YahooMailNeo@web133204.mail.ir2.yahoo.com>	<CAGaZB333-qmU--cOERveLoks4o81ODhma1GynOqhqC2idthNCg@mail.gmail.com>
	<CAGaZB30GtkW0LZ19N3g2Wq4cGLsnDf6X_PynPVJ8OmS+3ncP=Q@mail.gmail.com>
Message-ID: <527CC00E.5050903@gmail.com>

Hi Jeremy

do you know about SpatialLinesLengths? See ?SpatialLines for more information.

You should be able to apply this to your path1 object. It might, in fact, help you to shortcut, as 
gdistance::shortestPath allows also coordinate matrices as input AFAIK.

Rafael


On 08.11.13 10:54, Jeremy Larroque wrote:
> I wrote something to compute the along-path distance in meters using the
> shortestPath function.
> It works but it takes too much time. Advice to improve efficiency?
>
> # I create an empty matrix of size n*n (n = number of individuals)
> APD <- matrix(nrow=dim(xy)[1],ncol=dim(xy)[1])
>
> # A loop by row and column
> # I compute the shortestPath for all pairs of individuals
> for (m in 1:dim(xy)[1]) {
>
>      for(j in 1:m) {
>
> path1 <- c("NA")
>
> A <- cbind(xy[m,1],xy[m,2])
> B <- cbind(xy[j,1],xy[j,2])
>
>
> path1 <- try(shortestPath(tr1, A, B, output="SpatialLines"), silent = TRUE)
>
> #try function in cases where individuals have the same location and thus
> the shortestPath function does not work
> if (class(path1)=="try-error") { sumdis <- 0 } else {
>
> #I get the coordinates of the SpatialLines object created
>    coo <- as.data.frame(coordinates(path1))
>    dis <- c()
> #I compute the distance between each successive paires of coordinates
>    for (k in 1:c(dim(coo)[1]-1)) {
>    dis <- c(dis, dist(rbind(coo[k,],coo[k+1,])))
> }
> #I sum the distances to get the along-path distance in meters
> sumdis <- sum(dis)
>
> }
> #I fill the matrix
> APD[m,j] <- sumdis
>
> }
> }
>
>
>
>
>
> 2013/11/6 Jeremy Larroque <larroque.jeremy at gmail.com>
>
>> Hi,
>>
>>
>>
>> setting all the connection to 1 give me the straight line distance between
>> points, not the distance along the least-cost distance path.
>>
>> Maybe a way to get the least-cost path in meters would be to count the
>> number of transitions and multiply it by the resolution of the raster?
>>
>>
>>
>> Thanks,
>>
>>
>>
>> Jeremy
>>
>>
>> 2013/10/24 Jacob van Etten <jacobvanetten at yahoo.com>
>>
>>> Hi Jeremy,
>>>
>>> Here goes a complete example. The function geoCorrection does the work.
>>> It divides any value in the transition matrix by the distance between those
>>> cells (e.g. cell centres). By setting all connections to 1, we get
>>> conductance=1/distance
>>>
>>> ###
>>>
>>> library("gdistance")
>>>
>>> r <- raster(system.file("external/maungawhau.grd",
>>>                          package="gdistance"))
>>> plot(r)
>>> r #units are in meters
>>> tr1 <- transition(r,function(x){1},8) #gives all connection value 1
>>> tr1 <- geoCorrection(tr1) #conductance=1/distance is equivalent to
>>> resistance=distance
>>>
>>> tr2 <- transition(r,function(x){1},16) #more precision
>>> tr2 <- geoCorrection(tr2)
>>>
>>> A <- c(2667670,6479000)
>>> B <- c(2667800,6479400)
>>> cc <- rbind(A,B)
>>> points(cc)
>>>
>>> costDistance(tr1, cc) #454
>>> costDistance(tr2, cc) #431
>>>
>>> #Pythagoras to check
>>> sqrt((B[1] - A[1])^2 + (B[2] - A[2])^2) #421
>>>
>>> ###
>>>
>>> Using more connections (16 instead of 8) gives a better result in this
>>> case.
>>>
>>> The method also works for latlon grids. See ?geoCorrection.
>>>
>>> Jacob.
>>>
>>>
>>>    On Thursday, 24 October 2013, 7:09, Jeremy Larroque <
>>> larroque.jeremy at gmail.com> wrote:
>>>   Hi everyone,
>>>
>>>
>>>
>>> I'm using the gdistance package to compute least-cost distance, i.e. the
>>> cumulative cost of the least-cost path, on a raster file between points
>>> using the costDistance function.
>>>
>>> But does anyone have an idea of how to calculate the distance in meter
>>> along the least-cost path?
>>>
>>>
>>>
>>> Thanks,
>>>
>>>
>>> Jeremy
>>>
>>>      [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Rafael W?est
rafael.wueest at gmail.com
http://www.rowueest.net


From a.mosnier at gmail.com  Fri Nov  8 14:18:41 2013
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Fri, 8 Nov 2013 08:18:41 -0500
Subject: [R-sig-Geo] Fit a sine curve to raster stack
In-Reply-To: <CAB5R0=WodB3kSSnD_Sa=LZbr9Zp4mS1-4ukqYyOcj3c45fqKyg@mail.gmail.com>
References: <CANkFkEeYUSH4VbB_je2f=wybf6m1m=wkqtsAx8nrxSEToFfUtQ@mail.gmail.com>
	<CAB5R0=WodB3kSSnD_Sa=LZbr9Zp4mS1-4ukqYyOcj3c45fqKyg@mail.gmail.com>
Message-ID: <CANkFkEd3uHP7_y5gqoCu0BD3p8yBuRoJ6FQ_SPF37WRWb23ugA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131108/e15a966b/attachment.pl>

From amcilwee at westnet.com.au  Fri Nov  8 14:52:41 2013
From: amcilwee at westnet.com.au (Allen McIlwee)
Date: Sat, 9 Nov 2013 00:22:41 +1030
Subject: [R-sig-Geo] Landsat soil moisture index
Message-ID: <003501cedc89$cd7c9fd0$6875df70$@westnet.com.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131109/cbd429f9/attachment.pl>

From sarah.goslee at gmail.com  Fri Nov  8 22:30:15 2013
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Fri, 8 Nov 2013 16:30:15 -0500
Subject: [R-sig-Geo] Landsat soil moisture index
In-Reply-To: <003501cedc89$cd7c9fd0$6875df70$@westnet.com.au>
References: <003501cedc89$cd7c9fd0$6875df70$@westnet.com.au>
Message-ID: <CAM_vjumc6e61C_hWq=ppiDzXuzuKJ_2ike9VhJwo22MnWW7TGQ@mail.gmail.com>

Hi,

Well, you need to start at the beginning.
Where did you get your Landsat images?
What format are they in?
Has someone already calculated NDVI and surface temperature for you,
or do you need to do that? If so, what level of processing have the
images already received?
How have you imported the images into R?

Do you already know how to perform a linear regression in R?

It's not a difficult task programmatically, but there are a number of
steps that you need to consider, and things you must understand before
you can get good results. Remote sensing isn't necessarily an easy
field.

The landsat package and associated references may help you get started.

Sarah

On Fri, Nov 8, 2013 at 8:52 AM, Allen McIlwee <amcilwee at westnet.com.au> wrote:
> Dear list
>
>
>
> WANG et al. 2009 "Satellite remote sensing applications for surface soil
> moisture monitoring" derived a Landsat soil moisture index:
>
>
>
> SMI = (Tsmax - Ts) / (Tsmax - Tsmin)
>
>
>
> where Tsmax, Tsmin are the maximum and minimum surface temperatures for a
> given NDVI value, and Ts is the surface temperature at a given pixel for a
> given NDVI. Values near 1 (low surface temp & low greenness) have the
> highest estimated soil moisture, while values near 0 (high surface temp &
> greenness) have the lowest.
>
>
>
> Could anyone please advise me how I can create an image matrix that will
> extract the min and max surface temperatures for each unique NDVI value. I
> then need to apply a linear regression to the max temp vs NDVI & min temp vs
> NDVI scatter plots, and use the corresponding slopes and intercepts to
> calculate Tsmax and Tsmin
>
>
>
> Tsmax = (a1 x NDVI) + b1
>
> TSmin = (a2 x NDVI) + b2
>
>
>
> Hoping this is not such a difficult task for someone mathematically inclined
>
>
>
> Thanks
>
> Allen
>
>

-- 
Sarah Goslee
http://www.functionaldiversity.org


From eddieatr at gmail.com  Fri Nov  8 22:53:11 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Fri, 8 Nov 2013 21:53:11 +0000
Subject: [R-sig-Geo] Select and plot specific row in rasterstack
Message-ID: <CABaJH7_hH8RugzC2wiLBufB3TBVwn6BNk4hKNEo_B0JZUJyj1w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131108/83513e47/attachment.pl>

From thilton at ucmerced.edu  Sat Nov  9 00:08:40 2013
From: thilton at ucmerced.edu (Timothy W. Hilton)
Date: Fri, 8 Nov 2013 15:08:40 -0800
Subject: [R-sig-Geo] retrieving rectangular grid from lat/lon pairs & GrADS
 projection information
Message-ID: <20131108230840.GC46963@Timothys-MacBook-Air.local>

Hello,

I have a data on a 124x124 grid from which I would like to produce a
contour plot and image plot overlaid on a map of North America.  The
grid corresponds to latitudes and longitudes on a projected surface.  I
can easily produce and plot a contour plot (using contour) or image
(using image), but both of these plotting functions require
monotonically increasing coordinates.  I'm spinning my wheels trying to
figure out how to project these images onto my map.

I have the latitude/longitude of each grid cell along with a GrADS PDEF
string (this defines the rectangular grid -> latitude/longitude
projection):
pdef 124 124 nps  118.529  113.774  -40.0000   60

This defines a 124 by 124 native grid on a polar stereographic
projection with the North Pole at (118.529, 113.774) on the projected
grid (with (1,1) in the lower-left corner) and a reference longitude of
-40.0000 and 60km between grid points.

I think I need to do something like inverse project my lat/lon pairs
from the polar steriographic projection they're in now to a different
projection (I'm going for the "perspective" projection in the maps
package now).

I have two questions:

(1) is this approach a reasonable way to approach an image or contour
plot projected onto a map?

(2) I'm trying to figure out how to translate the PDEF string into a
proj.4 string for this.  I'm not sure what to use for +x (False Easting)
and +y (False Northing), or for +lat_ts (Latitude at natural origin) or
+lon_0 (Longitude at natural origin).  I'm using
"+proj=stere +lat_ts=40.0 +lat_0=90.0 +lon_0=220 +k_0=1.0 +x_0=0.0 +y_0=0.0"
but the inversse projection of my lat/lon does not end up on a
rectangular grid, as it seems to me like it should.

Many thanks,
Tim

--

Timothy W. Hilton
Assistant Project Scientist
School of Engineering
University of California, Merced
thilton at ucmerced.edu


From amcilwee at westnet.com.au  Sat Nov  9 05:43:55 2013
From: amcilwee at westnet.com.au (Allen McIlwee)
Date: Sat, 9 Nov 2013 15:13:55 +1030
Subject: [R-sig-Geo] Landsat soil moisture index
In-Reply-To: <CAM_vjumc6e61C_hWq=ppiDzXuzuKJ_2ike9VhJwo22MnWW7TGQ@mail.gmail.com>
References: <003501cedc89$cd7c9fd0$6875df70$@westnet.com.au>
	<CAM_vjumc6e61C_hWq=ppiDzXuzuKJ_2ike9VhJwo22MnWW7TGQ@mail.gmail.com>
Message-ID: <000a01cedd06$4c698890$e53c99b0$@westnet.com.au>

Hi Sarah 

I'm a student at Flinders University in South Australia looking at ways to
support the adaptive land management of grazing lands in the north-west
corner of the State. I am interested in how we can use various
multi-temporal image analysis techniques to enhance our understanding of
ecosystem dynamics and landscape processes.

I have over 100 cloud free Landsat images for one scene I have a field trip
out to next week. There are 5-6 images per year on average dating back to
1986. Each of the images has been processed by the ESPA who use the Landsat
Ecosystem Disturbance Adaptive Processing System (LEDAPS) to calculate
at-surface reflectance. I think the level of processing for these products
is 2A? The thermal band is given as brightness temperature.

I have a subset of the images I am working with at the moment which
represents the single driest image in every year. I am working with a bunch
of indices, all calculated in ERDAS imagine that can act as proxies for the
dynamic processes I am trying to understand. In terms of landscape drying
out and rehydration processes, I want to compare a number of indices
including the Tassel Cap Wetness Index, Normalised Difference Moisture
Index, Normalised Soil moisture Index, and the soil moisture index mentioned
below.

I can import the surface temperature & ndvi images into R by:

rm(list=ls())

library(raster) 
library(sp)
library(rgdal)

setwd("D:\\SMI\\")

ndvi <- raster("a_1987_298_l5_ndvi3.img", format="HFA", datatype='FLT4S',
NAflag=0)
projection(ndvi) <- "+proj=utm +zone=53 +south +ellps=WGS84 +datum=WGS84
+units=m +no_defs"
ndvi

class       : RasterLayer 
dimensions  : 6450, 6874, 44337300  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : 217875, 424095, 6867295, 7060795  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=53 +south +ellps=WGS84 +datum=WGS84 +units=m
+no_defs +towgs84=0,0,0 
data source : D:\SMI\a_1987_298_l5_ndvi3.img 
names       : a_1987_298_l5_ndvi3 
values      : -45.92834, 49.92658  (min, max)

band6 <- raster("a_1987_298_L5_band6.img", format="HFA", datatype='FLT4S',
NAflag=0)
projection(band6) <- "+proj=utm +zone=53 +south +ellps=WGS84 +datum=WGS84
+units=m +no_defs"
band6

class       : RasterLayer 
dimensions  : 6450, 6874, 44337300  (nrow, ncol, ncell)
resolution  : 30, 30  (x, y)
extent      : 217875, 424095, 6867295, 7060795  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=53 +south +ellps=WGS84 +datum=WGS84 +units=m
+no_defs +towgs84=0,0,0 
data source : D:\SMI\a_1987_298_L5_band6.img 
names       : a_1987_298_L5_band6 
values      : 2497, 4259  (min, max)

The frequency distribution of unique NDVI values that I want to calculate a
min and max brightness temperature is

freq(ndvi)

value    count
 [1,]   -46        1
 [2,]   -33        1
 [3,]   -31        1
 [4,]   -28        1
 [5,]   -25        1
 [6,]   -23        3
 [7,]   -21        2
 [8,]   -19        1
 [9,]   -18        4
[10,]   -15        3
[11,]   -13        1
[12,]   -12        1
[13,]   -11        2
[14,]   -10        2
[15,]    -9        3
[16,]    -8        3
[17,]    -7        4
[18,]    -6        4
[19,]    -5        6
[20,]    -3        4
[21,]    -2        8
[22,]    -1       12
[23,]     0 11386427
[24,]     1       28
[25,]     2       23
[26,]     3       39
[27,]     4      113
[28,]     5      539
[29,]     6     2663
[30,]     7     8683
[31,]     8    25549
[32,]     9    81499
[33,]    10   250318
[34,]    11  1202842
[35,]    12  3572881
[36,]    13  6462049
[37,]    14  7941048
[38,]    15  6749783
[39,]    16  3972814
[40,]    17  1729160
[41,]    18   612375
[42,]    19   204610
[43,]    20    71817
[44,]    21    27397
[45,]    22    14043
[46,]    23     7939
[47,]    24     4418
[48,]    25     2790
[49,]    26     1805
[50,]    27     1158
[51,]    28      773
[52,]    29      487
[53,]    30      339
[54,]    31      206
[55,]    32      163
[56,]    33      109
[57,]    34       74
[58,]    35       74
[59,]    36       38
[60,]    37       42
[61,]    38       30
[62,]    39       21
[63,]    40       19
[64,]    41       19
[65,]    42        3
[66,]    43        6
[67,]    44        4
[68,]    45        4
[69,]    46        3
[70,]    47        3
[71,]    48        2
[72,]    49        2
[73,]    50        1

Not sure where to go from here

Thanks
Allen

-----Original Message-----
From: Sarah Goslee [mailto:sarah.goslee at gmail.com] 
Sent: 09 November 2013 08:00
To: Allen McIlwee
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Landsat soil moisture index

Hi,

Well, you need to start at the beginning.
Where did you get your Landsat images?
What format are they in?
Has someone already calculated NDVI and surface temperature for you, or do
you need to do that? If so, what level of processing have the images already
received?
How have you imported the images into R?

Do you already know how to perform a linear regression in R?

It's not a difficult task programmatically, but there are a number of steps
that you need to consider, and things you must understand before you can get
good results. Remote sensing isn't necessarily an easy field.

The landsat package and associated references may help you get started.

Sarah

On Fri, Nov 8, 2013 at 8:52 AM, Allen McIlwee <amcilwee at westnet.com.au>
wrote:
> Dear list
>
>
>
> WANG et al. 2009 "Satellite remote sensing applications for surface 
> soil moisture monitoring" derived a Landsat soil moisture index:
>
>
>
> SMI = (Tsmax - Ts) / (Tsmax - Tsmin)
>
>
>
> where Tsmax, Tsmin are the maximum and minimum surface temperatures 
> for a given NDVI value, and Ts is the surface temperature at a given 
> pixel for a given NDVI. Values near 1 (low surface temp & low 
> greenness) have the highest estimated soil moisture, while values near 
> 0 (high surface temp &
> greenness) have the lowest.
>
>
>
> Could anyone please advise me how I can create an image matrix that 
> will extract the min and max surface temperatures for each unique NDVI 
> value. I then need to apply a linear regression to the max temp vs 
> NDVI & min temp vs NDVI scatter plots, and use the corresponding 
> slopes and intercepts to calculate Tsmax and Tsmin
>
>
>
> Tsmax = (a1 x NDVI) + b1
>
> TSmin = (a2 x NDVI) + b2
>
>
>
> Hoping this is not such a difficult task for someone mathematically 
> inclined
>
>
>
> Thanks
>
> Allen
>
>

--
Sarah Goslee
http://www.functionaldiversity.org


From g.ridhima at gmail.com  Sun Nov 10 07:05:45 2013
From: g.ridhima at gmail.com (Ridhima Gupta)
Date: Sun, 10 Nov 2013 11:35:45 +0530
Subject: [R-sig-Geo] testing for spatial correlation in an unbalanced panel
	data
Message-ID: <CAOrsxwX3Ej1Fo0MQF7z1b2Ya+Yin0SxKuCMsi2RUkK0gpiv2Lw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131110/5ff0feaa/attachment.pl>

From oscar.perpinan at upm.es  Mon Nov 11 11:13:40 2013
From: oscar.perpinan at upm.es (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Mon, 11 Nov 2013 11:13:40 +0100
Subject: [R-sig-Geo] Select and plot specific row in rasterstack
In-Reply-To: <CABaJH7_hH8RugzC2wiLBufB3TBVwn6BNk4hKNEo_B0JZUJyj1w@mail.gmail.com>
References: <CABaJH7_hH8RugzC2wiLBufB3TBVwn6BNk4hKNEo_B0JZUJyj1w@mail.gmail.com>
Message-ID: <86y54v9rfv.fsf@Triskela.Home>

Hello,

You can extract a row from a RasterStack with s[i,]. Try this code:
 
library(raster)
library(zoo)
library(lattice)

r <- raster(nrow=20, ncol=5)
s <- stack( sapply(1:5, function(i) setValues(r, rnorm(ncell(r), i, 3) )) )
## assign a time index to the 'RasterStack'
s <- setZ(s, seq(Sys.Date()-4, by='day', length=5))

## extract a row (10) and convert the result (a 'matrix') into a 'zoo'
## object using the time index of the 'RasterStack' object
zz <- zoo(t(s[10,]), order.by=getZ(s))

xyplot(zz, superpose=TRUE)


Best,

Oscar.
Eddie Smith writes:

> Dear list,
>
> How do I plot a specific row over time? For example I want to plot row
> 10(layer.1 to 5 is actually year 1 to year 5.
>
> library(raster)
> r <- raster(nrow=5, ncol=5)
> s <- stack( sapply(1:5, function(i) setValues(r, rnorm(ncell(r), i, 3) )) )
> s[]
>
>          layer.1    layer.2     layer.3    layer.4    layer.5
>  [1,]  6.7134890  6.9141251  4.38213123  4.8995302  2.3105321
>  [2,]  3.4323121  6.1074031 10.12872426  3.6728949  3.2252562
>  [3,]  4.4370107  3.1397068  5.47572912  1.9692684  4.0064603
>  [4,] -1.5588723  0.4075960 -0.73333754  6.3589944  5.0355051
>  [5,]  2.8095750  5.4264553  1.17820009  2.0665198  8.0491221
>  [6,]  4.3422219  2.1106691  1.08638206  5.0640175  6.8057674
>  [7,] -3.1072366 -1.1174633  6.28901706  5.0713964  1.8651354
>  [8,] -0.5628539  2.1868130  1.21288191  0.3114011  3.0452161
>  [9,]  0.1725606  3.4535112 -1.38043518  3.6439042  5.4005650
> [10,] -2.3376856  4.8803363 -0.05927408  7.9275016  4.7013126
> [11,]  2.3032655  2.4974161  4.63961513  1.4021305 10.2302589
> [12,]  0.4470648  1.1660421 -0.70127807  6.3293479  6.6178080
> [13,]  2.5835127 -0.8768809  2.87405383  6.1361518  3.4851934
> [14,] -3.2769134  2.1721391  2.17317611  1.4170633  0.6446692
> [15,]  1.0771079 -2.5369687  4.89710339  1.8667695  4.4847933
> [16,]  7.2532218  3.0210221  0.56993065  2.4564492  6.9473683
> [17,]  4.0682441 -0.8198112  4.85259334  7.3296033  8.9541915
> [18,]  5.3991328 -0.9818425  1.73782230  2.9220433  4.9865858
> [19,]  2.0556183 -0.7470914  5.44869675  1.6452235  4.5236089
> [20,] -0.6277883  6.7255821  5.12606765  5.5721351  4.7081256
> [21,]  9.0139352  3.1350767  6.59366754  2.0351358  5.1865195
> [22,]  7.0598020  0.2869291  7.14368927  9.7213576  0.4251934
> [23,]  1.6430309  6.3806803  5.95776881  7.5234383  4.8860264
> [24,]  1.9473764  1.5386180  3.89690297  2.5333431  7.7217174
> [25,]  0.7960661 -1.5137800  2.84861591 -5.9986647  2.9309536
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://http://oscarperpinan.github.io
Twitter: @oscarperpinan


From eddieatr at gmail.com  Mon Nov 11 12:22:24 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Mon, 11 Nov 2013 11:22:24 +0000
Subject: [R-sig-Geo] Select and plot specific row in rasterstack
In-Reply-To: <86y54v9rfv.fsf@Triskela.Home>
References: <CABaJH7_hH8RugzC2wiLBufB3TBVwn6BNk4hKNEo_B0JZUJyj1w@mail.gmail.com>
	<86y54v9rfv.fsf@Triskela.Home>
Message-ID: <CABaJH7-qaERyrG23FBwJwmx=X0N8c8Z4NorbKe4C-VMZ-X_CBg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131111/97b836ca/attachment.pl>

From oscar.perpinan at upm.es  Mon Nov 11 12:37:49 2013
From: oscar.perpinan at upm.es (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Mon, 11 Nov 2013 12:37:49 +0100
Subject: [R-sig-Geo] Select and plot specific row in rasterstack
In-Reply-To: <CABaJH7-qaERyrG23FBwJwmx=X0N8c8Z4NorbKe4C-VMZ-X_CBg@mail.gmail.com>
References: <CABaJH7_hH8RugzC2wiLBufB3TBVwn6BNk4hKNEo_B0JZUJyj1w@mail.gmail.com>,
	<86y54v9rfv.fsf@Triskela.Home>,
	<CABaJH7-qaERyrG23FBwJwmx=X0N8c8Z4NorbKe4C-VMZ-X_CBg@mail.gmail.com>
Message-ID: <86vbzz9njm.fsf@Triskela.Home>

If you know the row and column numbers use 's[row, column]':

s[2, 3]

or if you want to know the cell number:

myCell <- cellFromRowCol(s, 2, 3)
s[myCell]

Oscar

Eddie Smith writes:

> Thanks a lot Oscar.
>
> I just realized that I had misunderstood how R listed the pixels.Row 1 is
> actually consist of pixel 1 to 5. Row 2, pixel 6 to 10 and so on.
>
> What I want to plot is actually a single pixel over time. For example, I
> want to plot pixel at row 2, column 3 for those 5 years.
>
> I know I can use plot(c(s[8])) but it's hard for me to know the pixel if
> for example I had much larger rasterstack and want to plot pixel at row 200
> and column 130.
>
>
>
>
>
>
>
>
>
>
> On Mon, Nov 11, 2013 at 10:13 AM, Oscar Perpi..n Lamigueiro <
> oscar.perpinan at upm.es> wrote:
>
>> Hello,
>>
>> You can extract a row from a RasterStack with s[i,]. Try this code:
>>
>> library(raster)
>> library(zoo)
>> library(lattice)
>>
>> r <- raster(nrow=20, ncol=5)
>> s <- stack( sapply(1:5, function(i) setValues(r, rnorm(ncell(r), i, 3) )) )
>> ## assign a time index to the 'RasterStack'
>> s <- setZ(s, seq(Sys.Date()-4, by='day', length=5))
>>
>> ## extract a row (10) and convert the result (a 'matrix') into a 'zoo'
>> ## object using the time index of the 'RasterStack' object
>> zz <- zoo(t(s[10,]), order.by=getZ(s))
>>
>> xyplot(zz, superpose=TRUE)
>>
>>
>> Best,
>>
>> Oscar.
>> Eddie Smith writes:
>>
>> > Dear list,
>> >
>> > How do I plot a specific row over time? For example I want to plot row
>> > 10(layer.1 to 5 is actually year 1 to year 5.
>> >
>> > library(raster)
>> > r <- raster(nrow=5, ncol=5)
>> > s <- stack( sapply(1:5, function(i) setValues(r, rnorm(ncell(r), i, 3)
>> )) )
>> > s[]
>> >
>> >          layer.1    layer.2     layer.3    layer.4    layer.5
>> >  [1,]  6.7134890  6.9141251  4.38213123  4.8995302  2.3105321
>> >  [2,]  3.4323121  6.1074031 10.12872426  3.6728949  3.2252562
>> >  [3,]  4.4370107  3.1397068  5.47572912  1.9692684  4.0064603
>> >  [4,] -1.5588723  0.4075960 -0.73333754  6.3589944  5.0355051
>> >  [5,]  2.8095750  5.4264553  1.17820009  2.0665198  8.0491221
>> >  [6,]  4.3422219  2.1106691  1.08638206  5.0640175  6.8057674
>> >  [7,] -3.1072366 -1.1174633  6.28901706  5.0713964  1.8651354
>> >  [8,] -0.5628539  2.1868130  1.21288191  0.3114011  3.0452161
>> >  [9,]  0.1725606  3.4535112 -1.38043518  3.6439042  5.4005650
>> > [10,] -2.3376856  4.8803363 -0.05927408  7.9275016  4.7013126
>> > [11,]  2.3032655  2.4974161  4.63961513  1.4021305 10.2302589
>> > [12,]  0.4470648  1.1660421 -0.70127807  6.3293479  6.6178080
>> > [13,]  2.5835127 -0.8768809  2.87405383  6.1361518  3.4851934
>> > [14,] -3.2769134  2.1721391  2.17317611  1.4170633  0.6446692
>> > [15,]  1.0771079 -2.5369687  4.89710339  1.8667695  4.4847933
>> > [16,]  7.2532218  3.0210221  0.56993065  2.4564492  6.9473683
>> > [17,]  4.0682441 -0.8198112  4.85259334  7.3296033  8.9541915
>> > [18,]  5.3991328 -0.9818425  1.73782230  2.9220433  4.9865858
>> > [19,]  2.0556183 -0.7470914  5.44869675  1.6452235  4.5236089
>> > [20,] -0.6277883  6.7255821  5.12606765  5.5721351  4.7081256
>> > [21,]  9.0139352  3.1350767  6.59366754  2.0351358  5.1865195
>> > [22,]  7.0598020  0.2869291  7.14368927  9.7213576  0.4251934
>> > [23,]  1.6430309  6.3806803  5.95776881  7.5234383  4.8860264
>> > [24,]  1.9473764  1.5386180  3.89690297  2.5333431  7.7217174
>> > [25,]  0.7960661 -1.5137800  2.84861591 -5.9986647  2.9309536
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>> --
>> Oscar Perpi..n Lamigueiro
>> Dpto. Ingenier.a El.ctrica (ETSIDI-UPM)
>> Grupo de Sistemas Fotovoltaicos (IES-UPM)
>> URL: http://http://oscarperpinan.github.io
>> Twitter: @oscarperpinan
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://http://oscarperpinan.github.io
Twitter: @oscarperpinan


From eddieatr at gmail.com  Mon Nov 11 13:14:20 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Mon, 11 Nov 2013 12:14:20 +0000
Subject: [R-sig-Geo] Select and plot specific row in rasterstack
In-Reply-To: <86vbzz9njm.fsf@Triskela.Home>
References: <CABaJH7_hH8RugzC2wiLBufB3TBVwn6BNk4hKNEo_B0JZUJyj1w@mail.gmail.com>
	<86y54v9rfv.fsf@Triskela.Home>
	<CABaJH7-qaERyrG23FBwJwmx=X0N8c8Z4NorbKe4C-VMZ-X_CBg@mail.gmail.com>
	<86vbzz9njm.fsf@Triskela.Home>
Message-ID: <CABaJH78VKn4yc0TZRNDN0ixvs1C+Nrj0VZ=9rt2YrwvZ+dRUog@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131111/c14acab0/attachment.pl>

From mello at ieee.org  Mon Nov 11 14:05:40 2013
From: mello at ieee.org (Marcio Pupin Mello)
Date: Mon, 11 Nov 2013 11:05:40 -0200
Subject: [R-sig-Geo] selecting n smallest values from a Raster
Message-ID: <l5qkmp$o62$1@ger.gmane.org>

Dear list,
	I have a RasterLayer (raster package) and want to select "n" smallest 
values from it (values and coordinates). I figured out that the 
which.min function in the raster package give me the coordinate of the 
smallest value. But how could I get the 10 smallest values?
	I'm using last version of R for Windows and all the packages.
	Thanks in advance,
-- 
Marcio
www.dsr.inpe.br/~mello


From roman.lustrik at gmail.com  Mon Nov 11 14:15:26 2013
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 11 Nov 2013 14:15:26 +0100
Subject: [R-sig-Geo] selecting n smallest values from a Raster
In-Reply-To: <l5qkmp$o62$1@ger.gmane.org>
References: <l5qkmp$o62$1@ger.gmane.org>
Message-ID: <CAHT1vphFLFPAN5HURM0wyYKHd-i9Ci+DvjC5NJk003SZ0_Vqjg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131111/37ecce0a/attachment.pl>

From mello at ieee.org  Mon Nov 11 14:24:02 2013
From: mello at ieee.org (Marcio Pupin Mello)
Date: Mon, 11 Nov 2013 11:24:02 -0200
Subject: [R-sig-Geo] selecting n smallest values from a Raster
In-Reply-To: <CAHT1vphFLFPAN5HURM0wyYKHd-i9Ci+DvjC5NJk003SZ0_Vqjg@mail.gmail.com>
References: <l5qkmp$o62$1@ger.gmane.org>
	<CAHT1vphFLFPAN5HURM0wyYKHd-i9Ci+DvjC5NJk003SZ0_Vqjg@mail.gmail.com>
Message-ID: <l5qlp7$4lb$1@ger.gmane.org>

Great!
	I was trying "order(my.r)" instead of "order(my.r[])".
	Thank you Roman!
	Cheers,

Marcio
www.dsr.inpe.br/~mello


On 11/11/2013 11:15, Roman Lu?trik wrote:
> Something like this?
>
> library(raster)
>
> my.r <- raster(nrow = 10, ncol = 10)
> my.r[] <- runif(ncell(my.r))
> plot(my.r)
>
> cell.numbers <- order(my.r[])
> cell.numbers[1:10]
>   [1]  32  33  81  12  28  98 100  34  69   2
> xyFromCell(my.r, cell.numbers[1:10])
>           x   y
>   [1,] -126  27
>   [2,]  -90  27
>   [3,] -162 -63
>   [4,] -126  63
>   [5,]   90  45
>   [6,]   90 -81
>   [7,]  162 -81
>   [8,]  -54  27
>   [9,]  126 -27
> [10,] -126  81
>
> points(xyFromCell(my.r, cell.numbers[1:10]))
>
> Cheers,
> Roman
>
>
>
>
> On Mon, Nov 11, 2013 at 2:05 PM, Marcio Pupin Mello <mello at ieee.org> wrote:
>
>> Dear list,
>>          I have a RasterLayer (raster package) and want to select "n"
>> smallest values from it (values and coordinates). I figured out that the
>> which.min function in the raster package give me the coordinate of the
>> smallest value. But how could I get the 10 smallest values?
>>          I'm using last version of R for Windows and all the packages.
>>          Thanks in advance,
>> --
>> Marcio
>> www.dsr.inpe.br/~mello
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

-- 
Marcio
www.dsr.inpe.br/~mello


From samanmonfared1 at gmail.com  Mon Nov 11 18:01:39 2013
From: samanmonfared1 at gmail.com (Saman Monfared)
Date: Mon, 11 Nov 2013 20:31:39 +0330
Subject: [R-sig-Geo] St matrix form
Message-ID: <CAOytA4a81GmnyD5VeXKzRnFi53wMxs1_5wtx24-wKwdi-sF-8w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131111/2a9fea19/attachment.pl>

From eddieatr at gmail.com  Mon Nov 11 20:53:30 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Mon, 11 Nov 2013 19:53:30 +0000
Subject: [R-sig-Geo] How to extract the first 10 rows in a rasterstack?
Message-ID: <CABaJH799=EmUUa-o2FcyeLX=vpN5p8AffkODKNs736HUe5RXOg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131111/9a3a61c3/attachment.pl>

From dan.rosauer at anu.edu.au  Tue Nov 12 05:43:45 2013
From: dan.rosauer at anu.edu.au (Dan Rosauer)
Date: Tue, 12 Nov 2013 04:43:45 +0000
Subject: [R-sig-Geo] write .flt format in R
Message-ID: <99EECC31A3D980448F72935790880DB9128B0E81@HKXPRD0610MB389.apcprd06.prod.outlook.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131112/e4e6ac3d/attachment.pl>

From mdsumner at gmail.com  Tue Nov 12 06:31:42 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 12 Nov 2013 16:31:42 +1100
Subject: [R-sig-Geo] write .flt format in R
In-Reply-To: <99EECC31A3D980448F72935790880DB9128B0E81@HKXPRD0610MB389.apcprd06.prod.outlook.com>
References: <99EECC31A3D980448F72935790880DB9128B0E81@HKXPRD0610MB389.apcprd06.prod.outlook.com>
Message-ID: <CAAcGz9-aFor7aPq3CHOs6En1YdGXx02gOHC34ni9n72dYtUh4g@mail.gmail.com>

You could use rgdal instead:

library(raster)
library(rgdal)
x <- raster(volcano, crs = "+proj=laea")
## so rather than
## writeRaster(x, "file.flt")
writeGDAL(as(x, "SpatialGridDataFrame"), "file.flt", drivername = "EHdr")

## see this for the drivers available
gdalDrivers()

But that format is not very well defined, so I would test carefully
that your target is satisfied.

See here for some info:
http://www.gdal.org/frmt_various.html#EHdr
http://geospaced.blogspot.co.uk/2011/12/reading-afripop-data.html


Cheers, Mike.

On Tue, Nov 12, 2013 at 3:43 PM, Dan Rosauer <dan.rosauer at anu.edu.au> wrote:
> Hi
>
> Can anyone advise on an R method to write a raster object to the ESRI .flt grid format?
>
> writeRaster accepted the *.flt filename, but silently handled it by actually saving to *.grd, *.gri files which are the DIVA format.
>
> I can do it by roundabout methods, eg writing to .asc and then converting in DIVA or ArcGIS.  But a direct method would save much time and fiddling.
>
> Thanks for your help.
>
> Dan
>
> ~~~~~~~~~~~~~~~~~~~~~~
> Dan Rosauer
> Postdoctoral Fellow
> Moritz Lab
> Ecology, Evolution & Genetics
> Research School of Biology
> Gould Building, Daley Road
> Australian National University
> Canberra ACT 0200
>
> +61 413 950 275 (mobile)
> +61 2 6125 1028 (office)
> dan.rosauer at anu.edu.au
>
> sites.google.com/site/danielrosauer
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From thanhtungmilan at gmail.com  Wed Nov 13 09:06:46 2013
From: thanhtungmilan at gmail.com (Tung Nguyen)
Date: Wed, 13 Nov 2013 00:06:46 -0800
Subject: [R-sig-Geo] Interpolate time series point values to an existing
 raster grid having different resolution and projection
Message-ID: <CAE0B8CJt5sD6C_WcrYRw+miz12g+QeAEtPXLMgVNHeMn6=RdzA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/4f223d2d/attachment.pl>

From lassana60 at gmail.com  Wed Nov 13 09:27:03 2013
From: lassana60 at gmail.com (lassana toure)
Date: Wed, 13 Nov 2013 08:27:03 +0000
Subject: [R-sig-Geo] Connectons-nous sur LinkedIn
Message-ID: <2107194661.2349135.1384331223453.JavaMail.app@ela4-app0097.prod>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/dad20ebf/attachment.pl>

From mauriziomarchi85 at gmail.com  Wed Nov 13 11:00:04 2013
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Wed, 13 Nov 2013 11:00:04 +0100
Subject: [R-sig-Geo] Collinearity test
Message-ID: <CANJhsN1XciOa4z-1L4a9fchDZ1qyVCe9LGFK2S6LFZp20WXo6w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/676c12d6/attachment.pl>

From imranserver at yahoo.com  Wed Nov 13 11:10:42 2013
From: imranserver at yahoo.com (Muhammad Imran)
Date: Wed, 13 Nov 2013 02:10:42 -0800 (PST)
Subject: [R-sig-Geo] Collinearity test
In-Reply-To: <CANJhsN1XciOa4z-1L4a9fchDZ1qyVCe9LGFK2S6LFZp20WXo6w@mail.gmail.com>
References: <CANJhsN1XciOa4z-1L4a9fchDZ1qyVCe9LGFK2S6LFZp20WXo6w@mail.gmail.com>
Message-ID: <1384337442.23116.YahooMailNeo@web160702.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/81a24a11/attachment.pl>

From alaios at yahoo.com  Wed Nov 13 11:36:32 2013
From: alaios at yahoo.com (Alaios)
Date: Wed, 13 Nov 2013 02:36:32 -0800 (PST)
Subject: [R-sig-Geo] Grid type of sampling in geodata
Message-ID: <1384338992.27448.YahooMailNeo@web125304.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/bfb87be9/attachment.pl>

From dominic.roye at gmail.com  Wed Nov 13 11:54:34 2013
From: dominic.roye at gmail.com (Dominic Roye)
Date: Wed, 13 Nov 2013 11:54:34 +0100
Subject: [R-sig-Geo] Kriging
Message-ID: <CALvVS-EuPanuJpxM9y+knd-DMmKyqi5Zm7GsO7=fga1XRRJxng@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/49703f65/attachment.pl>

From andre.vanproosdij at wur.nl  Wed Nov 13 12:06:09 2013
From: andre.vanproosdij at wur.nl (Proosdij, Andre van)
Date: Wed, 13 Nov 2013 11:06:09 +0000
Subject: [R-sig-Geo] Collinearity test
In-Reply-To: <CANJhsN1XciOa4z-1L4a9fchDZ1qyVCe9LGFK2S6LFZp20WXo6w@mail.gmail.com>
References: <CANJhsN1XciOa4z-1L4a9fchDZ1qyVCe9LGFK2S6LFZp20WXo6w@mail.gmail.com>
Message-ID: <84D737939C16114590DCDD4F003E013B1FEC85AC@SCOMP0936.wurnet.nl>

Hi Maurizio,

I used the rcorr function from the Hmisc package to calculate the Pearson correlation.

Best,


Andr?


Ir. A.S.J. van Proosdij
PhD Student
e? andre.vanproosdij at wur.nl
Naturalis Biodiversity Center, section NHN
Biosystematics Group, Wageningen?University
Gen. Foulkesweg 37, 6703 BL Wageningen,?the Netherlands
www.bis.wur.nl

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Maurizio Marchi
Sent: woensdag 13 november 2013 11:00
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Collinearity test

Hallo everybody,
I'm working with Species Distibution Models to predict the potential distribution of a forest specie.
I use WorldClim raster data for Italy and before running SDMs algorithm I would like to test the collineariy between factors to eliminate redundancy of data.
My question in: is there a package that can be used to Test collinearity between factors of a raster stack (worldclim biovariables)?

Thanks,

--
Maurizio Marchi, Ph.D student
Forestry Research Centre (Arezzo, IT)
ID skype: maurizioxyz
*Ubuntu 12.04 (Precise Pangolin)*

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Wed Nov 13 12:21:46 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 13 Nov 2013 12:21:46 +0100
Subject: [R-sig-Geo] Grid type of sampling in geodata
In-Reply-To: <1384338992.27448.YahooMailNeo@web125304.mail.ne1.yahoo.com>
References: <1384338992.27448.YahooMailNeo@web125304.mail.ne1.yahoo.com>
Message-ID: <528360CA.5070006@uni-muenster.de>

You may want to look at sp::spsample, which can sample along lines,
using different strategies.

Please mention the packages where you found the functions you used.

On 11/13/2013 11:36 AM, Alaios wrote:
> Hi all,
> I have spatial field created with grf and I was wondering if I can sample in lines, something that can resemble sampling outdoors at the streets.
> Random sampling looks to far of what I want to have.
> 
> there is in geodata package the sample.geodata but this looks like to be random samples.
> 
> I would like to thank you in advance for your help
> 
> Regards
> A.
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/d9edfb66/attachment.bin>

From edzer.pebesma at uni-muenster.de  Wed Nov 13 12:28:36 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 13 Nov 2013 12:28:36 +0100
Subject: [R-sig-Geo] Kriging
In-Reply-To: <CALvVS-EuPanuJpxM9y+knd-DMmKyqi5Zm7GsO7=fga1XRRJxng@mail.gmail.com>
References: <CALvVS-EuPanuJpxM9y+knd-DMmKyqi5Zm7GsO7=fga1XRRJxng@mail.gmail.com>
Message-ID: <52836264.5080700@uni-muenster.de>

You may have (near) duplicate points in your data.

Other packages let you control more when you want to kriging, see the
Spatial task view on CRAN.

To me, kriging::kriging seems a bit of a black box: does it compute
Euclidian distances from long/lat coordinates directly? How does it fit
variogram models?

On 11/13/2013 11:54 AM, Dominic Roye wrote:
> Hello,
> 
> I have a problem with the kriging function {kriging}. I get this error:
> 
> "Error in solve.default(matrix(A, n + 1, n + 1)) :
>   system is computationally singular: reciprocal condition number =
> 5.53457e-17"
> 
> But it has worked with other data and now I don't understand why this
> error.
> 
> Here is a data example and at the end the kriging function.
> 
> https://gist.github.com/geo81/b32f98f4784edc4b754d
> 
> Thanks for your help.
> 
> Greetings,
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/0331613a/attachment.bin>

From alaios at yahoo.com  Wed Nov 13 12:54:32 2013
From: alaios at yahoo.com (Alaios)
Date: Wed, 13 Nov 2013 03:54:32 -0800 (PST)
Subject: [R-sig-Geo] Grid type of sampling in geodata
In-Reply-To: <528360CA.5070006@uni-muenster.de>
References: <1384338992.27448.YahooMailNeo@web125304.mail.ne1.yahoo.com>
	<528360CA.5070006@uni-muenster.de>
Message-ID: <1384343672.89072.YahooMailNeo@web125304.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/52573c3d/attachment.pl>

From paulojus at c3sl.ufpr.br  Wed Nov 13 13:15:32 2013
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 13 Nov 2013 10:15:32 -0200 (BRST)
Subject: [R-sig-Geo] Grid type of sampling in geodata
In-Reply-To: <1384343672.89072.YahooMailNeo@web125304.mail.ne1.yahoo.com>
References: <1384338992.27448.YahooMailNeo@web125304.mail.ne1.yahoo.com>
	<528360CA.5070006@uni-muenster.de>
	<1384343672.89072.YahooMailNeo@web125304.mail.ne1.yahoo.com>
Message-ID: <alpine.DEB.2.02.1311131011330.6483@macalan.c3sl.ufpr.br>

So... you can convert from grf() output to a sp class before using 
spsample

## simulating 100 pts using geoR at an irregular grid of points
sim1 <- grf(100, cov.pars=c(1, 0.2))
sim1.sp <- as.data.frame(sim1)
class(sim1.sp) <- "data.frame"
coordinates(sim1.sp) <- ~x+y
class(sim1.sp)


## simulating 100 pts using geoR at an irregular grid of points
sim2 <- grf(121, frid="reg", cov.pars=c(1, 0.2))
sim2.sp <- as.data.frame(sim2)
class(sim2.sp) <- "data.frame"
coordinates(sim2.sp) <- ~x+y
class(sim2.sp)
gridded(sim2.sp) <- TRUE
class(sim2.sp)



Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
VOIP: (+55) (41) (3361 3600) 1053 1066
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Wed, 13 Nov 2013, Alaios wrote:

> Hi,
> thanksf or the answer.
> I am using the? library(geoR)
> and the grf to make map realizations... Thanks also for your suggestion. Currently looks like that the spsample can not work on geodata type of data...
>
> I will have one more round later this evening. I hope better luck by then
>
> Regards
> A
>
>
>
>
> On Wednesday, November 13, 2013 12:22 PM, Edzer Pebesma <edzer.pebesma at uni-muenster.de> wrote:
>
> You may want to look at sp::spsample, which can sample along lines,
> using different strategies.
>
> Please mention the packages where you found the functions you used.
>
>
> On 11/13/2013 11:36 AM, Alaios wrote:
>> Hi all,
>> I have spatial field created with grf and I was wondering if I can sample in lines, something that can resemble sampling outdoors at the streets.
>> Random sampling looks to far of what I want to have.
>>
>> there is in geodata package the sample.geodata but this looks like to be random samples.
>>
>> I would like to thank you in advance for your help
>>
>> Regards
>> A.
>> ??? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- 
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 	[[alternative HTML version deleted]]
>
>


From noelia.gonzalezm at gmail.com  Wed Nov 13 13:19:51 2013
From: noelia.gonzalezm at gmail.com (Acacia dealbata)
Date: Wed, 13 Nov 2013 04:19:51 -0800 (PST)
Subject: [R-sig-Geo] Memory size
Message-ID: <1384345191905-7585100.post@n2.nabble.com>

Hi community!

I am trying to run SDMs in a PC. 

However, I got this message:

Error: cannot allocate vector of size 133.5 Mb
Reached total allocation of 1535 Mb: see help (memory.size)

Do you know how can fix it? 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Memory-size-tp7585100.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From s6lihert at uni-bonn.de  Wed Nov 13 13:34:40 2013
From: s6lihert at uni-bonn.de (Lionel)
Date: Wed, 13 Nov 2013 13:34:40 +0100
Subject: [R-sig-Geo] Memory size
In-Reply-To: <1384345191905-7585100.post@n2.nabble.com>
References: <1384345191905-7585100.post@n2.nabble.com>
Message-ID: <528371E0.1050106@uni-bonn.de>

Several options:

-buy a PC with more RAM memory
-break down the analysis into smaller fragments
-increase the memory allocation to R (see ?memory.size)

Yours,
Lionel

On 11/13/2013 01:19 PM, Acacia dealbata wrote:
> Hi community!
>
> I am trying to run SDMs in a PC.
>
> However, I got this message:
>
> Error: cannot allocate vector of size 133.5 Mb
> Reached total allocation of 1535 Mb: see help (memory.size)
>
> Do you know how can fix it?
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Memory-size-tp7585100.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Wed Nov 13 13:47:43 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 13 Nov 2013 13:47:43 +0100
Subject: [R-sig-Geo] Memory size
In-Reply-To: <1384345191905-7585100.post@n2.nabble.com>
References: <1384345191905-7585100.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1311131345080.22318@reclus.nhh.no>

On Wed, 13 Nov 2013, Acacia dealbata wrote:

> Hi community!
>
> I am trying to run SDMs in a PC.
>
> However, I got this message:
>
> Error: cannot allocate vector of size 133.5 Mb
> Reached total allocation of 1535 Mb: see help (memory.size)
>
> Do you know how can fix it?

Yes, do read the posting guide:

http://www.r-project.org/posting-guide.html

and instructions:

http://www.r-project.org/mail.html#instructions

Then think: what could SDM mean to anyone but me if I don't include the 
command following which the error message appears? School of Dental 
Medicine? You need to be explicit and concise.

Roger

>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Memory-size-tp7585100.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From samanmonfared1 at gmail.com  Wed Nov 13 13:50:31 2013
From: samanmonfared1 at gmail.com (Saman Monfared)
Date: Wed, 13 Nov 2013 16:20:31 +0330
Subject: [R-sig-Geo] St kriging
In-Reply-To: <CAOytA4b+TJc-9oQ7rUyOyxEB1B5kEfSd2c7Qc4AuoPvxAynijQ@mail.gmail.com>
References: <CAOytA4b+TJc-9oQ7rUyOyxEB1B5kEfSd2c7Qc4AuoPvxAynijQ@mail.gmail.com>
Message-ID: <CAOytA4Z3Hzt1-gJysfHHYZNk5SO7O3EXid3ad9E2JKFaY6z64A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131113/6767333f/attachment.pl>

From cyndyh at nmsu.edu  Wed Nov 13 18:29:03 2013
From: cyndyh at nmsu.edu (cyndy-jer)
Date: Wed, 13 Nov 2013 09:29:03 -0800 (PST)
Subject: [R-sig-Geo] trouble installing rgdal on CentOs 6.2 - help?
Message-ID: <1384363743178-7585104.post@n2.nabble.com>

Hi folks -

I'm having trouble with rgdal on a Linux machine (specifically, CentOS 6.2).  
I've successfully installed sp and GeoTiff, Gdal, and a few other goodies
from instructions on this page:

http://scigeo.org/articles/howto-install-latest-geospatial-software-on-linux.html#libtiff

But when I go into R and install.packages("rgdal")  I get the following
error:

*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded
Error in dyn.load(file, DLLpath = DLLpath, ...) :
 * unable to load shared object
'/usr/local/lib64/R/library/rgdal/libs/rgdal.so':
  libgdal.so.1: cannot open shared object file: No such file or directory*
Error: loading failed
Execution halted

However:

[root at jornada-devvlt2 libkml-trunk]# cd
/usr/local/lib64/R/library/rgdal/libs/
[root at jornada-devvlt2 libs]# ls
libgdal.so.1  rgdal.so  test

???  Can anyone shed any light on what might be wrong, here?

Thanks much.






--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/trouble-installing-rgdal-on-CentOs-6-2-help-tp7585104.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Wed Nov 13 19:25:01 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 13 Nov 2013 19:25:01 +0100
Subject: [R-sig-Geo] trouble installing rgdal on CentOs 6.2 - help?
In-Reply-To: <1384363743178-7585104.post@n2.nabble.com>
References: <1384363743178-7585104.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1311131905330.29554@reclus.nhh.no>

On Wed, 13 Nov 2013, cyndy-jer wrote:

> Hi folks -
>
> I'm having trouble with rgdal on a Linux machine (specifically, CentOS 6.2).
> I've successfully installed sp and GeoTiff, Gdal, and a few other goodies
> from instructions on this page:
>
> http://scigeo.org/articles/howto-install-latest-geospatial-software-on-linux.html#libtiff

This page appears to be written by someone without sufficient insight into 
basic Linux handling of shared objects, and without understanding the need 
to clarify and simplify. There is no need to install most of the drivers 
suggested, there is no need to build and install GDAL with all the flags 
given, there is no need to put it in a special /opt location, there is no 
need to build from trunk.

However, given that you've followed these arcane instructions, did you add 
the install location to a directory under /etc/ld.so.conf.d as root, then 
run /sbin/ldconfig to make the shared objects stored there available?

The page does use LD_LIBRARY_PATH, and does run ldconfig from time to 
time, but the page is far too picky.

Also consult:

https://r-forge.r-project.org/scm/viewvc.php/pkg/inst/README?view=markup&root=rgdal

or inst/README in the rgdal TARBALL for accumulated installation hints.

Hope this clarifies,

Roger

>
> But when I go into R and install.packages("rgdal")  I get the following
> error:
>
> *** installing help indices
> ** building package indices
> ** installing vignettes
> ** testing if installed package can be loaded
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
> * unable to load shared object
> '/usr/local/lib64/R/library/rgdal/libs/rgdal.so':
>  libgdal.so.1: cannot open shared object file: No such file or directory*
> Error: loading failed
> Execution halted
>
> However:
>
> [root at jornada-devvlt2 libkml-trunk]# cd
> /usr/local/lib64/R/library/rgdal/libs/
> [root at jornada-devvlt2 libs]# ls
> libgdal.so.1  rgdal.so  test
>
> ???  Can anyone shed any light on what might be wrong, here?
>
> Thanks much.
>
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/trouble-installing-rgdal-on-CentOs-6-2-help-tp7585104.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Scott.Waichler at pnnl.gov  Thu Nov 14 05:00:18 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Wed, 13 Nov 2013 20:00:18 -0800
Subject: [R-sig-Geo] working with a rotated grid of SpatialPolygons
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B2980D61@EMAIL05.pnl.gov>

I have an environmental process model whose domain is a regular grid that is not oriented in the cardinal directions.  I want to show an outline of the active part of the domain, as well as other subgroupings of cells within the domain, on a map figure.  These will be "blocky" polygons oriented at an angle to E-W, N-S.  I assume I should do the rotation on (x,y,z) with rotate3d() of rgl.  If there is a way to rotate sp objects directly, do tell.

library(rgl)
library(sp)
x <- y <- seq(0.5, 9.5, by=1)  # cell centers of a toy grid
xy <- expand.grid(x, y)
xyz <- matrix(data = 0, nrow=nrow(xy), ncol=3)
xyz[,1] <- xy[,1]
xyz[,2] <- xy[,2]
# rotate the grid 45 degrees counterclockwise
xyz.r <- rotate3d(obj=xyz, angle=-pi/4, x=0, y=0, z=1)
# plot the cell centers (not vertices) of the original and rotated grids
plot(xyz[,1], xyz[,2], col="blue", type="p", asp=1, xlim=c(-6, 10), ylim=c(0, 15), main="grid cell centers")
points(xyz.r[,1], xyz.r[,2], col="red", type="p")

# I have learned this for defining polygons based on the original grid:
grd <- GridTopology(cellcentre.offset=c(0.5,0.5), cellsize=c(1,1), cells.dim=c(10,10))
grdp <- as.SpatialPolygons.GridTopology(grd)

How can I efficiently extract the vertices of all the grdp polygons (each one a square) so that I can rotate them?  I think str() and slot() are needed but I don't understand them.  Once I have the rotated vertex coordinates, how do I use them to define the new SpatialPolygons?  Once I have SpatialPolygons, I want to use unionSpatialPolygons(), so I also need to understand how to carry through an attribute for classifying grid cells.

I could easily rotate vertices instead of cell centers, but I wouldn't know how to make grid cell polygons from the matrix of coordinates.

Scott Waichler
Pacific Northwest National Laboratory, Washington, USA
scott.waichler at pnnl.gov


From mdsumner at gmail.com  Thu Nov 14 05:22:51 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 14 Nov 2013 15:22:51 +1100
Subject: [R-sig-Geo] working with a rotated grid of SpatialPolygons
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B2980D61@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B2980D61@EMAIL05.pnl.gov>
Message-ID: <CAAcGz98H7tLRbzUU7PPO3O6L_+Y0E-E_Lq8629c57VX6tZjoGQ@mail.gmail.com>

How about just using high-level maptools?  Following on directly from
your code, the function elide can rotate the grid polygons:

library(maptools)
 plot(elide(grdp, rotate = -45), add = TRUE)


On Thu, Nov 14, 2013 at 3:00 PM, Waichler, Scott R
<Scott.Waichler at pnnl.gov> wrote:
> I have an environmental process model whose domain is a regular grid that is not oriented in the cardinal directions.  I want to show an outline of the active part of the domain, as well as other subgroupings of cells within the domain, on a map figure.  These will be "blocky" polygons oriented at an angle to E-W, N-S.  I assume I should do the rotation on (x,y,z) with rotate3d() of rgl.  If there is a way to rotate sp objects directly, do tell.
>
> library(rgl)
> library(sp)
> x <- y <- seq(0.5, 9.5, by=1)  # cell centers of a toy grid
> xy <- expand.grid(x, y)
> xyz <- matrix(data = 0, nrow=nrow(xy), ncol=3)
> xyz[,1] <- xy[,1]
> xyz[,2] <- xy[,2]
> # rotate the grid 45 degrees counterclockwise
> xyz.r <- rotate3d(obj=xyz, angle=-pi/4, x=0, y=0, z=1)
> # plot the cell centers (not vertices) of the original and rotated grids
> plot(xyz[,1], xyz[,2], col="blue", type="p", asp=1, xlim=c(-6, 10), ylim=c(0, 15), main="grid cell centers")
> points(xyz.r[,1], xyz.r[,2], col="red", type="p")
>
> # I have learned this for defining polygons based on the original grid:
> grd <- GridTopology(cellcentre.offset=c(0.5,0.5), cellsize=c(1,1), cells.dim=c(10,10))
> grdp <- as.SpatialPolygons.GridTopology(grd)
>
> How can I efficiently extract the vertices of all the grdp polygons (each one a square) so that I can rotate them?  I think str() and slot() are needed but I don't understand them.  Once I have the rotated vertex coordinates, how do I use them to define the new SpatialPolygons?  Once I have SpatialPolygons, I want to use unionSpatialPolygons(), so I also need to understand how to carry through an attribute for classifying grid cells.
>
> I could easily rotate vertices instead of cell centers, but I wouldn't know how to make grid cell polygons from the matrix of coordinates.
>
> Scott Waichler
> Pacific Northwest National Laboratory, Washington, USA
> scott.waichler at pnnl.gov
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From b.rowlingson at lancaster.ac.uk  Thu Nov 14 09:32:09 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 14 Nov 2013 08:32:09 +0000
Subject: [R-sig-Geo] working with a rotated grid of SpatialPolygons
In-Reply-To: <6391feb6c67a4dcd9b73ef259db3a2c6@EX-1-HT0.lancs.local>
References: <6391feb6c67a4dcd9b73ef259db3a2c6@EX-1-HT0.lancs.local>
Message-ID: <CANVKczN+0juvHAU3dp3=TCA7_8pG1=Crsdx1ftCDd4+g7KMUnw@mail.gmail.com>

On Thu, Nov 14, 2013 at 4:00 AM, Waichler, Scott R
<Scott.Waichler at pnnl.gov> wrote:
> I have an environmental process model whose domain is a regular grid that is not oriented in the cardinal directions.  I want to show an outline of the active part of the domain, as well as other subgroupings of cells within the domain, on a map figure.  These will be "blocky" polygons oriented at an angle to E-W, N-S.  I assume I should do the rotation on (x,y,z) with rotate3d() of rgl.  If there is a way to rotate sp objects directly, do tell.
>
> library(rgl)
> library(sp)
> x <- y <- seq(0.5, 9.5, by=1)  # cell centers of a toy grid
> xy <- expand.grid(x, y)
> xyz <- matrix(data = 0, nrow=nrow(xy), ncol=3)
> xyz[,1] <- xy[,1]
> xyz[,2] <- xy[,2]
> # rotate the grid 45 degrees counterclockwise
> xyz.r <- rotate3d(obj=xyz, angle=-pi/4, x=0, y=0, z=1)
> # plot the cell centers (not vertices) of the original and rotated grids
> plot(xyz[,1], xyz[,2], col="blue", type="p", asp=1, xlim=c(-6, 10), ylim=c(0, 15), main="grid cell centers")
> points(xyz.r[,1], xyz.r[,2], col="red", type="p")
>
> # I have learned this for defining polygons based on the original grid:
> grd <- GridTopology(cellcentre.offset=c(0.5,0.5), cellsize=c(1,1), cells.dim=c(10,10))
> grdp <- as.SpatialPolygons.GridTopology(grd)
>
> How can I efficiently extract the vertices of all the grdp polygons (each one a square) so that I can rotate them?  I think str() and slot() are needed but I don't understand them.  Once I have the rotated vertex coordinates, how do I use them to define the new SpatialPolygons?  Once I have SpatialPolygons, I want to use unionSpatialPolygons(), so I also need to understand how to carry through an attribute for classifying grid cells.
>
> I could easily rotate vertices instead of cell centers, but I wouldn't know how to make grid cell polygons from the matrix of coordinates.

Ooh thats a lot of questions. If you are working on a regular grid
rotated at a known angle to your coordinate system, it might be
possible to define a coordinate system where your points are aligned
with the coordinate axes.

I do something like this using an oblique mercator projection, as
explained here:

http://rpubs.com/geospacedman/rotatespatial

The usual mercator projection imagines a cylinder wrapped around the
earth touching at the equator, a transverse mercator has the cylinder
wrapped at right-angles to that, along a line of latitude (and its
180-degree opposite), and an oblique mercator imagines the cylinder
wrapped at any great circle.

Is your data in a real geographic coordinate system, like UTM or is
this simply a model with no base on the ground:?

Barry


From cicoz at anadolu.edu.tr  Thu Nov 14 10:22:23 2013
From: cicoz at anadolu.edu.tr (=?iso-8859-3?B?Q2VuayCpx9Za?=)
Date: Thu, 14 Nov 2013 09:22:23 +0000
Subject: [R-sig-Geo] Coluring a map
Message-ID: <CEAA62F2.1C00%cicoz@anadolu.edu.tr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131114/0a90d3e9/attachment.pl>

From roman.lustrik at gmail.com  Thu Nov 14 10:36:33 2013
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Thu, 14 Nov 2013 10:36:33 +0100
Subject: [R-sig-Geo] Coluring a map
In-Reply-To: <CEAA62F2.1C00%cicoz@anadolu.edu.tr>
References: <CEAA62F2.1C00%cicoz@anadolu.edu.tr>
Message-ID: <CAHT1vph29qGiVqcgCzTX4qxK9otvrvXjBPJnV7r4JJXchRxifA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131114/141e6ba4/attachment.pl>

From dominic.roye at gmail.com  Thu Nov 14 13:17:26 2013
From: dominic.roye at gmail.com (Dominic Roye)
Date: Thu, 14 Nov 2013 13:17:26 +0100
Subject: [R-sig-Geo] Kriging
Message-ID: <CALvVS-F3f5Wpj8o8NCun=9nTnttfEwbEc50TNPE09uo+kWqxrQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131114/464df0b9/attachment.pl>

From mgilbert at ulb.ac.be  Thu Nov 14 13:33:11 2013
From: mgilbert at ulb.ac.be (Marius Gilbert)
Date: Thu, 14 Nov 2013 13:33:11 +0100
Subject: [R-sig-Geo] 2-year Post-Doc position in livestock and human
 population distribution modeling using R
Message-ID: <5284C307.4080202@ulb.ac.be>

Dear colleagues,
This short post to inform those potentially interested that we have a 
2-year post-doc position opened until filled in our lab in Brussels to 
work on livestock and human population distribution modeling using R. 
More information about the position can be found here: 
http://bit.ly/1cdNqGr
Kind regards,
Marius

-- 

Marius Gilbert


--------------------------------------------------
Chercheur qualifi? FNRS
Lutte biologique et Ecologie spatiale (LUBIES)
Universite Libre de Bruxelles CP 160/12
50, av F.D. Roosevelt  1050, Bruxelles BELGIUM
http://lubies.ulb.ac.be/Spatepi.html
Tel: +32-2-650.37.80 - Fax: +32-2-650.24.45


From Scott.Waichler at pnnl.gov  Thu Nov 14 16:57:36 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Thu, 14 Nov 2013 07:57:36 -0800
Subject: [R-sig-Geo] working with a rotated grid of SpatialPolygons
In-Reply-To: <CANVKczN+0juvHAU3dp3=TCA7_8pG1=Crsdx1ftCDd4+g7KMUnw@mail.gmail.com>
References: <6391feb6c67a4dcd9b73ef259db3a2c6@EX-1-HT0.lancs.local>
	<CANVKczN+0juvHAU3dp3=TCA7_8pG1=Crsdx1ftCDd4+g7KMUnw@mail.gmail.com>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B2980D70@EMAIL05.pnl.gov>

> How about just using high-level maptools?  Following on directly from your
> code, the function elide can rotate the grid polygons:
> 
> library(maptools)
> plot(elide(grdp, rotate = -45), add = TRUE)

Yes, elide should work for my needs.  Thank you for pointing it out!


> Is your data in a real geographic coordinate system, like UTM or is this
> simply a model with no base on the ground:?

The grid has uniform spacing and I can easily define it with the lower left corner at (0,0), and extending to the right and up.  But I want to rotate the grid and convert the points to a geographic coordinate system like UTM (using a georeferenced location for the model grid origin) so that I can plot the grid over a Google Map background.  I know how to do it using the grid package--a rotated viewport for the model grid and relative coordinates within the viewport, but I would like to learn how to do it using and saving actual geographic coordinates for the grid, so that I can use higher level plotting functions.

I think can get there using the wonderful capabilities of elide().

Scott Waichler


From calum at callingthetune.co.uk  Fri Nov 15 13:25:31 2013
From: calum at callingthetune.co.uk (Calum Galleitch)
Date: Fri, 15 Nov 2013 12:25:31 +0000
Subject: [R-sig-Geo] Formatting output of plotKML
Message-ID: <CALbM3JPO01_BATrifSqqSO+NP_7V24BMj1dJ_3fc-P_VrYs=Sg@mail.gmail.com>

 Hello,

I am having a little trouble with plotKML and I am not sure whether to
ascribe it to my incompetence (most likely), incomplete documentation,
or other incorrect behaviour.

My aim is to produce a display in Google Earth visualising point data,
and I wish to control the size, label, and colour of these points.  I
have succesfully achieved the first two but am struggling a little to
achieve the latter.  I have attached my test data below along with the
script I am using and sessionInfo().  The test data is in the UK's
National Grid co-ordinate system so it gets converted before writing
out as a SpacialPointsDataFrame.

According to the ?plotKML documentation there is a colour argument;
however attempting to call it with a vector of required colours fails:

> plotKML(map_data_lat_long,
+         file.name='test.kml',
+         points_names = map_data_lat_long at data$Label,
+         colour = col2kml("red") # or map_data_lat_long at data$colour -
with or without col2kml
+         )
Error in `[.data.frame`(obj at data, , as.character(colour)) :
  undefined columns selected

Suspecting a localisation issue I tried color instead.  This did not
error, however it just generated the default colour palette.  Other
incantations of various sorts have not really helped, including
replacing named colours with the output of col2kml in the data.

I have tried to use kml_aes but it's not very clear to me how it is to be used.

Any advice will be most welcome, even if just possible avenues to
attack.  Also, I am not wedded by any means to plotKML and suggestions
for similar methods to achieve the same ends would also be helpful.

Many thanks,
Calum

test.csv:

xCord,yCord,size,Label,colour
532063,180615,14854874,Label A 1,red
537441,179551,851711370,Label A 2,red
560496,193284,652296152,Label A 3,red
324608,673413,936830099,Label A 4,red
532912,181045,734565801,Label B1,yellow
533045,181729,213722268,Label B2,yellow
530997,181334,104685106,Label B3,yellow
412716,94732,129014315,Label B4,yellow
532922,182308,385289711,Label B5,yellow
412782,93652,203823599,Label B6,yellow
533087,181376,666606649,Label B7,yellow
257763,665929,270940754,Label B8,yellow
410777,91722,442497572,Label B9,yellow
529425,181882,784422025,Label B10,yellow
532099,181799,679613728,Label B11,yellow
317524,671657,15213991,Label B12,yellow
532083,181106,51632818,Label B13,yellow
538538,181218,753123608,Label B14,yellow
409275,183852,916308988,Label B15,yellow
410525,91826,315714830,Label B16,yellow
531754,181472,533400391,Label B17,yellow
531283,180728,555929970,Label C1,green
532626,182039,873479599,Label C2,green
531808,180688,646380547,Label C3,green
531420,180361,672470450,Label C4,green
406677,287059,570024001,Label C5,green
360081,173983,877518563,Label C6,green
531881,180954,31953847,Label C7,green
533121,181183,983234849,Label C8,green
532923,180402,247198656,Label C9,green
532462,181973,442823961,Label C10,green
261791,669595,730094270,Label C11,green
459422,302817,884024369,Label D1,blue
429471,434310,235268642,Label D2,blue
379879,395710,674285057,Label D3,blue
384301,398337,920018841,Label D4,blue
624079,309248,317068333,Label D5,blue
625735,310478,944036809,Label D6,blue
622527,307366,269074659,Label D7,blue
629426,308707,796105708,Label D8,blue
628978,309282,469163049,Label D9,blue
309342,722860,550759988,Label D10,blue
433071,384763,205810120,Label D11,blue
433895,389174,859445905,Label D12,blue
443319,118260,662205408,Label D13,blue
459825,451261,465489204,Label D14,blue
459630,451405,807818766,Label D15,blue

Script:

# Load required libraries
library("plotKML")

# Read data
csvFile <- "test.csv"
map_data <- read.csv(csvFile, header=TRUE)

# Specify what are the x, y columns and create co-ordinate system
coordinates( map_data ) <- c("xCord","yCord")
proj4string( map_data ) <- CRS("+init=epsg:27700")

# Convert OS grid to lat/long
map_data_lat_long <- spTransform( map_data, CRS("+proj=longlat +datum=WGS84"))

# Carry out plotting
kml_aes(map_data_lat_long, colour=
col2kml(map_data_lat_long at data$colour)) #unsure about this!
plotKML(map_data_lat_long,
        file.name='test.kml',
        points_names = map_data_lat_long at data$Label
        )


> sessionInfo()
R version 3.0.2 (2013-09-25)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United Kingdom.1252
[2] LC_CTYPE=English_United Kingdom.1252
[3] LC_MONETARY=English_United Kingdom.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United Kingdom.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] plotKML_0.3-8 sp_1.0-12

loaded via a namespace (and not attached):
 [1] aqp_1.5-3          cluster_1.14.4     colorRamps_2.3     colorspace_1.2-4
 [5] dichromat_2.0-0    dismo_0.8-17       grid_3.0.2         gstat_1.0-17
 [9] Hmisc_3.12-2       intervals_0.14.0   labeling_0.2       lattice_0.20-23
[13] munsell_0.4.2      pixmap_0.4-11      plotrix_3.5-2      plyr_1.8
[17] raster_2.1-49      RColorBrewer_1.0-5 reshape_0.8.4      rgdal_0.8-11
[21] rpart_4.1-3        RSAGA_0.93-6       scales_0.2.3       spacetime_1.0-9
[25] stringr_0.6.2      tools_3.0.2        XML_3.98-1.1       xts_0.9-7
[29] zoo_1.7-10


From bgr at bgs.ac.uk  Fri Nov 15 16:34:13 2013
From: bgr at bgs.ac.uk (Rawlins, Barry G.)
Date: Fri, 15 Nov 2013 15:34:13 +0000
Subject: [R-sig-Geo] Problem in RSAGA for computing soil wetness index
Message-ID: <C1D2C279E163C549802E18252065A441053CD02352@nerckwmbc.ad.nerc.ac.uk>

I have been trying to use RSAGA to compute SWI as per various instructions on implementing RSAGA.

I have installed SAGA and I can successfully run the rsaga.env() call and the other R spatial packages.

I imported a SAGA grid of elevations:

summary(sgrd)
     Length Class  Mode
header     8  -none- list
data   98400  -none- numeric

and I can see elevation data if I summarise the data in the grid.

When I try to run the call to the wetness index:

>rsaga.wetness.index(in.dem=sgrd,out.wetness.index="SWI.grd")

I get:

Error in system(command, intern = intern, show.output.on.console = show.output.on.console,  :
  'CreateProcess' failed to run 'C:\Users\bgr\DOCUME~1\R\WIN-LI~1\3.0\RSAGA\SAGA-GIS\saga_cmd.exe ta_hydrology "SAGA Wetness Index" -DEM "list(ncols = 410, nrows = 240, xllcorner = 277000, yllcorner = 322000, cellsize = 200, nodata_value = -9999, xllcenter = 277100, yllcenter = 322100).sgrd" -C "NA" -GN "NA" -CS "NA" -SB "NA" -DEM "NA" -C "NA" -GN "NA" -CS "NA" -SB "NA" -DEM "NA" -C "NA" -GN "NA" -CS "NA" -SB "NA" -DEM "NA" -C "NA" -GN "NA" -CS "NA" -SB "NA" -DEM "NA" -C "NA" -GN "NA" -CS "NA" -S

Does anyone recognise this error and how I might solve it?

My sessionInfo below:

> sessionInfo()
R version 3.0.1 (2013-05-16)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United Kingdom.1252
[2] LC_CTYPE=English_United Kingdom.1252
[3] LC_MONETARY=English_United Kingdom.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United Kingdom.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods
[7] base

other attached packages:
[1] maptools_0.8-27 rgdal_0.8-11    sp_1.0-14       RSAGA_0.93-6
[5] plyr_1.8        shapefiles_0.7  foreign_0.8-55  gstat_1.0-17
[9] ctv_0.7-8

loaded via a namespace (and not attached):
[1] grid_3.0.1       intervals_0.14.0 lattice_0.20-15
[4] MASS_7.3-26      spacetime_1.0-9  tools_3.0.1
[7] xts_0.9-7        zoo_1.7-10

Thanks, Barry

This message (and any attachments) is for the recipient ...{{dropped:6}}


From a.mosnier at gmail.com  Fri Nov 15 17:52:20 2013
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Fri, 15 Nov 2013 11:52:20 -0500
Subject: [R-sig-Geo] Defining CRS when loading a raster doesn't seems to
	work anymore
Message-ID: <CANkFkEcvbM6xF=J-8axLsN+7GKawXaWG86OSxJcu+OJ-HK9nfA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131115/df0aceae/attachment.pl>

From jan.verbesselt at wur.nl  Fri Nov 15 17:59:50 2013
From: jan.verbesselt at wur.nl (Verbesselt, Jan)
Date: Fri, 15 Nov 2013 16:59:50 +0000
Subject: [R-sig-Geo] Defining CRS when loading a raster doesn't seems to
 work anymore
In-Reply-To: <CANkFkEcvbM6xF=J-8axLsN+7GKawXaWG86OSxJcu+OJ-HK9nfA@mail.gmail.com>
Message-ID: <CEAC10FD.C66F%jan.verbesselt@wur.nl>

Hi Arnaud,

Something like:

r <- raster()
projection(r)
projection(r) <- "+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +ellps=WGS84"
projection()


Might help,

Best,
Jan


On 15/11/13 17:52, "Arnaud Mosnier" <a.mosnier at gmail.com> wrote:

>Hi all,
>
>I re-run a script written some times ago containing a line like the
>following
>
>test <- raster("myraster.tif", crs = "+proj=longlat +ellps=WGS84")
>
>The file is loaded correctly, but the crs was not attributed.
>
>>proj4string(test)
>
>gives me
>
>[1] "NA"
>
>
>When looking at the help file, nothing seems to have changed, so what the
>problem ?
>Any suggestion ?
>
>Thanks
>
>Arnaud
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jeandaniel.sylvain at gmail.com  Fri Nov 15 18:05:18 2013
From: jeandaniel.sylvain at gmail.com (Jean-Daniel Sylvain)
Date: Fri, 15 Nov 2013 12:05:18 -0500
Subject: [R-sig-Geo] Problem in RSAGA for computing soil wetness index
In-Reply-To: <C1D2C279E163C549802E18252065A441053CD02352@nerckwmbc.ad.nerc.ac.uk>
References: <C1D2C279E163C549802E18252065A441053CD02352@nerckwmbc.ad.nerc.ac.uk>
Message-ID: <CAEZcs98G09fO4m1=d8bc1=JQf+Jv1L2cnUKOv2gLt8gXK6_XBg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131115/68cbb90f/attachment.pl>

From a.mosnier at gmail.com  Fri Nov 15 19:35:35 2013
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Fri, 15 Nov 2013 13:35:35 -0500
Subject: [R-sig-Geo] Defining CRS when loading a raster doesn't seems to
 work anymore
In-Reply-To: <CEAC10FD.C66F%jan.verbesselt@wur.nl>
References: <CANkFkEcvbM6xF=J-8axLsN+7GKawXaWG86OSxJcu+OJ-HK9nfA@mail.gmail.com>
	<CEAC10FD.C66F%jan.verbesselt@wur.nl>
Message-ID: <CANkFkEeA6x=6Eiw0VXteTWUPcCQObqiFwWiwGjJLFgDJtDHgTA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131115/70a53d06/attachment.pl>

From Scott.Waichler at pnnl.gov  Fri Nov 15 20:13:28 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Fri, 15 Nov 2013 11:13:28 -0800
Subject: [R-sig-Geo] image background for spplot of gridded data
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B2980EA7@EMAIL05.pnl.gov>

Hi,

I have a map tile from RgoogleMaps that I want to use as a background image for an spplot of gridded data, where the data will be plotted with an alpha value < 1.  I am unable to plot them together. 

I was going to set up an example with meuse.grid, but I couldn't get CRS() to work with the meuse spec provided in the rgdal documentation.  So allow me to show as simply as I can with my code:

# background image
backgr <- list('grid.raster', myGoogleMapTile, x=x.ftCenter, y=y.ftCenter,
               width=backgr.width.ft, height=backgr.height.ft, default.units='native')
my.layout <- list(backgr)  

# data frame df has x, y, and z columns
coordinates(df) <- c("x", "y")
spdf <- as(df, "SpatialPixelsDataFrame")

spplot(spdf)  # plots df only, as expected
spplot(spdf, sp.layout=my.layout)  # only the background image and colorkey show

Thinking that the second call of spplot() is plotting the background image over the gridded data, I tried using first=T as shown below, but both ways generated an error message.  

backgr <- list('grid.raster', myGoogleMapTile, x=x.ftCenter, y=y.ftCenter,
               width=backgr.width.ft, height=backgr.height.ft, default.units='native', first=T)
my.layout <- list(backgr, first=T)

What am I missing here?

Thanks,
Scott Waichler
Pacific Northwest National Laboratory
Richland, WA, USA


From chetcuti at hawaii.edu  Fri Nov 15 21:10:30 2013
From: chetcuti at hawaii.edu (Jordan Chetcuti)
Date: Fri, 15 Nov 2013 10:10:30 -1000
Subject: [R-sig-Geo] Regression kriging - error not found when ordinary
	kriging
Message-ID: <CAFKik1dJag_3Mckcd4feVL0S9MSML1VHPdD--Wpr=ZCJ=qw1ZQ@mail.gmail.com>

Hello, I was wondering if anyone has encountered this issue?


This line works:
                      TotalKrige <- krige(Total~1, locations=bd,
newdata=blank, model=fit_Total)

This line does not:
                     TotalRegKrige <-
krige(Total~m5005CVOL+n50010CVOL+n50015CVOL+DTM, locations=bd,
newdata=blank, model=fit_r)

Message:
                     Error in eval(expr, envir, enclos) : object
'm5005CVOL' not found

I have emailed the author of the library "gstat", he very helpfully
offered some advice and that I post here. I have also included my
intial email exchange with Prof. Pebesma.

I have included a description of my two datsets below and the
libraries I have loaded.

data = locations (therefore it isn't necessary to have "data"
specified (in the way it is in a linear model lm() )
newdata = the locations to krige

I have also tried among other things:

TotalRegKrige <-
krige(Total~bd$m5005CVOL+bd$n50010CVOL+bd$n50015CVOL+bd$DTM,
locations=bd, newdata=blank, model=fit_r)

Giveing:

Error in gstat.formula.predict(d$formula, newdata, na.action = na.action,  :
  NROW(locs) != NROW(X): this should not occur
In addition: Warning messages:
1: 'newdata' had 26026 rows but variables found have 83 rows
2: 'newdata' had 26026 rows but variables found have 83 rows

This would lead me to think there is an error in the ascii grid,
except that it worked perfectly in the ordinary kriging example.

Any help anyone can give would be greatly appreciated.

Regards

Jordan Chetcuti

p.s. see descriptions of data and libraries below, and conversation
with Prof. Pebesma.


Dataset "bd"
> summary(bd)
Object of class SpatialPointsDataFrame
Coordinates:
      min     max
X  228112  232468
Y 2190072 2195810
Is projected: NA
proj4string : [NA]
Number of points: 83
Data attributes:
   StationID       m1K10CrnR       m1K10TrHT       m1K10CVOL (only
first few, contains many).

Dataset "blank"
> summary(blank)
Object of class SpatialGridDataFrame
Coordinates:
         min     max
[1,]  226693  233843
[2,] 2187940 2197040
Is projected: NA
proj4string : [NA]
Grid attributes:
  cellcentre.offset cellsize cells.dim
1            226718       50       143
2           2187965       50       182
Data attributes:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
      1       1       1       1       1       1


Libraries
1. geoR
2. gstat
3. sp
4. lattice




>---------- Forwarded message ----------
>From: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
>Date: 14 November 2013 21:15
>Subject: Re: Regression kriging
>To: Jordan Chetcuti <chetcuti at hawaii.edu>


>You omitted the error, which is:

>Error in eval(expr, envir, enclos) : object 'm5005CVOL' not found

>it means that in "blank", the prediction locations, m5005CVOL is not
>found (as is true of all other predictors).

>Please consider posting to r-sig-geo in the future.

>with best regards,

>Edzer Pebesma

>On 11/15/2013 03:30 AM, Jordan Chetcuti wrote:
>> Dear Prof. Pebesma,
>>
>> My name is Jordan Chetcuti and I am a graduate student at the University of
>> Hawaii at Manoa, in the Geography department.
>>
>> I am attempting to do regression kriging on some of my data, but I am alas
>> having a bit of a problem with gstat.
>>
>> within my script this line works:
>>
>> TotalKrige <- krige(Total~1, locations=bd, newdata=blank, model=fit_Total)
>>
>> this does not:
>>
>> TotalRegKrige <- krige(Total~m5005CVOL+n50010CVOL+n50015CVOL+DTM,
>> locations=bd, newdata=blank, model=fit_r)
>>
>> The problem seems to be in the "newdata" when regression kriging (replacing
>> "blank" with "bd" does not cause the error, although it also does not krige
>> between the points)
>>
>> I was wondering if you would mind having a very quick look at this for me?
>> My hope is that it is something I have simply mistyped. I've spent
>> considerable time writing vba, vb.net and python scripts and numerous weeks
>> working in R recently and I am usually pretty good at de-bugging. Alas at
>> the moment I can't seem to find a solution.
>>
>> Any help would be greatly received.
>>
>> Sincerely
>>
>> Jordan Chetcuti


From edzer.pebesma at uni-muenster.de  Fri Nov 15 22:55:19 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 15 Nov 2013 22:55:19 +0100
Subject: [R-sig-Geo] image background for spplot of gridded data
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B2980EA7@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B2980EA7@EMAIL05.pnl.gov>
Message-ID: <52869847.8030109@uni-muenster.de>



On 11/15/2013 08:13 PM, Waichler, Scott R wrote:
> Hi,
> 
> I have a map tile from RgoogleMaps that I want to use as a background image for an spplot of gridded data, where the data will be plotted with an alpha value < 1.  I am unable to plot them together. 
> 
> I was going to set up an example with meuse.grid, but I couldn't get CRS() to work with the meuse spec provided in the rgdal documentation.  So allow me to show as simply as I can with my code:
> 
> # background image
> backgr <- list('grid.raster', myGoogleMapTile, x=x.ftCenter, y=y.ftCenter,
>                width=backgr.width.ft, height=backgr.height.ft, default.units='native')
> my.layout <- list(backgr)  
> 
> # data frame df has x, y, and z columns
> coordinates(df) <- c("x", "y")
> spdf <- as(df, "SpatialPixelsDataFrame")
> 
> spplot(spdf)  # plots df only, as expected
> spplot(spdf, sp.layout=my.layout)  # only the background image and colorkey show
> 
> Thinking that the second call of spplot() is plotting the background image over the gridded data, I tried using first=T as shown below, but both ways generated an error message.  
> 
> backgr <- list('grid.raster', myGoogleMapTile, x=x.ftCenter, y=y.ftCenter,
>                width=backgr.width.ft, height=backgr.height.ft, default.units='native', first=T)
> my.layout <- list(backgr, first=T)
> 
> What am I missing here?

1. an example that we can reproduce
2. after loading sp, demo(meuse, ask=FALSE) sets the CRS for meuse
3. understanding that spplot uses lattice, and hence does not let you
plot incrementally
4. prior emails from Oscar on this list that explain how to do what you want

Having some of these things made easy and documented somewhere, e.g. in
a vignette, is high on my wish list.

> 
> Thanks,
> Scott Waichler
> Pacific Northwest National Laboratory
> Richland, WA, USA
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131115/44f62b72/attachment.bin>

From alexander.brenning at uwaterloo.ca  Sat Nov 16 13:41:15 2013
From: alexander.brenning at uwaterloo.ca (Alexander Brenning)
Date: Sat, 16 Nov 2013 12:41:15 +0000
Subject: [R-sig-Geo] Problem in RSAGA for computing soil wetness index
Message-ID: <7751194102F32C41B664258D78FE5BC571C6D845@connmbx>

Hi Barry,

the in.dem argument to rsaga.wetness.index should a file name (with default file extension .sgrd) in SAGA grid format. I.e. you do not import the raster data into R to perform this task, this operation is entirely file-based. See e.g. example section of the function's help page:

rsaga.wetness.index("dem.sgrd","swi.sgrd")

Cheers
  Alex

--
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
UW: https://uwaterloo.ca/gem/people-profiles/alexander-brenning
Academia.edu: http://uwaterloo.academia.edu/AlexanderBrenning
LinkedIn: http://ca.linkedin.com/pub/alexander-brenning/3/242/440




Date: Fri, 15 Nov 2013 15:34:13 +0000
From: "Rawlins, Barry G." <bgr at bgs.ac.uk>
To: "'r-sig-geo at r-project.org'" <r-sig-geo at r-project.org>
Subject: [R-sig-Geo] Problem in RSAGA for computing soil wetness index
Message-ID:
        <C1D2C279E163C549802E18252065A441053CD02352 at nerckwmbc.ad.nerc.ac.uk>
Content-Type: text/plain; charset="us-ascii"

I have been trying to use RSAGA to compute SWI as per various instructions on implementing RSAGA.

I have installed SAGA and I can successfully run the rsaga.env() call and the other R spatial packages.

I imported a SAGA grid of elevations:

summary(sgrd)
     Length Class  Mode
header     8  -none- list
data   98400  -none- numeric

and I can see elevation data if I summarise the data in the grid.

When I try to run the call to the wetness index:

>rsaga.wetness.index(in.dem=sgrd,out.wetness.index="SWI.grd")

I get:

Error in system(command, intern = intern, show.output.on.console = show.output.on.console,  :
  'CreateProcess' failed to run 'C:\Users\bgr\DOCUME~1\R\WIN-LI~1\3.0\RSAGA\SAGA-GIS\saga_cmd.exe ta_hydrology "SAGA Wetness Index" -DEM "list(ncols = 410, nrows = 240, xllcorner = 277000, yllcorner = 322000, cellsize = 200, nodata_value = -9999, xllcenter = 277100, yllcenter = 322100).sgrd" -C "NA" -GN "NA" -CS "NA" -SB "NA" -DEM "NA" -C "NA" -GN "NA" -CS "NA" -SB "NA" -DEM "NA" -C "NA" -GN "NA" -CS "NA" -SB "NA" -DEM "NA" -C "NA" -GN "NA" -CS "NA" -SB "NA" -DEM "NA" -C "NA" -GN "NA" -CS "NA" -S

Does anyone recognise this error and how I might solve it?

My sessionInfo below:

> sessionInfo()
R version 3.0.1 (2013-05-16)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United Kingdom.1252
[2] LC_CTYPE=English_United Kingdom.1252
[3] LC_MONETARY=English_United Kingdom.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United Kingdom.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods
[7] base

other attached packages:
[1] maptools_0.8-27 rgdal_0.8-11    sp_1.0-14       RSAGA_0.93-6
[5] plyr_1.8        shapefiles_0.7  foreign_0.8-55  gstat_1.0-17
[9] ctv_0.7-8

loaded via a namespace (and not attached):
[1] grid_3.0.1       intervals_0.14.0 lattice_0.20-15
[4] MASS_7.3-26      spacetime_1.0-9  tools_3.0.1
[7] xts_0.9-7        zoo_1.7-10

Thanks, Barry

This message (and any attachments) is for the recipient ...{{dropped:2}}


From mdsumner at gmail.com  Sun Nov 17 17:27:59 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 17 Nov 2013 16:27:59 +0000
Subject: [R-sig-Geo] Defining CRS when loading a raster doesn't seems to
 work anymore
In-Reply-To: <CANkFkEeA6x=6Eiw0VXteTWUPcCQObqiFwWiwGjJLFgDJtDHgTA@mail.gmail.com>
References: <CANkFkEcvbM6xF=J-8axLsN+7GKawXaWG86OSxJcu+OJ-HK9nfA@mail.gmail.com>
	<CEAC10FD.C66F%jan.verbesselt@wur.nl>
	<CANkFkEeA6x=6Eiw0VXteTWUPcCQObqiFwWiwGjJLFgDJtDHgTA@mail.gmail.com>
Message-ID: <CAAcGz9965c9KthfaDwGCbLGU_8yoWX6uPcwuG-uX6HjpXaLJNQ@mail.gmail.com>

I don't think it ever was possible to do this. If you look carefully
at the Details for ?raster, it mentions extra arguments passed via ...
and none of these is "crs" for the "character" method. That can be a
bit obscure until you understand that the character method (for a
file) does not allow you to pass in crs at that point, it's only
defined for the signatures  "missing", "Extent", "matrix" and
"big.matrix".

Does that make sense?

On Fri, Nov 15, 2013 at 6:35 PM, Arnaud Mosnier <a.mosnier at gmail.com> wrote:
> Hi Jan,
>
> Thanks.
> You can also use
> proj4string(r) <- "+proj=longlat +ellps=WGS84"
>
> but the problem (the bug ?) is that it does not work anymore defining
> directly the crs into the raster function.
>
> Arnaud
>
>
> 2013/11/15 Verbesselt, Jan <jan.verbesselt at wur.nl>
>
>> Hi Arnaud,
>>
>> Something like:
>>
>> r <- raster()
>> projection(r)
>> projection(r) <- "+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +ellps=WGS84"
>> projection()
>>
>>
>> Might help,
>>
>> Best,
>> Jan
>>
>>
>> On 15/11/13 17:52, "Arnaud Mosnier" <a.mosnier at gmail.com> wrote:
>>
>> >Hi all,
>> >
>> >I re-run a script written some times ago containing a line like the
>> >following
>> >
>> >test <- raster("myraster.tif", crs = "+proj=longlat +ellps=WGS84")
>> >
>> >The file is loaded correctly, but the crs was not attributed.
>> >
>> >>proj4string(test)
>> >
>> >gives me
>> >
>> >[1] "NA"
>> >
>> >
>> >When looking at the help file, nothing seems to have changed, so what the
>> >problem ?
>> >Any suggestion ?
>> >
>> >Thanks
>> >
>> >Arnaud
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> >_______________________________________________
>> >R-sig-Geo mailing list
>> >R-sig-Geo at r-project.org
>> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>>
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.hijmans at gmail.com  Sun Nov 17 20:51:46 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 17 Nov 2013 11:51:46 -0800
Subject: [R-sig-Geo] Defining CRS when loading a raster doesn't seems to
 work anymore
In-Reply-To: <CAAcGz9965c9KthfaDwGCbLGU_8yoWX6uPcwuG-uX6HjpXaLJNQ@mail.gmail.com>
References: <CANkFkEcvbM6xF=J-8axLsN+7GKawXaWG86OSxJcu+OJ-HK9nfA@mail.gmail.com>
	<CEAC10FD.C66F%jan.verbesselt@wur.nl>
	<CANkFkEeA6x=6Eiw0VXteTWUPcCQObqiFwWiwGjJLFgDJtDHgTA@mail.gmail.com>
	<CAAcGz9965c9KthfaDwGCbLGU_8yoWX6uPcwuG-uX6HjpXaLJNQ@mail.gmail.com>
Message-ID: <CANtt_hyL4M19yHykY2qGy_eoj9n=NQzUvnwC2Em8_EyWi1PqDA@mail.gmail.com>

I think it was possible; the 'crs' argument is passed on by the
ellipsis; but only if the file had an unknown crs (it is in the help
file under Details).

I think it broke because of a change in sp (or rgdal). Previously, if
the crs was unknown, the CRS object would store "NA" (with quotes),
now it has NA (no quotes). That seems to be an improvement but broke
the raster code. This has been fixed for the next version of raster.

Robert

On Sun, Nov 17, 2013 at 8:27 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> I don't think it ever was possible to do this. If you look carefully
> at the Details for ?raster, it mentions extra arguments passed via ...
> and none of these is "crs" for the "character" method. That can be a
> bit obscure until you understand that the character method (for a
> file) does not allow you to pass in crs at that point, it's only
> defined for the signatures  "missing", "Extent", "matrix" and
> "big.matrix".
>
> Does that make sense?
>
> On Fri, Nov 15, 2013 at 6:35 PM, Arnaud Mosnier <a.mosnier at gmail.com> wrote:
>> Hi Jan,
>>
>> Thanks.
>> You can also use
>> proj4string(r) <- "+proj=longlat +ellps=WGS84"
>>
>> but the problem (the bug ?) is that it does not work anymore defining
>> directly the crs into the raster function.
>>
>> Arnaud
>>
>>
>> 2013/11/15 Verbesselt, Jan <jan.verbesselt at wur.nl>
>>
>>> Hi Arnaud,
>>>
>>> Something like:
>>>
>>> r <- raster()
>>> projection(r)
>>> projection(r) <- "+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +ellps=WGS84"
>>> projection()
>>>
>>>
>>> Might help,
>>>
>>> Best,
>>> Jan
>>>
>>>
>>> On 15/11/13 17:52, "Arnaud Mosnier" <a.mosnier at gmail.com> wrote:
>>>
>>> >Hi all,
>>> >
>>> >I re-run a script written some times ago containing a line like the
>>> >following
>>> >
>>> >test <- raster("myraster.tif", crs = "+proj=longlat +ellps=WGS84")
>>> >
>>> >The file is loaded correctly, but the crs was not attributed.
>>> >
>>> >>proj4string(test)
>>> >
>>> >gives me
>>> >
>>> >[1] "NA"
>>> >
>>> >
>>> >When looking at the help file, nothing seems to have changed, so what the
>>> >problem ?
>>> >Any suggestion ?
>>> >
>>> >Thanks
>>> >
>>> >Arnaud
>>> >
>>> >       [[alternative HTML version deleted]]
>>> >
>>> >_______________________________________________
>>> >R-sig-Geo mailing list
>>> >R-sig-Geo at r-project.org
>>> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>>
>>>
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Michael Sumner
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Sun Nov 17 20:58:44 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 17 Nov 2013 11:58:44 -0800
Subject: [R-sig-Geo] How to extract the first 10 rows in a rasterstack?
In-Reply-To: <CABaJH799=EmUUa-o2FcyeLX=vpN5p8AffkODKNs736HUe5RXOg@mail.gmail.com>
References: <CABaJH799=EmUUa-o2FcyeLX=vpN5p8AffkODKNs736HUe5RXOg@mail.gmail.com>
Message-ID: <CANtt_hy4=iWV2LcZwKAzCk9hN2VdxpE8iPidn2YGTn=n6aYhgA@mail.gmail.com>

Eddie,

You can have a look at this
http://cran.r-project.org/web/packages/raster/vignettes/Raster.pdf

and this:
?getValues

Robert

On Mon, Nov 11, 2013 at 11:53 AM, Eddie Smith <eddieatr at gmail.com> wrote:
> Dear list,
>
> I am working with such a huge rasterstack. Is there any possibilities that
> we could extract the pixel values chunk by chunk?
>
> The extract command below took nearly 7 hours.
>
> library(raster)
> r <- raster(nrow=1000, ncol=1000)
> s <- stack( sapply(1:366, function(i) setValues(r, rnorm(ncell(r), i, 3) ))
> )
> Pixels<-extract(s,1:ncell(s))
>
> Thanks in advance.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Sun Nov 17 21:03:18 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 17 Nov 2013 12:03:18 -0800
Subject: [R-sig-Geo] Collinearity test
In-Reply-To: <84D737939C16114590DCDD4F003E013B1FEC85AC@SCOMP0936.wurnet.nl>
References: <CANJhsN1XciOa4z-1L4a9fchDZ1qyVCe9LGFK2S6LFZp20WXo6w@mail.gmail.com>
	<84D737939C16114590DCDD4F003E013B1FEC85AC@SCOMP0936.wurnet.nl>
Message-ID: <CANtt_hw=3-EtHj+B3AjowNTX3_7ZDhGUWexDa3OzVWFRjCEOeA@mail.gmail.com>

Also see:

library(dismo)
s <- stack(system.file("external/rlogo.grd", package="raster"))
pairs(s)

Robert

On Wed, Nov 13, 2013 at 3:06 AM, Proosdij, Andre van
<andre.vanproosdij at wur.nl> wrote:
> Hi Maurizio,
>
> I used the rcorr function from the Hmisc package to calculate the Pearson correlation.
>
> Best,
>
>
> Andr?
>
>
> Ir. A.S.J. van Proosdij
> PhD Student
> e  andre.vanproosdij at wur.nl
> Naturalis Biodiversity Center, section NHN
> Biosystematics Group, Wageningen University
> Gen. Foulkesweg 37, 6703 BL Wageningen, the Netherlands
> www.bis.wur.nl
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Maurizio Marchi
> Sent: woensdag 13 november 2013 11:00
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Collinearity test
>
> Hallo everybody,
> I'm working with Species Distibution Models to predict the potential distribution of a forest specie.
> I use WorldClim raster data for Italy and before running SDMs algorithm I would like to test the collineariy between factors to eliminate redundancy of data.
> My question in: is there a package that can be used to Test collinearity between factors of a raster stack (worldclim biovariables)?
>
> Thanks,
>
> --
> Maurizio Marchi, Ph.D student
> Forestry Research Centre (Arezzo, IT)
> ID skype: maurizioxyz
> *Ubuntu 12.04 (Precise Pangolin)*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ndcNS at hampshire.edu  Mon Nov 18 06:40:15 2013
From: ndcNS at hampshire.edu (ndcNS at hampshire.edu)
Date: Mon, 18 Nov 2013 00:40:15 -0500
Subject: [R-sig-Geo] get ncdf values at point locations - efficient method?
Message-ID: <20131118004015.Horde.K5ZXePrBk2lSiag-u7JWy_A@webmail.hampshire.edu>

Hi,

I'm trying to extract data from point locations in NetCDF files  
efficiently.  I can do it for small data, but I am moving to scenarios  
with huge grids and 500,000 points.  For small data, I do one of two  
things:

1) Read the entire grid into memory and convert it to a raster stack,  
then extract cell values at my coordinates.
2) Loop through each point, reading in just the single value from the ncdf.

The problem with #1 is that it is too slow and large to fit all those  
extraneous grid cells into memory.  The problem with #2 is that  
looping through 500,000 points is too slow.  What I want to do is  
something like #2, but without a loop - a single vectorizable call.   
Any suggestions?

Here's a simplified version of what my #2 code looks like now:

opened.ncdf <- open.ncdf(test.nc)
lons <- get.var.ncdf(opened.ncdf, 'longitude')
lats <- get.var.ncdf(opened.ncdf, 'latitude')
point.coords <- read.csv('lonlat.csv')
point.coords[,1] <- sapply(point.coords[,1],function(x)which.min(abs(x  
- lons)))
point.coords[,2] <- sapply(point.coords[,2],function(x)which.min(abs(x  
- lats)))
layer.num <- 3 # this is time, I have seperate ways for handling this,  
let's just call it timestep 3 for now
output <- vector('numeric',length(dim(point.coords)[1]))

for(i in 1:(dim(point.coords)[1])){
	output[i] <- get.var.ncdf(opened.ncdf,  
start=c(point.coords[i,],layer.num), count=c(1,1,1))
}

Is there a way to vectorize that slow loop???

Thanks!!!
-Noah

---
Noah Charney, PhD
Visiting Assistant Professor of Ecology
School of Natural Science
Hampshire College
304 Cole Science Center
Amherst, MA 01002
413-559-5775


From r.hijmans at gmail.com  Mon Nov 18 07:28:04 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sun, 17 Nov 2013 22:28:04 -0800
Subject: [R-sig-Geo] get ncdf values at point locations - efficient
	method?
In-Reply-To: <20131118004015.Horde.K5ZXePrBk2lSiag-u7JWy_A@webmail.hampshire.edu>
References: <20131118004015.Horde.K5ZXePrBk2lSiag-u7JWy_A@webmail.hampshire.edu>
Message-ID: <CANtt_hxBkjDgpyReSRDDg6DbsPO7TsZ5DVD5SQTZYdTqSEAnUg@mail.gmail.com>

Noah,
There is a third way:

library(raster)
b <- brick("test.nc")

(this does not load the cell values into memory). Now there are
several ways to extract subsets. See ?getValues, ?crop, ....
Robert



On Sun, Nov 17, 2013 at 9:40 PM,  <ndcNS at hampshire.edu> wrote:
> Hi,
>
> I'm trying to extract data from point locations in NetCDF files efficiently.
> I can do it for small data, but I am moving to scenarios with huge grids and
> 500,000 points.  For small data, I do one of two things:
>
> 1) Read the entire grid into memory and convert it to a raster stack, then
> extract cell values at my coordinates.
> 2) Loop through each point, reading in just the single value from the ncdf.
>
> The problem with #1 is that it is too slow and large to fit all those
> extraneous grid cells into memory.  The problem with #2 is that looping
> through 500,000 points is too slow.  What I want to do is something like #2,
> but without a loop - a single vectorizable call.  Any suggestions?
>
> Here's a simplified version of what my #2 code looks like now:
>
> opened.ncdf <- open.ncdf(test.nc)
> lons <- get.var.ncdf(opened.ncdf, 'longitude')
> lats <- get.var.ncdf(opened.ncdf, 'latitude')
> point.coords <- read.csv('lonlat.csv')
> point.coords[,1] <- sapply(point.coords[,1],function(x)which.min(abs(x -
> lons)))
> point.coords[,2] <- sapply(point.coords[,2],function(x)which.min(abs(x -
> lats)))
> layer.num <- 3 # this is time, I have seperate ways for handling this, let's
> just call it timestep 3 for now
> output <- vector('numeric',length(dim(point.coords)[1]))
>
> for(i in 1:(dim(point.coords)[1])){
>         output[i] <- get.var.ncdf(opened.ncdf,
> start=c(point.coords[i,],layer.num), count=c(1,1,1))
> }
>
> Is there a way to vectorize that slow loop???
>
> Thanks!!!
> -Noah
>
> ---
> Noah Charney, PhD
> Visiting Assistant Professor of Ecology
> School of Natural Science
> Hampshire College
> 304 Cole Science Center
> Amherst, MA 01002
> 413-559-5775
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ashton at msu.edu  Mon Nov 18 14:40:06 2013
From: ashton at msu.edu (Ashton Shortridge)
Date: Mon, 18 Nov 2013 08:40:06 -0500
Subject: [R-sig-Geo] Regression kriging - error not found when ordinary
	kriging
In-Reply-To: <CAFKik1dJag_3Mckcd4feVL0S9MSML1VHPdD--Wpr=ZCJ=qw1ZQ@mail.gmail.com>
References: <CAFKik1dJag_3Mckcd4feVL0S9MSML1VHPdD--Wpr=ZCJ=qw1ZQ@mail.gmail.com>
Message-ID: <1549776.gbLsn439Pv@erebus>

Hi Jordan,

I always use the 'data' parameter when kriging. Here's how I'd do it:

class(bd)   # This should be a SpatialPointsDataFrame
names(bd) #  all the variables in the model (Total, m5005CVOL, etc)

class(blank) # This should be a SpatialPointsDataFrame
names(blank) # all the variables in the model except for Total

TotalRegKrige <- krige(Total~m5005CVOL+n50010CVOL+n50015CVOL+DTM, bd, blank, 
model=fit_r)


Hope this helps.

Ashton



On Friday, November 15, 2013 10:10:30 AM Jordan Chetcuti wrote:
> Hello, I was wondering if anyone has encountered this issue?
> 
> 
> This line works:
>                       TotalKrige <- krige(Total~1, locations=bd,
> newdata=blank, model=fit_Total)
> 
> This line does not:
>                      TotalRegKrige <-
> krige(Total~m5005CVOL+n50010CVOL+n50015CVOL+DTM, locations=bd,
> newdata=blank, model=fit_r)
> 
> Message:
>                      Error in eval(expr, envir, enclos) : object
> 'm5005CVOL' not found
> 
> I have emailed the author of the library "gstat", he very helpfully
> offered some advice and that I post here. I have also included my
> intial email exchange with Prof. Pebesma.
> 
> I have included a description of my two datsets below and the
> libraries I have loaded.
> 
> data = locations (therefore it isn't necessary to have "data"
> specified (in the way it is in a linear model lm() )
> newdata = the locations to krige
> 
> I have also tried among other things:
> 
> TotalRegKrige <-
> krige(Total~bd$m5005CVOL+bd$n50010CVOL+bd$n50015CVOL+bd$DTM,
> locations=bd, newdata=blank, model=fit_r)
> 
> Giveing:
> 
> Error in gstat.formula.predict(d$formula, newdata, na.action = na.action,  :
> NROW(locs) != NROW(X): this should not occur
> In addition: Warning messages:
> 1: 'newdata' had 26026 rows but variables found have 83 rows
> 2: 'newdata' had 26026 rows but variables found have 83 rows
> 
> This would lead me to think there is an error in the ascii grid,
> except that it worked perfectly in the ordinary kriging example.
> 
> Any help anyone can give would be greatly appreciated.
> 
> Regards
> 
> Jordan Chetcuti
> 
> p.s. see descriptions of data and libraries below, and conversation
> with Prof. Pebesma.
> 
> 
> Dataset "bd"
> 
> > summary(bd)
> 
> Object of class SpatialPointsDataFrame
> Coordinates:
>       min     max
> X  228112  232468
> Y 2190072 2195810
> Is projected: NA
> proj4string : [NA]
> Number of points: 83
> Data attributes:
>    StationID       m1K10CrnR       m1K10TrHT       m1K10CVOL (only
> first few, contains many).
> 
> Dataset "blank"
> 
> > summary(blank)
> 
> Object of class SpatialGridDataFrame
> Coordinates:
>          min     max
> [1,]  226693  233843
> [2,] 2187940 2197040
> Is projected: NA
> proj4string : [NA]
> Grid attributes:
>   cellcentre.offset cellsize cells.dim
> 1            226718       50       143
> 2           2187965       50       182
> Data attributes:
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>       1       1       1       1       1       1
> 
> 
> Libraries
> 1. geoR
> 2. gstat
> 3. sp
> 4. lattice
> 
> >---------- Forwarded message ----------
> >From: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> >Date: 14 November 2013 21:15
> >Subject: Re: Regression kriging
> >To: Jordan Chetcuti <chetcuti at hawaii.edu>
> >
> >
> >You omitted the error, which is:
> >
> >Error in eval(expr, envir, enclos) : object 'm5005CVOL' not found
> >
> >it means that in "blank", the prediction locations, m5005CVOL is not
> >found (as is true of all other predictors).
> >
> >Please consider posting to r-sig-geo in the future.
> >
> >with best regards,
> >
> >Edzer Pebesma
> >
> >On 11/15/2013 03:30 AM, Jordan Chetcuti wrote:
> >> Dear Prof. Pebesma,
> >> 
> >> My name is Jordan Chetcuti and I am a graduate student at the University
> >> of
> >> Hawaii at Manoa, in the Geography department.
> >> 
> >> I am attempting to do regression kriging on some of my data, but I am
> >> alas
> >> having a bit of a problem with gstat.
> >> 
> >> within my script this line works:
> >> 
> >> TotalKrige <- krige(Total~1, locations=bd, newdata=blank,
> >> model=fit_Total)
> >> 
> >> this does not:
> >> 
> >> TotalRegKrige <- krige(Total~m5005CVOL+n50010CVOL+n50015CVOL+DTM,
> >> locations=bd, newdata=blank, model=fit_r)
> >> 
> >> The problem seems to be in the "newdata" when regression kriging
> >> (replacing
> >> "blank" with "bd" does not cause the error, although it also does not
> >> krige
> >> between the points)
> >> 
> >> I was wondering if you would mind having a very quick look at this for
> >> me?
> >> My hope is that it is something I have simply mistyped. I've spent
> >> considerable time writing vba, vb.net and python scripts and numerous
> >> weeks
> >> working in R recently and I am usually pretty good at de-bugging. Alas at
> >> the moment I can't seem to find a solution.
> >> 
> >> Any help would be greatly received.
> >> 
> >> Sincerely
> >> 
> >> Jordan Chetcuti
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-----
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From jgrn at illinois.edu  Tue Nov 19 01:20:35 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Mon, 18 Nov 2013 18:20:35 -0600
Subject: [R-sig-Geo] Landsat soil moisture index
In-Reply-To: <000a01cedd06$4c698890$e53c99b0$@westnet.com.au>
References: <003501cedc89$cd7c9fd0$6875df70$@westnet.com.au>
	<CAM_vjumc6e61C_hWq=ppiDzXuzuKJ_2ike9VhJwo22MnWW7TGQ@mail.gmail.com>
	<000a01cedd06$4c698890$e53c99b0$@westnet.com.au>
Message-ID: <CABG0rfvkd_oG23uzmgHceJ1VxgHChqLSv6vnbFtPNvyf1kroQQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131118/b474d492/attachment.pl>

From alaios at yahoo.com  Tue Nov 19 12:40:40 2013
From: alaios at yahoo.com (Alaios)
Date: Tue, 19 Nov 2013 03:40:40 -0800 (PST)
Subject: [R-sig-Geo] GPS Localization systems statistics
Message-ID: <1384861240.59336.YahooMailNeo@web125301.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131119/c1d1f243/attachment.pl>

From markpayneatwork at gmail.com  Tue Nov 19 14:58:10 2013
From: markpayneatwork at gmail.com (Mark Payne)
Date: Tue, 19 Nov 2013 14:58:10 +0100
Subject: [R-sig-Geo] Combining spatial pixels objects
Message-ID: <CAGBzUO8Sk46W-KLz1y9yh8Q9xDDe05-DVkLyUEiMaX=OFizKsg@mail.gmail.com>

Hi,

Consider a situation where I have a spatialpixelsdataframe, m.subset,
that is a subset of a larger dataframe, m. Due to the large size of my
dataset, its more efficient for me to work on just this subset, than
it is to work with the entire data set. Now, the question is, once
I've finished processing the subset, I want to add it back into the
original object. But the question is... how?

In terms of a code example, it might look like:

library(sp)
data(meuse.grid)
coordinates(meuse.grid) <- ~ x + y
m <- SpatialPixelsDataFrame(meuse.grid,meuse.grid at data)
m <- m[,"dist"]

#Split into a subset
m.subset <- subset(m,m$y > 333000)

#Do som fancy processing on m.subset e.g.
m.subset$dist <- m.subset$dist * 10

Now I want to combine the modified pixels in m.subset back into the
main object, m. Does anyone have any ideas how this might be done?

Best wishes,

Mark


From edzer.pebesma at uni-muenster.de  Tue Nov 19 15:27:11 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 19 Nov 2013 15:27:11 +0100
Subject: [R-sig-Geo] Combining spatial pixels objects
In-Reply-To: <CAGBzUO8Sk46W-KLz1y9yh8Q9xDDe05-DVkLyUEiMaX=OFizKsg@mail.gmail.com>
References: <CAGBzUO8Sk46W-KLz1y9yh8Q9xDDe05-DVkLyUEiMaX=OFizKsg@mail.gmail.com>
Message-ID: <528B753F.9050708@uni-muenster.de>



On 11/19/2013 02:58 PM, Mark Payne wrote:
> Hi,
> 
> Consider a situation where I have a spatialpixelsdataframe, m.subset,
> that is a subset of a larger dataframe, m. Due to the large size of my
> dataset, its more efficient for me to work on just this subset, than
> it is to work with the entire data set. Now, the question is, once
> I've finished processing the subset, I want to add it back into the
> original object. But the question is... how?
> 
> In terms of a code example, it might look like:
> 
> library(sp)
> data(meuse.grid)
> coordinates(meuse.grid) <- ~ x + y
> m <- SpatialPixelsDataFrame(meuse.grid,meuse.grid at data)
> m <- m[,"dist"]
> 
> #Split into a subset
> m.subset <- subset(m,m$y > 333000)
> 
> #Do som fancy processing on m.subset e.g.
> m.subset$dist <- m.subset$dist * 10
> 
> Now I want to combine the modified pixels in m.subset back into the
> main object, m. Does anyone have any ideas how this might be done?

yes, by

total = rbind(m, m.subset)

but note that in this case total will have some pixels appear twice,
which you will not see in

image(total)

but for instance,

image(rbind(m.subset, m))

will mask the larger values. Then,

as(total, "SpatialGridDataFrame")

will remove the duplicates. Use carefully,

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131119/2482af9e/attachment.bin>

From a.mosnier at gmail.com  Tue Nov 19 15:58:28 2013
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Tue, 19 Nov 2013 09:58:28 -0500
Subject: [R-sig-Geo] Defining CRS when loading a raster doesn't seems to
 work anymore
In-Reply-To: <CANtt_hyL4M19yHykY2qGy_eoj9n=NQzUvnwC2Em8_EyWi1PqDA@mail.gmail.com>
References: <CANkFkEcvbM6xF=J-8axLsN+7GKawXaWG86OSxJcu+OJ-HK9nfA@mail.gmail.com>
	<CEAC10FD.C66F%jan.verbesselt@wur.nl>
	<CANkFkEeA6x=6Eiw0VXteTWUPcCQObqiFwWiwGjJLFgDJtDHgTA@mail.gmail.com>
	<CAAcGz9965c9KthfaDwGCbLGU_8yoWX6uPcwuG-uX6HjpXaLJNQ@mail.gmail.com>
	<CANtt_hyL4M19yHykY2qGy_eoj9n=NQzUvnwC2Em8_EyWi1PqDA@mail.gmail.com>
Message-ID: <CANkFkEe6j1im=nk6GTnTgrBpEwxBbepscip=_iSrok8frCHomA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131119/0b1a180e/attachment.pl>

From mdsumner at gmail.com  Tue Nov 19 16:36:57 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 19 Nov 2013 15:36:57 +0000
Subject: [R-sig-Geo] Defining CRS when loading a raster doesn't seems to
 work anymore
In-Reply-To: <CANtt_hyL4M19yHykY2qGy_eoj9n=NQzUvnwC2Em8_EyWi1PqDA@mail.gmail.com>
References: <CANkFkEcvbM6xF=J-8axLsN+7GKawXaWG86OSxJcu+OJ-HK9nfA@mail.gmail.com>
	<CEAC10FD.C66F%jan.verbesselt@wur.nl>
	<CANkFkEeA6x=6Eiw0VXteTWUPcCQObqiFwWiwGjJLFgDJtDHgTA@mail.gmail.com>
	<CAAcGz9965c9KthfaDwGCbLGU_8yoWX6uPcwuG-uX6HjpXaLJNQ@mail.gmail.com>
	<CANtt_hyL4M19yHykY2qGy_eoj9n=NQzUvnwC2Em8_EyWi1PqDA@mail.gmail.com>
Message-ID: <CAAcGz9_VLRo+nR47WGcDjkyuxQROtyK1K1WOTWvq+parJc8Gkg@mail.gmail.com>

Whoops, sorry for my off-track mis-advice.

On Sun, Nov 17, 2013 at 7:51 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> I think it was possible; the 'crs' argument is passed on by the
> ellipsis; but only if the file had an unknown crs (it is in the help
> file under Details).
>
> I think it broke because of a change in sp (or rgdal). Previously, if
> the crs was unknown, the CRS object would store "NA" (with quotes),
> now it has NA (no quotes). That seems to be an improvement but broke
> the raster code. This has been fixed for the next version of raster.
>
> Robert
>
> On Sun, Nov 17, 2013 at 8:27 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> I don't think it ever was possible to do this. If you look carefully
>> at the Details for ?raster, it mentions extra arguments passed via ...
>> and none of these is "crs" for the "character" method. That can be a
>> bit obscure until you understand that the character method (for a
>> file) does not allow you to pass in crs at that point, it's only
>> defined for the signatures  "missing", "Extent", "matrix" and
>> "big.matrix".
>>
>> Does that make sense?
>>
>> On Fri, Nov 15, 2013 at 6:35 PM, Arnaud Mosnier <a.mosnier at gmail.com> wrote:
>>> Hi Jan,
>>>
>>> Thanks.
>>> You can also use
>>> proj4string(r) <- "+proj=longlat +ellps=WGS84"
>>>
>>> but the problem (the bug ?) is that it does not work anymore defining
>>> directly the crs into the raster function.
>>>
>>> Arnaud
>>>
>>>
>>> 2013/11/15 Verbesselt, Jan <jan.verbesselt at wur.nl>
>>>
>>>> Hi Arnaud,
>>>>
>>>> Something like:
>>>>
>>>> r <- raster()
>>>> projection(r)
>>>> projection(r) <- "+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +ellps=WGS84"
>>>> projection()
>>>>
>>>>
>>>> Might help,
>>>>
>>>> Best,
>>>> Jan
>>>>
>>>>
>>>> On 15/11/13 17:52, "Arnaud Mosnier" <a.mosnier at gmail.com> wrote:
>>>>
>>>> >Hi all,
>>>> >
>>>> >I re-run a script written some times ago containing a line like the
>>>> >following
>>>> >
>>>> >test <- raster("myraster.tif", crs = "+proj=longlat +ellps=WGS84")
>>>> >
>>>> >The file is loaded correctly, but the crs was not attributed.
>>>> >
>>>> >>proj4string(test)
>>>> >
>>>> >gives me
>>>> >
>>>> >[1] "NA"
>>>> >
>>>> >
>>>> >When looking at the help file, nothing seems to have changed, so what the
>>>> >problem ?
>>>> >Any suggestion ?
>>>> >
>>>> >Thanks
>>>> >
>>>> >Arnaud
>>>> >
>>>> >       [[alternative HTML version deleted]]
>>>> >
>>>> >_______________________________________________
>>>> >R-sig-Geo mailing list
>>>> >R-sig-Geo at r-project.org
>>>> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >
>>>>
>>>>
>>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Michael Sumner
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From droletguillaume at gmail.com  Tue Nov 19 21:35:30 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Tue, 19 Nov 2013 15:35:30 -0500
Subject: [R-sig-Geo] writeRaster and raster give same error after package
	update
Message-ID: <CAOkiyv5tS8GvcFbuPdmw6DGEBVxhQhfDabWaOU3N40fz6QdKiQ@mail.gmail.com>

Hi,

I've been working on a set of functions for a bit more than a month.
This morning I updated all my packages (but not R) and now, when I
call:

outfile <- "b4.sinks.sgrd"
writeRaster(myraster, outfile, overwrite = TRUE, datatype = "FLT4S",
    NAflag = -9999)

or

infile <- "b4.sinks.sdat"
r <- raster(infile)

from within one of my functions, I get this error:

Error in if (is.null(projs) | is.na(projs) | nchar(projs) < 3) { :
  argument is of length zero
In addition: Warning message:
In is.na(projs) : is.na() applied to non-(list or vector) of type 'NULL'

My function that calls writeRaster() and raster() hasn't changed in a
while. It was working fine just yesterday! From the error message, it
looks like .makeProj (in makeProjString.R) calls .newCRS with an
unknown projection, although I never changed my raster's projections
since I started working on this project. Here's the output of
proj4string(myraster):

 "+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"

Here's the output of sessionInfo():

R version 3.0.2 (2013-09-25)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=French_Canada.1252  LC_CTYPE=French_Canada.1252
LC_MONETARY=French_Canada.1252
[4] LC_NUMERIC=C                   LC_TIME=French_Canada.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
 [1] snow_0.3-13       raster_2.1-66     devtools_1.3
stringr_0.6.2     RSAGA_0.93-6      plyr_1.8
 [7] shapefiles_0.7    foreign_0.8-55    gstat_1.0-17
rgdal_0.8-11      data.table_1.8.10 sp_1.0-14

loaded via a namespace (and not attached):
 [1] digest_0.6.3     evaluate_0.5.1   grid_3.0.2       httr_0.2
  intervals_0.14.0 lattice_0.20-23
 [7] memoise_0.1      parallel_3.0.2   RCurl_1.95-4.1
spacetime_1.0-9  tools_3.0.2      whisker_0.3-2
[13] xts_0.9-7        zoo_1.7-10

I'm getting frustrated as I'm about to finish this program I've been
working on for a while and now I'm stuck!!

Thanks for your help,

Guillaume


From droletguillaume at gmail.com  Tue Nov 19 23:52:40 2013
From: droletguillaume at gmail.com (droletg)
Date: Tue, 19 Nov 2013 14:52:40 -0800 (PST)
Subject: [R-sig-Geo] writeRaster and raster give same error after
	package update
In-Reply-To: <CAOkiyv5tS8GvcFbuPdmw6DGEBVxhQhfDabWaOU3N40fz6QdKiQ@mail.gmail.com>
References: <CAOkiyv5tS8GvcFbuPdmw6DGEBVxhQhfDabWaOU3N40fz6QdKiQ@mail.gmail.com>
Message-ID: <1384901560539-7585139.post@n2.nabble.com>

Hi Again:

Following on to my previous post, I discovered that I can successfully
writeRaster() if the output file has extension ".tif". The problems I
experience seems to come from trying to write to a SAGA grid (.sgrd),
although it used to work until today...

If you have any piece of information that could help me fix this problem, I
will appreciate it a lot!

Cheers,

Guillaume



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeRaster-and-raster-give-same-error-after-package-update-tp7585138p7585139.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Tue Nov 19 23:59:18 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 19 Nov 2013 14:59:18 -0800
Subject: [R-sig-Geo] writeRaster and raster give same error after
	package update
In-Reply-To: <1384901560539-7585139.post@n2.nabble.com>
References: <CAOkiyv5tS8GvcFbuPdmw6DGEBVxhQhfDabWaOU3N40fz6QdKiQ@mail.gmail.com>
	<1384901560539-7585139.post@n2.nabble.com>
Message-ID: <CANtt_hzgbvFZQZjBNw6fPL0GxJ6fEONuc5tq5VBn9azD51gVNg@mail.gmail.com>

Guillaume, It is a bug in the latest version of raster. IYou should be
able to install a corrected version 2.1-68 from R-Forge in a couple of
hours:

install.packages("raster", repos="http://R-Forge.R-project.org")

I will also send this to CRAN soon.

Thanks for reporting this. Robert


On Tue, Nov 19, 2013 at 2:52 PM, droletg <droletguillaume at gmail.com> wrote:
> Hi Again:
>
> Following on to my previous post, I discovered that I can successfully
> writeRaster() if the output file has extension ".tif". The problems I
> experience seems to come from trying to write to a SAGA grid (.sgrd),
> although it used to work until today...
>
> If you have any piece of information that could help me fix this problem, I
> will appreciate it a lot!
>
> Cheers,
>
> Guillaume
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeRaster-and-raster-give-same-error-after-package-update-tp7585138p7585139.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From droletguillaume at gmail.com  Wed Nov 20 00:08:59 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Tue, 19 Nov 2013 15:08:59 -0800 (PST)
Subject: [R-sig-Geo] writeRaster and raster give same error after
	package update
In-Reply-To: <CANtt_hzgbvFZQZjBNw6fPL0GxJ6fEONuc5tq5VBn9azD51gVNg@mail.gmail.com>
References: <CAOkiyv5tS8GvcFbuPdmw6DGEBVxhQhfDabWaOU3N40fz6QdKiQ@mail.gmail.com>
	<1384901560539-7585139.post@n2.nabble.com>
	<CANtt_hzgbvFZQZjBNw6fPL0GxJ6fEONuc5tq5VBn9azD51gVNg@mail.gmail.com>
Message-ID: <1384902539549-7585141.post@n2.nabble.com>

Robert: thanks! That's a great news! 

Can't wait to install the fixed version and continue my work.

Guillaume



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeRaster-and-raster-give-same-error-after-package-update-tp7585138p7585141.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.naimi at utwente.nl  Wed Nov 20 00:33:22 2013
From: b.naimi at utwente.nl (b.naimi at utwente.nl)
Date: Tue, 19 Nov 2013 23:33:22 +0000
Subject: [R-sig-Geo] Collinearity test
In-Reply-To: <F4F0D729F6AAFE47A105B7809266251710EE7528@EXMBX21.ad.utwente.nl>
References: <F4F0D729F6AAFE47A105B7809266251710EE650A@EXMBX21.ad.utwente.nl>,
	<F4F0D729F6AAFE47A105B7809266251710EE7528@EXMBX21.ad.utwente.nl>
Message-ID: <F4F0D729F6AAFE47A105B7809266251710EE7539@EXMBX21.ad.utwente.nl>

Hi Maurizio,

You can use vif, vifstep, vifcor and exclude functions in usdm package to deal with collinearity problem in environmental variables. The input variables can be either raster object or data.frames. You can find an example of using these function for SDM in the following reference:

Naimi, B.,et al..(2013). Where is positional uncertainty a problem for species distribution modelling, Ecography. DOI: 10.1111/j.1600-0587.2013.00205.x<http://onlinelibrary.wiley.com/doi/10.1111/j.1600-0587.2013.00205.x/abstract>

Hope this helps.

Cheers,

Babak
http://r-gis.net


> -----Original Message-----
Date: Sun, 17 Nov 2013 12:03:18 -0800
From: "Robert J. Hijmans" <r.hijmans at gmail.com>
To: "Proosdij, Andre van" <andre.vanproosdij at wur.nl>
Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>,        Maurizio
        Marchi <mauriziomarchi85 at gmail.com>
Subject: Re: [R-sig-Geo] Collinearity test
Message-ID:
        <CANtt_hw=3-EtHj+B3AjowNTX3_7ZDhGUWexDa3OzVWFRjCEOeA at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Also see:

library(dismo)
s <- stack(system.file("external/rlogo.grd", package="raster"))
pairs(s)

Robert

On Wed, Nov 13, 2013 at 3:06 AM, Proosdij, Andre van
<andre.vanproosdij at wur.nl> wrote:
> Hi Maurizio,
>
> I used the rcorr function from the Hmisc package to calculate the Pearson correlation.
>
> Best,
>
>
> Andr?
>
>
> Ir. A.S.J. van Proosdij
> PhD Student
> e  andre.vanproosdij at wur.nl
> Naturalis Biodiversity Center, section NHN
> Biosystematics Group, Wageningen University
> Gen. Foulkesweg 37, 6703 BL Wageningen, the Netherlands
> www.bis.wur.nl<http://www.bis.wur.nl>
>

> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Maurizio Marchi
> Sent: woensdag 13 november 2013 11:00
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Collinearity test
>
> Hallo everybody,
> I'm working with Species Distibution Models to predict the potential distribution of a forest specie.
> I use WorldClim raster data for Italy and before running SDMs algorithm I would like to test the collineariy between factors to eliminate redundancy of data.
> My question in: is there a package that can be used to Test collinearity between factors of a raster stack (worldclim biovariables)?
>
> Thanks,
>
> --
> Maurizio Marchi, Ph.D student
> Forestry Research Centre (Arezzo, IT)
> ID skype: maurizioxyz
> *Ubuntu 12.04 (Precise Pangolin)*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

        [[alternative HTML version deleted]]




From Scott.Waichler at pnnl.gov  Wed Nov 20 01:32:50 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Tue, 19 Nov 2013 16:32:50 -0800
Subject: [R-sig-Geo] image background for spplot of gridded data
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B3B6B674@EMAIL05.pnl.gov>

I was told, among other things, to look for previous messages by Oscar that would explain how to do this.  Here is Oscar's solution that I found to work for the case where you want to plot two rasters that have different extents.  In my case, gmap is a satellite image obtained with RgoogleMaps, and z are the results I want to plot over the background image.  I made the alpha values of z less than 1 so that the background image would show through.

library(rasterVis)
levelplot(z~x*y) + 
layer_(grid.raster(gmap, y=latCenter, width=width, height=height, default.units='native'))

Scott Waichler


From chetcuti at hawaii.edu  Wed Nov 20 04:05:41 2013
From: chetcuti at hawaii.edu (Jordan Chetcuti)
Date: Tue, 19 Nov 2013 17:05:41 -1000
Subject: [R-sig-Geo] Regression kriging - error not found when ordinary
	kriging
In-Reply-To: <1549776.gbLsn439Pv@erebus>
References: <CAFKik1dJag_3Mckcd4feVL0S9MSML1VHPdD--Wpr=ZCJ=qw1ZQ@mail.gmail.com>
	<1549776.gbLsn439Pv@erebus>
Message-ID: <CAFKik1fMFu7GRH4bQBBMoL733aZ7EBoNJFC3QH7SmcjSmXZ_DA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131119/e3135132/attachment.pl>

From droletguillaume at gmail.com  Wed Nov 20 15:32:29 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Wed, 20 Nov 2013 06:32:29 -0800 (PST)
Subject: [R-sig-Geo] writeRaster and raster give same error after
	package update
In-Reply-To: <1384902539549-7585141.post@n2.nabble.com>
References: <CAOkiyv5tS8GvcFbuPdmw6DGEBVxhQhfDabWaOU3N40fz6QdKiQ@mail.gmail.com>
	<1384901560539-7585139.post@n2.nabble.com>
	<CANtt_hzgbvFZQZjBNw6fPL0GxJ6fEONuc5tq5VBn9azD51gVNg@mail.gmail.com>
	<1384902539549-7585141.post@n2.nabble.com>
Message-ID: <1384957949168-7585145.post@n2.nabble.com>

Hi Robert,

This morning I got the error below when I tried to install the latest
version of raster:

> install.packages("raster", repos = "http://R-Forge.project.org")

Installing package into ?C:/Users/Utilisateur/Documents/R/win-library/3.0?
(as ?lib? is unspecified)
source repository is unavailable to check versions
Error in install.packages : Line starting '<!DOCTYPE HTML PUBLI ...' is
malformed!

Do you have any clue?

Cheers,

Guillaume



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeRaster-and-raster-give-same-error-after-package-update-tp7585138p7585145.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ashton at msu.edu  Wed Nov 20 16:22:03 2013
From: ashton at msu.edu (Ashton Shortridge)
Date: Wed, 20 Nov 2013 10:22:03 -0500
Subject: [R-sig-Geo] Regression kriging - error not found when ordinary
	kriging
In-Reply-To: <CAFKik1fMFu7GRH4bQBBMoL733aZ7EBoNJFC3QH7SmcjSmXZ_DA@mail.gmail.com>
References: <CAFKik1dJag_3Mckcd4feVL0S9MSML1VHPdD--Wpr=ZCJ=qw1ZQ@mail.gmail.com>
	<1549776.gbLsn439Pv@erebus>
	<CAFKik1fMFu7GRH4bQBBMoL733aZ7EBoNJFC3QH7SmcjSmXZ_DA@mail.gmail.com>
Message-ID: <1411494.JK0lMCO4IV@erebus>

hi Jordan,

(off-list) 

it sounds like your problem is not a good candidate for regression kriging. RK 
(or the similar kriging with external drift, KED) require that you have 
collocated dependent and independent variables so that you can actually run a 
regression.

You could use cokriging, though in my experience (limited!) cokriging with 
more than one secondary variable becomes a real pain to model. This is because 
the cross-variogram models all have to meet certain requirements.

I have some lecture notes that might (or might not) be helpful:
https://www.msu.edu/~ashton/classes/866/notes/lect18/index.html

Yours,

Ashton


On Tuesday, November 19, 2013 05:05:41 PM Jordan Chetcuti wrote:
> Hi Ashton,
> 
> Thanks for taking the time to email me.
> 
> I alas don't have the variables for all locations in the "blank" dataset. I
> am beginning to wonder if I entirely understand regression kriging (or in
> fact if any of my class really understand this).
> 
> Having the variables at more locations than the "bd" dataset, makes this
> seem similar to co-kriging.
> 
> That would make more sense, I had wondered how the regression was worked
> out for each prediction location.
> 
> Thanks again.
> 
> Regards
> 
> Jordan
> 
> On 18 November 2013 03:40, Ashton Shortridge <ashton at msu.edu> wrote:
> > Hi Jordan,
> > 
> > I always use the 'data' parameter when kriging. Here's how I'd do it:
> > 
> > class(bd)   # This should be a SpatialPointsDataFrame
> > names(bd) #  all the variables in the model (Total, m5005CVOL, etc)
> > 
> > class(blank) # This should be a SpatialPointsDataFrame
> > names(blank) # all the variables in the model except for Total
> > 
> > TotalRegKrige <- krige(Total~m5005CVOL+n50010CVOL+n50015CVOL+DTM, bd,
> > blank,
> > model=fit_r)
> > 
> > 
> > Hope this helps.
> > 
> > Ashton
> > 
> > On Friday, November 15, 2013 10:10:30 AM Jordan Chetcuti wrote:
> > > Hello, I was wondering if anyone has encountered this issue?
> > > 
> > > This line works:
> > >                       TotalKrige <- krige(Total~1, locations=bd,
> > > 
> > > newdata=blank, model=fit_Total)
> > > 
> > > This line does not:
> > >                      TotalRegKrige <-
> > > 
> > > krige(Total~m5005CVOL+n50010CVOL+n50015CVOL+DTM, locations=bd,
> > > newdata=blank, model=fit_r)
> > > 
> > > Message:
> > >                      Error in eval(expr, envir, enclos) : object
> > > 
> > > 'm5005CVOL' not found
> > > 
> > > I have emailed the author of the library "gstat", he very helpfully
> > > offered some advice and that I post here. I have also included my
> > > intial email exchange with Prof. Pebesma.
> > > 
> > > I have included a description of my two datsets below and the
> > > libraries I have loaded.
> > > 
> > > data = locations (therefore it isn't necessary to have "data"
> > > specified (in the way it is in a linear model lm() )
> > > newdata = the locations to krige
> > > 
> > > I have also tried among other things:
> > > 
> > > TotalRegKrige <-
> > > krige(Total~bd$m5005CVOL+bd$n50010CVOL+bd$n50015CVOL+bd$DTM,
> > > locations=bd, newdata=blank, model=fit_r)
> > > 
> > > Giveing:
> > > 
> > > Error in gstat.formula.predict(d$formula, newdata, na.action =
> > 
> > na.action,  :
> > > NROW(locs) != NROW(X): this should not occur
> > > In addition: Warning messages:
> > > 1: 'newdata' had 26026 rows but variables found have 83 rows
> > > 2: 'newdata' had 26026 rows but variables found have 83 rows
> > > 
> > > This would lead me to think there is an error in the ascii grid,
> > > except that it worked perfectly in the ordinary kriging example.
> > > 
> > > Any help anyone can give would be greatly appreciated.
> > > 
> > > Regards
> > > 
> > > Jordan Chetcuti
> > > 
> > > p.s. see descriptions of data and libraries below, and conversation
> > > with Prof. Pebesma.
> > > 
> > > 
> > > Dataset "bd"
> > > 
> > > > summary(bd)
> > > 
> > > Object of class SpatialPointsDataFrame
> > > 
> > > Coordinates:
> > >       min     max
> > > 
> > > X  228112  232468
> > > Y 2190072 2195810
> > > Is projected: NA
> > > proj4string : [NA]
> > > Number of points: 83
> > > 
> > > Data attributes:
> > >    StationID       m1K10CrnR       m1K10TrHT       m1K10CVOL (only
> > > 
> > > first few, contains many).
> > > 
> > > Dataset "blank"
> > > 
> > > > summary(blank)
> > > 
> > > Object of class SpatialGridDataFrame
> > > 
> > > Coordinates:
> > >          min     max
> > > 
> > > [1,]  226693  233843
> > > [2,] 2187940 2197040
> > > Is projected: NA
> > > proj4string : [NA]
> > > 
> > > Grid attributes:
> > >   cellcentre.offset cellsize cells.dim
> > > 
> > > 1            226718       50       143
> > > 2           2187965       50       182
> > > 
> > > Data attributes:
> > >    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
> > >    
> > >       1       1       1       1       1       1
> > > 
> > > Libraries
> > > 1. geoR
> > > 2. gstat
> > > 3. sp
> > > 4. lattice
> > > 
> > > >---------- Forwarded message ----------
> > > >From: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> > > >Date: 14 November 2013 21:15
> > > >Subject: Re: Regression kriging
> > > >To: Jordan Chetcuti <chetcuti at hawaii.edu>
> > > >
> > > >
> > > >You omitted the error, which is:
> > > >
> > > >Error in eval(expr, envir, enclos) : object 'm5005CVOL' not found
> > > >
> > > >it means that in "blank", the prediction locations, m5005CVOL is not
> > > >found (as is true of all other predictors).
> > > >
> > > >Please consider posting to r-sig-geo in the future.
> > > >
> > > >with best regards,
> > > >
> > > >Edzer Pebesma
> > > >
> > > >On 11/15/2013 03:30 AM, Jordan Chetcuti wrote:
> > > >> Dear Prof. Pebesma,
> > > >> 
> > > >> My name is Jordan Chetcuti and I am a graduate student at the
> > 
> > University
> > 
> > > >> of
> > > >> Hawaii at Manoa, in the Geography department.
> > > >> 
> > > >> I am attempting to do regression kriging on some of my data, but I am
> > > >> alas
> > > >> having a bit of a problem with gstat.
> > > >> 
> > > >> within my script this line works:
> > > >> 
> > > >> TotalKrige <- krige(Total~1, locations=bd, newdata=blank,
> > > >> model=fit_Total)
> > > >> 
> > > >> this does not:
> > > >> 
> > > >> TotalRegKrige <- krige(Total~m5005CVOL+n50010CVOL+n50015CVOL+DTM,
> > > >> locations=bd, newdata=blank, model=fit_r)
> > > >> 
> > > >> The problem seems to be in the "newdata" when regression kriging
> > > >> (replacing
> > > >> "blank" with "bd" does not cause the error, although it also does not
> > > >> krige
> > > >> between the points)
> > > >> 
> > > >> I was wondering if you would mind having a very quick look at this
> > > >> for
> > > >> me?
> > > >> My hope is that it is something I have simply mistyped. I've spent
> > > >> considerable time writing vba, vb.net and python scripts and numerous
> > > >> weeks
> > > >> working in R recently and I am usually pretty good at de-bugging.
> > 
> > Alas at
> > 
> > > >> the moment I can't seem to find a solution.
> > > >> 
> > > >> Any help would be greatly received.
> > > >> 
> > > >> Sincerely
> > > >> 
> > > >> Jordan Chetcuti
> > > 
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at r-project.org
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> > -----
> > Ashton Shortridge
> > Associate Professor                     ashton at msu.edu
> > Dept of Geography                       http://www.msu.edu/~ashton
> > 235 Geography Building          ph (517) 432-3561
> > Michigan State University               fx (517) 432-1671
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-----
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From droletguillaume at gmail.com  Wed Nov 20 17:40:23 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Wed, 20 Nov 2013 08:40:23 -0800 (PST)
Subject: [R-sig-Geo] cluster error with clusterR and calc
Message-ID: <1384965623370-7585148.post@n2.nabble.com>

Hi,I have the piece of code below which returns this error: Error in
clusterR(s, fun1, filename = f) : cluster error# Piece of code# x, y, z are
rasters# f is a filenamefun1 <- function(x) {      calc(x, fun = function(x)
{        10 * (x[2] - x[3]) / ENV.LAPSERATE + x[1]      })}s <- stack(x, y,
z)beginCluster(nodes)  h <- clusterR(s, fun1, filename = f)endCluster()# End
piece of codeYesterday I got the code to run without error by first
detaching package "parallel" detach("package:parallel", unload = TRUE) [It
seems that package "parallel" is masking functions from package "snow" which
is used by clusterR]. Today I just can't detach "parallel" (Error in
detach("package:parallel") : argument 'name' incorrect). This may be due to
the fact that I updated a buch of packages yesterday.If you have any idea
about what is causing this error, please let me know. I'll be very
happy!Thanks,Guillaume



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/cluster-error-with-clusterR-and-calc-tp7585148.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Wed Nov 20 18:19:52 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 20 Nov 2013 09:19:52 -0800
Subject: [R-sig-Geo] writeRaster and raster give same error after
	package update
In-Reply-To: <1384957949168-7585145.post@n2.nabble.com>
References: <CAOkiyv5tS8GvcFbuPdmw6DGEBVxhQhfDabWaOU3N40fz6QdKiQ@mail.gmail.com>
	<1384901560539-7585139.post@n2.nabble.com>
	<CANtt_hzgbvFZQZjBNw6fPL0GxJ6fEONuc5tq5VBn9azD51gVNg@mail.gmail.com>
	<1384902539549-7585141.post@n2.nabble.com>
	<1384957949168-7585145.post@n2.nabble.com>
Message-ID: <CANtt_hx-ySrM_b5Lq2CUs0OhkFP12Jb3nRs5K7tFxQt3is_5Tw@mail.gmail.com>

Guillaume.
Alternatively you can download and then install from here:
http://r-forge.r-project.org/R/?group_id=294
Download the zip file and in Rgui use "install packages from local zip file"
Robert



On Wed, Nov 20, 2013 at 6:32 AM, Guillaume Drolet
<droletguillaume at gmail.com> wrote:
> Hi Robert,
>
> This morning I got the error below when I tried to install the latest
> version of raster:
>
>> install.packages("raster", repos = "http://R-Forge.project.org")
>
> Installing package into ?C:/Users/Utilisateur/Documents/R/win-library/3.0?
> (as ?lib? is unspecified)
> source repository is unavailable to check versions
> Error in install.packages : Line starting '<!DOCTYPE HTML PUBLI ...' is
> malformed!
>
> Do you have any clue?
>
> Cheers,
>
> Guillaume
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeRaster-and-raster-give-same-error-after-package-update-tp7585138p7585145.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Wed Nov 20 18:41:37 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 20 Nov 2013 09:41:37 -0800
Subject: [R-sig-Geo] cluster error with clusterR and calc
In-Reply-To: <1384965623370-7585148.post@n2.nabble.com>
References: <1384965623370-7585148.post@n2.nabble.com>
Message-ID: <CANtt_hwH=_=LkKbGqp_L14s01d9-5=HQ-Ry8rJiuHjQFR1K-nQ@mail.gmail.com>

Guillaume,

You cannot use an unevaluated variable in the clusterR "fun" function
as such variables are not exported to the nodes. It works by replacing
ENV.LAPSERATE with a number.
Also, note my different (matrix) notation in the function for calc,
but that for cases like this, where you want to refer to specific
layers, the overlay function is more convenient.

Robert

library(raster)
x <- raster()
y = setValues(x, runif(ncell(x)))
z = setValues(x, runif(ncell(x)))
x = setValues(x, runif(ncell(x)))
f= 'test.tif'
s <- stack(x, y, z)

# note, I replaced ENV.LAPSERATE with a number
fun1 <- function(x) calc(x, fun = function(d){ 10 * (d[,2] - d[,3]) /
6 + d[,1] })
fun2 <- function(x) overlay(x, fun = function(d,e,f){ 10 * (e - f) / 6 + d })

beginCluster(4)
h1 <- clusterR(s, fun1)
h2 <- clusterR(s, fun2)
# or like this
h3 <- clusterR(s, overlay, args=list(fun = function(d,e,f){ 10 * (e -
f) / 6 + d }))
endCluster()

On Wed, Nov 20, 2013 at 8:40 AM, Guillaume Drolet
<droletguillaume at gmail.com> wrote:
> Hi,I have the piece of code below which returns this error: Error in
> clusterR(s, fun1, filename = f) : cluster error# Piece of code# x, y, z are
> rasters# f is a filenamefun1 <- function(x) {      calc(x, fun = function(x)
> {        10 * (x[2] - x[3]) / ENV.LAPSERATE + x[1]      })}s <- stack(x, y,
> z)beginCluster(nodes)  h <- clusterR(s, fun1, filename = f)endCluster()# End
> piece of codeYesterday I got the code to run without error by first
> detaching package "parallel" detach("package:parallel", unload = TRUE) [It
> seems that package "parallel" is masking functions from package "snow" which
> is used by clusterR]. Today I just can't detach "parallel" (Error in
> detach("package:parallel") : argument 'name' incorrect). This may be due to
> the fact that I updated a buch of packages yesterday.If you have any idea
> about what is causing this error, please let me know. I'll be very
> happy!Thanks,Guillaume
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/cluster-error-with-clusterR-and-calc-tp7585148.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From oscar.perpinan at gmail.com  Wed Nov 20 18:47:05 2013
From: oscar.perpinan at gmail.com (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Wed, 20 Nov 2013 18:47:05 +0100
Subject: [R-sig-Geo] image background for spplot of gridded data
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B3B6B674@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B3B6B674@EMAIL05.pnl.gov>
Message-ID: <CAMLL7bnvgJ=f-F1MAeeyE-Tnhmzhf7mYqhHBAhOjuiDB+NTS9g@mail.gmail.com>

Hi,

For the sake of completeness: just a few days ago I received a comment
to a post about spplot and ggmap
(http://procomun.wordpress.com/2013/04/24/stamen-maps-with-spplot/).
There I was using a SpatialPointsDataFrame object. Because of that
comment I posted another example with SpatialPolygonsDataFrame:
https://gist.github.com/oscarperpinan/7482848

Best,

Oscar.
-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Grupo de Sistemas Fotovoltaicos (IES-UPM)
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


2013/11/20 Waichler, Scott R <Scott.Waichler at pnnl.gov>:
> I was told, among other things, to look for previous messages by Oscar that would explain how to do this.  Here is Oscar's solution that I found to work for the case where you want to plot two rasters that have different extents.  In my case, gmap is a satellite image obtained with RgoogleMaps, and z are the results I want to plot over the background image.  I made the alpha values of z less than 1 so that the background image would show through.
>
> library(rasterVis)
> levelplot(z~x*y) +
> layer_(grid.raster(gmap, y=latCenter, width=width, height=height, default.units='native'))
>
> Scott Waichler
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From droletguillaume at gmail.com  Wed Nov 20 18:49:39 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Wed, 20 Nov 2013 09:49:39 -0800 (PST)
Subject: [R-sig-Geo] cluster error with clusterR and calc
In-Reply-To: <CANtt_hwH=_=LkKbGqp_L14s01d9-5=HQ-Ry8rJiuHjQFR1K-nQ@mail.gmail.com>
References: <1384965623370-7585148.post@n2.nabble.com>
	<CANtt_hwH=_=LkKbGqp_L14s01d9-5=HQ-Ry8rJiuHjQFR1K-nQ@mail.gmail.com>
Message-ID: <1384969779316-7585153.post@n2.nabble.com>

Hi Robert,

Thanks for your help. I thought that overlay didn't work with clusterR (see
?clusterR: ... For example, it works with calc but not with overlay.)

Is there any way to export variables to the clusters when using clusterR,
similar to when using clusterExport() with snow, or if it HAS to be hard
coded?

Best wishes,

Guillaume



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/cluster-error-with-clusterR-and-calc-tp7585148p7585153.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Wed Nov 20 19:48:40 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 20 Nov 2013 10:48:40 -0800
Subject: [R-sig-Geo] cluster error with clusterR and calc
In-Reply-To: <1384969779316-7585153.post@n2.nabble.com>
References: <1384965623370-7585148.post@n2.nabble.com>
	<CANtt_hwH=_=LkKbGqp_L14s01d9-5=HQ-Ry8rJiuHjQFR1K-nQ@mail.gmail.com>
	<1384969779316-7585153.post@n2.nabble.com>
Message-ID: <CANtt_hyNfPK+4nC2Yyeyz6E8OXMYdavE0uNA9dfE79_dKMhSSA@mail.gmail.com>

The manual is wrong. It should say that clusterR also works with
overlay if you use a single RasterStack or RasterBrick object as the
first argument (it would not work if you provided three RasterLayer
objects)

Yes, you can use clusterExport, by first calling getCluster() to get
the cluster object.

library(raster)
x <- raster()
y = setValues(x, runif(ncell(x)))
z = setValues(x, runif(ncell(x)))
x = setValues(x, runif(ncell(x)))
f= 'test.tif'
s <- stack(x, y, z)

ENV.LAPSERATE = 6
fun1 <- function(x) calc(x, fun = function(d){ 10 * (d[,2] - d[,3]) /
ENV.LAPSERATE + d[,1] })
fun2 <- function(x) overlay(x, fun = function(d,e,f){ 10 * (e - f) /
ENV.LAPSERATE + d })

beginCluster(4)
cl <- getCluster()
clusterExport(cl, "ENV.LAPSERATE")
h1 <- clusterR(s, fun1)
h2 <- clusterR(s, fun2)
h3 <- clusterR(s, overlay, args=list(fun = function(d,e,f){ 10 * (e -
f) / ENV.LAPSERATE + d }))
endCluster()

On Wed, Nov 20, 2013 at 9:49 AM, Guillaume Drolet
<droletguillaume at gmail.com> wrote:
> Hi Robert,
>
> Thanks for your help. I thought that overlay didn't work with clusterR (see
> ?clusterR: ... For example, it works with calc but not with overlay.)
>
> Is there any way to export variables to the clusters when using clusterR,
> similar to when using clusterExport() with snow, or if it HAS to be hard
> coded?
>
> Best wishes,
>
> Guillaume
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/cluster-error-with-clusterR-and-calc-tp7585148p7585153.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From rvaid at hotmail.com  Wed Nov 20 23:49:23 2013
From: rvaid at hotmail.com (Ravi --)
Date: Wed, 20 Nov 2013 14:49:23 -0800
Subject: [R-sig-Geo] Clipping a Map
Message-ID: <BLU176-W479408E300411D4B9FFEB0A7E60@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131120/dfdcba65/attachment.pl>

From bingjiehuang at gwmail.gwu.edu  Thu Nov 21 04:32:47 2013
From: bingjiehuang at gwmail.gwu.edu (BINGJIE HUANG)
Date: Wed, 20 Nov 2013 22:32:47 -0500
Subject: [R-sig-Geo] Spatial Prediction
Message-ID: <CAC36NmDz_s8P-ec5vGVJ4tQ-BiaBUFhbLa2ZmG+5z9hY2vo5iw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131120/60b7ef55/attachment.pl>

From pintodasilva.a at gmail.com  Thu Nov 21 16:25:55 2013
From: pintodasilva.a at gmail.com (Andre)
Date: Thu, 21 Nov 2013 07:25:55 -0800 (PST)
Subject: [R-sig-Geo] create rasters using pca components of bioclimatic
	variables
Message-ID: <1385047555545-7585158.post@n2.nabble.com>

Hi,

I performed pca in 4 bioclimatic variables using princomp.

##stack rasters
myExpl <- raster::stack (Bio01,Bio02,Bio03,Bio04)
##read as data.frame
m <- as.data.frame(myExpl)
##pca (here I used formula to activate na.action) 
pca <- princomp(formula = ~., data = m, cor = TRUE, na.action=na.exclude)

Now I would like to create rasters (with the same size as BIO01) for each
component of the PCA to use them as input in biomod2.

What is the best way to do this?

Many thanks,

Andre



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/create-rasters-using-pca-components-of-bioclimatic-variables-tp7585158.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Thu Nov 21 18:40:17 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 21 Nov 2013 09:40:17 -0800
Subject: [R-sig-Geo] create rasters using pca components of bioclimatic
	variables
In-Reply-To: <1385047555545-7585158.post@n2.nabble.com>
References: <1385047555545-7585158.post@n2.nabble.com>
Message-ID: <CANtt_hwCGW9Zn1867TiRXpQLHZcRVAjmvtOFbDOvVU+JOtHwpA@mail.gmail.com>

Andre,

The below is slightly modified from the example in
?raster::predict

library(raster)
logo <- brick(system.file("external/rlogo.grd", package="raster"))
sr <- sampleRegular(logo, min(100000, ncell(logo)))
pca <- prcomp(sr)
x <- predict(logo, pca, index=1:3)
plot(x)


Robert

On Thu, Nov 21, 2013 at 7:25 AM, Andre <pintodasilva.a at gmail.com> wrote:
> Hi,
>
> I performed pca in 4 bioclimatic variables using princomp.
>
> ##stack rasters
> myExpl <- raster::stack (Bio01,Bio02,Bio03,Bio04)
> ##read as data.frame
> m <- as.data.frame(myExpl)
> ##pca (here I used formula to activate na.action)
> pca <- princomp(formula = ~., data = m, cor = TRUE, na.action=na.exclude)
>
> Now I would like to create rasters (with the same size as BIO01) for each
> component of the PCA to use them as input in biomod2.
>
> What is the best way to do this?
>
> Many thanks,
>
> Andre
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/create-rasters-using-pca-components-of-bioclimatic-variables-tp7585158.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From pintodasilva.a at gmail.com  Thu Nov 21 19:47:51 2013
From: pintodasilva.a at gmail.com (Andre)
Date: Thu, 21 Nov 2013 10:47:51 -0800 (PST)
Subject: [R-sig-Geo] create rasters using pca components of bioclimatic
	variables
In-Reply-To: <CANtt_hwCGW9Zn1867TiRXpQLHZcRVAjmvtOFbDOvVU+JOtHwpA@mail.gmail.com>
References: <1385047555545-7585158.post@n2.nabble.com>
	<CANtt_hwCGW9Zn1867TiRXpQLHZcRVAjmvtOFbDOvVU+JOtHwpA@mail.gmail.com>
Message-ID: <CAGE9Ru9xQ0emAYaBiqYgDsO9BQxsV01bQdPBM-ktb+XRwScKgA@mail.gmail.com>

Thanks Robert.

I got this error

x <- predict(Bio01, pca, index=1:3)
Error in predict.princomp(model, blockvals, ...) :
  'newdata' does not have named columns matching one or more of the
original columns

What is missing in the code?

Thanks


On 21 November 2013 18:41, Robert Hijmans [via R-sig-geo] <
ml-node+s2731867n7585159h14 at n2.nabble.com> wrote:

> Andre,
>
> The below is slightly modified from the example in
> ?raster::predict
>
> library(raster)
> logo <- brick(system.file("external/rlogo.grd", package="raster"))
> sr <- sampleRegular(logo, min(100000, ncell(logo)))
> pca <- prcomp(sr)
> x <- predict(logo, pca, index=1:3)
> plot(x)
>
>
> Robert
>
> On Thu, Nov 21, 2013 at 7:25 AM, Andre <[hidden email]<http://user/SendEmail.jtp?type=node&node=7585159&i=0>>
> wrote:
>
> > Hi,
> >
> > I performed pca in 4 bioclimatic variables using princomp.
> >
> > ##stack rasters
> > myExpl <- raster::stack (Bio01,Bio02,Bio03,Bio04)
> > ##read as data.frame
> > m <- as.data.frame(myExpl)
> > ##pca (here I used formula to activate na.action)
> > pca <- princomp(formula = ~., data = m, cor = TRUE,
> na.action=na.exclude)
> >
> > Now I would like to create rasters (with the same size as BIO01) for
> each
> > component of the PCA to use them as input in biomod2.
> >
> > What is the best way to do this?
> >
> > Many thanks,
> >
> > Andre
> >
> >
> >
> > --
> > View this message in context:
> http://r-sig-geo.2731867.n2.nabble.com/create-rasters-using-pca-components-of-bioclimatic-variables-tp7585158.html
> > Sent from the R-sig-geo mailing list archive at Nabble.com.
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > [hidden email] <http://user/SendEmail.jtp?type=node&node=7585159&i=1>
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=7585159&i=2>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://r-sig-geo.2731867.n2.nabble.com/create-rasters-using-pca-components-of-bioclimatic-variables-tp7585158p7585159.html
>  To unsubscribe from create rasters using pca components of bioclimatic
> variables, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7585158&code=cGludG9kYXNpbHZhLmFAZ21haWwuY29tfDc1ODUxNTh8Nzg5MzY3ODc2>
> .
> NAML<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>



-- 
*Andr? P. Silva*
PhD Candidate
Department of Animal Ecology
Evolutionary Biology Centre
Uppsala University
Norbyv?gen 18D
752 36 Uppsala
Sweden




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/create-rasters-using-pca-components-of-bioclimatic-variables-tp7585158p7585160.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jacqueline.schweizer at wuestundpartner.com  Fri Nov 22 12:06:41 2013
From: jacqueline.schweizer at wuestundpartner.com (Jacqueline Schweizer)
Date: Fri, 22 Nov 2013 12:06:41 +0100
Subject: [R-sig-Geo] Spatial Regression Eigenwert-Matrix
Message-ID: <0175A702-98FA-40E4-A1F1-601F9D4BDADD@wuestundpartner.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131122/cc94a00d/attachment.pl>

From berman.jesse at gmail.com  Fri Nov 22 17:36:52 2013
From: berman.jesse at gmail.com (Jesse Berman)
Date: Fri, 22 Nov 2013 08:36:52 -0800 (PST)
Subject: [R-sig-Geo] Clipping a Map
In-Reply-To: <BLU176-W479408E300411D4B9FFEB0A7E60@phx.gbl>
References: <BLU176-W479408E300411D4B9FFEB0A7E60@phx.gbl>
Message-ID: <1385138212945-7585162.post@n2.nabble.com>

Hi Ravi,

After performing 'gIntersects' try merging this result to your dataframe,
then select the TRUE values?

Jesse

 cz_zip <- gIntersects(camapzip_temp,camap_base, byid=TRUE)
camap_base at data<-cbind(camap_base at data, czip)
camap2<-camap_base[(camap_base at data[,/???/] %in% c("TRUE)),] # Insert your
column number for czip in place of ???

plot(camap2)
head(camap2 at data) 



-----
--------------------------------------------------------
Jesse D Berman, PhD
Yale University
School of Forestry and Environmental Studies
Post-Doc Fellow
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Clipping-a-Map-tp7585156p7585162.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jgrn at illinois.edu  Fri Nov 22 18:50:57 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 22 Nov 2013 11:50:57 -0600
Subject: [R-sig-Geo] Graduate Positions in Landscape Level Plant-Climate
 Interactions and Remote Sensing Science
Message-ID: <CABG0rfumPzcnMVTO+5swG6xn-Lvj0mbQUPpE+-1d1E7FqnyqAg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131122/90bef6d9/attachment.pl>

From rvaid at hotmail.com  Fri Nov 22 18:51:06 2013
From: rvaid at hotmail.com (Ravi Vaid)
Date: Fri, 22 Nov 2013 09:51:06 -0800
Subject: [R-sig-Geo] Clipping a Map
In-Reply-To: <1385138212945-7585162.post@n2.nabble.com>
References: <BLU176-W479408E300411D4B9FFEB0A7E60@phx.gbl>,
	<1385138212945-7585162.post@n2.nabble.com>
Message-ID: <BLU176-W3C06C69D62FF6AB5BF17DA7E00@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131122/a1ede7e6/attachment.pl>

From Roger.Bivand at nhh.no  Fri Nov 22 19:59:53 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 22 Nov 2013 19:59:53 +0100
Subject: [R-sig-Geo] Clipping a Map
In-Reply-To: <BLU176-W3C06C69D62FF6AB5BF17DA7E00@phx.gbl>
References: <BLU176-W479408E300411D4B9FFEB0A7E60@phx.gbl>,
	<1385138212945-7585162.post@n2.nabble.com>
	<BLU176-W3C06C69D62FF6AB5BF17DA7E00@phx.gbl>
Message-ID: <alpine.LRH.2.03.1311221949290.28643@reclus.nhh.no>

On Fri, 22 Nov 2013, Ravi Vaid wrote:

>
> Jesse,
>
> The clipping of the larger map by a smaller region works perfectly, but the resulting map (the clipped version) has the data component of the SP object missing. I can't merge anything if the data component is not there. I have tried directly using the gintersection function to clip the map but that seems to fail (waited more than 2 hours for the program to run).
> When I run the command: slotNames(czout) I should get an object of name "data" along with the other 4 components below
> but I only get,
> I get: [1] "polygons"    "plotOrder"   "bbox"        "proj4string"So, somehow the "data" object is getting lost. I am fairly new to GIS, I just found the code for clipping on the sig-geo list and tried it and it worked, but the "data" object is missing. I know how to merge data but I just can't figure out how to recover the "data" component of the SP object.

No, you get a SpatialPolygons object. Obviously, the intersection will be 
some subset of your clipped input object, but the function cannot lknow or 
guess what you want. Suppose that you had a variable in the data slot that 
was a count of some phenomenon - we don't know what proportion of the 
count to retain if only part of the geometry is returned. This is clearly 
up to the user to decide. Use the row.names() of the input and output 
objects to identify which are which - use the accessor method to retrieve 
the string values

row.names(camapzip_temp)
row.names(camap_base)

and

row.names(cz_zip)

which are catenated from the input object row.names.

Hope this clarifies,

Roger

PS. Never, ever, assign directly to the data slot - this almost always 
creates havoc and confusion by sidestepping checking of row.name values. 
It's a really great way of randomising your data by accident, but 
otherwise has no good justification.

>
> Ravi
>
>
>> Date: Fri, 22 Nov 2013 08:36:52 -0800
>> From: berman.jesse at gmail.com
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Clipping a Map
>>
>> Hi Ravi,
>>
>> After performing 'gIntersects' try merging this result to your dataframe,
>> then select the TRUE values?
>>
>> Jesse
>>
>>  cz_zip <- gIntersects(camapzip_temp,camap_base, byid=TRUE)
>> camap_base at data<-cbind(camap_base at data, czip)
>> camap2<-camap_base[(camap_base at data[,/???/] %in% c("TRUE)),] # Insert your
>> column number for czip in place of ???
>>
>> plot(camap2)
>> head(camap2 at data)
>>
>>
>>
>> -----
>> --------------------------------------------------------
>> Jesse D Berman, PhD
>> Yale University
>> School of Forestry and Environmental Studies
>> Post-Doc Fellow
>> --
>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Clipping-a-Map-tp7585156p7585162.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From rvaid at hotmail.com  Fri Nov 22 20:31:42 2013
From: rvaid at hotmail.com (Ravi Vaid)
Date: Fri, 22 Nov 2013 11:31:42 -0800
Subject: [R-sig-Geo] Clipping a Map
In-Reply-To: <alpine.LRH.2.03.1311221949290.28643@reclus.nhh.no>
References: <BLU176-W479408E300411D4B9FFEB0A7E60@phx.gbl>, ,
	<1385138212945-7585162.post@n2.nabble.com>,
	<BLU176-W3C06C69D62FF6AB5BF17DA7E00@phx.gbl>,
	<alpine.LRH.2.03.1311221949290.28643@reclus.nhh.no>
Message-ID: <BLU176-W36411E802876D22B08A605A7E00@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131122/e7dfde84/attachment.pl>

From palfaro at motionsoft.com.uy  Fri Nov 22 21:09:56 2013
From: palfaro at motionsoft.com.uy (Pablo Alfaro)
Date: Fri, 22 Nov 2013 18:09:56 -0200
Subject: [R-sig-Geo] Intamap, reduce verbose output of idw method
Message-ID: <CAGFWpktq+b0tARuGFGN3=QaUt9AG43Jm_9ZnCgJ8e1igZHNZJA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131122/bc9cfcb0/attachment.pl>

From Roger.Bivand at nhh.no  Fri Nov 22 22:23:00 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 22 Nov 2013 22:23:00 +0100
Subject: [R-sig-Geo] Clipping a Map
In-Reply-To: <BLU176-W36411E802876D22B08A605A7E00@phx.gbl>
References: <BLU176-W479408E300411D4B9FFEB0A7E60@phx.gbl>, ,
	<1385138212945-7585162.post@n2.nabble.com>,
	<BLU176-W3C06C69D62FF6AB5BF17DA7E00@phx.gbl>,
	<alpine.LRH.2.03.1311221949290.28643@reclus.nhh.no>
	<BLU176-W36411E802876D22B08A605A7E00@phx.gbl>
Message-ID: <alpine.LRH.2.03.1311222211360.28997@reclus.nhh.no>

On Fri, 22 Nov 2013, Ravi Vaid wrote:
>
> Dude, You are going way over my head. I think I lost you in the first 
> sentence. Since this is probably a common task that alot of people have 
> to do, can you provide an example of doing this. That would really help. 
> I have a map of western US (camapzip_temp) and I am clipping the 
> California portion of that. The CA (camap_base) portion is just a single 
> polygon. The US map has zip code polygons and data attributes (zip 
> codes) are attached to this map. I know your time is valuable but when 
> ever you have some free time can you proved the modifications that are 
> necessary to the code below. I would really appreciate it. This might be 
> a silly question but why does the gIntersection function not work in 
> this case. Keep in mind I am really new at this. My original attempt is 
> below,

These things do not happen without study, it isn't just software, and 
there are no one-size-fits-all solutions (to anything). If anyone tells 
you otherwise, they are misleading you. Not only do I not have time, but 
you will learn more by understanding what is actually going on.

What we know is in ch. 5 of Bivand et al. (2013) Applied Spatial Data 
Analysis with R, Springer; read that and its references (read ch. 2 as 
well), and things should be plainer. Simplify as much as possible, yes, 
but no more, as we know, and oversimplification is a prime source of 
confusion.

Much of what we know about GEOS (and GDAL) is derived from watching the 
underlying functions in operation, often in unusual settings, and some 
aspects become clear after many years - a recent change to rgdal corrected 
a non-obvious misunderstanding about hoe GDAL worked that has been around 
since you were likely in primary school. Looking at the data and how it is 
represented in conjunction with understanding the operations you are using 
is crucial.

Hope this informs, clarification requires maybe more,

Roger


>
> {
> cz_zip <- gIntersects(camapzip_temp,camap_base, byid=TRUE)
> out <- lapply( which(cz_zip) , function(x){ gIntersection( camapzip_temp[x,] , camap_base ) } )
> keep <- sapply(out, class)
> out <- out[keep == "SpatialPolygons"]
> czout <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <- slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>                                                                   Pol}))
> }
>
>
>
>
>
>
>
>> Date: Fri, 22 Nov 2013 19:59:53 +0100
>> From: Roger.Bivand at nhh.no
>> To: rvaid at hotmail.com
>> CC: berman.jesse at gmail.com; r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Clipping a Map
>>
>> On Fri, 22 Nov 2013, Ravi Vaid wrote:
>>
>>>
>>> Jesse,
>>>
>>> The clipping of the larger map by a smaller region works perfectly, but the resulting map (the clipped version) has the data component of the SP object missing. I can't merge anything if the data component is not there. I have tried directly using the gintersection function to clip the map but that seems to fail (waited more than 2 hours for the program to run).
>>> When I run the command: slotNames(czout) I should get an object of name "data" along with the other 4 components below
>>> but I only get,
>>> I get: [1] "polygons"    "plotOrder"   "bbox"        "proj4string"So, somehow the "data" object is getting lost. I am fairly new to GIS, I just found the code for clipping on the sig-geo list and tried it and it worked, but the "data" object is missing. I know how to merge data but I just can't figure out how to recover the "data" component of the SP object.
>>
>> No, you get a SpatialPolygons object. Obviously, the intersection will be
>> some subset of your clipped input object, but the function cannot lknow or
>> guess what you want. Suppose that you had a variable in the data slot that
>> was a count of some phenomenon - we don't know what proportion of the
>> count to retain if only part of the geometry is returned. This is clearly
>> up to the user to decide. Use the row.names() of the input and output
>> objects to identify which are which - use the accessor method to retrieve
>> the string values
>>
>> row.names(camapzip_temp)
>> row.names(camap_base)
>>
>> and
>>
>> row.names(cz_zip)
>>
>> which are catenated from the input object row.names.
>>
>> Hope this clarifies,
>>
>> Roger
>>
>> PS. Never, ever, assign directly to the data slot - this almost always
>> creates havoc and confusion by sidestepping checking of row.name values.
>> It's a really great way of randomising your data by accident, but
>> otherwise has no good justification.
>>
>>>
>>> Ravi
>>>
>>>
>>>> Date: Fri, 22 Nov 2013 08:36:52 -0800
>>>> From: berman.jesse at gmail.com
>>>> To: r-sig-geo at r-project.org
>>>> Subject: Re: [R-sig-Geo] Clipping a Map
>>>>
>>>> Hi Ravi,
>>>>
>>>> After performing 'gIntersects' try merging this result to your dataframe,
>>>> then select the TRUE values?
>>>>
>>>> Jesse
>>>>
>>>>  cz_zip <- gIntersects(camapzip_temp,camap_base, byid=TRUE)
>>>> camap_base at data<-cbind(camap_base at data, czip)
>>>> camap2<-camap_base[(camap_base at data[,/???/] %in% c("TRUE)),] # Insert your
>>>> column number for czip in place of ???
>>>>
>>>> plot(camap2)
>>>> head(camap2 at data)
>>>>
>>>>
>>>>
>>>> -----
>>>> --------------------------------------------------------
>>>> Jesse D Berman, PhD
>>>> Yale University
>>>> School of Forestry and Environmental Studies
>>>> Post-Doc Fellow
>>>> --
>>>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Clipping-a-Map-tp7585156p7585162.html
>>>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From brian.buma at uas.alaska.edu  Sat Nov 23 07:58:48 2013
From: brian.buma at uas.alaska.edu (Brian Buma)
Date: Fri, 22 Nov 2013 21:58:48 -0900
Subject: [R-sig-Geo] Extract cell numbers from raster based on condition
Message-ID: <CAM25M7pvdxRpJ85S-_Jds5ct77DqQH00_biFGNzdn7OCwpTH4g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131122/921f8f01/attachment.pl>

From roman.lustrik at gmail.com  Sat Nov 23 09:51:58 2013
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 23 Nov 2013 09:51:58 +0100
Subject: [R-sig-Geo] Extract cell numbers from raster based on condition
In-Reply-To: <CAM25M7pvdxRpJ85S-_Jds5ct77DqQH00_biFGNzdn7OCwpTH4g@mail.gmail.com>
References: <CAM25M7pvdxRpJ85S-_Jds5ct77DqQH00_biFGNzdn7OCwpTH4g@mail.gmail.com>
Message-ID: <CAHT1vpgU=mZr=wocyW99_NWUyTc3cWWEQa7jCZJymdXrxJ0yfQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131123/d381a91e/attachment.pl>

From eddieatr at gmail.com  Sat Nov 23 17:12:05 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Sat, 23 Nov 2013 16:12:05 +0000
Subject: [R-sig-Geo] How to extract standard error,
	r-squared for a linear model in rasterstack?
Message-ID: <CABaJH78xP1kF_zzk6Qgb+3x9R5KdMfV9qLY7vZeuaKMxA0YRYQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131123/72e88b61/attachment.pl>

From ROONEYJ4 at tcd.ie  Sat Nov 23 17:30:43 2013
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Sat, 23 Nov 2013 16:30:43 +0000
Subject: [R-sig-Geo] Help - caling OpenBugs thourgh R2OpenBugs problem
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>

Hi all,

I am working on a Bayesian spatial smoothing project - and have implemented the BYM model, similar to the description in Chapter 11 of the ASDAR book. However, I have been having a huge problem calling OpenBugs from within R and I cannot figure out why. I would veyr much liek to do this as it would speed up the whole process. I'm stared at this for a omnth or two now to no avail so I'm hoping that somebody might spot a mistake. Basically when I call OpenBugs from R using the bugs command through R2OpenBugs - it throws a non-specific error and tells me to heck the bugs log file. The problem is Bugs does not generate one. This is made all the weirder by the fact that if I manually start up bugs and start it running using the data and inits files gnerated by R2OpenBugs - it runs fine without complaint. This is how I have been working so far. But I want to parallelize Bugs using Snow - so I need R2OpenBugs to work properly. I'm hoping someone here can help!!!

I've made a simulation to recreate the problem. My apologies it is a little complex, but I wanted to use the shapefile I'm actually working with which is freely downloadable for those willing to take a look.
So here goes.

1. Go here for the shapefile:
http://www.cso.ie/en/census/census2011boundaryfiles/

2. Click on the word "Disclaimer" to access the shapefiles (should you agree with the disclaimer!!). After clicking through the Disclaimer stuff, the file to download is: "Census2011_Electoral_Divisions_generalised20m.zip"

3. Set up a directory for this and save the shapefiles there.

4. You will need a bugs model. Cut and paste the below into a txt file and save it to your directory under the name "spatial_CAR.txt"

model
{

  for(i in 1:N)
  {
    observed[i]~dpois(mu[i])    
    log(theta[i])<-alpha + u[i] + v[i]
    mu[i]<-expected[i]*theta[i]
    u[i] ~dnorm(0,tau)
  }

v[1:N]~car.normal(adj[],weights[],num[],precv)

  alpha ~dflat()
  tau ~dgamma(0.001,0.001)
  precv ~dgamma(0.1,0.1)
}

5. Now open R and paste in the R code below. Remember to set your working directory to the same directory you saved the shapefiles and bugs model into. Also you might need to modify the path to OpenBugs on your machine.

6. Run the code. For me the final line throws the error:
"Error in bugs.run(n.burnin, OpenBUGS.pgm, debug = debug, WINE = WINE,  : 
  Look at the log file in  C:......<SNIP>................./R2OpenBugs Simulation  and
try again with 'debug=TRUE' to figure out what went wrong within OpenBUGS."

I cannot figure out why!!! The log file does not exist!! If you manually open bugs and use the data and init files it works. Why ? No idea!!!!
Any and all help much appreciated!!!
Apologies for the length of this!!

James


R Code:

library(rgdal)
library(spdep)
library(R2OpenBUGS)

setwd("....your working directory here......")

#Read in Spatial Polygon Data Frame
SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)

# Detect neighbours
nb<-poly2nb(SPolyDF,queen=T,snap=0.1) # snap at 100m distance

# Create nb weights
nb.w<-nb2listw(nb,zero.policy=T,style="B")

# Create BUGS CAR weights
nbBugs<-listw2WB(nb.w)

# Simulate some count data for observed and expected cases
N<-nrow(SPolyDF)
SPolyDF$obs<-sample.int(100, N, TRUE)
SPolyDF$exp<-sample.int(100, N, TRUE)

# Prep Data for OpenBugs
d<-list(N = N, observed = SPolyDF$obs, expected = SPolyDF$exp, adj=nbBugs$adj, weights=nbBugs$weights, num=nbBugs$num)

# Specify dir where bugs lives
BugsDir<-"C:/Program Files (x86)/OpenBUGS/OpenBUGS322"

# Define initial values for bugs
inits<-list(
   list(u=rep(0,N),v=rep(0,N),alpha=0,tau=0.0001,precv=0.002)
   ,list(u=rep(0,N),v=rep(0,N),alpha=0.1,tau=0.0002,precv=0.001))

# Define working directory as current directory
wdir=getwd()

# Openbugs call
MCMCres<-bugs(data=d,inits=inits,parameters.to.save =c("theta","alpha","tau","precv"),
              n.iter=1000,model.file="spatial_CAR.txt",n.chains=2,n.burnin=100,n.thin=1, 
              OpenBUGS.pgm=BugsDir,working.directory=wdir,codaPkg=F,debug=T)


From brian.buma at uas.alaska.edu  Sat Nov 23 19:48:10 2013
From: brian.buma at uas.alaska.edu (Brian Buma)
Date: Sat, 23 Nov 2013 09:48:10 -0900
Subject: [R-sig-Geo] Extract cell numbers from raster based on condition
In-Reply-To: <CAHT1vpgU=mZr=wocyW99_NWUyTc3cWWEQa7jCZJymdXrxJ0yfQ@mail.gmail.com>
References: <CAM25M7pvdxRpJ85S-_Jds5ct77DqQH00_biFGNzdn7OCwpTH4g@mail.gmail.com>
	<CAHT1vpgU=mZr=wocyW99_NWUyTc3cWWEQa7jCZJymdXrxJ0yfQ@mail.gmail.com>
Message-ID: <CAM25M7prpwKNF75KsFVLRopw_ZE3q=VgsFydOJU-a=1ywdQrBw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131123/dbdf4682/attachment.pl>

From droletguillaume at gmail.com  Sun Nov 24 01:01:45 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Sat, 23 Nov 2013 16:01:45 -0800 (PST)
Subject: [R-sig-Geo] Extract cell numbers from raster based on condition
In-Reply-To: <CAM25M7prpwKNF75KsFVLRopw_ZE3q=VgsFydOJU-a=1ywdQrBw@mail.gmail.com>
References: <CAM25M7pvdxRpJ85S-_Jds5ct77DqQH00_biFGNzdn7OCwpTH4g@mail.gmail.com>
	<CAHT1vpgU=mZr=wocyW99_NWUyTc3cWWEQa7jCZJymdXrxJ0yfQ@mail.gmail.com>
	<CAM25M7prpwKNF75KsFVLRopw_ZE3q=VgsFydOJU-a=1ywdQrBw@mail.gmail.com>
Message-ID: <1385251305356-7585174.post@n2.nabble.com>

Hi Brian,

To get cell numbers of raster NA values, use this:

cellnb.na <- Which(is.na(ras), cells = TRUE)

Guillaume



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Extract-cell-numbers-from-raster-based-on-condition-tp7585169p7585174.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Sun Nov 24 04:19:42 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 23 Nov 2013 19:19:42 -0800
Subject: [R-sig-Geo] How to extract standard error,
 r-squared for a linear model in rasterstack?
In-Reply-To: <CABaJH78xP1kF_zzk6Qgb+3x9R5KdMfV9qLY7vZeuaKMxA0YRYQ@mail.gmail.com>
References: <CABaJH78xP1kF_zzk6Qgb+3x9R5KdMfV9qLY7vZeuaKMxA0YRYQ@mail.gmail.com>
Message-ID: <CANtt_hzpsFF3-kaZ7Dr5YWHJSZtZJhbPp0_=9eikfEFjZ3Ytjg@mail.gmail.com>

Eddie, here is how you can do that (presented as a general worked
example for writing functions for calc) Robert

#1 create test data
library(raster)
r <- raster(nrow=10, ncol=10)
set.seed(0)
s <- stack(lapply(1:12, function(i) setValues(r, rnorm(ncell(r), i, 3) )))
time <- 1:nlayers(s)

#2 create an appropriate function that returns the values of interest

fun <- function(x) {
  m <- lm(x ~ time)
  s  <- summary(m)
  r2 <- s$r.squared
  p <- s$coefficients[2,4]
  cbind(r2, p)
}


#3 test the function for a single cell (vector)
test <- as.vector(s[1])
fun(test)
#            r2           p
#[1,] 0.453078 0.01643562
# OK

#4 also test with some NA values
test[3] <- NA
fun(test)
#            r2          p
#[1,] 0.4025646 0.03600484
#OK

#5 also test with only NA values
test[] <- NA
fun(test)
#Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...) :
#  0 (non-NA) cases

#6 not good, fix function
fun <- function(x) {
if (all(is.na(x))) {
return(cbind(NA,NA))
}
m <- lm(x ~ time)
s  <- summary(m)
r2 <- s$r.squared
p <- s$coefficients[2,4]
cbind(r2, p)
}

#7 test again
test <- as.vector(s[1])
fun(test)
#            r2           p
#[1,] 0.453078 0.01643562
test[3] <- NA
fun(test)
#            r2          p
#[1,] 0.4025646 0.03600484
test[] <- NA
fun(test)
#     [,1] [,2]
#[1,]   NA   NA
# all good now

#8 test within apply (although this may not be strictly required)

t(apply(s[1:5], 1, fun))
#          [,1]         [,2]
#[1,] 0.4530780 0.0164356218
#[2,] 0.6958559 0.0007421297
#[3,] 0.6469321 0.0016099809
#[4,] 0.3184170 0.0559753606
#[5,] 0.4496749 0.0170002701
# looks good

#9 test with Raster* data
 s[1:5] <- NA
 r <- calc(s, fun)
 plot(r)

#10 all good, now try with the real data

On Sat, Nov 23, 2013 at 8:12 AM, Eddie Smith <eddieatr at gmail.com> wrote:
> Dear list,
>
> r <- raster(nrow=10, ncol=10)
> s1 <- s2<- list()
> for (i in 1:12) {
>     s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
>     s2[i] <- setValues(r, rnorm(ncell(r), i, 3) )
> }
> s1 <- stack(s1)
> s2 <- stack(s2)
>
> stest <- stack(s1, s2)
> fun <- function(x) { lm(x ~ time)$coefficients }
> x <- calc(stest, fun)
>
> >From the raster document, x contains the intercept and slope of the model.
>
> Anybody could help me in producing other details of the model e.g standard
> error, r-squared, p-value etc?
>
> Thanks in advance.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Sun Nov 24 04:22:11 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 23 Nov 2013 19:22:11 -0800
Subject: [R-sig-Geo] Extract cell numbers from raster based on condition
In-Reply-To: <1385251305356-7585174.post@n2.nabble.com>
References: <CAM25M7pvdxRpJ85S-_Jds5ct77DqQH00_biFGNzdn7OCwpTH4g@mail.gmail.com>
	<CAHT1vpgU=mZr=wocyW99_NWUyTc3cWWEQa7jCZJymdXrxJ0yfQ@mail.gmail.com>
	<CAM25M7prpwKNF75KsFVLRopw_ZE3q=VgsFydOJU-a=1ywdQrBw@mail.gmail.com>
	<1385251305356-7585174.post@n2.nabble.com>
Message-ID: <CANtt_hyQNvcC3Uvio8my0R9834LbKusQ6DkBVfRD910Y2_U=vw@mail.gmail.com>

And to get the cell numbers of cells with a value > 50 you can do

library(raster)
ras <- raster(ncols=10,nrows=10)
ras[] <- 1:100

# following Guillaume
Which(ras > 50, cells = TRUE)

# or like this (and this also returns the cell values ( p[, 3] ):
p <- rasterToPoints(ras, fun=function(x){x>50})
cellFromXY(ras, p[,1:2])

Robert

On Sat, Nov 23, 2013 at 4:01 PM, Guillaume Drolet
<droletguillaume at gmail.com> wrote:
> Hi Brian,
>
> To get cell numbers of raster NA values, use this:
>
> cellnb.na <- Which(is.na(ras), cells = TRUE)
>
> Guillaume
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Extract-cell-numbers-from-raster-based-on-condition-tp7585169p7585174.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Sun Nov 24 04:24:45 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 23 Nov 2013 19:24:45 -0800
Subject: [R-sig-Geo] create rasters using pca components of bioclimatic
	variables
In-Reply-To: <CAGE9Ru9xQ0emAYaBiqYgDsO9BQxsV01bQdPBM-ktb+XRwScKgA@mail.gmail.com>
References: <1385047555545-7585158.post@n2.nabble.com>
	<CANtt_hwCGW9Zn1867TiRXpQLHZcRVAjmvtOFbDOvVU+JOtHwpA@mail.gmail.com>
	<CAGE9Ru9xQ0emAYaBiqYgDsO9BQxsV01bQdPBM-ktb+XRwScKgA@mail.gmail.com>
Message-ID: <CANtt_hyiOowwthiU8ASUgQci02hVDyqOcuUbkBOBZ7EL+PBbvw@mail.gmail.com>

You are using 'Bio01' where it probably should be 'myExpl'. I would
have thought that this should have been pretty clear from the working
example that I sent.
Robert

On Thu, Nov 21, 2013 at 10:47 AM, Andre <pintodasilva.a at gmail.com> wrote:
> Thanks Robert.
>
> I got this error
>
> x <- predict(Bio01, pca, index=1:3)
> Error in predict.princomp(model, blockvals, ...) :
>   'newdata' does not have named columns matching one or more of the
> original columns
>
> What is missing in the code?
>
> Thanks
>
>
> On 21 November 2013 18:41, Robert Hijmans [via R-sig-geo] <
> ml-node+s2731867n7585159h14 at n2.nabble.com> wrote:
>
>> Andre,
>>
>> The below is slightly modified from the example in
>> ?raster::predict
>>
>> library(raster)
>> logo <- brick(system.file("external/rlogo.grd", package="raster"))
>> sr <- sampleRegular(logo, min(100000, ncell(logo)))
>> pca <- prcomp(sr)
>> x <- predict(logo, pca, index=1:3)
>> plot(x)
>>
>>
>> Robert
>>
>> On Thu, Nov 21, 2013 at 7:25 AM, Andre <[hidden email]<http://user/SendEmail.jtp?type=node&node=7585159&i=0>>
>> wrote:
>>
>> > Hi,
>> >
>> > I performed pca in 4 bioclimatic variables using princomp.
>> >
>> > ##stack rasters
>> > myExpl <- raster::stack (Bio01,Bio02,Bio03,Bio04)
>> > ##read as data.frame
>> > m <- as.data.frame(myExpl)
>> > ##pca (here I used formula to activate na.action)
>> > pca <- princomp(formula = ~., data = m, cor = TRUE,
>> na.action=na.exclude)
>> >
>> > Now I would like to create rasters (with the same size as BIO01) for
>> each
>> > component of the PCA to use them as input in biomod2.
>> >
>> > What is the best way to do this?
>> >
>> > Many thanks,
>> >
>> > Andre
>> >
>> >
>> >
>> > --
>> > View this message in context:
>> http://r-sig-geo.2731867.n2.nabble.com/create-rasters-using-pca-components-of-bioclimatic-variables-tp7585158.html
>> > Sent from the R-sig-geo mailing list archive at Nabble.com.
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > [hidden email] <http://user/SendEmail.jtp?type=node&node=7585159&i=1>
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> [hidden email] <http://user/SendEmail.jtp?type=node&node=7585159&i=2>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>> ------------------------------
>>  If you reply to this email, your message will be added to the discussion
>> below:
>>
>> http://r-sig-geo.2731867.n2.nabble.com/create-rasters-using-pca-components-of-bioclimatic-variables-tp7585158p7585159.html
>>  To unsubscribe from create rasters using pca components of bioclimatic
>> variables, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7585158&code=cGludG9kYXNpbHZhLmFAZ21haWwuY29tfDc1ODUxNTh8Nzg5MzY3ODc2>
>> .
>> NAML<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>>
>
>
>
> --
> *Andr? P. Silva*
> PhD Candidate
> Department of Animal Ecology
> Evolutionary Biology Centre
> Uppsala University
> Norbyv?gen 18D
> 752 36 Uppsala
> Sweden
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/create-rasters-using-pca-components-of-bioclimatic-variables-tp7585158p7585160.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From HodgessE at uhd.edu  Sun Nov 24 04:54:03 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 24 Nov 2013 03:54:03 +0000
Subject: [R-sig-Geo] variogram cutoff question
Message-ID: <FF9DB805FC41CC4E95825A50F680630217AC4196@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131124/8c9fb494/attachment.pl>

From HodgessE at uhd.edu  Sun Nov 24 05:00:10 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 24 Nov 2013 04:00:10 +0000
Subject: [R-sig-Geo] variogram cutoff question
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217AC4196@challenger.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F680630217AC4196@challenger.uhd.campus>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217AC41B0@challenger.uhd.campus>

Please ignore the previous....just saw the "help" file.  It's right there.

Sorry for the trouble.

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Hodgess, Erin [HodgessE at uhd.edu]
Sent: Saturday, November 23, 2013 9:54 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] variogram cutoff question

Hello everyone!

I have a quick question, please:  in the variogram function, how is the cutoff determined if it is not specified, please?

Thanks so much!

Sincerely,
Erin


        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Sun Nov 24 05:16:52 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 23 Nov 2013 20:16:52 -0800
Subject: [R-sig-Geo] Clipping a Map
In-Reply-To: <BLU176-W36411E802876D22B08A605A7E00@phx.gbl>
References: <BLU176-W479408E300411D4B9FFEB0A7E60@phx.gbl>
	<1385138212945-7585162.post@n2.nabble.com>
	<BLU176-W3C06C69D62FF6AB5BF17DA7E00@phx.gbl>
	<alpine.LRH.2.03.1311221949290.28643@reclus.nhh.no>
	<BLU176-W36411E802876D22B08A605A7E00@phx.gbl>
Message-ID: <CANtt_hyC8fHC_xu83UAFw2UDKhhypJgZ4wAQxfELuG2RVZaE-w@mail.gmail.com>

Ravi,
I think you can use the crop function in raster (which calls the rgeos
function gIntersect, but also does the necessary attribute
housekeeping):

library(raster)
x <- crop(camapzip_temp, camap_base)

Robert





On Fri, Nov 22, 2013 at 11:31 AM, Ravi Vaid <rvaid at hotmail.com> wrote:
>
>
>
> Dude, You are going way over my head. I think I lost you in the first sentence. Since this is probably a common task that alot of people have to do, can you provide an example of doing this. That would really help. I have a map of western US (camapzip_temp) and I am clipping the California portion of that. The CA (camap_base) portion is just a single polygon. The US map has zip code polygons and data attributes (zip codes) are attached to this map. I know your time is valuable but when ever you have some free time can you proved the modifications that are necessary to the code below. I would really appreciate it. This might be a silly question but why does the gIntersection function not work in this case. Keep in mind I am really new at this. My original attempt is below,
>
> {
> cz_zip <- gIntersects(camapzip_temp,camap_base, byid=TRUE)
> out <- lapply( which(cz_zip) , function(x){ gIntersection( camapzip_temp[x,] , camap_base ) } )
> keep <- sapply(out, class)
> out <- out[keep == "SpatialPolygons"]
> czout <- SpatialPolygons( lapply( 1:length( out ) , function(i) { Pol <- slot(out[[i]], "polygons")[[1]];   slot(Pol, "ID") <- as.character(i)
>                                                                    Pol}))
> }
>
>
>
>
>
>
>
>> Date: Fri, 22 Nov 2013 19:59:53 +0100
>> From: Roger.Bivand at nhh.no
>> To: rvaid at hotmail.com
>> CC: berman.jesse at gmail.com; r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Clipping a Map
>>
>> On Fri, 22 Nov 2013, Ravi Vaid wrote:
>>
>> >
>> > Jesse,
>> >
>> > The clipping of the larger map by a smaller region works perfectly, but the resulting map (the clipped version) has the data component of the SP object missing. I can't merge anything if the data component is not there. I have tried directly using the gintersection function to clip the map but that seems to fail (waited more than 2 hours for the program to run).
>> > When I run the command: slotNames(czout) I should get an object of name "data" along with the other 4 components below
>> > but I only get,
>> > I get: [1] "polygons"    "plotOrder"   "bbox"        "proj4string"So, somehow the "data" object is getting lost. I am fairly new to GIS, I just found the code for clipping on the sig-geo list and tried it and it worked, but the "data" object is missing. I know how to merge data but I just can't figure out how to recover the "data" component of the SP object.
>>
>> No, you get a SpatialPolygons object. Obviously, the intersection will be
>> some subset of your clipped input object, but the function cannot lknow or
>> guess what you want. Suppose that you had a variable in the data slot that
>> was a count of some phenomenon - we don't know what proportion of the
>> count to retain if only part of the geometry is returned. This is clearly
>> up to the user to decide. Use the row.names() of the input and output
>> objects to identify which are which - use the accessor method to retrieve
>> the string values
>>
>> row.names(camapzip_temp)
>> row.names(camap_base)
>>
>> and
>>
>> row.names(cz_zip)
>>
>> which are catenated from the input object row.names.
>>
>> Hope this clarifies,
>>
>> Roger
>>
>> PS. Never, ever, assign directly to the data slot - this almost always
>> creates havoc and confusion by sidestepping checking of row.name values.
>> It's a really great way of randomising your data by accident, but
>> otherwise has no good justification.
>>
>> >
>> > Ravi
>> >
>> >
>> >> Date: Fri, 22 Nov 2013 08:36:52 -0800
>> >> From: berman.jesse at gmail.com
>> >> To: r-sig-geo at r-project.org
>> >> Subject: Re: [R-sig-Geo] Clipping a Map
>> >>
>> >> Hi Ravi,
>> >>
>> >> After performing 'gIntersects' try merging this result to your dataframe,
>> >> then select the TRUE values?
>> >>
>> >> Jesse
>> >>
>> >>  cz_zip <- gIntersects(camapzip_temp,camap_base, byid=TRUE)
>> >> camap_base at data<-cbind(camap_base at data, czip)
>> >> camap2<-camap_base[(camap_base at data[,/???/] %in% c("TRUE)),] # Insert your
>> >> column number for czip in place of ???
>> >>
>> >> plot(camap2)
>> >> head(camap2 at data)
>> >>
>> >>
>> >>
>> >> -----
>> >> --------------------------------------------------------
>> >> Jesse D Berman, PhD
>> >> Yale University
>> >> School of Forestry and Environmental Studies
>> >> Post-Doc Fellow
>> >> --
>> >> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Clipping-a-Map-tp7585156p7585162.html
>> >> Sent from the R-sig-geo mailing list archive at Nabble.com.
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at r-project.org
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> >
>> >
>> >     [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From HodgessE at uhd.edu  Sun Nov 24 06:46:35 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 24 Nov 2013 05:46:35 +0000
Subject: [R-sig-Geo] back with cutoff/variogram question
Message-ID: <FF9DB805FC41CC4E95825A50F680630217AC4226@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131124/af2a4cd9/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sun Nov 24 10:08:34 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 24 Nov 2013 09:08:34 +0000
Subject: [R-sig-Geo] back with cutoff/variogram question
In-Reply-To: <8f967ce289894fbf950fbb02a13e8322@EX-0-HT0.lancs.local>
References: <8f967ce289894fbf950fbb02a13e8322@EX-0-HT0.lancs.local>
Message-ID: <CANVKczM1X-kvPJqAZJK9Ehkdao5BhySCdgRZreKbBx0Q5BM3Lg@mail.gmail.com>

On Sun, Nov 24, 2013 at 5:46 AM, Hodgess, Erin <HodgessE at uhd.edu> wrote:
> Hello again.
>
> I'm back with the variogram question.  Here is the info from the help file:
>
>   cutoff: spatial separation distance up to which point pairs are
>           included in semivariance estimates; as a default, the length
>           of the diagonal of the box spanning the data is divided by
>           three.
>
> By the box spanning the data, does that mean the bounding box, please?  If so, wouldn't that just be 2, please?

 There's quite a few 'variogram' functions in various R packages so it
might help if you told us which one!

 I should think that "the box spanning the data" is indeed the
bounding box. I don't see what you think would be '2' in this case
though, unless the diagonal length of the bounding box happened to be
6.

 For data that included points at (0,0) and (1,1) the diagonal would
have length sqrt(2) and so the cutoff default should be sqrt(2)/3.
Note you have to actually have points at those coordinates and not
just generate 1000 random points in the unit square.

 A few simple experiments with simulated point data sets with various
bounding boxes should confirm this, or you could just look at the
code?

Barry


From HodgessE at uhd.edu  Sun Nov 24 16:53:50 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 24 Nov 2013 15:53:50 +0000
Subject: [R-sig-Geo] back with cutoff/variogram question
In-Reply-To: <CANVKczM1X-kvPJqAZJK9Ehkdao5BhySCdgRZreKbBx0Q5BM3Lg@mail.gmail.com>
References: <8f967ce289894fbf950fbb02a13e8322@EX-0-HT0.lancs.local>,
	<CANVKczM1X-kvPJqAZJK9Ehkdao5BhySCdgRZreKbBx0Q5BM3Lg@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217AC4383@challenger.uhd.campus>

Hi!

This is from the gstat variogram.

I tried to track this down via the vario.c function, but I'm having some trouble with it.

________________________________________
From: b.rowlingson at gmail.com [b.rowlingson at gmail.com] on behalf of Barry Rowlingson [b.rowlingson at lancaster.ac.uk]
Sent: Sunday, November 24, 2013 3:08 AM
To: Hodgess, Erin
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] back with cutoff/variogram question

On Sun, Nov 24, 2013 at 5:46 AM, Hodgess, Erin <HodgessE at uhd.edu> wrote:
> Hello again.
>
> I'm back with the variogram question.  Here is the info from the help file:
>
>   cutoff: spatial separation distance up to which point pairs are
>           included in semivariance estimates; as a default, the length
>           of the diagonal of the box spanning the data is divided by
>           three.
>
> By the box spanning the data, does that mean the bounding box, please?  If so, wouldn't that just be 2, please?

 There's quite a few 'variogram' functions in various R packages so it
might help if you told us which one!

 I should think that "the box spanning the data" is indeed the
bounding box. I don't see what you think would be '2' in this case
though, unless the diagonal length of the bounding box happened to be
6.

 For data that included points at (0,0) and (1,1) the diagonal would
have length sqrt(2) and so the cutoff default should be sqrt(2)/3.
Note you have to actually have points at those coordinates and not
just generate 1000 random points in the unit square.

 A few simple experiments with simulated point data sets with various
bounding boxes should confirm this, or you could just look at the
code?

Barry


From edzer.pebesma at uni-muenster.de  Sun Nov 24 19:39:44 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 24 Nov 2013 19:39:44 +0100
Subject: [R-sig-Geo] back with cutoff/variogram question
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217AC4383@challenger.uhd.campus>
References: <8f967ce289894fbf950fbb02a13e8322@EX-0-HT0.lancs.local>,
	<CANVKczM1X-kvPJqAZJK9Ehkdao5BhySCdgRZreKbBx0Q5BM3Lg@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F680630217AC4383@challenger.uhd.campus>
Message-ID: <529247F0.1060109@uni-muenster.de>

Erin, it is in

https://r-forge.r-project.org/scm/viewvc.php/pkg/src/sem.c?view=markup&root=gstat

file sem.c, line 692

defaults.h defines:

#define DEF_fraction    0.33333 /* fraction of max_dist for def. cutoff */

which is the default value for gl_fraction.

The default number of lag classes is 15 (gl_n_intervals). You can change
these defaults to e.g. 0.5 and 25 by:

variogram(gstat(NULL, "zinc", zinc~1, meuse,
    set=list(fraction=.5,intervals=25)))


On 11/24/2013 04:53 PM, Hodgess, Erin wrote:
> Hi!
> 
> This is from the gstat variogram.
> 
> I tried to track this down via the vario.c function, but I'm having some trouble with it.
> 
> ________________________________________
> From: b.rowlingson at gmail.com [b.rowlingson at gmail.com] on behalf of Barry Rowlingson [b.rowlingson at lancaster.ac.uk]
> Sent: Sunday, November 24, 2013 3:08 AM
> To: Hodgess, Erin
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] back with cutoff/variogram question
> 
> On Sun, Nov 24, 2013 at 5:46 AM, Hodgess, Erin <HodgessE at uhd.edu> wrote:
>> Hello again.
>>
>> I'm back with the variogram question.  Here is the info from the help file:
>>
>>   cutoff: spatial separation distance up to which point pairs are
>>           included in semivariance estimates; as a default, the length
>>           of the diagonal of the box spanning the data is divided by
>>           three.
>>
>> By the box spanning the data, does that mean the bounding box, please?  If so, wouldn't that just be 2, please?
> 
>  There's quite a few 'variogram' functions in various R packages so it
> might help if you told us which one!
> 
>  I should think that "the box spanning the data" is indeed the
> bounding box. I don't see what you think would be '2' in this case
> though, unless the diagonal length of the bounding box happened to be
> 6.
> 
>  For data that included points at (0,0) and (1,1) the diagonal would
> have length sqrt(2) and so the cutoff default should be sqrt(2)/3.
> Note you have to actually have points at those coordinates and not
> just generate 1000 random points in the unit square.
> 
>  A few simple experiments with simulated point data sets with various
> bounding boxes should confirm this, or you could just look at the
> code?
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131124/6716903c/attachment.bin>

From HodgessE at uhd.edu  Sun Nov 24 20:36:26 2013
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 24 Nov 2013 19:36:26 +0000
Subject: [R-sig-Geo] back with cutoff/variogram question
In-Reply-To: <529247F0.1060109@uni-muenster.de>
References: <8f967ce289894fbf950fbb02a13e8322@EX-0-HT0.lancs.local>,
	<CANVKczM1X-kvPJqAZJK9Ehkdao5BhySCdgRZreKbBx0Q5BM3Lg@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F680630217AC4383@challenger.uhd.campus>,
	<529247F0.1060109@uni-muenster.de>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217AC44E7@challenger.uhd.campus>

This is perfect!  Thank you!
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Edzer Pebesma [edzer.pebesma at uni-muenster.de]
Sent: Sunday, November 24, 2013 12:39 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] back with cutoff/variogram question

Erin, it is in

https://r-forge.r-project.org/scm/viewvc.php/pkg/src/sem.c?view=markup&root=gstat

file sem.c, line 692

defaults.h defines:

#define DEF_fraction    0.33333 /* fraction of max_dist for def. cutoff */

which is the default value for gl_fraction.

The default number of lag classes is 15 (gl_n_intervals). You can change
these defaults to e.g. 0.5 and 25 by:

variogram(gstat(NULL, "zinc", zinc~1, meuse,
    set=list(fraction=.5,intervals=25)))


On 11/24/2013 04:53 PM, Hodgess, Erin wrote:
> Hi!
>
> This is from the gstat variogram.
>
> I tried to track this down via the vario.c function, but I'm having some trouble with it.
>
> ________________________________________
> From: b.rowlingson at gmail.com [b.rowlingson at gmail.com] on behalf of Barry Rowlingson [b.rowlingson at lancaster.ac.uk]
> Sent: Sunday, November 24, 2013 3:08 AM
> To: Hodgess, Erin
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] back with cutoff/variogram question
>
> On Sun, Nov 24, 2013 at 5:46 AM, Hodgess, Erin <HodgessE at uhd.edu> wrote:
>> Hello again.
>>
>> I'm back with the variogram question.  Here is the info from the help file:
>>
>>   cutoff: spatial separation distance up to which point pairs are
>>           included in semivariance estimates; as a default, the length
>>           of the diagonal of the box spanning the data is divided by
>>           three.
>>
>> By the box spanning the data, does that mean the bounding box, please?  If so, wouldn't that just be 2, please?
>
>  There's quite a few 'variogram' functions in various R packages so it
> might help if you told us which one!
>
>  I should think that "the box spanning the data" is indeed the
> bounding box. I don't see what you think would be '2' in this case
> though, unless the diagonal length of the bounding box happened to be
> 6.
>
>  For data that included points at (0,0) and (1,1) the diagonal would
> have length sqrt(2) and so the cutoff default should be sqrt(2)/3.
> Note you have to actually have points at those coordinates and not
> just generate 1000 random points in the unit square.
>
>  A few simple experiments with simulated point data sets with various
> bounding boxes should confirm this, or you could just look at the
> code?
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795



From Roger.Bivand at nhh.no  Mon Nov 25 13:31:02 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 25 Nov 2013 13:31:02 +0100
Subject: [R-sig-Geo] Spatial Regression Eigenwert-Matrix
In-Reply-To: <0175A702-98FA-40E4-A1F1-601F9D4BDADD@wuestundpartner.com>
References: <0175A702-98FA-40E4-A1F1-601F9D4BDADD@wuestundpartner.com>
Message-ID: <alpine.LRH.2.03.1311251308170.19133@reclus.nhh.no>

On Fri, 22 Nov 2013, Jacqueline Schweizer wrote:

>
>
> Hello everybody,
>
> I am trying to test my model (lm) in a spatial regression model. I have 
> already done the moran I test and found, that due to the spatial 
> correlation it would be wise to try a spatial regression model. When I 
> try to do the eigenwert-matrix or the spatial lag model, i get the 
> following error:
>

You did not provide the output of sessionInfo(), but I assume that you are 
using 32-bit Windows. On 64-bit Linux, the error message is:

> oo <- matrix(0, nrow = n, ncol = n)
Error: cannot allocate vector of size 36.5 Gb

You also omitted to report the output of traceback() run after the error 
occurred, so it isn't obvious where this happens

The underlying question is why you want to try to do something that is 
hard (handling large dense matrices), when easier alternatives are 
provided in the same model-fitting function you are using. If you look at 
the help page for lagsarlm(), you'll see that for your intrinsically 
asymmetric weights (k-nearest neighbours are almost always asymmetric), 
your choices for an exact fit are method="eigen" and method="LU", and 
"eigen" presumes moderate n (say < 5000 in most cases).

"LU" provides the same numerical result as "eigen", but is not limited to 
moderate n, because it uses a sparse representation of W; for large n it 
will take some time. Analytical standard errors are not available for 
"LU", with values based on the numerical Hessian returned - you may wish 
to pass the traces of the power series of W to lagsarlm() to improve the 
numerical Hessian values. See Lesage & Pace (2009) and Bivand, Hauke & 
Kossowski (2013) for details.

There are further possibilities for approximations, also described in 
?do_ldet.

Note that the output coefficients of lagsarlm() cannot be interpreted, so 
you will also need to use impacts() to get to something you can use.

Hope this helps,

Roger

>
> #-------------------------------------------------------------
> Fehler in matrix(0, nrow = n, ncol = n) : zu viele Elemente angegeben
> #-------------------------------------------------------------
> -> English: to many elements specified
>
>
> I have a dataset of about 70'000 points. Is it possible that this is too much for the eigenwert-matrix? I use library (spdep)
>
> Here's my code:
>
> #-------------------------------------------------------------
> # Get coordinates
> d.angeb.efh.sub2$residuals <- reg.lm.bereinigt2$residuals
>
> crds 		<- as.matrix(d.angeb.efh.sub2[, c("LON1903","LAT1903")])
>
> t.neig 		<- knn2nb(knearneigh(crds, k=4, longlat=FALSE))
>
>
> # Weights-Matrix (W = row-standardized)
> n.listw.obj 	<- nb2listw(t.neig, style="W")
>
> # Moran's I Test
> moran.test(reg.lm.bereinigt2$residuals, listw=n.listw.obj, alternative="two.sided", na.action=na.exclude,
> 			zero.policy=TRUE)
>
> # Spatial Lag Model
> mod.lag.eig 			<- lagsarlm(log(VPREIS) 									~
> 							as.factor(ALTER.CL2)								+
> 							as.factor(ZIMMERK)								+
> 							log(FLAE)										+
> 							log(FLAE):as.factor(ZIMMERK)	,
> 							data=d.angeb.efh.sub2,
> 							n.listw.obj, method="eigen",
> 							quiet=FALSE)
>
> # Fehler in matrix(0, nrow = n, ncol = n) : zu viele Elemente angegeben
> #-------------------------------------------------------------
>
>
>
> Does anyone have a tip how to handle bigger datasets or am I missing something and focusing on the wrong problem?
>
> Thanks for the help,
> Jacqueline
>
> Disclaimer\ \ Die in dieser E-Mail enthaltenen Informati...{{dropped:27}}
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Nov 25 13:39:01 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 25 Nov 2013 13:39:01 +0100
Subject: [R-sig-Geo] Spatial Regression Eigenwert-Matrix
In-Reply-To: <0175A702-98FA-40E4-A1F1-601F9D4BDADD@wuestundpartner.com>
References: <0175A702-98FA-40E4-A1F1-601F9D4BDADD@wuestundpartner.com>
Message-ID: <alpine.LRH.2.03.1311251334420.19133@reclus.nhh.no>

On Fri, 22 Nov 2013, Jacqueline Schweizer wrote:

>
> # Moran's I Test
> moran.test(reg.lm.bereinigt2$residuals, listw=n.listw.obj, alternative="two.sided", na.action=na.exclude,
> 			zero.policy=TRUE)
>

... and *NEVER* run Moran's I on regression residuals with moran.test(), 
always use lm.morantest() on the fitted model object. The expectation and 
variance of I are defined differently in the two tests, the difference has 
been know about for at least 40 years.

Roger

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jon.skoien at jrc.ec.europa.eu  Mon Nov 25 15:41:32 2013
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Mon, 25 Nov 2013 15:41:32 +0100
Subject: [R-sig-Geo] Intamap, reduce verbose output of idw method
In-Reply-To: <CAGFWpktq+b0tARuGFGN3=QaUt9AG43Jm_9ZnCgJ8e1igZHNZJA@mail.gmail.com>
References: <CAGFWpktq+b0tARuGFGN3=QaUt9AG43Jm_9ZnCgJ8e1igZHNZJA@mail.gmail.com>
Message-ID: <5293619C.80308@jrc.ec.europa.eu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131125/3ab9a1e7/attachment.pl>

From brian.buma at uas.alaska.edu  Mon Nov 25 16:49:29 2013
From: brian.buma at uas.alaska.edu (Brian Buma)
Date: Mon, 25 Nov 2013 06:49:29 -0900
Subject: [R-sig-Geo] Extract cell numbers from raster based on condition
In-Reply-To: <52910192.5010403@gmail.com>
References: <CAM25M7pvdxRpJ85S-_Jds5ct77DqQH00_biFGNzdn7OCwpTH4g@mail.gmail.com>
	<CAHT1vpgU=mZr=wocyW99_NWUyTc3cWWEQa7jCZJymdXrxJ0yfQ@mail.gmail.com>
	<CAM25M7prpwKNF75KsFVLRopw_ZE3q=VgsFydOJU-a=1ywdQrBw@mail.gmail.com>
	<52910192.5010403@gmail.com>
Message-ID: <CAM25M7o40uasR+WX_j9iVZK-P=M2ZRg-tMwDU_zhoHeEfhDJbg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131125/59b42e49/attachment.pl>

From horning at amnh.org  Mon Nov 25 18:42:47 2013
From: horning at amnh.org (Ned Horning)
Date: Mon, 25 Nov 2013 12:42:47 -0500
Subject: [R-sig-Geo] Problem with cell numbers when using a raster extent
	object
Message-ID: <52938C17.6070906@amnh.org>

Hi -

I have a script that calculates a common extent between two images than 
then uses the resulting extent to restrict the random selection of cells 
from a raster using the ?sampleRandom? function. I use the following 
function:

sampleCells <- sampleRandom(predImage, size=numSamps, cells=TRUE, 
extent=commonExt)[,1]

Next I use "xyFromCell(predImage, sampleCells[i])" to calculate the 
coordinates of the center of a cell and all of the cell centers fall 
outside of the extent that I am using. Using "sp=TRUE" I get a similar 
result - all of the points are outside of the extent:

sampleCells <- sampleRandom(predImage, size=numSamps, sp=TRUE, 
ext=commonExt)

To get around this problem I tried to physically clip the image before 
running ?sampleRandom? and the results are similar. The following line 
also produces cells that are outside of the extent ?commonExt? when I 
use ?xyFromCell?:

sampleCells <- sampleRandom(crop(predImage,commonExt), size=numSamps, 
ext=commonExt, na.rm=TRUE)

However, if I run the following line using"clip" and "sp=TRUE" the 
sample points fall within the extent:

sampleCells <- sampleRandom(crop(predImage,commonExt), size=numSamps, 
sp=TRUE, ext=commonExt, na.rm=TRUE)

So, there is a work-around but I'd prefer not to have the overhead of 
clipping the image.

This seems somewhat similar to a problem I reported a few months ago and 
was fixed. Can anyone replicate this problem? Am I doing something wrong?

I am using R version: 3.0.2 and Raster package version: 2.1-49 on Ubuntu 
12.04 64 bit

Ned


From r.hijmans at gmail.com  Mon Nov 25 18:50:48 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 25 Nov 2013 09:50:48 -0800
Subject: [R-sig-Geo] Extract cell numbers from raster based on condition
In-Reply-To: <CAM25M7o40uasR+WX_j9iVZK-P=M2ZRg-tMwDU_zhoHeEfhDJbg@mail.gmail.com>
References: <CAM25M7pvdxRpJ85S-_Jds5ct77DqQH00_biFGNzdn7OCwpTH4g@mail.gmail.com>
	<CAHT1vpgU=mZr=wocyW99_NWUyTc3cWWEQa7jCZJymdXrxJ0yfQ@mail.gmail.com>
	<CAM25M7prpwKNF75KsFVLRopw_ZE3q=VgsFydOJU-a=1ywdQrBw@mail.gmail.com>
	<52910192.5010403@gmail.com>
	<CAM25M7o40uasR+WX_j9iVZK-P=M2ZRg-tMwDU_zhoHeEfhDJbg@mail.gmail.com>
Message-ID: <CANtt_hyks5QVToij9ROyz9ry1KrYEMwFJ-kAWix-QJCtw4jS0Q@mail.gmail.com>

Brian,

Andrew's approach works, but you really should not do it that way. It
is inefficient due to the use of extract. Rather than extract(x,
1:ncell(x) you could do the much more direct values(x). The code could
also lead to an error due to memory limitations whereas the other two
approaches (Which or rasterToPoints) might work for the same data (if
there are relatively many NA values).

Andrew improved the original   ras[ras[] > 50] <- NA  to the much
better  ras[ras > 50] <- NA ; again because that will work with large
files, but reclassify(ras,  cbind(50, Inf, NA)) would be my
preference. I understand that you may only use relatively small files,
but as the archives of this mailing list are a resource for many, I am
compelled to explain this such that others won't get into trouble.

(The next questions is whether you actually need to extract cell
numbers for what you want to accomplish (this is often done but rarely
needed) ---- but that is not the topic of your post)

Robert

On Mon, Nov 25, 2013 at 7:49 AM, Brian Buma <brian.buma at uas.alaska.edu> wrote:
> Thanks Andrew, this works.  I appreciate it.
>
> -brian
>
>
>
> On Sat, Nov 23, 2013 at 10:27 AM, Andrew Vitale <vitale232 at gmail.com> wrote:
>
>>  Brian,
>>
>> This works, but it will use memory.  I guess it depends just how big that
>> DEM is...
>>
>> -Andrew
>>
>>
>> library(raster)
>>
>> ras <- raster(ncols=10,nrows=10)
>> ras[] <- 1:100
>>
>> #now I want to get the cell numbers for cells > 50.  I don't see a good way
>> #to do it.
>>
>> #An attempt with spatial points doesn't work:
>>
>> ras[ras<50] <- NA
>> temp <- extract(ras, 1:ncell(ras), df = TRUE)
>>
>> cells <- temp$ID[which(!is.na(temp$layer))]
>>
>>
>>  On 11/23/2013 10:48 AM, Brian Buma wrote:
>>
>> Thanks, but that does not do what I need.  As in my example, that just
>> reclasses the raster, it doesn't return the cell numbers for the non-NA
>> portions of the raster.  Calling SpatialPoints on the raster with NA
>> likewise does not return the non-NA cells only.
>>
>>
>>
>>
>> On Fri, Nov 22, 2013 at 11:51 PM, Roman Lu?trik <roman.lustrik at gmail.com> <roman.lustrik at gmail.com>wrote:
>>
>>
>>  Try this.
>>
>> library(raster)
>> ras <- raster(ncols=10,nrows=10)
>> ras[] <- 1:100
>>
>> par(mfrow = c(1, 2))
>> plot(ras)
>> ras[ras[] > 50] <- NA
>> plot(ras)
>>
>>
>> Cheers,
>> Roman
>>
>>
>>
>>
>> On Sat, Nov 23, 2013 at 7:58 AM, Brian Buma <brian.buma at uas.alaska.edu> <brian.buma at uas.alaska.edu>wrote:
>>
>>
>>  Hello all,
>>
>> I'm trying to extract the cell numbers from a raster in R based on a
>> logical.  For example:
>>
>>
>> ras <- raster(ncols=10,nrows=10)
>> ras[] <- 1:100
>>
>> #now I want to get the cell numbers for cells > 50.  I don't see a good
>> way
>> to do it.
>> #An attempt with spatial points doesn't work:
>>
>> temp <- SpatialPoints(ras>50)
>> out <- cellFromXY(ras,temp)
>>
>> #nor does reclassing the raster
>> ras[ras<50] <- NA
>>
>>
>> I hope this isn't an obvious question, but I'm just not seeing it.  For
>> what it's worth, I'm analyzing a large DEM and want to skip elevations
>> that
>> equal zero, rather than process those as well as the rest.  The current
>> code is quite efficient (no for loops, vectorized) but the dataset is so
>> large it takes a while.  The process runs off of cell numbers (currently
>> running all the cells), so if I could not analyze those cell numbers at
>> all, so much the better.
>>
>> Thanks.  I imagine there's a simple, elegant solution I'm just not seeing
>> for some reason.
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing listR-sig-Geo at r-project.orghttps://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>  --
>> In God we trust, all others bring data.
>>
>>
>>       [[alternative HTML version deleted]]
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing listR-sig-Geo at r-project.orghttps://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>> --
>> Andrew Vitale
>> Master's Student
>> Department of Geography
>> University of Nevada, Renovitale232 at gmail.com
>>
>>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Mon Nov 25 19:04:10 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 25 Nov 2013 10:04:10 -0800
Subject: [R-sig-Geo] Problem with cell numbers when using a raster
	extent object
In-Reply-To: <52938C17.6070906@amnh.org>
References: <52938C17.6070906@amnh.org>
Message-ID: <CANtt_hzcZx8X1zyKSpkWetwKbOYn4D3w2FaWJyn9LB__Cc391w@mail.gmail.com>

Ned,

Hard to see what does not work here. Perhaps it is just the [i] in
xyFromCell(predImage, sampleCells[i])?
Can you please provide a self-contained example, perhaps based on the below?

library(raster)
r <- raster(system.file("external/rlogo.grd", package="raster"))
e <- extent(r) + 100
s <- sampleRandom(r, size=100, cells=TRUE, extent=e)[,1]
xy <- xyFromCell(r, s)

plot(e)
plot(r, add=T, legend=F)
points(xy)



On Mon, Nov 25, 2013 at 9:42 AM, Ned Horning <horning at amnh.org> wrote:
> Hi -
>
> I have a script that calculates a common extent between two images than then
> uses the resulting extent to restrict the random selection of cells from a
> raster using the ?sampleRandom? function. I use the following function:
>
> sampleCells <- sampleRandom(predImage, size=numSamps, cells=TRUE,
> extent=commonExt)[,1]
>
> Next I use "xyFromCell(predImage, sampleCells[i])" to calculate the
> coordinates of the center of a cell and all of the cell centers fall outside
> of the extent that I am using. Using "sp=TRUE" I get a similar result - all
> of the points are outside of the extent:
>
> sampleCells <- sampleRandom(predImage, size=numSamps, sp=TRUE,
> ext=commonExt)
>
> To get around this problem I tried to physically clip the image before
> running ?sampleRandom? and the results are similar. The following line also
> produces cells that are outside of the extent ?commonExt? when I use
> ?xyFromCell?:
>
> sampleCells <- sampleRandom(crop(predImage,commonExt), size=numSamps,
> ext=commonExt, na.rm=TRUE)
>
> However, if I run the following line using"clip" and "sp=TRUE" the sample
> points fall within the extent:
>
> sampleCells <- sampleRandom(crop(predImage,commonExt), size=numSamps,
> sp=TRUE, ext=commonExt, na.rm=TRUE)
>
> So, there is a work-around but I'd prefer not to have the overhead of
> clipping the image.
>
> This seems somewhat similar to a problem I reported a few months ago and was
> fixed. Can anyone replicate this problem? Am I doing something wrong?
>
> I am using R version: 3.0.2 and Raster package version: 2.1-49 on Ubuntu
> 12.04 64 bit
>
> Ned
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From vitale232 at gmail.com  Mon Nov 25 19:12:59 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Mon, 25 Nov 2013 10:12:59 -0800
Subject: [R-sig-Geo] Problem with cell numbers when using a raster
	extent object
In-Reply-To: <CANtt_hzcZx8X1zyKSpkWetwKbOYn4D3w2FaWJyn9LB__Cc391w@mail.gmail.com>
References: <52938C17.6070906@amnh.org>
	<CANtt_hzcZx8X1zyKSpkWetwKbOYn4D3w2FaWJyn9LB__Cc391w@mail.gmail.com>
Message-ID: <CAFTcopd-ed_GPWq5t368PA+iv2DY73hzH7Br6f2OLsKRozTrDQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131125/64a2884e/attachment.pl>

From horning at amnh.org  Mon Nov 25 20:28:38 2013
From: horning at amnh.org (Ned Horning)
Date: Mon, 25 Nov 2013 14:28:38 -0500
Subject: [R-sig-Geo] Problem with cell numbers when using a raster
 extent object
In-Reply-To: <CANtt_hzcZx8X1zyKSpkWetwKbOYn4D3w2FaWJyn9LB__Cc391w@mail.gmail.com>
References: <52938C17.6070906@amnh.org>
	<CANtt_hzcZx8X1zyKSpkWetwKbOYn4D3w2FaWJyn9LB__Cc391w@mail.gmail.com>
Message-ID: <5293A4E6.5010408@amnh.org>

Robert,

Here are examples of the two versions.

### This one does not select points within the extent ###

library(raster)
crs_predImage <- CRS("+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs 
+ellps=WGS84 +towgs84=0,0,0")
predImage <- raster(nrows=7561, ncols=8521, xmn=240585, xmx=496215, 
ymn=5297985, ymx=5524815)
projection(predImage) <- crs_predImage
predImage[] <- 1

commonExt <- extent(366760.6 , 425233.5, 5396052, 5450158)

sampleCells <- sampleRandom(predImage, size=20, sp=TRUE, extent=commonExt)

plot(predImage)
plot(commonExt, add=T)
plot(sampleCells, add=T)


### This one does work ###

library(raster)
crs_predImage <- CRS("+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs 
+ellps=WGS84 +towgs84=0,0,0")
predImage <- raster(nrows=7561, ncols=8521, xmn=240585, xmx=496215, 
ymn=5297985, ymx=5524815)
projection(predImage) <- crs_predImage
predImage[] <- 1

commonExt <- extent(366760.6 , 425233.5, 5396052, 5450158)

sampleCells <- sampleRandom(crop(predImage,commonExt), size=20, sp=TRUE, 
ext=commonExt, na.rm=TRUE)

plot(predImage)
plot(commonExt, add=T)
plot(sampleCells, add=T)


On 11/25/2013 01:04 PM, Robert J. Hijmans wrote:
> Ned,
>
> Hard to see what does not work here. Perhaps it is just the [i] in
> xyFromCell(predImage, sampleCells[i])?
> Can you please provide a self-contained example, perhaps based on the below?
>
> library(raster)
> r <- raster(system.file("external/rlogo.grd", package="raster"))
> e <- extent(r) + 100
> s <- sampleRandom(r, size=100, cells=TRUE, extent=e)[,1]
> xy <- xyFromCell(r, s)
>
> plot(e)
> plot(r, add=T, legend=F)
> points(xy)
>
>
>
> On Mon, Nov 25, 2013 at 9:42 AM, Ned Horning <horning at amnh.org> wrote:
>> Hi -
>>
>> I have a script that calculates a common extent between two images than then
>> uses the resulting extent to restrict the random selection of cells from a
>> raster using the ?sampleRandom? function. I use the following function:
>>
>> sampleCells <- sampleRandom(predImage, size=numSamps, cells=TRUE,
>> extent=commonExt)[,1]
>>
>> Next I use "xyFromCell(predImage, sampleCells[i])" to calculate the
>> coordinates of the center of a cell and all of the cell centers fall outside
>> of the extent that I am using. Using "sp=TRUE" I get a similar result - all
>> of the points are outside of the extent:
>>
>> sampleCells <- sampleRandom(predImage, size=numSamps, sp=TRUE,
>> ext=commonExt)
>>
>> To get around this problem I tried to physically clip the image before
>> running ?sampleRandom? and the results are similar. The following line also
>> produces cells that are outside of the extent ?commonExt? when I use
>> ?xyFromCell?:
>>
>> sampleCells <- sampleRandom(crop(predImage,commonExt), size=numSamps,
>> ext=commonExt, na.rm=TRUE)
>>
>> However, if I run the following line using"clip" and "sp=TRUE" the sample
>> points fall within the extent:
>>
>> sampleCells <- sampleRandom(crop(predImage,commonExt), size=numSamps,
>> sp=TRUE, ext=commonExt, na.rm=TRUE)
>>
>> So, there is a work-around but I'd prefer not to have the overhead of
>> clipping the image.
>>
>> This seems somewhat similar to a problem I reported a few months ago and was
>> fixed. Can anyone replicate this problem? Am I doing something wrong?
>>
>> I am using R version: 3.0.2 and Raster package version: 2.1-49 on Ubuntu
>> 12.04 64 bit
>>
>> Ned
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ldecola at comcast.net  Mon Nov 25 22:15:25 2013
From: ldecola at comcast.net (ldecola at comcast.net)
Date: Mon, 25 Nov 2013 21:15:25 +0000 (UTC)
Subject: [R-sig-Geo] grid overlay on polylines
In-Reply-To: <73022115.634675.1385408457741.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
Message-ID: <1595292952.637166.1385414125479.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131125/2d2b57ec/attachment.pl>

From r.hijmans at gmail.com  Mon Nov 25 22:40:57 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 25 Nov 2013 13:40:57 -0800
Subject: [R-sig-Geo] Problem with cell numbers when using a raster
	extent object
In-Reply-To: <5293A4E6.5010408@amnh.org>
References: <52938C17.6070906@amnh.org>
	<CANtt_hzcZx8X1zyKSpkWetwKbOYn4D3w2FaWJyn9LB__Cc391w@mail.gmail.com>
	<5293A4E6.5010408@amnh.org>
Message-ID: <CANtt_hzeVowUMU6-zmrB1dKvW5H4o8S6=stK0CHUHoBb08fdZg@mail.gmail.com>

Ned, that's a bug that only occurred with large rasters (than are not
processed in one chunk). This has been fixed for version 2.1-71
Note that Andrew correctly pointed out that in any case it should be
"ext=commonExt", not "extent=commonExt".
Thanks for the helpful example. Best, Robert

On Mon, Nov 25, 2013 at 11:28 AM, Ned Horning <horning at amnh.org> wrote:
> Robert,
>
> Here are examples of the two versions.
>
> ### This one does not select points within the extent ###
>
> library(raster)
> crs_predImage <- CRS("+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0")
> predImage <- raster(nrows=7561, ncols=8521, xmn=240585, xmx=496215,
> ymn=5297985, ymx=5524815)
> projection(predImage) <- crs_predImage
> predImage[] <- 1
>
> commonExt <- extent(366760.6 , 425233.5, 5396052, 5450158)
>
> sampleCells <- sampleRandom(predImage, size=20, sp=TRUE, extent=commonExt)
>
> plot(predImage)
> plot(commonExt, add=T)
> plot(sampleCells, add=T)
>
>
> ### This one does work ###
>
> library(raster)
> crs_predImage <- CRS("+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0")
> predImage <- raster(nrows=7561, ncols=8521, xmn=240585, xmx=496215,
> ymn=5297985, ymx=5524815)
> projection(predImage) <- crs_predImage
> predImage[] <- 1
>
> commonExt <- extent(366760.6 , 425233.5, 5396052, 5450158)
>
> sampleCells <- sampleRandom(crop(predImage,commonExt), size=20, sp=TRUE,
> ext=commonExt, na.rm=TRUE)
>
> plot(predImage)
> plot(commonExt, add=T)
> plot(sampleCells, add=T)
>
>
>
> On 11/25/2013 01:04 PM, Robert J. Hijmans wrote:
>>
>> Ned,
>>
>> Hard to see what does not work here. Perhaps it is just the [i] in
>> xyFromCell(predImage, sampleCells[i])?
>> Can you please provide a self-contained example, perhaps based on the
>> below?
>>
>> library(raster)
>> r <- raster(system.file("external/rlogo.grd", package="raster"))
>> e <- extent(r) + 100
>> s <- sampleRandom(r, size=100, cells=TRUE, extent=e)[,1]
>> xy <- xyFromCell(r, s)
>>
>> plot(e)
>> plot(r, add=T, legend=F)
>> points(xy)
>>
>>
>>
>> On Mon, Nov 25, 2013 at 9:42 AM, Ned Horning <horning at amnh.org> wrote:
>>>
>>> Hi -
>>>
>>> I have a script that calculates a common extent between two images than
>>> then
>>> uses the resulting extent to restrict the random selection of cells from
>>> a
>>> raster using the ?sampleRandom? function. I use the following function:
>>>
>>> sampleCells <- sampleRandom(predImage, size=numSamps, cells=TRUE,
>>> extent=commonExt)[,1]
>>>
>>> Next I use "xyFromCell(predImage, sampleCells[i])" to calculate the
>>> coordinates of the center of a cell and all of the cell centers fall
>>> outside
>>> of the extent that I am using. Using "sp=TRUE" I get a similar result -
>>> all
>>> of the points are outside of the extent:
>>>
>>> sampleCells <- sampleRandom(predImage, size=numSamps, sp=TRUE,
>>> ext=commonExt)
>>>
>>> To get around this problem I tried to physically clip the image before
>>> running ?sampleRandom? and the results are similar. The following line
>>> also
>>> produces cells that are outside of the extent ?commonExt? when I use
>>> ?xyFromCell?:
>>>
>>> sampleCells <- sampleRandom(crop(predImage,commonExt), size=numSamps,
>>> ext=commonExt, na.rm=TRUE)
>>>
>>> However, if I run the following line using"clip" and "sp=TRUE" the sample
>>> points fall within the extent:
>>>
>>> sampleCells <- sampleRandom(crop(predImage,commonExt), size=numSamps,
>>> sp=TRUE, ext=commonExt, na.rm=TRUE)
>>>
>>> So, there is a work-around but I'd prefer not to have the overhead of
>>> clipping the image.
>>>
>>> This seems somewhat similar to a problem I reported a few months ago and
>>> was
>>> fixed. Can anyone replicate this problem? Am I doing something wrong?
>>>
>>> I am using R version: 3.0.2 and Raster package version: 2.1-49 on Ubuntu
>>> 12.04 64 bit
>>>
>>> Ned
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From r.hijmans at gmail.com  Mon Nov 25 22:43:32 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 25 Nov 2013 13:43:32 -0800
Subject: [R-sig-Geo] grid overlay on polylines
In-Reply-To: <1595292952.637166.1385414125479.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
References: <73022115.634675.1385408457741.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
	<1595292952.637166.1385414125479.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
Message-ID: <CANtt_hwHP1+fzM02SRFvTqcvS+G0BVMFoYRCFMrR1TuN3m=0QA@mail.gmail.com>

Lee,
What are you trying the accomplish with this "overlay"? If you want to
do a spatial query (extract grid cell values covered by the line), you
can use raster::extract. If you want to rasterize (create a raster
where the cells covered by the line get a particular value), you can
use raster::rasterize.
Robert

On Mon, Nov 25, 2013 at 1:15 PM,  <ldecola at comcast.net> wrote:
>
> i'm trying to overlay a grid on a SpatialLines object but over() doesn't work, even if i load rgeos...
> --------
> library(sp)
> library(rgeos)
>
> # SPATIAL LINES OBJECT
> tmp_sl <- SpatialLines(
> list(
> Lines(
> list(
> Line(matrix(c(0, 1, 1, 0, 0, 1), 3))
> ),
> ID = 'a'
> )
> )
> )
> plot(tmp_sl, axes = T, col = 'red', lwd = 4)
>
> # SPATIAL GRID TO COVER IT
> res <- 2^-3
> tmp_grd <- SpatialGrid(
> GridTopology(
> bbox(tmp_sl)[, 'min'],
> rep(res, 2),
> round(apply(bbox(tmp_sl), 1, diff) / res + 1)
> )
> )
> plot(tmp_grd, add = T)
>
> # DOESN'T WORK...
> over(tmp_grd, tmp_sl)
> # *** END ***
> --------
>
>
> Lee De Cola, PhD, MCP.
> DATA to Insight
> LDECOLA at COMCAST.NET
> Reston, Virginia
> 703 709 6972
> 571 315 0577 mobile
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From arudolph at PIRE.org  Tue Nov 26 00:37:12 2013
From: arudolph at PIRE.org (Abby Rudolph)
Date: Mon, 25 Nov 2013 23:37:12 +0000
Subject: [R-sig-Geo] Altering Quadrat count plot specifications
Message-ID: <E8BCE61EEF4C354CA43F97C7B4B21FDA014C21@MAIL-01.PIRE.org>

I am able to calculate and plot the quadrat counts for my cases and controls, however, the background of the map is by default colored with blue at the top and peach at the bottom.  Is there a way to change the default coloring scheme of the plot background (e.g., the area of the shapefile window) to either be blank or to reflect the coloring scheme in the spatial intensity maps produced with density?

Second, I was also hoping to create a map where quadrats with cases but no controls were one color, quadrats with controls but not cases were a second color, quadrats with cases and controls were a third color and quadrats with no cases and no controls were a fourth color.  Is this possible?  Right now, I subtracted qcases from qcontrols, so I can plot this difference (however, it is misleading due to the zeros).  I can also quantitatively tell how many regions fall into these categories.  For example cases_but_not_controls<-sum(qcases&!qcontrols)
Of 60 quadrats, 4 have cases but not controls, 6 have controls but not case, 11 have both, and 40 have neither.
Any assistance would be greatly appreciated!

Thanks in advance!


From oliveirajc at ufv.br  Tue Nov 26 13:39:31 2013
From: oliveirajc at ufv.br (julio cesar oliveira)
Date: Tue, 26 Nov 2013 10:39:31 -0200
Subject: [R-sig-Geo] Spatio-temporal geostatistics with Raster stack
Message-ID: <CAG+u5go=guag-4xuxh_eURAfGw4tSoQnYm+QV4fxH-DBgXKr4Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131126/e015c9e4/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Nov 26 15:34:45 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 26 Nov 2013 15:34:45 +0100
Subject: [R-sig-Geo] Spatio-temporal geostatistics with Raster stack
In-Reply-To: <CAG+u5go=guag-4xuxh_eURAfGw4tSoQnYm+QV4fxH-DBgXKr4Q@mail.gmail.com>
References: <CAG+u5go=guag-4xuxh_eURAfGw4tSoQnYm+QV4fxH-DBgXKr4Q@mail.gmail.com>
Message-ID: <5294B185.4000707@uni-muenster.de>

library(spacetime)
EVI.st = as(EVI, "STFDF")
# This requires that the layers in your EVI have time stamps.

library(gstat)
vignette("st")

Having said this, you may well run into problems with memory or
computation time, or both -- I haven't run tests with data this large,
and would be interested to hear from you also if it doesn't work.

On 11/26/2013 01:39 PM, julio cesar oliveira wrote:
> Hi,
> 
> I have a raster stack with 250 layers, and i would like to Fitt a
> spatio-temporal variogram model.
> 
> How to convert the data for analysis?
> 
> 
>> EVI
> class       : RasterBrick
> dimensions  : 476, 336, 159936, 250  (nrow, ncol, ncell, nlayers)
> resolution  : 250, 250  (x, y)
> extent      : 607868.3, 691868.3, 8421531, 8540531  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=utm +zone=21 +south +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0
> data source : in memory
> names       : MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI,
> MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI,
> MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI,
> MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI,
> MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI, MOD13Q1.A//6_days_EVI,
> MOD13Q1.A//6_days_EVI, ...
> 
> 
> 
> Regards,
> 
> Julio
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795


From anne.relun at cirad.fr  Tue Nov 26 16:27:45 2013
From: anne.relun at cirad.fr (Anne RELUN)
Date: Tue, 26 Nov 2013 16:27:45 +0100 (CET)
Subject: [R-sig-Geo] Package dismo 0.9-1;
 empty plot window with gmap() and plot() functions
In-Reply-To: <1433868396.5021233.1385478726230.JavaMail.root@cirad.fr>
Message-ID: <1564391409.5032290.1385479664964.JavaMail.root@cirad.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131126/66a06f36/attachment.pl>

From eddieatr at gmail.com  Tue Nov 26 19:11:56 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Tue, 26 Nov 2013 18:11:56 +0000
Subject: [R-sig-Geo] How to extract standard error,
 r-squared for a linear model in rasterstack?
In-Reply-To: <CANtt_hzpsFF3-kaZ7Dr5YWHJSZtZJhbPp0_=9eikfEFjZ3Ytjg@mail.gmail.com>
References: <CABaJH78xP1kF_zzk6Qgb+3x9R5KdMfV9qLY7vZeuaKMxA0YRYQ@mail.gmail.com>
	<CANtt_hzpsFF3-kaZ7Dr5YWHJSZtZJhbPp0_=9eikfEFjZ3Ytjg@mail.gmail.com>
Message-ID: <CABaJH786X-ut=K4Mbzc67wDkQ+4cVaxVYuEXFFk6TgKpHjemvQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131126/04e58826/attachment.pl>

From Roger.Bivand at nhh.no  Tue Nov 26 20:52:45 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 26 Nov 2013 20:52:45 +0100
Subject: [R-sig-Geo] CRAN Windows binaries: rgdal and rgeos
Message-ID: <alpine.LRH.2.03.1311262032570.32418@reclus.nhh.no>

Thanks to the continuing support of Brian Ripley and Uwe Ligges, the rgdal 
CRAN Windows binary package now static links to the GDAL 1.10.1 and PROJ.4 
4.8.0 libraries, and the rgeos binary package static links to GEOS 3.4.2. 
These are the latest releases, and should provide extra features and bug 
fixes. Note that EPSG projection definitions have also been updated, so 
please be aware that there may be changes from earlier versions, 
correcting earlier inaccuracies. To track changes in the versions of EPSG 
included, see the GDAL and PROJ.4 release notes for the versions you are 
running, for example:

NEWS <- "http://svn.osgeo.org/metacrs/proj/trunk/proj/NEWS"
PROJ4_NEWS <- readLines(url(NEWS))
lns <- grep("Release Notes|EPSG", PROJ4_NEWS)
head(PROJ4_NEWS[lns])

NEWS <- "http://trac.osgeo.org/gdal/export/26662/trunk/gdal/NEWS"
GDAL_NEWS <- readLines(url(NEWS))
lns <- grep("Release Notes|EPSG", GDAL_NEWS)
head(GDAL_NEWS[lns])


Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From senator at ecotoxicology.de  Tue Nov 26 21:59:36 2013
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Tue, 26 Nov 2013 21:59:36 +0100
Subject: [R-sig-Geo] Linking R/spgrass6 to OSGEO4W GRASS GIS installation
Message-ID: <9E8C2FC2-1D69-4F7C-802B-B63BEB48553E@ecotoxicology.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131126/2c13a3e8/attachment.pl>

From jefunes at gmail.com  Tue Nov 26 23:13:25 2013
From: jefunes at gmail.com (Jose Funes)
Date: Tue, 26 Nov 2013 17:13:25 -0500
Subject: [R-sig-Geo] Spatial point process
Message-ID: <CAG1eJiF+OnDcreby=SVTdG3Eks7pGh+xvYrsMkUgTVBLh3JfRg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131126/3e0da4ff/attachment.pl>

From antonio.bubbico at gmail.com  Wed Nov 27 13:11:10 2013
From: antonio.bubbico at gmail.com (Antonio Bubbico)
Date: Wed, 27 Nov 2013 13:11:10 +0100
Subject: [R-sig-Geo] sphet using two Ws in the first equation
Message-ID: <CABW+3tAk9_6Cva2rXkgux-a2yDZmQtNCCBkD_hAtY_ZYznqzVg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131127/b5ad2575/attachment.pl>

From ldecola at comcast.net  Wed Nov 27 18:34:54 2013
From: ldecola at comcast.net (ldecola at comcast.net)
Date: Wed, 27 Nov 2013 17:34:54 +0000 (UTC)
Subject: [R-sig-Geo] where's spatstat?
In-Reply-To: <CANtt_hwHP1+fzM02SRFvTqcvS+G0BVMFoYRCFMrR1TuN3m=0QA@mail.gmail.com>
Message-ID: <1813961962.668950.1385573694898.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131127/a2f728e1/attachment.pl>

From sarah.goslee at gmail.com  Wed Nov 27 18:43:59 2013
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Wed, 27 Nov 2013 12:43:59 -0500
Subject: [R-sig-Geo] where's spatstat?
In-Reply-To: <1813961962.668950.1385573694898.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
References: <CANtt_hwHP1+fzM02SRFvTqcvS+G0BVMFoYRCFMrR1TuN3m=0QA@mail.gmail.com>
	<1813961962.668950.1385573694898.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
Message-ID: <CAM_vju=NAGgB-3Tu45aXH1rpOw6LihEs0mR-ifhhXm5c5mMEdg@mail.gmail.com>

Where are you looking?

Not, apparently, on CRAN:
http://cran.r-project.org/web/packages/spatstat/index.html

Sarah

On Wed, Nov 27, 2013 at 12:34 PM,  <ldecola at comcast.net> wrote:
> i don't see it among available packages to install...
>
>



-- 
Sarah Goslee
http://www.functionaldiversity.org


From ldecola at comcast.net  Wed Nov 27 18:55:53 2013
From: ldecola at comcast.net (ldecola at comcast.net)
Date: Wed, 27 Nov 2013 17:55:53 +0000 (UTC)
Subject: [R-sig-Geo] where's spatstat?
In-Reply-To: <CAM_vju=NAGgB-3Tu45aXH1rpOw6LihEs0mR-ifhhXm5c5mMEdg@mail.gmail.com>
Message-ID: <992859230.669347.1385574953147.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131127/8d94089a/attachment.pl>

From sarah.goslee at gmail.com  Wed Nov 27 19:00:57 2013
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Wed, 27 Nov 2013 13:00:57 -0500
Subject: [R-sig-Geo] where's spatstat?
In-Reply-To: <992859230.669347.1385574953147.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
References: <CAM_vju=NAGgB-3Tu45aXH1rpOw6LihEs0mR-ifhhXm5c5mMEdg@mail.gmail.com>
	<992859230.669347.1385574953147.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
Message-ID: <CAM_vjunvBPhzQ602wYnJFR3vWqduFsi4-hCJdJN1ntUemi3Y=g@mail.gmail.com>

You can can download the Windows binary from the link I provided and
use the install local packages option, or you can select a different
mirror.

You can also use the install.packages() command, and specify the
package name and mirror.

If your particular method and mirror are not working for you, there
are a multitude of other options.

But do note that the more information about OS, procedure, etc, you
include in your initial query, the more helpful the answers are likely
to be. "This does not work" is not a well-formed query.

Sarah

On Wed, Nov 27, 2013 at 12:55 PM,  <ldecola at comcast.net> wrote:
> i install packages on my windows7 pc by clicking packages > install and then i select a mirror site, which brings up a list of 100s of packages in alpha order, including SpatioTemporal followed by spBayes.
>
> Lee De Cola. ----- Original Message -----
> From: "Sarah Goslee" <sarah.goslee at gmail.com>
> To: ldecola at comcast.net
> Cc: "r-sig-geo" <r-sig-geo at r-project.org>
> Sent: Wednesday, November 27, 2013 12:43:59 PM
> Subject: Re: [R-sig-Geo] where's spatstat?
>
> Where are you looking?
>
> Not, apparently, on CRAN:
> http://cran.r-project.org/web/packages/spatstat/index.html
>
> Sarah
>
> On Wed, Nov 27, 2013 at 12:34 PM, <ldecola at comcast.net> wrote:
>> i don't see it among available packages to install...
>>
>>
>

-- 
Sarah Goslee
http://www.functionaldiversity.org


From timothy.gregoire at yale.edu  Wed Nov 27 19:00:46 2013
From: timothy.gregoire at yale.edu (Gregoire, Timothy)
Date: Wed, 27 Nov 2013 18:00:46 +0000
Subject: [R-sig-Geo] where's spatstat?
In-Reply-To: <992859230.669347.1385574953147.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
References: <CAM_vju=NAGgB-3Tu45aXH1rpOw6LihEs0mR-ifhhXm5c5mMEdg@mail.gmail.com>
	<992859230.669347.1385574953147.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
Message-ID: <8A2DF497F2B80E4B9BE3662392CD10D807F84E96@X10-MBX9.yu.yale.edu>

Is your version of R up-to-date? If not, that might explain absence of spatstat from list.

Timothy G. Gregoire
J. P. Weyerhaeuser Professor of Forest Management
School of Forestry & Environmental Studies, Yale University
360 Prospect Street, New Haven, CT  06511-2104  U.S.A.

office: 1.203.432.9398  mobile: 1.203.508.4014, fax: 1.203.432.3809
timothy.gregoire at yale.edu
G&V sampling text: http://crcpress.com/product/isbn/9781584883708


-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of ldecola at comcast.net
Sent: Wednesday, November 27, 2013 12:56 PM
Cc: r-sig-geo
Subject: Re: [R-sig-Geo] where's spatstat?

i install packages on my windows7 pc by clicking packages > install and then i select a mirror site, which brings up a list of 100s of packages in alpha order, including SpatioTemporal followed by spBayes. 

Lee De Cola. ----- Original Message -----
From: "Sarah Goslee" <sarah.goslee at gmail.com> 
To: ldecola at comcast.net 
Cc: "r-sig-geo" <r-sig-geo at r-project.org> 
Sent: Wednesday, November 27, 2013 12:43:59 PM 
Subject: Re: [R-sig-Geo] where's spatstat? 

Where are you looking? 

Not, apparently, on CRAN: 
http://cran.r-project.org/web/packages/spatstat/index.html 

Sarah 

On Wed, Nov 27, 2013 at 12:34 PM, <ldecola at comcast.net> wrote: 
> i don't see it among available packages to install... 
> 
> 



-- 
Sarah Goslee 
http://www.functionaldiversity.org 

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ldecola at comcast.net  Wed Nov 27 19:12:30 2013
From: ldecola at comcast.net (ldecola at comcast.net)
Date: Wed, 27 Nov 2013 18:12:30 +0000 (UTC)
Subject: [R-sig-Geo] where's spatstat?
In-Reply-To: <8A2DF497F2B80E4B9BE3662392CD10D807F84E96@X10-MBX9.yu.yale.edu>
Message-ID: <16241495.669635.1385575950606.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131127/34fa2ec8/attachment.pl>

From sarah.goslee at gmail.com  Wed Nov 27 19:19:53 2013
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Wed, 27 Nov 2013 13:19:53 -0500
Subject: [R-sig-Geo] where's spatstat?
In-Reply-To: <16241495.669635.1385575950606.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
References: <8A2DF497F2B80E4B9BE3662392CD10D807F84E96@X10-MBX9.yu.yale.edu>
	<16241495.669635.1385575950606.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>
Message-ID: <CAM_vjunf_fB_cbBZ35aPb2YLyNgQfJdZnsLg_baQkKtE21Ue0w@mail.gmail.com>

On Wed, Nov 27, 2013 at 1:12 PM,  <ldecola at comcast.net> wrote:
> i would not think the version would have anything to do with the packages available on the sites...anyway, here's what's reported at startup:
> --------
> R version 3.0.1 (2013-05-16) -- "Good Sport"
> Copyright (C) 2013 The R Foundation for Statistical Computing
> Platform: x86_64-w64-mingw32/x64 (64-bit)

http://cran.r-project.org/web/packages/spatstat/index.html

Version: 1.34-1
Depends: R (? 3.0.2)


You need to upgrade.

Sarah

> --------
>
> Lee De Cola.
> ----- Original Message -----
> From: "Timothy Gregoire" <timothy.gregoire at yale.edu>
> To: ldecola at comcast.net
> Cc: "r-sig-geo" <r-sig-geo at r-project.org>
> Sent: Wednesday, November 27, 2013 1:00:46 PM
> Subject: RE: [R-sig-Geo] where's spatstat?
>
> Is your version of R up-to-date? If not, that might explain absence of spatstat from list.
>
> Timothy G. Gregoire
> J. P. Weyerhaeuser Professor of Forest Management
> School of Forestry & Environmental Studies, Yale University
> 360 Prospect Street, New Haven, CT 06511-2104 U.S.A.
>
> office: 1.203.432.9398 mobile: 1.203.508.4014, fax: 1.203.432.3809
> timothy.gregoire at yale.edu
> G&V sampling text: http://crcpress.com/product/isbn/9781584883708
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of ldecola at comcast.net
> Sent: Wednesday, November 27, 2013 12:56 PM
> Cc: r-sig-geo
> Subject: Re: [R-sig-Geo] where's spatstat?
>
> i install packages on my windows7 pc by clicking packages > install and then i select a mirror site, which brings up a list of 100s of packages in alpha order, including SpatioTemporal followed by spBayes.
>
> Lee De Cola. ----- Original Message -----
> From: "Sarah Goslee" <sarah.goslee at gmail.com>
> To: ldecola at comcast.net
> Cc: "r-sig-geo" <r-sig-geo at r-project.org>
> Sent: Wednesday, November 27, 2013 12:43:59 PM
> Subject: Re: [R-sig-Geo] where's spatstat?
>
> Where are you looking?
>
> Not, apparently, on CRAN:
> http://cran.r-project.org/web/packages/spatstat/index.html
>
> Sarah
>
> On Wed, Nov 27, 2013 at 12:34 PM, <ldecola at comcast.net> wrote:
>> i don't see it among available packages to install...
>>
>>
>
>


From ldecola at comcast.net  Wed Nov 27 19:55:00 2013
From: ldecola at comcast.net (ldecola at comcast.net)
Date: Wed, 27 Nov 2013 18:55:00 +0000 (UTC)
Subject: [R-sig-Geo] where's spatstat?
In-Reply-To: <CAM_vjunf_fB_cbBZ35aPb2YLyNgQfJdZnsLg_baQkKtE21Ue0w@mail.gmail.com>
Message-ID: <1593245166.670221.1385578500391.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131127/c0e25e6c/attachment.pl>

From ROONEYJ4 at tcd.ie  Wed Nov 27 21:13:30 2013
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Wed, 27 Nov 2013 20:13:30 +0000
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>

Hi everyone,

Has anyone looked at this problem below ?
Even if nobody has an answer I'd be keen to know if the problem replicated for others.

Many thanks,

James

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] On Behalf Of James Rooney [ROONEYJ4 at tcd.ie]
Sent: 23 November 2013 16:30
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Help - caling OpenBugs thourgh R2OpenBugs problem

Hi all,

I am working on a Bayesian spatial smoothing project - and have implemented the BYM model, similar to the description in Chapter 11 of the ASDAR book. However, I have been having a huge problem calling OpenBugs from within R and I cannot figure out why. I would veyr much liek to do this as it would speed up the whole process. I'm stared at this for a omnth or two now to no avail so I'm hoping that somebody might spot a mistake. Basically when I call OpenBugs from R using the bugs command through R2OpenBugs - it throws a non-specific error and tells me to heck the bugs log file. The problem is Bugs does not generate one. This is made all the weirder by the fact that if I manually start up bugs and start it running using the data and inits files gnerated by R2OpenBugs - it runs fine without complaint. This is how I have been working so far. But I want to parallelize Bugs using Snow - so I need R2OpenBugs to work properly. I'm hoping someone here can help!!!

I've made a simulation to recreate the problem. My apologies it is a little complex, but I wanted to use the shapefile I'm actually working with which is freely downloadable for those willing to take a look.
So here goes.

1. Go here for the shapefile:
http://www.cso.ie/en/census/census2011boundaryfiles/

2. Click on the word "Disclaimer" to access the shapefiles (should you agree with the disclaimer!!). After clicking through the Disclaimer stuff, the file to download is: "Census2011_Electoral_Divisions_generalised20m.zip"

3. Set up a directory for this and save the shapefiles there.

4. You will need a bugs model. Cut and paste the below into a txt file and save it to your directory under the name "spatial_CAR.txt"

model
{

  for(i in 1:N)
  {
    observed[i]~dpois(mu[i])
    log(theta[i])<-alpha + u[i] + v[i]
    mu[i]<-expected[i]*theta[i]
    u[i] ~dnorm(0,tau)
  }

v[1:N]~car.normal(adj[],weights[],num[],precv)

  alpha ~dflat()
  tau ~dgamma(0.001,0.001)
  precv ~dgamma(0.1,0.1)
}

5. Now open R and paste in the R code below. Remember to set your working directory to the same directory you saved the shapefiles and bugs model into. Also you might need to modify the path to OpenBugs on your machine.

6. Run the code. For me the final line throws the error:
"Error in bugs.run(n.burnin, OpenBUGS.pgm, debug = debug, WINE = WINE,  :
  Look at the log file in  C:......<SNIP>................./R2OpenBugs Simulation  and
try again with 'debug=TRUE' to figure out what went wrong within OpenBUGS."

I cannot figure out why!!! The log file does not exist!! If you manually open bugs and use the data and init files it works. Why ? No idea!!!!
Any and all help much appreciated!!!
Apologies for the length of this!!

James


R Code:

library(rgdal)
library(spdep)
library(R2OpenBUGS)

setwd("....your working directory here......")

#Read in Spatial Polygon Data Frame
SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)

# Detect neighbours
nb<-poly2nb(SPolyDF,queen=T,snap=0.1) # snap at 100m distance

# Create nb weights
nb.w<-nb2listw(nb,zero.policy=T,style="B")

# Create BUGS CAR weights
nbBugs<-listw2WB(nb.w)

# Simulate some count data for observed and expected cases
N<-nrow(SPolyDF)
SPolyDF$obs<-sample.int(100, N, TRUE)
SPolyDF$exp<-sample.int(100, N, TRUE)

# Prep Data for OpenBugs
d<-list(N = N, observed = SPolyDF$obs, expected = SPolyDF$exp, adj=nbBugs$adj, weights=nbBugs$weights, num=nbBugs$num)

# Specify dir where bugs lives
BugsDir<-"C:/Program Files (x86)/OpenBUGS/OpenBUGS322"

# Define initial values for bugs
inits<-list(
   list(u=rep(0,N),v=rep(0,N),alpha=0,tau=0.0001,precv=0.002)
   ,list(u=rep(0,N),v=rep(0,N),alpha=0.1,tau=0.0002,precv=0.001))

# Define working directory as current directory
wdir=getwd()

# Openbugs call
MCMCres<-bugs(data=d,inits=inits,parameters.to.save =c("theta","alpha","tau","precv"),
              n.iter=1000,model.file="spatial_CAR.txt",n.chains=2,n.burnin=100,n.thin=1,
              OpenBUGS.pgm=BugsDir,working.directory=wdir,codaPkg=F,debug=T)

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From virgilio.gomez at uclm.es  Wed Nov 27 21:29:16 2013
From: virgilio.gomez at uclm.es (Virgilio =?ISO-8859-1?Q?G=F3mez-Rubio?=)
Date: Wed, 27 Nov 2013 21:29:16 +0100
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
Message-ID: <1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>

Dear James,

I'll be happy to look into this but I will need more information about
your system. Also, could you run the code using 'debug=TRUE' as seen in
the error message?

Best wishes,

Virgilio

On mi?, 2013-11-27 at 20:13 +0000, James Rooney wrote:
> Hi everyone,
> 
> Has anyone looked at this problem below ?
> Even if nobody has an answer I'd be keen to know if the problem replicated for others.
> 
> Many thanks,
> 
> James
> 
> ________________________________________
> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] On Behalf Of James Rooney [ROONEYJ4 at tcd.ie]
> Sent: 23 November 2013 16:30
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Help - caling OpenBugs thourgh R2OpenBugs problem
> 
> Hi all,
> 
> I am working on a Bayesian spatial smoothing project - and have implemented the BYM model, similar to the description in Chapter 11 of the ASDAR book. However, I have been having a huge problem calling OpenBugs from within R and I cannot figure out why. I would veyr much liek to do this as it would speed up the whole process. I'm stared at this for a omnth or two now to no avail so I'm hoping that somebody might spot a mistake. Basically when I call OpenBugs from R using the bugs command through R2OpenBugs - it throws a non-specific error and tells me to heck the bugs log file. The problem is Bugs does not generate one. This is made all the weirder by the fact that if I manually start up bugs and start it running using the data and inits files gnerated by R2OpenBugs - it runs fine without complaint. This is how I have been working so far. But I want to parallelize Bugs using Snow - so I need R2OpenBugs to work properly. I'm hoping someone here can help!!!
> 
> I've made a simulation to recreate the problem. My apologies it is a little complex, but I wanted to use the shapefile I'm actually working with which is freely downloadable for those willing to take a look.
> So here goes.
> 
> 1. Go here for the shapefile:
> http://www.cso.ie/en/census/census2011boundaryfiles/
> 
> 2. Click on the word "Disclaimer" to access the shapefiles (should you agree with the disclaimer!!). After clicking through the Disclaimer stuff, the file to download is: "Census2011_Electoral_Divisions_generalised20m.zip"
> 
> 3. Set up a directory for this and save the shapefiles there.
> 
> 4. You will need a bugs model. Cut and paste the below into a txt file and save it to your directory under the name "spatial_CAR.txt"
> 
> model
> {
> 
>   for(i in 1:N)
>   {
>     observed[i]~dpois(mu[i])
>     log(theta[i])<-alpha + u[i] + v[i]
>     mu[i]<-expected[i]*theta[i]
>     u[i] ~dnorm(0,tau)
>   }
> 
> v[1:N]~car.normal(adj[],weights[],num[],precv)
> 
>   alpha ~dflat()
>   tau ~dgamma(0.001,0.001)
>   precv ~dgamma(0.1,0.1)
> }
> 
> 5. Now open R and paste in the R code below. Remember to set your working directory to the same directory you saved the shapefiles and bugs model into. Also you might need to modify the path to OpenBugs on your machine.
> 
> 6. Run the code. For me the final line throws the error:
> "Error in bugs.run(n.burnin, OpenBUGS.pgm, debug = debug, WINE = WINE,  :
>   Look at the log file in  C:......<SNIP>................./R2OpenBugs Simulation  and
> try again with 'debug=TRUE' to figure out what went wrong within OpenBUGS."
> 
> I cannot figure out why!!! The log file does not exist!! If you manually open bugs and use the data and init files it works. Why ? No idea!!!!
> Any and all help much appreciated!!!
> Apologies for the length of this!!
> 
> James
> 
> 
> R Code:
> 
> library(rgdal)
> library(spdep)
> library(R2OpenBUGS)
> 
> setwd("....your working directory here......")
> 
> #Read in Spatial Polygon Data Frame
> SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)
> 
> # Detect neighbours
> nb<-poly2nb(SPolyDF,queen=T,snap=0.1) # snap at 100m distance
> 
> # Create nb weights
> nb.w<-nb2listw(nb,zero.policy=T,style="B")
> 
> # Create BUGS CAR weights
> nbBugs<-listw2WB(nb.w)
> 
> # Simulate some count data for observed and expected cases
> N<-nrow(SPolyDF)
> SPolyDF$obs<-sample.int(100, N, TRUE)
> SPolyDF$exp<-sample.int(100, N, TRUE)
> 
> # Prep Data for OpenBugs
> d<-list(N = N, observed = SPolyDF$obs, expected = SPolyDF$exp, adj=nbBugs$adj, weights=nbBugs$weights, num=nbBugs$num)
> 
> # Specify dir where bugs lives
> BugsDir<-"C:/Program Files (x86)/OpenBUGS/OpenBUGS322"
> 
> # Define initial values for bugs
> inits<-list(
>    list(u=rep(0,N),v=rep(0,N),alpha=0,tau=0.0001,precv=0.002)
>    ,list(u=rep(0,N),v=rep(0,N),alpha=0.1,tau=0.0002,precv=0.001))
> 
> # Define working directory as current directory
> wdir=getwd()
> 
> # Openbugs call
> MCMCres<-bugs(data=d,inits=inits,parameters.to.save =c("theta","alpha","tau","precv"),
>               n.iter=1000,model.file="spatial_CAR.txt",n.chains=2,n.burnin=100,n.thin=1,
>               OpenBUGS.pgm=BugsDir,working.directory=wdir,codaPkg=F,debug=T)
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ROONEYJ4 at tcd.ie  Wed Nov 27 22:13:48 2013
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Wed, 27 Nov 2013 21:13:48 +0000
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>,
	<1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>

Dear Virgilio,

Many thanks for taking a look at it!

That  'debug = TRUE' is already set!!!! It doesn't make any difference!!

I'm running R in Windows 7 through Parallels on a Macbook Pro  (OSx Mavericks). I have shut down OsX and booted purely into windows and it doesn't make any difference.
I've experienced this problem under both R 2.15 and R 3.01. It also happens both in R Studio and in the standard R interface. I have Openbugs version 3.2.2. Running latest version of the packages used.

My thinking is that something is crashing OpenBugs when it attempts to open - but I cant' figure out how or why. I wonder is there a file size limit for passing things into OpenBugs ?

Appreciate any help!
James

________________________________________
From: Virgilio G?mez-Rubio [virgilio.gomez at uclm.es]
Sent: 27 November 2013 20:29
To: James Rooney
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Dear James,

I'll be happy to look into this but I will need more information about
your system. Also, could you run the code using 'debug=TRUE' as seen in
the error message?

Best wishes,

Virgilio

On mi?, 2013-11-27 at 20:13 +0000, James Rooney wrote:
> Hi everyone,
>
> Has anyone looked at this problem below ?
> Even if nobody has an answer I'd be keen to know if the problem replicated for others.
>
> Many thanks,
>
> James
>
> ________________________________________
> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] On Behalf Of James Rooney [ROONEYJ4 at tcd.ie]
> Sent: 23 November 2013 16:30
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Help - caling OpenBugs thourgh R2OpenBugs problem
>
> Hi all,
>
> I am working on a Bayesian spatial smoothing project - and have implemented the BYM model, similar to the description in Chapter 11 of the ASDAR book. However, I have been having a huge problem calling OpenBugs from within R and I cannot figure out why. I would veyr much liek to do this as it would speed up the whole process. I'm stared at this for a omnth or two now to no avail so I'm hoping that somebody might spot a mistake. Basically when I call OpenBugs from R using the bugs command through R2OpenBugs - it throws a non-specific error and tells me to heck the bugs log file. The problem is Bugs does not generate one. This is made all the weirder by the fact that if I manually start up bugs and start it running using the data and inits files gnerated by R2OpenBugs - it runs fine without complaint. This is how I have been working so far. But I want to parallelize Bugs using Snow - so I need R2OpenBugs to work properly. I'm hoping someone here can help!!!
>
> I've made a simulation to recreate the problem. My apologies it is a little complex, but I wanted to use the shapefile I'm actually working with which is freely downloadable for those willing to take a look.
> So here goes.
>
> 1. Go here for the shapefile:
> http://www.cso.ie/en/census/census2011boundaryfiles/
>
> 2. Click on the word "Disclaimer" to access the shapefiles (should you agree with the disclaimer!!). After clicking through the Disclaimer stuff, the file to download is: "Census2011_Electoral_Divisions_generalised20m.zip"
>
> 3. Set up a directory for this and save the shapefiles there.
>
> 4. You will need a bugs model. Cut and paste the below into a txt file and save it to your directory under the name "spatial_CAR.txt"
>
> model
> {
>
>   for(i in 1:N)
>   {
>     observed[i]~dpois(mu[i])
>     log(theta[i])<-alpha + u[i] + v[i]
>     mu[i]<-expected[i]*theta[i]
>     u[i] ~dnorm(0,tau)
>   }
>
> v[1:N]~car.normal(adj[],weights[],num[],precv)
>
>   alpha ~dflat()
>   tau ~dgamma(0.001,0.001)
>   precv ~dgamma(0.1,0.1)
> }
>
> 5. Now open R and paste in the R code below. Remember to set your working directory to the same directory you saved the shapefiles and bugs model into. Also you might need to modify the path to OpenBugs on your machine.
>
> 6. Run the code. For me the final line throws the error:
> "Error in bugs.run(n.burnin, OpenBUGS.pgm, debug = debug, WINE = WINE,  :
>   Look at the log file in  C:......<SNIP>................./R2OpenBugs Simulation  and
> try again with 'debug=TRUE' to figure out what went wrong within OpenBUGS."
>
> I cannot figure out why!!! The log file does not exist!! If you manually open bugs and use the data and init files it works. Why ? No idea!!!!
> Any and all help much appreciated!!!
> Apologies for the length of this!!
>
> James
>
>
> R Code:
>
> library(rgdal)
> library(spdep)
> library(R2OpenBUGS)
>
> setwd("....your working directory here......")
>
> #Read in Spatial Polygon Data Frame
> SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)
>
> # Detect neighbours
> nb<-poly2nb(SPolyDF,queen=T,snap=0.1) # snap at 100m distance
>
> # Create nb weights
> nb.w<-nb2listw(nb,zero.policy=T,style="B")
>
> # Create BUGS CAR weights
> nbBugs<-listw2WB(nb.w)
>
> # Simulate some count data for observed and expected cases
> N<-nrow(SPolyDF)
> SPolyDF$obs<-sample.int(100, N, TRUE)
> SPolyDF$exp<-sample.int(100, N, TRUE)
>
> # Prep Data for OpenBugs
> d<-list(N = N, observed = SPolyDF$obs, expected = SPolyDF$exp, adj=nbBugs$adj, weights=nbBugs$weights, num=nbBugs$num)
>
> # Specify dir where bugs lives
> BugsDir<-"C:/Program Files (x86)/OpenBUGS/OpenBUGS322"
>
> # Define initial values for bugs
> inits<-list(
>    list(u=rep(0,N),v=rep(0,N),alpha=0,tau=0.0001,precv=0.002)
>    ,list(u=rep(0,N),v=rep(0,N),alpha=0.1,tau=0.0002,precv=0.001))
>
> # Define working directory as current directory
> wdir=getwd()
>
> # Openbugs call
> MCMCres<-bugs(data=d,inits=inits,parameters.to.save =c("theta","alpha","tau","precv"),
>               n.iter=1000,model.file="spatial_CAR.txt",n.chains=2,n.burnin=100,n.thin=1,
>               OpenBUGS.pgm=BugsDir,working.directory=wdir,codaPkg=F,debug=T)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From rahmannorthampton at gmail.com  Wed Nov 27 23:31:14 2013
From: rahmannorthampton at gmail.com (Lutfor)
Date: Wed, 27 Nov 2013 14:31:14 -0800 (PST)
Subject: [R-sig-Geo] mcp calculation
Message-ID: <1385591474760-7585219.post@n2.nabble.com>

Dear forum members,

Today, I upgraded my R with 3.0.2. I was going to use my old code for MCP
calculation using adehabitat. But when I was going use mcp.area calculation
it says, i do need gpclib. Unfortunately new version of R don't have gpclib
packages. I was trying to do with adehabitatHR but now luck yet. could
anyone help to calculated mcp.area from my data.

I have used following code for my calculation.

mcpdata1<-read.csv("DataMCPKernel.csv",header=T)
attach(mcpdata1)

XY=mcpdata1[,c("x","y")]
id=mcpdata1[,c("Stage")] 

HrMcp<-mcp.area(XY,id)
#When I do run above command following error message pop up.
Loading required package: gpclib
Failed with error:  ??gpclib? is not a valid installed package?
Error in mcp.area(XY, id) : package gpclib required

I would greatly appreciate if you get me any suggestion (I tried to follow
adehabitatHR example but sorry to say not having any luck with my data).  

My data: 

Stage	            x	            y
incubation	646446.9	5213729
incubation	646395.1	5213765
incubation	646395.1	5213765
incubation	646395.1	5213765
incubation	646382.5	5213783
incubation	646395.1	5213765
incubation	646395.5	5213746
incubation	646665	5213605
incubation	645684.8	5213821
incubation	646396	5213727
incubation	648337.4	5214609
incubation	643467.4	5214935
incubation	646395.1	5213765
incubation	642319.7	5214203
incubation	646244.7	5214224
incubation	643306.7	5214227

Kind regards
Lutfor



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/mcp-calculation-tp7585219.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From basille.web at ase-research.org  Thu Nov 28 00:22:56 2013
From: basille.web at ase-research.org (Mathieu Basille)
Date: Wed, 27 Nov 2013 18:22:56 -0500
Subject: [R-sig-Geo] mcp calculation
In-Reply-To: <1385591474760-7585219.post@n2.nabble.com>
References: <1385591474760-7585219.post@n2.nabble.com>
Message-ID: <52967ED0.2090306@ase-research.org>

Dear Lutfor,

It should work out of the box with the current version of adehabitatHR, 
which does not rely on gpclib for MCP estimations. Here is an example using 
R 3.0.2 and adehabitatHR 0.4.10:

## Load adehabitatHR
library(adehabitatHR)

## This give me:
#
# Loading required package: sp
# Loading required package: deldir
# deldir 0.1-1
# Loading required package: ade4
#
# Attaching package: ?ade4?
#
# The following object is masked from ?package:base?:
#
#     within
#
# Loading required package: adehabitatMA
# Loading required package: adehabitatLT
# Loading required package: CircStats
# Loading required package: MASS
# Loading required package: boot
#
## As you can see, gpclib is not loaded.

## Load example data
data(puechabonsp)
rel <-  puechabonsp$relocs

## Estimates the MCP
cp <- mcp(rel[,1])

## The home-range size
as.data.frame(cp)
#          id     area
# Brock Brock 22.64670
# Calou Calou 41.68815
# Chou   Chou 71.93205
# Jean   Jean 55.88415

## Computation of the home-range size:
mcp.area(rel[,1])
#        Brock    Calou      Chou      Jean
# 20   2.01000  8.06000  15.74195   1.13685
# 25   2.05565  9.96440  16.11330   1.48680
# 30   2.44080 13.27520  16.67075   1.69070
# 35   6.46570 13.65330  18.04590   2.33475
# 40   7.01845 14.88035  22.65340   4.09565
# ...

Hope this helps,
Mathieu.


Le 11/27/2013 05:31 PM, Lutfor a ?crit :
> Dear forum members,
>
> Today, I upgraded my R with 3.0.2. I was going to use my old code for MCP
> calculation using adehabitat. But when I was going use mcp.area calculation
> it says, i do need gpclib. Unfortunately new version of R don't have gpclib
> packages. I was trying to do with adehabitatHR but now luck yet. could
> anyone help to calculated mcp.area from my data.
>
> I have used following code for my calculation.
>
> mcpdata1<-read.csv("DataMCPKernel.csv",header=T)
> attach(mcpdata1)
>
> XY=mcpdata1[,c("x","y")]
> id=mcpdata1[,c("Stage")]
>
> HrMcp<-mcp.area(XY,id)
> #When I do run above command following error message pop up.
> Loading required package: gpclib
> Failed with error:  ??gpclib? is not a valid installed package?
> Error in mcp.area(XY, id) : package gpclib required
>
> I would greatly appreciate if you get me any suggestion (I tried to follow
> adehabitatHR example but sorry to say not having any luck with my data).
>
> My data:
>
> Stage	            x	            y
> incubation	646446.9	5213729
> incubation	646395.1	5213765
> incubation	646395.1	5213765
> incubation	646395.1	5213765
> incubation	646382.5	5213783
> incubation	646395.1	5213765
> incubation	646395.5	5213746
> incubation	646665	5213605
> incubation	645684.8	5213821
> incubation	646396	5213727
> incubation	648337.4	5214609
> incubation	643467.4	5214935
> incubation	646395.1	5213765
> incubation	642319.7	5214203
> incubation	646244.7	5214224
> incubation	643306.7	5214227
>
> Kind regards
> Lutfor
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/mcp-calculation-tp7585219.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 

~$ whoami
Mathieu Basille, PhD

~$ locate --details
University of Florida \\
Fort Lauderdale Research and Education Center
(+1) 954-577-6314
http://ase-research.org/basille

~$ fortune
? Le tout est de tout dire, et je manque de mots
Et je manque de temps, et je manque d'audace. ?
  -- Paul ?luard


From yuster0 at gmail.com  Thu Nov 28 10:11:48 2013
From: yuster0 at gmail.com (Yuster Ronoh)
Date: Thu, 28 Nov 2013 12:11:48 +0300
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
	<1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>
Message-ID: <CAP6hh38pzWgacpe+E9wmkQSmmSqJAdEmPStB00dKNbG=nO10kg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131128/64afd3e3/attachment.pl>

From ROONEYJ4 at tcd.ie  Thu Nov 28 10:17:24 2013
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Thu, 28 Nov 2013 09:17:24 +0000
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <CAP6hh38pzWgacpe+E9wmkQSmmSqJAdEmPStB00dKNbG=nO10kg@mail.gmail.com>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
	<1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>,
	<CAP6hh38pzWgacpe+E9wmkQSmmSqJAdEmPStB00dKNbG=nO10kg@mail.gmail.com>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE1D@GOMAIL.college.tcd.ie>

Hi Yuster,

Did you download the correct shapefile into "C:/Users/Public/shapefile" ?? There are alot of files there and I could not link directly to the file due to the "Disclaimer" page.

The other thing I find if I am having these kinds of errors from readOGR, is to paste the full pathway in quote into the readOGR instead of "."
In other words for your pathway if you are sure the right file is in the folder try this:

SPolyDF<-readOGR("C:/Users/Public/shapefile","Census2011_Electoral_Divisions_generalised20m",TRUE)

James

________________________________________
From: Yuster Ronoh [yuster0 at gmail.com]
Sent: 28 November 2013 09:11
To: James Rooney
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Hi All
I try to follow the above example but i got stuck in reading Spatial Data Frame any Idea or Help?
Here are my R codes with error. I am using RStudio Version 3.0.2 ,Windows 7 32Bit


Loading required package: sp
> library(rgdal)
rgdal: version: 0.8-12, (SVN revision 492)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
Path to GDAL shared files: C:/Users/symon/R/win-library/3.0/rgdal/gdal
GDAL does not use iconv for recoding strings.
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
Path to PROJ.4 shared files: C:/Users/symon/R/win-library/3.0/rgdal/proj
> library(spdep)
Loading required package: Matrix
Loading required package: lattice
> library(R2OpenBUGS)
> setwd("C:/Users/Public/shapefile")
> #Read in Spatial Polygon Data Frame
> SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv) :
  Cannot open file



On Thu, Nov 28, 2013 at 12:13 AM, James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>> wrote:
Dear Virgilio,

Many thanks for taking a look at it!

That  'debug = TRUE' is already set!!!! It doesn't make any difference!!

I'm running R in Windows 7 through Parallels on a Macbook Pro  (OSx Mavericks). I have shut down OsX and booted purely into windows and it doesn't make any difference.
I've experienced this problem under both R 2.15 and R 3.01. It also happens both in R Studio and in the standard R interface. I have Openbugs version 3.2.2. Running latest version of the packages used.

My thinking is that something is crashing OpenBugs when it attempts to open - but I cant' figure out how or why. I wonder is there a file size limit for passing things into OpenBugs ?

Appreciate any help!
James

________________________________________
From: Virgilio G?mez-Rubio [virgilio.gomez at uclm.es<mailto:virgilio.gomez at uclm.es>]
Sent: 27 November 2013 20:29
To: James Rooney
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Dear James,

I'll be happy to look into this but I will need more information about
your system. Also, could you run the code using 'debug=TRUE' as seen in
the error message?

Best wishes,

Virgilio

On mi?, 2013-11-27 at 20:13 +0000, James Rooney wrote:
> Hi everyone,
>
> Has anyone looked at this problem below ?
> Even if nobody has an answer I'd be keen to know if the problem replicated for others.
>
> Many thanks,
>
> James
>
> ________________________________________
> From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>] On Behalf Of James Rooney [ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>]
> Sent: 23 November 2013 16:30
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Subject: [R-sig-Geo] Help - caling OpenBugs thourgh R2OpenBugs problem
>
> Hi all,
>
> I am working on a Bayesian spatial smoothing project - and have implemented the BYM model, similar to the description in Chapter 11 of the ASDAR book. However, I have been having a huge problem calling OpenBugs from within R and I cannot figure out why. I would veyr much liek to do this as it would speed up the whole process. I'm stared at this for a omnth or two now to no avail so I'm hoping that somebody might spot a mistake. Basically when I call OpenBugs from R using the bugs command through R2OpenBugs - it throws a non-specific error and tells me to heck the bugs log file. The problem is Bugs does not generate one. This is made all the weirder by the fact that if I manually start up bugs and start it running using the data and inits files gnerated by R2OpenBugs - it runs fine without complaint. This is how I have been working so far. But I want to parallelize Bugs using Snow - so I need R2OpenBugs to work properly. I'm hoping someone here can help!!!
>
> I've made a simulation to recreate the problem. My apologies it is a little complex, but I wanted to use the shapefile I'm actually working with which is freely downloadable for those willing to take a look.
> So here goes.
>
> 1. Go here for the shapefile:
> http://www.cso.ie/en/census/census2011boundaryfiles/
>
> 2. Click on the word "Disclaimer" to access the shapefiles (should you agree with the disclaimer!!). After clicking through the Disclaimer stuff, the file to download is: "Census2011_Electoral_Divisions_generalised20m.zip"
>
> 3. Set up a directory for this and save the shapefiles there.
>
> 4. You will need a bugs model. Cut and paste the below into a txt file and save it to your directory under the name "spatial_CAR.txt"
>
> model
> {
>
>   for(i in 1:N)
>   {
>     observed[i]~dpois(mu[i])
>     log(theta[i])<-alpha + u[i] + v[i]
>     mu[i]<-expected[i]*theta[i]
>     u[i] ~dnorm(0,tau)
>   }
>
> v[1:N]~car.normal(adj[],weights[],num[],precv)
>
>   alpha ~dflat()
>   tau ~dgamma(0.001,0.001)
>   precv ~dgamma(0.1,0.1)
> }
>
> 5. Now open R and paste in the R code below. Remember to set your working directory to the same directory you saved the shapefiles and bugs model into. Also you might need to modify the path to OpenBugs on your machine.
>
> 6. Run the code. For me the final line throws the error:
> "Error in bugs.run(n.burnin, OpenBUGS.pgm, debug = debug, WINE = WINE,  :
>   Look at the log file in  C:......<SNIP>................./R2OpenBugs Simulation  and
> try again with 'debug=TRUE' to figure out what went wrong within OpenBUGS."
>
> I cannot figure out why!!! The log file does not exist!! If you manually open bugs and use the data and init files it works. Why ? No idea!!!!
> Any and all help much appreciated!!!
> Apologies for the length of this!!
>
> James
>
>
> R Code:
>
> library(rgdal)
> library(spdep)
> library(R2OpenBUGS)
>
> setwd("....your working directory here......")
>
> #Read in Spatial Polygon Data Frame
> SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)
>
> # Detect neighbours
> nb<-poly2nb(SPolyDF,queen=T,snap=0.1) # snap at 100m distance
>
> # Create nb weights
> nb.w<-nb2listw(nb,zero.policy=T,style="B")
>
> # Create BUGS CAR weights
> nbBugs<-listw2WB(nb.w)
>
> # Simulate some count data for observed and expected cases
> N<-nrow(SPolyDF)
> SPolyDF$obs<-sample.int<http://sample.int>(100, N, TRUE)
> SPolyDF$exp<-sample.int<http://sample.int>(100, N, TRUE)
>
> # Prep Data for OpenBugs
> d<-list(N = N, observed = SPolyDF$obs, expected = SPolyDF$exp, adj=nbBugs$adj, weights=nbBugs$weights, num=nbBugs$num)
>
> # Specify dir where bugs lives
> BugsDir<-"C:/Program Files (x86)/OpenBUGS/OpenBUGS322"
>
> # Define initial values for bugs
> inits<-list(
>    list(u=rep(0,N),v=rep(0,N),alpha=0,tau=0.0001,precv=0.002)
>    ,list(u=rep(0,N),v=rep(0,N),alpha=0.1,tau=0.0002,precv=0.001))
>
> # Define working directory as current directory
> wdir=getwd()
>
> # Openbugs call
> MCMCres<-bugs(data=d,inits=inits,parameters.to.save =c("theta","alpha","tau","precv"),
>               n.iter=1000,model.file="spatial_CAR.txt",n.chains=2,n.burnin=100,n.thin=1,
>               OpenBUGS.pgm=BugsDir,working.directory=wdir,codaPkg=F,debug=T)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From yuster0 at gmail.com  Thu Nov 28 11:21:01 2013
From: yuster0 at gmail.com (Yuster Ronoh)
Date: Thu, 28 Nov 2013 13:21:01 +0300
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE1D@GOMAIL.college.tcd.ie>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
	<1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>
	<CAP6hh38pzWgacpe+E9wmkQSmmSqJAdEmPStB00dKNbG=nO10kg@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE1D@GOMAIL.college.tcd.ie>
Message-ID: <CAP6hh3-FNHmMcQeSVPLrGq0Znt6sdkAmxKTxVH9i5H0ssnyHRg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131128/c3492a2b/attachment.pl>

From ROONEYJ4 at tcd.ie  Thu Nov 28 11:56:51 2013
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Thu, 28 Nov 2013 10:56:51 +0000
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <CAP6hh3-FNHmMcQeSVPLrGq0Znt6sdkAmxKTxVH9i5H0ssnyHRg@mail.gmail.com>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
	<1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>
	<CAP6hh38pzWgacpe+E9wmkQSmmSqJAdEmPStB00dKNbG=nO10kg@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE1D@GOMAIL.college.tcd.ie>,
	<CAP6hh3-FNHmMcQeSVPLrGq0Znt6sdkAmxKTxVH9i5H0ssnyHRg@mail.gmail.com>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE1F@GOMAIL.college.tcd.ie>

Hi Yuster,

Did you unzip the file? Sorry I forgot to say that in instructions. You need to put the unzipped file into that directory.
James
________________________________________
From: Yuster Ronoh [yuster0 at gmail.com]
Sent: 28 November 2013 10:21
To: James Rooney
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Hi James
I Downloaded the correct file from http://www.cso.ie/en/census/census2011boundaryfiles/  as Census2011_Electoral_Divisions_generalised20m zipfolder of 4mb data size ,I set working Directory as("C:/Users/Public/shapefile") in shapefile i pasted the downloaded folder as zip file I try to both was first SPolyDF<-readOGR("C:/Users/Public/shapefile","Census2011_Electoral_Divisions_generalised20m",TRUE) and for second time SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)returning the same error message.


On Thu, Nov 28, 2013 at 12:17 PM, James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>> wrote:
Hi Yuster,

Did you download the correct shapefile into "C:/Users/Public/shapefile" ?? There are alot of files there and I could not link directly to the file due to the "Disclaimer" page.

The other thing I find if I am having these kinds of errors from readOGR, is to paste the full pathway in quote into the readOGR instead of "."
In other words for your pathway if you are sure the right file is in the folder try this:

SPolyDF<-readOGR("C:/Users/Public/shapefile","Census2011_Electoral_Divisions_generalised20m",TRUE)

James

________________________________________
From: Yuster Ronoh [yuster0 at gmail.com<mailto:yuster0 at gmail.com>]
Sent: 28 November 2013 09:11
To: James Rooney
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Hi All
I try to follow the above example but i got stuck in reading Spatial Data Frame any Idea or Help?
Here are my R codes with error. I am using RStudio Version 3.0.2 ,Windows 7 32Bit


Loading required package: sp
> library(rgdal)
rgdal: version: 0.8-12, (SVN revision 492)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
Path to GDAL shared files: C:/Users/symon/R/win-library/3.0/rgdal/gdal
GDAL does not use iconv for recoding strings.
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
Path to PROJ.4 shared files: C:/Users/symon/R/win-library/3.0/rgdal/proj
> library(spdep)
Loading required package: Matrix
Loading required package: lattice
> library(R2OpenBUGS)
> setwd("C:/Users/Public/shapefile")
> #Read in Spatial Polygon Data Frame
> SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv) :
  Cannot open file



On Thu, Nov 28, 2013 at 12:13 AM, James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>>> wrote:
Dear Virgilio,

Many thanks for taking a look at it!

That  'debug = TRUE' is already set!!!! It doesn't make any difference!!

I'm running R in Windows 7 through Parallels on a Macbook Pro  (OSx Mavericks). I have shut down OsX and booted purely into windows and it doesn't make any difference.
I've experienced this problem under both R 2.15 and R 3.01. It also happens both in R Studio and in the standard R interface. I have Openbugs version 3.2.2. Running latest version of the packages used.

My thinking is that something is crashing OpenBugs when it attempts to open - but I cant' figure out how or why. I wonder is there a file size limit for passing things into OpenBugs ?

Appreciate any help!
James

________________________________________
From: Virgilio G?mez-Rubio [virgilio.gomez at uclm.es<mailto:virgilio.gomez at uclm.es><mailto:virgilio.gomez at uclm.es<mailto:virgilio.gomez at uclm.es>>]
Sent: 27 November 2013 20:29
To: James Rooney
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Dear James,

I'll be happy to look into this but I will need more information about
your system. Also, could you run the code using 'debug=TRUE' as seen in
the error message?

Best wishes,

Virgilio

On mi?, 2013-11-27 at 20:13 +0000, James Rooney wrote:
> Hi everyone,
>
> Has anyone looked at this problem below ?
> Even if nobody has an answer I'd be keen to know if the problem replicated for others.
>
> Many thanks,
>
> James
>
> ________________________________________
> From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org><mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>> [r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org><mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>>] On Behalf Of James Rooney [ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>>]
> Sent: 23 November 2013 16:30
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>
> Subject: [R-sig-Geo] Help - caling OpenBugs thourgh R2OpenBugs problem
>
> Hi all,
>
> I am working on a Bayesian spatial smoothing project - and have implemented the BYM model, similar to the description in Chapter 11 of the ASDAR book. However, I have been having a huge problem calling OpenBugs from within R and I cannot figure out why. I would veyr much liek to do this as it would speed up the whole process. I'm stared at this for a omnth or two now to no avail so I'm hoping that somebody might spot a mistake. Basically when I call OpenBugs from R using the bugs command through R2OpenBugs - it throws a non-specific error and tells me to heck the bugs log file. The problem is Bugs does not generate one. This is made all the weirder by the fact that if I manually start up bugs and start it running using the data and inits files gnerated by R2OpenBugs - it runs fine without complaint. This is how I have been working so far. But I want to parallelize Bugs using Snow - so I need R2OpenBugs to work properly. I'm hoping someone here can help!!!
>
> I've made a simulation to recreate the problem. My apologies it is a little complex, but I wanted to use the shapefile I'm actually working with which is freely downloadable for those willing to take a look.
> So here goes.
>
> 1. Go here for the shapefile:
> http://www.cso.ie/en/census/census2011boundaryfiles/
>
> 2. Click on the word "Disclaimer" to access the shapefiles (should you agree with the disclaimer!!). After clicking through the Disclaimer stuff, the file to download is: "Census2011_Electoral_Divisions_generalised20m.zip"
>
> 3. Set up a directory for this and save the shapefiles there.
>
> 4. You will need a bugs model. Cut and paste the below into a txt file and save it to your directory under the name "spatial_CAR.txt"
>
> model
> {
>
>   for(i in 1:N)
>   {
>     observed[i]~dpois(mu[i])
>     log(theta[i])<-alpha + u[i] + v[i]
>     mu[i]<-expected[i]*theta[i]
>     u[i] ~dnorm(0,tau)
>   }
>
> v[1:N]~car.normal(adj[],weights[],num[],precv)
>
>   alpha ~dflat()
>   tau ~dgamma(0.001,0.001)
>   precv ~dgamma(0.1,0.1)
> }
>
> 5. Now open R and paste in the R code below. Remember to set your working directory to the same directory you saved the shapefiles and bugs model into. Also you might need to modify the path to OpenBugs on your machine.
>
> 6. Run the code. For me the final line throws the error:
> "Error in bugs.run(n.burnin, OpenBUGS.pgm, debug = debug, WINE = WINE,  :
>   Look at the log file in  C:......<SNIP>................./R2OpenBugs Simulation  and
> try again with 'debug=TRUE' to figure out what went wrong within OpenBUGS."
>
> I cannot figure out why!!! The log file does not exist!! If you manually open bugs and use the data and init files it works. Why ? No idea!!!!
> Any and all help much appreciated!!!
> Apologies for the length of this!!
>
> James
>
>
> R Code:
>
> library(rgdal)
> library(spdep)
> library(R2OpenBUGS)
>
> setwd("....your working directory here......")
>
> #Read in Spatial Polygon Data Frame
> SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)
>
> # Detect neighbours
> nb<-poly2nb(SPolyDF,queen=T,snap=0.1) # snap at 100m distance
>
> # Create nb weights
> nb.w<-nb2listw(nb,zero.policy=T,style="B")
>
> # Create BUGS CAR weights
> nbBugs<-listw2WB(nb.w)
>
> # Simulate some count data for observed and expected cases
> N<-nrow(SPolyDF)
> SPolyDF$obs<-sample.int<http://sample.int><http://sample.int>(100, N, TRUE)
> SPolyDF$exp<-sample.int<http://sample.int><http://sample.int>(100, N, TRUE)
>
> # Prep Data for OpenBugs
> d<-list(N = N, observed = SPolyDF$obs, expected = SPolyDF$exp, adj=nbBugs$adj, weights=nbBugs$weights, num=nbBugs$num)
>
> # Specify dir where bugs lives
> BugsDir<-"C:/Program Files (x86)/OpenBUGS/OpenBUGS322"
>
> # Define initial values for bugs
> inits<-list(
>    list(u=rep(0,N),v=rep(0,N),alpha=0,tau=0.0001,precv=0.002)
>    ,list(u=rep(0,N),v=rep(0,N),alpha=0.1,tau=0.0002,precv=0.001))
>
> # Define working directory as current directory
> wdir=getwd()
>
> # Openbugs call
> MCMCres<-bugs(data=d,inits=inits,parameters.to.save =c("theta","alpha","tau","precv"),
>               n.iter=1000,model.file="spatial_CAR.txt",n.chains=2,n.burnin=100,n.thin=1,
>               OpenBUGS.pgm=BugsDir,working.directory=wdir,codaPkg=F,debug=T)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From yuster0 at gmail.com  Thu Nov 28 12:08:00 2013
From: yuster0 at gmail.com (Yuster Ronoh)
Date: Thu, 28 Nov 2013 14:08:00 +0300
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE1F@GOMAIL.college.tcd.ie>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
	<1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>
	<CAP6hh38pzWgacpe+E9wmkQSmmSqJAdEmPStB00dKNbG=nO10kg@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE1D@GOMAIL.college.tcd.ie>
	<CAP6hh3-FNHmMcQeSVPLrGq0Znt6sdkAmxKTxVH9i5H0ssnyHRg@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE1F@GOMAIL.college.tcd.ie>
Message-ID: <CAP6hh39=qFZCciORR0Eg=B=oXZSOpczBnrJGC0S-3LwhvAwHAw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131128/3af6023c/attachment.pl>

From ROONEYJ4 at tcd.ie  Thu Nov 28 13:00:57 2013
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Thu, 28 Nov 2013 12:00:57 +0000
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <CAP6hh39=qFZCciORR0Eg=B=oXZSOpczBnrJGC0S-3LwhvAwHAw@mail.gmail.com>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
	<1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>
	<CAP6hh38pzWgacpe+E9wmkQSmmSqJAdEmPStB00dKNbG=nO10kg@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE1D@GOMAIL.college.tcd.ie>
	<CAP6hh3-FNHmMcQeSVPLrGq0Znt6sdkAmxKTxVH9i5H0ssnyHRg@mail.gmail.com>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE1F@GOMAIL.college.tcd.ie>,
	<CAP6hh39=qFZCciORR0Eg=B=oXZSOpczBnrJGC0S-3LwhvAwHAw@mail.gmail.com>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE20@GOMAIL.college.tcd.ie>

I don't know then Yuster. Is your rgdal package up to date ?


________________________________________
From: Yuster Ronoh [yuster0 at gmail.com]
Sent: 28 November 2013 11:08
To: James Rooney
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Yes I unzip the folder to no avail


On Thu, Nov 28, 2013 at 1:56 PM, James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>> wrote:
Hi Yuster,

Did you unzip the file? Sorry I forgot to say that in instructions. You need to put the unzipped file into that directory.
James
________________________________________
From: Yuster Ronoh [yuster0 at gmail.com<mailto:yuster0 at gmail.com>]
Sent: 28 November 2013 10:21
To: James Rooney
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Hi James
I Downloaded the correct file from http://www.cso.ie/en/census/census2011boundaryfiles/  as Census2011_Electoral_Divisions_generalised20m zipfolder of 4mb data size ,I set working Directory as("C:/Users/Public/shapefile") in shapefile i pasted the downloaded folder as zip file I try to both was first SPolyDF<-readOGR("C:/Users/Public/shapefile","Census2011_Electoral_Divisions_generalised20m",TRUE) and for second time SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)returning the same error message.


On Thu, Nov 28, 2013 at 12:17 PM, James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>>> wrote:
Hi Yuster,

Did you download the correct shapefile into "C:/Users/Public/shapefile" ?? There are alot of files there and I could not link directly to the file due to the "Disclaimer" page.

The other thing I find if I am having these kinds of errors from readOGR, is to paste the full pathway in quote into the readOGR instead of "."
In other words for your pathway if you are sure the right file is in the folder try this:

SPolyDF<-readOGR("C:/Users/Public/shapefile","Census2011_Electoral_Divisions_generalised20m",TRUE)

James

________________________________________
From: Yuster Ronoh [yuster0 at gmail.com<mailto:yuster0 at gmail.com><mailto:yuster0 at gmail.com<mailto:yuster0 at gmail.com>>]
Sent: 28 November 2013 09:11
To: James Rooney
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Hi All
I try to follow the above example but i got stuck in reading Spatial Data Frame any Idea or Help?
Here are my R codes with error. I am using RStudio Version 3.0.2 ,Windows 7 32Bit


Loading required package: sp
> library(rgdal)
rgdal: version: 0.8-12, (SVN revision 492)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
Path to GDAL shared files: C:/Users/symon/R/win-library/3.0/rgdal/gdal
GDAL does not use iconv for recoding strings.
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
Path to PROJ.4 shared files: C:/Users/symon/R/win-library/3.0/rgdal/proj
> library(spdep)
Loading required package: Matrix
Loading required package: lattice
> library(R2OpenBUGS)
> setwd("C:/Users/Public/shapefile")
> #Read in Spatial Polygon Data Frame
> SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv) :
  Cannot open file



On Thu, Nov 28, 2013 at 12:13 AM, James Rooney <ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>>>> wrote:
Dear Virgilio,

Many thanks for taking a look at it!

That  'debug = TRUE' is already set!!!! It doesn't make any difference!!

I'm running R in Windows 7 through Parallels on a Macbook Pro  (OSx Mavericks). I have shut down OsX and booted purely into windows and it doesn't make any difference.
I've experienced this problem under both R 2.15 and R 3.01. It also happens both in R Studio and in the standard R interface. I have Openbugs version 3.2.2. Running latest version of the packages used.

My thinking is that something is crashing OpenBugs when it attempts to open - but I cant' figure out how or why. I wonder is there a file size limit for passing things into OpenBugs ?

Appreciate any help!
James

________________________________________
From: Virgilio G?mez-Rubio [virgilio.gomez at uclm.es<mailto:virgilio.gomez at uclm.es><mailto:virgilio.gomez at uclm.es<mailto:virgilio.gomez at uclm.es>><mailto:virgilio.gomez at uclm.es<mailto:virgilio.gomez at uclm.es><mailto:virgilio.gomez at uclm.es<mailto:virgilio.gomez at uclm.es>>>]
Sent: 27 November 2013 20:29
To: James Rooney
Cc: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>>
Subject: Re: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem

Dear James,

I'll be happy to look into this but I will need more information about
your system. Also, could you run the code using 'debug=TRUE' as seen in
the error message?

Best wishes,

Virgilio

On mi?, 2013-11-27 at 20:13 +0000, James Rooney wrote:
> Hi everyone,
>
> Has anyone looked at this problem below ?
> Even if nobody has an answer I'd be keen to know if the problem replicated for others.
>
> Many thanks,
>
> James
>
> ________________________________________
> From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org><mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>><mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org><mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>>> [r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org><mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>><mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org><mailto:r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>>>] On Behalf Of James Rooney [ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie><mailto:ROONEYJ4 at tcd.ie<mailto:ROONEYJ4 at tcd.ie>>>]
> Sent: 23 November 2013 16:30
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org><mailto:r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>>>
> Subject: [R-sig-Geo] Help - caling OpenBugs thourgh R2OpenBugs problem
>
> Hi all,
>
> I am working on a Bayesian spatial smoothing project - and have implemented the BYM model, similar to the description in Chapter 11 of the ASDAR book. However, I have been having a huge problem calling OpenBugs from within R and I cannot figure out why. I would veyr much liek to do this as it would speed up the whole process. I'm stared at this for a omnth or two now to no avail so I'm hoping that somebody might spot a mistake. Basically when I call OpenBugs from R using the bugs command through R2OpenBugs - it throws a non-specific error and tells me to heck the bugs log file. The problem is Bugs does not generate one. This is made all the weirder by the fact that if I manually start up bugs and start it running using the data and inits files gnerated by R2OpenBugs - it runs fine without complaint. This is how I have been working so far. But I want to parallelize Bugs using Snow - so I need R2OpenBugs to work properly. I'm hoping someone here can help!!!
>
> I've made a simulation to recreate the problem. My apologies it is a little complex, but I wanted to use the shapefile I'm actually working with which is freely downloadable for those willing to take a look.
> So here goes.
>
> 1. Go here for the shapefile:
> http://www.cso.ie/en/census/census2011boundaryfiles/
>
> 2. Click on the word "Disclaimer" to access the shapefiles (should you agree with the disclaimer!!). After clicking through the Disclaimer stuff, the file to download is: "Census2011_Electoral_Divisions_generalised20m.zip"
>
> 3. Set up a directory for this and save the shapefiles there.
>
> 4. You will need a bugs model. Cut and paste the below into a txt file and save it to your directory under the name "spatial_CAR.txt"
>
> model
> {
>
>   for(i in 1:N)
>   {
>     observed[i]~dpois(mu[i])
>     log(theta[i])<-alpha + u[i] + v[i]
>     mu[i]<-expected[i]*theta[i]
>     u[i] ~dnorm(0,tau)
>   }
>
> v[1:N]~car.normal(adj[],weights[],num[],precv)
>
>   alpha ~dflat()
>   tau ~dgamma(0.001,0.001)
>   precv ~dgamma(0.1,0.1)
> }
>
> 5. Now open R and paste in the R code below. Remember to set your working directory to the same directory you saved the shapefiles and bugs model into. Also you might need to modify the path to OpenBugs on your machine.
>
> 6. Run the code. For me the final line throws the error:
> "Error in bugs.run(n.burnin, OpenBUGS.pgm, debug = debug, WINE = WINE,  :
>   Look at the log file in  C:......<SNIP>................./R2OpenBugs Simulation  and
> try again with 'debug=TRUE' to figure out what went wrong within OpenBUGS."
>
> I cannot figure out why!!! The log file does not exist!! If you manually open bugs and use the data and init files it works. Why ? No idea!!!!
> Any and all help much appreciated!!!
> Apologies for the length of this!!
>
> James
>
>
> R Code:
>
> library(rgdal)
> library(spdep)
> library(R2OpenBUGS)
>
> setwd("....your working directory here......")
>
> #Read in Spatial Polygon Data Frame
> SPolyDF<-readOGR(".","Census2011_Electoral_Divisions_generalised20m",TRUE)
>
> # Detect neighbours
> nb<-poly2nb(SPolyDF,queen=T,snap=0.1) # snap at 100m distance
>
> # Create nb weights
> nb.w<-nb2listw(nb,zero.policy=T,style="B")
>
> # Create BUGS CAR weights
> nbBugs<-listw2WB(nb.w)
>
> # Simulate some count data for observed and expected cases
> N<-nrow(SPolyDF)
> SPolyDF$obs<-sample.int<http://sample.int><http://sample.int><http://sample.int>(100, N, TRUE)
> SPolyDF$exp<-sample.int<http://sample.int><http://sample.int><http://sample.int>(100, N, TRUE)
>
> # Prep Data for OpenBugs
> d<-list(N = N, observed = SPolyDF$obs, expected = SPolyDF$exp, adj=nbBugs$adj, weights=nbBugs$weights, num=nbBugs$num)
>
> # Specify dir where bugs lives
> BugsDir<-"C:/Program Files (x86)/OpenBUGS/OpenBUGS322"
>
> # Define initial values for bugs
> inits<-list(
>    list(u=rep(0,N),v=rep(0,N),alpha=0,tau=0.0001,precv=0.002)
>    ,list(u=rep(0,N),v=rep(0,N),alpha=0.1,tau=0.0002,precv=0.001))
>
> # Define working directory as current directory
> wdir=getwd()
>
> # Openbugs call
> MCMCres<-bugs(data=d,inits=inits,parameters.to.save =c("theta","alpha","tau","precv"),
>               n.iter=1000,model.file="spatial_CAR.txt",n.chains=2,n.burnin=100,n.thin=1,
>               OpenBUGS.pgm=BugsDir,working.directory=wdir,codaPkg=F,debug=T)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>>>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>>>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>>>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org><mailto:R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From villers.alexandre at gmail.com  Thu Nov 28 17:28:20 2013
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Thu, 28 Nov 2013 18:28:20 +0200
Subject: [R-sig-Geo] rasterize SpatialLines
Message-ID: <52976F24.7060500@gmail.com>

Dear list,

I'm trying to rasterize a SpatialLines object, which represents the path 
of an individual (created from the points locations).
I would like to know the number of times he visited a given pixel.
Following the example (slightly modified) in raster::rasterize


cds1 <- rbind(c(-180,-20), c(-140,55), c(10, 0), c(-140,-60))
cds2 <- rbind(c(-10,0), c(140,60), c(160,0), c(140,-55), c(50,100))
cds3 <- rbind(c(-125,0), c(0,60), c(40,5), c(15,-45))

lines <- SpatialLines(list(Lines(list(Line(cds1)), "1"),
      Lines(list(Line(cds2)), "2"), Lines(list(Line(cds3)), "3") ))
	
r <- raster(ncols=90, nrows=45)
rl <- rasterize(lines, r, fun='count')
plot(rl)
lines (lines)

It's clear from the figure that a pixel that is "visited" twice by a 
SpatialLines with the same ID isn't counted twice (which I would like) 
compared to a pixel visited twice by SpatialLines of 2 different IDs.

I guess I could build a SpatialLines object with each segment bearing a 
different ID but I suspect there is a more elegant way. However I 
couldn't figure out what function to specify (though I'm pretty sure 
once I'll see the answer, it will become obvious...).

Any hint ?

Thanks in advance

Alex


From ldecola at comcast.net  Thu Nov 28 19:33:35 2013
From: ldecola at comcast.net (ldecola at comcast.net)
Date: Thu, 28 Nov 2013 18:33:35 +0000
Subject: [R-sig-Geo] rasterize SpatialLines
In-Reply-To: <52976F24.7060500@gmail.com>
Message-ID: <431801562.679735.1385663615411.JavaMail.root@sz0206a.westchester.pa.mail.comcast.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131128/c2b45852/attachment.pl>

From droletguillaume at gmail.com  Fri Nov 29 01:34:14 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Thu, 28 Nov 2013 16:34:14 -0800 (PST)
Subject: [R-sig-Geo] clusterR: error when using a cluster object passed as
 an argument to function
Message-ID: <1385685254562-7585230.post@n2.nabble.com>

Hi,

I have a function, say fun1, in which I create a SNOW cluster object using:

beginCluster(nodes)   
cl <- getCluster()

Then I export variables to the cores (nodes) and load some libraries:

clusterExport(cl, c("tmpdir", "maxmemory", "chunksize"))
clusterEvalQ(cl, c(library(raster), library(rgdal),  rasterOptions(tmpdir = 
        tmpdir, maxmemory = maxmemory, chunksize = chunksize)))

Later in my function, I call a bunch of other functions to which I pass cl
as one of their arguments.
For exemple, say I have fun2 to which I pass cl which in turn is used in a
call to clusterR:

fun2 <- function(x, b, prl, cl) {
  
  if (prl & !inMemory(x)) {    
    f1 <- function(x, y) {     
      min(x != y - 1)      
    }
    
    nm <- clusterR(x, fun = f1, args = list(b), cl = cl)    
  } else {
    nm <- min(x != b - 1)
  }

   return(nm)
}
When I run fun1 and it gets to the first function which uses cl (fun2 in
this example), this results in the error:

Error in (function (classes, fdef, mtable)  : 
  unable to find an inherited method for function ?writeStart? for signature
?"RasterLayer", "SOCKcluster"?

At the moment I don't have a clue about the source of the problem. Only
thing I know is that it used to work when I was running fun1 line by line
and not by calling the function. Thanks for your help!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/clusterR-error-when-using-a-cluster-object-passed-as-an-argument-to-function-tp7585230.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From virgilio.gomez at uclm.es  Fri Nov 29 10:43:03 2013
From: virgilio.gomez at uclm.es (Virgilio =?ISO-8859-1?Q?G=F3mez-Rubio?=)
Date: Fri, 29 Nov 2013 10:43:03 +0100
Subject: [R-sig-Geo] Help - calling OpenBugs through R2OpenBugs problem
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>
References: <75C8D19A1470D344A8AF5312F01160A602BBB78CFE16@GOMAIL.college.tcd.ie>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE18@GOMAIL.college.tcd.ie>
	, <1385584156.2906.3.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
	<75C8D19A1470D344A8AF5312F01160A602BBB78CFE19@GOMAIL.college.tcd.ie>
Message-ID: <1385718183.2881.10.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>

Dear James,

I have been able to run your code. See attached files. Not sure why
OpenBUGS crashed but I found a few strange symbols (vertical bars) when
I copied and pasted your model from your e-mail. OpenBUGS complained and
it worked fine after I had these symbols removed.

I have run it on an Ubuntu Linux, with R version 3.0.2 Patched
(2013-10-25 r64109). I have used wine to run OpenBUGS, so you may need
to change that in my code. Please, try the code attached on the latest R
you can find.

If you have any particular problem when running my code, please, contact
me off-list so that we can reduce the noise of this list.

Best wishes,

Virgilio
-------------- next part --------------
model
{

for(i in 1:N)
{
 observed[i]~dpois(mu[i])
 log(theta[i])<-alpha + u[i] + v[i]
 mu[i]<-expected[i]*theta[i]
 u[i] ~dnorm(0,tau)
 }

v[1:N]~car.normal(adj[],weights[],num[],precv)

alpha ~dflat()
tau ~dgamma(0.001,0.001)
precv ~dgamma(0.1,0.1)
}
-------------- next part --------------
A non-text attachment was scrubbed...
Name: testOpenBUGS.R
Type: text/x-r-source
Size: 1372 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131129/6a126a3b/attachment.bin>

From john.tellat at gmail.com  Fri Nov 29 11:27:53 2013
From: john.tellat at gmail.com (John Tellat)
Date: Fri, 29 Nov 2013 11:27:53 +0100
Subject: [R-sig-Geo] Taking elevation into account when calculating distance
Message-ID: <CAOPvn+i-TCbmF7STCQho4Pwz8gTXrPDTQR48mRyt_QAYCoPL5Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131129/29ee7207/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Fri Nov 29 12:52:49 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 29 Nov 2013 11:52:49 +0000
Subject: [R-sig-Geo] Taking elevation into account when calculating
	distance
In-Reply-To: <00a71e91955a45268ecbf4f2d88c0414@EX-0-HT0.lancs.local>
References: <00a71e91955a45268ecbf4f2d88c0414@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOMqr6bu1vmL6YojdvYUTOSw0xrXJZT+x85MmGZXgizoA@mail.gmail.com>

Ask Pythagoras?

On a small enough raster so that you can ignore the (nearly) spherical
earth its just sqrt(dx^2+dy^2+dz^2) where dz is the elevation
difference in the same units as x and y.

Sample the elevations from the raster using the functions in the
raster package. Job done?

Barry



On Fri, Nov 29, 2013 at 10:27 AM, John Tellat <john.tellat at gmail.com> wrote:
> Hi,
>
> I?m currently dealing with telemetry data combined with altitude
> measurements in a mountainous area with many valleys.
>
> I want to compute the straight distance between points but taking into
> account the elevation which is likely to extend the distance.
> Any idea on how to compute the "real distance" based on elevation raster
> data?
>
> Thanks!
>
>         [[alternative HTML version deleted]]
>


From forrest at ufl.edu  Fri Nov 29 17:13:18 2013
From: forrest at ufl.edu (Forrest Stevens)
Date: Fri, 29 Nov 2013 11:13:18 -0500
Subject: [R-sig-Geo] Taking elevation into account when calculating
	distance
In-Reply-To: <CAOPvn+i-TCbmF7STCQho4Pwz8gTXrPDTQR48mRyt_QAYCoPL5Q@mail.gmail.com>
References: <CAOPvn+i-TCbmF7STCQho4Pwz8gTXrPDTQR48mRyt_QAYCoPL5Q@mail.gmail.com>
Message-ID: <CAEBQMMkNSmjui_E=Dhsxqc5JShXTEDyVPmBw-0UHKySYMb9LAw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131129/76e3f868/attachment.pl>

From bernd.vogelgesang at gmx.de  Fri Nov 29 18:17:24 2013
From: bernd.vogelgesang at gmx.de (geobernadotte)
Date: Fri, 29 Nov 2013 09:17:24 -0800 (PST)
Subject: [R-sig-Geo] Linking R/spgrass6 to OSGEO4W GRASS GIS installation
In-Reply-To: <9E8C2FC2-1D69-4F7C-802B-B63BEB48553E@ecotoxicology.de>
References: <9E8C2FC2-1D69-4F7C-802B-B63BEB48553E@ecotoxicology.de>
Message-ID: <1385745444377-7585235.post@n2.nabble.com>

Ralf Sch?fer wrote
> Solution:
> Add OSGEO4W/bin to the path to enable access to gdal110.dll
> 
> WPATH <- Sys.getenv("PATH")
> WPATH1 <- paste("C:\\OSGeo4W\\bin", WPATH, sep=";")
> # Note: Users with 64bit installation should put "C:\\OSGeo4W64\\bin"
> #Sys.setenv(PATH=WPATH1)
> initGRASS("C:/OSGeo4W/apps/grass/grass-6.4.3", tempdir(), override=TRUE,
> SG = mwidem_trans2)
> # Note: Users with 64bit installation should put
> C:/OSGeo4W64/apps/grass/grass-6.4.3

You saved my day. Only took me an hour to understand that i have to un-#
Sys.setenv(PATH=WPATH1) from your example ...

I can imagine that this is a problem for quite some people wanting to
utilize GRASS from within R with an OSGEO4W-install. Should find it's way
into some help page maybe...

So thanx for sharing
Cheers
Bernd



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Linking-R-spgrass6-to-OSGEO4W-GRASS-GIS-installation-tp7585204p7585235.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From droletguillaume at gmail.com  Fri Nov 29 18:52:33 2013
From: droletguillaume at gmail.com (Guillaume Drolet)
Date: Fri, 29 Nov 2013 09:52:33 -0800 (PST)
Subject: [R-sig-Geo] clusterR: error when using a cluster object passed
 as an argument to function
In-Reply-To: <1385685254562-7585230.post@n2.nabble.com>
References: <1385685254562-7585230.post@n2.nabble.com>
Message-ID: <1385747553246-7585236.post@n2.nabble.com>

For others who could have the same error, I finally  found the problem with
my functions: 

the cl object should not be passed as an argument to clusterR when
beginCluster() has been called (as explained in the documentation, sorry I
didn't read it carefully before posting).

I removed the use of cl in fn2 and now I'm rolling again!

Guillaume







--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/clusterR-error-when-using-a-cluster-object-passed-as-an-argument-to-function-tp7585230p7585236.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Fri Nov 29 20:01:30 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 29 Nov 2013 20:01:30 +0100
Subject: [R-sig-Geo] sphet using two Ws in the first equation
In-Reply-To: <CABW+3tAk9_6Cva2rXkgux-a2yDZmQtNCCBkD_hAtY_ZYznqzVg@mail.gmail.com>
References: <CABW+3tAk9_6Cva2rXkgux-a2yDZmQtNCCBkD_hAtY_ZYznqzVg@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1311291958540.17122@reclus.nhh.no>

On Wed, 27 Nov 2013, Antonio Bubbico wrote:

> Hello,
>
> I would like to run a "generalized spatial two stage least squares" using
> the sphet package,
> where the model is given by:
>
> y = X \beta + \rho_{1}  W_{1} y + \rho_{2} W_{2} y + u
> u = \lambda W u + \varepsilon
>
> Actually I don't know how to run that model in R, and obviously the problem
> is the second W in the first equation.
>
> Do you know if there is possibility to implement the code to run that kind
> of model?

This model is not implemented in sphet or elsewhere in R packages as far 
as I know in any form. A reference to something similar is:

http://ideas.repec.org/p/ces/ceswps/_2356.html

but you may know this already. The domain of a process of this kind is 
something which has not been exhaustively studied.

Hope this clarifies,

Roger

>
> Regards,
>
> Antonio Bubbico.
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From tech_dev at wildintellect.com  Sat Nov 30 00:13:06 2013
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Fri, 29 Nov 2013 15:13:06 -0800
Subject: [R-sig-Geo] Linking R/spgrass6 to OSGEO4W GRASS GIS installation
In-Reply-To: <1385745444377-7585235.post@n2.nabble.com>
References: <9E8C2FC2-1D69-4F7C-802B-B63BEB48553E@ecotoxicology.de>
	<1385745444377-7585235.post@n2.nabble.com>
Message-ID: <52991F82.20701@wildintellect.com>

On 11/29/2013 09:17 AM, geobernadotte wrote:
> Ralf Sch?fer wrote
>> Solution:
>> Add OSGEO4W/bin to the path to enable access to gdal110.dll
>>
>> WPATH <- Sys.getenv("PATH")
>> WPATH1 <- paste("C:\\OSGeo4W\\bin", WPATH, sep=";")
>> # Note: Users with 64bit installation should put "C:\\OSGeo4W64\\bin"
>> #Sys.setenv(PATH=WPATH1)
>> initGRASS("C:/OSGeo4W/apps/grass/grass-6.4.3", tempdir(), override=TRUE,
>> SG = mwidem_trans2)
>> # Note: Users with 64bit installation should put
>> C:/OSGeo4W64/apps/grass/grass-6.4.3
> 
> You saved my day. Only took me an hour to understand that i have to un-#
> Sys.setenv(PATH=WPATH1) from your example ...
> 
> I can imagine that this is a problem for quite some people wanting to
> utilize GRASS from within R with an OSGEO4W-install. Should find it's way
> into some help page maybe...
> 
> So thanx for sharing
> Cheers
> Bernd
> 

Forwarding to the OSGeo4w list so we can put it on our wiki.
trac.osgeo.org/osgeo4w

Thanks,
Alex


From davbauman at gmail.com  Sat Nov 30 14:33:17 2013
From: davbauman at gmail.com (David Bauman)
Date: Sat, 30 Nov 2013 15:33:17 +0200
Subject: [R-sig-Geo] MEM : Spatial structures detection issues
Message-ID: <CAGrRo0c_=40zT6zr8s_NrmfYfq+wiqKN3hZp+D0Nx97oaWz_uA@mail.gmail.com>

Hi everyone,

I am facing a problem I really do not know how to resolve about
detecting significant spatial structures in a region I am studying.

The study is about the Miombo forest (wooded savanna). I am working in
a 10 ha permanent forest plot, where all trees are mapped and
identified. I sampled 24 more or less regulately scattered plots of 25
x 25 m over the 10 ha. In each plot of 25 x 25 m I got 5 soil samples
on which I will measure a battery of variables (the explanatory
variables).
What I want to study is the b?ta-diversity of the ectomycorrhizal
community, so that in each plot I got about 15 pieces of root
containing some ectomycorrhizal fungus on it (response variables).

My purpose is to explain the spatial variation of the ectomycorrhizal
diversity thanks to the soil variables I will have measured.

To do so, I want to use a PCNM (or MEM).

My problem is that :

All the 24 plots are considered as points, so that the euclidean
distance between them is overestimated. Two adjacent, contiguous,
plots are considered to be 25 m far from each other, while the
distance should be 0, since they "touch" each other.
This leads me to the problem that the truncation threshold distance is
to high to allow the RDA of the response dataframe on the spatial PCNM
variables to detect a significant linear link between both matrices
(function anova.cca()).

So the question is : How can I do so that the area of my plots are
taken into account, and they are not considered as points anymore ?
This would lower the truncation distance and probably allow me to
detect spatial structures that, I really think, do exist.

I hope someone with some experience and good ideas will be able to help.

If you want some more concrete information about the study, do not
hesitate to ask it to me.

Thanks a lot,

David Bauman


From Roger.Bivand at nhh.no  Sat Nov 30 17:04:39 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 30 Nov 2013 17:04:39 +0100
Subject: [R-sig-Geo] MEM : Spatial structures detection issues
In-Reply-To: <CAGrRo0c_=40zT6zr8s_NrmfYfq+wiqKN3hZp+D0Nx97oaWz_uA@mail.gmail.com>
References: <CAGrRo0c_=40zT6zr8s_NrmfYfq+wiqKN3hZp+D0Nx97oaWz_uA@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1311301659190.20544@reclus.nhh.no>

On Sat, 30 Nov 2013, David Bauman wrote:

> Hi everyone,
>
> I am facing a problem I really do not know how to resolve about
> detecting significant spatial structures in a region I am studying.
>
> The study is about the Miombo forest (wooded savanna). I am working in
> a 10 ha permanent forest plot, where all trees are mapped and
> identified. I sampled 24 more or less regulately scattered plots of 25
> x 25 m over the 10 ha. In each plot of 25 x 25 m I got 5 soil samples
> on which I will measure a battery of variables (the explanatory
> variables).
> What I want to study is the b?ta-diversity of the ectomycorrhizal
> community, so that in each plot I got about 15 pieces of root
> containing some ectomycorrhizal fungus on it (response variables).
>
> My purpose is to explain the spatial variation of the ectomycorrhizal
> diversity thanks to the soil variables I will have measured.
>
> To do so, I want to use a PCNM (or MEM).
>
> My problem is that :
>
> All the 24 plots are considered as points, so that the euclidean
> distance between them is overestimated. Two adjacent, contiguous,
> plots are considered to be 25 m far from each other, while the
> distance should be 0, since they "touch" each other.

Well, how are you representing the support of the plots? If you are only 
providing a central point rather than a polygon, you are getting what you 
asked for. If you are providing polygon boundaries, but using the 
coordinates() method to return the central points, the same follows. If 
tou need distances between polygon objects, use gDistance() in rgeos (if 
your positional data are projected).

It always helps if questioners show their reasoning by including a small 
example with code, as the problem may result from an unfortunate choice of 
functions in the workflow. Also always include the output of sessionInfo() 
as functions may behave differently in different versions of R and 
packages.

Hope this clarifies,

Roger

> This leads me to the problem that the truncation threshold distance is
> to high to allow the RDA of the response dataframe on the spatial PCNM
> variables to detect a significant linear link between both matrices
> (function anova.cca()).
>
> So the question is : How can I do so that the area of my plots are
> taken into account, and they are not considered as points anymore ?
> This would lower the truncation distance and probably allow me to
> detect spatial structures that, I really think, do exist.
>
> I hope someone with some experience and good ideas will be able to help.
>
> If you want some more concrete information about the study, do not
> hesitate to ask it to me.
>
> Thanks a lot,
>
> David Bauman
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

