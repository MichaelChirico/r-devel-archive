From cicaboo at gmail.com  Sun Mar  1 00:17:03 2009
From: cicaboo at gmail.com (Michel Barbosa)
Date: Sun, 1 Mar 2009 00:17:03 +0100
Subject: [R-sig-Geo] Point pattern analysis | Kernel estimation and
	GoogleMaps
In-Reply-To: <A3EA804CA6F446429B6AEBB45558456301270E3B@HUGIN.uib.no>
References: <f7f7b86f0902280756v1748fe07sb494d96b012531f5@mail.gmail.com>
	<A3EA804CA6F446429B6AEBB45558456301270E3B@HUGIN.uib.no>
Message-ID: <f7f7b86f0902281517g2ef8bdceied6c2ca7e54af895@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090301/ef4a3904/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sun Mar  1 00:26:36 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 28 Feb 2009 23:26:36 +0000
Subject: [R-sig-Geo] Point pattern analysis | Kernel estimation and
	GoogleMaps
In-Reply-To: <f7f7b86f0902281517g2ef8bdceied6c2ca7e54af895@mail.gmail.com>
References: <f7f7b86f0902280756v1748fe07sb494d96b012531f5@mail.gmail.com>
	<A3EA804CA6F446429B6AEBB45558456301270E3B@HUGIN.uib.no>
	<f7f7b86f0902281517g2ef8bdceied6c2ca7e54af895@mail.gmail.com>
Message-ID: <d8ad40b50902281526w24cba76fp2e9260ac7096c5cf@mail.gmail.com>

2009/2/28 Michel Barbosa <cicaboo at gmail.com>:

> I want to overlay my PNG from the bottom left where the Google logo is, to
> the top right above "New Jersey. So the PNG would overlay my entire Google
> Map. This is what I'm trying to achieve. Hope you guys can help me out.

 Isn't there anything in the Google Maps API that gives you the bounds
of the map region? Use a bit of javascript to put that inside some
HTML, then cut n paste into R to generate a spatstat window with those
bounds. Run your kernel density estimation, generate the PNG, then
overlay on the map.

 Or are you trying to do something dynamic? So that when any user
moves or zooms their google map, R is somehow called and produces a
PNG that covers the map view?

Barry


From stephen.roecker at gmail.com  Sun Mar  1 04:52:54 2009
From: stephen.roecker at gmail.com (Stephen Roecker)
Date: Sat, 28 Feb 2009 19:52:54 -0800
Subject: [R-sig-Geo] Feature Extraction - object based image analysis
Message-ID: <2c0695a50902281952g53336462qfa4cd140325aad3b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090228/44b2f503/attachment.pl>

From Virgilio.Gomez at uclm.es  Sun Mar  1 14:17:39 2009
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Sun, 01 Mar 2009 14:17:39 +0100
Subject: [R-sig-Geo] Point pattern analysis | Kernel estimation and
 Google Maps
In-Reply-To: <f7f7b86f0902280756v1748fe07sb494d96b012531f5@mail.gmail.com>
References: <f7f7b86f0902280756v1748fe07sb494d96b012531f5@mail.gmail.com>
Message-ID: <1235913459.7168.2.camel@Virgilio-Gomez>

Michel,

In addition to the comments that have already been made, there is an
example of overlying results (IDW, but kernel estimation can be done in
a similar way) here:

http://www.asdar-book.org/book/die.R

Look at chunks 41 to 44.

Hope this helps.

Virgilio


From h.wickham at gmail.com  Sun Mar  1 16:01:52 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Sun, 1 Mar 2009 09:01:52 -0600
Subject: [R-sig-Geo] Map thinning/generalisation
Message-ID: <f8e6ff050903010701wca08f00g96e954d913ec92cb@mail.gmail.com>

Hi all,

Is anyone aware of any code for performing topologically consistent
polygon thinning/simplification/generalisation in R?

Hadley

-- 
http://had.co.nz/


From brenning at uwaterloo.ca  Sun Mar  1 16:43:29 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Sun, 01 Mar 2009 10:43:29 -0500
Subject: [R-sig-Geo] RSAGA .asc morphology loop question
In-Reply-To: <79a13c220902251955w533f314ap6bd01559759e91f8@mail.gmail.com>
References: <79a13c220902251955w533f314ap6bd01559759e91f8@mail.gmail.com>
Message-ID: <49AAAD21.9090804@uwaterloo.ca>

Hi Tim,

the rsaga.esri.wrapper currently expects the in.* and out.* arguments 
(with the ASCII/float ESRI grids) to have NO file extension - the file 
extension to be used for all ESRI grids can be given by the 
esri.extension argument; it currently defaults to ".asc" when 
format="ascii" and to ".flt" when format="binary". (Sorry that the help 
file is not explicit enough regarding the file extensions; will add this 
to the next update.)

Two more remarks on your code:

 >   read.ascii.grid(i)
This simply reads the grid but does nothing else - redundant.

 > prec=1
Slope is calculated in radians (see ?rsaga.slope). So with a 0.1 radian 
increment (the smallest increment that can be represented with prec=1 
digits) you get 0.1 * 180 / pi = 5.7 degree increments on the degree 
scale - you probably want to haver a finer discretization. I would 
recommend prec=3 in the case of slope (and probably prec=6 or 7 for 
curvature attributes).

I hope this helps.

Cheers
  Alex


Tim Sippel wrote:
> I'm using RSAGA (version 0.9-4) to calculate rate of change (slope) on a
> series of .asc files.  I'm getting en error message saying it can't open the
> grid. My code follows:
> 
> library(RSAGA)
> # data directory containing my .asc files to calculate slope on
> wd.in<-"C:\\my.data.dir"
> setwd(wd.in)
> env<-rsaga.env(path="C:\\programs\\saga_vc", cmd="saga_cmd.exe")
> asc.list<-dir(wd.in, pattern='.asc$')
> for (i in asc.list) {
>   read.ascii.grid(i)
>   rsaga.esri.wrapper(fun=rsaga.slope, in.dem=i, method="maxslope",
> in.esri=T, out.esri=T, clean.up=T,
>   out.slope=c(paste("SLOPE",as.character(i),sep="")), env=env,
> esri.workspace=wd.in, format="ascii", georef="corner", prec=1)
>   }
> 
> Here are some of the data files in my directory from my asc.list object
> above:
> 
> asc.list
>  [1] "tmp1_220E-15N2005-03-02.asc"   "tmp10_220E-15N2005-05-13.asc"
> "tmp100_220E-15N2007-05-13.asc" "tmp101_220E-15N2007-05-21.asc"
>  [5] "tmp102_220E-15N2007-05-29.asc" "tmp103_220E-15N2007-06-06.asc"
> "tmp104_220E-15N2007-06-14.asc" "tmp105_220E-15N2007-06-22.asc"
> 
> The error I'm getting is below:
> 
> SAGA CMD 2.0.3
> library path:   C:\programs\saga_vc/modules
> library name:   ta_morphometry
> module name :   Local Morphometry
> author      :   (c) 2001 by O.Conrad
> Load grid: tmp1_220E-15N2005-03-02.asc...
> failed
> error: Grid file could not be opened.
> error: input file [tmp1_220E-15N2005-03-02.asc]
> error: executing module [Local Morphometry]
> 
> Not sure what I've done wrong in calling in the grid files and would
> appreciate advice.
> 
> Best regards,
> 
> Tim Sippel
> University of Auckland
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From cicaboo at gmail.com  Sun Mar  1 17:28:06 2009
From: cicaboo at gmail.com (Michel Barbosa)
Date: Sun, 1 Mar 2009 17:28:06 +0100
Subject: [R-sig-Geo] Point pattern analysis | Kernel estimation and
	GoogleMaps
In-Reply-To: <d8ad40b50902281526w24cba76fp2e9260ac7096c5cf@mail.gmail.com>
References: <f7f7b86f0902280756v1748fe07sb494d96b012531f5@mail.gmail.com>
	<A3EA804CA6F446429B6AEBB45558456301270E3B@HUGIN.uib.no>
	<f7f7b86f0902281517g2ef8bdceied6c2ca7e54af895@mail.gmail.com>
	<d8ad40b50902281526w24cba76fp2e9260ac7096c5cf@mail.gmail.com>
Message-ID: <f7f7b86f0903010828r56cf0e22gca2a255d44accaa@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090301/b5618a10/attachment.pl>

From cicaboo at gmail.com  Sun Mar  1 17:28:47 2009
From: cicaboo at gmail.com (Michel Barbosa)
Date: Sun, 1 Mar 2009 17:28:47 +0100
Subject: [R-sig-Geo] Point pattern analysis | Kernel estimation and
	Google Maps
In-Reply-To: <1235913459.7168.2.camel@Virgilio-Gomez>
References: <f7f7b86f0902280756v1748fe07sb494d96b012531f5@mail.gmail.com>
	<1235913459.7168.2.camel@Virgilio-Gomez>
Message-ID: <f7f7b86f0903010828k46f72f87q3e0b49934bfe6020@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090301/daba7ce4/attachment.pl>

From tsippel at gmail.com  Mon Mar  2 00:47:50 2009
From: tsippel at gmail.com (Tim Sippel)
Date: Mon, 2 Mar 2009 12:47:50 +1300
Subject: [R-sig-Geo] RSAGA .asc morphology loop question
In-Reply-To: <49AAAD21.9090804@uwaterloo.ca>
References: <79a13c220902251955w533f314ap6bd01559759e91f8@mail.gmail.com>
	<49AAAD21.9090804@uwaterloo.ca>
Message-ID: <79a13c220903011547p23611836rd2acce8217a69bb4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090302/4da7ea66/attachment.pl>

From brenning at uwaterloo.ca  Mon Mar  2 02:41:13 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Sun, 01 Mar 2009 20:41:13 -0500
Subject: [R-sig-Geo] RSAGA .asc morphology loop question
In-Reply-To: <79a13c220903011547p23611836rd2acce8217a69bb4@mail.gmail.com>
References: <79a13c220902251955w533f314ap6bd01559759e91f8@mail.gmail.com>	
	<49AAAD21.9090804@uwaterloo.ca>
	<79a13c220903011547p23611836rd2acce8217a69bb4@mail.gmail.com>
Message-ID: <49AB3939.9060109@uwaterloo.ca>

Hi,

this...

 > for (i in length(asc.files[i])) {

...only works if the variable i existed previously, and it seems that 
its value happened to be 1 in your case. It then counts from 
length(asc.files[i]) to length(asc.files[i]); asc.files[i] is a vector 
of length one (because i is 1), so the for loop goes from i=1 to i=1.

This is what you want to do:

 > for (i in 1:length(asc.files)) {

Cheers
  Alex


Tim Sippel wrote:
> Hi Alex-
> Thanks for the response, which helped me get a step closer to what I want.
> Now that I have removed the extensions from the files as you suggest, I am
> able to process one file, but am not able to process an entire directory of
> files.  Upon running a loop over all files in the directory, it only
> processes the first file and returns the calculated values (slope in my
> case).  However, there are 62 files in my directory and I'm at a loss for
> why I can't process all of them in my loop.  Sample code follows:
> 
> library(RSAGA)
> wd.in<-"C:\\my.dir"
> setwd(wd.in)
> env<-rsaga.env(path="C:\\programs\\saga_vc", cmd="saga_cmd.exe")
> asc.files<-dir(wd.in, pattern='.asc$')
> asc.files<-substr(basename(asc.files), 1, nchar(basename(asc.files)) - 4)
> 
>> asc.files
>  [1] "tmp1_220E-15N2005-03-02"   "tmp10_220E-15N2005-05-13"
> "tmp100_220E-15N2007-05-13" "tmp101_220E-15N2007-05-21"
> "tmp102_220E-15N2007-05-29"
> for (i in length(asc.files[i])) {
>   rsaga.esri.wrapper(fun=rsaga.slope, in.dem=asc.files[i],
> method="maxslope", in.esri=T, out.esri=T, clean.up=T,
>   out.slope=c(paste("SLOPE",asc.files[i],sep="")), env=env, esri.workspace=
> wd.in, format="ascii", georef="corner", prec=3)
>   }
> 
> This loop works, but only processes one file and stops.  My directory now
> includes the following files:
> 
>  [1] "SLOPEtmp1_220E-15N2005-03-02" "tmp1_220E-15N2005-03-02"
> "tmp10_220E-15N2005-05-13"     "tmp100_220E-15N2007-05-13"
> 
> Thanks again for suggestions on how to process the whole directory.
> 
> Tim Sippel
> 
> 
> 
> On Mon, Mar 2, 2009 at 4:43 AM, Alexander Brenning <brenning at uwaterloo.ca>wrote:
> 
>> Hi Tim,
>>
>> the rsaga.esri.wrapper currently expects the in.* and out.* arguments (with
>> the ASCII/float ESRI grids) to have NO file extension - the file extension
>> to be used for all ESRI grids can be given by the esri.extension argument;
>> it currently defaults to ".asc" when format="ascii" and to ".flt" when
>> format="binary". (Sorry that the help file is not explicit enough regarding
>> the file extensions; will add this to the next update.)
>>
>> Two more remarks on your code:
>>
>>>   read.ascii.grid(i)
>> This simply reads the grid but does nothing else - redundant.
>>
>>> prec=1
>> Slope is calculated in radians (see ?rsaga.slope). So with a 0.1 radian
>> increment (the smallest increment that can be represented with prec=1
>> digits) you get 0.1 * 180 / pi = 5.7 degree increments on the degree scale -
>> you probably want to haver a finer discretization. I would recommend prec=3
>> in the case of slope (and probably prec=6 or 7 for curvature attributes).
>>
>> I hope this helps.
>>
>> Cheers
>>  Alex
>>
>>
>> Tim Sippel wrote:
>>
>>>  I'm using RSAGA (version 0.9-4) to calculate rate of change (slope) on a
>>> series of .asc files.  I'm getting en error message saying it can't open
>>> the
>>> grid. My code follows:
>>>
>>> library(RSAGA)
>>> # data directory containing my .asc files to calculate slope on
>>> wd.in<-"C:\\my.data.dir"
>>> setwd(wd.in)
>>> env<-rsaga.env(path="C:\\programs\\saga_vc", cmd="saga_cmd.exe")
>>> asc.list<-dir(wd.in, pattern='.asc$')
>>> for (i in asc.list) {
>>>  read.ascii.grid(i)
>>>  rsaga.esri.wrapper(fun=rsaga.slope, in.dem=i, method="maxslope",
>>> in.esri=T, out.esri=T, clean.up=T,
>>>  out.slope=c(paste("SLOPE",as.character(i),sep="")), env=env,
>>> esri.workspace=wd.in, format="ascii", georef="corner", prec=1)
>>>  }
>>>
>>> Here are some of the data files in my directory from my asc.list object
>>> above:
>>>
>>> asc.list
>>>  [1] "tmp1_220E-15N2005-03-02.asc"   "tmp10_220E-15N2005-05-13.asc"
>>> "tmp100_220E-15N2007-05-13.asc" "tmp101_220E-15N2007-05-21.asc"
>>>  [5] "tmp102_220E-15N2007-05-29.asc" "tmp103_220E-15N2007-06-06.asc"
>>> "tmp104_220E-15N2007-06-14.asc" "tmp105_220E-15N2007-06-22.asc"
>>>
>>> The error I'm getting is below:
>>>
>>> SAGA CMD 2.0.3
>>> library path:   C:\programs\saga_vc/modules
>>> library name:   ta_morphometry
>>> module name :   Local Morphometry
>>> author      :   (c) 2001 by O.Conrad
>>> Load grid: tmp1_220E-15N2005-03-02.asc...
>>> failed
>>> error: Grid file could not be opened.
>>> error: input file [tmp1_220E-15N2005-03-02.asc]
>>> error: executing module [Local Morphometry]
>>>
>>> Not sure what I've done wrong in calling in the grid files and would
>>> appreciate advice.
>>>
>>> Best regards,
>>>
>>> Tim Sippel
>>> University of Auckland
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>> --
>> Alexander Brenning
>> brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
>> Department of Geography and Environmental Management
>> University of Waterloo
>> 200 University Ave. W - Waterloo, ON - Canada N2L 3G1
>> http://www.fes.uwaterloo.ca/geography/faculty/brenning/
>>
> 

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From gianni.lavaredo at gmail.com  Mon Mar  2 19:14:54 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 2 Mar 2009 19:14:54 +0100
Subject: [R-sig-Geo] HELP with RPyGeo and RSAGA slope function
Message-ID: <518dff330903021014p48a6af1fh637f95acee94379a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090302/03adac78/attachment.pl>

From gianni.lavaredo at gmail.com  Mon Mar  2 19:33:46 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 2 Mar 2009 19:33:46 +0100
Subject: [R-sig-Geo] Help with RPyGeo and RSAGA to SLOPE code
Message-ID: <518dff330903021033u7557652ao5986aff3e4f7c1be@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090302/3cba1d29/attachment.pl>

From brenning at uwaterloo.ca  Mon Mar  2 20:41:44 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Mon, 02 Mar 2009 14:41:44 -0500
Subject: [R-sig-Geo] HELP with RPyGeo and RSAGA slope function
In-Reply-To: <518dff330903021014p48a6af1fh637f95acee94379a@mail.gmail.com>
References: <518dff330903021014p48a6af1fh637f95acee94379a@mail.gmail.com>
Message-ID: <49AC3678.7050905@uwaterloo.ca>

Dear Gianni,

ArcGIS is not that flexible; it does not allow you to directly create an 
ASCII raster as an output of a geoprocessing tool. Try this to create an 
ESRI raster "SLOPE" and then convert the result to ASCII:

setwd("C:/work")
env = rpygeo.build.env(overwriteoutput = 1,
            workspace = getwd())
rpygeo.geoprocessor(fun = "ASCIIToRaster_conversion",
      args = list("DEM.asc","DEM"), env=env)
rpygeo.Slope.sa("DEM","SLOPE",unit="PERCENT_RISE", env=env)
rpygeo.geoprocessor(fun = "RasterToASCII_conversion",
      args = list("SLOPE","SLOPE.asc"), env=env)
rpygeo.Delete.management("DEM", env=env)
rpygeo.Delete.management("SLOPE", env=env)


Regarding the (much faster) RSAGA solution, try this:

setwd("C:/work")
rsaga.esri.to.sgrd("DEM")
rsaga.slope("DEM","SLOPErad")
# convert to slope in percent:
rsaga.grid.calculus("SLOPErad","SLOPE", formula="100*tan(a)")
rsaga.sgrd.to.esri("SLOPE", prec = 4)
unlink(c("SLOPErad.*", "SLOPE.?grd", "SLOPE.sdat",
            "DEM.?grd", "DEM.sdat"))

I hope this helps...

cheers
  Alex


P.S.: You could also you the following call for converting ESRI raster 
to ASCII...

rpygeo.RasterToASCII.conversion("C:/work/SLOPE","C:/work/SLOPE.asc")

using the following function that is included in the next release of 
RPyGeo (to be available in the next days):

rpygeo.RasterToASCII.conversion = function(in.raster,
	out.ascii.file, ...)
{
     out.ascii.file = default.file.extension(out.ascii.file, ".asc")
     if (!(tolower(get.file.extension(out.ascii.file)) %in% c(".asc",
         ".txt")))
         stop("'out.ascii.file' must have extension '.asc' or '.txt'.\n")
     args = list(in.raster, out.ascii.file)
     rpygeo.geoprocessor(fun = "RasterToASCII_conversion", args = args,
         ...)
}





gianni lavaredo wrote:
> Hi All,
> 
> I am using Alexander Brenning RPyGeo. I have a DEM.asc (ASCII File format)
> and I wish to obtaion SLOPE (possible always in ascii formta) in percent.
> But I have this problem:
> 
>  rpygeo.Slope.sa("C:/work/DEM.asc","C:/work/SLOPE.asc",unit=c("PERCENT_RISE"),
> z.factor = 1)
> [1] "Executing: Slope C:/work/DEM.asc C:\\work\\SLOPE.asc PERCENT_RISE
> 1"
> [2] "Start Time: Mon Mar 02 19:03:30
> 2009"
> [3] "Failed to execute. Parameters are not
> valid."
> [4] "Parameter : C:\\work\\SLOPE.asc's extension is invalid for the output
> raster format."
> [5] "Failed to execute
> (Slope)."
> [6] "End Time: Mon Mar 02 19:03:30 2009 (Elapsed Time: 0.00
> seconds)"
> 
> I tryed several solutions but nothing. I tryed also with RSAGA but I don't
> understand the right code to have in "percent".
> 
> 
> Thanks
> 
> Gianni.
> 
> PS: for Prof. Alexander Brenning. this geoprocessing expression runs in
> RpyGEO
> 
> rpygeo.geoprocessing("Intersect_analysis"
> c("C:/work/plots.shp;C:/work/sample.shp", "C:/work/right_sample.shp",
> "ALL"))
> but I need to load the datas from the work folder
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From gianni.lavaredo at gmail.com  Tue Mar  3 01:02:58 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 3 Mar 2009 01:02:58 +0100
Subject: [R-sig-Geo] testing DEM geoprocessing in RSAGA,
	SAGA GIS and ARCGIS: different of 	results in value range
Message-ID: <518dff330903021602t16adcea4y5036f7d6ec365f9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090303/b8237f64/attachment.pl>

From brenning at uwaterloo.ca  Tue Mar  3 02:41:05 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Mon, 02 Mar 2009 20:41:05 -0500
Subject: [R-sig-Geo] testing DEM geoprocessing in RSAGA,
 SAGA GIS and ARCGIS: different of 	results in value range
In-Reply-To: <518dff330903021602t16adcea4y5036f7d6ec365f9@mail.gmail.com>
References: <518dff330903021602t16adcea4y5036f7d6ec365f9@mail.gmail.com>
Message-ID: <49AC8AB1.60305@uwaterloo.ca>

It seems that SAGA GIS stores angles (slope, aspect) in internally 
radian, but it shows them in degrees when displaying them in the GUI of 
SAGA GIS. I noticed that once in the context of slope angles and was 
pretty puzzled... just do *180/pi to convert radian into degree.
   A.



gianni lavaredo wrote:
> Dear Professor,
> 
> Thanks for your competence and your work in RSAGA and Rypgeo. This packages
> are very useful and interesting.
> 
> I am testing different geoprocessing code in RSAGA, SAGA, Phyton and Rypgeo
> to see the results, but I noticed a singular situation. I am using this code
> to create SLOPE and ASPECT with DEM in RSAGA and see the difference in
> ARCGIS geoprocessing
> 
> rsaga.slope("DEM","SLOPErad")
> # convert to slope in percent:
> rsaga.grid.calculus("SLOPErad","SLOPE", formula="100*tan(a)")
> rsaga.sgrd.to.esri("SLOPE", prec = 4)
> rsaga.aspect("DEM","ASPECT")
> rsaga.sgrd.to.esri("ASPECT", prec= 4)
> 
> but there are some difference when I convert the ASPECT.sgrd in ASCII file.
> ex
> 
> ASPECT.sgrd: min value=  0.020869 max value =  360.00001
> (the same Value range I have in SAGA GIS or in ARCGIS)
> 
> ASPECT.asc: min value= 0.0004 max value= 6.2832
> 
> Thanks Again
> 
> Gianni
> 

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From j.burke at earthlink.net  Tue Mar  3 03:29:46 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Mon, 02 Mar 2009 20:29:46 -0600
Subject: [R-sig-Geo] Using the Z value for 3-D polygons?
Message-ID: <49AC961A.6020003@earthlink.net>

Hi Everyone,

QUESTION: How can I plot a spatial polygon (SpatialPolygonsDataFrame) as 
3-d? Perhaps using "spplot.polygons" with its z value?

GOAL: To have a series of polygons look like approximately like the last 
example in the PDF below.
http://ocw.mit.edu/NR/rdonlyres/Urban-Studies-and-Planning/11-521Spatial-Database-Management-and-Advanced-Geographic-Information-SystemsSpring2003/ACA80C9F-4089-403E-9669-50763381D08A/0/lect13c.pdf

EXAMPLE SUGGESTION: Use "spplot.pologons" with the venerable SourceForge 
NC fig21.R example and using its color coding values as the polygon $z 
value? Assuming lat and long are in the sp.
http://r-spatial.sourceforge.net/gallery/#fig21.R

Then if its not as straightforward as above, what would be the steps to 
convert a spatial polygon to points or something to graph that way?

Thanks,
Jim Burke


From edzer.pebesma at uni-muenster.de  Tue Mar  3 08:27:44 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 03 Mar 2009 08:27:44 +0100
Subject: [R-sig-Geo] Using the Z value for 3-D polygons?
In-Reply-To: <49AC961A.6020003@earthlink.net>
References: <49AC961A.6020003@earthlink.net>
Message-ID: <49ACDBF0.5070101@uni-muenster.de>

Jim,

I'm sorry that this not answer your question; refering to this graphic
gallery, I discovered that fig21 is no longer matches current states in
sp, so I updated the complete set on sourceforge (and the sources in
cvs, target spweb). For fig21, I also had to update the generating code,
as panels now need to have matching factor levels (to have a common scale).

Figures now look a little different here and there, as I changed from
using driver GDD to png, which, when using cairo, now also provides
anti-aliasing.
--
Edzer

Jim Burke wrote:
> Hi Everyone,
>
> QUESTION: How can I plot a spatial polygon (SpatialPolygonsDataFrame)
> as 3-d? Perhaps using "spplot.polygons" with its z value?
>
> GOAL: To have a series of polygons look like approximately like the
> last example in the PDF below.
> http://ocw.mit.edu/NR/rdonlyres/Urban-Studies-and-Planning/11-521Spatial-Database-Management-and-Advanced-Geographic-Information-SystemsSpring2003/ACA80C9F-4089-403E-9669-50763381D08A/0/lect13c.pdf
>
>
> EXAMPLE SUGGESTION: Use "spplot.pologons" with the venerable
> SourceForge NC fig21.R example and using its color coding values as
> the polygon $z value? Assuming lat and long are in the sp.
> http://r-spatial.sourceforge.net/gallery/#fig21.R
>
> Then if its not as straightforward as above, what would be the steps
> to convert a spatial polygon to points or something to graph that way?
>
> Thanks,
> Jim Burke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From pshayes at maine.rr.com  Tue Mar  3 15:08:45 2009
From: pshayes at maine.rr.com (Peter S. Hayes)
Date: Tue, 03 Mar 2009 09:08:45 -0500
Subject: [R-sig-Geo] 'Cleaning' unioned polygons using sp and maptools...
Message-ID: <49AD39ED.8000507@maine.rr.com>

Hi List,

Here's a question... I have a watershed polygon that has been 'tiled' 
into separate and non-overlapping cells according to a combination of 
attributes. The original watershed boundary seems not to be available in 
undivided form and I was interested in retrieving it from the divided 
shape file. Using ESRI resulted in several internal boundaries that were 
not removed. Using 'unionSpatialPolygons' produced even more non-removed 
internal boundaries.

Is there a simple means of 'cleaning' this to remove duplicate 
boundaries and no-longer-connected internal boundaries? I have looked a 
little (and admit to being a relative neophyte in using the packages) 
but haven't found anything that appears promising. I can certainly begin 
to appreciate the difficulty of finding and removing these boundaries, 
at least on a conceptual level... a problem in graph theory? (not at all 
my area...)

Thank you all!



Pete


From b.rowlingson at lancaster.ac.uk  Tue Mar  3 15:18:23 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 3 Mar 2009 14:18:23 +0000
Subject: [R-sig-Geo] 'Cleaning' unioned polygons using sp and maptools...
In-Reply-To: <49AD39ED.8000507@maine.rr.com>
References: <49AD39ED.8000507@maine.rr.com>
Message-ID: <d8ad40b50903030618j4f9ca57by673ee00cbbf6f235@mail.gmail.com>

2009/3/3 Peter S. Hayes <pshayes at maine.rr.com>:
> Hi List,
>
> Here's a question... I have a watershed polygon that has been 'tiled' into
> separate and non-overlapping cells according to a combination of attributes.
> The original watershed boundary seems not to be available in undivided form
> and I was interested in retrieving it from the divided shape file. Using
> ESRI resulted in several internal boundaries that were not removed. Using
> 'unionSpatialPolygons' produced even more non-removed internal boundaries.
>
> Is there a simple means of 'cleaning' this to remove duplicate boundaries
> and no-longer-connected internal boundaries? I have looked a little (and
> admit to being a relative neophyte in using the packages) but haven't found
> anything that appears promising. I can certainly begin to appreciate the
> difficulty of finding and removing these boundaries, at least on a
> conceptual level... a problem in graph theory? (not at all my area...)

 Just trying to get this clear - there is an irregular simple (no
islands or holes) polygon that defines the watershed, but what you've
actually got is a number of polygons that divide the polygon into
cells. The polygon you want is the external boundary of the cells?

 What ESRI tool did you use? Any idea why it failed? Anything special
about those boundaries? Some tolerance value exceeded?

 I think a picture speaks a thousand words here - any chance you could
upload an image showing the boundaries and what you want dissolved?

 Images sent to the list might get stripped out, so maybe use a
temporary image bin site:

http://imagebin.org/

 or something like google docs...

Barry


From marion.tafani at cebc.cnrs.fr  Tue Mar  3 16:09:19 2009
From: marion.tafani at cebc.cnrs.fr (Marion TAFANI)
Date: Tue, 03 Mar 2009 16:09:19 +0100
Subject: [R-sig-Geo] minimun distance between polygons' edges
Message-ID: <49AD481F.5040409@cebc.cnrs.fr>

dear all,

we want to calculate the minimun distance between polygons' edges , do 
you know any package or function which can help us ? we try to work with 
vectors rather than raster but we lack some tools. we only found how to 
calculate distances between centroids but nothing between edges.

thanks



__________ Information from ESET Mail Security, version of virus signature database 3904 (20090303) __________

The message was checked by ESET Mail Security.
http://www.eset.com


From gianni.lavaredo at gmail.com  Tue Mar  3 16:25:24 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 3 Mar 2009 16:25:24 +0100
Subject: [R-sig-Geo] RPyGeo: merge geoprocessing problems with
	"field_mappings" option
Message-ID: <518dff330903030725g4189893fl92fa9a53191ad5e4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090303/b4973b7e/attachment.pl>

From torleif.lunde at cih.uib.no  Tue Mar  3 16:58:08 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Tue, 3 Mar 2009 16:58:08 +0100
Subject: [R-sig-Geo] Using the Z value for 3-D polygons?
In-Reply-To: <49AC961A.6020003@earthlink.net>
References: <49AC961A.6020003@earthlink.net>
Message-ID: <200903031658.08358.torleif.lunde@cih.uib.no>

Not exactly what you are looking for, but at least an attempt. Guess you could 
also look at the rgl package (never worked for me on Fedora) or misc3d. 
Modifying the functions could give you what you want.


require(maptools)
nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
proj4string=CRS("+proj=longlat +datum=NAD27"))

for (i in 1:length(nc at data$NWBIR79)) {
  zv <- rep(nc at data$NWBIR79[i], length(nc at polygons[[i]]@Polygons[[1]]@coords))
  xy <- nc at polygons[[i]]@Polygons[[1]]@coords
  colnames(xy)  <- c("x", "y")
  xyz.tmp <- cbind(xy, zv)
  if (i == 1) xyz <- xyz.tmp else xyz <- rbind(xyz, xyz.tmp)
}


#install.packages(c("R.basic"), contriburl="http://www.braju.com/R/repos/")
require(R.basic)
xyz <- data.frame(xyz)
with(xyz, plot3d(x, y, zv, type="n", theta=35, phi=30))


un <- unique(xyz$zv)
my.colors <- colorRampPalette(c("green", "blue", "red"))
mypalette <- my.colors(100)

for (i in 1:length(un)) {
  with(xyz, polygon3d(x[zv==un[i]],y[zv==un[i]],zv[zv==un[i]], 			           
col=mypalette[i]))
}

Good luck
Torleif


On Tuesday 03 March 2009 03:29:46 am Jim Burke wrote:
> Hi Everyone,
>
> QUESTION: How can I plot a spatial polygon (SpatialPolygonsDataFrame) as
> 3-d? Perhaps using "spplot.polygons" with its z value?
>
> GOAL: To have a series of polygons look like approximately like the last
> example in the PDF below.
> http://ocw.mit.edu/NR/rdonlyres/Urban-Studies-and-Planning/11-521Spatial-Da
>tabase-Management-and-Advanced-Geographic-Information-SystemsSpring2003/ACA8
>0C9F-4089-403E-9669-50763381D08A/0/lect13c.pdf
>
> EXAMPLE SUGGESTION: Use "spplot.pologons" with the venerable SourceForge
> NC fig21.R example and using its color coding values as the polygon $z
> value? Assuming lat and long are in the sp.
> http://r-spatial.sourceforge.net/gallery/#fig21.R
>
> Then if its not as straightforward as above, what would be the steps to
> convert a spatial polygon to points or something to graph that way?
>
> Thanks,
> Jim Burke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From bibiko at eva.mpg.de  Tue Mar  3 17:32:41 2009
From: bibiko at eva.mpg.de (=?ISO-8859-1?Q?Hans-J=F6rg_Bibiko?=)
Date: Tue, 3 Mar 2009 17:32:41 +0100
Subject: [R-sig-Geo] SpatialLines to SpatialPolygons convertion
Message-ID: <5A0DBF01-2C51-4156-A23B-95A1F06AA39C@eva.mpg.de>

Hi,

I have a short question.
Is there any workaround available which tries to convert a list of  
SpatialLines to a list of SpatialPolygons objects?

In my case I have a list of Lines objects coming from a gshhs  
(shorelines) file. The list represents 8 polygons of a given xlim/ 
ylim. Now I'd like to convert the list into 8 polygons in order to  
draw them filled out.

I could do it 'manually' and try close these lines heuristically but  
maybe there's already such a workaround available.

Thanks for any hint in advance!

--Hans

PS The new maptools release is really nice :) Thanks!


From Torleif.Lunde at cih.uib.no  Tue Mar  3 18:30:01 2009
From: Torleif.Lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Tue, 3 Mar 2009 18:30:01 +0100
Subject: [R-sig-Geo] SpatialLines to SpatialPolygons convertion
References: <5A0DBF01-2C51-4156-A23B-95A1F06AA39C@eva.mpg.de>
Message-ID: <A3EA804CA6F446429B6AEBB45558456301270E3E@HUGIN.uib.no>

Hi 
 
A workaround could be to use Rgshhs or the modified version suggested in https://stat.ethz.ch/pipermail/r-sig-geo/2009-February/005157.html 
 
Best wishes
Torleif

________________________________

Fra: r-sig-geo-bounces at stat.math.ethz.ch p? vegne av Hans-J?rg Bibiko
Sendt: ti 03.03.2009 17:32
Til: R-sig-Geo at stat.math.ethz.ch
Emne: [R-sig-Geo] SpatialLines to SpatialPolygons convertion



Hi,

I have a short question.
Is there any workaround available which tries to convert a list of 
SpatialLines to a list of SpatialPolygons objects?

In my case I have a list of Lines objects coming from a gshhs 
(shorelines) file. The list represents 8 polygons of a given xlim/
ylim. Now I'd like to convert the list into 8 polygons in order to 
draw them filled out.

I could do it 'manually' and try close these lines heuristically but 
maybe there's already such a workaround available.

Thanks for any hint in advance!

--Hans

PS The new maptools release is really nice :) Thanks!

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Henk.Sierdsema at sovon.nl  Tue Mar  3 18:41:34 2009
From: Henk.Sierdsema at sovon.nl (Henk Sierdsema)
Date: Tue, 3 Mar 2009 18:41:34 +0100
Subject: [R-sig-Geo] SpatialLines to SpatialPolygons convertion
In-Reply-To: <5A0DBF01-2C51-4156-A23B-95A1F06AA39C@eva.mpg.de>
Message-ID: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDB6F9@mail.sovon.nl>

Hi Hans,

Please have a look at paragraph 2.6 (page 41) on spatial polygons in the ASDAR-book. Here you will find an example of converting a shoreline into polygons.

Henk



Henk Sierdsema

SOVON Vogelonderzoek Nederland / SOVON Dutch Centre for Field Ornithology

Rijksstraatweg 178
6573 DG  Beek-Ubbergen
The Netherlands
tel: +31 (0)24 6848145
fax: +31 (0)24 6848122



-----Oorspronkelijk bericht-----
Van: Hans-J?rg Bibiko [mailto:bibiko at eva.mpg.de]
Verzonden: dinsdag 3 maart 2009 17:33
Aan: R-sig-Geo at stat.math.ethz.ch
Onderwerp: [R-sig-Geo] SpatialLines to SpatialPolygons convertion


Hi,

I have a short question.
Is there any workaround available which tries to convert a list of  
SpatialLines to a list of SpatialPolygons objects?

In my case I have a list of Lines objects coming from a gshhs  
(shorelines) file. The list represents 8 polygons of a given xlim/ 
ylim. Now I'd like to convert the list into 8 polygons in order to  
draw them filled out.

I could do it 'manually' and try close these lines heuristically but  
maybe there's already such a workaround available.

Thanks for any hint in advance!

--Hans

PS The new maptools release is really nice :) Thanks!

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alinashe at gmail.com  Tue Mar  3 20:49:47 2009
From: alinashe at gmail.com (Alina Sheyman)
Date: Tue, 3 Mar 2009 14:49:47 -0500
Subject: [R-sig-Geo] mapping by zip codes
Message-ID: <f58db2700903031149l3dd2adcci8cdf2d8fa9144464@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090303/5b71bbf2/attachment.pl>

From valcu at orn.mpg.de  Tue Mar  3 21:18:41 2009
From: valcu at orn.mpg.de (Mihai Valcu)
Date: Tue, 03 Mar 2009 21:18:41 +0100
Subject: [R-sig-Geo] minimun distance between polygons' edges
In-Reply-To: <49AD481F.5040409@cebc.cnrs.fr>
References: <49AD481F.5040409@cebc.cnrs.fr>
Message-ID: <49AD90A1.9040109@orn.mpg.de>


You could approach it as a minimum distance between points problem.
With sp,  first convert each SpatialPolygons to SpatialLines,  generate 
regular points on each line and then compute minimum dist between all 
points. Obviously, there is a trade off  between the number of points 
and precision.

Something like this:

require(sp)

# 1st  "polygon"
p1 = SpatialLines(list(Lines(list(Line(cbind(c(10.92, 8.13, 17.12, 
29.97, 31.06, 25.95, 20.21,10.92),
c(86.56, 73.24, 59.75, 67.54, 75.84, 86.39, 95.04,86.56) ))))))

# 2nd "polygon"
p2 = SpatialLines(list(Lines(list(Line(cbind(c(41.75, 35.55, 42.68, 
53.99, 60.96, 58.94, 53.21,41.75),
c(66.5, 53.87, 41.07, 42.11, 51.62, 64.77, 67.36,66.5)))))))

plot(1:100, type = "n")
plot(p1, add = T)
plot(p2, add = T)


# regular  sampling on each polygon
n = 500
p1.pts = spsample(p1, n = n, type = "regular")
p2.pts = spsample(p2, n = n, type = "regular")

# minimun distance between polygons' edges
min(apply(coordinates(p1.pts), 1, function(p) 
spDistsN1(coordinates(p2.pts), p )))


...
Mihai





Marion TAFANI wrote:
> dear all,
>
> we want to calculate the minimun distance between polygons' edges , do 
> you know any package or function which can help us ? we try to work 
> with vectors rather than raster but we lack some tools. we only found 
> how to calculate distances between centroids but nothing between edges.
>
> thanks
>
>
>
> __________ Information from ESET Mail Security, version of virus 
> signature database 3904 (20090303) __________
>
> The message was checked by ESET Mail Security.
> http://www.eset.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-


From ksafi at orn.mpg.de  Tue Mar  3 21:21:01 2009
From: ksafi at orn.mpg.de (Kamran Safi)
Date: Tue, 03 Mar 2009 21:21:01 +0100
Subject: [R-sig-Geo] SpatialLines to SpatialPolygons convertion
In-Reply-To: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDB6F9@mail.sovon.nl>
References: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDB6F9@mail.sovon.nl>
Message-ID: <49AD912D.20303@orn.mpg.de>

Hi all,

I was just wasting the last two days fiddling around this problem. I 
ended up using maptools and PBSmapping with SpatialLines2PolySet() and 
then PolySet2SpatialPolygons() to work around this problem. I don't know 
why this has to be so complicated. But I was also struggling with 
different projections, so you might find this solution easy...

Hope this helps.

Kami
-- 
Kamran Safi

Max Planck Institute for Ornithology
Vogelwarte Radolfzell
Schlossallee 2
78315 Radolfzell
Germany

and

Institute of Zoology
Zoological Society of London
Regent's Park
NW1 4RY London
United Kingdom


Henk Sierdsema schrieb:
> Hi Hans,
>
> Please have a look at paragraph 2.6 (page 41) on spatial polygons in the ASDAR-book. Here you will find an example of converting a shoreline into polygons.
>
> Henk
>
>
>
> Henk Sierdsema
>
> SOVON Vogelonderzoek Nederland / SOVON Dutch Centre for Field Ornithology
>
> Rijksstraatweg 178
> 6573 DG  Beek-Ubbergen
> The Netherlands
> tel: +31 (0)24 6848145
> fax: +31 (0)24 6848122
>
>
>
> -----Oorspronkelijk bericht-----
> Van: Hans-J?rg Bibiko [mailto:bibiko at eva.mpg.de]
> Verzonden: dinsdag 3 maart 2009 17:33
> Aan: R-sig-Geo at stat.math.ethz.ch
> Onderwerp: [R-sig-Geo] SpatialLines to SpatialPolygons convertion
>
>
> Hi,
>
> I have a short question.
> Is there any workaround available which tries to convert a list of  
> SpatialLines to a list of SpatialPolygons objects?
>
> In my case I have a list of Lines objects coming from a gshhs  
> (shorelines) file. The list represents 8 polygons of a given xlim/ 
> ylim. Now I'd like to convert the list into 8 polygons in order to  
> draw them filled out.
>
> I could do it 'manually' and try close these lines heuristically but  
> maybe there's already such a workaround available.
>
> Thanks for any hint in advance!
>
> --Hans
>
> PS The new maptools release is really nice :) Thanks!
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>   


-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3275 bytes
Desc: S/MIME Cryptographic Signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090303/bd26e82e/attachment.bin>

From bibiko at eva.mpg.de  Tue Mar  3 21:34:08 2009
From: bibiko at eva.mpg.de (=?ISO-8859-1?Q?Hans-J=F6rg_Bibiko?=)
Date: Tue, 3 Mar 2009 21:34:08 +0100
Subject: [R-sig-Geo] SpatialLines to SpatialPolygons convertion
In-Reply-To: <49AD912D.20303@orn.mpg.de>
References: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDB6F9@mail.sovon.nl>
	<49AD912D.20303@orn.mpg.de>
Message-ID: <0EBFC28C-8373-4047-AFAB-E48EEA2D101C@eva.mpg.de>

Thanks a lot for the hints. I'll try them.

Kind regards

--Hans


**********************************************************
Hans-Joerg Bibiko
Max Planck Institute for Evolutionary Anthropology
Department of Linguistics
Deutscher Platz 6     phone:   +49 (0) 341 3550 341
D-04103 Leipzig       fax:     +49 (0) 341 3550 333
Germany               e-mail:  bibiko at eva.mpg.de


From p.hiemstra at geo.uu.nl  Tue Mar  3 21:40:57 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 03 Mar 2009 21:40:57 +0100
Subject: [R-sig-Geo] mapping by zip codes
In-Reply-To: <f58db2700903031149l3dd2adcci8cdf2d8fa9144464@mail.gmail.com>
References: <f58db2700903031149l3dd2adcci8cdf2d8fa9144464@mail.gmail.com>
Message-ID: <49AD95D9.6020005@geo.uu.nl>

Hi,

You have to provide some more info in order for us to answer you 
question. How does 'your data' look like? A data.frame with x and y 
coordinates and more info? If this is correct, you need to convert the 
xy data.frame to a spatial object:

library(sp)
data(meuse) # data.frame
# The columns with the x and y coordinates are called "x" and "y"
coordinates(meuse) = ~x+y # SpatialPointsDataFrame

Then you can use overlay() to find out in which customer is in which 
polygon. Then you can count the number of customers per zip code.

cheers,
Paul

Alina Sheyman schreef:
> I'm very new to creating maps using shapefiles, so this question might be
> pretty basic.
>
> I'm trying to create a map of the US, divided up by zip codes, where i then
> map number of customers by zip code.
> I located shapefiles for US with zip codes (although at this point only for
> individual states, and not the entire country) and read it into R using
> maptools,
> but now I need to apply my data (which I read into R as a separate data
> frame and not a shapefile) to that map. Which is the part where I get
> completely lost and not sure how to proceed. If anyone could give me any
> pointers I'd really appreciate it.
>
> thank you
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From T.Hengl at uva.nl  Tue Mar  3 22:18:29 2009
From: T.Hengl at uva.nl (Hengl, T.)
Date: Tue, 3 Mar 2009 22:18:29 +0100
Subject: [R-sig-Geo] mapping by zip codes
References: <f58db2700903031149l3dd2adcci8cdf2d8fa9144464@mail.gmail.com>
Message-ID: <37382E8DCB905042969BA78541F65706754225@kwek.ic.uva.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090303/997d4b5c/attachment.pl>

From j.burke at earthlink.net  Tue Mar  3 23:21:52 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Tue, 03 Mar 2009 16:21:52 -0600
Subject: [R-sig-Geo] mapping by zip codes
In-Reply-To: <37382E8DCB905042969BA78541F65706754225@kwek.ic.uva.nl>
References: <f58db2700903031149l3dd2adcci8cdf2d8fa9144464@mail.gmail.com>
	<37382E8DCB905042969BA78541F65706754225@kwek.ic.uva.nl>
Message-ID: <49ADAD80.7060401@earthlink.net>

Hi Tom and everyone,

First, Tom an excellent little google website you pointed out!


Then below is what I have used to merge and have fun with data frames.
My apologies in advance, Netscape Communicator will likely forget
some line feeds.

##############################
# . read in your basic state zip file with whatever columns
##############################
state_alldata_df <- read.csv ("state_info.csv", header = TRUE, sep = ",")

##############################
# . get one small state to experiment with WY has about 550,000 people 
and 23 counties
#   people and likely fewer zip codes.
# . assuming your state file has  state abbreviation as
#   ST_ABBREV, ST_NAME, and ZIP, CUST_CNT plus other non needed cols.
# . in the example below, we drop ST_ABBREV in the second data frame
##############################
wy_df <- state_alldata_df[state_alldata_df$ST_ABBREV=="WY", 
c("STATE_NAME", "ZIP", "CUST_CNT")]
remove(state_alldata_df) # clean up data frames we don't need
names(wy_df)             # list data frame columns

##############################
# . read in the shapefile see below for more general info, especially 
the 1st line readShapePoly code
# . you can also get more read shapefile examples from r-spatial.source 
forge below
# . 
http://www.nceas.ucsb.edu/scicomp/GISSeminar/UseCases/PolygonDissolve/PolygonDissolve.html
##############################
library(sp)
library(maptools)         # for geospatial services; automatically loads 
foreign and sp
library(rgdal)            # for map projection support; automatically 
loads sp
library(PBSmapping)       # for GIS_like geospatial object manipulation 
/ analysis including poly
zip1_sp <- readShapePoly("allstates.shp", IDvar="ZIP", 
proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
names(zip1_sp)            # list spatial data frame columns, it has lots 
of other info besides cols

###########################################################
# . good explanation
#   http://www.ats.ucla.edu/stat/R/modules/subsetting.htm
# . select all cols from wy_df by default, so your $CUST_CNT is here
###########################################################
zip2_sp <- zip1_sp [zip1_sp$ZIP %in% wy_df$ZIP,]
names(zip2_sp)            # list spatial data frame columns
sapply(slot(zip2_sp, "polygons"), function(x) slot(x, "ID")) # what are 
the sp "ID"s?

###########################################################
# . plotting time. Example code from
#   http://r-spatial.sourceforge.net/gallery/#fig13.R
###########################################################
plot(zip2_sp)
invisible(text(getSpPPolygonsLabptSlots(zip2_sp), 
labels=as.character(zip2_sp$CUST_CNT), cex=0.4))
title("Wyoming Customer count", sub = "Something at the bottom of the 
graph",
      cex.main = 2,   font.main= 4, col.main= "blue",
      cex.sub = 0.75, font.sub = 3, col.sub = "red")


Hope this helps, now back to myself figuring out "spplot.polygons"
Jim Burke


Hengl, T. wrote:
>  
> Dear Alina,
>  
> If you load two datasets to R and you want to merge them via some key (e.g. zip code), you have to consider using the "merge" method e.g.:
>  
>   
>> spdata <- merge(x=data.frame(ZIP=zipshape$ZIP, X=zipshape$X, Y=zipshape$Y), y=data.frame(ZIP=customers$ZIP, V=customers$V), by=ZIP, all.y=F)
>> coordinates(merge) <-~X+Y
>>     
>  
> You could also consider using the Google service to geocode the addresses (I do not know how accurate is your US zip shape file, Google data is pretty accurate).
>  
> You should be able to figure out from this example what you have to do automate retrieval of coordinates from addresses:
>  
> http://spatial-analyst.net/wiki/index.php?title=Mapping_research_hot-spots#Geocoding_addresses
>  
>  
> HTH
>  
> Tom Hengl
>  
>  
>
> ________________________________
>
> From: r-sig-geo-bounces at stat.math.ethz.ch on behalf of Alina Sheyman
> Sent: Tue 3/3/2009 8:49 PM
> To: R-sig-Geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] mapping by zip codes
>
>
>
> I'm very new to creating maps using shapefiles, so this question might be
> pretty basic.
>
> I'm trying to create a map of the US, divided up by zip codes, where i then
> map number of customers by zip code.
> I located shapefiles for US with zip codes (although at this point only for
> individual states, and not the entire country) and read it into R using
> maptools,
> but now I need to apply my data (which I read into R as a separate data
> frame and not a shapefile) to that map. Which is the part where I get
> completely lost and not sure how to proceed. If anyone could give me any
> pointers I'd really appreciate it.
>
> thank you
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


From torleif.lunde at cih.uib.no  Wed Mar  4 00:20:56 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Wed, 4 Mar 2009 00:20:56 +0100
Subject: [R-sig-Geo] Using the Z value for 3-D polygons?
In-Reply-To: <49AC961A.6020003@earthlink.net>
References: <49AC961A.6020003@earthlink.net>
Message-ID: <200903040020.57179.torleif.lunde@cih.uib.no>

Still not as good as it should be, but at least a try. Some of the code could 
be a lot more efficient, but I guess you could use this as a template:


require(maptools)
nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
proj4string=CRS("+proj=longlat +datum=NAD27"))

for (i in 1:length(nc at data$NWBIR79)) {
  zv <- rep(nc at data$NWBIR79[i], length(nc at polygons[[i]]@Polygons[[1]]@coords))
  xy <- nc at polygons[[i]]@Polygons[[1]]@coords
  colnames(xy)  <- c("x", "y")
  xyz.tmp <- cbind(xy, zv)
  if (i == 1) xyz <- xyz.tmp else xyz <- rbind(xyz, xyz.tmp)
}


#install.packages(c("R.basic"), contriburl="http://www.braju.com/R/repos/")
require(R.basic)
xyz <- data.frame(xyz)
with(xyz, plot3d(x,y,zv, type="n", theta=35, phi=30))


un <- unique(xyz$zv)
my.colors <- colorRampPalette(c("green", "blue", "red"))
mypalette <- rev(my.colors(100))

for (ii in 1:length(un)) {
  a <- un[ii]
  b <- data.frame(x=xyz$x[xyz$zv==a], y=xyz$y[xyz$zv==a], 
zv=xyz$zv[xyz$zv==a])
  for (iii in 1:length(b$x)) {
    if (iii != length(b$x)) {
      ab <- b[iii:(iii+1),] 
      } else ab <- rbind(b[iii,], b[1,])
    ab <- rbind(ab, ab[2,], ab[1,])
    ab[3:4,3] <- 0
    ab$uni <- iii
    ab$group <- ii
    if (iii == 1) out <- ab else out <- rbind(out, ab)
   }
  if (ii == 1) p.out <- out else p.out <- rbind(p.out, out)
}

p.out$uni <- as.integer(rep(1:(length(p.out$uni)/4), each = 4))

length(p.out$x)
iv1 <- 1
while (iv1 <=  length(p.out$x)) {
  for (i in iv.1:(iv1+2460)) {
  with(p.out, polygon3d(x[uni==i], y[uni==i], zv[uni==i], border = NULL, 
lty=1, col="green"))# or mypalette[group[(i+]]))
  }
iv1 <- iv1+2460
}

for (i in 1:length(un)) {
with(xyz, polygon3d(x[zv==un[i]],y[zv==un[i]],zv[zv==un[i]], col = "green")) # 
or col=mypalette[i]))
}




On Tuesday 03 March 2009 03:29:46 am Jim Burke wrote:
> Hi Everyone,
>
> QUESTION: How can I plot a spatial polygon (SpatialPolygonsDataFrame) as
> 3-d? Perhaps using "spplot.polygons" with its z value?
>
> GOAL: To have a series of polygons look like approximately like the last
> example in the PDF below.
> http://ocw.mit.edu/NR/rdonlyres/Urban-Studies-and-Planning/11-521Spatial-Da
>tabase-Management-and-Advanced-Geographic-Information-SystemsSpring2003/ACA8
>0C9F-4089-403E-9669-50763381D08A/0/lect13c.pdf
>
> EXAMPLE SUGGESTION: Use "spplot.pologons" with the venerable SourceForge
> NC fig21.R example and using its color coding values as the polygon $z
> value? Assuming lat and long are in the sp.
> http://r-spatial.sourceforge.net/gallery/#fig21.R
>
> Then if its not as straightforward as above, what would be the steps to
> convert a spatial polygon to points or something to graph that way?
>
> Thanks,
> Jim Burke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From brenning at uwaterloo.ca  Wed Mar  4 03:10:22 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Tue, 03 Mar 2009 21:10:22 -0500
Subject: [R-sig-Geo] RPyGeo: merge geoprocessing problems
 with	"field_mappings" option
In-Reply-To: <518dff330903030725g4189893fl92fa9a53191ad5e4@mail.gmail.com>
References: <518dff330903030725g4189893fl92fa9a53191ad5e4@mail.gmail.com>
Message-ID: <49ADE30E.6030407@uwaterloo.ca>

Dear Gianni,

I haven't used the Merge_management tool in ArcGIS, but after having a 
look at ESRI's documentation...

http://webhelp.esri.com/arcgisdesktop/9.2/index.cfm?TopicName=Merge_(Data_Management)

...it seems to me that field_mappings is not just a character string but 
an object of the class "FieldMappings":

http://webhelp.esri.com/arcgisdesktop/9.2/index.cfm?id=812&pid=785&topicname=FieldMappings_properties

This is not something that would be easily addressed from within R, 
you'd better just use Python directly if you want to automate this with 
ArcGIS Geoprocessing tools.

Cheers
  Alex



gianni lavaredo wrote:
> Hi All
> 
> I am testing RPyGeo (old version) developed to Prof. Alexander Brenning.  I
> wish to merge three points shapefile each with this database: ID, X, Y, V.
> The Scripting syntax in Python is "Merge_management (inputs, output,
> field_mappings)", where  with "field_mappings" (Optional) I can chose the
> output shapefile fields. I am trying in R+ RPyGeo with different code but
> always I have the right result but with all 4 fields.
> 
> 
> 
> rpygeo.geoprocessor("Merge_management",
> c("C:\\work\\point1.shp;C:\\work\\point2.shp;C:\\work\\point3.shp","C:\\work\\point_merge.shp"),
> "field_mappings:ID;V")
> 
> 
> 
> thanks in advance
> 
> Gianni
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From ya-cine at hotmail.com  Wed Mar  4 08:42:03 2009
From: ya-cine at hotmail.com (yacine kouba)
Date: Wed, 4 Mar 2009 07:42:03 +0000
Subject: [R-sig-Geo] Area Under the ROC curve (AUC)
Message-ID: <BAY114-W5545003DEC48DD883C6506FBA70@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090304/181066e1/attachment.pl>

From p.hiemstra at geo.uu.nl  Wed Mar  4 12:00:56 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 04 Mar 2009 12:00:56 +0100
Subject: [R-sig-Geo] Area Under the ROC curve (AUC)
In-Reply-To: <BAY114-W5545003DEC48DD883C6506FBA70@phx.gbl>
References: <BAY114-W5545003DEC48DD883C6506FBA70@phx.gbl>
Message-ID: <49AE5F68.3090402@geo.uu.nl>

Hi Yacine,

I'm not really sure why you sent this to the r-sig-geo. Not that your 
question isn't welcome, but you might get more response on the r-help 
list. You could look at the Baysian Task View 
(http://cran.r-project.org/web/views/Bayesian.html) for the packages in 
R that deal with Baysian inference.

cheers,
Paul

yacine kouba wrote:
> Dear all,
> we want to simulate de area under the ROC curve ?AUC? for Bayesian Model Averaging (BMA), do you know any package or functions which can help us? 
>  
> Thanks
>  
> Yacine
> _________________________________________________________________
> [[elided Hotmail spam]]
>
> 	[[alternative HTML version deleted]]
>
>   
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From chuanwen9302 at yahoo.com  Wed Mar  4 14:56:26 2009
From: chuanwen9302 at yahoo.com (Chuanwen Chen)
Date: Wed, 4 Mar 2009 05:56:26 -0800 (PST)
Subject: [R-sig-Geo] point and click visualization of data
Message-ID: <535940.23229.qm@web33404.mail.mud.yahoo.com>


Dear all,

I am not sure if this question is related to spatial analysis or not. 
I searched CRAN task View, it seems this is the only place.

The data we are working on is multivariate data, where each observation has p features(variables). For each observation, all features are computed/subtract from a picture, i.e., one observation correspondents to one picture, which is then summarized by a p-dimension vector( features). 

Now in a x-y plot of two features ( variables), we want to click or select some observations, could it possible to bring up the correspondent pictures of those observations ? In R, I know identify() function. But here we want to bring up the pictures. Any package can do this ?

Thank you very much for your time!
Chuanwen


From knussear at mac.com  Wed Mar  4 20:07:16 2009
From: knussear at mac.com (Ken Nussear)
Date: Wed, 04 Mar 2009 11:07:16 -0800
Subject: [R-sig-Geo] imaging geoRglm binomial krig
Message-ID: <1898D59A-04AF-4625-B19C-E8DACA88A133@mac.com>

Hi

Wondering if anyone has had success imaging a krige produced  using  
geoRglm?

The dataset has 3467 locations....

Here is the code used to build the krige and attempted image.

itdsglm1 <- trend.spatial(~TRAN_LNTH + Maxent + HWYS_Dist2 + MDEP +   
pop, WMgeo.Sign)

itlsglm1 <- trend.spatial(~TRAN_LNTH + Maxent + HWYS_Dist2 + MDEP +   
pop, WMgeo.kriglocs)

kmod <- model.glm.control(trend.d = itdsglm1, trend.l = itlsglm1,  
cov.model = "exponential")

kprior <- prior.glm.control(beta.prior = "flat", sigmasq.prior =  
"fixed", sigmasq= 0.0307, phi.prior = "fixed", phi = 7748,  
phi.discrete = NULL, tausq.rel = 5.276)


bkcontrl <- mcmc.control(S.scale = .07, thin=40, phi.start= 7748,  
phi.scale = .2, burn.in=10)
kgout <- output.glm.control(sim.posterior=T, sim.predict=T,  
keep.mcmc.sim=T, inference=T, messages=T, quantile=c(0.25,0.5,0.975))


bkb <- binom.krige.bayes(WMgeo.Sign, locations = WMgeo.kriglocs 
$coords,  model= kmod, mcmc.input= bkcontrl, prior=kprior)

image(bkb, locations=WMgeo.kriglocs$coords,  
values.to.plot='simulation', number.col=1, messates=T)



image.glm.krige.bayes(bkb, locations=WMgeo.kriglocs$coords,  
values.to.plot=c("median"), number.col=1, coords.data=WMgeo.kriglocs 
$coords, x.leg=c(410312,561312), y.leg=c(3822651,3920651), messages=T)




I get the following errors and I can't figure out what it wants....


mapping the medians of the predictive distribution
Error in image.default(x = c(410311.919949, 411311.919949,  
412311.919949,  :
  dimensions of z are not length(x)(-1) times length(y)(-1)
In addition: Warning messages:
1: In if (coords.data) coords.data <- eval(attr(x, "data.locations")) :
  the condition has length > 1 and only the first element will be used
2: In matrix(values.loc, ncol = ny) :
  data length [3467] is not a sub-multiple or multiple of the number  
of rows [36]



Ken


From J.vanEtten at cgiar.org  Thu Mar  5 01:31:51 2009
From: J.vanEtten at cgiar.org (van Etten, Jacob (IRRI))
Date: Thu, 5 Mar 2009 08:31:51 +0800
Subject: [R-sig-Geo] point and click visualization of data
In-Reply-To: <535940.23229.qm@web33404.mail.mud.yahoo.com>
References: <535940.23229.qm@web33404.mail.mud.yahoo.com>
Message-ID: <AFBF317E3DEC0B43BF750B4618EBFA0D0110C72E@HERMES>

Dear Chuanwen

You could write a new function around identify() that looks for the
observation ID, looks up the corresponding picture and plots it. None of
the spatial packages will do this automagically.

Jacob

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Chuanwen Chen
Sent: Wednesday, March 04, 2009 9:56 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] point and click visualization of data


Dear all,

I am not sure if this question is related to spatial analysis or not. 
I searched CRAN task View, it seems this is the only place.

The data we are working on is multivariate data, where each observation
has p features(variables). For each observation, all features are
computed/subtract from a picture, i.e., one observation correspondents
to one picture, which is then summarized by a p-dimension vector(
features). 

Now in a x-y plot of two features ( variables), we want to click or
select some observations, could it possible to bring up the
correspondent pictures of those observations ? In R, I know identify()
function. But here we want to bring up the pictures. Any package can do
this ?

Thank you very much for your time!
Chuanwen

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From j.burke at earthlink.net  Thu Mar  5 02:48:53 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Wed, 04 Mar 2009 19:48:53 -0600
Subject: [R-sig-Geo] Using the Z value for 3-D polygons?
In-Reply-To: <49AC961A.6020003@earthlink.net>
References: <49AC961A.6020003@earthlink.net>
Message-ID: <49AF2F85.4060800@earthlink.net>

Hi, I still need some help. Scant progress.

Resources: I have Deepayan's "Lattice" book and Roger,
Edzer, and Virgillio's "Applied Spatial Data Analysis"
if you want to refer me to anything there.

A. I use spplot with spplot.polygon parameters I receive the
   following error.
   . The argument seems there and returns "iso".
   . Am I missing something? My call is in section I below.
   "Error in append(list(formula, data = as(sdf, "data.frame"),
    aspect = aspect,: argument is missing, with no default"

B. By the way, mapasp doc could be cleaner. In the line below...
   1) no opening brace to match "180)" closing brace
   2) "middle of the map" the correct word is probably "median" not "mean"
    "let s = 1/cos(My * pi)/180) with My the y coordinate of the middle
    of the map (the mean of ylim)"

C. I would be happy to email my spatial polygon data frame if you want
   to experiment.

Below is my non working spplot call. Idea is to have a 3d version
that uses the z value.

I.  Errors with aspect function argument
    library(sp)
    library(maptools)  
    library(rgdal)     
    library(PBSmapping)
    tx3_sp <- readShapePoly("tx3_sp.shp", IDvar="PCT",
    proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
 
    spplot (
        tx3_sp,                 # obj                      
        c("D_CNT"),             # zcol = names(obj). D_CNT has a max of 1693
        ,                       # other arguments passed to levelplot 
(grids,
                                # polygons) or xyplot (points)
        ,                       # names, to use in panel, if different 
from zcol
                                # names  
        scales = list(draw = FALSE), # scales argument to be passed to 
Lattice
                                     # plots;                              
        xlab = NULL,         
        ylab = NULL,         
        aspect = mapasp(obj,xlim,ylim),
                                 # aspect ratio for spatial axes; 
defaults to "iso"
                                 # (one unit on the x-axis equals one 
unit on the
                                 # y-axis) but may be set to more 
suitable values
                                 # if the data are e.g. if coordinates are
                                 #latitude/longitude                       
        panel = panel.polygonsplot,
                                 # depending on the class of obj, 
panel.polygonsplot
                                 # (for polygons or lines), 
panel.gridplot (grids) or
                                 # panel.pointsplot (points) is used; 
for further
                                 # control custom panel functions
                                 # can be supplied that call one of 
these panel functions,
                                 # but do read how the argument 
sp.layout may help
        sp.layout = NULL,        # NULL or list; see notes below
        ,                        # formula, optional; may be useful to 
plot a transformed
                                 # value. Defaults to z~x+y for single 
and z~x+y|name
                                 # for multiple attributes; use e.g. 
exp(x)~x+y|name to
                                 # plot the exponent of the 
z-variable                                
        xlim = bbox(tx3_sp)[1, ],# numeric; x-axis limits 
        ylim = bbox(tx3_sp)[2, ] # numeric; y-axis limits
        )

II.    > summary(tx3_sp)
       Object of class SpatialPolygonsDataFrame
       Coordinates:
            min     max
       r1 2488376 2542115
       r2 7003736 7046215
       Is projected: TRUE
       proj4string :
       [+proj=aea +ellps=GRS80 +datum=WGS84 +lat_1=29.5 +lat_2=45.5
       +towgs84=0,0,0]
       Data attributes: (I did not list these)

III.   mapasp(tx3_sp,bbox(tx3_sp)[1, ],bbox(tx3_sp)[2, ])
       [1] "iso"


Thanks,
Jim Burke


Jim Burke wrote:
> Hi Everyone,
>
> QUESTION: How can I plot a spatial polygon (SpatialPolygonsDataFrame) 
> as 3-d? Perhaps using "spplot.polygons" with its z value?
>
> GOAL: To have a series of polygons look like approximately like the 
> last example in the PDF below.
> http://ocw.mit.edu/NR/rdonlyres/Urban-Studies-and-Planning/11-521Spatial-Database-Management-and-Advanced-Geographic-Information-SystemsSpring2003/ACA80C9F-4089-403E-9669-50763381D08A/0/lect13c.pdf 
>
>
> EXAMPLE SUGGESTION: Use "spplot.pologons" with the venerable 
> SourceForge NC fig21.R example and using its color coding values as 
> the polygon $z value? Assuming lat and long are in the sp.
> http://r-spatial.sourceforge.net/gallery/#fig21.R
>
> Then if its not as straightforward as above, what would be the steps 
> to convert a spatial polygon to points or something to graph that way?
>
> Thanks,
> Jim Burke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From j.burke at earthlink.net  Thu Mar  5 03:44:14 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Wed, 04 Mar 2009 20:44:14 -0600
Subject: [R-sig-Geo] Using the Z value for 3-D polygons?
In-Reply-To: <49AC961A.6020003@earthlink.net>
References: <49AC961A.6020003@earthlink.net>
Message-ID: <49AF3C7E.707@earthlink.net>

Hi everyone,

Please be patient with that recent email I sent
out that suddenly turned into dropped linefeed
semi garbage as I sent it.

To view this properly, you can copy and paste
to a Notepad or Unix edit session and insert
the line feeds here and there so you can
understand it better.

I opened a bug with Thunderbird.

Back to R, I really hope to get going on the
problem in that note. I have spent some
thought and time trying to get it fixed but
no success.

Thanks,
Jim Burke


Jim Burke wrote:
> Hi Everyone,
>
> QUESTION: How can I plot a spatial polygon (SpatialPolygonsDataFrame) 
> as 3-d? Perhaps using "spplot.polygons" with its z value?
>
> GOAL: To have a series of polygons look like approximately like the 
> last example in the PDF below.
> http://ocw.mit.edu/NR/rdonlyres/Urban-Studies-and-Planning/11-521Spatial-Database-Management-and-Advanced-Geographic-Information-SystemsSpring2003/ACA80C9F-4089-403E-9669-50763381D08A/0/lect13c.pdf 
>
>
> EXAMPLE SUGGESTION: Use "spplot.pologons" with the venerable 
> SourceForge NC fig21.R example and using its color coding values as 
> the polygon $z value? Assuming lat and long are in the sp.
> http://r-spatial.sourceforge.net/gallery/#fig21.R
>
> Then if its not as straightforward as above, what would be the steps 
> to convert a spatial polygon to points or something to graph that way?
>
> Thanks,
> Jim Burke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From Virgilio.Gomez at uclm.es  Thu Mar  5 10:41:36 2009
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Thu, 05 Mar 2009 10:41:36 +0100
Subject: [R-sig-Geo] point and click visualization of data
In-Reply-To: <535940.23229.qm@web33404.mail.mud.yahoo.com>
References: <535940.23229.qm@web33404.mail.mud.yahoo.com>
Message-ID: <1236246096.8984.10.camel@Virgilio-Gomez>

Hi,

I am not sure about what you need, bu you may want to try Mondrian for
this:

http://rosuda.org/mondrian/

If you have your data in R (as a SpatialPolygonsDataFrame), you can use
sp2Mondrian to export to a file that Mondrian can read. This will let
you visualize multivariate data very easily.

There is also a plug-in for Quantum GIS called manageR that will let you
import your data into QGIS and point and click very easily.

Hope this helps.

Virgilio

El mi?, 04-03-2009 a las 05:56 -0800, Chuanwen Chen escribi?:
> Dear all,
> 
> I am not sure if this question is related to spatial analysis or not. 
> I searched CRAN task View, it seems this is the only place.
> 
> The data we are working on is multivariate data, where each observation has p features(variables). For each observation, all features are computed/subtract from a picture, i.e., one observation correspondents to one picture, which is then summarized by a p-dimension vector( features). 
> 
> Now in a x-y plot of two features ( variables), we want to click or select some observations, could it possible to bring up the correspondent pictures of those observations ? In R, I know identify() function. But here we want to bring up the pictures. Any package can do this ?
> 
> Thank you very much for your time!
> Chuanwen
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Thu Mar  5 11:05:22 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 05 Mar 2009 11:05:22 +0100
Subject: [R-sig-Geo] Using the Z value for 3-D polygons?
In-Reply-To: <49AF2F85.4060800@earthlink.net>
References: <49AC961A.6020003@earthlink.net> <49AF2F85.4060800@earthlink.net>
Message-ID: <49AFA3E2.7040306@uni-muenster.de>

Thanks for the detailed comments. Before you want me starting to
experiment with your data, I want to ask you what makes you think that
spplot will solve your problem, which I assume is plotting 3D polygons
(although I'm not sure)?

Some more comments inline.
-- 
Edzer

Jim Burke wrote:
> Hi, I still need some help. Scant progress.
>
> Resources: I have Deepayan's "Lattice" book and Roger,
> Edzer, and Virgillio's "Applied Spatial Data Analysis"
> if you want to refer me to anything there.
>
> A. I use spplot with spplot.polygon parameters I receive the
>   following error.
>   . The argument seems there and returns "iso".
>   . Am I missing something? My call is in section I below.
>   "Error in append(list(formula, data = as(sdf, "data.frame"),
>    aspect = aspect,: argument is missing, with no default"
>
> B. By the way, mapasp doc could be cleaner. In the line below...
>   1) no opening brace to match "180)" closing brace
I corrected the docs.
>   2) "middle of the map" the correct word is probably "median" not "mean"
>    "let s = 1/cos(My * pi)/180) with My the y coordinate of the middle
>    of the map (the mean of ylim)"
I find the phrase "the mean of ylim" pretty clear. As the median of two
numbers is equal to the mean of two numbers, I don't see the point of
changing this.
>
> C. I would be happy to email my spatial polygon data frame if you want
>   to experiment.
>
> Below is my non working spplot call. Idea is to have a 3d version
> that uses the z value.
>
> I.  Errors with aspect function argument
>    library(sp)
>    library(maptools)     library(rgdal)        library(PBSmapping)
>    tx3_sp <- readShapePoly("tx3_sp.shp", IDvar="PCT",
>    proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
>
>    spplot (
>        tx3_sp,                 # obj                            
> c("D_CNT"),             # zcol = names(obj). D_CNT has a max of 1693
>        ,                       # other arguments passed to levelplot
> (grids,
>                                # polygons) or xyplot (points)
>        ,                       # names, to use in panel, if different
> from zcol
>                                # names         scales = list(draw =
> FALSE), # scales argument to be passed to Lattice
>                                     #
> plots;                                     xlab = NULL,               
> ylab = NULL,                aspect = mapasp(obj,xlim,ylim),
>                                 # aspect ratio for spatial axes;
> defaults to "iso"
>                                 # (one unit on the x-axis equals one
> unit on the
>                                 # y-axis) but may be set to more
> suitable values
>                                 # if the data are e.g. if coordinates are
>                                
> #latitude/longitude                              panel =
> panel.polygonsplot,
>                                 # depending on the class of obj,
> panel.polygonsplot
>                                 # (for polygons or lines),
> panel.gridplot (grids) or
>                                 # panel.pointsplot (points) is used;
> for further
>                                 # control custom panel functions
>                                 # can be supplied that call one of
> these panel functions,
>                                 # but do read how the argument
> sp.layout may help
>        sp.layout = NULL,        # NULL or list; see notes below
>        ,                        # formula, optional; may be useful to
> plot a transformed
>                                 # value. Defaults to z~x+y for single
> and z~x+y|name
>                                 # for multiple attributes; use e.g.
> exp(x)~x+y|name to
>                                 # plot the exponent of the
> z-variable                                       xlim =
> bbox(tx3_sp)[1, ],# numeric; x-axis limits        ylim =
> bbox(tx3_sp)[2, ] # numeric; y-axis limits
>        )
>
> II.    > summary(tx3_sp)
>       Object of class SpatialPolygonsDataFrame
>       Coordinates:
>            min     max
>       r1 2488376 2542115
>       r2 7003736 7046215
>       Is projected: TRUE
>       proj4string :
>       [+proj=aea +ellps=GRS80 +datum=WGS84 +lat_1=29.5 +lat_2=45.5
>       +towgs84=0,0,0]
>       Data attributes: (I did not list these)
>
> III.   mapasp(tx3_sp,bbox(tx3_sp)[1, ],bbox(tx3_sp)[2, ])
>       [1] "iso"
>
>
> Thanks,
> Jim Burke
>
>
> Jim Burke wrote:
>> Hi Everyone,
>>
>> QUESTION: How can I plot a spatial polygon (SpatialPolygonsDataFrame)
>> as 3-d? Perhaps using "spplot.polygons" with its z value?
>>
>> GOAL: To have a series of polygons look like approximately like the
>> last example in the PDF below.
>> http://ocw.mit.edu/NR/rdonlyres/Urban-Studies-and-Planning/11-521Spatial-Database-Management-and-Advanced-Geographic-Information-SystemsSpring2003/ACA80C9F-4089-403E-9669-50763381D08A/0/lect13c.pdf
>>
>>
>> EXAMPLE SUGGESTION: Use "spplot.pologons" with the venerable
>> SourceForge NC fig21.R example and using its color coding values as
>> the polygon $z value? Assuming lat and long are in the sp.
>> http://r-spatial.sourceforge.net/gallery/#fig21.R
>>
>> Then if its not as straightforward as above, what would be the steps
>> to convert a spatial polygon to points or something to graph that way?
>>
>> Thanks,
>> Jim Burke
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From N.A.Batchelor at sms.ed.ac.uk  Thu Mar  5 12:18:06 2009
From: N.A.Batchelor at sms.ed.ac.uk (Nicola Batchelor)
Date: Thu, 5 Mar 2009 11:18:06 -0000
Subject: [R-sig-Geo] imaging geoRglm binomial krig
In-Reply-To: <mailman.11.1236250803.11125.r-sig-geo@stat.math.ethz.ch>
References: <mailman.11.1236250803.11125.r-sig-geo@stat.math.ethz.ch>
Message-ID: <79548305D7E445EA8CA79B129F0FAE8A@VCS126114>

Hi Ken,

I've also been using geoRglm for similar analyses, and found the prediction
to be a bit fickle when it comes to the prediction grids!  

I was having similar problems to yours and the only thing that I could do to
make it work was to alter the way I made my prediction grids.  How are you
creating yours?

What I was doing initially was creating the prediction points in ArcMap,
adding the covariate data to it and then exporting and importing to R which
didn't work.

I ended up changing my method, so I'd create the prediction points in R
using the pred_grid function, then export that and import the points to
ArcMap.  Then I'd attach all the covariate data to the prediction points and
then export from ArcMap and import to R as a covariate object (and also use
the prediction points created using pred_grid as my prediction locations).

I hope this helps you a bit, but perhaps your problem is not the same as
mine was!

Nicola


Date: Wed, 04 Mar 2009 11:07:16 -0800
From: Ken Nussear <knussear at mac.com>
Subject: [R-sig-Geo] imaging geoRglm binomial krig
To: r-sig-geo at stat.math.ethz.ch
Message-ID: <1898D59A-04AF-4625-B19C-E8DACA88A133 at mac.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes

Hi

Wondering if anyone has had success imaging a krige produced  using  
geoRglm?

The dataset has 3467 locations....

Here is the code used to build the krige and attempted image.

itdsglm1 <- trend.spatial(~TRAN_LNTH + Maxent + HWYS_Dist2 + MDEP +   
pop, WMgeo.Sign)

itlsglm1 <- trend.spatial(~TRAN_LNTH + Maxent + HWYS_Dist2 + MDEP +   
pop, WMgeo.kriglocs)

kmod <- model.glm.control(trend.d = itdsglm1, trend.l = itlsglm1,  
cov.model = "exponential")

kprior <- prior.glm.control(beta.prior = "flat", sigmasq.prior =  
"fixed", sigmasq= 0.0307, phi.prior = "fixed", phi = 7748,  
phi.discrete = NULL, tausq.rel = 5.276)


bkcontrl <- mcmc.control(S.scale = .07, thin=40, phi.start= 7748,  
phi.scale = .2, burn.in=10)
kgout <- output.glm.control(sim.posterior=T, sim.predict=T,  
keep.mcmc.sim=T, inference=T, messages=T, quantile=c(0.25,0.5,0.975))


bkb <- binom.krige.bayes(WMgeo.Sign, locations = WMgeo.kriglocs 
$coords,  model= kmod, mcmc.input= bkcontrl, prior=kprior)

image(bkb, locations=WMgeo.kriglocs$coords,  
values.to.plot='simulation', number.col=1, messates=T)



image.glm.krige.bayes(bkb, locations=WMgeo.kriglocs$coords,  
values.to.plot=c("median"), number.col=1, coords.data=WMgeo.kriglocs 
$coords, x.leg=c(410312,561312), y.leg=c(3822651,3920651), messages=T)


I get the following errors and I can't figure out what it wants....


mapping the medians of the predictive distribution
Error in image.default(x = c(410311.919949, 411311.919949,  
412311.919949,  :
  dimensions of z are not length(x)(-1) times length(y)(-1)
In addition: Warning messages:
1: In if (coords.data) coords.data <- eval(attr(x, "data.locations")) :
  the condition has length > 1 and only the first element will be used
2: In matrix(values.loc, ncol = ny) :
  data length [3467] is not a sub-multiple or multiple of the number  
of rows [36]



Ken



-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.


From knussear at mac.com  Thu Mar  5 13:49:35 2009
From: knussear at mac.com (Ken Nussear)
Date: Thu, 05 Mar 2009 04:49:35 -0800
Subject: [R-sig-Geo] imaging geoRglm binomial krig
In-Reply-To: <79548305D7E445EA8CA79B129F0FAE8A@VCS126114>
References: <mailman.11.1236250803.11125.r-sig-geo@stat.math.ethz.ch>
	<79548305D7E445EA8CA79B129F0FAE8A@VCS126114>
Message-ID: <8672D104-4326-421D-9FDE-84C7C4A82828@mac.com>

Hi Noicola,
Thanks for the reply

Mine were originally made in ArcMap by a colleague of mine, then  
imported into Grass, which I use. The point locations (x,y) and the  
covariates are all in a vector attribute table for the points and all  
values are pulled direclty from a sqlite backend via RSQLite (Code  
Below). I haven't tried pred_grid. Ill give it a shot.

drv <- dbDriver("SQLite")
con <- dbConnect(drv, dbname="/Users/knussear/Documents/Research/GIS/ 
grassdata/DTSpatial/Working/sqlite.db")
dtdata2 <- dbSendQuery(con, "SELECT * from LDS1kGridE WHERE XMIN >=  
415311.9 and XMIN <= 555311.9 and YMIN >= 3823651 and YMIN <= 3918651")
kriglocs <- fetch(dtdata2, n=-1)

#AnUnits='WM' and
kriglocs $TRAN_LNTH <- kriglocs $TRAN_LNTH/1000
kriglocs $MDEP <- kriglocs $MDEP/1000
kriglocs $HWYS_Dist2 <- kriglocs $HWYS_Dist2/1000
kriglocs $pop <- kriglocs $Pop_15km/1000
kriglocs $ER <- kriglocs $LIVE_COUNT/kriglocs $TRAN_LNTH

WMgeo.kriglocs <- as.geodata(kriglocs, coords.col=c(5,7), data.col=44,  
covar.col=c(34,37,42,43))


Ken


On Mar 5, 2009, at 3:18 AM, Nicola Batchelor wrote:

> Hi Ken,
>
> I've also been using geoRglm for similar analyses, and found the  
> prediction
> to be a bit fickle when it comes to the prediction grids!
>
> I was having similar problems to yours and the only thing that I  
> could do to
> make it work was to alter the way I made my prediction grids.  How  
> are you
> creating yours?
>
> What I was doing initially was creating the prediction points in  
> ArcMap,
> adding the covariate data to it and then exporting and importing to  
> R which
> didn't work.
>
> I ended up changing my method, so I'd create the prediction points  
> in R
> using the pred_grid function, then export that and import the points  
> to
> ArcMap.  Then I'd attach all the covariate data to the prediction  
> points and
> then export from ArcMap and import to R as a covariate object (and  
> also use
> the prediction points created using pred_grid as my prediction  
> locations).
>
> I hope this helps you a bit, but perhaps your problem is not the  
> same as
> mine was!
>
> Nicola
>
>
> Date: Wed, 04 Mar 2009 11:07:16 -0800
> From: Ken Nussear <knussear at mac.com>
> Subject: [R-sig-Geo] imaging geoRglm binomial krig
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID: <1898D59A-04AF-4625-B19C-E8DACA88A133 at mac.com>
> Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
>
> Hi
>
> Wondering if anyone has had success imaging a krige produced  using
> geoRglm?
>
> The dataset has 3467 locations....
>
> Here is the code used to build the krige and attempted image.
>
> itdsglm1 <- trend.spatial(~TRAN_LNTH + Maxent + HWYS_Dist2 + MDEP +
> pop, WMgeo.Sign)
>
> itlsglm1 <- trend.spatial(~TRAN_LNTH + Maxent + HWYS_Dist2 + MDEP +
> pop, WMgeo.kriglocs)
>
> kmod <- model.glm.control(trend.d = itdsglm1, trend.l = itlsglm1,
> cov.model = "exponential")
>
> kprior <- prior.glm.control(beta.prior = "flat", sigmasq.prior =
> "fixed", sigmasq= 0.0307, phi.prior = "fixed", phi = 7748,
> phi.discrete = NULL, tausq.rel = 5.276)
>
>
> bkcontrl <- mcmc.control(S.scale = .07, thin=40, phi.start= 7748,
> phi.scale = .2, burn.in=10)
> kgout <- output.glm.control(sim.posterior=T, sim.predict=T,
> keep.mcmc.sim=T, inference=T, messages=T, quantile=c(0.25,0.5,0.975))
>
>
> bkb <- binom.krige.bayes(WMgeo.Sign, locations = WMgeo.kriglocs
> $coords,  model= kmod, mcmc.input= bkcontrl, prior=kprior)
>
> image(bkb, locations=WMgeo.kriglocs$coords,
> values.to.plot='simulation', number.col=1, messates=T)
>
>
>
> image.glm.krige.bayes(bkb, locations=WMgeo.kriglocs$coords,
> values.to.plot=c("median"), number.col=1, coords.data=WMgeo.kriglocs
> $coords, x.leg=c(410312,561312), y.leg=c(3822651,3920651), messages=T)
>
>
> I get the following errors and I can't figure out what it wants....
>
>
> mapping the medians of the predictive distribution
> Error in image.default(x = c(410311.919949, 411311.919949,
> 412311.919949,  :
>  dimensions of z are not length(x)(-1) times length(y)(-1)
> In addition: Warning messages:
> 1: In if (coords.data) coords.data <- eval(attr(x,  
> "data.locations")) :
>  the condition has length > 1 and only the first element will be used
> 2: In matrix(values.loc, ncol = ny) :
>  data length [3467] is not a sub-multiple or multiple of the number
> of rows [36]
>
>
>
> Ken
>
>
>
> -- 
> The University of Edinburgh is a charitable body, registered in
> Scotland, with registration number SC005336.
>


From fkbarthold46 at hotmail.com  Thu Mar  5 16:29:41 2009
From: fkbarthold46 at hotmail.com (Frauke Barthold)
Date: Thu, 5 Mar 2009 16:29:41 +0100
Subject: [R-sig-Geo] extract values to points
Message-ID: <BLU126-W115C981401850F3622F1F5CAA40@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090305/9d095127/attachment.pl>

From torleif.lunde at cih.uib.no  Thu Mar  5 16:51:20 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 5 Mar 2009 16:51:20 +0100
Subject: [R-sig-Geo] Using the Z value for 3-D polygons?
In-Reply-To: <49AF2F85.4060800@earthlink.net>
References: <49AC961A.6020003@earthlink.net> <49AF2F85.4060800@earthlink.net>
Message-ID: <200903051651.20544.torleif.lunde@cih.uib.no>

Ok. Again I will not answer the question exactly the way you would like to 
have things done. Anyway this is an approach to use lattice. 
1. Use spsample to create a grid
2. Make a data.frame and give the corresponding data values from the shp-file 
to the coordinates in the data frame
3. plot with wireframe from lattice. 
4. An alternative approach

require(maptools)
require(lattice)

nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
		    proj4string=CRS("+proj=longlat +datum=NAD27"))

#Make a grid. Details controlled by cellsize
grd <- spsample(nc, cellsize = c(.05,.05), 
		type = "regular", 
		offset = c(0.5, 0.5))

#Get polygon ID and give "value" to z data
z <- overlay(as(grd, "SpatialPoints"), nc)
grd.co <- data.frame(slot(grd, 'coords'))
grd.df <- data.frame(cbind(grd.co, z))
grd.df$z <- sapply(grd.df$z, 
		function(i) slot(nc, 'data')$NWBIR79[i])

#Make the plot. Notice that wireframe is not drawn at NA values
with(grd.df, wireframe(z ~ x1 * x2, 
	       scales = list(arrows = FALSE),
               shade =TRUE, pretty = TRUE,
		xlab="", ylab="", zlab=""))

#Trying to correct by creating matrix of z data
grd.sp <- SpatialPixelsDataFrame(cbind(grd.df$x1, grd.df$x2), 
				  data = data.frame(grd.df$z))

xyz <- as.image.SpatialGridDataFrame(grd.sp["grd.df.z"])
xyz$z[is.na(xyz$z)] <- 0

with(xyz, wireframe(z, row.values=x, col.values=y, shade = TRUE,
                             light.source = c(90,190,90)),  
			     scales = list(arrows = FALSE))


At least this is one approach. Since I am not too familiar with spplot, I 
apologize if there should be an option to plot the polygons directly with z 
in the third dimension. From what Edzer writes I would guess it is not 
straight forward. In that case I would be interested to know. 

The rendering is still not too pretty.

Best wishes
Torleif

On Thursday 05 March 2009 02:48:53 am Jim Burke wrote:
> Hi, I still need some help. Scant progress.
>
> Resources: I have Deepayan's "Lattice" book and Roger,
> Edzer, and Virgillio's "Applied Spatial Data Analysis"
> if you want to refer me to anything there.
>
> A. I use spplot with spplot.polygon parameters I receive the
>    following error.
>    . The argument seems there and returns "iso".
>    . Am I missing something? My call is in section I below.
>    "Error in append(list(formula, data = as(sdf, "data.frame"),
>     aspect = aspect,: argument is missing, with no default"
>
> B. By the way, mapasp doc could be cleaner. In the line below...
>    1) no opening brace to match "180)" closing brace
>    2) "middle of the map" the correct word is probably "median" not "mean"
>     "let s = 1/cos(My * pi)/180) with My the y coordinate of the middle
>     of the map (the mean of ylim)"
>
> C. I would be happy to email my spatial polygon data frame if you want
>    to experiment.
>
> Below is my non working spplot call. Idea is to have a 3d version
> that uses the z value.
>
> I.  Errors with aspect function argument
>     library(sp)
>     library(maptools)
>     library(rgdal)
>     library(PBSmapping)
>     tx3_sp <- readShapePoly("tx3_sp.shp", IDvar="PCT",
>     proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
>
>     spplot (
>         tx3_sp,                 # obj
>         c("D_CNT"),             # zcol = names(obj). D_CNT has a max of
> 1693 ,                       # other arguments passed to levelplot (grids,
>                                 # polygons) or xyplot (points)
>         ,                       # names, to use in panel, if different
> from zcol
>                                 # names
>         scales = list(draw = FALSE), # scales argument to be passed to
> Lattice
>                                      # plots;
>         xlab = NULL,
>         ylab = NULL,
>         aspect = mapasp(obj,xlim,ylim),
>                                  # aspect ratio for spatial axes;
> defaults to "iso"
>                                  # (one unit on the x-axis equals one
> unit on the
>                                  # y-axis) but may be set to more
> suitable values
>                                  # if the data are e.g. if coordinates are
>                                  #latitude/longitude
>         panel = panel.polygonsplot,
>                                  # depending on the class of obj,
> panel.polygonsplot
>                                  # (for polygons or lines),
> panel.gridplot (grids) or
>                                  # panel.pointsplot (points) is used;
> for further
>                                  # control custom panel functions
>                                  # can be supplied that call one of
> these panel functions,
>                                  # but do read how the argument
> sp.layout may help
>         sp.layout = NULL,        # NULL or list; see notes below
>         ,                        # formula, optional; may be useful to
> plot a transformed
>                                  # value. Defaults to z~x+y for single
> and z~x+y|name
>                                  # for multiple attributes; use e.g.
> exp(x)~x+y|name to
>                                  # plot the exponent of the
> z-variable
>         xlim = bbox(tx3_sp)[1, ],# numeric; x-axis limits
>         ylim = bbox(tx3_sp)[2, ] # numeric; y-axis limits
>         )
>
> II.    > summary(tx3_sp)
>        Object of class SpatialPolygonsDataFrame
>        Coordinates:
>             min     max
>        r1 2488376 2542115
>        r2 7003736 7046215
>        Is projected: TRUE
>        proj4string :
>        [+proj=aea +ellps=GRS80 +datum=WGS84 +lat_1=29.5 +lat_2=45.5
>        +towgs84=0,0,0]
>        Data attributes: (I did not list these)
>
> III.   mapasp(tx3_sp,bbox(tx3_sp)[1, ],bbox(tx3_sp)[2, ])
>        [1] "iso"
>
>
> Thanks,
> Jim Burke
>
> Jim Burke wrote:
> > Hi Everyone,
> >
> > QUESTION: How can I plot a spatial polygon (SpatialPolygonsDataFrame)
> > as 3-d? Perhaps using "spplot.polygons" with its z value?
> >
> > GOAL: To have a series of polygons look like approximately like the
> > last example in the PDF below.
> > http://ocw.mit.edu/NR/rdonlyres/Urban-Studies-and-Planning/11-521Spatial-
> >Database-Management-and-Advanced-Geographic-Information-SystemsSpring2003/
> >ACA80C9F-4089-403E-9669-50763381D08A/0/lect13c.pdf
> >
> >
> > EXAMPLE SUGGESTION: Use "spplot.pologons" with the venerable
> > SourceForge NC fig21.R example and using its color coding values as
> > the polygon $z value? Assuming lat and long are in the sp.
> > http://r-spatial.sourceforge.net/gallery/#fig21.R
> >
> > Then if its not as straightforward as above, what would be the steps
> > to convert a spatial polygon to points or something to graph that way?
> >
> > Thanks,
> > Jim Burke
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alinashe at gmail.com  Thu Mar  5 19:58:47 2009
From: alinashe at gmail.com (Alina Sheyman)
Date: Thu, 5 Mar 2009 13:58:47 -0500
Subject: [R-sig-Geo] mapping by zip codes
In-Reply-To: <49AD95D9.6020005@geo.uu.nl>
References: <f58db2700903031149l3dd2adcci8cdf2d8fa9144464@mail.gmail.com>
	<49AD95D9.6020005@geo.uu.nl>
Message-ID: <f58db2700903051058j108102f9nf5c6c83c1751e533@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090305/30e615aa/attachment.pl>

From torleif.lunde at cih.uib.no  Thu Mar  5 20:26:33 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 5 Mar 2009 20:26:33 +0100
Subject: [R-sig-Geo] mapping by zip codes
In-Reply-To: <f58db2700903051058j108102f9nf5c6c83c1751e533@mail.gmail.com>
References: <f58db2700903031149l3dd2adcci8cdf2d8fa9144464@mail.gmail.com>
	<49AD95D9.6020005@geo.uu.nl>
	<f58db2700903051058j108102f9nf5c6c83c1751e533@mail.gmail.com>
Message-ID: <200903052026.33737.torleif.lunde@cih.uib.no>

Dear Alina

First of all I suggest you search this mailing list, google, as well as 
reading a little at http://r-spatial.sourceforge.net/ 
Especially the Graph gallery is useful with lots of examples. If you want to 
advance, please look at http://www.asdar-book.org/


The answer to your question is 
require(sp)
xyz.df <- data.frame(x=c(50,60,70), y=c(60,40, 80), customers=c(1654, 986, 
2678))
coordinates(xyz.df) <- ~x+y
proj4string(xyz.df) <- CRS("+proj=longlat +datum=WGS84") #Use right projection
class(xyz.df)
str(xyz.df)

Best wishes
Torleif

On Thursday 05 March 2009 07:58:47 pm Alina Sheyman wrote:
> My data consists of lat, long, and the number of customers associated with
> each
> How do I go about converting my data.frame to a spatial object?
>
> On Tue, Mar 3, 2009 at 3:40 PM, Paul Hiemstra <p.hiemstra at geo.uu.nl> wrote:
> > Hi,
> >
> > You have to provide some more info in order for us to answer you
> > question. How does 'your data' look like? A data.frame with x and y
> > coordinates and more info? If this is correct, you need to convert the xy
> > data.frame to a spatial object:
> >
> > library(sp)
> > data(meuse) # data.frame
> > # The columns with the x and y coordinates are called "x" and "y"
> > coordinates(meuse) = ~x+y # SpatialPointsDataFrame
> >
> > Then you can use overlay() to find out in which customer is in which
> > polygon. Then you can count the number of customers per zip code.
> >
> > cheers,
> > Paul
> >
> > Alina Sheyman schreef:
> >> I'm very new to creating maps using shapefiles, so this question might
> >> be pretty basic.
> >>
> >> I'm trying to create a map of the US, divided up by zip codes, where i
> >> then
> >> map number of customers by zip code.
> >> I located shapefiles for US with zip codes (although at this point only
> >> for
> >> individual states, and not the entire country) and read it into R using
> >> maptools,
> >> but now I need to apply my data (which I read into R as a separate data
> >> frame and not a shapefile) to that map. Which is the part where I get
> >> completely lost and not sure how to proceed. If anyone could give me any
> >> pointers I'd really appreciate it.
> >>
> >> thank you
> >>
> >>        [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > --
> > Drs. Paul Hiemstra
> > Department of Physical Geography
> > Faculty of Geosciences
> > University of Utrecht
> > Heidelberglaan 2
> > P.O. Box 80.115
> > 3508 TC Utrecht
> > Phone:  +3130 274 3113 Mon-Tue
> > Phone:  +3130 253 5773 Wed-Fri
> > http://intamap.geo.uu.nl/~paul <http://intamap.geo.uu.nl/%7Epaul>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From p.hiemstra at geo.uu.nl  Thu Mar  5 22:20:05 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 05 Mar 2009 22:20:05 +0100
Subject: [R-sig-Geo] mapping by zip codes
In-Reply-To: <f58db2700903051058j108102f9nf5c6c83c1751e533@mail.gmail.com>
References: <f58db2700903031149l3dd2adcci8cdf2d8fa9144464@mail.gmail.com>	
	<49AD95D9.6020005@geo.uu.nl>
	<f58db2700903051058j108102f9nf5c6c83c1751e533@mail.gmail.com>
Message-ID: <49B04205.7090508@geo.uu.nl>

Hi,

I gave the answer in my previous e-mail

library(sp)
data(meuse) # data.frame
# The columns with the x and y coordinates are called "x" and "y"
coordinates(meuse) = ~x+y # SpatialPointsDataFrame

A good source of additional information is the sp-documentation or the 
book Applied Spatial Data Analysis in R.

cheers,
Paul

Alina Sheyman schreef:
> My data consists of lat, long, and the number of customers associated 
> with each
> How do I go about converting my data.frame to a spatial object?
>
> On Tue, Mar 3, 2009 at 3:40 PM, Paul Hiemstra <p.hiemstra at geo.uu.nl 
> <mailto:p.hiemstra at geo.uu.nl>> wrote:
>
>     Hi,
>
>     You have to provide some more info in order for us to answer you
>     question. How does 'your data' look like? A data.frame with x and
>     y coordinates and more info? If this is correct, you need to
>     convert the xy data.frame to a spatial object:
>
>     library(sp)
>     data(meuse) # data.frame
>     # The columns with the x and y coordinates are called "x" and "y"
>     coordinates(meuse) = ~x+y # SpatialPointsDataFrame
>
>     Then you can use overlay() to find out in which customer is in
>     which polygon. Then you can count the number of customers per zip
>     code.
>
>     cheers,
>     Paul
>
>     Alina Sheyman schreef:
>
>         I'm very new to creating maps using shapefiles, so this
>         question might be
>         pretty basic.
>
>         I'm trying to create a map of the US, divided up by zip codes,
>         where i then
>         map number of customers by zip code.
>         I located shapefiles for US with zip codes (although at this
>         point only for
>         individual states, and not the entire country) and read it
>         into R using
>         maptools,
>         but now I need to apply my data (which I read into R as a
>         separate data
>         frame and not a shapefile) to that map. Which is the part
>         where I get
>         completely lost and not sure how to proceed. If anyone could
>         give me any
>         pointers I'd really appreciate it.
>
>         thank you
>
>                [[alternative HTML version deleted]]
>
>         _______________________________________________
>         R-sig-Geo mailing list
>         R-sig-Geo at stat.math.ethz.ch <mailto:R-sig-Geo at stat.math.ethz.ch>
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>          
>
>
>
>     -- 
>     Drs. Paul Hiemstra
>     Department of Physical Geography
>     Faculty of Geosciences
>     University of Utrecht
>     Heidelberglaan 2
>     P.O. Box 80.115
>     3508 TC Utrecht
>     Phone:  +3130 274 3113 Mon-Tue
>     Phone:  +3130 253 5773 Wed-Fri
>     http://intamap.geo.uu.nl/~paul <http://intamap.geo.uu.nl/%7Epaul>
>
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From brenning at uwaterloo.ca  Thu Mar  5 23:17:51 2009
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Thu, 05 Mar 2009 17:17:51 -0500
Subject: [R-sig-Geo] extract values to points
In-Reply-To: <BLU126-W115C981401850F3622F1F5CAA40@phx.gbl>
References: <BLU126-W115C981401850F3622F1F5CAA40@phx.gbl>
Message-ID: <49B04F8F.4000705@uwaterloo.ca>

Hi Frauke,

in the RSAGA package there is a function pick.from.ascii.grid which does
exactly what you want. Even works with large grids as it can process
them row by row. I use it for extracting point data from stacks of
Landsat bands, terrain attributes etc.

Here a case study (landslide susceptibility modeling):

http://www.environment.uwaterloo.ca/u/brenning/Brenning-2008-RSAGA.html

also available as pdf:
http://www.environment.uwaterloo.ca/u/brenning/Brenning-2008-RSAGA.pdf

I hope this helps

Cheers
    Alex


Frauke Barthold wrote:
> Dear list,
> 
> I have a soilmap as an Ascii grid and a dataframe with x and y
> coordinates (these are sampling points). I would now like to extract
> values from the soilmap to the dataframe based on location, the  x
> and y values. Is there any way to do this in R?
> 
> Cheers, Frauke
> 
> _________________________________________________________________
> 
> 
> [[alternative HTML version deleted]]
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at stat.math.ethz.ch 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From gianni.lavaredo at gmail.com  Fri Mar  6 00:06:19 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 6 Mar 2009 00:06:19 +0100
Subject: [R-sig-Geo] help for select two columns in a data frame
Message-ID: <518dff330903051506j3e3bb7c8saec31fc7873e0a09@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090306/afb95661/attachment.pl>

From moor0554 at umn.edu  Fri Mar  6 01:34:22 2009
From: moor0554 at umn.edu (Christopher Moore)
Date: Thu, 5 Mar 2009 18:34:22 -0600
Subject: [R-sig-Geo] SpatialPoints symbols cut off in PNG produced with
	GE_SpatialGrid() and kmlOverlay()
Message-ID: <854CC894F323430F9A323D892A08A300@T60>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090305/3aa55bff/attachment.pl>

From adrian at maths.uwa.edu.au  Fri Mar  6 05:04:12 2009
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Fri, 06 Mar 2009 13:04:12 +0900
Subject: [R-sig-Geo] minimum distance between polygons' edges
Message-ID: <49B0A0BC.2000106@maths.uwa.edu.au>

arion TAFANI wrote:

>
> > we want to calculate the minimun distance between polygons' edges , do 
> > you know any package or function which can help us ? we try to work 
> > with vectors rather than raster but we lack some tools. we only found 
> > how to calculate distances between centroids but nothing between edges.
>
>   
This is implemented in the package 'spatstat'.

For objects of class "psp" (representing collections of line segments) 
the function pairdist.psp computes the distance between each pair of 
line segments. There is also a function crossdist.psp for comparing two 
sets of line segments.

To convert your data from sp classes (like SpatialPolygons or 
SpatialLines) to the class "psp", see the vignette provided in the 
spatstat package.

Note that the shortest distance between two line segments is not the 
same as the minimum distance between their endpoints. So the other 
solutions which have been suggested will not give the correct answer.

Adrian Baddeley


From ksafi at orn.mpg.de  Fri Mar  6 07:04:45 2009
From: ksafi at orn.mpg.de (Kamran Safi)
Date: Fri, 06 Mar 2009 07:04:45 +0100
Subject: [R-sig-Geo] help for select two columns in a data frame
In-Reply-To: <518dff330903051506j3e3bb7c8saec31fc7873e0a09@mail.gmail.com>
References: <518dff330903051506j3e3bb7c8saec31fc7873e0a09@mail.gmail.com>
Message-ID: <49B0BCFD.8010301@orn.mpg.de>

Hi,

sample_real <- sample[, c(2,4)]
writeOGR(sample_real, ".", "sample_real", driver="ESRI Shapefile")

should do the job.

Kami


gianni lavaredo wrote:
> sorry for the easy questions but I have this problem. I had read Help but I
> didn't find this question. Sorry for desturbing but I am a brand new in R,
> sorry again
>
> # I have a shape file with 4 column (soil, ID, country, pH)
>
> sample <- readOGR(".", "sample")
> summary("sample")
> # I wish select only the ID (2 column) and pH (4 column)
> # in help I found this sw[1:3] for select the 1?,2?,3? columns, but I wish
> to select only the
> # 2? and 4?
>
> sample_real <- sample[?????]
> writeOGR(sample_real, ".", "sample_real", driver="ESRI Shapefile")
>
> thanks and sorry again for the question and for your time
>
> Gianni
>
>
> sampe <-
>
> 	[[alternative HTML version deleted]]
>
>   
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3275 bytes
Desc: S/MIME Cryptographic Signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090306/902920c4/attachment.bin>

From T.Hengl at uva.nl  Fri Mar  6 10:04:38 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Fri, 6 Mar 2009 10:04:38 +0100
Subject: [R-sig-Geo] GEOSTAT 2009 Summer School, 3-10 May 2009 MEDILS, Split,
	Croatia 2nd call
Message-ID: <EC31C14E083B473990C7B8A6373FF63D@pcibed193>


Dear R-sig-geo,

There are still some open places for our GEOSTAT 2009 summer school (the registration closes on 15h
of March). We will finally be three lecturers: (1) Roger Bivand; (2) Olaf Conrad (the main creator
of SAGA) and (3) Tomislav Hengl. The fifth day of the summer school, we will run a R-sig-geo LIVE
discussion - via a live broadcast (under preparation).

Current registrations: uni-bonn.de; zg.htnet.hr; gmx.de; izor.hr; agr.hr; ugent.be; geo.uzh.ch;
geodata.hr; uclouvain.be; iastate.edu; ceh.ac.uk;

F.A.Q.

1. Where can I find more info about the course programme?
- The programme of the school will be published after we collect the registrations. We keep some
flexibility considering the programme because we try to adjust to the topics that applicants select
as much as possible.

2. Is there a possibility to get a discount or funding from the hosting institute?
- In principle no. We have tried our best to reduce the price as much as possible (all the lecturers
are volunteers), while still being able to use excellent facilities (not to mention that MEDILS has
its private beach). Possibly the only way to save some money is to try to organize the accommodation
yourself. The registration costs for external accommodation will be 300-350 ? (but you would soon
find out that accommodation in Split is as expensive as on the institute).

3. Can two or more people from the same institute apply?
- Of course! The selection criteria are only: (1) scientific excellence, (2) relevance, (3) distance
from the course (more distant applications have advantage), (4) time of application.


my apologies for cross posting!

------------------------------------------------

2nd call: GEOSTAT 2009 Summer School
"Spatio-temporal data analysis with R + SAGA + Google Earth"

Period: 3 ? 10 May 2009
Location: Mediterranean Institute For Life Sciences (MEDILS), Split, Croatia

The objective of the GEOSTAT Summer School is to promote use of open source tools for the analysis
of spatio-temporal data. The course aims at providing a balanced combination of theoretical and
hands-on-software (R + open source GIS) training, and includes a one-day workshop where each
participant can present his/her case study and receive feedback.

Course moderators:
* Roger S. Bivand (Norwegian School of Economics and Business Administration)
* Tomislav Hengl (University of Amsterdam)
* Olaf Conrad (University of Hamburg)

The MEDILS institute features fully equipped lecture and seminar rooms. Accommodation is available
in-house (hotel complex on the upper floors) - comfortable two-bed rooms with private bathrooms. All
rooms are fully air-conditioned and provide telephone and high-speed Internet access. Three meals
per day (breakfast, lunch, dinner) and intermediate coffee/snacks are provided at the Institute. The
institute also features sport facilities, and access to sea (beach).

Registration fees:
Single rooms*: 840 ?
Shared rooms (2 beds): 680 ?
*A limited number of single rooms is available. In the case of high interest for single rooms, the
organizers will try to arrange an equivalent accommodation in the neighboring hotel.

The registration fees are ALL INCLUSIVE: they include workshop fees, accommodation at the institute
(six nights), meals during the whole duration of the summer school (excluding Friday 8.05 dinner and
Sunday 10.05 lunch), and costs of the Saturday 9.05 excursion to island Brac (Pustinja Blaca - old
Monastery).

Registration dead-line: 15 March 2009

The course is limited to 25 participants. The candidates will be selected based on: (a) academic
excellent; (b) thematic relevance to the topic of the course; (c) geographic location (more distant
applications have advantage) and (d) time of application.
To register for this summer school, please fill out and forward the registration form available at:

http://www.medils.org/index.php/archives/category/events/schools-workshops/


For all other information:
Tomislav Hengl, course coordinator
E-mail: T.Hengl at uva.nl
URL: http://spatial-analyst.net


From gianni.lavaredo at gmail.com  Fri Mar  6 13:08:25 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 6 Mar 2009 13:08:25 +0100
Subject: [R-sig-Geo] simple help to calculate max statistic in data.frame
Message-ID: <518dff330903060408u660639c0w334c57442efb393c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090306/6529bc1b/attachment.pl>

From Joshua.Myers at norfolk.gov  Fri Mar  6 14:41:11 2009
From: Joshua.Myers at norfolk.gov (Myers, Joshua)
Date: Fri, 6 Mar 2009 08:41:11 -0500
Subject: [R-sig-Geo] enhanced BLAS support in R 2.8.1
Message-ID: <9B075A4C00AC004191F2A8C73EB78E62976C7A@MAILC-EVS.norfolk.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090306/35f5c49e/attachment.pl>

From paciorek at hsph.harvard.edu  Fri Mar  6 23:48:39 2009
From: paciorek at hsph.harvard.edu (Christopher Paciorek)
Date: Fri, 06 Mar 2009 17:48:39 -0500
Subject: [R-sig-Geo] enhanced BLAS support in R 2.8.1
In-Reply-To: <9B075A4C00AC004191F2A8C73EB78E62976C7A@MAILC-EVS.norfolk.gov>
References: <9B075A4C00AC004191F2A8C73EB78E62976C7A@MAILC-EVS.norfolk.gov>
Message-ID: <49B161E1.10CD.002E.0@hsph.harvard.edu>

Hi Josh, 

Take a look at the section on BLAS in the R Installation and Admin manual.  

In Linux we've gotten order of magnitude speedups by using GotoBLAS instead of the default BLAS in R.  But it's not available for XP - there are other  BLAS implementations mentioned in the manual that might be faster than the default, though my guess is that they will not be as fast as GotoBLAS (based in part on an email exchange with Brian Ripley through the R-devel mailing list).


-chris

----------------------------------------------------------------------------------------------
Chris Paciorek / Asst. Professor        Email: paciorek at hsph.harvard.edu
Department of Biostatistics             Voice: 617-432-4912
Harvard School of Public Health         Fax:   617-432-5619
655 Huntington Av., Bldg. 2-407         WWW: www.biostat.harvard.edu/~paciorek
Boston, MA 02115 USA                    Permanent forward: paciorek at alumni.cmu.edu



 
>>> "Myers, Joshua" <Joshua.Myers at norfolk.gov> 03/06/09 8:41 AM >>> 
List,
	I am running Windows XP and R 2.8.1 on a Dell Core 2 Processor
Computer.  I have a question concerning the performance speed of matrix
operations and BLAS.  Is R 2.8.1 already configured to take advantage of
more enhanced BLAS than the old standard R BLAS, or is there something
extra I have to install or do before I can get to that point?
Basically, what I am asking is for any advice on how to speed up these
floating point matrix operations, and how R 2.8.1's BLAS plays into
that.  Thanks.

-Josh

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From markus.loecher at gmail.com  Sun Mar  8 17:32:50 2009
From: markus.loecher at gmail.com (Markus Loecher)
Date: Sun, 8 Mar 2009 12:32:50 -0400
Subject: [R-sig-Geo] overplotting on png map tile in R
Message-ID: <bf460e020903080932lcedfacpa75502c2b879e27e@mail.gmail.com>

Dear R geo wizards,
while I am very happy with the kmloverlay() function from the maptools
package to create overlays from R in Google Earth, I often would like
to perform an even simpler task.
Given a png image with a known lat/lon bounding box, such as a map
tile or some other geographically aligned image, I would like to
(i)  load the image into R,
(ii) plot the image, and
(iii) overlay e.g. lat/lon referenced points on top of this image

The points should be plotted with respect to the coordinates of the image.

Is this possible at all ?

Thanks !

Markus


From tom.gottfried at wzw.tum.de  Sun Mar  8 19:26:00 2009
From: tom.gottfried at wzw.tum.de (Tom Gottfried)
Date: Sun, 8 Mar 2009 19:26:00 +0100
Subject: [R-sig-Geo] simple help to calculate max statistic in data.frame
In-Reply-To: <mailman.15.1236423603.22512.r-sig-geo@stat.math.ethz.ch>
References: <mailman.15.1236423603.22512.r-sig-geo@stat.math.ethz.ch>
Message-ID: <D741BE7B-6E3B-4291-809C-A1F85EBC0820@wzw.tum.de>

Hi Gianni,

when you combine the information given in chapter 2.7 (especially the  
part about logical index vectors) and chapter 5.2 (note that a  
data.frame here acts like an array with two dimensions) of "An  
Introduction to R", you see that you can do that with logical index  
vectors (e.g. looping over the values in your column "ID").  
Furthermore you can consider using `subset()'.

Hope this helps.

Regards,
Tom

> Date: Fri, 6 Mar 2009 13:08:25 +0100
> From: gianni lavaredo <gianni.lavaredo at gmail.com>
> Subject: [R-sig-Geo] simple help to calculate max statistic in
> 	data.frame
> To: r-sig-geo at stat.math.ethz.ch
> Message-ID:
> 	<518dff330903060408u660639c0w334c57442efb393c at mail.gmail.com>
> Content-Type: text/plain
>
> Thanks for help and attention
>
> I have a data.frame "sample" in shape-file like this
>
> ID; pH
> 1;3.4
> 1;3.8
> 1;3.9
> 4;5.5
> 4;5.9
> 4;5.8
> 5;7.1
> 5;7.5
> 5;7.6
> 5;7.7
> 5;7.8
> 5;7.9
>
> I wish to extract the max(pH) of ID = 1, after max(pH) of ID = 2,  
> etc. etc.
>
> I tryed the code
>
> sample <- readOGR(".", "sample")
> max(sample$pH) #to obtain the max of pH
> max(sample$ph[c(1), ] #not run
>
> thanks
> Gianni
>
> 	[[alternative HTML version deleted]]
>


From torleif.lunde at cih.uib.no  Sun Mar  8 19:55:36 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Sun, 8 Mar 2009 19:55:36 +0100
Subject: [R-sig-Geo] simple help to calculate max statistic in data.frame
In-Reply-To: <D741BE7B-6E3B-4291-809C-A1F85EBC0820@wzw.tum.de>
References: <mailman.15.1236423603.22512.r-sig-geo@stat.math.ethz.ch>
	<D741BE7B-6E3B-4291-809C-A1F85EBC0820@wzw.tum.de>
Message-ID: <200903081955.37691.torleif.lunde@cih.uib.no>

Hi Gianni

To simplify things you could use tapply()

data.df <- data.frame(ID=c(1,1,1, 4,4,4,5,5,5,5,5,5), pH=c(3.4, 3.8, 3.9, 5.5, 
5.9, 5.8, 7.1, 7.5, 7.6, 7.7, 7.8, 7.9))

with(data.df, tapply(pH, ID, max))

The solution of Tom could of course also be used.

Best wishes
Torleif


On Sunday 08 March 2009 07:26:00 pm Tom Gottfried wrote:
> Hi Gianni,
>
> when you combine the information given in chapter 2.7 (especially the
> part about logical index vectors) and chapter 5.2 (note that a
> data.frame here acts like an array with two dimensions) of "An
> Introduction to R", you see that you can do that with logical index
> vectors (e.g. looping over the values in your column "ID").
> Furthermore you can consider using `subset()'.
>
> Hope this helps.
>
> Regards,
> Tom
>
> > Date: Fri, 6 Mar 2009 13:08:25 +0100
> > From: gianni lavaredo <gianni.lavaredo at gmail.com>
> > Subject: [R-sig-Geo] simple help to calculate max statistic in
> > 	data.frame
> > To: r-sig-geo at stat.math.ethz.ch
> > Message-ID:
> > 	<518dff330903060408u660639c0w334c57442efb393c at mail.gmail.com>
> > Content-Type: text/plain
> >
> > Thanks for help and attention
> >
> > I have a data.frame "sample" in shape-file like this
> >
> > ID; pH
> > 1;3.4
> > 1;3.8
> > 1;3.9
> > 4;5.5
> > 4;5.9
> > 4;5.8
> > 5;7.1
> > 5;7.5
> > 5;7.6
> > 5;7.7
> > 5;7.8
> > 5;7.9
> >
> > I wish to extract the max(pH) of ID = 1, after max(pH) of ID = 2,
> > etc. etc.
> >
> > I tryed the code
> >
> > sample <- readOGR(".", "sample")
> > max(sample$pH) #to obtain the max of pH
> > max(sample$ph[c(1), ] #not run
> >
> > thanks
> > Gianni
> >
> > 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From T.Hengl at uva.nl  Mon Mar  9 09:30:16 2009
From: T.Hengl at uva.nl (Hengl, T.)
Date: Mon, 9 Mar 2009 09:30:16 +0100
Subject: [R-sig-Geo] Download and resampling of MODIS images (automated)
Message-ID: <37382E8DCB905042969BA78541F65706754230@kwek.ic.uva.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090309/4585b06d/attachment.pl>

From koen.hufkens at ua.ac.be  Mon Mar  9 11:18:40 2009
From: koen.hufkens at ua.ac.be (Koen Hufkens)
Date: Mon, 09 Mar 2009 11:18:40 +0100
Subject: [R-sig-Geo] comparing confusion matrices
Message-ID: <1236593920.13654.39.camel@chupchup>

Dear list,

I need some expert assistance on a geo-statistical question.

I have two maps, first and second choice classification results. And I
have two areas selected within this map. For these areas I calculated
confusion matrices.

However, I want to compare these matrices. I was considering a Mantel
test. However, I do not know if this is correct (sample sizes are not
the same so I normalized both matrices) and ideally I would love to
extract inter row differences rather than the evaluation of the total
matrix (Z-score p-value etc).

Has anyone experience with these kind of statistics (row based
comparison of matrices).

Kind regards,
Koen


From andrew.niccolai at yale.edu  Mon Mar  9 12:55:59 2009
From: andrew.niccolai at yale.edu (Andrew Niccolai)
Date: Mon, 9 Mar 2009 07:55:59 -0400
Subject: [R-sig-Geo] comparing confusion matrices
In-Reply-To: <1236593920.13654.39.camel@chupchup>
References: <1236593920.13654.39.camel@chupchup>
Message-ID: <000601c9a0ae$040686a0$0c1393e0$@niccolai@yale.edu>

Koen,

Congalton and Green 1999 ("Assessing the Accuracy of Remotely Sensed Data:
Principles and Practices") describes such a method which they term Margfit.
This method "can be applied to ?normalize? or standardize the error matrices
for comparison purposes.
Margfit uses an iterative proportional fitting procedure which forces each
row and column (i.e., marginal) in the matrix to sum to a predetermined
value; hence the name Margfit. If the predetermined value is one, then each
cell value is a proportion
of one and can easily be multiplied by 100 to represent percentages. The
predetermined value could also be set to 100 to obtain percentages directly
or to any other value the analyst chooses.  In this normalization process,
differences in sample sizes used to generate the matrices are eliminated and
therefore, individual cell values within the matrix are directly
comparable." (Chapter 5).  

Dr. Congalton has sent me his Margfit application (I think it is written in
C++ but can't be sure) and I'm sure would do the same for anyone else
interested.  He can be reached at russ.congalton at unh.edu

AS for R, I bet it would be relatively straightforward to code a version of
Margefit into R.

Hope this helps,
Andrew

Andrew Niccolai
Doctoral Candidate
Yale School of Forestry
860-402-6079
andrew.niccolai at yale.edu


? 

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Koen Hufkens
Sent: Monday, March 09, 2009 6:19 AM
To: R-sig-GEO
Subject: [R-sig-Geo] comparing confusion matrices

Dear list,

I need some expert assistance on a geo-statistical question.

I have two maps, first and second choice classification results. And I
have two areas selected within this map. For these areas I calculated
confusion matrices.

However, I want to compare these matrices. I was considering a Mantel
test. However, I do not know if this is correct (sample sizes are not
the same so I normalized both matrices) and ideally I would love to
extract inter row differences rather than the evaluation of the total
matrix (Z-score p-value etc).

Has anyone experience with these kind of statistics (row based
comparison of matrices).

Kind regards,
Koen

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alinashe at gmail.com  Mon Mar  9 17:46:06 2009
From: alinashe at gmail.com (Alina Sheyman)
Date: Mon, 9 Mar 2009 12:46:06 -0400
Subject: [R-sig-Geo] shape file for Boston
Message-ID: <f58db2700903090946v5cb2ac7ak5f478c07d36de227@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090309/3b9ab977/attachment.pl>

From Greg.Snow at imail.org  Mon Mar  9 20:52:20 2009
From: Greg.Snow at imail.org (Greg Snow)
Date: Mon, 9 Mar 2009 13:52:20 -0600
Subject: [R-sig-Geo] overplotting on png map tile in R
In-Reply-To: <bf460e020903080932lcedfacpa75502c2b879e27e@mail.gmail.com>
References: <bf460e020903080932lcedfacpa75502c2b879e27e@mail.gmail.com>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC61CC19A894@LP-EXMBVS10.CO.IHC.COM>

I don't know of any functions to load and display a .png file, but if you can convert it to .jpg (Imagemagick is one way) then you can read it and plot it with the rimage package.  You can then use updateusr from the TeachingDemos package to change the user coordinates to match the latitude and longitude information and add whatever you want to the graph (given that the distortion from curved earth to flat plot is small enough).

For example:

library(TeachingDemos)
library(rimage)

# file ccc.jpg from: http://terraserver-usa.com/ImageInfo.aspx?T=4&S=12&Z=12&X=531&Y=5643&W=1
tmp <- read.jpeg('ccc.jpg')
plot(tmp)

tmp2 <- locator(2) # click on ll and ur corners

latlon <- c(40.77707, -111.90064, 40.79148, -111.87239)

updateusr(tmp2, x2=latlon[ c(2,4) ], y2=latlon[ c(1,3) ] )

with(ccc, lines(Lon, Lat, col='red') )




Hope this helps,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] On Behalf Of Markus Loecher
> Sent: Sunday, March 08, 2009 10:33 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] overplotting on png map tile in R
> 
> Dear R geo wizards,
> while I am very happy with the kmloverlay() function from the maptools
> package to create overlays from R in Google Earth, I often would like
> to perform an even simpler task.
> Given a png image with a known lat/lon bounding box, such as a map
> tile or some other geographically aligned image, I would like to
> (i)  load the image into R,
> (ii) plot the image, and
> (iii) overlay e.g. lat/lon referenced points on top of this image
> 
> The points should be plotted with respect to the coordinates of the
> image.
> 
> Is this possible at all ?
> 
> Thanks !
> 
> Markus
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ggrothendieck at gmail.com  Mon Mar  9 21:52:48 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 9 Mar 2009 16:52:48 -0400
Subject: [R-sig-Geo] overplotting on png map tile in R
In-Reply-To: <bf460e020903080932lcedfacpa75502c2b879e27e@mail.gmail.com>
References: <bf460e020903080932lcedfacpa75502c2b879e27e@mail.gmail.com>
Message-ID: <971536df0903091352t54868f27n887584ec19423505@mail.gmail.com>

The rgdal package can read png images.  See:
http://finzi.psych.upenn.edu/R/Rhelp02a/archive/94605.html

On Sun, Mar 8, 2009 at 12:32 PM, Markus Loecher
<markus.loecher at gmail.com> wrote:
> Dear R geo wizards,
> while I am very happy with the kmloverlay() function from the maptools
> package to create overlays from R in Google Earth, I often would like
> to perform an even simpler task.
> Given a png image with a known lat/lon bounding box, such as a map
> tile or some other geographically aligned image, I would like to
> (i) ?load the image into R,
> (ii) plot the image, and
> (iii) overlay e.g. lat/lon referenced points on top of this image
>
> The points should be plotted with respect to the coordinates of the image.
>
> Is this possible at all ?
>
> Thanks !
>
> Markus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From j.burke at earthlink.net  Mon Mar  9 23:47:34 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Mon, 09 Mar 2009 17:47:34 -0500
Subject: [R-sig-Geo] shape file for Boston
In-Reply-To: <f58db2700903090946v5cb2ac7ak5f478c07d36de227@mail.gmail.com>
References: <f58db2700903090946v5cb2ac7ak5f478c07d36de227@mail.gmail.com>
Message-ID: <49B59C86.9000201@earthlink.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090309/b6604d92/attachment.pl>

From p.hiemstra at geo.uu.nl  Tue Mar 10 11:04:23 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 10 Mar 2009 11:04:23 +0100
Subject: [R-sig-Geo] extract values to points
In-Reply-To: <BLU126-W115C981401850F3622F1F5CAA40@phx.gbl>
References: <BLU126-W115C981401850F3622F1F5CAA40@phx.gbl>
Message-ID: <49B63B27.1020401@geo.uu.nl>

Hi,

An option using only R is to use the overlay() command from the sp 
package, try running this example:

# Load data
library(sp)
data(meuse)
# point data
coordinates(meuse) = ~x+y
data(meuse.grid)
# grid data
gridded(meuse.grid) = ~x+y

overlay(meuse.grid, meuse)
# Returns the indices in meuse.grid correpsonding to the points in meuse
# get the data from meuse.grid, for example the column "dist"
# a non spatial vector
dist = meuse.grid$dist[overlay(meuse.grid, meuse)]
# A spatialPointsDataFrame
dist = meuse.grid[overlay(meuse.grid, meuse), "dist"]

Also check out the rgdal pacakge to get your data into R-spatial objects.

cheers,
Paul

Frauke Barthold wrote:
> Dear list,
>
> I have a soilmap as an Ascii grid and a dataframe with x and y coordinates (these are sampling points). I would now like to extract values from the soilmap to the dataframe based on location, the  x and y values. Is there any way to do this in R?
>
> Cheers,
> Frauke  
>
> _________________________________________________________________
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From p.hiemstra at geo.uu.nl  Tue Mar 10 12:50:06 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 10 Mar 2009 12:50:06 +0100
Subject: [R-sig-Geo] extract values to points
In-Reply-To: <20090310101256.M67642@mail.orn.mpg.de>
References: <BLU126-W115C981401850F3622F1F5CAA40@phx.gbl>
	<49B63B27.1020401@geo.uu.nl>
	<20090310101256.M67642@mail.orn.mpg.de>
Message-ID: <49B653EE.7020303@geo.uu.nl>

Hi,

Funny to see how you can do things in multiple ways in R :). To add to 
the possibilities, you could probably also get this functionality using 
R and Grass.

I would personally recommend to use overlay() as you don't have to 
install anything apart from the sp package, unlike using rsaga and SAGA. 
Especially if the only thing you want is to do an overlay. When there 
was other SAGA specific functionality you needed, SAGA would be a good 
option. In addition to not having to install a lot of software, 
overlay() has been used extensively, this in contrast to the raster 
package which is still experimental. But this is strictly my personal 
opinion ofcourse :).

cheers,
Paul

Kamran Safi Radolfzell wrote:
> Hi all,
>
> the raster package is although in its alpha stage very helpful in this 
> respect:
>
> install.packages("raster", repos="http://R-Forge.R-project.org")
> library(raster)
> library(maptools)
> X <- 
> Y <- 
> raster <- rasterFromFile("C:/yourfile")
> (result <- data.frame(Long=x, Lat=y, Value=xyValues(raster, matrix(c(x,y), 
> ncol=2)))))
>
>
> That should work. Remember to take out the install.package after initial 
> install. Of course you can work with several coordinates. Peadagogically 
> better is the overlay() function...
>
> Very straight forward. 
>
> Kami
>
> On Tue, 10 Mar 2009 11:04:23 +0100, Paul Hiemstra wrote
>   
>> Hi,
>>
>> An option using only R is to use the overlay() command from the sp 
>> package, try running this example:
>>
>> # Load data
>> library(sp)
>> data(meuse)
>> # point data
>> coordinates(meuse) = ~x+y
>> data(meuse.grid)
>> # grid data
>> gridded(meuse.grid) = ~x+y
>>
>> overlay(meuse.grid, meuse)
>> # Returns the indices in meuse.grid correpsonding to the points in meuse
>> # get the data from meuse.grid, for example the column "dist"
>> # a non spatial vector
>> dist = meuse.grid$dist[overlay(meuse.grid, meuse)]
>> # A spatialPointsDataFrame
>> dist = meuse.grid[overlay(meuse.grid, meuse), "dist"]
>>
>> Also check out the rgdal pacakge to get your data into R-spatial objects.
>>
>> cheers,
>> Paul
>>
>> Frauke Barthold wrote:
>>     
>>> Dear list,
>>>
>>> I have a soilmap as an Ascii grid and a dataframe with x and y 
>>>       
> coordinates (these are sampling points). I would now like to extract values 
> from the soilmap to the dataframe based on location, the  x and y values. Is 
> there any way to do this in R?
>   
>>> Cheers,
>>> Frauke  
>>>
>>> _________________________________________________________________
>>>
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>       
>> -- 
>> Drs. Paul Hiemstra
>> Department of Physical Geography
>> Faculty of Geosciences
>> University of Utrecht
>> Heidelberglaan 2
>> P.O. Box 80.115
>> 3508 TC Utrecht
>> Phone:  +3130 274 3113 Mon-Tue
>> Phone:  +3130 253 5773 Wed-Fri
>> http://intamap.geo.uu.nl/~paul
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>
>
> --
> Open WebMail Project (http://openwebmail.org)
>
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From r.hijmans at gmail.com  Tue Mar 10 13:19:17 2009
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Tue, 10 Mar 2009 20:19:17 +0800
Subject: [R-sig-Geo] extract values to points
In-Reply-To: <49B653EE.7020303@geo.uu.nl>
References: <BLU126-W115C981401850F3622F1F5CAA40@phx.gbl>
	<49B63B27.1020401@geo.uu.nl> <20090310101256.M67642@mail.orn.mpg.de>
	<49B653EE.7020303@geo.uu.nl>
Message-ID: <dc22b2570903100519o442ec69w981b471f25f0add5@mail.gmail.com>

Just for the record. this is how I would do this with the raster
package (Kamran's example should work, but seems a bit unnecessarily
complex; just what we are trying to avoid with that package :):

install.packages("raster", repos="http://R-Forge.R-project.org")
library(raster)

xy <- your matrix
raster <- rasterFromFile("C:/yourfile")
v <- xyValues(raster, xy)

xyv <- cbind(xy, v)

Robert

On Tue, Mar 10, 2009 at 7:50 PM, Paul Hiemstra <p.hiemstra at geo.uu.nl> wrote:
> Hi,
>
> Funny to see how you can do things in multiple ways in R :). To add to the
> possibilities, you could probably also get this functionality using R and
> Grass.
>
> I would personally recommend to use overlay() as you don't have to install
> anything apart from the sp package, unlike using rsaga and SAGA. Especially
> if the only thing you want is to do an overlay. When there was other SAGA
> specific functionality you needed, SAGA would be a good option. In addition
> to not having to install a lot of software, overlay() has been used
> extensively, this in contrast to the raster package which is still
> experimental. But this is strictly my personal opinion ofcourse :).
>
> cheers,
> Paul
>
> Kamran Safi Radolfzell wrote:
>>
>> Hi all,
>>
>> the raster package is although in its alpha stage very helpful in this
>> respect:
>>
>> install.packages("raster", repos="http://R-Forge.R-project.org")
>> library(raster)
>> library(maptools)
>> X <- Y <- raster <- rasterFromFile("C:/yourfile")
>> (result <- data.frame(Long=x, Lat=y, Value=xyValues(raster, matrix(c(x,y),
>> ncol=2)))))
>>
>>
>> That should work. Remember to take out the install.package after initial
>> install. Of course you can work with several coordinates. Peadagogically
>> better is the overlay() function...
>>
>> Very straight forward.
>> Kami
>>
>> On Tue, 10 Mar 2009 11:04:23 +0100, Paul Hiemstra wrote
>>
>>>
>>> Hi,
>>>
>>> An option using only R is to use the overlay() command from the sp
>>> package, try running this example:
>>>
>>> # Load data
>>> library(sp)
>>> data(meuse)
>>> # point data
>>> coordinates(meuse) = ~x+y
>>> data(meuse.grid)
>>> # grid data
>>> gridded(meuse.grid) = ~x+y
>>>
>>> overlay(meuse.grid, meuse)
>>> # Returns the indices in meuse.grid correpsonding to the points in meuse
>>> # get the data from meuse.grid, for example the column "dist"
>>> # a non spatial vector
>>> dist = meuse.grid$dist[overlay(meuse.grid, meuse)]
>>> # A spatialPointsDataFrame
>>> dist = meuse.grid[overlay(meuse.grid, meuse), "dist"]
>>>
>>> Also check out the rgdal pacakge to get your data into R-spatial objects.
>>>
>>> cheers,
>>> Paul
>>>
>>> Frauke Barthold wrote:
>>>
>>>>
>>>> Dear list,
>>>>
>>>> I have a soilmap as an Ascii grid and a dataframe with x and y
>>
>> coordinates (these are sampling points). I would now like to extract
>> values from the soilmap to the dataframe based on location, the ?x and y
>> values. Is there any way to do this in R?
>>
>>>>
>>>> Cheers,
>>>> Frauke
>>>> _________________________________________________________________
>>>>
>>>>
>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>
>>> --
>>> Drs. Paul Hiemstra
>>> Department of Physical Geography
>>> Faculty of Geosciences
>>> University of Utrecht
>>> Heidelberglaan 2
>>> P.O. Box 80.115
>>> 3508 TC Utrecht
>>> Phone: ?+3130 274 3113 Mon-Tue
>>> Phone: ?+3130 253 5773 Wed-Fri
>>> http://intamap.geo.uu.nl/~paul
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>> --
>> Open WebMail Project (http://openwebmail.org)
>>
>>
>
>
> --
> Drs. Paul Hiemstra
> Department of Physical Geography
> Faculty of Geosciences
> University of Utrecht
> Heidelberglaan 2
> P.O. Box 80.115
> 3508 TC Utrecht
> Phone: ?+3130 274 3113 Mon-Tue
> Phone: ?+3130 253 5773 Wed-Fri
> http://intamap.geo.uu.nl/~paul
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.m.krug at gmail.com  Tue Mar 10 13:46:24 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Tue, 10 Mar 2009 14:46:24 +0200
Subject: [R-sig-Geo] Problem loading GRASS 6.3.0 raster
Message-ID: <fb7c7e870903100546t6d7cfb00u659718ee8715a911@mail.gmail.com>

Hi

I want to load a raster from GRASS with readRAST6(..., useGDAL=TRUE),
but I get the following error:

Error in .local(.Object, ...) :
        GDAL Error 4:
`/tmp/15827.1.default.q/simASM.CapePeninsula.15827.1/grass/simulation/.tmp/comp017/HSericea_dc_2007'
does not exist in the file system,
and is not recognised as a supported dataset name.

When I use readRAST6(..., useGDAL=FALSE)
it works.

I am using R 2.7.2, spgrass 0.5.18 and rgdal 0.6.7

GDAL is compiled without GRASS support, but the plugin is installed.


Rainer



-- 
Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
Biology, UCT), Dipl. Phys. (Germany)

Centre of Excellence for Invasion Biology
Faculty of Science
Natural Sciences Building
Private Bag X1
University of Stellenbosch
Matieland 7602
South Africa


From gianni.lavaredo at gmail.com  Tue Mar 10 17:28:22 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 10 Mar 2009 17:28:22 +0100
Subject: [R-sig-Geo] problem to caclulate in a data frame
Message-ID: <518dff330903100928s696f2c8bod34ec355aca29d3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090310/8a740e5e/attachment.pl>

From Roger.Bivand at nhh.no  Tue Mar 10 18:07:42 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 10 Mar 2009 18:07:42 +0100 (CET)
Subject: [R-sig-Geo] Problem loading GRASS 6.3.0 raster
In-Reply-To: <fb7c7e870903100546t6d7cfb00u659718ee8715a911@mail.gmail.com>
References: <fb7c7e870903100546t6d7cfb00u659718ee8715a911@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903101800260.2516@reclus.nhh.no>

On Tue, 10 Mar 2009, Rainer M Krug wrote:

> Hi
>
> I want to load a raster from GRASS with readRAST6(..., useGDAL=TRUE),
> but I get the following error:
>
> Error in .local(.Object, ...) :
>        GDAL Error 4:
> `/tmp/15827.1.default.q/simASM.CapePeninsula.15827.1/grass/simulation/.tmp/comp017/HSericea_dc_2007'
> does not exist in the file system,
> and is not recognised as a supported dataset name.

Rainer,

Two extra pieces of information might be helpful, the traceback() of the 
error (to see which R code was used last) and the GRASS version. If you 
felt like running readRAST6() under debug(), it would be even clearer 
whether execution is following the plugin or r.out.gdal forks in the code.

I ask about the GRASS version because I seem to remember a file name 
length limitation in older versions.

Roger


>
> When I use readRAST6(..., useGDAL=FALSE)
> it works.
>
> I am using R 2.7.2, spgrass 0.5.18 and rgdal 0.6.7
>
> GDAL is compiled without GRASS support, but the plugin is installed.
>
>
> Rainer
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Torleif.Lunde at cih.uib.no  Tue Mar 10 18:56:20 2009
From: Torleif.Lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Tue, 10 Mar 2009 18:56:20 +0100
Subject: [R-sig-Geo] problem to caclulate in a data frame
References: <518dff330903100928s696f2c8bod34ec355aca29d3@mail.gmail.com>
Message-ID: <A3EA804CA6F446429B6AEBB45558456301270E43@HUGIN.uib.no>

Don't worry. Everyone has to start somewhere. If I understand your question correctly, this is what you want. 
##START##
#Make a demonstration data frame
data.df <- data.frame(ID=factor(c(1, 2, 3, 4, 5)), x=c(25.8, 45, 24.1, 54.8, 41.9))
#If you want to keep the original data frame, make a new one equal to data.df
CorrectIndex.df <- data.df
#COlumn x in CorrectIndex.df should be equal to data.df$x - 2
CorrectIndex.df$x <-  data.df$x - 2
##END##
 
Here 2 is recycled for each row, and is actually treated as a vector. What it actually does is to create a vector c(2,2,2,2,2) and subtract it. You could also try data.df$x - c(2, 1) and look at the result. When you feel more into R, you could also look at ?apply
sapply(data.df$x, function (x) x-2)
 
When that is said, I guess this question would be more suitable for the R-help mailinglist. 
 
What you actually did was to ask R to sort (and subset) the rows in the dataframe like this data.df[c(5, 4, 3, 1, 2), c("ID", "x")]. You also say it should be done for both ID and x. Try the example in the previous sentence, and you will understand..
 
Best wishes, and good luck
Torleif
 
 

________________________________

Fra: r-sig-geo-bounces at stat.math.ethz.ch p? vegne av gianni lavaredo
Sendt: ti 10.03.2009 17:28
Til: r-sig-geo at stat.math.ethz.ch
Emne: [R-sig-Geo] problem to caclulate in a data frame



Thanks for attention. I am reading the manual of R to work inside the
dataframe. I write this code to subtract the value 2 at the column x
values

I import the data, see the structures of my data frame

> str(Soil_pollution)
'data.frame':   912 obs. of  2 variables:
 $ ID: Factor w/ 912 levels "1","2","3","4",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ x : num  22.8 23 53.5 39.7 27.5 ...



# subtract index = 2 at all values
indexcorrect_Soil_pollution <- Soil_pollution[Soil_pollution$x - 2
,c("ID","x")]

> str(indexcorrect_Soil_pollution)
'data.frame':   912 obs. of  2 variables:
 $ ID: Factor w/ 912 levels "1","2","3","4",..: 20 21 51 37 25 45 37 24 36
39 ...
 $ x : num  25.8 45 24.1 54.8 41.9 ...

there is a modification of the data frame but sorry I don't understand where
is the problem in the code. I spent all my afternoon to read.  Sorry if I
sent this email

Gianni

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From gustaf.rydevik at gmail.com  Tue Mar 10 19:06:14 2009
From: gustaf.rydevik at gmail.com (Gustaf Rydevik)
Date: Tue, 10 Mar 2009 19:06:14 +0100
Subject: [R-sig-Geo] Smallest distance from one point feature to a point
	layer
Message-ID: <45f568c70903101106s6e19ff1p6bd670b1e07d957f@mail.gmail.com>

Hi All,

I have two shapefiles with point features, A and B. I've managed to
import them into R with maptools and spatstat.
Now I would like to calculate, for each point in A, the closest
distance to any point in B.
What is the best way to do this?

Many thanks in advance,

Gustaf
-- 
Gustaf Rydevik, M.Sci.
tel: +46(0)703 051 451
address:Essingetorget 40,112 66 Stockholm, SE
skype:gustaf_rydevik


From Torleif.Lunde at cih.uib.no  Tue Mar 10 19:14:40 2009
From: Torleif.Lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Tue, 10 Mar 2009 19:14:40 +0100
Subject: [R-sig-Geo] Smallest distance from one point feature to a
	pointlayer
References: <45f568c70903101106s6e19ff1p6bd670b1e07d957f@mail.gmail.com>
Message-ID: <A3EA804CA6F446429B6AEBB45558456301270E44@HUGIN.uib.no>

Hi
 
Roger Bivand replied a similar question 3.5 years (roughly) ago. Maybe this link can help you:
 
https://stat.ethz.ch/pipermail/r-sig-geo/2005-November/000682.html <http://osdir.com/ml/lang.r.geo/2005-11/msg00032.html> 
 
Best wishes
Torleif 

________________________________

Fra: r-sig-geo-bounces at stat.math.ethz.ch p? vegne av Gustaf Rydevik
Sendt: ti 10.03.2009 19:06
Til: r-sig-geo at stat.math.ethz.ch
Emne: [R-sig-Geo] Smallest distance from one point feature to a pointlayer



Hi All,

I have two shapefiles with point features, A and B. I've managed to
import them into R with maptools and spatstat.
Now I would like to calculate, for each point in A, the closest
distance to any point in B.
What is the best way to do this?

Many thanks in advance,

Gustaf
--
Gustaf Rydevik, M.Sci.
tel: +46(0)703 051 451
address:Essingetorget 40,112 66 Stockholm, SE
skype:gustaf_rydevik

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From reeves at nceas.ucsb.edu  Tue Mar 10 19:36:39 2009
From: reeves at nceas.ucsb.edu (rick reeves)
Date: Tue, 10 Mar 2009 11:36:39 -0700
Subject: [R-sig-Geo] Smallest distance from one point feature to
	a	pointlayer
In-Reply-To: <A3EA804CA6F446429B6AEBB45558456301270E44@HUGIN.uib.no>
References: <45f568c70903101106s6e19ff1p6bd670b1e07d957f@mail.gmail.com>
	<A3EA804CA6F446429B6AEBB45558456301270E44@HUGIN.uib.no>
Message-ID: <49B6B337.8010403@nceas.ucsb.edu>

Hello,
and here is another demonstration:

http://nceas.ucsb.edu/scicomp/GISSeminar/UseCases/AssignClosestPointsR/AssignClosestPointsR.html

And the 'Assign Closest Airports to Cities' example on this page might 
be useful -

http://nceas.ucsb.edu/scicomp/RSpatialWorkshopExamples.html

Regards,
Rick R

Torleif Markussen Lunde wrote:
> Hi
>  
> Roger Bivand replied a similar question 3.5 years (roughly) ago. Maybe this link can help you:
>  
> https://stat.ethz.ch/pipermail/r-sig-geo/2005-November/000682.html <http://osdir.com/ml/lang.r.geo/2005-11/msg00032.html> 
>  
> Best wishes
> Torleif 
>
> ________________________________
>
> Fra: r-sig-geo-bounces at stat.math.ethz.ch p? vegne av Gustaf Rydevik
> Sendt: ti 10.03.2009 19:06
> Til: r-sig-geo at stat.math.ethz.ch
> Emne: [R-sig-Geo] Smallest distance from one point feature to a pointlayer
>
>
>
> Hi All,
>
> I have two shapefiles with point features, A and B. I've managed to
> import them into R with maptools and spatstat.
> Now I would like to calculate, for each point in A, the closest
> distance to any point in B.
> What is the best way to do this?
>
> Many thanks in advance,
>
> Gustaf
> --
> Gustaf Rydevik, M.Sci.
> tel: +46(0)703 051 451
> address:Essingetorget 40,112 66 Stockholm, SE
> skype:gustaf_rydevik
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Rick Reeves
Scientific Programmer/Analyst and Data Manager
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
www.nceas.ucsb.edu
805 892 2533


From alessandro.montaghi at unifi.it  Tue Mar 10 22:33:58 2009
From: alessandro.montaghi at unifi.it (Alessandro)
Date: Tue, 10 Mar 2009 22:33:58 +0100
Subject: [R-sig-Geo] Help with suggestion to finish to write a "layer/bins
	density index"
Message-ID: <00f601c9a1c7$ec0c1b30$c4245190$@montaghi@unifi.it>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090310/1acefb03/attachment.pl>

From r.m.krug at gmail.com  Wed Mar 11 07:48:38 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Wed, 11 Mar 2009 08:48:38 +0200
Subject: [R-sig-Geo] Problem loading GRASS 6.3.0 raster
In-Reply-To: <alpine.LRH.2.00.0903101800260.2516@reclus.nhh.no>
References: <fb7c7e870903100546t6d7cfb00u659718ee8715a911@mail.gmail.com>
	<alpine.LRH.2.00.0903101800260.2516@reclus.nhh.no>
Message-ID: <fb7c7e870903102348k51573706w41740a111f64ebd9@mail.gmail.com>

On Tue, Mar 10, 2009 at 7:07 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Tue, 10 Mar 2009, Rainer M Krug wrote:
>
>> Hi
>>
>> I want to load a raster from GRASS with readRAST6(..., useGDAL=TRUE),
>> but I get the following error:
>>
>> Error in .local(.Object, ...) :
>> ? ? ? GDAL Error 4:
>>
>> `/tmp/15827.1.default.q/simASM.CapePeninsula.15827.1/grass/simulation/.tmp/comp017/HSericea_dc_2007'
>> does not exist in the file system,
>> and is not recognised as a supported dataset name.
>
> Rainer,
>
> Two extra pieces of information might be helpful, the traceback() of the
> error (to see which R code was used last) and the GRASS version. If you felt
> like running readRAST6() under debug(), it would be even clearer whether
> execution is following the plugin or r.out.gdal forks in the code.


Hi Roger

Here is the additional info you asked for:

GRASS version: 6.3.0

traceback():
> tmp <- readRAST6("MASK", useGDAL=TRUE)

> tmp <- readRAST6("MASK", useGDAL=FALSE)
Creating BIL support files...
Header File =
/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK.hdr
World File =
/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK.wld
Exporting raster as floating values (bytes=4)
Using the current region settings...
north=6263000.000000
south=6242000.000000
east=653000.000000
west=574000.000000
r=210
c=790

> tmp <- readRAST6("MASK", useGDAL=TRUE)
Sorry, <c> is not a valid flag
Error in .local(.Object, ...) :

	GDAL Error 4: `/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK'
does not exist in the file system,
and is not recognised as a supported dataset name.

> traceback()
8: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, PACKAGE = "rgdal")
7: .local(.Object, ...)
6: initialize(value, ...)
5: initialize(value, ...)
4: new("GDALReadOnlyDataset", filename)
3: GDAL.open(fname)
2: readGDAL(rtmpfl11, p4s = getLocationProj(), silent = ignore.stderr)
1: readRAST6("MASK", useGDAL = TRUE)
>


last lines of debug(readRAST6):
Browse[1]>
debug: if (useGDAL && G63) {
    type <- ifelse(to_int, "Int32", "Float32")
    cmd <- paste(paste("r.out.gdal", .addexe(), sep = ""), " -c
--quiet input=",
        vname[i], " output=", gtmpfl11, " type=", type, " nodata=",
        NODATA, sep = "")
    tull <- ifelse(.Platform$OS.type == "windows", system(cmd),
        system(cmd, ignore.stderr = ignore.stderr))
    res <- readGDAL(rtmpfl11, p4s = getLocationProj(), silent = ignore.stderr)
    names(res) <- vname[i]
} else {
    cmd <- paste(paste("r.out.bin", .addexe(), sep = ""), " -b input=",
        vname[i], " output=", gtmpfl11, " null=", NODATA, sep = "")
    tull <- ifelse(.Platform$OS.type == "windows", system(cmd),
        system(cmd, ignore.stderr = ignore.stderr))
    res <- readBinGrid(rtmpfl11, colname = vname[i], proj4string = p4,
        integer = to_int)
}
Browse[1]>
debug: type <- ifelse(to_int, "Int32", "Float32")
Browse[1]>
debug: cmd <- paste(paste("r.out.gdal", .addexe(), sep = ""), " -c
--quiet input=",
    vname[i], " output=", gtmpfl11, " type=", type, " nodata=",
    NODATA, sep = "")
Browse[1]>
debug: tull <- ifelse(.Platform$OS.type == "windows", system(cmd), system(cmd,
    ignore.stderr = ignore.stderr))
Browse[1]>
Sorry, <c> is not a valid flag
debug: res <- readGDAL(rtmpfl11, p4s = getLocationProj(), silent =
ignore.stderr)
Browse[1]>
Error in .local(.Object, ...) :

	GDAL Error 4: `/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK'
does not exist in the file system,
and is not recognised as a supported dataset name.


and

last lines of debug(readGDAL)

Browse[1]>
debug: if (nchar(fname) == 0) stop("empty file name")
Browse[1]>
debug: x = GDAL.open(fname)
Browse[1]>
Error in .local(.Object, ...) :

	GDAL Error 4: `/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK'
does not exist in the file system,
and is not recognised as a supported dataset name.


finally  debug(GDAL.open):
> tmp <- readRAST6("MASK", useGDAL=TRUE)
Sorry, <c> is not a valid flag
debugging in: GDAL.open(fname)
debug: {
    res <- if (read.only)
        new("GDALReadOnlyDataset", filename)
    else new("GDALDataset", filename)
    res
}
Browse[1]>
debug: res <- if (read.only) new("GDALReadOnlyDataset", filename) else
new("GDALDataset",
    filename)
Browse[1]>
Error in .local(.Object, ...) :

	GDAL Error 4: `/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK'
does not exist in the file system,
and is not recognised as a supported dataset name.


readRAST("MASK", useGDAL=FALSE) is working.

If you need any further info, just let me know.

Rainer

>

>
>
>
> I ask about the GRASS version because I seem to remember a file name length
> limitation in older versions.
>
> Roger
>
>
>>
>> When I use readRAST6(..., useGDAL=FALSE)
>> it works.
>>
>> I am using R 2.7.2, spgrass 0.5.18 and rgdal 0.6.7
>>
>> GDAL is compiled without GRASS support, but the plugin is installed.
>>
>>
>> Rainer
>>
>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>



-- 
Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
Biology, UCT), Dipl. Phys. (Germany)

Centre of Excellence for Invasion Biology
Faculty of Science
Natural Sciences Building
Private Bag X1
University of Stellenbosch
Matieland 7602
South Africa


From Roger.Bivand at nhh.no  Wed Mar 11 08:48:23 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 11 Mar 2009 08:48:23 +0100 (CET)
Subject: [R-sig-Geo] Problem loading GRASS 6.3.0 raster
In-Reply-To: <fb7c7e870903102348k51573706w41740a111f64ebd9@mail.gmail.com>
References: <fb7c7e870903100546t6d7cfb00u659718ee8715a911@mail.gmail.com>
	<alpine.LRH.2.00.0903101800260.2516@reclus.nhh.no>
	<fb7c7e870903102348k51573706w41740a111f64ebd9@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903110839340.4911@reclus.nhh.no>

On Wed, 11 Mar 2009, Rainer M Krug wrote:

> On Tue, Mar 10, 2009 at 7:07 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Tue, 10 Mar 2009, Rainer M Krug wrote:
>>
>>> Hi
>>>
>>> I want to load a raster from GRASS with readRAST6(..., useGDAL=TRUE),
>>> but I get the following error:
>>>
>>> Error in .local(.Object, ...) :
>>> ? ? ? GDAL Error 4:
>>>
>>> `/tmp/15827.1.default.q/simASM.CapePeninsula.15827.1/grass/simulation/.tmp/comp017/HSericea_dc_2007'
>>> does not exist in the file system,
>>> and is not recognised as a supported dataset name.
>>
>> Rainer,
>>
>> Two extra pieces of information might be helpful, the traceback() of the
>> error (to see which R code was used last) and the GRASS version. If you felt
>> like running readRAST6() under debug(), it would be even clearer whether
>> execution is following the plugin or r.out.gdal forks in the code.
>
>
> Hi Roger
>
> Here is the additional info you asked for:
>
> GRASS version: 6.3.0
>
> traceback():
>> tmp <- readRAST6("MASK", useGDAL=TRUE)
>
>> tmp <- readRAST6("MASK", useGDAL=FALSE)
> Creating BIL support files...
> Header File =
> /home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK.hdr
> World File =
> /home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK.wld
> Exporting raster as floating values (bytes=4)
> Using the current region settings...
> north=6263000.000000
> south=6242000.000000
> east=653000.000000
> west=574000.000000
> r=210
> c=790
>
>> tmp <- readRAST6("MASK", useGDAL=TRUE)
> Sorry, <c> is not a valid flag


Thanks. The problem is that some GRASS 6.3 but > 6.3.0 have a -c flag to 
r.out.gdal to suppress colortable export, and here this is used but for an 
earlier version of GRASS. The flag is present in 6.4. I'll try to add 
guard checks to test for its presence if the GRASS version is 6.3.

Roger

> Error in .local(.Object, ...) :
>
> 	GDAL Error 4: `/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK'
> does not exist in the file system,
> and is not recognised as a supported dataset name.
>
>> traceback()
> 8: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, PACKAGE = "rgdal")
> 7: .local(.Object, ...)
> 6: initialize(value, ...)
> 5: initialize(value, ...)
> 4: new("GDALReadOnlyDataset", filename)
> 3: GDAL.open(fname)
> 2: readGDAL(rtmpfl11, p4s = getLocationProj(), silent = ignore.stderr)
> 1: readRAST6("MASK", useGDAL = TRUE)
>>
>
>
> last lines of debug(readRAST6):
> Browse[1]>
> debug: if (useGDAL && G63) {
>    type <- ifelse(to_int, "Int32", "Float32")
>    cmd <- paste(paste("r.out.gdal", .addexe(), sep = ""), " -c
> --quiet input=",
>        vname[i], " output=", gtmpfl11, " type=", type, " nodata=",
>        NODATA, sep = "")
>    tull <- ifelse(.Platform$OS.type == "windows", system(cmd),
>        system(cmd, ignore.stderr = ignore.stderr))
>    res <- readGDAL(rtmpfl11, p4s = getLocationProj(), silent = ignore.stderr)
>    names(res) <- vname[i]
> } else {
>    cmd <- paste(paste("r.out.bin", .addexe(), sep = ""), " -b input=",
>        vname[i], " output=", gtmpfl11, " null=", NODATA, sep = "")
>    tull <- ifelse(.Platform$OS.type == "windows", system(cmd),
>        system(cmd, ignore.stderr = ignore.stderr))
>    res <- readBinGrid(rtmpfl11, colname = vname[i], proj4string = p4,
>        integer = to_int)
> }
> Browse[1]>
> debug: type <- ifelse(to_int, "Int32", "Float32")
> Browse[1]>
> debug: cmd <- paste(paste("r.out.gdal", .addexe(), sep = ""), " -c
> --quiet input=",
>    vname[i], " output=", gtmpfl11, " type=", type, " nodata=",
>    NODATA, sep = "")
> Browse[1]>
> debug: tull <- ifelse(.Platform$OS.type == "windows", system(cmd), system(cmd,
>    ignore.stderr = ignore.stderr))
> Browse[1]>
> Sorry, <c> is not a valid flag
> debug: res <- readGDAL(rtmpfl11, p4s = getLocationProj(), silent =
> ignore.stderr)
> Browse[1]>
> Error in .local(.Object, ...) :
>
> 	GDAL Error 4: `/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK'
> does not exist in the file system,
> and is not recognised as a supported dataset name.
>
>
> and
>
> last lines of debug(readGDAL)
>
> Browse[1]>
> debug: if (nchar(fname) == 0) stop("empty file name")
> Browse[1]>
> debug: x = GDAL.open(fname)
> Browse[1]>
> Error in .local(.Object, ...) :
>
> 	GDAL Error 4: `/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK'
> does not exist in the file system,
> and is not recognised as a supported dataset name.
>
>
> finally  debug(GDAL.open):
>> tmp <- readRAST6("MASK", useGDAL=TRUE)
> Sorry, <c> is not a valid flag
> debugging in: GDAL.open(fname)
> debug: {
>    res <- if (read.only)
>        new("GDALReadOnlyDataset", filename)
>    else new("GDALDataset", filename)
>    res
> }
> Browse[1]>
> debug: res <- if (read.only) new("GDALReadOnlyDataset", filename) else
> new("GDALDataset",
>    filename)
> Browse[1]>
> Error in .local(.Object, ...) :
>
> 	GDAL Error 4: `/home/rkrug/Documents/Projects/AlienSpread/R/../grass/simulation/.tmp/ecolmod/MASK'
> does not exist in the file system,
> and is not recognised as a supported dataset name.
>
>
> readRAST("MASK", useGDAL=FALSE) is working.
>
> If you need any further info, just let me know.
>
> Rainer
>
>>
>
>>
>>
>>
>> I ask about the GRASS version because I seem to remember a file name length
>> limitation in older versions.
>>
>> Roger
>>
>>
>>>
>>> When I use readRAST6(..., useGDAL=FALSE)
>>> it works.
>>>
>>> I am using R 2.7.2, spgrass 0.5.18 and rgdal 0.6.7
>>>
>>> GDAL is compiled without GRASS support, but the plugin is installed.
>>>
>>>
>>> Rainer
>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From pbeck at whrc.org  Wed Mar 11 14:17:58 2009
From: pbeck at whrc.org (Pieter Beck)
Date: Wed, 11 Mar 2009 09:17:58 -0400
Subject: [R-sig-Geo] downloading MODIS data, individual pixels
Message-ID: <002c01c9a24b$cbd12ca0$637385e0$@org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090311/ab949a5d/attachment.pl>

From sven.adler2 at uni-rostock.de  Wed Mar 11 15:48:00 2009
From: sven.adler2 at uni-rostock.de (Sven Adler)
Date: Wed, 11 Mar 2009 15:48:00 +0100
Subject: [R-sig-Geo] Zero Inflated Poisson
Message-ID: <f9bd47b4e30.e30f9bd47b4@uni-rostock.de>

Dear all,
I want to model bird distribution at see. The data consists 10000
samples but 90% are zeros. I try first a gamm (mgcv)with quasipoisson
but it might bee problematic with so many zeros. I look for a (spatial)
model that can use Zero Inflated Poisson distribution or similar. Is
there any?

Thank you
sincerely yours

Sven


From edzer.pebesma at uni-muenster.de  Wed Mar 11 16:21:35 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 11 Mar 2009 16:21:35 +0100
Subject: [R-sig-Geo] Zero Inflated Poisson
In-Reply-To: <f9bd47b4e30.e30f9bd47b4@uni-rostock.de>
References: <f9bd47b4e30.e30f9bd47b4@uni-rostock.de>
Message-ID: <49B7D6FF.8010602@uni-muenster.de>

*I'm not sure if you're aware of the following publication:

*

*2005*: Mapping sea bird densities over the North Sea: spatially
aggregated estimates and temporal changes
<http://www.citeulike.org/article/3505281>
Pebesma Edzer J. and Duin Richard N. M. and Burrough Peter A.
/Environmetrics/

*The analysis done there is mostly reproduced by:
*

*library(gstat)
demo(fulmar) # Fulmaris glacialis
*

*Another direction you might want to look at is package geoRglm.
*

*Best regads,
--
Edzer
*



Sven Adler wrote:
> Dear all,
> I want to model bird distribution at see. The data consists 10000
> samples but 90% are zeros. I try first a gamm (mgcv)with quasipoisson
> but it might bee problematic with so many zeros. I look for a (spatial)
> model that can use Zero Inflated Poisson distribution or similar. Is
> there any?
>
> Thank you
> sincerely yours
>
> Sven
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From qlemouland at yahoo.fr  Wed Mar 11 16:57:03 2009
From: qlemouland at yahoo.fr (Quentin LEMOULAND)
Date: Wed, 11 Mar 2009 15:57:03 +0000 (GMT)
Subject: [R-sig-Geo] "clustered" Random distribution of statial points
Message-ID: <12590.41508.qm@web24203.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090311/9bb89960/attachment.pl>

From Virgilio.Gomez at uclm.es  Wed Mar 11 17:03:40 2009
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Wed, 11 Mar 2009 17:03:40 +0100
Subject: [R-sig-Geo] Zero Inflated Poisson
In-Reply-To: <49B7D6FF.8010602@uni-muenster.de>
References: <f9bd47b4e30.e30f9bd47b4@uni-rostock.de>
	<49B7D6FF.8010602@uni-muenster.de>
Message-ID: <1236787420.7197.11.camel@Virgilio-Gomez>

Sven,

In addition to what Edzer has pointed out, I have been trying to fit
some zero-inflated Binomial models recently, but I have found that
including spatial random effects may not be a good idea when the number
of zeros is large. 

In our case, we have 126 observations with only 17 non-zero
observations. We used package VGAM to fit zero-inflated models and
WinBUGS to fit models with random effects. In general, including random
effects is problematic and convergence was terrible in some cases. My
feeling is that the zero-inflated part of the model may clash with
random effects. 

If you have several observations per site this may change. We also
observed a better fit when we consider several observations per site (by
splitting the observations into 3 age groups).

I do not think that there is a way of fitting zero-inflated spatial
models in R (but I may be wrong). I asked Paulo Ribeiro some months ago
about whether geoR/geoRglm can handle that and the answer was no.

Hope this helps.

Virgilio

El mi?, 11-03-2009 a las 16:21 +0100, Edzer Pebesma escribi?:
> *I'm not sure if you're aware of the following publication:
> 
> *
> 
> *2005*: Mapping sea bird densities over the North Sea: spatially
> aggregated estimates and temporal changes
> <http://www.citeulike.org/article/3505281>
> Pebesma Edzer J. and Duin Richard N. M. and Burrough Peter A.
> /Environmetrics/
> 
> *The analysis done there is mostly reproduced by:
> *
> 
> *library(gstat)
> demo(fulmar) # Fulmaris glacialis
> *
> 
> *Another direction you might want to look at is package geoRglm.
> *
> 
> *Best regads,
> --
> Edzer
> *
> 
> 
> 
> Sven Adler wrote:
> > Dear all,
> > I want to model bird distribution at see. The data consists 10000
> > samples but 90% are zeros. I try first a gamm (mgcv)with quasipoisson
> > but it might bee problematic with so many zeros. I look for a (spatial)
> > model that can use Zero Inflated Poisson distribution or similar. Is
> > there any?
> >
> > Thank you
> > sincerely yours
> >
> > Sven
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >   
> 


From Thierry.ONKELINX at inbo.be  Wed Mar 11 17:05:20 2009
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Wed, 11 Mar 2009 17:05:20 +0100
Subject: [R-sig-Geo] "clustered" Random distribution of statial points
In-Reply-To: <12590.41508.qm@web24203.mail.ird.yahoo.com>
References: <12590.41508.qm@web24203.mail.ird.yahoo.com>
Message-ID: <2E9C414912813E4EB981326983E0A104062E0763@inboexch.inbo.be>

Dear Quentin,

Have a look at the spatstat package. The Strauss process or hard-core process is what you are looking for.

HTH,

Thierry 


----------------------------------------------------------------------------
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics, methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium 
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be 
www.inbo.be 

To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Quentin LEMOULAND
Verzonden: woensdag 11 maart 2009 16:57
Aan: r-sig-geo at stat.math.ethz.ch
Onderwerp: [R-sig-Geo] "clustered" Random distribution of statial points

Hello,

I am trying to make a "clustered" Random distribution of statial points.
I want to make p "random" distribution of n points.
But I don't want a typical random distribution. I want a clustered one (with minimal distances bettween my points fixed as my observed distribution: c(3.9,3.3,1.4,1.4,0.7,0.7)).
I have seen that the spsample function from package sp could "in theory" make this...
But impossible to understand how to make it work:

> spsample(var,10,"clustered")
Erreur dans `[<-.data.frame`(`*tmp*`, , j, value = c(-33.8558590595841, -24.8671595071446,? : 
? replacement has 14 rows, data has 12

Does anyone know the solution, there is no example in the help page of spsample.

Thanks by advance,

Quentin





      
	[[alternative HTML version deleted]]


Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer 
en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is
door een geldig ondertekend document. The views expressed in  this message 
and any annex are purely those of the writer and may not be regarded as stating 
an official position of INBO, as long as the message is not confirmed by a duly 
signed document.


From figen.ramirez at gmail.com  Wed Mar 11 21:34:37 2009
From: figen.ramirez at gmail.com (Figen Ramirez)
Date: Wed, 11 Mar 2009 15:34:37 -0500
Subject: [R-sig-Geo] detrending 3d data
Message-ID: <1a5e77ac0903111334n3e071549v8542aa3bba7aab0d@mail.gmail.com>

Hello,

I have a 3D data that I would like to detrend.
 summary(MC610)
       X                Y                 Zm                MC
 Min.   :262472   Min.   :3296543   Min.   : 0.3048   Min.   : 5.00
 1st Qu.:262670   1st Qu.:3296859   1st Qu.: 2.4384   1st Qu.:14.00
 Median :262845   Median :3297034   Median : 4.2672   Median :17.00
 Mean   :262840   Mean   :3297020   Mean   : 8.1005   Mean   :17.81
 3rd Qu.:262977   3rd Qu.:3297193   3rd Qu.:11.5824   3rd Qu.:21.00
 Max.   :263285   Max.   :3297466   Max.   :30.1752   Max.   :37.00
X,Y and Zm are my coordinates all in meters and my variable is MC.
After I checked my variogram I realized that I have trend. My question
is can I use :

lm(MC~X+Y+Zm+I(X)^2+I(Y)^2+I(Zm)^2)

Unfortunately I couldn't find much information on 3D spatial problems
and none of the ones I have found tackle the detrending. Now I am
wondering is there something I am missing? I am new in both R and
geostatistics so please forgive me if my question is very simple.

Thanks in advance

-- 
Figen Esen Ramirez


From fkbarthold46 at hotmail.com  Thu Mar 12 08:29:36 2009
From: fkbarthold46 at hotmail.com (Frauke Barthold)
Date: Thu, 12 Mar 2009 08:29:36 +0100
Subject: [R-sig-Geo] extract values to points
In-Reply-To: <dc22b2570903100519o442ec69w981b471f25f0add5@mail.gmail.com>
References: <BLU126-W115C981401850F3622F1F5CAA40@phx.gbl>
	<49B63B27.1020401@geo.uu.nl> <20090310101256.M67642@mail.orn.mpg.de>
	<49B653EE.7020303@geo.uu.nl> 
	<dc22b2570903100519o442ec69w981b471f25f0add5@mail.gmail.com>
Message-ID: <BLU126-W1BCF0ECC496E7477EFA7CCA9F0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090312/fa9255d1/attachment.pl>

From bfissel at ucsd.edu  Thu Mar 12 08:51:57 2009
From: bfissel at ucsd.edu (Ben Fissel)
Date: Thu, 12 Mar 2009 00:51:57 -0700
Subject: [R-sig-Geo] large shapefiles; zip code data
Message-ID: <ca69cc1d0903120051h5756c3fcyf2be3e25e2be30b8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090312/5ade155a/attachment.pl>

From Virgilio.Gomez at uclm.es  Thu Mar 12 10:50:33 2009
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Thu, 12 Mar 2009 10:50:33 +0100
Subject: [R-sig-Geo] large shapefiles; zip code data
In-Reply-To: <ca69cc1d0903120051h5756c3fcyf2be3e25e2be30b8@mail.gmail.com>
References: <ca69cc1d0903120051h5756c3fcyf2be3e25e2be30b8@mail.gmail.com>
Message-ID: <1236851433.7218.21.camel@Virgilio-Gomez>

Ben,

How many areas will you have in case you are able to read in all your
shapefiles? Are you sure that you will be able to handle that once you
have your data ready? If you have too many areas perhaps you should
consider aggregate your data in some way and try running a modela with
that.

I know that this is not an answer, but if you are trying to fit a model
with WinBUGS,  it may not take a very large data set. And, if it does,
you will need to run it for a long time before you get an answer.

Best,

Virgilio


El jue, 12-03-2009 a las 00:51 -0700, Ben Fissel escribi?:
> Hello,
> 
> I am attempting to fit a model CAR count data model of the Besag-York-Mollie
> form to US zip code data (entire US minus Hawaii and Alaska).  However, I'm
> running out of memory reading in the zip code data.  The zip code data I
> obtained form the census at
> http://www2.census.gov/geo/tiger/TIGER2008/tl_2008_us_zcta500.zip and are
> shapefiles.  I've allocated 4GB of memory to R which is the max my OS will
> give it (Vista).  Despite this when I attempt to load the shapefiles in I
> run out of memory using readOGR or readShapePoly .  I had a similar problem
> in Stata and worked around it by reading in the shapefiles for the lower 48
> states http://www.census.gov/geo/www/cob/z52000.html separately and
> concatenating them together, relabeling the ID in the process.  I'm trying
> to do the same thing in R but relabeling the ID is not as straight forward
> for me given my novice R programming ability.  Luckily I found a little help
> at
> http://help.nceas.ucsb.edu/R:_Spatial#Understanding_spatial_data_formats_in_Rwhich
> I adapted to my code.
> 
> spatdata <- readOGR(".", "zt01_d00")
> #spatdata <- readShapePoly("zt01_d00")
> names(spatdata)[3] <- "ZT00_D00"
> names(spatdata)[4] <- "ZT00_D00_I"
> 
> for (j in 2:2){    # Just loop over one file until I get it to work
>    filename <- paste("zt", statelist[j], "_d00",sep ="")  #statlist  is a
> vector of the form statelist <- c("01","04",...,"56") with number that
> correspond the 48 state shapefiles
> 
>    spatdf <- readOGR(".", filename)
>  # spatdf <- readShapePoly(filename)
>    names(spatdf)[3] <- "ZT00_D00"
>    names(spatdf)[4] <- "ZT00_D00_I"
>    mergedata <- rbind(spatdata at data,spatdf at data)
>    mergepolys <- c(spatdata at polygons,spatdf at polygons)
>    mergepolysp <-
> SpatialPolygons(mergepolys,proj4string=CRS(proj4string(spatdf)))
>    rm("spatdata","spatdf","filename")
> 
>    for (i in 1: length(mergepolys)){
>      sNew = as.character(i)
>      mergepolys[i]@ID = sNew
>    }
>    ID <- c(as.character(1:length(mergepolys)))
>    mergedataID <- cbind(ID,mergedata)
>    spatdata <- SpatialPolygonsDataFrame(mergepolysp,data =
> mergedataID,match.ID = FALSE)
>    rm("mergepolys","mergedata","mergepolysp","mergedataID","ID")
> 
>    gc()
> }
> 
> However in the for loop over "i" I get an error when trying to relabel the
> ID: "Error in validObject(.Object) :  invalid class "SpatialPolygons"
> object: non-unique Polygons ID slot values" .  I've tried a number of
> different ways to change the ID in 'mergepolys' but haven't been successful
> yet.
> 
> Ultimately, I just want to get the shapefiles into R so I can identify
> contiguous zip codes for the spatial regression.  Whether I get this by
> loading in one big shape zip code file or concatenating 48 state files is
> irrelevant to me.  Perhaps the census shapefiles have superfluous data that
> I can get rid of to free up memory and still achieve my objective, I don't
> know enough about shapefiles and how R reads them to know what I can throw
> away.  Maybe I'm going about this all wrong.  Thank you for any help and or
> suggestions that you can provide.
> 
> After getting the shapefiles in I plan to identify contiguous zip codes and
> use R2Winbugs to fit the model as outlined in "Applied Spatial Data Analysis
> with R".  However, given the memory issues I'm having I am concerned that
> forming the spatial weighting matrix won't be possible, will R try to store
> this as an nxn matrix?  Furthermore, I have about 50+ other covariates that
> I need to merge in with the zip code data that is going to take up memory as
> well.  Simply put, is the memory bottleneck just in the function(s) loading
> the shapefiles or am I going to have trouble fitting this model with the
> covariates in R?
> 
> I've seen the thread "mapping by zip codes"
> https://stat.ethz.ch/pipermail/r-sig-geo/2009-March/005194.html , which
> provides very useful information but hasn't helped me get around the
> problems I'm having.
> 
> I've tried to be complete yet concise.  If there is any other information
> you need please let me know.
> 
> Thanks for any help and or suggestions you can provide.
> 
> -Ben
> -- 
> Benjamin Earl Fissel
> Economics Graduate Student
> University of California, San Diego
> bfissel.googlepages.com/home
> bfissel at ucsd.edu
> bfissel at gmail.com
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From bfissel at ucsd.edu  Thu Mar 12 11:38:49 2009
From: bfissel at ucsd.edu (Ben Fissel)
Date: Thu, 12 Mar 2009 03:38:49 -0700
Subject: [R-sig-Geo] large shapefiles; zip code data
In-Reply-To: <1236851433.7218.21.camel@Virgilio-Gomez>
References: <ca69cc1d0903120051h5756c3fcyf2be3e25e2be30b8@mail.gmail.com>
	<1236851433.7218.21.camel@Virgilio-Gomez>
Message-ID: <ca69cc1d0903120338o372870ebv571601c1e295869c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090312/76f109ea/attachment.pl>

From Virgilio.Gomez at uclm.es  Thu Mar 12 11:46:22 2009
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Thu, 12 Mar 2009 11:46:22 +0100
Subject: [R-sig-Geo] large shapefiles; zip code data
In-Reply-To: <ca69cc1d0903120338o372870ebv571601c1e295869c@mail.gmail.com>
References: <ca69cc1d0903120051h5756c3fcyf2be3e25e2be30b8@mail.gmail.com>
	<1236851433.7218.21.camel@Virgilio-Gomez>
	<ca69cc1d0903120338o372870ebv571601c1e295869c@mail.gmail.com>
Message-ID: <1236854782.7218.32.camel@Virgilio-Gomez>

Hi Ben,

> There are 31625 zipcodes which correspond to a geographic area in the
> US.  I'm expecting it to take a while to run, as long as it takes less

I know that some people in Spain were using similar models with around
8500 areas and it took 18 hours to run. So not sure if in your case
WinBUGS will be able to give you an answer in a reasonable time. You may
try to load your shapefiles using a GIS and then try to make the
adjacency matrix with that. Depending on the software, you may get a
better memory management.

When fitting your models, I believe that you should try INLA if you have
a large number of areas. It is a software for Approximate Bayesian
Infenrece that we will give you the marginals of your parameters of
interest. Basically, you do not MCMC any more but approximate the
marginal distributions of your parameters of interest, which is faster.
In disease mapping most of the time that is what you want (i.e.,
posterior estimates of your relative risks).

The code is very well written and I am sure that it will handle large
data sets better than WinBUGS and you will get similar results. There is
a full course on this here:

http://www.bias-project.org.uk/GMRFCourse/

There is an R interface (R-INLA) that works pretty well.  The
installation is a bit tricky in Linux, but if you are using Windows I
believe that it is also possible to have it installed. 

Another option is to parallelize the Gibss sampler. I did some work on
this some time ago using package snow, but I found that, for very large
problems, it is not very reliable. For some reason, the connection
between the nodes was lost, although it could also be related to my
(lack of) configuration of the cluster.

Hope this helps.

Virgilio

PS: Fitting a spatial model on the NC Sids Data with R-INLA is something
like

library(spdep)
library(INLA)

source("nb2inla.R")

#Read and display map
xx <- readShapePoly(system.file("shapes/sids.shp",
package="maptools")[1],
      IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
nbsids<-poly2nb(xx)

xx$region<-0:99
xx$region.struct<-0:99
xx$Exp<-xx$BIR74*sum(xx$SID74)/sum(xx$BIR74)
xx$SMR<-xx$SID74/xx$Exp

nb2inla(file="ncsids.graph", nbsids)


formula  <-
SID74~f(region.struct,model="besag",graph.file="ncsids.graph",
param=c(1,0.00005),initial=2.8)+f(NWBIR74,model="rw2",param=c(1,0.05))+
f(region,model="iid")

mod  <-  inla(formula,family="poisson",data=xx,E=Exp,
   control.inla=list(h=0.01),verbose=TRUE,
   inla.call="/home/virgil/usr/bin/inla")

xx$RR<-mod$summary.fitted.values[,1]
spplot(xx, c("SMR", "RR"))


From els.verfaillie at ugent.be  Thu Mar 12 12:21:00 2009
From: els.verfaillie at ugent.be (Els Verfaillie)
Date: Thu, 12 Mar 2009 12:21:00 +0100
Subject: [R-sig-Geo] plotting directional variograms
Message-ID: <007b01c9a304$9f7e9700$de7bc500$@verfaillie@ugent.be>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090312/9040af23/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Mar 12 12:28:58 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 12 Mar 2009 12:28:58 +0100
Subject: [R-sig-Geo] plotting directional variograms
In-Reply-To: <007b01c9a304$9f7e9700$de7bc500$@verfaillie@ugent.be>
References: <007b01c9a304$9f7e9700$de7bc500$@verfaillie@ugent.be>
Message-ID: <49B8F1FA.2090705@uni-muenster.de>

Dear Els,

please look at the default value for tol.hor in ?variogram and specify
it in your second call.
--
Edzer

Els Verfaillie wrote:
> Dear list,
>
>  
>
> When plotting directional variograms, I wonder why in the first plot I see a
> different sample variogram for the 45 direction than in the second plot
> (where I only want to plot the 45? variogram). Do I have to define for the
> second plot an angular tolerance that is default for the first plot? 
>
>  
>
> dir.lz <- variogram(log(zinc)~1, data=meuse, alpha=c(0,45,90,135),
> cutoff=1800, width=200)
>
> plot(dir.lz)
>
>  
>
> dir45.lz <- variogram(log(zinc)~1, data=meuse, alpha=c(45), cutoff=1800,
> width=200)
>
> plot(dir45.lz)
>
>  
>
> Thank you for any suggestion.
>
>  
>
>  
>
> ______________________________________________
>
> Dr. Els Verfaillie
>
> Carto-GIS cluster
>
> Ghent University (UGent) - Department of Geography
>
> Krijgslaan 281 - S8  B- 9000 Gent  Belgium
>
> ______________________________________________
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
>   
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From roland.kaiser at sbg.ac.at  Thu Mar 12 12:36:54 2009
From: roland.kaiser at sbg.ac.at (Roland Kaiser)
Date: Thu, 12 Mar 2009 12:36:54 +0100
Subject: [R-sig-Geo] "clustered" Random distribution of statial points
In-Reply-To: <2E9C414912813E4EB981326983E0A104062E0763@inboexch.inbo.be>
References: <12590.41508.qm@web24203.mail.ird.yahoo.com>
	<2E9C414912813E4EB981326983E0A104062E0763@inboexch.inbo.be>
Message-ID: <0BDD5035-0B35-491A-A8ED-6D984B974B64@sbg.ac.at>

You may also want to try the Thomas process

ow <- map('state','illinois', plot=FALSE, fill=TRUE)
ow.sppgs <- map2SpatialPolygons(ow, IDs=ow$names,
	proj4string=CRS("+proj=longlat"))
ow <- as(ow.sppgs, "owin")
x <- rThomas(2, 0.1, 10, win = ow)
sp.pts <- as(x, "SpatialPoints")
plot(ow.sppgs)
points(sp.pts)

Roland

> Dear Quentin,
>
> Have a look at the spatstat package. The Strauss process or hard- 
> core process is what you are looking for.
>
> HTH,
>
> Thierry
>
>
> ---------------------------------------------------------------------- 
> ------
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for  
> Nature and Forest
> Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,  
> methodology and quality assurance
> Gaverstraat 4
> 9500 Geraardsbergen
> Belgium
> tel. + 32 54/436 185
> Thierry.Onkelinx at inbo.be
> www.inbo.be
>
> To call in the statistician after the experiment is done may be no  
> more than asking him to perform a post-mortem examination: he may  
> be able to say what the experiment died of.
> ~ Sir Ronald Aylmer Fisher
>
> The plural of anecdote is not data.
> ~ Roger Brinner
>
> The combination of some data and an aching desire for an answer  
> does not ensure that a reasonable answer can be extracted from a  
> given body of data.
> ~ John Tukey
>
> -----Oorspronkelijk bericht-----
> Van: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo- 
> bounces at stat.math.ethz.ch] Namens Quentin LEMOULAND
> Verzonden: woensdag 11 maart 2009 16:57
> Aan: r-sig-geo at stat.math.ethz.ch
> Onderwerp: [R-sig-Geo] "clustered" Random distribution of statial  
> points
>
> Hello,
>
> I am trying to make a "clustered" Random distribution of statial  
> points.
> I want to make p "random" distribution of n points.
> But I don't want a typical random distribution. I want a clustered  
> one (with minimal distances bettween my points fixed as my observed  
> distribution: c(3.9,3.3,1.4,1.4,0.7,0.7)).
> I have seen that the spsample function from package sp could "in  
> theory" make this...
> But impossible to understand how to make it work:
>
>> spsample(var,10,"clustered")
> Erreur dans `[<-.data.frame`(`*tmp*`, , j, value = c 
> (-33.8558590595841, -24.8671595071446,  :
>   replacement has 14 rows, data has 12
>
> Does anyone know the solution, there is no example in the help page  
> of spsample.
>
> Thanks by advance,
>
> Quentin
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
>
> Dit bericht en eventuele bijlagen geven enkel de visie van de  
> schrijver weer
> en binden het INBO onder geen enkel beding, zolang dit bericht niet  
> bevestigd is
> door een geldig ondertekend document. The views expressed in  this  
> message
> and any annex are purely those of the writer and may not be  
> regarded as stating
> an official position of INBO, as long as the message is not  
> confirmed by a duly
> signed document.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Thu Mar 12 14:53:25 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Mar 2009 14:53:25 +0100 (CET)
Subject: [R-sig-Geo] large shapefiles; zip code data
In-Reply-To: <ca69cc1d0903120051h5756c3fcyf2be3e25e2be30b8@mail.gmail.com>
References: <ca69cc1d0903120051h5756c3fcyf2be3e25e2be30b8@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903121446090.9387@reclus.nhh.no>

On Thu, 12 Mar 2009, Ben Fissel wrote:

> Hello,
>
> I am attempting to fit a model CAR count data model of the Besag-York-Mollie
> form to US zip code data (entire US minus Hawaii and Alaska).  However, I'm
> running out of memory reading in the zip code data.  The zip code data I
> obtained form the census at
> http://www2.census.gov/geo/tiger/TIGER2008/tl_2008_us_zcta500.zip and are
> shapefiles.  I've allocated 4GB of memory to R which is the max my OS will
> give it (Vista).  Despite this when I attempt to load the shapefiles in I
> run out of memory using readOGR or readShapePoly .  I had a similar problem
> in Stata and worked around it by reading in the shapefiles for the lower 48
> states http://www.census.gov/geo/www/cob/z52000.html separately and
> concatenating them together, relabeling the ID in the process.  I'm trying
> to do the same thing in R but relabeling the ID is not as straight forward
> for me given my novice R programming ability.  Luckily I found a little help
> at
> http://help.nceas.ucsb.edu/R:_Spatial#Understanding_spatial_data_formats_in_Rwhich
> I adapted to my code.

Ben,

In addition to the answers you've already had, you could look at the 
spRbind() and spChFIDs() methods in maptools. spChFIDs() lets you 
manipulate the IDs (to make them unique, for example), and spRbind() 
sticks them together. I've used the combination for assembling US census 
tracts (68'), so a larger task than you face. I have then run poly2nb() in 
spdep on the output, which completed, although needing a lot of time.

There is an example of this in detail on the ASDAR book website, 
http://www.asdar-book.org, see the code examples for Chapter 5, but there 
just assembling data for counties in three US states.

Hope this helps,

Roger

>
> spatdata <- readOGR(".", "zt01_d00")
> #spatdata <- readShapePoly("zt01_d00")
> names(spatdata)[3] <- "ZT00_D00"
> names(spatdata)[4] <- "ZT00_D00_I"
>
> for (j in 2:2){    # Just loop over one file until I get it to work
>   filename <- paste("zt", statelist[j], "_d00",sep ="")  #statlist  is a
> vector of the form statelist <- c("01","04",...,"56") with number that
> correspond the 48 state shapefiles
>
>   spatdf <- readOGR(".", filename)
> # spatdf <- readShapePoly(filename)
>   names(spatdf)[3] <- "ZT00_D00"
>   names(spatdf)[4] <- "ZT00_D00_I"
>   mergedata <- rbind(spatdata at data,spatdf at data)
>   mergepolys <- c(spatdata at polygons,spatdf at polygons)
>   mergepolysp <-
> SpatialPolygons(mergepolys,proj4string=CRS(proj4string(spatdf)))
>   rm("spatdata","spatdf","filename")
>
>   for (i in 1: length(mergepolys)){
>     sNew = as.character(i)
>     mergepolys[i]@ID = sNew
>   }
>   ID <- c(as.character(1:length(mergepolys)))
>   mergedataID <- cbind(ID,mergedata)
>   spatdata <- SpatialPolygonsDataFrame(mergepolysp,data =
> mergedataID,match.ID = FALSE)
>   rm("mergepolys","mergedata","mergepolysp","mergedataID","ID")
>
>   gc()
> }
>
> However in the for loop over "i" I get an error when trying to relabel the
> ID: "Error in validObject(.Object) :  invalid class "SpatialPolygons"
> object: non-unique Polygons ID slot values" .  I've tried a number of
> different ways to change the ID in 'mergepolys' but haven't been successful
> yet.
>
> Ultimately, I just want to get the shapefiles into R so I can identify
> contiguous zip codes for the spatial regression.  Whether I get this by
> loading in one big shape zip code file or concatenating 48 state files is
> irrelevant to me.  Perhaps the census shapefiles have superfluous data that
> I can get rid of to free up memory and still achieve my objective, I don't
> know enough about shapefiles and how R reads them to know what I can throw
> away.  Maybe I'm going about this all wrong.  Thank you for any help and or
> suggestions that you can provide.
>
> After getting the shapefiles in I plan to identify contiguous zip codes and
> use R2Winbugs to fit the model as outlined in "Applied Spatial Data Analysis
> with R".  However, given the memory issues I'm having I am concerned that
> forming the spatial weighting matrix won't be possible, will R try to store
> this as an nxn matrix?  Furthermore, I have about 50+ other covariates that
> I need to merge in with the zip code data that is going to take up memory as
> well.  Simply put, is the memory bottleneck just in the function(s) loading
> the shapefiles or am I going to have trouble fitting this model with the
> covariates in R?
>
> I've seen the thread "mapping by zip codes"
> https://stat.ethz.ch/pipermail/r-sig-geo/2009-March/005194.html , which
> provides very useful information but hasn't helped me get around the
> problems I'm having.
>
> I've tried to be complete yet concise.  If there is any other information
> you need please let me know.
>
> Thanks for any help and or suggestions you can provide.
>
> -Ben
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gpodesta at rsmas.miami.edu  Thu Mar 12 15:58:22 2009
From: gpodesta at rsmas.miami.edu (Guillermo Podesta)
Date: Thu, 12 Mar 2009 10:58:22 -0400
Subject: [R-sig-Geo] Dividing a polygon into several smaller polygons of
	different sizes
Message-ID: <000601c9a323$08305d60$18911820$@miami.edu>

Dear list,

We are working on an agent-based simulation of agricultural production
in the Pampas of Argentina. Very briefly, we want to ask the list for
tips about how to divide a polygon (e.g., a county, or administrative
division) into several smaller polygons of different sizes. Each of
the smaller polygons would represent the geographic boundaries of one
simulated farm (or ?pseudo-farm?).

A more detailed explanation of the problem


We are modifying the space (or environment) of our agent-based model
from a regular grid to a GIS space. In the current regular grid, each
point in the grid represents a simulated farm. In the GIS space, a
farm will be represented by a polygon describing its geographic
boundaries. 

We have a shape file describing the contour of a county (or
administrative division); this county is the area to model. However,
we do NOT have actual cadastre information with the boundaries of all
farms inside the county. What we do have is information from the
Argentine Agricultural Census containing: (a) the number of farms (N)
inside the county (this is the _approximate_ number of farms we want
to simulate) and (b) a frequency distribution of farm sizes in the
county (e.g., 45 farms with areas from 50 to 99 hectares, 30 farms
between 100 and 150 hectares, and so on
).

Also, we can create a vector of N simulated sizes by using the size
frequency information in the Census and sampling inside each size
interval (e.g., if the Census says there are 3 farms between 500 and
1000 hectares, we can simulate their sizes as 536, 777 and 900
hectares).

Using the information above, we would like to create approx. N
simulated farms (or ?pseudo-farms?) inside the county of interest,
including their boundaries. I guess another way of framing the
question is to say we want to ?fit? N polygons of different sizes
inside a larger polygon (that represents the county where farms are
located). A couple of details that may help: (a) N does not have to be
exactly the number in the census (i.e., plus or minus 2-3% does not
matter), (b) we do not have to fill the entire county with farms
(empty areas can represent cities, forests, etc), although the
"non-farm" area cannot be huge.

Is there any way of doing this using the R spatial libraries?
Suggestions or pointers are most welcome and we thank in advance all
readers of the list


Regards!

----------------------------------------------------------------------
-------------------------------
Guillermo P. Podest?
University of Miami Rosenstiel School of Marine & Atmospheric Science
4600 Rickenbacker Causeway Miami FL 33149-1098, USA
E-mail: gpodesta at rsmas.miami.edu
Voice:  +1.305.421.4142   Fax: +1.305.421.4622
http://www.rsmas.miami.edu/divs/mpo/people/Faculty/Podesta/index.htm


From lhq0837 at yahoo.com  Thu Mar 12 18:29:33 2009
From: lhq0837 at yahoo.com (Huang Juying)
Date: Thu, 12 Mar 2009 10:29:33 -0700 (PDT)
Subject: [R-sig-Geo] error "not a numeric vector" when use function "localG"
Message-ID: <181021.70804.qm@web80203.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090312/f05a18af/attachment.pl>

From marcelino.delacruz at upm.es  Thu Mar 12 19:16:42 2009
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Thu, 12 Mar 2009 19:16:42 +0100
Subject: [R-sig-Geo] error "not a numeric vector" when use function
 "localG"
In-Reply-To: <181021.70804.qm@web80203.mail.mud.yahoo.com>
References: <181021.70804.qm@web80203.mail.mud.yahoo.com>
Message-ID: <200903121816.n2CIGXYv027051@edison.ccupm.upm.es>

Dear Cristina,

It sounds like a problem with the decimal 
separator in your raw data. If it is a comma, 
that can explain your problem. When reading the data in R indicate sep=","

HTH

Marcelino


At 18:29 12/03/2009, Huang Juying wrote:
>Content-Type: text/plain
>Content-Disposition: inline
>Content-length: 828
>
>Dear list members,
>
>I am a new R user and spdep user. I tried to use 
>function "localG" to calculate Getis Gi. My 
>targeted variable is log(SalePrice) for over 
>1000 houses. The listw is the number of neighbors within 3000m.
>
> > SalePrice.Gi <- localG(SalePrice, nb3000m.W, zero.policy=TRUE)
>
>Then I got this error:  SalePrice is not a numeric vector
>
>I don't understand why. All SalePrice data is 
>numeric, with 6 decimal precision. I tried to 
>import SalePrice from .dat or .txt or .csv file, 
>but got the same error. I tried to play with the 
>header and column/row argument, still no use.
>
>I am really frustrated. I guess there is a 
>simple solution, but I just cannot find it!!! 
>Please help me! Thank you in advance!
>
>Christina
>USC Geography department
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

________________________________

Marcelino de la Cruz Rot

Departamento de  Biolog?a Vegetal
E.U.T.I. Agr?cola
Universidad Polit?cnica de Madrid
28040-Madrid
Tel.: 91 336 54 35
Fax: 91 336 56 56
marcelino.delacruz at upm.es


From tsippel at gmail.com  Thu Mar 12 20:55:03 2009
From: tsippel at gmail.com (Tim Sippel)
Date: Fri, 13 Mar 2009 08:55:03 +1300
Subject: [R-sig-Geo] downloading MODIS data, individual pixels
Message-ID: <79a13c220903121255q3266697fhb969c464f9c6743d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090313/4b50d446/attachment.pl>

From bfissel at ucsd.edu  Thu Mar 12 21:13:35 2009
From: bfissel at ucsd.edu (Ben Fissel)
Date: Thu, 12 Mar 2009 13:13:35 -0700
Subject: [R-sig-Geo] large shapefiles; zip code data
In-Reply-To: <1236854782.7218.32.camel@Virgilio-Gomez>
References: <ca69cc1d0903120051h5756c3fcyf2be3e25e2be30b8@mail.gmail.com>
	<1236851433.7218.21.camel@Virgilio-Gomez>
	<ca69cc1d0903120338o372870ebv571601c1e295869c@mail.gmail.com>
	<1236854782.7218.32.camel@Virgilio-Gomez>
Message-ID: <ca69cc1d0903121313w2860d66anb20a01d535c7670d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090312/8083064b/attachment.pl>

From Roger.Bivand at nhh.no  Thu Mar 12 22:16:01 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Mar 2009 22:16:01 +0100 (CET)
Subject: [R-sig-Geo] error "not a numeric vector" when use function
 "localG"
In-Reply-To: <181021.70804.qm@web80203.mail.mud.yahoo.com>
References: <181021.70804.qm@web80203.mail.mud.yahoo.com>
Message-ID: <alpine.LRH.2.00.0903122210380.10482@reclus.nhh.no>

On Thu, 12 Mar 2009, Huang Juying wrote:

> Dear list members,
>
> I am a new R user and spdep user. I tried to use function "localG" to 
> calculate Getis Gi. My targeted variable is log(SalePrice) for over 1000 
> houses. The listw is the number of neighbors within 3000m.
>
>> SalePrice.Gi <- localG(SalePrice, nb3000m.W, zero.policy=TRUE)
>
> Then I got this error:? SalePrice is not a numeric vector

When you don't know how the object of interest actually got represented in 
the workspace, try str(), here str(SalePrice). It may be that this is a 
factor (because the decimal sign wasn't what you thought, as Marcelino 
already suggested). It may also be that you did SalePrice <- read.csv(), 
in which case it is a data frame, with column(s). If so, look for its 
names(), and use the one you need, such as SalePrice$var1. The str() 
digest method is very powerful for browsing objects, and has extra 
arguments when the output is too voluminous.

Roger

>
> I don't understand why. All SalePrice data is numeric, with 6 decimal 
> precision. I tried to import SalePrice from .dat or .txt or .csv file, 
> but got the same error. I tried to play with the header and column/row 
> argument, still no use.
>
> I am really frustrated. I guess there is a simple solution, but I just 
> cannot find it!!! Please help me! Thank you in advance!
>
> Christina
> USC Geography department
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From torleif.lunde at cih.uib.no  Thu Mar 12 22:57:49 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 12 Mar 2009 22:57:49 +0100
Subject: [R-sig-Geo] error "not a numeric vector" when use function
	"localG"
In-Reply-To: <alpine.LRH.2.00.0903122210380.10482@reclus.nhh.no>
References: <181021.70804.qm@web80203.mail.mud.yahoo.com>
	<alpine.LRH.2.00.0903122210380.10482@reclus.nhh.no>
Message-ID: <200903122257.49402.torleif.lunde@cih.uib.no>

And if none of these helps remember to specify the NA (not available) values 
in your data 

read.table("data.txt", na.strings="yournavalues", as.is=TRUE)

If your NA values in the original data was for example "NN" R would think the 
column was all made of factors and thereby convert it. By using the as.is 
argument R will not try to anything smart, and you would than afterwords have 
to specify all columns as factors, numeric etc.

However, if you have given your NA values this should not be a problem. Try to 
make a txt file from the data below, and run the following code to get a 
better grip on what is happening when reading with read.table. Note the dot 
in row 5, column x6

date group x1 x2 x3 x4 x5 x6
02/20/1902 0 7 2.53 168.19 77.79 97.16 17.56
05/01/1920 0 5 2.87 175.25 57.83 157.14 18.73
05/22/1919 0 3 2.79 180.49 84.18 122.12 18.88
07/05/1902 0 7 2.38 165.98 58.74 96.51 9.35
12/03/1902 0 5 2.36 172.72 95.48 147 .
01/10/1914 0 6 2.69 180.33 89.13 131.49 16.88
03/13/1916 0 10 2.8 179.07 68.94 117.72 16.84
03/02/1915 0 10 3.27 170.17 78.69 159.61 26.41

ex1 <- read.table("asisex.txt", head=T, sep=" ", as.is=TRUE)
ex2 <- read.table("asisex.txt", head=T, sep=" ")
ex3<- read.table("asisex.txt", head=T, sep=" ", na.strings=".")
str(ex1)
str(ex2)
str(ex3)

Best wishes
Torleif

On Thursday 12 March 2009 10:16:01 pm Roger Bivand wrote:
> On Thu, 12 Mar 2009, Huang Juying wrote:
> > Dear list members,
> >
> > I am a new R user and spdep user. I tried to use function "localG" to
> > calculate Getis Gi. My targeted variable is log(SalePrice) for over 1000
> > houses. The listw is the number of neighbors within 3000m.
> >
> >> SalePrice.Gi <- localG(SalePrice, nb3000m.W, zero.policy=TRUE)
> >
> > Then I got this error:? SalePrice is not a numeric vector
>
> When you don't know how the object of interest actually got represented in 
> the workspace, try str(), here str(SalePrice). It may be that this is a
> factor (because the decimal sign wasn't what you thought, as Marcelino
> already suggested). It may also be that you did SalePrice <- read.csv(),
> in which case it is a data frame, with column(s). If so, look for its
> names(), and use the one you need, such as SalePrice$var1. The str()
> digest method is very powerful for browsing objects, and has extra
> arguments when the output is too voluminous.
>
> Roger
>
> > I don't understand why. All SalePrice data is numeric, with 6 decimal
> > precision. I tried to import SalePrice from .dat or .txt or .csv file,
> > but got the same error. I tried to play with the header and column/row
> > argument, still no use.
> >
> > I am really frustrated. I guess there is a simple solution, but I just
> > cannot find it!!! Please help me! Thank you in advance!
> >
> > Christina
> > USC Geography department
> >
> >
> >
> >
> >
> > 	[[alternative HTML version deleted]]


From gianni.lavaredo at gmail.com  Fri Mar 13 02:58:21 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 13 Mar 2009 02:58:21 +0100
Subject: [R-sig-Geo] Help to count in apply(...)
Message-ID: <518dff330903121858t619b7306s8f0e19559a241fde@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090313/ee1a04b4/attachment.pl>

From r.hijmans at gmail.com  Fri Mar 13 04:45:20 2009
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 13 Mar 2009 11:45:20 +0800
Subject: [R-sig-Geo] Help to count in apply(...)
In-Reply-To: <518dff330903121858t619b7306s8f0e19559a241fde@mail.gmail.com>
References: <518dff330903121858t619b7306s8f0e19559a241fde@mail.gmail.com>
Message-ID: <dc22b2570903122045k6f7c4a91sf6cb160a58097176@mail.gmail.com>

Dear Gianni,

I think you want this:

tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm=TRUE)

E.g.:

ID <- rep(1:10, each=10)
K <- runif(100)
areaFe <- as.data.frame(cbind(ID, K))
fer.conc.max <- 0.5
tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm=TRUE)


Robert


On Fri, Mar 13, 2009 at 9:58 AM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> dear User
>
> I'm quite new to R and trying to learn the basic and sorry for the email. I
> don't wish abuse of mail-list. I had read manual and Help online about
> tapply (...). I have a data frame and I need "count" the Fe value with sum
> for every ID sample area
>
> fer.conc.max <- tapply(areaFe$K, areaFe$ID, max, na.rm=TRUE)
>
> I need to count the Fe area with Fe$K <= ?fer.conc.max
>
> # give me the summatory and not the count
> fer.conc.max <- tapply(areaFe$K, areaFe$ID, sum, na.rm=TRUE)
>
> I tried sever combination that I found in mail-list archive but alway I have
> a error message
>
> thanks Gianni
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From brown_emu at yahoo.com  Fri Mar 13 08:42:02 2009
From: brown_emu at yahoo.com (Stephen Tucker)
Date: Fri, 13 Mar 2009 00:42:02 -0700 (PDT)
Subject: [R-sig-Geo] how to avoid manual trimming of polygons from map() ?
Message-ID: <648503.75275.qm@web39708.mail.mud.yahoo.com>


Hello all,

I was trying to plot a stereographic projection (centered around Bering Strait)  using map() but am having to manually trim the polygons:

## choose limits
xlim <- c(110,290); ylim <- c(40,90)

## plot - doesn't look right
map("world2",projection="stereographic",xlim=xlim,ylim=ylim)

## extract polygons and trim manually
mp <- map("world2",xlim=xlim,ylim=ylim,plot=FALSE)
w <- which(mp$x < min(xlim) | mp$x > max(xlim))
mp$x <- mp$x[-w]; mp$y <- mp$y[-w]

## replot
map(mp,projection="stereographic",xlim=xlim,ylim=ylim,border=0)
map.grid(c(xlim,ylim),xpd=TRUE,col=8,lab=FALSE)

###

This also leaves significant whitespace around the actual coastlines (in the plotting region, as observed when box() is invoked after drawing the map)... I wonder if there is a way to trim points and fill the plotting region?

Thanks much!

Stephen


From gianni.lavaredo at gmail.com  Fri Mar 13 10:02:20 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 13 Mar 2009 10:02:20 +0100
Subject: [R-sig-Geo] Help to count in apply(...)
In-Reply-To: <dc22b2570903122045k6f7c4a91sf6cb160a58097176@mail.gmail.com>
References: <518dff330903121858t619b7306s8f0e19559a241fde@mail.gmail.com>
	<dc22b2570903122045k6f7c4a91sf6cb160a58097176@mail.gmail.com>
Message-ID: <518dff330903130202l2f1f9d2fj3cdea2f777c49044@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090313/91f98556/attachment.pl>

From r.hijmans at gmail.com  Fri Mar 13 10:16:53 2009
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 13 Mar 2009 17:16:53 +0800
Subject: [R-sig-Geo] Help to count in apply(...)
In-Reply-To: <518dff330903130202l2f1f9d2fj3cdea2f777c49044@mail.gmail.com>
References: <518dff330903121858t619b7306s8f0e19559a241fde@mail.gmail.com>
	<dc22b2570903122045k6f7c4a91sf6cb160a58097176@mail.gmail.com>
	<518dff330903130202l2f1f9d2fj3cdea2f777c49044@mail.gmail.com>
Message-ID: <dc22b2570903130216i414fd98di2baf2e1862dbc8f2@mail.gmail.com>

I see, I did not understand that. This is a quick fix, please check if
it is OK. Using which.max might be more elegant.

ID <- rep(1:10, each=10)
K <- runif(100)
areaFe <- as.data.frame(cbind(ID, K))
fer.conc.max <- tapply(areaFe$K, areaFe$ID, max, na.rm=TRUE)
fermax <- rep (fer.conc.max, each=10)
tapply(areaFe$K > 0.9 * fermax, areaFe$ID, sum, na.rm=TRUE)

Robert

On Fri, Mar 13, 2009 at 5:02 PM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> Thanks Robert
>
> the problem (on your example) this I need
>
> ID <- rep(1:10, each=10)
> K <- runif(100)
> areaFe <- as.data.frame(cbind(ID, K))
> #find the max value in each ID area
>> fer.conc.max <- tapply(areaFe$K, areaFe$ID, max, na.rm=TRUE)
>> fer.conc.max
> ??????? 1???????? 2???????? 3???????? 4???????? 5???????? 6
> 7???????? 8
> 0.9339687 0.9413441 0.9605550 0.9968569 0.9647085 0.9563837 0.9731356
> 0.9278238
> ??????? 9??????? 10
> 0.9496833 0.9111127
> #count the?value?below or equal the fe.comc.max
>> tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm=TRUE)
> Error tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm = TRUE) :
> ? dims [product 10] do not match the length of object [100]
>
>
>
> 2009/3/13 Robert Hijmans <r.hijmans at gmail.com>
>>
>> Dear Gianni,
>>
>> I think you want this:
>>
>> tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm=TRUE)
>>
>> E.g.:
>>
>> ID <- rep(1:10, each=10)
>> K <- runif(100)
>> areaFe <- as.data.frame(cbind(ID, K))
>> fer.conc.max <- 0.5
>> tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm=TRUE)
>>
>>
>> Robert
>>
>>
>> On Fri, Mar 13, 2009 at 9:58 AM, gianni lavaredo
>> <gianni.lavaredo at gmail.com> wrote:
>> > dear User
>> >
>> > I'm quite new to R and trying to learn the basic and sorry for the
>> > email. I
>> > don't wish abuse of mail-list. I had read manual and Help online about
>> > tapply (...). I have a data frame and I need "count" the Fe value with
>> > sum
>> > for every ID sample area
>> >
>> > fer.conc.max <- tapply(areaFe$K, areaFe$ID, max, na.rm=TRUE)
>> >
>> > I need to count the Fe area with Fe$K <= ?fer.conc.max
>> >
>> > # give me the summatory and not the count
>> > fer.conc.max <- tapply(areaFe$K, areaFe$ID, sum, na.rm=TRUE)
>> >
>> > I tried sever combination that I found in mail-list archive but alway I
>> > have
>> > a error message
>> >
>> > thanks Gianni
>> >
>> > ? ? ? ?[[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at stat.math.ethz.ch
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>
>


From gianni.lavaredo at gmail.com  Fri Mar 13 13:29:47 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 13 Mar 2009 13:29:47 +0100
Subject: [R-sig-Geo] Help to count in apply(...)
In-Reply-To: <dc22b2570903130216i414fd98di2baf2e1862dbc8f2@mail.gmail.com>
References: <518dff330903121858t619b7306s8f0e19559a241fde@mail.gmail.com>
	<dc22b2570903122045k6f7c4a91sf6cb160a58097176@mail.gmail.com>
	<518dff330903130202l2f1f9d2fj3cdea2f777c49044@mail.gmail.com>
	<dc22b2570903130216i414fd98di2baf2e1862dbc8f2@mail.gmail.com>
Message-ID: <518dff330903130529s2ced9d3fwc87c0e758b14768b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090313/1857ea04/attachment.pl>

From r.hijmans at gmail.com  Fri Mar 13 13:55:27 2009
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 13 Mar 2009 20:55:27 +0800
Subject: [R-sig-Geo] Help to count in apply(...)
In-Reply-To: <518dff330903130529s2ced9d3fwc87c0e758b14768b@mail.gmail.com>
References: <518dff330903121858t619b7306s8f0e19559a241fde@mail.gmail.com>
	<dc22b2570903122045k6f7c4a91sf6cb160a58097176@mail.gmail.com>
	<518dff330903130202l2f1f9d2fj3cdea2f777c49044@mail.gmail.com>
	<dc22b2570903130216i414fd98di2baf2e1862dbc8f2@mail.gmail.com>
	<518dff330903130529s2ced9d3fwc87c0e758b14768b@mail.gmail.com>
Message-ID: <dc22b2570903130555t46850ca1v23e97beca7fd606a@mail.gmail.com>

I think the solution is using 'merge'

soil.fe <- data.frame(
  ID =c(1,1,1,1,2,2,3,3,4,5,5,5,5,5,9,9,9,9,9,9,10,10),
  K =c(6.25,12.50,25.00,50.00,80.00,12.00,6.25,12.50,25.00,50.00,76.00,67.00,67.00,56.00,98.00,32.00,33.00,43.00,54.00,76.00,85.00,67.00))

 fer.conc.max <- tapply(soil.fe$K, soil.fe$ID, max, na.rm=TRUE)
 fm <- matrix(as.numeric(cbind(names(fer.conc.max), fer.conc.max)), ncol=2)
 colnames(fm) <- c('ID', 'maxFe')
 merge(soil.fe, fm)

 R

On Fri, Mar 13, 2009 at 8:29 PM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> Thanks Robert,
>
> I have a data frame with difefferent length of ID and I change the codes in
> this mode
>
> ID <- rep(1:10, each=10)
> K <- runif(100)
> areaFe <- as.data.frame(cbind(ID, K))
> fer.conc.max <- tapply(areaFe$K, areaFe$ID, max, na.rm=TRUE)
> # I am sure that all my value are under 100
> tapply(areaFe$K?<= 100, areaFe$ID, sum, na.rm=TRUE)
>
> 1? 2? 3? 4? 5? 6? 7? 8? 9 10
> 10 10 10 10 10 10 10 10 10 10
>
> It's not elegant mode, and I ask please if there an elegant mode to write
> below (use "fer.conc.max")
>
>
> soil.fe <- data.frame(
> ??ID =c(1,1,1,1,2,2,3,3,4,5,5,5,5,5,9,9,9,9,9,9,10,10),
> ??K
> =c(6.25,12.50,25.00,50.00,80.00,12.00,6.25,12.50,25.00,50.00,76.00,67.00,67.00,56.00,98.00,32.00,33.00,43.00,54.00,76.00,85.00,67.00))
>
> fer.conc.max <- tapply(soil.fe$K, soil.fe$ID, max, na.rm=TRUE)
> #ee max value
> fer.conc.max
>
> 1??? 2??? 3??? 4??? 5??? 9?? 10
> 50.0 80.0 12.5 25.0 76.0 98.0 85.0
>
> # I am sure that all my value are under 100
> tapply(soil.fe$K <= 100, soil.fe$ID, sum, na.rm=TRUE)
>
> 1? 2? 3? 4? 5? 9 10
> ?4? 2? 2? 1? 5? 6? 2
>
>
> Thanks
>
> 2009/3/13 Robert Hijmans <r.hijmans at gmail.com>
>>
>> I see, I did not understand that. This is a quick fix, please check if
>> it is OK. Using which.max might be more elegant.
>>
>> ID <- rep(1:10, each=10)
>> K <- runif(100)
>> areaFe <- as.data.frame(cbind(ID, K))
>> fer.conc.max <- tapply(areaFe$K, areaFe$ID, max, na.rm=TRUE)
>> fermax <- rep (fer.conc.max, each=10)
>> tapply(areaFe$K > 0.9 * fermax, areaFe$ID, sum, na.rm=TRUE)
>>
>> Robert
>>
>> On Fri, Mar 13, 2009 at 5:02 PM, gianni lavaredo
>> <gianni.lavaredo at gmail.com> wrote:
>> > Thanks Robert
>> >
>> > the problem (on your example) this I need
>> >
>> > ID <- rep(1:10, each=10)
>> > K <- runif(100)
>> > areaFe <- as.data.frame(cbind(ID, K))
>> > #find the max value in each ID area
>> >> fer.conc.max <- tapply(areaFe$K, areaFe$ID, max, na.rm=TRUE)
>> >> fer.conc.max
>> > ??????? 1???????? 2???????? 3???????? 4???????? 5???????? 6
>> > 7???????? 8
>> > 0.9339687 0.9413441 0.9605550 0.9968569 0.9647085 0.9563837 0.9731356
>> > 0.9278238
>> > ??????? 9??????? 10
>> > 0.9496833 0.9111127
>> > #count the?value?below or equal the fe.comc.max
>> >> tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm=TRUE)
>> > Error tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm = TRUE) :
>> > ? dims [product 10] do not match the length of object [100]
>> >
>> >
>> >
>> > 2009/3/13 Robert Hijmans <r.hijmans at gmail.com>
>> >>
>> >> Dear Gianni,
>> >>
>> >> I think you want this:
>> >>
>> >> tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm=TRUE)
>> >>
>> >> E.g.:
>> >>
>> >> ID <- rep(1:10, each=10)
>> >> K <- runif(100)
>> >> areaFe <- as.data.frame(cbind(ID, K))
>> >> fer.conc.max <- 0.5
>> >> tapply(areaFe$K <= fer.conc.max, areaFe$ID, sum, na.rm=TRUE)
>> >>
>> >>
>> >> Robert
>> >>
>> >>
>> >> On Fri, Mar 13, 2009 at 9:58 AM, gianni lavaredo
>> >> <gianni.lavaredo at gmail.com> wrote:
>> >> > dear User
>> >> >
>> >> > I'm quite new to R and trying to learn the basic and sorry for the
>> >> > email. I
>> >> > don't wish abuse of mail-list. I had read manual and Help online
>> >> > about
>> >> > tapply (...). I have a data frame and I need "count" the Fe value
>> >> > with
>> >> > sum
>> >> > for every ID sample area
>> >> >
>> >> > fer.conc.max <- tapply(areaFe$K, areaFe$ID, max, na.rm=TRUE)
>> >> >
>> >> > I need to count the Fe area with Fe$K <= ?fer.conc.max
>> >> >
>> >> > # give me the summatory and not the count
>> >> > fer.conc.max <- tapply(areaFe$K, areaFe$ID, sum, na.rm=TRUE)
>> >> >
>> >> > I tried sever combination that I found in mail-list archive but alway
>> >> > I
>> >> > have
>> >> > a error message
>> >> >
>> >> > thanks Gianni
>> >> >
>> >> > ? ? ? ?[[alternative HTML version deleted]]
>> >> >
>> >> > _______________________________________________
>> >> > R-sig-Geo mailing list
>> >> > R-sig-Geo at stat.math.ethz.ch
>> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >> >
>> >
>> >
>
>


From h.wickham at gmail.com  Fri Mar 13 14:02:58 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 13 Mar 2009 08:02:58 -0500
Subject: [R-sig-Geo] Help to count in apply(...)
In-Reply-To: <dc22b2570903130555t46850ca1v23e97beca7fd606a@mail.gmail.com>
References: <518dff330903121858t619b7306s8f0e19559a241fde@mail.gmail.com>
	<dc22b2570903122045k6f7c4a91sf6cb160a58097176@mail.gmail.com>
	<518dff330903130202l2f1f9d2fj3cdea2f777c49044@mail.gmail.com>
	<dc22b2570903130216i414fd98di2baf2e1862dbc8f2@mail.gmail.com>
	<518dff330903130529s2ced9d3fwc87c0e758b14768b@mail.gmail.com>
	<dc22b2570903130555t46850ca1v23e97beca7fd606a@mail.gmail.com>
Message-ID: <f8e6ff050903130602i2fe020f4j358a099d532bf352@mail.gmail.com>

On Fri, Mar 13, 2009 at 7:55 AM, Robert Hijmans <r.hijmans at gmail.com> wrote:
> I think the solution is using 'merge'
>
> soil.fe <- data.frame(
> ?ID =c(1,1,1,1,2,2,3,3,4,5,5,5,5,5,9,9,9,9,9,9,10,10),
> ?K =c(6.25,12.50,25.00,50.00,80.00,12.00,6.25,12.50,25.00,50.00,76.00,67.00,67.00,56.00,98.00,32.00,33.00,43.00,54.00,76.00,85.00,67.00))
>
> ?fer.conc.max <- tapply(soil.fe$K, soil.fe$ID, max, na.rm=TRUE)
> ?fm <- matrix(as.numeric(cbind(names(fer.conc.max), fer.conc.max)), ncol=2)
> ?colnames(fm) <- c('ID', 'maxFe')
> ?merge(soil.fe, fm)

Another alternative is to use ddply from the plyr package:

ddply(soil.fe, .(ID), transform, maxFe = max(K, na.rm = T))

You can find out more at http://had.co.nz/plyr.

Hadley


-- 
http://had.co.nz/


From Virgilio.Gomez at uclm.es  Fri Mar 13 17:22:00 2009
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Fri, 13 Mar 2009 17:22:00 +0100
Subject: [R-sig-Geo] [Fwd: SAGA gis and geostatistics-request for
 expressions of interest]
Message-ID: <1236961320.7320.3.camel@Virgilio-Gomez>

Dear all,

Although this is not an R question, I believe that this may be of
interest to some people on this list.

Best wishes,

Virgilio


--------- Mensaje reenviado --------
De: Ivens, Rob <Rob.Ivens at MOLEVALLEY.GOV.UK>
Reply-to: "Ivens, Rob" <Rob.Ivens at MOLEVALLEY.GOV.UK>
Para: allstat at JISCMAIL.AC.UK
Asunto: SAGA gis and geostatistics-request for expressions of interest
Fecha: Fri, 13 Mar 2009 15:16:06 -0000

I hope this is an acceptable post.

 

I work for a local authority with duties to inspect contamination on
parcels of land. 

 

*	Usually we collect data sets for individual contaminants of
100-500 values
*	Total data sets are 3000-9000 values.

 

I am interested in trying to use regression and variogramme analysis and
krigging 

to obtain an estimate of upper and lower bounds of a particular
contaminant within spatially clustered subsets of this data.

 

R is to complex for me, SAGA gis looks interesting Sgems and Geosem have
also been recommended not to mention windows version of Gslib.

As an unskilled user, with a complicated but very specific question is
anyone interested in assisting us?

 

I would like to pay for 3 days consultancy to study a data set we are
about to acquire in the next 6 months or so as part of an inspection
under Part IIA of the contaminated land regulations combined with 1 days
training on that particular data set. The most likely distribution of
the data will be some sort of localised hot spots within areas of
relatively clean material

 

I have 2 other historical sites with associated data that show the way
we make decisions.

 

If I can get 3 expressions of interest I can develop a proposal to build
into my funding bid for next year.

 

Cheers.

 

Rob Ivens

Scientific Officer

01306 879232

 




_______________________________________________________________________

Please don't print this e-mail unless you really need to. Save paper.

Visit http://www.molevalley.gov.uk for information about Council services, online payments and planning information.

This email and any files transmitted with it are intended solely for the use of the individual or entity to which they are addressed. If you are not the intended recipient, the E-mail and any files have been transmitted to you in error and any copying, distribution or other use of the information contained in them is strictly prohibited.

The Council computer systems may be monitored and communications carried on them recorded, to secure the effective operation of the system and for other lawful purposes.


From jean.gaudart at univmed.fr  Fri Mar 13 17:54:28 2009
From: jean.gaudart at univmed.fr (jean gaudart)
Date: Fri, 13 Mar 2009 17:54:28 +0100
Subject: [R-sig-Geo] moran.boot
Message-ID: <20090313165306.00A1A469D39@smtp.univmed.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090313/2256bd14/attachment.pl>

From gianni.lavaredo at gmail.com  Sat Mar 14 18:52:08 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Sat, 14 Mar 2009 18:52:08 +0100
Subject: [R-sig-Geo] help to obtain the list of the ID
Message-ID: <518dff330903141052y23f2abbco67a84676e1babf6c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090314/9bf75b99/attachment.pl>

From Torleif.Lunde at cih.uib.no  Sat Mar 14 19:17:35 2009
From: Torleif.Lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Sat, 14 Mar 2009 19:17:35 +0100
Subject: [R-sig-Geo] help to obtain the list of the ID
References: <518dff330903141052y23f2abbco67a84676e1babf6c@mail.gmail.com>
Message-ID: <A3EA804CA6F446429B6AEBB45558456301270E45@HUGIN.uib.no>

Hi
 
try 
unique(mfDF$ID)
 
Best wishes
Torleif

________________________________

Fra: r-sig-geo-bounces at stat.math.ethz.ch p? vegne av gianni lavaredo
Sendt: l? 14.03.2009 18:52
Til: r-sig-geo at stat.math.ethz.ch
Emne: [R-sig-Geo] help to obtain the list of the ID



Thanks in advice for your time,

Sorry for this simple question I am searching a function or a method to
obtain the list of the ID. I tryed sever combination like manual or in R
wiki


mfDF <- data.frame(
  ID =c(1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3),
  value =c(2,12,25,50,100,200,6,12,50,25,50,50,6,8,90,5,8))

like this

>
1 2 3

Thanks and sorry

Gianni

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From p.hiemstra at geo.uu.nl  Sun Mar 15 10:57:48 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sun, 15 Mar 2009 10:57:48 +0100
Subject: [R-sig-Geo] help to obtain the list of the ID
In-Reply-To: <518dff330903141052y23f2abbco67a84676e1babf6c@mail.gmail.com>
References: <518dff330903141052y23f2abbco67a84676e1babf6c@mail.gmail.com>
Message-ID: <49BCD11C.6010500@geo.uu.nl>

gianni lavaredo schreef:
> Thanks in advice for your time,
>
> Sorry for this simple question I am searching a function or a method to
> obtain the list of the ID. I tryed sever combination like manual or in R
> wiki
>
>
> mfDF <- data.frame(
>   ID =c(1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3),
>   value =c(2,12,25,50,100,200,6,12,50,25,50,50,6,8,90,5,8))
>
> like this
>
>   
> 1 2 3
>
> Thanks and sorry
>
> Gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
Hi,

Because ID is a categorical value, it is good to make it a factor (R 
type for categories). Then it is also quite easy to get the levels:

 mfDF <- data.frame(
   ID =as.factor(c(1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3)),
   value =c(2,12,25,50,100,200,6,12,50,25,50,50,6,8,90,5,8))
# Get a list of the possible ID's
levels(mfDF$ID)

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From gianni.lavaredo at gmail.com  Mon Mar 16 16:15:41 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 16 Mar 2009 16:15:41 +0100
Subject: [R-sig-Geo] direct operation with two data.frame in elegant code
Message-ID: <518dff330903160815v10237535t6ebf3f852318f975@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090316/7ef79085/attachment.pl>

From j.burke at earthlink.net  Tue Mar 17 06:43:32 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Tue, 17 Mar 2009 00:43:32 -0500
Subject: [R-sig-Geo] Merging SpatialPolygonsDataFrame and
	SpatialLinesDataFrame
Message-ID: <49BF3883.5090904@earthlink.net>

Hi everyone,

Been scratching my head on this. A common
operation. Google seems to be mute on this,
so I turn to you.

I have a nice SpatialPolygonsDataFrame that I
can plot with wonderful colors using spplot.

I would like to

1. MERGE SpatialLinesDataFrame (PolyLine) over
the SpatialPolygonsDataFrame (Polygons). And
plot with spplot().

2. CLIP the PolyLine to the area of the Polygons.
The polygons are within the larger main_main roads
Polyline

3. COLOR PolyLine main_roads different than
black for example; white or gray.


NOTES. FILE READS ARE BELOW

 >tx3_sp <- readShapePoly("tx3_sp.shp", IDvar="PCT",
proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"),
verbose=TRUE, repair=FALSE)
Shapefile type: Polygon, (5), # of Shapes: 39

 >main_roads <-readShapeLines("main roads.shp",
proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"),
verbose=TRUE,repair=FALSE)
Shapefile type: PolyLine, (3), # of Shapes: 29161

 > class(tx3_sp)
[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"

 > class(main_roads)
[1] "SpatialLinesDataFrame"
attr(,"package")
[1] "sp"

Thanks and I am grateful for all thoughts and assistance,
Jim Burke


From edzer.pebesma at uni-muenster.de  Tue Mar 17 13:58:35 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 17 Mar 2009 13:58:35 +0100
Subject: [R-sig-Geo] Merging SpatialPolygonsDataFrame
	and	SpatialLinesDataFrame
In-Reply-To: <49BF3883.5090904@earthlink.net>
References: <49BF3883.5090904@earthlink.net>
Message-ID: <49BF9E7B.3020103@uni-muenster.de>

Jim Burke schrieb:
> Hi everyone,
>
> Been scratching my head on this. A common
> operation. Google seems to be mute on this,
> so I turn to you.
>
> I have a nice SpatialPolygonsDataFrame that I
> can plot with wonderful colors using spplot.
>
> I would like to
>
> 1. MERGE SpatialLinesDataFrame (PolyLine) over
> the SpatialPolygonsDataFrame (Polygons). And
> plot with spplot().
add the SpatialLinesDataFrame as an object in the sp.layout argument to 
spplot, as in
spplot(x, ..., sp.layout = list("sp.lines", SLDF, col = 'black'))
>
> 2. CLIP the PolyLine to the area of the Polygons.
> The polygons are within the larger main_main roads
> Polyline
Hard to do; I just found out it can be done with aRT, which requires you 
to run TerraLib as the GIS on your computer.
>
> 3. COLOR PolyLine main_roads different than
> black for example; white or gray.
you could select, them, and nest, as in
..., sp.layout = list(list("sp.lines", SLDF1,col='red'), 
list("sp.lines", SLDF2, col='blue'))

Bests,
--
Edzer
>
>
> NOTES. FILE READS ARE BELOW
>
> >tx3_sp <- readShapePoly("tx3_sp.shp", IDvar="PCT",
> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"),
> verbose=TRUE, repair=FALSE)
> Shapefile type: Polygon, (5), # of Shapes: 39
>
> >main_roads <-readShapeLines("main roads.shp",
> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"),
> verbose=TRUE,repair=FALSE)
> Shapefile type: PolyLine, (3), # of Shapes: 29161
>
> > class(tx3_sp)
> [1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
>
> > class(main_roads)
> [1] "SpatialLinesDataFrame"
> attr(,"package")
> [1] "sp"
>
> Thanks and I am grateful for all thoughts and assistance,
> Jim Burke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ksafi at orn.mpg.de  Tue Mar 17 15:29:09 2009
From: ksafi at orn.mpg.de (Kamran Safi)
Date: Tue, 17 Mar 2009 15:29:09 +0100
Subject: [R-sig-Geo] Merging
	SpatialPolygonsDataFrame	and	SpatialLinesDataFrame
In-Reply-To: <49BF9E7B.3020103@uni-muenster.de>
References: <49BF3883.5090904@earthlink.net> <49BF9E7B.3020103@uni-muenster.de>
Message-ID: <49BFB3B5.8080000@orn.mpg.de>

Hi all,

without having given it a lot of thought. Have you looked into PBSmapping?
you can use maptools to convert between sp spatial classes and PBS 
spatial classes.

In PBSmapping you have:

addLines(): Add a PolySet <PolySet.html> to an existing plot, where each 
unique (|PID|, |SID|) describes a polyline.
and
joinPolys(): Join one or two PolySet <PolySet.html>s using a logic 
operation, where |"DIFF"|, |"INT"|, |"UNION"|, or |"XOR"|, representing 
difference, intersection, union, and exclusive-or, respectively.

Sorry for the cryptic answer.

Kami

Edzer Pebesma wrote:
> Jim Burke schrieb:
>> Hi everyone,
>>
>> Been scratching my head on this. A common
>> operation. Google seems to be mute on this,
>> so I turn to you.
>>
>> I have a nice SpatialPolygonsDataFrame that I
>> can plot with wonderful colors using spplot.
>>
>> I would like to
>>
>> 1. MERGE SpatialLinesDataFrame (PolyLine) over
>> the SpatialPolygonsDataFrame (Polygons). And
>> plot with spplot().
> add the SpatialLinesDataFrame as an object in the sp.layout argument 
> to spplot, as in
> spplot(x, ..., sp.layout = list("sp.lines", SLDF, col = 'black'))
>>
>> 2. CLIP the PolyLine to the area of the Polygons.
>> The polygons are within the larger main_main roads
>> Polyline
> Hard to do; I just found out it can be done with aRT, which requires 
> you to run TerraLib as the GIS on your computer.
>>
>> 3. COLOR PolyLine main_roads different than
>> black for example; white or gray.
> you could select, them, and nest, as in
> ..., sp.layout = list(list("sp.lines", SLDF1,col='red'), 
> list("sp.lines", SLDF2, col='blue'))
>
> Bests,
> -- 
> Edzer
>>
>>
>> NOTES. FILE READS ARE BELOW
>>
>> >tx3_sp <- readShapePoly("tx3_sp.shp", IDvar="PCT",
>> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"),
>> verbose=TRUE, repair=FALSE)
>> Shapefile type: Polygon, (5), # of Shapes: 39
>>
>> >main_roads <-readShapeLines("main roads.shp",
>> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"),
>> verbose=TRUE,repair=FALSE)
>> Shapefile type: PolyLine, (3), # of Shapes: 29161
>>
>> > class(tx3_sp)
>> [1] "SpatialPolygonsDataFrame"
>> attr(,"package")
>> [1] "sp"
>>
>> > class(main_roads)
>> [1] "SpatialLinesDataFrame"
>> attr(,"package")
>> [1] "sp"
>>
>> Thanks and I am grateful for all thoughts and assistance,
>> Jim Burke
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3275 bytes
Desc: S/MIME Cryptographic Signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090317/fb9386d4/attachment.bin>

From p.hiemstra at geo.uu.nl  Tue Mar 17 15:30:53 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 17 Mar 2009 15:30:53 +0100
Subject: [R-sig-Geo] Merging SpatialPolygonsDataFrame
	and	SpatialLinesDataFrame
In-Reply-To: <49BF3883.5090904@earthlink.net>
References: <49BF3883.5090904@earthlink.net>
Message-ID: <49BFB41D.6010805@geo.uu.nl>

Hi,

You might also want to look into the links between Grass and R and SAGA 
and R. This link enables you to use the GIS functionality of these 
programs from R, I'm fairly certain that this includes the functionality 
your requested.

cheers,
Paul

Jim Burke wrote:
> Hi everyone,
>
> Been scratching my head on this. A common
> operation. Google seems to be mute on this,
> so I turn to you.
>
> I have a nice SpatialPolygonsDataFrame that I
> can plot with wonderful colors using spplot.
>
> I would like to
>
> 1. MERGE SpatialLinesDataFrame (PolyLine) over
> the SpatialPolygonsDataFrame (Polygons). And
> plot with spplot().
>
> 2. CLIP the PolyLine to the area of the Polygons.
> The polygons are within the larger main_main roads
> Polyline
>
> 3. COLOR PolyLine main_roads different than
> black for example; white or gray.
>
>
> NOTES. FILE READS ARE BELOW
>
> >tx3_sp <- readShapePoly("tx3_sp.shp", IDvar="PCT",
> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"),
> verbose=TRUE, repair=FALSE)
> Shapefile type: Polygon, (5), # of Shapes: 39
>
> >main_roads <-readShapeLines("main roads.shp",
> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"),
> verbose=TRUE,repair=FALSE)
> Shapefile type: PolyLine, (3), # of Shapes: 29161
>
> > class(tx3_sp)
> [1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
>
> > class(main_roads)
> [1] "SpatialLinesDataFrame"
> attr(,"package")
> [1] "sp"
>
> Thanks and I am grateful for all thoughts and assistance,
> Jim Burke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From wroberts at csir.co.za  Wed Mar 18 16:01:49 2009
From: wroberts at csir.co.za (Wesley Roberts)
Date: Wed, 18 Mar 2009 17:01:49 +0200
Subject: [R-sig-Geo] Error in if (dxsd > tolerance) { : missing value
	where	TRUE/FALSE needed
Message-ID: <49C128FE0200007300019DE8@pta-emo.csir.co.za>

Dear R-sig-Geo'ers

I am currently trying to extract some NDVI values from a group of NDVI images for specific shapefile polygons. I have 17 individual polygons and 23 NDVI images. I have written the script below to select individual polygons and to then extract the average NDVI within each polygon and store this in a list. Once all 23 images have been processed the script moves to the next polygon and so on and so on, until all polygons have been average for all 23 images. The code essentially extracts the NDVI data as a time series for each polygon.

Unfortunately, as everyone knows, Landsat 7 ETM has a broken scan line corrector meaning that all post 2003 data have large areas of missing data. In my pre-processing I convert these areas to nan using gdal_merge.py (I have to stich and subset two scenes). The code below works well until a large portion of a polygon lies on the nan area of the image (some polygons that only have a small area in the nan process fine). When this happens I get the following error message

Error in if (dxsd > tolerance) { : missing value where TRUE/FALSE needed

The error is related to the following command 

x.clip <- temp[!is.na(overlay(temp, brede_add)),]

I have no idea how to solve this error, as a backup plan I am using r.fillnulls in grass to get rid of the stripes but this takes a very long time and is not ideal.

Any additional help or pointers would be greatly appreciated

Many thanks and kind regards

****************************************************************************************************************************************************************************************************************************************************

library(maptools)
library(rgdal)
library(spatstat)

input <- "/media/win-drive/wes2006/Projects/Evapotranspiration/Data/Landsat_NDVI"
maps <- data.frame((list.files(input, pattern=".img",full.names=FALSE)),(list.files(input, pattern=".img", full.names=TRUE)))
names(maps) <- c("File", "Path")
fn=data.frame(maps$File)

rastx<-284055.000
rasty<-6302475.000

Lst <- list()

brede <- readShapePoly("BredeCatchmentSites.shp", IDvar="COUNT", proj4string=CRS("+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs"))

x=0
while (x <= 17)
{
	x<-x+1
		nfiles <- length(maps$Path) 
		for (n in 1:nfiles)
		{  
		   brede_add <- brede[brede$COUNT[x], ]
		   box <- as.list(as.numeric(bbox(brede_add)))
		   xstart <- (as.numeric(box[1])-rastx)/30
		   ystart <- abs((as.numeric(box[4])-rasty)/30)
		   
		   row <- round((as.numeric(box[3])-as.numeric(box[1]))/30)
		   col <- round((as.numeric(box[4])-as.numeric(box[2]))/30)
		   
		   temp <- readGDAL(as.character(maps$Path[n]),silent=TRUE, offset=c(ystart,xstart), region.dim=c(col,row))
		   fullgrid(temp)=FALSE
		   	   
		   x.clip <- temp[!is.na(overlay(temp, brede_add)),]   <<<<<<<<<<<-------------HERE IS THE PROBLEM-------------
		   
		   a <- mean(as.data.frame(x.clip$band1))
		   
		   Lst[n] <- list(as.numeric(a))
		   print(n)
		   x.clip<-0
		 } 
		 
	data <- as.numeric(Lst)
	data2 <- cbind(data,fn)
   	write.table(data, paste(brede$NBALID[x]))
	print(paste(brede$NBALID[x]))
}



Wesley Roberts MSc.
Researcher: Earth Observation (Ecosystems)
Natural Resources and the Environment
CSIR
Tel: +27 (21) 888-2490
Fax: +27 (21) 888-2693

"To know the road ahead, ask those coming back."
- Chinese proverb


-- 
This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard. 
The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.


and is believed to be clean.  MailScanner thanks Transtec Computers for their support.


From david.wahlund at gmail.com  Wed Mar 18 18:06:28 2009
From: david.wahlund at gmail.com (David Wahlund)
Date: Wed, 18 Mar 2009 18:06:28 +0100
Subject: [R-sig-Geo] Error in if (dxsd > tolerance) { : missing value
	where TRUE/FALSE needed
In-Reply-To: <49C128FE0200007300019DE8@pta-emo.csir.co.za>
References: <49C128FE0200007300019DE8@pta-emo.csir.co.za>
Message-ID: <616581940903181006i162f8866ld77f78fc944f32d2@mail.gmail.com>

Hi
I got the same error trying to do something similar. For me the
problem was with the polygon data. One of the shapes was corrupted. My
tip is to try and identify what polygon renders the error and confirm
that it is OK.

-David Wahlund

On Wed, Mar 18, 2009 at 16:01, Wesley Roberts <wroberts at csir.co.za> wrote:
> Dear R-sig-Geo'ers
>
> I am currently trying to extract some NDVI values from a group of NDVI images for specific shapefile polygons. I have 17 individual polygons and 23 NDVI images. I have written the script below to select individual polygons and to then extract the average NDVI within each polygon and store this in a list. Once all 23 images have been processed the script moves to the next polygon and so on and so on, until all polygons have been average for all 23 images. The code essentially extracts the NDVI data as a time series for each polygon.
>
> Unfortunately, as everyone knows, Landsat 7 ETM has a broken scan line corrector meaning that all post 2003 data have large areas of missing data. In my pre-processing I convert these areas to nan using gdal_merge.py (I have to stich and subset two scenes). The code below works well until a large portion of a polygon lies on the nan area of the image (some polygons that only have a small area in the nan process fine). When this happens I get the following error message
>
> Error in if (dxsd > tolerance) { : missing value where TRUE/FALSE needed
>
> The error is related to the following command
>
> x.clip <- temp[!is.na(overlay(temp, brede_add)),]
>
> I have no idea how to solve this error, as a backup plan I am using r.fillnulls in grass to get rid of the stripes but this takes a very long time and is not ideal.
>
> Any additional help or pointers would be greatly appreciated
>
> Many thanks and kind regards
>
> ****************************************************************************************************************************************************************************************************************************************************
>
> library(maptools)
> library(rgdal)
> library(spatstat)
>
> input <- "/media/win-drive/wes2006/Projects/Evapotranspiration/Data/Landsat_NDVI"
> maps <- data.frame((list.files(input, pattern=".img",full.names=FALSE)),(list.files(input, pattern=".img", full.names=TRUE)))
> names(maps) <- c("File", "Path")
> fn=data.frame(maps$File)
>
> rastx<-284055.000
> rasty<-6302475.000
>
> Lst <- list()
>
> brede <- readShapePoly("BredeCatchmentSites.shp", IDvar="COUNT", proj4string=CRS("+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs"))
>
> x=0
> while (x <= 17)
> {
> ? ? ? ?x<-x+1
> ? ? ? ? ? ? ? ?nfiles <- length(maps$Path)
> ? ? ? ? ? ? ? ?for (n in 1:nfiles)
> ? ? ? ? ? ? ? ?{
> ? ? ? ? ? ? ? ? ? brede_add <- brede[brede$COUNT[x], ]
> ? ? ? ? ? ? ? ? ? box <- as.list(as.numeric(bbox(brede_add)))
> ? ? ? ? ? ? ? ? ? xstart <- (as.numeric(box[1])-rastx)/30
> ? ? ? ? ? ? ? ? ? ystart <- abs((as.numeric(box[4])-rasty)/30)
>
> ? ? ? ? ? ? ? ? ? row <- round((as.numeric(box[3])-as.numeric(box[1]))/30)
> ? ? ? ? ? ? ? ? ? col <- round((as.numeric(box[4])-as.numeric(box[2]))/30)
>
> ? ? ? ? ? ? ? ? ? temp <- readGDAL(as.character(maps$Path[n]),silent=TRUE, offset=c(ystart,xstart), region.dim=c(col,row))
> ? ? ? ? ? ? ? ? ? fullgrid(temp)=FALSE
>
> ? ? ? ? ? ? ? ? ? x.clip <- temp[!is.na(overlay(temp, brede_add)),] ? <<<<<<<<<<<-------------HERE IS THE PROBLEM-------------
>
> ? ? ? ? ? ? ? ? ? a <- mean(as.data.frame(x.clip$band1))
>
> ? ? ? ? ? ? ? ? ? Lst[n] <- list(as.numeric(a))
> ? ? ? ? ? ? ? ? ? print(n)
> ? ? ? ? ? ? ? ? ? x.clip<-0
> ? ? ? ? ? ? ? ? }
>
> ? ? ? ?data <- as.numeric(Lst)
> ? ? ? ?data2 <- cbind(data,fn)
> ? ? ? ?write.table(data, paste(brede$NBALID[x]))
> ? ? ? ?print(paste(brede$NBALID[x]))
> }
>
>
>
> Wesley Roberts MSc.
> Researcher: Earth Observation (Ecosystems)
> Natural Resources and the Environment
> CSIR
> Tel: +27 (21) 888-2490
> Fax: +27 (21) 888-2693
>
> "To know the road ahead, ask those coming back."
> - Chinese proverb
>
>
> --
> This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard.
> The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.
>
>
> and is believed to be clean. ?MailScanner thanks Transtec Computers for their support.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Wed Mar 18 19:55:03 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 18 Mar 2009 19:55:03 +0100 (CET)
Subject: [R-sig-Geo] Error in if (dxsd > tolerance) { : missing value
 where TRUE/FALSE needed
In-Reply-To: <616581940903181006i162f8866ld77f78fc944f32d2@mail.gmail.com>
References: <49C128FE0200007300019DE8@pta-emo.csir.co.za>
	<616581940903181006i162f8866ld77f78fc944f32d2@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903181948440.11574@reclus.nhh.no>

On Wed, 18 Mar 2009, David Wahlund wrote:

> Hi
> I got the same error trying to do something similar. For me the
> problem was with the polygon data. One of the shapes was corrupted. My
> tip is to try and identify what polygon renders the error and confirm
> that it is OK.

Yes, the underlying problem is that the "[" method for a SpatialGrid is 
trying to re-assemble an object from the remaining data, and the heuristic 
being used to "guess" the step of the grid when many rows and columns are 
missing is failing. If you manage to find out which it is, you might 
consider sending me a copy of the objects (save()), so that I can have a 
look at the heuristic. In general, you can drill down to the failing 
function by using traceback() afterwards - here it is points2grid() that 
has failed.

Roger

>
> -David Wahlund
>
> On Wed, Mar 18, 2009 at 16:01, Wesley Roberts <wroberts at csir.co.za> wrote:
>> Dear R-sig-Geo'ers
>>
>> I am currently trying to extract some NDVI values from a group of NDVI images for specific shapefile polygons. I have 17 individual polygons and 23 NDVI images. I have written the script below to select individual polygons and to then extract the average NDVI within each polygon and store this in a list. Once all 23 images have been processed the script moves to the next polygon and so on and so on, until all polygons have been average for all 23 images. The code essentially extracts the NDVI data as a time series for each polygon.
>>
>> Unfortunately, as everyone knows, Landsat 7 ETM has a broken scan line corrector meaning that all post 2003 data have large areas of missing data. In my pre-processing I convert these areas to nan using gdal_merge.py (I have to stich and subset two scenes). The code below works well until a large portion of a polygon lies on the nan area of the image (some polygons that only have a small area in the nan process fine). When this happens I get the following error message
>>
>> Error in if (dxsd > tolerance) { : missing value where TRUE/FALSE needed
>>
>> The error is related to the following command
>>
>> x.clip <- temp[!is.na(overlay(temp, brede_add)),]
>>
>> I have no idea how to solve this error, as a backup plan I am using r.fillnulls in grass to get rid of the stripes but this takes a very long time and is not ideal.
>>
>> Any additional help or pointers would be greatly appreciated
>>
>> Many thanks and kind regards
>>
>> ****************************************************************************************************************************************************************************************************************************************************
>>
>> library(maptools)
>> library(rgdal)
>> library(spatstat)
>>
>> input <- "/media/win-drive/wes2006/Projects/Evapotranspiration/Data/Landsat_NDVI"
>> maps <- data.frame((list.files(input, pattern=".img",full.names=FALSE)),(list.files(input, pattern=".img", full.names=TRUE)))
>> names(maps) <- c("File", "Path")
>> fn=data.frame(maps$File)
>>
>> rastx<-284055.000
>> rasty<-6302475.000
>>
>> Lst <- list()
>>
>> brede <- readShapePoly("BredeCatchmentSites.shp", IDvar="COUNT", proj4string=CRS("+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs"))
>>
>> x=0
>> while (x <= 17)
>> {
>> ? ? ? ?x<-x+1
>> ? ? ? ? ? ? ? ?nfiles <- length(maps$Path)
>> ? ? ? ? ? ? ? ?for (n in 1:nfiles)
>> ? ? ? ? ? ? ? ?{
>> ? ? ? ? ? ? ? ? ? brede_add <- brede[brede$COUNT[x], ]
>> ? ? ? ? ? ? ? ? ? box <- as.list(as.numeric(bbox(brede_add)))
>> ? ? ? ? ? ? ? ? ? xstart <- (as.numeric(box[1])-rastx)/30
>> ? ? ? ? ? ? ? ? ? ystart <- abs((as.numeric(box[4])-rasty)/30)
>>
>> ? ? ? ? ? ? ? ? ? row <- round((as.numeric(box[3])-as.numeric(box[1]))/30)
>> ? ? ? ? ? ? ? ? ? col <- round((as.numeric(box[4])-as.numeric(box[2]))/30)
>>
>> ? ? ? ? ? ? ? ? ? temp <- readGDAL(as.character(maps$Path[n]),silent=TRUE, offset=c(ystart,xstart), region.dim=c(col,row))
>> ? ? ? ? ? ? ? ? ? fullgrid(temp)=FALSE
>>
>> ? ? ? ? ? ? ? ? ? x.clip <- temp[!is.na(overlay(temp, brede_add)),] ? <<<<<<<<<<<-------------HERE IS THE PROBLEM-------------
>>
>> ? ? ? ? ? ? ? ? ? a <- mean(as.data.frame(x.clip$band1))
>>
>> ? ? ? ? ? ? ? ? ? Lst[n] <- list(as.numeric(a))
>> ? ? ? ? ? ? ? ? ? print(n)
>> ? ? ? ? ? ? ? ? ? x.clip<-0
>> ? ? ? ? ? ? ? ? }
>>
>> ? ? ? ?data <- as.numeric(Lst)
>> ? ? ? ?data2 <- cbind(data,fn)
>> ? ? ? ?write.table(data, paste(brede$NBALID[x]))
>> ? ? ? ?print(paste(brede$NBALID[x]))
>> }
>>
>>
>>
>> Wesley Roberts MSc.
>> Researcher: Earth Observation (Ecosystems)
>> Natural Resources and the Environment
>> CSIR
>> Tel: +27 (21) 888-2490
>> Fax: +27 (21) 888-2693
>>
>> "To know the road ahead, ask those coming back."
>> - Chinese proverb
>>
>>
>> --
>> This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard.
>> The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.
>>
>>
>> and is believed to be clean. ?MailScanner thanks Transtec Computers for their support.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From jmdoyle at mail.med.upenn.edu  Wed Mar 18 20:37:53 2009
From: jmdoyle at mail.med.upenn.edu (Jamie Mihoko Doyle)
Date: Wed, 18 Mar 2009 15:37:53 -0400
Subject: [R-sig-Geo] Error in Moran eigenvector GLM filtering ("base
 correlation higher than alpha")
Message-ID: <49C14D91.1060502@mail.med.upenn.edu>

Hi everyone,

I could really use your help. I'm doing a study of homicide mortality 
among Foreign Born and US Born Hispanics in the U.S. and using Moran 
eigenvector filtering for the Poisson models. The data are from US 
counties having populations greater than 100,000 people since data from 
smaller counties is not publicly available.

I seem to get the following error when I'm running the model for Foreign 
Born Hispanics only: "base correlation higher than alpha".

Is there a more appropriate method I should use?

Please find my code below. The data that I am using can be found here: 
http://www.jamiemihoko.com/Rquestions.htm

I would greatly appreciate any help.

Thank you in advance for your time,

Jamie

######
##Data
######
# Read in flat data
d <- read.csv("D:/Vital Statistics Mortality/R Version of 
Dataset/homic_mortality_v14_R.csv",header=TRUE)

#Read in shape file
homic<-readOGR("D:/Vital Statistics Mortality/ArcGIS Shapefiles", 
layer="mortality_data2_edited_Disso3")

# Store Coordinates
coords<-coordinates(homic)

##################################
# Create Nearest Neighbor Weights
##################################
homic.nn.cont<- poly2nb(homic)
homic.nn.cont.W<-nb2listw(homic.nn.cont, zero.policy=TRUE)       # Need 
to use "zero.polcy=TRUE" because some areas do not have neighbors

##############################################
# Need to round numbers (5-year average of homicide deaths)
##############################################
d_HispFore.r <- round(homic$d_HispFore)

###################
# Spatial filter 
###################
          sf.HF <- ME(d_HispF5.r  ~ mindistCA2 + median_age + pct_single 
+ pct_male2 +  pct_ling_i +  pct_povert +  pop_densit,
                                     data = homic, family = 'poisson', 
listw = homic.nn.cont.W, alpha = 0.2, verbose = TRUE)

# Data Dictionary- All county-level:
   # d_HispF5.r :     Foreign Born Hispanic Deaths
   # mindistCA2:     Minimum distance from county, population-weighted 
centroids to the U.S.-Mexico border
   # median_age:     Median age of county residents
   # pct_male2:       % male residents
   # pct_ling_i:        % linguistically isolated
   # pct_povert:      % poverty
   # pop_densit:      Population density

-- 
Jamie Mihoko Doyle, PhD
Department of Biostatistics and Epidemiology
University of Pennsylvania School of Medicine
423 Guardian Drive
934 Blockley Hall
Philadelphia, PA 19104
http://www.jamiemihoko.com


From Roger.Bivand at nhh.no  Wed Mar 18 20:53:57 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 18 Mar 2009 20:53:57 +0100 (CET)
Subject: [R-sig-Geo] Error in Moran eigenvector GLM filtering ("base
 correlation higher than alpha")
In-Reply-To: <49C14D91.1060502@mail.med.upenn.edu>
References: <49C14D91.1060502@mail.med.upenn.edu>
Message-ID: <alpine.LRH.2.00.0903182049260.11574@reclus.nhh.no>

On Wed, 18 Mar 2009, Jamie Mihoko Doyle wrote:

> Hi everyone,
>
> I could really use your help. I'm doing a study of homicide mortality among 
> Foreign Born and US Born Hispanics in the U.S. and using Moran eigenvector 
> filtering for the Poisson models. The data are from US counties having 
> populations greater than 100,000 people since data from smaller counties is 
> not publicly available.
>
> I seem to get the following error when I'm running the model for Foreign Born 
> Hispanics only: "base correlation higher than alpha".

You see this message when the observed autocorrelation is so weak that no 
eigenvectors are chosen for inclusion for the value of alpha given (here 
0.2). You could increase alpha, or, better, just fit a regular glm(), 
because autocorrelation does not seem to be a problem in this case. I say 
"does not seem to be", because you would need to examine the residuals of 
the glm() fit carefully. You may also be running into negative 
autocorrelation (ME() assumes positive), but I haven't looked at your data 
(yet).

Hope this helps,

Roger

>
> Is there a more appropriate method I should use?
>
> Please find my code below. The data that I am using can be found here: 
> http://www.jamiemihoko.com/Rquestions.htm
>
> I would greatly appreciate any help.
>
> Thank you in advance for your time,
>
> Jamie
>
> ######
> ##Data
> ######
> # Read in flat data
> d <- read.csv("D:/Vital Statistics Mortality/R Version of 
> Dataset/homic_mortality_v14_R.csv",header=TRUE)
>
> #Read in shape file
> homic<-readOGR("D:/Vital Statistics Mortality/ArcGIS Shapefiles", 
> layer="mortality_data2_edited_Disso3")
>
> # Store Coordinates
> coords<-coordinates(homic)
>
> ##################################
> # Create Nearest Neighbor Weights
> ##################################
> homic.nn.cont<- poly2nb(homic)
> homic.nn.cont.W<-nb2listw(homic.nn.cont, zero.policy=TRUE)       # Need to 
> use "zero.polcy=TRUE" because some areas do not have neighbors
>
> ##############################################
> # Need to round numbers (5-year average of homicide deaths)
> ##############################################
> d_HispFore.r <- round(homic$d_HispFore)
>
> ###################
> # Spatial filter ###################
>         sf.HF <- ME(d_HispF5.r  ~ mindistCA2 + median_age + pct_single + 
> pct_male2 +  pct_ling_i +  pct_povert +  pop_densit,
>                                    data = homic, family = 'poisson', listw = 
> homic.nn.cont.W, alpha = 0.2, verbose = TRUE)
>
> # Data Dictionary- All county-level:
>  # d_HispF5.r :     Foreign Born Hispanic Deaths
>  # mindistCA2:     Minimum distance from county, population-weighted 
> centroids to the U.S.-Mexico border
>  # median_age:     Median age of county residents
>  # pct_male2:       % male residents
>  # pct_ling_i:        % linguistically isolated
>  # pct_povert:      % poverty
>  # pop_densit:      Population density
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Wed Mar 18 20:56:00 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 18 Mar 2009 20:56:00 +0100
Subject: [R-sig-Geo] Error in if (dxsd > tolerance) { : missing value
 where TRUE/FALSE needed
In-Reply-To: <alpine.LRH.2.00.0903181948440.11574@reclus.nhh.no>
References: <49C128FE0200007300019DE8@pta-emo.csir.co.za>	<616581940903181006i162f8866ld77f78fc944f32d2@mail.gmail.com>
	<alpine.LRH.2.00.0903181948440.11574@reclus.nhh.no>
Message-ID: <49C151D0.8070203@uni-muenster.de>

A quick solution could be to convert it into a SpatialPointsDataFrame 
object (gridded(x) = FALSE), before doing the selection that broke your 
script. If it still breaks, you might check whether the selection is empty.
--
Edzer


Roger Bivand schrieb:
> On Wed, 18 Mar 2009, David Wahlund wrote:
>
>> Hi
>> I got the same error trying to do something similar. For me the
>> problem was with the polygon data. One of the shapes was corrupted. My
>> tip is to try and identify what polygon renders the error and confirm
>> that it is OK.
>
> Yes, the underlying problem is that the "[" method for a SpatialGrid 
> is trying to re-assemble an object from the remaining data, and the 
> heuristic being used to "guess" the step of the grid when many rows 
> and columns are missing is failing. If you manage to find out which it 
> is, you might consider sending me a copy of the objects (save()), so 
> that I can have a look at the heuristic. In general, you can drill 
> down to the failing function by using traceback() afterwards - here it 
> is points2grid() that has failed.
>
> Roger
>
>>
>> -David Wahlund
>>
>> On Wed, Mar 18, 2009 at 16:01, Wesley Roberts <wroberts at csir.co.za> 
>> wrote:
>>> Dear R-sig-Geo'ers
>>>
>>> I am currently trying to extract some NDVI values from a group of 
>>> NDVI images for specific shapefile polygons. I have 17 individual 
>>> polygons and 23 NDVI images. I have written the script below to 
>>> select individual polygons and to then extract the average NDVI 
>>> within each polygon and store this in a list. Once all 23 images 
>>> have been processed the script moves to the next polygon and so on 
>>> and so on, until all polygons have been average for all 23 images. 
>>> The code essentially extracts the NDVI data as a time series for 
>>> each polygon.
>>>
>>> Unfortunately, as everyone knows, Landsat 7 ETM has a broken scan 
>>> line corrector meaning that all post 2003 data have large areas of 
>>> missing data. In my pre-processing I convert these areas to nan 
>>> using gdal_merge.py (I have to stich and subset two scenes). The 
>>> code below works well until a large portion of a polygon lies on the 
>>> nan area of the image (some polygons that only have a small area in 
>>> the nan process fine). When this happens I get the following error 
>>> message
>>>
>>> Error in if (dxsd > tolerance) { : missing value where TRUE/FALSE 
>>> needed
>>>
>>> The error is related to the following command
>>>
>>> x.clip <- temp[!is.na(overlay(temp, brede_add)),]
>>>
>>> I have no idea how to solve this error, as a backup plan I am using 
>>> r.fillnulls in grass to get rid of the stripes but this takes a very 
>>> long time and is not ideal.
>>>
>>> Any additional help or pointers would be greatly appreciated
>>>
>>> Many thanks and kind regards
>>>
>>> **************************************************************************************************************************************************************************************************************************************************** 
>>>
>>>
>>> library(maptools)
>>> library(rgdal)
>>> library(spatstat)
>>>
>>> input <- 
>>> "/media/win-drive/wes2006/Projects/Evapotranspiration/Data/Landsat_NDVI" 
>>>
>>> maps <- data.frame((list.files(input, 
>>> pattern=".img",full.names=FALSE)),(list.files(input, pattern=".img", 
>>> full.names=TRUE)))
>>> names(maps) <- c("File", "Path")
>>> fn=data.frame(maps$File)
>>>
>>> rastx<-284055.000
>>> rasty<-6302475.000
>>>
>>> Lst <- list()
>>>
>>> brede <- readShapePoly("BredeCatchmentSites.shp", IDvar="COUNT", 
>>> proj4string=CRS("+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 
>>> +units=m +no_defs"))
>>>
>>> x=0
>>> while (x <= 17)
>>> {
>>>        x<-x+1
>>>                nfiles <- length(maps$Path)
>>>                for (n in 1:nfiles)
>>>                {
>>>                   brede_add <- brede[brede$COUNT[x], ]
>>>                   box <- as.list(as.numeric(bbox(brede_add)))
>>>                   xstart <- (as.numeric(box[1])-rastx)/30
>>>                   ystart <- abs((as.numeric(box[4])-rasty)/30)
>>>
>>>                   row <- 
>>> round((as.numeric(box[3])-as.numeric(box[1]))/30)
>>>                   col <- 
>>> round((as.numeric(box[4])-as.numeric(box[2]))/30)
>>>
>>>                   temp <- 
>>> readGDAL(as.character(maps$Path[n]),silent=TRUE, 
>>> offset=c(ystart,xstart), region.dim=c(col,row))
>>>                   fullgrid(temp)=FALSE
>>>
>>>                   x.clip <- temp[!is.na(overlay(temp, brede_add)),] 
>>>   <<<<<<<<<<<-------------HERE IS THE PROBLEM-------------
>>>
>>>                   a <- mean(as.data.frame(x.clip$band1))
>>>
>>>                   Lst[n] <- list(as.numeric(a))
>>>                   print(n)
>>>                   x.clip<-0
>>>                 }
>>>
>>>        data <- as.numeric(Lst)
>>>        data2 <- cbind(data,fn)
>>>        write.table(data, paste(brede$NBALID[x]))
>>>        print(paste(brede$NBALID[x]))
>>> }
>>>
>>>
>>>
>>> Wesley Roberts MSc.
>>> Researcher: Earth Observation (Ecosystems)
>>> Natural Resources and the Environment
>>> CSIR
>>> Tel: +27 (21) 888-2490
>>> Fax: +27 (21) 888-2693
>>>
>>> "To know the road ahead, ask those coming back."
>>> - Chinese proverb
>>>
>>>
>>> -- 
>>> This message is subject to the CSIR's copyright terms and 
>>> conditions, e-mail legal notice, and implemented Open Document 
>>> Format (ODF) standard.
>>> The full disclaimer details can be found at 
>>> http://www.csir.co.za/disclaimer.html.
>>>
>>>
>>> and is believed to be clean.  MailScanner thanks Transtec Computers 
>>> for their support.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From j.burke at earthlink.net  Thu Mar 19 07:07:33 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Thu, 19 Mar 2009 01:07:33 -0500
Subject: [R-sig-Geo] Error in multiple && !outer : invalid 'x' type in 'x &&
	y'
Message-ID: <49C1E125.7030201@earthlink.net>

Thanks in advance everyone. I need assistance
resolving the above error. Trying to spplot join
or merge two "SpatialPolygonsDataFrame"s

Each set of polys will plot adjacent to each other.
They do not overlap.

census_block_sp <- readShapePoly("HD_108_blocks_sp.shp", 
IDvar="BLKIDFP", proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
tx3_sp <- readShapePoly("HD_108_whole_sp.shp", IDvar="PCT", 
proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))


spplot(tx3_sp, c("D_TOT"),
    colorkey=list(height=1.0, width=0.6),
    main = list(label="HD-108 - Barack Obama \n Votes by Precinct 
11/04/08",cex=1),
    sub =  list(label="by Jim Burke, j.burke at earthlink.net",cex=.3),
    line=0,
    sp.layout = list("sp.text",coordinates(tx3_sp),
                    as.character(tx3_sp$PCT,cex = .02),
                    as.table = TRUE),
                list("sp.text", coordinates(census_block_sp),
                    as.character(census_block_sp$NAME, cex = .02),
                    col='blue')     
)

Error in multiple && !outer : invalid 'x' type in 'x && y'

Thanks,
Jim Burke


From j.burke at earthlink.net  Thu Mar 19 07:16:54 2009
From: j.burke at earthlink.net (Jim Burke)
Date: Thu, 19 Mar 2009 01:16:54 -0500
Subject: [R-sig-Geo] Error in multiple && !outer : invalid 'x' type in
 'x &&	y'
In-Reply-To: <49C1E125.7030201@earthlink.net>
References: <49C1E125.7030201@earthlink.net>
Message-ID: <49C1E356.8020500@earthlink.net>

A partial answer. plot() these separately shows
they plot at vastly different dimensions in order
to fill the plot frame.

I will try a merge in R and see what happens.

Thanks,
Jim

Jim Burke wrote:
> Thanks in advance everyone. I need assistance
> resolving the above error. Trying to spplot join
> or merge two "SpatialPolygonsDataFrame"s
>
> Each set of polys will plot adjacent to each other.
> They do not overlap.
>
> census_block_sp <- readShapePoly("HD_108_blocks_sp.shp", 
> IDvar="BLKIDFP", proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
> tx3_sp <- readShapePoly("HD_108_whole_sp.shp", IDvar="PCT", 
> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
>
>
> spplot(tx3_sp, c("D_TOT"),
>    colorkey=list(height=1.0, width=0.6),
>    main = list(label="HD-108 - Barack Obama \n Votes by Precinct 
> 11/04/08",cex=1),
>    sub =  list(label="by Jim Burke, j.burke at earthlink.net",cex=.3),
>    line=0,
>    sp.layout = list("sp.text",coordinates(tx3_sp),
>                    as.character(tx3_sp$PCT,cex = .02),
>                    as.table = TRUE),
>                list("sp.text", coordinates(census_block_sp),
>                    as.character(census_block_sp$NAME, cex = .02),
>                    col='blue')     )
>
> Error in multiple && !outer : invalid 'x' type in 'x && y'
>
> Thanks,
> Jim Burke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From Roger.Bivand at nhh.no  Thu Mar 19 08:09:04 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Mar 2009 08:09:04 +0100 (CET)
Subject: [R-sig-Geo] Error in multiple && !outer : invalid 'x' type in
 'x &&	y'
In-Reply-To: <49C1E356.8020500@earthlink.net>
References: <49C1E125.7030201@earthlink.net> <49C1E356.8020500@earthlink.net>
Message-ID: <alpine.LRH.2.00.0903190758160.14087@reclus.nhh.no>

On Thu, 19 Mar 2009, Jim Burke wrote:

> A partial answer. plot() these separately shows
> they plot at vastly different dimensions in order
> to fill the plot frame.
>
> I will try a merge in R and see what happens.

Please *do* run traceback() after error messages like these - it takes a 
very long time to try to guess where the error might have occurred. If 
traceback() is too hard, please make a minimal data set reproducing the 
problem available on a website, with a script to provoke the error. Here, 
bbox() of the objects would show the differences in extent.

Essentially, what you are saying is that plotting the non-overlapping 
names of census_block_sp on their label points messes up spplot of tx3_sp, 
right? The spplot() command works without the second component in the 
sp.layout= list? Have you tried assigning the colours in a regular plot() 
command manually, then using text() directly? If you can figure out what 
is going on in base graphics, the lattice graphics case will be resolvable 
too (usually).

Please avoid using the term "merge" - it has no meaning in this context. R 
spatial for vector data is not a GIS for doing topology, really. "Seeing 
what happens" with large and complex objects does look like a recipe for 
trouble, please simplify first as much as possible, and very often you 
will resolve the problem yourself (simplification does work like that, it 
helps you bring your needs closer to what the software is offering by 
removing irrelevant detail).

Hope this helps,

Roger

>
> Thanks,
> Jim
>
> Jim Burke wrote:
>> Thanks in advance everyone. I need assistance
>> resolving the above error. Trying to spplot join
>> or merge two "SpatialPolygonsDataFrame"s
>> 
>> Each set of polys will plot adjacent to each other.
>> They do not overlap.
>> 
>> census_block_sp <- readShapePoly("HD_108_blocks_sp.shp", IDvar="BLKIDFP", 
>> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
>> tx3_sp <- readShapePoly("HD_108_whole_sp.shp", IDvar="PCT", 
>> proj4string=CRS("+proj=aea +ellps=GRS80 +datum=WGS84"))
>> 
>> 
>> spplot(tx3_sp, c("D_TOT"),
>>    colorkey=list(height=1.0, width=0.6),
>>    main = list(label="HD-108 - Barack Obama \n Votes by Precinct 
>> 11/04/08",cex=1),
>>    sub =  list(label="by Jim Burke, j.burke at earthlink.net",cex=.3),
>>    line=0,
>>    sp.layout = list("sp.text",coordinates(tx3_sp),
>>                    as.character(tx3_sp$PCT,cex = .02),
>>                    as.table = TRUE),
>>                list("sp.text", coordinates(census_block_sp),
>>                    as.character(census_block_sp$NAME, cex = .02),
>>                    col='blue')     )
>> 
>> Error in multiple && !outer : invalid 'x' type in 'x && y'
>> 
>> Thanks,
>> Jim Burke
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Thu Mar 19 13:08:15 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 19 Mar 2009 13:08:15 +0100
Subject: [R-sig-Geo] Merging data frame for SpPolDF
Message-ID: <49C235AF.6070303@gmail.com>

Hi!

I often have to add more information to the data slot of
a SpPolDF imported from a shp file. I do it in this way, don't like
it too much and would like feed-back on a better way-

#Import shp
MMAMBmuni <- readOGR("C:/Pruebas/DUNS/MMAMBmuni", layer="MMAMBmuni")
#Extract the DF
MMAMBmuniDFori <- MMAMBmuni at data

#Make a new dataframe by merging with another DF
MMAMBmuniDFnew <-
merge(MMAMBmuniDFori,MMAMBempleados,by.x="MUNICIPI",by.y="CODMUN",all.x=T,sort=F)

The problem here is that there are a couple of towns in the by.x field
for which we do not any in by.y
As we have set all.x=T, we get a line for which the values from the
second dataframe are NA. But, despite stating sort=F, those cases are
not in the same row as they are in the first data.frame but appended at
the end of the new dataframe. This is bad news for us, as breaks
the order required for including the new dataframe as the data slot
of a new SpPolDF. Therefore, I have to reorder the new dataframe, thanks
to another field, IDgrafic:

MMAMBmuniDFnew<- MMAMBmuniDFnew[order(MMAMBmuniDFnew$ID_GRAFIC),]

and then copy the original row.names, required because the row.names are
the ones
making the link to the polygons in the future SpPolDF:

row.names(MMAMBmuniDFnew) <- row.names(MMAMBmuniDFori)

#Now we put the new DF in lieu of the older one:
MMAMBmuni2 at data <- MMAMBmuniDFnew

#and finally save as shp
writeOGR(MMAMBmuni2,dsn="C:/Pruebas/DUNS/MMAMBmuni2",layer="MMAMBmuni2",
driver="ESRI Shapefile")

Any suggestions on a better procedure? The problem is that sometimes I
forget reordering and get a wrong shp. Until now, I have always realized
the error, but I'm terrified by the idea of not realizing the error
sometime and using true garbage after that point...

Thanks

Agus


From wroberts at csir.co.za  Thu Mar 19 14:27:53 2009
From: wroberts at csir.co.za (Wesley Roberts)
Date: Thu, 19 Mar 2009 15:27:53 +0200
Subject: [R-sig-Geo] Error in if (dxsd > tolerance) { :
	missing	valuewhere TRUE/FALSE needed
Message-ID: <49C2647A0200007300019EB8@pta-emo.csir.co.za>

Many thanks Edzer,

gridded is now working a charm on my data.

Regards,
Wesley

>>> Edzer Pebesma <edzer.pebesma at uni-muenster.de> 03/18/09 9:58 PM >>>
A quick solution could be to convert it into a SpatialPointsDataFrame 
object (gridded(x) = FALSE), before doing the selection that broke your 
script. If it still breaks, you might check whether the selection is empty.
--
Edzer


Roger Bivand schrieb:
> On Wed, 18 Mar 2009, David Wahlund wrote:
>
>> Hi
>> I got the same error trying to do something similar. For me the
>> problem was with the polygon data. One of the shapes was corrupted. My
>> tip is to try and identify what polygon renders the error and confirm
>> that it is OK.
>
> Yes, the underlying problem is that the "[" method for a SpatialGrid 
> is trying to re-assemble an object from the remaining data, and the 
> heuristic being used to "guess" the step of the grid when many rows 
> and columns are missing is failing. If you manage to find out which it 
> is, you might consider sending me a copy of the objects (save()), so 
> that I can have a look at the heuristic. In general, you can drill 
> down to the failing function by using traceback() afterwards - here it 
> is points2grid() that has failed.
>
> Roger
>
>>
>> -David Wahlund
>>
>> On Wed, Mar 18, 2009 at 16:01, Wesley Roberts <wroberts at csir.co.za> 
>> wrote:
>>> Dear R-sig-Geo'ers
>>>
>>> I am currently trying to extract some NDVI values from a group of 
>>> NDVI images for specific shapefile polygons. I have 17 individual 
>>> polygons and 23 NDVI images. I have written the script below to 
>>> select individual polygons and to then extract the average NDVI 
>>> within each polygon and store this in a list. Once all 23 images 
>>> have been processed the script moves to the next polygon and so on 
>>> and so on, until all polygons have been average for all 23 images. 
>>> The code essentially extracts the NDVI data as a time series for 
>>> each polygon.
>>>
>>> Unfortunately, as everyone knows, Landsat 7 ETM has a broken scan 
>>> line corrector meaning that all post 2003 data have large areas of 
>>> missing data. In my pre-processing I convert these areas to nan 
>>> using gdal_merge.py (I have to stich and subset two scenes). The 
>>> code below works well until a large portion of a polygon lies on the 
>>> nan area of the image (some polygons that only have a small area in 
>>> the nan process fine). When this happens I get the following error 
>>> message
>>>
>>> Error in if (dxsd > tolerance) { : missing value where TRUE/FALSE 
>>> needed
>>>
>>> The error is related to the following command
>>>
>>> x.clip <- temp[!is.na(overlay(temp, brede_add)),]
>>>
>>> I have no idea how to solve this error, as a backup plan I am using 
>>> r.fillnulls in grass to get rid of the stripes but this takes a very 
>>> long time and is not ideal.
>>>
>>> Any additional help or pointers would be greatly appreciated
>>>
>>> Many thanks and kind regards
>>>
>>> **************************************************************************************************************************************************************************************************************************************************** 
>>>
>>>
>>> library(maptools)
>>> library(rgdal)
>>> library(spatstat)
>>>
>>> input <- 
>>> "/media/win-drive/wes2006/Projects/Evapotranspiration/Data/Landsat_NDVI" 
>>>
>>> maps <- data.frame((list.files(input, 
>>> pattern=".img",full.names=FALSE)),(list.files(input, pattern=".img", 
>>> full.names=TRUE)))
>>> names(maps) <- c("File", "Path")
>>> fn=data.frame(maps$File)
>>>
>>> rastx<-284055.000
>>> rasty<-6302475.000
>>>
>>> Lst <- list()
>>>
>>> brede <- readShapePoly("BredeCatchmentSites.shp", IDvar="COUNT", 
>>> proj4string=CRS("+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 
>>> +units=m +no_defs"))
>>>
>>> x=0
>>> while (x <= 17)
>>> {
>>>        x<-x+1
>>>                nfiles <- length(maps$Path)
>>>                for (n in 1:nfiles)
>>>                {
>>>                   brede_add <- brede[brede$COUNT[x], ]
>>>                   box <- as.list(as.numeric(bbox(brede_add)))
>>>                   xstart <- (as.numeric(box[1])-rastx)/30
>>>                   ystart <- abs((as.numeric(box[4])-rasty)/30)
>>>
>>>                   row <- 
>>> round((as.numeric(box[3])-as.numeric(box[1]))/30)
>>>                   col <- 
>>> round((as.numeric(box[4])-as.numeric(box[2]))/30)
>>>
>>>                   temp <- 
>>> readGDAL(as.character(maps$Path[n]),silent=TRUE, 
>>> offset=c(ystart,xstart), region.dim=c(col,row))
>>>                   fullgrid(temp)=FALSE
>>>
>>>                   x.clip <- temp[!is.na(overlay(temp, brede_add)),] 
>>>   <<<<<<<<<<<-------------HERE IS THE PROBLEM-------------
>>>
>>>                   a <- mean(as.data.frame(x.clip$band1))
>>>
>>>                   Lst[n] <- list(as.numeric(a))
>>>                   print(n)
>>>                   x.clip<-0
>>>                 }
>>>
>>>        data <- as.numeric(Lst)
>>>        data2 <- cbind(data,fn)
>>>        write.table(data, paste(brede$NBALID[x]))
>>>        print(paste(brede$NBALID[x]))
>>> }
>>>
>>>
>>>
>>> Wesley Roberts MSc.
>>> Researcher: Earth Observation (Ecosystems)
>>> Natural Resources and the Environment
>>> CSIR
>>> Tel: +27 (21) 888-2490
>>> Fax: +27 (21) 888-2693
>>>
>>> "To know the road ahead, ask those coming back."
>>> - Chinese proverb
>>>
>>>
>>> -- 
>>> This message is subject to the CSIR's copyright terms and 
>>> conditions, e-mail legal notice, and implemented Open Document 
>>> Format (ODF) standard.
>>> The full disclaimer details can be found at 
>>> http://www.csir.co.za/disclaimer.html.
>>>
>>>
>>> and is believed to be clean.  MailScanner thanks Transtec Computers 
>>> for their support.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard. 
The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.


and is believed to be clean.  MailScanner thanks Transtec Computers for their support.


From p.hiemstra at geo.uu.nl  Thu Mar 19 15:09:37 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 19 Mar 2009 15:09:37 +0100
Subject: [R-sig-Geo] automap available from CRAN
Message-ID: <49C25221.10304@geo.uu.nl>

Dear people,

Today I uploaded automap to CRAN, automap is an automatic interpolation 
package building on gstat. It should be available at a mirror near you 
very soon.

Any remarks on the code or the documentation are more than welcome.

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From torleif.lunde at cih.uib.no  Thu Mar 19 15:29:18 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 19 Mar 2009 15:29:18 +0100
Subject: [R-sig-Geo] Merging data frame for SpPolDF
In-Reply-To: <49C235AF.6070303@gmail.com>
References: <49C235AF.6070303@gmail.com>
Message-ID: <200903191529.18838.torleif.lunde@cih.uib.no>

Hi

Maybe this can help? Please correct me if this is not what you wanted.

require(maptools)

nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
		    proj4string=CRS("+proj=longlat +datum=NAD27"))

#Create dummy data. Do some changes to make it look different (subset and 
order)
extra <- data.frame(ID=slot(nc, 'data')$CNTY_ID, 
Ndata=runif(length(slot(nc, 'data')$CNTY_ID)))
extra <- extra[4:67, 1:2]
extra <- extra[order(extra$ID, decreasing=TRUE),]
extra[1,1] <- 342

#add the dummy data(.frame) (this part is what you want to do)
extra <- extra[match(slot(nc, 'data')$CNTY_ID, extra$ID), 1:2]

slot(nc, 'data')$Ndata <- extra$Ndata
#or for the data frame
slot(nc, 'data') <- cbind(slot(nc, 'data'), extra[-1])

Best wishes
Torleif



On Thursday 19 March 2009 01:08:15 pm Agustin Lobo wrote:
> Hi!
>
> I often have to add more information to the data slot of
> a SpPolDF imported from a shp file. I do it in this way, don't like
> it too much and would like feed-back on a better way-
>
> #Import shp
> MMAMBmuni <- readOGR("C:/Pruebas/DUNS/MMAMBmuni", layer="MMAMBmuni")
> #Extract the DF
> MMAMBmuniDFori <- MMAMBmuni at data
>
> #Make a new dataframe by merging with another DF
> MMAMBmuniDFnew <-
> merge(MMAMBmuniDFori,MMAMBempleados,by.x="MUNICIPI",by.y="CODMUN",all.x=T,s
>ort=F)
>
> The problem here is that there are a couple of towns in the by.x field
> for which we do not any in by.y
> As we have set all.x=T, we get a line for which the values from the
> second dataframe are NA. But, despite stating sort=F, those cases are
> not in the same row as they are in the first data.frame but appended at
> the end of the new dataframe. This is bad news for us, as breaks
> the order required for including the new dataframe as the data slot
> of a new SpPolDF. Therefore, I have to reorder the new dataframe, thanks
> to another field, IDgrafic:
>
> MMAMBmuniDFnew<- MMAMBmuniDFnew[order(MMAMBmuniDFnew$ID_GRAFIC),]
>
> and then copy the original row.names, required because the row.names are
> the ones
> making the link to the polygons in the future SpPolDF:
>
> row.names(MMAMBmuniDFnew) <- row.names(MMAMBmuniDFori)
>
> #Now we put the new DF in lieu of the older one:
> MMAMBmuni2 at data <- MMAMBmuniDFnew
>
> #and finally save as shp
> writeOGR(MMAMBmuni2,dsn="C:/Pruebas/DUNS/MMAMBmuni2",layer="MMAMBmuni2",
> driver="ESRI Shapefile")
>
> Any suggestions on a better procedure? The problem is that sometimes I
> forget reordering and get a wrong shp. Until now, I have always realized
> the error, but I'm terrified by the idea of not realizing the error
> sometime and using true garbage after that point...
>
> Thanks
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From prairie.picker at gmail.com  Thu Mar 19 20:19:11 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Thu, 19 Mar 2009 15:19:11 -0400
Subject: [R-sig-Geo] Generate lines using start and end coordinates
Message-ID: <9fb1ae890903191219q3684dea2qfdc8977aa9eecdf9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090319/69667acf/attachment.pl>

From alobolistas at gmail.com  Thu Mar 19 20:21:25 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 19 Mar 2009 20:21:25 +0100
Subject: [R-sig-Geo] Merging data frame for SpPolDF
In-Reply-To: <200903191529.18838.torleif.lunde@cih.uib.no>
References: <49C235AF.6070303@gmail.com>
	<200903191529.18838.torleif.lunde@cih.uib.no>
Message-ID: <49C29B35.3060704@gmail.com>

Thanks. I might be wrong, but I think that your example is different.
The problem comes up when the second dataframe does not
have values for all cases  that are present in the first one. For example

 > a1 <-data.frame(letras=c("A","B","C","D"),nums=c("1","2","3","4"))
 > a2 <-data.frame(letras=c("A","C","D"),nums=c("10","30","40"))
 > a1
  letras nums
1      A    1
2      B    2
3      C    3
4      D    4
 > a2
  letras nums
1      A   10
2      C   30
3      D   40
 > a2 <-data.frame(letters=c("A","C","D"),cods=c("10","30","40"))
 > merge(a1,a2,by.x="letras",by.y="letters",all.x=T,sort=F)
  letras nums cods
1      A    1   10
2      C    3   30
3      D    4   40
4      B    2 <NA>

which disrupts the ordering in a1 and thus creates a risk for
puting the merged dataframe in the SpPolDF

And what you say would be:

 > a2[match(a1$letras, a2$letters), ]
   letters cods
1        A   10
NA    <NA> <NA>
2        C   30
3        D   40

which would not solve the problem.

Perhaps I did not correctly interpret your solution?

Agus

Torleif Markussen Lunde wrote:
> Hi
>
> Maybe this can help? Please correct me if this is not what you wanted.
>
> require(maptools)
>
> nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
> 		    proj4string=CRS("+proj=longlat +datum=NAD27"))
>
> #Create dummy data. Do some changes to make it look different (subset and 
> order)
> extra <- data.frame(ID=slot(nc, 'data')$CNTY_ID, 
> Ndata=runif(length(slot(nc, 'data')$CNTY_ID)))
> extra <- extra[4:67, 1:2]
> extra <- extra[order(extra$ID, decreasing=TRUE),]
> extra[1,1] <- 342
>
> #add the dummy data(.frame) (this part is what you want to do)
> extra <- extra[match(slot(nc, 'data')$CNTY_ID, extra$ID), 1:2]
>
> slot(nc, 'data')$Ndata <- extra$Ndata
> #or for the data frame
> slot(nc, 'data') <- cbind(slot(nc, 'data'), extra[-1])
>
> Best wishes
> Torleif
>
>
>
> On Thursday 19 March 2009 01:08:15 pm Agustin Lobo wrote:
>   
>> Hi!
>>
>> I often have to add more information to the data slot of
>> a SpPolDF imported from a shp file. I do it in this way, don't like
>> it too much and would like feed-back on a better way-
>>
>> #Import shp
>> MMAMBmuni <- readOGR("C:/Pruebas/DUNS/MMAMBmuni", layer="MMAMBmuni")
>> #Extract the DF
>> MMAMBmuniDFori <- MMAMBmuni at data
>>
>> #Make a new dataframe by merging with another DF
>> MMAMBmuniDFnew <-
>> merge(MMAMBmuniDFori,MMAMBempleados,by.x="MUNICIPI",by.y="CODMUN",all.x=T,s
>> ort=F)
>>
>> The problem here is that there are a couple of towns in the by.x field
>> for which we do not any in by.y
>> As we have set all.x=T, we get a line for which the values from the
>> second dataframe are NA. But, despite stating sort=F, those cases are
>> not in the same row as they are in the first data.frame but appended at
>> the end of the new dataframe. This is bad news for us, as breaks
>> the order required for including the new dataframe as the data slot
>> of a new SpPolDF. Therefore, I have to reorder the new dataframe, thanks
>> to another field, IDgrafic:
>>
>> MMAMBmuniDFnew<- MMAMBmuniDFnew[order(MMAMBmuniDFnew$ID_GRAFIC),]
>>
>> and then copy the original row.names, required because the row.names are
>> the ones
>> making the link to the polygons in the future SpPolDF:
>>
>> row.names(MMAMBmuniDFnew) <- row.names(MMAMBmuniDFori)
>>
>> #Now we put the new DF in lieu of the older one:
>> MMAMBmuni2 at data <- MMAMBmuniDFnew
>>
>> #and finally save as shp
>> writeOGR(MMAMBmuni2,dsn="C:/Pruebas/DUNS/MMAMBmuni2",layer="MMAMBmuni2",
>> driver="ESRI Shapefile")
>>
>> Any suggestions on a better procedure? The problem is that sometimes I
>> forget reordering and get a wrong shp. Until now, I have always realized
>> the error, but I'm terrified by the idea of not realizing the error
>> sometime and using true garbage after that point...
>>
>> Thanks
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>
>
>
>   

-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090319/6e9d21b3/attachment.vcf>

From torleif.lunde at cih.uib.no  Thu Mar 19 21:44:18 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 19 Mar 2009 21:44:18 +0100
Subject: [R-sig-Geo] Merging data frame for SpPolDF
In-Reply-To: <49C29B35.3060704@gmail.com>
References: <49C235AF.6070303@gmail.com>
	<200903191529.18838.torleif.lunde@cih.uib.no>
	<49C29B35.3060704@gmail.com>
Message-ID: <200903192144.18693.torleif.lunde@cih.uib.no>

Hi

It might be we are talking about different things. What I understand is that 
you have an original shp-file with unique IDs associated with each Polygon. 
In the shape-file these are named "letras". In addition to this you have a 
data.frame with variables "letters" which matches the ones in "letras". 

However in the letters column there are fewer IDs that in letras. This is what 
is generated by:
#First we extract the CNTY_ID (let this be letras) to get some similar IDs for 
the dummy data.frame. At this stage it should contain one column named ID 
with the IDs, and one named Ndata with some random values
extra <- data.frame(ID=slot(nc, 'data')$CNTY_ID, 
Ndata=runif(length(slot(nc, 'data')$CNTY_ID)))

first:
> str(slot(nc, 'data'))
'data.frame':   100 obs. of  14 variables:
.
.
 $ CNTY_ID  : num  1825 1827 1828 1831 1832 ...                                  
.
. 
$ NWBIR79  : num  19 12 260 145 1197 ...
.


#The next step is to remove some of these IDs (1-3, and 68-100). At this stage 
we have removed quite a number of IDs
extra <- extra[4:67, 1:2]

#In addition we want to sort them in a different way, to make things more 
realistic
extra <- extra[order(extra$ID, decreasing=TRUE),]

#And finally we change the value of one of the IDs to have a value that is not 
present in the original CNTY_ID. Also this to make it more realistic
extra[1,1] <- 342

> str(extra)
'data.frame':   64 obs. of  2 variables:
 $ ID   : num  342 2039 2034 2032 2030 ...
 $ Ndata: num  0.8272 0.0255 0.5633 0.1834 0.8208 ...

> str(slot(nc, 'data')$CNTY_ID)
 num [1:100] 1825 1827 1828 1831 1832 ...

So we see they look different, just like a1 and a2 in the example provided. So 
far we have only been worried about making the dummy data. 

Skip the merge() function and move directly to the match() function. This is 
what you want to do (only the next steps):

extra <- extra[match(slot(nc, 'data')$CNTY_ID, extra$ID), 1:2]

> str(extra)
'data.frame':   100 obs. of  2 variables:
 $ ID   : num  NA NA NA 1831 1832 ...
 $ Ndata: num  NA NA NA 0.252 0.842 ...

We now have the data frame you wanted to add with the same number of rows, and 
ordered the same way as the data in the SpatialPolygonsDataFrame.

We add it to the data slot in the SpatialPolygonsDataFrame.
slot(nc, 'data')$Ndata <- extra$Ndata

> str(slot(nc, 'data')) 
'data.frame':   100 obs. of  15 variables:      
.
.
 $ CNTY_ID  : num  1825 1827 1828 1831 1832 ...                                  
 .
.
 $ NWBIR79  : num  19 12 260 145 1197 ...
 $ Ndata    : num  NA NA NA 0.252 0.842 ...
.

The point is that you sort the data by the IDs in the original shape file, and 
hence you can simply add the data back to the data slot and they are than 
located in the right place.

Finally export the data, and the new shapefile has one more variable. 
writeOGR(nc,dsn="/home/lunde/MMAMBmuni2",layer="MMAMBmuni2",
driver="ESRI Shapefile")


Am I still wrong? In that, could someone else assist me?

Best wishes 
Torleif






On Thursday 19 March 2009 08:21:25 pm Agustin Lobo wrote:
> Thanks. I might be wrong, but I think that your example is different.
> The problem comes up when the second dataframe does not
> have values for all cases  that are present in the first one. For example
>
>  > a1 <-data.frame(letras=c("A","B","C","D"),nums=c("1","2","3","4"))
>  > a2 <-data.frame(letras=c("A","C","D"),nums=c("10","30","40"))
>  > a1
>
>   letras nums
> 1      A    1
> 2      B    2
> 3      C    3
> 4      D    4
>
>  > a2
>
>   letras nums
> 1      A   10
> 2      C   30
> 3      D   40
>
>  > a2 <-data.frame(letters=c("A","C","D"),cods=c("10","30","40"))
>  > merge(a1,a2,by.x="letras",by.y="letters",all.x=T,sort=F)
>
>   letras nums cods
> 1      A    1   10
> 2      C    3   30
> 3      D    4   40
> 4      B    2 <NA>
>
> which disrupts the ordering in a1 and thus creates a risk for
> puting the merged dataframe in the SpPolDF
>
> And what you say would be:
>  > a2[match(a1$letras, a2$letters), ]
>
>    letters cods
> 1        A   10
> NA    <NA> <NA>
> 2        C   30
> 3        D   40
>
> which would not solve the problem.
>
> Perhaps I did not correctly interpret your solution?
>
> Agus
>
> Torleif Markussen Lunde wrote:
> > Hi
> >
> > Maybe this can help? Please correct me if this is not what you wanted.
> >
> > require(maptools)
> >
> > nc <- readShapePoly(system.file("shapes/sids.shp",
> > package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
> >
> > #Create dummy data. Do some changes to make it look different (subset and
> > order)
> > extra <- data.frame(ID=slot(nc, 'data')$CNTY_ID,
> > Ndata=runif(length(slot(nc, 'data')$CNTY_ID)))
> > extra <- extra[4:67, 1:2]
> > extra <- extra[order(extra$ID, decreasing=TRUE),]
> > extra[1,1] <- 342
> >
> > #add the dummy data(.frame) (this part is what you want to do)
> > extra <- extra[match(slot(nc, 'data')$CNTY_ID, extra$ID), 1:2]
> >
> > slot(nc, 'data')$Ndata <- extra$Ndata
> > #or for the data frame
> > slot(nc, 'data') <- cbind(slot(nc, 'data'), extra[-1])
> >
> > Best wishes
> > Torleif
> >
> > On Thursday 19 March 2009 01:08:15 pm Agustin Lobo wrote:
> >> Hi!
> >>
> >> I often have to add more information to the data slot of
> >> a SpPolDF imported from a shp file. I do it in this way, don't like
> >> it too much and would like feed-back on a better way-
> >>
> >> #Import shp
> >> MMAMBmuni <- readOGR("C:/Pruebas/DUNS/MMAMBmuni", layer="MMAMBmuni")
> >> #Extract the DF
> >> MMAMBmuniDFori <- MMAMBmuni at data
> >>
> >> #Make a new dataframe by merging with another DF
> >> MMAMBmuniDFnew <-
> >> merge(MMAMBmuniDFori,MMAMBempleados,by.x="MUNICIPI",by.y="CODMUN",all.x=
> >>T,s ort=F)
> >>
> >> The problem here is that there are a couple of towns in the by.x field
> >> for which we do not any in by.y
> >> As we have set all.x=T, we get a line for which the values from the
> >> second dataframe are NA. But, despite stating sort=F, those cases are
> >> not in the same row as they are in the first data.frame but appended at
> >> the end of the new dataframe. This is bad news for us, as breaks
> >> the order required for including the new dataframe as the data slot
> >> of a new SpPolDF. Therefore, I have to reorder the new dataframe, thanks
> >> to another field, IDgrafic:
> >>
> >> MMAMBmuniDFnew<- MMAMBmuniDFnew[order(MMAMBmuniDFnew$ID_GRAFIC),]
> >>
> >> and then copy the original row.names, required because the row.names are
> >> the ones
> >> making the link to the polygons in the future SpPolDF:
> >>
> >> row.names(MMAMBmuniDFnew) <- row.names(MMAMBmuniDFori)
> >>
> >> #Now we put the new DF in lieu of the older one:
> >> MMAMBmuni2 at data <- MMAMBmuniDFnew
> >>
> >> #and finally save as shp
> >> writeOGR(MMAMBmuni2,dsn="C:/Pruebas/DUNS/MMAMBmuni2",layer="MMAMBmuni2",
> >> driver="ESRI Shapefile")
> >>
> >> Any suggestions on a better procedure? The problem is that sometimes I
> >> forget reordering and get a wrong shp. Until now, I have always realized
> >> the error, but I'm terrified by the idea of not realizing the error
> >> sometime and using true garbage after that point...
> >>
> >> Thanks
> >>
> >> Agus
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From prairie.picker at gmail.com  Thu Mar 19 22:14:51 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Thu, 19 Mar 2009 17:14:51 -0400
Subject: [R-sig-Geo] Extract coordinates from SpatialPolygonsDataFrame
Message-ID: <9fb1ae890903191414j5108a624q1f2343c1917f3aa@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090319/4ad57d4d/attachment.pl>

From torleif.lunde at cih.uib.no  Thu Mar 19 22:37:42 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 19 Mar 2009 22:37:42 +0100
Subject: [R-sig-Geo] Extract coordinates from SpatialPolygonsDataFrame
In-Reply-To: <9fb1ae890903191414j5108a624q1f2343c1917f3aa@mail.gmail.com>
References: <9fb1ae890903191414j5108a624q1f2343c1917f3aa@mail.gmail.com>
Message-ID: <200903192237.42617.torleif.lunde@cih.uib.no>

Hi 

In your case I guess you only need part 1. If there are more than 1 polygon 
you would also need part 2. As far as i know there are no inbuilt functions 
to extract coordinates from a SpatialPolygon. 

##
#part 1
nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], 
		    proj4string=CRS("+proj=longlat +datum=NAD27"))

lonlat <- lapply(slot(nc, "polygons"), function(x) lapply(slot(x,
   "Polygons"), function(y) slot(y, "coords")))

#part 2
for (i in 1:dim(summary(lonlat))[1]) {
  size <- length(unlist(lapply(lapply(lonlat[i], lapply, dim), unlist)))
  if (size == 2) { res2 <- data.frame(unlist(lonlat[i], recursive=FALSE))
    } else lonlat.tmp <- unlist(lonlat[i], recursive=FALSE)
  if (size != 1) lonlat2 <- do.call(rbind, lapply(lonlat.tmp, data.frame))
  res2$ID <- i
  if (i == 1) lonlat3 <- lonlat2 else lonlat3 <- rbind(lonlat3, lonlat2)
}

lonlat3
##

Maybe this could be more efficient (part 2), but at least it works.

Best wishes 
Torleif


On Thursday 19 March 2009 10:14:51 pm Tyler Dean Rudolph wrote:
> Hi there,
>
> Nestled deep within the "polygons" slot of my SpatialPolygonsDataFrame
> object is a list of xy coordinates I would like to extract.  Using
> coordinates() only produces a single xy pair associated with the polygon
> (1st entry?  Centroid?) and I cannot for the life of me manage another way,
> though I presume it is far from impossible.  Could someone please direct me
> on this?
>
> Cheers
> Tyler
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From torleif.lunde at cih.uib.no  Thu Mar 19 22:47:00 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 19 Mar 2009 22:47:00 +0100
Subject: [R-sig-Geo] Extract coordinates from SpatialPolygonsDataFrame
In-Reply-To: <200903192237.42617.torleif.lunde@cih.uib.no>
References: <9fb1ae890903191414j5108a624q1f2343c1917f3aa@mail.gmail.com>
	<200903192237.42617.torleif.lunde@cih.uib.no>
Message-ID: <200903192247.00445.torleif.lunde@cih.uib.no>

a small correction.

in the loop;
replace  if (size != 1) lonlat2 ...
with
if (size != 2) lonlat2 ...

best
Torleif

On Thursday 19 March 2009 10:37:42 pm Torleif Markussen Lunde wrote:
> Hi
>
> In your case I guess you only need part 1. If there are more than 1 polygon
> you would also need part 2. As far as i know there are no inbuilt functions
> to extract coordinates from a SpatialPolygon.
>
> ##
> #part 1
> nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1],
> 		    proj4string=CRS("+proj=longlat +datum=NAD27"))
>
> lonlat <- lapply(slot(nc, "polygons"), function(x) lapply(slot(x,
>    "Polygons"), function(y) slot(y, "coords")))
>
> #part 2
> for (i in 1:dim(summary(lonlat))[1]) {
>   size <- length(unlist(lapply(lapply(lonlat[i], lapply, dim), unlist)))
>   if (size == 2) { res2 <- data.frame(unlist(lonlat[i], recursive=FALSE))
>     } else lonlat.tmp <- unlist(lonlat[i], recursive=FALSE)
>   if (size != 1) lonlat2 <- do.call(rbind, lapply(lonlat.tmp, data.frame))
>   res2$ID <- i
>   if (i == 1) lonlat3 <- lonlat2 else lonlat3 <- rbind(lonlat3, lonlat2)
> }
>
> lonlat3
> ##
>
> Maybe this could be more efficient (part 2), but at least it works.
>
> Best wishes
> Torleif
>
> On Thursday 19 March 2009 10:14:51 pm Tyler Dean Rudolph wrote:
> > Hi there,
> >
> > Nestled deep within the "polygons" slot of my SpatialPolygonsDataFrame
> > object is a list of xy coordinates I would like to extract.  Using
> > coordinates() only produces a single xy pair associated with the polygon
> > (1st entry?  Centroid?) and I cannot for the life of me manage another
> > way, though I presume it is far from impossible.  Could someone please
> > direct me on this?
> >
> > Cheers
> > Tyler
> >
> > 	[[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Torleif Markussen Lunde
Centre for International Health/
Bjernes Centre for Climate Research
University of Bergen, Norway


From h.wickham at gmail.com  Thu Mar 19 22:48:42 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 19 Mar 2009 16:48:42 -0500
Subject: [R-sig-Geo] Extract coordinates from SpatialPolygonsDataFrame
In-Reply-To: <200903192237.42617.torleif.lunde@cih.uib.no>
References: <9fb1ae890903191414j5108a624q1f2343c1917f3aa@mail.gmail.com>
	<200903192237.42617.torleif.lunde@cih.uib.no>
Message-ID: <f8e6ff050903191448s4143edd9i9abc03d81101af8b@mail.gmail.com>

I have the following code in ggplot2 for turning a SpatialPolygon into
a regular data frame of coordinates.  You'll need to load ggplot2, and
then run fortify(yoursp).

fortify.SpatialPolygonsDataFrame <- function(shape, region = NULL) {
  attr <- as.data.frame(shape)
  # If not specified, split into regions based on first variable in attributes
  if (is.null(region)) {
    region <- names(attr)[1]
    message("Using ", region, " to define regions.")
  }

  # Figure out how polygons should be split up into the region of interest
  polys <- split(as.numeric(row.names(attr)), attr[, region])
  cp <- polygons(shape)

  # Union together all polygons that make up a region
  try_require(c("gpclib", "maptools"))
  unioned <- unionSpatialPolygons(cp, invert(polys))

  coords <- fortify(unioned)
  coords$order <- 1:nrow(coords)
  coords
}

fortify.SpatialPolygons <- function(model, data, ...) {
  ldply(model at polygons, fortify)
}

fortify.Polygons <- function(model, data, ...) {
  subpolys <- model at Polygons
  pieces <- ldply(seq_along(subpolys), function(i) {
    df <- fortify(subpolys[[model at plotOrder[i]]])
    df$piece <- i
    df
  })

  within(pieces,{
    order <- 1:nrow(pieces)
    id <- model at ID
    piece <- factor(piece)
    group <- interaction(id, piece)
  })
}

fortify.Polygon <- function(model, data, ...) {
  df <- as.data.frame(model at coords)
  names(df) <- c("long", "lat")
  df$order <- 1:nrow(df)
  df$hole <- model at hole
  df
}

fortify.SpatialLinesDataFrame <- function(model, data, ...) {
  ldply(model at lines, fortify)
}

fortify.Lines <- function(model, data, ...) {
  lines <- model at Lines
  pieces <- ldply(seq_along(lines), function(i) {
    df <- fortify(lines[[i]])
    df$piece <- i
    df
  })

  within(pieces,{
    order <- 1:nrow(pieces)
    id <- model at ID
    piece <- factor(piece)
    group <- interaction(id, piece)
  })
}

fortify.Line <- function(model, data, ...) {
  df <- as.data.frame(model at coords)
  names(df) <- c("long", "lat")
  df$order <- 1:nrow(df)
  df
}


Hadley

On Thu, Mar 19, 2009 at 4:37 PM, Torleif Markussen Lunde
<torleif.lunde at cih.uib.no> wrote:
> Hi
>
> In your case I guess you only need part 1. If there are more than 1 polygon
> you would also need part 2. As far as i know there are no inbuilt functions
> to extract coordinates from a SpatialPolygon.
>
> ##
> #part 1
> nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1],
> ? ? ? ? ? ? ? ? ? ?proj4string=CRS("+proj=longlat +datum=NAD27"))
>
> lonlat <- lapply(slot(nc, "polygons"), function(x) lapply(slot(x,
> ? "Polygons"), function(y) slot(y, "coords")))
>
> #part 2
> for (i in 1:dim(summary(lonlat))[1]) {
> ?size <- length(unlist(lapply(lapply(lonlat[i], lapply, dim), unlist)))
> ?if (size == 2) { res2 <- data.frame(unlist(lonlat[i], recursive=FALSE))
> ? ?} else lonlat.tmp <- unlist(lonlat[i], recursive=FALSE)
> ?if (size != 1) lonlat2 <- do.call(rbind, lapply(lonlat.tmp, data.frame))
> ?res2$ID <- i
> ?if (i == 1) lonlat3 <- lonlat2 else lonlat3 <- rbind(lonlat3, lonlat2)
> }
>
> lonlat3
> ##
>
> Maybe this could be more efficient (part 2), but at least it works.
>
> Best wishes
> Torleif
>
>
> On Thursday 19 March 2009 10:14:51 pm Tyler Dean Rudolph wrote:
>> Hi there,
>>
>> Nestled deep within the "polygons" slot of my SpatialPolygonsDataFrame
>> object is a list of xy coordinates I would like to extract. ?Using
>> coordinates() only produces a single xy pair associated with the polygon
>> (1st entry? ?Centroid?) and I cannot for the life of me manage another way,
>> though I presume it is far from impossible. ?Could someone please direct me
>> on this?
>>
>> Cheers
>> Tyler
>>
>> ? ? ? [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
http://had.co.nz/


From nikhil17 at gmail.com  Fri Mar 20 00:47:41 2009
From: nikhil17 at gmail.com (Nikhil Jha)
Date: Thu, 19 Mar 2009 18:47:41 -0500
Subject: [R-sig-Geo] create coordinates of columbus data for knearneigh
Message-ID: <c80e4b920903191647h4a658bare31adea98592293d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090319/bbaec748/attachment.pl>

From prairie.picker at gmail.com  Fri Mar 20 00:52:39 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Thu, 19 Mar 2009 19:52:39 -0400
Subject: [R-sig-Geo] Generate lines in ascii format using X1Y1 and X2Y2
Message-ID: <9fb1ae890903191652x93de418n47a64231b7d4b789@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090319/bb32caa2/attachment.pl>

From nikhil17 at gmail.com  Fri Mar 20 02:13:40 2009
From: nikhil17 at gmail.com (Nikhil Jha)
Date: Thu, 19 Mar 2009 20:13:40 -0500
Subject: [R-sig-Geo] create coordinates of columbus data for knearneigh
In-Reply-To: <c80e4b920903191647h4a658bare31adea98592293d@mail.gmail.com>
References: <c80e4b920903191647h4a658bare31adea98592293d@mail.gmail.com>
Message-ID: <c80e4b920903191813n331dcdddw462f41720cce0fa8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090319/fdd88550/attachment.pl>

From marceivissa at gmail.com  Fri Mar 20 11:51:55 2009
From: marceivissa at gmail.com (=?ISO-8859-1?Q?Marc_Mar=ED_Dell=27Olmo?=)
Date: Fri, 20 Mar 2009 11:51:55 +0100
Subject: [R-sig-Geo] convert point and map coordinates UTM to WSG
Message-ID: <e0379d960903200351r18abe38fo72dc0000b6b825a0@mail.gmail.com>

Dear R-users,

Can anyone tell me how to convert point coordinates from WSG84 (google
maps coordinates) format to UTM HUSO-31 ED-50. And if I have a map
(shp format) with UTM HUSO-31 ED-50 coordinates, how can I convert to
WSG84 (google maps coordinates) coordinates. Should I install some
external software?

Can anyone tell me the instructions?

Thank you,

Marc


From gianni.lavaredo at gmail.com  Fri Mar 20 13:30:36 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 20 Mar 2009 13:30:36 +0100
Subject: [R-sig-Geo] HELP please with a "list" to change column name
Message-ID: <518dff330903200530u583800eag8e63c333b44ca72a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090320/57f14d08/attachment.pl>

From linxin.pku at gmail.com  Fri Mar 20 16:08:07 2009
From: linxin.pku at gmail.com (Xin LIN)
Date: Fri, 20 Mar 2009 23:08:07 +0800
Subject: [R-sig-Geo] How to calculate the area of polygons with holes?
Message-ID: <66bcfc490903200808s50a8e6b9w16a96d1c3a17ea42@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090320/e1524086/attachment.pl>

From gianni.lavaredo at gmail.com  Fri Mar 20 16:41:53 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 20 Mar 2009 16:41:53 +0100
Subject: [R-sig-Geo] delete shapefile in the directory
Message-ID: <518dff330903200841m656de4b7qe1d30cdf9a29ea9f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090320/0d16e904/attachment.pl>

From alobolistas at gmail.com  Fri Mar 20 17:00:41 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 20 Mar 2009 17:00:41 +0100
Subject: [R-sig-Geo] Extract coordinates from SpatialPolygonsDataFrame
In-Reply-To: <f8e6ff050903191448s4143edd9i9abc03d81101af8b@mail.gmail.com>
References: <9fb1ae890903191414j5108a624q1f2343c1917f3aa@mail.gmail.com>	<200903192237.42617.torleif.lunde@cih.uib.no>
	<f8e6ff050903191448s4143edd9i9abc03d81101af8b@mail.gmail.com>
Message-ID: <49C3BDA9.5070203@gmail.com>

Hadley,

It would be great if you could put your code
in the wiki
http://wiki.r-project.org/rwiki/doku.php?id=tips:spatial-data

I think that David Hugh-Jones has contributed a lot to
this site and he might advice on the best way of doing it
(David: sorry if I'm wrong on this)

Agus

hadley wickham wrote:
> I have the following code in ggplot2 for turning a SpatialPolygon into
> a regular data frame of coordinates.  You'll need to load ggplot2, and
> then run fortify(yoursp).
>
>   
.../...

-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090320/d293d21d/attachment.vcf>

From invu97 at snu.ac.kr  Fri Mar 20 18:23:46 2009
From: invu97 at snu.ac.kr (JY SON)
Date: Fri, 20 Mar 2009 13:23:46 -0400
Subject: [R-sig-Geo] Inverse distance weighting
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAABZ4551o2zFLqOTlkeJ7nQDCgAAAEAAAAA/ydThBRFlArvK26KaA/OIBAAAAAA==@snu.ac.kr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090320/4e046c8a/attachment.pl>

From alobolistas at gmail.com  Fri Mar 20 18:29:13 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 20 Mar 2009 18:29:13 +0100
Subject: [R-sig-Geo] delete shapefile in the directory
In-Reply-To: <518dff330903200841m656de4b7qe1d30cdf9a29ea9f@mail.gmail.com>
References: <518dff330903200841m656de4b7qe1d30cdf9a29ea9f@mail.gmail.com>
Message-ID: <49C3D269.50103@gmail.com>

system()
lets you run any command on your OS
Agus

gianni lavaredo wrote:
> Hi all
>
> is there a code to delete shapefie in a directory?
>
> thanks
>
> Gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>   

-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090320/43f46e69/attachment.vcf>

From alessandro.montaghi at unifi.it  Fri Mar 20 18:33:29 2009
From: alessandro.montaghi at unifi.it (Alessandro Montaghi)
Date: Fri, 20 Mar 2009 18:33:29 +0100
Subject: [R-sig-Geo] R:  Inverse distance weighting
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAABZ4551o2zFLqOTlkeJ7nQDCgAAAEAAAAA/ydThBRFlArvK26KaA/OIBAAAAAA==@snu.ac.kr>
Message-ID: <20090320173350.0176110006E@av3.sf-csiaf.unifi.it>

Hey Jiyoung,

I use RSAGA package to do interpolation with IDW. You need to install SAGA
GIS and library(RSAGA).

The command is

rsaga.geoprocessor(lib="grid_gridding", module=0,....................


I hope this is help you

Ale


-----Messaggio originale-----
Da: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] Per conto di JY SON
Inviato: venerd? 20 marzo 2009 18.24
A: r-sig-geo at stat.math.ethz.ch
Oggetto: [R-sig-Geo] Inverse distance weighting

Dear everyone,

 

I try to do spatial interpolation using R.

I have air pollution monitoring data from 13 monitoring stations.

I'd like to make estimates of unmeasured points using IDW (Inverse Distance
Weighting) method. 

I have coordinates of monitoring station and unmeasured points.

It would be highly appreciated if you let me know which function and library
I can use to do the above.

 

Best regards,

Jiyoung

 


	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From h.wickham at gmail.com  Fri Mar 20 19:43:07 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 20 Mar 2009 13:43:07 -0500
Subject: [R-sig-Geo] Extract coordinates from SpatialPolygonsDataFrame
In-Reply-To: <49C3BDA9.5070203@gmail.com>
References: <9fb1ae890903191414j5108a624q1f2343c1917f3aa@mail.gmail.com>
	<200903192237.42617.torleif.lunde@cih.uib.no>
	<f8e6ff050903191448s4143edd9i9abc03d81101af8b@mail.gmail.com>
	<49C3BDA9.5070203@gmail.com>
Message-ID: <f8e6ff050903201143v7d5c719eu36efd70efa923fec@mail.gmail.com>

> It would be great if you could put your code
> in the wiki
> http://wiki.r-project.org/rwiki/doku.php?id=tips:spatial-data

I don't mind if the code is put on the wiki, but I don't want to keep
it up-to-date in to places, and people will be able to use it directly
from the next release of ggplot2.

Hadley

-- 
http://had.co.nz/


From Virgilio.Gomez at uclm.es  Fri Mar 20 21:59:33 2009
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Fri, 20 Mar 2009 21:59:33 +0100
Subject: [R-sig-Geo] Looking for a zero-inflated spatial data
Message-ID: <1237582773.7246.30.camel@Virgilio-Gomez>

Dear all,

I am trying to find some zero-inflated spatial data to test some of my
models but I cannot find anything. Does anyone know of any spatial data
set based on count data (ideally, from public health data) that is
freely available?

I know that this is not an R question, but if I can find a suitable data
se I will make sure that it is available in one of the R packages that I
maintain.

Many thanks,

Virgilio


From stephajm at gmail.com  Fri Mar 20 22:26:15 2009
From: stephajm at gmail.com (Stephanie)
Date: Fri, 20 Mar 2009 17:26:15 -0400
Subject: [R-sig-Geo] Extract coordinates from SpatialPolygonsDataFrame
Message-ID: <98f0d4b90903201426i20192d67h721b22ad220edc40@mail.gmail.com>

Hi all,

I've had to extract coordinates from a SpatialPolygonsDataFrame for my
work as well.

# example from Sp Vignettes (Pebesma & Bivand)
 Sr1 = Polygon(cbind(c(2, 4, 4, 1, 2), c(2, 3, 5, 4, 2)))
 Sr2 = Polygon(cbind(c(5, 4, 2, 5), c(2, 3, 2, 2)))
 Sr3 = Polygon(cbind(c(4, 4, 5, 10, 4), c(5, 3, 2, 5, 5)))
 Sr4 = Polygon(cbind(c(5, 6, 6, 5, 5), c(4, 4, 3, 3, 4)), hole = TRUE)
 Srs1 = Polygons(list(Sr1), "s1")
 Srs2 = Polygons(list(Sr2), "s2")
 Srs3 = Polygons(list(Sr3, Sr4), "s3/4")
 SpP = SpatialPolygons(list(Srs1, Srs2, Srs3), 1:3)
 plot(SpP, col = 1:3, pbg = "white")
class(SpP)

# extracting coordinates
test<-SpP at polygons[[1]]
test2<-test at Polygons[[1]] # here '1' is the first polygon in your
shapefile (you can loop through them)
test2 at coords

# Works for a SpatialPolygonsDataFrame as well. I've tried it.

Cheers,
Stephanie Melles


From p.hiemstra at geo.uu.nl  Sat Mar 21 09:55:01 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Sat, 21 Mar 2009 09:55:01 +0100
Subject: [R-sig-Geo] Inverse distance weighting
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAABZ4551o2zFLqOTlkeJ7nQDCgAAAEAAAAA/ydThBRFlArvK26KaA/OIBAAAAAA==@snu.ac.kr>
References: <!&!AAAAAAAAAAAYAAAAAAAAABZ4551o2zFLqOTlkeJ7nQDCgAAAEAAAAA/ydThBRFlArvK26KaA/OIBAAAAAA==@snu.ac.kr>
Message-ID: <49C4AB65.6040303@geo.uu.nl>

Hi,

The geostatistical package gstat supports IDW.

library(gstat)
data(meuse)
data(meuse.grid)
coordinates(meuse)=~x+y
gridded(meuse.grid)=~x+y

meuse.idw = idw(log(zinc)~1, meuse, meuse.grid, idp = 2)
spplot(meuse.idw, "var1.pred")

cheers,
Paul

JY SON wrote:
> Dear everyone,
>
>  
>
> I try to do spatial interpolation using R.
>
> I have air pollution monitoring data from 13 monitoring stations.
>
> I'd like to make estimates of unmeasured points using IDW (Inverse Distance
> Weighting) method. 
>
> I have coordinates of monitoring station and unmeasured points.
>
> It would be highly appreciated if you let me know which function and library
> I can use to do the above.
>
>  
>
> Best regards,
>
> Jiyoung
>
>  
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From alobolistas at gmail.com  Sat Mar 21 13:22:43 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sat, 21 Mar 2009 13:22:43 +0100
Subject: [R-sig-Geo] readOGR and writeOGR: encoding?
Message-ID: <49C4DC13.2060002@gmail.com>

Hi!

Is there any way to read the dbf of shp files that contain
non-ascii characters? I've tried with encoding="UTF-8"
or latin3 as for scan, but this argument does not exist for
readOGR (or writeOGR)

Agus


From roland.kaiser at sbg.ac.at  Sat Mar 21 16:03:43 2009
From: roland.kaiser at sbg.ac.at (Roland Kaiser)
Date: Sat, 21 Mar 2009 16:03:43 +0100
Subject: [R-sig-Geo] readOGR and writeOGR: encoding?
In-Reply-To: <49C4DC13.2060002@gmail.com>
References: <49C4DC13.2060002@gmail.com>
Message-ID: <DB100AAE-4E88-43E9-A46D-2CBEE9B3082D@sbg.ac.at>

You can try something like this

shp <- readOGR()
df <- apply(shp at data, 2, as.character) # if options 
("stringsAsFactors") is TRUE
Encoding(df) <- "latin1"
shp at data <- as.data.frame(df)

Roland

> Hi!
>
> Is there any way to read the dbf of shp files that contain
> non-ascii characters? I've tried with encoding="UTF-8"
> or latin3 as for scan, but this argument does not exist for
> readOGR (or writeOGR)
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Sat Mar 21 19:14:13 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sat, 21 Mar 2009 19:14:13 +0100
Subject: [R-sig-Geo] readOGR and writeOGR: encoding?
In-Reply-To: <DB100AAE-4E88-43E9-A46D-2CBEE9B3082D@sbg.ac.at>
References: <49C4DC13.2060002@gmail.com>
	<DB100AAE-4E88-43E9-A46D-2CBEE9B3082D@sbg.ac.at>
Message-ID: <49C52E75.2010408@gmail.com>

Thanks!

The problem is that only UTF-8 and latin1 area available , but for cases in
which encoding of the dbf is different (i.e. IBM850 or Western Europe 
(DOS/OS2-850/International
as recognized by OpenOffice in the case I'm dealing with now) I can read 
in QGIS and write with QGIS
as UTF8 or latin1.

Agus

Roland Kaiser wrote:
> You can try something like this
>
> shp <- readOGR()
> df <- apply(shp at data, 2, as.character) # if 
> options("stringsAsFactors") is TRUE
> Encoding(df) <- "latin1"
> shp at data <- as.data.frame(df)
>
> Roland
>
>> Hi!
>>
>> Is there any way to read the dbf of shp files that contain
>> non-ascii characters? I've tried with encoding="UTF-8"
>> or latin3 as for scan, but this argument does not exist for
>> readOGR (or writeOGR)
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: alobolistas.vcf
Type: text/x-vcard
Size: 251 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090321/b0076ee4/attachment.vcf>

From p.hiemstra at geo.uu.nl  Mon Mar 23 10:06:30 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 23 Mar 2009 10:06:30 +0100
Subject: [R-sig-Geo] delete shapefile in the directory
In-Reply-To: <49C3D269.50103@gmail.com>
References: <518dff330903200841m656de4b7qe1d30cdf9a29ea9f@mail.gmail.com>
	<49C3D269.50103@gmail.com>
Message-ID: <49C75116.8010201@geo.uu.nl>

Hi,

You can also use the command file.remove. The advantage of using this 
command in stead of the system call that Agustin suggested is that the 
code will work on all OS'es. If you use a call like system("rm 
/foo/bar") this works on Linux but not on Windows.

In addition, shapefiles are ofcourse a collection of files. You can use 
file.remove in combination with list.files to delete all the files that 
form a shapefile. If the base name of the shapefile is foo_bar:

file.remove(list.files(pattern="foo_bar"))

cheers
Paul

Agustin Lobo wrote:
> system()
> lets you run any command on your OS
> Agus
>
> gianni lavaredo wrote:
>> Hi all
>>
>> is there a code to delete shapefie in a directory?
>>
>> thanks
>>
>> Gianni
>>
>>     [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>   
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From p.hiemstra at geo.uu.nl  Mon Mar 23 10:23:46 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 23 Mar 2009 10:23:46 +0100
Subject: [R-sig-Geo] convert point and map coordinates UTM to WSG
In-Reply-To: <e0379d960903200351r18abe38fo72dc0000b6b825a0@mail.gmail.com>
References: <e0379d960903200351r18abe38fo72dc0000b6b825a0@mail.gmail.com>
Message-ID: <49C75522.5070104@geo.uu.nl>

Hi,

To transform coordinates you can use the spTransform function from the 
rgdal pacakge. It uses proj4 to do the transformations. Proj uses a 
string to describe a certain projection, the so called proj4string. If 
you can determine the proj4string for both your projections you can 
transform between them. The first string (WGS84) looks like this:

"+proj=longlat +datum=WGS84"

The second (UTM) something like:

"+proj=utm +zone=yourzone +datum=yourdatum"

See the documentation of spTransform for more information on how to use 
the function.

cheers and hth,
Paul

Marc Mar? Dell'Olmo wrote:
> Dear R-users,
>
> Can anyone tell me how to convert point coordinates from WSG84 (google
> maps coordinates) format to UTM HUSO-31 ED-50. And if I have a map
> (shp format) with UTM HUSO-31 ED-50 coordinates, how can I convert to
> WSG84 (google maps coordinates) coordinates. Should I install some
> external software?
>
> Can anyone tell me the instructions?
>
> Thank you,
>
> Marc
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From clint at ecy.wa.gov  Mon Mar 23 15:31:46 2009
From: clint at ecy.wa.gov (Clint Bowman)
Date: Mon, 23 Mar 2009 07:31:46 -0700 (PDT)
Subject: [R-sig-Geo] R:  Inverse distance weighting
In-Reply-To: <20090320173350.0176110006E@av3.sf-csiaf.unifi.it>
References: <20090320173350.0176110006E@av3.sf-csiaf.unifi.it>
Message-ID: <Pine.LNX.4.64.0903230722440.30475@aeolus.ecy.wa.gov>

Jiyoung,

Although there are R functions to do spatial interpolation, I'd advise
caution when working with air pollution data.  Be sure that topographic
and emission patterns are sufficiently smooth that you can do simple
spatial interpolation.

A technique which will likely produce better results where topographic
features are important or where the emissions are not spatially uniform is
to use a dispersion model to produce an estimate of the concentration over
the region of interest.  Now the dispersion model may not be completely
accurate, but it will reflect the spatial variation of the emission
sources quite accurately and should also do an adequate job of accounting
for the topography.

Now at each point where the concentration is measured, take the difference
between the observed and predicted concentrations.  Now spatially
interpolate that difference and apply it to the modeled values.  The US
EPA has a program, BenMAP, (Benefits MAPping) that can help with the
process.  Or you can use RSAGA as Alessandro suggested.

Clint

Clint Bowman			INTERNET:	clint at ecy.wa.gov
Air Dispersion Modeler		INTERNET:	clint at math.utah.edu
Air Quality Program		VOICE:		(360) 407-6815
Department of Ecology		FAX:		(360) 407-7534

	USPS:  		PO Box 47600, Olympia, WA 98504-7600
	Parcels:	300 Desmond Drive, Lacey, WA 98503-1274

On Fri, 20 Mar 2009, Alessandro Montaghi wrote:

> Hey Jiyoung,
>
> I use RSAGA package to do interpolation with IDW. You need to install SAGA
> GIS and library(RSAGA).
>
> The command is
>
> rsaga.geoprocessor(lib="grid_gridding", module=0,....................
>
>
> I hope this is help you
>
> Ale
>
>
> -----Messaggio originale-----
> Da: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Per conto di JY SON
> Inviato: venerd? 20 marzo 2009 18.24
> A: r-sig-geo at stat.math.ethz.ch
> Oggetto: [R-sig-Geo] Inverse distance weighting
>
> Dear everyone,
>
>
>
> I try to do spatial interpolation using R.
>
> I have air pollution monitoring data from 13 monitoring stations.
>
> I'd like to make estimates of unmeasured points using IDW (Inverse Distance
> Weighting) method.
>
> I have coordinates of monitoring station and unmeasured points.
>
> It would be highly appreciated if you let me know which function and library
> I can use to do the above.
>
>
>
> Best regards,
>
> Jiyoung
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

From markus.loecher at gmail.com  Tue Mar 24 14:19:34 2009
From: markus.loecher at gmail.com (Markus Loecher)
Date: Tue, 24 Mar 2009 09:19:34 -0400
Subject: [R-sig-Geo] meuse coordinates in lat/lon available ?
Message-ID: <bf460e020903240619y42a5c141v4d805616d976887d@mail.gmail.com>

Dear all,
I understand that the x/y coordinates of the meuse data set are projections.
I was wondering if and how I could compute the original lat/lon coordinates ?

Thanks !

Markus


From T.Hengl at uva.nl  Tue Mar 24 14:44:43 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Tue, 24 Mar 2009 14:44:43 +0100
Subject: [R-sig-Geo] meuse coordinates in lat/lon available ?
In-Reply-To: <bf460e020903240619y42a5c141v4d805616d976887d@mail.gmail.com>
References: <bf460e020903240619y42a5c141v4d805616d976887d@mail.gmail.com>
Message-ID: <B346E51420D34B039A0B3893E1464D12@pcibed193>


> data(meuse)
> coordinates(meuse) <- ~x+y
# > proj4string(meuse) <- CRS("+init=epsg:28992") 
> proj4string(meuse) <- CRS("+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889
+k=0.999908 +x_0=155000 +y_0=463000 +ellps=bessel
+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812 +units=m +no_defs")
> meuse.ll <- spTransform(meuse, CRS("+proj=longlat +datum=WGS84"))

See also:
http://spatial-analyst.net/wiki/index.php?title=Export_maps_to_GE 



-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
Markus Loecher
Sent: Tuesday, March 24, 2009 2:20 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] meuse coordinates in lat/lon available ?

Dear all,
I understand that the x/y coordinates of the meuse data set are projections.
I was wondering if and how I could compute the original lat/lon coordinates ?

Thanks !

Markus

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From els.verfaillie at ugent.be  Tue Mar 24 15:00:23 2009
From: els.verfaillie at ugent.be (Els Verfaillie)
Date: Tue, 24 Mar 2009 15:00:23 +0100
Subject: [R-sig-Geo] residuals by subtracting point values from grid values
Message-ID: <001c01c9ac88$e03a0bc0$a0ae2340$@verfaillie@ugent.be>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090324/6c0c99db/attachment.pl>

From T.Hengl at uva.nl  Tue Mar 24 15:26:48 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Tue, 24 Mar 2009 15:26:48 +0100
Subject: [R-sig-Geo] residuals by subtracting point values from grid
	values
In-Reply-To: <001c01c9ac88$e03a0bc0$a0ae2340$@verfaillie@ugent.be>
References: <001c01c9ac88$e03a0bc0$a0ae2340$@verfaillie@ugent.be>
Message-ID: <FC1EFFA41BCC44F0AF3BA0D41BA42C19@pcibed193>


Dear Else,

I've read your message twice, but I am still not sure what exactly you want to run: (1) which
prediction technique, (2) for which purpose (validation only?).

Using the krige.cv method, you can also run the cross validation for inverse distance interpolation
(note: you only need to omit the variogram):

> idw.zn.cv <- krige.cv(zinc~1, meuse, nfold=2)
[inverse distance weighted interpolation]
...

This is all explained in Edzer's paper on gstat:

Pebesma, E.J. 2004. Multivariable geostatistics in S: The gstat package. Computers and Geosciences
30: 683?91.
http://dx.doi.org/10.1016/j.cageo.2004.03.012 

see also pages 222-226 in Bivand et al. (2008) code available at:
http://www.asdar-book.org/book/geos_mod.R

here are some similar simple examples:

http://spatial-analyst.net/wiki/index.php?title=Spatial_prediction_of_soil_moisture 

HTH 

Tom Hengl


-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
Els Verfaillie
Sent: Tuesday, March 24, 2009 3:00 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] residuals by subtracting point values from grid values

Hi list,

 

I've splitted my dataset (e.g. the meuse dataset) into random 2 parts (2/3
for prediction and 1/3 for validation). I've done an interpolation (e.g.
IDW, but I also want to do it with different kriging techniques) based on
the prediction dataset. Now I want to subtract the "zinc" values from the
validation dataset (i.e. a SpatialPointsDataFrame with 52 points) from the
"var1.pred" values from the interpolation (i.e. a SpatialPointsDataFrame
with 3103 points) to obtain the residuals. This of course only on the
location of the 52 points from the validation dataset. Then I want to
calculate validation indices.

 

This is my code:

 

#Validation and prediction dataset

permid <- sample(155)

idportion <- 1:round(2*155/3)

meuse.pred <- meuse[permid[idportion], ] 

meuse.val <- meuse[permid[-idportion], ]

 

#idw based on meuse.pred

idw.pred.zn <- idw(zinc ~ 1, meuse.pred, meuse.grid)

 

I know that I could use the "krige.cv" to do an n-fold cross-validation, but
I would like to do it based on the above method.

 

Any suggestions? 

 

Thanks a lot!

 

Els 

 

______________________________________________

Dr. Els Verfaillie

Carto-GIS cluster

Ghent University (UGent) - Department of Geography

Krijgslaan 281 - S8  B- 9000 Gent  Belgium

______________________________________________






	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From j.skoien at geo.uu.nl  Tue Mar 24 18:48:44 2009
From: j.skoien at geo.uu.nl (Jon Olav Skoien)
Date: Tue, 24 Mar 2009 18:48:44 +0100
Subject: [R-sig-Geo] residuals by subtracting point values from grid
	values
In-Reply-To: <001c01c9ac88$e03a0bc0$a0ae2340$@verfaillie@ugent.be>
References: <001c01c9ac88$e03a0bc0$a0ae2340$@verfaillie@ugent.be>
Message-ID: <49C91CFC.50309@geo.uu.nl>

Hi Els,

I think you want to do:

idw.pred.zn <- idw(zinc ~ 1, meuse.pred, meuse.val)

and for kriging cross-validation:

krige.pred.zn <- krige(zinc ~ 1, meuse.pred, meuse.val,model = vgm(140000,"Sph",600,0.1))
krige.pred.zn$res = krige.pred.zn$var1.pred - meuse.val$zinc
krige.pred.zn$zscore = krige.pred.zn$res/sqrt(krige.pred.zn$var1.var)
 

You cannot do crossvalidation with meuse.grid, as you dont have 
zinc-observations in the data set.
As Tom said, this is more or less the same as you can get a lot easier 
using krige.cv (with nfold=3), unless you are planning to recalculate 
the variogram for each fold.

Cheers,
Jon



Els Verfaillie wrote:
> Hi list,
>
>  
>
> I've splitted my dataset (e.g. the meuse dataset) into random 2 parts (2/3
> for prediction and 1/3 for validation). I've done an interpolation (e.g.
> IDW, but I also want to do it with different kriging techniques) based on
> the prediction dataset. Now I want to subtract the "zinc" values from the
> validation dataset (i.e. a SpatialPointsDataFrame with 52 points) from the
> "var1.pred" values from the interpolation (i.e. a SpatialPointsDataFrame
> with 3103 points) to obtain the residuals. This of course only on the
> location of the 52 points from the validation dataset. Then I want to
> calculate validation indices.
>
>  
>
> This is my code:
>
>  
>
> #Validation and prediction dataset
>
> permid <- sample(155)
>
> idportion <- 1:round(2*155/3)
>
> meuse.pred <- meuse[permid[idportion], ] 
>
> meuse.val <- meuse[permid[-idportion], ]
>
>  
>
> #idw based on meuse.pred
>
> idw.pred.zn <- idw(zinc ~ 1, meuse.pred, meuse.grid)
>
>  
>
> I know that I could use the "krige.cv" to do an n-fold cross-validation, but
> I would like to do it based on the above method.
>
>  
>
> Any suggestions? 
>
>  
>
> Thanks a lot!
>
>  
>
> Els 
>
>  
>
> ______________________________________________
>
> Dr. Els Verfaillie
>
> Carto-GIS cluster
>
> Ghent University (UGent) - Department of Geography
>
> Krijgslaan 281 - S8  B- 9000 Gent  Belgium
>
> ______________________________________________
>
>  
>
>  
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From T.Hengl at uva.nl  Wed Mar 25 10:18:42 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Wed, 25 Mar 2009 10:18:42 +0100
Subject: [R-sig-Geo] Running analysis on DEMs using GRASS (from R?)
Message-ID: <F3CCD791B842448D8E3A79D8906FE683@pcibed193>


Dear list,

I am trying to test some DEM analysis functions in GRASS GIS (under MS Windows machines). This is my
first contact with GRASS scripting (I have successfully installed GRASS 6.4 for windows from
http://grass.itc.it/grass63/binary/mswindows/native/).

For example, with SAGA GIS, I can completely control the analysis from R and use SAGA as external
application to run the processing, e.g. to extract the drainage networks from a DEM:

> library(rgdal)
> library(RSAGA)

# obtain the data:
download.file("http://www.geomorphometry.org/data/DEM25m.zip",
destfile=paste(getwd(),"DEM25m.zip",sep="/"))
fname <- zip.file.extract(file="DEM25m.asc", zipname="DEM25m.zip")
file.copy(fname, "./DEM25m.asc", overwrite=TRUE)

# load to SAGA format:
> rsaga.esri.to.sgrd(in.grids="dem25m.asc", out.sgrds="dem25m.sgrd", in.path=getwd())
# Fill the spurious sinks:
> rsaga.geoprocessor(lib="ta_preprocessor", module=2, param=list(DEM="dem25m.sgrd",
RESULT="dem25m_f.sgrd", MINSLOPE=0.05))
# extract the channel network:
> rsaga.geoprocessor(lib="ta_channels", module=0, param=list(ELEVATION="dem25m_f.sgrd",
CHNLNTWRK="channel_ntwrk.sgrd", CHNLROUTE="channel_route.sgrd", SHAPES="channels.shp",
INIT_GRID="dem25m_f.sgrd", DIV_CELLS=3, MINLEN=40))
# read back to R:
> channels <- readOGR("channels.shp", "channels")
> spplot(channels["LENGTH"], col.regions=bpy.colors())


How could I run the same processing using GRASS? Can you control GRASS from R at all? (I would be a
bit disappointed with GRASS if I am not able to run the analysis from R).

Many thanks for your time and suggestions in advance!


Tom Hengl
http://home.medewerker.uva.nl/t.hengl/


From alobolistas at gmail.com  Wed Mar 25 10:45:54 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 25 Mar 2009 10:45:54 +0100
Subject: [R-sig-Geo] Running analysis on DEMs using GRASS (from R?)
In-Reply-To: <F3CCD791B842448D8E3A79D8906FE683@pcibed193>
References: <F3CCD791B842448D8E3A79D8906FE683@pcibed193>
Message-ID: <49C9FD52.3040800@gmail.com>

Tomislav,

This would be part of an R script using grass:

"brachspread" <- function(itmax=1,a=-1)
{
#Do the next once per session
#attach("/media/mifat32/Rutils/utiles.rda")
#Execute grass command: import tiff file into grass
#Data:
#manchas (importado de ****)
#noocup (importado de no_ocupable1.tif, 3==no ocupable)
#(senderos importado de senderos_raster10m.tif)
#trailbuf importado de senderos
#r.buffer -z --o in=senderos out=trailbuf distance=10 units=meters
#camino:1; contiguo:2; resto, NULL

require(spgrass6) #Package connecting R<->grass
G <- gmeta6() #Read grass environment
system("g.region rast=manchas")

system("r.mapcalc 'habqual = if(trailbuf==1,0,trailbuf)'")
system("r.mapcalc 'habqual = if(habqual==2,0.8,habqual)'")
system("r.mapcalc 'habqual = if(isnull(habqual),0.5,habqual)'")

#Execute grass command: set region to raster
system("g.region rast=manchas")
system("r.mapcalc 'manchasit = manchas'")

#inicio del bucle de itersciones tiempo
it <-0
system("r.mapcalc 'prob = 0.000'")
for(it in 1:itmax) {
system("r.clump --o in=manchasit out=manchasit.clmp")
#Execute grass command: create stats file
system("r.stats -cl in=manchasit.clmp out=delme.txt")
#Read stats file into R:
mistat <- read.table("delme.txt",header=F,comment.char="*")
system("rm delme.txt") #delete garbage
#Write reclass file for grass
write.table(mistat, file="delme.txt", row.names=F, col.names=F ,sep="=")
system("r.reclass --o in=manchasit.clmp out=manchas.sze rules=delme.txt")
system("rm delme.txt")

etc

Tomislav Hengl wrote:
> Dear list,
>
> I am trying to test some DEM analysis functions in GRASS GIS (under MS Windows machines). This is my
> first contact with GRASS scripting (I have successfully installed GRASS 6.4 for windows from
> http://grass.itc.it/grass63/binary/mswindows/native/).
>
> For example, with SAGA GIS, I can completely control the analysis from R and use SAGA as external
> application to run the processing, e.g. to extract the drainage networks from a DEM:
>
>   
>> library(rgdal)
>> library(RSAGA)
>>     
>
> # obtain the data:
> download.file("http://www.geomorphometry.org/data/DEM25m.zip",
> destfile=paste(getwd(),"DEM25m.zip",sep="/"))
> fname <- zip.file.extract(file="DEM25m.asc", zipname="DEM25m.zip")
> file.copy(fname, "./DEM25m.asc", overwrite=TRUE)
>
> # load to SAGA format:
>   
>> rsaga.esri.to.sgrd(in.grids="dem25m.asc", out.sgrds="dem25m.sgrd", in.path=getwd())
>>     
> # Fill the spurious sinks:
>   
>> rsaga.geoprocessor(lib="ta_preprocessor", module=2, param=list(DEM="dem25m.sgrd",
>>     
> RESULT="dem25m_f.sgrd", MINSLOPE=0.05))
> # extract the channel network:
>   
>> rsaga.geoprocessor(lib="ta_channels", module=0, param=list(ELEVATION="dem25m_f.sgrd",
>>     
> CHNLNTWRK="channel_ntwrk.sgrd", CHNLROUTE="channel_route.sgrd", SHAPES="channels.shp",
> INIT_GRID="dem25m_f.sgrd", DIV_CELLS=3, MINLEN=40))
> # read back to R:
>   
>> channels <- readOGR("channels.shp", "channels")
>> spplot(channels["LENGTH"], col.regions=bpy.colors())
>>     
>
>
> How could I run the same processing using GRASS? Can you control GRASS from R at all? (I would be a
> bit disappointed with GRASS if I am not able to run the analysis from R).
>
> Many thanks for your time and suggestions in advance!
>
>
> Tom Hengl
> http://home.medewerker.uva.nl/t.hengl/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From T.Hengl at uva.nl  Wed Mar 25 11:24:10 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Wed, 25 Mar 2009 11:24:10 +0100
Subject: [R-sig-Geo] Running analysis on DEMs using GRASS (from R?)
In-Reply-To: <49C9FD52.3040800@gmail.com>
References: <F3CCD791B842448D8E3A79D8906FE683@pcibed193>
	<49C9FD52.3040800@gmail.com>
Message-ID: <92BE129F1A234A14AA6BE88F0649749C@pcibed193>


Dear Augustin,

Thank you for your message and examples shown (flavored with a bits of Portuguese). I am aware of
the spgrass6 package. I also know that there are plenty of examples for the R GRASS connection e.g.
http://casoilresource.lawr.ucdavis.edu/drupal/node/438, but I would still like to see how an R
script would look like for the case study shown below
("http:/www.geomorphometry.org/data/DEM25m.zip"; extraction of channel network). 

I am still confused whether GRASS can be run from R (or is it only the other way around?)? how to
import the data into GRASS (e.g. ArcInfo ASCII)? how to set-up the parameters of the GRASS
environment (working directory, projection system etc)? how to control the processing from R (e.g.
using "system(...)"), and then read the results of analysis back to R? 

Please excuse my ignorance (and the fact that I am a MS Windows user). I am just a beginner with
GRASS, so it could be that things are much simpler than they seem (it could also be that they are
also much more complicated).


Many thanks,

Tom Hengl
http://home.medewerker.uva.nl/t.hengl/


-----Original Message-----
From: Agustin Lobo [mailto:alobolistas at gmail.com] 
Sent: Wednesday, March 25, 2009 10:46 AM
To: Tomislav Hengl
Cc: r-sig-geo at stat.math.ethz.ch; carlos.grohmann at gmail.com
Subject: Re: [R-sig-Geo] Running analysis on DEMs using GRASS (from R?)

Tomislav,

This would be part of an R script using grass:

"brachspread" <- function(itmax=1,a=-1)
{
#Do the next once per session
#attach("/media/mifat32/Rutils/utiles.rda")
#Execute grass command: import tiff file into grass
#Data:
#manchas (importado de ****)
#noocup (importado de no_ocupable1.tif, 3==no ocupable)
#(senderos importado de senderos_raster10m.tif)
#trailbuf importado de senderos
#r.buffer -z --o in=senderos out=trailbuf distance=10 units=meters
#camino:1; contiguo:2; resto, NULL

require(spgrass6) #Package connecting R<->grass
G <- gmeta6() #Read grass environment
system("g.region rast=manchas")

system("r.mapcalc 'habqual = if(trailbuf==1,0,trailbuf)'")
system("r.mapcalc 'habqual = if(habqual==2,0.8,habqual)'")
system("r.mapcalc 'habqual = if(isnull(habqual),0.5,habqual)'")

#Execute grass command: set region to raster
system("g.region rast=manchas")
system("r.mapcalc 'manchasit = manchas'")

#inicio del bucle de itersciones tiempo
it <-0
system("r.mapcalc 'prob = 0.000'")
for(it in 1:itmax) {
system("r.clump --o in=manchasit out=manchasit.clmp")
#Execute grass command: create stats file
system("r.stats -cl in=manchasit.clmp out=delme.txt")
#Read stats file into R:
mistat <- read.table("delme.txt",header=F,comment.char="*")
system("rm delme.txt") #delete garbage
#Write reclass file for grass
write.table(mistat, file="delme.txt", row.names=F, col.names=F ,sep="=")
system("r.reclass --o in=manchasit.clmp out=manchas.sze rules=delme.txt")
system("rm delme.txt")

etc

Tomislav Hengl wrote:
> Dear list,
>
> I am trying to test some DEM analysis functions in GRASS GIS (under MS Windows machines). This is
my
> first contact with GRASS scripting (I have successfully installed GRASS 6.4 for windows from
> http://grass.itc.it/grass63/binary/mswindows/native/).
>
> For example, with SAGA GIS, I can completely control the analysis from R and use SAGA as external
> application to run the processing, e.g. to extract the drainage networks from a DEM:
>
>   
>> library(rgdal)
>> library(RSAGA)
>>     
>
> # obtain the data:
> download.file("http://www.geomorphometry.org/data/DEM25m.zip",
> destfile=paste(getwd(),"DEM25m.zip",sep="/"))
> fname <- zip.file.extract(file="DEM25m.asc", zipname="DEM25m.zip")
> file.copy(fname, "./DEM25m.asc", overwrite=TRUE)
>
> # load to SAGA format:
>   
>> rsaga.esri.to.sgrd(in.grids="dem25m.asc", out.sgrds="dem25m.sgrd", in.path=getwd())
>>     
> # Fill the spurious sinks:
>   
>> rsaga.geoprocessor(lib="ta_preprocessor", module=2, param=list(DEM="dem25m.sgrd",
>>     
> RESULT="dem25m_f.sgrd", MINSLOPE=0.05))
> # extract the channel network:
>   
>> rsaga.geoprocessor(lib="ta_channels", module=0, param=list(ELEVATION="dem25m_f.sgrd",
>>     
> CHNLNTWRK="channel_ntwrk.sgrd", CHNLROUTE="channel_route.sgrd", SHAPES="channels.shp",
> INIT_GRID="dem25m_f.sgrd", DIV_CELLS=3, MINLEN=40))
> # read back to R:
>   
>> channels <- readOGR("channels.shp", "channels")
>> spplot(channels["LENGTH"], col.regions=bpy.colors())
>>     
>
>
> How could I run the same processing using GRASS? Can you control GRASS from R at all? (I would be
a
> bit disappointed with GRASS if I am not able to run the analysis from R).
>
> Many thanks for your time and suggestions in advance!
>
>
> Tom Hengl
> http://home.medewerker.uva.nl/t.hengl/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From alobolistas at gmail.com  Wed Mar 25 12:27:57 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 25 Mar 2009 12:27:57 +0100
Subject: [R-sig-Geo] Running analysis on DEMs using GRASS (from R?)
In-Reply-To: <92BE129F1A234A14AA6BE88F0649749C@pcibed193>
References: <F3CCD791B842448D8E3A79D8906FE683@pcibed193>	<49C9FD52.3040800@gmail.com>
	<92BE129F1A234A14AA6BE88F0649749C@pcibed193>
Message-ID: <49CA153D.20207@gmail.com>

Tomislav,

You set up your grass location and mapset, import your data
etc. outside R. Then, from the grass console, you start R and run
an scrip like the one I sent you or tits individual commands. Once 
you've done

require(spgrass6) #Package connecting R<->grass
G <- gmeta6() #Read grass environment

you can run grass commands using system(), pass results from
R to grass and from grass to R (It's done in the script
I sent you), import raster files (which I normally
don't do: raster files are too large for R in general, I prefer to
use grass for processing and then pass data as tables to R for
the stats; but have no experience with the new raster package made
by Roger).

Actually, I often use R as an scripting language for grass. I used
to do scripts in the Bourne shell itself (actually, it was csh), but 
using R (perhaps python also)
is much easier (and powerful).

I do not see that many differences between
the way you are using saga and the way you would use grass, except that
for grass you must have your location, mapset and region set. This
is actually very powerful, as (re)defining regions with g.region lets 
you restrict
your analysis to an area of interest, which you can change by
repeated calls to g.region that could depend upon a dynamic process.
The same can be done by setting a MASK.

The script that I sent you is part of a process simulating the spread of 
an invasive
plant. Note that all control is within R. You can do the same with R 
alone, but
if your raster layers are large, it could become very slow (note that 
there is for() loop
in the script, and for() loops have a very low performance in R; as most of
the commands run within the loop are grass commands run through system(),
there is minimum memory built up).

I've used the grass that comes within QGIS in windows sometimes, but I 
feel really not comfortable
doing this type of work outside linux though.

You seem experienced with saga. Actually, would like to talk to you on a 
possible use
of sage from within qgis thanks to the fact that both saga and qgis make 
use of python.

Agus

Tomislav Hengl wrote:
> Dear Augustin,
>
> Thank you for your message and examples shown (flavored with a bits of Portuguese). I am aware of
> the spgrass6 package. I also know that there are plenty of examples for the R GRASS connection e.g.
> http://casoilresource.lawr.ucdavis.edu/drupal/node/438, but I would still like to see how an R
> script would look like for the case study shown below
> ("http:/www.geomorphometry.org/data/DEM25m.zip"; extraction of channel network). 
>
> I am still confused whether GRASS can be run from R (or is it only the other way around?)? how to
> import the data into GRASS (e.g. ArcInfo ASCII)? how to set-up the parameters of the GRASS
> environment (working directory, projection system etc)? how to control the processing from R (e.g.
> using "system(...)"), and then read the results of analysis back to R? 
>
> Please excuse my ignorance (and the fact that I am a MS Windows user). I am just a beginner with
> GRASS, so it could be that things are much simpler than they seem (it could also be that they are
> also much more complicated).
>
>
> Many thanks,
>
> Tom Hengl
> http://home.medewerker.uva.nl/t.hengl/
>
>
> -----Original Message-----
> From: Agustin Lobo [mailto:alobolistas at gmail.com] 
> Sent: Wednesday, March 25, 2009 10:46 AM
> To: Tomislav Hengl
> Cc: r-sig-geo at stat.math.ethz.ch; carlos.grohmann at gmail.com
> Subject: Re: [R-sig-Geo] Running analysis on DEMs using GRASS (from R?)
>
> Tomislav,
>
> This would be part of an R script using grass:
>
> "brachspread" <- function(itmax=1,a=-1)
> {
> #Do the next once per session
> #attach("/media/mifat32/Rutils/utiles.rda")
> #Execute grass command: import tiff file into grass
> #Data:
> #manchas (importado de ****)
> #noocup (importado de no_ocupable1.tif, 3==no ocupable)
> #(senderos importado de senderos_raster10m.tif)
> #trailbuf importado de senderos
> #r.buffer -z --o in=senderos out=trailbuf distance=10 units=meters
> #camino:1; contiguo:2; resto, NULL
>
> require(spgrass6) #Package connecting R<->grass
> G <- gmeta6() #Read grass environment
> system("g.region rast=manchas")
>
> system("r.mapcalc 'habqual = if(trailbuf==1,0,trailbuf)'")
> system("r.mapcalc 'habqual = if(habqual==2,0.8,habqual)'")
> system("r.mapcalc 'habqual = if(isnull(habqual),0.5,habqual)'")
>
> #Execute grass command: set region to raster
> system("g.region rast=manchas")
> system("r.mapcalc 'manchasit = manchas'")
>
> #inicio del bucle de itersciones tiempo
> it <-0
> system("r.mapcalc 'prob = 0.000'")
> for(it in 1:itmax) {
> system("r.clump --o in=manchasit out=manchasit.clmp")
> #Execute grass command: create stats file
> system("r.stats -cl in=manchasit.clmp out=delme.txt")
> #Read stats file into R:
> mistat <- read.table("delme.txt",header=F,comment.char="*")
> system("rm delme.txt") #delete garbage
> #Write reclass file for grass
> write.table(mistat, file="delme.txt", row.names=F, col.names=F ,sep="=")
> system("r.reclass --o in=manchasit.clmp out=manchas.sze rules=delme.txt")
> system("rm delme.txt")
>
> etc
>
> Tomislav Hengl wrote:
>   
>> Dear list,
>>
>> I am trying to test some DEM analysis functions in GRASS GIS (under MS Windows machines). This is
>>     
> my
>   
>> first contact with GRASS scripting (I have successfully installed GRASS 6.4 for windows from
>> http://grass.itc.it/grass63/binary/mswindows/native/).
>>
>> For example, with SAGA GIS, I can completely control the analysis from R and use SAGA as external
>> application to run the processing, e.g. to extract the drainage networks from a DEM:
>>
>>   
>>     
>>> library(rgdal)
>>> library(RSAGA)
>>>     
>>>       
>> # obtain the data:
>> download.file("http://www.geomorphometry.org/data/DEM25m.zip",
>> destfile=paste(getwd(),"DEM25m.zip",sep="/"))
>> fname <- zip.file.extract(file="DEM25m.asc", zipname="DEM25m.zip")
>> file.copy(fname, "./DEM25m.asc", overwrite=TRUE)
>>
>> # load to SAGA format:
>>   
>>     
>>> rsaga.esri.to.sgrd(in.grids="dem25m.asc", out.sgrds="dem25m.sgrd", in.path=getwd())
>>>     
>>>       
>> # Fill the spurious sinks:
>>   
>>     
>>> rsaga.geoprocessor(lib="ta_preprocessor", module=2, param=list(DEM="dem25m.sgrd",
>>>     
>>>       
>> RESULT="dem25m_f.sgrd", MINSLOPE=0.05))
>> # extract the channel network:
>>   
>>     
>>> rsaga.geoprocessor(lib="ta_channels", module=0, param=list(ELEVATION="dem25m_f.sgrd",
>>>     
>>>       
>> CHNLNTWRK="channel_ntwrk.sgrd", CHNLROUTE="channel_route.sgrd", SHAPES="channels.shp",
>> INIT_GRID="dem25m_f.sgrd", DIV_CELLS=3, MINLEN=40))
>> # read back to R:
>>   
>>     
>>> channels <- readOGR("channels.shp", "channels")
>>> spplot(channels["LENGTH"], col.regions=bpy.colors())
>>>     
>>>       
>> How could I run the same processing using GRASS? Can you control GRASS from R at all? (I would be
>>     
> a
>   
>> bit disappointed with GRASS if I am not able to run the analysis from R).
>>
>> Many thanks for your time and suggestions in advance!
>>
>>
>> Tom Hengl
>> http://home.medewerker.uva.nl/t.hengl/
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From Roger.Bivand at nhh.no  Wed Mar 25 13:26:49 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 25 Mar 2009 13:26:49 +0100 (CET)
Subject: [R-sig-Geo] Running analysis on DEMs using GRASS (from R?)
In-Reply-To: <49CA153D.20207@gmail.com>
References: <F3CCD791B842448D8E3A79D8906FE683@pcibed193>
	<49C9FD52.3040800@gmail.com>
	<92BE129F1A234A14AA6BE88F0649749C@pcibed193>
	<49CA153D.20207@gmail.com>
Message-ID: <alpine.LRH.2.00.0903251321150.362@reclus.nhh.no>

On Wed, 25 Mar 2009, Agustin Lobo wrote:

> Tomislav,
>
> You set up your grass location and mapset, import your data
> etc. outside R. Then, from the grass console, you start R and run
> an scrip like the one I sent you or tits individual commands. Once you've 
> done
>
> require(spgrass6) #Package connecting R<->grass
> G <- gmeta6() #Read grass environment
>
> you can run grass commands using system(), pass results from
> R to grass and from grass to R (It's done in the script
> I sent you), import raster files (which I normally
> don't do: raster files are too large for R in general, I prefer to
> use grass for processing and then pass data as tables to R for
> the stats; but have no experience with the new raster package made
> by Roger

The raster package on R-forge is by Robert Hijmans and a team of 
developers - very interesting, and often the most active project on the 
whole (very active) site!

As you write, spgrass6 itself uses system() within its functions. A year 
ago I did some work on an automatic interface generator for GRASS commands 
in R using the interface descriptions provided by GRASS modules in XML. 
Would there be interest in using these to try to automate the writing of 
GRASS commands from R? Would anyone like to help? Should spgrass6 be moved 
from sourceforge CVS to R-forge SVN to make it easier for others to join 
in?

Roger


>
> Actually, I often use R as an scripting language for grass. I used
> to do scripts in the Bourne shell itself (actually, it was csh), but using R 
> (perhaps python also)
> is much easier (and powerful).
>
> I do not see that many differences between
> the way you are using saga and the way you would use grass, except that
> for grass you must have your location, mapset and region set. This
> is actually very powerful, as (re)defining regions with g.region lets you 
> restrict
> your analysis to an area of interest, which you can change by
> repeated calls to g.region that could depend upon a dynamic process.
> The same can be done by setting a MASK.
>
> The script that I sent you is part of a process simulating the spread of an 
> invasive
> plant. Note that all control is within R. You can do the same with R alone, 
> but
> if your raster layers are large, it could become very slow (note that there 
> is for() loop
> in the script, and for() loops have a very low performance in R; as most of
> the commands run within the loop are grass commands run through system(),
> there is minimum memory built up).
>
> I've used the grass that comes within QGIS in windows sometimes, but I feel 
> really not comfortable
> doing this type of work outside linux though.
>
> You seem experienced with saga. Actually, would like to talk to you on a 
> possible use
> of sage from within qgis thanks to the fact that both saga and qgis make use 
> of python.
>
> Agus
>
> Tomislav Hengl wrote:
>> Dear Augustin,
>> 
>> Thank you for your message and examples shown (flavored with a bits of 
>> Portuguese). I am aware of
>> the spgrass6 package. I also know that there are plenty of examples for the 
>> R GRASS connection e.g.
>> http://casoilresource.lawr.ucdavis.edu/drupal/node/438, but I would still 
>> like to see how an R
>> script would look like for the case study shown below
>> ("http:/www.geomorphometry.org/data/DEM25m.zip"; extraction of channel 
>> network). 
>> I am still confused whether GRASS can be run from R (or is it only the 
>> other way around?)? how to
>> import the data into GRASS (e.g. ArcInfo ASCII)? how to set-up the 
>> parameters of the GRASS
>> environment (working directory, projection system etc)? how to control the 
>> processing from R (e.g.
>> using "system(...)"), and then read the results of analysis back to R? 
>> Please excuse my ignorance (and the fact that I am a MS Windows user). I am 
>> just a beginner with
>> GRASS, so it could be that things are much simpler than they seem (it could 
>> also be that they are
>> also much more complicated).
>> 
>> 
>> Many thanks,
>> 
>> Tom Hengl
>> http://home.medewerker.uva.nl/t.hengl/
>> 
>> 
>> -----Original Message-----
>> From: Agustin Lobo [mailto:alobolistas at gmail.com] Sent: Wednesday, March 
>> 25, 2009 10:46 AM
>> To: Tomislav Hengl
>> Cc: r-sig-geo at stat.math.ethz.ch; carlos.grohmann at gmail.com
>> Subject: Re: [R-sig-Geo] Running analysis on DEMs using GRASS (from R?)
>> 
>> Tomislav,
>> 
>> This would be part of an R script using grass:
>> 
>> "brachspread" <- function(itmax=1,a=-1)
>> {
>> #Do the next once per session
>> #attach("/media/mifat32/Rutils/utiles.rda")
>> #Execute grass command: import tiff file into grass
>> #Data:
>> #manchas (importado de ****)
>> #noocup (importado de no_ocupable1.tif, 3==no ocupable)
>> #(senderos importado de senderos_raster10m.tif)
>> #trailbuf importado de senderos
>> #r.buffer -z --o in=senderos out=trailbuf distance=10 units=meters
>> #camino:1; contiguo:2; resto, NULL
>> 
>> require(spgrass6) #Package connecting R<->grass
>> G <- gmeta6() #Read grass environment
>> system("g.region rast=manchas")
>> 
>> system("r.mapcalc 'habqual = if(trailbuf==1,0,trailbuf)'")
>> system("r.mapcalc 'habqual = if(habqual==2,0.8,habqual)'")
>> system("r.mapcalc 'habqual = if(isnull(habqual),0.5,habqual)'")
>> 
>> #Execute grass command: set region to raster
>> system("g.region rast=manchas")
>> system("r.mapcalc 'manchasit = manchas'")
>> 
>> #inicio del bucle de itersciones tiempo
>> it <-0
>> system("r.mapcalc 'prob = 0.000'")
>> for(it in 1:itmax) {
>> system("r.clump --o in=manchasit out=manchasit.clmp")
>> #Execute grass command: create stats file
>> system("r.stats -cl in=manchasit.clmp out=delme.txt")
>> #Read stats file into R:
>> mistat <- read.table("delme.txt",header=F,comment.char="*")
>> system("rm delme.txt") #delete garbage
>> #Write reclass file for grass
>> write.table(mistat, file="delme.txt", row.names=F, col.names=F ,sep="=")
>> system("r.reclass --o in=manchasit.clmp out=manchas.sze rules=delme.txt")
>> system("rm delme.txt")
>> 
>> etc
>> 
>> Tomislav Hengl wrote:
>> 
>>> Dear list,
>>> 
>>> I am trying to test some DEM analysis functions in GRASS GIS (under MS 
>>> Windows machines). This is
>>> 
>> my
>> 
>>> first contact with GRASS scripting (I have successfully installed GRASS 
>>> 6.4 for windows from
>>> http://grass.itc.it/grass63/binary/mswindows/native/).
>>> 
>>> For example, with SAGA GIS, I can completely control the analysis from R 
>>> and use SAGA as external
>>> application to run the processing, e.g. to extract the drainage networks 
>>> from a DEM:
>>>
>>> 
>>>> library(rgdal)
>>>> library(RSAGA)
>>>> 
>>> # obtain the data:
>>> download.file("http://www.geomorphometry.org/data/DEM25m.zip",
>>> destfile=paste(getwd(),"DEM25m.zip",sep="/"))
>>> fname <- zip.file.extract(file="DEM25m.asc", zipname="DEM25m.zip")
>>> file.copy(fname, "./DEM25m.asc", overwrite=TRUE)
>>> 
>>> # load to SAGA format:
>>> 
>>>> rsaga.esri.to.sgrd(in.grids="dem25m.asc", out.sgrds="dem25m.sgrd", 
>>>> in.path=getwd())
>>>> 
>>> # Fill the spurious sinks:
>>> 
>>>> rsaga.geoprocessor(lib="ta_preprocessor", module=2, 
>>>> param=list(DEM="dem25m.sgrd",
>>>> 
>>> RESULT="dem25m_f.sgrd", MINSLOPE=0.05))
>>> # extract the channel network:
>>> 
>>>> rsaga.geoprocessor(lib="ta_channels", module=0, 
>>>> param=list(ELEVATION="dem25m_f.sgrd",
>>>> 
>>> CHNLNTWRK="channel_ntwrk.sgrd", CHNLROUTE="channel_route.sgrd", 
>>> SHAPES="channels.shp",
>>> INIT_GRID="dem25m_f.sgrd", DIV_CELLS=3, MINLEN=40))
>>> # read back to R:
>>> 
>>>> channels <- readOGR("channels.shp", "channels")
>>>> spplot(channels["LENGTH"], col.regions=bpy.colors())
>>>> 
>>> How could I run the same processing using GRASS? Can you control GRASS 
>>> from R at all? (I would be
>>> 
>> a
>> 
>>> bit disappointed with GRASS if I am not able to run the analysis from R).
>>> 
>>> Many thanks for your time and suggestions in advance!
>>> 
>>> 
>>> Tom Hengl
>>> http://home.medewerker.uva.nl/t.hengl/
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>>>
>>> 
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From brianadr at optusnet.com.au  Wed Mar 25 14:27:18 2009
From: brianadr at optusnet.com.au (Brian Cooper)
Date: Thu, 26 Mar 2009 00:27:18 +1100
Subject: [R-sig-Geo] Factor Analysis using R and grass
Message-ID: <C1267A8009854B7E94322856A5BA367E@brianmain>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090326/a8e12e6b/attachment.pl>

From facrimas at libero.it  Wed Mar 25 15:49:52 2009
From: facrimas at libero.it (facrimas at libero.it)
Date: Wed, 25 Mar 2009 15:49:52 +0100 (CET)
Subject: [R-sig-Geo] about cross h scattergram
Message-ID: <13889718.708961237992592135.JavaMail.root@wmail44>


Hi guys,

I want to plot a h-scattergram between two attributes.

For univariate case, I use:

> data(jura)
> coordinates(jura.pred) = ~Xloc+Yloc
> hscat <- hscat(Cd~1, jura.pred, c(0, 0.043, 0.214, 0.388, 0.616, 0.787, 
1.024))

in bivariate case, I used following script

> data(jura)
> coordinates(jura.pred) = ~Xloc+Yloc
> hscat <- hscat(Cd~Ni, jura.pred, c(0, 0.043, 0.214, 0.388, 0.616, 0.787, 
1.024))

with ~Ni (secondary attribute) instead of ~1, but that gets me the same 
results of before.

any suggestions?

thanks

Cristiano


From T.Hengl at uva.nl  Wed Mar 25 18:44:57 2009
From: T.Hengl at uva.nl (Tomislav Hengl)
Date: Wed, 25 Mar 2009 18:44:57 +0100
Subject: [R-sig-Geo] FW:  Factor Analysis using R and grass
Message-ID: <438574A7DC50439392CD8A97195103D2@pcibed193>



Hi Brian,

The PCA you can also run without GRASS e.g.:

> gridmaps <- readGDAL("NED1.asc")  
> names(gridmaps)[1] <- "DEM"
> proj4string(gridmaps) <- CRS("+init=epsg:32618")
> gridmaps$twi <- readGDAL("twi.asc")$band1
> gridmaps$achan <- readGDAL("achan.asc")$band1
> gridmaps$insolat <- readGDAL("insolat.asc")$band1
> pc.dem <- prcomp(~DEM+twi+achan+insolat, scale=TRUE, gridmaps at data)
> biplot(pc.dem, arrow.len=0.1, xlabs=rep(".", length(pc.dem$x[,1])), main="PCA biplot")

If you have missing pixels or if you use a max, then you will need to select the generated
components before you can reproduce the maps.

See also: http://spatial-analyst.net/wiki/index.php?title=Analysis_of_DEMs_in_R%2BILWIS/SAGA 

HTH

Tom Hengl
http://spatial-analyst.net 



-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
Brian Cooper
Sent: Wednesday, March 25, 2009 2:27 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] Factor Analysis using R and grass

I am new to both R and Grass. I need to duplicate the Principal Component
Analysis approach used in SPSS with GRASS and R. Is this possible?
 
brian Cooper

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From debeaudette at ucdavis.edu  Wed Mar 25 19:47:00 2009
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Wed, 25 Mar 2009 11:47:00 -0700
Subject: [R-sig-Geo] FW:  Factor Analysis using R and grass
In-Reply-To: <438574A7DC50439392CD8A97195103D2@pcibed193>
References: <438574A7DC50439392CD8A97195103D2@pcibed193>
Message-ID: <200903251147.00229.dylan.beaudette@gmail.com>

Hi,

Alternatively, if you must use all of the pixels in a massive grid, you can do 
PCA in GRASS with the i.pca command. Note that you must take care of 
standardization if you are using variables with different units / scales.

Cheers,

Dylan


On Wednesday 25 March 2009, Tomislav Hengl wrote:
> Hi Brian,
>
> The PCA you can also run without GRASS e.g.:
> > gridmaps <- readGDAL("NED1.asc")
> > names(gridmaps)[1] <- "DEM"
> > proj4string(gridmaps) <- CRS("+init=epsg:32618")
> > gridmaps$twi <- readGDAL("twi.asc")$band1
> > gridmaps$achan <- readGDAL("achan.asc")$band1
> > gridmaps$insolat <- readGDAL("insolat.asc")$band1
> > pc.dem <- prcomp(~DEM+twi+achan+insolat, scale=TRUE, gridmaps at data)
> > biplot(pc.dem, arrow.len=0.1, xlabs=rep(".", length(pc.dem$x[,1])),
> > main="PCA biplot")
>
> If you have missing pixels or if you use a max, then you will need to
> select the generated components before you can reproduce the maps.
>
> See also:
> http://spatial-analyst.net/wiki/index.php?title=Analysis_of_DEMs_in_R%2BILW
>IS/SAGA
>
> HTH
>
> Tom Hengl
> http://spatial-analyst.net
>
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Brian Cooper
> Sent: Wednesday, March 25, 2009 2:27 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Factor Analysis using R and grass
>
> I am new to both R and Grass. I need to duplicate the Principal Component
> Analysis approach used in SPSS with GRASS and R. Is this possible?
>
> brian Cooper
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From macq at llnl.gov  Wed Mar 25 22:06:20 2009
From: macq at llnl.gov (Don MacQueen)
Date: Wed, 25 Mar 2009 14:06:20 -0700
Subject: [R-sig-Geo] help pages for CRS duplicated?
Message-ID: <p06240807c5f049ce8163@[128.115.67.9]>

I encountered the following. My quick and simple search of past 
emails in R-sig-geo didn't find any previous discussion.


>  search()
  ".GlobalEnv"        "package:rmacq"     "package:rgdal"
   "package:maptools"  "package:sp"
   "package:foreign"   "package:stats"     "package:graphics"
  "package:grDevices" "package:utils"     "package:datasets"
   "package:methods"   "Autoloads"         "package:base"
>
>  find('CRS')
[1] "package:sp"
>
>  ?CRS
Help on topic 'CRS' was found in the following packages:

   Package               Library
   rgdal                 /Library/Frameworks/R.framework/Resources/library
   sp                    /Library/Frameworks/R.framework/Resources/library



Followed by a request to identify which one to view.

Thanks
-Don


(In case anyone wonders, rmacq is a local personal package.)

>  sessionInfo()
R version 2.8.1 (2008-12-22)
i386-apple-darwin8.11.1

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rmacq_1.0-2     rgdal_0.5-30    maptools_0.7-16 sp_0.9-28 
foreign_0.8-30

loaded via a namespace (and not attached):
[1] grid_2.8.1      lattice_0.17-17 tcltk_2.8.1     tools_2.8.1
Warning message:
'DESCRIPTION' file has 'Encoding' field and re-encoding is not possible

-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062


From Roger.Bivand at nhh.no  Wed Mar 25 23:16:23 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 25 Mar 2009 23:16:23 +0100 (CET)
Subject: [R-sig-Geo] help pages for CRS duplicated?
In-Reply-To: <p06240807c5f049ce8163@[128.115.67.9]>
References: <p06240807c5f049ce8163@[128.115.67.9]>
Message-ID: <alpine.LRH.2.00.0903252308300.1755@reclus.nhh.no>

On Wed, 25 Mar 2009, Don MacQueen wrote:

> I encountered the following. My quick and simple search of past emails in 
> R-sig-geo didn't find any previous discussion.
>
>
>>  search()
> ".GlobalEnv"        "package:rmacq"     "package:rgdal"
>  "package:maptools"  "package:sp"
>  "package:foreign"   "package:stats"     "package:graphics"
> "package:grDevices" "package:utils"     "package:datasets"
>  "package:methods"   "Autoloads"         "package:base"
>>
>>  find('CRS')
> [1] "package:sp"
>>
>>  ?CRS
> Help on topic 'CRS' was found in the following packages:
>
>  Package               Library
>  rgdal                 /Library/Frameworks/R.framework/Resources/library
>  sp                    /Library/Frameworks/R.framework/Resources/library
>
>
>
> Followed by a request to identify which one to view.

Since the behaviour of the class differs depending on whether rgdal is 
available or not, it is described (somewhat differently) in both. As it 
is, sp does not depend on rgdal but rgdal depends on sp, and this is 
likely to continue to be the case. Note that the specific versions can be 
accessed by:

help(CRS, package=sp)
help(CRS, package=rgdal)

Further, the sp version uses examples depending on rgdal through 
require(), but sp does not "Suggest:" rgdal to avoid circularity.

The difference, as the help pages explain, is that in just sp, there is no 
external check of the correctness of the string inserted into class 
instances, while when rgdal is loaded, the strings are checked using the 
PROJ.4 library.

Hope this helps,

Roger

>
> Thanks
> -Don
>
>
> (In case anyone wonders, rmacq is a local personal package.)
>
>>  sessionInfo()
> R version 2.8.1 (2008-12-22)
> i386-apple-darwin8.11.1
>
> locale:
> C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rmacq_1.0-2     rgdal_0.5-30    maptools_0.7-16 sp_0.9-28 foreign_0.8-30
>
> loaded via a namespace (and not attached):
> [1] grid_2.8.1      lattice_0.17-17 tcltk_2.8.1     tools_2.8.1
> Warning message:
> 'DESCRIPTION' file has 'Encoding' field and re-encoding is not possible
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From macq at llnl.gov  Wed Mar 25 23:24:27 2009
From: macq at llnl.gov (Don MacQueen)
Date: Wed, 25 Mar 2009 15:24:27 -0700
Subject: [R-sig-Geo] help pages for CRS duplicated?
In-Reply-To: <alpine.LRH.2.00.0903252308300.1755@reclus.nhh.no>
References: <p06240807c5f049ce8163@[128.115.67.9]>
	<alpine.LRH.2.00.0903252308300.1755@reclus.nhh.no>
Message-ID: <p06240809c5f05f82977c@[128.115.67.9]>

This does help, thank you.

-Don

At 11:16 PM +0100 3/25/09, Roger Bivand wrote:
>On Wed, 25 Mar 2009, Don MacQueen wrote:
>
>>I encountered the following. My quick and simple search of past 
>>emails in R-sig-geo didn't find any previous discussion.
>>
>>>  search()
>>".GlobalEnv"        "package:rmacq"     "package:rgdal"
>>  "package:maptools"  "package:sp"
>>  "package:foreign"   "package:stats"     "package:graphics"
>>"package:grDevices" "package:utils"     "package:datasets"
>>  "package:methods"   "Autoloads"         "package:base"
>>>
>>>  find('CRS')
>>[1] "package:sp"
>>>
>>>  ?CRS
>>Help on topic 'CRS' was found in the following packages:
>>
>>  Package               Library
>>  rgdal                 /Library/Frameworks/R.framework/Resources/library
>>  sp                    /Library/Frameworks/R.framework/Resources/library
>>
>>
>>
>>Followed by a request to identify which one to view.
>
>Since the behaviour of the class differs depending on whether rgdal 
>is available or not, it is described (somewhat differently) in both. 
>As it is, sp does not depend on rgdal but rgdal depends on sp, and 
>this is likely to continue to be the case. Note that the specific 
>versions can be accessed by:
>
>help(CRS, package=sp)
>help(CRS, package=rgdal)
>
>Further, the sp version uses examples depending on rgdal through 
>require(), but sp does not "Suggest:" rgdal to avoid circularity.
>
>The difference, as the help pages explain, is that in just sp, there 
>is no external check of the correctness of the string inserted into 
>class instances, while when rgdal is loaded, the strings are checked 
>using the PROJ.4 library.
>
>Hope this helps,
>
>Roger
>
>>
>>Thanks
>>-Don
>>
>>
>>(In case anyone wonders, rmacq is a local personal package.)
>>
>>>  sessionInfo()
>>R version 2.8.1 (2008-12-22)
>>i386-apple-darwin8.11.1
>>
>>locale:
>>C
>>
>>attached base packages:
>>[1] stats     graphics  grDevices utils     datasets  methods   base
>>
>>other attached packages:
>>[1] rmacq_1.0-2     rgdal_0.5-30    maptools_0.7-16 sp_0.9-28 foreign_0.8-30
>>
>>loaded via a namespace (and not attached):
>>[1] grid_2.8.1      lattice_0.17-17 tcltk_2.8.1     tools_2.8.1
>>Warning message:
>>'DESCRIPTION' file has 'Encoding' field and re-encoding is not possible
>>
>
>--
>Roger Bivand
>Economic Geography Section, Department of Economics, Norwegian School of
>Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>e-mail: Roger.Bivand at nhh.no


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062


From els.verfaillie at ugent.be  Thu Mar 26 09:44:54 2009
From: els.verfaillie at ugent.be (Els Verfaillie)
Date: Thu, 26 Mar 2009 09:44:54 +0100
Subject: [R-sig-Geo] residuals by subtracting point values from grid
	values
In-Reply-To: <49C91CFC.50309@geo.uu.nl>
References: <001c01c9ac88$e03a0bc0$a0ae2340$@verfaillie@ugent.be>
	<49C91CFC.50309@geo.uu.nl>
Message-ID: <003e01c9adef$22f65dd0$68e31970$@verfaillie@ugent.be>

Hi Jon and Tomislav,

Thanks for your answers. This is what I needed.
I know that krige.cv is a lot easier to use, but I just wanted to do a test
with this methodology.

Best wishes,
Els
 



-----Original Message-----
From: Jon Olav Skoien [mailto:j.skoien at geo.uu.nl] 
Sent: dinsdag 24 maart 2009 18:49
To: Els Verfaillie
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] residuals by subtracting point values from grid
values

Hi Els,

I think you want to do:

idw.pred.zn <- idw(zinc ~ 1, meuse.pred, meuse.val)

and for kriging cross-validation:

krige.pred.zn <- krige(zinc ~ 1, meuse.pred, meuse.val,model =
vgm(140000,"Sph",600,0.1))
krige.pred.zn$res = krige.pred.zn$var1.pred - meuse.val$zinc
krige.pred.zn$zscore = krige.pred.zn$res/sqrt(krige.pred.zn$var1.var)
 

You cannot do crossvalidation with meuse.grid, as you dont have 
zinc-observations in the data set.
As Tom said, this is more or less the same as you can get a lot easier 
using krige.cv (with nfold=3), unless you are planning to recalculate 
the variogram for each fold.

Cheers,
Jon



Els Verfaillie wrote:
> Hi list,
>
>  
>
> I've splitted my dataset (e.g. the meuse dataset) into random 2 parts (2/3
> for prediction and 1/3 for validation). I've done an interpolation (e.g.
> IDW, but I also want to do it with different kriging techniques) based on
> the prediction dataset. Now I want to subtract the "zinc" values from the
> validation dataset (i.e. a SpatialPointsDataFrame with 52 points) from the
> "var1.pred" values from the interpolation (i.e. a SpatialPointsDataFrame
> with 3103 points) to obtain the residuals. This of course only on the
> location of the 52 points from the validation dataset. Then I want to
> calculate validation indices.
>
>  
>
> This is my code:
>
>  
>
> #Validation and prediction dataset
>
> permid <- sample(155)
>
> idportion <- 1:round(2*155/3)
>
> meuse.pred <- meuse[permid[idportion], ] 
>
> meuse.val <- meuse[permid[-idportion], ]
>
>  
>
> #idw based on meuse.pred
>
> idw.pred.zn <- idw(zinc ~ 1, meuse.pred, meuse.grid)
>
>  
>
> I know that I could use the "krige.cv" to do an n-fold cross-validation,
but
> I would like to do it based on the above method.
>
>  
>
> Any suggestions? 
>
>  
>
> Thanks a lot!
>
>  
>
> Els 
>
>  
>
> ______________________________________________
>
> Dr. Els Verfaillie
>
> Carto-GIS cluster
>
> Ghent University (UGent) - Department of Geography
>
> Krijgslaan 281 - S8  B- 9000 Gent  Belgium
>
> ______________________________________________
>
>  
>
>  
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

No virus found in this incoming message.
Checked by AVG - www.avg.com 

18:54:00


From alobolistas at gmail.com  Thu Mar 26 10:55:55 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 26 Mar 2009 10:55:55 +0100
Subject: [R-sig-Geo] FW:  Factor Analysis using R and grass
In-Reply-To: <200903251147.00229.dylan.beaudette@gmail.com>
References: <438574A7DC50439392CD8A97195103D2@pcibed193>
	<200903251147.00229.dylan.beaudette@gmail.com>
Message-ID: <49CB512B.6010708@gmail.com>

Note that there has recently been a lot of
traffic on this issue, visit
http://grass.osgeo.org/wiki/Principal_Component_Analysis

i.pca has given trouble since many years ago, the consensus
was rather using m.eigensystem and r.mapcalc instead.

It seems that the fact is the i.pca is equivalent
to prcomp(X,center=F) in R. Non-centered PCA is not
a common use of PCA (IMHO, pretty useless in our context),
and actually has no equivalent in princomp()

Anyway, note that if you do a random selection of, say,
5% of your pixels, save values to a table and import
to R, you can calculate the eigenvectors and then use
them in r.mapcalc to calculate the PCs. This gives you much
more control of the statistical part. You can also calculate
the covar matrix in grass, pass it to R and carry out your analysis
there. In that way you will not have to sample, but I encourage you
to test the sampling procedure.

Finally note that factor analysis and PCA are not identical.

Agus

Dylan Beaudette wrote:
> Hi,
>
> Alternatively, if you must use all of the pixels in a massive grid, you can do 
> PCA in GRASS with the i.pca command. Note that you must take care of 
> standardization if you are using variables with different units / scales.
>
> Cheers,
>
> Dylan
>
>
> On Wednesday 25 March 2009, Tomislav Hengl wrote:
>   
>> Hi Brian,
>>
>> The PCA you can also run without GRASS e.g.:
>>     
>>> gridmaps <- readGDAL("NED1.asc")
>>> names(gridmaps)[1] <- "DEM"
>>> proj4string(gridmaps) <- CRS("+init=epsg:32618")
>>> gridmaps$twi <- readGDAL("twi.asc")$band1
>>> gridmaps$achan <- readGDAL("achan.asc")$band1
>>> gridmaps$insolat <- readGDAL("insolat.asc")$band1
>>> pc.dem <- prcomp(~DEM+twi+achan+insolat, scale=TRUE, gridmaps at data)
>>> biplot(pc.dem, arrow.len=0.1, xlabs=rep(".", length(pc.dem$x[,1])),
>>> main="PCA biplot")
>>>       
>> If you have missing pixels or if you use a max, then you will need to
>> select the generated components before you can reproduce the maps.
>>
>> See also:
>> http://spatial-analyst.net/wiki/index.php?title=Analysis_of_DEMs_in_R%2BILW
>> IS/SAGA
>>
>> HTH
>>
>> Tom Hengl
>> http://spatial-analyst.net
>>
>>
>>
>> -----Original Message-----
>> From: r-sig-geo-bounces at stat.math.ethz.ch
>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Brian Cooper
>> Sent: Wednesday, March 25, 2009 2:27 PM
>> To: r-sig-geo at stat.math.ethz.ch
>> Subject: [R-sig-Geo] Factor Analysis using R and grass
>>
>> I am new to both R and Grass. I need to duplicate the Principal Component
>> Analysis approach used in SPSS with GRASS and R. Is this possible?
>>
>> brian Cooper
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>
>
>
>


From brianadr at optusnet.com.au  Thu Mar 26 13:52:26 2009
From: brianadr at optusnet.com.au (Brian Cooper)
Date: Thu, 26 Mar 2009 23:52:26 +1100
Subject: [R-sig-Geo] Factor Analysis using R and grass
In-Reply-To: <C1267A8009854B7E94322856A5BA367E@brianmain>
References: <C1267A8009854B7E94322856A5BA367E@brianmain>
Message-ID: <B5656139696245988C35A1D1BB6E3960@brianmain>

Thanks for the response; the data sets are centroid based with 20 to 30
variables per centroid. What has been suggested will work with rasters but
not with vectors. What I need to know it is possible to conduct a PCA on
vector data sets and store the results as additional variables. I am
interested in the impact of the nearest neighbour on the particular score. I
work with human services planning data and am looking at developing more
effective measures for local area planning. Theoretically speaking a
geo-statistical approach will give a truer result that current aspatial
approaches.

Brian Cooper

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Brian Cooper
Sent: Thursday, 26 March 2009 12:27 AM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] Factor Analysis using R and grass

I am new to both R and Grass. I need to duplicate the Principal Component
Analysis approach used in SPSS with GRASS and R. Is this possible?
 
brian Cooper

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Thu Mar 26 14:12:12 2009
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 26 Mar 2009 14:12:12 +0100
Subject: [R-sig-Geo] Factor Analysis using R and grass
In-Reply-To: <B5656139696245988C35A1D1BB6E3960@brianmain>
References: <C1267A8009854B7E94322856A5BA367E@brianmain>
	<B5656139696245988C35A1D1BB6E3960@brianmain>
Message-ID: <49CB7F2C.5000400@gmail.com>

Brian,

PCA does not care about raster or vector. All you need is
a table of individuals x variables. Whether you get that
from a vector or a raster does not matter at all. Instead,
you must be careful with what your data mean. In particular,
you mention centroids. If those are centroids of polygons
which do not have the same area and your centroid
is the mean of a surface-dependent variable
, you must be aware of the fact
the PCA of A and B below is not the same (B has the first row of A 3 
times, the second once
and the third 5, i.e the area of the 3 polygons would be 3, 1, 5 units)

 > A
[,1] [,2] [,3] [,4]
[1,] 0.7142542 2.4097913 0.36845987 -0.08292664
[2,] -0.1718578 -1.2655390 -0.01597638 -0.51156564
[3,] 0.3774107 -0.4042545 0.35403702 -1.01637522
 > B
[,1] [,2] [,3] [,4]
[1,] 0.7142542 2.409791 0.36845987 -0.08292664
[2,] 0.7142542 2.409791 0.36845987 -0.08292664
[3,] 0.7142542 2.409791 0.36845987 -0.08292664
[4,] -0.1718578 -1.265539 -0.01597638 -0.51156564
[5,] 0.7142542 2.409791 0.36845987 -0.08292664
[6,] 0.7142542 2.409791 0.36845987 -0.08292664
[7,] 0.7142542 2.409791 0.36845987 -0.08292664
[8,] 0.7142542 2.409791 0.36845987 -0.08292664
[9,] 0.7142542 2.409791 0.36845987 -0.08292664

Also, note that PCA is not spatial at all.

Agus

Brian Cooper wrote:
> Thanks for the response; the data sets are centroid based with 20 to 30
> variables per centroid. What has been suggested will work with rasters but
> not with vectors. What I need to know it is possible to conduct a PCA on
> vector data sets and store the results as additional variables. I am
> interested in the impact of the nearest neighbour on the particular score. I
> work with human services planning data and am looking at developing more
> effective measures for local area planning. Theoretically speaking a
> geo-statistical approach will give a truer result that current aspatial
> approaches.
>
> Brian Cooper
>
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Brian Cooper
> Sent: Thursday, 26 March 2009 12:27 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Factor Analysis using R and grass
>
> I am new to both R and Grass. I need to duplicate the Principal Component
> Analysis approach used in SPSS with GRASS and R. Is this possible?
>  
> brian Cooper
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From qlemouland at yahoo.fr  Thu Mar 26 16:33:05 2009
From: qlemouland at yahoo.fr (Quentin LEMOULAND)
Date: Thu, 26 Mar 2009 15:33:05 +0000 (GMT)
Subject: [R-sig-Geo] as.psp don't work for big shapefiles?
Message-ID: <301396.61864.qm@web24204.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090326/a8104fc8/attachment.pl>

From zev at zevross.com  Thu Mar 26 21:53:35 2009
From: zev at zevross.com (Zev Ross)
Date: Thu, 26 Mar 2009 16:53:35 -0400
Subject: [R-sig-Geo] RPyGeo Query -- probably easy
Message-ID: <49CBEB4F.4060905@zevross.com>

Hi All,

I'm wondering if anybody could give me a little guidance on formatting a 
query using RPyGeo. I'm excited to be able to run Python geoprocessing 
functions straight from R but am having trouble with the quote, double 
quote kinds of issues.

Here's an example of what I'd like to run

rpygeo.geoprocessor("makefeaturelayer('X:\\abc.shp',
'walk')", "SelectLayerByAttribute('walk','NEW_SELECTION', ' "hrwk05" 
'<>0")",env=myenv)

Where the sticking point is hrwk05 <> 0. In Python my query would be 
double quote, field name, close double quote, comparison, number e.g, 
"hrwk05" <> 0 but I'm not sure how to put this into RPyGeo

If I run like so:

rpygeo.geoprocessor("makefeaturelayer('X:\\abc.shp',
'walk')", "SelectLayerByAttribute('walk','NEW_SELECTION', '')",env=myenv)

it runs.

Thank you in advance for assistance.

Zev

-- 
Zev Ross
ZevRoss Spatial Analysis
120 N Aurora, Suite 3A
Ithaca, NY 14850
607-277-0004 (phone)
866-877-3690 (fax, toll-free)
zev at zevross.com


From torleif.lunde at cih.uib.no  Thu Mar 26 22:08:25 2009
From: torleif.lunde at cih.uib.no (Torleif Markussen Lunde)
Date: Thu, 26 Mar 2009 22:08:25 +0100
Subject: [R-sig-Geo] as.psp don't work for big shapefiles?
In-Reply-To: <301396.61864.qm@web24204.mail.ird.yahoo.com>
References: <301396.61864.qm@web24204.mail.ird.yahoo.com>
Message-ID: <200903262208.26028.torleif.lunde@cih.uib.no>

Hi 

I tried to convert a SpatialLinesDataFrame with 
dim(var at data)
10615     4
and 153665 coordinate pairs.

It worked fine (as.psp(var)), but took about an hour to run.

sessionInfo()
R version 2.8.1 (2008-12-22) 
i386-redhat-linux-gnu        

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C                                  

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] maptools_0.7-20 foreign_0.8-29  sp_0.9-32       spatstat_1.15-0
[5] deldir_0.0-7    gpclib_1.4-3    mgcv_1.4-1.1

loaded via a namespace (and not attached):
[1] grid_2.8.1      lattice_0.17-17

Do you get any error messages? Does traceback() return anything?

This probably did not help, but if you could provide some more information, it 
would be nice. You could also start as.psp and abort it (ctrl+c) and run 
traceback to see if anything happened.

Best wishes 
Torleif

On Thursday 26 March 2009 04:33:05 pm Quentin LEMOULAND wrote:
> Hello,
>
> I have written a code that nead to convert SpatialLinesDataFrame to psp in
> order to use statstat functions.
>
> This functiun works well.
> The problem is that when the shapefile is to big (all the little rivers of
> a region for example: 3000), the as.psp function doesn't return anything
> and var2 is nothing:
>
> if (class(var)=="SpatialLinesDataFrame")
>
> {var at data<-data.frame(c(1:dim(var at data)[1]))
>
> var2<-as(var,"psp")}
>
> When I just select a few rivers (100), no problem.
>
> Does anyone know how to solve it?
>
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Torleif Markussen Lunde
Centre for International Health/
Bjernes Centre for Climate Research
University of Bergen, Norway


From prairie.picker at gmail.com  Fri Mar 27 00:03:15 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Thu, 26 Mar 2009 19:03:15 -0400
Subject: [R-sig-Geo] distmap of polylines
Message-ID: <9fb1ae890903261603x44867a2er3f13bc3a010670e3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090326/c999f12e/attachment.pl>

From prairie.picker at gmail.com  Fri Mar 27 00:48:05 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Thu, 26 Mar 2009 19:48:05 -0400
Subject: [R-sig-Geo] Search engine for R-sig-Geo archives??
Message-ID: <9fb1ae890903261648x75045a0fh19b6d949b6351808@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090326/cfd19475/attachment.pl>

From Roger.Bivand at nhh.no  Fri Mar 27 00:57:56 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 27 Mar 2009 00:57:56 +0100 (CET)
Subject: [R-sig-Geo] Search engine for R-sig-Geo archives??
In-Reply-To: <9fb1ae890903261648x75045a0fh19b6d949b6351808@mail.gmail.com>
References: <9fb1ae890903261648x75045a0fh19b6d949b6351808@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903270051380.5732@reclus.nhh.no>

On Thu, 26 Mar 2009, Tyler Dean Rudolph wrote:

> Am I missing something or is all the spatial-related R knowledge that is to
> be found in the R-sig-Geo forum not accessible by way of a simple search
> engine?  If not I would hope this to be forthcoming....  At present I am
> going through the archives one month at a time and it is simply not working!

Search with RSiteSearch() from the command line or the R Site Search link 
on the R and CRAN web pages. The search engine includes R-sig-geo traffic, 
thanks to its maintainer, Jonathan Baron.

Roger

>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From kjetil1001 at gmail.com  Fri Mar 27 01:03:37 2009
From: kjetil1001 at gmail.com (Kjetil Halvorsen)
Date: Thu, 26 Mar 2009 20:03:37 -0400
Subject: [R-sig-Geo] Search engine for R-sig-Geo archives??
In-Reply-To: <alpine.LRH.2.00.0903270051380.5732@reclus.nhh.no>
References: <9fb1ae890903261648x75045a0fh19b6d949b6351808@mail.gmail.com>
	<alpine.LRH.2.00.0903270051380.5732@reclus.nhh.no>
Message-ID: <1f6d6c820903261703h518704dbgfae3486464f42a11@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090326/b20c8783/attachment.pl>

From contact at dominikfuchs.com  Fri Mar 27 07:37:18 2009
From: contact at dominikfuchs.com (contact at dominikfuchs.com)
Date: Thu, 26 Mar 2009 23:37:18 -0700
Subject: [R-sig-Geo]
	=?utf-8?q?Search_engine_for_R-sig-Geo_archives=3F=3F?=
Message-ID: <20090326233718.0c0c2a9e5faeb1149988f23a38ef111a.9b72f68d84.wbe@email04.secureserver.net>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090326/1f68b74d/attachment.html>

From qlemouland at yahoo.fr  Fri Mar 27 09:55:06 2009
From: qlemouland at yahoo.fr (Quentin LEMOULAND)
Date: Fri, 27 Mar 2009 08:55:06 +0000 (GMT)
Subject: [R-sig-Geo] as.psp don't work for big shapefiles?
In-Reply-To: <200903262208.26028.torleif.lunde@cih.uib.no>
Message-ID: <283165.51578.qm@web24206.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090327/ee48c2ca/attachment.pl>

From p.hiemstra at geo.uu.nl  Fri Mar 27 11:26:14 2009
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Fri, 27 Mar 2009 11:26:14 +0100
Subject: [R-sig-Geo] Search engine for R-sig-Geo archives??
In-Reply-To: <9fb1ae890903261648x75045a0fh19b6d949b6351808@mail.gmail.com>
References: <9fb1ae890903261648x75045a0fh19b6d949b6351808@mail.gmail.com>
Message-ID: <49CCA9C6.2020303@geo.uu.nl>

Tyler Dean Rudolph schreef:
> Am I missing something or is all the spatial-related R knowledge that is to
> be found in the R-sig-Geo forum not accessible by way of a simple search
> engine?  If not I would hope this to be forthcoming....  At present I am
> going through the archives one month at a time and it is simply not working!
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
Hi,

Googling for "r-sig-geo your keywords" also works quite well.

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From wroberts at csir.co.za  Fri Mar 27 11:42:08 2009
From: wroberts at csir.co.za (Wesley Roberts)
Date: Fri, 27 Mar 2009 12:42:08 +0200
Subject: [R-sig-Geo] Search engine for R-sig-Geo archives??
Message-ID: <49CCC9A2020000730001A3C0@pta-emo.csir.co.za>

Hi Tyler,

I use the following (copy and paste into google search bar)

site:https://stat.ethz.ch/pipermail/r-sig-geo/ <my search subject>

This way google is restricted to that site only. You can actually use site:<your site of interest> <your search term> for any website. 

HTH
Wesley

>>> Paul Hiemstra <p.hiemstra at geo.uu.nl> 03/27/09 12:29 PM >>>
Tyler Dean Rudolph schreef:
> Am I missing something or is all the spatial-related R knowledge that is to
> be found in the R-sig-Geo forum not accessible by way of a simple search
> engine?  If not I would hope this to be forthcoming....  At present I am
> going through the archives one month at a time and it is simply not working!
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
Hi,

Googling for "r-sig-geo your keywords" also works quite well.

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
This message is subject to the CSIR's copyright terms and conditions, e-mail legal notice, and implemented Open Document Format (ODF) standard. 
The full disclaimer details can be found at http://www.csir.co.za/disclaimer.html.


and is believed to be clean.  MailScanner thanks Transtec Computers for their support.


From prairie.picker at gmail.com  Fri Mar 27 20:34:13 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Fri, 27 Mar 2009 15:34:13 -0400
Subject: [R-sig-Geo] distmap of polylines
Message-ID: <9fb1ae890903271234l50445764qd04182af54682ad8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090327/426dc68e/attachment.pl>

From elpata at yahoo.com.ar  Fri Mar 27 21:43:00 2009
From: elpata at yahoo.com.ar (Pata)
Date: Fri, 27 Mar 2009 17:43:00 -0300
Subject: [R-sig-Geo] surface area calculation
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAMicicJhyVVGlS398BlnQ3HCgAAAEAAAALsxQ/HW26hLs0ZHyFw40KgBAAAAAA==@yahoo.com.ar>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090327/f2b34222/attachment.pl>

From apineda at dataquick.com  Fri Mar 27 22:21:04 2009
From: apineda at dataquick.com (Adalberto Pineda)
Date: Fri, 27 Mar 2009 14:21:04 -0700
Subject: [R-sig-Geo] Converge problems with spgwr
Message-ID: <D53712A05C0B5F44A2F605AF7EB76EFB0117813B@sd1ex1.mscorp.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090327/6035e3d9/attachment.pl>

From prairie.picker at gmail.com  Sat Mar 28 01:38:13 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Fri, 27 Mar 2009 20:38:13 -0400
Subject: [R-sig-Geo] Issues importing BIG shapefile - Limitations of R or
	something else?
Message-ID: <9fb1ae890903271738x3d3c0fbct3767dc22b471662c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090327/6d3c3213/attachment.pl>

From Roger.Bivand at nhh.no  Sat Mar 28 13:04:15 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 28 Mar 2009 13:04:15 +0100 (CET)
Subject: [R-sig-Geo] Issues importing BIG shapefile - Limitations of R
 or something else?
In-Reply-To: <9fb1ae890903271738x3d3c0fbct3767dc22b471662c@mail.gmail.com>
References: <9fb1ae890903271738x3d3c0fbct3767dc22b471662c@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903281258030.13684@reclus.nhh.no>

On Fri, 27 Mar 2009, Tyler Dean Rudolph wrote:

> I have no trouble importing a subset of a road network for my study area as
> a shapefile into R, but when I try to import the complete network (area
> equivalent to approximately 30,000 km^2), I get the following error message
> (even when I split up the two class formats into two separate commands):
>
>> fullroads<-as(as(readShapeLines(fn="D:\\GIS\\roadnet.shp"),
> "SpatialLines"), "psp")
> *Error in function (classes, fdef, mtable)  :
>  unable to find an inherited method for function "coordinates", for
> signature "numeric"*
> **
> Is this due to the memory limitations of R, or to those of my particular
> machine, or to something else I'm missing?

It may be the file, it isn't memory (the error message would say so), and 
it is unlikely to be your machine. Please provide sessionInfo() and 
traceback() from immediately after the error. If the files in question can 
be made available as a zip archive on a website, this may allow others to 
try to debug the problem. We saw something like this with odd polygon 
geometries recently, but not with lines.

Roger

> The processes I am trying to
> model are happening at very "large" spatial scales and it would be a great
> deal more efficient if I could use the entire road network rather than
> dealing with multiple subsets of a greater image.  Importing as an ascii
> grid is not an option due to subsequent operations using distmap() which are
> based on the psp format.
>
> Tyler
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From corey.sparks at UTSA.EDU  Sat Mar 28 13:51:36 2009
From: corey.sparks at UTSA.EDU (Corey Sparks)
Date: Sat, 28 Mar 2009 07:51:36 -0500
Subject: [R-sig-Geo]  Converge problems with spgwr
Message-ID: <153E7745-A063-457A-B5A1-07F40DEBEDE5@utsa.edu>


The problems is that you are sending the bandwidth (percentage) to  
the wrong argument of gwr

try:
coords<-cbind(data$X_COORD, data$Y_COORD)
percentage<-gwr.sel(Y ~ X1 + X2, data = data, coords = coords,  
adapt=TRUE, longlat=TRUE)
adaptive.model<-gwr(Y ~ X1 + X2, data = data, coords = coords,  
adapt=TRUE, bandwidth=percentage, longlat=TRUE)

that should do the trick
Corey

I'm trying to fit an adaptive GWR model using the spgwr package but  
ran into some problems.
Specifically, what I'm trying to do is to plug the optimal percentage  
generated by the gwr.sel function into the gwr function.
This is my model's layout:

coords<-cbind(data$X_COORD, data$Y_COORD)
percentage<-gwr.sel(Y ~ X1 + X2, data = data, coords = coords,  
adapt=TRUE, longlat=TRUE)
adaptive.model<-gwr(Y ~ X1 + X2, data = data, coords = coords,  
adapt=percentage, longlat=TRUE)

But the gwr.sel function won't pass a value to the gwr function.  It  
seems that gwr.sel fails to converge.  It just stops without giving  
any error messages.
This is the output I've got:

Adaptive q: 0.381966 CV score: 4.635847e+14
Adaptive q: 0.618034 CV score: 4.969922e+14
Adaptive q: 0.236068 CV score: 4.256574e+14
Adaptive q: 0.1458980 CV score: 3.818798e+14
Adaptive q: 0.09016994 CV score: 3.386485e+14
Adaptive q: 0.05572809 CV score: 2.959508e+14
Adaptive q: 0.03444185 CV score: 2.516265e+14

Are there any known issues with the gwr.sel function?

Corey Sparks
Assistant Professor
Department of Demography and Organization Studies
College of Public Policy
One UTSA Circle
San Antonio, TX 78239
corey.sparks at utsa.edu


From Roger.Bivand at nhh.no  Sat Mar 28 16:48:53 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 28 Mar 2009 16:48:53 +0100 (CET)
Subject: [R-sig-Geo] Converge problems with spgwr
In-Reply-To: <153E7745-A063-457A-B5A1-07F40DEBEDE5@utsa.edu>
References: <153E7745-A063-457A-B5A1-07F40DEBEDE5@utsa.edu>
Message-ID: <alpine.LRH.2.00.0903281646480.14179@reclus.nhh.no>

On Sat, 28 Mar 2009, Corey Sparks wrote:

>
> The problems is that you are sending the bandwidth (percentage) to the wrong 
> argument of gwr
>
> try:
> coords<-cbind(data$X_COORD, data$Y_COORD)
> percentage<-gwr.sel(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE, 
> longlat=TRUE)
> adaptive.model<-gwr(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE, 
> bandwidth=percentage, longlat=TRUE)
>
> that should do the trick

In addition, the model does have a major scaling problem, as can be seen 
by the CVS scores. Consider re-scaling the variables in the model, and you 
may find that gwr.sel() has an easier time.

Roger

> Corey
>
> I'm trying to fit an adaptive GWR model using the spgwr package but ran into 
> some problems.
> Specifically, what I'm trying to do is to plug the optimal percentage 
> generated by the gwr.sel function into the gwr function.
> This is my model's layout:
>
> coords<-cbind(data$X_COORD, data$Y_COORD)
> percentage<-gwr.sel(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE, 
> longlat=TRUE)
> adaptive.model<-gwr(Y ~ X1 + X2, data = data, coords = coords, 
> adapt=percentage, longlat=TRUE)
>
> But the gwr.sel function won't pass a value to the gwr function.  It seems 
> that gwr.sel fails to converge.  It just stops without giving any error 
> messages.
> This is the output I've got:
>
> Adaptive q: 0.381966 CV score: 4.635847e+14
> Adaptive q: 0.618034 CV score: 4.969922e+14
> Adaptive q: 0.236068 CV score: 4.256574e+14
> Adaptive q: 0.1458980 CV score: 3.818798e+14
> Adaptive q: 0.09016994 CV score: 3.386485e+14
> Adaptive q: 0.05572809 CV score: 2.959508e+14
> Adaptive q: 0.03444185 CV score: 2.516265e+14
>
> Are there any known issues with the gwr.sel function?
>
> Corey Sparks
> Assistant Professor
> Department of Demography and Organization Studies
> College of Public Policy
> One UTSA Circle
> San Antonio, TX 78239
> corey.sparks at utsa.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From prairie.picker at gmail.com  Sat Mar 28 18:08:44 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Sat, 28 Mar 2009 13:08:44 -0400
Subject: [R-sig-Geo] Issues importing BIG shapefile - Limitations of R
	or something else?
Message-ID: <9fb1ae890903281008j5560e396o49b5e98c16e0dbc9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090328/2a99c30d/attachment.pl>

From milton.ruser at gmail.com  Sun Mar 29 06:43:35 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Sun, 29 Mar 2009 00:43:35 -0400
Subject: [R-sig-Geo] spgrass6 : diferent values from original
Message-ID: <3aaf1a030903282143iafbf520h2df56b0bc049326e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/3e42980f/attachment.pl>

From milton.ruser at gmail.com  Sun Mar 29 09:30:23 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Sun, 29 Mar 2009 03:30:23 -0400
Subject: [R-sig-Geo] spgrass6 : diferent values from original
In-Reply-To: <3aaf1a030903282143iafbf520h2df56b0bc049326e@mail.gmail.com>
References: <3aaf1a030903282143iafbf520h2df56b0bc049326e@mail.gmail.com>
Message-ID: <3aaf1a030903290030t3e07ea44w8da225d55a5be395@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/f550666c/attachment.pl>

From Roger.Bivand at nhh.no  Sun Mar 29 17:04:14 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 29 Mar 2009 17:04:14 +0200 (CEST)
Subject: [R-sig-Geo] spgrass6 : diferent values from original
In-Reply-To: <3aaf1a030903290030t3e07ea44w8da225d55a5be395@mail.gmail.com>
References: <3aaf1a030903282143iafbf520h2df56b0bc049326e@mail.gmail.com>
	<3aaf1a030903290030t3e07ea44w8da225d55a5be395@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903291653410.13822@reclus.nhh.no>

On Sun, 29 Mar 2009, milton ruser wrote:

> Checking the result on the readRAST6, I noticed that
> the number of bytes are 2, and I need 4 bits to store
> values greather than 32565, I suppose.
> --------------
>> mapa <- readRAST6(varint, cat=FALSE)
> Creating BIL support files...
> Header File =
> C:/Data/Tibagi/vegPR_probio_proatlan_abr2009/tibagi_Probio_grass_sdb_apr2009/newLocation/PERMANENT/.tmp/uso_tibagi_fundo_soflor_ero30m_dila030m_mata_clump.hdr
> World File =
> C:/Data/Tibagi/vegPR_probio_proatlan_abr2009/tibagi_Probio_grass_sdb_apr2009/newLocation/PERMANENT/.tmp/uso_tibagi_fundo_soflor_ero30m_dila030m_mata_clump.wld
> Exporting raster as integer values (bytes=2)
> Using the current region settings...
> --------------------
> But how can I chance the number of bytes, if it is not an
> argument on readRAST6?

Thanks for including your sessionInfo() in the preceding mail. If you are 
still using 0.5-10, you have no choice but to cast the data to floating 
point using r.mapcalc (add 0.0 should do it). There have been many changes 
in readRAST6() since that version, for example to use a GRASS GDAL plugin 
if available, and to use GDAL to read and write GTiff temporary files. The 
older route using r.out.bin only offers 2-byte integers, so was a reason 
for making more formats available.

So the answer in general is to update sp, spgrass6 and rgdal if you can. 
Since you in addition on Windows, and probably using the Native Windows 
version, until a new release you will hit a snag that more recent GRASS 
r.out.gdal have a -c flag which is not in your release - here you can wait 
for the next release, and use the trick of casting to floating point until 
then.

Roger

> Best wishes
>
> miltinho
>
>
> On Sun, Mar 29, 2009 at 12:43 AM, milton ruser <milton.ruser at gmail.com>wrote:
>
>> Hi there,
>>
>> I have a set of maps on GRASS 6.5 and I need to compute some basic stats
>> on R 2.7.1. For some maps I get the desired results, but for other I am
>> getting different values. My raster are integer values >= 1 (with some NAs
>> where not mapped).
>>
>> I start R from GRASS session without problem, and can read the rasters
>> on R:
>>
>> require(spgrass6)
>> varint<-"uso_tibagi_fundo_soflor_ero30m_dila030m_mata_clump_AreaHA"
>> mapa <- readRAST6(varint, cat=FALSE)
>> mapa.valores<-mapa at data[1]
>> mapa.valores<-mapa.valores[!is.na(mapa.valores)]
>> quantile(mapa.valores, probs=c(0.20,0.40,0.60,0.80))
>> summary(mapa.valores)
>> rm(mapa, mapa.valores,varint)
>> But for one of my map I get different range of value between R and GRASS
>> ON GRASS - r.univar
>> n: 8336636
>> minimum: 1
>> maximum: 303396
>> range: 303395
>> mean: 125949
>>
>> ON R
>>> summary(mapa at data[1])
>>  uso_tibagi_fundo_soflor_dila030m_clump_mata_limpa_AreaHA
>>  Min.   :  -24284
>>  1st Qu.:  -24284
>>  Median :      31
>>  Mean   :   -6551
>>  3rd Qu.:    2225
>>  Max.   :   27846
>>  NA's   :59217475
>>
>> -----> sessionInfo()
>> R version 2.7.1 (2008-06-23)
>> i386-pc-mingw32
>> locale:
>>
>> LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=English_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> other attached packages:
>> [1] spgrass6_0.5-10 rgdal_0.5-25    sp_0.9-26
>> loaded via a namespace (and not attached):
>> [1] grid_2.7.1     lattice_0.17-8
>> Any help are welcome.
>>
>> Regards
>>
>> miltinho
>> Toronto, CA
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sun Mar 29 17:21:53 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 29 Mar 2009 17:21:53 +0200 (CEST)
Subject: [R-sig-Geo] Issues importing BIG shapefile - Limitations of R
 or something else?
In-Reply-To: <9fb1ae890903281008j5560e396o49b5e98c16e0dbc9@mail.gmail.com>
References: <9fb1ae890903281008j5560e396o49b5e98c16e0dbc9@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903291714410.13822@reclus.nhh.no>

On Sat, 28 Mar 2009, Tyler Dean Rudolph wrote:

> Here are the sessionInfo() and traceback() results following the failed
> import.  It looks like I am not using the most recent version of sp so I am
> trying to figure out the terms in the call to update.package() and with the
> most recent version I will try again.

Thanks! The indications are that coordinates is being passed a numeric 
vector, not a matrix, at:

Line(coords = shape$verts[from[i]:to[i], ])

so if from[i] == to[i], the code as shown converts a single coordinate 
(one row) matrix into a numeric vector (omitted drop=FALSE in "[" method, 
perhaps the most common coding error in S/R).

That is fixable, but a better workaround may be to use readOGR() in rgdal 
rather than readShapeLines() in maptools.

Roger

> The .shp file is ~30 megabytes and
> the associated .dbf is ~15 megabytes, though I don't think the latter is
> included in the import.  I have 2G of memory on this machine....
>
> Tyler
>
> **
> *> roads<-as(as(readShapeLines(fn="D:\\GIS\\road2004.shp"), "SpatialLines"),
> "psp")
> *Error in function (classes, fdef, mtable)  :
>  unable to find an inherited method for function "coordinates", for
> signature "numeric"
>
> *> sessionInfo()*
> R version 2.8.1 (2008-12-22)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=English_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252
>
> attached base packages:
> [1] stats     graphics  grDevices datasets  utils     methods   base
>
> other attached packages:
> [1] spatstat_1.15-0 deldir_0.0-7    gpclib_1.4-3    mgcv_1.4-1.1
> maptools_0.7-20 foreign_0.8-29  sp_0.9-29
> loaded via a namespace (and not attached):
> [1] grid_2.8.1      lattice_0.17-17 tools_2.8.1
>
> *> traceback()*
> 13: stop("unable to find an inherited method for function \"", fdef at generic,
>
>        "\", for signature ", cnames)
> 12: function (classes, fdef, mtable)
>    {
>        methods <- .findInheritedMethods(classes, fdef, mtable)
>        if (length(methods) == 1)
>            return(methods[[1]])
>        else if (length(methods) == 0) {
>            cnames <- paste("\"", sapply(classes, as.character),
>                "\"", sep = "", collapse = ", ")
>            stop("unable to find an inherited method for function \"",
>                fdef at generic, "\", for signature ", cnames)
>        }
>        else stop("Internal error in finding inherited methods; didn't
> return a unique method")
>    }(list("numeric"), function (obj)
>    standardGeneric("coordinates"), <environment>)
> 11: coordinates(coords)
> 10: Line(coords = shape$verts[from[i]:to[i], ])
> 9: .shapes2LinesList(shapes[[i]], ID = IDs[i])
> 8: .shp2LinesDF(Map, proj4string = proj4string)
> 7: withCallingHandlers(expr, warning = function(w)
> invokeRestart("muffleWarning"))
> 6: suppressWarnings(.shp2LinesDF(Map, proj4string = proj4string))
> 5: readShapeLines(fn = "D:\\GIS\\road2004.shp")
> 4: .class1(object)
> 3: as(readShapeLines(fn = "D:\\GIS\\road2004.shp"), "SpatialLines")
> 2: .class1(object)
> 1: as(as(readShapeLines(fn = "D:\\GIS\\road2004.shp"), "SpatialLines"),
>       "psp")
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gianni.lavaredo at gmail.com  Sun Mar 29 18:54:31 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Sun, 29 Mar 2009 18:54:31 +0200
Subject: [R-sig-Geo] help to find this function
Message-ID: <518dff330903290954n2d98aeb2paaff7177717cb0b9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/5661fcef/attachment.pl>

From ba208 at exeter.ac.uk  Sun Mar 29 19:16:17 2009
From: ba208 at exeter.ac.uk (baptiste auguie)
Date: Sun, 29 Mar 2009 18:16:17 +0100
Subject: [R-sig-Geo] help to find this function
In-Reply-To: <518dff330903290954n2d98aeb2paaff7177717cb0b9@mail.gmail.com>
References: <518dff330903290954n2d98aeb2paaff7177717cb0b9@mail.gmail.com>
Message-ID: <59D26585-FFE3-49FF-8DA2-FF5C951EDD82@exeter.ac.uk>

Hi,

could you provide an example for the data in "sample"?  (incidentally,  
note that sample is already the name of a built-in function)

I'm guessing you could do something like,

>
> library(doBy)
> summaryBy(count~ID, data= count_myData, FUN=sum)

tested with,

count_myData <- data.frame(ID=rep(c(1:4),each=4),  
count=abs(ceiling(rnorm(16,8,4))))


hope this helps,

baptiste

On 29 Mar 2009, at 17:54, gianni lavaredo wrote:

> Dear R user,
>
> Thanks for this sunday attention about my problem. I have a  
> data.frame like
> this example:
>
> count_myData
>
> ID: 1,1,1,1,2,2,2,3,3,3,3,3,4,4,4,4,4,4
> count: 4,4,4,4,3,3,3,5,5,5,5,5,6,6,6,6,6,6
>
> this data.frame derived from this code
>
> count_myData <- ddply(sample, .(ID), transform, sum = sum(Z >=0,  
> na.rm = T))
>
> with this I have the number of sample inside of area with ID 1, ID 2  
> ID 3
> etc etc.
> Now I need a data.frame like this
>
> new_myData
> ID:1,2,3,4
> count:4,3,5,6
>
> Thanks Gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_____________________________

Baptiste Augui?

School of Physics
University of Exeter
Stocker Road,
Exeter, Devon,
EX4 4QL, UK

Phone: +44 1392 264187

http://newton.ex.ac.uk/research/emag


From gianni.lavaredo at gmail.com  Sun Mar 29 19:28:22 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Sun, 29 Mar 2009 19:28:22 +0200
Subject: [R-sig-Geo] help to find this function
In-Reply-To: <59D26585-FFE3-49FF-8DA2-FF5C951EDD82@exeter.ac.uk>
References: <518dff330903290954n2d98aeb2paaff7177717cb0b9@mail.gmail.com>
	<59D26585-FFE3-49FF-8DA2-FF5C951EDD82@exeter.ac.uk>
Message-ID: <518dff330903291028s1505b9f3h6179c367b0d563b2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/f4619dc5/attachment.pl>

From ba208 at exeter.ac.uk  Sun Mar 29 20:24:58 2009
From: ba208 at exeter.ac.uk (baptiste auguie)
Date: Sun, 29 Mar 2009 19:24:58 +0100
Subject: [R-sig-Geo] help to find this function
In-Reply-To: <518dff330903291028s1505b9f3h6179c367b0d563b2@mail.gmail.com>
References: <518dff330903290954n2d98aeb2paaff7177717cb0b9@mail.gmail.com>
	<59D26585-FFE3-49FF-8DA2-FF5C951EDD82@exeter.ac.uk>
	<518dff330903291028s1505b9f3h6179c367b0d563b2@mail.gmail.com>
Message-ID: <E79BD590-881F-4A6D-A8B5-0E7367AC179D@exeter.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/a54e5ea9/attachment.pl>

From prairie.picker at gmail.com  Sun Mar 29 22:46:38 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Sun, 29 Mar 2009 16:46:38 -0400
Subject: [R-sig-Geo] Issues importing BIG shapefile - Limitations of R
	or something else?
In-Reply-To: <alpine.LRH.2.00.0903291714410.13822@reclus.nhh.no>
References: <9fb1ae890903281008j5560e396o49b5e98c16e0dbc9@mail.gmail.com>
	<alpine.LRH.2.00.0903291714410.13822@reclus.nhh.no>
Message-ID: <9fb1ae890903291346n4a4419edx5e94930e5bb281df@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/8c94947f/attachment.pl>

From prairie.picker at gmail.com  Sun Mar 29 22:58:01 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Sun, 29 Mar 2009 16:58:01 -0400
Subject: [R-sig-Geo] Generate lines using start and end coordinates
Message-ID: <9fb1ae890903291358i4fabe43cw7a72e9f6f27653f0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/db13e4e0/attachment.pl>

From Adrian.Baddeley at csiro.au  Mon Mar 30 04:08:02 2009
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Mon, 30 Mar 2009 10:08:02 +0800
Subject: [R-sig-Geo]  as.psp doesn't work for big shapefiles?
Message-ID: <57DC18C299094D4299F837570C5DF1C50293EAB556@EXWA-MBX01.nexus.csiro.au>

Quentin LEMOULAND <qlemouland at yahoo.fr> writes:

> The problem is that when the shapefile is too big (all the little rivers of a region for example: 3000), 
> the as.psp function doesn't return anything 

Under spatstat 1.15-0 and maptools 0.7-16 there is a bottleneck which causes 'as.psp.SpatialLines' to become very slow when executed on a large shapefile. However, I would still expect it to return the correct value eventually, if it is allowed to keep running. 

The bottleneck will be fixed in spatstat 1.15-1.

Adrian Baddeley

From milton.ruser at gmail.com  Mon Mar 30 05:07:57 2009
From: milton.ruser at gmail.com (milton ruser)
Date: Sun, 29 Mar 2009 23:07:57 -0400
Subject: [R-sig-Geo] spgrass6 : diferent values from original
In-Reply-To: <alpine.LRH.2.00.0903291653410.13822@reclus.nhh.no>
References: <3aaf1a030903282143iafbf520h2df56b0bc049326e@mail.gmail.com>
	<3aaf1a030903290030t3e07ea44w8da225d55a5be395@mail.gmail.com>
	<alpine.LRH.2.00.0903291653410.13822@reclus.nhh.no>
Message-ID: <3aaf1a030903292007o206a917eudc8680360fd443b9@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/f22c5e48/attachment.pl>

From prairie.picker at gmail.com  Mon Mar 30 05:48:31 2009
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Sun, 29 Mar 2009 23:48:31 -0400
Subject: [R-sig-Geo] Issues importing BIG shapefile - Limitations of R
	or something else?
In-Reply-To: <alpine.LRH.2.00.0903281258030.13684@reclus.nhh.no>
References: <9fb1ae890903271738x3d3c0fbct3767dc22b471662c@mail.gmail.com>
	<alpine.LRH.2.00.0903281258030.13684@reclus.nhh.no>
Message-ID: <9fb1ae890903292048p2c5f2aabm701dbc224c9d7c25@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090329/7a1a8f04/attachment.pl>

From Roger.Bivand at nhh.no  Mon Mar 30 09:48:13 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Mar 2009 09:48:13 +0200 (CEST)
Subject: [R-sig-Geo] Issues importing BIG shapefile - Limitations of R
 or something else?
In-Reply-To: <9fb1ae890903291346n4a4419edx5e94930e5bb281df@mail.gmail.com>
References: <9fb1ae890903281008j5560e396o49b5e98c16e0dbc9@mail.gmail.com>
	<alpine.LRH.2.00.0903291714410.13822@reclus.nhh.no>
	<9fb1ae890903291346n4a4419edx5e94930e5bb281df@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903300935300.19575@reclus.nhh.no>

On Sun, 29 Mar 2009, Tyler Dean Rudolph wrote:

> As you've indicated Roger there does appear to be an error in
> readShapeLines() under maptools.  However I can't help but wonder why I do
> not have any problems using the same command sequence for a subset of
> the same data (even after updating my version of sp)...?  With said subset I
> am able to import and convert the .shp file to a SpatialLinesDataFrame
> object and then (end result) a psp object.  This latter transformation is
> critical in order to produce the type of output I am trying to model using
> distmap().
>
> Now via the alternate path, readOGR() successfully imported the spatial
> lines polygon (full coverage) as a SpatialLinesDataFrame object;
> **
> *> roads<-readOGR("D:/GIS", layer="road2004")*
> OGR data source with driver: ESRI Shapefile
> Source: "D:/GIS", layer: "road2004"
> with  51218  rows and  4  columns
> Feature type: wkbLineString with 2 dimensions
> However from this point when I try to convert it to a psp object it fails:

Tyler:

Thanks again for a full report. The failure in readShapeLines() was caused 
by a line with only a single coordinate (two, in fact). This isn't a 
problem in the readOGR() code, and will not be in the latest release of 
maptools.

In spatstat, if spatstat.options("checkpolygons") is TRUE, (xrange[2] < 
xrange[1]) and (yrange[2] < yrange[1]) are both expected to hold, and 
cannot, because for single coordinate lines, the min and max are equal.

You have two choices - based on the files you made available, either drop 
the two single coordinate lines:

ncrds <- sapply(slot(roads, "lines"), function(x) sapply(slot(x, "Lines"),
   function(y) nrow(slot(y, "coords"))))
summary(unlist(wh_singleton))
keep <- sapply(ncrds, function(x) all(x > 1))
roads_gt_1 <- roads[keep]
length(slot(roads, "lines"))
length(slot(roads_gt_1, "lines"))
test <- as(roads_gt_1, "psp")

or set checkpolygons to FALSE in spatstat.options(). I'm running the 
former at the moment - deleting the SpatialLinesDataFrame object after 
coercing to SpatialLines would save some memory.

Hope this helps,

Roger

>
> ** *> test<-as(roads, "psp")*
> Error in owin(xr, yr, poly = list(x = xr[c(1, 2, 2, 1)], y = yr[c(1, 1,  :
>  xrange should be a vector of length 2 giving (xmin, xmax)
>
> Here I will provide similar information as before, in hopes that we might be
> able to shed light on the issue, which appears to involve the window
> being used to spatially frame the data:
>
> *> sessionInfo()*
> R version 2.8.1 (2008-12-22)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=English_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252
>
> attached base packages:
> [1] stats     graphics  grDevices datasets  utils     methods   base
>
> other attached packages:
> [1] rgdal_0.6-7     spatstat_1.15-0 deldir_0.0-7    gpclib_1.4-3
> mgcv_1.4-1.1    maptools_0.7-20 sp_0.9-32       foreign_0.8-29
> loaded via a namespace (and not attached):
> [1] grid_2.8.1      lattice_0.17-17 nlme_3.1-89     tools_2.8.1
>
> *> traceback()
> *14: stop("xrange should be a vector of length 2 giving (xmin, xmax)")
> 13: owin(xr, yr, poly = list(x = xr[c(1, 2, 2, 1)], y = yr[c(1, 1,
>        2, 2)]), unitname = unitname(W))
> 12: switch(W$type, rectangle = {
>        xr <- W$xrange
>        yr <- W$yrange
>        return(owin(xr, yr, poly = list(x = xr[c(1, 2, 2, 1)], y = yr[c(1,
>            1, 2, 2)]), unitname = unitname(W)))
>    }, polygonal = {
>        return(W)
>    }, mask = {
>        stop("A mask cannot be converted to a polygon")
>    })
> 11: as.polygonal(x)
> 10: owin2gpc(B)
> 9: union.owin(W, Wlist[[i]])
> 8: superimposePSP(y, window = window)
> 7: FUN(X[[24798L]], ...)
> 6: lapply(lin, as.psp.Lines)
> 5: as.psp.SpatialLines(y, window = window, marks = marks)
> 4: as.psp(y, window = window, marks = marks)
> 3: as.psp.SpatialLinesDataFrame(from)
> 2: asMethod(object)
> 1: as(roads, "psp")
>
> Why does this error occur now when it works fine for a subset of the same
> data?  Is there a fix that could help with this problem?
> Tyler
>
>
>
> On Sun, Mar 29, 2009 at 11:21 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Sat, 28 Mar 2009, Tyler Dean Rudolph wrote:
>>
>> Here are the sessionInfo() and traceback() results following the failed
>>> import.  It looks like I am not using the most recent version of sp so I
>>> am
>>> trying to figure out the terms in the call to update.package() and with
>>> the
>>> most recent version I will try again.
>>>
>>
>> Thanks! The indications are that coordinates is being passed a numeric
>> vector, not a matrix, at:
>>
>> Line(coords = shape$verts[from[i]:to[i], ])
>>
>> so if from[i] == to[i], the code as shown converts a single coordinate (one
>> row) matrix into a numeric vector (omitted drop=FALSE in "[" method, perhaps
>> the most common coding error in S/R).
>>
>> That is fixable, but a better workaround may be to use readOGR() in rgdal
>> rather than readShapeLines() in maptools.
>>
>> Roger
>>
>>   The .shp file is ~30 megabytes and
>>> the associated .dbf is ~15 megabytes, though I don't think the latter is
>>> included in the import.  I have 2G of memory on this machine....
>>>
>>> Tyler
>>>
>>> **
>>> *> roads<-as(as(readShapeLines(fn="D:\\GIS\\road2004.shp"),
>>> "SpatialLines"),
>>> "psp")
>>> *Error in function (classes, fdef, mtable)  :
>>>  unable to find an inherited method for function "coordinates", for
>>> signature "numeric"
>>>
>>> *> sessionInfo()*
>>> R version 2.8.1 (2008-12-22)
>>> i386-pc-mingw32
>>>
>>> locale:
>>>
>>> LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=English_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices datasets  utils     methods   base
>>>
>>> other attached packages:
>>> [1] spatstat_1.15-0 deldir_0.0-7    gpclib_1.4-3    mgcv_1.4-1.1
>>> maptools_0.7-20 foreign_0.8-29  sp_0.9-29
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.8.1      lattice_0.17-17 tools_2.8.1
>>>
>>> *> traceback()*
>>> 13: stop("unable to find an inherited method for function \"",
>>> fdef at generic,
>>>
>>>       "\", for signature ", cnames)
>>> 12: function (classes, fdef, mtable)
>>>   {
>>>       methods <- .findInheritedMethods(classes, fdef, mtable)
>>>       if (length(methods) == 1)
>>>           return(methods[[1]])
>>>       else if (length(methods) == 0) {
>>>           cnames <- paste("\"", sapply(classes, as.character),
>>>               "\"", sep = "", collapse = ", ")
>>>           stop("unable to find an inherited method for function \"",
>>>               fdef at generic, "\", for signature ", cnames)
>>>       }
>>>       else stop("Internal error in finding inherited methods; didn't
>>> return a unique method")
>>>   }(list("numeric"), function (obj)
>>>   standardGeneric("coordinates"), <environment>)
>>> 11: coordinates(coords)
>>> 10: Line(coords = shape$verts[from[i]:to[i], ])
>>> 9: .shapes2LinesList(shapes[[i]], ID = IDs[i])
>>> 8: .shp2LinesDF(Map, proj4string = proj4string)
>>> 7: withCallingHandlers(expr, warning = function(w)
>>> invokeRestart("muffleWarning"))
>>> 6: suppressWarnings(.shp2LinesDF(Map, proj4string = proj4string))
>>> 5: readShapeLines(fn = "D:\\GIS\\road2004.shp")
>>> 4: .class1(object)
>>> 3: as(readShapeLines(fn = "D:\\GIS\\road2004.shp"), "SpatialLines")
>>> 2: .class1(object)
>>> 1: as(as(readShapeLines(fn = "D:\\GIS\\road2004.shp"), "SpatialLines"),
>>>      "psp")
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gianni.lavaredo at gmail.com  Mon Mar 30 15:15:13 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 30 Mar 2009 15:15:13 +0200
Subject: [R-sig-Geo] import ASCII file via RGDAL to SpatialPixelsDataFrame'
Message-ID: <518dff330903300615i54bd71cbk35d8502dc34f7bf1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090330/80fb383c/attachment.pl>

From Roger.Bivand at nhh.no  Mon Mar 30 15:50:56 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Mar 2009 15:50:56 +0200 (CEST)
Subject: [R-sig-Geo] import ASCII file via RGDAL to
 SpatialPixelsDataFrame'
In-Reply-To: <518dff330903300615i54bd71cbk35d8502dc34f7bf1@mail.gmail.com>
References: <518dff330903300615i54bd71cbk35d8502dc34f7bf1@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903301546180.23388@reclus.nhh.no>

On Mon, 30 Mar 2009, gianni lavaredo wrote:

> Dear R user,
>
> I have an ascii file (It's a raster in Arcmap) and I wish to import in R
> to do some analisys. I am using like help
>
> Zone_2644149 = readGDAL("Zone_2644149.asc")$band1
> Zone_2644149.asc has GDAL driver AAIGrid
> and has 246 rows and 381 columns
>
> str(Zone_2644149)
> num [1:93726] 35.1 34.7 35.2 35.9 31.2 ...

What about:

Zone_2644149 <- readGDAL("Zone_2644149.asc")
# to get a SpatialGridDataFrame (I think with a single band only for this 
# format; selecting $band1 just returns the data in band1
fullgrid(Zone_2644149) <- FALSE
# to drop the cells with NA to get a SpatialPixelsDataFrame
# or Zone_2644149 <- as(Zone_2644149, "SpatialPixelsDataFrame")

If you say summary(Zone_2644149) first, you can check whether coercing 
from SpatialGrid to SpatialPixels is justified by the number of NAs in 
band1.

Hope this helps,

Roger

>
> but I need to have a SpatialPixelsDataFrame but SORRY I haven't idea how to
> import as SpatialPixelsDataFrame
>
> thanks Gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Mon Mar 30 15:58:09 2009
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 30 Mar 2009 15:58:09 +0200
Subject: [R-sig-Geo] import ASCII file via RGDAL to
	SpatialPixelsDataFrame'
In-Reply-To: <518dff330903300615i54bd71cbk35d8502dc34f7bf1@mail.gmail.com>
References: <518dff330903300615i54bd71cbk35d8502dc34f7bf1@mail.gmail.com>
Message-ID: <49D0CFF1.5010904@uni-muenster.de>

Try:

Zone_2644149 = readGDAL("Zone_2644149.asc")


This returns a SpatialGridDataFrame.Then:

fullgrid(Zone_2644149) = FALSE

converts into a SpatialPixelsDataFrame, or, in a single command:

Zone_2644149 = as(readGDAL("Zone_2644149.asc"), "SpatialPixelsDataFrame")

--
Edzer


gianni lavaredo wrote:
> Dear R user,
>
> I have an ascii file (It's a raster in Arcmap) and I wish to import in R
> to do some analisys. I am using like help
>
> Zone_2644149 = readGDAL("Zone_2644149.asc")$band1
> Zone_2644149.asc has GDAL driver AAIGrid
> and has 246 rows and 381 columns
>
> str(Zone_2644149)
>  num [1:93726] 35.1 34.7 35.2 35.9 31.2 ...
>
> but I need to have a SpatialPixelsDataFrame but SORRY I haven't idea how to
> import as SpatialPixelsDataFrame
>
> thanks Gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de/
http://www.springer.com/978-0-387-78170-9 e.pebesma at wwu.de


From Paul.Satterthwaite at oregonstate.edu  Mon Mar 30 17:38:12 2009
From: Paul.Satterthwaite at oregonstate.edu (Satterthwaite, Paul)
Date: Mon, 30 Mar 2009 08:38:12 -0700
Subject: [R-sig-Geo] question about spatial bootstrapping
Message-ID: <D7B94F0B40246740A3EFF9DBBD921B7BB89BC5@SAGE.forestry.oregonstate.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090330/e14558e2/attachment.pl>

From gianni.lavaredo at gmail.com  Mon Mar 30 18:41:39 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 30 Mar 2009 18:41:39 +0200
Subject: [R-sig-Geo] dissolve boundaries between adjacent polygon in R
Message-ID: <518dff330903300941v150bf55bu83a22e198c43fe2c@mail.gmail.com>

Thanks for help It's very important for me,

I imported two grids in R and with RSAGA I classified the grids in two
new 0-1 value grids. Always in RSAGA I created two polygon shape file (one
for the grid A one for the grid B) and I intersected to obtain a new polygon
shape-file. The problem is on the edge because I need to dissolve the
boundaries between adjacent polygons. I attached a very small polygon
problem to understand better the question.

Thanks Gianni
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090330/bdd3acab/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sample.zip
Type: application/zip
Size: 913 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090330/bdd3acab/attachment.zip>

From apineda at dataquick.com  Mon Mar 30 19:51:21 2009
From: apineda at dataquick.com (Adalberto Pineda)
Date: Mon, 30 Mar 2009 10:51:21 -0700
Subject: [R-sig-Geo] Convergence problems with spgwr
In-Reply-To: <alpine.LRH.2.00.0903281646480.14179@reclus.nhh.no>
Message-ID: <D53712A05C0B5F44A2F605AF7EB76EFB01178142@sd1ex1.mscorp.com>

Thank you for your replies but it's my understanding that (for an adaptive model) the percentage 
should be entered at the "adapt" argument (based on the spgwr package manual and Roger's reply 
to this posting: https://stat.ethz.ch/pipermail/r-sig-geo/2005-August/000535.html). 
  
Also, the gwr function won't run on my data if I try bandwith = percentage.
This is the error I get:
"Error in print.gwr(list(SDF = <S4 object of class "SpatialPointsDataFrame">,  : 
  subscript out of bounds"

Could you confirm me on this?

-- Adalberto.


Adalberto Pineda
Data Analytics Specialist
MDA Dataquick
9620 Towne Centre Dr.
San Diego, CA. 92121.



-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
Sent: Saturday, March 28, 2009 8:49 AM
To: Corey Sparks
Cc: Adalberto Pineda; r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Converge problems with spgwr


On Sat, 28 Mar 2009, Corey Sparks wrote:

>
> The problems is that you are sending the bandwidth (percentage) to the wrong 
> argument of gwr
>
> try:
> coords<-cbind(data$X_COORD, data$Y_COORD)
> percentage<-gwr.sel(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE, 
> longlat=TRUE)
> adaptive.model<-gwr(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE, 
> bandwidth=percentage, longlat=TRUE)
>
> that should do the trick

In addition, the model does have a major scaling problem, as can be seen 
by the CVS scores. Consider re-scaling the variables in the model, and you 
may find that gwr.sel() has an easier time.

Roger

> Corey
>
> I'm trying to fit an adaptive GWR model using the spgwr package but ran into 
> some problems.
> Specifically, what I'm trying to do is to plug the optimal percentage 
> generated by the gwr.sel function into the gwr function.
> This is my model's layout:
>
> coords<-cbind(data$X_COORD, data$Y_COORD)
> percentage<-gwr.sel(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE, 
> longlat=TRUE)
> adaptive.model<-gwr(Y ~ X1 + X2, data = data, coords = coords, 
> adapt=percentage, longlat=TRUE)
>
> But the gwr.sel function won't pass a value to the gwr function.  It seems 
> that gwr.sel fails to converge.  It just stops without giving any error 
> messages.
> This is the output I've got:
>
> Adaptive q: 0.381966 CV score: 4.635847e+14
> Adaptive q: 0.618034 CV score: 4.969922e+14
> Adaptive q: 0.236068 CV score: 4.256574e+14
> Adaptive q: 0.1458980 CV score: 3.818798e+14
> Adaptive q: 0.09016994 CV score: 3.386485e+14
> Adaptive q: 0.05572809 CV score: 2.959508e+14
> Adaptive q: 0.03444185 CV score: 2.516265e+14
>
> Are there any known issues with the gwr.sel function?
>
> Corey Sparks
> Assistant Professor
> Department of Demography and Organization Studies
> College of Public Policy
> One UTSA Circle
> San Antonio, TX 78239
> corey.sparks at utsa.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


This message contains confidential information and is in...{{dropped:5}}


From Roger.Bivand at nhh.no  Mon Mar 30 20:00:41 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Mar 2009 20:00:41 +0200 (CEST)
Subject: [R-sig-Geo] Convergence problems with spgwr
In-Reply-To: <D53712A05C0B5F44A2F605AF7EB76EFB01178142@sd1ex1.mscorp.com>
References: <D53712A05C0B5F44A2F605AF7EB76EFB01178142@sd1ex1.mscorp.com>
Message-ID: <alpine.LRH.2.00.0903301958480.23898@reclus.nhh.no>

On Mon, 30 Mar 2009, Adalberto Pineda wrote:

> Thank you for your replies but it's my understanding that (for an adaptive model) the percentage
> should be entered at the "adapt" argument (based on the spgwr package manual and Roger's reply
> to this posting: https://stat.ethz.ch/pipermail/r-sig-geo/2005-August/000535.html).
>
> Also, the gwr function won't run on my data if I try bandwith = percentage.
> This is the error I get:
> "Error in print.gwr(list(SDF = <S4 object of class "SpatialPointsDataFrame">,  :
>  subscript out of bounds"
>
> Could you confirm me on this?

Until you can make gwr.sel() work, this is irrelevant. Please rescale your 
model until such time that gwr.sel() does converge, then read the gwr() 
help page properly - that (and the code) is the confirmation. First get 
rid of the 1e14 CVS scores!

Roger

>
> -- Adalberto.
>
>
> Adalberto Pineda
> Data Analytics Specialist
> MDA Dataquick
> 9620 Towne Centre Dr.
> San Diego, CA. 92121.
>
>
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Saturday, March 28, 2009 8:49 AM
> To: Corey Sparks
> Cc: Adalberto Pineda; r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Converge problems with spgwr
>
>
> On Sat, 28 Mar 2009, Corey Sparks wrote:
>
>>
>> The problems is that you are sending the bandwidth (percentage) to the wrong
>> argument of gwr
>>
>> try:
>> coords<-cbind(data$X_COORD, data$Y_COORD)
>> percentage<-gwr.sel(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE,
>> longlat=TRUE)
>> adaptive.model<-gwr(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE,
>> bandwidth=percentage, longlat=TRUE)
>>
>> that should do the trick
>
> In addition, the model does have a major scaling problem, as can be seen
> by the CVS scores. Consider re-scaling the variables in the model, and you
> may find that gwr.sel() has an easier time.
>
> Roger
>
>> Corey
>>
>> I'm trying to fit an adaptive GWR model using the spgwr package but ran into
>> some problems.
>> Specifically, what I'm trying to do is to plug the optimal percentage
>> generated by the gwr.sel function into the gwr function.
>> This is my model's layout:
>>
>> coords<-cbind(data$X_COORD, data$Y_COORD)
>> percentage<-gwr.sel(Y ~ X1 + X2, data = data, coords = coords, adapt=TRUE,
>> longlat=TRUE)
>> adaptive.model<-gwr(Y ~ X1 + X2, data = data, coords = coords,
>> adapt=percentage, longlat=TRUE)
>>
>> But the gwr.sel function won't pass a value to the gwr function.  It seems
>> that gwr.sel fails to converge.  It just stops without giving any error
>> messages.
>> This is the output I've got:
>>
>> Adaptive q: 0.381966 CV score: 4.635847e+14
>> Adaptive q: 0.618034 CV score: 4.969922e+14
>> Adaptive q: 0.236068 CV score: 4.256574e+14
>> Adaptive q: 0.1458980 CV score: 3.818798e+14
>> Adaptive q: 0.09016994 CV score: 3.386485e+14
>> Adaptive q: 0.05572809 CV score: 2.959508e+14
>> Adaptive q: 0.03444185 CV score: 2.516265e+14
>>
>> Are there any known issues with the gwr.sel function?
>>
>> Corey Sparks
>> Assistant Professor
>> Department of Demography and Organization Studies
>> College of Public Policy
>> One UTSA Circle
>> San Antonio, TX 78239
>> corey.sparks at utsa.edu
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From donal.bisanzio at unito.it  Mon Mar 30 20:04:28 2009
From: donal.bisanzio at unito.it (Donal Bisanzio)
Date: Mon, 30 Mar 2009 20:04:28 +0200
Subject: [R-sig-Geo] spatio-temporal cluster: R package
In-Reply-To: <ba95c4b80903301030x270b2030n13d4e4b1efeabf0b@mail.gmail.com>
References: <mailman.8167.1238164810.4476.r-sig-geo@stat.math.ethz.ch>
	<ba95c4b80903301030x270b2030n13d4e4b1efeabf0b@mail.gmail.com>
Message-ID: <ba95c4b80903301104i58efbb81rd37a8a07d34ab72e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090330/e7d5cbe1/attachment.pl>

From moliver at udel.edu  Mon Mar 30 20:16:02 2009
From: moliver at udel.edu (Matt Oliver)
Date: Mon, 30 Mar 2009 14:16:02 -0400
Subject: [R-sig-Geo] spatio-temporal cluster: R package
In-Reply-To: <ba95c4b80903301104i58efbb81rd37a8a07d34ab72e@mail.gmail.com>
References: <mailman.8167.1238164810.4476.r-sig-geo@stat.math.ethz.ch>
	<ba95c4b80903301030x270b2030n13d4e4b1efeabf0b@mail.gmail.com>
	<ba95c4b80903301104i58efbb81rd37a8a07d34ab72e@mail.gmail.com>
Message-ID: <6d4aad460903301116t6d8d9ee9wd858a5d4ccc5fd82@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090330/595a0579/attachment.pl>

From PJ at DCE.AU.DK  Mon Mar 30 22:07:19 2009
From: PJ at DCE.AU.DK (Peter Jepsen)
Date: Mon, 30 Mar 2009 22:07:19 +0200
Subject: [R-sig-Geo] Repost: Find boundaries between two
	SpatialPolygonsDataFrame objects?
Message-ID: <BF9B6C436B8F26458D7F5FC295C7770102164B4F@gere.svf.au.dk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090330/ad5fe9d9/attachment.pl>

From jonthayn at ku.edu  Mon Mar 30 22:15:12 2009
From: jonthayn at ku.edu (Jonathan Boyd Thayn)
Date: Mon, 30 Mar 2009 15:15:12 -0500
Subject: [R-sig-Geo] Repost: Find boundaries between two
	SpatialPolygonsDataFrame objects?
In-Reply-To: <BF9B6C436B8F26458D7F5FC295C7770102164B4F@gere.svf.au.dk>
References: <BF9B6C436B8F26458D7F5FC295C7770102164B4F@gere.svf.au.dk>
Message-ID: <78AA3774-6B56-4316-86F5-039740153392@ku.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090330/f3cd5d3b/attachment.pl>

From Roger.Bivand at nhh.no  Mon Mar 30 22:49:56 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 30 Mar 2009 22:49:56 +0200 (CEST)
Subject: [R-sig-Geo] Issues importing BIG shapefile - Limitations of R
 or something else?
In-Reply-To: <9fb1ae890903301311t3cce90a3s9f133c5708826314@mail.gmail.com>
References: <9fb1ae890903281008j5560e396o49b5e98c16e0dbc9@mail.gmail.com>
	<alpine.LRH.2.00.0903291714410.13822@reclus.nhh.no>
	<9fb1ae890903291346n4a4419edx5e94930e5bb281df@mail.gmail.com>
	<alpine.LRH.2.00.0903300935300.19575@reclus.nhh.no>
	<9fb1ae890903301311t3cce90a3s9f133c5708826314@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903302246310.23898@reclus.nhh.no>

On Mon, 30 Mar 2009, Tyler Dean Rudolph wrote:

> Hello Roger,
>
> This certainly does shed a lot of light on the mechanism behind the error
> and your code is greatly appreciated.  Now for the question: did your final
> line of code work???  When I tried it on my machine it took over 4 hours
> without completing, at which time I stopped and tried it on an external
> machine, which gave me the following:

Still running at 13 hours, I'll leave it overnight. It seems to take up to 
10 seconds on some lines (guess). I think that this is what Adrian refered 
to saying that the next release of spatstat should do this faster. 51K 
lines is a seriously large number, after all ...

Roger

>
> *> roads<-readOGR("D:/GIS", layer="road2004")*
> OGR data source with driver: ESRI Shapefile
> Source: "D:/GIS", layer: "road2004"
> with  51218  rows and  4  columns
> Feature type: wkbLineString with 2 dimensions
> *> roads<-as(roads, "SpatialLines")
> *> ## Remove any unpaired coordinates (code by Roger Bivand)
> *> ncrds <- sapply(slot(roads, "lines"), function(x) sapply(slot(x,
> "Lines"),
> +  function(y) nrow(slot(y, "coords"))))
>> summary(unlist(ncrds))*
>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>   1.00    6.00   16.00   31.99   39.00 3241.00
> *> keep <- sapply(ncrds, function(x) all(x > 1))
>> roads_gt_1 <- roads[keep]
>> length(slot(roads, "lines"))
> *[1] 51218
> *> length(slot(roads_gt_1, "lines"))*
> [1] 51216
> *> test<-as(roads_gt_1, "psp")*
> Erreur in FUN(X[[1L]], ...) : impossible to find the function
> "superimposePSP"
>
> **** For *sessionInfo() *and *traceback()* results see the
> attached print.screen image.* ***
>
> It feels like we are very close to success yet there seems to be an issue in
> the process of conversion to a psp object.  ?
>
> Tyler
>
>
>
> On Mon, Mar 30, 2009 at 3:48 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Sun, 29 Mar 2009, Tyler Dean Rudolph wrote:
>>
>> As you've indicated Roger there does appear to be an error in
>>> readShapeLines() under maptools.  However I can't help but wonder why I do
>>> not have any problems using the same command sequence for a subset of
>>> the same data (even after updating my version of sp)...?  With said subset
>>> I
>>> am able to import and convert the .shp file to a SpatialLinesDataFrame
>>> object and then (end result) a psp object.  This latter transformation is
>>> critical in order to produce the type of output I am trying to model using
>>> distmap().
>>>
>>> Now via the alternate path, readOGR() successfully imported the spatial
>>> lines polygon (full coverage) as a SpatialLinesDataFrame object;
>>> **
>>> *> roads<-readOGR("D:/GIS", layer="road2004")*
>>> OGR data source with driver: ESRI Shapefile
>>> Source: "D:/GIS", layer: "road2004"
>>> with  51218  rows and  4  columns
>>> Feature type: wkbLineString with 2 dimensions
>>> However from this point when I try to convert it to a psp object it fails:
>>>
>>
>> Tyler:
>>
>> Thanks again for a full report. The failure in readShapeLines() was caused
>> by a line with only a single coordinate (two, in fact). This isn't a problem
>> in the readOGR() code, and will not be in the latest release of maptools.
>>
>> In spatstat, if spatstat.options("checkpolygons") is TRUE, (xrange[2] <
>> xrange[1]) and (yrange[2] < yrange[1]) are both expected to hold, and
>> cannot, because for single coordinate lines, the min and max are equal.
>>
>> You have two choices - based on the files you made available, either drop
>> the two single coordinate lines:
>>
>> ncrds <- sapply(slot(roads, "lines"), function(x) sapply(slot(x, "Lines"),
>>  function(y) nrow(slot(y, "coords"))))
>> summary(unlist(wh_singleton))
>> keep <- sapply(ncrds, function(x) all(x > 1))
>> roads_gt_1 <- roads[keep]
>> length(slot(roads, "lines"))
>> length(slot(roads_gt_1, "lines"))
>> test <- as(roads_gt_1, "psp")
>>
>> or set checkpolygons to FALSE in spatstat.options(). I'm running the former
>> at the moment - deleting the SpatialLinesDataFrame object after coercing to
>> SpatialLines would save some memory.
>>
>> Hope this helps,
>>
>> Roger
>>
>>
>>> ** *> test<-as(roads, "psp")*
>>>
>>> Error in owin(xr, yr, poly = list(x = xr[c(1, 2, 2, 1)], y = yr[c(1, 1,  :
>>>  xrange should be a vector of length 2 giving (xmin, xmax)
>>>
>>> Here I will provide similar information as before, in hopes that we might
>>> be
>>> able to shed light on the issue, which appears to involve the window
>>> being used to spatially frame the data:
>>>
>>> *> sessionInfo()*
>>> R version 2.8.1 (2008-12-22)
>>> i386-pc-mingw32
>>>
>>> locale:
>>>
>>> LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=English_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices datasets  utils     methods   base
>>>
>>> other attached packages:
>>> [1] rgdal_0.6-7     spatstat_1.15-0 deldir_0.0-7    gpclib_1.4-3
>>> mgcv_1.4-1.1    maptools_0.7-20 sp_0.9-32       foreign_0.8-29
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.8.1      lattice_0.17-17 nlme_3.1-89     tools_2.8.1
>>>
>>> *> traceback()
>>> *14: stop("xrange should be a vector of length 2 giving (xmin, xmax)")
>>> 13: owin(xr, yr, poly = list(x = xr[c(1, 2, 2, 1)], y = yr[c(1, 1,
>>>       2, 2)]), unitname = unitname(W))
>>> 12: switch(W$type, rectangle = {
>>>       xr <- W$xrange
>>>       yr <- W$yrange
>>>       return(owin(xr, yr, poly = list(x = xr[c(1, 2, 2, 1)], y = yr[c(1,
>>>           1, 2, 2)]), unitname = unitname(W)))
>>>   }, polygonal = {
>>>       return(W)
>>>   }, mask = {
>>>       stop("A mask cannot be converted to a polygon")
>>>   })
>>> 11: as.polygonal(x)
>>> 10: owin2gpc(B)
>>> 9: union.owin(W, Wlist[[i]])
>>> 8: superimposePSP(y, window = window)
>>> 7: FUN(X[[24798L]], ...)
>>> 6: lapply(lin, as.psp.Lines)
>>> 5: as.psp.SpatialLines(y, window = window, marks = marks)
>>> 4: as.psp(y, window = window, marks = marks)
>>> 3: as.psp.SpatialLinesDataFrame(from)
>>> 2: asMethod(object)
>>> 1: as(roads, "psp")
>>>
>>> Why does this error occur now when it works fine for a subset of the same
>>> data?  Is there a fix that could help with this problem?
>>> Tyler
>>>
>>>
>>>
>>> On Sun, Mar 29, 2009 at 11:21 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>> wrote:
>>>
>>> On Sat, 28 Mar 2009, Tyler Dean Rudolph wrote:
>>>>
>>>> Here are the sessionInfo() and traceback() results following the failed
>>>>
>>>>> import.  It looks like I am not using the most recent version of sp so I
>>>>> am
>>>>> trying to figure out the terms in the call to update.package() and with
>>>>> the
>>>>> most recent version I will try again.
>>>>>
>>>>>
>>>> Thanks! The indications are that coordinates is being passed a numeric
>>>> vector, not a matrix, at:
>>>>
>>>> Line(coords = shape$verts[from[i]:to[i], ])
>>>>
>>>> so if from[i] == to[i], the code as shown converts a single coordinate
>>>> (one
>>>> row) matrix into a numeric vector (omitted drop=FALSE in "[" method,
>>>> perhaps
>>>> the most common coding error in S/R).
>>>>
>>>> That is fixable, but a better workaround may be to use readOGR() in rgdal
>>>> rather than readShapeLines() in maptools.
>>>>
>>>> Roger
>>>>
>>>>  The .shp file is ~30 megabytes and
>>>>
>>>>> the associated .dbf is ~15 megabytes, though I don't think the latter is
>>>>> included in the import.  I have 2G of memory on this machine....
>>>>>
>>>>> Tyler
>>>>>
>>>>> **
>>>>> *> roads<-as(as(readShapeLines(fn="D:\\GIS\\road2004.shp"),
>>>>> "SpatialLines"),
>>>>> "psp")
>>>>> *Error in function (classes, fdef, mtable)  :
>>>>>  unable to find an inherited method for function "coordinates", for
>>>>> signature "numeric"
>>>>>
>>>>> *> sessionInfo()*
>>>>> R version 2.8.1 (2008-12-22)
>>>>> i386-pc-mingw32
>>>>>
>>>>> locale:
>>>>>
>>>>>
>>>>> LC_COLLATE=English_Canada.1252;LC_CTYPE=English_Canada.1252;LC_MONETARY=English_Canada.1252;LC_NUMERIC=C;LC_TIME=English_Canada.1252
>>>>>
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices datasets  utils     methods   base
>>>>>
>>>>> other attached packages:
>>>>> [1] spatstat_1.15-0 deldir_0.0-7    gpclib_1.4-3    mgcv_1.4-1.1
>>>>> maptools_0.7-20 foreign_0.8-29  sp_0.9-29
>>>>> loaded via a namespace (and not attached):
>>>>> [1] grid_2.8.1      lattice_0.17-17 tools_2.8.1
>>>>>
>>>>> *> traceback()*
>>>>> 13: stop("unable to find an inherited method for function \"",
>>>>> fdef at generic,
>>>>>
>>>>>      "\", for signature ", cnames)
>>>>> 12: function (classes, fdef, mtable)
>>>>>  {
>>>>>      methods <- .findInheritedMethods(classes, fdef, mtable)
>>>>>      if (length(methods) == 1)
>>>>>          return(methods[[1]])
>>>>>      else if (length(methods) == 0) {
>>>>>          cnames <- paste("\"", sapply(classes, as.character),
>>>>>              "\"", sep = "", collapse = ", ")
>>>>>          stop("unable to find an inherited method for function \"",
>>>>>              fdef at generic, "\", for signature ", cnames)
>>>>>      }
>>>>>      else stop("Internal error in finding inherited methods; didn't
>>>>> return a unique method")
>>>>>  }(list("numeric"), function (obj)
>>>>>  standardGeneric("coordinates"), <environment>)
>>>>> 11: coordinates(coords)
>>>>> 10: Line(coords = shape$verts[from[i]:to[i], ])
>>>>> 9: .shapes2LinesList(shapes[[i]], ID = IDs[i])
>>>>> 8: .shp2LinesDF(Map, proj4string = proj4string)
>>>>> 7: withCallingHandlers(expr, warning = function(w)
>>>>> invokeRestart("muffleWarning"))
>>>>> 6: suppressWarnings(.shp2LinesDF(Map, proj4string = proj4string))
>>>>> 5: readShapeLines(fn = "D:\\GIS\\road2004.shp")
>>>>> 4: .class1(object)
>>>>> 3: as(readShapeLines(fn = "D:\\GIS\\road2004.shp"), "SpatialLines")
>>>>> 2: .class1(object)
>>>>> 1: as(as(readShapeLines(fn = "D:\\GIS\\road2004.shp"), "SpatialLines"),
>>>>>     "psp")
>>>>>
>>>>>       [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gianni.lavaredo at gmail.com  Tue Mar 31 02:26:19 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 31 Mar 2009 02:26:19 +0200
Subject: [R-sig-Geo] problem with readOGR
Message-ID: <518dff330903301726q474e9177h106744bca6b28946@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090331/fe6bfb12/attachment.pl>

From r.m.krug at gmail.com  Tue Mar 31 12:29:09 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Tue, 31 Mar 2009 12:29:09 +0200
Subject: [R-sig-Geo] Problem with overlay(x="SpatialGridDataFrame",
	y="SpatialPoints")
Message-ID: <fb7c7e870903310329k8a0b360x58931fd542660d4a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090331/2858278a/attachment.pl>

From gianni.lavaredo at gmail.com  Tue Mar 31 12:50:10 2009
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 31 Mar 2009 12:50:10 +0200
Subject: [R-sig-Geo] calculate max and min distance vertex in a polygon shape
Message-ID: <518dff330903310350v9071326qb785bd89504021e5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090331/80f915ab/attachment.pl>

From Roger.Bivand at nhh.no  Tue Mar 31 14:16:08 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 31 Mar 2009 14:16:08 +0200 (CEST)
Subject: [R-sig-Geo] Problem with overlay(x="SpatialGridDataFrame",
 y="SpatialPoints")
In-Reply-To: <fb7c7e870903310329k8a0b360x58931fd542660d4a@mail.gmail.com>
References: <fb7c7e870903310329k8a0b360x58931fd542660d4a@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903311357590.26843@reclus.nhh.no>

On Tue, 31 Mar 2009, Rainer M Krug wrote:

> Hi
>
> I want to get the data from a grid at locations based in a point vector
> file. I am using the following code, and I get the error below.

Rainer:

The quick workaround is to read the shapefile with readOGR(), which does 
not give the coordinates matrix row names, so the failing test for 
matching with data frame row names is skipped. I have fixed overlay() 
to suit in sp's CVS on R-spatial on sourceforge - could you try it, 
please? The following will show if it is fixed:

library(sp)
data(meuse)
coordinates(meuse) <- c("x", "y")
data(meuse.grid)
coordinates(meuse.grid) <- c("x", "y")
gridded(meuse.grid) <- TRUE
fullgrid(meuse.grid) <- TRUE
zz <- overlay(meuse.grid, meuse)
library(rgdal)
writeOGR(meuse, "/tmp", "meuse", driver="ESRI Shapefile")
meuse <- readOGR("/tmp", "meuse")
zz <- overlay(meuse.grid, meuse)
library(maptools)
meuse <- readShapePoints("/tmp/meuse.shp")
zz <- overlay(meuse.grid, meuse)

Hope this helps,

Roger


>
> Could anybody help to solve this?
>
> Thanks
>
> Rainer
>
>
>> lastFire <- readAsciiGrid("fire_last_2006.asc")
>> biota <- readShapePoints("Biota")
>> overlay(lastFire, biota)
> Error in SpatialPointsDataFrame(cc, x at data[idx, , drop = FALSE], proj4string
> = CRS(proj4string(x))) :
>  row.names of data and coords do not match
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.m.krug at gmail.com  Tue Mar 31 15:11:11 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Tue, 31 Mar 2009 15:11:11 +0200
Subject: [R-sig-Geo] Problem with overlay(x="SpatialGridDataFrame",
	y="SpatialPoints")
In-Reply-To: <alpine.LRH.2.00.0903311357590.26843@reclus.nhh.no>
References: <fb7c7e870903310329k8a0b360x58931fd542660d4a@mail.gmail.com>
	<alpine.LRH.2.00.0903311357590.26843@reclus.nhh.no>
Message-ID: <fb7c7e870903310611j642afde5g17d871c8c6ee1bc1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090331/8fbb5047/attachment.pl>

From Roger.Bivand at nhh.no  Tue Mar 31 15:54:29 2009
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 31 Mar 2009 15:54:29 +0200 (CEST)
Subject: [R-sig-Geo] Problem with overlay(x="SpatialGridDataFrame",
 y="SpatialPoints")
In-Reply-To: <fb7c7e870903310611j642afde5g17d871c8c6ee1bc1@mail.gmail.com>
References: <fb7c7e870903310329k8a0b360x58931fd542660d4a@mail.gmail.com>
	<alpine.LRH.2.00.0903311357590.26843@reclus.nhh.no>
	<fb7c7e870903310611j642afde5g17d871c8c6ee1bc1@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.0903311551010.30176@reclus.nhh.no>

On Tue, 31 Mar 2009, Rainer M Krug wrote:

> On Tue, Mar 31, 2009 at 2:16 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Tue, 31 Mar 2009, Rainer M Krug wrote:
>>
>>  Hi
>>>
>>> I want to get the data from a grid at locations based in a point vector
>>> file. I am using the following code, and I get the error below.
>>>
>>
>> Rainer:
>>
>> The quick workaround is to read the shapefile with readOGR(), which does
>> not give the coordinates matrix row names, so the failing test for matching
>> with
>
>
> Yes - it works with readOGR, which I like. But the problem is, that most
> attendants of the course use Windows (unfortunately), and as faer as I know
> is rgdal on windows tricky.
>

For what definition of tricky? The CRAN Windows binary ships with its own 
GDAL binaries and support files (thanks to Uwe Ligges), so I don't think 
it is harder to install than maptools (but is a much larger download for 
obvious reasons - it includes quite a lot of raster and vector drivers, 
and the GDAL and PROJ.4 support metadata files).

>
>> data frame row names is skipped. I have fixed overlay() to suit in sp's CVS
>> on R-spatial on sourceforge - could you try it, please? The following will
>> show if it
>
>
> OK - it's working now. ANy idea when this will be available on CRAN?

sp_0.9-34.tar.gz submitted to CRAN, so probably tomorrow for the Windows 
build if it passes checks.

Roger

>
> Thanks a lot,
>
> Rainer
>
> is fixed:
>>
>> library(sp)
>> data(meuse)
>> coordinates(meuse) <- c("x", "y")
>> data(meuse.grid)
>> coordinates(meuse.grid) <- c("x", "y")
>> gridded(meuse.grid) <- TRUE
>> fullgrid(meuse.grid) <- TRUE
>> zz <- overlay(meuse.grid, meuse)
>> library(rgdal)
>> writeOGR(meuse, "/tmp", "meuse", driver="ESRI Shapefile")
>> meuse <- readOGR("/tmp", "meuse")
>> zz <- overlay(meuse.grid, meuse)
>> library(maptools)
>> meuse <- readShapePoints("/tmp/meuse.shp")
>> zz <- overlay(meuse.grid, meuse)
>>
>> Hope this helps,
>>
>> Roger
>>
>>
>>
>>
>>> Could anybody help to solve this?
>>>
>>> Thanks
>>>
>>> Rainer
>>>
>>>
>>>  lastFire <- readAsciiGrid("fire_last_2006.asc")
>>>> biota <- readShapePoints("Biota")
>>>> overlay(lastFire, biota)
>>>>
>>> Error in SpatialPointsDataFrame(cc, x at data[idx, , drop = FALSE],
>>> proj4string
>>> = CRS(proj4string(x))) :
>>>  row.names of data and coords do not match
>>>
>>>>
>>>>
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.m.krug at gmail.com  Tue Mar 31 16:02:03 2009
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Tue, 31 Mar 2009 16:02:03 +0200
Subject: [R-sig-Geo] Problem with overlay(x="SpatialGridDataFrame",
	y="SpatialPoints")
In-Reply-To: <alpine.LRH.2.00.0903311551010.30176@reclus.nhh.no>
References: <fb7c7e870903310329k8a0b360x58931fd542660d4a@mail.gmail.com>
	<alpine.LRH.2.00.0903311357590.26843@reclus.nhh.no>
	<fb7c7e870903310611j642afde5g17d871c8c6ee1bc1@mail.gmail.com>
	<alpine.LRH.2.00.0903311551010.30176@reclus.nhh.no>
Message-ID: <fb7c7e870903310702u331c19fcmc0547b44312c7e9c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20090331/b141e06e/attachment.pl>

From honeydelagiroday at gmail.com  Tue Mar 31 19:37:12 2009
From: honeydelagiroday at gmail.com (Honey-Marie de la Giroday)
Date: Tue, 31 Mar 2009 10:37:12 -0700
Subject: [R-sig-Geo] Using an image, produced via the predict.ppm() command,
	as a 	covariate in a ppm
Message-ID: <dd480afd0903311037u15bafa7tc18a9fcc598dca2f@mail.gmail.com>

Hi UseRs

I'm an R neophyte working on a Windows XP platform (R v. 2.8.1 and
spatstat v. 1.15-0).  I have created an image using the predict.ppm()
command and a ppp object.  While trying to use that image as a
covariate in another ppm() model fit, I got the following error (Error
in allcovar || want.trend : invalid 'y' type in 'x || y').  The image
produced using the predict() command contains NA values (although I'm
not sure why) and so I thought this might be affecting the
calculation.  However,  I replaced NA values with zeros to see if that
would allow be to fit the final model; however, this did not work.
Has anyone seen this error message before and can they explain what it
might mean.  Please feel free to let me know if I need to provide more
clarification about the problem, data, or produced image.  Thank you
for your time.  Please see the code below.

#Load packages I need
library(spatstat)
library(shapefiles)
library(maptools)
library(foreign)

#Read in point file that will be the response variable (i.e.
susceptible habitat)
haz54321 <- readShapePoints("haz_54321_pt")

#Read in point files that will be used to produce covariate image
surface (i.e. location of monkey infestations)
mpb04 <- readShapePoints("2004")
mpb05 <- readShapePoints("2005")
mpb06 <- readShapePoints("2006")

#Extract X and Y coordinates from ShapePoints
Xhaz <- haz54321$easting
Yhaz <- haz54321$northing

X04 <- mpb04$Easting
Y04 <- mpb04$Northing

X05 <- mpb05$Easting
Y05 <- mpb05$Northing

#Create object window from research area boundary
landform1 <- readAsciiGrid("tpi_utm_sus1.txt", as.image=TRUE)#Canyons
tpi1 <- as.im(landform1)

#Create object window for analysis from one of the susceptibility
datasets (these have been clipped by tpi raster in Arcview but are
slightly smaller that tpi boundary in some areas)
tpi1.win <- as.owin(tpi1)

#Convert ShapePoints to point pattern manually
haz54321 <- ppp(x=haz54321$easting, y=haz54321$northing, window=tpi1.win)
xxx04 <- ppp(x=mpb04$Easting, y=mpb04$Northing, window=tpi1.win)
xxx05 <- ppp(x=mpb05$Easting, y=mpb05$Northing, window=tpi1.win)
xxx06 <- ppp(x=mpb06$Easting, y=mpb06$Northing, window=tpi1.win)

#Read in distance from western edge of dataset
distance <- readAsciiGrid("dist138.txt", as.image=TRUE)

##Fit wave propagation models
fm.wave2004 <- ppm(xxx04, ~ distance + I(distance^2), Poisson(),
covariates=list(distance=distance))
fm.wave2005 <- ppm(xxx05, ~ distance + I(distance^2), Poisson(),
covariates=list(distance=distance))
fm.wave2006 <- ppm(xxx06, ~ distance + I(distance^2), Poisson(),
covariates=list(distance=distance))

#Create image covariate from fit models
wave2004 <- predict.ppm(fm.wave2004)
wave2005 <- predict.ppm(fm.wave2005)
wave2006 <- predict.ppm(fm.wave2006)

#See if habitat also fits a wave-like pattern
fm2 <- ppm(haz54321, ~ wave2004, Poisson(), covariate=c(wave2004=wave2004))
fm3 <- ppm(haz54321, ~ wave2005, Poisson(), covariate=c(wave2005=wave2005))
fm4 <- ppm(haz54321, ~ wave2006, Poisson(), covariate=c(wave2006=wave2006))

#Resulting error message
"Error in allcovar || want.trend : invalid 'y' type in 'x || y'"


 --
 Sincerely,





Honey-Marie de la Giroday


