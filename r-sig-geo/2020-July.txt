From te@3rd @end|ng |rom gm@||@com  Thu Jul  2 19:46:34 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Thu, 2 Jul 2020 13:46:34 -0400
Subject: [R-sig-Geo] Trouble installing rgdal
Message-ID: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>

Hi all,

I have searched the internet and have spent a few days trying to get to the
problem when I try to install rgdal into my Ubuntu 18.04 system. I have
done this many times previously, but cannot seem to track down what I am
doing wrong now. I have tried a forced install from sources with and
without dependencies. Below is what I get. Any help is appreciated.

Tom

> install.packages("rgdal")
Installing package into ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
(as ?lib? is unspecified)
trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
==================================================
downloaded 2.2 MB

* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
** using staged installation
configure: R_HOME: /usr/local/lib/R
configure: CC: gcc
configure: CXX: g++ -std=gnu++11
configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
configure: CXX is: g++ -std=gnu++11
configure: C++11 support available
configure: rgdal: 1.5-12
checking for /usr/bin/svnversion... yes
configure: svn revision: 1018
checking for gdal-config... /usr/local/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 3.0.0
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking GDAL: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
configure: pkg-config proj exists, will use it
configure: PROJ version: 6.1.0
configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
configure: PROJ LIBS: -L/usr/local/lib -lproj
checking PROJ header API:... yes
checking whether the C++ compiler works... yes
checking for C++ compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C++ compiler... yes
checking whether g++ -std=gnu++11 accepts -g... yes
checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking proj.h usability... yes
checking proj.h presence... yes
checking for proj.h... yes
checking for proj_context_create in -lproj... yes
checking Using GDAL < 3 with PROJ >= 6... no
checking PROJ version >= 4.8.0... yes
checking PROJ: proj.db found and readable... yes
configure: Package CPP flags:  -I/usr/local/include -I/usr/local/include
-DPROJ_H_API
configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib -lproj
configure: creating ./config.status
config.status: creating src/Makevars
** libs
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
gdal-bindings.o
gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o ogr_polygons.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in this
scope
         OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
         ^~~~~~~~~~~~~~~~~
ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
         OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
         ^~~~~~~~~~~~~~~~~
         OSRProjVersion
/usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o' failed
make: *** [ogr_proj.o] Error 1
ERROR: compilation failed for package ?rgdal?
* removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?

The downloaded source packages are in
?/tmp/RtmpNkdFOf/downloaded_packages?
Warning message:
In install.packages("rgdal") :
  installation of package ?rgdal? had non-zero exit status


-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From bennet @end|ng |rom um|ch@edu  Thu Jul  2 20:00:57 2020
From: bennet @end|ng |rom um|ch@edu (Bennet Fauber)
Date: Thu, 2 Jul 2020 14:00:57 -0400
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
Message-ID: <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>

You might try this

install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
repos="http://R-Forge.R-project.org")

as there have been recent patches to rgdal that might help that have
been incorporated there.


On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
>
> Hi all,
>
> I have searched the internet and have spent a few days trying to get to the
> problem when I try to install rgdal into my Ubuntu 18.04 system. I have
> done this many times previously, but cannot seem to track down what I am
> doing wrong now. I have tried a forced install from sources with and
> without dependencies. Below is what I get. Any help is appreciated.
>
> Tom
>
> > install.packages("rgdal")
> Installing package into ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> (as ?lib? is unspecified)
> trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
> Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
> ==================================================
> downloaded 2.2 MB
>
> * installing *source* package ?rgdal? ...
> ** package ?rgdal? successfully unpacked and MD5 sums checked
> ** using staged installation
> configure: R_HOME: /usr/local/lib/R
> configure: CC: gcc
> configure: CXX: g++ -std=gnu++11
> configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
> configure: CXX is: g++ -std=gnu++11
> configure: C++11 support available
> configure: rgdal: 1.5-12
> checking for /usr/bin/svnversion... yes
> configure: svn revision: 1018
> checking for gdal-config... /usr/local/bin/gdal-config
> checking gdal-config usability... yes
> configure: GDAL: 3.0.0
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking GDAL: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
> configure: pkg-config proj exists, will use it
> configure: PROJ version: 6.1.0
> configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> configure: PROJ LIBS: -L/usr/local/lib -lproj
> checking PROJ header API:... yes
> checking whether the C++ compiler works... yes
> checking for C++ compiler default output file name... a.out
> checking for suffix of executables...
> checking whether we are cross compiling... no
> checking for suffix of object files... o
> checking whether we are using the GNU C++ compiler... yes
> checking whether g++ -std=gnu++11 accepts -g... yes
> checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> checking for grep that handles long lines and -e... /bin/grep
> checking for egrep... /bin/grep -E
> checking for ANSI C header files... yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking proj.h usability... yes
> checking proj.h presence... yes
> checking for proj.h... yes
> checking for proj_context_create in -lproj... yes
> checking Using GDAL < 3 with PROJ >= 6... no
> checking PROJ version >= 4.8.0... yes
> checking PROJ: proj.db found and readable... yes
> configure: Package CPP flags:  -I/usr/local/include -I/usr/local/include
> -DPROJ_H_API
> configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib -lproj
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> gdal-bindings.o
> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o ogr_polygons.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
> ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in this
> scope
>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>          ^~~~~~~~~~~~~~~~~
> ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>          ^~~~~~~~~~~~~~~~~
>          OSRProjVersion
> /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o' failed
> make: *** [ogr_proj.o] Error 1
> ERROR: compilation failed for package ?rgdal?
> * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>
> The downloaded source packages are in
> ?/tmp/RtmpNkdFOf/downloaded_packages?
> Warning message:
> In install.packages("rgdal") :
>   installation of package ?rgdal? had non-zero exit status
>
>
> --
> Thomas E Adams, III
> 1724 Sage Lane
> Blacksburg, VA 24060
> tea3rd at gmail.com (personal)
> tea at terrapredictions.org (work)
>
> 1 (513) 739-9512 (cell)
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From te@3rd @end|ng |rom gm@||@com  Thu Jul  2 20:44:47 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Thu, 2 Jul 2020 14:44:47 -0400
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
Message-ID: <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>

Hi Bennet!

Thank you for your help, but I get the same error...

Tom

On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu> wrote:

> You might try this
>
> install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
> repos="http://R-Forge.R-project.org")
>
> as there have been recent patches to rgdal that might help that have
> been incorporated there.
>
>
> On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
> >
> > Hi all,
> >
> > I have searched the internet and have spent a few days trying to get to
> the
> > problem when I try to install rgdal into my Ubuntu 18.04 system. I have
> > done this many times previously, but cannot seem to track down what I am
> > doing wrong now. I have tried a forced install from sources with and
> > without dependencies. Below is what I get. Any help is appreciated.
> >
> > Tom
> >
> > > install.packages("rgdal")
> > Installing package into ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> > (as ?lib? is unspecified)
> > trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
> > Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
> > ==================================================
> > downloaded 2.2 MB
> >
> > * installing *source* package ?rgdal? ...
> > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > ** using staged installation
> > configure: R_HOME: /usr/local/lib/R
> > configure: CC: gcc
> > configure: CXX: g++ -std=gnu++11
> > configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
> > configure: CXX is: g++ -std=gnu++11
> > configure: C++11 support available
> > configure: rgdal: 1.5-12
> > checking for /usr/bin/svnversion... yes
> > configure: svn revision: 1018
> > checking for gdal-config... /usr/local/bin/gdal-config
> > checking gdal-config usability... yes
> > configure: GDAL: 3.0.0
> > checking GDAL version >= 1.11.4... yes
> > checking GDAL version <= 2.5 or >= 3.0... yes
> > checking GDAL: linking with --libs only... yes
> > checking GDAL: gdal-config data directory readable... yes
> > checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
> > configure: pkg-config proj exists, will use it
> > configure: PROJ version: 6.1.0
> > configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> > configure: PROJ LIBS: -L/usr/local/lib -lproj
> > checking PROJ header API:... yes
> > checking whether the C++ compiler works... yes
> > checking for C++ compiler default output file name... a.out
> > checking for suffix of executables...
> > checking whether we are cross compiling... no
> > checking for suffix of object files... o
> > checking whether we are using the GNU C++ compiler... yes
> > checking whether g++ -std=gnu++11 accepts -g... yes
> > checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> > checking for grep that handles long lines and -e... /bin/grep
> > checking for egrep... /bin/grep -E
> > checking for ANSI C header files... yes
> > checking for sys/types.h... yes
> > checking for sys/stat.h... yes
> > checking for stdlib.h... yes
> > checking for string.h... yes
> > checking for memory.h... yes
> > checking for strings.h... yes
> > checking for inttypes.h... yes
> > checking for stdint.h... yes
> > checking for unistd.h... yes
> > checking proj.h usability... yes
> > checking proj.h presence... yes
> > checking for proj.h... yes
> > checking for proj_context_create in -lproj... yes
> > checking Using GDAL < 3 with PROJ >= 6... no
> > checking PROJ version >= 4.8.0... yes
> > checking PROJ: proj.db found and readable... yes
> > configure: Package CPP flags:  -I/usr/local/include -I/usr/local/include
> > -DPROJ_H_API
> > configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib -lproj
> > configure: creating ./config.status
> > config.status: creating src/Makevars
> > ** libs
> > g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> -I/usr/local/include
> > -I/usr/local/include -DPROJ_H_API
> > -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> > -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
> > g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> -I/usr/local/include
> > -I/usr/local/include -DPROJ_H_API
> > -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> > -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> > gdal-bindings.o
> > gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> > -I/usr/local/include -DPROJ_H_API
> > -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> > -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> > gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> > -I/usr/local/include -DPROJ_H_API
> > -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> > -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> > gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> > -I/usr/local/include -DPROJ_H_API
> > -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> > -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
> > g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> -I/usr/local/include
> > -I/usr/local/include -DPROJ_H_API
> > -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> > -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> > gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> > -I/usr/local/include -DPROJ_H_API
> > -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> > -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o ogr_polygons.o
> > g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> -I/usr/local/include
> > -I/usr/local/include -DPROJ_H_API
> > -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> > -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> > ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
> > ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in this
> > scope
> >          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >          ^~~~~~~~~~~~~~~~~
> > ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
> >          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >          ^~~~~~~~~~~~~~~~~
> >          OSRProjVersion
> > /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o' failed
> > make: *** [ogr_proj.o] Error 1
> > ERROR: compilation failed for package ?rgdal?
> > * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >
> > The downloaded source packages are in
> > ?/tmp/RtmpNkdFOf/downloaded_packages?
> > Warning message:
> > In install.packages("rgdal") :
> >   installation of package ?rgdal? had non-zero exit status
> >
> >
> > --
> > Thomas E Adams, III
> > 1724 Sage Lane
> > Blacksburg, VA 24060
> > tea3rd at gmail.com (personal)
> > tea at terrapredictions.org (work)
> >
> > 1 (513) 739-9512 (cell)
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Thu Jul  2 21:14:57 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 2 Jul 2020 21:14:57 +0200
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
Message-ID: <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>

On Thu, 2 Jul 2020, Thomas Adams wrote:

> Hi Bennet!
>
> Thank you for your help, but I get the same error...

Tom,

Once rgdal revision 1029 completes building (check first) on:

https://r-forge.r-project.org/R/?group_id=884

please re-try. The missing function is not in the GDAL 3.0.0 headers, but 
is in the 3.0.1 headers. I've modified the check so as not to try for just 
>= 3 to >= 3.0.1.

Roger

>
> Tom
>
> On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu> wrote:
>
>> You might try this
>>
>> install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
>> repos="http://R-Forge.R-project.org")
>>
>> as there have been recent patches to rgdal that might help that have
>> been incorporated there.
>>
>>
>> On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
>>>
>>> Hi all,
>>>
>>> I have searched the internet and have spent a few days trying to get to
>> the
>>> problem when I try to install rgdal into my Ubuntu 18.04 system. I have
>>> done this many times previously, but cannot seem to track down what I am
>>> doing wrong now. I have tried a forced install from sources with and
>>> without dependencies. Below is what I get. Any help is appreciated.
>>>
>>> Tom
>>>
>>>> install.packages("rgdal")
>>> Installing package into ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
>>> (as ?lib? is unspecified)
>>> trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
>>> Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
>>> ==================================================
>>> downloaded 2.2 MB
>>>
>>> * installing *source* package ?rgdal? ...
>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>> ** using staged installation
>>> configure: R_HOME: /usr/local/lib/R
>>> configure: CC: gcc
>>> configure: CXX: g++ -std=gnu++11
>>> configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
>>> configure: CXX is: g++ -std=gnu++11
>>> configure: C++11 support available
>>> configure: rgdal: 1.5-12
>>> checking for /usr/bin/svnversion... yes
>>> configure: svn revision: 1018
>>> checking for gdal-config... /usr/local/bin/gdal-config
>>> checking gdal-config usability... yes
>>> configure: GDAL: 3.0.0
>>> checking GDAL version >= 1.11.4... yes
>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>> checking GDAL: linking with --libs only... yes
>>> checking GDAL: gdal-config data directory readable... yes
>>> checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
>>> configure: pkg-config proj exists, will use it
>>> configure: PROJ version: 6.1.0
>>> configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
>>> configure: PROJ LIBS: -L/usr/local/lib -lproj
>>> checking PROJ header API:... yes
>>> checking whether the C++ compiler works... yes
>>> checking for C++ compiler default output file name... a.out
>>> checking for suffix of executables...
>>> checking whether we are cross compiling... no
>>> checking for suffix of object files... o
>>> checking whether we are using the GNU C++ compiler... yes
>>> checking whether g++ -std=gnu++11 accepts -g... yes
>>> checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
>>> checking for grep that handles long lines and -e... /bin/grep
>>> checking for egrep... /bin/grep -E
>>> checking for ANSI C header files... yes
>>> checking for sys/types.h... yes
>>> checking for sys/stat.h... yes
>>> checking for stdlib.h... yes
>>> checking for string.h... yes
>>> checking for memory.h... yes
>>> checking for strings.h... yes
>>> checking for inttypes.h... yes
>>> checking for stdint.h... yes
>>> checking for unistd.h... yes
>>> checking proj.h usability... yes
>>> checking proj.h presence... yes
>>> checking for proj.h... yes
>>> checking for proj_context_create in -lproj... yes
>>> checking Using GDAL < 3 with PROJ >= 6... no
>>> checking PROJ version >= 4.8.0... yes
>>> checking PROJ: proj.db found and readable... yes
>>> configure: Package CPP flags:  -I/usr/local/include -I/usr/local/include
>>> -DPROJ_H_API
>>> configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib -lproj
>>> configure: creating ./config.status
>>> config.status: creating src/Makevars
>>> ** libs
>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>> -I/usr/local/include
>>> -I/usr/local/include -DPROJ_H_API
>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>> -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>> -I/usr/local/include
>>> -I/usr/local/include -DPROJ_H_API
>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>> -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
>>> gdal-bindings.o
>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>> -I/usr/local/include -DPROJ_H_API
>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>> -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>> -I/usr/local/include -DPROJ_H_API
>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>> -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>> -I/usr/local/include -DPROJ_H_API
>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>> -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>> -I/usr/local/include
>>> -I/usr/local/include -DPROJ_H_API
>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>> -I/usr/local/include -DPROJ_H_API
>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o ogr_polygons.o
>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>> -I/usr/local/include
>>> -I/usr/local/include -DPROJ_H_API
>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
>>> ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
>>> ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in this
>>> scope
>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>          ^~~~~~~~~~~~~~~~~
>>> ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>          ^~~~~~~~~~~~~~~~~
>>>          OSRProjVersion
>>> /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o' failed
>>> make: *** [ogr_proj.o] Error 1
>>> ERROR: compilation failed for package ?rgdal?
>>> * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>>
>>> The downloaded source packages are in
>>> ?/tmp/RtmpNkdFOf/downloaded_packages?
>>> Warning message:
>>> In install.packages("rgdal") :
>>>   installation of package ?rgdal? had non-zero exit status
>>>
>>>
>>> --
>>> Thomas E Adams, III
>>> 1724 Sage Lane
>>> Blacksburg, VA 24060
>>> tea3rd at gmail.com (personal)
>>> tea at terrapredictions.org (work)
>>>
>>> 1 (513) 739-9512 (cell)
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From te@3rd @end|ng |rom gm@||@com  Thu Jul  2 22:22:29 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Thu, 2 Jul 2020 16:22:29 -0400
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
Message-ID: <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>

Roger,

Thank you so much; after downloading the *.tar.gz file, the that did the
trick, using:

sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
rgdal_1.5-13.tar.gz

Best regards!
Tom


On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Thu, 2 Jul 2020, Thomas Adams wrote:
>
> > Hi Bennet!
> >
> > Thank you for your help, but I get the same error...
>
> Tom,
>
> Once rgdal revision 1029 completes building (check first) on:
>
> https://r-forge.r-project.org/R/?group_id=884
>
> please re-try. The missing function is not in the GDAL 3.0.0 headers, but
> is in the 3.0.1 headers. I've modified the check so as not to try for just
> >= 3 to >= 3.0.1.
>
> Roger
>
> >
> > Tom
> >
> > On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu> wrote:
> >
> >> You might try this
> >>
> >> install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
> >> repos="http://R-Forge.R-project.org")
> >>
> >> as there have been recent patches to rgdal that might help that have
> >> been incorporated there.
> >>
> >>
> >> On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
> >>>
> >>> Hi all,
> >>>
> >>> I have searched the internet and have spent a few days trying to get to
> >> the
> >>> problem when I try to install rgdal into my Ubuntu 18.04 system. I have
> >>> done this many times previously, but cannot seem to track down what I
> am
> >>> doing wrong now. I have tried a forced install from sources with and
> >>> without dependencies. Below is what I get. Any help is appreciated.
> >>>
> >>> Tom
> >>>
> >>>> install.packages("rgdal")
> >>> Installing package into
> ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> >>> (as ?lib? is unspecified)
> >>> trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
> >>> Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
> >>> ==================================================
> >>> downloaded 2.2 MB
> >>>
> >>> * installing *source* package ?rgdal? ...
> >>> ** package ?rgdal? successfully unpacked and MD5 sums checked
> >>> ** using staged installation
> >>> configure: R_HOME: /usr/local/lib/R
> >>> configure: CC: gcc
> >>> configure: CXX: g++ -std=gnu++11
> >>> configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
> >>> configure: CXX is: g++ -std=gnu++11
> >>> configure: C++11 support available
> >>> configure: rgdal: 1.5-12
> >>> checking for /usr/bin/svnversion... yes
> >>> configure: svn revision: 1018
> >>> checking for gdal-config... /usr/local/bin/gdal-config
> >>> checking gdal-config usability... yes
> >>> configure: GDAL: 3.0.0
> >>> checking GDAL version >= 1.11.4... yes
> >>> checking GDAL version <= 2.5 or >= 3.0... yes
> >>> checking GDAL: linking with --libs only... yes
> >>> checking GDAL: gdal-config data directory readable... yes
> >>> checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
> >>> configure: pkg-config proj exists, will use it
> >>> configure: PROJ version: 6.1.0
> >>> configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> >>> configure: PROJ LIBS: -L/usr/local/lib -lproj
> >>> checking PROJ header API:... yes
> >>> checking whether the C++ compiler works... yes
> >>> checking for C++ compiler default output file name... a.out
> >>> checking for suffix of executables...
> >>> checking whether we are cross compiling... no
> >>> checking for suffix of object files... o
> >>> checking whether we are using the GNU C++ compiler... yes
> >>> checking whether g++ -std=gnu++11 accepts -g... yes
> >>> checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> >>> checking for grep that handles long lines and -e... /bin/grep
> >>> checking for egrep... /bin/grep -E
> >>> checking for ANSI C header files... yes
> >>> checking for sys/types.h... yes
> >>> checking for sys/stat.h... yes
> >>> checking for stdlib.h... yes
> >>> checking for string.h... yes
> >>> checking for memory.h... yes
> >>> checking for strings.h... yes
> >>> checking for inttypes.h... yes
> >>> checking for stdint.h... yes
> >>> checking for unistd.h... yes
> >>> checking proj.h usability... yes
> >>> checking proj.h presence... yes
> >>> checking for proj.h... yes
> >>> checking for proj_context_create in -lproj... yes
> >>> checking Using GDAL < 3 with PROJ >= 6... no
> >>> checking PROJ version >= 4.8.0... yes
> >>> checking PROJ: proj.db found and readable... yes
> >>> configure: Package CPP flags:  -I/usr/local/include
> -I/usr/local/include
> >>> -DPROJ_H_API
> >>> configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
> -lproj
> >>> configure: creating ./config.status
> >>> config.status: creating src/Makevars
> >>> ** libs
> >>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >> -I/usr/local/include
> >>> -I/usr/local/include -DPROJ_H_API
> >>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>> -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
> >>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >> -I/usr/local/include
> >>> -I/usr/local/include -DPROJ_H_API
> >>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>> -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> >>> gdal-bindings.o
> >>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>> -I/usr/local/include -DPROJ_H_API
> >>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>> -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> >>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>> -I/usr/local/include -DPROJ_H_API
> >>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>> -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> >>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>> -I/usr/local/include -DPROJ_H_API
> >>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>> -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
> >>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >> -I/usr/local/include
> >>> -I/usr/local/include -DPROJ_H_API
> >>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>> -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> >>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>> -I/usr/local/include -DPROJ_H_API
> >>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>> -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
> ogr_polygons.o
> >>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >> -I/usr/local/include
> >>> -I/usr/local/include -DPROJ_H_API
> >>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>> -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> >>> ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
> >>> ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in this
> >>> scope
> >>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>          ^~~~~~~~~~~~~~~~~
> >>> ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
> >>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>          ^~~~~~~~~~~~~~~~~
> >>>          OSRProjVersion
> >>> /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
> failed
> >>> make: *** [ogr_proj.o] Error 1
> >>> ERROR: compilation failed for package ?rgdal?
> >>> * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>>
> >>> The downloaded source packages are in
> >>> ?/tmp/RtmpNkdFOf/downloaded_packages?
> >>> Warning message:
> >>> In install.packages("rgdal") :
> >>>   installation of package ?rgdal? had non-zero exit status
> >>>
> >>>
> >>> --
> >>> Thomas E Adams, III
> >>> 1724 Sage Lane
> >>> Blacksburg, VA 24060
> >>> tea3rd at gmail.com (personal)
> >>> tea at terrapredictions.org (work)
> >>>
> >>> 1 (513) 739-9512 (cell)
> >>>
> >>>         [[alternative HTML version deleted]]
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri Jul  3 11:45:34 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 3 Jul 2020 11:45:34 +0200
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
 <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
Message-ID: <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>

On Thu, 2 Jul 2020, Thomas Adams wrote:

> Roger,
>
> Thank you so much; after downloading the *.tar.gz file, the that did the
> trick, using:
>
> sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
> rgdal_1.5-13.tar.gz

Since you have GDAL: 3.0.0 and PROJ version: 6.1.0, you can drop 
--configure-args=--with-proj_api="proj_api.h", which is only needed if 
GDAL < 3 and PROJ >= 6. I'm uncertain how stable a system will be if GDAL 
>= 3 && PROJ >= 6 with this configure argument, as it is only a 
work-around for systems with GDAL < 3 and PROJ >= 6, and onnly tested in 
that setting.

Thanks for reporting back!

Roger

>
> Best regards!
> Tom
>
>
> On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Thu, 2 Jul 2020, Thomas Adams wrote:
>>
>>> Hi Bennet!
>>>
>>> Thank you for your help, but I get the same error...
>>
>> Tom,
>>
>> Once rgdal revision 1029 completes building (check first) on:
>>
>> https://r-forge.r-project.org/R/?group_id=884
>>
>> please re-try. The missing function is not in the GDAL 3.0.0 headers, but
>> is in the 3.0.1 headers. I've modified the check so as not to try for just
>>> = 3 to >= 3.0.1.
>>
>> Roger
>>
>>>
>>> Tom
>>>
>>> On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu> wrote:
>>>
>>>> You might try this
>>>>
>>>> install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
>>>> repos="http://R-Forge.R-project.org")
>>>>
>>>> as there have been recent patches to rgdal that might help that have
>>>> been incorporated there.
>>>>
>>>>
>>>> On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
>>>>>
>>>>> Hi all,
>>>>>
>>>>> I have searched the internet and have spent a few days trying to get to
>>>> the
>>>>> problem when I try to install rgdal into my Ubuntu 18.04 system. I have
>>>>> done this many times previously, but cannot seem to track down what I
>> am
>>>>> doing wrong now. I have tried a forced install from sources with and
>>>>> without dependencies. Below is what I get. Any help is appreciated.
>>>>>
>>>>> Tom
>>>>>
>>>>>> install.packages("rgdal")
>>>>> Installing package into
>> ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
>>>>> (as ?lib? is unspecified)
>>>>> trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
>>>>> Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
>>>>> ==================================================
>>>>> downloaded 2.2 MB
>>>>>
>>>>> * installing *source* package ?rgdal? ...
>>>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>>>> ** using staged installation
>>>>> configure: R_HOME: /usr/local/lib/R
>>>>> configure: CC: gcc
>>>>> configure: CXX: g++ -std=gnu++11
>>>>> configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
>>>>> configure: CXX is: g++ -std=gnu++11
>>>>> configure: C++11 support available
>>>>> configure: rgdal: 1.5-12
>>>>> checking for /usr/bin/svnversion... yes
>>>>> configure: svn revision: 1018
>>>>> checking for gdal-config... /usr/local/bin/gdal-config
>>>>> checking gdal-config usability... yes
>>>>> configure: GDAL: 3.0.0
>>>>> checking GDAL version >= 1.11.4... yes
>>>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>>>> checking GDAL: linking with --libs only... yes
>>>>> checking GDAL: gdal-config data directory readable... yes
>>>>> checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
>>>>> configure: pkg-config proj exists, will use it
>>>>> configure: PROJ version: 6.1.0
>>>>> configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
>>>>> configure: PROJ LIBS: -L/usr/local/lib -lproj
>>>>> checking PROJ header API:... yes
>>>>> checking whether the C++ compiler works... yes
>>>>> checking for C++ compiler default output file name... a.out
>>>>> checking for suffix of executables...
>>>>> checking whether we are cross compiling... no
>>>>> checking for suffix of object files... o
>>>>> checking whether we are using the GNU C++ compiler... yes
>>>>> checking whether g++ -std=gnu++11 accepts -g... yes
>>>>> checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
>>>>> checking for grep that handles long lines and -e... /bin/grep
>>>>> checking for egrep... /bin/grep -E
>>>>> checking for ANSI C header files... yes
>>>>> checking for sys/types.h... yes
>>>>> checking for sys/stat.h... yes
>>>>> checking for stdlib.h... yes
>>>>> checking for string.h... yes
>>>>> checking for memory.h... yes
>>>>> checking for strings.h... yes
>>>>> checking for inttypes.h... yes
>>>>> checking for stdint.h... yes
>>>>> checking for unistd.h... yes
>>>>> checking proj.h usability... yes
>>>>> checking proj.h presence... yes
>>>>> checking for proj.h... yes
>>>>> checking for proj_context_create in -lproj... yes
>>>>> checking Using GDAL < 3 with PROJ >= 6... no
>>>>> checking PROJ version >= 4.8.0... yes
>>>>> checking PROJ: proj.db found and readable... yes
>>>>> configure: Package CPP flags:  -I/usr/local/include
>> -I/usr/local/include
>>>>> -DPROJ_H_API
>>>>> configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
>> -lproj
>>>>> configure: creating ./config.status
>>>>> config.status: creating src/Makevars
>>>>> ** libs
>>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>> -I/usr/local/include
>>>>> -I/usr/local/include -DPROJ_H_API
>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>> -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
>>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>> -I/usr/local/include
>>>>> -I/usr/local/include -DPROJ_H_API
>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>> -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
>>>>> gdal-bindings.o
>>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>> -I/usr/local/include -DPROJ_H_API
>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>> -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
>>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>> -I/usr/local/include -DPROJ_H_API
>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>> -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
>>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>> -I/usr/local/include -DPROJ_H_API
>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>> -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
>>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>> -I/usr/local/include
>>>>> -I/usr/local/include -DPROJ_H_API
>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
>>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>> -I/usr/local/include -DPROJ_H_API
>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
>> ogr_polygons.o
>>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>> -I/usr/local/include
>>>>> -I/usr/local/include -DPROJ_H_API
>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
>>>>> ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
>>>>> ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in this
>>>>> scope
>>>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>>>          ^~~~~~~~~~~~~~~~~
>>>>> ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
>>>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>>>          ^~~~~~~~~~~~~~~~~
>>>>>          OSRProjVersion
>>>>> /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
>> failed
>>>>> make: *** [ogr_proj.o] Error 1
>>>>> ERROR: compilation failed for package ?rgdal?
>>>>> * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>>>>
>>>>> The downloaded source packages are in
>>>>> ?/tmp/RtmpNkdFOf/downloaded_packages?
>>>>> Warning message:
>>>>> In install.packages("rgdal") :
>>>>>   installation of package ?rgdal? had non-zero exit status
>>>>>
>>>>>
>>>>> --
>>>>> Thomas E Adams, III
>>>>> 1724 Sage Lane
>>>>> Blacksburg, VA 24060
>>>>> tea3rd at gmail.com (personal)
>>>>> tea at terrapredictions.org (work)
>>>>>
>>>>> 1 (513) 739-9512 (cell)
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From te@3rd @end|ng |rom gm@||@com  Fri Jul  3 11:48:10 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Fri, 3 Jul 2020 05:48:10 -0400
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
 <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
Message-ID: <CAGxgkWiZj5-ETvEPdCetXP_hdi0K46ahDVQJ80a=0hZ5LYpNXg@mail.gmail.com>

Thank you, Roger! I'll re-install without using
--configure-args=--with-proj_api="proj_api.h

Best,
Tom

On Fri, Jul 3, 2020 at 5:45 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Thu, 2 Jul 2020, Thomas Adams wrote:
>
> > Roger,
> >
> > Thank you so much; after downloading the *.tar.gz file, the that did the
> > trick, using:
> >
> > sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
> > rgdal_1.5-13.tar.gz
>
> Since you have GDAL: 3.0.0 and PROJ version: 6.1.0, you can drop
> --configure-args=--with-proj_api="proj_api.h", which is only needed if
> GDAL < 3 and PROJ >= 6. I'm uncertain how stable a system will be if GDAL
> >= 3 && PROJ >= 6 with this configure argument, as it is only a
> work-around for systems with GDAL < 3 and PROJ >= 6, and onnly tested in
> that setting.
>
> Thanks for reporting back!
>
> Roger
>
> >
> > Best regards!
> > Tom
> >
> >
> > On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> >> On Thu, 2 Jul 2020, Thomas Adams wrote:
> >>
> >>> Hi Bennet!
> >>>
> >>> Thank you for your help, but I get the same error...
> >>
> >> Tom,
> >>
> >> Once rgdal revision 1029 completes building (check first) on:
> >>
> >> https://r-forge.r-project.org/R/?group_id=884
> >>
> >> please re-try. The missing function is not in the GDAL 3.0.0 headers,
> but
> >> is in the 3.0.1 headers. I've modified the check so as not to try for
> just
> >>> = 3 to >= 3.0.1.
> >>
> >> Roger
> >>
> >>>
> >>> Tom
> >>>
> >>> On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu> wrote:
> >>>
> >>>> You might try this
> >>>>
> >>>> install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
> >>>> repos="http://R-Forge.R-project.org")
> >>>>
> >>>> as there have been recent patches to rgdal that might help that have
> >>>> been incorporated there.
> >>>>
> >>>>
> >>>> On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
> >>>>>
> >>>>> Hi all,
> >>>>>
> >>>>> I have searched the internet and have spent a few days trying to get
> to
> >>>> the
> >>>>> problem when I try to install rgdal into my Ubuntu 18.04 system. I
> have
> >>>>> done this many times previously, but cannot seem to track down what I
> >> am
> >>>>> doing wrong now. I have tried a forced install from sources with and
> >>>>> without dependencies. Below is what I get. Any help is appreciated.
> >>>>>
> >>>>> Tom
> >>>>>
> >>>>>> install.packages("rgdal")
> >>>>> Installing package into
> >> ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> >>>>> (as ?lib? is unspecified)
> >>>>> trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
> >>>>> Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
> >>>>> ==================================================
> >>>>> downloaded 2.2 MB
> >>>>>
> >>>>> * installing *source* package ?rgdal? ...
> >>>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
> >>>>> ** using staged installation
> >>>>> configure: R_HOME: /usr/local/lib/R
> >>>>> configure: CC: gcc
> >>>>> configure: CXX: g++ -std=gnu++11
> >>>>> configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
> >>>>> configure: CXX is: g++ -std=gnu++11
> >>>>> configure: C++11 support available
> >>>>> configure: rgdal: 1.5-12
> >>>>> checking for /usr/bin/svnversion... yes
> >>>>> configure: svn revision: 1018
> >>>>> checking for gdal-config... /usr/local/bin/gdal-config
> >>>>> checking gdal-config usability... yes
> >>>>> configure: GDAL: 3.0.0
> >>>>> checking GDAL version >= 1.11.4... yes
> >>>>> checking GDAL version <= 2.5 or >= 3.0... yes
> >>>>> checking GDAL: linking with --libs only... yes
> >>>>> checking GDAL: gdal-config data directory readable... yes
> >>>>> checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
> >>>>> configure: pkg-config proj exists, will use it
> >>>>> configure: PROJ version: 6.1.0
> >>>>> configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> >>>>> configure: PROJ LIBS: -L/usr/local/lib -lproj
> >>>>> checking PROJ header API:... yes
> >>>>> checking whether the C++ compiler works... yes
> >>>>> checking for C++ compiler default output file name... a.out
> >>>>> checking for suffix of executables...
> >>>>> checking whether we are cross compiling... no
> >>>>> checking for suffix of object files... o
> >>>>> checking whether we are using the GNU C++ compiler... yes
> >>>>> checking whether g++ -std=gnu++11 accepts -g... yes
> >>>>> checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> >>>>> checking for grep that handles long lines and -e... /bin/grep
> >>>>> checking for egrep... /bin/grep -E
> >>>>> checking for ANSI C header files... yes
> >>>>> checking for sys/types.h... yes
> >>>>> checking for sys/stat.h... yes
> >>>>> checking for stdlib.h... yes
> >>>>> checking for string.h... yes
> >>>>> checking for memory.h... yes
> >>>>> checking for strings.h... yes
> >>>>> checking for inttypes.h... yes
> >>>>> checking for stdint.h... yes
> >>>>> checking for unistd.h... yes
> >>>>> checking proj.h usability... yes
> >>>>> checking proj.h presence... yes
> >>>>> checking for proj.h... yes
> >>>>> checking for proj_context_create in -lproj... yes
> >>>>> checking Using GDAL < 3 with PROJ >= 6... no
> >>>>> checking PROJ version >= 4.8.0... yes
> >>>>> checking PROJ: proj.db found and readable... yes
> >>>>> configure: Package CPP flags:  -I/usr/local/include
> >> -I/usr/local/include
> >>>>> -DPROJ_H_API
> >>>>> configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
> >> -lproj
> >>>>> configure: creating ./config.status
> >>>>> config.status: creating src/Makevars
> >>>>> ** libs
> >>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>> -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
> >>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>> -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> >>>>> gdal-bindings.o
> >>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> >>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> >>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o
> local_stubs.o
> >>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>> -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> >>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
> >> ogr_polygons.o
> >>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>> -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> >>>>> ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
> >>>>> ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in
> this
> >>>>> scope
> >>>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>>>          ^~~~~~~~~~~~~~~~~
> >>>>> ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
> >>>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>>>          ^~~~~~~~~~~~~~~~~
> >>>>>          OSRProjVersion
> >>>>> /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
> >> failed
> >>>>> make: *** [ogr_proj.o] Error 1
> >>>>> ERROR: compilation failed for package ?rgdal?
> >>>>> * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>>>>
> >>>>> The downloaded source packages are in
> >>>>> ?/tmp/RtmpNkdFOf/downloaded_packages?
> >>>>> Warning message:
> >>>>> In install.packages("rgdal") :
> >>>>>   installation of package ?rgdal? had non-zero exit status
> >>>>>
> >>>>>
> >>>>> --
> >>>>> Thomas E Adams, III
> >>>>> 1724 Sage Lane
> >>>>> Blacksburg, VA 24060
> >>>>> tea3rd at gmail.com (personal)
> >>>>> tea at terrapredictions.org (work)
> >>>>>
> >>>>> 1 (513) 739-9512 (cell)
> >>>>>
> >>>>>         [[alternative HTML version deleted]]
> >>>>>
> >>>>> _______________________________________________
> >>>>> R-sig-Geo mailing list
> >>>>> R-sig-Geo at r-project.org
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>>
> >>>
> >>>
> >>
> >> --
> >> Roger Bivand
> >> Department of Economics, Norwegian School of Economics,
> >> Helleveien 30, N-5045 Bergen, Norway.
> >> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >> https://orcid.org/0000-0003-2392-6140
> >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From te@3rd @end|ng |rom gm@||@com  Fri Jul  3 11:52:13 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Fri, 3 Jul 2020 05:52:13 -0400
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
 <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
Message-ID: <CAGxgkWjBXnM06E7uT=K4h6b6i4LHLJ2NZWUxrWzj2uNuL1KRFQ@mail.gmail.com>

Hi Roger,

I just tried re-installing withou using the argument and got this:

teaiii at teaiii-Leopard-WS:~$ sudo R CMD INSTALL rgdal_1.5-13.tar.gz
* installing to library ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
* installing *source* package ?rgdal? ...
** using staged installation
configure: R_HOME: /usr/local/lib/R
configure: CC: gcc
configure: CXX: g++ -std=gnu++11
configure: CFLAGS: -g -O2
configure: CPPFLAGS: -I/usr/local/include
configure: CXXFLAGS: -g -O2
configure: LDFLAGS: -L/usr/local/lib
configure: LDFLAGS: -L/usr/local/lib
configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
configure: CXX is: g++ -std=gnu++11
configure: C++11 support available
configure: rgdal: 1.5-13
checking for /usr/bin/svnversion... yes
cat: inst/SVN_VERSION: No such file or directory
configure: svn revision:
checking for gdal-config... /usr/local/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 3.0.0
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking GDAL: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
configure: pkg-config proj exists, will use it
configure: PROJ version: 6.1.0
configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
configure: PROJ LIBS: -L/usr/local/lib -lproj
checking PROJ header API:... yes
checking whether the C++ compiler works... yes
checking for C++ compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C++ compiler... yes
checking whether g++ -std=gnu++11 accepts -g... yes
checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking proj.h usability... yes
checking proj.h presence... yes
checking for proj.h... yes
checking for proj_context_create in -lproj... yes
checking Using GDAL < 3 with PROJ >= 6... no
checking PROJ version >= 4.8.0... yes
checking PROJ: proj.db found and readable... yes
configure: Package CPP flags:  -I/usr/local/include -I/usr/local/include
-DPROJ_H_API
configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib -lproj
configure: creating ./config.status
config.status: creating src/Makevars
** libs
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
gdal-bindings.o
gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o ogr_polygons.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c ogrsource.cpp -o ogrsource.o
g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
-I/usr/local/include -DPROJ_H_API
-I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
-I/usr/local/include   -fpic  -g -O2  -c proj6.cpp -o proj6.o
proj6.cpp: In function ?SEXPREC* transform_ng(SEXP, SEXP, SEXP, SEXP, SEXP,
SEXP, SEXP)?:
proj6.cpp:521:29: error: ?proj_create_crs_to_crs_from_pj? was not declared
in this scope
         if ((pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
source_crs,
                             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
proj6.cpp:521:29: note: suggested alternative: ?proj_create_crs_to_crs?
         if ((pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
source_crs,
                             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                             proj_create_crs_to_crs
proj6.cpp: In function ?SEXPREC* project_ng_coordOp(SEXP, SEXP)?:
proj6.cpp:704:33: error: ?proj_create_crs_to_crs_from_pj? was not declared
in this scope
     if (use_inv) pj_transform =
proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
                                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
proj6.cpp:704:33: note: suggested alternative: ?proj_create_crs_to_crs?
     if (use_inv) pj_transform =
proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
                                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                 proj_create_crs_to_crs
proj6.cpp:706:25: error: ?proj_create_crs_to_crs_from_pj? was not declared
in this scope
     else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
source_crs,
                         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
proj6.cpp:706:25: note: suggested alternative: ?proj_create_crs_to_crs?
     else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
source_crs,
                         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                         proj_create_crs_to_crs
/usr/local/lib/R/etc/Makeconf:176: recipe for target 'proj6.o' failed
make: *** [proj6.o] Error 1
ERROR: compilation failed for package ?rgdal?
* removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
* restoring previous ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?

On Fri, Jul 3, 2020 at 5:45 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Thu, 2 Jul 2020, Thomas Adams wrote:
>
> > Roger,
> >
> > Thank you so much; after downloading the *.tar.gz file, the that did the
> > trick, using:
> >
> > sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
> > rgdal_1.5-13.tar.gz
>
> Since you have GDAL: 3.0.0 and PROJ version: 6.1.0, you can drop
> --configure-args=--with-proj_api="proj_api.h", which is only needed if
> GDAL < 3 and PROJ >= 6. I'm uncertain how stable a system will be if GDAL
> >= 3 && PROJ >= 6 with this configure argument, as it is only a
> work-around for systems with GDAL < 3 and PROJ >= 6, and onnly tested in
> that setting.
>
> Thanks for reporting back!
>
> Roger
>
> >
> > Best regards!
> > Tom
> >
> >
> > On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> >> On Thu, 2 Jul 2020, Thomas Adams wrote:
> >>
> >>> Hi Bennet!
> >>>
> >>> Thank you for your help, but I get the same error...
> >>
> >> Tom,
> >>
> >> Once rgdal revision 1029 completes building (check first) on:
> >>
> >> https://r-forge.r-project.org/R/?group_id=884
> >>
> >> please re-try. The missing function is not in the GDAL 3.0.0 headers,
> but
> >> is in the 3.0.1 headers. I've modified the check so as not to try for
> just
> >>> = 3 to >= 3.0.1.
> >>
> >> Roger
> >>
> >>>
> >>> Tom
> >>>
> >>> On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu> wrote:
> >>>
> >>>> You might try this
> >>>>
> >>>> install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
> >>>> repos="http://R-Forge.R-project.org")
> >>>>
> >>>> as there have been recent patches to rgdal that might help that have
> >>>> been incorporated there.
> >>>>
> >>>>
> >>>> On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
> >>>>>
> >>>>> Hi all,
> >>>>>
> >>>>> I have searched the internet and have spent a few days trying to get
> to
> >>>> the
> >>>>> problem when I try to install rgdal into my Ubuntu 18.04 system. I
> have
> >>>>> done this many times previously, but cannot seem to track down what I
> >> am
> >>>>> doing wrong now. I have tried a forced install from sources with and
> >>>>> without dependencies. Below is what I get. Any help is appreciated.
> >>>>>
> >>>>> Tom
> >>>>>
> >>>>>> install.packages("rgdal")
> >>>>> Installing package into
> >> ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> >>>>> (as ?lib? is unspecified)
> >>>>> trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
> >>>>> Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
> >>>>> ==================================================
> >>>>> downloaded 2.2 MB
> >>>>>
> >>>>> * installing *source* package ?rgdal? ...
> >>>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
> >>>>> ** using staged installation
> >>>>> configure: R_HOME: /usr/local/lib/R
> >>>>> configure: CC: gcc
> >>>>> configure: CXX: g++ -std=gnu++11
> >>>>> configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
> >>>>> configure: CXX is: g++ -std=gnu++11
> >>>>> configure: C++11 support available
> >>>>> configure: rgdal: 1.5-12
> >>>>> checking for /usr/bin/svnversion... yes
> >>>>> configure: svn revision: 1018
> >>>>> checking for gdal-config... /usr/local/bin/gdal-config
> >>>>> checking gdal-config usability... yes
> >>>>> configure: GDAL: 3.0.0
> >>>>> checking GDAL version >= 1.11.4... yes
> >>>>> checking GDAL version <= 2.5 or >= 3.0... yes
> >>>>> checking GDAL: linking with --libs only... yes
> >>>>> checking GDAL: gdal-config data directory readable... yes
> >>>>> checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
> >>>>> configure: pkg-config proj exists, will use it
> >>>>> configure: PROJ version: 6.1.0
> >>>>> configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> >>>>> configure: PROJ LIBS: -L/usr/local/lib -lproj
> >>>>> checking PROJ header API:... yes
> >>>>> checking whether the C++ compiler works... yes
> >>>>> checking for C++ compiler default output file name... a.out
> >>>>> checking for suffix of executables...
> >>>>> checking whether we are cross compiling... no
> >>>>> checking for suffix of object files... o
> >>>>> checking whether we are using the GNU C++ compiler... yes
> >>>>> checking whether g++ -std=gnu++11 accepts -g... yes
> >>>>> checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> >>>>> checking for grep that handles long lines and -e... /bin/grep
> >>>>> checking for egrep... /bin/grep -E
> >>>>> checking for ANSI C header files... yes
> >>>>> checking for sys/types.h... yes
> >>>>> checking for sys/stat.h... yes
> >>>>> checking for stdlib.h... yes
> >>>>> checking for string.h... yes
> >>>>> checking for memory.h... yes
> >>>>> checking for strings.h... yes
> >>>>> checking for inttypes.h... yes
> >>>>> checking for stdint.h... yes
> >>>>> checking for unistd.h... yes
> >>>>> checking proj.h usability... yes
> >>>>> checking proj.h presence... yes
> >>>>> checking for proj.h... yes
> >>>>> checking for proj_context_create in -lproj... yes
> >>>>> checking Using GDAL < 3 with PROJ >= 6... no
> >>>>> checking PROJ version >= 4.8.0... yes
> >>>>> checking PROJ: proj.db found and readable... yes
> >>>>> configure: Package CPP flags:  -I/usr/local/include
> >> -I/usr/local/include
> >>>>> -DPROJ_H_API
> >>>>> configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
> >> -lproj
> >>>>> configure: creating ./config.status
> >>>>> config.status: creating src/Makevars
> >>>>> ** libs
> >>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>> -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
> >>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>> -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> >>>>> gdal-bindings.o
> >>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> >>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> >>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o
> local_stubs.o
> >>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>> -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> >>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
> >> ogr_polygons.o
> >>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>> -I/usr/local/include
> >>>>> -I/usr/local/include -DPROJ_H_API
> >>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> >>>>> ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
> >>>>> ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in
> this
> >>>>> scope
> >>>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>>>          ^~~~~~~~~~~~~~~~~
> >>>>> ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
> >>>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>>>          ^~~~~~~~~~~~~~~~~
> >>>>>          OSRProjVersion
> >>>>> /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
> >> failed
> >>>>> make: *** [ogr_proj.o] Error 1
> >>>>> ERROR: compilation failed for package ?rgdal?
> >>>>> * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>>>>
> >>>>> The downloaded source packages are in
> >>>>> ?/tmp/RtmpNkdFOf/downloaded_packages?
> >>>>> Warning message:
> >>>>> In install.packages("rgdal") :
> >>>>>   installation of package ?rgdal? had non-zero exit status
> >>>>>
> >>>>>
> >>>>> --
> >>>>> Thomas E Adams, III
> >>>>> 1724 Sage Lane
> >>>>> Blacksburg, VA 24060
> >>>>> tea3rd at gmail.com (personal)
> >>>>> tea at terrapredictions.org (work)
> >>>>>
> >>>>> 1 (513) 739-9512 (cell)
> >>>>>
> >>>>>         [[alternative HTML version deleted]]
> >>>>>
> >>>>> _______________________________________________
> >>>>> R-sig-Geo mailing list
> >>>>> R-sig-Geo at r-project.org
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>>
> >>>
> >>>
> >>
> >> --
> >> Roger Bivand
> >> Department of Economics, Norwegian School of Economics,
> >> Helleveien 30, N-5045 Bergen, Norway.
> >> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >> https://orcid.org/0000-0003-2392-6140
> >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri Jul  3 12:08:09 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 3 Jul 2020 12:08:09 +0200
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <CAGxgkWjBXnM06E7uT=K4h6b6i4LHLJ2NZWUxrWzj2uNuL1KRFQ@mail.gmail.com>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
 <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
 <CAGxgkWjBXnM06E7uT=K4h6b6i4LHLJ2NZWUxrWzj2uNuL1KRFQ@mail.gmail.com>
Message-ID: <alpine.LFD.2.22.394.2007031206210.3918620@reclus.nhh.no>

On Fri, 3 Jul 2020, Thomas Adams wrote:

> Hi Roger,
>
> I just tried re-installing withou using the argument and got this:

Very useful, thanks - painful but another case of staying too close to the 
front. proj_create_crs_to_crs_from_pj() was new in PROJ 6.2.0. I'll try to 
adapt to accommodate older PROJ 6.

Roger

>
> teaiii at teaiii-Leopard-WS:~$ sudo R CMD INSTALL rgdal_1.5-13.tar.gz
> * installing to library ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> * installing *source* package ?rgdal? ...
> ** using staged installation
> configure: R_HOME: /usr/local/lib/R
> configure: CC: gcc
> configure: CXX: g++ -std=gnu++11
> configure: CFLAGS: -g -O2
> configure: CPPFLAGS: -I/usr/local/include
> configure: CXXFLAGS: -g -O2
> configure: LDFLAGS: -L/usr/local/lib
> configure: LDFLAGS: -L/usr/local/lib
> configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
> configure: CXX is: g++ -std=gnu++11
> configure: C++11 support available
> configure: rgdal: 1.5-13
> checking for /usr/bin/svnversion... yes
> cat: inst/SVN_VERSION: No such file or directory
> configure: svn revision:
> checking for gdal-config... /usr/local/bin/gdal-config
> checking gdal-config usability... yes
> configure: GDAL: 3.0.0
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking GDAL: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
> configure: pkg-config proj exists, will use it
> configure: PROJ version: 6.1.0
> configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> configure: PROJ LIBS: -L/usr/local/lib -lproj
> checking PROJ header API:... yes
> checking whether the C++ compiler works... yes
> checking for C++ compiler default output file name... a.out
> checking for suffix of executables...
> checking whether we are cross compiling... no
> checking for suffix of object files... o
> checking whether we are using the GNU C++ compiler... yes
> checking whether g++ -std=gnu++11 accepts -g... yes
> checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> checking for grep that handles long lines and -e... /bin/grep
> checking for egrep... /bin/grep -E
> checking for ANSI C header files... yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking proj.h usability... yes
> checking proj.h presence... yes
> checking for proj.h... yes
> checking for proj_context_create in -lproj... yes
> checking Using GDAL < 3 with PROJ >= 6... no
> checking PROJ version >= 4.8.0... yes
> checking PROJ: proj.db found and readable... yes
> configure: Package CPP flags:  -I/usr/local/include -I/usr/local/include
> -DPROJ_H_API
> configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib -lproj
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> gdal-bindings.o
> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o ogr_polygons.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c ogrsource.cpp -o ogrsource.o
> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> -I/usr/local/include -DPROJ_H_API
> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> -I/usr/local/include   -fpic  -g -O2  -c proj6.cpp -o proj6.o
> proj6.cpp: In function ?SEXPREC* transform_ng(SEXP, SEXP, SEXP, SEXP, SEXP,
> SEXP, SEXP)?:
> proj6.cpp:521:29: error: ?proj_create_crs_to_crs_from_pj? was not declared
> in this scope
>         if ((pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> source_crs,
>                             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> proj6.cpp:521:29: note: suggested alternative: ?proj_create_crs_to_crs?
>         if ((pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> source_crs,
>                             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>                             proj_create_crs_to_crs
> proj6.cpp: In function ?SEXPREC* project_ng_coordOp(SEXP, SEXP)?:
> proj6.cpp:704:33: error: ?proj_create_crs_to_crs_from_pj? was not declared
> in this scope
>     if (use_inv) pj_transform =
> proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
>                                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> proj6.cpp:704:33: note: suggested alternative: ?proj_create_crs_to_crs?
>     if (use_inv) pj_transform =
> proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
>                                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>                                 proj_create_crs_to_crs
> proj6.cpp:706:25: error: ?proj_create_crs_to_crs_from_pj? was not declared
> in this scope
>     else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> source_crs,
>                         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> proj6.cpp:706:25: note: suggested alternative: ?proj_create_crs_to_crs?
>     else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> source_crs,
>                         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>                         proj_create_crs_to_crs
> /usr/local/lib/R/etc/Makeconf:176: recipe for target 'proj6.o' failed
> make: *** [proj6.o] Error 1
> ERROR: compilation failed for package ?rgdal?
> * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> * restoring previous ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>
> On Fri, Jul 3, 2020 at 5:45 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Thu, 2 Jul 2020, Thomas Adams wrote:
>>
>>> Roger,
>>>
>>> Thank you so much; after downloading the *.tar.gz file, the that did the
>>> trick, using:
>>>
>>> sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
>>> rgdal_1.5-13.tar.gz
>>
>> Since you have GDAL: 3.0.0 and PROJ version: 6.1.0, you can drop
>> --configure-args=--with-proj_api="proj_api.h", which is only needed if
>> GDAL < 3 and PROJ >= 6. I'm uncertain how stable a system will be if GDAL
>>> = 3 && PROJ >= 6 with this configure argument, as it is only a
>> work-around for systems with GDAL < 3 and PROJ >= 6, and onnly tested in
>> that setting.
>>
>> Thanks for reporting back!
>>
>> Roger
>>
>>>
>>> Best regards!
>>> Tom
>>>
>>>
>>> On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>
>>>> On Thu, 2 Jul 2020, Thomas Adams wrote:
>>>>
>>>>> Hi Bennet!
>>>>>
>>>>> Thank you for your help, but I get the same error...
>>>>
>>>> Tom,
>>>>
>>>> Once rgdal revision 1029 completes building (check first) on:
>>>>
>>>> https://r-forge.r-project.org/R/?group_id=884
>>>>
>>>> please re-try. The missing function is not in the GDAL 3.0.0 headers,
>> but
>>>> is in the 3.0.1 headers. I've modified the check so as not to try for
>> just
>>>>> = 3 to >= 3.0.1.
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Tom
>>>>>
>>>>> On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu> wrote:
>>>>>
>>>>>> You might try this
>>>>>>
>>>>>> install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
>>>>>> repos="http://R-Forge.R-project.org")
>>>>>>
>>>>>> as there have been recent patches to rgdal that might help that have
>>>>>> been incorporated there.
>>>>>>
>>>>>>
>>>>>> On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
>>>>>>>
>>>>>>> Hi all,
>>>>>>>
>>>>>>> I have searched the internet and have spent a few days trying to get
>> to
>>>>>> the
>>>>>>> problem when I try to install rgdal into my Ubuntu 18.04 system. I
>> have
>>>>>>> done this many times previously, but cannot seem to track down what I
>>>> am
>>>>>>> doing wrong now. I have tried a forced install from sources with and
>>>>>>> without dependencies. Below is what I get. Any help is appreciated.
>>>>>>>
>>>>>>> Tom
>>>>>>>
>>>>>>>> install.packages("rgdal")
>>>>>>> Installing package into
>>>> ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
>>>>>>> (as ?lib? is unspecified)
>>>>>>> trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
>>>>>>> Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
>>>>>>> ==================================================
>>>>>>> downloaded 2.2 MB
>>>>>>>
>>>>>>> * installing *source* package ?rgdal? ...
>>>>>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>>>>>> ** using staged installation
>>>>>>> configure: R_HOME: /usr/local/lib/R
>>>>>>> configure: CC: gcc
>>>>>>> configure: CXX: g++ -std=gnu++11
>>>>>>> configure: CXX11 is: g++, CXX11STD is: -std=gnu++11
>>>>>>> configure: CXX is: g++ -std=gnu++11
>>>>>>> configure: C++11 support available
>>>>>>> configure: rgdal: 1.5-12
>>>>>>> checking for /usr/bin/svnversion... yes
>>>>>>> configure: svn revision: 1018
>>>>>>> checking for gdal-config... /usr/local/bin/gdal-config
>>>>>>> checking gdal-config usability... yes
>>>>>>> configure: GDAL: 3.0.0
>>>>>>> checking GDAL version >= 1.11.4... yes
>>>>>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>>>>>> checking GDAL: linking with --libs only... yes
>>>>>>> checking GDAL: gdal-config data directory readable... yes
>>>>>>> checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
>>>>>>> configure: pkg-config proj exists, will use it
>>>>>>> configure: PROJ version: 6.1.0
>>>>>>> configure: PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
>>>>>>> configure: PROJ LIBS: -L/usr/local/lib -lproj
>>>>>>> checking PROJ header API:... yes
>>>>>>> checking whether the C++ compiler works... yes
>>>>>>> checking for C++ compiler default output file name... a.out
>>>>>>> checking for suffix of executables...
>>>>>>> checking whether we are cross compiling... no
>>>>>>> checking for suffix of object files... o
>>>>>>> checking whether we are using the GNU C++ compiler... yes
>>>>>>> checking whether g++ -std=gnu++11 accepts -g... yes
>>>>>>> checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
>>>>>>> checking for grep that handles long lines and -e... /bin/grep
>>>>>>> checking for egrep... /bin/grep -E
>>>>>>> checking for ANSI C header files... yes
>>>>>>> checking for sys/types.h... yes
>>>>>>> checking for sys/stat.h... yes
>>>>>>> checking for stdlib.h... yes
>>>>>>> checking for string.h... yes
>>>>>>> checking for memory.h... yes
>>>>>>> checking for strings.h... yes
>>>>>>> checking for inttypes.h... yes
>>>>>>> checking for stdint.h... yes
>>>>>>> checking for unistd.h... yes
>>>>>>> checking proj.h usability... yes
>>>>>>> checking proj.h presence... yes
>>>>>>> checking for proj.h... yes
>>>>>>> checking for proj_context_create in -lproj... yes
>>>>>>> checking Using GDAL < 3 with PROJ >= 6... no
>>>>>>> checking PROJ version >= 4.8.0... yes
>>>>>>> checking PROJ: proj.db found and readable... yes
>>>>>>> configure: Package CPP flags:  -I/usr/local/include
>>>> -I/usr/local/include
>>>>>>> -DPROJ_H_API
>>>>>>> configure: Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
>>>> -lproj
>>>>>>> configure: creating ./config.status
>>>>>>> config.status: creating src/Makevars
>>>>>>> ** libs
>>>>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>> -I/usr/local/include
>>>>>>> -I/usr/local/include -DPROJ_H_API
>>>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>> -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
>>>>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>> -I/usr/local/include
>>>>>>> -I/usr/local/include -DPROJ_H_API
>>>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>> -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
>>>>>>> gdal-bindings.o
>>>>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>> -I/usr/local/include -DPROJ_H_API
>>>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>> -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
>>>>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>> -I/usr/local/include -DPROJ_H_API
>>>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>> -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
>>>>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>> -I/usr/local/include -DPROJ_H_API
>>>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>> -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o
>> local_stubs.o
>>>>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>> -I/usr/local/include
>>>>>>> -I/usr/local/include -DPROJ_H_API
>>>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
>>>>>>> gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>> -I/usr/local/include -DPROJ_H_API
>>>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
>>>> ogr_polygons.o
>>>>>>> g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>> -I/usr/local/include
>>>>>>> -I/usr/local/include -DPROJ_H_API
>>>>>>> -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>> -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
>>>>>>> ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
>>>>>>> ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in
>> this
>>>>>>> scope
>>>>>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>>>>>          ^~~~~~~~~~~~~~~~~
>>>>>>> ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
>>>>>>>          OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>>>>>          ^~~~~~~~~~~~~~~~~
>>>>>>>          OSRProjVersion
>>>>>>> /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
>>>> failed
>>>>>>> make: *** [ogr_proj.o] Error 1
>>>>>>> ERROR: compilation failed for package ?rgdal?
>>>>>>> * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>>>>>>
>>>>>>> The downloaded source packages are in
>>>>>>> ?/tmp/RtmpNkdFOf/downloaded_packages?
>>>>>>> Warning message:
>>>>>>> In install.packages("rgdal") :
>>>>>>>   installation of package ?rgdal? had non-zero exit status
>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> Thomas E Adams, III
>>>>>>> 1724 Sage Lane
>>>>>>> Blacksburg, VA 24060
>>>>>>> tea3rd at gmail.com (personal)
>>>>>>> tea at terrapredictions.org (work)
>>>>>>>
>>>>>>> 1 (513) 739-9512 (cell)
>>>>>>>
>>>>>>>         [[alternative HTML version deleted]]
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Department of Economics, Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>> https://orcid.org/0000-0003-2392-6140
>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From t|m@how@rd @end|ng |rom dec@ny@gov  Fri Jul  3 16:27:13 2020
From: t|m@how@rd @end|ng |rom dec@ny@gov (Howard, Tim G (DEC))
Date: Fri, 3 Jul 2020 14:27:13 +0000
Subject: [R-sig-Geo] creating spatial metadata: best tools/approach?
Message-ID: <DM6PR09MB3353E54790B25CCAE2CDB8AAA86A0@DM6PR09MB3353.namprd09.prod.outlook.com>

All, 
I need to create XML metadata for some of my outputs (mostly rasters) following the US government standard (FGDC):

https://www.fgdc.gov/standards/projects/FGDC-standards-projects/metadata/base-metadata/index_html

In researching what my options are in R, I have found EML:

https://github.com/ropensci/EML

and the spMetadata function in plotKML:

http://plotkml.r-forge.r-project.org/spMetadata.html

and, of course, I could use the XML package to simply build and write my own xml. 

https://cran.r-project.org/web/packages/XML/index.html

Does this group have any suggestions as to the most robust and efficient way to accomplish this? Or positive or negative experiences to share? I'm tempted to just use the XML package as then I'll have the most control, but I don't want to be missing anything before I start down that path. 

Thanks in advance, 
Tim



From Roger@B|v@nd @end|ng |rom nhh@no  Fri Jul  3 17:24:00 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 3 Jul 2020 17:24:00 +0200
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <alpine.LFD.2.22.394.2007031206210.3918620@reclus.nhh.no>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
 <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
 <CAGxgkWjBXnM06E7uT=K4h6b6i4LHLJ2NZWUxrWzj2uNuL1KRFQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031206210.3918620@reclus.nhh.no>
Message-ID: <alpine.LFD.2.22.394.2007031721090.3922277@reclus.nhh.no>

On Fri, 3 Jul 2020, Roger Bivand wrote:

> On Fri, 3 Jul 2020, Thomas Adams wrote:
>
>>  Hi Roger,
>>
>>  I just tried re-installing withou using the argument and got this:
>
> Very useful, thanks - painful but another case of staying too close to the 
> front. proj_create_crs_to_crs_from_pj() was new in PROJ 6.2.0. I'll try to 
> adapt to accommodate older PROJ 6.

Re-creating a GDAL 3.0.0 with PROJ 6.1.0 platform has thrown up another 
issue which which I'm struggling. I'll try to resolve it, but until then 
advice would be to update GDAL and PROJ to 3.0.4 and 6.3.1, which we know 
work (those are the versions in the CRAN Windows binary).

Roger

>
> Roger
>
>>
>>  teaiii at teaiii-Leopard-WS:~$ sudo R CMD INSTALL rgdal_1.5-13.tar.gz
>>  * installing to library ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
>>  * installing *source* package ?rgdal? ...
>>  ** using staged installation
>> configure:  R_HOME: /usr/local/lib/R
>> configure:  CC: gcc
>> configure:  CXX: g++ -std=gnu++11
>> configure:  CFLAGS: -g -O2
>> configure:  CPPFLAGS: -I/usr/local/include
>> configure:  CXXFLAGS: -g -O2
>> configure: LDFLAGS:  -L/usr/local/lib
>> configure: LDFLAGS:  -L/usr/local/lib
>> configure:  CXX11 is: g++, CXX11STD is: -std=gnu++11
>> configure:  CXX is: g++ -std=gnu++11
>> configure:  C++11 support available
>> configure:  rgdal: 1.5-13
>>  checking for /usr/bin/svnversion... yes
>>  cat: inst/SVN_VERSION: No such file or directory
>> configure:  svn revision:
>>  checking for gdal-config... /usr/local/bin/gdal-config
>>  checking gdal-config usability... yes
>> configure:  GDAL: 3.0.0
>>  checking GDAL version >= 1.11.4... yes
>>  checking GDAL version <= 2.5 or >= 3.0... yes
>>  checking GDAL: linking with --libs only... yes
>>  checking GDAL: gdal-config data directory readable... yes
>>  checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
>> configure:  pkg-config proj exists, will use it
>> configure:  PROJ version: 6.1.0
>> configure:  PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
>> configure:  PROJ LIBS: -L/usr/local/lib -lproj
>>  checking PROJ header API:... yes
>>  checking whether the C++ compiler works... yes
>>  checking for C++ compiler default output file name... a.out
>>  checking for suffix of executables...
>>  checking whether we are cross compiling... no
>>  checking for suffix of object files... o
>>  checking whether we are using the GNU C++ compiler... yes
>>  checking whether g++ -std=gnu++11 accepts -g... yes
>>  checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
>>  checking for grep that handles long lines and -e... /bin/grep
>>  checking for egrep... /bin/grep -E
>>  checking for ANSI C header files... yes
>>  checking for sys/types.h... yes
>>  checking for sys/stat.h... yes
>>  checking for stdlib.h... yes
>>  checking for string.h... yes
>>  checking for memory.h... yes
>>  checking for strings.h... yes
>>  checking for inttypes.h... yes
>>  checking for stdint.h... yes
>>  checking for unistd.h... yes
>>  checking proj.h usability... yes
>>  checking proj.h presence... yes
>>  checking for proj.h... yes
>>  checking for proj_context_create in -lproj... yes
>>  checking Using GDAL < 3 with PROJ >= 6... no
>>  checking PROJ version >= 4.8.0... yes
>>  checking PROJ: proj.db found and readable... yes
>> configure:  Package CPP flags:  -I/usr/local/include -I/usr/local/include
>>  -DPROJ_H_API
>> configure:  Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib -lproj
>> configure:  creating ./config.status
>>  config.status: creating src/Makevars
>>  ** libs
>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>  -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>  -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
>>  gdal-bindings.o
>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>  -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o ogr_polygons.o
>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>  -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>  -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>  -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c ogrsource.cpp -o ogrsource.o
>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>  -I/usr/local/include
>>  -I/usr/local/include -DPROJ_H_API
>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>  -I/usr/local/include   -fpic  -g -O2  -c proj6.cpp -o proj6.o
>>  proj6.cpp: In function ?SEXPREC* transform_ng(SEXP, SEXP, SEXP, SEXP,
>>  SEXP,
>>  SEXP, SEXP)?:
>>  proj6.cpp:521:29: error: ?proj_create_crs_to_crs_from_pj? was not declared
>>  in this scope
>>          if ((pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
>>  source_crs,
>>                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>  proj6.cpp:521:29: note: suggested alternative: ?proj_create_crs_to_crs?
>>          if ((pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
>>  source_crs,
>>                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>                              proj_create_crs_to_crs
>>  proj6.cpp: In function ?SEXPREC* project_ng_coordOp(SEXP, SEXP)?:
>>  proj6.cpp:704:33: error: ?proj_create_crs_to_crs_from_pj? was not declared
>>  in this scope
>>      if (use_inv) pj_transform =
>>  proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
>>                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>  proj6.cpp:704:33: note: suggested alternative: ?proj_create_crs_to_crs?
>>      if (use_inv) pj_transform =
>>  proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
>>                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>                                  proj_create_crs_to_crs
>>  proj6.cpp:706:25: error: ?proj_create_crs_to_crs_from_pj? was not declared
>>  in this scope
>>      else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
>>  source_crs,
>>                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>  proj6.cpp:706:25: note: suggested alternative: ?proj_create_crs_to_crs?
>>      else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
>>  source_crs,
>>                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>                          proj_create_crs_to_crs
>>  /usr/local/lib/R/etc/Makeconf:176: recipe for target 'proj6.o' failed
>>  make: *** [proj6.o] Error 1
>>  ERROR: compilation failed for package ?rgdal?
>>  * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>  * restoring previous
>>  ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>
>>  On Fri, Jul 3, 2020 at 5:45 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>>>  On Thu, 2 Jul 2020, Thomas Adams wrote:
>>>
>>>>  Roger,
>>>>
>>>>  Thank you so much; after downloading the *.tar.gz file, the that did the
>>>>  trick, using:
>>>>
>>>>  sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
>>>>  rgdal_1.5-13.tar.gz
>>>
>>>  Since you have GDAL: 3.0.0 and PROJ version: 6.1.0, you can drop
>>>  --configure-args=--with-proj_api="proj_api.h", which is only needed if
>>>  GDAL < 3 and PROJ >= 6. I'm uncertain how stable a system will be if GDAL
>>>>  = 3 && PROJ >= 6 with this configure argument, as it is only a
>>>  work-around for systems with GDAL < 3 and PROJ >= 6, and onnly tested in
>>>  that setting.
>>>
>>>  Thanks for reporting back!
>>>
>>>  Roger
>>> 
>>>>
>>>>  Best regards!
>>>>  Tom
>>>> 
>>>>
>>>>  On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>
>>>>>  On Thu, 2 Jul 2020, Thomas Adams wrote:
>>>>>
>>>>>>  Hi Bennet!
>>>>>>
>>>>>>  Thank you for your help, but I get the same error...
>>>>>
>>>>>  Tom,
>>>>>
>>>>>  Once rgdal revision 1029 completes building (check first) on:
>>>>>
>>>>>  https://r-forge.r-project.org/R/?group_id=884
>>>>>
>>>>>  please re-try. The missing function is not in the GDAL 3.0.0 headers,
>>>  but
>>>>>  is in the 3.0.1 headers. I've modified the check so as not to try for
>>>  just
>>>>>>  = 3 to >= 3.0.1.
>>>>>
>>>>>  Roger
>>>>> 
>>>>>>
>>>>>>  Tom
>>>>>>
>>>>>>  On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu> wrote:
>>>>>>
>>>>>>>  You might try this
>>>>>>>
>>>>>>>  install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
>>>>>>>  repos="http://R-Forge.R-project.org")
>>>>>>>
>>>>>>>  as there have been recent patches to rgdal that might help that have
>>>>>>>  been incorporated there.
>>>>>>> 
>>>>>>>
>>>>>>>  On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com> wrote:
>>>>>>>>
>>>>>>>>  Hi all,
>>>>>>>>
>>>>>>>>  I have searched the internet and have spent a few days trying to get
>>>  to
>>>>>>>  the
>>>>>>>>  problem when I try to install rgdal into my Ubuntu 18.04 system. I
>>>  have
>>>>>>>>  done this many times previously, but cannot seem to track down what
>>>>>>>>  I
>>>>>  am
>>>>>>>>  doing wrong now. I have tried a forced install from sources with and
>>>>>>>>  without dependencies. Below is what I get. Any help is appreciated.
>>>>>>>>
>>>>>>>>  Tom
>>>>>>>>
>>>>>>>>>  install.packages("rgdal")
>>>>>>>>  Installing package into
>>>>>  ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
>>>>>>>>  (as ?lib? is unspecified)
>>>>>>>>  trying URL 'https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
>>>>>>>>  Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
>>>>>>>>  ==================================================
>>>>>>>>  downloaded 2.2 MB
>>>>>>>>
>>>>>>>>  * installing *source* package ?rgdal? ...
>>>>>>>>  ** package ?rgdal? successfully unpacked and MD5 sums checked
>>>>>>>>  ** using staged installation
>>>>>>>> configure:  R_HOME: /usr/local/lib/R
>>>>>>>> configure:  CC: gcc
>>>>>>>> configure:  CXX: g++ -std=gnu++11
>>>>>>>> configure:  CXX11 is: g++, CXX11STD is: -std=gnu++11
>>>>>>>> configure:  CXX is: g++ -std=gnu++11
>>>>>>>> configure:  C++11 support available
>>>>>>>> configure:  rgdal: 1.5-12
>>>>>>>>  checking for /usr/bin/svnversion... yes
>>>>>>>> configure:  svn revision: 1018
>>>>>>>>  checking for gdal-config... /usr/local/bin/gdal-config
>>>>>>>>  checking gdal-config usability... yes
>>>>>>>> configure:  GDAL: 3.0.0
>>>>>>>>  checking GDAL version >= 1.11.4... yes
>>>>>>>>  checking GDAL version <= 2.5 or >= 3.0... yes
>>>>>>>>  checking GDAL: linking with --libs only... yes
>>>>>>>>  checking GDAL: gdal-config data directory readable... yes
>>>>>>>>  checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
>>>>>>>> configure:  pkg-config proj exists, will use it
>>>>>>>> configure:  PROJ version: 6.1.0
>>>>>>>> configure:  PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
>>>>>>>> configure:  PROJ LIBS: -L/usr/local/lib -lproj
>>>>>>>>  checking PROJ header API:... yes
>>>>>>>>  checking whether the C++ compiler works... yes
>>>>>>>>  checking for C++ compiler default output file name... a.out
>>>>>>>>  checking for suffix of executables...
>>>>>>>>  checking whether we are cross compiling... no
>>>>>>>>  checking for suffix of object files... o
>>>>>>>>  checking whether we are using the GNU C++ compiler... yes
>>>>>>>>  checking whether g++ -std=gnu++11 accepts -g... yes
>>>>>>>>  checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
>>>>>>>>  checking for grep that handles long lines and -e... /bin/grep
>>>>>>>>  checking for egrep... /bin/grep -E
>>>>>>>>  checking for ANSI C header files... yes
>>>>>>>>  checking for sys/types.h... yes
>>>>>>>>  checking for sys/stat.h... yes
>>>>>>>>  checking for stdlib.h... yes
>>>>>>>>  checking for string.h... yes
>>>>>>>>  checking for memory.h... yes
>>>>>>>>  checking for strings.h... yes
>>>>>>>>  checking for inttypes.h... yes
>>>>>>>>  checking for stdint.h... yes
>>>>>>>>  checking for unistd.h... yes
>>>>>>>>  checking proj.h usability... yes
>>>>>>>>  checking proj.h presence... yes
>>>>>>>>  checking for proj.h... yes
>>>>>>>>  checking for proj_context_create in -lproj... yes
>>>>>>>>  checking Using GDAL < 3 with PROJ >= 6... no
>>>>>>>>  checking PROJ version >= 4.8.0... yes
>>>>>>>>  checking PROJ: proj.db found and readable... yes
>>>>>>>> configure:  Package CPP flags:  -I/usr/local/include
>>>>>  -I/usr/local/include
>>>>>>>>  -DPROJ_H_API
>>>>>>>> configure:  Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
>>>>>  -lproj
>>>>>>>> configure:  creating ./config.status
>>>>>>>>  config.status: creating src/Makevars
>>>>>>>>  ** libs
>>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>>>  -I/usr/local/include
>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o
>>>>>>>>  OGR_write.o
>>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>>>  -I/usr/local/include
>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
>>>>>>>>  gdal-bindings.o
>>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
>>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
>>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o
>>>  local_stubs.o
>>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>>>  -I/usr/local/include
>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
>>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
>>>>>  ogr_polygons.o
>>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>>>  -I/usr/local/include
>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
>>>>>>>>  ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
>>>>>>>>  ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared in
>>>  this
>>>>>>>>  scope
>>>>>>>>           OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>>>>>>           ^~~~~~~~~~~~~~~~~
>>>>>>>>  ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
>>>>>>>>           OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>>>>>>           ^~~~~~~~~~~~~~~~~
>>>>>>>>           OSRProjVersion
>>>>>>>>  /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
>>>>>  failed
>>>>>>>>  make: *** [ogr_proj.o] Error 1
>>>>>>>>  ERROR: compilation failed for package ?rgdal?
>>>>>>>>  * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>>>>>>>
>>>>>>>>  The downloaded source packages are in
>>>>>>>>  ?/tmp/RtmpNkdFOf/downloaded_packages?
>>>>>>>>  Warning message:
>>>>>>>>  In install.packages("rgdal") :
>>>>>>>>    installation of package ?rgdal? had non-zero exit status
>>>>>>>> 
>>>>>>>>
>>>>>>>>  --
>>>>>>>>  Thomas E Adams, III
>>>>>>>>  1724 Sage Lane
>>>>>>>>  Blacksburg, VA 24060
>>>>>>>>  tea3rd at gmail.com (personal)
>>>>>>>>  tea at terrapredictions.org (work)
>>>>>>>>
>>>>>>>>  1 (513) 739-9512 (cell)
>>>>>>>>
>>>>>>>>          [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>>  _______________________________________________
>>>>>>>>  R-sig-Geo mailing list
>>>>>>>>  R-sig-Geo at r-project.org
>>>>>>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>
>>>>>  --
>>>>>  Roger Bivand
>>>>>  Department of Economics, Norwegian School of Economics,
>>>>>  Helleveien 30, N-5045 Bergen, Norway.
>>>>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>>>  https://orcid.org/0000-0003-2392-6140
>>>>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>> 
>>>> 
>>>> 
>>>> 
>>>
>>>  --
>>>  Roger Bivand
>>>  Department of Economics, Norwegian School of Economics,
>>>  Helleveien 30, N-5045 Bergen, Norway.
>>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>  https://orcid.org/0000-0003-2392-6140
>>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> 
>> 
>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From te@3rd @end|ng |rom gm@||@com  Fri Jul  3 17:54:59 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Fri, 3 Jul 2020 11:54:59 -0400
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <alpine.LFD.2.22.394.2007031721090.3922277@reclus.nhh.no>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
 <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
 <CAGxgkWjBXnM06E7uT=K4h6b6i4LHLJ2NZWUxrWzj2uNuL1KRFQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031206210.3918620@reclus.nhh.no>
 <alpine.LFD.2.22.394.2007031721090.3922277@reclus.nhh.no>
Message-ID: <CAGxgkWiTL_anjc5TWEQyVkX_-fYowcFg3-4SPzswPwxyMOku0Q@mail.gmail.com>

Roger,

OK; I'll update GDAL and PROJ to 3.0.4 and 6.3.1 and get back to you... you
anticipated my question... thank you!

Best,
Tom

On Fri, Jul 3, 2020 at 11:24 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Fri, 3 Jul 2020, Roger Bivand wrote:
>
> > On Fri, 3 Jul 2020, Thomas Adams wrote:
> >
> >>  Hi Roger,
> >>
> >>  I just tried re-installing withou using the argument and got this:
> >
> > Very useful, thanks - painful but another case of staying too close to
> the
> > front. proj_create_crs_to_crs_from_pj() was new in PROJ 6.2.0. I'll try
> to
> > adapt to accommodate older PROJ 6.
>
> Re-creating a GDAL 3.0.0 with PROJ 6.1.0 platform has thrown up another
> issue which which I'm struggling. I'll try to resolve it, but until then
> advice would be to update GDAL and PROJ to 3.0.4 and 6.3.1, which we know
> work (those are the versions in the CRAN Windows binary).
>
> Roger
>
> >
> > Roger
> >
> >>
> >>  teaiii at teaiii-Leopard-WS:~$ sudo R CMD INSTALL rgdal_1.5-13.tar.gz
> >>  * installing to library
> ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> >>  * installing *source* package ?rgdal? ...
> >>  ** using staged installation
> >> configure:  R_HOME: /usr/local/lib/R
> >> configure:  CC: gcc
> >> configure:  CXX: g++ -std=gnu++11
> >> configure:  CFLAGS: -g -O2
> >> configure:  CPPFLAGS: -I/usr/local/include
> >> configure:  CXXFLAGS: -g -O2
> >> configure: LDFLAGS:  -L/usr/local/lib
> >> configure: LDFLAGS:  -L/usr/local/lib
> >> configure:  CXX11 is: g++, CXX11STD is: -std=gnu++11
> >> configure:  CXX is: g++ -std=gnu++11
> >> configure:  C++11 support available
> >> configure:  rgdal: 1.5-13
> >>  checking for /usr/bin/svnversion... yes
> >>  cat: inst/SVN_VERSION: No such file or directory
> >> configure:  svn revision:
> >>  checking for gdal-config... /usr/local/bin/gdal-config
> >>  checking gdal-config usability... yes
> >> configure:  GDAL: 3.0.0
> >>  checking GDAL version >= 1.11.4... yes
> >>  checking GDAL version <= 2.5 or >= 3.0... yes
> >>  checking GDAL: linking with --libs only... yes
> >>  checking GDAL: gdal-config data directory readable... yes
> >>  checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
> >> configure:  pkg-config proj exists, will use it
> >> configure:  PROJ version: 6.1.0
> >> configure:  PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> >> configure:  PROJ LIBS: -L/usr/local/lib -lproj
> >>  checking PROJ header API:... yes
> >>  checking whether the C++ compiler works... yes
> >>  checking for C++ compiler default output file name... a.out
> >>  checking for suffix of executables...
> >>  checking whether we are cross compiling... no
> >>  checking for suffix of object files... o
> >>  checking whether we are using the GNU C++ compiler... yes
> >>  checking whether g++ -std=gnu++11 accepts -g... yes
> >>  checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> >>  checking for grep that handles long lines and -e... /bin/grep
> >>  checking for egrep... /bin/grep -E
> >>  checking for ANSI C header files... yes
> >>  checking for sys/types.h... yes
> >>  checking for sys/stat.h... yes
> >>  checking for stdlib.h... yes
> >>  checking for string.h... yes
> >>  checking for memory.h... yes
> >>  checking for strings.h... yes
> >>  checking for inttypes.h... yes
> >>  checking for stdint.h... yes
> >>  checking for unistd.h... yes
> >>  checking proj.h usability... yes
> >>  checking proj.h presence... yes
> >>  checking for proj.h... yes
> >>  checking for proj_context_create in -lproj... yes
> >>  checking Using GDAL < 3 with PROJ >= 6... no
> >>  checking PROJ version >= 4.8.0... yes
> >>  checking PROJ: proj.db found and readable... yes
> >> configure:  Package CPP flags:  -I/usr/local/include
> -I/usr/local/include
> >>  -DPROJ_H_API
> >> configure:  Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
> -lproj
> >> configure:  creating ./config.status
> >>  config.status: creating src/Makevars
> >>  ** libs
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> >>  gdal-bindings.o
> >>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> >>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> >>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> >>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
> ogr_polygons.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogrsource.cpp -o ogrsource.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c proj6.cpp -o proj6.o
> >>  proj6.cpp: In function ?SEXPREC* transform_ng(SEXP, SEXP, SEXP, SEXP,
> >>  SEXP,
> >>  SEXP, SEXP)?:
> >>  proj6.cpp:521:29: error: ?proj_create_crs_to_crs_from_pj? was not
> declared
> >>  in this scope
> >>          if ((pj_transform =
> proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> >>  source_crs,
> >>                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>  proj6.cpp:521:29: note: suggested alternative: ?proj_create_crs_to_crs?
> >>          if ((pj_transform =
> proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> >>  source_crs,
> >>                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>                              proj_create_crs_to_crs
> >>  proj6.cpp: In function ?SEXPREC* project_ng_coordOp(SEXP, SEXP)?:
> >>  proj6.cpp:704:33: error: ?proj_create_crs_to_crs_from_pj? was not
> declared
> >>  in this scope
> >>      if (use_inv) pj_transform =
> >>  proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
> >>                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>  proj6.cpp:704:33: note: suggested alternative: ?proj_create_crs_to_crs?
> >>      if (use_inv) pj_transform =
> >>  proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
> >>                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>                                  proj_create_crs_to_crs
> >>  proj6.cpp:706:25: error: ?proj_create_crs_to_crs_from_pj? was not
> declared
> >>  in this scope
> >>      else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> >>  source_crs,
> >>                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>  proj6.cpp:706:25: note: suggested alternative: ?proj_create_crs_to_crs?
> >>      else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> >>  source_crs,
> >>                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>                          proj_create_crs_to_crs
> >>  /usr/local/lib/R/etc/Makeconf:176: recipe for target 'proj6.o' failed
> >>  make: *** [proj6.o] Error 1
> >>  ERROR: compilation failed for package ?rgdal?
> >>  * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>  * restoring previous
> >>  ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>
> >>  On Fri, Jul 3, 2020 at 5:45 AM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >>
> >>>  On Thu, 2 Jul 2020, Thomas Adams wrote:
> >>>
> >>>>  Roger,
> >>>>
> >>>>  Thank you so much; after downloading the *.tar.gz file, the that did
> the
> >>>>  trick, using:
> >>>>
> >>>>  sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
> >>>>  rgdal_1.5-13.tar.gz
> >>>
> >>>  Since you have GDAL: 3.0.0 and PROJ version: 6.1.0, you can drop
> >>>  --configure-args=--with-proj_api="proj_api.h", which is only needed if
> >>>  GDAL < 3 and PROJ >= 6. I'm uncertain how stable a system will be if
> GDAL
> >>>>  = 3 && PROJ >= 6 with this configure argument, as it is only a
> >>>  work-around for systems with GDAL < 3 and PROJ >= 6, and onnly tested
> in
> >>>  that setting.
> >>>
> >>>  Thanks for reporting back!
> >>>
> >>>  Roger
> >>>
> >>>>
> >>>>  Best regards!
> >>>>  Tom
> >>>>
> >>>>
> >>>>  On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >>>>
> >>>>>  On Thu, 2 Jul 2020, Thomas Adams wrote:
> >>>>>
> >>>>>>  Hi Bennet!
> >>>>>>
> >>>>>>  Thank you for your help, but I get the same error...
> >>>>>
> >>>>>  Tom,
> >>>>>
> >>>>>  Once rgdal revision 1029 completes building (check first) on:
> >>>>>
> >>>>>  https://r-forge.r-project.org/R/?group_id=884
> >>>>>
> >>>>>  please re-try. The missing function is not in the GDAL 3.0.0
> headers,
> >>>  but
> >>>>>  is in the 3.0.1 headers. I've modified the check so as not to try
> for
> >>>  just
> >>>>>>  = 3 to >= 3.0.1.
> >>>>>
> >>>>>  Roger
> >>>>>
> >>>>>>
> >>>>>>  Tom
> >>>>>>
> >>>>>>  On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu>
> wrote:
> >>>>>>
> >>>>>>>  You might try this
> >>>>>>>
> >>>>>>>  install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
> >>>>>>>  repos="http://R-Forge.R-project.org")
> >>>>>>>
> >>>>>>>  as there have been recent patches to rgdal that might help that
> have
> >>>>>>>  been incorporated there.
> >>>>>>>
> >>>>>>>
> >>>>>>>  On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com>
> wrote:
> >>>>>>>>
> >>>>>>>>  Hi all,
> >>>>>>>>
> >>>>>>>>  I have searched the internet and have spent a few days trying to
> get
> >>>  to
> >>>>>>>  the
> >>>>>>>>  problem when I try to install rgdal into my Ubuntu 18.04 system.
> I
> >>>  have
> >>>>>>>>  done this many times previously, but cannot seem to track down
> what
> >>>>>>>>  I
> >>>>>  am
> >>>>>>>>  doing wrong now. I have tried a forced install from sources with
> and
> >>>>>>>>  without dependencies. Below is what I get. Any help is
> appreciated.
> >>>>>>>>
> >>>>>>>>  Tom
> >>>>>>>>
> >>>>>>>>>  install.packages("rgdal")
> >>>>>>>>  Installing package into
> >>>>>  ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> >>>>>>>>  (as ?lib? is unspecified)
> >>>>>>>>  trying URL '
> https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
> >>>>>>>>  Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
> >>>>>>>>  ==================================================
> >>>>>>>>  downloaded 2.2 MB
> >>>>>>>>
> >>>>>>>>  * installing *source* package ?rgdal? ...
> >>>>>>>>  ** package ?rgdal? successfully unpacked and MD5 sums checked
> >>>>>>>>  ** using staged installation
> >>>>>>>> configure:  R_HOME: /usr/local/lib/R
> >>>>>>>> configure:  CC: gcc
> >>>>>>>> configure:  CXX: g++ -std=gnu++11
> >>>>>>>> configure:  CXX11 is: g++, CXX11STD is: -std=gnu++11
> >>>>>>>> configure:  CXX is: g++ -std=gnu++11
> >>>>>>>> configure:  C++11 support available
> >>>>>>>> configure:  rgdal: 1.5-12
> >>>>>>>>  checking for /usr/bin/svnversion... yes
> >>>>>>>> configure:  svn revision: 1018
> >>>>>>>>  checking for gdal-config... /usr/local/bin/gdal-config
> >>>>>>>>  checking gdal-config usability... yes
> >>>>>>>> configure:  GDAL: 3.0.0
> >>>>>>>>  checking GDAL version >= 1.11.4... yes
> >>>>>>>>  checking GDAL version <= 2.5 or >= 3.0... yes
> >>>>>>>>  checking GDAL: linking with --libs only... yes
> >>>>>>>>  checking GDAL: gdal-config data directory readable... yes
> >>>>>>>>  checking GDAL: /usr/local/share/gdal/stateplane.csv readable...
> yes
> >>>>>>>> configure:  pkg-config proj exists, will use it
> >>>>>>>> configure:  PROJ version: 6.1.0
> >>>>>>>> configure:  PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> >>>>>>>> configure:  PROJ LIBS: -L/usr/local/lib -lproj
> >>>>>>>>  checking PROJ header API:... yes
> >>>>>>>>  checking whether the C++ compiler works... yes
> >>>>>>>>  checking for C++ compiler default output file name... a.out
> >>>>>>>>  checking for suffix of executables...
> >>>>>>>>  checking whether we are cross compiling... no
> >>>>>>>>  checking for suffix of object files... o
> >>>>>>>>  checking whether we are using the GNU C++ compiler... yes
> >>>>>>>>  checking whether g++ -std=gnu++11 accepts -g... yes
> >>>>>>>>  checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> >>>>>>>>  checking for grep that handles long lines and -e... /bin/grep
> >>>>>>>>  checking for egrep... /bin/grep -E
> >>>>>>>>  checking for ANSI C header files... yes
> >>>>>>>>  checking for sys/types.h... yes
> >>>>>>>>  checking for sys/stat.h... yes
> >>>>>>>>  checking for stdlib.h... yes
> >>>>>>>>  checking for string.h... yes
> >>>>>>>>  checking for memory.h... yes
> >>>>>>>>  checking for strings.h... yes
> >>>>>>>>  checking for inttypes.h... yes
> >>>>>>>>  checking for stdint.h... yes
> >>>>>>>>  checking for unistd.h... yes
> >>>>>>>>  checking proj.h usability... yes
> >>>>>>>>  checking proj.h presence... yes
> >>>>>>>>  checking for proj.h... yes
> >>>>>>>>  checking for proj_context_create in -lproj... yes
> >>>>>>>>  checking Using GDAL < 3 with PROJ >= 6... no
> >>>>>>>>  checking PROJ version >= 4.8.0... yes
> >>>>>>>>  checking PROJ: proj.db found and readable... yes
> >>>>>>>> configure:  Package CPP flags:  -I/usr/local/include
> >>>>>  -I/usr/local/include
> >>>>>>>>  -DPROJ_H_API
> >>>>>>>> configure:  Package LIBS:  -L/usr/local/lib -lgdal
> -L/usr/local/lib
> >>>>>  -lproj
> >>>>>>>> configure:  creating ./config.status
> >>>>>>>>  config.status: creating src/Makevars
> >>>>>>>>  ** libs
> >>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>>>>>  -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o
> >>>>>>>>  OGR_write.o
> >>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>>>>>  -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> >>>>>>>>  gdal-bindings.o
> >>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> >>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> >>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o
> >>>  local_stubs.o
> >>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>>>>>  -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o
> ogr_geom.o
> >>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
> >>>>>  ogr_polygons.o
> >>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>>>>>  -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o
> ogr_proj.o
> >>>>>>>>  ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
> >>>>>>>>  ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared
> in
> >>>  this
> >>>>>>>>  scope
> >>>>>>>>           OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>>>>>>           ^~~~~~~~~~~~~~~~~
> >>>>>>>>  ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
> >>>>>>>>           OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>>>>>>           ^~~~~~~~~~~~~~~~~
> >>>>>>>>           OSRProjVersion
> >>>>>>>>  /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
> >>>>>  failed
> >>>>>>>>  make: *** [ogr_proj.o] Error 1
> >>>>>>>>  ERROR: compilation failed for package ?rgdal?
> >>>>>>>>  * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>>>>>>>
> >>>>>>>>  The downloaded source packages are in
> >>>>>>>>  ?/tmp/RtmpNkdFOf/downloaded_packages?
> >>>>>>>>  Warning message:
> >>>>>>>>  In install.packages("rgdal") :
> >>>>>>>>    installation of package ?rgdal? had non-zero exit status
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>  --
> >>>>>>>>  Thomas E Adams, III
> >>>>>>>>  1724 Sage Lane
> >>>>>>>>  Blacksburg, VA 24060
> >>>>>>>>  tea3rd at gmail.com (personal)
> >>>>>>>>  tea at terrapredictions.org (work)
> >>>>>>>>
> >>>>>>>>  1 (513) 739-9512 (cell)
> >>>>>>>>
> >>>>>>>>          [[alternative HTML version deleted]]
> >>>>>>>>
> >>>>>>>>  _______________________________________________
> >>>>>>>>  R-sig-Geo mailing list
> >>>>>>>>  R-sig-Geo at r-project.org
> >>>>>>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>
> >>>>>  --
> >>>>>  Roger Bivand
> >>>>>  Department of Economics, Norwegian School of Economics,
> >>>>>  Helleveien 30, N-5045 Bergen, Norway.
> >>>>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >>>>>  https://orcid.org/0000-0003-2392-6140
> >>>>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>>>
> >>>>
> >>>>
> >>>>
> >>>
> >>>  --
> >>>  Roger Bivand
> >>>  Department of Economics, Norwegian School of Economics,
> >>>  Helleveien 30, N-5045 Bergen, Norway.
> >>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >>>  https://orcid.org/0000-0003-2392-6140
> >>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>
> >>
> >>
> >>
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From j_@rronte @end|ng |rom hotm@||@com  Fri Jul  3 19:26:45 2020
From: j_@rronte @end|ng |rom hotm@||@com (JC Arronte)
Date: Fri, 3 Jul 2020 17:26:45 +0000
Subject: [R-sig-Geo] Error trying to stack two raster bricks with different
 extension and resolution
In-Reply-To: <CAMbH+HhD4MEEjucXa-dsYpO43R35G5BYkMvWKrROALe1fYS3MA@mail.gmail.com>
References: <CAKBoCbF6++bz56D5SKu5WZNR0UhXWFrtO6bOivnf9WgkiTheZQ@mail.gmail.com>
 <9442a78e-e67f-601d-a545-8a08fb9e4ff0@gmail.com>
 <CAKBoCbEK2rQhRcddUNNNc3KsgTJqVTyEC6vjasPNf2E-5oaU=g@mail.gmail.com>
 <5e5ce909-2217-c715-423d-3ac945cb3fc2@uni-muenster.de>,
 <CAMbH+HhD4MEEjucXa-dsYpO43R35G5BYkMvWKrROALe1fYS3MA@mail.gmail.com>
Message-ID: <DB6PR0901MB1653115F64C0B76A00B6C5238B6A0@DB6PR0901MB1653.eurprd09.prod.outlook.com>

Hi All,


I?m starting to work with the package raster and although I?ve been looking for solutions, I can?t find the way to solve my problem.


I?ve two ncdf files downloaded from Copernicus with near-bottom sea temperature data. They correspond to two different periods of time (1998-2018 & 2019) and they have both different extent and resolution. The files can be downloaded from https://www.dropbox.com/sh/orr567sjdvxjycn/AAB2zEbo5hMwRhm0YEvXY5dma?dl=0


I want to stack both files in one raster brick with a final resolution of 3km and a LAEA projection. I?ve tried several approaches but none has worked.


Any help will be very appreciated! Thanks in advance.


Juan Carlos



This is the code I have been working with
-----------------------------------------------------------------------


library(ncdf4)
library(raster)
library(proj4)

temp_9818 <-brick('temp_9818.nc')
temp_19 <-brick('temp_2019.nc')
LAEA <- "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"

temp_9818
#class      : RasterBrick
#dimensions : 61, 145, 8845, 252  (nrow, ncol, ncell, nlayers)
#resolution : 0.08333333, 0.08333333  (x, y)
#extent     : -11.04167, 1.041666, 40.95833, 46.04167  (xmin, xmax, ymin, ymax)
#crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0

temp_19
#class      : RasterBrick
#dimensions : 181, 433, 78373, 12  (nrow, ncol, ncell, nlayers)
#resolution : 0.02777778, 0.02777778  (x, y)
#extent     : -11.01389, 1.013889, 40.98611, 46.01389  (xmin, xmax, ymin, ymax)
#crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0

# Different extents
extent(temp_9818)
#xmin       : -11.04167
#xmax       : 1.041666
#ymin       : 40.95833
#ymax       : 46.04167

extent(temp_19)
#xmin       : -11.01389
#xmax       : 1.013889
#ymin       : 40.98611
#ymax       : 46.01389

##  Projecting 3km & LAEA ---
temp_9818_project <-projectRaster(temp_9818, crs=LAEA, res=3000, method="bilinear")
temp_19_project <-projectRaster(temp_19, crs=LAEA, res=3000, method="bilinear")

extent(temp_9818_project)
#xmin       : 2552554
#xmax       : 3644554
#ymin       : 2015246
#ymax       : 2792246

extent(temp_19_project)
#xmin       : 2555581
#xmax       : 3641581
#ymin       : 2017655
#ymax       : 2788655


##  Obviously, error!! ----
temp_9819_final <- stack(temp_9818_project,temp_19_project)
#Error in compareRaster(x) : different extent

## Defining new extension for cropping
newextend <- extent(c(2395000, 3400000, 2281000, 2600000))

temp_9818_project_crop <-crop(temp_9818_project, newextend)
temp_19_project_crop <-crop(temp_19_project, newextend)

temp_9819_final <- stack(temp_9818_project_crop, temp_19_project_crop) #Error again!!
#Error in compareRaster(x) : different extent

extent(temp_9818_project_crop)
#xmin       : 2552554
#xmax       : 3398554
#ymin       : 2282246
#ymax       : 2600246

extent(temp_19_project_crop)
#xmin       : 2555581
#xmax       : 3398581
#ymin       : 2281655
#ymax       : 2599655

[[elided Hotmail spam]]

-------------------------------------------------------------

________________________________
De: R-sig-Geo <r-sig-geo-bounces at r-project.org> en nombre de Tim Salabim <tim.appelhans at gmail.com>
Enviado: s?bado, 20 de junio de 2020 18:32
Para: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
Cc: r-sig-geo <r-sig-geo at r-project.org>
Asunto: Re: [R-sig-Geo] Error when saving an sf (data) object to file as a shapefile

And for anyone looking for arguments:

http://switchfromshapefile.org/


On Sat, Jun 20, 2020, 18:20 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
wrote:

>
>
> On 6/20/20 12:28 PM, Lom Navanyo wrote:
> > Unknown field name `Act_Depthtwtr': updating a layer with improper field
> > name(s)?
>
> Shapefiles have funny restrictions as to the length and form of variable
> names, you probably ran into that, as the message suggests.
>
> A general advice is to not use shapefiles for writing; there are better
> alternatives, geopackage comes to mind. Shapefiles make life unnecessary
> complicated, you've now run into two of the many problems they have. The
> days of creating shapefiles are over. If someone asks you to create
> shapfiles, explain them it is a bad idea.
> --
> Edzer Pebesma
> Institute for Geoinformatics
> Heisenbergstrasse 2, 48149 Muenster, Germany
> Phone: +49 251 8333081
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Fri Jul  3 19:37:40 2020
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Fri, 3 Jul 2020 19:37:40 +0200
Subject: [R-sig-Geo] 
 Error trying to stack two raster bricks with different
 extension and resolution
In-Reply-To: <DB6PR0901MB1653115F64C0B76A00B6C5238B6A0@DB6PR0901MB1653.eurprd09.prod.outlook.com>
References: <CAKBoCbF6++bz56D5SKu5WZNR0UhXWFrtO6bOivnf9WgkiTheZQ@mail.gmail.com>
 <9442a78e-e67f-601d-a545-8a08fb9e4ff0@gmail.com>
 <CAKBoCbEK2rQhRcddUNNNc3KsgTJqVTyEC6vjasPNf2E-5oaU=g@mail.gmail.com>
 <5e5ce909-2217-c715-423d-3ac945cb3fc2@uni-muenster.de>
 <CAMbH+HhD4MEEjucXa-dsYpO43R35G5BYkMvWKrROALe1fYS3MA@mail.gmail.com>
 <DB6PR0901MB1653115F64C0B76A00B6C5238B6A0@DB6PR0901MB1653.eurprd09.prod.outlook.com>
Message-ID: <1525e9d2-b38e-b9d7-9171-7f8e75de8223@gmail.com>

Dear Juan Carlos,

maybe the simplest solution is
1) creating an empty raster at 3 km resolution and LAEA projection, 
using the desired extent,
2) then reprojecting both rasters to the projection/resolution/extent of 
this empty one using projectRaster(from, to)

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2020.07.03. 19:26 keltez?ssel, JC Arronte ?rta:
> Hi All,
>
>
> I?m starting to work with the package raster and although I?ve been looking for solutions, I can?t find the way to solve my problem.
>
>
> I?ve two ncdf files downloaded from Copernicus with near-bottom sea temperature data. They correspond to two different periods of time (1998-2018 & 2019) and they have both different extent and resolution. The files can be downloaded from https://www.dropbox.com/sh/orr567sjdvxjycn/AAB2zEbo5hMwRhm0YEvXY5dma?dl=0
>
>
> I want to stack both files in one raster brick with a final resolution of 3km and a LAEA projection. I?ve tried several approaches but none has worked.
>
>
> Any help will be very appreciated! Thanks in advance.
>
>
> Juan Carlos
>
>
>
> This is the code I have been working with
> -----------------------------------------------------------------------
>
>
> library(ncdf4)
> library(raster)
> library(proj4)
>
> temp_9818 <-brick('temp_9818.nc')
> temp_19 <-brick('temp_2019.nc')
> LAEA <- "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
>
> temp_9818
> #class      : RasterBrick
> #dimensions : 61, 145, 8845, 252  (nrow, ncol, ncell, nlayers)
> #resolution : 0.08333333, 0.08333333  (x, y)
> #extent     : -11.04167, 1.041666, 40.95833, 46.04167  (xmin, xmax, ymin, ymax)
> #crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>
> temp_19
> #class      : RasterBrick
> #dimensions : 181, 433, 78373, 12  (nrow, ncol, ncell, nlayers)
> #resolution : 0.02777778, 0.02777778  (x, y)
> #extent     : -11.01389, 1.013889, 40.98611, 46.01389  (xmin, xmax, ymin, ymax)
> #crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>
> # Different extents
> extent(temp_9818)
> #xmin       : -11.04167
> #xmax       : 1.041666
> #ymin       : 40.95833
> #ymax       : 46.04167
>
> extent(temp_19)
> #xmin       : -11.01389
> #xmax       : 1.013889
> #ymin       : 40.98611
> #ymax       : 46.01389
>
> ##  Projecting 3km & LAEA ---
> temp_9818_project <-projectRaster(temp_9818, crs=LAEA, res=3000, method="bilinear")
> temp_19_project <-projectRaster(temp_19, crs=LAEA, res=3000, method="bilinear")
>
> extent(temp_9818_project)
> #xmin       : 2552554
> #xmax       : 3644554
> #ymin       : 2015246
> #ymax       : 2792246
>
> extent(temp_19_project)
> #xmin       : 2555581
> #xmax       : 3641581
> #ymin       : 2017655
> #ymax       : 2788655
>
>
> ##  Obviously, error!! ----
> temp_9819_final <- stack(temp_9818_project,temp_19_project)
> #Error in compareRaster(x) : different extent
>
> ## Defining new extension for cropping
> newextend <- extent(c(2395000, 3400000, 2281000, 2600000))
>
> temp_9818_project_crop <-crop(temp_9818_project, newextend)
> temp_19_project_crop <-crop(temp_19_project, newextend)
>
> temp_9819_final <- stack(temp_9818_project_crop, temp_19_project_crop) #Error again!!
> #Error in compareRaster(x) : different extent
>
> extent(temp_9818_project_crop)
> #xmin       : 2552554
> #xmax       : 3398554
> #ymin       : 2282246
> #ymax       : 2600246
>
> extent(temp_19_project_crop)
> #xmin       : 2555581
> #xmax       : 3398581
> #ymin       : 2281655
> #ymax       : 2599655
>
> [[elided Hotmail spam]]
>
> -------------------------------------------------------------
>
> ________________________________
> De: R-sig-Geo <r-sig-geo-bounces at r-project.org> en nombre de Tim Salabim <tim.appelhans at gmail.com>
> Enviado: s?bado, 20 de junio de 2020 18:32
> Para: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> Cc: r-sig-geo <r-sig-geo at r-project.org>
> Asunto: Re: [R-sig-Geo] Error when saving an sf (data) object to file as a shapefile
>
> And for anyone looking for arguments:
>
> http://switchfromshapefile.org/
>
>
> On Sat, Jun 20, 2020, 18:20 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> wrote:
>
>>
>> On 6/20/20 12:28 PM, Lom Navanyo wrote:
>>> Unknown field name `Act_Depthtwtr': updating a layer with improper field
>>> name(s)?
>> Shapefiles have funny restrictions as to the length and form of variable
>> names, you probably ran into that, as the message suggests.
>>
>> A general advice is to not use shapefiles for writing; there are better
>> alternatives, geopackage comes to mind. Shapefiles make life unnecessary
>> complicated, you've now run into two of the many problems they have. The
>> days of creating shapefiles are over. If someone asks you to create
>> shapfiles, explain them it is a bad idea.
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics
>> Heisenbergstrasse 2, 48149 Muenster, Germany
>> Phone: +49 251 8333081
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>          [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> 	[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From @our@v@@@rk@r @end|ng |rom @hdun|@edu@|n  Sat Jul  4 10:07:16 2020
From: @our@v@@@rk@r @end|ng |rom @hdun|@edu@|n (Sourav Sarkar)
Date: Sat, 4 Jul 2020 13:37:16 +0530
Subject: [R-sig-Geo] (no subject)
Message-ID: <CAFBgidrCebP+3KaQ2x-OeiMWiAPWqzExQiWqy4R99SrJ3M+p8Q@mail.gmail.com>

Hi All,
I have a sf dataframe (cities) of point locations of about a hundred cities
in India with latitudes in the second column and longitudes in the third
column. I am trying to create a geodesic buffer around each of these points
by projecting them to azimuthal equidistant projection centred at the
respective point and then using the st_buffer function.

The error is occuring when I try to centre the equidistant projection to my
preferred latitude and longitude since lat_0 and lon_0 accept only numbers
which I do not want to put manually. From searches over the internet, it
seems to me that probably something related to paste or \"" needs to be
applied but since I am not an expert I am unable to get the correct code.

My code looks something like this:
a <-st_transform(cities[i,], "+proj=aeqd +lat_0=cities [i,3][[1]]
+lon_0=cities[i,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
+no_defs")
buffer_aeqd =st_transform(cities[1,], "+proj=aeqd +lat_0= cities[1,3][[1]]
+lon_0= cities[1,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
+no_defs")
buffer_aeqd=st_buffer(buffer_aeqd, 50000)
buffer_aeqd=st_transform(buffer_aeqd, 4326)

for (i in 2:nrow(cities)){
a =  st_transform(cities[i,], "+proj=aeqd +lat_0=cities [i,3][[1]]
+lon_0=cities[i,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
+no_defs")
a=st_buffer(a, 200000)
a=st_transform(a, 4326)
buffer_aeqd=rbind(buffer_aeqd, a)
}
remove(a)

It will be very nice if you can give me some leads. Thank You very much in
advance.

Yours sincerely,
-- 
Sourav Sarkar,
Assistant Professor,
School of Arts and Sciences,
Ahmedabad University

	[[alternative HTML version deleted]]


From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Sat Jul  4 11:49:23 2020
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Sat, 4 Jul 2020 11:49:23 +0200
Subject: [R-sig-Geo] (no subject)
In-Reply-To: <CAFBgidrCebP+3KaQ2x-OeiMWiAPWqzExQiWqy4R99SrJ3M+p8Q@mail.gmail.com>
References: <CAFBgidrCebP+3KaQ2x-OeiMWiAPWqzExQiWqy4R99SrJ3M+p8Q@mail.gmail.com>
Message-ID: <CAKtE6yNskDP5JMBiBtnyw11eLKP8eKS7jNjtk6bFGgoygYhSBw@mail.gmail.com>

Hi Sourav,

Perhaps replacing "+proj=aeqd +lat_0=cities [i,3][[1]]
+lon_0=cities[i,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
+no_defs"
by
sprintf("+proj=aeqd +lat_0=%f
+lon_0=%f + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
+no_defs",  cities [i,3][[1]], cities[i,2][[1]])
etc.
could solve your problem.
HTH
Zivan




Le sam. 4 juil. 2020 ? 10:07, Sourav Sarkar <sourav.sarkar at ahduni.edu.in> a
?crit :

> Hi All,
> I have a sf dataframe (cities) of point locations of about a hundred cities
> in India with latitudes in the second column and longitudes in the third
> column. I am trying to create a geodesic buffer around each of these points
> by projecting them to azimuthal equidistant projection centred at the
> respective point and then using the st_buffer function.
>
> The error is occuring when I try to centre the equidistant projection to my
> preferred latitude and longitude since lat_0 and lon_0 accept only numbers
> which I do not want to put manually. From searches over the internet, it
> seems to me that probably something related to paste or \"" needs to be
> applied but since I am not an expert I am unable to get the correct code.
>
> My code looks something like this:
> a <-st_transform(cities[i,], "+proj=aeqd +lat_0=cities [i,3][[1]]
> +lon_0=cities[i,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
> +no_defs")
> buffer_aeqd =st_transform(cities[1,], "+proj=aeqd +lat_0= cities[1,3][[1]]
> +lon_0= cities[1,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
> +no_defs")
> buffer_aeqd=st_buffer(buffer_aeqd, 50000)
> buffer_aeqd=st_transform(buffer_aeqd, 4326)
>
> for (i in 2:nrow(cities)){
> a =  st_transform(cities[i,], "+proj=aeqd +lat_0=cities [i,3][[1]]
> +lon_0=cities[i,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
> +no_defs")
> a=st_buffer(a, 200000)
> a=st_transform(a, 4326)
> buffer_aeqd=rbind(buffer_aeqd, a)
> }
> remove(a)
>
> It will be very nice if you can give me some leads. Thank You very much in
> advance.
>
> Yours sincerely,
> --
> Sourav Sarkar,
> Assistant Professor,
> School of Arts and Sciences,
> Ahmedabad University
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From @our@v@@@rk@r @end|ng |rom @hdun|@edu@|n  Sat Jul  4 12:04:23 2020
From: @our@v@@@rk@r @end|ng |rom @hdun|@edu@|n (Sourav Sarkar)
Date: Sat, 4 Jul 2020 15:34:23 +0530
Subject: [R-sig-Geo] (no subject)
In-Reply-To: <CAKtE6yNskDP5JMBiBtnyw11eLKP8eKS7jNjtk6bFGgoygYhSBw@mail.gmail.com>
References: <CAFBgidrCebP+3KaQ2x-OeiMWiAPWqzExQiWqy4R99SrJ3M+p8Q@mail.gmail.com>
 <CAKtE6yNskDP5JMBiBtnyw11eLKP8eKS7jNjtk6bFGgoygYhSBw@mail.gmail.com>
Message-ID: <CAFBgidpRZqEcePyuNg3En0MdXNkwNtWLx1T5OqUjB363Q_QJWA@mail.gmail.com>

Your code works perfectly Zivan! Thank you very much for all your help!

Kind regards,

???, ? ?????, ???? ?????? ?:?? PM ??? ? Zivan Karaman <
zivan.karaman at gmail.com> ???????:

> Hi Sourav,
>
> Perhaps replacing "+proj=aeqd +lat_0=cities [i,3][[1]]
> +lon_0=cities[i,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
> +no_defs"
> by
> sprintf("+proj=aeqd +lat_0=%f
> +lon_0=%f + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
> +no_defs",  cities [i,3][[1]], cities[i,2][[1]])
> etc.
> could solve your problem.
> HTH
> Zivan
>
>
>
>
> Le sam. 4 juil. 2020 ? 10:07, Sourav Sarkar <sourav.sarkar at ahduni.edu.in>
> a ?crit :
>
>> Hi All,
>> I have a sf dataframe (cities) of point locations of about a hundred
>> cities
>> in India with latitudes in the second column and longitudes in the third
>> column. I am trying to create a geodesic buffer around each of these
>> points
>> by projecting them to azimuthal equidistant projection centred at the
>> respective point and then using the st_buffer function.
>>
>> The error is occuring when I try to centre the equidistant projection to
>> my
>> preferred latitude and longitude since lat_0 and lon_0 accept only numbers
>> which I do not want to put manually. From searches over the internet, it
>> seems to me that probably something related to paste or \"" needs to be
>> applied but since I am not an expert I am unable to get the correct code.
>>
>> My code looks something like this:
>> a <-st_transform(cities[i,], "+proj=aeqd +lat_0=cities [i,3][[1]]
>> +lon_0=cities[i,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
>> +no_defs")
>> buffer_aeqd =st_transform(cities[1,], "+proj=aeqd +lat_0= cities[1,3][[1]]
>> +lon_0= cities[1,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
>> +no_defs")
>> buffer_aeqd=st_buffer(buffer_aeqd, 50000)
>> buffer_aeqd=st_transform(buffer_aeqd, 4326)
>>
>> for (i in 2:nrow(cities)){
>> a =  st_transform(cities[i,], "+proj=aeqd +lat_0=cities [i,3][[1]]
>> +lon_0=cities[i,2][[1]] + x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m
>> +no_defs")
>> a=st_buffer(a, 200000)
>> a=st_transform(a, 4326)
>> buffer_aeqd=rbind(buffer_aeqd, a)
>> }
>> remove(a)
>>
>> It will be very nice if you can give me some leads. Thank You very much in
>> advance.
>>
>> Yours sincerely,
>> --
>> Sourav Sarkar,
>> Assistant Professor,
>> School of Arts and Sciences,
>> Ahmedabad University
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Sourav Sarkar,
Assistant Professor,
School of Arts and Sciences,
Ahmedabad University

	[[alternative HTML version deleted]]


From te@3rd @end|ng |rom gm@||@com  Sat Jul  4 18:10:59 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Sat, 4 Jul 2020 12:10:59 -0400
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <alpine.LFD.2.22.394.2007031721090.3922277@reclus.nhh.no>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
 <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
 <CAGxgkWjBXnM06E7uT=K4h6b6i4LHLJ2NZWUxrWzj2uNuL1KRFQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031206210.3918620@reclus.nhh.no>
 <alpine.LFD.2.22.394.2007031721090.3922277@reclus.nhh.no>
Message-ID: <CAGxgkWgAcrLDiBzEL1qMvBT-CG9Xw=PP_8A42urMk1YEwdD6eg@mail.gmail.com>

Hi Roger!

I updated GDAL and PROJ to 3.0.4 and 6.3.1, respectively... the install
worked perfectly using:

sudo R CMD INSTALL rgdal_1.5-13.tar.gz

Thank you so much!

Best,
Tom

On Fri, Jul 3, 2020 at 11:24 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Fri, 3 Jul 2020, Roger Bivand wrote:
>
> > On Fri, 3 Jul 2020, Thomas Adams wrote:
> >
> >>  Hi Roger,
> >>
> >>  I just tried re-installing withou using the argument and got this:
> >
> > Very useful, thanks - painful but another case of staying too close to
> the
> > front. proj_create_crs_to_crs_from_pj() was new in PROJ 6.2.0. I'll try
> to
> > adapt to accommodate older PROJ 6.
>
> Re-creating a GDAL 3.0.0 with PROJ 6.1.0 platform has thrown up another
> issue which which I'm struggling. I'll try to resolve it, but until then
> advice would be to update GDAL and PROJ to 3.0.4 and 6.3.1, which we know
> work (those are the versions in the CRAN Windows binary).
>
> Roger
>
> >
> > Roger
> >
> >>
> >>  teaiii at teaiii-Leopard-WS:~$ sudo R CMD INSTALL rgdal_1.5-13.tar.gz
> >>  * installing to library
> ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> >>  * installing *source* package ?rgdal? ...
> >>  ** using staged installation
> >> configure:  R_HOME: /usr/local/lib/R
> >> configure:  CC: gcc
> >> configure:  CXX: g++ -std=gnu++11
> >> configure:  CFLAGS: -g -O2
> >> configure:  CPPFLAGS: -I/usr/local/include
> >> configure:  CXXFLAGS: -g -O2
> >> configure: LDFLAGS:  -L/usr/local/lib
> >> configure: LDFLAGS:  -L/usr/local/lib
> >> configure:  CXX11 is: g++, CXX11STD is: -std=gnu++11
> >> configure:  CXX is: g++ -std=gnu++11
> >> configure:  C++11 support available
> >> configure:  rgdal: 1.5-13
> >>  checking for /usr/bin/svnversion... yes
> >>  cat: inst/SVN_VERSION: No such file or directory
> >> configure:  svn revision:
> >>  checking for gdal-config... /usr/local/bin/gdal-config
> >>  checking gdal-config usability... yes
> >> configure:  GDAL: 3.0.0
> >>  checking GDAL version >= 1.11.4... yes
> >>  checking GDAL version <= 2.5 or >= 3.0... yes
> >>  checking GDAL: linking with --libs only... yes
> >>  checking GDAL: gdal-config data directory readable... yes
> >>  checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
> >> configure:  pkg-config proj exists, will use it
> >> configure:  PROJ version: 6.1.0
> >> configure:  PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> >> configure:  PROJ LIBS: -L/usr/local/lib -lproj
> >>  checking PROJ header API:... yes
> >>  checking whether the C++ compiler works... yes
> >>  checking for C++ compiler default output file name... a.out
> >>  checking for suffix of executables...
> >>  checking whether we are cross compiling... no
> >>  checking for suffix of object files... o
> >>  checking whether we are using the GNU C++ compiler... yes
> >>  checking whether g++ -std=gnu++11 accepts -g... yes
> >>  checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> >>  checking for grep that handles long lines and -e... /bin/grep
> >>  checking for egrep... /bin/grep -E
> >>  checking for ANSI C header files... yes
> >>  checking for sys/types.h... yes
> >>  checking for sys/stat.h... yes
> >>  checking for stdlib.h... yes
> >>  checking for string.h... yes
> >>  checking for memory.h... yes
> >>  checking for strings.h... yes
> >>  checking for inttypes.h... yes
> >>  checking for stdint.h... yes
> >>  checking for unistd.h... yes
> >>  checking proj.h usability... yes
> >>  checking proj.h presence... yes
> >>  checking for proj.h... yes
> >>  checking for proj_context_create in -lproj... yes
> >>  checking Using GDAL < 3 with PROJ >= 6... no
> >>  checking PROJ version >= 4.8.0... yes
> >>  checking PROJ: proj.db found and readable... yes
> >> configure:  Package CPP flags:  -I/usr/local/include
> -I/usr/local/include
> >>  -DPROJ_H_API
> >> configure:  Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
> -lproj
> >> configure:  creating ./config.status
> >>  config.status: creating src/Makevars
> >>  ** libs
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> >>  gdal-bindings.o
> >>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> >>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> >>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
> >>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
> ogr_polygons.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c ogrsource.cpp -o ogrsource.o
> >>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>  -I/usr/local/include
> >>  -I/usr/local/include -DPROJ_H_API
> >>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>  -I/usr/local/include   -fpic  -g -O2  -c proj6.cpp -o proj6.o
> >>  proj6.cpp: In function ?SEXPREC* transform_ng(SEXP, SEXP, SEXP, SEXP,
> >>  SEXP,
> >>  SEXP, SEXP)?:
> >>  proj6.cpp:521:29: error: ?proj_create_crs_to_crs_from_pj? was not
> declared
> >>  in this scope
> >>          if ((pj_transform =
> proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> >>  source_crs,
> >>                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>  proj6.cpp:521:29: note: suggested alternative: ?proj_create_crs_to_crs?
> >>          if ((pj_transform =
> proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> >>  source_crs,
> >>                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>                              proj_create_crs_to_crs
> >>  proj6.cpp: In function ?SEXPREC* project_ng_coordOp(SEXP, SEXP)?:
> >>  proj6.cpp:704:33: error: ?proj_create_crs_to_crs_from_pj? was not
> declared
> >>  in this scope
> >>      if (use_inv) pj_transform =
> >>  proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
> >>                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>  proj6.cpp:704:33: note: suggested alternative: ?proj_create_crs_to_crs?
> >>      if (use_inv) pj_transform =
> >>  proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
> >>                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>                                  proj_create_crs_to_crs
> >>  proj6.cpp:706:25: error: ?proj_create_crs_to_crs_from_pj? was not
> declared
> >>  in this scope
> >>      else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> >>  source_crs,
> >>                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>  proj6.cpp:706:25: note: suggested alternative: ?proj_create_crs_to_crs?
> >>      else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
> >>  source_crs,
> >>                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> >>                          proj_create_crs_to_crs
> >>  /usr/local/lib/R/etc/Makeconf:176: recipe for target 'proj6.o' failed
> >>  make: *** [proj6.o] Error 1
> >>  ERROR: compilation failed for package ?rgdal?
> >>  * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>  * restoring previous
> >>  ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>
> >>  On Fri, Jul 3, 2020 at 5:45 AM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >>
> >>>  On Thu, 2 Jul 2020, Thomas Adams wrote:
> >>>
> >>>>  Roger,
> >>>>
> >>>>  Thank you so much; after downloading the *.tar.gz file, the that did
> the
> >>>>  trick, using:
> >>>>
> >>>>  sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
> >>>>  rgdal_1.5-13.tar.gz
> >>>
> >>>  Since you have GDAL: 3.0.0 and PROJ version: 6.1.0, you can drop
> >>>  --configure-args=--with-proj_api="proj_api.h", which is only needed if
> >>>  GDAL < 3 and PROJ >= 6. I'm uncertain how stable a system will be if
> GDAL
> >>>>  = 3 && PROJ >= 6 with this configure argument, as it is only a
> >>>  work-around for systems with GDAL < 3 and PROJ >= 6, and onnly tested
> in
> >>>  that setting.
> >>>
> >>>  Thanks for reporting back!
> >>>
> >>>  Roger
> >>>
> >>>>
> >>>>  Best regards!
> >>>>  Tom
> >>>>
> >>>>
> >>>>  On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >>>>
> >>>>>  On Thu, 2 Jul 2020, Thomas Adams wrote:
> >>>>>
> >>>>>>  Hi Bennet!
> >>>>>>
> >>>>>>  Thank you for your help, but I get the same error...
> >>>>>
> >>>>>  Tom,
> >>>>>
> >>>>>  Once rgdal revision 1029 completes building (check first) on:
> >>>>>
> >>>>>  https://r-forge.r-project.org/R/?group_id=884
> >>>>>
> >>>>>  please re-try. The missing function is not in the GDAL 3.0.0
> headers,
> >>>  but
> >>>>>  is in the 3.0.1 headers. I've modified the check so as not to try
> for
> >>>  just
> >>>>>>  = 3 to >= 3.0.1.
> >>>>>
> >>>>>  Roger
> >>>>>
> >>>>>>
> >>>>>>  Tom
> >>>>>>
> >>>>>>  On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu>
> wrote:
> >>>>>>
> >>>>>>>  You might try this
> >>>>>>>
> >>>>>>>  install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
> >>>>>>>  repos="http://R-Forge.R-project.org")
> >>>>>>>
> >>>>>>>  as there have been recent patches to rgdal that might help that
> have
> >>>>>>>  been incorporated there.
> >>>>>>>
> >>>>>>>
> >>>>>>>  On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com>
> wrote:
> >>>>>>>>
> >>>>>>>>  Hi all,
> >>>>>>>>
> >>>>>>>>  I have searched the internet and have spent a few days trying to
> get
> >>>  to
> >>>>>>>  the
> >>>>>>>>  problem when I try to install rgdal into my Ubuntu 18.04 system.
> I
> >>>  have
> >>>>>>>>  done this many times previously, but cannot seem to track down
> what
> >>>>>>>>  I
> >>>>>  am
> >>>>>>>>  doing wrong now. I have tried a forced install from sources with
> and
> >>>>>>>>  without dependencies. Below is what I get. Any help is
> appreciated.
> >>>>>>>>
> >>>>>>>>  Tom
> >>>>>>>>
> >>>>>>>>>  install.packages("rgdal")
> >>>>>>>>  Installing package into
> >>>>>  ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
> >>>>>>>>  (as ?lib? is unspecified)
> >>>>>>>>  trying URL '
> https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
> >>>>>>>>  Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
> >>>>>>>>  ==================================================
> >>>>>>>>  downloaded 2.2 MB
> >>>>>>>>
> >>>>>>>>  * installing *source* package ?rgdal? ...
> >>>>>>>>  ** package ?rgdal? successfully unpacked and MD5 sums checked
> >>>>>>>>  ** using staged installation
> >>>>>>>> configure:  R_HOME: /usr/local/lib/R
> >>>>>>>> configure:  CC: gcc
> >>>>>>>> configure:  CXX: g++ -std=gnu++11
> >>>>>>>> configure:  CXX11 is: g++, CXX11STD is: -std=gnu++11
> >>>>>>>> configure:  CXX is: g++ -std=gnu++11
> >>>>>>>> configure:  C++11 support available
> >>>>>>>> configure:  rgdal: 1.5-12
> >>>>>>>>  checking for /usr/bin/svnversion... yes
> >>>>>>>> configure:  svn revision: 1018
> >>>>>>>>  checking for gdal-config... /usr/local/bin/gdal-config
> >>>>>>>>  checking gdal-config usability... yes
> >>>>>>>> configure:  GDAL: 3.0.0
> >>>>>>>>  checking GDAL version >= 1.11.4... yes
> >>>>>>>>  checking GDAL version <= 2.5 or >= 3.0... yes
> >>>>>>>>  checking GDAL: linking with --libs only... yes
> >>>>>>>>  checking GDAL: gdal-config data directory readable... yes
> >>>>>>>>  checking GDAL: /usr/local/share/gdal/stateplane.csv readable...
> yes
> >>>>>>>> configure:  pkg-config proj exists, will use it
> >>>>>>>> configure:  PROJ version: 6.1.0
> >>>>>>>> configure:  PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
> >>>>>>>> configure:  PROJ LIBS: -L/usr/local/lib -lproj
> >>>>>>>>  checking PROJ header API:... yes
> >>>>>>>>  checking whether the C++ compiler works... yes
> >>>>>>>>  checking for C++ compiler default output file name... a.out
> >>>>>>>>  checking for suffix of executables...
> >>>>>>>>  checking whether we are cross compiling... no
> >>>>>>>>  checking for suffix of object files... o
> >>>>>>>>  checking whether we are using the GNU C++ compiler... yes
> >>>>>>>>  checking whether g++ -std=gnu++11 accepts -g... yes
> >>>>>>>>  checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
> >>>>>>>>  checking for grep that handles long lines and -e... /bin/grep
> >>>>>>>>  checking for egrep... /bin/grep -E
> >>>>>>>>  checking for ANSI C header files... yes
> >>>>>>>>  checking for sys/types.h... yes
> >>>>>>>>  checking for sys/stat.h... yes
> >>>>>>>>  checking for stdlib.h... yes
> >>>>>>>>  checking for string.h... yes
> >>>>>>>>  checking for memory.h... yes
> >>>>>>>>  checking for strings.h... yes
> >>>>>>>>  checking for inttypes.h... yes
> >>>>>>>>  checking for stdint.h... yes
> >>>>>>>>  checking for unistd.h... yes
> >>>>>>>>  checking proj.h usability... yes
> >>>>>>>>  checking proj.h presence... yes
> >>>>>>>>  checking for proj.h... yes
> >>>>>>>>  checking for proj_context_create in -lproj... yes
> >>>>>>>>  checking Using GDAL < 3 with PROJ >= 6... no
> >>>>>>>>  checking PROJ version >= 4.8.0... yes
> >>>>>>>>  checking PROJ: proj.db found and readable... yes
> >>>>>>>> configure:  Package CPP flags:  -I/usr/local/include
> >>>>>  -I/usr/local/include
> >>>>>>>>  -DPROJ_H_API
> >>>>>>>> configure:  Package LIBS:  -L/usr/local/lib -lgdal
> -L/usr/local/lib
> >>>>>  -lproj
> >>>>>>>> configure:  creating ./config.status
> >>>>>>>>  config.status: creating src/Makevars
> >>>>>>>>  ** libs
> >>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>>>>>  -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o
> >>>>>>>>  OGR_write.o
> >>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>>>>>  -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
> >>>>>>>>  gdal-bindings.o
> >>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
> >>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
> >>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o
> >>>  local_stubs.o
> >>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>>>>>  -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o
> ogr_geom.o
> >>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
> >>>>>  ogr_polygons.o
> >>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
> >>>>>>>  -I/usr/local/include
> >>>>>>>>  -I/usr/local/include -DPROJ_H_API
> >>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
> >>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o
> ogr_proj.o
> >>>>>>>>  ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
> >>>>>>>>  ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared
> in
> >>>  this
> >>>>>>>>  scope
> >>>>>>>>           OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>>>>>>           ^~~~~~~~~~~~~~~~~
> >>>>>>>>  ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
> >>>>>>>>           OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
> >>>>>>>>           ^~~~~~~~~~~~~~~~~
> >>>>>>>>           OSRProjVersion
> >>>>>>>>  /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
> >>>>>  failed
> >>>>>>>>  make: *** [ogr_proj.o] Error 1
> >>>>>>>>  ERROR: compilation failed for package ?rgdal?
> >>>>>>>>  * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
> >>>>>>>>
> >>>>>>>>  The downloaded source packages are in
> >>>>>>>>  ?/tmp/RtmpNkdFOf/downloaded_packages?
> >>>>>>>>  Warning message:
> >>>>>>>>  In install.packages("rgdal") :
> >>>>>>>>    installation of package ?rgdal? had non-zero exit status
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>  --
> >>>>>>>>  Thomas E Adams, III
> >>>>>>>>  1724 Sage Lane
> >>>>>>>>  Blacksburg, VA 24060
> >>>>>>>>  tea3rd at gmail.com (personal)
> >>>>>>>>  tea at terrapredictions.org (work)
> >>>>>>>>
> >>>>>>>>  1 (513) 739-9512 (cell)
> >>>>>>>>
> >>>>>>>>          [[alternative HTML version deleted]]
> >>>>>>>>
> >>>>>>>>  _______________________________________________
> >>>>>>>>  R-sig-Geo mailing list
> >>>>>>>>  R-sig-Geo at r-project.org
> >>>>>>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>
> >>>>>  --
> >>>>>  Roger Bivand
> >>>>>  Department of Economics, Norwegian School of Economics,
> >>>>>  Helleveien 30, N-5045 Bergen, Norway.
> >>>>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >>>>>  https://orcid.org/0000-0003-2392-6140
> >>>>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>>>
> >>>>
> >>>>
> >>>>
> >>>
> >>>  --
> >>>  Roger Bivand
> >>>  Department of Economics, Norwegian School of Economics,
> >>>  Helleveien 30, N-5045 Bergen, Norway.
> >>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >>>  https://orcid.org/0000-0003-2392-6140
> >>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>
> >>
> >>
> >>
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From j_@rronte @end|ng |rom hotm@||@com  Sat Jul  4 20:54:42 2020
From: j_@rronte @end|ng |rom hotm@||@com (JC Arronte)
Date: Sat, 4 Jul 2020 18:54:42 +0000
Subject: [R-sig-Geo] 
 Error trying to stack two raster bricks with different
 extension and resolution
In-Reply-To: <1525e9d2-b38e-b9d7-9171-7f8e75de8223@gmail.com>
References: <CAKBoCbF6++bz56D5SKu5WZNR0UhXWFrtO6bOivnf9WgkiTheZQ@mail.gmail.com>
 <9442a78e-e67f-601d-a545-8a08fb9e4ff0@gmail.com>
 <CAKBoCbEK2rQhRcddUNNNc3KsgTJqVTyEC6vjasPNf2E-5oaU=g@mail.gmail.com>
 <5e5ce909-2217-c715-423d-3ac945cb3fc2@uni-muenster.de>
 <CAMbH+HhD4MEEjucXa-dsYpO43R35G5BYkMvWKrROALe1fYS3MA@mail.gmail.com>
 <DB6PR0901MB1653115F64C0B76A00B6C5238B6A0@DB6PR0901MB1653.eurprd09.prod.outlook.com>,
 <1525e9d2-b38e-b9d7-9171-7f8e75de8223@gmail.com>
Message-ID: <DB6PR0901MB16539A830692CAC8F516743D8B6B0@DB6PR0901MB1653.eurprd09.prod.outlook.com>

Dear ?kos,

It worked!!. Thank you very much for your help.

Best regards,

Juan Carlos

________________________________
De: R-sig-Geo <r-sig-geo-bounces at r-project.org> en nombre de Bede-Fazekas ?kos <bfalevlist at gmail.com>
Enviado: viernes, 3 de julio de 2020 19:37
Para: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
Asunto: Re: [R-sig-Geo] Error trying to stack two raster bricks with different extension and resolution

Dear Juan Carlos,

maybe the simplest solution is
1) creating an empty raster at 3 km resolution and LAEA projection,
using the desired extent,
2) then reprojecting both rasters to the projection/resolution/extent of
this empty one using projectRaster(from, to)

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2020.07.03. 19:26 keltez?ssel, JC Arronte ?rta:
> Hi All,
>
>
> I?m starting to work with the package raster and although I?ve been looking for solutions, I can?t find the way to solve my problem.
>
>
> I?ve two ncdf files downloaded from Copernicus with near-bottom sea temperature data. They correspond to two different periods of time (1998-2018 & 2019) and they have both different extent and resolution. The files can be downloaded from https://www.dropbox.com/sh/orr567sjdvxjycn/AAB2zEbo5hMwRhm0YEvXY5dma?dl=0
>
>
> I want to stack both files in one raster brick with a final resolution of 3km and a LAEA projection. I?ve tried several approaches but none has worked.
>
>
> Any help will be very appreciated! Thanks in advance.
>
>
> Juan Carlos
>
>
>
> This is the code I have been working with
> -----------------------------------------------------------------------
>
>
> library(ncdf4)
> library(raster)
> library(proj4)
>
> temp_9818 <-brick('temp_9818.nc')
> temp_19 <-brick('temp_2019.nc')
> LAEA <- "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
>
> temp_9818
> #class      : RasterBrick
> #dimensions : 61, 145, 8845, 252  (nrow, ncol, ncell, nlayers)
> #resolution : 0.08333333, 0.08333333  (x, y)
> #extent     : -11.04167, 1.041666, 40.95833, 46.04167  (xmin, xmax, ymin, ymax)
> #crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>
> temp_19
> #class      : RasterBrick
> #dimensions : 181, 433, 78373, 12  (nrow, ncol, ncell, nlayers)
> #resolution : 0.02777778, 0.02777778  (x, y)
> #extent     : -11.01389, 1.013889, 40.98611, 46.01389  (xmin, xmax, ymin, ymax)
> #crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
>
> # Different extents
> extent(temp_9818)
> #xmin       : -11.04167
> #xmax       : 1.041666
> #ymin       : 40.95833
> #ymax       : 46.04167
>
> extent(temp_19)
> #xmin       : -11.01389
> #xmax       : 1.013889
> #ymin       : 40.98611
> #ymax       : 46.01389
>
> ##  Projecting 3km & LAEA ---
> temp_9818_project <-projectRaster(temp_9818, crs=LAEA, res=3000, method="bilinear")
> temp_19_project <-projectRaster(temp_19, crs=LAEA, res=3000, method="bilinear")
>
> extent(temp_9818_project)
> #xmin       : 2552554
> #xmax       : 3644554
> #ymin       : 2015246
> #ymax       : 2792246
>
> extent(temp_19_project)
> #xmin       : 2555581
> #xmax       : 3641581
> #ymin       : 2017655
> #ymax       : 2788655
>
>
> ##  Obviously, error!! ----
> temp_9819_final <- stack(temp_9818_project,temp_19_project)
> #Error in compareRaster(x) : different extent
>
> ## Defining new extension for cropping
> newextend <- extent(c(2395000, 3400000, 2281000, 2600000))
>
> temp_9818_project_crop <-crop(temp_9818_project, newextend)
> temp_19_project_crop <-crop(temp_19_project, newextend)
>
> temp_9819_final <- stack(temp_9818_project_crop, temp_19_project_crop) #Error again!!
> #Error in compareRaster(x) : different extent
>
> extent(temp_9818_project_crop)
> #xmin       : 2552554
> #xmax       : 3398554
> #ymin       : 2282246
> #ymax       : 2600246
>
> extent(temp_19_project_crop)
> #xmin       : 2555581
> #xmax       : 3398581
> #ymin       : 2281655
> #ymax       : 2599655
>
> [[elided Hotmail spam]]
>
> -------------------------------------------------------------
>
> ________________________________
> De: R-sig-Geo <r-sig-geo-bounces at r-project.org> en nombre de Tim Salabim <tim.appelhans at gmail.com>
> Enviado: s?bado, 20 de junio de 2020 18:32
> Para: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> Cc: r-sig-geo <r-sig-geo at r-project.org>
> Asunto: Re: [R-sig-Geo] Error when saving an sf (data) object to file as a shapefile
>
> And for anyone looking for arguments:
>
> http://switchfromshapefile.org/
>
>
> On Sat, Jun 20, 2020, 18:20 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> wrote:
>
>>
>> On 6/20/20 12:28 PM, Lom Navanyo wrote:
>>> Unknown field name `Act_Depthtwtr': updating a layer with improper field
>>> name(s)?
>> Shapefiles have funny restrictions as to the length and form of variable
>> names, you probably ran into that, as the message suggests.
>>
>> A general advice is to not use shapefiles for writing; there are better
>> alternatives, geopackage comes to mind. Shapefiles make life unnecessary
>> complicated, you've now run into two of the many problems they have. The
>> days of creating shapefiles are over. If someone asks you to create
>> shapfiles, explain them it is a bad idea.
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics
>> Heisenbergstrasse 2, 48149 Muenster, Germany
>> Phone: +49 251 8333081
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>          [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>        [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From gr@h@m|e@@k5 @end|ng |rom gm@||@com  Sat Jul  4 21:22:14 2020
From: gr@h@m|e@@k5 @end|ng |rom gm@||@com (Graham Leask)
Date: Sat, 4 Jul 2020 20:22:14 +0100
Subject: [R-sig-Geo] Mapping Geographical Coordinate Data
Message-ID: <9FC34998-DEC6-4739-A079-CE376FF57A46@gmail.com>

Dear List,

I have a postcode file containing geographical coordinates but this is not in the
format of a standard shape file. I list some information below;


structure(list(Postcode = structure(c("101", "102", "103", "104", 
"105", "106"), label = "Brick code", format.stata = "%9s"), Postcode_geometry = structure(c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]", 
"[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]", 
"[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]", 
"[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]", 
"[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]", 
"[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
), label = "%Key_Brick_Geometry", format.stata = "%9s")), row.names = c(NA, 
-6L), class = c("tbl_df", "tbl", "data.frame?))

How can I map this file using R? I?ve tried using the sf package with st_multipolygon and st_multilinestring without success. 

Any help as to which package and appropriate commands to successfully map this data using R will be appreciated.

Kind regards


Graham

From Roger@B|v@nd @end|ng |rom nhh@no  Sun Jul  5 15:52:42 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 5 Jul 2020 15:52:42 +0200
Subject: [R-sig-Geo] Trouble installing rgdal
In-Reply-To: <CAGxgkWgAcrLDiBzEL1qMvBT-CG9Xw=PP_8A42urMk1YEwdD6eg@mail.gmail.com>
References: <CAGxgkWjRd7HKK1VcZ77ej6Q5dUtWb0yJcLNc+LSh3P3mkiTVLQ@mail.gmail.com>
 <CAB2ovot9gbJ2cq1b7Rba9eRiJyq8ba-bVKVKL1mb2VMWaCSJbQ@mail.gmail.com>
 <CAGxgkWi_w9ajpPs_m_xCH5ty5qZKq7=JStAtfNwKos+z5Q_QfQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007022110220.3890276@reclus.nhh.no>
 <CAGxgkWhakJyKQRvqgcx605F1QDv4eysGzygpBfXK8G05wKhwNA@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031141040.3918230@reclus.nhh.no>
 <CAGxgkWjBXnM06E7uT=K4h6b6i4LHLJ2NZWUxrWzj2uNuL1KRFQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2007031206210.3918620@reclus.nhh.no>
 <alpine.LFD.2.22.394.2007031721090.3922277@reclus.nhh.no>
 <CAGxgkWgAcrLDiBzEL1qMvBT-CG9Xw=PP_8A42urMk1YEwdD6eg@mail.gmail.com>
Message-ID: <alpine.LFD.2.22.394.2007051543490.3948027@reclus.nhh.no>

The revisions needed to install on PROJ 6.1.0 and GDAL 3.0.0 involved a 
compiled function that only entered PROJ in 6.2.0, another that only 
entered GDAL in 3.0.1, and bugs in handling +proj=ob_tran in PROJ 6.0.0, 
6.1.0 and 6.1.1. Revision 1031 covering these and letting rgdal install on 
these (oldish) versions has been committed to R-Forge, and when the build 
completes will answer the intial question. The package installed using the 
old PROJ API because that choice also avoided the problem with GDAL, but 
didn't advance to being able to use WKT2 instead of Proj4 strings 
internally (with sp >= 1.4). In any case, GDAL 3.0.4 and PROJ 6.3.1 or 
later is a safer choice, but at least now those obliged to stay with 
earlier GDAL 3 and PROJ 6 should be covered.

Roger

On Sat, 4 Jul 2020, Thomas Adams wrote:

> Hi Roger!
>
> I updated GDAL and PROJ to 3.0.4 and 6.3.1, respectively... the install
> worked perfectly using:
>
> sudo R CMD INSTALL rgdal_1.5-13.tar.gz
>
> Thank you so much!
>
> Best,
> Tom
>
> On Fri, Jul 3, 2020 at 11:24 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Fri, 3 Jul 2020, Roger Bivand wrote:
>>
>>> On Fri, 3 Jul 2020, Thomas Adams wrote:
>>>
>>>>  Hi Roger,
>>>>
>>>>  I just tried re-installing withou using the argument and got this:
>>>
>>> Very useful, thanks - painful but another case of staying too close to
>> the
>>> front. proj_create_crs_to_crs_from_pj() was new in PROJ 6.2.0. I'll try
>> to
>>> adapt to accommodate older PROJ 6.
>>
>> Re-creating a GDAL 3.0.0 with PROJ 6.1.0 platform has thrown up another
>> issue which which I'm struggling. I'll try to resolve it, but until then
>> advice would be to update GDAL and PROJ to 3.0.4 and 6.3.1, which we know
>> work (those are the versions in the CRAN Windows binary).
>>
>> Roger
>>
>>>
>>> Roger
>>>
>>>>
>>>>  teaiii at teaiii-Leopard-WS:~$ sudo R CMD INSTALL rgdal_1.5-13.tar.gz
>>>>  * installing to library
>> ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
>>>>  * installing *source* package ?rgdal? ...
>>>>  ** using staged installation
>>>> configure:  R_HOME: /usr/local/lib/R
>>>> configure:  CC: gcc
>>>> configure:  CXX: g++ -std=gnu++11
>>>> configure:  CFLAGS: -g -O2
>>>> configure:  CPPFLAGS: -I/usr/local/include
>>>> configure:  CXXFLAGS: -g -O2
>>>> configure: LDFLAGS:  -L/usr/local/lib
>>>> configure: LDFLAGS:  -L/usr/local/lib
>>>> configure:  CXX11 is: g++, CXX11STD is: -std=gnu++11
>>>> configure:  CXX is: g++ -std=gnu++11
>>>> configure:  C++11 support available
>>>> configure:  rgdal: 1.5-13
>>>>  checking for /usr/bin/svnversion... yes
>>>>  cat: inst/SVN_VERSION: No such file or directory
>>>> configure:  svn revision:
>>>>  checking for gdal-config... /usr/local/bin/gdal-config
>>>>  checking gdal-config usability... yes
>>>> configure:  GDAL: 3.0.0
>>>>  checking GDAL version >= 1.11.4... yes
>>>>  checking GDAL version <= 2.5 or >= 3.0... yes
>>>>  checking GDAL: linking with --libs only... yes
>>>>  checking GDAL: gdal-config data directory readable... yes
>>>>  checking GDAL: /usr/local/share/gdal/stateplane.csv readable... yes
>>>> configure:  pkg-config proj exists, will use it
>>>> configure:  PROJ version: 6.1.0
>>>> configure:  PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
>>>> configure:  PROJ LIBS: -L/usr/local/lib -lproj
>>>>  checking PROJ header API:... yes
>>>>  checking whether the C++ compiler works... yes
>>>>  checking for C++ compiler default output file name... a.out
>>>>  checking for suffix of executables...
>>>>  checking whether we are cross compiling... no
>>>>  checking for suffix of object files... o
>>>>  checking whether we are using the GNU C++ compiler... yes
>>>>  checking whether g++ -std=gnu++11 accepts -g... yes
>>>>  checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
>>>>  checking for grep that handles long lines and -e... /bin/grep
>>>>  checking for egrep... /bin/grep -E
>>>>  checking for ANSI C header files... yes
>>>>  checking for sys/types.h... yes
>>>>  checking for sys/stat.h... yes
>>>>  checking for stdlib.h... yes
>>>>  checking for string.h... yes
>>>>  checking for memory.h... yes
>>>>  checking for strings.h... yes
>>>>  checking for inttypes.h... yes
>>>>  checking for stdint.h... yes
>>>>  checking for unistd.h... yes
>>>>  checking proj.h usability... yes
>>>>  checking proj.h presence... yes
>>>>  checking for proj.h... yes
>>>>  checking for proj_context_create in -lproj... yes
>>>>  checking Using GDAL < 3 with PROJ >= 6... no
>>>>  checking PROJ version >= 4.8.0... yes
>>>>  checking PROJ: proj.db found and readable... yes
>>>> configure:  Package CPP flags:  -I/usr/local/include
>> -I/usr/local/include
>>>>  -DPROJ_H_API
>>>> configure:  Package LIBS:  -L/usr/local/lib -lgdal -L/usr/local/lib
>> -lproj
>>>> configure:  creating ./config.status
>>>>  config.status: creating src/Makevars
>>>>  ** libs
>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>  -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o OGR_write.o
>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>  -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
>>>>  gdal-bindings.o
>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o local_stubs.o
>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>  -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o ogr_geom.o
>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
>> ogr_polygons.o
>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>  -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o ogr_proj.o
>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>  -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogrdrivers.cpp -o ogrdrivers.o
>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>  -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogrsource.cpp -o ogrsource.o
>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>  -I/usr/local/include
>>>>  -I/usr/local/include -DPROJ_H_API
>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>  -I/usr/local/include   -fpic  -g -O2  -c proj6.cpp -o proj6.o
>>>>  proj6.cpp: In function ?SEXPREC* transform_ng(SEXP, SEXP, SEXP, SEXP,
>>>>  SEXP,
>>>>  SEXP, SEXP)?:
>>>>  proj6.cpp:521:29: error: ?proj_create_crs_to_crs_from_pj? was not
>> declared
>>>>  in this scope
>>>>          if ((pj_transform =
>> proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
>>>>  source_crs,
>>>>                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>>>  proj6.cpp:521:29: note: suggested alternative: ?proj_create_crs_to_crs?
>>>>          if ((pj_transform =
>> proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
>>>>  source_crs,
>>>>                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>>>                              proj_create_crs_to_crs
>>>>  proj6.cpp: In function ?SEXPREC* project_ng_coordOp(SEXP, SEXP)?:
>>>>  proj6.cpp:704:33: error: ?proj_create_crs_to_crs_from_pj? was not
>> declared
>>>>  in this scope
>>>>      if (use_inv) pj_transform =
>>>>  proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
>>>>                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>>>  proj6.cpp:704:33: note: suggested alternative: ?proj_create_crs_to_crs?
>>>>      if (use_inv) pj_transform =
>>>>  proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX, target_crs,
>>>>                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>>>                                  proj_create_crs_to_crs
>>>>  proj6.cpp:706:25: error: ?proj_create_crs_to_crs_from_pj? was not
>> declared
>>>>  in this scope
>>>>      else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
>>>>  source_crs,
>>>>                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>>>  proj6.cpp:706:25: note: suggested alternative: ?proj_create_crs_to_crs?
>>>>      else pj_transform = proj_create_crs_to_crs_from_pj(PJ_DEFAULT_CTX,
>>>>  source_crs,
>>>>                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>>>>                          proj_create_crs_to_crs
>>>>  /usr/local/lib/R/etc/Makeconf:176: recipe for target 'proj6.o' failed
>>>>  make: *** [proj6.o] Error 1
>>>>  ERROR: compilation failed for package ?rgdal?
>>>>  * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>>>  * restoring previous
>>>>  ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>>>
>>>>  On Fri, Jul 3, 2020 at 5:45 AM Roger Bivand <Roger.Bivand at nhh.no>
>> wrote:
>>>>
>>>>>  On Thu, 2 Jul 2020, Thomas Adams wrote:
>>>>>
>>>>>>  Roger,
>>>>>>
>>>>>>  Thank you so much; after downloading the *.tar.gz file, the that did
>> the
>>>>>>  trick, using:
>>>>>>
>>>>>>  sudo R CMD INSTALL --configure-args=--with-proj_api="proj_api.h"
>>>>>>  rgdal_1.5-13.tar.gz
>>>>>
>>>>>  Since you have GDAL: 3.0.0 and PROJ version: 6.1.0, you can drop
>>>>>  --configure-args=--with-proj_api="proj_api.h", which is only needed if
>>>>>  GDAL < 3 and PROJ >= 6. I'm uncertain how stable a system will be if
>> GDAL
>>>>>>  = 3 && PROJ >= 6 with this configure argument, as it is only a
>>>>>  work-around for systems with GDAL < 3 and PROJ >= 6, and onnly tested
>> in
>>>>>  that setting.
>>>>>
>>>>>  Thanks for reporting back!
>>>>>
>>>>>  Roger
>>>>>
>>>>>>
>>>>>>  Best regards!
>>>>>>  Tom
>>>>>>
>>>>>>
>>>>>>  On Thu, Jul 2, 2020 at 3:15 PM Roger Bivand <Roger.Bivand at nhh.no>
>> wrote:
>>>>>>
>>>>>>>  On Thu, 2 Jul 2020, Thomas Adams wrote:
>>>>>>>
>>>>>>>>  Hi Bennet!
>>>>>>>>
>>>>>>>>  Thank you for your help, but I get the same error...
>>>>>>>
>>>>>>>  Tom,
>>>>>>>
>>>>>>>  Once rgdal revision 1029 completes building (check first) on:
>>>>>>>
>>>>>>>  https://r-forge.r-project.org/R/?group_id=884
>>>>>>>
>>>>>>>  please re-try. The missing function is not in the GDAL 3.0.0
>> headers,
>>>>>  but
>>>>>>>  is in the 3.0.1 headers. I've modified the check so as not to try
>> for
>>>>>  just
>>>>>>>>  = 3 to >= 3.0.1.
>>>>>>>
>>>>>>>  Roger
>>>>>>>
>>>>>>>>
>>>>>>>>  Tom
>>>>>>>>
>>>>>>>>  On Thu, Jul 2, 2020 at 2:01 PM Bennet Fauber <bennet at umich.edu>
>> wrote:
>>>>>>>>
>>>>>>>>>  You might try this
>>>>>>>>>
>>>>>>>>>  install.packages("rgdal", "/sw/arcts/centos7/Rgeospatial/062020",
>>>>>>>>>  repos="http://R-Forge.R-project.org")
>>>>>>>>>
>>>>>>>>>  as there have been recent patches to rgdal that might help that
>> have
>>>>>>>>>  been incorporated there.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>  On Thu, Jul 2, 2020 at 1:47 PM Thomas Adams <tea3rd at gmail.com>
>> wrote:
>>>>>>>>>>
>>>>>>>>>>  Hi all,
>>>>>>>>>>
>>>>>>>>>>  I have searched the internet and have spent a few days trying to
>> get
>>>>>  to
>>>>>>>>>  the
>>>>>>>>>>  problem when I try to install rgdal into my Ubuntu 18.04 system.
>> I
>>>>>  have
>>>>>>>>>>  done this many times previously, but cannot seem to track down
>> what
>>>>>>>>>>  I
>>>>>>>  am
>>>>>>>>>>  doing wrong now. I have tried a forced install from sources with
>> and
>>>>>>>>>>  without dependencies. Below is what I get. Any help is
>> appreciated.
>>>>>>>>>>
>>>>>>>>>>  Tom
>>>>>>>>>>
>>>>>>>>>>>  install.packages("rgdal")
>>>>>>>>>>  Installing package into
>>>>>>>  ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0?
>>>>>>>>>>  (as ?lib? is unspecified)
>>>>>>>>>>  trying URL '
>> https://cran.case.edu/src/contrib/rgdal_1.5-12.tar.gz'
>>>>>>>>>>  Content type 'application/x-gzip' length 2302403 bytes (2.2 MB)
>>>>>>>>>>  ==================================================
>>>>>>>>>>  downloaded 2.2 MB
>>>>>>>>>>
>>>>>>>>>>  * installing *source* package ?rgdal? ...
>>>>>>>>>>  ** package ?rgdal? successfully unpacked and MD5 sums checked
>>>>>>>>>>  ** using staged installation
>>>>>>>>>> configure:  R_HOME: /usr/local/lib/R
>>>>>>>>>> configure:  CC: gcc
>>>>>>>>>> configure:  CXX: g++ -std=gnu++11
>>>>>>>>>> configure:  CXX11 is: g++, CXX11STD is: -std=gnu++11
>>>>>>>>>> configure:  CXX is: g++ -std=gnu++11
>>>>>>>>>> configure:  C++11 support available
>>>>>>>>>> configure:  rgdal: 1.5-12
>>>>>>>>>>  checking for /usr/bin/svnversion... yes
>>>>>>>>>> configure:  svn revision: 1018
>>>>>>>>>>  checking for gdal-config... /usr/local/bin/gdal-config
>>>>>>>>>>  checking gdal-config usability... yes
>>>>>>>>>> configure:  GDAL: 3.0.0
>>>>>>>>>>  checking GDAL version >= 1.11.4... yes
>>>>>>>>>>  checking GDAL version <= 2.5 or >= 3.0... yes
>>>>>>>>>>  checking GDAL: linking with --libs only... yes
>>>>>>>>>>  checking GDAL: gdal-config data directory readable... yes
>>>>>>>>>>  checking GDAL: /usr/local/share/gdal/stateplane.csv readable...
>> yes
>>>>>>>>>> configure:  pkg-config proj exists, will use it
>>>>>>>>>> configure:  PROJ version: 6.1.0
>>>>>>>>>> configure:  PROJ CPP flags: -DPROJ_H_API -I/usr/local/include
>>>>>>>>>> configure:  PROJ LIBS: -L/usr/local/lib -lproj
>>>>>>>>>>  checking PROJ header API:... yes
>>>>>>>>>>  checking whether the C++ compiler works... yes
>>>>>>>>>>  checking for C++ compiler default output file name... a.out
>>>>>>>>>>  checking for suffix of executables...
>>>>>>>>>>  checking whether we are cross compiling... no
>>>>>>>>>>  checking for suffix of object files... o
>>>>>>>>>>  checking whether we are using the GNU C++ compiler... yes
>>>>>>>>>>  checking whether g++ -std=gnu++11 accepts -g... yes
>>>>>>>>>>  checking how to run the C++ preprocessor... g++ -std=gnu++11 -E
>>>>>>>>>>  checking for grep that handles long lines and -e... /bin/grep
>>>>>>>>>>  checking for egrep... /bin/grep -E
>>>>>>>>>>  checking for ANSI C header files... yes
>>>>>>>>>>  checking for sys/types.h... yes
>>>>>>>>>>  checking for sys/stat.h... yes
>>>>>>>>>>  checking for stdlib.h... yes
>>>>>>>>>>  checking for string.h... yes
>>>>>>>>>>  checking for memory.h... yes
>>>>>>>>>>  checking for strings.h... yes
>>>>>>>>>>  checking for inttypes.h... yes
>>>>>>>>>>  checking for stdint.h... yes
>>>>>>>>>>  checking for unistd.h... yes
>>>>>>>>>>  checking proj.h usability... yes
>>>>>>>>>>  checking proj.h presence... yes
>>>>>>>>>>  checking for proj.h... yes
>>>>>>>>>>  checking for proj_context_create in -lproj... yes
>>>>>>>>>>  checking Using GDAL < 3 with PROJ >= 6... no
>>>>>>>>>>  checking PROJ version >= 4.8.0... yes
>>>>>>>>>>  checking PROJ: proj.db found and readable... yes
>>>>>>>>>> configure:  Package CPP flags:  -I/usr/local/include
>>>>>>>  -I/usr/local/include
>>>>>>>>>>  -DPROJ_H_API
>>>>>>>>>> configure:  Package LIBS:  -L/usr/local/lib -lgdal
>> -L/usr/local/lib
>>>>>>>  -lproj
>>>>>>>>>> configure:  creating ./config.status
>>>>>>>>>>  config.status: creating src/Makevars
>>>>>>>>>>  ** libs
>>>>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>>>>>  -I/usr/local/include
>>>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c OGR_write.cpp -o
>>>>>>>>>>  OGR_write.o
>>>>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>>>>>  -I/usr/local/include
>>>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c gdal-bindings.cpp -o
>>>>>>>>>>  gdal-bindings.o
>>>>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o
>>>>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c inverser.c -o inverser.o
>>>>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c local_stubs.c -o
>>>>>  local_stubs.o
>>>>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>>>>>  -I/usr/local/include
>>>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_geom.cpp -o
>> ogr_geom.o
>>>>>>>>>>  gcc -I"/usr/local/lib/R/include" -DNDEBUG -I/usr/local/include
>>>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_polygons.c -o
>>>>>>>  ogr_polygons.o
>>>>>>>>>>  g++ -std=gnu++11 -I"/usr/local/lib/R/include" -DNDEBUG
>>>>>>>>>  -I/usr/local/include
>>>>>>>>>>  -I/usr/local/include -DPROJ_H_API
>>>>>>>>>>  -I'/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/sp/include'
>>>>>>>>>>  -I/usr/local/include   -fpic  -g -O2  -c ogr_proj.cpp -o
>> ogr_proj.o
>>>>>>>>>>  ogr_proj.cpp: In function ?SEXPREC* R_GDAL_OSR_PROJ()?:
>>>>>>>>>>  ogr_proj.cpp:163:9: error: ?OSRGetPROJVersion? was not declared
>> in
>>>>>  this
>>>>>>>>>>  scope
>>>>>>>>>>           OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>>>>>>>>           ^~~~~~~~~~~~~~~~~
>>>>>>>>>>  ogr_proj.cpp:163:9: note: suggested alternative: ?OSRProjVersion?
>>>>>>>>>>           OSRGetPROJVersion(&pnMajor, &pnMinor, &pnPatch);
>>>>>>>>>>           ^~~~~~~~~~~~~~~~~
>>>>>>>>>>           OSRProjVersion
>>>>>>>>>>  /usr/local/lib/R/etc/Makeconf:176: recipe for target 'ogr_proj.o'
>>>>>>>  failed
>>>>>>>>>>  make: *** [ogr_proj.o] Error 1
>>>>>>>>>>  ERROR: compilation failed for package ?rgdal?
>>>>>>>>>>  * removing ?/home/teaiii/R/x86_64-pc-linux-gnu-library/4.0/rgdal?
>>>>>>>>>>
>>>>>>>>>>  The downloaded source packages are in
>>>>>>>>>>  ?/tmp/RtmpNkdFOf/downloaded_packages?
>>>>>>>>>>  Warning message:
>>>>>>>>>>  In install.packages("rgdal") :
>>>>>>>>>>    installation of package ?rgdal? had non-zero exit status
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>  --
>>>>>>>>>>  Thomas E Adams, III
>>>>>>>>>>  1724 Sage Lane
>>>>>>>>>>  Blacksburg, VA 24060
>>>>>>>>>>  tea3rd at gmail.com (personal)
>>>>>>>>>>  tea at terrapredictions.org (work)
>>>>>>>>>>
>>>>>>>>>>  1 (513) 739-9512 (cell)
>>>>>>>>>>
>>>>>>>>>>          [[alternative HTML version deleted]]
>>>>>>>>>>
>>>>>>>>>>  _______________________________________________
>>>>>>>>>>  R-sig-Geo mailing list
>>>>>>>>>>  R-sig-Geo at r-project.org
>>>>>>>>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>>  --
>>>>>>>  Roger Bivand
>>>>>>>  Department of Economics, Norwegian School of Economics,
>>>>>>>  Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>>>>>  https://orcid.org/0000-0003-2392-6140
>>>>>>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>>  --
>>>>>  Roger Bivand
>>>>>  Department of Economics, Norwegian School of Economics,
>>>>>  Helleveien 30, N-5045 Bergen, Norway.
>>>>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>>>  https://orcid.org/0000-0003-2392-6140
>>>>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>
>>>>
>>>>
>>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Sun Jul  5 16:00:13 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 5 Jul 2020 16:00:13 +0200
Subject: [R-sig-Geo] Mapping Geographical Coordinate Data
In-Reply-To: <9FC34998-DEC6-4739-A079-CE376FF57A46@gmail.com>
References: <9FC34998-DEC6-4739-A079-CE376FF57A46@gmail.com>
Message-ID: <alpine.LFD.2.22.394.2007051553080.3948027@reclus.nhh.no>

On Sat, 4 Jul 2020, Graham Leask wrote:

> Dear List,
>
> I have a postcode file containing geographical coordinates but this is 
> not in the format of a standard shape file. I list some information 
> below;

Is the smoking gun: 'format.stata = "%9s"'? What generated the data - was 
it for example read into R using foreign, haven, or some other function or 
package for reading stata objects? What function in Stata generated that 
file (if made in Stata)? Could you please provide the full context 
including the lines of the Stata do file used? Some seem to use Stata for 
mapping:

https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/

so we need to know what made the object, and whether it could have made 
something more readable.

Roger

>
>
> structure(list(Postcode = structure(c("101", "102", "103", "104",
> "105", "106"), label = "Brick code", format.stata = "%9s"), Postcode_geometry = structure(c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
> ), label = "%Key_Brick_Geometry", format.stata = "%9s")), row.names = c(NA,
> -6L), class = c("tbl_df", "tbl", "data.frame?))
>
> How can I map this file using R? I?ve tried using the sf package with 
> st_multipolygon and st_multilinestring without success.
>
> Any help as to which package and appropriate commands to successfully 
> map this data using R will be appreciated.
>
> Kind regards
>
>
> Graham
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From gr@h@m|e@@k5 @end|ng |rom gm@||@com  Sun Jul  5 20:27:45 2020
From: gr@h@m|e@@k5 @end|ng |rom gm@||@com (Graham Leask)
Date: Sun, 5 Jul 2020 19:27:45 +0100
Subject: [R-sig-Geo] Mapping Geographical Coordinate Data
In-Reply-To: <alpine.LFD.2.22.394.2007051553080.3948027@reclus.nhh.no>
References: <9FC34998-DEC6-4739-A079-CE376FF57A46@gmail.com>
 <alpine.LFD.2.22.394.2007051553080.3948027@reclus.nhh.no>
Message-ID: <4C8A2153-4F53-4F70-A42C-A625A024D820@gmail.com>

Hi Roger

Here is the file imported from the original .csv file. I suspect it may have originated as a .qvd file converted to .csv.

dput(head(Geog1))
structure(list(BrickCode = c("101;", "102;", "103;", "104;", 
"105;", "106;"), X.Key_Brick_Geometry = c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]", 
"[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]", 
"[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]", 
"[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]", 
"[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]", 
"[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
)), row.names = c(NA, 6L), class = "data.frame")

> On 5 Jul 2020, at 15:00, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> On Sat, 4 Jul 2020, Graham Leask wrote:
> 
>> Dear List,
>> 
>> I have a postcode file containing geographical coordinates but this is not in the format of a standard shape file. I list some information below;
> 
> Is the smoking gun: 'format.stata = "%9s"'? What generated the data - was it for example read into R using foreign, haven, or some other function or package for reading stata objects? What function in Stata generated that file (if made in Stata)? Could you please provide the full context including the lines of the Stata do file used? Some seem to use Stata for mapping:
> 
> https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/ <https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/>
> 
> so we need to know what made the object, and whether it could have made something more readable.
> 
> Roger
> 
>> 
>> 
>> structure(list(Postcode = structure(c("101", "102", "103", "104",
>> "105", "106"), label = "Brick code", format.stata = "%9s"), Postcode_geometry = structure(c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
>> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
>> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
>> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
>> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
>> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
>> ), label = "%Key_Brick_Geometry", format.stata = "%9s")), row.names = c(NA,
>> -6L), class = c("tbl_df", "tbl", "data.frame?))
>> 
>> How can I map this file using R? I?ve tried using the sf package with st_multipolygon and st_multilinestring without success.
>> 
>> Any help as to which package and appropriate commands to successfully map this data using R will be appreciated.
>> 
>> Kind regards
>> 
>> 
>> Graham
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
> https://orcid.org/0000-0003-2392-6140 <https://orcid.org/0000-0003-2392-6140>
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>

	[[alternative HTML version deleted]]


From gr@h@m|e@@k5 @end|ng |rom gm@||@com  Sun Jul  5 20:32:47 2020
From: gr@h@m|e@@k5 @end|ng |rom gm@||@com (Graham Leask)
Date: Sun, 5 Jul 2020 19:32:47 +0100
Subject: [R-sig-Geo] Mapping Geographical Coordinates
In-Reply-To: <AM4PR05MB3316C2D3580360C0BB85609EAC680@AM4PR05MB3316.eurprd05.prod.outlook.com>
References: <AM4PR05MB3316C2D3580360C0BB85609EAC680@AM4PR05MB3316.eurprd05.prod.outlook.com>
Message-ID: <24503A1A-BE8D-4CF2-BF0D-BF80CB7BE509@gmail.com>


I?m afraid that I don?t know the exact origin of the file. I read the .csv file into R using read.csv.


> On 5 Jul 2020, at 18:41, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> When replying in thread, provide a link only to the csv file, or part of it, and show how you read it. What created the file?
> 
> -------
> Roger Bivand
> Norwegian School of Economics, Bergen, Norway
> roger.bivand at nhh.no
> 
>  
> Fra: Graham Leask <grahamleask5 at gmail.com>
> Sendt: s?ndag 5. juli 2020, 18:59
> Til: roger.bivand at nhh.no
> Emne: Mapping Geographical Coordinates
> 
> Dear Roger Here is the file imported from the original .csv file. dput(head(Geog1)) structure(list(BrickCode = c("101;", "102;", "103;", "104;", "105;", "106;"), X.Key_Brick_Geometry = c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]", "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]", "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]", "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]", "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]", "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]" )), row.names = c(NA, 6L), class = "data.frame") 


	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jul  6 11:23:12 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 6 Jul 2020 11:23:12 +0200
Subject: [R-sig-Geo] Mapping Geographical Coordinate Data
In-Reply-To: <4C8A2153-4F53-4F70-A42C-A625A024D820@gmail.com>
References: <9FC34998-DEC6-4739-A079-CE376FF57A46@gmail.com>
 <alpine.LFD.2.22.394.2007051553080.3948027@reclus.nhh.no>
 <4C8A2153-4F53-4F70-A42C-A625A024D820@gmail.com>
Message-ID: <alpine.LFD.2.22.394.2007061104140.3958436@reclus.nhh.no>

On Sun, 5 Jul 2020, Graham Leask wrote:

> Hi Roger
>
> Here is the file imported from the original .csv file. I suspect it may 
> have originated as a .qvd file converted to .csv.

The geometry string column contains [] separated geographical coordinates 
of somewhat varying formatting (the string versions of first and last 
ring coordinates are not always equal, I think), in an undocumented 
format.

There is certainly no existing function to read this. Use string handling 
to convert to a format that can be read, most likely Well-Known Text. This 
will involve quite advanced regular expression handling. The sample data 
look like POLYGON objects (an exterior ring and interior rings), but they 
might also be MULTIPOLYGON objects. From there, sf::st_as_sfc(). WKT does 
not group coordinates as ((1,1),(2,2)), rather as (1 1, 2 2).

It would still be very useful to know the provenance of the file in some 
detail. It is not likely that anyone will help you write the regular 
expression code to handle this data unless it can be generalised to a 
common use case (you suggested QVD (QlikView)).

Roger

>
> dput(head(Geog1))
> structure(list(BrickCode = c("101;", "102;", "103;", "104;",
> "105;", "106;"), X.Key_Brick_Geometry = c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
> )), row.names = c(NA, 6L), class = "data.frame")
>
>> On 5 Jul 2020, at 15:00, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>> On Sat, 4 Jul 2020, Graham Leask wrote:
>>
>>> Dear List,
>>>
>>> I have a postcode file containing geographical coordinates but this is not in the format of a standard shape file. I list some information below;
>>
>> Is the smoking gun: 'format.stata = "%9s"'? What generated the data - was it for example read into R using foreign, haven, or some other function or package for reading stata objects? What function in Stata generated that file (if made in Stata)? Could you please provide the full context including the lines of the Stata do file used? Some seem to use Stata for mapping:
>>
>> https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/ <https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/>
>>
>> so we need to know what made the object, and whether it could have made something more readable.
>>
>> Roger
>>
>>>
>>>
>>> structure(list(Postcode = structure(c("101", "102", "103", "104",
>>> "105", "106"), label = "Brick code", format.stata = "%9s"), Postcode_geometry = structure(c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
>>> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
>>> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
>>> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
>>> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
>>> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
>>> ), label = "%Key_Brick_Geometry", format.stata = "%9s")), row.names = c(NA,
>>> -6L), class = c("tbl_df", "tbl", "data.frame?))
>>>
>>> How can I map this file using R? I?ve tried using the sf package with st_multipolygon and st_multilinestring without success.
>>>
>>> Any help as to which package and appropriate commands to successfully map this data using R will be appreciated.
>>>
>>> Kind regards
>>>
>>>
>>> Graham
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
>> https://orcid.org/0000-0003-2392-6140 <https://orcid.org/0000-0003-2392-6140>
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From gr@h@m|e@@k5 @end|ng |rom gm@||@com  Mon Jul  6 11:30:47 2020
From: gr@h@m|e@@k5 @end|ng |rom gm@||@com (Graham Leask)
Date: Mon, 6 Jul 2020 10:30:47 +0100
Subject: [R-sig-Geo] Mapping Geographical Coordinate Data
In-Reply-To: <alpine.LFD.2.22.394.2007061104140.3958436@reclus.nhh.no>
References: <9FC34998-DEC6-4739-A079-CE376FF57A46@gmail.com>
 <alpine.LFD.2.22.394.2007051553080.3948027@reclus.nhh.no>
 <4C8A2153-4F53-4F70-A42C-A625A024D820@gmail.com>
 <alpine.LFD.2.22.394.2007061104140.3958436@reclus.nhh.no>
Message-ID: <CA+vXeCOMFOLkxcUx+SYojXRtqZvnnJxSKpTS6UQ3r+BqAJj1xg@mail.gmail.com>

Thank you. That?s helpful and confirms my thoughts that this does not
follow the standard structure that can be read by the available existing
functions within R.

Kind regards


Graham

On Mon, 6 Jul 2020 at 10:23, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Sun, 5 Jul 2020, Graham Leask wrote:
>
> > Hi Roger
> >
> > Here is the file imported from the original .csv file. I suspect it may
> > have originated as a .qvd file converted to .csv.
>
> The geometry string column contains [] separated geographical coordinates
> of somewhat varying formatting (the string versions of first and last
> ring coordinates are not always equal, I think), in an undocumented
> format.
>
> There is certainly no existing function to read this. Use string handling
> to convert to a format that can be read, most likely Well-Known Text. This
> will involve quite advanced regular expression handling. The sample data
> look like POLYGON objects (an exterior ring and interior rings), but they
> might also be MULTIPOLYGON objects. From there, sf::st_as_sfc(). WKT does
> not group coordinates as ((1,1),(2,2)), rather as (1 1, 2 2).
>
> It would still be very useful to know the provenance of the file in some
> detail. It is not likely that anyone will help you write the regular
> expression code to handle this data unless it can be generalised to a
> common use case (you suggested QVD (QlikView)).
>
> Roger
>
> >
> > dput(head(Geog1))
> > structure(list(BrickCode = c("101;", "102;", "103;", "104;",
> > "105;", "106;"), X.Key_Brick_Geometry =
> c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
> >
> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
> >
> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
> >
> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
> >
> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
> >
> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
> > )), row.names = c(NA, 6L), class = "data.frame")
> >
> >> On 5 Jul 2020, at 15:00, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >>
> >> On Sat, 4 Jul 2020, Graham Leask wrote:
> >>
> >>> Dear List,
> >>>
> >>> I have a postcode file containing geographical coordinates but this is
> not in the format of a standard shape file. I list some information below;
> >>
> >> Is the smoking gun: 'format.stata = "%9s"'? What generated the data -
> was it for example read into R using foreign, haven, or some other function
> or package for reading stata objects? What function in Stata generated that
> file (if made in Stata)? Could you please provide the full context
> including the lines of the Stata do file used? Some seem to use Stata for
> mapping:
> >>
> >>
> https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/
> <
> https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/
> >
> >>
> >> so we need to know what made the object, and whether it could have made
> something more readable.
> >>
> >> Roger
> >>
> >>>
> >>>
> >>> structure(list(Postcode = structure(c("101", "102", "103", "104",
> >>> "105", "106"), label = "Brick code", format.stata = "%9s"),
> Postcode_geometry =
> structure(c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
> >>>
> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
> >>>
> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
> >>>
> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
> >>>
> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
> >>>
> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
> >>> ), label = "%Key_Brick_Geometry", format.stata = "%9s")), row.names =
> c(NA,
> >>> -6L), class = c("tbl_df", "tbl", "data.frame?))
> >>>
> >>> How can I map this file using R? I?ve tried using the sf package with
> st_multipolygon and st_multilinestring without success.
> >>>
> >>> Any help as to which package and appropriate commands to successfully
> map this data using R will be appreciated.
> >>>
> >>> Kind regards
> >>>
> >>>
> >>> Graham
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> >>>
> >>
> >> --
> >> Roger Bivand
> >> Department of Economics, Norwegian School of Economics,
> >> Helleveien 30, N-5045 Bergen, Norway.
> >> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no <mailto:
> Roger.Bivand at nhh.no>
> >> https://orcid.org/0000-0003-2392-6140 <
> https://orcid.org/0000-0003-2392-6140>
> >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jul  6 11:47:36 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 6 Jul 2020 11:47:36 +0200
Subject: [R-sig-Geo] Mapping Geographical Coordinate Data
In-Reply-To: <CA+vXeCOMFOLkxcUx+SYojXRtqZvnnJxSKpTS6UQ3r+BqAJj1xg@mail.gmail.com>
References: <9FC34998-DEC6-4739-A079-CE376FF57A46@gmail.com>
 <alpine.LFD.2.22.394.2007051553080.3948027@reclus.nhh.no>
 <4C8A2153-4F53-4F70-A42C-A625A024D820@gmail.com>
 <alpine.LFD.2.22.394.2007061104140.3958436@reclus.nhh.no>
 <CA+vXeCOMFOLkxcUx+SYojXRtqZvnnJxSKpTS6UQ3r+BqAJj1xg@mail.gmail.com>
Message-ID: <alpine.LFD.2.22.394.2007061140230.3958436@reclus.nhh.no>

On Mon, 6 Jul 2020, Graham Leask wrote:

> Thank you. That?s helpful and confirms my thoughts that this does not
> follow the standard structure that can be read by the available existing
> functions within R.


For your subset of the input data, this appears to work:

# o is your data subset
geoms <- o[,2]
library(sf)
l_out <- lapply(geoms, function(geom) {
   o1 <- gsub("([0-9])(,)([0-9])", "\\1 \\3", geom)
     # between lon and lat
   o2 <- gsub("\\]", ")", gsub("\\[", "(", o1))
     # all brackets to parentheses
   o3 <- gsub("([0-9])\\),\\(([0-9])", "\\1,\\2", o2)
     # between coordinate pairs
   o4 <- gsub("\\(\\(\\(", "(", gsub("\\)\\)\\)", ")", o3))
     # three ((())) to one ()
   st_as_sfc(paste0("POLYGON", o4))
})
out <- do.call("c", l_out)
plot(out, col=1:6)
st_is_valid(out)
# [1] FALSE FALSE  TRUE  TRUE  TRUE  TRUE
out1 <- st_make_valid(out)
plot(out1, col=1:6)

but having only seen the first 6, there may be further problems. 
Refreshing regular expressions knowledge is I hope an effective mental 
exercise ...

Roger

>
> Kind regards
>
>
> Graham
>
> On Mon, 6 Jul 2020 at 10:23, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Sun, 5 Jul 2020, Graham Leask wrote:
>>
>>> Hi Roger
>>>
>>> Here is the file imported from the original .csv file. I suspect it may
>>> have originated as a .qvd file converted to .csv.
>>
>> The geometry string column contains [] separated geographical coordinates
>> of somewhat varying formatting (the string versions of first and last
>> ring coordinates are not always equal, I think), in an undocumented
>> format.
>>
>> There is certainly no existing function to read this. Use string handling
>> to convert to a format that can be read, most likely Well-Known Text. This
>> will involve quite advanced regular expression handling. The sample data
>> look like POLYGON objects (an exterior ring and interior rings), but they
>> might also be MULTIPOLYGON objects. From there, sf::st_as_sfc(). WKT does
>> not group coordinates as ((1,1),(2,2)), rather as (1 1, 2 2).
>>
>> It would still be very useful to know the provenance of the file in some
>> detail. It is not likely that anyone will help you write the regular
>> expression code to handle this data unless it can be generalised to a
>> common use case (you suggested QVD (QlikView)).
>>
>> Roger
>>
>>>
>>> dput(head(Geog1))
>>> structure(list(BrickCode = c("101;", "102;", "103;", "104;",
>>> "105;", "106;"), X.Key_Brick_Geometry =
>> c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
>>>
>> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
>>>
>> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
>>>
>> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
>>>
>> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
>>>
>> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
>>> )), row.names = c(NA, 6L), class = "data.frame")
>>>
>>>> On 5 Jul 2020, at 15:00, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>
>>>> On Sat, 4 Jul 2020, Graham Leask wrote:
>>>>
>>>>> Dear List,
>>>>>
>>>>> I have a postcode file containing geographical coordinates but this is
>> not in the format of a standard shape file. I list some information below;
>>>>
>>>> Is the smoking gun: 'format.stata = "%9s"'? What generated the data -
>> was it for example read into R using foreign, haven, or some other function
>> or package for reading stata objects? What function in Stata generated that
>> file (if made in Stata)? Could you please provide the full context
>> including the lines of the Stata do file used? Some seem to use Stata for
>> mapping:
>>>>
>>>>
>> https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/
>> <
>> https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/
>>>
>>>>
>>>> so we need to know what made the object, and whether it could have made
>> something more readable.
>>>>
>>>> Roger
>>>>
>>>>>
>>>>>
>>>>> structure(list(Postcode = structure(c("101", "102", "103", "104",
>>>>> "105", "106"), label = "Brick code", format.stata = "%9s"),
>> Postcode_geometry =
>> structure(c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
>>>>>
>> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
>>>>>
>> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
>>>>>
>> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
>>>>>
>> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
>>>>>
>> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
>>>>> ), label = "%Key_Brick_Geometry", format.stata = "%9s")), row.names =
>> c(NA,
>>>>> -6L), class = c("tbl_df", "tbl", "data.frame?))
>>>>>
>>>>> How can I map this file using R? I?ve tried using the sf package with
>> st_multipolygon and st_multilinestring without success.
>>>>>
>>>>> Any help as to which package and appropriate commands to successfully
>> map this data using R will be appreciated.
>>>>>
>>>>> Kind regards
>>>>>
>>>>>
>>>>> Graham
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Department of Economics, Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no <mailto:
>> Roger.Bivand at nhh.no>
>>>> https://orcid.org/0000-0003-2392-6140 <
>> https://orcid.org/0000-0003-2392-6140>
>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From gr@h@m|e@@k5 @end|ng |rom gm@||@com  Mon Jul  6 15:40:44 2020
From: gr@h@m|e@@k5 @end|ng |rom gm@||@com (Graham Leask)
Date: Mon, 6 Jul 2020 14:40:44 +0100
Subject: [R-sig-Geo] Mapping Geographical Coordinate Data
In-Reply-To: <alpine.LFD.2.22.394.2007061140230.3958436@reclus.nhh.no>
References: <9FC34998-DEC6-4739-A079-CE376FF57A46@gmail.com>
 <alpine.LFD.2.22.394.2007051553080.3948027@reclus.nhh.no>
 <4C8A2153-4F53-4F70-A42C-A625A024D820@gmail.com>
 <alpine.LFD.2.22.394.2007061104140.3958436@reclus.nhh.no>
 <CA+vXeCOMFOLkxcUx+SYojXRtqZvnnJxSKpTS6UQ3r+BqAJj1xg@mail.gmail.com>
 <alpine.LFD.2.22.394.2007061140230.3958436@reclus.nhh.no>
Message-ID: <4D3C1727-2913-4687-A9C3-7E69224BB3F9@gmail.com>

Your code worked perfectly Roger. Thank you.


> On 6 Jul 2020, at 10:47, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> On Mon, 6 Jul 2020, Graham Leask wrote:
> 
>> Thank you. That?s helpful and confirms my thoughts that this does not
>> follow the standard structure that can be read by the available existing
>> functions within R.
> 
> 
> For your subset of the input data, this appears to work:
> 
> # o is your data subset
> geoms <- o[,2]
> library(sf)
> l_out <- lapply(geoms, function(geom) {
>  o1 <- gsub("([0-9])(,)([0-9])", "\\1 \\3", geom)
>    # between lon and lat
>  o2 <- gsub("\\]", ")", gsub("\\[", "(", o1))
>    # all brackets to parentheses
>  o3 <- gsub("([0-9])\\),\\(([0-9])", "\\1,\\2", o2)
>    # between coordinate pairs
>  o4 <- gsub("\\(\\(\\(", "(", gsub("\\)\\)\\)", ")", o3))
>    # three ((())) to one ()
>  st_as_sfc(paste0("POLYGON", o4))
> })
> out <- do.call("c", l_out)
> plot(out, col=1:6)
> st_is_valid(out)
> # [1] FALSE FALSE  TRUE  TRUE  TRUE  TRUE
> out1 <- st_make_valid(out)
> plot(out1, col=1:6)
> 
> but having only seen the first 6, there may be further problems. Refreshing regular expressions knowledge is I hope an effective mental exercise ...
> 
> Roger
> 
>> 
>> Kind regards
>> 
>> 
>> Graham
>> 
>> On Mon, 6 Jul 2020 at 10:23, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> 
>>> On Sun, 5 Jul 2020, Graham Leask wrote:
>>> 
>>>> Hi Roger
>>>> 
>>>> Here is the file imported from the original .csv file. I suspect it may
>>>> have originated as a .qvd file converted to .csv.
>>> 
>>> The geometry string column contains [] separated geographical coordinates
>>> of somewhat varying formatting (the string versions of first and last
>>> ring coordinates are not always equal, I think), in an undocumented
>>> format.
>>> 
>>> There is certainly no existing function to read this. Use string handling
>>> to convert to a format that can be read, most likely Well-Known Text. This
>>> will involve quite advanced regular expression handling. The sample data
>>> look like POLYGON objects (an exterior ring and interior rings), but they
>>> might also be MULTIPOLYGON objects. From there, sf::st_as_sfc(). WKT does
>>> not group coordinates as ((1,1),(2,2)), rather as (1 1, 2 2).
>>> 
>>> It would still be very useful to know the provenance of the file in some
>>> detail. It is not likely that anyone will help you write the regular
>>> expression code to handle this data unless it can be generalised to a
>>> common use case (you suggested QVD (QlikView)).
>>> 
>>> Roger
>>> 
>>>> 
>>>> dput(head(Geog1))
>>>> structure(list(BrickCode = c("101;", "102;", "103;", "104;",
>>>> "105;", "106;"), X.Key_Brick_Geometry =
>>> c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
>>>> 
>>> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
>>>> 
>>> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
>>>> 
>>> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
>>>> 
>>> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
>>>> 
>>> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
>>>> )), row.names = c(NA, 6L), class = "data.frame")
>>>> 
>>>>> On 5 Jul 2020, at 15:00, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>> 
>>>>> On Sat, 4 Jul 2020, Graham Leask wrote:
>>>>> 
>>>>>> Dear List,
>>>>>> 
>>>>>> I have a postcode file containing geographical coordinates but this is
>>> not in the format of a standard shape file. I list some information below;
>>>>> 
>>>>> Is the smoking gun: 'format.stata = "%9s"'? What generated the data -
>>> was it for example read into R using foreign, haven, or some other function
>>> or package for reading stata objects? What function in Stata generated that
>>> file (if made in Stata)? Could you please provide the full context
>>> including the lines of the Stata do file used? Some seem to use Stata for
>>> mapping:
>>>>> 
>>>>> 
>>> https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/
>>> <
>>> https://blog.stata.com/2020/04/07/how-to-create-choropleth-maps-using-the-covid-19-data-from-johns-hopkins-university/
>>>> 
>>>>> 
>>>>> so we need to know what made the object, and whether it could have made
>>> something more readable.
>>>>> 
>>>>> Roger
>>>>> 
>>>>>> 
>>>>>> 
>>>>>> structure(list(Postcode = structure(c("101", "102", "103", "104",
>>>>>> "105", "106"), label = "Brick code", format.stata = "%9s"),
>>> Postcode_geometry =
>>> structure(c("[[[[15.066294,54.986481],[15.08849170010846,54.98916685060565],[15.109724384490239,55.009579959623146],[15.120340726681128,55.014414643337815],[15.120340726681128,55.02945588156123],[15.112619750542299,55.03805087483176],[15.123236092733189,55.04503430686406],[15.125166336767895,55.05040617765814],[15.138678045010845,55.05792679676985],[15.140608289045552,55.06759616419919],[15.158945607375271,55.081025841184385],[15.158945607375271,55.089620834454905],[15.151224631236442,55.10036457604306],[15.151224631236442,55.11110831763122],[15.147364143167028,55.11540581426648],[15.158945607375271,55.12829830417227],[15.154119997288504,55.13420736204576],[15.138678045010845,55.144951103633915],[15.117445360629068,55.146025477792726],[15.078840479934925,55.156769219380884],[15.046026331344903,55.17288483176312],[15.017072670824295,55.18040545087483],[14.990049254338395,55.19759543741588],[14.984258522234274,55.20726480484522],[14.968816569956616,55.215859798115744],[14.939862909436009,55.212636675639295],[14.926351201193059,55.220157294751004],[14.889676564533623,55.22767791386271],[14.872304368221258,55.24164477792732],[14.835629731561822,55.25131414535666],[14.820187779284165,55.25990913862718],[14.810536559110629,55.276024751009416],[14.781582898590022,55.29214036339165],[14.779652654555314,55.29966098250336],[14.766140946312365,55.29966098250336],[14.750698994034707,55.291065989232834],[14.749733872017353,55.2679669448183],[14.733326797722343,55.24916539703903],[14.715954601409978,55.23519853297442],[14.703408015184381,55.212099488559886],[14.703408015184381,55.203504495289366],[14.699547527114968,55.1992069986541],[14.699547527114968,55.17557076716016],[14.703408015184381,55.17127327052489],[14.703408015184381,55.12829830417227],[14.699547527114968,55.12400080753701],[14.699547527114968,55.11325706594885],[14.6947219170282,55.10734800807536],[14.685070696854664,55.10412488559892],[14.685070696854664,55.09660426648721],[14.70823362527115,55.081563028263794],[14.7217453335141,55.078339905787345],[14.746838505965293,55.06222429340511],[14.77000143438178,55.05362930013459],[14.79992021691974,55.05094336473755],[14.824048267353579,55.04288555854643],[14.880025344360087,55.03321619111709],[14.89739754067245,55.023546823687745],[14.959165349783081,55.00420808882907],[15.008386572668112,54.99507590847914],[15.043130965292843,54.9929271601615],[15.066294,54.986481]]],[[[15.182108999999999,55.323834],[15.19369,55.321686],[15.19369,55.319537],[15.185969,55.317387999999994],[15.182108999999999,55.319537],[15.182108999999999,55.323834]]],[[[15.182108999999999,55.323834],[15.174387999999999,55.323834],[15.174387999999999,55.325983],[15.182108999999999,55.325983],[15.182108999999999,55.323834]]]]",
>>>>>> 
>>> "[[[[12.529952999999999,55.631105],[12.525127622017353,55.62519635262449],[12.507755425704989,55.61552698519515],[12.506790303687636,55.60102293405114],[12.52705786605206,55.57577514131897],[12.552151038503252,55.57255201884253],[12.565662746746202,55.55858515477792],[12.598476895336225,55.55643640646029],[12.631291043926247,55.57470076716016],[12.667965680585683,55.58222138627187],[12.679547144793926,55.58866763122476],[12.680512266811279,55.59457668909825],[12.673756412689805,55.602634495289365],[12.684372754880693,55.61606417227456],[12.684372754880693,55.62465916554508],[12.679547144793926,55.6327169717362],[12.66217494848156,55.63594009421265],[12.654453972342733,55.64238633916554],[12.64866324023861,55.65850195154778],[12.638046898047723,55.66763413189771],[12.649628362255964,55.676229125168234],[12.639012020065074,55.683212557200534],[12.637081776030367,55.69073317631224],[12.619709579718004,55.68858442799461],[12.610058359544468,55.678915060565274],[12.59461640726681,55.670320067294746],[12.577244210954445,55.669245693135935],[12.564698,55.661187999999996],[12.563732502711495,55.65527882907133],[12.552151038503252,55.64453508748317],[12.529952999999999,55.631105]]],[[[12.734558999999999,55.609618],[12.749035930043384,55.606931991924625],[12.777024468546637,55.59027919246299],[12.774129102494577,55.58866763122476],[12.75096617407809,55.595113876177656],[12.739384709869848,55.60156012113055],[12.734558999999999,55.609618]]],[[[12.792466,55.607468999999995],[12.762547638286334,55.60585761776581],[12.749035930043384,55.61767573351278],[12.739384709869848,55.618750107671595],[12.730698611713665,55.63755165545087],[12.743245197939261,55.6670969448183],[12.769303492407808,55.671931628532974],[12.779919834598697,55.66494819650067],[12.784745444685466,55.65689039030955],[12.784745444685466,55.62895666218034],[12.792466420824294,55.613915423956925],[12.792466,55.607468999999995]]]]",
>>>>>> 
>>> "[[[[12.545395,55.684824],[12.564698,55.684824],[12.568558,55.689122],[12.552151038503252,55.70792316285329],[12.545395,55.708459999999995],[12.541535,55.706312],[12.541535,55.702014],[12.537673999999999,55.702014],[12.537673999999999,55.697717],[12.529952999999999,55.697717],[12.529952999999999,55.695567999999994],[12.537673999999999,55.695567999999994],[12.537673999999999,55.691269999999996],[12.541535,55.691269999999996],[12.541535,55.686972999999995],[12.545395,55.684824]]]]",
>>>>>> 
>>> "[[[[12.510651,55.635403],[12.526093,55.635403],[12.529952999999999,55.631105],[12.552151038503252,55.64453508748317],[12.563732502711495,55.65527882907133],[12.564698,55.661187999999996],[12.556976648590021,55.66548538358008],[12.529952999999999,55.665485],[12.525127622017353,55.6531300807537],[12.511615913774403,55.65205570659488],[12.50293,55.641849],[12.506789999999999,55.6397],[12.506789999999999,55.635403],[12.510651,55.635403]]]]",
>>>>>> 
>>> "[[[[12.50293,55.641849],[12.511615913774403,55.65205570659488],[12.525127622017353,55.6531300807537],[12.529952999999999,55.665485],[12.538639330260303,55.682138183041715],[12.545395,55.684824],[12.541535,55.686972999999995],[12.541535,55.691269999999996],[12.537673999999999,55.691269999999996],[12.537673999999999,55.695567999999994],[12.529952999999999,55.695567999999994],[12.503894937635573,55.68858442799461],[12.479766999999999,55.67408],[12.480732009219087,55.65742757738896],[12.490383229392624,55.65205570659488],[12.49231347342733,55.6466838358008],[12.50293,55.641849]]]]",
>>>>>> 
>>> "[[[[12.510651,55.635403],[12.506789999999999,55.635403],[12.506789999999999,55.6397],[12.50293,55.641849],[12.49231347342733,55.6466838358008],[12.490383229392624,55.65205570659488],[12.480732009219087,55.65742757738896],[12.479766999999999,55.67408],[12.469150545010844,55.683212557200534],[12.464324934924077,55.69341911170928],[12.464324934924077,55.70201410497981],[12.453708592733188,55.70684878869448],[12.452743,55.714907],[12.43826664045553,55.71436940780619],[12.425720054229934,55.7084603499327],[12.391940783622559,55.70577441453566],[12.387115,55.699864999999996],[12.393871027657266,55.68965880215343],[12.372638343275487,55.68428693135935],[12.371673221258133,55.661187886944816],[12.36781273318872,55.65474164199192],[12.382289563449023,55.64346071332436],[12.406417999999999,55.613915],[12.432475908351408,55.61337823687752],[12.460464446854663,55.60102293405114],[12.494243717462037,55.60156012113055],[12.50292981561822,55.611766675639295],[12.499069327548806,55.62251041722745],[12.510651,55.635403]]]]"
>>>>>> ), label = "%Key_Brick_Geometry", format.stata = "%9s")), row.names =
>>> c(NA,
>>>>>> -6L), class = c("tbl_df", "tbl", "data.frame?))
>>>>>> 
>>>>>> How can I map this file using R? I?ve tried using the sf package with
>>> st_multipolygon and st_multilinestring without success.
>>>>>> 
>>>>>> Any help as to which package and appropriate commands to successfully
>>> map this data using R will be appreciated.
>>>>>> 
>>>>>> Kind regards
>>>>>> 
>>>>>> 
>>>>>> Graham
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>> 
>>>>> 
>>>>> --
>>>>> Roger Bivand
>>>>> Department of Economics, Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no <mailto:
>>> Roger.Bivand at nhh.no>
>>>>> https://orcid.org/0000-0003-2392-6140 <
>>> https://orcid.org/0000-0003-2392-6140>
>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>
>>>> 
>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
> https://orcid.org/0000-0003-2392-6140 <https://orcid.org/0000-0003-2392-6140>
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en <https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en>

	[[alternative HTML version deleted]]


From |v@|ery @end|ng |rom out|ook@|r  Tue Jul  7 19:15:30 2020
From: |v@|ery @end|ng |rom out|ook@|r (=?iso-8859-1?Q?Lo=EFc_Val=E9ry?=)
Date: Tue, 7 Jul 2020 17:15:30 +0000
Subject: [R-sig-Geo] 
 [R] Need help using GRASS within R - error when running
 the script for a second time
In-Reply-To: <559480fc-bc45-8ea3-26e9-4cb17ee7ffbb@gmail.com>
References: <AM5PR0601MB2692F2F68C0EA1E1169E663BD0850@AM5PR0601MB2692.eurprd06.prod.outlook.com>
 <dabf4146-6c35-030b-e7ff-2b88b6ef117b@gmail.com>
 <AM5PR0601MB2692D06DB5D8CB7780698C02D0820@AM5PR0601MB2692.eurprd06.prod.outlook.com>
 <801784c0-3935-9696-75cf-7cdd0bf3f51c@gmail.com>
 <AM5PR0601MB2692F8F4CFB20B3D5BF8CE8CD0690@AM5PR0601MB2692.eurprd06.prod.outlook.com>,
 <559480fc-bc45-8ea3-26e9-4cb17ee7ffbb@gmail.com>
Message-ID: <AM5PR0601MB2692FCB77CA6C7D9AE686C6ED0660@AM5PR0601MB2692.eurprd06.prod.outlook.com>

Dear all,

As advised by Micha (FYI his reply is at the end of this email) , I contact you to submit an inextricable problem when using rgrass7 : the script (cf. just below) works the first time but, when I rerun it a second time, R and windows return error messages. For this to work, I must close and open R or use the rs.restartR() command from RStudio, which is not very convenient because it stops the script.

Many thanks in advance for your help.
Lo?c
@Micha :  thank you very much for your reply. But I performed the tests you asked me to do and, unfortunately, none of them solve the problem. Also, I tried to run "execGRASS("g.proj", flags = "c", proj4 = p4str)" a second time WITHOUT reinitializing GRASS but R and windows still return the same error messages.

ERRORS WHEN I RUN THE SCRIPT FOR A SECOND TIME :

      - FROM WINDOWS : g.region.exe : the procedure entry point GEOSMakeValid_r could not be located in the dynamic link library C:\Program Files\GRASS GIS 7.8\extrabin\gdal300.dll

      - FROM R :
# Link to GRASS GIS software v.7.8.3
> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8", 
+           home="temp/GRASS_tmp", use_g.dirseps.exe=F,
+           gisDbase="temp/GRASS_tmp", mapset="PERMANENT",
+           remove_GISRC=T, override=T)
Error in if (is.na(projstr)) uprojargs <- projstr else uprojargs <- paste(unique(unlist(strsplit(projstr,  :
  l'argument est de longueur nulle
De plus : There were 50 or more warnings (use warnings() to see the first 50)
> 
> # Specifying the projection reference for the GRASS working environment
> p4str<-sp::proj4string(seg_poly)                                                    
Warning message:
In sp::proj4string(seg_poly) :
  CRS object has comment, which is lost in output
> 
> execGRASS("g.proj", flags = "c", proj4 = p4str)                                    
> rgrass7::use_sp()
> 
> # Converting the 'sp' object into a GRASS-readable file format (here, 'vec1.shp')
> writeVECT(seg_poly,"vec1",v.in.ogr_flags=c("o", "overwrite"), 
+           driver="ESRI Shapefile")
Error in writeVECT(seg_poly, "vec1", v.in.ogr_flags = c("o", "overwrite"),  :
  driver %in% candDrivers is not TRUE
De plus : Warning message:
In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,  :
  l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313
> 
> 
> # Run the 'v.generalize' function                                                  
> execGRASS("v.generalize",flag=c("overwrite"),
+           parameters=list(input="vec1",
+                           output="GRASS_smooth_seg_poly",
+                           error="GRASS_smooth_seg_poly_error",
+                           method="distance_weighting",
+                           threshold=1))
> 
> 
> # Converting the shapefile 'GRASS_smooth_seg_poly.shp' into a R-readable object 
> # (here, a SpatialPolygonDataFrame named 'smooth_seg_poly')
> smooth_seg_poly<-readVECT("GRASS_smooth_seg_poly", with_prj=T, 
+                           driver="ESRI Shapefile")
Error in .read_vect_non_plugin(vname = vname, layer = layer, type = type,  :
  driver %in% candDrivers is not TRUE
De plus : Warning message:
In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,  :
  l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313



REPLY FROM MICHA :
De : Micha Silver <tsvibar at gmail.com>
Envoy? : mardi 7 juillet 2020 15:55
? : Lo?c Val?ry <lvalery at outlook.fr>
Cc?: grass-user <grass-user at lists.osgeo.org>
Objet : Re: [R] Need help using GRASS within R - error when running the script for a second time 
?
Hello Lo?c

Let's keep the discussion on the list, so others can help and benefit from responses.

BTW, you might want to post to the r-sig-geo list also. If you come across questions specific to R and spatial functions, that's the best place to ask.

Below,inline, some guesses as to what is happening...

On 07/07/2020 0:03, Lo?c Val?ry wrote:
initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8", 

+           home="temp/GRASS_tmp", use_g.dirseps.exe=F, 
+           gisDbase="temp/GRASS_tmp", mapset="PERMANENT", 
+           remove_GISRC=T, override=T)
Error in if (is.na(projstr)) uprojargs <- projstr else uprojargs <- paste(unique(unlist(strsplit(projstr,  : 
  l'argument est de longueur nulle
De plus : There were 50 or more warnings (use warnings() to see the first 50)

I'm not sure, but I don't think you want to rerun initGRASS() a second time. In your script, you do initGRASS only once, then if you need to perform several analyses, do them in the same (running) GRASS session.


# Specifying the projection reference for the GRASS working environment
p4str<-sp::proj4string(seg_poly)                                                    

Warning message:
In sp::proj4string(seg_poly) :
  CRS object has comment, which is lost in output

execGRASS("g.proj", flags = "c", proj4 = p4str)                                    
rgrass7::use_sp()

# Converting the 'sp' object into a GRASS-readable file format (here, 'vec1.shp')
writeVECT(seg_poly,"vec1",v.in.ogr_flags=c("o", "overwrite"), 

+           driver="ESRI Shapefile")

The driver name is "ESRI_Shapefile" (note the underscore). Perhaps that is the problem here?

Error in writeVECT(seg_poly, "vec1", v.in.ogr_flags = c("o", "overwrite"),  : 
  driver %in% candDrivers is not TRUE
De plus : Warning message:
In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,  :
  l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313

# Run the 'v.generalize' function                                                  
execGRASS("v.generalize",flag=c("overwrite"),

+           parameters=list(input="vec1",
+                           output="GRASS_smooth_seg_poly",
+                           error="GRASS_smooth_seg_poly_error",
+                           method="distance_weighting",
+                           threshold=1))

# Converting the shapefile 'GRASS_smooth_seg_poly.shp' into a R-readable object 
# (here, a SpatialPolygonDataFrame named 'smooth_seg_poly')
smooth_seg_poly<-readVECT("GRASS_smooth_seg_poly", with_prj=T, 

+                           driver="ESRI Shapefile")

Same here, the driver name for shapefile is wrong.

I would also add that both R and GRASS have switched to the better Geopackage format for exchanging spatial data. You might want to try, the driver name is "GPKG"

See details about Geopackage here:
https://www.gis-blog.com/geopackage-vs-shapefile/
and in French here:
https://www.sigterritoires.fr/index.php/le-format-geopackage-et-qgis-3/

Best, Micha






PREVIOUS EMAILS: 

De : Micha Silver <tsvibar at gmail.com>
Envoy? : mardi 9 juin 2020 23:08
? : Lo?c Val?ry <lvalery at outlook.fr>
Objet : Re: [R] Need help using GRASS within R - problem with CRS using the 'v.generalize' command 
?

On 09/06/2020 16:22, Lo?c Val?ry wrote:
Dear Micha,

A thousand thanks for your help. It works now!
Whoa, you'd better save some thanks for the next question. ;-)

For your information and following your remark, I also updated rgdal.
Thanks again for taking the time to answer me.
Kind regards
Lo?c

De : Micha Silver <tsvibar at gmail.com>
Envoy? : mardi 9 juin 2020 08:44
? : Lo?c Val?ry <lvalery at outlook.fr>; r-help at R-project.org <r-help at R-project.org>
Objet : Re: [R] Need help using GRASS within R - problem with CRS using the 'v.generalize' command 
?
Hello


On 08/06/2020 19:52, Lo?c Val?ry wrote:

Dear all,

First of all, this is my first message on the list. Therefore, please be indulgent if my message is not perfectly formatted as it should be.

I am currently encountering a difficulty with GRASS 7.8 within R when using the 'v.generalize' command to smooth the contour of polygons after a segmentation step.

I tried two different ways to "call" GRASS:

??????????? 1 - using the RQGIS3 package

setwd("D:/test")
library(sp)
library(rgdal)

rgdal: version: 1.4-8, (SVN revision 845)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 2.2.3, released 2017/11/20
Path to GDAL shared files: C:/Users/toto/Documents/R/win-library/3.6/rgdal/gdal
GDAL binary built with GEOS: TRUE
Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
Path to PROJ.4 shared files: C:/Users/toto/Documents/R/win-library/3.6/rgdal/proj
Linking to sp version: 1.4-1

Please note that you have older versions of GDAL (2.2.3 here) and PROJ.4 
(4.9 here). These are currently being replaced by GDAL 3.0 and PROJ 6.3. 
You might (should) want to follow the discussion the the r-sig-geo maillist:


https://stat.ethz.ch/pipermail/r-sig-geo/2020-June/028165.html


....... (skipped all the discussion regarding RQGIS3 as I think it's not 
relevant)

setwd("D:/test")
library(rgrass7)

# characteristics of the SpatialPolygonsDataFrame 'seg_poly' : CRS does exist
seg_poly

class?????? : SpatialPolygonsDataFrame
features??? : 31
extent????? : 477371.3, 477397.6, 5631995, 5632020? (xmin, xmax, ymin, ymax)
crs???????? : +proj=utm +zone=32 +datum=WGS84 +units=m +no_defs
variables?? : 1
names?????? : Seg_ID
min values? :????? 1
max values? :???? 31
Warning message:
In proj4string(x) : CRS object has comment, which is lost in output

# initialization of GRASS 7.8 from R
initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8", home="temp/GRASS",gisDbase="temp/GRASS", use_g.dirseps.exe=F,remove_GISRC=T, override=T)

gisdbase??? temp/GRASS
location??? file19685026c56
mapset????? file196829fa7141
rows??????? 1
columns???? 1
north?????? 1
south?????? 0
west??????? 0
east??????? 1
nsres?????? 1
ewres?????? 1
projection? NA

I suspect that the problem comes from 'projection NA' when initializing GRASS (cf. just above)

What you need to do here is setup the CRS of your new location. 
Typically, you would run initGRASS and point to a *previously created*? 
LOCATION, with CRS already defined. In this case, since you are creating 
a new location, you must define it's coordinate system. (GRASS is very 
"picky" about that).

Here's a GIS Stackexchange post that explains:

https://gis.stackexchange.com/questions/183032/create-a-new-grass-database-in-r-with-crs-projection


You can derive the full proj4 string from your sp object with:


p4str = sp::proj4string(seg_poly)


Then use that to set the project parameters for the new LOCATION, with

execGRASS("g.proj", flags = "c", proj4 = p4str) Now you should be able 
to continue with...



execGRASS("v.generalize",flag=c("overwrite"),parameters=list(input="vec1",

+????????????????????????????????????????????????????????????? output="GRASS_smooth_seg_poly",
+????????????????????????????????????????????????????????????? error="GRASS_smooth_seg_poly_error",
+????????????????????????????????????????????????????????????? method="distance_weighting",
+????????????????????????????????????????????????????????????? threshold=1))



As a novice in the field, I would be very grateful for your help.
I remain at your entire disposal for any further information you may need to help me in finding a solution to this problem.

Yours sincerely,
Lo?c
______________________________________________
R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
https://stat.ethz.ch/mailman/listinfo/r-help
PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
and provide commented, minimal, self-contained, reproducible code.


-- 
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918
https://orcid.org/0000-0002-1128-1325

From Roger@B|v@nd @end|ng |rom nhh@no  Tue Jul  7 20:20:55 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 7 Jul 2020 20:20:55 +0200
Subject: [R-sig-Geo] 
 [R] Need help using GRASS within R - error when running
 the script for a second time
In-Reply-To: <AM5PR0601MB2692FCB77CA6C7D9AE686C6ED0660@AM5PR0601MB2692.eurprd06.prod.outlook.com>
References: <AM5PR0601MB2692F2F68C0EA1E1169E663BD0850@AM5PR0601MB2692.eurprd06.prod.outlook.com>
 <dabf4146-6c35-030b-e7ff-2b88b6ef117b@gmail.com>
 <AM5PR0601MB2692D06DB5D8CB7780698C02D0820@AM5PR0601MB2692.eurprd06.prod.outlook.com>
 <801784c0-3935-9696-75cf-7cdd0bf3f51c@gmail.com>
 <AM5PR0601MB2692F8F4CFB20B3D5BF8CE8CD0690@AM5PR0601MB2692.eurprd06.prod.outlook.com>,
 <559480fc-bc45-8ea3-26e9-4cb17ee7ffbb@gmail.com>
 <AM5PR0601MB2692FCB77CA6C7D9AE686C6ED0660@AM5PR0601MB2692.eurprd06.prod.outlook.com>
Message-ID: <alpine.LFD.2.23.451.2007072006090.159781@reclus.nhh.no>

Please do not cross-post between lists, because few are likely to 
subscribe to both. Choose rather to post only to the list likely to 
include people using R and GRASS:

http://lists.osgeo.org/mailman/listinfo/grass-stats

Further, please post plain text only - I missed your earlier post to 
grass-user because it was scrubbed as HTML (or maybe Micha's reply).

Once resolved, you might report back on grass-user and R-sig-geo on the 
findings.

Briefly, it looks as though you are caught in the transition in sp/rgdal 
and sf from Proj4 to WKT2-2019 CRS, and similar changes in Grass. Grass 
7.8 and R packages may be installed with old PROJ/GDAL or new PROJ/GDAL. 
So far, nobody knows how to use g.proj and siblings sensibly in the R 
context. Most likely, using the wkt= parameter when the object in R has a 
WKT2 representation is going to be much more secure than passing a proj4= 
string, but wkt= takes a file name or standard input.

I would invite discussion in an issue on:

https://github.com/rsbivand/rgrass7/issues

with use cases (platform-independent).

Roger

On Tue, 7 Jul 2020, Lo?c Val?ry wrote:

> Dear all,
>
> As advised by Micha (FYI his reply is at the end of this email) , I 
> contact you to submit an inextricable problem when using rgrass7 : the 
> script (cf. just below) works the first time but, when I rerun it a 
> second time, R and windows return error messages. For this to work, I 
> must close and open R or use the rs.restartR() command from RStudio, 
> which is not very convenient because it stops the script.
>
> Many thanks in advance for your help.
> Lo?c

> @Micha :  thank you very much for your reply. But I performed the tests 
> you asked me to do and, unfortunately, none of them solve the problem. 
> Also, I tried to run "execGRASS("g.proj", flags = "c", proj4 = p4str)" a 
> second time WITHOUT reinitializing GRASS but R and windows still return 
> the same error messages.
>
> ERRORS WHEN I RUN THE SCRIPT FOR A SECOND TIME :
>
>      - FROM WINDOWS : g.region.exe : the procedure entry point GEOSMakeValid_r could not be located in the dynamic link library C:\Program Files\GRASS GIS 7.8\extrabin\gdal300.dll
>
>      - FROM R :
> # Link to GRASS GIS software v.7.8.3
>> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8",
> +           home="temp/GRASS_tmp", use_g.dirseps.exe=F,
> +           gisDbase="temp/GRASS_tmp", mapset="PERMANENT",
> +           remove_GISRC=T, override=T)
> Error in if (is.na(projstr)) uprojargs <- projstr else uprojargs <- paste(unique(unlist(strsplit(projstr,  :
>  l'argument est de longueur nulle
> De plus : There were 50 or more warnings (use warnings() to see the first 50)
>>
>> # Specifying the projection reference for the GRASS working environment
>> p4str<-sp::proj4string(seg_poly)
> Warning message:
> In sp::proj4string(seg_poly) :
>  CRS object has comment, which is lost in output
>>
>> execGRASS("g.proj", flags = "c", proj4 = p4str)
>> rgrass7::use_sp()
>>
>> # Converting the 'sp' object into a GRASS-readable file format (here, 'vec1.shp')
>> writeVECT(seg_poly,"vec1",v.in.ogr_flags=c("o", "overwrite"),
> +           driver="ESRI Shapefile")
> Error in writeVECT(seg_poly, "vec1", v.in.ogr_flags = c("o", "overwrite"),  :
>  driver %in% candDrivers is not TRUE
> De plus : Warning message:
> In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,  :
>  l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313
>>
>>
>> # Run the 'v.generalize' function
>> execGRASS("v.generalize",flag=c("overwrite"),
> +           parameters=list(input="vec1",
> +                           output="GRASS_smooth_seg_poly",
> +                           error="GRASS_smooth_seg_poly_error",
> +                           method="distance_weighting",
> +                           threshold=1))
>>
>>
>> # Converting the shapefile 'GRASS_smooth_seg_poly.shp' into a R-readable object
>> # (here, a SpatialPolygonDataFrame named 'smooth_seg_poly')
>> smooth_seg_poly<-readVECT("GRASS_smooth_seg_poly", with_prj=T,
> +                           driver="ESRI Shapefile")
> Error in .read_vect_non_plugin(vname = vname, layer = layer, type = type,  :
>  driver %in% candDrivers is not TRUE
> De plus : Warning message:
> In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,  :
>  l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313
>
>
>
> REPLY FROM MICHA :
> De : Micha Silver <tsvibar at gmail.com>
> Envoy? : mardi 7 juillet 2020 15:55
> ? : Lo?c Val?ry <lvalery at outlook.fr>
> Cc?: grass-user <grass-user at lists.osgeo.org>
> Objet : Re: [R] Need help using GRASS within R - error when running the script for a second time
> ?
> Hello Lo?c
>
> Let's keep the discussion on the list, so others can help and benefit from responses.
>
> BTW, you might want to post to the r-sig-geo list also. If you come across questions specific to R and spatial functions, that's the best place to ask.
>
> Below,inline, some guesses as to what is happening...
>
> On 07/07/2020 0:03, Lo?c Val?ry wrote:
> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8",
>
> +           home="temp/GRASS_tmp", use_g.dirseps.exe=F,
> +           gisDbase="temp/GRASS_tmp", mapset="PERMANENT",
> +           remove_GISRC=T, override=T)
> Error in if (is.na(projstr)) uprojargs <- projstr else uprojargs <- paste(unique(unlist(strsplit(projstr,  :
>  l'argument est de longueur nulle
> De plus : There were 50 or more warnings (use warnings() to see the first 50)
>
> I'm not sure, but I don't think you want to rerun initGRASS() a second time. In your script, you do initGRASS only once, then if you need to perform several analyses, do them in the same (running) GRASS session.
>
>
> # Specifying the projection reference for the GRASS working environment
> p4str<-sp::proj4string(seg_poly)
>
> Warning message:
> In sp::proj4string(seg_poly) :
>  CRS object has comment, which is lost in output
>
> execGRASS("g.proj", flags = "c", proj4 = p4str)
> rgrass7::use_sp()
>
> # Converting the 'sp' object into a GRASS-readable file format (here, 'vec1.shp')
> writeVECT(seg_poly,"vec1",v.in.ogr_flags=c("o", "overwrite"),
>
> +           driver="ESRI Shapefile")
>
> The driver name is "ESRI_Shapefile" (note the underscore). Perhaps that is the problem here?
>
> Error in writeVECT(seg_poly, "vec1", v.in.ogr_flags = c("o", "overwrite"),  :
>  driver %in% candDrivers is not TRUE
> De plus : Warning message:
> In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,  :
>  l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313
>
> # Run the 'v.generalize' function
> execGRASS("v.generalize",flag=c("overwrite"),
>
> +           parameters=list(input="vec1",
> +                           output="GRASS_smooth_seg_poly",
> +                           error="GRASS_smooth_seg_poly_error",
> +                           method="distance_weighting",
> +                           threshold=1))
>
> # Converting the shapefile 'GRASS_smooth_seg_poly.shp' into a R-readable object
> # (here, a SpatialPolygonDataFrame named 'smooth_seg_poly')
> smooth_seg_poly<-readVECT("GRASS_smooth_seg_poly", with_prj=T,
>
> +                           driver="ESRI Shapefile")
>
> Same here, the driver name for shapefile is wrong.
>
> I would also add that both R and GRASS have switched to the better Geopackage format for exchanging spatial data. You might want to try, the driver name is "GPKG"
>
> See details about Geopackage here:
> https://www.gis-blog.com/geopackage-vs-shapefile/
> and in French here:
> https://www.sigterritoires.fr/index.php/le-format-geopackage-et-qgis-3/
>
> Best, Micha
>
>
>
>
>
>
> PREVIOUS EMAILS:
>
> De : Micha Silver <tsvibar at gmail.com>
> Envoy? : mardi 9 juin 2020 23:08
> ? : Lo?c Val?ry <lvalery at outlook.fr>
> Objet : Re: [R] Need help using GRASS within R - problem with CRS using the 'v.generalize' command
> ?
>
> On 09/06/2020 16:22, Lo?c Val?ry wrote:
> Dear Micha,
>
> A thousand thanks for your help. It works now!
> Whoa, you'd better save some thanks for the next question. ;-)
>
> For your information and following your remark, I also updated rgdal.
> Thanks again for taking the time to answer me.
> Kind regards
> Lo?c
>
> De : Micha Silver <tsvibar at gmail.com>
> Envoy? : mardi 9 juin 2020 08:44
> ? : Lo?c Val?ry <lvalery at outlook.fr>; r-help at R-project.org <r-help at R-project.org>
> Objet : Re: [R] Need help using GRASS within R - problem with CRS using the 'v.generalize' command
> ?
> Hello
>
>
> On 08/06/2020 19:52, Lo?c Val?ry wrote:
>
> Dear all,
>
> First of all, this is my first message on the list. Therefore, please be indulgent if my message is not perfectly formatted as it should be.
>
> I am currently encountering a difficulty with GRASS 7.8 within R when using the 'v.generalize' command to smooth the contour of polygons after a segmentation step.
>
> I tried two different ways to "call" GRASS:
>
> ??????????? 1 - using the RQGIS3 package
>
> setwd("D:/test")
> library(sp)
> library(rgdal)
>
> rgdal: version: 1.4-8, (SVN revision 845)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 2.2.3, released 2017/11/20
> Path to GDAL shared files: C:/Users/toto/Documents/R/win-library/3.6/rgdal/gdal
> GDAL binary built with GEOS: TRUE
> Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
> Path to PROJ.4 shared files: C:/Users/toto/Documents/R/win-library/3.6/rgdal/proj
> Linking to sp version: 1.4-1
>
> Please note that you have older versions of GDAL (2.2.3 here) and PROJ.4
> (4.9 here). These are currently being replaced by GDAL 3.0 and PROJ 6.3.
> You might (should) want to follow the discussion the the r-sig-geo maillist:
>
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2020-June/028165.html
>
>
> ....... (skipped all the discussion regarding RQGIS3 as I think it's not
> relevant)
>
> setwd("D:/test")
> library(rgrass7)
>
> # characteristics of the SpatialPolygonsDataFrame 'seg_poly' : CRS does exist
> seg_poly
>
> class?????? : SpatialPolygonsDataFrame
> features??? : 31
> extent????? : 477371.3, 477397.6, 5631995, 5632020? (xmin, xmax, ymin, ymax)
> crs???????? : +proj=utm +zone=32 +datum=WGS84 +units=m +no_defs
> variables?? : 1
> names?????? : Seg_ID
> min values? :????? 1
> max values? :???? 31
> Warning message:
> In proj4string(x) : CRS object has comment, which is lost in output
>
> # initialization of GRASS 7.8 from R
> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8", home="temp/GRASS",gisDbase="temp/GRASS", use_g.dirseps.exe=F,remove_GISRC=T, override=T)
>
> gisdbase??? temp/GRASS
> location??? file19685026c56
> mapset????? file196829fa7141
> rows??????? 1
> columns???? 1
> north?????? 1
> south?????? 0
> west??????? 0
> east??????? 1
> nsres?????? 1
> ewres?????? 1
> projection? NA
>
> I suspect that the problem comes from 'projection NA' when initializing GRASS (cf. just above)
>
> What you need to do here is setup the CRS of your new location.
> Typically, you would run initGRASS and point to a *previously created*?
> LOCATION, with CRS already defined. In this case, since you are creating
> a new location, you must define it's coordinate system. (GRASS is very
> "picky" about that).
>
> Here's a GIS Stackexchange post that explains:
>
> https://gis.stackexchange.com/questions/183032/create-a-new-grass-database-in-r-with-crs-projection
>
>
> You can derive the full proj4 string from your sp object with:
>
>
> p4str = sp::proj4string(seg_poly)
>
>
> Then use that to set the project parameters for the new LOCATION, with
>
> execGRASS("g.proj", flags = "c", proj4 = p4str) Now you should be able
> to continue with...
>
>
>
> execGRASS("v.generalize",flag=c("overwrite"),parameters=list(input="vec1",
>
> +????????????????????????????????????????????????????????????? output="GRASS_smooth_seg_poly",
> +????????????????????????????????????????????????????????????? error="GRASS_smooth_seg_poly_error",
> +????????????????????????????????????????????????????????????? method="distance_weighting",
> +????????????????????????????????????????????????????????????? threshold=1))
>
>
>
> As a novice in the field, I would be very grateful for your help.
> I remain at your entire disposal for any further information you may need to help me in finding a solution to this problem.
>
> Yours sincerely,
> Lo?c
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From |v@|ery @end|ng |rom out|ook@|r  Tue Jul  7 21:03:59 2020
From: |v@|ery @end|ng |rom out|ook@|r (=?iso-8859-1?Q?Lo=EFc_Val=E9ry?=)
Date: Tue, 7 Jul 2020 19:03:59 +0000
Subject: [R-sig-Geo] 
 [R] Need help using GRASS within R - error when running
 the script for a second time
In-Reply-To: <alpine.LFD.2.23.451.2007072006090.159781@reclus.nhh.no>
References: <AM5PR0601MB2692F2F68C0EA1E1169E663BD0850@AM5PR0601MB2692.eurprd06.prod.outlook.com>
 <dabf4146-6c35-030b-e7ff-2b88b6ef117b@gmail.com>
 <AM5PR0601MB2692D06DB5D8CB7780698C02D0820@AM5PR0601MB2692.eurprd06.prod.outlook.com>
 <801784c0-3935-9696-75cf-7cdd0bf3f51c@gmail.com>
 <AM5PR0601MB2692F8F4CFB20B3D5BF8CE8CD0690@AM5PR0601MB2692.eurprd06.prod.outlook.com>,
 <559480fc-bc45-8ea3-26e9-4cb17ee7ffbb@gmail.com>
 <AM5PR0601MB2692FCB77CA6C7D9AE686C6ED0660@AM5PR0601MB2692.eurprd06.prod.outlook.com>,
 <alpine.LFD.2.23.451.2007072006090.159781@reclus.nhh.no>
Message-ID: <AM5PR0601MB269227E968199D7EC8A7B283D0660@AM5PR0601MB2692.eurprd06.prod.outlook.com>

Dear Roger,

Sorry for cross-posting.
As you invite me, I'm going to post my case on https://github.com/rsbivand/rgrass7/issues.

Just a short comment to yours: if the reason you give is the right one, I don't understand why the script works the first time but not the second time. In your hypothesis, I guess it shouldn't work at all.

Best regards,
Lo?c

De : Roger Bivand <Roger.Bivand at nhh.no>
Envoy? : mardi 7 juillet 2020 20:20
? : Lo?c Val?ry <lvalery at outlook.fr>
Cc?: Micha Silver <tsvibar at gmail.com>; r-sig-geo at r-project.org <r-sig-geo at r-project.org>; grass-user <grass-user at lists.osgeo.org>
Objet : Re: [R-sig-Geo] [R] Need help using GRASS within R - error when running the script for a second time 
?
Please do not cross-post between lists, because few are likely to 
subscribe to both. Choose rather to post only to the list likely to 
include people using R and GRASS:

http://lists.osgeo.org/mailman/listinfo/grass-stats

Further, please post plain text only - I missed your earlier post to 
grass-user because it was scrubbed as HTML (or maybe Micha's reply).

Once resolved, you might report back on grass-user and R-sig-geo on the 
findings.

Briefly, it looks as though you are caught in the transition in sp/rgdal 
and sf from Proj4 to WKT2-2019 CRS, and similar changes in Grass. Grass 
7.8 and R packages may be installed with old PROJ/GDAL or new PROJ/GDAL. 
So far, nobody knows how to use g.proj and siblings sensibly in the R 
context. Most likely, using the wkt= parameter when the object in R has a 
WKT2 representation is going to be much more secure than passing a proj4= 
string, but wkt= takes a file name or standard input.

I would invite discussion in an issue on:

https://github.com/rsbivand/rgrass7/issues

with use cases (platform-independent).

Roger

On Tue, 7 Jul 2020, Lo?c Val?ry wrote:

> Dear all,
>
> As advised by Micha (FYI his reply is at the end of this email) , I 
> contact you to submit an inextricable problem when using rgrass7 : the 
> script (cf. just below) works the first time but, when I rerun it a 
> second time, R and windows return error messages. For this to work, I 
> must close and open R or use the rs.restartR() command from RStudio, 
> which is not very convenient because it stops the script.
>
> Many thanks in advance for your help.
> Lo?c

> @Micha :? thank you very much for your reply. But I performed the tests 
> you asked me to do and, unfortunately, none of them solve the problem. 
> Also, I tried to run "execGRASS("g.proj", flags = "c", proj4 = p4str)" a 
> second time WITHOUT reinitializing GRASS but R and windows still return 
> the same error messages.
>
> ERRORS WHEN I RUN THE SCRIPT FOR A SECOND TIME :
>
>????? - FROM WINDOWS : g.region.exe : the procedure entry point GEOSMakeValid_r could not be located in the dynamic link library C:\Program Files\GRASS GIS 7.8\extrabin\gdal300.dll
>
>????? - FROM R :
> # Link to GRASS GIS software v.7.8.3
>> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8",
> +?????????? home="temp/GRASS_tmp", use_g.dirseps.exe=F,
> +?????????? gisDbase="temp/GRASS_tmp", mapset="PERMANENT",
> +?????????? remove_GISRC=T, override=T)
> Error in if (is.na(projstr)) uprojargs <- projstr else uprojargs <- paste(unique(unlist(strsplit(projstr,? :
>? l'argument est de longueur nulle
> De plus : There were 50 or more warnings (use warnings() to see the first 50)
>>
>> # Specifying the projection reference for the GRASS working environment
>> p4str<-sp::proj4string(seg_poly)
> Warning message:
> In sp::proj4string(seg_poly) :
>? CRS object has comment, which is lost in output
>>
>> execGRASS("g.proj", flags = "c", proj4 = p4str)
>> rgrass7::use_sp()
>>
>> # Converting the 'sp' object into a GRASS-readable file format (here, 'vec1.shp')
>> writeVECT(seg_poly,"vec1",v.in.ogr_flags=c("o", "overwrite"),
> +?????????? driver="ESRI Shapefile")
> Error in writeVECT(seg_poly, "vec1", v.in.ogr_flags = c("o", "overwrite"),? :
>? driver %in% candDrivers is not TRUE
> De plus : Warning message:
> In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,? :
>? l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313
>>
>>
>> # Run the 'v.generalize' function
>> execGRASS("v.generalize",flag=c("overwrite"),
> +?????????? parameters=list(input="vec1",
> +?????????????????????????? output="GRASS_smooth_seg_poly",
> +?????????????????????????? error="GRASS_smooth_seg_poly_error",
> +?????????????????????????? method="distance_weighting",
> +?????????????????????????? threshold=1))
>>
>>
>> # Converting the shapefile 'GRASS_smooth_seg_poly.shp' into a R-readable object
>> # (here, a SpatialPolygonDataFrame named 'smooth_seg_poly')
>> smooth_seg_poly<-readVECT("GRASS_smooth_seg_poly", with_prj=T,
> +?????????????????????????? driver="ESRI Shapefile")
> Error in .read_vect_non_plugin(vname = vname, layer = layer, type = type,? :
>? driver %in% candDrivers is not TRUE
> De plus : Warning message:
> In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,? :
>? l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313
>
>
>
> REPLY FROM MICHA :
> De : Micha Silver <tsvibar at gmail.com>
> Envoy? : mardi 7 juillet 2020 15:55
> ? : Lo?c Val?ry <lvalery at outlook.fr>
> Cc?: grass-user <grass-user at lists.osgeo.org>
> Objet : Re: [R] Need help using GRASS within R - error when running the script for a second time
> ?
> Hello Lo?c
>
> Let's keep the discussion on the list, so others can help and benefit from responses.
>
> BTW, you might want to post to the r-sig-geo list also. If you come across questions specific to R and spatial functions, that's the best place to ask.
>
> Below,inline, some guesses as to what is happening...
>
> On 07/07/2020 0:03, Lo?c Val?ry wrote:
> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8",
>
> +?????????? home="temp/GRASS_tmp", use_g.dirseps.exe=F,
> +?????????? gisDbase="temp/GRASS_tmp", mapset="PERMANENT",
> +?????????? remove_GISRC=T, override=T)
> Error in if (is.na(projstr)) uprojargs <- projstr else uprojargs <- paste(unique(unlist(strsplit(projstr,? :
>? l'argument est de longueur nulle
> De plus : There were 50 or more warnings (use warnings() to see the first 50)
>
> I'm not sure, but I don't think you want to rerun initGRASS() a second time. In your script, you do initGRASS only once, then if you need to perform several analyses, do them in the same (running) GRASS session.
>
>
> # Specifying the projection reference for the GRASS working environment
> p4str<-sp::proj4string(seg_poly)
>
> Warning message:
> In sp::proj4string(seg_poly) :
>? CRS object has comment, which is lost in output
>
> execGRASS("g.proj", flags = "c", proj4 = p4str)
> rgrass7::use_sp()
>
> # Converting the 'sp' object into a GRASS-readable file format (here, 'vec1.shp')
> writeVECT(seg_poly,"vec1",v.in.ogr_flags=c("o", "overwrite"),
>
> +?????????? driver="ESRI Shapefile")
>
> The driver name is "ESRI_Shapefile" (note the underscore). Perhaps that is the problem here?
>
> Error in writeVECT(seg_poly, "vec1", v.in.ogr_flags = c("o", "overwrite"),? :
>? driver %in% candDrivers is not TRUE
> De plus : Warning message:
> In system(syscmd, intern = intern, ignore.stderr = ignore.stderr,? :
>? l'ex?cution de la commande 'v.in.ogr.exe -f' renvoie un statut 313
>
> # Run the 'v.generalize' function
> execGRASS("v.generalize",flag=c("overwrite"),
>
> +?????????? parameters=list(input="vec1",
> +?????????????????????????? output="GRASS_smooth_seg_poly",
> +?????????????????????????? error="GRASS_smooth_seg_poly_error",
> +?????????????????????????? method="distance_weighting",
> +?????????????????????????? threshold=1))
>
> # Converting the shapefile 'GRASS_smooth_seg_poly.shp' into a R-readable object
> # (here, a SpatialPolygonDataFrame named 'smooth_seg_poly')
> smooth_seg_poly<-readVECT("GRASS_smooth_seg_poly", with_prj=T,
>
> +?????????????????????????? driver="ESRI Shapefile")
>
> Same here, the driver name for shapefile is wrong.
>
> I would also add that both R and GRASS have switched to the better Geopackage format for exchanging spatial data. You might want to try, the driver name is "GPKG"
>
> See details about Geopackage here:
> https://www.gis-blog.com/geopackage-vs-shapefile/
> and in French here:
> https://www.sigterritoires.fr/index.php/le-format-geopackage-et-qgis-3/
>
> Best, Micha
>
>
>
>
>
>
> PREVIOUS EMAILS:
>
> De : Micha Silver <tsvibar at gmail.com>
> Envoy? : mardi 9 juin 2020 23:08
> ? : Lo?c Val?ry <lvalery at outlook.fr>
> Objet : Re: [R] Need help using GRASS within R - problem with CRS using the 'v.generalize' command
> ?
>
> On 09/06/2020 16:22, Lo?c Val?ry wrote:
> Dear Micha,
>
> A thousand thanks for your help. It works now!
> Whoa, you'd better save some thanks for the next question. ;-)
>
> For your information and following your remark, I also updated rgdal.
> Thanks again for taking the time to answer me.
> Kind regards
> Lo?c
>
> De : Micha Silver <tsvibar at gmail.com>
> Envoy? : mardi 9 juin 2020 08:44
> ? : Lo?c Val?ry <lvalery at outlook.fr>; r-help at R-project.org <r-help at R-project.org>
> Objet : Re: [R] Need help using GRASS within R - problem with CRS using the 'v.generalize' command
> ?
> Hello
>
>
> On 08/06/2020 19:52, Lo?c Val?ry wrote:
>
> Dear all,
>
> First of all, this is my first message on the list. Therefore, please be indulgent if my message is not perfectly formatted as it should be.
>
> I am currently encountering a difficulty with GRASS 7.8 within R when using the 'v.generalize' command to smooth the contour of polygons after a segmentation step.
>
> I tried two different ways to "call" GRASS:
>
> ??????????? 1 - using the RQGIS3 package
>
> setwd("D:/test")
> library(sp)
> library(rgdal)
>
> rgdal: version: 1.4-8, (SVN revision 845)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 2.2.3, released 2017/11/20
> Path to GDAL shared files: C:/Users/toto/Documents/R/win-library/3.6/rgdal/gdal
> GDAL binary built with GEOS: TRUE
> Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
> Path to PROJ.4 shared files: C:/Users/toto/Documents/R/win-library/3.6/rgdal/proj
> Linking to sp version: 1.4-1
>
> Please note that you have older versions of GDAL (2.2.3 here) and PROJ.4
> (4.9 here). These are currently being replaced by GDAL 3.0 and PROJ 6.3.
> You might (should) want to follow the discussion the the r-sig-geo maillist:
>
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2020-June/028165.html
>
>
> ....... (skipped all the discussion regarding RQGIS3 as I think it's not
> relevant)
>
> setwd("D:/test")
> library(rgrass7)
>
> # characteristics of the SpatialPolygonsDataFrame 'seg_poly' : CRS does exist
> seg_poly
>
> class?????? : SpatialPolygonsDataFrame
> features??? : 31
> extent????? : 477371.3, 477397.6, 5631995, 5632020? (xmin, xmax, ymin, ymax)
> crs???????? : +proj=utm +zone=32 +datum=WGS84 +units=m +no_defs
> variables?? : 1
> names?????? : Seg_ID
> min values? :????? 1
> max values? :???? 31
> Warning message:
> In proj4string(x) : CRS object has comment, which is lost in output
>
> # initialization of GRASS 7.8 from R
> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.8", home="temp/GRASS",gisDbase="temp/GRASS", use_g.dirseps.exe=F,remove_GISRC=T, override=T)
>
> gisdbase??? temp/GRASS
> location??? file19685026c56
> mapset????? file196829fa7141
> rows??????? 1
> columns???? 1
> north?????? 1
> south?????? 0
> west??????? 0
> east??????? 1
> nsres?????? 1
> ewres?????? 1
> projection? NA
>
> I suspect that the problem comes from 'projection NA' when initializing GRASS (cf. just above)
>
> What you need to do here is setup the CRS of your new location.
> Typically, you would run initGRASS and point to a *previously created*?
> LOCATION, with CRS already defined. In this case, since you are creating
> a new location, you must define it's coordinate system. (GRASS is very
> "picky" about that).
>
> Here's a GIS Stackexchange post that explains:
>
> https://gis.stackexchange.com/questions/183032/create-a-new-grass-database-in-r-with-crs-projection
>
>
> You can derive the full proj4 string from your sp object with:
>
>
> p4str = sp::proj4string(seg_poly)
>
>
> Then use that to set the project parameters for the new LOCATION, with
>
> execGRASS("g.proj", flags = "c", proj4 = p4str) Now you should be able
> to continue with...
>
>
>
> execGRASS("v.generalize",flag=c("overwrite"),parameters=list(input="vec1",
>
> +????????????????????????????????????????????????????????????? output="GRASS_smooth_seg_poly",
> +????????????????????????????????????????????????????????????? error="GRASS_smooth_seg_poly_error",
> +????????????????????????????????????????????????????????????? method="distance_weighting",
> +????????????????????????????????????????????????????????????? threshold=1))
>
>
>
> As a novice in the field, I would be very grateful for your help.
> I remain at your entire disposal for any further information you may need to help me in finding a solution to this problem.
>
> Yours sincerely,
> Lo?c
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From eg@mp@du @end|ng |rom gm@||@com  Fri Jul 10 12:46:02 2020
From: eg@mp@du @end|ng |rom gm@||@com (Enoch Gyamfi Ampadu)
Date: Fri, 10 Jul 2020 12:46:02 +0200
Subject: [R-sig-Geo] Image reprojection and resampling
Message-ID: <CAC4+n+y_YjF_75E4uO4xTOXNLmWiQc_qT25VQDoO-ejV4E_P7w@mail.gmail.com>

Dear list,

Please I am working with a Sentinel 2 image of 20 m resolution. I have
tried to reproject and aggregate the resolution to 50 m. But after doing
the reprojection, I get the resolution in decimals and I am not sure what
factor to use for the escalation.

I tried another means to reproject with an existing image of similar
resolution 20 m using this code; Sentinel <- projectRaster(Sentinel, crs =
crs(Trying), res = 20) and
Sentinel <- projectRaster(Sentinel,crs = crs(Trying), keepres= TRUE)
After the process, I get an empty image when I plot.

I will be glad if I could have some insights on how to deal with these
issues of the reprojection and aggregation/resampling.

Best regards,

Enoch

-- 
*Enoch Gyamfi - Ampadu*

*Geography & Environmental Sciences*

*College of Agriculture, Engineering & Science*

*University of KwaZulu-Natal, Westville Campus*

*Private Bag X54001*
*Durban, South Africa **? 4000**.*
*Phone: +27 835 828255*

*email: egampadu at gmail.com <egampadu at gmail.com>*


*skype: enoch.ampadu*
*The highest evidence of nobility is self-control*.

*A simple act of kindness creates an endless ripple*.

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Fri Jul 10 12:56:03 2020
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Fri, 10 Jul 2020 12:56:03 +0200
Subject: [R-sig-Geo] Image reprojection and resampling
In-Reply-To: <CAC4+n+y_YjF_75E4uO4xTOXNLmWiQc_qT25VQDoO-ejV4E_P7w@mail.gmail.com>
References: <CAC4+n+y_YjF_75E4uO4xTOXNLmWiQc_qT25VQDoO-ejV4E_P7w@mail.gmail.com>
Message-ID: <728f0f27-f8ab-e85e-ab1f-170c5a4d517b@gmail.com>

Dear Enoch,

Without a reproducible example it is hard to guess what you data looks 
like and what causes the unexpected results.
Anyway, if you are sure that raster object called "Trying" has perfect 
CRS and resolution, then this may solve your problem:
Sentinel <- projectRaster(from = Sentinel, to = Trying)

Have a nice weekend,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2020.07.10. 12:46 keltez?ssel, Enoch Gyamfi Ampadu ?rta:
> Dear list,
>
> Please I am working with a Sentinel 2 image of 20 m resolution. I have
> tried to reproject and aggregate the resolution to 50 m. But after doing
> the reprojection, I get the resolution in decimals and I am not sure what
> factor to use for the escalation.
>
> I tried another means to reproject with an existing image of similar
> resolution 20 m using this code; Sentinel <- projectRaster(Sentinel, crs =
> crs(Trying), res = 20) and
> Sentinel <- projectRaster(Sentinel,crs = crs(Trying), keepres= TRUE)
> After the process, I get an empty image when I plot.
>
> I will be glad if I could have some insights on how to deal with these
> issues of the reprojection and aggregation/resampling.
>
> Best regards,
>
> Enoch
>


From te@3rd @end|ng |rom gm@||@com  Fri Jul 10 17:33:42 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Fri, 10 Jul 2020 11:33:42 -0400
Subject: [R-sig-Geo] Issue with rgrass7 and readRAST
Message-ID: <CAGxgkWhkTm2P+csdbKTDT2mtn9rSF_D-uMohc7Ybm=6Sycy3Hg@mail.gmail.com>

Hi,

I'm using R in combination with GRASS GIS 7.8.3, attempting to read a GRASS
raster file into R with the rgrass7 interface. I have done this kind of
thing countless times previously without problems. It's quite possible I am
running into memory issues, but my Ubuntu 18.04 Linux computer has 32 GB of
RAM.

My GRASS raster file:

Type of Map:  raster               Number of Categories: 0
Data Type:    CELL
Rows:         22663
Columns:      28794
Total Cells:  652558422
~90m resolution

Using...

srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)

After quite some time, I get...

Error in execGRASS("r.out.bin", flags = rOutBinFlags, input = vname[i],  :
  The command:
r.out.bin -b -i input=mozambique_srtm_patch
output=/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS/mozambique_srtm_patch
bytes=4 null=-81
produced an error (1) during execution:
Creating BIL support files...
Exporting raster as integer values (bytes=4)
ERROR: Error writing data
In addition: Warning messages:
1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
+x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded datum unknown in CRS definition

Libraries loaded include: sp, rgrass7, rgdal, raster...

Any thoughts?

Best,
Tom

-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sat Jul 11 15:26:26 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 11 Jul 2020 15:26:26 +0200
Subject: [R-sig-Geo] Issue with rgrass7 and readRAST
In-Reply-To: <CAGxgkWhkTm2P+csdbKTDT2mtn9rSF_D-uMohc7Ybm=6Sycy3Hg@mail.gmail.com>
References: <CAGxgkWhkTm2P+csdbKTDT2mtn9rSF_D-uMohc7Ybm=6Sycy3Hg@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007111515340.261485@reclus.nhh.no>

Tom

On Fri, 10 Jul 2020, Thomas Adams wrote:

> Hi,
>
> I'm using R in combination with GRASS GIS 7.8.3, attempting to read a GRASS
> raster file into R with the rgrass7 interface. I have done this kind of
> thing countless times previously without problems. It's quite possible I am
> running into memory issues, but my Ubuntu 18.04 Linux computer has 32 GB of
> RAM.
>

I have not succeeded in reproducing this, I'm afraid. I created a location 
with cell counts to match, and ran r.out.bin first to check whether there 
were any issues writing the data to a temporary file. Then I ran the 
equivalent of your command (readRAST()), again without problems. I'm on a 
16 GB PC, so the problem is puzzling. I'm curious about the free space on 
your

/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/
teaiii-Leopard-WS

directory. Did you check whether any output arrived there, since the error 
message is coming from r.out.bin?

The error is on line 53 in raster/r.out.bin/main.c, when the system 
function fwrite() returns an error.

Thanks for your patience.

Roger


> My GRASS raster file:
>
> Type of Map:  raster               Number of Categories: 0
> Data Type:    CELL
> Rows:         22663
> Columns:      28794
> Total Cells:  652558422
> ~90m resolution
>
> Using...
>
> srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
>
> After quite some time, I get...
>
> Error in execGRASS("r.out.bin", flags = rOutBinFlags, input = vname[i],  :
>  The command:
> r.out.bin -b -i input=mozambique_srtm_patch
> output=/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS/mozambique_srtm_patch
> bytes=4 null=-81
> produced an error (1) during execution:
> Creating BIL support files...
> Exporting raster as integer values (bytes=4)
> ERROR: Error writing data
> In addition: Warning messages:
> 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
> +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
> 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>  Discarded datum unknown in CRS definition
>
> Libraries loaded include: sp, rgrass7, rgdal, raster...
>
> Any thoughts?
>
> Best,
> Tom
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From te@3rd @end|ng |rom gm@||@com  Sat Jul 11 17:59:42 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Sat, 11 Jul 2020 11:59:42 -0400
Subject: [R-sig-Geo] Issue with rgrass7 and readRAST
In-Reply-To: <alpine.LFD.2.23.451.2007111515340.261485@reclus.nhh.no>
References: <CAGxgkWhkTm2P+csdbKTDT2mtn9rSF_D-uMohc7Ybm=6Sycy3Hg@mail.gmail.com>
 <alpine.LFD.2.23.451.2007111515340.261485@reclus.nhh.no>
Message-ID: <CAGxgkWiD5TscO1RRaVeJiWLBfMPqwW+bnL8GRchvoitn=g_myA@mail.gmail.com>

Hi Roger!

Here is what was written in
/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS:

drwxr-xr-x 3 teaiii teaiii   4096 Sep 23  2019 ..
-rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:02 801.0.gpkg
-rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:04 466.0.gpkg
-rw-r--r-- 1 teaiii teaiii      0 Jul  9 20:32 801.0
-rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:40 188.0
-rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:51 222.0

And there is plenty of space on the disk drive...

Tom

On Sat, Jul 11, 2020 at 9:26 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> Tom
>
> On Fri, 10 Jul 2020, Thomas Adams wrote:
>
> > Hi,
> >
> > I'm using R in combination with GRASS GIS 7.8.3, attempting to read a
> GRASS
> > raster file into R with the rgrass7 interface. I have done this kind of
> > thing countless times previously without problems. It's quite possible I
> am
> > running into memory issues, but my Ubuntu 18.04 Linux computer has 32 GB
> of
> > RAM.
> >
>
> I have not succeeded in reproducing this, I'm afraid. I created a location
> with cell counts to match, and ran r.out.bin first to check whether there
> were any issues writing the data to a temporary file. Then I ran the
> equivalent of your command (readRAST()), again without problems. I'm on a
> 16 GB PC, so the problem is puzzling. I'm curious about the free space on
> your
>
> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/
> teaiii-Leopard-WS
>
> directory. Did you check whether any output arrived there, since the error
> message is coming from r.out.bin?
>
> The error is on line 53 in raster/r.out.bin/main.c, when the system
> function fwrite() returns an error.
>
> Thanks for your patience.
>
> Roger
>
>
> > My GRASS raster file:
> >
> > Type of Map:  raster               Number of Categories: 0
> > Data Type:    CELL
> > Rows:         22663
> > Columns:      28794
> > Total Cells:  652558422
> > ~90m resolution
> >
> > Using...
> >
> > srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
> >
> > After quite some time, I get...
> >
> > Error in execGRASS("r.out.bin", flags = rOutBinFlags, input = vname[i],
> :
> >  The command:
> > r.out.bin -b -i input=mozambique_srtm_patch
> >
> output=/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS/mozambique_srtm_patch
> > bytes=4 null=-81
> > produced an error (1) during execution:
> > Creating BIL support files...
> > Exporting raster as integer values (bytes=4)
> > ERROR: Error writing data
> > In addition: Warning messages:
> > 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
> >  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
> > +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
> > 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
> >  Discarded datum unknown in CRS definition
> >
> > Libraries loaded include: sp, rgrass7, rgdal, raster...
> >
> > Any thoughts?
> >
> > Best,
> > Tom
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>


-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sat Jul 11 18:12:48 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 11 Jul 2020 16:12:48 +0000
Subject: [R-sig-Geo] Issue with rgrass7 and readRAST
Message-ID: <DB6PR05MB3318489EAFA710664A83C986AC620@DB6PR05MB3318.eurprd05.prod.outlook.com>

Briefly, please try to run r.out.bin manually, to the same output or another. This is what is failing on theGRASS side.

Roger

-------
Roger Bivand
Norwegian School of Economics, Bergen, Norway
roger.bivand at nhh.no

________________________________
Fra: Thomas Adams <tea3rd at gmail.com>
Sendt: l?rdag 11. juli 2020, 17:59
Til: Roger Bivand
Kopi: r-sig-Geo at r-project.org
Emne: Re: [R-sig-Geo] Issue with rgrass7 and readRAST

Hi Roger!

Here is what was written in /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS:

drwxr-xr-x 3 teaiii teaiii   4096 Sep 23  2019 ..
-rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:02 801.0.gpkg
-rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:04 466.0.gpkg
-rw-r--r-- 1 teaiii teaiii      0 Jul  9 20:32 801.0
-rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:40 188.0
-rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:51 222.0

And there is plenty of space on the disk drive...

Tom

On Sat, Jul 11, 2020 at 9:26 AM Roger Bivand <Roger.Bivand at nhh.no<mailto:Roger.Bivand at nhh.no>> wrote:
Tom

On Fri, 10 Jul 2020, Thomas Adams wrote:

> Hi,
>
> I'm using R in combination with GRASS GIS 7.8.3, attempting to read a GRASS
> raster file into R with the rgrass7 interface. I have done this kind of
> thing countless times previously without problems. It's quite possible I am
> running into memory issues, but my Ubuntu 18.04 Linux computer has 32 GB of
> RAM.
>

I have not succeeded in reproducing this, I'm afraid. I created a location
with cell counts to match, and ran r.out.bin first to check whether there
were any issues writing the data to a temporary file. Then I ran the
equivalent of your command (readRAST()), again without problems. I'm on a
16 GB PC, so the problem is puzzling. I'm curious about the free space on
your

/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/
teaiii-Leopard-WS

directory. Did you check whether any output arrived there, since the error
message is coming from r.out.bin?

The error is on line 53 in raster/r.out.bin/main.c, when the system
function fwrite() returns an error.

Thanks for your patience.

Roger


> My GRASS raster file:
>
> Type of Map:  raster               Number of Categories: 0
> Data Type:    CELL
> Rows:         22663
> Columns:      28794
> Total Cells:  652558422
> ~90m resolution
>
> Using...
>
> srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
>
> After quite some time, I get...
>
> Error in execGRASS("r.out.bin", flags = rOutBinFlags, input = vname[i],  :
>  The command:
> r.out.bin -b -i input=mozambique_srtm_patch
> output=/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS/mozambique_srtm_patch
> bytes=4 null=-81
> produced an error (1) during execution:
> Creating BIL support files...
> Exporting raster as integer values (bytes=4)
> ERROR: Error writing data
> In addition: Warning messages:
> 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
> +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
> 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>  Discarded datum unknown in CRS definition
>
> Libraries loaded include: sp, rgrass7, rgdal, raster...
>
> Any thoughts?
>
> Best,
> Tom
>
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no<mailto:Roger.Bivand at nhh.no>
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


--
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com<mailto:tea3rd at gmail.com> (personal)
tea at terrapredictions.org<mailto:tea at terrapredictions.org> (work)

1 (513) 739-9512 (cell)



	[[alternative HTML version deleted]]


From te@3rd @end|ng |rom gm@||@com  Sun Jul 12 05:02:43 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Sat, 11 Jul 2020 23:02:43 -0400
Subject: [R-sig-Geo] Issue with rgrass7 and readRAST
In-Reply-To: <DB6PR05MB3318489EAFA710664A83C986AC620@DB6PR05MB3318.eurprd05.prod.outlook.com>
References: <DB6PR05MB3318489EAFA710664A83C986AC620@DB6PR05MB3318.eurprd05.prod.outlook.com>
Message-ID: <CAGxgkWinrz98KyBzYkDeQN35iMtstfeqOKu783q1jkXJkckjqA@mail.gmail.com>

Hi Roger,

r.out.bin from GRASS did succeed... r.out.bin
input=mozambique_srtm_patch at teaiii output=mozambique_srtm_patch null=-999
Exporting raster as integer values (bytes=2)

A very large file!!
-rw-r--r--   1 teaiii teaiii 1045368225220 Jul 11 13:26
mozambique_srtm_patch

Tom


On Sat, Jul 11, 2020 at 12:12 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> Briefly, please try to run r.out.bin manually, to the same output or
> another. This is what is failing on theGRASS side.
>
> Roger
>
> -------
> Roger Bivand
> Norwegian School of Economics, Bergen, Norway
> roger.bivand at nhh.no
>
> ------------------------------
> *Fra:* Thomas Adams <tea3rd at gmail.com>
> *Sendt:* l?rdag 11. juli 2020, 17:59
> *Til:* Roger Bivand
> *Kopi:* r-sig-Geo at r-project.org
> *Emne:* Re: [R-sig-Geo] Issue with rgrass7 and readRAST
>
> Hi Roger!
>
> Here is what was written in
> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS:
>
> drwxr-xr-x 3 teaiii teaiii   4096 Sep 23  2019 ..
> -rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:02 801.0.gpkg
> -rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:04 466.0.gpkg
> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 20:32 801.0
> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:40 188.0
> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:51 222.0
>
> And there is plenty of space on the disk drive...
>
> Tom
>
> On Sat, Jul 11, 2020 at 9:26 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> Tom
>>
>> On Fri, 10 Jul 2020, Thomas Adams wrote:
>>
>> > Hi,
>> >
>> > I'm using R in combination with GRASS GIS 7.8.3, attempting to read a
>> GRASS
>> > raster file into R with the rgrass7 interface. I have done this kind of
>> > thing countless times previously without problems. It's quite possible
>> I am
>> > running into memory issues, but my Ubuntu 18.04 Linux computer has 32
>> GB of
>> > RAM.
>> >
>>
>> I have not succeeded in reproducing this, I'm afraid. I created a
>> location
>> with cell counts to match, and ran r.out.bin first to check whether there
>> were any issues writing the data to a temporary file. Then I ran the
>> equivalent of your command (readRAST()), again without problems. I'm on a
>> 16 GB PC, so the problem is puzzling. I'm curious about the free space on
>> your
>>
>> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/
>> teaiii-Leopard-WS
>>
>> directory. Did you check whether any output arrived there, since the
>> error
>> message is coming from r.out.bin?
>>
>> The error is on line 53 in raster/r.out.bin/main.c, when the system
>> function fwrite() returns an error.
>>
>> Thanks for your patience.
>>
>> Roger
>>
>>
>> > My GRASS raster file:
>> >
>> > Type of Map:  raster               Number of Categories: 0
>> > Data Type:    CELL
>> > Rows:         22663
>> > Columns:      28794
>> > Total Cells:  652558422
>> > ~90m resolution
>> >
>> > Using...
>> >
>> > srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
>> >
>> > After quite some time, I get...
>> >
>> > Error in execGRASS("r.out.bin", flags = rOutBinFlags, input =
>> vname[i],  :
>> >  The command:
>> > r.out.bin -b -i input=mozambique_srtm_patch
>> >
>> output=/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS/mozambique_srtm_patch
>> > bytes=4 null=-81
>> > produced an error (1) during execution:
>> > Creating BIL support files...
>> > Exporting raster as integer values (bytes=4)
>> > ERROR: Error writing data
>> > In addition: Warning messages:
>> > 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>> >  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0
>> +lon_0=0
>> > +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
>> > 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>> >  Discarded datum unknown in CRS definition
>> >
>> > Libraries loaded include: sp, rgrass7, rgdal, raster...
>> >
>> > Any thoughts?
>> >
>> > Best,
>> > Tom
>> >
>> >
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>
>
> --
> Thomas E Adams, III
> 1724 Sage Lane
> Blacksburg, VA 24060
> tea3rd at gmail.com (personal)
> tea at terrapredictions.org (work)
>
> 1 (513) 739-9512 (cell)
>
>
>

-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From te@3rd @end|ng |rom gm@||@com  Sun Jul 12 13:27:31 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Sun, 12 Jul 2020 07:27:31 -0400
Subject: [R-sig-Geo] Issue with rgrass7 and readRAST
In-Reply-To: <CAGxgkWinrz98KyBzYkDeQN35iMtstfeqOKu783q1jkXJkckjqA@mail.gmail.com>
References: <DB6PR05MB3318489EAFA710664A83C986AC620@DB6PR05MB3318.eurprd05.prod.outlook.com>
 <CAGxgkWinrz98KyBzYkDeQN35iMtstfeqOKu783q1jkXJkckjqA@mail.gmail.com>
Message-ID: <CAGxgkWiDyge8A8Bbd7zBx14+dOP_=13gEYG-ZsFYEzmBU6T49A@mail.gmail.com>

Hi Roger,

I believe I may have been correct about the memory issue... it's possible,
in GRASS, that I did not restrict my REGION sufficiently, using g.region.
Additionally, I applied a MASK for my country of interest, Mozambique,
before starting R, which yielded:

srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
Creating BIL support files...
Exporting raster as integer values (bytes=4)
 100%
Warning messages:
1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
+x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded datum unknown in CRS definition
> image(srtm)
Error in rasterImage(m, bb[1, 1], bb[2, 1], bb[1, 2], bb[2, 2], interpolate
= interpolate,  :
  cannot allocate memory block of size 16777216 Tb

Still, a huge amount of memory needed (is 16777216 Tb correct??)

My thought was to resample the SRTM data in GRASS to 1km resolution, then
start R, and proceed, which quite honestly, for my purposes, really is
sufficient. By doing this, everything worked perfectly! I was able to read
the srtm data quickly and generate an image. I am puzzled by the "cannot
allocate memory block of size 16777216 Tb" message with my GRASS Region
settings in place.

Thank you for all your help!

Best,
Tom



On Sat, Jul 11, 2020 at 11:02 PM Thomas Adams <tea3rd at gmail.com> wrote:

> Hi Roger,
>
> r.out.bin from GRASS did succeed... r.out.bin
> input=mozambique_srtm_patch at teaiii output=mozambique_srtm_patch null=-999
> Exporting raster as integer values (bytes=2)
>
> A very large file!!
> -rw-r--r--   1 teaiii teaiii 1045368225220 Jul 11 13:26
> mozambique_srtm_patch
>
> Tom
>
>
> On Sat, Jul 11, 2020 at 12:12 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> Briefly, please try to run r.out.bin manually, to the same output or
>> another. This is what is failing on theGRASS side.
>>
>> Roger
>>
>> -------
>> Roger Bivand
>> Norwegian School of Economics, Bergen, Norway
>> roger.bivand at nhh.no
>>
>> ------------------------------
>> *Fra:* Thomas Adams <tea3rd at gmail.com>
>> *Sendt:* l?rdag 11. juli 2020, 17:59
>> *Til:* Roger Bivand
>> *Kopi:* r-sig-Geo at r-project.org
>> *Emne:* Re: [R-sig-Geo] Issue with rgrass7 and readRAST
>>
>> Hi Roger!
>>
>> Here is what was written in
>> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS:
>>
>> drwxr-xr-x 3 teaiii teaiii   4096 Sep 23  2019 ..
>> -rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:02 801.0.gpkg
>> -rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:04 466.0.gpkg
>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 20:32 801.0
>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:40 188.0
>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:51 222.0
>>
>> And there is plenty of space on the disk drive...
>>
>> Tom
>>
>> On Sat, Jul 11, 2020 at 9:26 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>>> Tom
>>>
>>> On Fri, 10 Jul 2020, Thomas Adams wrote:
>>>
>>> > Hi,
>>> >
>>> > I'm using R in combination with GRASS GIS 7.8.3, attempting to read a
>>> GRASS
>>> > raster file into R with the rgrass7 interface. I have done this kind of
>>> > thing countless times previously without problems. It's quite possible
>>> I am
>>> > running into memory issues, but my Ubuntu 18.04 Linux computer has 32
>>> GB of
>>> > RAM.
>>> >
>>>
>>> I have not succeeded in reproducing this, I'm afraid. I created a
>>> location
>>> with cell counts to match, and ran r.out.bin first to check whether
>>> there
>>> were any issues writing the data to a temporary file. Then I ran the
>>> equivalent of your command (readRAST()), again without problems. I'm on
>>> a
>>> 16 GB PC, so the problem is puzzling. I'm curious about the free space
>>> on
>>> your
>>>
>>> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/
>>> teaiii-Leopard-WS
>>>
>>> directory. Did you check whether any output arrived there, since the
>>> error
>>> message is coming from r.out.bin?
>>>
>>> The error is on line 53 in raster/r.out.bin/main.c, when the system
>>> function fwrite() returns an error.
>>>
>>> Thanks for your patience.
>>>
>>> Roger
>>>
>>>
>>> > My GRASS raster file:
>>> >
>>> > Type of Map:  raster               Number of Categories: 0
>>> > Data Type:    CELL
>>> > Rows:         22663
>>> > Columns:      28794
>>> > Total Cells:  652558422
>>> > ~90m resolution
>>> >
>>> > Using...
>>> >
>>> > srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
>>> >
>>> > After quite some time, I get...
>>> >
>>> > Error in execGRASS("r.out.bin", flags = rOutBinFlags, input =
>>> vname[i],  :
>>> >  The command:
>>> > r.out.bin -b -i input=mozambique_srtm_patch
>>> >
>>> output=/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS/mozambique_srtm_patch
>>> > bytes=4 null=-81
>>> > produced an error (1) during execution:
>>> > Creating BIL support files...
>>> > Exporting raster as integer values (bytes=4)
>>> > ERROR: Error writing data
>>> > In addition: Warning messages:
>>> > 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>>> >  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0
>>> +lon_0=0
>>> > +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
>>> > 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>>> >  Discarded datum unknown in CRS definition
>>> >
>>> > Libraries loaded include: sp, rgrass7, rgdal, raster...
>>> >
>>> > Any thoughts?
>>> >
>>> > Best,
>>> > Tom
>>> >
>>> >
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>
>>
>>
>> --
>> Thomas E Adams, III
>> 1724 Sage Lane
>> Blacksburg, VA 24060
>> tea3rd at gmail.com (personal)
>> tea at terrapredictions.org (work)
>>
>> 1 (513) 739-9512 (cell)
>>
>>
>>
>
> --
> Thomas E Adams, III
> 1724 Sage Lane
> Blacksburg, VA 24060
> tea3rd at gmail.com (personal)
> tea at terrapredictions.org (work)
>
> 1 (513) 739-9512 (cell)
>
>

-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sun Jul 12 15:19:38 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 12 Jul 2020 15:19:38 +0200
Subject: [R-sig-Geo] Issue with rgrass7 and readRAST
In-Reply-To: <CAGxgkWiDyge8A8Bbd7zBx14+dOP_=13gEYG-ZsFYEzmBU6T49A@mail.gmail.com>
References: <DB6PR05MB3318489EAFA710664A83C986AC620@DB6PR05MB3318.eurprd05.prod.outlook.com>
 <CAGxgkWinrz98KyBzYkDeQN35iMtstfeqOKu783q1jkXJkckjqA@mail.gmail.com>
 <CAGxgkWiDyge8A8Bbd7zBx14+dOP_=13gEYG-ZsFYEzmBU6T49A@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007121454330.282322@reclus.nhh.no>

On Sun, 12 Jul 2020, Thomas Adams wrote:

> Hi Roger,
>
> I believe I may have been correct about the memory issue... it's possible,
> in GRASS, that I did not restrict my REGION sufficiently, using g.region.
> Additionally, I applied a MASK for my country of interest, Mozambique,
> before starting R, which yielded:
>
> srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
> Creating BIL support files...
> Exporting raster as integer values (bytes=4)
> 100%
> Warning messages:
> 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
> +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
> 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>  Discarded datum unknown in CRS definition
>> image(srtm)
> Error in rasterImage(m, bb[1, 1], bb[2, 1], bb[1, 2], bb[2, 2], interpolate
> = interpolate,  :
>  cannot allocate memory block of size 16777216 Tb

I'd got to an errant g.region before r.out.bin too.

graphics::rasterImage() is reporting the error. The metric is wrong, but 
the problem is real. The object is about 650M x 4 bytes, which image() 
needs to manipulate too, creating several copies (in the imported object 
it is a vector, but is cast to a matrix and transposed).

>
> Still, a huge amount of memory needed (is 16777216 Tb correct??)
>
> My thought was to resample the SRTM data in GRASS to 1km resolution, then
> start R, and proceed, which quite honestly, for my purposes, really is
> sufficient. By doing this, everything worked perfectly! I was able to read
> the srtm data quickly and generate an image. I am puzzled by the "cannot
> allocate memory block of size 16777216 Tb" message with my GRASS Region
> settings in place.

Please try r.out.gdal in 90m, then stars::read_stars(..., proxy=TRUE) 
(outside rgrass7). We need to try to get stars to work in rgrass7, but we 
had not gone into that yet. In stars and gdalcubes, the idea is to do work 
on the back end, and only bring data to (say) display in the feasible 
resolution. So I think something like:

library(stars)
big <- read_stars("big.tif", proxy=TRUE)
plot(big)

automates the downsampling. The default arguments to readRAST() assume 
that uncompressed binary is the optimal transfer strategy, and that all 
the data should be in R's workspace.

I can speculate that if GDAL used the GRASS plugin, it might be possibble 
to proxy the actual GRASS CELL or DCELL. However, someone else would need 
to take responsibility for implementing prototypes for that. The same 
applies to support for stars, alternatively for terra in addition (raster 
is used by many, but with limited resources, stars and terra should be 
preferred).

Roger

>
> Thank you for all your help!
>
> Best,
> Tom
>
>
>
> On Sat, Jul 11, 2020 at 11:02 PM Thomas Adams <tea3rd at gmail.com> wrote:
>
>> Hi Roger,
>>
>> r.out.bin from GRASS did succeed... r.out.bin
>> input=mozambique_srtm_patch at teaiii output=mozambique_srtm_patch null=-999
>> Exporting raster as integer values (bytes=2)
>>
>> A very large file!!
>> -rw-r--r--   1 teaiii teaiii 1045368225220 Jul 11 13:26
>> mozambique_srtm_patch
>>
>> Tom
>>
>>
>> On Sat, Jul 11, 2020 at 12:12 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>>> Briefly, please try to run r.out.bin manually, to the same output or
>>> another. This is what is failing on theGRASS side.
>>>
>>> Roger
>>>
>>> -------
>>> Roger Bivand
>>> Norwegian School of Economics, Bergen, Norway
>>> roger.bivand at nhh.no
>>>
>>> ------------------------------
>>> *Fra:* Thomas Adams <tea3rd at gmail.com>
>>> *Sendt:* l?rdag 11. juli 2020, 17:59
>>> *Til:* Roger Bivand
>>> *Kopi:* r-sig-Geo at r-project.org
>>> *Emne:* Re: [R-sig-Geo] Issue with rgrass7 and readRAST
>>>
>>> Hi Roger!
>>>
>>> Here is what was written in
>>> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS:
>>>
>>> drwxr-xr-x 3 teaiii teaiii   4096 Sep 23  2019 ..
>>> -rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:02 801.0.gpkg
>>> -rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:04 466.0.gpkg
>>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 20:32 801.0
>>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:40 188.0
>>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:51 222.0
>>>
>>> And there is plenty of space on the disk drive...
>>>
>>> Tom
>>>
>>> On Sat, Jul 11, 2020 at 9:26 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>
>>>> Tom
>>>>
>>>> On Fri, 10 Jul 2020, Thomas Adams wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> I'm using R in combination with GRASS GIS 7.8.3, attempting to read a
>>>> GRASS
>>>>> raster file into R with the rgrass7 interface. I have done this kind of
>>>>> thing countless times previously without problems. It's quite possible
>>>> I am
>>>>> running into memory issues, but my Ubuntu 18.04 Linux computer has 32
>>>> GB of
>>>>> RAM.
>>>>>
>>>>
>>>> I have not succeeded in reproducing this, I'm afraid. I created a
>>>> location
>>>> with cell counts to match, and ran r.out.bin first to check whether
>>>> there
>>>> were any issues writing the data to a temporary file. Then I ran the
>>>> equivalent of your command (readRAST()), again without problems. I'm on
>>>> a
>>>> 16 GB PC, so the problem is puzzling. I'm curious about the free space
>>>> on
>>>> your
>>>>
>>>> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/
>>>> teaiii-Leopard-WS
>>>>
>>>> directory. Did you check whether any output arrived there, since the
>>>> error
>>>> message is coming from r.out.bin?
>>>>
>>>> The error is on line 53 in raster/r.out.bin/main.c, when the system
>>>> function fwrite() returns an error.
>>>>
>>>> Thanks for your patience.
>>>>
>>>> Roger
>>>>
>>>>
>>>>> My GRASS raster file:
>>>>>
>>>>> Type of Map:  raster               Number of Categories: 0
>>>>> Data Type:    CELL
>>>>> Rows:         22663
>>>>> Columns:      28794
>>>>> Total Cells:  652558422
>>>>> ~90m resolution
>>>>>
>>>>> Using...
>>>>>
>>>>> srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
>>>>>
>>>>> After quite some time, I get...
>>>>>
>>>>> Error in execGRASS("r.out.bin", flags = rOutBinFlags, input =
>>>> vname[i],  :
>>>>>  The command:
>>>>> r.out.bin -b -i input=mozambique_srtm_patch
>>>>>
>>>> output=/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS/mozambique_srtm_patch
>>>>> bytes=4 null=-81
>>>>> produced an error (1) during execution:
>>>>> Creating BIL support files...
>>>>> Exporting raster as integer values (bytes=4)
>>>>> ERROR: Error writing data
>>>>> In addition: Warning messages:
>>>>> 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>>>>>  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0
>>>> +lon_0=0
>>>>> +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
>>>>> 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
>>>>>  Discarded datum unknown in CRS definition
>>>>>
>>>>> Libraries loaded include: sp, rgrass7, rgdal, raster...
>>>>>
>>>>> Any thoughts?
>>>>>
>>>>> Best,
>>>>> Tom
>>>>>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Department of Economics, Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>> https://orcid.org/0000-0003-2392-6140
>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>
>>>
>>>
>>> --
>>> Thomas E Adams, III
>>> 1724 Sage Lane
>>> Blacksburg, VA 24060
>>> tea3rd at gmail.com (personal)
>>> tea at terrapredictions.org (work)
>>>
>>> 1 (513) 739-9512 (cell)
>>>
>>>
>>>
>>
>> --
>> Thomas E Adams, III
>> 1724 Sage Lane
>> Blacksburg, VA 24060
>> tea3rd at gmail.com (personal)
>> tea at terrapredictions.org (work)
>>
>> 1 (513) 739-9512 (cell)
>>
>>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From te@3rd @end|ng |rom gm@||@com  Mon Jul 13 01:47:00 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Sun, 12 Jul 2020 19:47:00 -0400
Subject: [R-sig-Geo] Issue with rgrass7 and readRAST
In-Reply-To: <alpine.LFD.2.23.451.2007121454330.282322@reclus.nhh.no>
References: <DB6PR05MB3318489EAFA710664A83C986AC620@DB6PR05MB3318.eurprd05.prod.outlook.com>
 <CAGxgkWinrz98KyBzYkDeQN35iMtstfeqOKu783q1jkXJkckjqA@mail.gmail.com>
 <CAGxgkWiDyge8A8Bbd7zBx14+dOP_=13gEYG-ZsFYEzmBU6T49A@mail.gmail.com>
 <alpine.LFD.2.23.451.2007121454330.282322@reclus.nhh.no>
Message-ID: <CAGxgkWjqcfPBogwoX4YSde8PRb=sJtWamC3=L6r83tfQKj+Vvg@mail.gmail.com>

Hi Roger,

I did run with a 90m resolution, with the same error:
> srtm <- readRAST("mozambique_srtm_90m",cat=FALSE)
Creating BIL support files...
Exporting raster as integer values (bytes=4)
 100%
Warning messages:
1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
+x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded datum unknown in CRS definition
> image(srtm)
Error in rasterImage(m, bb[1, 1], bb[2, 1], bb[1, 2], bb[2, 2], interpolate
= interpolate,  :
  cannot allocate memory block of size 16777216 Tb

However, with a 250m resolution the import and visualization worked fine:

> srtm <- readRAST("mozambique_srtm_250m",cat=FALSE)
Creating BIL support files...
Exporting raster as integer values (bytes=4)
 100%
Warning messages:
1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
+x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded datum unknown in CRS definition
> image(srtm,col = terrain.colors(20))

Thank you for your help!

Best regards,
Tom


On Sun, Jul 12, 2020 at 9:19 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Sun, 12 Jul 2020, Thomas Adams wrote:
>
> > Hi Roger,
> >
> > I believe I may have been correct about the memory issue... it's
> possible,
> > in GRASS, that I did not restrict my REGION sufficiently, using g.region.
> > Additionally, I applied a MASK for my country of interest, Mozambique,
> > before starting R, which yielded:
> >
> > srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
> > Creating BIL support files...
> > Exporting raster as integer values (bytes=4)
> > 100%
> > Warning messages:
> > 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
> >  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0 +lon_0=0
> > +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
> > 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
> >  Discarded datum unknown in CRS definition
> >> image(srtm)
> > Error in rasterImage(m, bb[1, 1], bb[2, 1], bb[1, 2], bb[2, 2],
> interpolate
> > = interpolate,  :
> >  cannot allocate memory block of size 16777216 Tb
>
> I'd got to an errant g.region before r.out.bin too.
>
> graphics::rasterImage() is reporting the error. The metric is wrong, but
> the problem is real. The object is about 650M x 4 bytes, which image()
> needs to manipulate too, creating several copies (in the imported object
> it is a vector, but is cast to a matrix and transposed).
>
> >
> > Still, a huge amount of memory needed (is 16777216 Tb correct??)
> >
> > My thought was to resample the SRTM data in GRASS to 1km resolution, then
> > start R, and proceed, which quite honestly, for my purposes, really is
> > sufficient. By doing this, everything worked perfectly! I was able to
> read
> > the srtm data quickly and generate an image. I am puzzled by the "cannot
> > allocate memory block of size 16777216 Tb" message with my GRASS Region
> > settings in place.
>
> Please try r.out.gdal in 90m, then stars::read_stars(..., proxy=TRUE)
> (outside rgrass7). We need to try to get stars to work in rgrass7, but we
> had not gone into that yet. In stars and gdalcubes, the idea is to do work
> on the back end, and only bring data to (say) display in the feasible
> resolution. So I think something like:
>
> library(stars)
> big <- read_stars("big.tif", proxy=TRUE)
> plot(big)
>
> automates the downsampling. The default arguments to readRAST() assume
> that uncompressed binary is the optimal transfer strategy, and that all
> the data should be in R's workspace.
>
> I can speculate that if GDAL used the GRASS plugin, it might be possibble
> to proxy the actual GRASS CELL or DCELL. However, someone else would need
> to take responsibility for implementing prototypes for that. The same
> applies to support for stars, alternatively for terra in addition (raster
> is used by many, but with limited resources, stars and terra should be
> preferred).
>
> Roger
>
> >
> > Thank you for all your help!
> >
> > Best,
> > Tom
> >
> >
> >
> > On Sat, Jul 11, 2020 at 11:02 PM Thomas Adams <tea3rd at gmail.com> wrote:
> >
> >> Hi Roger,
> >>
> >> r.out.bin from GRASS did succeed... r.out.bin
> >> input=mozambique_srtm_patch at teaiii output=mozambique_srtm_patch
> null=-999
> >> Exporting raster as integer values (bytes=2)
> >>
> >> A very large file!!
> >> -rw-r--r--   1 teaiii teaiii 1045368225220 Jul 11 13:26
> >> mozambique_srtm_patch
> >>
> >> Tom
> >>
> >>
> >> On Sat, Jul 11, 2020 at 12:12 PM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >>
> >>> Briefly, please try to run r.out.bin manually, to the same output or
> >>> another. This is what is failing on theGRASS side.
> >>>
> >>> Roger
> >>>
> >>> -------
> >>> Roger Bivand
> >>> Norwegian School of Economics, Bergen, Norway
> >>> roger.bivand at nhh.no
> >>>
> >>> ------------------------------
> >>> *Fra:* Thomas Adams <tea3rd at gmail.com>
> >>> *Sendt:* l?rdag 11. juli 2020, 17:59
> >>> *Til:* Roger Bivand
> >>> *Kopi:* r-sig-Geo at r-project.org
> >>> *Emne:* Re: [R-sig-Geo] Issue with rgrass7 and readRAST
> >>>
> >>> Hi Roger!
> >>>
> >>> Here is what was written in
> >>>
> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS:
> >>>
> >>> drwxr-xr-x 3 teaiii teaiii   4096 Sep 23  2019 ..
> >>> -rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:02 801.0.gpkg
> >>> -rw-r--r-- 1 teaiii teaiii 131072 Jul  9 10:04 466.0.gpkg
> >>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 20:32 801.0
> >>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:40 188.0
> >>> -rw-r--r-- 1 teaiii teaiii      0 Jul  9 22:51 222.0
> >>>
> >>> And there is plenty of space on the disk drive...
> >>>
> >>> Tom
> >>>
> >>> On Sat, Jul 11, 2020 at 9:26 AM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >>>
> >>>> Tom
> >>>>
> >>>> On Fri, 10 Jul 2020, Thomas Adams wrote:
> >>>>
> >>>>> Hi,
> >>>>>
> >>>>> I'm using R in combination with GRASS GIS 7.8.3, attempting to read a
> >>>> GRASS
> >>>>> raster file into R with the rgrass7 interface. I have done this kind
> of
> >>>>> thing countless times previously without problems. It's quite
> possible
> >>>> I am
> >>>>> running into memory issues, but my Ubuntu 18.04 Linux computer has 32
> >>>> GB of
> >>>>> RAM.
> >>>>>
> >>>>
> >>>> I have not succeeded in reproducing this, I'm afraid. I created a
> >>>> location
> >>>> with cell counts to match, and ran r.out.bin first to check whether
> >>>> there
> >>>> were any issues writing the data to a temporary file. Then I ran the
> >>>> equivalent of your command (readRAST()), again without problems. I'm
> on
> >>>> a
> >>>> 16 GB PC, so the problem is puzzling. I'm curious about the free space
> >>>> on
> >>>> your
> >>>>
> >>>> /media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/
> >>>> teaiii-Leopard-WS
> >>>>
> >>>> directory. Did you check whether any output arrived there, since the
> >>>> error
> >>>> message is coming from r.out.bin?
> >>>>
> >>>> The error is on line 53 in raster/r.out.bin/main.c, when the system
> >>>> function fwrite() returns an error.
> >>>>
> >>>> Thanks for your patience.
> >>>>
> >>>> Roger
> >>>>
> >>>>
> >>>>> My GRASS raster file:
> >>>>>
> >>>>> Type of Map:  raster               Number of Categories: 0
> >>>>> Data Type:    CELL
> >>>>> Rows:         22663
> >>>>> Columns:      28794
> >>>>> Total Cells:  652558422
> >>>>> ~90m resolution
> >>>>>
> >>>>> Using...
> >>>>>
> >>>>> srtm <- readRAST("mozambique_srtm_patch",cat=FALSE)
> >>>>>
> >>>>> After quite some time, I get...
> >>>>>
> >>>>> Error in execGRASS("r.out.bin", flags = rOutBinFlags, input =
> >>>> vname[i],  :
> >>>>>  The command:
> >>>>> r.out.bin -b -i input=mozambique_srtm_patch
> >>>>>
> >>>>
> output=/media/teaiii/development/grass/greensboro_mercator/teaiii/.tmp/teaiii-Leopard-WS/mozambique_srtm_patch
> >>>>> bytes=4 null=-81
> >>>>> produced an error (1) during execution:
> >>>>> Creating BIL support files...
> >>>>> Exporting raster as integer values (bytes=4)
> >>>>> ERROR: Error writing data
> >>>>> In addition: Warning messages:
> >>>>> 1: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
> >>>>>  Discarded ellps unknown in CRS definition: +proj=merc +lat_ts=0
> >>>> +lon_0=0
> >>>>> +x_0=0 +y_0=0 +R=6378137 +units=m +no_defs
> >>>>> 2: In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
> >>>>>  Discarded datum unknown in CRS definition
> >>>>>
> >>>>> Libraries loaded include: sp, rgrass7, rgdal, raster...
> >>>>>
> >>>>> Any thoughts?
> >>>>>
> >>>>> Best,
> >>>>> Tom
> >>>>>
> >>>>>
> >>>>
> >>>> --
> >>>> Roger Bivand
> >>>> Department of Economics, Norwegian School of Economics,
> >>>> Helleveien 30, N-5045 Bergen, Norway.
> >>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >>>> https://orcid.org/0000-0003-2392-6140
> >>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>>>
> >>>
> >>>
> >>> --
> >>> Thomas E Adams, III
> >>> 1724 Sage Lane
> >>> Blacksburg, VA 24060
> >>> tea3rd at gmail.com (personal)
> >>> tea at terrapredictions.org (work)
> >>>
> >>> 1 (513) 739-9512 (cell)
> >>>
> >>>
> >>>
> >>
> >> --
> >> Thomas E Adams, III
> >> 1724 Sage Lane
> >> Blacksburg, VA 24060
> >> tea3rd at gmail.com (personal)
> >> tea at terrapredictions.org (work)
> >>
> >> 1 (513) 739-9512 (cell)
> >>
> >>
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From @e||m@b@n@b@k @end|ng |rom tuw|en@@c@@t  Mon Jul 13 11:38:05 2020
From: @e||m@b@n@b@k @end|ng |rom tuw|en@@c@@t (Banabak, Selim)
Date: Mon, 13 Jul 2020 09:38:05 +0000
Subject: [R-sig-Geo] Using stsls() with predict.sarlm()
Message-ID: <1594633024692.10095@tuwien.ac.at>

Dear All,


I am using the "spatialreg" package to estimate a spatial autoregressive model for a large number of observations (~75.000) and would thus prefer to use stsls() over lagsarlm() to gain estimation speed. In a second step however, I want to use the model for out of sample prediction with predict.sarlm().

As predict.sarlm() is not designed for stsls() outputs I tried to modify the stsls() function outputs in a way that the prediction function would be able to handle them.


Now I have two question:

- Is it, from a theoretical point of view, legitimate to just use the IV estimates instead of the ML estimates for the predictors described in

Goulard et al. (2017)?

- Is the following modification of the original stsls() function in combination with the predict.sarlm() an acceptable approach to implement the prediction methods suggested by Goulard et al. (2017) with an IV estimator? (Unfortunately I could not come up with a way to test this myself)



Modifications + test predictions in R:

[modifications are marked with "## additional outputs start ##" and  "## additional outputs end ##" ]



library("spdep")
library("spatialreg")

# modify stsls function outputs
stsls2 <- function(formula, data = list(), listw, zero.policy=NULL,
                  na.action=na.fail, robust=FALSE, HC=NULL, legacy=FALSE, W2X=TRUE) {
  if (!inherits(listw, "listw"))
    stop("No neighbourhood list")

  if (is.null(zero.policy))
    zero.policy <- get("zeroPolicy", envir = .spatialregOptions)
  stopifnot(is.logical(zero.policy))
  if (!inherits(formula, "formula")) formula <- as.formula(formula)
  mt <- terms(formula, data = data)
  mf <- lm(formula, data, na.action=na.action, method="model.frame")
  na.act <- attr(mf, "na.action")
  if (!is.null(na.act)) {
    subset <- !(1:length(listw$neighbours) %in% na.act)
    listw <- subset(listw, subset, zero.policy=zero.policy)
  }

  y <- model.extract(mf, "response")
  if (any(is.na(y))) stop("NAs in dependent variable")
  X <- model.matrix(mt, mf)
  if (any(is.na(X))) stop("NAs in independent variable")
  if (robust) {
    if (is.null(HC)) HC <- "HC0"
    if (!any(HC %in% c("HC0", "HC1")))
      stop("HC must be one of HC0, HC1")
  }
  # modified to pass zero.policy Juan Tomas Sayago 100913
  Wy <- lag.listw(listw, y, zero.policy=zero.policy)
  dim(Wy) <- c(nrow(X),1)
  colnames(Wy) <- c("Rho")

  #    WX <- lag.listw(W,X[,2:ncol(X)])
  n <- NROW(X)
  m <- NCOL(X)
  xcolnames <- colnames(X)
  K <- ifelse(xcolnames[1] == "(Intercept)", 2, 1)
  if (m > 1) {
    WX <- matrix(nrow=n, ncol=(m-(K-1)))
    if(W2X) WWX <- matrix(nrow = n, ncol = ncol(WX) )
    for (k in K:m) {
      wx <- lag.listw(listw, X[,k], zero.policy=zero.policy)
      if(W2X) wwx <- lag.listw(listw, wx, zero.policy = zero.policy)
      if (any(is.na(wx)))
        stop("NAs in lagged independent variable")
      WX[,(k-(K-1))] <- wx
      if(W2X) WWX[, (k - (K - 1))] <- wwx
    }
    if(W2X) inst <- cbind(WX, WWX)
    else inst <- WX
  }
  if (K == 2 && listw$style != "W") {
    # modified to meet other styles, email from Rein Halbersma
    wx1 <- as.double(rep(1, n))
    wx <- lag.listw(listw, wx1, zero.policy=zero.policy)
    if(W2X) wwx <- lag.listw(listw, wx, zero.policy=zero.policy)
    if (m > 1) {
      inst <- cbind(wx, inst)
      if(W2X) inst <- cbind(wwx, inst)
    } else {
      inst <- matrix(wx, nrow=n, ncol=1)
      if(W2X) inst <- cbind(inst, wwx)
    }
    #        colnames(inst) <- xcolnames

  }
  #    if (listw$style == "W") colnames(WX) <- xcolnames[-1]
  result <- tsls(y=y, yend=Wy, X=X, Zinst=inst, robust=robust, HC=HC,
                 legacy=legacy)
  result$zero.policy <- zero.policy
  result$robust <- robust
  if (robust) result$HC <- HC
  result$legacy <- legacy
  result$listw_style <- listw$style
  result$call <- match.call()

  ## additional outputs ##
  result$rho <- result$coefficients[1]
  result$coefficients <- result$coefficients[2:length(result$coefficients)]
  result$type <- "lag"
  result$X <- X
  result$y <- y
  result$s2<-result$sse / result$df

  ## additional outputs end ##

  class(result) <- "stsls"
  result
}


# update original function in spatialreg
tmpfun <- get("stsls", envir = asNamespace("spatialreg"))
environment(stsls2) <- environment(tmpfun)
attributes(stsls2) <- attributes(tmpfun)
assignInNamespace("stsls", stsls2, ns="spatialreg")


#-# test prediction with updated function

# data
data(oldcol)

# set seed
set.seed(123)

# draw observations to use as test data
outsamp <- sample(1:nrow(COL.OLD), nrow(COL.OLD)*.3, replace = FALSE)

# create train and test dataframes
S.sample <- COL.OLD[-outsamp, ] # train
O.sample <- COL.OLD[outsamp, ] # test

S.sample.nb <- subset.nb(COL.nb, !(1:length(COL.nb) %in% outsamp)) # train

# run regression
testreg <- spatialreg::stsls(CRIME ~ INC + HOVAL, data=S.sample,
                     nb2listw(S.sample.nb, style="W"))

# in and outsample prediction
S.PRED.TC <- spatialreg::predict.sarlm(object = testreg, listw = nb2listw(S.sample.nb, style="W"),
                                       pred.type = "TC", power = FALSE)


O.PRED.TC <- spatialreg::predict.sarlm(object = testreg , newdata = O.sample,
                                           listw = nb2listw(COL.nb, style="W"), pred.type = "TC", power = FALSE)

O.PRED.BP <- spatialreg::predict.sarlm(object = testreg , newdata = O.sample,
                                           listw = nb2listw(COL.nb, style="W"), pred.type = "BP", power = FALSE)




I would be very glad to get some feedback on both the general idea and the implementation!


Best regards,

Selim Banabak


	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jul 13 14:43:27 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 13 Jul 2020 14:43:27 +0200
Subject: [R-sig-Geo] Using stsls() with predict.sarlm()
In-Reply-To: <1594633024692.10095@tuwien.ac.at>
References: <1594633024692.10095@tuwien.ac.at>
Message-ID: <alpine.LFD.2.23.451.2007131425590.298178@reclus.nhh.no>

On Mon, 13 Jul 2020, Banabak, Selim wrote:

> Dear All,
>
>
> I am using the "spatialreg" package to estimate a spatial autoregressive 
> model for a large number of observations (~75.000) and would thus prefer 
> to use stsls() over lagsarlm() to gain estimation speed. In a second 
> step however, I want to use the model for out of sample prediction with 
> predict.sarlm().
>
> As predict.sarlm() is not designed for stsls() outputs I tried to modify 
> the stsls() function outputs in a way that the prediction function would 
> be able to handle them.
>
>
> Now I have two question:
>
> - Is it, from a theoretical point of view, legitimate to just use the IV
>   estimates instead of the ML estimates for the predictors described in
>   Goulard et al. (2017)?

You would need to go through the underlying equations. Just using the 
point estimates of the coefficients and their standard errors is one 
approach, but there are few studies beyond Goulard et al. Maybe look at 
Suesse and co-author https://doi.org/10.1016/j.csda.2017.11.004, 
https://doi.org/10.1080/00949655.2017.1286495 (also ML - much of the 
STSLS/GMM literature avoids looking at important problems).

While estimating and fitting larger data sets is more time-consuming with 
ML, using LU or Cholesky decomposition is practical when the spatial 
weights are sparse (this applies to STSLS too). Predicting is also 
constrained when n is large, as inverting the nxn matrix may be needed.

Check whether Stata knows how to predict from STSLS, and check usage of 
sphet::spreg rather than spatialreg::stsls. Consider contacting the 
maintainer of sphet if there is no response on this list, as it would make 
more sense to explore predict methods for more modern sphet 
implementations than legacy ones in spatialreg.

>
> - Is the following modification of the original stsls() function in
>   combination with the predict.sarlm() an acceptable approach to
>   implement the prediction methods suggested by Goulard et al. (2017)
>   with an IV estimator? (Unfortunately I could not come up with a way to
>   test this myself)
>

You would need to do the matrix math separately - maybe contacting the 
author of the spatialreg implementations, Martin Gubri, would also make 
sense.

Interesting topic!

Roger

>
>
> Modifications + test predictions in R:
>
> [modifications are marked with "## additional outputs start ##" and  "## additional outputs end ##" ]
>
>
>
> library("spdep")
> library("spatialreg")
>
> # modify stsls function outputs
> stsls2 <- function(formula, data = list(), listw, zero.policy=NULL,
>                  na.action=na.fail, robust=FALSE, HC=NULL, legacy=FALSE, W2X=TRUE) {
>  if (!inherits(listw, "listw"))
>    stop("No neighbourhood list")
>
>  if (is.null(zero.policy))
>    zero.policy <- get("zeroPolicy", envir = .spatialregOptions)
>  stopifnot(is.logical(zero.policy))
>  if (!inherits(formula, "formula")) formula <- as.formula(formula)
>  mt <- terms(formula, data = data)
>  mf <- lm(formula, data, na.action=na.action, method="model.frame")
>  na.act <- attr(mf, "na.action")
>  if (!is.null(na.act)) {
>    subset <- !(1:length(listw$neighbours) %in% na.act)
>    listw <- subset(listw, subset, zero.policy=zero.policy)
>  }
>
>  y <- model.extract(mf, "response")
>  if (any(is.na(y))) stop("NAs in dependent variable")
>  X <- model.matrix(mt, mf)
>  if (any(is.na(X))) stop("NAs in independent variable")
>  if (robust) {
>    if (is.null(HC)) HC <- "HC0"
>    if (!any(HC %in% c("HC0", "HC1")))
>      stop("HC must be one of HC0, HC1")
>  }
>  # modified to pass zero.policy Juan Tomas Sayago 100913
>  Wy <- lag.listw(listw, y, zero.policy=zero.policy)
>  dim(Wy) <- c(nrow(X),1)
>  colnames(Wy) <- c("Rho")
>
>  #    WX <- lag.listw(W,X[,2:ncol(X)])
>  n <- NROW(X)
>  m <- NCOL(X)
>  xcolnames <- colnames(X)
>  K <- ifelse(xcolnames[1] == "(Intercept)", 2, 1)
>  if (m > 1) {
>    WX <- matrix(nrow=n, ncol=(m-(K-1)))
>    if(W2X) WWX <- matrix(nrow = n, ncol = ncol(WX) )
>    for (k in K:m) {
>      wx <- lag.listw(listw, X[,k], zero.policy=zero.policy)
>      if(W2X) wwx <- lag.listw(listw, wx, zero.policy = zero.policy)
>      if (any(is.na(wx)))
>        stop("NAs in lagged independent variable")
>      WX[,(k-(K-1))] <- wx
>      if(W2X) WWX[, (k - (K - 1))] <- wwx
>    }
>    if(W2X) inst <- cbind(WX, WWX)
>    else inst <- WX
>  }
>  if (K == 2 && listw$style != "W") {
>    # modified to meet other styles, email from Rein Halbersma
>    wx1 <- as.double(rep(1, n))
>    wx <- lag.listw(listw, wx1, zero.policy=zero.policy)
>    if(W2X) wwx <- lag.listw(listw, wx, zero.policy=zero.policy)
>    if (m > 1) {
>      inst <- cbind(wx, inst)
>      if(W2X) inst <- cbind(wwx, inst)
>    } else {
>      inst <- matrix(wx, nrow=n, ncol=1)
>      if(W2X) inst <- cbind(inst, wwx)
>    }
>    #        colnames(inst) <- xcolnames
>
>  }
>  #    if (listw$style == "W") colnames(WX) <- xcolnames[-1]
>  result <- tsls(y=y, yend=Wy, X=X, Zinst=inst, robust=robust, HC=HC,
>                 legacy=legacy)
>  result$zero.policy <- zero.policy
>  result$robust <- robust
>  if (robust) result$HC <- HC
>  result$legacy <- legacy
>  result$listw_style <- listw$style
>  result$call <- match.call()
>
>  ## additional outputs ##
>  result$rho <- result$coefficients[1]
>  result$coefficients <- result$coefficients[2:length(result$coefficients)]
>  result$type <- "lag"
>  result$X <- X
>  result$y <- y
>  result$s2<-result$sse / result$df
>
>  ## additional outputs end ##
>
>  class(result) <- "stsls"
>  result
> }
>
>
> # update original function in spatialreg
> tmpfun <- get("stsls", envir = asNamespace("spatialreg"))
> environment(stsls2) <- environment(tmpfun)
> attributes(stsls2) <- attributes(tmpfun)
> assignInNamespace("stsls", stsls2, ns="spatialreg")
>
>
> #-# test prediction with updated function
>
> # data
> data(oldcol)
>
> # set seed
> set.seed(123)
>
> # draw observations to use as test data
> outsamp <- sample(1:nrow(COL.OLD), nrow(COL.OLD)*.3, replace = FALSE)
>
> # create train and test dataframes
> S.sample <- COL.OLD[-outsamp, ] # train
> O.sample <- COL.OLD[outsamp, ] # test
>
> S.sample.nb <- subset.nb(COL.nb, !(1:length(COL.nb) %in% outsamp)) # train
>
> # run regression
> testreg <- spatialreg::stsls(CRIME ~ INC + HOVAL, data=S.sample,
>                     nb2listw(S.sample.nb, style="W"))
>
> # in and outsample prediction
> S.PRED.TC <- spatialreg::predict.sarlm(object = testreg, listw = nb2listw(S.sample.nb, style="W"),
>                                       pred.type = "TC", power = FALSE)
>
>
> O.PRED.TC <- spatialreg::predict.sarlm(object = testreg , newdata = O.sample,
>                                           listw = nb2listw(COL.nb, style="W"), pred.type = "TC", power = FALSE)
>
> O.PRED.BP <- spatialreg::predict.sarlm(object = testreg , newdata = O.sample,
>                                           listw = nb2listw(COL.nb, style="W"), pred.type = "BP", power = FALSE)
>
>
>
>
> I would be very glad to get some feedback on both the general idea and the implementation!
>
>
> Best regards,
>
> Selim Banabak
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz  Mon Jul 13 15:39:46 2020
From: M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz (=?UTF-8?Q?Michal_Kvasni=C4=8Dka?=)
Date: Mon, 13 Jul 2020 15:39:46 +0200
Subject: [R-sig-Geo] How set up spatstat::densityHeat()?
Message-ID: <CAEsi-R+Drtx6ZQLGgKPwx0MbUuhe36LMmUJjg96bRp7OfqiZvw@mail.gmail.com>

Hello.

I have to find hotspots of road accidents. It seems that
spatstat::densityHeat() implements McSwiggan et al. (2017) algorithm I want
to use. I plan to follow path of DrHotNet package:

1. estimate the density function
2. lixelize the network
3. calculate the density in the middle point of each lixel from (2) using
function estimated in (1)
4. find clusters of lixels from (3) with sufficiently high density

However, I don't know how to set the function's parameters.

I cannot use the implicit setting (finespacing=TRUE) because it suggests
tens of billions iterations. (I use OSM road maps of Czech districts
converted to Krovak projection. My testing district has about 2,700 km of
roads with an average length of road segments of about 30 meters due to
road curvatures. This is not the largest district I have to handle---Prague
is much larger.)

I can set finespacing = FALSE and then finetune the parameters myself.
However, I can't find any documentation. Having skimmed the source code,
I'm trying something like this:

density_function <- densityHeat(accident_lpp, sigma, finespacing = FALSE,
eps = 10, fun = TRUE)

This way I get the function I need. However, I'm not certain what I'm
doing. It seems that the densityHeat() uses some grid, based on lixelized
network. My questions are:

* Is it sufficient to set the eps parameter or do I need to set other
parameters too? Which ones?
* Is the parameter in meters (my map is projected with meters as its units)?
* If eps = 10 means grid of 10x10 meters, what precisely does it mean? How
is the network lixelized (and why)? How does it affect the estimated
function (not the linim object)?
* What is the (economically/substantially) reasonable value of eps (and
other necessary parameters)?
* Is there any documentation to the function? (I've read chapter 17 of the
spatstat book but found nothing there. The function help page doesn't cover
this either.)
* Does it any difference if I lixelize the network myself before running
densityHeat()?

Many thanks for your advice. (And an apology for such a long question.)

Best wishes,
*Ing. Michal Kvasni?ka, Ph.D.*



*Masaryk University | School of Economics and Administration*
Department of Economics
A: Lipov? 41a | 602 00 Brno
E: michal.kvasnicka at econ.muni.cz | W: www.econ.muni.cz/~qasar

	[[alternative HTML version deleted]]


From coyotepe@2203 @end|ng |rom gm@||@com  Mon Jul 13 15:56:54 2020
From: coyotepe@2203 @end|ng |rom gm@||@com (Coyo Tepe)
Date: Mon, 13 Jul 2020 07:56:54 -0600
Subject: [R-sig-Geo] Unable to perform intersection operations with vectors
Message-ID: <CAGSstc_BCN1HtQRp0CAu9AXky_NmEZ_AxU8ZH5Z1cMSEowXY0g@mail.gmail.com>

Platform and versions

Windows 64 bit

R version 4.0.2 (2020-06-22) -- "Taking Off Again"

Rstudio Version 1.3.959

rgdal: 1.5-12 / gdal: 3.0.4

rgeos version: 0.5-3, (SVN revision 634)

GEOS runtime version: 3.8.0-CAPI-1.13.1

Linking to sp version: 1.4-2

Polygon checking: TRUE



Problem

 We are trying to perform an intersection operation between two vector
layers in shapefile format and we get an error:

 Warning message:

In proj4string(x) : CRS object has comment, which is lost in output



Below you can have a REPEX:

???

library(rgdal)

library(raster)

library(rgeos)

 #layer a

bbox_a<-c(497555,500000,137000,138000)

 extent_a<-extent(bbox_a)

extent_a



capa_a<-as(extent_a,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons

crs(capa_a)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"

crs(capa_a)

shapefile(capa_a,paste("capa_a_re",sep="/"),overwrite=TRUE)

plot(capa_a,col="green") #plot(capa_a,col="green")

 #layer b

bbox_b<-c(497995,500050,137100,138100)

 extent_b<-extent(bbox_b)

extent_b

 capa_b<-as(extent_b,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons

crs(capa_b)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"

crs(capa_b)

shapefile(capa_b,paste("capa_b_re",sep="/"),overwrite=TRUE)

plot(capa_b,add=T)

 #buffer

b_buf<-buffer(capa_b,width=50)

plot(b_buf,add=T) #plot(b_buf,add=T,col="blue")

 #intersect

b_intersect<-intersect(capa_a,b_buf)



#Warning messages:

# 1: In proj4string(x) : CRS object has comment, which is lost in output

# 2: In proj4string(y) : CRS object has comment, which is lost in output


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Jul 13 17:04:58 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 13 Jul 2020 17:04:58 +0200
Subject: [R-sig-Geo] 
 Unable to perform intersection operations with vectors
In-Reply-To: <CAGSstc_BCN1HtQRp0CAu9AXky_NmEZ_AxU8ZH5Z1cMSEowXY0g@mail.gmail.com>
References: <CAGSstc_BCN1HtQRp0CAu9AXky_NmEZ_AxU8ZH5Z1cMSEowXY0g@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007131633360.299719@reclus.nhh.no>

On Mon, 13 Jul 2020, Coyo Tepe wrote:

> Platform and versions
> Windows 64 bit
> R version 4.0.2 (2020-06-22) -- "Taking Off Again"
Irrelevant > Rstudio Version 1.3.959
> rgdal: 1.5-12 / gdal: 3.0.4
> rgeos version: 0.5-3, (SVN revision 634)
> GEOS runtime version: 3.8.0-CAPI-1.13.1
> Linking to sp version: 1.4-2
> Polygon checking: TRUE

> Problem
>
> We are trying to perform an intersection operation between two vector
> layers in shapefile format and we get an error:
>
> Warning message:
>
> In proj4string(x) : CRS object has comment, which is lost in output
>

No, this is a warning not an error (unless you set options(warn=2)). Read 
for example https://www.r-spatial.org/r/2020/03/17/wkt.html and 
https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html 
to begin to grasp underlying changes that affect everyone's workflows. You 
can no longer assume that using Proj4 strings gives a satisfactory 
representation of CRS. With recent versions of raster, you see:

cat(comment(crs(capa_a)), "\n")

giving the WKT2 (2019) representation.

The warnings are given because the released raster S4 "intersect" method 
for signature (x='SpatialPolygons', y='SpatialPolygons') uses 
sp::proj4string() rather than the actual slot in a test. The code is (from 
getMethod("intersect", c('SpatialPolygons', 'SpatialPolygons'))):

     if (!identical(proj4string(x), proj4string(y))) {
         warning("non identical CRS")
         y at proj4string <- x at proj4string
     }

where each use of sp::proj4string() generates a warning. Here, they are 
identical, and the CRS slot of the output is handled correctly by rgeos 
internally. In the development version of raster, there is no use of 
sp::proj4string(), so no warning is made; however rgeos sees objects with 
no assigned projection, stopping it complaining when a user uses strictly 
planar methods with geographical coordinates. This seems convenient but 
is wrong.

The warnings are in place because workflows may be affected by Proj4 
strings no longer working as before, and being in practice abandoned. In 
sp-based workflows, they are still present, but are not used for 
transformation. Warnings are much better than unannounced changes in 
output.

Roger


>
>
> Below you can have a REPEX:
>
> ???
>
> library(rgdal)
>
> library(raster)
>
> library(rgeos)
>
> #layer a
>
> bbox_a<-c(497555,500000,137000,138000)
>
> extent_a<-extent(bbox_a)
>
> extent_a
>
>
>
> capa_a<-as(extent_a,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
>
> crs(capa_a)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
>
> crs(capa_a)
>
> shapefile(capa_a,paste("capa_a_re",sep="/"),overwrite=TRUE)
>
> plot(capa_a,col="green") #plot(capa_a,col="green")
>
> #layer b
>
> bbox_b<-c(497995,500050,137100,138100)
>
> extent_b<-extent(bbox_b)
>
> extent_b
>
> capa_b<-as(extent_b,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
>
> crs(capa_b)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
>
> crs(capa_b)
>
> shapefile(capa_b,paste("capa_b_re",sep="/"),overwrite=TRUE)
>
> plot(capa_b,add=T)
>
> #buffer
>
> b_buf<-buffer(capa_b,width=50)
>
> plot(b_buf,add=T) #plot(b_buf,add=T,col="blue")
>
> #intersect
>
> b_intersect<-intersect(capa_a,b_buf)
>
>
>
> #Warning messages:
>
> # 1: In proj4string(x) : CRS object has comment, which is lost in output
>
> # 2: In proj4string(y) : CRS object has comment, which is lost in output
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From coyotepe@2203 @end|ng |rom gm@||@com  Mon Jul 13 22:36:45 2020
From: coyotepe@2203 @end|ng |rom gm@||@com (Coyo Tepe)
Date: Mon, 13 Jul 2020 14:36:45 -0600
Subject: [R-sig-Geo] Unable to perform intersection operations with vectors
Message-ID: <CAGSstc9jiEfsnYaWUxbEikNuou49Zt1Aw9HPBHEAyyXawKeTNg@mail.gmail.com>

Platform and versions
Windows 64 bit
R version 4.0.2 (2020-06-22) -- "Taking Off Again"
Rstudio Version 1.3.959
rgdal: 1.5-12 / gdal: 3.0.4
rgeos version: 0.5-3, (SVN revision 634)
GEOS runtime version: 3.8.0-CAPI-1.13.1
Linking to sp version: 1.4-2
Polygon checking: TRUE

Problem
We are trying to perform an intersection operation between two vector
layers in shapefile format and we get an error:

Warning message:
In proj4string(x) : CRS object has comment, which is lost in output

Below you can have a REPEX:
??
library(rgdal)
library(raster)
library(rgeos)

 #layer a
bbox_a<-c(497555,500000,137000,138000)
extent_a<-extent(bbox_a)
extent_a
capa_a<-as(extent_a,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
crs(capa_a)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
crs(capa_a)
shapefile(capa_a,paste("capa_a_re",sep="/"),overwrite=TRUE)
plot(capa_a,col="green") #plot(capa_a,col="green")

 #layer b
bbox_b<-c(497995,500050,137100,138100)
extent_b<-extent(bbox_b)
extent_b
capa_b<-as(extent_b,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
crs(capa_b)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
crs(capa_b)
shapefile(capa_b,paste("capa_b_re",sep="/"),overwrite=TRUE)
plot(capa_b,add=T)

 #buffer
b_buf<-buffer(capa_b,width=50)
plot(b_buf,add=T) #plot(b_buf,add=T,col="blue")

#intersect
b_intersect<-intersect(capa_a,b_buf)

#Warning messages:
# 1: In proj4string(x) : CRS object has comment, which is lost in output
# 2: In proj4string(y) : CRS object has comment, which is lost in output

???

We have found in the following link:

https://gis.stackexchange.com/questions/364667/r-4-0-1-not-sure-i-understand-this-message-warning-message-in-proj4stringx

some comment about this problem: ?This is not related to R 4.0.1 but
to rgdal 1.5-8 and the migration to gdal 3 and proj 6. This is a very
long and complex process that impact hundreds maybe thouthands of
packages. All the packages are not yet up-to-date with what is coming.
As a regular user you do not need to pay too much attention on these
warnings but should be aware of what is coming in the geospatial
world.

You can have a look to ?rgdal::set_thin_PROJ6_warnings() to eliminate
those warnings.?

However, this warning for us is a problem since it does not allow us
to perform the intersection operation between the 2 layers.

What we have tried is to pass our R and rgdal to a previous version
(Version rgdal 1.4-8) and R version 3.6.1 (2019-07-05) - "Action of
the Toes" but we would like to know if this is the way to go or there
other options.

Currently we have managed to get the 3.6.1 R version and but we have
trouble passing to the Rgdal version 1.4-8, hoping that this version
does not have these problems with the warning that we can not perform
the operation of intersection.

Regarding how to install an older rgdal version we found an interesting link

(https://stackoverflow.com/questions/51749860/installing-rgdal-backdate-rgdal-version-versus-update-gdal-version-and-how)
that explains how to do it with the following commands:

require(devtools)
install_version("rgdal", version="1.4-8")
But we get the following error:
ERROR: lazy loading failed for package 'rgdal'
* removing 'C:/Users/pepe/Documents/R/win-library/3.6/rgdal'
* restoring previous 'C:/Users/pepe/Documents/R/win-library/3.6/rgdal'
Error: Failed to install 'unknown package' from URL:
  (converted from warning) installation of
package ?C:/Users/pepe /AppData/Local/Temp/RtmpqCxtfw/remotes26c7f616614/rgdal?
had non-zero exit status

Thank you for your help,


From A|ex@nder@Herr @end|ng |rom c@|ro@@u  Tue Jul 14 06:17:55 2020
From: A|ex@nder@Herr @end|ng |rom c@|ro@@u (Herr, Alexander (L&W, Black Mountain))
Date: Tue, 14 Jul 2020 04:17:55 +0000
Subject: [R-sig-Geo] subsetting terra::raster
Message-ID: <SY3PR01MB1273EC9345224BCB3B609024EB610@SY3PR01MB1273.ausprd01.prod.outlook.com>

Hi,

I am moving from raster to terra. I get an error when I adapt the following raster code:
require(raster)
set.seed(666)
 reps=10
 r <- raster( matrix(nrow=reps,ncol=reps, round(rnorm(reps^2),1)))
 extent(r)<- c(1,101,1,101)
plot(r) 
xy<-xyFromCell(r,r[r>0])
z<-r[r>0]
cbind(xy,z)

Under terra code:
require(terra)
r <- rast( matrix(nrow=reps,ncol=reps, round(rnorm(reps^2),1)))
plot(r)
xy<-xyFromCell(r,r[r>0])
Error in r[r > 0] : object of type 'S4' is not subsettable

What am I doing wrong?

Thanks
herry


 in terra



From md@umner @end|ng |rom gm@||@com  Tue Jul 14 06:40:47 2020
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Tue, 14 Jul 2020 14:40:47 +1000
Subject: [R-sig-Geo] subsetting terra::raster
In-Reply-To: <SY3PR01MB1273EC9345224BCB3B609024EB610@SY3PR01MB1273.ausprd01.prod.outlook.com>
References: <SY3PR01MB1273EC9345224BCB3B609024EB610@SY3PR01MB1273.ausprd01.prod.outlook.com>
Message-ID: <CAAcGz9-kfuJqG5=N9WxHWDRO1LWYCDbbrEV0m3z9tMN7YtvJng@mail.gmail.com>

The second argument to xyFromCell is a *cell number*, but in `r[r>0]` you
have a *cell value*, which may not be what you want.

It's the r[r > 0] part that's not working in terra, so you could do this as
a workaround ...

xy <- xyFromCell(r, values(r)[values(r) >0])

(but are your cell values really intended for use as cell numbers? It's
certainly useful for that but probably uncommon).

Your code also did not set the extent in the terra object, or set.seed so
there's several steps that lack compatibility.

Cheers, Mike



On Tue, Jul 14, 2020 at 2:18 PM Herr, Alexander (L&W, Black Mountain)
<Alexander.Herr at csiro.au> wrote:

> Hi,
>
> I am moving from raster to terra. I get an error when I adapt the
> following raster code:
> require(raster)
> set.seed(666)
>  reps=10
>  r <- raster( matrix(nrow=reps,ncol=reps, round(rnorm(reps^2),1)))
>  extent(r)<- c(1,101,1,101)
> plot(r)
> xy<-xyFromCell(r,r[r>0])
> z<-r[r>0]
> cbind(xy,z)
>
> Under terra code:
> require(terra)
> r <- rast( matrix(nrow=reps,ncol=reps, round(rnorm(reps^2),1)))
> plot(r)
> xy<-xyFromCell(r,r[r>0])
> Error in r[r > 0] : object of type 'S4' is not subsettable
>
> What am I doing wrong?
>
> Thanks
> herry
>
>
>  in terra
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]


From A|ex@nder@Herr @end|ng |rom c@|ro@@u  Tue Jul 14 08:02:17 2020
From: A|ex@nder@Herr @end|ng |rom c@|ro@@u (Herr, Alexander (L&W, Black Mountain))
Date: Tue, 14 Jul 2020 06:02:17 +0000
Subject: [R-sig-Geo] subsetting terra::raster
In-Reply-To: <CAAcGz9-kfuJqG5=N9WxHWDRO1LWYCDbbrEV0m3z9tMN7YtvJng@mail.gmail.com>
References: <SY3PR01MB1273EC9345224BCB3B609024EB610@SY3PR01MB1273.ausprd01.prod.outlook.com>
 <CAAcGz9-kfuJqG5=N9WxHWDRO1LWYCDbbrEV0m3z9tMN7YtvJng@mail.gmail.com>
Message-ID: <SY3PR01MB127326B8A7E8CD4BB4A69BCEEB610@SY3PR01MB1273.ausprd01.prod.outlook.com>

You are right,
What I really want is extract cell coordinates and their values for cells with values >0

So I could use in raster
xyz <- rasterToPoints(r, fun=function(x){x>0}, xy=T)
or
Which(r>0,cells=T)->p
cbind(xyFromCell(r,p),extract(r,p))

what?s the terra alternative?




From: Michael Sumner <mdsumner at gmail.com>
Sent: Tuesday, 14 July 2020 2:41 PM
To: Herr, Alexander (L&W, Black Mountain) <Alexander.Herr at csiro.au>
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] subsetting terra::raster

The second argument to xyFromCell is a *cell number*, but in `r[r>0]` you have a *cell value*, which may not be what you want.

It's the r[r > 0] part that's not working in terra, so you could do this as a workaround ...

xy <- xyFromCell(r, values(r)[values(r) >0])

(but are your cell values really intended for use as cell numbers? It's certainly useful for that but probably uncommon).

Your code also did not set the extent in the terra object, or set.seed so there's several steps that lack compatibility.

Cheers, Mike


On Tue, Jul 14, 2020 at 2:18 PM Herr, Alexander (L&W, Black Mountain) <Alexander.Herr at csiro.au<mailto:Alexander.Herr at csiro.au>> wrote:
Hi,

I am moving from raster to terra. I get an error when I adapt the following raster code:
require(raster)
set.seed(666)
 reps=10
 r <- raster( matrix(nrow=reps,ncol=reps, round(rnorm(reps^2),1)))
 extent(r)<- c(1,101,1,101)
plot(r)
xy<-xyFromCell(r,r[r>0])
z<-r[r>0]
cbind(xy,z)

Under terra code:
require(terra)
r <- rast( matrix(nrow=reps,ncol=reps, round(rnorm(reps^2),1)))
plot(r)
xy<-xyFromCell(r,r[r>0])
Error in r[r > 0] : object of type 'S4' is not subsettable

What am I doing wrong?

Thanks
herry


 in terra


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


--
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com<mailto:mdsumner at gmail.com>

	[[alternative HTML version deleted]]


From md@umner @end|ng |rom gm@||@com  Tue Jul 14 08:15:45 2020
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Tue, 14 Jul 2020 16:15:45 +1000
Subject: [R-sig-Geo] subsetting terra::raster
In-Reply-To: <SY3PR01MB127326B8A7E8CD4BB4A69BCEEB610@SY3PR01MB1273.ausprd01.prod.outlook.com>
References: <SY3PR01MB1273EC9345224BCB3B609024EB610@SY3PR01MB1273.ausprd01.prod.outlook.com>
 <CAAcGz9-kfuJqG5=N9WxHWDRO1LWYCDbbrEV0m3z9tMN7YtvJng@mail.gmail.com>
 <SY3PR01MB127326B8A7E8CD4BB4A69BCEEB610@SY3PR01MB1273.ausprd01.prod.outlook.com>
Message-ID: <CAAcGz98Rko0W2RuAQh=h1RdO45ZkzOPwJLrPWw1n2ZuteewwZg@mail.gmail.com>

you could do this for a single layer object:

p <- which(values(r) > 0)    #  Possibly faster to use values(r > 0) > 0
cbind(xyFromCell(r,p),extract(r,p))

as long as getting all values is memory-safe (I'm not sure if there's a
Which analog in terra).

HTH



On Tue, Jul 14, 2020 at 4:02 PM Herr, Alexander (L&W, Black Mountain)
<Alexander.Herr at csiro.au> wrote:

> You are right,
>
> What I really want is extract cell coordinates and their values for cells
> with values >0
>
>
>
> So I could use in raster
>
> xyz <- rasterToPoints(r, fun=function(x){x>0}, xy=T)
>
> or
>
> Which(r>0,cells=T)->p
>
> cbind(xyFromCell(r,p),extract(r,p))
>
>
>
> what?s the terra alternative?
>
>
>
>
>
>
>
>
>
> *From:* Michael Sumner <mdsumner at gmail.com>
> *Sent:* Tuesday, 14 July 2020 2:41 PM
> *To:* Herr, Alexander (L&W, Black Mountain) <Alexander.Herr at csiro.au>
> *Cc:* r-sig-geo at r-project.org
> *Subject:* Re: [R-sig-Geo] subsetting terra::raster
>
>
>
> The second argument to xyFromCell is a *cell number*, but in `r[r>0]` you
> have a *cell value*, which may not be what you want.
>
>
>
> It's the r[r > 0] part that's not working in terra, so you could do this
> as a workaround ...
>
>
>
> xy <- xyFromCell(r, values(r)[values(r) >0])
>
>
>
> (but are your cell values really intended for use as cell numbers? It's
> certainly useful for that but probably uncommon).
>
>
>
> Your code also did not set the extent in the terra object, or set.seed so
> there's several steps that lack compatibility.
>
>
>
> Cheers, Mike
>
>
>
>
>
> On Tue, Jul 14, 2020 at 2:18 PM Herr, Alexander (L&W, Black Mountain) <
> Alexander.Herr at csiro.au> wrote:
>
> Hi,
>
> I am moving from raster to terra. I get an error when I adapt the
> following raster code:
> require(raster)
> set.seed(666)
>  reps=10
>  r <- raster( matrix(nrow=reps,ncol=reps, round(rnorm(reps^2),1)))
>  extent(r)<- c(1,101,1,101)
> plot(r)
> xy<-xyFromCell(r,r[r>0])
> z<-r[r>0]
> cbind(xy,z)
>
> Under terra code:
> require(terra)
> r <- rast( matrix(nrow=reps,ncol=reps, round(rnorm(reps^2),1)))
> plot(r)
> xy<-xyFromCell(r,r[r>0])
> Error in r[r > 0] : object of type 'S4' is not subsettable
>
> What am I doing wrong?
>
> Thanks
> herry
>
>
>  in terra
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
>
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Jul 14 14:36:11 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 14 Jul 2020 14:36:11 +0200
Subject: [R-sig-Geo] 
 Unable to perform intersection operations with vectors
In-Reply-To: <CAGSstc9jiEfsnYaWUxbEikNuou49Zt1Aw9HPBHEAyyXawKeTNg@mail.gmail.com>
References: <CAGSstc9jiEfsnYaWUxbEikNuou49Zt1Aw9HPBHEAyyXawKeTNg@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007141413050.313796@reclus.nhh.no>

On Mon, 13 Jul 2020, Coyo Tepe wrote:

> Platform and versions
> Windows 64 bit
> R version 4.0.2 (2020-06-22) -- "Taking Off Again"
> Rstudio Version 1.3.959
> rgdal: 1.5-12 / gdal: 3.0.4
> rgeos version: 0.5-3, (SVN revision 634)
> GEOS runtime version: 3.8.0-CAPI-1.13.1
> Linking to sp version: 1.4-2
> Polygon checking: TRUE
>
> Problem
> We are trying to perform an intersection operation between two vector
> layers in shapefile format and we get an error:
>
> Warning message:
> In proj4string(x) : CRS object has comment, which is lost in output

As I replied before (and I know with complete certainty, because I wrote 
and maintain the code), this is a warning, not an error. You (no 
affiliation, I have no idea what work/research you are doing) and 
everybody else using R spatial software needs to be aware that Proj4 
strings (the ones starting with "+proj=") are almost defunct and should 
not be relied on. Hence the warning. If your workflow is affected by 
degradation as described in 
https://www.r-spatial.org/r/2020/03/17/wkt.html and 
https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html, 
you will suffer increased imprecision by about 150m.

You should in principle trust information from package authors and 
maintainers much more than random google search hits. I do not contribute 
to stackoverflow, and while the answer you refer to does concern this 
issue, it is basically wrong in saying that regular users do not need to 
pay attention. I have noted why in that thread. Downgrading R/packages 
makes absolutely no sense, and you should only consider installing old 
versions of R and packages to reproduce old results.

Again, you  are not seeing any errors in your example, only two warnings 
in the released version of raster, which are (wrongly) suppressed in the 
development version.

Please demonstrate that anything here is an error, and show the output of 
traceback in your case, which the reprex obviously does not capture. Your 
reprex also contains totally irrelevant calls to raster::shapefile(), 
which just writes the polygons to disk but are otherwise without effect.

Roger

>
> Below you can have a REPEX:
> ??
> library(rgdal)
> library(raster)
> library(rgeos)
>
> #layer a
> bbox_a<-c(497555,500000,137000,138000)
> extent_a<-extent(bbox_a)
> extent_a
> capa_a<-as(extent_a,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
> crs(capa_a)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
> crs(capa_a)
> shapefile(capa_a,paste("capa_a_re",sep="/"),overwrite=TRUE)
> plot(capa_a,col="green") #plot(capa_a,col="green")
>
> #layer b
> bbox_b<-c(497995,500050,137100,138100)
> extent_b<-extent(bbox_b)
> extent_b
> capa_b<-as(extent_b,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
> crs(capa_b)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
> crs(capa_b)
> shapefile(capa_b,paste("capa_b_re",sep="/"),overwrite=TRUE)
> plot(capa_b,add=T)
>
> #buffer
> b_buf<-buffer(capa_b,width=50)
> plot(b_buf,add=T) #plot(b_buf,add=T,col="blue")
>
> #intersect
> b_intersect<-intersect(capa_a,b_buf)
>
> #Warning messages:
> # 1: In proj4string(x) : CRS object has comment, which is lost in output
> # 2: In proj4string(y) : CRS object has comment, which is lost in output
>
> ???
>
> We have found in the following link:
>
> https://gis.stackexchange.com/questions/364667/r-4-0-1-not-sure-i-understand-this-message-warning-message-in-proj4stringx
>
> some comment about this problem: ?This is not related to R 4.0.1 but
> to rgdal 1.5-8 and the migration to gdal 3 and proj 6. This is a very
> long and complex process that impact hundreds maybe thouthands of
> packages. All the packages are not yet up-to-date with what is coming.
> As a regular user you do not need to pay too much attention on these
> warnings but should be aware of what is coming in the geospatial
> world.
>
> You can have a look to ?rgdal::set_thin_PROJ6_warnings() to eliminate
> those warnings.?
>
> However, this warning for us is a problem since it does not allow us
> to perform the intersection operation between the 2 layers.
>
> What we have tried is to pass our R and rgdal to a previous version
> (Version rgdal 1.4-8) and R version 3.6.1 (2019-07-05) - "Action of
> the Toes" but we would like to know if this is the way to go or there
> other options.
>
> Currently we have managed to get the 3.6.1 R version and but we have
> trouble passing to the Rgdal version 1.4-8, hoping that this version
> does not have these problems with the warning that we can not perform
> the operation of intersection.
>
> Regarding how to install an older rgdal version we found an interesting link
>
> (https://stackoverflow.com/questions/51749860/installing-rgdal-backdate-rgdal-version-versus-update-gdal-version-and-how)
> that explains how to do it with the following commands:
>
> require(devtools)
> install_version("rgdal", version="1.4-8")
> But we get the following error:
> ERROR: lazy loading failed for package 'rgdal'
> * removing 'C:/Users/pepe/Documents/R/win-library/3.6/rgdal'
> * restoring previous 'C:/Users/pepe/Documents/R/win-library/3.6/rgdal'
> Error: Failed to install 'unknown package' from URL:
>  (converted from warning) installation of
> package ?C:/Users/pepe /AppData/Local/Temp/RtmpqCxtfw/remotes26c7f616614/rgdal?
> had non-zero exit status
>
> Thank you for your help,
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From te@3rd @end|ng |rom gm@||@com  Wed Jul 15 12:22:05 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Wed, 15 Jul 2020 06:22:05 -0400
Subject: [R-sig-Geo] Help with universal kriging using gstat
Message-ID: <CAGxgkWhpuOoTvMZtqk-OyjYOyXEXsCdmLhA2uJPfPH0vxAVYCw@mail.gmail.com>

Hi all,

It's been some time since I approached universal kriging using gstat (I
struggled with this previously, years ago:
https://stat.ethz.ch/pipermail/r-sig-geo/2006-May/001017.html).

The problem...

Within GRASS GIS, using R, I do this...

(1) read a raster DEM into R from GRASS -- srtm <-
readRAST("mozambique_srtm_patch",cat=FALSE)
(2) read GRASS point data consisting of 4 fields (category, lon, lat,
temperature) -- airtemp <- readVECT("Mozambique_air_temp_2017_ann")
(3) so I have a SpatialGridDataFrame and SpatialPointsDataFrame,
respectively
(4) I can do the following: plot srtm, airtemp, generate an interpolated
grid of air temperatures with krige, using the airtemp
SpatialPointsDataFrame, and overlay the various data for visualization

What I want to do is to use the srtm DEM data as a secondary trend variable
to spatially interpolate airtemp using universal kriging. I cannot figure
out how to construct the data sets and use krige in gstat to do this. I
have spent several days scouring the internet for an example (including
previous queries of my own, cited above) to no avail.

It seems I should be able to do this, essentially:

 > dem<-read.asciigrid("gtopo30.dem")
 > class(dem)
[1] "SpatialGridDataFrame"
attr(,"package")
[1] "sp"
 > image(dem)
 > points(Y ~ X, data=temps)
 > class(temps)
[1] "data.frame"
 > coordinates(temps)=~X+Y
 > dem.ov=overlay(dem,temps)
 > summary(dem.ov)

> vgm <- vgm(psill=8,model="Exp",range=600000,nugget=3.8)
 > vgm_temps_r<-fit.variogram(variogram(T~gtopo30.dem,temps), model=vgm)
 > plot(variogram(T~gtopo30.dem,temps),main = "fitted by gstat")
 > temps_uk<-krige(T~gtopo30.dem,temps,dem, vgm_temps_r)
[using universal kriging]
 > library(lattice)
 > trellis.par.set(sp.theme())
 > spplot(temps_uk,"var1.pred", main="Universal kriging predictions

However, when I take this step:

> dem.ov=overlay(srtm,airtemp)
Error in (function (classes, fdef, mtable)  :
  unable to find an inherited method for function ?overlay? for signature
?"SpatialGridDataFrame", "SpatialPointsDataFrame"?

> airtemp$srtm.dem=dem.ov$srtm  <====== this fails (see below)


> vgm <- vgm(psill=8,model="Exp",range=600000,nugget=3.8)
> vgm_temps_r<-fit.variogram(variogram(temp~srtm.dem,airtemp), model=vgm)
> temps_uk<-krige(temp~srtm.dem,airtemp,srtm, vgm_temps_r)

> airtemp$srtm.dem=srtm
Error in `[[<-.data.frame`(`*tmp*`, name, value =
new("SpatialGridDataFrame",  :
  replacement has 72821592 rows, data has 267

Any suggestions?

Best,
Tom

-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From coyotepe@2203 @end|ng |rom gm@||@com  Wed Jul 15 22:40:33 2020
From: coyotepe@2203 @end|ng |rom gm@||@com (Coyo Tepe)
Date: Wed, 15 Jul 2020 14:40:33 -0600
Subject: [R-sig-Geo] 
 Unable to perform intersection operations with vectors
In-Reply-To: <alpine.LFD.2.23.451.2007141413050.313796@reclus.nhh.no>
References: <CAGSstc9jiEfsnYaWUxbEikNuou49Zt1Aw9HPBHEAyyXawKeTNg@mail.gmail.com>
 <alpine.LFD.2.23.451.2007141413050.313796@reclus.nhh.no>
Message-ID: <CAGSstc_yKvY5M9wZzRTmoFScCP6DsBQqTtpWAhe6qERKQp4ZrA@mail.gmail.com>

Dear Doctor Roger Bivand,

First I have to say thank you for your quick response and secondly I
am sorry for the confusion. I did not mean you to think I don?t trust
your comments. Not at all, you are the reference in this matter..


I first sent an incomplete message and when I realized it I sent the
complete one,  that?s why the message was sent twice and I did not
read your reply before sending this second message.


Regarding your message, you are right, this is a warning, not an error
and I agree with you that is much better to have warnings that
problems at the end of the process and not knowing what could be
wrong.


I was not aware thae using the Proj4 strings should not be relied on
and of course you are right about the comment with shapefile() call,
this should not be part of the REPEX. Thanks also for the
recommendation regarding the downgrading or R packages. I have read
the links you shared regarding the GDAL and PROJ development and is
more clear to me now.


Thank you!!  and again  I am really sorry for the misunderstanding,

El mar., 14 jul. 2020 a las 6:36, Roger Bivand (<Roger.Bivand at nhh.no>) escribi?:
>
> On Mon, 13 Jul 2020, Coyo Tepe wrote:
>
> > Platform and versions
> > Windows 64 bit
> > R version 4.0.2 (2020-06-22) -- "Taking Off Again"
> > Rstudio Version 1.3.959
> > rgdal: 1.5-12 / gdal: 3.0.4
> > rgeos version: 0.5-3, (SVN revision 634)
> > GEOS runtime version: 3.8.0-CAPI-1.13.1
> > Linking to sp version: 1.4-2
> > Polygon checking: TRUE
> >
> > Problem
> > We are trying to perform an intersection operation between two vector
> > layers in shapefile format and we get an error:
> >
> > Warning message:
> > In proj4string(x) : CRS object has comment, which is lost in output
>
> As I replied before (and I know with complete certainty, because I wrote
> and maintain the code), this is a warning, not an error. You (no
> affiliation, I have no idea what work/research you are doing) and
> everybody else using R spatial software needs to be aware that Proj4
> strings (the ones starting with "+proj=") are almost defunct and should
> not be relied on. Hence the warning. If your workflow is affected by
> degradation as described in
> https://www.r-spatial.org/r/2020/03/17/wkt.html and
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html,
> you will suffer increased imprecision by about 150m.
>
> You should in principle trust information from package authors and
> maintainers much more than random google search hits. I do not contribute
> to stackoverflow, and while the answer you refer to does concern this
> issue, it is basically wrong in saying that regular users do not need to
> pay attention. I have noted why in that thread. Downgrading R/packages
> makes absolutely no sense, and you should only consider installing old
> versions of R and packages to reproduce old results.
>
> Again, you  are not seeing any errors in your example, only two warnings
> in the released version of raster, which are (wrongly) suppressed in the
> development version.
>
> Please demonstrate that anything here is an error, and show the output of
> traceback in your case, which the reprex obviously does not capture. Your
> reprex also contains totally irrelevant calls to raster::shapefile(),
> which just writes the polygons to disk but are otherwise without effect.
>
> Roger
>
> >
> > Below you can have a REPEX:
> > ??
> > library(rgdal)
> > library(raster)
> > library(rgeos)
> >
> > #layer a
> > bbox_a<-c(497555,500000,137000,138000)
> > extent_a<-extent(bbox_a)
> > extent_a
> > capa_a<-as(extent_a,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
> > crs(capa_a)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
> > crs(capa_a)
> > shapefile(capa_a,paste("capa_a_re",sep="/"),overwrite=TRUE)
> > plot(capa_a,col="green") #plot(capa_a,col="green")
> >
> > #layer b
> > bbox_b<-c(497995,500050,137100,138100)
> > extent_b<-extent(bbox_b)
> > extent_b
> > capa_b<-as(extent_b,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
> > crs(capa_b)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
> > crs(capa_b)
> > shapefile(capa_b,paste("capa_b_re",sep="/"),overwrite=TRUE)
> > plot(capa_b,add=T)
> >
> > #buffer
> > b_buf<-buffer(capa_b,width=50)
> > plot(b_buf,add=T) #plot(b_buf,add=T,col="blue")
> >
> > #intersect
> > b_intersect<-intersect(capa_a,b_buf)
> >
> > #Warning messages:
> > # 1: In proj4string(x) : CRS object has comment, which is lost in output
> > # 2: In proj4string(y) : CRS object has comment, which is lost in output
> >
> > ???
> >
> > We have found in the following link:
> >
> > https://gis.stackexchange.com/questions/364667/r-4-0-1-not-sure-i-understand-this-message-warning-message-in-proj4stringx
> >
> > some comment about this problem: ?This is not related to R 4.0.1 but
> > to rgdal 1.5-8 and the migration to gdal 3 and proj 6. This is a very
> > long and complex process that impact hundreds maybe thouthands of
> > packages. All the packages are not yet up-to-date with what is coming.
> > As a regular user you do not need to pay too much attention on these
> > warnings but should be aware of what is coming in the geospatial
> > world.
> >
> > You can have a look to ?rgdal::set_thin_PROJ6_warnings() to eliminate
> > those warnings.?
> >
> > However, this warning for us is a problem since it does not allow us
> > to perform the intersection operation between the 2 layers.
> >
> > What we have tried is to pass our R and rgdal to a previous version
> > (Version rgdal 1.4-8) and R version 3.6.1 (2019-07-05) - "Action of
> > the Toes" but we would like to know if this is the way to go or there
> > other options.
> >
> > Currently we have managed to get the 3.6.1 R version and but we have
> > trouble passing to the Rgdal version 1.4-8, hoping that this version
> > does not have these problems with the warning that we can not perform
> > the operation of intersection.
> >
> > Regarding how to install an older rgdal version we found an interesting link
> >
> > (https://stackoverflow.com/questions/51749860/installing-rgdal-backdate-rgdal-version-versus-update-gdal-version-and-how)
> > that explains how to do it with the following commands:
> >
> > require(devtools)
> > install_version("rgdal", version="1.4-8")
> > But we get the following error:
> > ERROR: lazy loading failed for package 'rgdal'
> > * removing 'C:/Users/pepe/Documents/R/win-library/3.6/rgdal'
> > * restoring previous 'C:/Users/pepe/Documents/R/win-library/3.6/rgdal'
> > Error: Failed to install 'unknown package' from URL:
> >  (converted from warning) installation of
> > package ?C:/Users/pepe /AppData/Local/Temp/RtmpqCxtfw/remotes26c7f616614/rgdal?
> > had non-zero exit status
> >
> > Thank you for your help,
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Roger@B|v@nd @end|ng |rom nhh@no  Thu Jul 16 10:15:33 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 16 Jul 2020 10:15:33 +0200
Subject: [R-sig-Geo] Help with universal kriging using gstat
In-Reply-To: <CAGxgkWhpuOoTvMZtqk-OyjYOyXEXsCdmLhA2uJPfPH0vxAVYCw@mail.gmail.com>
References: <CAGxgkWhpuOoTvMZtqk-OyjYOyXEXsCdmLhA2uJPfPH0vxAVYCw@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007161012180.351776@reclus.nhh.no>

On Wed, 15 Jul 2020, Thomas Adams wrote:

> Hi all,
>
> It's been some time since I approached universal kriging using gstat (I
> struggled with this previously, years ago:
> https://stat.ethz.ch/pipermail/r-sig-geo/2006-May/001017.html).
>
> The problem...
>
> Within GRASS GIS, using R, I do this...
>
> (1) read a raster DEM into R from GRASS -- srtm <-
> readRAST("mozambique_srtm_patch",cat=FALSE)
> (2) read GRASS point data consisting of 4 fields (category, lon, lat,
> temperature) -- airtemp <- readVECT("Mozambique_air_temp_2017_ann")
> (3) so I have a SpatialGridDataFrame and SpatialPointsDataFrame,
> respectively
> (4) I can do the following: plot srtm, airtemp, generate an interpolated
> grid of air temperatures with krige, using the airtemp
> SpatialPointsDataFrame, and overlay the various data for visualization
>
> What I want to do is to use the srtm DEM data as a secondary trend variable
> to spatially interpolate airtemp using universal kriging. I cannot figure
> out how to construct the data sets and use krige in gstat to do this. I
> have spent several days scouring the internet for an example (including
> previous queries of my own, cited above) to no avail.
>
> It seems I should be able to do this, essentially:
>
> > dem<-read.asciigrid("gtopo30.dem")
> > class(dem)
> [1] "SpatialGridDataFrame"
> attr(,"package")
> [1] "sp"
> > image(dem)
> > points(Y ~ X, data=temps)
> > class(temps)
> [1] "data.frame"
> > coordinates(temps)=~X+Y
> > dem.ov=overlay(dem,temps)
> > summary(dem.ov)
>
>> vgm <- vgm(psill=8,model="Exp",range=600000,nugget=3.8)
> > vgm_temps_r<-fit.variogram(variogram(T~gtopo30.dem,temps), model=vgm)
> > plot(variogram(T~gtopo30.dem,temps),main = "fitted by gstat")
> > temps_uk<-krige(T~gtopo30.dem,temps,dem, vgm_temps_r)
> [using universal kriging]
> > library(lattice)
> > trellis.par.set(sp.theme())
> > spplot(temps_uk,"var1.pred", main="Universal kriging predictions
>
> However, when I take this step:
>
>> dem.ov=overlay(srtm,airtemp)
> Error in (function (classes, fdef, mtable)  :
>  unable to find an inherited method for function ?overlay? for signature
> ?"SpatialGridDataFrame", "SpatialPointsDataFrame"?

The overlay() method was retired long ago in favour of over(), and the 
order of the arguments was standardised. So over(airtemp, strm) should 
return the values of strm at the airtemp measuement points.

Roger

>
>> airtemp$srtm.dem=dem.ov$srtm  <====== this fails (see below)
>
>
>> vgm <- vgm(psill=8,model="Exp",range=600000,nugget=3.8)
>> vgm_temps_r<-fit.variogram(variogram(temp~srtm.dem,airtemp), model=vgm)
>> temps_uk<-krige(temp~srtm.dem,airtemp,srtm, vgm_temps_r)
>
>> airtemp$srtm.dem=srtm
> Error in `[[<-.data.frame`(`*tmp*`, name, value =
> new("SpatialGridDataFrame",  :
>  replacement has 72821592 rows, data has 267
>
> Any suggestions?
>
> Best,
> Tom
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Thu Jul 16 10:37:19 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 16 Jul 2020 10:37:19 +0200
Subject: [R-sig-Geo] 
 Unable to perform intersection operations with vectors
In-Reply-To: <CAGSstc_yKvY5M9wZzRTmoFScCP6DsBQqTtpWAhe6qERKQp4ZrA@mail.gmail.com>
References: <CAGSstc9jiEfsnYaWUxbEikNuou49Zt1Aw9HPBHEAyyXawKeTNg@mail.gmail.com>
 <alpine.LFD.2.23.451.2007141413050.313796@reclus.nhh.no>
 <CAGSstc_yKvY5M9wZzRTmoFScCP6DsBQqTtpWAhe6qERKQp4ZrA@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007161031100.351776@reclus.nhh.no>

On Wed, 15 Jul 2020, Coyo Tepe wrote:

> Dear Doctor Roger Bivand,
>
> First I have to say thank you for your quick response and secondly I
> am sorry for the confusion. I did not mean you to think I don?t trust
> your comments. Not at all, you are the reference in this matter..

OK, not a problem.

>
>
> I first sent an incomplete message and when I realized it I sent the
> complete one,  that?s why the message was sent twice and I did not
> read your reply before sending this second message.
>

I mis-understood this - you might have added a comment at the head of your 
post. Had I looked at 
https://stat.ethz.ch/pipermail/r-sig-geo/2020-July/thread.html, I would 
have seen that you were replying to yourself, not to my reply.

>
> Regarding your message, you are right, this is a warning, not an error
> and I agree with you that is much better to have warnings that
> problems at the end of the process and not knowing what could be
> wrong.
>
>
> I was not aware thae using the Proj4 strings should not be relied on
> and of course you are right about the comment with shapefile() call,
> this should not be part of the REPEX. Thanks also for the
> recommendation regarding the downgrading or R packages. I have read
> the links you shared regarding the GDAL and PROJ development and is
> more clear to me now.
>

Excellent! Now you and others following the thread have been alerted. What 
we do not know is which workflows will be affected - if we did, we could 
check and only warn those affected. So awareness of changes in 
sp::CRS/raster::crs/sf::st_crs will be needed to let users check whether 
their current workflows (written before the changes) are affected.

Roger

>
> Thank you!!  and again  I am really sorry for the misunderstanding,
>
> El mar., 14 jul. 2020 a las 6:36, Roger Bivand (<Roger.Bivand at nhh.no>) escribi?:
>>
>> On Mon, 13 Jul 2020, Coyo Tepe wrote:
>>
>>> Platform and versions
>>> Windows 64 bit
>>> R version 4.0.2 (2020-06-22) -- "Taking Off Again"
>>> Rstudio Version 1.3.959
>>> rgdal: 1.5-12 / gdal: 3.0.4
>>> rgeos version: 0.5-3, (SVN revision 634)
>>> GEOS runtime version: 3.8.0-CAPI-1.13.1
>>> Linking to sp version: 1.4-2
>>> Polygon checking: TRUE
>>>
>>> Problem
>>> We are trying to perform an intersection operation between two vector
>>> layers in shapefile format and we get an error:
>>>
>>> Warning message:
>>> In proj4string(x) : CRS object has comment, which is lost in output
>>
>> As I replied before (and I know with complete certainty, because I wrote
>> and maintain the code), this is a warning, not an error. You (no
>> affiliation, I have no idea what work/research you are doing) and
>> everybody else using R spatial software needs to be aware that Proj4
>> strings (the ones starting with "+proj=") are almost defunct and should
>> not be relied on. Hence the warning. If your workflow is affected by
>> degradation as described in
>> https://www.r-spatial.org/r/2020/03/17/wkt.html and
>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html,
>> you will suffer increased imprecision by about 150m.
>>
>> You should in principle trust information from package authors and
>> maintainers much more than random google search hits. I do not contribute
>> to stackoverflow, and while the answer you refer to does concern this
>> issue, it is basically wrong in saying that regular users do not need to
>> pay attention. I have noted why in that thread. Downgrading R/packages
>> makes absolutely no sense, and you should only consider installing old
>> versions of R and packages to reproduce old results.
>>
>> Again, you  are not seeing any errors in your example, only two warnings
>> in the released version of raster, which are (wrongly) suppressed in the
>> development version.
>>
>> Please demonstrate that anything here is an error, and show the output of
>> traceback in your case, which the reprex obviously does not capture. Your
>> reprex also contains totally irrelevant calls to raster::shapefile(),
>> which just writes the polygons to disk but are otherwise without effect.
>>
>> Roger
>>
>>>
>>> Below you can have a REPEX:
>>> ??
>>> library(rgdal)
>>> library(raster)
>>> library(rgeos)
>>>
>>> #layer a
>>> bbox_a<-c(497555,500000,137000,138000)
>>> extent_a<-extent(bbox_a)
>>> extent_a
>>> capa_a<-as(extent_a,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
>>> crs(capa_a)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
>>> crs(capa_a)
>>> shapefile(capa_a,paste("capa_a_re",sep="/"),overwrite=TRUE)
>>> plot(capa_a,col="green") #plot(capa_a,col="green")
>>>
>>> #layer b
>>> bbox_b<-c(497995,500050,137100,138100)
>>> extent_b<-extent(bbox_b)
>>> extent_b
>>> capa_b<-as(extent_b,'SpatialPolygons') #creamos un objeto tipo SpatialPolygons
>>> crs(capa_b)<- "+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs"
>>> crs(capa_b)
>>> shapefile(capa_b,paste("capa_b_re",sep="/"),overwrite=TRUE)
>>> plot(capa_b,add=T)
>>>
>>> #buffer
>>> b_buf<-buffer(capa_b,width=50)
>>> plot(b_buf,add=T) #plot(b_buf,add=T,col="blue")
>>>
>>> #intersect
>>> b_intersect<-intersect(capa_a,b_buf)
>>>
>>> #Warning messages:
>>> # 1: In proj4string(x) : CRS object has comment, which is lost in output
>>> # 2: In proj4string(y) : CRS object has comment, which is lost in output
>>>
>>> ???
>>>
>>> We have found in the following link:
>>>
>>> https://gis.stackexchange.com/questions/364667/r-4-0-1-not-sure-i-understand-this-message-warning-message-in-proj4stringx
>>>
>>> some comment about this problem: ?This is not related to R 4.0.1 but
>>> to rgdal 1.5-8 and the migration to gdal 3 and proj 6. This is a very
>>> long and complex process that impact hundreds maybe thouthands of
>>> packages. All the packages are not yet up-to-date with what is coming.
>>> As a regular user you do not need to pay too much attention on these
>>> warnings but should be aware of what is coming in the geospatial
>>> world.
>>>
>>> You can have a look to ?rgdal::set_thin_PROJ6_warnings() to eliminate
>>> those warnings.?
>>>
>>> However, this warning for us is a problem since it does not allow us
>>> to perform the intersection operation between the 2 layers.
>>>
>>> What we have tried is to pass our R and rgdal to a previous version
>>> (Version rgdal 1.4-8) and R version 3.6.1 (2019-07-05) - "Action of
>>> the Toes" but we would like to know if this is the way to go or there
>>> other options.
>>>
>>> Currently we have managed to get the 3.6.1 R version and but we have
>>> trouble passing to the Rgdal version 1.4-8, hoping that this version
>>> does not have these problems with the warning that we can not perform
>>> the operation of intersection.
>>>
>>> Regarding how to install an older rgdal version we found an interesting link
>>>
>>> (https://stackoverflow.com/questions/51749860/installing-rgdal-backdate-rgdal-version-versus-update-gdal-version-and-how)
>>> that explains how to do it with the following commands:
>>>
>>> require(devtools)
>>> install_version("rgdal", version="1.4-8")
>>> But we get the following error:
>>> ERROR: lazy loading failed for package 'rgdal'
>>> * removing 'C:/Users/pepe/Documents/R/win-library/3.6/rgdal'
>>> * restoring previous 'C:/Users/pepe/Documents/R/win-library/3.6/rgdal'
>>> Error: Failed to install 'unknown package' from URL:
>>>  (converted from warning) installation of
>>> package ?C:/Users/pepe /AppData/Local/Temp/RtmpqCxtfw/remotes26c7f616614/rgdal?
>>> had non-zero exit status
>>>
>>> Thank you for your help,
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From te@3rd @end|ng |rom gm@||@com  Thu Jul 16 14:03:09 2020
From: te@3rd @end|ng |rom gm@||@com (Thomas Adams)
Date: Thu, 16 Jul 2020 08:03:09 -0400
Subject: [R-sig-Geo] Help with universal kriging using gstat
In-Reply-To: <alpine.LFD.2.23.451.2007161012180.351776@reclus.nhh.no>
References: <CAGxgkWhpuOoTvMZtqk-OyjYOyXEXsCdmLhA2uJPfPH0vxAVYCw@mail.gmail.com>
 <alpine.LFD.2.23.451.2007161012180.351776@reclus.nhh.no>
Message-ID: <CAGxgkWg=pJ=cfEGNZ2bVox5XRaBR2JHvxWFK9MzGNhH+CfqUiw@mail.gmail.com>

Hi Roger,

Thank you... I finally figured out what I was doing wrong and have been
successful with gstat universal kriging. I will write-up the details for
others later today and plan to write a technical note of such for GRASS GIS
users, which I will submit there.

Best,
Tom

On Thu, Jul 16, 2020 at 4:15 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Wed, 15 Jul 2020, Thomas Adams wrote:
>
> > Hi all,
> >
> > It's been some time since I approached universal kriging using gstat (I
> > struggled with this previously, years ago:
> > https://stat.ethz.ch/pipermail/r-sig-geo/2006-May/001017.html).
> >
> > The problem...
> >
> > Within GRASS GIS, using R, I do this...
> >
> > (1) read a raster DEM into R from GRASS -- srtm <-
> > readRAST("mozambique_srtm_patch",cat=FALSE)
> > (2) read GRASS point data consisting of 4 fields (category, lon, lat,
> > temperature) -- airtemp <- readVECT("Mozambique_air_temp_2017_ann")
> > (3) so I have a SpatialGridDataFrame and SpatialPointsDataFrame,
> > respectively
> > (4) I can do the following: plot srtm, airtemp, generate an interpolated
> > grid of air temperatures with krige, using the airtemp
> > SpatialPointsDataFrame, and overlay the various data for visualization
> >
> > What I want to do is to use the srtm DEM data as a secondary trend
> variable
> > to spatially interpolate airtemp using universal kriging. I cannot figure
> > out how to construct the data sets and use krige in gstat to do this. I
> > have spent several days scouring the internet for an example (including
> > previous queries of my own, cited above) to no avail.
> >
> > It seems I should be able to do this, essentially:
> >
> > > dem<-read.asciigrid("gtopo30.dem")
> > > class(dem)
> > [1] "SpatialGridDataFrame"
> > attr(,"package")
> > [1] "sp"
> > > image(dem)
> > > points(Y ~ X, data=temps)
> > > class(temps)
> > [1] "data.frame"
> > > coordinates(temps)=~X+Y
> > > dem.ov=overlay(dem,temps)
> > > summary(dem.ov)
> >
> >> vgm <- vgm(psill=8,model="Exp",range=600000,nugget=3.8)
> > > vgm_temps_r<-fit.variogram(variogram(T~gtopo30.dem,temps), model=vgm)
> > > plot(variogram(T~gtopo30.dem,temps),main = "fitted by gstat")
> > > temps_uk<-krige(T~gtopo30.dem,temps,dem, vgm_temps_r)
> > [using universal kriging]
> > > library(lattice)
> > > trellis.par.set(sp.theme())
> > > spplot(temps_uk,"var1.pred", main="Universal kriging predictions
> >
> > However, when I take this step:
> >
> >> dem.ov=overlay(srtm,airtemp)
> > Error in (function (classes, fdef, mtable)  :
> >  unable to find an inherited method for function ?overlay? for signature
> > ?"SpatialGridDataFrame", "SpatialPointsDataFrame"?
>
> The overlay() method was retired long ago in favour of over(), and the
> order of the arguments was standardised. So over(airtemp, strm) should
> return the values of strm at the airtemp measuement points.
>
> Roger
>
> >
> >> airtemp$srtm.dem=dem.ov$srtm  <====== this fails (see below)
> >
> >
> >> vgm <- vgm(psill=8,model="Exp",range=600000,nugget=3.8)
> >> vgm_temps_r<-fit.variogram(variogram(temp~srtm.dem,airtemp), model=vgm)
> >> temps_uk<-krige(temp~srtm.dem,airtemp,srtm, vgm_temps_r)
> >
> >> airtemp$srtm.dem=srtm
> > Error in `[[<-.data.frame`(`*tmp*`, name, value =
> > new("SpatialGridDataFrame",  :
> >  replacement has 72821592 rows, data has 267
> >
> > Any suggestions?
> >
> > Best,
> > Tom
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en



-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Fri Jul 17 07:33:53 2020
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Fri, 17 Jul 2020 17:33:53 +1200
Subject: [R-sig-Geo] How set up spatstat::densityHeat()?
In-Reply-To: <CAEsi-R+Drtx6ZQLGgKPwx0MbUuhe36LMmUJjg96bRp7OfqiZvw@mail.gmail.com>
References: <CAEsi-R+Drtx6ZQLGgKPwx0MbUuhe36LMmUJjg96bRp7OfqiZvw@mail.gmail.com>
Message-ID: <eea5dcd9-39bc-76d8-9c2a-e98580692faa@auckland.ac.nz>


On 14/07/20 1:39 am, Michal Kvasni?ka wrote:

> Hello.
> 
> I have to find hotspots of road accidents. It seems that
> spatstat::densityHeat() implements McSwiggan et al. (2017) algorithm I want
> to use. I plan to follow path of DrHotNet package:
> 
> 1. estimate the density function
> 2. lixelize the network
> 3. calculate the density in the middle point of each lixel from (2) using
> function estimated in (1)
> 4. find clusters of lixels from (3) with sufficiently high density
> 
> However, I don't know how to set the function's parameters.
> 
> I cannot use the implicit setting (finespacing=TRUE) because it suggests
> tens of billions iterations. (I use OSM road maps of Czech districts
> converted to Krovak projection. My testing district has about 2,700 km of
> roads with an average length of road segments of about 30 meters due to
> road curvatures. This is not the largest district I have to handle---Prague
> is much larger.)
> 
> I can set finespacing = FALSE and then finetune the parameters myself.
> However, I can't find any documentation. Having skimmed the source code,
> I'm trying something like this:
> 
> density_function <- densityHeat(accident_lpp, sigma, finespacing = FALSE,
> eps = 10, fun = TRUE)
> 
> This way I get the function I need. However, I'm not certain what I'm
> doing. It seems that the densityHeat() uses some grid, based on lixelized
> network. My questions are:
> 
> * Is it sufficient to set the eps parameter or do I need to set other
> parameters too? Which ones?
> * Is the parameter in meters (my map is projected with meters as its units)?
> * If eps = 10 means grid of 10x10 meters, what precisely does it mean? How
> is the network lixelized (and why)? How does it affect the estimated
> function (not the linim object)?
> * What is the (economically/substantially) reasonable value of eps (and
> other necessary parameters)?
> * Is there any documentation to the function? (I've read chapter 17 of the
> spatstat book but found nothing there. The function help page doesn't cover
> this either.)
> * Does it any difference if I lixelize the network myself before running
> densityHeat()?
> 
> Many thanks for your advice. (And an apology for such a long question.)
> 
> Best wishes,
> *Ing. Michal Kvasni?ka, Ph.D.*

Dear Michal,

I am replying on behalf of the spatstat authors (and not claiming any 
personal competence in the area of point processes on networks).

My co-authors suggest that you:

    * upgrade to the latest development version of spatstat.  You
      could use

      > remotes::install_github("spatstat/spatstat",lib=.Rlib)

      to do this,

    * look at help(densityHeat), in particular the
      section "Discretisation and Error Messages" which explains
      how the discretisation is performed,

    * use densityfun.lpp instead of density.lpp if you want a
      function rather than a pixel image.

Note that if finespacing=FALSE is selected, the discretisation is 
determined by the default pixel resolution of the window containing the 
network. The arguments eps and dimyx would be passed to as.mask to 
determine pixel resolution in the usual way (their interpretation is 
explained in the help for as.mask()).

Note also that density.lpp() calls densityHeat() which calls the 
internal algorithm. Similarly densityfun.lpp() calls the same internal 
algorithm. Consequently they all handle discretisation arguments the 
same way.

The spatstat authors know nothing about the package DrHotNet and do not 
necessarily endorse whatever they are doing. Definitely *do not* 
'lixellate' (discretise) the network before applying density(), because 
this will screw up the discretisation procedure.

We are very sceptical about the validity of applying clustering to the 
elements of the discretisation.

HTH

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz  Fri Jul 17 11:04:10 2020
From: M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz (=?UTF-8?Q?Michal_Kvasni=C4=8Dka?=)
Date: Fri, 17 Jul 2020 11:04:10 +0200
Subject: [R-sig-Geo] How set up spatstat::densityHeat()?
In-Reply-To: <eea5dcd9-39bc-76d8-9c2a-e98580692faa@auckland.ac.nz>
References: <CAEsi-R+Drtx6ZQLGgKPwx0MbUuhe36LMmUJjg96bRp7OfqiZvw@mail.gmail.com>
 <eea5dcd9-39bc-76d8-9c2a-e98580692faa@auckland.ac.nz>
Message-ID: <CAEsi-RKnJjkmpXf62Px0+4_0qkrG6ZsxusZF6hbaGH_R20iRSw@mail.gmail.com>

Dear Rolf.

Thanks a lot for the suggestions! I'll check it out.

Best wishes to you and all spatstat team,
*Ing. Michal Kvasni?ka, Ph.D.*



*Masaryk University | School of Economics and Administration*
Department of Economics
A: Lipov? 41a | 602 00 Brno
E: michal.kvasnicka at econ.muni.cz | W: www.econ.muni.cz/~qasar


p? 17. 7. 2020 v 7:34 odes?latel Rolf Turner <r.turner at auckland.ac.nz>
napsal:

>
> On 14/07/20 1:39 am, Michal Kvasni?ka wrote:
>
> > Hello.
> >
> > I have to find hotspots of road accidents. It seems that
> > spatstat::densityHeat() implements McSwiggan et al. (2017) algorithm I
> want
> > to use. I plan to follow path of DrHotNet package:
> >
> > 1. estimate the density function
> > 2. lixelize the network
> > 3. calculate the density in the middle point of each lixel from (2) using
> > function estimated in (1)
> > 4. find clusters of lixels from (3) with sufficiently high density
> >
> > However, I don't know how to set the function's parameters.
> >
> > I cannot use the implicit setting (finespacing=TRUE) because it suggests
> > tens of billions iterations. (I use OSM road maps of Czech districts
> > converted to Krovak projection. My testing district has about 2,700 km of
> > roads with an average length of road segments of about 30 meters due to
> > road curvatures. This is not the largest district I have to
> handle---Prague
> > is much larger.)
> >
> > I can set finespacing = FALSE and then finetune the parameters myself.
> > However, I can't find any documentation. Having skimmed the source code,
> > I'm trying something like this:
> >
> > density_function <- densityHeat(accident_lpp, sigma, finespacing = FALSE,
> > eps = 10, fun = TRUE)
> >
> > This way I get the function I need. However, I'm not certain what I'm
> > doing. It seems that the densityHeat() uses some grid, based on lixelized
> > network. My questions are:
> >
> > * Is it sufficient to set the eps parameter or do I need to set other
> > parameters too? Which ones?
> > * Is the parameter in meters (my map is projected with meters as its
> units)?
> > * If eps = 10 means grid of 10x10 meters, what precisely does it mean?
> How
> > is the network lixelized (and why)? How does it affect the estimated
> > function (not the linim object)?
> > * What is the (economically/substantially) reasonable value of eps (and
> > other necessary parameters)?
> > * Is there any documentation to the function? (I've read chapter 17 of
> the
> > spatstat book but found nothing there. The function help page doesn't
> cover
> > this either.)
> > * Does it any difference if I lixelize the network myself before running
> > densityHeat()?
> >
> > Many thanks for your advice. (And an apology for such a long question.)
> >
> > Best wishes,
> > *Ing. Michal Kvasni?ka, Ph.D.*
>
> Dear Michal,
>
> I am replying on behalf of the spatstat authors (and not claiming any
> personal competence in the area of point processes on networks).
>
> My co-authors suggest that you:
>
>     * upgrade to the latest development version of spatstat.  You
>       could use
>
>       > remotes::install_github("spatstat/spatstat",lib=.Rlib)
>
>       to do this,
>
>     * look at help(densityHeat), in particular the
>       section "Discretisation and Error Messages" which explains
>       how the discretisation is performed,
>
>     * use densityfun.lpp instead of density.lpp if you want a
>       function rather than a pixel image.
>
> Note that if finespacing=FALSE is selected, the discretisation is
> determined by the default pixel resolution of the window containing the
> network. The arguments eps and dimyx would be passed to as.mask to
> determine pixel resolution in the usual way (their interpretation is
> explained in the help for as.mask()).
>
> Note also that density.lpp() calls densityHeat() which calls the
> internal algorithm. Similarly densityfun.lpp() calls the same internal
> algorithm. Consequently they all handle discretisation arguments the
> same way.
>
> The spatstat authors know nothing about the package DrHotNet and do not
> necessarily endorse whatever they are doing. Definitely *do not*
> 'lixellate' (discretise) the network before applying density(), because
> this will screw up the discretisation procedure.
>
> We are very sceptical about the validity of applying clustering to the
> elements of the discretisation.
>
> HTH
>
> cheers,
>
> Rolf Turner
>
> --
> Honorary Research Fellow
> Department of Statistics
> University of Auckland
> Phone: +64-9-373-7599 ext. 88276
>

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sat Jul 18 00:58:41 2020
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sat, 18 Jul 2020 10:58:41 +1200
Subject: [R-sig-Geo] How set up spatstat::densityHeat()?
In-Reply-To: <CAEsi-RKnJjkmpXf62Px0+4_0qkrG6ZsxusZF6hbaGH_R20iRSw@mail.gmail.com>
References: <CAEsi-R+Drtx6ZQLGgKPwx0MbUuhe36LMmUJjg96bRp7OfqiZvw@mail.gmail.com>
 <eea5dcd9-39bc-76d8-9c2a-e98580692faa@auckland.ac.nz>
 <CAEsi-RKnJjkmpXf62Px0+4_0qkrG6ZsxusZF6hbaGH_R20iRSw@mail.gmail.com>
Message-ID: <f309e869-86fd-aef9-6f49-5153988316a9@auckland.ac.nz>


On 17/07/20 9:04 pm, Michal Kvasni?ka wrote:

> Dear Rolf.
> 
> Thanks a lot for the suggestions! I'll check it out.
> 
> Best wishes to you and all spatstat team,
> *Ing. Michal Kvasni?ka, Ph.D.*


Good luck with your endeavours.  I'd like to point out a slight glitch 
in the advice that I proffered, explicitly my suggestion that you use

     remotes::install_github("spatstat/spatstat",lib=.Rlib)

to install the latest version of spatstat.  The code above was copied 
and pasted from my .Rhistory and I neglected to  change the "lib=.Rlib", 
which is peculiar to my personal R set-up.

You should replace ".Rlib" with a text string specifying the library 
where you keep the packages that you install.

Apologies for any confusion that may have resulted.

cheers,

Rolf

<SNIP>

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From Geo||rey@R@w||ng @end|ng |rom nmt@edu  Mon Jul 20 20:53:42 2020
From: Geo||rey@R@w||ng @end|ng |rom nmt@edu (Rawling, Geoffrey)
Date: Mon, 20 Jul 2020 12:53:42 -0600
Subject: [R-sig-Geo] question about interpreting timelag in output of
 variogramST
Message-ID: <CAOBZqnh8Rpi=ygP8Zw2tYy2Vj1mFXwp5HFhg-UKsU=03RebXYA@mail.gmail.com>

Hello all

I have done quite a bit of searching including in the archives of this list
and I cannot find an answer to this question. The script below calculates a
sample spacetime variogram from water levels measured in wells over about
40 years. The variogram plots look fine but I dont understand the values in
the timelag field of the output, it comes out as decimals, with a max value
of 0.52. If I have formatted the input data correctly shouldn't the time
lags be counted in months as the time values of the data points are "month
year", just as the lags for the spatial coordinates are in meters?

Do the decimal values in the timefield of the variogram ST output mean the
time lag as a fraction of the entire time series of data?

I have also formatted the input data as the full date of measurement,
including the day, the time lags then result in days (I think) but with a
maximum of about 190. But the total time series of data spans about 40
years. I would like to use the temporal data spanning a couple of tens of
years to inform the sample variogram. I have tried various values for the
tlags parameter in variogram ST but that has only furthered my confusion.

I am probably missing something obvious about how variogramST works and/or
how to format the temporal data correctly for input to the function.

Any advice is appreciated.

Geoff Rawling

dropbox link to two csv files for script
https://www.dropbox.com/s/w2vcelj4sr5d779/doi_wells.zip?dl=0


# script to calculate experimental spacetime variogram

library(sp)
library(spacetime)
library(gstat)
library(rgdal)

library(ggplot2)
library(xts)

# read in data of interest, doi

#read in data comma separated text files of well locs and wls
doi = read.table("doi.csv", header = TRUE, sep = ",",  stringsAsFactors =
FALSE)

wells = read.table("wells.csv", header = TRUE, sep = ",",  stringsAsFactors
= FALSE)

# basic heat map of wl meas pts thru time

d <- ggplot(doi, aes(mnth_ct, Well_SID )) +
scale_fill_gradient(low="black", high="red")

d + geom_bin2d(binwidth = c(3, 1))

# simplify to create index matrix for input STSDF, each unique well site
gets a number, each unique time of meas gets a number
# n x 2 matrix, each row is a wl meas, 1st column is well site number,
second column is meas time number

index <- as.matrix(doi[,c("Well_SID","T_SID")])

# sort the well locs by increasing  x, then y

wells <- wells[order(wells$LCC_East, wells$LCC_North),]

# plot to check data locations, symbolize w well id
ggplot(doi, aes(LCC_East,LCC_North)) + geom_point()
ggplot(doi, aes(LCC_East,LCC_North)) + geom_text(aes(label=Well_SID))

rownames(wells) <- wells[,1]
wells <- wells[,c(2,3)]


wells = SpatialPoints(wells, proj4string=CRS("+proj=lcc +lat_0=0
+lon_0=-106 +lat_1=33 +lat_2=45 +x_0=0 +y_0=0 +datum=WGS84 +units=m
+no_defs "))

# time of water level measurements
# DateL is from lubridate

time <- as.Date(doi[,"DateL"])

# simplify time to month and year
timeYM <- as.yearmon(time)
str(timeYM)
summary(timeYM)


# PCA trend surface residuals at spatial points and time of measurement

tsr <- doi[,c("PCA.tsR","Point_ID")]

# make spacetime object STSDF

# STSDF(sp, time, data, index, endTime = delta(time))
SO <- STSDF(wells, time, tsr, index)

timeSO <- SO at time
str(timeSO)
str(SO)


# calc exp st variogram

exp_st_vgm <- variogramST(PCA.tsR~1, SO, width = 2000, cutoff = 20000,
assumeRegular=FALSE, na.omit = TRUE)

plot(exp_st_vgm)# plot variograms
plot(exp_st_vgm, wireframe = T) # plot variograms
plot(exp_st_vgm, map=F) # plot variograms

-- 
*********************************************

Geoffrey Rawling

Senior Field Geologist
NM Bureau of Geology and Mineral Resources

Geoffrey.Rawling at nmt.edu

1015 Tijeras Avenue NW, Suite 200
Albuquerque, NM, 87102

505-366-2535 phone
505-999-8307 cell

*********************************************

	[[alternative HTML version deleted]]


From M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz  Tue Jul 21 16:08:18 2020
From: M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz (=?UTF-8?Q?Michal_Kvasni=C4=8Dka?=)
Date: Tue, 21 Jul 2020 16:08:18 +0200
Subject: [R-sig-Geo] 
 Warning message: In showSRID(uprojargs, format = "PROJ",
 multiline = "NO")?
Message-ID: <CAEsi-RL4HfFXV=4vH_-P6vF1i-tMEPxYF0Y4Vw-n1w6bnKiHBA@mail.gmail.com>

Hello.

I have a sfc_MULTILINESTRING object called zz. It is in CRS EPSG:5514
("S-JTSK / Krovak East North"). When I convert it to sp via as(zz,
"Spatial"), I get the following warning:

Warning message:
In showSRID(uprojargs, format = "PROJ", multiline = "NO") :
  Discarded datum Unknown based on Bessel 1841 ellipsoid in CRS definition,
 but +towgs84= values preserved

Could you help me understand what does this mean and whether it is serious?

I use:
R version 4.0.2 (2020-06-22)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04 LTS
sf 0.9-5
sp 1.4-2
rgdal 1.5-12
rgeos 0.5-3
gdal 3.0.4
geos 3.8.0

Many thanks for your help.

Best wishes,
*Ing. Michal Kvasni?ka, Ph.D.*



*Masaryk University | School of Economics and Administration*
Department of Economics
A: Lipov? 41a | 602 00 Brno
E: michal.kvasnicka at econ.muni.cz | W: www.econ.muni.cz/~qasar

	[[alternative HTML version deleted]]


From M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz  Tue Jul 21 16:23:01 2020
From: M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz (=?UTF-8?Q?Michal_Kvasni=C4=8Dka?=)
Date: Tue, 21 Jul 2020 16:23:01 +0200
Subject: [R-sig-Geo] How best simplify a road network?
Message-ID: <CAEsi-R+itcEkZMR1HtKeb-oXMb0gQamYgpspkm4-JkrB+mkYJw@mail.gmail.com>

Hello.

I need to read the OSM map into R and convert it to spatstat linnet class.
In the process, I need to simplify the graph so that no edge is shorter
than several meters. At the same time, the network graph topology must
remain the same, i.e. the crossroads must be kept as they are.

So far, I've proceeded this way: 1) I use the map packed by geofabric.de,
2) I read it with sf::st_read(), 3) transform its CRS to Krovak projection
with st_transform(), and 4) simplify it with

roads %>%
    st_union()
    st_simplify(preserveTopology = TRUE, dTolerance = 20)

My questions:
1. Does st_simplify() the work, i.e. does it keep the crossroads?
2. Is st_union() in front of it necessary?
3. Isn't there a better way? st_simplify() still leaves some very short
(about 1 mm long) edges in the graph. (If necessary, crossroads, i.e.
vertices with more than two edges, can be moved and joined if they are
close to each other and connected with an edge, since all such vertices
closer than several meters may represent a bug in the map anyway. At least,
I guess so.)

One extra question: I going through geofabric.de, sf, sp, and
spatstat::as.linnet() safe?

Many thanks for your kind help.

Best wishes,
*Ing. Michal Kvasni?ka, Ph.D.*



*Masaryk University | School of Economics and Administration*
Department of Economics
A: Lipov? 41a | 602 00 Brno
E: michal.kvasnicka at econ.muni.cz | W: www.econ.muni.cz/~qasar

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Jul 21 17:32:15 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 21 Jul 2020 15:32:15 +0000
Subject: [R-sig-Geo] 
 Warning message: In showSRID(uprojargs, format = "PROJ",
 multiline = "NO")?
Message-ID: <AM4PR05MB33163424D81F4244E51771BFAC780@AM4PR05MB3316.eurprd05.prod.outlook.com>

It depends on your software and workflow. If you check the versions of PROJ and GDAL with rgdal::extSoftVersion(), you will probably find > 5 and > 2. If you then take sp::wkt() of the sp object, you should see a correct WKT2 representation of the CRS. Packages using this should not show degradation, but those only using the Proj4 string may show degradation. See https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html and
https://www.r-spatial.org/r/2020/03/17/wkt.html for details.

-------
Roger Bivand
Norwegian School of Economics, Bergen, Norway
roger.bivand at nhh.no

________________________________
Fra: R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Michal Kvasni?ka <michal.kvasnicka at econ.muni.cz>
Sendt: tirsdag 21. juli 2020, 16:08
Til: r-sig-geo at r-project.org
Emne: [R-sig-Geo] Warning message: In showSRID(uprojargs, format = "PROJ", multiline = "NO")?

Hello. I have a sfc_MULTILINESTRING object called zz. It is in CRS EPSG:5514 ("S-JTSK / Krovak East North"). When I convert it to sp via as(zz, "Spatial"), I get the following warning: Warning message: In showSRID(uprojargs, format = "PROJ", multiline = "NO") : Discarded datum Unknown based on Bessel 1841 ellipsoid in CRS definition, but +towgs84= values preserved Could you help me understand what does this mean and whether it is serious? I use: R version 4.0.2 (2020-06-22) Platform: x86_64-pc-linux-gnu (64-bit) Running under: Ubuntu 20.04 LTS sf 0.9-5 sp 1.4-2 rgdal 1.5-12 rgeos 0.5-3 gdal 3.0.4 geos 3.8.0 Many thanks for your help. Best wishes, *Ing. Michal Kvasni?ka, Ph.D.* *Masaryk University | School of Economics and Administration* Department of Economics A: Lipov? 41a | 602 00 Brno E: michal.kvasnicka at econ.muni.cz | W: www.econ.muni.cz/~qasar [[alternative HTML version deleted]] _______________________________________________ R-sig-Geo mailing list R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From peter@pe@rm@n @end|ng |rom ehu@e@  Wed Jul 22 12:09:14 2020
From: peter@pe@rm@n @end|ng |rom ehu@e@ (Peter B. Pearman)
Date: Wed, 22 Jul 2020 12:09:14 +0200
Subject: [R-sig-Geo] eigenvectors increase spatial autocorrelation in ols
 regression
Message-ID: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200722/377f62fe/attachment.html>

From M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz  Wed Jul 22 12:14:43 2020
From: M|ch@|@Kv@@n|ck@ @end|ng |rom econ@mun|@cz (=?UTF-8?Q?Michal_Kvasni=C4=8Dka?=)
Date: Wed, 22 Jul 2020 12:14:43 +0200
Subject: [R-sig-Geo] 
 Warning message: In showSRID(uprojargs, format = "PROJ",
 multiline = "NO")?
In-Reply-To: <AM4PR05MB33163424D81F4244E51771BFAC780@AM4PR05MB3316.eurprd05.prod.outlook.com>
References: <AM4PR05MB33163424D81F4244E51771BFAC780@AM4PR05MB3316.eurprd05.prod.outlook.com>
Message-ID: <CAEsi-RKZNa2xbw0L9jLeC1fjnoO7+dgxbmDg1m+3A=dga-royg@mail.gmail.com>

Hello.

Many thanks for your reply. I tried to read the two papers you suggested,
but I can't say I do understand them very well (I'm an economist, not a
geographer).

Do I understand it correctly that when I use just EPSG numbers and stay
away from proj4 string, and have up-to-date SW, I'd be safe?

I transform CRS with sf::st_transform(crs = 5514).

rgdal::rgdal_extSoftVersion() returns on my computers:
          GDAL GDAL_with_GEOS           PROJ             sp
       "3.0.4"         "TRUE"        "6.3.1"        "1.4-2"

rgdal::sp::wkt(sp) returns the same WKT as sf::st_crs(sf), where sf is the
original object and sp <- as(sf, "Spatial").

Are these sufficient tests sufficient to say I'm o.k.? Many thanks once
more for your time.

Best wishes,
*Ing. Michal Kvasni?ka, Ph.D.*



*Masaryk University | School of Economics and Administration*
Department of Economics
A: Lipov? 41a | 602 00 Brno
E: michal.kvasnicka at econ.muni.cz | W: www.econ.muni.cz/~qasar


?t 21. 7. 2020 v 17:32 odes?latel Roger Bivand <Roger.Bivand at nhh.no> napsal:

> It depends on your software and workflow. If you check the versions of
> PROJ and GDAL with rgdal::extSoftVersion(), you will probably find > 5 and
> > 2. If you then take sp::wkt() of the sp object, you should see a correct
> WKT2 representation of the CRS. Packages using this should not show
> degradation, but those only using the Proj4 string may show degradation.
> See
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>  and
> https://www.r-spatial.org/r/2020/03/17/wkt.html for details.
>
> -------
> Roger Bivand
> Norwegian School of Economics, Bergen, Norway
> roger.bivand at nhh.no
>
> ------------------------------
> *Fra:* R-sig-Geo <r-sig-geo-bounces at r-project.org> p? vegne av Michal
> Kvasni?ka <michal.kvasnicka at econ.muni.cz>
> *Sendt:* tirsdag 21. juli 2020, 16:08
> *Til:* r-sig-geo at r-project.org
> *Emne:* [R-sig-Geo] Warning message: In showSRID(uprojargs, format =
> "PROJ", multiline = "NO")?
>
> Hello. I have a sfc_MULTILINESTRING object called zz. It is in CRS
> EPSG:5514 ("S-JTSK / Krovak East North"). When I convert it to sp via
> as(zz, "Spatial"), I get the following warning: Warning message: In
> showSRID(uprojargs, format = "PROJ", multiline = "NO") : Discarded datum
> Unknown based on Bessel 1841 ellipsoid in CRS definition, but +towgs84=
> values preserved Could you help me understand what does this mean and
> whether it is serious? I use: R version 4.0.2 (2020-06-22) Platform:
> x86_64-pc-linux-gnu (64-bit) Running under: Ubuntu 20.04 LTS sf 0.9-5 sp
> 1.4-2 rgdal 1.5-12 rgeos 0.5-3 gdal 3.0.4 geos 3.8.0 Many thanks for your
> help. Best wishes, *Ing. Michal Kvasni?ka, Ph.D.* *Masaryk University |
> School of Economics and Administration* Department of Economics A: Lipov?
> 41a | 602 00 Brno E: michal.kvasnicka at econ.muni.cz | W:
> www.econ.muni.cz/~qasar [[alternative HTML version deleted]]
> _______________________________________________ R-sig-Geo mailing list
> R-sig-Geo at r-project.org https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From @pencer@gr@ve@ @end|ng |rom prod@y@e@com  Wed Jul 22 16:45:15 2020
From: @pencer@gr@ve@ @end|ng |rom prod@y@e@com (Spencer Graves)
Date: Wed, 22 Jul 2020 09:45:15 -0500
Subject: [R-sig-Geo] 
 eigenvectors increase spatial autocorrelation in ols regression
In-Reply-To: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>
References: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>
Message-ID: <dc16fedf-7b97-9371-a1c8-2b2490f67a44@prodsyse.com>

 ????? Have you considered the "corSpher" and "corSpatial" functions in 
the nlme package?


 ????? Spencer Graves


On 2020-07-22 05:09, Peter B. Pearman wrote:
>
> Dear Roger and list members,
>
> I have a ols regression and want to remove spatial autocorrelation 
> (SAC) from the residuals, in order to avoid its potential effects of 
> SAC on the hypothesis tests (and the reviewers/editor).? I have 
> generated spatial eigenvectors with SpatialFiltering(), and added the 
> generated vectors to the regression.? Surprisingly, SAC appears to 
> become more pronounced.? I also tried ME(), but many more vectors are 
> produced and SAC is also not removed.? Isn't including the vectors 
> from SpatialFiltering() supposed to reduce SAC?
>
> Can you please enlighten me as to what's going on, what I am doing 
> wrong, or what I should try?
>
> Thanks in advance for you time.
>
> Peter
>
> The data are here:
>
> https://drive.google.com/file/d/1Z3FIGIAbYvXqGETn0EWLjTOY8MYpZi_S/view?usp=sharing
>
> The analysis goes like this:
>
> library(spatialreg)
> library(spdep)
> library(tidyverse)
> library(car)
> library(ncf)
>
>
> data <- read_csv("for_RAR.csv")
> set.seed(12345)
> x <- data$ses.mntd
> y <- log(data$RAR)
> ols_for_RAR <- lm(y ~ x)
> ## qqplot() and shapiro.test() show residuals are nicely distributed
> # x is significant and R-square about 0.2, demonstrated here
> car::Anova(ols_for_RAR,type="III")
> summary(ols_for_RAR)
>
> # the following appears to make an acceptable neighbor network
> c1<-c(data$LONG)
> c2<-c(data$LAT)
> cbindForests<-cbind(c1,c2)
> # a value of 0.7, below, is sufficient to join all the points.
> # qualitatively the results aren't affected, as far as I see by 
> setting this higher
> # However, the number of eigenvectors generated by SpatialFiltering() 
> varies a lot
> nbnear4 <- dnearneigh(cbindForests, 0, 0.7)
> plot(nbnear4, cbindForests, col = "red", pch = 20)
>
> # SAC appears significant at short distances (<10km), which is what I 
> want to remove
> cor_for <- correlog(c1, c2, residuals(ols_for_RAR), increment = 1, 
> resamp = 1000, latlon=TRUE, na.rm = TRUE)
> plot(cor_for$correlation[1:20],type="s")
> # p-values
> print(cor_for$p[which(cor_for$p < 0.05)])
> # Moran's I values
> cor_for$correlation[which(cor_for$p < 0.05)]
>
> # Generate optimized spatial eigenvectors using SpatialFiltering() and 
> use them
> # Several vectors are generated depending on values in dnearneigh()
> spfilt_mntd_RAR<- spatialreg::SpatialFiltering(y ~ x, nb=nbnear4,style 
> = "W", tol=0.0001, ExactEV = TRUE)
> new_mod <- lm(y ~ x + fitted(spfilt_mntd_RAR))
> car::Anova(new_mod, type="III")
> summary(new_mod)
>
> # Plot Moran's I at distances under 20km
> cor_for_1c <- correlog(c1, c2, residuals(new_mod), increment = 1, 
> resamp = 1000, latlon=TRUE, na.rm = TRUE)
> plot(cor_for_1c$correlation[1:20],type="s")
>
> # Extract significant values of Moran's I
> cor_for_1c$p[which(cor_for_1c$p < 0.05)]
> cor_for_1c$correlation[which(cor_for_1c$p < 0.05)]
>
> # The result is that Moran's I is significant at additional short 
> distances
> -- 
>
> _+_+_+_+_+_+_+_+_
>
> Peter B. Pearman
> Ikerbasque Research Professor
>
> Laboratory for Computational Ecology and Evolution
> Departamento de Biolog?a Vegetal y Ecolog?a
> Facultad de Ciencias y Tecnolog?a
> Ap. 644
> Universidad del Pa?s Vasco/ Euskal Herriko Unibertsitatea
>
> Barrio Sarriena s/n
> 48940 Leioa, Bizkaia
>
> SPAIN
>
> Tel. +34 94 601 8030
>
> Fax? +34 94 601 3500
>
> www.ehu.eus/es/web/bgppermp <http://www.ehu.es/peter.pearman>
>
> When you believe in things that you don?t understand
>
> Then you suffer
>
> -- Stevie Wonder
>
>
> Download my public encryption key here: https://pgp.mit.edu/
>
> and please use it when you send me e-mail.
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From v|n|c|u@@@@m@|@77 @end|ng |rom gm@||@com  Thu Jul 23 03:13:04 2020
From: v|n|c|u@@@@m@|@77 @end|ng |rom gm@||@com (Vinicius Maia)
Date: Wed, 22 Jul 2020 22:13:04 -0300
Subject: [R-sig-Geo] 
 eigenvectors increase spatial autocorrelation in ols regression
In-Reply-To: <dc16fedf-7b97-9371-a1c8-2b2490f67a44@prodsyse.com>
References: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>
 <dc16fedf-7b97-9371-a1c8-2b2490f67a44@prodsyse.com>
Message-ID: <CAMXcYmZyODVHSH6zFyhF3qDtHxUcGh79T=hmh30Y4FR17CZiZg@mail.gmail.com>

It is worth sending this question to r-sig-mixed-models at r-project.org.



Em qua., 22 de jul. de 2020 ?s 11:45, Spencer Graves <
spencer.graves at prodsyse.com> escreveu:

>        Have you considered the "corSpher" and "corSpatial" functions in
> the nlme package?
>
>
>        Spencer Graves
>
>
> On 2020-07-22 05:09, Peter B. Pearman wrote:
> >
> > Dear Roger and list members,
> >
> > I have a ols regression and want to remove spatial autocorrelation
> > (SAC) from the residuals, in order to avoid its potential effects of
> > SAC on the hypothesis tests (and the reviewers/editor).  I have
> > generated spatial eigenvectors with SpatialFiltering(), and added the
> > generated vectors to the regression.  Surprisingly, SAC appears to
> > become more pronounced.  I also tried ME(), but many more vectors are
> > produced and SAC is also not removed.  Isn't including the vectors
> > from SpatialFiltering() supposed to reduce SAC?
> >
> > Can you please enlighten me as to what's going on, what I am doing
> > wrong, or what I should try?
> >
> > Thanks in advance for you time.
> >
> > Peter
> >
> > The data are here:
> >
> >
> https://drive.google.com/file/d/1Z3FIGIAbYvXqGETn0EWLjTOY8MYpZi_S/view?usp=sharing
> >
> > The analysis goes like this:
> >
> > library(spatialreg)
> > library(spdep)
> > library(tidyverse)
> > library(car)
> > library(ncf)
> >
> >
> > data <- read_csv("for_RAR.csv")
> > set.seed(12345)
> > x <- data$ses.mntd
> > y <- log(data$RAR)
> > ols_for_RAR <- lm(y ~ x)
> > ## qqplot() and shapiro.test() show residuals are nicely distributed
> > # x is significant and R-square about 0.2, demonstrated here
> > car::Anova(ols_for_RAR,type="III")
> > summary(ols_for_RAR)
> >
> > # the following appears to make an acceptable neighbor network
> > c1<-c(data$LONG)
> > c2<-c(data$LAT)
> > cbindForests<-cbind(c1,c2)
> > # a value of 0.7, below, is sufficient to join all the points.
> > # qualitatively the results aren't affected, as far as I see by
> > setting this higher
> > # However, the number of eigenvectors generated by SpatialFiltering()
> > varies a lot
> > nbnear4 <- dnearneigh(cbindForests, 0, 0.7)
> > plot(nbnear4, cbindForests, col = "red", pch = 20)
> >
> > # SAC appears significant at short distances (<10km), which is what I
> > want to remove
> > cor_for <- correlog(c1, c2, residuals(ols_for_RAR), increment = 1,
> > resamp = 1000, latlon=TRUE, na.rm = TRUE)
> > plot(cor_for$correlation[1:20],type="s")
> > # p-values
> > print(cor_for$p[which(cor_for$p < 0.05)])
> > # Moran's I values
> > cor_for$correlation[which(cor_for$p < 0.05)]
> >
> > # Generate optimized spatial eigenvectors using SpatialFiltering() and
> > use them
> > # Several vectors are generated depending on values in dnearneigh()
> > spfilt_mntd_RAR<- spatialreg::SpatialFiltering(y ~ x, nb=nbnear4,style
> > = "W", tol=0.0001, ExactEV = TRUE)
> > new_mod <- lm(y ~ x + fitted(spfilt_mntd_RAR))
> > car::Anova(new_mod, type="III")
> > summary(new_mod)
> >
> > # Plot Moran's I at distances under 20km
> > cor_for_1c <- correlog(c1, c2, residuals(new_mod), increment = 1,
> > resamp = 1000, latlon=TRUE, na.rm = TRUE)
> > plot(cor_for_1c$correlation[1:20],type="s")
> >
> > # Extract significant values of Moran's I
> > cor_for_1c$p[which(cor_for_1c$p < 0.05)]
> > cor_for_1c$correlation[which(cor_for_1c$p < 0.05)]
> >
> > # The result is that Moran's I is significant at additional short
> > distances
> > --
> >
> > _+_+_+_+_+_+_+_+_
> >
> > Peter B. Pearman
> > Ikerbasque Research Professor
> >
> > Laboratory for Computational Ecology and Evolution
> > Departamento de Biolog?a Vegetal y Ecolog?a
> > Facultad de Ciencias y Tecnolog?a
> > Ap. 644
> > Universidad del Pa?s Vasco/ Euskal Herriko Unibertsitatea
> >
> > Barrio Sarriena s/n
> > 48940 Leioa, Bizkaia
> >
> > SPAIN
> >
> > Tel. +34 94 601 8030
> >
> > Fax  +34 94 601 3500
> >
> > www.ehu.eus/es/web/bgppermp <http://www.ehu.es/peter.pearman>
> >
> > When you believe in things that you don?t understand
> >
> > Then you suffer
> >
> > -- Stevie Wonder
> >
> >
> > Download my public encryption key here: https://pgp.mit.edu/
> >
> > and please use it when you send me e-mail.
> >
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Thu Jul 23 18:52:27 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 23 Jul 2020 18:52:27 +0200
Subject: [R-sig-Geo] 
 eigenvectors increase spatial autocorrelation in ols regression
In-Reply-To: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>
References: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>
Message-ID: <alpine.LFD.2.23.451.2007231754460.450674@reclus.nhh.no>

On Wed, 22 Jul 2020, Peter B. Pearman wrote:

> 
> Dear Roger and list members,
> 
> I have a ols regression and want to remove spatial autocorrelation (SAC) 
> from the residuals, in order to avoid its potential effects of SAC on 
> the hypothesis tests (and the reviewers/editor).  I have generated 
> spatial eigenvectors with SpatialFiltering(), and added the generated 
> vectors to the regression.  Surprisingly, SAC appears to become more 
> pronounced.  I also tried ME(), but many more vectors are produced and 
> SAC is also not removed. Isn't including the vectors from 
> SpatialFiltering() supposed to reduce SAC?
> 
> Can you please enlighten me as to what's going on, what I am doing 
> wrong, or what I should try?

You are using point support (your forests are at points not areas, so that 
the observations are not contiguous). The advice to consider this as a 
mixed model problem may be relevant. It is certainly the case that 
ncf::correlog() should not be used for regression residuals.

Further, your data are in a band 1.5-4.3E, 43.0-43.4N, so using 0.7 
degrees in dnearneigh() was a risky choice, and squashes the data. If you 
coerce to an sf object and apply an appropriate CRS, you get many fewer 
neighbours on average.

library(sf)
data <- st_as_sf(data, coords=c("LONG", "LAT"))
(nbnear4 <- dnearneigh(data, 0, 0.7))
st_crs(data) <- 4326
(nbnear4a <- dnearneigh(data, 0, 27))
# or project to a relevant planar UTM 31N spec.
data_utm31 <- st_transform(data, st_crs(32631))
(nbd <- dnearneigh(data_utm31, 0, 27))

and so on. SpatialFiltering() and ME() test against global residual 
autocorrelation in finding candidate eigenvectors, and running 
lm.morantest() on the fitted model shows that there is no global 
autocorrelation as intended (because positive and negative local 
autocorrelation cancels out). I think that the underlying problems are 
mixing approaches that are not asking the same questions, and in too 
little care in choosing the weights.

Hope this clarifies,

Roger

> 
> Thanks in advance for you time.
> 
> Peter
> 
> The data are here:
> 
> https://drive.google.com/file/d/1Z3FIGIAbYvXqGETn0EWLjTOY8MYpZi_S/view?usp=
> sharing
> 
> The analysis goes like this:
> 
> library(spatialreg)
> library(spdep)
> library(tidyverse)
> library(car)
> library(ncf)
> 
> 
> data <- read_csv("for_RAR.csv")
> set.seed(12345)
> x <- data$ses.mntd
> y <- log(data$RAR)
> ols_for_RAR <- lm(y ~ x)
> ## qqplot() and shapiro.test() show residuals are nicely distributed
> # x is significant and R-square about 0.2, demonstrated here
> car::Anova(ols_for_RAR,type="III")
> summary(ols_for_RAR)
> 
> # the following appears to make an acceptable neighbor network
> c1<-c(data$LONG)
> c2<-c(data$LAT)
> cbindForests<-cbind(c1,c2)
> # a value of 0.7, below, is sufficient to join all the points.
> # qualitatively the results aren't affected, as far as I see by setting this
> higher
> # However, the number of eigenvectors generated by SpatialFiltering() varies
> a lot
> nbnear4 <- dnearneigh(cbindForests, 0, 0.7)
> plot(nbnear4, cbindForests, col = "red", pch = 20)
> 
> # SAC appears significant at short distances (<10km), which is what I want
> to remove
> cor_for <- correlog(c1, c2, residuals(ols_for_RAR), increment = 1, resamp =
> 1000, latlon=TRUE, na.rm = TRUE)
> plot(cor_for$correlation[1:20],type="s")
> # p-values
> print(cor_for$p[which(cor_for$p < 0.05)])
> # Moran's I values
> cor_for$correlation[which(cor_for$p < 0.05)]
> 
> # Generate optimized spatial eigenvectors using SpatialFiltering() and use
> them
> # Several vectors are generated depending on values in dnearneigh()
> spfilt_mntd_RAR<- spatialreg::SpatialFiltering(y ~ x, nb=nbnear4,style =
> "W", tol=0.0001, ExactEV = TRUE)
> new_mod <- lm(y ~ x + fitted(spfilt_mntd_RAR))
> car::Anova(new_mod, type="III")
> summary(new_mod)
> 
> # Plot Moran's I at distances under 20km
> cor_for_1c <- correlog(c1, c2, residuals(new_mod), increment = 1, resamp =
> 1000, latlon=TRUE, na.rm = TRUE)
> plot(cor_for_1c$correlation[1:20],type="s")
> 
> # Extract significant values of Moran's I
> cor_for_1c$p[which(cor_for_1c$p < 0.05)]
> cor_for_1c$correlation[which(cor_for_1c$p < 0.05)]
> 
> # The result is that Moran's I is significant at additional short distances
> --
> 
> _+_+_+_+_+_+_+_+_
> 
> Peter B. Pearman
> Ikerbasque Research Professor
> 
> Laboratory for Computational Ecology and Evolution
> Departamento de Biolog?a Vegetal y Ecolog?a
> Facultad de Ciencias y Tecnolog?a
> Ap. 644
> Universidad del Pa?s Vasco/ Euskal Herriko Unibertsitatea
> 
> Barrio Sarriena s/n
> 48940 Leioa, Bizkaia
> 
> SPAIN
> 
> Tel. ?+34 94 601 8030
> 
> Fax? +34 94 601 3500
> 
> www.ehu.eus/es/web/bgppermp
> 
> ?
> 
> When you believe in things that you don?t understand
> 
> Then you suffer
> 
> ??????????????????????? -- Stevie Wonder
> 
> 
> Download my public encryption key here: https://pgp.mit.edu/
> 
> and please use it when you send me e-mail.
> 
> ?
> 
> 
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From v|n|c|u@@@@m@|@77 @end|ng |rom gm@||@com  Thu Jul 23 19:36:11 2020
From: v|n|c|u@@@@m@|@77 @end|ng |rom gm@||@com (Vinicius Maia)
Date: Thu, 23 Jul 2020 14:36:11 -0300
Subject: [R-sig-Geo] 
 eigenvectors increase spatial autocorrelation in ols regression
In-Reply-To: <alpine.LFD.2.23.451.2007231754460.450674@reclus.nhh.no>
References: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>
 <alpine.LFD.2.23.451.2007231754460.450674@reclus.nhh.no>
Message-ID: <CAMXcYmbqairh447U6+iYtzBouahup+xe4ofnKSDA5rzxusK4fA@mail.gmail.com>

Dear Roger,

Why ncf::correlog() should not be used for regression residuals in this
case?

Could you clarify this to me, please?

Thank you

Best,

Vinicius

Em qui., 23 de jul. de 2020 ?s 13:52, Roger Bivand <Roger.Bivand at nhh.no>
escreveu:

> On Wed, 22 Jul 2020, Peter B. Pearman wrote:
>
> >
> > Dear Roger and list members,
> >
> > I have a ols regression and want to remove spatial autocorrelation (SAC)
> > from the residuals, in order to avoid its potential effects of SAC on
> > the hypothesis tests (and the reviewers/editor).  I have generated
> > spatial eigenvectors with SpatialFiltering(), and added the generated
> > vectors to the regression.  Surprisingly, SAC appears to become more
> > pronounced.  I also tried ME(), but many more vectors are produced and
> > SAC is also not removed. Isn't including the vectors from
> > SpatialFiltering() supposed to reduce SAC?
> >
> > Can you please enlighten me as to what's going on, what I am doing
> > wrong, or what I should try?
>
> You are using point support (your forests are at points not areas, so that
> the observations are not contiguous). The advice to consider this as a
> mixed model problem may be relevant. It is certainly the case that
> ncf::correlog() should not be used for regression residuals.
>
> Further, your data are in a band 1.5-4.3E, 43.0-43.4N, so using 0.7
> degrees in dnearneigh() was a risky choice, and squashes the data. If you
> coerce to an sf object and apply an appropriate CRS, you get many fewer
> neighbours on average.
>
> library(sf)
> data <- st_as_sf(data, coords=c("LONG", "LAT"))
> (nbnear4 <- dnearneigh(data, 0, 0.7))
> st_crs(data) <- 4326
> (nbnear4a <- dnearneigh(data, 0, 27))
> # or project to a relevant planar UTM 31N spec.
> data_utm31 <- st_transform(data, st_crs(32631))
> (nbd <- dnearneigh(data_utm31, 0, 27))
>
> and so on. SpatialFiltering() and ME() test against global residual
> autocorrelation in finding candidate eigenvectors, and running
> lm.morantest() on the fitted model shows that there is no global
> autocorrelation as intended (because positive and negative local
> autocorrelation cancels out). I think that the underlying problems are
> mixing approaches that are not asking the same questions, and in too
> little care in choosing the weights.
>
> Hope this clarifies,
>
> Roger
>
> >
> > Thanks in advance for you time.
> >
> > Peter
> >
> > The data are here:
> >
> >
> https://drive.google.com/file/d/1Z3FIGIAbYvXqGETn0EWLjTOY8MYpZi_S/view?usp=
> > sharing
> >
> > The analysis goes like this:
> >
> > library(spatialreg)
> > library(spdep)
> > library(tidyverse)
> > library(car)
> > library(ncf)
> >
> >
> > data <- read_csv("for_RAR.csv")
> > set.seed(12345)
> > x <- data$ses.mntd
> > y <- log(data$RAR)
> > ols_for_RAR <- lm(y ~ x)
> > ## qqplot() and shapiro.test() show residuals are nicely distributed
> > # x is significant and R-square about 0.2, demonstrated here
> > car::Anova(ols_for_RAR,type="III")
> > summary(ols_for_RAR)
> >
> > # the following appears to make an acceptable neighbor network
> > c1<-c(data$LONG)
> > c2<-c(data$LAT)
> > cbindForests<-cbind(c1,c2)
> > # a value of 0.7, below, is sufficient to join all the points.
> > # qualitatively the results aren't affected, as far as I see by setting
> this
> > higher
> > # However, the number of eigenvectors generated by SpatialFiltering()
> varies
> > a lot
> > nbnear4 <- dnearneigh(cbindForests, 0, 0.7)
> > plot(nbnear4, cbindForests, col = "red", pch = 20)
> >
> > # SAC appears significant at short distances (<10km), which is what I
> want
> > to remove
> > cor_for <- correlog(c1, c2, residuals(ols_for_RAR), increment = 1,
> resamp =
> > 1000, latlon=TRUE, na.rm = TRUE)
> > plot(cor_for$correlation[1:20],type="s")
> > # p-values
> > print(cor_for$p[which(cor_for$p < 0.05)])
> > # Moran's I values
> > cor_for$correlation[which(cor_for$p < 0.05)]
> >
> > # Generate optimized spatial eigenvectors using SpatialFiltering() and
> use
> > them
> > # Several vectors are generated depending on values in dnearneigh()
> > spfilt_mntd_RAR<- spatialreg::SpatialFiltering(y ~ x, nb=nbnear4,style =
> > "W", tol=0.0001, ExactEV = TRUE)
> > new_mod <- lm(y ~ x + fitted(spfilt_mntd_RAR))
> > car::Anova(new_mod, type="III")
> > summary(new_mod)
> >
> > # Plot Moran's I at distances under 20km
> > cor_for_1c <- correlog(c1, c2, residuals(new_mod), increment = 1, resamp
> =
> > 1000, latlon=TRUE, na.rm = TRUE)
> > plot(cor_for_1c$correlation[1:20],type="s")
> >
> > # Extract significant values of Moran's I
> > cor_for_1c$p[which(cor_for_1c$p < 0.05)]
> > cor_for_1c$correlation[which(cor_for_1c$p < 0.05)]
> >
> > # The result is that Moran's I is significant at additional short
> distances
> > --
> >
> > _+_+_+_+_+_+_+_+_
> >
> > Peter B. Pearman
> > Ikerbasque Research Professor
> >
> > Laboratory for Computational Ecology and Evolution
> > Departamento de Biolog?a Vegetal y Ecolog?a
> > Facultad de Ciencias y Tecnolog?a
> > Ap. 644
> > Universidad del Pa?s Vasco/ Euskal Herriko Unibertsitatea
> >
> > Barrio Sarriena s/n
> > 48940 Leioa, Bizkaia
> >
> > SPAIN
> >
> > Tel.  +34 94 601 8030
> >
> > Fax  +34 94 601 3500
> >
> > www.ehu.eus/es/web/bgppermp
> >
> >
> >
> > When you believe in things that you don?t understand
> >
> > Then you suffer
> >
> >                         -- Stevie Wonder
> >
> >
> > Download my public encryption key here: https://pgp.mit.edu/
> >
> > and please use it when you send me e-mail.
> >
> >
> >
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sat Jul 25 13:40:48 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 25 Jul 2020 13:40:48 +0200
Subject: [R-sig-Geo] 
 eigenvectors increase spatial autocorrelation in ols regression
In-Reply-To: <CAMXcYmbqairh447U6+iYtzBouahup+xe4ofnKSDA5rzxusK4fA@mail.gmail.com>
References: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>
 <alpine.LFD.2.23.451.2007231754460.450674@reclus.nhh.no>
 <CAMXcYmbqairh447U6+iYtzBouahup+xe4ofnKSDA5rzxusK4fA@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007251305180.478032@reclus.nhh.no>

On Thu, 23 Jul 2020, Vinicius Maia wrote:

> Dear Roger,
>
> Why ncf::correlog() should not be used for regression residuals in this
> case?
>
> Could you clarify this to me, please?

I do not have my copy of Cliff & Ord (1973) to hand. The value of Moran's 
I is the same, but the inferences will be affected by changes in the 
expectation and variance (under Normality):

library(spdep)
columbus <- st_read(system.file("shapes/columbus.shp",
   package="spData")[1])
col.gal.nb <- read.gal(system.file("weights/columbus.gal",
   package="spData")[1])
OLS <- lm(CRIME ~ INC + HOVAL, data=columbus)
lm.morantest(OLS, listw=nb2listw(col.gal.nb))
moran.test(residuals(OLS), listw=nb2listw(col.gal.nb),
   randomisation=FALSE)

This is because standard regression assumptions affect how we view the 
regression residuals, details in Cliff & Ord. See for example the code in 
moran.test() for E(I) (var(I) is similar):

     EI <- (-1)/wc$n1

where wc$n1 is n - 1 from spweights.constants(). In the lm.morantest() 
case:

     XtXinv <- chol2inv(model$qr$qr[p1, p1, drop = FALSE])
     X <- model.matrix(terms(model), model.frame(model))
     if (length(nacoefs) > 0L)
         X <- X[, -nacoefs]
     if (!is.null(wts <- weights(model))) {
         X <- drop(t(sapply(1:length(wts), function(i) sqrt(wts[i]) *
             X[i, ])))
     }
     Z <- lag.listw(listw.U, X, zero.policy = zero.policy)
     C1 <- t(X) %*% Z
     trA <- (sum(diag(XtXinv %*% C1)))
     EI <- -((N * trA)/((N - p) * S0))

and S_0 is the sum of weights (N if row standardised), p is the number 
columns of X, and A = (X'X)^{-1} X'WX. For the distance band case, you 
also need to adjust N for the count of pairs of neighbours within that 
band; in moran.test() you see n <- as.double(length(which(cards > 0))) by 
default, where cards is a vector of neighbour counts; in lm.morantest() 
the equivalent by default is
  N <- as.double(length(which(card(listw$neighbours) > 0L)))

My presumption is that ncf::correlog() is for input variables, not 
regression residuals, as there is no argument to pass though the fitted 
model object from which to extract the model matrix or (X'X)^{-1}. 
Further, resampling regression residuals may be unsafe for similar 
reasons; the draws should not be from the residuals, I think.

Recall that the code is shown by typing the function name, and this best 
documents what is going on.

Again, refer to Cliff & Ord 1973 for the full development.

Roger


>
> Thank you
>
> Best,
>
> Vinicius
>
> Em qui., 23 de jul. de 2020 ?s 13:52, Roger Bivand <Roger.Bivand at nhh.no>
> escreveu:
>
>> On Wed, 22 Jul 2020, Peter B. Pearman wrote:
>>
>>>
>>> Dear Roger and list members,
>>>
>>> I have a ols regression and want to remove spatial autocorrelation (SAC)
>>> from the residuals, in order to avoid its potential effects of SAC on
>>> the hypothesis tests (and the reviewers/editor).  I have generated
>>> spatial eigenvectors with SpatialFiltering(), and added the generated
>>> vectors to the regression.  Surprisingly, SAC appears to become more
>>> pronounced.  I also tried ME(), but many more vectors are produced and
>>> SAC is also not removed. Isn't including the vectors from
>>> SpatialFiltering() supposed to reduce SAC?
>>>
>>> Can you please enlighten me as to what's going on, what I am doing
>>> wrong, or what I should try?
>>
>> You are using point support (your forests are at points not areas, so that
>> the observations are not contiguous). The advice to consider this as a
>> mixed model problem may be relevant. It is certainly the case that
>> ncf::correlog() should not be used for regression residuals.
>>
>> Further, your data are in a band 1.5-4.3E, 43.0-43.4N, so using 0.7
>> degrees in dnearneigh() was a risky choice, and squashes the data. If you
>> coerce to an sf object and apply an appropriate CRS, you get many fewer
>> neighbours on average.
>>
>> library(sf)
>> data <- st_as_sf(data, coords=c("LONG", "LAT"))
>> (nbnear4 <- dnearneigh(data, 0, 0.7))
>> st_crs(data) <- 4326
>> (nbnear4a <- dnearneigh(data, 0, 27))
>> # or project to a relevant planar UTM 31N spec.
>> data_utm31 <- st_transform(data, st_crs(32631))
>> (nbd <- dnearneigh(data_utm31, 0, 27))
>>
>> and so on. SpatialFiltering() and ME() test against global residual
>> autocorrelation in finding candidate eigenvectors, and running
>> lm.morantest() on the fitted model shows that there is no global
>> autocorrelation as intended (because positive and negative local
>> autocorrelation cancels out). I think that the underlying problems are
>> mixing approaches that are not asking the same questions, and in too
>> little care in choosing the weights.
>>
>> Hope this clarifies,
>>
>> Roger
>>
>>>
>>> Thanks in advance for you time.
>>>
>>> Peter
>>>
>>> The data are here:
>>>
>>>
>> https://drive.google.com/file/d/1Z3FIGIAbYvXqGETn0EWLjTOY8MYpZi_S/view?usp=
>>> sharing
>>>
>>> The analysis goes like this:
>>>
>>> library(spatialreg)
>>> library(spdep)
>>> library(tidyverse)
>>> library(car)
>>> library(ncf)
>>>
>>>
>>> data <- read_csv("for_RAR.csv")
>>> set.seed(12345)
>>> x <- data$ses.mntd
>>> y <- log(data$RAR)
>>> ols_for_RAR <- lm(y ~ x)
>>> ## qqplot() and shapiro.test() show residuals are nicely distributed
>>> # x is significant and R-square about 0.2, demonstrated here
>>> car::Anova(ols_for_RAR,type="III")
>>> summary(ols_for_RAR)
>>>
>>> # the following appears to make an acceptable neighbor network
>>> c1<-c(data$LONG)
>>> c2<-c(data$LAT)
>>> cbindForests<-cbind(c1,c2)
>>> # a value of 0.7, below, is sufficient to join all the points.
>>> # qualitatively the results aren't affected, as far as I see by setting
>> this
>>> higher
>>> # However, the number of eigenvectors generated by SpatialFiltering()
>> varies
>>> a lot
>>> nbnear4 <- dnearneigh(cbindForests, 0, 0.7)
>>> plot(nbnear4, cbindForests, col = "red", pch = 20)
>>>
>>> # SAC appears significant at short distances (<10km), which is what I
>> want
>>> to remove
>>> cor_for <- correlog(c1, c2, residuals(ols_for_RAR), increment = 1,
>> resamp =
>>> 1000, latlon=TRUE, na.rm = TRUE)
>>> plot(cor_for$correlation[1:20],type="s")
>>> # p-values
>>> print(cor_for$p[which(cor_for$p < 0.05)])
>>> # Moran's I values
>>> cor_for$correlation[which(cor_for$p < 0.05)]
>>>
>>> # Generate optimized spatial eigenvectors using SpatialFiltering() and
>> use
>>> them
>>> # Several vectors are generated depending on values in dnearneigh()
>>> spfilt_mntd_RAR<- spatialreg::SpatialFiltering(y ~ x, nb=nbnear4,style =
>>> "W", tol=0.0001, ExactEV = TRUE)
>>> new_mod <- lm(y ~ x + fitted(spfilt_mntd_RAR))
>>> car::Anova(new_mod, type="III")
>>> summary(new_mod)
>>>
>>> # Plot Moran's I at distances under 20km
>>> cor_for_1c <- correlog(c1, c2, residuals(new_mod), increment = 1, resamp
>> =
>>> 1000, latlon=TRUE, na.rm = TRUE)
>>> plot(cor_for_1c$correlation[1:20],type="s")
>>>
>>> # Extract significant values of Moran's I
>>> cor_for_1c$p[which(cor_for_1c$p < 0.05)]
>>> cor_for_1c$correlation[which(cor_for_1c$p < 0.05)]
>>>
>>> # The result is that Moran's I is significant at additional short
>> distances
>>> --
>>>
>>> _+_+_+_+_+_+_+_+_
>>>
>>> Peter B. Pearman
>>> Ikerbasque Research Professor
>>>
>>> Laboratory for Computational Ecology and Evolution
>>> Departamento de Biolog?a Vegetal y Ecolog?a
>>> Facultad de Ciencias y Tecnolog?a
>>> Ap. 644
>>> Universidad del Pa?s Vasco/ Euskal Herriko Unibertsitatea
>>>
>>> Barrio Sarriena s/n
>>> 48940 Leioa, Bizkaia
>>>
>>> SPAIN
>>>
>>> Tel.  +34 94 601 8030
>>>
>>> Fax  +34 94 601 3500
>>>
>>> www.ehu.eus/es/web/bgppermp
>>>
>>>
>>>
>>> When you believe in things that you don?t understand
>>>
>>> Then you suffer
>>>
>>>                         -- Stevie Wonder
>>>
>>>
>>> Download my public encryption key here: https://pgp.mit.edu/
>>>
>>> and please use it when you send me e-mail.
>>>
>>>
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From v|n|c|u@@@@m@|@77 @end|ng |rom gm@||@com  Mon Jul 27 15:03:36 2020
From: v|n|c|u@@@@m@|@77 @end|ng |rom gm@||@com (Vinicius Maia)
Date: Mon, 27 Jul 2020 10:03:36 -0300
Subject: [R-sig-Geo] 
 eigenvectors increase spatial autocorrelation in ols regression
In-Reply-To: <alpine.LFD.2.23.451.2007251305180.478032@reclus.nhh.no>
References: <d5692ca0-8a24-3861-e7e8-77bdfd5ab943@ehu.es>
 <alpine.LFD.2.23.451.2007231754460.450674@reclus.nhh.no>
 <CAMXcYmbqairh447U6+iYtzBouahup+xe4ofnKSDA5rzxusK4fA@mail.gmail.com>
 <alpine.LFD.2.23.451.2007251305180.478032@reclus.nhh.no>
Message-ID: <CAMXcYmYYs8L7WBoQZ5ZXYmRBOtfLof7v_OnZry=86ZrFYiEs4g@mail.gmail.com>

Hi Roger,

Thank you for this clarification, it will certainly be useful for me and
others.

Best,

Vinicius

Em s?b., 25 de jul. de 2020 ?s 08:41, Roger Bivand <Roger.Bivand at nhh.no>
escreveu:

> On Thu, 23 Jul 2020, Vinicius Maia wrote:
>
> > Dear Roger,
> >
> > Why ncf::correlog() should not be used for regression residuals in this
> > case?
> >
> > Could you clarify this to me, please?
>
> I do not have my copy of Cliff & Ord (1973) to hand. The value of Moran's
> I is the same, but the inferences will be affected by changes in the
> expectation and variance (under Normality):
>
> library(spdep)
> columbus <- st_read(system.file("shapes/columbus.shp",
>    package="spData")[1])
> col.gal.nb <- read.gal(system.file("weights/columbus.gal",
>    package="spData")[1])
> OLS <- lm(CRIME ~ INC + HOVAL, data=columbus)
> lm.morantest(OLS, listw=nb2listw(col.gal.nb))
> moran.test(residuals(OLS), listw=nb2listw(col.gal.nb),
>    randomisation=FALSE)
>
> This is because standard regression assumptions affect how we view the
> regression residuals, details in Cliff & Ord. See for example the code in
> moran.test() for E(I) (var(I) is similar):
>
>      EI <- (-1)/wc$n1
>
> where wc$n1 is n - 1 from spweights.constants(). In the lm.morantest()
> case:
>
>      XtXinv <- chol2inv(model$qr$qr[p1, p1, drop = FALSE])
>      X <- model.matrix(terms(model), model.frame(model))
>      if (length(nacoefs) > 0L)
>          X <- X[, -nacoefs]
>      if (!is.null(wts <- weights(model))) {
>          X <- drop(t(sapply(1:length(wts), function(i) sqrt(wts[i]) *
>              X[i, ])))
>      }
>      Z <- lag.listw(listw.U, X, zero.policy = zero.policy)
>      C1 <- t(X) %*% Z
>      trA <- (sum(diag(XtXinv %*% C1)))
>      EI <- -((N * trA)/((N - p) * S0))
>
> and S_0 is the sum of weights (N if row standardised), p is the number
> columns of X, and A = (X'X)^{-1} X'WX. For the distance band case, you
> also need to adjust N for the count of pairs of neighbours within that
> band; in moran.test() you see n <- as.double(length(which(cards > 0))) by
> default, where cards is a vector of neighbour counts; in lm.morantest()
> the equivalent by default is
>   N <- as.double(length(which(card(listw$neighbours) > 0L)))
>
> My presumption is that ncf::correlog() is for input variables, not
> regression residuals, as there is no argument to pass though the fitted
> model object from which to extract the model matrix or (X'X)^{-1}.
> Further, resampling regression residuals may be unsafe for similar
> reasons; the draws should not be from the residuals, I think.
>
> Recall that the code is shown by typing the function name, and this best
> documents what is going on.
>
> Again, refer to Cliff & Ord 1973 for the full development.
>
> Roger
>
>
> >
> > Thank you
> >
> > Best,
> >
> > Vinicius
> >
> > Em qui., 23 de jul. de 2020 ?s 13:52, Roger Bivand <Roger.Bivand at nhh.no>
> > escreveu:
> >
> >> On Wed, 22 Jul 2020, Peter B. Pearman wrote:
> >>
> >>>
> >>> Dear Roger and list members,
> >>>
> >>> I have a ols regression and want to remove spatial autocorrelation
> (SAC)
> >>> from the residuals, in order to avoid its potential effects of SAC on
> >>> the hypothesis tests (and the reviewers/editor).  I have generated
> >>> spatial eigenvectors with SpatialFiltering(), and added the generated
> >>> vectors to the regression.  Surprisingly, SAC appears to become more
> >>> pronounced.  I also tried ME(), but many more vectors are produced and
> >>> SAC is also not removed. Isn't including the vectors from
> >>> SpatialFiltering() supposed to reduce SAC?
> >>>
> >>> Can you please enlighten me as to what's going on, what I am doing
> >>> wrong, or what I should try?
> >>
> >> You are using point support (your forests are at points not areas, so
> that
> >> the observations are not contiguous). The advice to consider this as a
> >> mixed model problem may be relevant. It is certainly the case that
> >> ncf::correlog() should not be used for regression residuals.
> >>
> >> Further, your data are in a band 1.5-4.3E, 43.0-43.4N, so using 0.7
> >> degrees in dnearneigh() was a risky choice, and squashes the data. If
> you
> >> coerce to an sf object and apply an appropriate CRS, you get many fewer
> >> neighbours on average.
> >>
> >> library(sf)
> >> data <- st_as_sf(data, coords=c("LONG", "LAT"))
> >> (nbnear4 <- dnearneigh(data, 0, 0.7))
> >> st_crs(data) <- 4326
> >> (nbnear4a <- dnearneigh(data, 0, 27))
> >> # or project to a relevant planar UTM 31N spec.
> >> data_utm31 <- st_transform(data, st_crs(32631))
> >> (nbd <- dnearneigh(data_utm31, 0, 27))
> >>
> >> and so on. SpatialFiltering() and ME() test against global residual
> >> autocorrelation in finding candidate eigenvectors, and running
> >> lm.morantest() on the fitted model shows that there is no global
> >> autocorrelation as intended (because positive and negative local
> >> autocorrelation cancels out). I think that the underlying problems are
> >> mixing approaches that are not asking the same questions, and in too
> >> little care in choosing the weights.
> >>
> >> Hope this clarifies,
> >>
> >> Roger
> >>
> >>>
> >>> Thanks in advance for you time.
> >>>
> >>> Peter
> >>>
> >>> The data are here:
> >>>
> >>>
> >>
> https://drive.google.com/file/d/1Z3FIGIAbYvXqGETn0EWLjTOY8MYpZi_S/view?usp=
> >>> sharing
> >>>
> >>> The analysis goes like this:
> >>>
> >>> library(spatialreg)
> >>> library(spdep)
> >>> library(tidyverse)
> >>> library(car)
> >>> library(ncf)
> >>>
> >>>
> >>> data <- read_csv("for_RAR.csv")
> >>> set.seed(12345)
> >>> x <- data$ses.mntd
> >>> y <- log(data$RAR)
> >>> ols_for_RAR <- lm(y ~ x)
> >>> ## qqplot() and shapiro.test() show residuals are nicely distributed
> >>> # x is significant and R-square about 0.2, demonstrated here
> >>> car::Anova(ols_for_RAR,type="III")
> >>> summary(ols_for_RAR)
> >>>
> >>> # the following appears to make an acceptable neighbor network
> >>> c1<-c(data$LONG)
> >>> c2<-c(data$LAT)
> >>> cbindForests<-cbind(c1,c2)
> >>> # a value of 0.7, below, is sufficient to join all the points.
> >>> # qualitatively the results aren't affected, as far as I see by setting
> >> this
> >>> higher
> >>> # However, the number of eigenvectors generated by SpatialFiltering()
> >> varies
> >>> a lot
> >>> nbnear4 <- dnearneigh(cbindForests, 0, 0.7)
> >>> plot(nbnear4, cbindForests, col = "red", pch = 20)
> >>>
> >>> # SAC appears significant at short distances (<10km), which is what I
> >> want
> >>> to remove
> >>> cor_for <- correlog(c1, c2, residuals(ols_for_RAR), increment = 1,
> >> resamp =
> >>> 1000, latlon=TRUE, na.rm = TRUE)
> >>> plot(cor_for$correlation[1:20],type="s")
> >>> # p-values
> >>> print(cor_for$p[which(cor_for$p < 0.05)])
> >>> # Moran's I values
> >>> cor_for$correlation[which(cor_for$p < 0.05)]
> >>>
> >>> # Generate optimized spatial eigenvectors using SpatialFiltering() and
> >> use
> >>> them
> >>> # Several vectors are generated depending on values in dnearneigh()
> >>> spfilt_mntd_RAR<- spatialreg::SpatialFiltering(y ~ x, nb=nbnear4,style
> =
> >>> "W", tol=0.0001, ExactEV = TRUE)
> >>> new_mod <- lm(y ~ x + fitted(spfilt_mntd_RAR))
> >>> car::Anova(new_mod, type="III")
> >>> summary(new_mod)
> >>>
> >>> # Plot Moran's I at distances under 20km
> >>> cor_for_1c <- correlog(c1, c2, residuals(new_mod), increment = 1,
> resamp
> >> =
> >>> 1000, latlon=TRUE, na.rm = TRUE)
> >>> plot(cor_for_1c$correlation[1:20],type="s")
> >>>
> >>> # Extract significant values of Moran's I
> >>> cor_for_1c$p[which(cor_for_1c$p < 0.05)]
> >>> cor_for_1c$correlation[which(cor_for_1c$p < 0.05)]
> >>>
> >>> # The result is that Moran's I is significant at additional short
> >> distances
> >>> --
> >>>
> >>> _+_+_+_+_+_+_+_+_
> >>>
> >>> Peter B. Pearman
> >>> Ikerbasque Research Professor
> >>>
> >>> Laboratory for Computational Ecology and Evolution
> >>> Departamento de Biolog?a Vegetal y Ecolog?a
> >>> Facultad de Ciencias y Tecnolog?a
> >>> Ap. 644
> >>> Universidad del Pa?s Vasco/ Euskal Herriko Unibertsitatea
> >>>
> >>> Barrio Sarriena s/n
> >>> 48940 Leioa, Bizkaia
> >>>
> >>> SPAIN
> >>>
> >>> Tel.  +34 94 601 8030
> >>>
> >>> Fax  +34 94 601 3500
> >>>
> >>> www.ehu.eus/es/web/bgppermp
> >>>
> >>>
> >>>
> >>> When you believe in things that you don?t understand
> >>>
> >>> Then you suffer
> >>>
> >>>                         -- Stevie Wonder
> >>>
> >>>
> >>> Download my public encryption key here: https://pgp.mit.edu/
> >>>
> >>> and please use it when you send me e-mail.
> >>>
> >>>
> >>>
> >>>
> >>>
> >>
> >> --
> >> Roger Bivand
> >> Department of Economics, Norwegian School of Economics,
> >> Helleveien 30, N-5045 Bergen, Norway.
> >> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >> https://orcid.org/0000-0003-2392-6140
> >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From g||berto@c@m@r@@|npe @end|ng |rom gm@||@com  Tue Jul 28 13:29:37 2020
From: g||berto@c@m@r@@|npe @end|ng |rom gm@||@com (Gilberto Camara)
Date: Tue, 28 Jul 2020 13:29:37 +0200
Subject: [R-sig-Geo] Help when moving from PROJ4 to PROJ6
Message-ID: <77306D20-8D17-40AC-8721-532D169E1D40@gmail.com>

Dear R-SIG-GEO (esp. Roger and Edzer)

I am having problems with ?raster?, ?rgdal?, and ?sf? when moving from PROJ4 to PROJ6. Roger?s explanation on the r-spatial blog ("https://www.r-spatial.org/r/2020/03/17/wkt.html?) and the rgdal blog (http://rgdal.r-forge.r-project.org/articles/PROJ6_GDAL3.html <http://rgdal.r-forge.r-project.org/articles/PROJ6_GDAL3.html>) are clear on the reasons why there are problems with CRS. As Roger points out, ?package maintainers will need to review their use of crs objects?. So very true!

I appreciate the tremendous effort of Edzer and Roger for moving from PROJ4 to PROJ6. 

However, I am failing to understand what is happening in the following example:

================================================
library(sf)
> longitude <- -55.62277
> latitude  <- -11.75932

> st_point <- sf::st_point(c(longitude, latitude))
> ll_sfc   <- sf::st_sfc(st_point, crs = "EPSG:4326")

> ll_sfc[[1]]
POINT (-55.55527 -11.51782)

> ll_sfc2 <- sf::st_sfc(st_point, crs = "+proj=longlat +datum=WGS84 +no_defs?)

> ll_sfc2[[1]]
POINT (-55.62277 -11.75932)
==================================================

> sessionInfo()
R version 4.0.1 (2020-06-06)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Catalina 10.15.5

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] sf_0.9-5      sits_0.9.5.1  raster_3.3-13 rgdal_1.5-12  sp_1.4-2    
=====================================================================

Why is using the EPSG code resulting in a different behaviour that using the old PROJ4 text?

Many thanks
Gilberto

===========================
Prof Dr Gilberto Camara
Secretariat Director
GEO - Group on Earth Observations
7 bis, Avenue de La Paix
CH-1211 Geneva - Switzerland
Tel: +41227308480
www.earthobservations.org


	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Tue Jul 28 15:34:31 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 28 Jul 2020 15:34:31 +0200
Subject: [R-sig-Geo] Help when moving from PROJ4 to PROJ6
In-Reply-To: <77306D20-8D17-40AC-8721-532D169E1D40@gmail.com>
References: <77306D20-8D17-40AC-8721-532D169E1D40@gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007281517550.520703@reclus.nhh.no>

On Tue, 28 Jul 2020, Gilberto Camara wrote:

> Dear R-SIG-GEO (esp. Roger and Edzer)
>
> I am having problems with ?raster?, ?rgdal?, and ?sf? when moving from 
> PROJ4 to PROJ6. Roger?s explanation on the r-spatial blog 
> ("https://www.r-spatial.org/r/2020/03/17/wkt.html?) and the rgdal blog 
> (http://rgdal.r-forge.r-project.org/articles/PROJ6_GDAL3.html 
> <http://rgdal.r-forge.r-project.org/articles/PROJ6_GDAL3.html>) are 
> clear on the reasons why there are problems with CRS. As Roger points 
> out, ?package maintainers will need to review their use of crs objects?. 
> So very true!
>
> I appreciate the tremendous effort of Edzer and Roger for moving from 
> PROJ4 to PROJ6.
>
> However, I am failing to understand what is happening in the following 
> example:
>
> ================================================
> library(sf)

Could you please report:

sf_extSoftVersion()

Mine are (on Linux, own PROJ & GDAL installations):

sf_extSoftVersion()
           GEOS           GDAL         proj.4 GDAL_with_GEOS     USE_PROJ_H
        "3.8.1"        "3.1.2"        "7.1.0"         "true"         "true"

where there is no change in the coordinates (there should not be a change 
as sf::st_crs() only sets the CRS (but may swap the axes as per 
specification).

I see:

> st_crs(ll_sfc2)
Coordinate Reference System:
   User input: +proj=longlat +datum=WGS84 +no_defs
   wkt:
GEOGCRS["unknown",
     DATUM["World Geodetic System 1984",
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]],
         ID["EPSG",6326]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433],
         ID["EPSG",8901]],
     CS[ellipsoidal,2],
         AXIS["longitude",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]],
         AXIS["latitude",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]]]

but

> st_crs(ll_sfc)
Coordinate Reference System:
   User input: EPSG:4326
   wkt:
GEOGCRS["WGS 84",
     DATUM["World Geodetic System 1984",
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433]],
     CS[ellipsoidal,2],
         AXIS["geodetic latitude (Lat)",north,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433]],
         AXIS["geodetic longitude (Lon)",east,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433]],
     USAGE[
         SCOPE["unknown"],
         AREA["World"],
         BBOX[-90,-180,90,180]],
     ID["EPSG",4326]]

I can't see from 
https://www.r-spatial.org/r/2020/03/17/wkt.html#axis-order how to 
instantiate a crs object with non-authorized order.

In sp/rgdal:

> sp <- SpatialPoints(cbind(longitude, latitude), 
proj4string=CRS("+proj=longlat +datum=WGS84"))
> sp
SpatialPoints:
      longitude  latitude
[1,] -55.62277 -11.75932
Coordinate Reference System (CRS) arguments: +proj=longlat +datum=WGS84
+no_defs
> cat(wkt(sp), "\n")
GEOGCRS["unknown",
     DATUM["World Geodetic System 1984",
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]],
         ID["EPSG",6326]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433],
         ID["EPSG",8901]],
     CS[ellipsoidal,2],
         AXIS["longitude",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]],
         AXIS["latitude",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]]]

> sp2 <- SpatialPoints(cbind(longitude, latitude), 
proj4string=CRS(SRS_string="EPSG:4326"))
> sp2
SpatialPoints:
      longitude  latitude
[1,] -55.62277 -11.75932
Coordinate Reference System (CRS) arguments: +proj=longlat +datum=WGS84
+no_defs
> cat(wkt(sp2), "\n")
GEOGCRS["WGS 84",
     DATUM["World Geodetic System 1984",
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]],
         ID["EPSG",6326]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433],
         ID["EPSG",8901]],
     CS[ellipsoidal,2],
         AXIS["longitude",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]],
         AXIS["latitude",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]],
     USAGE[
         SCOPE["unknown"],
         AREA["World"],
         BBOX[-90,-180,90,180]]]

where sp/rgdal enforces legacy/GIS/visualization axis order. Coercing 
from the EPSG:4326 sp/rgdal object to sfc gives the intended order:

> ll_sfc3 <- st_as_sfc(sp2)
> ll_sfc3
Geometry set for 1 feature
geometry type:  POINT
dimension:      XY
bbox:           xmin: -55.62277 ymin: -11.75932 xmax: -55.62277 ymax: 
-11.75932
geographic CRS: WGS 84
POINT (-55.62277 -11.75932)
> st_crs(ll_sfc3)
Coordinate Reference System:
   User input: WGS 84
   wkt:
GEOGCRS["WGS 84",
     DATUM["World Geodetic System 1984",
         ELLIPSOID["WGS 84",6378137,298.257223563,
             LENGTHUNIT["metre",1]],
         ID["EPSG",6326]],
     PRIMEM["Greenwich",0,
         ANGLEUNIT["degree",0.0174532925199433],
         ID["EPSG",8901]],
     CS[ellipsoidal,2],
         AXIS["longitude",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]],
         AXIS["latitude",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433,
                 ID["EPSG",9122]]],
     USAGE[
         SCOPE["unknown"],
         AREA["World"],
         BBOX[-90,-180,90,180]]]

@Edzer - should we raise an sf issue, as st_crs<- appears not to respect 
st_axis_order()?

I'm not sure that this clarifies enough, but it's a start ...

Roger

>> longitude <- -55.62277
>> latitude  <- -11.75932
>
>> st_point <- sf::st_point(c(longitude, latitude))
>> ll_sfc   <- sf::st_sfc(st_point, crs = "EPSG:4326")
>
>> ll_sfc[[1]]
> POINT (-55.55527 -11.51782)
>
>> ll_sfc2 <- sf::st_sfc(st_point, crs = "+proj=longlat +datum=WGS84 +no_defs?)
>
>> ll_sfc2[[1]]
> POINT (-55.62277 -11.75932)
> ==================================================
>
>> sessionInfo()
> R version 4.0.1 (2020-06-06)
> Platform: x86_64-apple-darwin17.0 (64-bit)
> Running under: macOS Catalina 10.15.5
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] sf_0.9-5      sits_0.9.5.1  raster_3.3-13 rgdal_1.5-12  sp_1.4-2
> =====================================================================
>
> Why is using the EPSG code resulting in a different behaviour that using the old PROJ4 text?
>
> Many thanks
> Gilberto
>
> ===========================
> Prof Dr Gilberto Camara
> Secretariat Director
> GEO - Group on Earth Observations
> 7 bis, Avenue de La Paix
> CH-1211 Geneva - Switzerland
> Tel: +41227308480
> www.earthobservations.org
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From g||berto@c@m@r@@|npe @end|ng |rom gm@||@com  Tue Jul 28 15:36:40 2020
From: g||berto@c@m@r@@|npe @end|ng |rom gm@||@com (Gilberto Camara)
Date: Tue, 28 Jul 2020 15:36:40 +0200
Subject: [R-sig-Geo] Help when moving from PROJ4 to PROJ6
In-Reply-To: <alpine.LFD.2.23.451.2007281517550.520703@reclus.nhh.no>
References: <77306D20-8D17-40AC-8721-532D169E1D40@gmail.com>
 <alpine.LFD.2.23.451.2007281517550.520703@reclus.nhh.no>
Message-ID: <2803F89F-3065-4B21-AFA2-958787FC643E@gmail.com>

Dear Roger 

Please see my output:

> sf_extSoftVersion()
          GEOS           GDAL         proj.4 GDAL_with_GEOS     USE_PROJ_H 
       "3.8.1"        "3.1.1"        "6.3.1"         "true"         ?true"

Thanks
Gilberto

===========================
Prof Dr Gilberto Camara
Secretariat Director
GEO - Group on Earth Observations
7 bis, Avenue de La Paix
CH-1211 Geneva - Switzerland
Tel: +41227308480
www.earthobservations.org

> On 28 Jul 2020, at 15:34, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> sf_extSoftVersion()


	[[alternative HTML version deleted]]


From g||berto@c@m@r@@|npe @end|ng |rom gm@||@com  Tue Jul 28 16:12:04 2020
From: g||berto@c@m@r@@|npe @end|ng |rom gm@||@com (Gilberto Camara)
Date: Tue, 28 Jul 2020 16:12:04 +0200
Subject: [R-sig-Geo] Help when moving from PROJ4 to PROJ6
In-Reply-To: <2803F89F-3065-4B21-AFA2-958787FC643E@gmail.com>
References: <77306D20-8D17-40AC-8721-532D169E1D40@gmail.com>
 <alpine.LFD.2.23.451.2007281517550.520703@reclus.nhh.no>
 <2803F89F-3065-4B21-AFA2-958787FC643E@gmail.com>
Message-ID: <8C6193A0-26A1-44F6-9E00-993438372333@gmail.com>

Dear Roger 

I have installed the latest version of project, using ?brew? as recommended by the PROJ website. I have also installed the latest versions of ?sf? and ?rgdal? as recommended by the ?sf? GitHub. 

install.packages("rgdal", configure.args = c("--with-proj-lib=/usr/local/lib/", "--with-proj-include=/usr/local/include/?))

However, I still seeing the same environment for ?sf? (proj version 6.3.1). Is there an additional command I need to do? 

Thanks
Gilberto


> On 28 Jul 2020, at 15:36, Gilberto Camara <gilberto.camara.inpe at gmail.com> wrote:
> 
> Dear Roger 
> 
> Please see my output:
> 
>> sf_extSoftVersion()
>          GEOS           GDAL         proj.4 GDAL_with_GEOS     USE_PROJ_H 
>       "3.8.1"        "3.1.1"        "6.3.1"         "true"         ?true"
> 
> Thanks
> Gilberto
> 
> ===========================
> Prof Dr Gilberto Camara
> Secretariat Director
> GEO - Group on Earth Observations
> 7 bis, Avenue de La Paix
> CH-1211 Geneva - Switzerland
> Tel: +41227308480
> www.earthobservations.org
> 
>> On 28 Jul 2020, at 15:34, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> 
>> sf_extSoftVersion()
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From P|etro_te|@to @end|ng |rom hotm@||@com  Wed Jul 29 15:37:23 2020
From: P|etro_te|@to @end|ng |rom hotm@||@com (Pietro Andre Telatin Paschoalino)
Date: Wed, 29 Jul 2020 13:37:23 +0000
Subject: [R-sig-Geo] Doubt
Message-ID: <BN8PR17MB2980B289E663D2EAA605FB9082700@BN8PR17MB2980.namprd17.prod.outlook.com>

Hello everyone on the list.

I am a PhD student in Brazil and I have some doubts in the area of ??spatial econometrics, if anyone knows and can answer me I would be very grateful.

I'm using the spreg function from the sphet package. Sorry if I'm asking you an obvious question, but I couldn't solve it simply by looking in forums / reading the articles of the area.

Follow:

1- One of the arguments of the spreg function is called step1c, in this case, if I say TRUE, would I be using the efficient estimator of ?, if false, would it just be the consistent estimator? I verified that step1c = T, brings me the same result as the gstslshet function.

2- I am having problems estimating impact after spreg, depending on the versions of my packages, or I have an error (evalue not informed), not performing the estimation, or when I can perform it, a HAC correction is applied to my standard errors (even if I don't put the HAC option on my code) and all my p-values ??become insignificant (which is very strange since my estimators by lmsar or gstsls have significant impacts). Would you know to inform me if there is an alternative way to calculate the impacts?

As the HAC was applied to the impacts, I was also in doubt as to whether all the correction for heteroscedasticity is being done via HAC, even though I did not select this option in the models.

Thank you very much.

Pietro Andre Telatin Paschoalino


[https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-animated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=icon>    Virus-free. www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>

	[[alternative HTML version deleted]]


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Wed Jul 29 16:01:20 2020
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Wed, 29 Jul 2020 16:01:20 +0200
Subject: [R-sig-Geo] Help when moving from PROJ4 to PROJ6
In-Reply-To: <alpine.LFD.2.23.451.2007281517550.520703@reclus.nhh.no>
References: <77306D20-8D17-40AC-8721-532D169E1D40@gmail.com>
 <alpine.LFD.2.23.451.2007281517550.520703@reclus.nhh.no>
Message-ID: <a5f2defe-8fe0-f4dc-4f8d-f19595adf715@uni-muenster.de>

This seems to have been resolved now by reinstalling sf.

Re: axis order: sf will not swap coordinates by itself, it is only the
way x/y coordinates are interpreted that changes (for EPSG:4326 as
lng/lat by default, but as lat/lng after giving st_axis_order(TRUE)).

You need to do something to get them interpreted as lat/lng.

On 7/28/20 3:34 PM, Roger Bivand wrote:
> On Tue, 28 Jul 2020, Gilberto Camara wrote:
> 
>> Dear R-SIG-GEO (esp. Roger and Edzer)
>>
>> I am having problems with ?raster?, ?rgdal?, and ?sf? when moving from
>> PROJ4 to PROJ6. Roger?s explanation on the r-spatial blog
>> ("https://www.r-spatial.org/r/2020/03/17/wkt.html?) and the rgdal blog
>> (http://rgdal.r-forge.r-project.org/articles/PROJ6_GDAL3.html
>> <http://rgdal.r-forge.r-project.org/articles/PROJ6_GDAL3.html>) are
>> clear on the reasons why there are problems with CRS. As Roger points
>> out, ?package maintainers will need to review their use of crs
>> objects?. So very true!
>>
>> I appreciate the tremendous effort of Edzer and Roger for moving from
>> PROJ4 to PROJ6.
>>
>> However, I am failing to understand what is happening in the following
>> example:
>>
>> ================================================
>> library(sf)
> 
> Could you please report:
> 
> sf_extSoftVersion()
> 
> Mine are (on Linux, own PROJ & GDAL installations):
> 
> sf_extSoftVersion()
> ????????? GEOS?????????? GDAL???????? proj.4 GDAL_with_GEOS???? USE_PROJ_H
> ?????? "3.8.1"??????? "3.1.2"??????? "7.1.0"???????? "true"???????? "true"
> 
> where there is no change in the coordinates (there should not be a
> change as sf::st_crs() only sets the CRS (but may swap the axes as per
> specification).
> 
> I see:
> 
>> st_crs(ll_sfc2)
> Coordinate Reference System:
> ? User input: +proj=longlat +datum=WGS84 +no_defs
> ? wkt:
> GEOGCRS["unknown",
> ??? DATUM["World Geodetic System 1984",
> ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
> ??????????? LENGTHUNIT["metre",1]],
> ??????? ID["EPSG",6326]],
> ??? PRIMEM["Greenwich",0,
> ??????? ANGLEUNIT["degree",0.0174532925199433],
> ??????? ID["EPSG",8901]],
> ??? CS[ellipsoidal,2],
> ??????? AXIS["longitude",east,
> ??????????? ORDER[1],
> ??????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????? ID["EPSG",9122]]],
> ??????? AXIS["latitude",north,
> ??????????? ORDER[2],
> ??????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????? ID["EPSG",9122]]]]
> 
> but
> 
>> st_crs(ll_sfc)
> Coordinate Reference System:
> ? User input: EPSG:4326
> ? wkt:
> GEOGCRS["WGS 84",
> ??? DATUM["World Geodetic System 1984",
> ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
> ??????????? LENGTHUNIT["metre",1]]],
> ??? PRIMEM["Greenwich",0,
> ??????? ANGLEUNIT["degree",0.0174532925199433]],
> ??? CS[ellipsoidal,2],
> ??????? AXIS["geodetic latitude (Lat)",north,
> ??????????? ORDER[1],
> ??????????? ANGLEUNIT["degree",0.0174532925199433]],
> ??????? AXIS["geodetic longitude (Lon)",east,
> ??????????? ORDER[2],
> ??????????? ANGLEUNIT["degree",0.0174532925199433]],
> ??? USAGE[
> ??????? SCOPE["unknown"],
> ??????? AREA["World"],
> ??????? BBOX[-90,-180,90,180]],
> ??? ID["EPSG",4326]]
> 
> I can't see from
> https://www.r-spatial.org/r/2020/03/17/wkt.html#axis-order how to
> instantiate a crs object with non-authorized order.
> 
> In sp/rgdal:
> 
>> sp <- SpatialPoints(cbind(longitude, latitude), 
> proj4string=CRS("+proj=longlat +datum=WGS84"))
>> sp
> SpatialPoints:
> ???? longitude? latitude
> [1,] -55.62277 -11.75932
> Coordinate Reference System (CRS) arguments: +proj=longlat +datum=WGS84
> +no_defs
>> cat(wkt(sp), "\n")
> GEOGCRS["unknown",
> ??? DATUM["World Geodetic System 1984",
> ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
> ??????????? LENGTHUNIT["metre",1]],
> ??????? ID["EPSG",6326]],
> ??? PRIMEM["Greenwich",0,
> ??????? ANGLEUNIT["degree",0.0174532925199433],
> ??????? ID["EPSG",8901]],
> ??? CS[ellipsoidal,2],
> ??????? AXIS["longitude",east,
> ??????????? ORDER[1],
> ??????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????? ID["EPSG",9122]]],
> ??????? AXIS["latitude",north,
> ??????????? ORDER[2],
> ??????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????? ID["EPSG",9122]]]]
> 
>> sp2 <- SpatialPoints(cbind(longitude, latitude), 
> proj4string=CRS(SRS_string="EPSG:4326"))
>> sp2
> SpatialPoints:
> ???? longitude? latitude
> [1,] -55.62277 -11.75932
> Coordinate Reference System (CRS) arguments: +proj=longlat +datum=WGS84
> +no_defs
>> cat(wkt(sp2), "\n")
> GEOGCRS["WGS 84",
> ??? DATUM["World Geodetic System 1984",
> ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
> ??????????? LENGTHUNIT["metre",1]],
> ??????? ID["EPSG",6326]],
> ??? PRIMEM["Greenwich",0,
> ??????? ANGLEUNIT["degree",0.0174532925199433],
> ??????? ID["EPSG",8901]],
> ??? CS[ellipsoidal,2],
> ??????? AXIS["longitude",east,
> ??????????? ORDER[1],
> ??????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????? ID["EPSG",9122]]],
> ??????? AXIS["latitude",north,
> ??????????? ORDER[2],
> ??????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????? ID["EPSG",9122]]],
> ??? USAGE[
> ??????? SCOPE["unknown"],
> ??????? AREA["World"],
> ??????? BBOX[-90,-180,90,180]]]
> 
> where sp/rgdal enforces legacy/GIS/visualization axis order. Coercing
> from the EPSG:4326 sp/rgdal object to sfc gives the intended order:
> 
>> ll_sfc3 <- st_as_sfc(sp2)
>> ll_sfc3
> Geometry set for 1 feature
> geometry type:? POINT
> dimension:????? XY
> bbox:?????????? xmin: -55.62277 ymin: -11.75932 xmax: -55.62277 ymax:
> -11.75932
> geographic CRS: WGS 84
> POINT (-55.62277 -11.75932)
>> st_crs(ll_sfc3)
> Coordinate Reference System:
> ? User input: WGS 84
> ? wkt:
> GEOGCRS["WGS 84",
> ??? DATUM["World Geodetic System 1984",
> ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
> ??????????? LENGTHUNIT["metre",1]],
> ??????? ID["EPSG",6326]],
> ??? PRIMEM["Greenwich",0,
> ??????? ANGLEUNIT["degree",0.0174532925199433],
> ??????? ID["EPSG",8901]],
> ??? CS[ellipsoidal,2],
> ??????? AXIS["longitude",east,
> ??????????? ORDER[1],
> ??????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????? ID["EPSG",9122]]],
> ??????? AXIS["latitude",north,
> ??????????? ORDER[2],
> ??????????? ANGLEUNIT["degree",0.0174532925199433,
> ??????????????? ID["EPSG",9122]]],
> ??? USAGE[
> ??????? SCOPE["unknown"],
> ??????? AREA["World"],
> ??????? BBOX[-90,-180,90,180]]]
> 
> @Edzer - should we raise an sf issue, as st_crs<- appears not to respect
> st_axis_order()?
> 
> I'm not sure that this clarifies enough, but it's a start ...
> 
> Roger
> 
>>> longitude <- -55.62277
>>> latitude? <- -11.75932
>>
>>> st_point <- sf::st_point(c(longitude, latitude))
>>> ll_sfc?? <- sf::st_sfc(st_point, crs = "EPSG:4326")
>>
>>> ll_sfc[[1]]
>> POINT (-55.55527 -11.51782)
>>
>>> ll_sfc2 <- sf::st_sfc(st_point, crs = "+proj=longlat +datum=WGS84
>>> +no_defs?)
>>
>>> ll_sfc2[[1]]
>> POINT (-55.62277 -11.75932)
>> ==================================================
>>
>>> sessionInfo()
>> R version 4.0.1 (2020-06-06)
>> Platform: x86_64-apple-darwin17.0 (64-bit)
>> Running under: macOS Catalina 10.15.5
>>
>> attached base packages:
>> [1] stats???? graphics? grDevices utils???? datasets? methods?? base
>>
>> other attached packages:
>> [1] sf_0.9-5????? sits_0.9.5.1? raster_3.3-13 rgdal_1.5-12? sp_1.4-2
>> =====================================================================
>>
>> Why is using the EPSG code resulting in a different behaviour that
>> using the old PROJ4 text?
>>
>> Many thanks
>> Gilberto
>>
>> ===========================
>> Prof Dr Gilberto Camara
>> Secretariat Director
>> GEO - Group on Earth Observations
>> 7 bis, Avenue de La Paix
>> CH-1211 Geneva - Switzerland
>> Tel: +41227308480
>> www.earthobservations.org
>>
>>
>> ????[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48149 Muenster, Germany
Phone: +49 251 8333081

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pEpkey.asc
Type: application/pgp-keys
Size: 3110 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200729/5bb3203e/attachment.bin>

From @@g||@rd|5 @end|ng |rom c@mpu@@un|m|b@|t  Wed Jul 29 17:09:08 2020
From: @@g||@rd|5 @end|ng |rom c@mpu@@un|m|b@|t (Andrea Gilardi)
Date: Wed, 29 Jul 2020 17:09:08 +0200
Subject: [R-sig-Geo] Question on symmetric for nb2mat
Message-ID: <CA+Q+afH9rXSsMFY8Xsgiy73sCr9Oy3dtLfbME+HteSDuJLt+bw@mail.gmail.com>

Dear all, probably I'm missing something obvious but I have a question on
the matrix built using nb2mat with argument style = "B". More precisely, I
don't understand why the following code says that the matrix *W* (which
should be a binary first-order adjacency matrix) is not symmetric:













*library(spdep)library(rgdal)library(Matrix)# datanc.sids <-
readOGR(system.file("shapes/sids.shp", package = "spData"))adj <-
poly2nb(nc.sids)W <- as(nb2mat(adj, style = "B"),
"Matrix")Matrix::isSymmetric(W)#> [1] FALSEchol(W)#> Error in
asMethod(object): not a symmetric matrix; consider forceSymmetric() or
symmpart()*

Kind regards
Andrea

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Jul 29 17:16:54 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 29 Jul 2020 17:16:54 +0200
Subject: [R-sig-Geo] Doubt
In-Reply-To: <BN8PR17MB2980B289E663D2EAA605FB9082700@BN8PR17MB2980.namprd17.prod.outlook.com>
References: <BN8PR17MB2980B289E663D2EAA605FB9082700@BN8PR17MB2980.namprd17.prod.outlook.com>
Message-ID: <alpine.LFD.2.23.451.2007291712550.533578@reclus.nhh.no>

On Wed, 29 Jul 2020, Pietro Andre Telatin Paschoalino wrote:

> Hello everyone on the list.
>
> I am a PhD student in Brazil and I have some doubts in the area of 
> ??spatial econometrics, if anyone knows and can answer me I would be very 
> grateful.
>
> I'm using the spreg function from the sphet package. Sorry if I'm asking 
> you an obvious question, but I couldn't solve it simply by looking in 
> forums / reading the articles of the area.
>
> Follow:
>
> 1- One of the arguments of the spreg function is called step1c, in this
>    case, if I say TRUE, would I be using the efficient estimator of ?,
>    if false, would it just be the consistent estimator? I verified that
>    step1c = T, brings me the same result as the gstslshet function.

Please see the section on GMM, subsection spatial error model of:

https://www.jstatsoft.org/article/view/v063i18

>
> 2- I am having problems estimating impact after spreg, depending on the
>    versions of my packages, or I have an error (evalue not informed),
>    not performing the estimation, or when I can perform it, a HAC
>    correction is applied to my standard errors (even if I don't put the
>    HAC option on my code) and all my p-values ??become insignificant
>    (which is very strange since my estimators by lmsar or gstsls have
>    significant impacts). Would you know to inform me if there is an
>    alternative way to calculate the impacts?

Without knowing your current versions, nobody knows. Report the output of 
sessionInfo(), preferably for the minimal set of packages needed for a 
reproducible example (without tidyverse, which loads 50+ packages that are 
not relevant here).

>
> As the HAC was applied to the impacts, I was also in doubt as to whether 
> all the correction for heteroscedasticity is being done via HAC, even 
> though I did not select this option in the models.
>

Please provide a reproducible example using a built-in data set, posting 
in plain text to make copying from your message easier than from HTML, 
which often gets garbled.

Roger



> Thank you very much.
>
> Pietro Andre Telatin Paschoalino
>
>
> [https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-animated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=icon>    Virus-free. www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Wed Jul 29 17:19:31 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 29 Jul 2020 17:19:31 +0200
Subject: [R-sig-Geo] Question on symmetric for nb2mat
In-Reply-To: <CA+Q+afH9rXSsMFY8Xsgiy73sCr9Oy3dtLfbME+HteSDuJLt+bw@mail.gmail.com>
References: <CA+Q+afH9rXSsMFY8Xsgiy73sCr9Oy3dtLfbME+HteSDuJLt+bw@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007291717520.533578@reclus.nhh.no>

Please follow-up in this thread posting in plain text (not HTML). As you 
can see below, HTML garbles your message.

On Wed, 29 Jul 2020, Andrea Gilardi wrote:

> Dear all, probably I'm missing something obvious but I have a question on
> the matrix built using nb2mat with argument style = "B". More precisely, I
> don't understand why the following code says that the matrix *W* (which
> should be a binary first-order adjacency matrix) is not symmetric:
>
>
>
>
>
>
>
>
>
>
>
>
>
> *library(spdep)library(rgdal)library(Matrix)# datanc.sids <-
> readOGR(system.file("shapes/sids.shp", package = "spData"))adj <-
> poly2nb(nc.sids)W <- as(nb2mat(adj, style = "B"),
> "Matrix")Matrix::isSymmetric(W)#> [1] FALSEchol(W)#> Error in
> asMethod(object): not a symmetric matrix; consider forceSymmetric() or
> symmpart()*
>
> Kind regards
> Andrea
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From @@g||@rd|5 @end|ng |rom c@mpu@@un|m|b@|t  Wed Jul 29 17:32:00 2020
From: @@g||@rd|5 @end|ng |rom c@mpu@@un|m|b@|t (Andrea Gilardi)
Date: Wed, 29 Jul 2020 17:32:00 +0200
Subject: [R-sig-Geo] Question on symmetric for nb2mat
In-Reply-To: <alpine.LFD.2.23.451.2007291717520.533578@reclus.nhh.no>
References: <CA+Q+afH9rXSsMFY8Xsgiy73sCr9Oy3dtLfbME+HteSDuJLt+bw@mail.gmail.com>
 <alpine.LFD.2.23.451.2007291717520.533578@reclus.nhh.no>
Message-ID: <CA+Q+afEjr8xSd9BSTwRVMbfXLu=XN4PMRTatJS9+BSHjM40icg@mail.gmail.com>

Dear all, I think the following message should work. Excuse me for the
previous message.

library(spdep)
library(rgdal)
library(Matrix)

nc_sids <- readOGR(system.file("shapes/sids.shp", package = "spData"))
adj <- poly2nb(nc_sids)
W <- as(nb2mat(adj, style = "B"), "Matrix")
Matrix::isSymmetric(W)
chol(W)

If it's still not working I added a reprex here:
https://gist.github.com/agila5/59d3a173df9b1efabe13800f748a2d48

Kind regards
Andrea


Il giorno mer 29 lug 2020 alle ore 17:19 Roger Bivand <Roger.Bivand at nhh.no>
ha scritto:

> Please follow-up in this thread posting in plain text (not HTML). As you
> can see below, HTML garbles your message.
>
> On Wed, 29 Jul 2020, Andrea Gilardi wrote:
>
> > Dear all, probably I'm missing something obvious but I have a question on
> > the matrix built using nb2mat with argument style = "B". More precisely,
> I
> > don't understand why the following code says that the matrix *W* (which
> > should be a binary first-order adjacency matrix) is not symmetric:
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > *library(spdep)library(rgdal)library(Matrix)# datanc.sids <-
> > readOGR(system.file("shapes/sids.shp", package = "spData"))adj <-
> > poly2nb(nc.sids)W <- as(nb2mat(adj, style = "B"),
> > "Matrix")Matrix::isSymmetric(W)#> [1] FALSEchol(W)#> Error in
> > asMethod(object): not a symmetric matrix; consider forceSymmetric() or
> > symmpart()*
> >
> > Kind regards
> > Andrea
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed Jul 29 17:50:59 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 29 Jul 2020 17:50:59 +0200
Subject: [R-sig-Geo] Question on symmetric for nb2mat
In-Reply-To: <CA+Q+afEjr8xSd9BSTwRVMbfXLu=XN4PMRTatJS9+BSHjM40icg@mail.gmail.com>
References: <CA+Q+afH9rXSsMFY8Xsgiy73sCr9Oy3dtLfbME+HteSDuJLt+bw@mail.gmail.com>
 <alpine.LFD.2.23.451.2007291717520.533578@reclus.nhh.no>
 <CA+Q+afEjr8xSd9BSTwRVMbfXLu=XN4PMRTatJS9+BSHjM40icg@mail.gmail.com>
Message-ID: <alpine.LFD.2.23.451.2007291737560.533818@reclus.nhh.no>

On Wed, 29 Jul 2020, Andrea Gilardi wrote:

> Dear all, I think the following message should work. Excuse me for the
> previous message.
>
> library(spdep)
> library(rgdal)
> library(Matrix)
>
> nc_sids <- readOGR(system.file("shapes/sids.shp", package = "spData"))

Do things in steps:

adj <- poly2nb(nc_sids)
is.symmetric.nb(adj, force=TRUE)
# [1] TRUE


> W <- as(nb2mat(adj, style = "B"), "Matrix")

W0 <- nb2mat(adj, style = "B")
all(W0 == t(W0))
# [1] TRUE



> Matrix::isSymmetric(W)
> chol(W)

W <- as(W0, "symmetricMatrix")
isSymmetric(W)
#[1] TRUE
res <- chol(W)
#Error in asMethod(object) : not a positive definite matrix

This step makes little sense - why is it included?

I don't know why coercing to Matrix does not see the matrix as symmetric. 
Or:

lw <- nb2listw(adj, style="B")
library(spatialreg)
W <- as(lw, "CsparseMatrix")
#> isSymmetric(W)
#[1] TRUE

This works and is what you might need:

res <- chol((Diagonal(nrow(W)) - 0.1 * W))

or see ?Matrix::USCounties.

Roger


>
> If it's still not working I added a reprex here:
> https://gist.github.com/agila5/59d3a173df9b1efabe13800f748a2d48

Not useful, not in thread nor do any answers stay in thread.

>
> Kind regards
> Andrea
>
>
> Il giorno mer 29 lug 2020 alle ore 17:19 Roger Bivand <Roger.Bivand at nhh.no>
> ha scritto:
>
>> Please follow-up in this thread posting in plain text (not HTML). As you
>> can see below, HTML garbles your message.
>>
>> On Wed, 29 Jul 2020, Andrea Gilardi wrote:
>>
>>> Dear all, probably I'm missing something obvious but I have a question on
>>> the matrix built using nb2mat with argument style = "B". More precisely,
>> I
>>> don't understand why the following code says that the matrix *W* (which
>>> should be a binary first-order adjacency matrix) is not symmetric:
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> *library(spdep)library(rgdal)library(Matrix)# datanc.sids <-
>>> readOGR(system.file("shapes/sids.shp", package = "spData"))adj <-
>>> poly2nb(nc.sids)W <- as(nb2mat(adj, style = "B"),
>>> "Matrix")Matrix::isSymmetric(W)#> [1] FALSEchol(W)#> Error in
>>> asMethod(object): not a symmetric matrix; consider forceSymmetric() or
>>> symmpart()*
>>>
>>> Kind regards
>>> Andrea
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From p|etro_te|@to @end|ng |rom hotm@||@com  Wed Jul 29 19:59:10 2020
From: p|etro_te|@to @end|ng |rom hotm@||@com (Pietro Andre Telatin Paschoalino)
Date: Wed, 29 Jul 2020 17:59:10 +0000
Subject: [R-sig-Geo] Doubt
In-Reply-To: <alpine.LFD.2.23.451.2007291712550.533578@reclus.nhh.no>
References: <BN8PR17MB2980B289E663D2EAA605FB9082700@BN8PR17MB2980.namprd17.prod.outlook.com>,
 <alpine.LFD.2.23.451.2007291712550.533578@reclus.nhh.no>
Message-ID: <BN8PR17MB2980BF7560CBAB0B84306FFD82700@BN8PR17MB2980.namprd17.prod.outlook.com>

Professor, thank you very much for the answers.

First issue resolved. Step1c = T means that ? is estimated via 2SLS instead of GS2SLS, in this case the default of spreg = GS2SLS.

Second: As you can see most of my problems arising due to the estimation of impacts.

As I reported, I was not able to estimate them, because I was having the same error that you discussed here (however, my estimation is done via spreg and not gstslshet):

https://stat.ethz.ch/pipermail/r-sig-geo/2019-January/027068.html

On my last attempt I upgraded to the package under development on R-Forge 1.7-6.

In this case, follow the pattern below that I used to estimate the impacts:

W <- as (as_dgRMatrix_listw (k2.listw), "CsparseMatrix")
trMatc <- trW (W, type = "mult")
effects <- summary (impacts (obj, tr = trMatc, R = 10000), zstats = TRUE, short = TRUE)
effects

Following this structure, in the development version, I can advance a little.

When I estimate a SAC (SARAR) model (with an option for heteroskedacticity) the results seem to be correct, and my results are built through the GSTSLS covariance matrix (practically all significant).

However when I try to verify the same issue for a SAR model, I have the error:

Error in UseMethod ("impacts", obj):  no applicable method for 'impacts' applied to an object of class "c ('sphet', 'stsls_sphet')".

One way to estimate was by specifying the spatial package

effects <- summary (spatialreg :: impacts (SARrobust, tr = trMatc, R = 10000), zstats = TRUE, short = TRUE)

however, as I said, for some reason, it is using an IV HAC variance matrix (I don't assign this in my model - which caused me the confusion about the possibility of HAC being applied in all SAR cases):

Another attempt was to use spatialreg::impacts.stsls

I am not sure if it is the way to estimate the impacts, but, again, the matrix used was IV HAC and in this specific case everything becomes insignificant.

Follow my sessionInfo()

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
 [1] sphet_1.7-6       plm_2.2-3         tseries_0.10-47   lmtest_0.9-37     zoo_1.8-8         car_3.0-8         carData_3.0-4     spdep_1.1-5
 [9] sf_0.9-5          maptools_1.0-1    xlsx_0.6.3        rgeos_0.5-3       rgdal_1.5-10      sp_1.4-2          shape_1.4.4       maps_3.3.0
[17] spDataLarge_0.4.1 spatialreg_1.1-5  Matrix_1.2-18     spData_0.3.8

loaded via a namespace (and not attached):
 [1] splines_3.6.2      gtools_3.8.2       Formula_1.2-3      Rdpack_0.11-1      expm_0.999-4       TTR_0.23-6         xlsxjars_0.6.1
 [8] cellranger_1.1.0   LearnBayes_2.15.1  pillar_1.4.4       lattice_0.20-41    glue_1.4.1         quadprog_1.5-8     digest_0.6.25
[15] sandwich_2.5-1     pkgconfig_2.0.3    bibtex_0.4.2.2     raster_3.3-7       haven_2.3.1        gmodels_2.18.1     purrr_0.3.4
[22] gdata_2.18.0       openxlsx_4.1.5     rio_0.5.16         tibble_3.0.1       generics_0.0.2     ellipsis_0.3.1     maxLik_1.3-8
[29] quantmod_0.4.17    magrittr_1.5       crayon_1.3.4       readxl_1.3.1       deldir_0.1-25      nlme_3.1-142       MASS_7.3-51.4
[36] forcats_0.5.0      xts_0.12-0         foreign_0.8-72     class_7.3-15       tools_3.6.2        data.table_1.12.8  hms_0.5.3
[43] gbRd_0.4-11        lifecycle_0.2.0    stringr_1.4.0      zip_2.0.4          compiler_3.6.2     e1071_1.7-3        rlang_0.4.7
[50] classInt_0.4-3     units_0.6-7        grid_3.6.2         miscTools_0.6-26   rstudioapi_0.11    boot_1.3-23        codetools_0.2-16
[57] abind_1.4-5        DBI_1.1.0          curl_4.3           R6_2.4.1           bdsmatrix_1.3-4    dplyr_1.0.0        KernSmooth_2.23-16
[64] rJava_0.9-12       stringi_1.4.6      Rcpp_1.0.5         vctrs_0.3.1        tidyselect_1.1.0   coda_0.19-3

Thank you.

Pietro Andre Telatin Paschoalino
Doutorando em Ci?ncias Econ?micas da Universidade Estadual de Maring? - PCE.

________________________________
De: Roger Bivand <Roger.Bivand at nhh.no>
Enviado: quarta-feira, 29 de julho de 2020 12:16
Para: Pietro Andre Telatin Paschoalino <Pietro_telato at hotmail.com>
Cc: r-sig-geo at r-project.org <r-sig-geo at r-project.org>
Assunto: Re: [R-sig-Geo] Doubt

On Wed, 29 Jul 2020, Pietro Andre Telatin Paschoalino wrote:

> Hello everyone on the list.
>
> I am a PhD student in Brazil and I have some doubts in the area of
> ??spatial econometrics, if anyone knows and can answer me I would be very
> grateful.
>
> I'm using the spreg function from the sphet package. Sorry if I'm asking
> you an obvious question, but I couldn't solve it simply by looking in
> forums / reading the articles of the area.
>
> Follow:
>
> 1- One of the arguments of the spreg function is called step1c, in this
>    case, if I say TRUE, would I be using the efficient estimator of ?,
>    if false, would it just be the consistent estimator? I verified that
>    step1c = T, brings me the same result as the gstslshet function.

Please see the section on GMM, subsection spatial error model of:

https://www.jstatsoft.org/article/view/v063i18

>
> 2- I am having problems estimating impact after spreg, depending on the
>    versions of my packages, or I have an error (evalue not informed),
>    not performing the estimation, or when I can perform it, a HAC
>    correction is applied to my standard errors (even if I don't put the
>    HAC option on my code) and all my p-values ??become insignificant
>    (which is very strange since my estimators by lmsar or gstsls have
>    significant impacts). Would you know to inform me if there is an
>    alternative way to calculate the impacts?

Without knowing your current versions, nobody knows. Report the output of
sessionInfo(), preferably for the minimal set of packages needed for a
reproducible example (without tidyverse, which loads 50+ packages that are
not relevant here).

>
> As the HAC was applied to the impacts, I was also in doubt as to whether
> all the correction for heteroscedasticity is being done via HAC, even
> though I did not select this option in the models.
>

Please provide a reproducible example using a built-in data set, posting
in plain text to make copying from your message easier than from HTML,
which often gets garbled.

Roger



> Thank you very much.
>
> Pietro Andre Telatin Paschoalino
>
>
> [https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-animated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=icon>    Virus-free. www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>
>
>        [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

[https://ipmcdn.avast.com/images/icons/icon-envelope-tick-round-orange-animated-no-repeat-v1.gif]<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=icon>    Virus-free. www.avast.com<https://www.avast.com/sig-email?utm_medium=email&utm_source=link&utm_campaign=sig-email&utm_content=webmail&utm_term=link>

	[[alternative HTML version deleted]]


From @@g||@rd|5 @end|ng |rom c@mpu@@un|m|b@|t  Wed Jul 29 21:38:38 2020
From: @@g||@rd|5 @end|ng |rom c@mpu@@un|m|b@|t (Andrea Gilardi)
Date: Wed, 29 Jul 2020 21:38:38 +0200
Subject: [R-sig-Geo] Question on symmetric for nb2mat
In-Reply-To: <alpine.LFD.2.23.451.2007291737560.533818@reclus.nhh.no>
References: <CA+Q+afH9rXSsMFY8Xsgiy73sCr9Oy3dtLfbME+HteSDuJLt+bw@mail.gmail.com>
 <alpine.LFD.2.23.451.2007291717520.533578@reclus.nhh.no>
 <CA+Q+afEjr8xSd9BSTwRVMbfXLu=XN4PMRTatJS9+BSHjM40icg@mail.gmail.com>
 <alpine.LFD.2.23.451.2007291737560.533818@reclus.nhh.no>
Message-ID: <CA+Q+afHVKXcDkmDNdXMpkq6C80k33DjmmTdzXLA8e7j-kwA5kQ@mail.gmail.com>

Dear Prof. Bivand, thank you very much for the super quick reply and fix.
The approach using *spatialreg* and as(x, "CsparseMatrix") works perfectly.

This step makes little sense - why is it included?
>

I included the Cholesky decomposition since I found this problem while I
was estimating the Cholesky decomposition of a precision matrix in a
multivariate CAR model (as you probably guessed) and the function *chol *was
complaining that D - alpha * W was not symmetric (where D is a diagonal
matrix with the total number of neighbours for each spatial unit and alpha
is the parameter controlling the strength in the proper CAR model). D is
clearly symmetric by construction so the problem was with W and I couldn't
understand why. I did not include all the details about how or why I found
the error because I think they were not important but, unfortunately, the
example with *chol(W)* is also meaningless.

Anyway thank you very much for the solution and the other suggestions.
Kind regards
Andrea









Il giorno mer 29 lug 2020 alle ore 17:51 Roger Bivand <Roger.Bivand at nhh.no>
ha scritto:

> On Wed, 29 Jul 2020, Andrea Gilardi wrote:
>
> > Dear all, I think the following message should work. Excuse me for the
> > previous message.
> >
> > library(spdep)
> > library(rgdal)
> > library(Matrix)
> >
> > nc_sids <- readOGR(system.file("shapes/sids.shp", package = "spData"))
>
> Do things in steps:
>
> adj <- poly2nb(nc_sids)
> is.symmetric.nb(adj, force=TRUE)
> # [1] TRUE
>
>
> > W <- as(nb2mat(adj, style = "B"), "Matrix")
>
> W0 <- nb2mat(adj, style = "B")
> all(W0 == t(W0))
> # [1] TRUE
>
>
>
> > Matrix::isSymmetric(W)
> > chol(W)
>
> W <- as(W0, "symmetricMatrix")
> isSymmetric(W)
> #[1] TRUE
> res <- chol(W)
> #Error in asMethod(object) : not a positive definite matrix
>
> This step makes little sense - why is it included?
>
> I don't know why coercing to Matrix does not see the matrix as symmetric.
> Or:
>
> lw <- nb2listw(adj, style="B")
> library(spatialreg)
> W <- as(lw, "CsparseMatrix")
> #> isSymmetric(W)
> #[1] TRUE
>
> This works and is what you might need:
>
> res <- chol((Diagonal(nrow(W)) - 0.1 * W))
>
> or see ?Matrix::USCounties.
>
> Roger
>
>
> >
> > If it's still not working I added a reprex here:
> > https://gist.github.com/agila5/59d3a173df9b1efabe13800f748a2d48
>
> Not useful, not in thread nor do any answers stay in thread.
>
> >
> > Kind regards
> > Andrea
> >
> >
> > Il giorno mer 29 lug 2020 alle ore 17:19 Roger Bivand <
> Roger.Bivand at nhh.no>
> > ha scritto:
> >
> >> Please follow-up in this thread posting in plain text (not HTML). As you
> >> can see below, HTML garbles your message.
> >>
> >> On Wed, 29 Jul 2020, Andrea Gilardi wrote:
> >>
> >>> Dear all, probably I'm missing something obvious but I have a question
> on
> >>> the matrix built using nb2mat with argument style = "B". More
> precisely,
> >> I
> >>> don't understand why the following code says that the matrix *W* (which
> >>> should be a binary first-order adjacency matrix) is not symmetric:
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>> *library(spdep)library(rgdal)library(Matrix)# datanc.sids <-
> >>> readOGR(system.file("shapes/sids.shp", package = "spData"))adj <-
> >>> poly2nb(nc.sids)W <- as(nb2mat(adj, style = "B"),
> >>> "Matrix")Matrix::isSymmetric(W)#> [1] FALSEchol(W)#> Error in
> >>> asMethod(object): not a symmetric matrix; consider forceSymmetric() or
> >>> symmpart()*
> >>>
> >>> Kind regards
> >>> Andrea
> >>>
> >>>       [[alternative HTML version deleted]]
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>
> >> --
> >> Roger Bivand
> >> Department of Economics, Norwegian School of Economics,
> >> Helleveien 30, N-5045 Bergen, Norway.
> >> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >> https://orcid.org/0000-0003-2392-6140
> >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>

	[[alternative HTML version deleted]]


