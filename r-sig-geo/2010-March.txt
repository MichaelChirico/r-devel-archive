From mayeul.kauffmann at free.fr  Mon Mar  1 00:11:15 2010
From: mayeul.kauffmann at free.fr (Mayeul Kauffmann)
Date: Mon, 01 Mar 2010 00:11:15 +0100
Subject: [R-sig-Geo] Least Cost Path/Corridor
In-Reply-To: <aa7630001002191003u28ebfd87v7098ec5aa429c253@mail.gmail.com>
References: <aa7630001002191003u28ebfd87v7098ec5aa429c253@mail.gmail.com>
Message-ID: <1267398675.4771.26.camel@mk-desktop-smh>

Maybe what you are looking for:

Package gdistance (in active development): distances and movements on
geographical grids     

Calculate distances and other measures using models/algorithms for
movements on geographic grids (least-cost path, random walk, randomises
shortest paths)

http://r-forge.r-project.org/projects/gdistance/

You'll find there the email of the developper (Jacob van Etten) who
might send you a more recent version.
Regards,
Mayeul

Le vendredi 19 f?vrier 2010 ? 19:03 +0100, Johannes Signer a ?crit :
> Dear List,
> 
> is anyone of you aware for a R package that has a least cost path/corridor
> algorithm implemented. I couldn't find anything over rseek, google and the
> package list.
> 
> Thanks and greetings
> 
> Johannes
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From e.jahanshiri at gmail.com  Mon Mar  1 10:23:07 2010
From: e.jahanshiri at gmail.com (Ebrahim Jahanshiri)
Date: Mon, 1 Mar 2010 17:23:07 +0800
Subject: [R-sig-Geo] Back-transforming krigged variables
Message-ID: <b0a6ce471003010123v3eaa92feqa60b944e08c34877@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100301/5602e8db/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Mar  1 13:26:23 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 01 Mar 2010 13:26:23 +0100
Subject: [R-sig-Geo] Back-transforming krigged variables
In-Reply-To: <b0a6ce471003010123v3eaa92feqa60b944e08c34877@mail.gmail.com>
References: <b0a6ce471003010123v3eaa92feqa60b944e08c34877@mail.gmail.com>
Message-ID: <4B8BB26F.6020603@uni-muenster.de>

Ebrahim Jahanshiri wrote:
> I am wondering if there is any function or option to back-transform the
> result of the lognormal kriging in gstat yet.
>   
You can use krigeTg, which does trans-Gaussian kriging for all Box-Cox 
transforms; passing it a lambda parameter with value 0, log-normal 
kriging is used. Pls look at the examples, the back-transformed values 
have funny names like var1TG.pred.

The whole think has been implemented for ordinary kriging only; if 
someone can point me out a source that describes how to do this for 
universal / external drift kriging, I'd be happy to look into how to 
implement it.
> Although for simple kriging it is fairly straight forward, that is, it is
> possible to do back-transform using the vector of predicted values and
> kriging variances, but for ordinary kriging, it might be difficult because
> we dont have lagrange multiplier (according to my web help search) to do the
> back-transformation. I am wondering if there has been any advancement in
> that matter?
>
> thank you
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Giovanna.Jonalasinio at uniroma1.it  Mon Mar  1 16:02:55 2010
From: Giovanna.Jonalasinio at uniroma1.it (Giovanna.Jonalasinio at uniroma1.it)
Date: Mon, 1 Mar 2010 16:02:55 +0100
Subject: [R-sig-Geo] =?iso-8859-1?q?Giovanna_Jonalasinio_=E8_fuori_ufficio?=
	=?iso-8859-1?q?=2C_I=27m_away?=
Message-ID: <OFAED22CC1.D30F6E81-ONC12576D9.0052AA57-C12576D9.0052AA57@Uniroma1.it>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100301/4e1db229/attachment.pl>

From ogbos.okike at gmail.com  Mon Mar  1 19:06:55 2010
From: ogbos.okike at gmail.com (ogbos okike)
Date: Mon, 1 Mar 2010 20:06:55 +0200
Subject: [R-sig-Geo] gpc cloud data files
Message-ID: <43b418581003011006p2a206c9fta88d772979def6b1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100301/edb57927/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Mar  1 19:16:46 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 1 Mar 2010 18:16:46 +0000
Subject: [R-sig-Geo] gpc cloud data files
In-Reply-To: <43b418581003011006p2a206c9fta88d772979def6b1@mail.gmail.com>
References: <43b418581003011006p2a206c9fta88d772979def6b1@mail.gmail.com>
Message-ID: <d8ad40b51003011016q1b52dc92rb106b7c24287b1a1@mail.gmail.com>

On Mon, Mar 1, 2010 at 6:06 PM, ogbos okike <ogbos.okike at gmail.com> wrote:
> Happy New Year.
>
> I have some cloud data files (e.g. ISCCP.D2.0.GLOBAL.1983.07.99.0000.GPC)
> and wish to analyze them in R. This is my first time of encountering this
> sort of file. I have searched for .gpc files in R and understand that gpclib
> package may be a way out. However, I need a hint to start from somewhere.
>
> I would be most grateful if anybody could give me a tip.

 What do you expect it to be? Gridded raster data or vector polygon
outlines? Or points? The GPC documentation only mentions one file
format, a text-based one that looks like this
[http://www.cs.man.ac.uk/~toby/alan/software/gpc.html]

"""
For example, a single polygon consisting of a triangular hole within a
quadrilateral (with hole flags included) may take the form:
          2
          3
          1
            4.0   4.0
            6.0   5.0
            5.0   6.0
          4
          0
            2.0   1.0
            8.0   2.0
            7.0   9.0
            1.0   7.0
"""

 Do your files look like that when you open them in a text editor?

 Or tell us where you got them from if we can download them ourselves,
we'll have a better chance of helping!

Barry


-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From cswingle at gmail.com  Mon Mar  1 20:03:06 2010
From: cswingle at gmail.com (Christopher Swingley)
Date: Mon, 1 Mar 2010 10:03:06 -0900
Subject: [R-sig-Geo] Clipping grid using shapefile?
Message-ID: <20100301190306.GB2817@abrinc.com>

Greetings!

I'm quite new to the spatial functions in R (and to R as well), and am
having trouble getting R to clip an ASCII grid using a shapefile raster.

What I've got are ASCII grids that store climatological variables (one
grid for each variable; temperature, precip, etc.).  I also have a
shapefile containing a series of watershed polygons.  What I want to do
is clip the ASCII grid using each polygon in the shapefile and calculate
the mean and standard deviation of the climate data within each polygon.

Reading the data in:

  > library(rgdal)
  > library(sp)
  > vector <- readOGR("shapefiles", "watersheds")
  > ppt01 <- readGDAL("ppt01.asc")
  > proj4string(ppt01) <- CRS("+proj=aea +lat_1=55 +lat_2=65 +lat_0=50
    +lon_0=-154 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs
    +towgs84=0,0,0")

I think overlay() is the function I want, but I'm not getting the
results I expect.  After the clipping, I'd like to be able to do:

  > means <- mean(ppt01_clip, na.rm = TRUE)
  > sds < -sd(ppt01_clip, na.rm = TRUE)

And get a table of watershed IDs with their means, and a table of
watershed IDs with their standard deviations.

Thanks,

Chris
-- 
Christopher S. Swingley
http://swingleydev.com/
<cswingle at gmail.com>


From edzer.pebesma at uni-muenster.de  Mon Mar  1 20:35:39 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 01 Mar 2010 20:35:39 +0100
Subject: [R-sig-Geo] Clipping grid using shapefile?
In-Reply-To: <20100301190306.GB2817@abrinc.com>
References: <20100301190306.GB2817@abrinc.com>
Message-ID: <4B8C170B.6070600@uni-muenster.de>

Hi Chris,

please tell us what was unexpected after you overlayed vector and ppt01.

Christopher Swingley wrote:
> Greetings!
>
> I'm quite new to the spatial functions in R (and to R as well), and am
> having trouble getting R to clip an ASCII grid using a shapefile raster.
>
> What I've got are ASCII grids that store climatological variables (one
> grid for each variable; temperature, precip, etc.).  I also have a
> shapefile containing a series of watershed polygons.  What I want to do
> is clip the ASCII grid using each polygon in the shapefile and calculate
> the mean and standard deviation of the climate data within each polygon.
>
> Reading the data in:
>
>   > library(rgdal)
>   > library(sp)
>   > vector <- readOGR("shapefiles", "watersheds")
>   > ppt01 <- readGDAL("ppt01.asc")
>   > proj4string(ppt01) <- CRS("+proj=aea +lat_1=55 +lat_2=65 +lat_0=50
>     +lon_0=-154 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs
>     +towgs84=0,0,0")
>
> I think overlay() is the function I want, but I'm not getting the
> results I expect.  After the clipping, I'd like to be able to do:
>
>   > means <- mean(ppt01_clip, na.rm = TRUE)
>   > sds < -sd(ppt01_clip, na.rm = TRUE)
>
> And get a table of watershed IDs with their means, and a table of
> watershed IDs with their standard deviations.
>
> Thanks,
>
> Chris
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From cswingle at gmail.com  Mon Mar  1 21:38:22 2010
From: cswingle at gmail.com (Christopher Swingley)
Date: Mon, 1 Mar 2010 11:38:22 -0900
Subject: [R-sig-Geo] Clipping grid using shapefile?
In-Reply-To: <4B8C170B.6070600@uni-muenster.de>
References: <20100301190306.GB2817@abrinc.com>
	<4B8C170B.6070600@uni-muenster.de>
Message-ID: <20100301203822.GD2817@abrinc.com>

Edzer,

* Edzer Pebesma <edzer.pebesma at uni-muenster.de> [2010-Mar-01 10:35 AKST]:
> >Reading the data in:
> >
> >  > library(rgdal)
> >  > library(sp)
> >  > vector <- readOGR("shapefiles", "watersheds")
> >  > ppt01 <- readGDAL("ppt01.asc")
> >  > proj4string(ppt01) <- CRS("+proj=aea +lat_1=55 +lat_2=65 +lat_0=50
> >    +lon_0=-154 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs
> >    +towgs84=0,0,0")
>
> please tell us what was unexpected after you overlayed vector and
> ppt01.

When I loaded vector R said:

    with 23 features and 10 fields

When I overlay:

    > clip <- overlay(ppt01, vector)
    > class(clip)
    [1] "integer"
    > summary(clip)
    Min.  1st Qu.  Median   Mean   3rd Qu.  Max.
   1.000    5.000   7.000  7.564  11.000   23.000
    NA's
    20196990.000

I guess I was thinking I'd get something that had 23 rows in it, one for
each polygon in the vector file.

I tried something like this:

    > clip <- overlay(ppt01, vector[vector$SITECODE=='A-001',])

and got:

    > summary(clip)
     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's
      1        1        1        1        1        1   20199300
    > mean(clip, na.rm = TRUE)
     [1] 1
    > clip[!is.na(clip)]
     [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1


There's a total of (3505*5763 = 20199315 rows), so it's calculating it's
mean from 15 points.  When I use GDAL tools (gdal_translate to project
the ASC file to a TIF, gdal_rasterize to burn the shapefile polygon), I
also get 15 grid values, but the range of numbers is between 1691 to
2645 (not 1 to 1).

It seems like I'm very close, but am missing something simple.

Thanks,

Chris
-- 
Christopher S. Swingley
http://swingleydev.com/
<cswingle at gmail.com>


From cswingle at gmail.com  Mon Mar  1 21:48:02 2010
From: cswingle at gmail.com (Christopher Swingley)
Date: Mon, 1 Mar 2010 11:48:02 -0900
Subject: [R-sig-Geo] Clipping grid using shapefile?
In-Reply-To: <20100301203822.GD2817@abrinc.com>
References: <20100301190306.GB2817@abrinc.com>
	<4B8C170B.6070600@uni-muenster.de>
	<20100301203822.GD2817@abrinc.com>
Message-ID: <20100301204802.GE2817@abrinc.com>

> I tried something like this:
> 
>     > clip <- overlay(ppt01, vector[vector$SITECODE=='A-001',])
> 
> and got:
> 
>     > summary(clip)
>      Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's
>       1        1        1        1        1        1   20199300
>     > mean(clip, na.rm = TRUE)
>      [1] 1
>     > clip[!is.na(clip)]
>      [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1

Sorry to reply to my own post, but now that I think about this, it looks
like 'clip' is a raster containing 1's where there's data and NA where
there isn't.  This makes me think that something like this:

    > mean(ppt01[clip,], na.rm = TRUE)

would give me the mean that I want.  Unfortunately, I get this:

    *** caught segfault ***
    address 0x7f626f27c758, cause 'memory not mapped'

    Traceback:
     1: ppt01[clip, ]
     2: mean(ppt01[clip, ], na.rm = TRUE)

Is there a more memory efficient way to do this, especially since I'm
dealing with 15 data points out of 20,199,315?

Thanks,

Chris
-- 
Christopher S. Swingley
http://swingleydev.com/
<cswingle at gmail.com>


From lannajin at gmail.com  Mon Mar  1 22:08:42 2010
From: lannajin at gmail.com (Lanna Jin)
Date: Mon, 1 Mar 2010 15:08:42 -0600
Subject: [R-sig-Geo] Question about convert.to.shapefile
Message-ID: <397fe8b41003011308w31ac745er431c5b8bdf206921@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100301/86c847f6/attachment.pl>

From greenberg at ucdavis.edu  Mon Mar  1 23:17:11 2010
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Mon, 1 Mar 2010 14:17:11 -0800
Subject: [R-sig-Geo] rgdal and grass rasters
Message-ID: <e4ca87521003011417x97b8c62rc0f818de72544e9f@mail.gmail.com>

Folks: when trying to import or GDALinfo a grass raster, where,
exactly, should I be pointing to in the grass directory?  I tried
pointing to the file with the same name as the raster I want to work
with in the fcell, cellhd, and cell directories
(grass/location/mapset), but none of these are working...  thanks!

--j


From greenberg at ucdavis.edu  Tue Mar  2 01:42:53 2010
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Mon, 1 Mar 2010 16:42:53 -0800
Subject: [R-sig-Geo] rgdal and grass rasters
In-Reply-To: <efb536d51003011435r66e52933t51f7c888195846fd@mail.gmail.com>
References: <e4ca87521003011417x97b8c62rc0f818de72544e9f@mail.gmail.com>
	<efb536d51003011435r66e52933t51f7c888195846fd@mail.gmail.com>
Message-ID: <e4ca87521003011642g46096131w8dca9767d5e909fc@mail.gmail.com>

Hmm, I'm trying to use the raster package via rgdal to access these
files -- I'm trying to avoid having to export then to another format
(I'm dealing with gigabytes of rasters), although I suppose I could do
this.  Does spgrass6 "enable" rgdal to access GRASS rasters, or is it
its own standalone program?  How does the base gdal package work with
grass rasters?

--j

On Mon, Mar 1, 2010 at 2:35 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
> I think you need to export it from grass first, with r.out.gdal
>
> Or you can use spgrass6 to work with R and GRASS directly.
>
> Sarah
>
> On Mon, Mar 1, 2010 at 5:17 PM, Jonathan Greenberg
> <greenberg at ucdavis.edu> wrote:
>> Folks: when trying to import or GDALinfo a grass raster, where,
>> exactly, should I be pointing to in the grass directory? ?I tried
>> pointing to the file with the same name as the raster I want to work
>> with in the fcell, cellhd, and cell directories
>> (grass/location/mapset), but none of these are working... ?thanks!
>>
>
>
>
> --
> Sarah Goslee
> http://www.functionaldiversity.org
>


From tech_dev at wildintellect.com  Tue Mar  2 02:44:17 2010
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Mon, 01 Mar 2010 17:44:17 -0800
Subject: [R-sig-Geo] rgdal and grass rasters
In-Reply-To: <e4ca87521003011642g46096131w8dca9767d5e909fc@mail.gmail.com>
References: <e4ca87521003011417x97b8c62rc0f818de72544e9f@mail.gmail.com>	<efb536d51003011435r66e52933t51f7c888195846fd@mail.gmail.com>
	<e4ca87521003011642g46096131w8dca9767d5e909fc@mail.gmail.com>
Message-ID: <4B8C6D71.4030004@wildintellect.com>

spgrass6 is a an R package and has read/write access to GRASS datasets.
It's usage would be instead of rgdal(well sorta, rgdal is required by
spgrass6). Both write objects to sp types.
You can use it from within R to start a GRASS session or within GRASS to
start a linked R session.
http://cran.r-project.org/web/packages/spgrass6/index.html

I got GDALinfo to work on my machine, I wonder if your just missing the
gdal-grass library, or libgrass.

On ubuntu it's something like libgdal1-1.6.0-grass
I know qgis needs this to work with GRASS not sure about gdal itself but
based on http://gdal.org/frmt_grass.html probably. Also note that page
talks about the path to a dataset that should be used.


Thanks,
Alex

> Hmm, I'm trying to use the raster package via rgdal to access these
> files -- I'm trying to avoid having to export then to another format
> (I'm dealing with gigabytes of rasters), although I suppose I could do
> this.  Does spgrass6 "enable" rgdal to access GRASS rasters, or is it
> its own standalone program?  How does the base gdal package work with
> grass rasters?
> 
> --j
> 
> On Mon, Mar 1, 2010 at 2:35 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
>> I think you need to export it from grass first, with r.out.gdal
>>
>> Or you can use spgrass6 to work with R and GRASS directly.
>>
>> Sarah
>>
>> On Mon, Mar 1, 2010 at 5:17 PM, Jonathan Greenberg
>> <greenberg at ucdavis.edu> wrote:
>>> Folks: when trying to import or GDALinfo a grass raster, where,
>>> exactly, should I be pointing to in the grass directory?  I tried
>>> pointing to the file with the same name as the raster I want to work
>>> with in the fcell, cellhd, and cell directories
>>> (grass/location/mapset), but none of these are working...  thanks!
>>>
>>
>>
>> --
>> Sarah Goslee
>> http://www.functionaldiversity.org
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From dylan.beaudette at gmail.com  Tue Mar  2 03:04:51 2010
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Mon, 1 Mar 2010 18:04:51 -0800
Subject: [R-sig-Geo] rgdal and grass rasters
In-Reply-To: <4B8C6D71.4030004@wildintellect.com>
References: <e4ca87521003011417x97b8c62rc0f818de72544e9f@mail.gmail.com>
	<efb536d51003011435r66e52933t51f7c888195846fd@mail.gmail.com>
	<e4ca87521003011642g46096131w8dca9767d5e909fc@mail.gmail.com>
	<4B8C6D71.4030004@wildintellect.com>
Message-ID: <3c5546141003011804r79e2b2b9p7631b32726ea82d7@mail.gmail.com>

Roger can likely point out the problem after some example code is
posted. In the mean time I would suggest checking to make sure your
GDAL is compiled _without_ GRASS support, and that the GDAL GRASS
plugin is correctly installed.

This is how I check on my machine:

gdal_translate --formats | grep -i grass
  GRASS (ro): GRASS Database Rasters (5.7+)

Cheers,
Dylan

On Mon, Mar 1, 2010 at 5:44 PM, Alex Mandel <tech_dev at wildintellect.com> wrote:
> spgrass6 is a an R package and has read/write access to GRASS datasets.
> It's usage would be instead of rgdal(well sorta, rgdal is required by
> spgrass6). Both write objects to sp types.
> You can use it from within R to start a GRASS session or within GRASS to
> start a linked R session.
> http://cran.r-project.org/web/packages/spgrass6/index.html
>
> I got GDALinfo to work on my machine, I wonder if your just missing the
> gdal-grass library, or libgrass.
>
> On ubuntu it's something like libgdal1-1.6.0-grass
> I know qgis needs this to work with GRASS not sure about gdal itself but
> based on http://gdal.org/frmt_grass.html probably. Also note that page
> talks about the path to a dataset that should be used.
>
>
> Thanks,
> Alex
>
>> Hmm, I'm trying to use the raster package via rgdal to access these
>> files -- I'm trying to avoid having to export then to another format
>> (I'm dealing with gigabytes of rasters), although I suppose I could do
>> this. ?Does spgrass6 "enable" rgdal to access GRASS rasters, or is it
>> its own standalone program? ?How does the base gdal package work with
>> grass rasters?
>>
>> --j
>>
>> On Mon, Mar 1, 2010 at 2:35 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
>>> I think you need to export it from grass first, with r.out.gdal
>>>
>>> Or you can use spgrass6 to work with R and GRASS directly.
>>>
>>> Sarah
>>>
>>> On Mon, Mar 1, 2010 at 5:17 PM, Jonathan Greenberg
>>> <greenberg at ucdavis.edu> wrote:
>>>> Folks: when trying to import or GDALinfo a grass raster, where,
>>>> exactly, should I be pointing to in the grass directory? ?I tried
>>>> pointing to the file with the same name as the raster I want to work
>>>> with in the fcell, cellhd, and cell directories
>>>> (grass/location/mapset), but none of these are working... ?thanks!
>>>>
>>>
>>>
>>> --
>>> Sarah Goslee
>>> http://www.functionaldiversity.org
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From greenberg at ucdavis.edu  Tue Mar  2 03:45:00 2010
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Mon, 1 Mar 2010 18:45:00 -0800
Subject: [R-sig-Geo] rgdal and grass rasters
In-Reply-To: <3c5546141003011804r79e2b2b9p7631b32726ea82d7@mail.gmail.com>
References: <e4ca87521003011417x97b8c62rc0f818de72544e9f@mail.gmail.com>
	<efb536d51003011435r66e52933t51f7c888195846fd@mail.gmail.com>
	<e4ca87521003011642g46096131w8dca9767d5e909fc@mail.gmail.com>
	<4B8C6D71.4030004@wildintellect.com>
	<3c5546141003011804r79e2b2b9p7631b32726ea82d7@mail.gmail.com>
Message-ID: <e4ca87521003011845r7edfc9bdhe305c36441713863@mail.gmail.com>

As far as sample code goes, simply getting
grass_to_raster=raster("somegrassfile") is my goal -- my understanding
is anything rgdal can read, raster can read.  Running your command I
do get:

GRASS (ro): GRASS Database Rasters (5.7+)

But with rgdal:

require(rgdal)
gdaldrivers=getGDALDriverNames()
gdaldrivers$create[gdaldrivers$name=="GRASS"]
[1] FALSE
gdaldrivers$copy[gdaldrivers$name=="GRASS"]
[1] FALSE
gdaldrivers$create[gdaldrivers$name=="GTiff"]
[1] TRUE
gdaldrivers$copy[gdaldrivers$name=="GTiff"]
[1] TRUE

Am I perhaps missing an rgdal installation flag that is required to
enable GRASS rasters?

--j

On Mon, Mar 1, 2010 at 6:04 PM, Dylan Beaudette
<dylan.beaudette at gmail.com> wrote:
> Roger can likely point out the problem after some example code is
> posted. In the mean time I would suggest checking to make sure your
> GDAL is compiled _without_ GRASS support, and that the GDAL GRASS
> plugin is correctly installed.
>
> This is how I check on my machine:
>
> gdal_translate --formats | grep -i grass
> ?GRASS (ro): GRASS Database Rasters (5.7+)
>
> Cheers,
> Dylan
>
> On Mon, Mar 1, 2010 at 5:44 PM, Alex Mandel <tech_dev at wildintellect.com> wrote:
>> spgrass6 is a an R package and has read/write access to GRASS datasets.
>> It's usage would be instead of rgdal(well sorta, rgdal is required by
>> spgrass6). Both write objects to sp types.
>> You can use it from within R to start a GRASS session or within GRASS to
>> start a linked R session.
>> http://cran.r-project.org/web/packages/spgrass6/index.html
>>
>> I got GDALinfo to work on my machine, I wonder if your just missing the
>> gdal-grass library, or libgrass.
>>
>> On ubuntu it's something like libgdal1-1.6.0-grass
>> I know qgis needs this to work with GRASS not sure about gdal itself but
>> based on http://gdal.org/frmt_grass.html probably. Also note that page
>> talks about the path to a dataset that should be used.
>>
>>
>> Thanks,
>> Alex
>>
>>> Hmm, I'm trying to use the raster package via rgdal to access these
>>> files -- I'm trying to avoid having to export then to another format
>>> (I'm dealing with gigabytes of rasters), although I suppose I could do
>>> this. ?Does spgrass6 "enable" rgdal to access GRASS rasters, or is it
>>> its own standalone program? ?How does the base gdal package work with
>>> grass rasters?
>>>
>>> --j
>>>
>>> On Mon, Mar 1, 2010 at 2:35 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
>>>> I think you need to export it from grass first, with r.out.gdal
>>>>
>>>> Or you can use spgrass6 to work with R and GRASS directly.
>>>>
>>>> Sarah
>>>>
>>>> On Mon, Mar 1, 2010 at 5:17 PM, Jonathan Greenberg
>>>> <greenberg at ucdavis.edu> wrote:
>>>>> Folks: when trying to import or GDALinfo a grass raster, where,
>>>>> exactly, should I be pointing to in the grass directory? ?I tried
>>>>> pointing to the file with the same name as the raster I want to work
>>>>> with in the fcell, cellhd, and cell directories
>>>>> (grass/location/mapset), but none of these are working... ?thanks!
>>>>>
>>>>
>>>>
>>>> --
>>>> Sarah Goslee
>>>> http://www.functionaldiversity.org
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From kimbesson1981 at gmail.com  Tue Mar  2 13:13:04 2010
From: kimbesson1981 at gmail.com (Kim Besson)
Date: Tue, 2 Mar 2010 12:13:04 +0000
Subject: [R-sig-Geo] spgrass6 and R versions to run GRASS-R interface
Message-ID: <8fb908a31003020413o62379f47xb3742546efb4830@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100302/354f7e79/attachment.pl>

From mccallum at iiasa.ac.at  Tue Mar  2 13:43:10 2010
From: mccallum at iiasa.ac.at (Ian McCallum)
Date: Tue, 02 Mar 2010 13:43:10 +0100
Subject: [R-sig-Geo] netCDF header info in R
Message-ID: <201003021243.o22ChGoK020966@amazon.iiasa.ac.at>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100302/1ef80049/attachment.pl>

From khaneboubi at gmail.com  Tue Mar  2 15:57:43 2010
From: khaneboubi at gmail.com (Mehdi Khaneboubi)
Date: Tue, 2 Mar 2010 15:57:43 +0100
Subject: [R-sig-Geo] a function to calculate distance
Message-ID: <94bd4a851003020657j6942a2a8qb19b5945511f3c59@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100302/719854ea/attachment.pl>

From p.hiemstra at geo.uu.nl  Tue Mar  2 16:19:04 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 02 Mar 2010 16:19:04 +0100
Subject: [R-sig-Geo] a function to calculate distance
In-Reply-To: <94bd4a851003020657j6942a2a8qb19b5945511f3c59@mail.gmail.com>
References: <94bd4a851003020657j6942a2a8qb19b5945511f3c59@mail.gmail.com>
Message-ID: <4B8D2C68.8000308@geo.uu.nl>

Mehdi Khaneboubi wrote:
> Hi,
>
> i am new to this list and i have a novice question.
>
> I am trying to calculate distance between two points. I have the latitude
> and longitude of those two points.
>
> I have try with the gdist() function from package Imap but it seems to be
> unsure. is there any others functions in others packages that will be able
> to do it ?
>
> best regards
>
> Mehdi Khaneboubi
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
Hi,

Look at the spDists and spDistsN1 functions from the sp-package.

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From cswingle at gmail.com  Tue Mar  2 17:24:47 2010
From: cswingle at gmail.com (Christopher Swingley)
Date: Tue, 2 Mar 2010 07:24:47 -0900
Subject: [R-sig-Geo] Clipping grid using shapefile?
In-Reply-To: <20100301204802.GE2817@abrinc.com>
References: <20100301190306.GB2817@abrinc.com>
	<4B8C170B.6070600@uni-muenster.de>
	<20100301203822.GD2817@abrinc.com>
	<20100301204802.GE2817@abrinc.com>
Message-ID: <20100302162447.GB2774@abrinc.com>

All,

Thanks to a lot of help off-list, I managed to get it to work.  What I
was trying to do was clip an ASCII grid of climatological data to a
series of watershed polygons (stored in a shapefile) and calculate the
mean value for the watershed.

Here's the code that worked:

    > library(rgdal)
    > library(sp)
    > vector <- readOGR("Watersheds", "DENA")
    > ppt01 <- readGDAL("Climate/ppt01.asc")
    > clip <- overlay(ppt01, vector[vector$SITECODE=='DENA-001',])
    > mean(ppt01 at data[[1]][!is.na(clip)])
    > sd(ppt01 at data[[1]][!is.na(clip)])

I think my primary problem is not quite grasping how to access the
various parts of the data objects loaded.  More reading of Data
Manipulation with R and Applied Spatial Data Analysis with R.

I may also try an approach using the raster library to see which is
faster for my data.  A python/GDAL version I wrote takes about 6 seconds
for each grid x polygon intersection calculation.

Cheers,

Chris
-- 
Christopher S. Swingley
http://swingleydev.com/
<cswingle at gmail.com>


From caspar.hallmann at gmail.com  Tue Mar  2 17:29:38 2010
From: caspar.hallmann at gmail.com (caspar hallmann)
Date: Tue, 2 Mar 2010 17:29:38 +0100
Subject: [R-sig-Geo] Bounding box for spplot?
Message-ID: <b552b8401003020829o191ef289w3c74d17a98c9a150@mail.gmail.com>

Dear list,

How would one remove the bounding box (the equivalent of 'frame.plot'
in plot.default) in a spplot?

Thanks in advance,

Caspar


From ageel_bushara at yahoo.com  Tue Mar  2 17:39:04 2010
From: ageel_bushara at yahoo.com (Ageel Ibrahim Bushara)
Date: Tue, 2 Mar 2010 08:39:04 -0800 (PST)
Subject: [R-sig-Geo] Bounding box for spplot?
In-Reply-To: <b552b8401003020829o191ef289w3c74d17a98c9a150@mail.gmail.com>
Message-ID: <746550.59969.qm@web35803.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100302/c6f45a6f/attachment.pl>

From caspar.hallmann at gmail.com  Tue Mar  2 17:59:38 2010
From: caspar.hallmann at gmail.com (caspar hallmann)
Date: Tue, 2 Mar 2010 17:59:38 +0100
Subject: [R-sig-Geo] Bounding box for spplot?
In-Reply-To: <746550.59969.qm@web35803.mail.mud.yahoo.com>
References: <b552b8401003020829o191ef289w3c74d17a98c9a150@mail.gmail.com>
	<746550.59969.qm@web35803.mail.mud.yahoo.com>
Message-ID: <b552b8401003020859k2415f85eocd1ce8394aea9657@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100302/a8ab369e/attachment.pl>

From zev at zevross.com  Tue Mar  2 18:07:26 2010
From: zev at zevross.com (Zev Ross)
Date: Tue, 02 Mar 2010 12:07:26 -0500
Subject: [R-sig-Geo] Using ggplot2 to plot a shapefile
Message-ID: <4B8D45CE.9030203@zevross.com>

Hi All,

I'm using the ggplot2 library to make some plots and I'm wondering how I 
could plot a shapefile along with my points

# I use this to plot my points
p<-ggplot(elev,aes(X, Y))+geom_point(aes(color=Elev, size=Elev))

# here I read in the county shapefile
counties<-readShapePoly("X:/counties_teale.shp")

# how do I add this to my plot would I use geom_polygon somehow?

Thank you, Zev

-- 
Zev Ross
ZevRoss Spatial Analysis
120 N Aurora, Suite 3A
Ithaca, NY 14850
607-277-0004 (phone)
866-877-3690 (fax, toll-free)
zev at zevross.com


From r.hijmans at gmail.com  Tue Mar  2 18:24:09 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 2 Mar 2010 09:24:09 -0800
Subject: [R-sig-Geo] Using ggplot2 to plot a shapefile
In-Reply-To: <4B8D45CE.9030203@zevross.com>
References: <4B8D45CE.9030203@zevross.com>
Message-ID: <dc22b2571003020924y351018eye5f010f4beb8b85@mail.gmail.com>

Zev,

Here is an example:
http://blog.revolution-computing.com/2009/11/choropleth-challenge-result.html

Robert

On Tue, Mar 2, 2010 at 9:07 AM, Zev Ross <zev at zevross.com> wrote:
> Hi All,
>
> I'm using the ggplot2 library to make some plots and I'm wondering how I
> could plot a shapefile along with my points
>
> # I use this to plot my points
> p<-ggplot(elev,aes(X, Y))+geom_point(aes(color=Elev, size=Elev))
>
> # here I read in the county shapefile
> counties<-readShapePoly("X:/counties_teale.shp")
>
> # how do I add this to my plot would I use geom_polygon somehow?
>
> Thank you, Zev
>
> --
> Zev Ross
> ZevRoss Spatial Analysis
> 120 N Aurora, Suite 3A
> Ithaca, NY 14850
> 607-277-0004 (phone)
> 866-877-3690 (fax, toll-free)
> zev at zevross.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From debeaudette at ucdavis.edu  Tue Mar  2 19:10:07 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Tue, 2 Mar 2010 10:10:07 -0800
Subject: [R-sig-Geo] rgdal and grass rasters
In-Reply-To: <e4ca87521003011828r9215312j6b2c3de63fb7ea8f@mail.gmail.com>
References: <e4ca87521003011417x97b8c62rc0f818de72544e9f@mail.gmail.com>
	<3c5546141003011804r79e2b2b9p7631b32726ea82d7@mail.gmail.com>
	<e4ca87521003011828r9215312j6b2c3de63fb7ea8f@mail.gmail.com>
Message-ID: <201003021010.07139.dylan.beaudette@gmail.com>

On Monday 01 March 2010, Jonathan Greenberg wrote:
> As far as sample code goes, simply getting
> grass_to_raster=raster("somegrassfile") is my goal -- my understanding
> is anything rgdal can read, raster can read.  Running your command I
> do get:
>
> GRASS (ro): GRASS Database Rasters (5.7+)
>
> But with rgdal:
>
> require(rgdal)
> gdaldrivers=getGDALDriverNames()
> gdaldrivers$create[gdaldrivers$name=="GRASS"]
> [1] FALSE
> gdaldrivers$copy[gdaldrivers$name=="GRASS"]
> [1] FALSE
> gdaldrivers$create[gdaldrivers$name=="GTiff"]
> [1] TRUE
> gdaldrivers$copy[gdaldrivers$name=="GTiff"]
> [1] TRUE
>
> Am I perhaps missing an rgdal installation flag that is required to
> enable GRASS rasters?
>
> --j

Could be.  How did you install GRASS/GDAL/rgdal?

Dylan

>
>
> On Mon, Mar 1, 2010 at 6:04 PM, Dylan Beaudette
>
> <dylan.beaudette at gmail.com> wrote:
> > Roger can likely point out the problem after some example code is
> > posted. In the mean time I would suggest checking to make sure your
> > GDAL is compiled _without_ GRASS support, and that the GDAL GRASS
> > plugin is correctly installed.
> >
> > This is how I check on my machine:
> >
> > gdal_translate --formats | grep -i grass
> > ?GRASS (ro): GRASS Database Rasters (5.7+)
> >
> > Cheers,
> > Dylan
> >
> > On Mon, Mar 1, 2010 at 5:44 PM, Alex Mandel <tech_dev at wildintellect.com> 
wrote:
> >> spgrass6 is a an R package and has read/write access to GRASS datasets.
> >> It's usage would be instead of rgdal(well sorta, rgdal is required by
> >> spgrass6). Both write objects to sp types.
> >> You can use it from within R to start a GRASS session or within GRASS to
> >> start a linked R session.
> >> http://cran.r-project.org/web/packages/spgrass6/index.html
> >>
> >> I got GDALinfo to work on my machine, I wonder if your just missing the
> >> gdal-grass library, or libgrass.
> >>
> >> On ubuntu it's something like libgdal1-1.6.0-grass
> >> I know qgis needs this to work with GRASS not sure about gdal itself but
> >> based on http://gdal.org/frmt_grass.html probably. Also note that page
> >> talks about the path to a dataset that should be used.
> >>
> >>
> >> Thanks,
> >> Alex
> >>
> >>> Hmm, I'm trying to use the raster package via rgdal to access these
> >>> files -- I'm trying to avoid having to export then to another format
> >>> (I'm dealing with gigabytes of rasters), although I suppose I could do
> >>> this. ?Does spgrass6 "enable" rgdal to access GRASS rasters, or is it
> >>> its own standalone program? ?How does the base gdal package work with
> >>> grass rasters?
> >>>
> >>> --j
> >>>
> >>> On Mon, Mar 1, 2010 at 2:35 PM, Sarah Goslee <sarah.goslee at gmail.com> 
wrote:
> >>>> I think you need to export it from grass first, with r.out.gdal
> >>>>
> >>>> Or you can use spgrass6 to work with R and GRASS directly.
> >>>>
> >>>> Sarah
> >>>>
> >>>> On Mon, Mar 1, 2010 at 5:17 PM, Jonathan Greenberg
> >>>>
> >>>> <greenberg at ucdavis.edu> wrote:
> >>>>> Folks: when trying to import or GDALinfo a grass raster, where,
> >>>>> exactly, should I be pointing to in the grass directory? ?I tried
> >>>>> pointing to the file with the same name as the raster I want to work
> >>>>> with in the fcell, cellhd, and cell directories
> >>>>> (grass/location/mapset), but none of these are working... ?thanks!
> >>>>
> >>>> --
> >>>> Sarah Goslee
> >>>> http://www.functionaldiversity.org
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at stat.math.ethz.ch
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From zev at zevross.com  Tue Mar  2 19:09:40 2010
From: zev at zevross.com (Zev Ross)
Date: Tue, 02 Mar 2010 13:09:40 -0500
Subject: [R-sig-Geo] Using ggplot2 to plot a shapefile
In-Reply-To: <dc22b2571003020924y351018eye5f010f4beb8b85@mail.gmail.com>
References: <4B8D45CE.9030203@zevross.com>
	<dc22b2571003020924y351018eye5f010f4beb8b85@mail.gmail.com>
Message-ID: <4B8D5464.3010200@zevross.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100302/dbff2dd0/attachment.html>

From Roger.Bivand at nhh.no  Tue Mar  2 20:39:56 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 2 Mar 2010 20:39:56 +0100 (CET)
Subject: [R-sig-Geo] spgrass6 and R versions to run GRASS-R interface
In-Reply-To: <8fb908a31003020413o62379f47xb3742546efb4830@mail.gmail.com>
References: <8fb908a31003020413o62379f47xb3742546efb4830@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1003022037120.925@reclus.nhh.no>

On Tue, 2 Mar 2010, Kim Besson wrote:

> Greetings
>
> I'm trying to have an interface between R and GRASS, using spgrass6, but
> whenever I run a function of spgrass6 I get an error of
> ERROR: Incompatible library version for module. You need to rebuild GRASS
>       or untangle multiple installations.
>
> I have rebuilt it so my guess is that I have wrong libraries versions. I'm
> running:
> GRASSsvn6.4.0
> R version 2.9.2 (2009-08-24)
> RGDAL 0.6
> spgrass6_0.6-15
>
> Any ideas of what might not be correct?

This was a further case of Ubuntu/Debian dependency hell with stale GDAL 
GRASS plugins - resolved on the GRASS user list:

http://n2.nabble.com/R-GDAL-incompatible-libraries-td4655676.html#a4655676

Roger

>
> Thanks
>
> Best regards
> Kim
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Mar  2 20:46:03 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 2 Mar 2010 20:46:03 +0100 (CET)
Subject: [R-sig-Geo] rgdal and grass rasters
In-Reply-To: <e4ca87521003011845r7edfc9bdhe305c36441713863@mail.gmail.com>
References: <e4ca87521003011417x97b8c62rc0f818de72544e9f@mail.gmail.com>
	<efb536d51003011435r66e52933t51f7c888195846fd@mail.gmail.com>
	<e4ca87521003011642g46096131w8dca9767d5e909fc@mail.gmail.com>
	<4B8C6D71.4030004@wildintellect.com>
	<3c5546141003011804r79e2b2b9p7631b32726ea82d7@mail.gmail.com>
	<e4ca87521003011845r7edfc9bdhe305c36441713863@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1003022040490.925@reclus.nhh.no>

On Mon, 1 Mar 2010, Jonathan Greenberg wrote:

> As far as sample code goes, simply getting
> grass_to_raster=raster("somegrassfile") is my goal -- my understanding
> is anything rgdal can read, raster can read.  Running your command I
> do get:
>
> GRASS (ro): GRASS Database Rasters (5.7+)
>
> But with rgdal:
>
> require(rgdal)
> gdaldrivers=getGDALDriverNames()
> gdaldrivers$create[gdaldrivers$name=="GRASS"]
> [1] FALSE
> gdaldrivers$copy[gdaldrivers$name=="GRASS"]
> [1] FALSE
> gdaldrivers$create[gdaldrivers$name=="GTiff"]
> [1] TRUE
> gdaldrivers$copy[gdaldrivers$name=="GTiff"]
> [1] TRUE
>
> Am I perhaps missing an rgdal installation flag that is required to
> enable GRASS rasters?

Unless rgdal was built against and is seeing a different GDAL, there is no 
good reason. gdalDrivers() will list all the drivers that the GDAL rgdal 
is using sees. However, beware of the plugin, which is notorious for 
refering to stale GRASS binaries, and for its choice of exporting the 
whole raster with its original resolution, which most often is not the 
same as the output of g.region.

To mimic raster, you would use g.region to set the tile size and shape 
before using readRAST6() with a temporary file. This could be automated 
too, I think.

Hope this helps,

Roger

>
> --j
>
> On Mon, Mar 1, 2010 at 6:04 PM, Dylan Beaudette
> <dylan.beaudette at gmail.com> wrote:
>> Roger can likely point out the problem after some example code is
>> posted. In the mean time I would suggest checking to make sure your
>> GDAL is compiled _without_ GRASS support, and that the GDAL GRASS
>> plugin is correctly installed.
>>
>> This is how I check on my machine:
>>
>> gdal_translate --formats | grep -i grass
>> ?GRASS (ro): GRASS Database Rasters (5.7+)
>>
>> Cheers,
>> Dylan
>>
>> On Mon, Mar 1, 2010 at 5:44 PM, Alex Mandel <tech_dev at wildintellect.com> wrote:
>>> spgrass6 is a an R package and has read/write access to GRASS datasets.
>>> It's usage would be instead of rgdal(well sorta, rgdal is required by
>>> spgrass6). Both write objects to sp types.
>>> You can use it from within R to start a GRASS session or within GRASS to
>>> start a linked R session.
>>> http://cran.r-project.org/web/packages/spgrass6/index.html
>>>
>>> I got GDALinfo to work on my machine, I wonder if your just missing the
>>> gdal-grass library, or libgrass.
>>>
>>> On ubuntu it's something like libgdal1-1.6.0-grass
>>> I know qgis needs this to work with GRASS not sure about gdal itself but
>>> based on http://gdal.org/frmt_grass.html probably. Also note that page
>>> talks about the path to a dataset that should be used.
>>>
>>>
>>> Thanks,
>>> Alex
>>>
>>>> Hmm, I'm trying to use the raster package via rgdal to access these
>>>> files -- I'm trying to avoid having to export then to another format
>>>> (I'm dealing with gigabytes of rasters), although I suppose I could do
>>>> this. ?Does spgrass6 "enable" rgdal to access GRASS rasters, or is it
>>>> its own standalone program? ?How does the base gdal package work with
>>>> grass rasters?
>>>>
>>>> --j
>>>>
>>>> On Mon, Mar 1, 2010 at 2:35 PM, Sarah Goslee <sarah.goslee at gmail.com> wrote:
>>>>> I think you need to export it from grass first, with r.out.gdal
>>>>>
>>>>> Or you can use spgrass6 to work with R and GRASS directly.
>>>>>
>>>>> Sarah
>>>>>
>>>>> On Mon, Mar 1, 2010 at 5:17 PM, Jonathan Greenberg
>>>>> <greenberg at ucdavis.edu> wrote:
>>>>>> Folks: when trying to import or GDALinfo a grass raster, where,
>>>>>> exactly, should I be pointing to in the grass directory? ?I tried
>>>>>> pointing to the file with the same name as the raster I want to work
>>>>>> with in the fcell, cellhd, and cell directories
>>>>>> (grass/location/mapset), but none of these are working... ?thanks!
>>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Sarah Goslee
>>>>> http://www.functionaldiversity.org
>>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From mdsumner at gmail.com  Tue Mar  2 21:47:31 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 3 Mar 2010 07:47:31 +1100
Subject: [R-sig-Geo] netCDF header info in R
In-Reply-To: <201003021243.o22ChGoK020966@amazon.iiasa.ac.at>
References: <201003021243.o22ChGoK020966@amazon.iiasa.ac.at>
Message-ID: <522664f81003021247qdadb2fdpc843338ed12f0674@mail.gmail.com>

You could use

shell("ncdump -h netCDF.nc", intern = TRUE)

In the ncdf package you can print a connection and it gives you a
summary, for example:

library(ncdf)
 nc <- open.ncdf("sst.wkmean.1990-present.nc")
print.ncdf(nc)
[1] "file sst.wkmean.1990-present.nc has 4 dimensions:"
[1] "lon   Size: 360"
[1] "lat   Size: 180"
[1] "nbnds   Size: 2"
[1] "time   Size: 1046"
[1] "------------------------"
[1] "file sst.wkmean.1990-present.nc has 2 variables:"
[1] "double time_bnds[nbnds,time]  Longname:Time Boundaries Missval:1e+30"
[1] "short sst[lon,lat,time]  Longname:Weekly Mean of Sea Surface
Temperature Missval:32767"

close.ncdf(nc)


The RNetCDF package does the same, but the summary is more "ncdump-alike":

library(RNetCDF)
nc <- open.nc("sst.wkmean.1990-present.nc")
print.nc(nc)
dimensions:
        lon = 360 ;
        lat = 180 ;
        nbnds = 2 ;
        time = UNLIMITED ; // (1046 currently)
variables:
        float lat(lat) ;
                lat:units = "degrees_north" ;
                lat:long_name = "Latitude" ;
                lat:actual_range = 89.5-89.5 ;
                lat:standard_name = "latitude_north" ;
                lat:axis = "y" ;
                lat:coordinate_defines = "center" ;
        float lon(lon) ;
                lon:units = "degrees_east" ;
                lon:long_name = "Longitude" ;
                lon:actual_range = 0.5359.5 ;
                lon:standard_name = "longitude_east" ;
                lon:axis = "x" ;
                lon:coordinate_defines = "center" ;
        double time(time) ;
                time:units = "days since 1800-1-1 00:00:00" ;
                time:long_name = "Time" ;
                time:actual_range = 6939576710 ;
                time:delta_t = "0000-00-07 00:00:00" ;
                time:avg_period = "0000-00-07 00:00:00" ;
                time:standard_name = "time" ;
                time:axis = "t" ;
        double time_bnds(nbnds, time) ;
                time_bnds:long_name = "Time Boundaries" ;
        short sst(lon, lat, time) ;
                sst:long_name = "Weekly Mean of Sea Surface Temperature" ;
                sst:valid_range = -540 ;
                sst:actual_range = -1.835.63 ;
                sst:units = "degC" ;
                sst:add_offset = 0 ;
                sst:scale_factor = 0.01 ;
                sst:missing_value = 32767 ;
                sst:precision = 2 ;
                sst:least_significant_digit = 2 ;
                sst:var_desc = "Sea Surface Temperature" ;
                sst:dataset = "NOAA Optimum Interpolation (OI) SST V2" ;
                sst:level_desc = "Surface" ;
                sst:statistic = "Weekly Mean" ;
                sst:parent_stat = "Individual obs" ;
                sst:standard_name = "sea_surface_temperature" ;

// global attributes:
                :title = "NOAA Optimum Interpolation (OI) SST V2" ;
                :Conventions = "CF-1.0" ;
                :history = "Created 10/2002 by RHS" ;
                :comments = "Data described in  Reynolds, R.W., N.A.
Rayner, T.M.
Smith, D.C. Stokes, and W. Wang, 2002: An Improved In Situ and Satellite
SST Analysis for Climate, J. Climate" ;
                :platform = "Model" ;
                :source = "NCEP Climate Modeling Branch" ;
                :institution = "National Centers for Environmental Prediction" ;
                :references =
"http://www.emc.ncep.noaa.gov/research/cmb/sst_analysis/
http://www.cdc.noaa.gov/cdc/data.ncep.oisst.v2.html" ;


Unfortunately, neither package provides the metadata as an R object
and they do not use the class system to (for example) remove the need
for the ".nc" on print() and close(). The functions are not that
complicated at the R level thought, so modifying them to suit is quite
simple.

Cheers, Mike.




On Tue, Mar 2, 2010 at 11:43 PM, Ian McCallum <mccallum at iiasa.ac.at> wrote:
> Greetings,
>
> I am importing netCDF files into R using library(ncdf)
> I would like to see the header info of these files directly in R if
> possible (i.e. units, full description, etc)
> It is possible to use "ncdump -h netCDF.nc" from the unix prompt,
> but I was wondering is it possible to access all info in the header
> directly in R?
>
> Many thanks
> Ian
>
>
> ___________________________________________
>
> Ian McCallum
> Forestry Program
> International Institute for Applied Systems Analysis
> Schlossplatz 1, A-2361 Laxenburg, Austria
> Phone: +43 2236 807-328
> Fax: +43 2236 807-599 or 71313
> E-mail: mccallum at iiasa.ac.at
> Web: http://www.iiasa.ac.at/Research/FOR/
> ___________________________________________
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mdsumner at gmail.com  Tue Mar  2 21:49:25 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 3 Mar 2010 07:49:25 +1100
Subject: [R-sig-Geo] netCDF header info in R
In-Reply-To: <522664f81003021247qdadb2fdpc843338ed12f0674@mail.gmail.com>
References: <201003021243.o22ChGoK020966@amazon.iiasa.ac.at>
	<522664f81003021247qdadb2fdpc843338ed12f0674@mail.gmail.com>
Message-ID: <522664f81003021249s34593ce2sedf2b784a9779db7@mail.gmail.com>

Sorry, one correction - the ncdf package does use the class system to
remove the need for ".nc" on print and close.


On Wed, Mar 3, 2010 at 7:47 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> You could use
>
> shell("ncdump -h netCDF.nc", intern = TRUE)
>
> In the ncdf package you can print a connection and it gives you a
> summary, for example:
>
> library(ncdf)
> ?nc <- open.ncdf("sst.wkmean.1990-present.nc")
> print.ncdf(nc)
> [1] "file sst.wkmean.1990-present.nc has 4 dimensions:"
> [1] "lon ? Size: 360"
> [1] "lat ? Size: 180"
> [1] "nbnds ? Size: 2"
> [1] "time ? Size: 1046"
> [1] "------------------------"
> [1] "file sst.wkmean.1990-present.nc has 2 variables:"
> [1] "double time_bnds[nbnds,time] ?Longname:Time Boundaries Missval:1e+30"
> [1] "short sst[lon,lat,time] ?Longname:Weekly Mean of Sea Surface
> Temperature Missval:32767"
>
> close.ncdf(nc)
>
>
> The RNetCDF package does the same, but the summary is more "ncdump-alike":
>
> library(RNetCDF)
> nc <- open.nc("sst.wkmean.1990-present.nc")
> print.nc(nc)
> dimensions:
> ? ? ? ?lon = 360 ;
> ? ? ? ?lat = 180 ;
> ? ? ? ?nbnds = 2 ;
> ? ? ? ?time = UNLIMITED ; // (1046 currently)
> variables:
> ? ? ? ?float lat(lat) ;
> ? ? ? ? ? ? ? ?lat:units = "degrees_north" ;
> ? ? ? ? ? ? ? ?lat:long_name = "Latitude" ;
> ? ? ? ? ? ? ? ?lat:actual_range = 89.5-89.5 ;
> ? ? ? ? ? ? ? ?lat:standard_name = "latitude_north" ;
> ? ? ? ? ? ? ? ?lat:axis = "y" ;
> ? ? ? ? ? ? ? ?lat:coordinate_defines = "center" ;
> ? ? ? ?float lon(lon) ;
> ? ? ? ? ? ? ? ?lon:units = "degrees_east" ;
> ? ? ? ? ? ? ? ?lon:long_name = "Longitude" ;
> ? ? ? ? ? ? ? ?lon:actual_range = 0.5359.5 ;
> ? ? ? ? ? ? ? ?lon:standard_name = "longitude_east" ;
> ? ? ? ? ? ? ? ?lon:axis = "x" ;
> ? ? ? ? ? ? ? ?lon:coordinate_defines = "center" ;
> ? ? ? ?double time(time) ;
> ? ? ? ? ? ? ? ?time:units = "days since 1800-1-1 00:00:00" ;
> ? ? ? ? ? ? ? ?time:long_name = "Time" ;
> ? ? ? ? ? ? ? ?time:actual_range = 6939576710 ;
> ? ? ? ? ? ? ? ?time:delta_t = "0000-00-07 00:00:00" ;
> ? ? ? ? ? ? ? ?time:avg_period = "0000-00-07 00:00:00" ;
> ? ? ? ? ? ? ? ?time:standard_name = "time" ;
> ? ? ? ? ? ? ? ?time:axis = "t" ;
> ? ? ? ?double time_bnds(nbnds, time) ;
> ? ? ? ? ? ? ? ?time_bnds:long_name = "Time Boundaries" ;
> ? ? ? ?short sst(lon, lat, time) ;
> ? ? ? ? ? ? ? ?sst:long_name = "Weekly Mean of Sea Surface Temperature" ;
> ? ? ? ? ? ? ? ?sst:valid_range = -540 ;
> ? ? ? ? ? ? ? ?sst:actual_range = -1.835.63 ;
> ? ? ? ? ? ? ? ?sst:units = "degC" ;
> ? ? ? ? ? ? ? ?sst:add_offset = 0 ;
> ? ? ? ? ? ? ? ?sst:scale_factor = 0.01 ;
> ? ? ? ? ? ? ? ?sst:missing_value = 32767 ;
> ? ? ? ? ? ? ? ?sst:precision = 2 ;
> ? ? ? ? ? ? ? ?sst:least_significant_digit = 2 ;
> ? ? ? ? ? ? ? ?sst:var_desc = "Sea Surface Temperature" ;
> ? ? ? ? ? ? ? ?sst:dataset = "NOAA Optimum Interpolation (OI) SST V2" ;
> ? ? ? ? ? ? ? ?sst:level_desc = "Surface" ;
> ? ? ? ? ? ? ? ?sst:statistic = "Weekly Mean" ;
> ? ? ? ? ? ? ? ?sst:parent_stat = "Individual obs" ;
> ? ? ? ? ? ? ? ?sst:standard_name = "sea_surface_temperature" ;
>
> // global attributes:
> ? ? ? ? ? ? ? ?:title = "NOAA Optimum Interpolation (OI) SST V2" ;
> ? ? ? ? ? ? ? ?:Conventions = "CF-1.0" ;
> ? ? ? ? ? ? ? ?:history = "Created 10/2002 by RHS" ;
> ? ? ? ? ? ? ? ?:comments = "Data described in ?Reynolds, R.W., N.A.
> Rayner, T.M.
> Smith, D.C. Stokes, and W. Wang, 2002: An Improved In Situ and Satellite
> SST Analysis for Climate, J. Climate" ;
> ? ? ? ? ? ? ? ?:platform = "Model" ;
> ? ? ? ? ? ? ? ?:source = "NCEP Climate Modeling Branch" ;
> ? ? ? ? ? ? ? ?:institution = "National Centers for Environmental Prediction" ;
> ? ? ? ? ? ? ? ?:references =
> "http://www.emc.ncep.noaa.gov/research/cmb/sst_analysis/
> http://www.cdc.noaa.gov/cdc/data.ncep.oisst.v2.html" ;
>
>
> Unfortunately, neither package provides the metadata as an R object
> and they do not use the class system to (for example) remove the need
> for the ".nc" on print() and close(). The functions are not that
> complicated at the R level thought, so modifying them to suit is quite
> simple.
>
> Cheers, Mike.
>
>
>
>
> On Tue, Mar 2, 2010 at 11:43 PM, Ian McCallum <mccallum at iiasa.ac.at> wrote:
>> Greetings,
>>
>> I am importing netCDF files into R using library(ncdf)
>> I would like to see the header info of these files directly in R if
>> possible (i.e. units, full description, etc)
>> It is possible to use "ncdump -h netCDF.nc" from the unix prompt,
>> but I was wondering is it possible to access all info in the header
>> directly in R?
>>
>> Many thanks
>> Ian
>>
>>
>> ___________________________________________
>>
>> Ian McCallum
>> Forestry Program
>> International Institute for Applied Systems Analysis
>> Schlossplatz 1, A-2361 Laxenburg, Austria
>> Phone: +43 2236 807-328
>> Fax: +43 2236 807-599 or 71313
>> E-mail: mccallum at iiasa.ac.at
>> Web: http://www.iiasa.ac.at/Research/FOR/
>> ___________________________________________
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From cswingle at gmail.com  Tue Mar  2 22:31:04 2010
From: cswingle at gmail.com (Christopher Swingley)
Date: Tue, 2 Mar 2010 12:31:04 -0900
Subject: [R-sig-Geo] Clipping grid using shapefile?
In-Reply-To: <20100302162447.GB2774@abrinc.com>
References: <20100301190306.GB2817@abrinc.com>
	<4B8C170B.6070600@uni-muenster.de>
	<20100301203822.GD2817@abrinc.com>
	<20100301204802.GE2817@abrinc.com>
	<20100302162447.GB2774@abrinc.com>
Message-ID: <20100302213104.GD2774@abrinc.com>

All,

* Christopher Swingley <cswingle at gmail.com> [2010-Mar-02 07:24 AKST]:
>     > library(rgdal)
>     > library(sp)
>     > vector <- readOGR("Watersheds", "DENA")
>     > ppt01 <- readGDAL("Climate/ppt01.asc")
>     > clip <- overlay(ppt01, vector[vector$SITECODE=='DENA-001',])
>     > mean(ppt01 at data[[1]][!is.na(clip)])
>     > sd(ppt01 at data[[1]][!is.na(clip)])

An alternative, and quite a bit faster, method:

    > library(raster)
    > library(rgdal)
    > polygons <- readOGR("Watersheds", "DENA")
    > r <- raster("grid_dir")
    > v_dena <- polygonValues(dena, r)
    > means_dena <- lapply(v_dena, mean)

Cheers,

Chris
-- 
Christopher S. Swingley
http://swingleydev.com/
<cswingle at gmail.com>


From pmaurogut at hotmail.com  Wed Mar  3 02:42:13 2010
From: pmaurogut at hotmail.com (FRANCISCO MAURO GUTIERREZ)
Date: Wed, 3 Mar 2010 01:42:13 +0000
Subject: [R-sig-Geo] Fourier Analysis
Message-ID: <COL107-W1375F298AF79634095B6C9BD3A0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100303/a15c0dc5/attachment.pl>

From christoph.hofer at env.ethz.ch  Wed Mar  3 12:57:43 2010
From: christoph.hofer at env.ethz.ch (Christoph Hofer)
Date: Wed, 3 Mar 2010 12:57:43 +0100
Subject: [R-sig-Geo] Public reference dataset
Message-ID: <9CE368CC-93E5-45E8-A7C6-A44B0173DADA@env.ethz.ch>

Dear list


I am looking for a public "reference" dataset (like the meuse dataset in the gstat package)
 to test some software for block kriging.
I appreciate any hint.


Regards

Christoph



ETH Zurich
Christoph Hofer
Soil and Terrestrial Environmental Physics
Institute of Terrestrial Ecosystems
CHN E 50.2
Universit?tstrasse 16
8092 Zurich, Switzerland
phone         (+41) - (0)44 - 633 63 65
fax               (+41) - (0)44 - 633 11 23
e-mail: christoph.hofer at env.ethz.ch


From pmaurogut at hotmail.com  Wed Mar  3 14:25:16 2010
From: pmaurogut at hotmail.com (FRANCISCO MAURO GUTIERREZ)
Date: Wed, 3 Mar 2010 13:25:16 +0000
Subject: [R-sig-Geo] Fourier Analysis
In-Reply-To: <b552b8401003030126n79aba2acyd355db42c7312c2e@mail.gmail.com>
References: <COL107-W1375F298AF79634095B6C9BD3A0@phx.gbl>,
	<b552b8401003030126n79aba2acyd355db42c7312c2e@mail.gmail.com>
Message-ID: <COL107-W31C108B83B92512E910414BD3A0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100303/a78b7f62/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Mar  3 15:14:10 2010
From: edzer.pebesma at uni-muenster.de (edzer pebesma)
Date: Wed, 03 Mar 2010 15:14:10 +0100
Subject: [R-sig-Geo] Public reference dataset
In-Reply-To: <9CE368CC-93E5-45E8-A7C6-A44B0173DADA@env.ethz.ch>
References: <9CE368CC-93E5-45E8-A7C6-A44B0173DADA@env.ethz.ch>
Message-ID: <96448a22-89e5-49bb-959f-df5d326f1535@email.android.com>

What should it have that meuse does not have?

"Christoph Hofer" <christoph.hofer at env.ethz.ch> wrote:

>Dear list
>
>
>I am looking for a public "reference" dataset (like the meuse dataset in the gstat package)
> to test some software for block kriging.
>I appreciate any hint.
>
>
>Regards
>
>Christoph
>
>
>
>ETH Zurich
>Christoph Hofer
>Soil and Terrestrial Environmental Physics
>Institute of Terrestrial Ecosystems
>CHN E 50.2
>Universit?tstrasse 16
>8092 Zurich, Switzerland
>phone         (+41) - (0)44 - 633 63 65
>fax               (+41) - (0)44 - 633 11 23
>e-mail: christoph.hofer at env.ethz.ch
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From christoph.hofer at env.ethz.ch  Wed Mar  3 16:37:11 2010
From: christoph.hofer at env.ethz.ch (Christoph Hofer)
Date: Wed, 3 Mar 2010 16:37:11 +0100
Subject: [R-sig-Geo] Public reference dataset
In-Reply-To: <96448a22-89e5-49bb-959f-df5d326f1535@email.android.com>
References: <9CE368CC-93E5-45E8-A7C6-A44B0173DADA@env.ethz.ch>
	<96448a22-89e5-49bb-959f-df5d326f1535@email.android.com>
Message-ID: <6F35933F-BEA5-492D-918B-AFDEAC8BB161@env.ethz.ch>

Of course, the meuse dataset will do nicely and I 
will use it. However, I was just wondering if their
is a "standard reference" dataset for block kriging.


Anyway, thanks for your comment.

Christoph


Am 03.03.2010 um 15:14 schrieb edzer pebesma:

> What should it have that meuse does not have?
> 
> "Christoph Hofer" <christoph.hofer at env.ethz.ch> wrote:
> 
>> Dear list
>> 
>> 
>> I am looking for a public "reference" dataset (like the meuse dataset in the gstat package)
>> to test some software for block kriging.
>> I appreciate any hint.
>> 
>> 
>> Regards
>> 
>> Christoph
>> 
>> 
>> 
>> ETH Zurich
>> Christoph Hofer
>> Soil and Terrestrial Environmental Physics
>> Institute of Terrestrial Ecosystems
>> CHN E 50.2
>> Universit?tstrasse 16
>> 8092 Zurich, Switzerland
>> phone         (+41) - (0)44 - 633 63 65
>> fax               (+41) - (0)44 - 633 11 23
>> e-mail: christoph.hofer at env.ethz.ch
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From hengl at spatial-analyst.net  Wed Mar  3 18:46:15 2010
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 3 Mar 2010 18:46:15 +0100
Subject: [R-sig-Geo] Public reference dataset
In-Reply-To: <6F35933F-BEA5-492D-918B-AFDEAC8BB161@env.ethz.ch>
References: <9CE368CC-93E5-45E8-A7C6-A44B0173DADA@env.ethz.ch>	<96448a22-89e5-49bb-959f-df5d326f1535@email.android.com>
	<6F35933F-BEA5-492D-918B-AFDEAC8BB161@env.ethz.ch>
Message-ID: <001501cabaf9$6c144050$443cc0f0$@net>


Hi Christoph,

I have prepared few datasets of interest for testing geostatistical algorithms:

http://spatial-analyst.net/book/data-sets 

I personally like the BCI (soil samples) dataset very much (used in the spatstat package also). It has enough points and they are sampled at both short and regular distances (see http://spatial-analyst.net/wiki/index.php?title=Image:Fig_pH_RK_draped.jpg). Here are some examples:

http://spatial-analyst.net/wiki/index.php?title=Spatial_interpolation_exercises_(NL)#Spatial_prediction_of_soil_properties_for_the_Barro_Colorado_Island_50_ha_Plot 

Additional grids for BCI are available here:

http://spatial-analyst.net/book/BCI_grids 

The field data collection and lab analysis has been explained in detail here:

https://ctfs.arnarb.harvard.edu/webatlas/datasets/bci/soilmaps/BCIsoil.html 

Then, there are also various datasets used in the geostats books:

Diggle, P.J., Ribeiro Jr, P.J., 2006. Model-based Geostatistics. Springer Series in Statistics, 230 p.
http://www.leg.ufpr.br/mbgbook/ 

Reimann, C., Filzmoser, P., Garrett, R., Dutter, R., 2008. Statistical Data Analysis Explained Applied Environmental Statistics with R. Wiley, Chichester, 337 p.
http://www.statistik.tuwien.ac.at/StatDA/ 


HTH,

T. Hengl
http://home.medewerker.uva.nl/t.hengl/ 


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] On Behalf Of Christoph Hofer
> Sent: Wednesday, March 03, 2010 4:37 PM
> To: edzer pebesma
> Cc: r-sig-geo forum
> Subject: Re: [R-sig-Geo] Public reference dataset
> 
> Of course, the meuse dataset will do nicely and I
> will use it. However, I was just wondering if their
> is a "standard reference" dataset for block kriging.
> 
> 
> Anyway, thanks for your comment.
> 
> Christoph
> 
> 
> Am 03.03.2010 um 15:14 schrieb edzer pebesma:
> 
> > What should it have that meuse does not have?
> >
> > "Christoph Hofer" <christoph.hofer at env.ethz.ch> wrote:
> >
> >> Dear list
> >>
> >>
> >> I am looking for a public "reference" dataset (like the meuse dataset in the
> gstat package)
> >> to test some software for block kriging.
> >> I appreciate any hint.
> >>
> >>
> >> Regards
> >>
> >> Christoph
> >>
> >>
> >>
> >> ETH Zurich
> >> Christoph Hofer
> >> Soil and Terrestrial Environmental Physics
> >> Institute of Terrestrial Ecosystems
> >> CHN E 50.2
> >> Universit?tstrasse 16
> >> 8092 Zurich, Switzerland
> >> phone         (+41) - (0)44 - 633 63 65
> >> fax               (+41) - (0)44 - 633 11 23
> >> e-mail: christoph.hofer at env.ethz.ch
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jthayn at ilstu.edu  Thu Mar  4 16:28:19 2010
From: jthayn at ilstu.edu (Jonathan Thayn)
Date: Thu, 4 Mar 2010 09:28:19 -0600
Subject: [R-sig-Geo] get the neighbors from a specified node in an nb object
Message-ID: <30D4A8EB-E2BB-45DD-B8B1-36B7E26AD0A0@ilstu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100304/f59b78e6/attachment.pl>

From Roger.Bivand at nhh.no  Thu Mar  4 17:41:50 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 4 Mar 2010 17:41:50 +0100 (CET)
Subject: [R-sig-Geo] get the neighbors from a specified node in an nb
 object
In-Reply-To: <30D4A8EB-E2BB-45DD-B8B1-36B7E26AD0A0@ilstu.edu>
References: <30D4A8EB-E2BB-45DD-B8B1-36B7E26AD0A0@ilstu.edu>
Message-ID: <alpine.LRH.2.00.1003041729290.11333@reclus.nhh.no>

On Thu, 4 Mar 2010, Jonathan Thayn wrote:

> I'm sure there is a simple way to do this but I can't seem to find it. I 
> have an nb object and a list of the landcover types associated with each 
> node in the neighborhood. I want to create a table showing how many 
> times each landcover class borders every other landcover class, like in 
> the example below.
>
>
>       Forest Grass Water
> Forest      0     0     0
> Grass       3     0     0
> Water       2     5     0
>
> I couldn't find a function that did this so I wrote a simple one using 
> some of the functions in the "network" library. I'm sure there is a way 
> to do this in the spdep package. How do I ask the nb object for the 
> neighbors of a specific node? The command in the network library is

An nb object is a list, so if you know the sequence number of the node of 
interest, say i in 1,...,n:

x <- nb[[i]]

will return an integer vector of neighbours, with no neighbours coded as 
a single zero (so drop zero).

If you need them coded by region.id, use attr(nb, "region.id") to extract 
these "row names", and match() the one you want against that vector to get 
i, reversing the process on x to get its "names".

However, for your end purpose, you might find that it is easier to go:

lw <- nb2listw(nb, style="B")
sn <- listw2sn(lw)

possibly with zero.policy=TRUE if needed, and then use sn$from and sn$to 
to index the category vector for tabulation (an sn object has a triplet 
for each link (from, to, weight)).

Note that double counting may be an issue for you using either method, as 
each symmetric link is counted twice, but with the categories reversed. 
You could try to remedy this by manipulating the input nb object, but your 
analysis of the table will show whether this is a problem for you.

Hope this helps,

Roger



>
> x <- get.neighborhood(network,node_id)
>
> I don't mind using the network library but it requires converting the nb 
> object to a network object and I'm sure there is a way to do this 
> without the conversion. Thanks for your help.
>
>
> Jonathan B. Thayn, Ph.D.
> Illinois State University
> Department of Geography - Geology
> 200A Felmley Hall
> Normal, Illinois 61790-4400
>
> (309) 438-8112
> jthayn at ilstu.edu
> my.ilstu.edu/~jthayn
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jthayn at ilstu.edu  Thu Mar  4 19:31:19 2010
From: jthayn at ilstu.edu (Jonathan Thayn)
Date: Thu, 4 Mar 2010 12:31:19 -0600
Subject: [R-sig-Geo] get the neighbors from a specified node in an nb
	object
In-Reply-To: <alpine.LRH.2.00.1003041729290.11333@reclus.nhh.no>
References: <30D4A8EB-E2BB-45DD-B8B1-36B7E26AD0A0@ilstu.edu>
	<alpine.LRH.2.00.1003041729290.11333@reclus.nhh.no>
Message-ID: <FB220307-219C-4F8C-8E89-9212FA87A004@ilstu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100304/4665b960/attachment.pl>

From julien.beguin.1 at ulaval.ca  Fri Mar  5 00:56:11 2010
From: julien.beguin.1 at ulaval.ca (Julien Beguin)
Date: Thu, 4 Mar 2010 18:56:11 -0500
Subject: [R-sig-Geo] Adjacency matrix of higher order (from winbugs to R)
In-Reply-To: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F62C@EXCH-MBX-F.ulaval.ca>
References: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F62C@EXCH-MBX-F.ulaval.ca>
Message-ID: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F62F@EXCH-MBX-F.ulaval.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100304/c135be66/attachment.html>

From Roger.Bivand at nhh.no  Fri Mar  5 15:06:24 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Mar 2010 15:06:24 +0100 (CET)
Subject: [R-sig-Geo] Adjacency matrix of higher order (from winbugs to R)
In-Reply-To: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F62F@EXCH-MBX-F.ulaval.ca>
References: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F62C@EXCH-MBX-F.ulaval.ca>
	<B56D7C27B4408243B93FBC46ABECB5A0011A83C8F62F@EXCH-MBX-F.ulaval.ca>
Message-ID: <alpine.LRH.2.00.1003051142220.14477@reclus.nhh.no>

On Thu, 4 Mar 2010, Julien Beguin wrote:

> Hi everyone,
> 
> I am trying to find a way to calculate an adjacency matrix from a polygon
> shapefile to make a CAR model in winbugs, but I would like to vary the order
> of neihborhood. I checked previous messages on the list but did not find
> this specific topic. I used the the spdep package to create an adjacency
> matrix (in list format) of order 2 and it works pretty fine:

Did you look at ?nblag - is that what you need?

Roger

> ---------------------------------------------------------------------------
> ------------
> ?? shape <- readShapePoly("path_to_my_shapefile", IDvar="Id")
> ?? shape_nb<-poly2nb(shape)
> 
> ?? data<-list(
> ?? N = length(shape_nb),
> ?? num=sapply(shape_nb, length),
> ?? adj=unlist(shape_nb),
> ?? lst?= attr(shape_nb, "region.id"),
> ?? adj2?= lst[unlist(shape_nb)],
> ?? sumNumNeigh=length(unlist(shape_nb)
> ?? )
> ---------------------------------------------------------------------------
> -------------
> is everyone know how to calculate an adjacency matrix in R for polygon
> shapefile but for higher orders of neihborhood (ex: 3,4,5, etc...)? I did
> not see any option with the function poly2nb() in spdep package but I
> imagine that other tools have to exist. Your help would be greatly
> appreciated.
> 
> Best regards,
> 
> Julien
> 
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From julien.beguin.1 at ulaval.ca  Mon Mar  8 18:35:52 2010
From: julien.beguin.1 at ulaval.ca (Julien Beguin)
Date: Mon, 8 Mar 2010 12:35:52 -0500
Subject: [R-sig-Geo] RE : Adjacency matrix of higher order (from winbugs to
 R)
In-Reply-To: <alpine.LRH.2.00.1003051142220.14477@reclus.nhh.no>
References: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F62C@EXCH-MBX-F.ulaval.ca>
	<B56D7C27B4408243B93FBC46ABECB5A0011A83C8F62F@EXCH-MBX-F.ulaval.ca>,
	<alpine.LRH.2.00.1003051142220.14477@reclus.nhh.no>
Message-ID: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F634@EXCH-MBX-F.ulaval.ca>

Thank you Roger, problem resolved.

Julien
________________________________________
De : Roger Bivand [Roger.Bivand at nhh.no]
Date d'envoi : 5 mars 2010 09:06
? : Julien Beguin
Cc : r-sig-geo at stat.math.ethz.ch
Objet : Re: [R-sig-Geo] Adjacency matrix of higher order (from winbugs to R)

On Thu, 4 Mar 2010, Julien Beguin wrote:

> Hi everyone,
>
> I am trying to find a way to calculate an adjacency matrix from a polygon
> shapefile to make a CAR model in winbugs, but I would like to vary the order
> of neihborhood. I checked previous messages on the list but did not find
> this specific topic. I used the the spdep package to create an adjacency
> matrix (in list format) of order 2 and it works pretty fine:

Did you look at ?nblag - is that what you need?

Roger

> ---------------------------------------------------------------------------
> ------------
>    shape <- readShapePoly("path_to_my_shapefile", IDvar="Id")
>    shape_nb<-poly2nb(shape)
>
>    data<-list(
>    N = length(shape_nb),
>    num=sapply(shape_nb, length),
>    adj=unlist(shape_nb),
>    lst = attr(shape_nb, "region.id"),
>    adj2 = lst[unlist(shape_nb)],
>    sumNumNeigh=length(unlist(shape_nb)
>    )
> ---------------------------------------------------------------------------
> -------------
> is everyone know how to calculate an adjacency matrix in R for polygon
> shapefile but for higher orders of neihborhood (ex: 3,4,5, etc...)? I did
> not see any option with the function poly2nb() in spdep package but I
> imagine that other tools have to exist. Your help would be greatly
> appreciated.
>
> Best regards,
>
> Julien
>
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From zev at zevross.com  Mon Mar  8 22:31:12 2010
From: zev at zevross.com (Zev Ross)
Date: Mon, 08 Mar 2010 16:31:12 -0500
Subject: [R-sig-Geo] GSTAT-inconsistent predictions KED w spline
Message-ID: <4B956CA0.4060907@zevross.com>

Hi All,

I am getting inconsistent predictions from GSTAT when I have a spline as 
part of the external drift while kriging.Can anyone explain why this 
might be?

In particular, I noticed that the predictions at a particular point will 
depend upon how many observations I have in the "newdata" argument. 
Using the meuse data as an example, you'll see that the predictions at 
the same first 5 records will be different if I include just those five 
records (second example below) or a larger dataset that includes those 
five records.

Perhaps using a spline in the drift is not supported and I should use a 
polynomial? I prefer using the spline.

Zev


library(splines)
data(meuse)
data(meuse.grid)

coordinates(meuse) = ~x + y
coordinates(meuse.grid) = ~x + y

lznr.vgm = variogram(log(zinc) ~ ns(dist,3), meuse)
lznr.fit = fit.variogram(lznr.vgm, model = vgm(1, "Exp", 300,+ 1))
plot(lznr.vgm, lznr.fit)
preds<-krige(log(zinc) ~ ns(dist,3), meuse, meuse.grid, lznr.fit)
preds[["var1.pred"]][1:5] # these predictions will be different from 
those below

data(meuse.grid)
meuse.grid<-meuse.grid[1:5,]
coordinates(meuse.grid) = ~x + y
preds<-krige(log(zinc) ~ ns(dist,3), meuse, meuse.grid, lznr.fit)
preds[["var1.pred"]][1:5] # these predictions are different from those above

-- 
Zev Ross
ZevRoss Spatial Analysis
120 N Aurora, Suite 3A
Ithaca, NY 14850
607-277-0004 (phone)
866-877-3690 (fax, toll-free)
zev at zevross.com


From mdsumner at gmail.com  Tue Mar  9 03:13:21 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 9 Mar 2010 13:13:21 +1100
Subject: [R-sig-Geo] raster (graphics) support in R 2.11.0
Message-ID: <522664f81003081813q1902a43bgb3700456e2269cac@mail.gmail.com>

Hello, I've been experimenting with the new raster graphics support in
2.11.0 (unstable)  It's nice as it can provide graphical
interpolation, and arbitrary rotation (angle is not obviously useful
in this context, but I've included it for experimenting).

This is a version of sp:::image.SpatialGridDataFrame that sets up the
data for the raster graphics function. I'm not sure how to handle
missing values, here they are just set to white. Probably it's best to
live with the warnings from raster, but it might be possible to
determine if the device can deal with it. "Per-pixel transparency" is
not supported on the windows() or png() device (on Windows) but it
seems to work for pdf().

The raster() function is very raw so it takes a bit of setting up to
use. It expects an existing plot that is added to, and it can take a
matrix of (hex) colours or a matrix or 3D array of values between 0
and 1.

Best regards,
Mike

raster.SGDF <- function (x, attr = 1, xcol = 1, ycol = 2, col = heat.colors(12),
    red = NULL, green = NULL, blue = NULL, axes = FALSE, xlim = NULL,
    ylim = NULL, add = FALSE, ..., asp = NA, setParUsrBB = FALSE,
interpolate = FALSE, angle = 0)
{
    ## function to scale values to [0, 1]
    scl <- function(x) (x - min(x, na.rm  = TRUE))/diff(range(x, na.rm = TRUE))
    ## bounding box of the image
    bb <- bbox(x)

    ## set up the background plot if it's not already
    if (!add)
        plot(as(x, "Spatial"), xlim = xlim, ylim = ylim, axes = axes,
            asp = asp, ..., setParUsrBB = setParUsrBB)

    ## 1-band case
    if (is.null(red)) {
        x <- x[attr]
        NAs <- is.na(x[[1]])
        nvalues <- length(unique(x[[1]][!NAs]))

        m <-  scl(t(matrix(x[[1]], x at grid@cells.dim[1], x at grid@cells.dim[2])))
        m <- matrix(col[as.vector(m) * (length(col)-1) + 1], nrow(m), ncol(m))
        ## if missing, set to white
        m[is.na(m)] <- rgb(1, 1, 1)


    } else {
        ## 3-band RGB case

        if (is.null(green) || is.null(blue))
            stop("all colour bands must be given")
        ## band data and missing values
        xd <- x at data[, c(red, green, blue)]
        NAs <- is.na(xd[, 1]) | is.na(xd[, 2]) | is.na(xd[, 3])
        if (any(NAs))
            xd <- xd[!NAs, ]
        ## create RGBs (using alpha=1 by default)
        RGBs <- rgb(xd, max = 255)
        if (any(NAs)) {
            z <- rep(NA, length(NAs))
            z[!NAs] <- RGBs
            RGBs <- z
        }

        cv <- coordinatevalues(getGridTopology(x))
        m <- t(matrix(RGBs, x at grid@cells.dim[1], x at grid@cells.dim[2],
        byrow = FALSE))
    }
    raster(m, bb[1,1], bb[2,1], bb[1,2], bb[2,2], interpolate =
interpolate, angle = angle)
}
op <- par(mfrow = c(3, 1))
raster.SGDF(Rlogo, red = "band1", green = "band1", blue = "band3",
interpolate = FALSE)

raster.SGDF(Rlogo, col = grey(seq(0, 1, length = 10)), angle = 28)
raster.SGDF(Rlogo, col = grey(seq(0, 1, length = 10)), interpolate = TRUE)
par(op)

 sessionInfo()
R version 2.11.0 Under development (unstable) (2010-03-07 r51225)
x86_64-pc-mingw64

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sp_0.9-60

loaded via a namespace (and not attached):
[1] grid_2.11.0    lattice_0.18-3 tools_2.11.0


From mdsumner at gmail.com  Tue Mar  9 03:19:58 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 9 Mar 2010 13:19:58 +1100
Subject: [R-sig-Geo] raster (graphics) support in R 2.11.0
In-Reply-To: <522664f81003081813q1902a43bgb3700456e2269cac@mail.gmail.com>
References: <522664f81003081813q1902a43bgb3700456e2269cac@mail.gmail.com>
Message-ID: <522664f81003081819o3a324972qbc10f5ab9b5d4338@mail.gmail.com>

My apologies, I left out the data set up for Rlogo. Here is the full session:


raster.SGDF <- function (x, attr = 1, xcol = 1, ycol = 2, col = heat.colors(12),
    red = NULL, green = NULL, blue = NULL, axes = FALSE, xlim = NULL,
    ylim = NULL, add = FALSE, ..., asp = NA, setParUsrBB = FALSE,
interpolate = FALSE, angle = 0)
{
    ## function to scale values to [0, 1]
    scl <- function(x) (x - min(x, na.rm  = TRUE))/diff(range(x, na.rm = TRUE))
    ## bounding box of the image
    bb <- bbox(x)

    ## set up the background plot if it's not already
    if (!add)
        plot(as(x, "Spatial"), xlim = xlim, ylim = ylim, axes = axes,
            asp = asp, ..., setParUsrBB = setParUsrBB)

    ## 1-band case
    if (is.null(red)) {
        x <- x[attr]
        NAs <- is.na(x[[1]])
        nvalues <- length(unique(x[[1]][!NAs]))

        m <-  scl(t(matrix(x[[1]], x at grid@cells.dim[1], x at grid@cells.dim[2])))
        m <- matrix(col[as.vector(m) * (length(col)-1) + 1], nrow(m), ncol(m))
        ## if missing, set to white
        m[is.na(m)] <- rgb(1, 1, 1)


    } else {
        ## 3-band RGB case

        if (is.null(green) || is.null(blue))
            stop("all colour bands must be given")
        ## band data and missing values
        xd <- x at data[, c(red, green, blue)]
        NAs <- is.na(xd[, 1]) | is.na(xd[, 2]) | is.na(xd[, 3])
        if (any(NAs))
            xd <- xd[!NAs, ]
        ## create RGBs (using alpha=1 by default)
        RGBs <- rgb(xd, max = 255)
        if (any(NAs)) {
            z <- rep(NA, length(NAs))
            z[!NAs] <- RGBs
            RGBs <- z
        }

        cv <- coordinatevalues(getGridTopology(x))
        m <- t(matrix(RGBs, x at grid@cells.dim[1], x at grid@cells.dim[2],
        byrow = FALSE))
    }
    raster(m, bb[1,1], bb[2,1], bb[1,2], bb[2,2], interpolate =
interpolate, angle = angle)
}
  library(sp)  ## R 2.11.0
  data(Rlogo)
  d = dim(Rlogo)
  cellsize = abs(c(gt[2],gt[6]))
  cells.dim = c(d[1], d[2]) # c(d[2],d[1])
  cellcentre.offset = c(x = gt[1] + 0.5 * cellsize[1], y = gt[4] -
(d[2] - 0.5) * abs(cellsize[2]))
  grid = GridTopology(cellcentre.offset, cellsize, cells.dim)
  df = as.vector(Rlogo[,,1])
  for (band in 2:d[3]) df = cbind(df, as.vector(Rlogo[,,band]))
  df = as.data.frame(df)
  names(df) = paste("band", 1:d[3], sep="")
  Rlogo <- SpatialGridDataFrame(grid = grid, data = df)

op <- par(mfrow = c(3, 1))
raster.SGDF(Rlogo, red = "band1", green = "band1", blue = "band3",
interpolate = FALSE)

raster.SGDF(Rlogo, col = grey(seq(0, 1, length = 10)), angle = 28)
raster.SGDF(Rlogo, col = grey(seq(0, 1, length = 10)), interpolate = TRUE)
par(op)

 sessionInfo()
R version 2.11.0 Under development (unstable) (2010-03-07 r51225)
x86_64-pc-mingw64

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sp_0.9-60

loaded via a namespace (and not attached):
[1] grid_2.11.0    lattice_0.18-3 tools_2.11.0




On Tue, Mar 9, 2010 at 1:13 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> Hello, I've been experimenting with the new raster graphics support in
> 2.11.0 (unstable) ?It's nice as it can provide graphical
> interpolation, and arbitrary rotation (angle is not obviously useful
> in this context, but I've included it for experimenting).
>
> This is a version of sp:::image.SpatialGridDataFrame that sets up the
> data for the raster graphics function. I'm not sure how to handle
> missing values, here they are just set to white. Probably it's best to
> live with the warnings from raster, but it might be possible to
> determine if the device can deal with it. "Per-pixel transparency" is
> not supported on the windows() or png() device (on Windows) but it
> seems to work for pdf().
>
> The raster() function is very raw so it takes a bit of setting up to
> use. It expects an existing plot that is added to, and it can take a
> matrix of (hex) colours or a matrix or 3D array of values between 0
> and 1.
>
> Best regards,
> Mike
>
> raster.SGDF <- function (x, attr = 1, xcol = 1, ycol = 2, col = heat.colors(12),
> ? ?red = NULL, green = NULL, blue = NULL, axes = FALSE, xlim = NULL,
> ? ?ylim = NULL, add = FALSE, ..., asp = NA, setParUsrBB = FALSE,
> interpolate = FALSE, angle = 0)
> {
> ? ?## function to scale values to [0, 1]
> ? ?scl <- function(x) (x - min(x, na.rm ?= TRUE))/diff(range(x, na.rm = TRUE))
> ? ?## bounding box of the image
> ? ?bb <- bbox(x)
>
> ? ?## set up the background plot if it's not already
> ? ?if (!add)
> ? ? ? ?plot(as(x, "Spatial"), xlim = xlim, ylim = ylim, axes = axes,
> ? ? ? ? ? ?asp = asp, ..., setParUsrBB = setParUsrBB)
>
> ? ?## 1-band case
> ? ?if (is.null(red)) {
> ? ? ? ?x <- x[attr]
> ? ? ? ?NAs <- is.na(x[[1]])
> ? ? ? ?nvalues <- length(unique(x[[1]][!NAs]))
>
> ? ? ? ?m <- ?scl(t(matrix(x[[1]], x at grid@cells.dim[1], x at grid@cells.dim[2])))
> ? ? ? ?m <- matrix(col[as.vector(m) * (length(col)-1) + 1], nrow(m), ncol(m))
> ? ? ? ?## if missing, set to white
> ? ? ? ?m[is.na(m)] <- rgb(1, 1, 1)
>
>
> ? ?} else {
> ? ? ? ?## 3-band RGB case
>
> ? ? ? ?if (is.null(green) || is.null(blue))
> ? ? ? ? ? ?stop("all colour bands must be given")
> ? ? ? ?## band data and missing values
> ? ? ? ?xd <- x at data[, c(red, green, blue)]
> ? ? ? ?NAs <- is.na(xd[, 1]) | is.na(xd[, 2]) | is.na(xd[, 3])
> ? ? ? ?if (any(NAs))
> ? ? ? ? ? ?xd <- xd[!NAs, ]
> ? ? ? ?## create RGBs (using alpha=1 by default)
> ? ? ? ?RGBs <- rgb(xd, max = 255)
> ? ? ? ?if (any(NAs)) {
> ? ? ? ? ? ?z <- rep(NA, length(NAs))
> ? ? ? ? ? ?z[!NAs] <- RGBs
> ? ? ? ? ? ?RGBs <- z
> ? ? ? ?}
>
> ? ? ? ?cv <- coordinatevalues(getGridTopology(x))
> ? ? ? ?m <- t(matrix(RGBs, x at grid@cells.dim[1], x at grid@cells.dim[2],
> ? ? ? ?byrow = FALSE))
> ? ?}
> ? ?raster(m, bb[1,1], bb[2,1], bb[1,2], bb[2,2], interpolate =
> interpolate, angle = angle)
> }
> op <- par(mfrow = c(3, 1))
> raster.SGDF(Rlogo, red = "band1", green = "band1", blue = "band3",
> interpolate = FALSE)
>
> raster.SGDF(Rlogo, col = grey(seq(0, 1, length = 10)), angle = 28)
> raster.SGDF(Rlogo, col = grey(seq(0, 1, length = 10)), interpolate = TRUE)
> par(op)
>
> ?sessionInfo()
> R version 2.11.0 Under development (unstable) (2010-03-07 r51225)
> x86_64-pc-mingw64
>
> locale:
> [1] LC_COLLATE=English_Australia.1252 ?LC_CTYPE=English_Australia.1252
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> [1] sp_0.9-60
>
> loaded via a namespace (and not attached):
> [1] grid_2.11.0 ? ?lattice_0.18-3 tools_2.11.0
>


From Roger.Bivand at nhh.no  Tue Mar  9 10:26:24 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 9 Mar 2010 10:26:24 +0100 (CET)
Subject: [R-sig-Geo] sp 0.9-61
Message-ID: <alpine.LRH.2.00.1003091015170.29641@reclus.nhh.no>

A update to the sp package, version 0.9-61 has been released on CRAN and 
will propagate to mirrors soon.

Versions 0.9-56 through 0.9-60 can be installed on R < 2.9.1 but fail when 
functions calling anyDuplicated() (spChFIDs() or any function calling 
Polygons()) are used. The problem only affects users of R < 2.9.1 and sp 
between 0.9-56 and 0.9-60. Users of R < 2.9.1 should revert to 0.9-52, or 
upgrade R if this problem affects you.

The new version now correctly depends on versions of R >= 2.9.1 that 
provide anyDuplicated().

Roger

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.aluizio at gmail.com  Tue Mar  9 15:02:40 2010
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Tue, 9 Mar 2010 11:02:40 -0300
Subject: [R-sig-Geo] Color Ramp on SpatialLines Object
Message-ID: <4b965507.47c1f10a.6aed.ffffa229@mx.google.com>

Hi List.

I?m preparing  a map for color publication and some colleagues of mine which
participate on this work, asked me to put the bathymetric lines in a color
ramp of deepness (eg.: light blue to dark blue) just to create an didactic
effect.

Well, this bathymetric data are stored in SpatialLinesDataFrame Object
imported from ShapeFiles with the readOGR (package rgdal) function. Here is
a summary of the object:

 

Object of class SpatialLinesDataFrame

Coordinates:

         min       max

r1 -53.01238 -26.92788

r2 -35.74499   7.03177

Is projected: FALSE 

proj4string :

[+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0]

Data attributes:

 OBJECTID_1      OBJECTID            COTA     

 Min.   :   1           Min.   :   1            Min.   :  25  

 1st Qu.: 570       1st Qu.: 570        1st Qu.: 850  

 Median :1139   Median :1139    Median :1900  

 Mean   :1139     Mean   :1139      Mean   :2128  

 3rd Qu.:1708     3rd Qu.:1708      3rd Qu.:3250  

 Max.   :2277      Max.   :2277       Max.   :5750  

                                             

 SHAPE_Leng                     Shape_Le_1                      LAYER     

 Min.   :  0.04632               Min.   :    5079                    4000
: 120  

 1st Qu.:  0.35611             1st Qu.:   39116                 3500   : 119


 Median :  0.61498           Median :   67435              3000   : 103  

 Mean   :  2.58294            Mean   :  279864               3250   :  95  

 3rd Qu.:  1.13124            3rd Qu.:  123223               3750   :  93  

 Max.   :123.74401           Max.   :13320334              2500   :  89  

 
(Other):1658

 

Well I can plot it without any problem in a map with other ShapeFiles
(SpatialPolygonsDataFrame in this case) imported in the same way. With the
Polygons I?m able to color each item with the color I want (eg.:
col=c(?col1?,?col2?,?etc?)), but I?m not able to do so with the Lines object
(neither with the col=c(?col1?,?etc?) or the
col=c(colorRampPalette(c(?initcol?,?endcol?)) function), when I try it the
same way I did with the Polygons, only the first specified color is applied
to all lines and the others are ignored, if I try with the colorRampPalette
function nothing is plotted and I got a lot of warnings (cor especificada
n?o ? nem num?rica nem caracter == specified color is not numeric neither
character)

 

So, here is the doubt, is there a way to designate specific colors to each
line of a SpatialLines* Object?

Ps.: I?m using the plot() function to draw the maps (probably a specific
panel variation of sp package).

 

Thank you for your attention, I hope you may help me.

 

-------------------------------------------------------------

MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio

Centro de Estudos do Mar/UFPR
Laborat?rio de Micropaleontologia
Avenida Beira Mar s/n - CEP 83255-000
Pontal do Paran? - PR - Brasil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100309/c630825e/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 4925 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100309/c630825e/attachment.bin>

From gledson.picharski at yahoo.com.br  Tue Mar  9 15:56:05 2010
From: gledson.picharski at yahoo.com.br (Gledson Picharski)
Date: Tue, 9 Mar 2010 06:56:05 -0800 (PST)
Subject: [R-sig-Geo] Res:  Color Ramp on SpatialLines Object
In-Reply-To: <4b965507.47c1f10a.6aed.ffffa229@mx.google.com>
References: <4b965507.47c1f10a.6aed.ffffa229@mx.google.com>
Message-ID: <623716.22054.qm@web63104.mail.re1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100309/f5f3c432/attachment.pl>

From r.aluizio at gmail.com  Tue Mar  9 16:32:12 2010
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Tue, 9 Mar 2010 12:32:12 -0300
Subject: [R-sig-Geo] Res: Color Ramp on SpatialLines Object
In-Reply-To: <623716.22054.qm@web63104.mail.re1.yahoo.com>
References: <4b965507.47c1f10a.6aed.ffffa229@mx.google.com>
	<623716.22054.qm@web63104.mail.re1.yahoo.com>
Message-ID: <71ea40f61003090732j751695a1q6a277b816a10174f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100309/120e7498/attachment.pl>

From juantomas.sayago at gmail.com  Wed Mar 10 00:05:34 2010
From: juantomas.sayago at gmail.com (Juan Tomas Sayago)
Date: Tue, 9 Mar 2010 18:05:34 -0500
Subject: [R-sig-Geo] Geocode for Bogota
Message-ID: <3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100309/170cbd20/attachment.pl>

From dan.putler at sauder.ubc.ca  Wed Mar 10 00:53:54 2010
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Tue, 9 Mar 2010 15:53:54 -0800
Subject: [R-sig-Geo] Geocode for Bogota
In-Reply-To: <3704_1268176021_1268176021_3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com>
References: <3704_1268176021_1268176021_3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com>
Message-ID: <1268178834.7125.43.camel@whitebox>

Hi Juan,

I don't know a way to do this in R. Outside of R you need both data
(such as a road network file with address ranges, address centroids, or
a land parcel layer) and software (a postal address geocoder). My guess
is that you will likely find it easiest to use one of the online mapping
sites (like Google maps) and script based geocoder software. To that
end, you might want to look at geopy: www.geopy.org.

Dan

On Tue, 2010-03-09 at 15:05 -0800, Juan Tomas Sayago wrote:
> Dear List,
> I need to geocode or to convert from address to coordenates.
> If someone knows what program I should use and some tips for  it.
> Thanks
> Juan
> 
-- 
Dan Putler
Sauder School of Business
University of British Columbia


From seanpor at acm.org  Wed Mar 10 06:51:53 2010
From: seanpor at acm.org (Sean O'Riordain)
Date: Wed, 10 Mar 2010 05:51:53 +0000
Subject: [R-sig-Geo] spatial clustering taking account of "value"
Message-ID: <8ed68eed1003092151u132c0b15k2d5c23832f14d208@mail.gmail.com>

Good morning,

I'm afraid I don't even know *exactly* what I'm looking for - apart
from some guidance please!

I have about 1.5 million (x,y,value) triples - for the most part these
are independent from each other - building location and sum insured.
I'm sure there are *lots* of clusters but I've no idea how many, and
I'm really only interested in looking at the clusters of highest
value.

I've already programmed a simple tagging of total value within 500
metres of every location - though not every building is accurately
tagged - some are only geocoded to UK postcode - so all buildings in a
postcode have the same coordinates.

I'm looking to highlight "clusters" (definition unclear!) where there
are a number of points "close together" (definition unclear!) and the
sum of all the values in the "cluster" is "high".? I'm happy to ignore
all "low" valued clusters or points which are of low value and all on
their own.? There could be a maximum threshold distance (say 5km) or
space between points beyond which it is definitely not part of a
cluster.? The algorithm doesn't have to perfectly identify all
clusters - I'm quite happy to start by looking that a small (say the
top 10) set of highest valued "clusters".

I've looked at a variety of sources on the web - but it is my
understanding that 1 million+ points is considered *very* big for most
clustering algorithms.  I've only come across clustering by distance
rather than sum of value and distance - I'm probably missing something
or mis-interpreting what I'm seeing!  I think I'm looking for a
modified form of density clustering...  Clearly I can't create a
full-size distance matrix and perfection isn't expected ! :-)  A
modified DBSCAN looks like it might be what I'm looking for?

Clearly an alternative to clustering is some sort of density algorithm
that allows for value - but I can't quite get my head around how this
might work.

Could someone point me in the right direction - what other keywords
should I be looking out for?? what R packages are worth a look?

Thanks in advance,
Sean O'Riordain
Dublin,
Ireland


From dan.putler at sauder.ubc.ca  Wed Mar 10 07:50:25 2010
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Tue, 9 Mar 2010 22:50:25 -0800
Subject: [R-sig-Geo] spatial clustering taking account of "value"
In-Reply-To: <4706_1268200348_1268200348_8ed68eed1003092151u132c0b15k2d5c23832f14d208@mail.gmail.com>
References: <4706_1268200348_1268200348_8ed68eed1003092151u132c0b15k2d5c23832f14d208@mail.gmail.com>
Message-ID: <1268203825.6952.20.camel@whitebox>

Hi Sean,

Yes, 1.5 million points is a lot of data. What scale is it on? Is it for
all of the UK, or a single metropolitan area?

I ask this because you probably want to break the data into smaller
areas and then cluster each of those areas. You can do this using some
sort of administrative boundaries, or alternatively, you can construct a
relative neighbor graph, and then create sub-graphs of the larger graph
by removing edges from the graph that exceed a threshold. You then
cluster each of the sub-graphs. You can construct the relative neighbor
graph using the relativeneigh() function of the spdeps package
(although, my guess is you will need a machine with a lot of memory).
Clustering with a spatial density based algorithm is a good choice.

I have actually used this two-step method before to good effect (using
DBSCAN and modified versions of DBSCAN where the epsilon radius is a
function of the local population density), although, with data sets of
20,000 points (which is typically considered to be a lot of points).

It if you are interested in what I do, you might want to get in touch
with me off list.

Dan

On Tue, 2010-03-09 at 21:51 -0800, Sean O'Riordain wrote:
> Good morning,
> 
> I'm afraid I don't even know *exactly* what I'm looking for - apart
> from some guidance please!
> 
> I have about 1.5 million (x,y,value) triples - for the most part these
> are independent from each other - building location and sum insured.
> I'm sure there are *lots* of clusters but I've no idea how many, and
> I'm really only interested in looking at the clusters of highest
> value.
> 
> I've already programmed a simple tagging of total value within 500
> metres of every location - though not every building is accurately
> tagged - some are only geocoded to UK postcode - so all buildings in a
> postcode have the same coordinates.
> 
> I'm looking to highlight "clusters" (definition unclear!) where there
> are a number of points "close together" (definition unclear!) and the
> sum of all the values in the "cluster" is "high".  I'm happy to ignore
> all "low" valued clusters or points which are of low value and all on
> their own.  There could be a maximum threshold distance (say 5km) or
> space between points beyond which it is definitely not part of a
> cluster.  The algorithm doesn't have to perfectly identify all
> clusters - I'm quite happy to start by looking that a small (say the
> top 10) set of highest valued "clusters".
> 
> I've looked at a variety of sources on the web - but it is my
> understanding that 1 million+ points is considered *very* big for most
> clustering algorithms.  I've only come across clustering by distance
> rather than sum of value and distance - I'm probably missing something
> or mis-interpreting what I'm seeing!  I think I'm looking for a
> modified form of density clustering...  Clearly I can't create a
> full-size distance matrix and perfection isn't expected ! :-)  A
> modified DBSCAN looks like it might be what I'm looking for?
> 
> Clearly an alternative to clustering is some sort of density algorithm
> that allows for value - but I can't quite get my head around how this
> might work.
> 
> Could someone point me in the right direction - what other keywords
> should I be looking out for?  what R packages are worth a look?
> 
> Thanks in advance,
> Sean O'Riordain
> Dublin,
> Ireland
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-- 
Dan Putler
Sauder School of Business
University of British Columbia


From seanpor at acm.org  Wed Mar 10 10:32:34 2010
From: seanpor at acm.org (Sean O'Riordain)
Date: Wed, 10 Mar 2010 09:32:34 +0000
Subject: [R-sig-Geo] spatial clustering taking account of "value"
In-Reply-To: <1268203825.6952.20.camel@whitebox>
References: <4706_1268200348_1268200348_8ed68eed1003092151u132c0b15k2d5c23832f14d208@mail.gmail.com>
	<1268203825.6952.20.camel@whitebox>
Message-ID: <8ed68eed1003100132o5ffcad7blc9d8ef2600f172d8@mail.gmail.com>

Hi Dan,

Thanks for that.  Yes indeed it is intended for the entire UK - but
clearly there are large swathes of the country where the 'cluster
value' would be below the nominal threshold of interest - the trick
(in my mind) is to identify the approximate areas of interest and
areas of non-interest without prior knowledge of the clusters - though
clearly central London is likely to be a candidate and the highlands
of Scotland (oil refineries excluded!) are not!

I'll do some experiments later to look at the memory requirements of
relativeneigh() ... this machine has 12gb... we'll see! :-)

cheers and thanks again,
Se?n



On Wed, Mar 10, 2010 at 6:50 AM, Dan Putler <dan.putler at sauder.ubc.ca> wrote:
> Hi Sean,
>
> Yes, 1.5 million points is a lot of data. What scale is it on? Is it for
> all of the UK, or a single metropolitan area?
>
> I ask this because you probably want to break the data into smaller
> areas and then cluster each of those areas. You can do this using some
> sort of administrative boundaries, or alternatively, you can construct a
> relative neighbor graph, and then create sub-graphs of the larger graph
> by removing edges from the graph that exceed a threshold. You then
> cluster each of the sub-graphs. You can construct the relative neighbor
> graph using the relativeneigh() function of the spdeps package
> (although, my guess is you will need a machine with a lot of memory).
> Clustering with a spatial density based algorithm is a good choice.
>
> I have actually used this two-step method before to good effect (using
> DBSCAN and modified versions of DBSCAN where the epsilon radius is a
> function of the local population density), although, with data sets of
> 20,000 points (which is typically considered to be a lot of points).
>
> It if you are interested in what I do, you might want to get in touch
> with me off list.
>
> Dan
>
> On Tue, 2010-03-09 at 21:51 -0800, Sean O'Riordain wrote:
>> Good morning,
>>
>> I'm afraid I don't even know *exactly* what I'm looking for - apart
>> from some guidance please!
>>
>> I have about 1.5 million (x,y,value) triples - for the most part these
>> are independent from each other - building location and sum insured.
>> I'm sure there are *lots* of clusters but I've no idea how many, and
>> I'm really only interested in looking at the clusters of highest
>> value.
>>
>> I've already programmed a simple tagging of total value within 500
>> metres of every location - though not every building is accurately
>> tagged - some are only geocoded to UK postcode - so all buildings in a
>> postcode have the same coordinates.
>>
>> I'm looking to highlight "clusters" (definition unclear!) where there
>> are a number of points "close together" (definition unclear!) and the
>> sum of all the values in the "cluster" is "high". ?I'm happy to ignore
>> all "low" valued clusters or points which are of low value and all on
>> their own. ?There could be a maximum threshold distance (say 5km) or
>> space between points beyond which it is definitely not part of a
>> cluster. ?The algorithm doesn't have to perfectly identify all
>> clusters - I'm quite happy to start by looking that a small (say the
>> top 10) set of highest valued "clusters".
>>
>> I've looked at a variety of sources on the web - but it is my
>> understanding that 1 million+ points is considered *very* big for most
>> clustering algorithms. ?I've only come across clustering by distance
>> rather than sum of value and distance - I'm probably missing something
>> or mis-interpreting what I'm seeing! ?I think I'm looking for a
>> modified form of density clustering... ?Clearly I can't create a
>> full-size distance matrix and perfection isn't expected ! :-) ?A
>> modified DBSCAN looks like it might be what I'm looking for?
>>
>> Clearly an alternative to clustering is some sort of density algorithm
>> that allows for value - but I can't quite get my head around how this
>> might work.
>>
>> Could someone point me in the right direction - what other keywords
>> should I be looking out for? ?what R packages are worth a look?
>>
>> Thanks in advance,
>> Sean O'Riordain
>> Dublin,
>> Ireland
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> --
> Dan Putler
> Sauder School of Business
> University of British Columbia
>
>


From carson.farmer at gmail.com  Wed Mar 10 11:06:49 2010
From: carson.farmer at gmail.com (Carson Farmer)
Date: Wed, 10 Mar 2010 10:06:49 +0000
Subject: [R-sig-Geo] spatial clustering taking account of "value"
In-Reply-To: <8ed68eed1003100132o5ffcad7blc9d8ef2600f172d8@mail.gmail.com>
References: <4706_1268200348_1268200348_8ed68eed1003092151u132c0b15k2d5c23832f14d208@mail.gmail.com>
	<1268203825.6952.20.camel@whitebox>
	<8ed68eed1003100132o5ffcad7blc9d8ef2600f172d8@mail.gmail.com>
Message-ID: <94b3c8441003100206h11ede6bbt6fdc6226757cf891@mail.gmail.com>

I may be misinterpreting your desired output, but could you not also
perform LISA on this dataset?
For example if you are interested in:

>> highlight[ing] "clusters" (definition unclear!) where there
>> are a number of points "close together" (definition unclear!) and the
>> sum of all the values in the "cluster" is "high".

Then the Getis and Ord Gi(*) statistic (not *truly* a LISA) would
likely do the trick for you.

> library(spdep)
> ?localG

>From the help:
The local spatial statistic G is calculated for each zone based on the
spatial weights object used. The value returned is a Z-value, and may
be used as a diagnostic tool. High positive values indicate the
posibility of a local cluster of high values of the variable being
analysed, very low relative values a similar cluster of low values.
The spatial weights object can be created using (as you mentioned
above) a distance threshold, or based on relativeneigh() I imagine.

Regards,

Carson


On Wed, Mar 10, 2010 at 9:32 AM, Sean O'Riordain <seanpor at acm.org> wrote:
> Hi Dan,
>
> Thanks for that. ?Yes indeed it is intended for the entire UK - but
> clearly there are large swathes of the country where the 'cluster
> value' would be below the nominal threshold of interest - the trick
> (in my mind) is to identify the approximate areas of interest and
> areas of non-interest without prior knowledge of the clusters - though
> clearly central London is likely to be a candidate and the highlands
> of Scotland (oil refineries excluded!) are not!
>
> I'll do some experiments later to look at the memory requirements of
> relativeneigh() ... this machine has 12gb... we'll see! :-)
>
> cheers and thanks again,
> Se?n
>
>
>
> On Wed, Mar 10, 2010 at 6:50 AM, Dan Putler <dan.putler at sauder.ubc.ca> wrote:
>> Hi Sean,
>>
>> Yes, 1.5 million points is a lot of data. What scale is it on? Is it for
>> all of the UK, or a single metropolitan area?
>>
>> I ask this because you probably want to break the data into smaller
>> areas and then cluster each of those areas. You can do this using some
>> sort of administrative boundaries, or alternatively, you can construct a
>> relative neighbor graph, and then create sub-graphs of the larger graph
>> by removing edges from the graph that exceed a threshold. You then
>> cluster each of the sub-graphs. You can construct the relative neighbor
>> graph using the relativeneigh() function of the spdeps package
>> (although, my guess is you will need a machine with a lot of memory).
>> Clustering with a spatial density based algorithm is a good choice.
>>
>> I have actually used this two-step method before to good effect (using
>> DBSCAN and modified versions of DBSCAN where the epsilon radius is a
>> function of the local population density), although, with data sets of
>> 20,000 points (which is typically considered to be a lot of points).
>>
>> It if you are interested in what I do, you might want to get in touch
>> with me off list.
>>
>> Dan
>>
>> On Tue, 2010-03-09 at 21:51 -0800, Sean O'Riordain wrote:
>>> Good morning,
>>>
>>> I'm afraid I don't even know *exactly* what I'm looking for - apart
>>> from some guidance please!
>>>
>>> I have about 1.5 million (x,y,value) triples - for the most part these
>>> are independent from each other - building location and sum insured.
>>> I'm sure there are *lots* of clusters but I've no idea how many, and
>>> I'm really only interested in looking at the clusters of highest
>>> value.
>>>
>>> I've already programmed a simple tagging of total value within 500
>>> metres of every location - though not every building is accurately
>>> tagged - some are only geocoded to UK postcode - so all buildings in a
>>> postcode have the same coordinates.
>>>
>>> I'm looking to highlight "clusters" (definition unclear!) where there
>>> are a number of points "close together" (definition unclear!) and the
>>> sum of all the values in the "cluster" is "high". ?I'm happy to ignore
>>> all "low" valued clusters or points which are of low value and all on
>>> their own. ?There could be a maximum threshold distance (say 5km) or
>>> space between points beyond which it is definitely not part of a
>>> cluster. ?The algorithm doesn't have to perfectly identify all
>>> clusters - I'm quite happy to start by looking that a small (say the
>>> top 10) set of highest valued "clusters".
>>>
>>> I've looked at a variety of sources on the web - but it is my
>>> understanding that 1 million+ points is considered *very* big for most
>>> clustering algorithms. ?I've only come across clustering by distance
>>> rather than sum of value and distance - I'm probably missing something
>>> or mis-interpreting what I'm seeing! ?I think I'm looking for a
>>> modified form of density clustering... ?Clearly I can't create a
>>> full-size distance matrix and perfection isn't expected ! :-) ?A
>>> modified DBSCAN looks like it might be what I'm looking for?
>>>
>>> Clearly an alternative to clustering is some sort of density algorithm
>>> that allows for value - but I can't quite get my head around how this
>>> might work.
>>>
>>> Could someone point me in the right direction - what other keywords
>>> should I be looking out for? ?what R packages are worth a look?
>>>
>>> Thanks in advance,
>>> Sean O'Riordain
>>> Dublin,
>>> Ireland
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> --
>> Dan Putler
>> Sauder School of Business
>> University of British Columbia
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Carson J. Q. Farmer
ISSP Doctoral Fellow
National Centre for Geocomputation
National University of Ireland, Maynooth,
http://www.carsonfarmer.com/


From jaime.garcia at uni-bonn.de  Wed Mar 10 13:52:13 2010
From: jaime.garcia at uni-bonn.de (Jaime R. Garcia M.)
Date: Wed, 10 Mar 2010 13:52:13 +0100
Subject: [R-sig-Geo] Text size in spplot legend
Message-ID: <1268225533.2753.32.camel@jaime>

Dear list users,

I am plotting a 'SpatialGridDataFrame' object using the spplot()
function.

I like the default legend but I would like to increase the size of the
text in the legend.

Is there a straightforward way to do it or do I need to create myself
the whole legend using the 'key' argument of the xyplot function?

Thanks for any help or suggestion,

Best,

Jaime Garcia


From edzer.pebesma at uni-muenster.de  Wed Mar 10 14:24:58 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 10 Mar 2010 14:24:58 +0100
Subject: [R-sig-Geo] Text size in spplot legend
In-Reply-To: <1268225533.2753.32.camel@jaime>
References: <1268225533.2753.32.camel@jaime>
Message-ID: <4B979DAA.70804@uni-muenster.de>

Jaime,

library(lattice)
?trellis.par.set

might provide an easier way of doing this.
--
Edzer

Jaime R. Garcia M. wrote:
> Dear list users,
>
> I am plotting a 'SpatialGridDataFrame' object using the spplot()
> function.
>
> I like the default legend but I would like to increase the size of the
> text in the legend.
>
> Is there a straightforward way to do it or do I need to create myself
> the whole legend using the 'key' argument of the xyplot function?
>
> Thanks for any help or suggestion,
>
> Best,
>
> Jaime Garcia
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From l.hawkes at bangor.ac.uk  Wed Mar 10 18:42:01 2010
From: l.hawkes at bangor.ac.uk (Lucy Hawkes)
Date: Wed, 10 Mar 2010 17:42:01 +0000
Subject: [R-sig-Geo] A function to calculate speed between two points
Message-ID: <93fa48a61003100942i35c0fd7fjda484d95b6e63d0c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100310/8655334e/attachment.pl>

From debeaudette at ucdavis.edu  Wed Mar 10 18:47:26 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Wed, 10 Mar 2010 09:47:26 -0800
Subject: [R-sig-Geo] custom variogram models
Message-ID: <201003100947.26061.dylan.beaudette@gmail.com>

Hi,

Is it possible to create "custom" variogram models that can be used within the 
gstat framework?

For example, would it be possible to generate a custom exponential model in 
the form of:

gamma = C [ 1 - exp (-3h/a) ]

instead of the typical:

gamma = C [ 1 - exp (-h/a) ]

Thanks,
Dylan


-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From h.lundqvist at gmail.com  Wed Mar 10 18:52:56 2010
From: h.lundqvist at gmail.com (Henrik Lundqvist)
Date: Wed, 10 Mar 2010 18:52:56 +0100
Subject: [R-sig-Geo] A function to calculate speed between two points
In-Reply-To: <93fa48a61003100942i35c0fd7fjda484d95b6e63d0c@mail.gmail.com>
References: <93fa48a61003100942i35c0fd7fjda484d95b6e63d0c@mail.gmail.com>
Message-ID: <5d355e911003100952l3c7e0c36i632ff28a612a595a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100310/7757ed6c/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Mar 10 20:09:07 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 10 Mar 2010 20:09:07 +0100
Subject: [R-sig-Geo] custom variogram models
In-Reply-To: <201003100947.26061.dylan.beaudette@gmail.com>
References: <201003100947.26061.dylan.beaudette@gmail.com>
Message-ID: <4B97EE53.5030106@uni-muenster.de>

Dylan Beaudette wrote:
> Hi,
>
> Is it possible to create "custom" variogram models that can be used within the 
> gstat framework?
>
> For example, would it be possible to generate a custom exponential model in 
> the form of:
>
> gamma = C [ 1 - exp (-3h/a) ]
>
> instead of the typical:
>
> gamma = C [ 1 - exp (-h/a) ]
>   
Hi Dylan,

variogram function evaluation is done in the gstat C code, to which you 
cannot pass R functions right now. If you need a particular variogram 
function that is not there, it may be easy to implement it (I could help 
here), as the code is set up such that adding functions is close to 
trivial if you've done it once. In that case, fit.variogram, vgm etc 
will also work.

It is possible to pass a custom variogram function to the krige0 
function, which does ordinary point kriging for global neighbourhoods 
(and is pure R). It means that you need the function including its 
parameters, you don't pass on C and a separately, as your example 
suggests. See ?krige0 for an example (and ignore the y argument); in 
addition, demo(wind) ends with an example with a separable product 
space-time covariance defined as R function, which is also not available 
in fit.variogram, krige etc.

This is an active research area for me, now -- feedback & suggestions 
are more than welcome.

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From j.burke at earthlink.net  Wed Mar 10 21:41:32 2010
From: j.burke at earthlink.net (Jim Burke)
Date: Wed, 10 Mar 2010 14:41:32 -0600
Subject: [R-sig-Geo] 3D bars on a Geographic Map?
Message-ID: <4B9803FC.7010603@earthlink.net>

I have a group of geographical polygons in lat long (epsg:4326) 
coordinates.
I would like to lay this polygon out at an angle.
I would like to put two 3D bar charts at the midpoint or close inside 
each polygon.

Can anyone provide an example of this? Or a web site with an example?

Thanks,
Jim Burke


From jarekj at amu.edu.pl  Wed Mar 10 22:17:27 2010
From: jarekj at amu.edu.pl (Jarek Jasiewicz)
Date: Wed, 10 Mar 2010 22:17:27 +0100
Subject: [R-sig-Geo] problem with ppm.plot in spatstat since version 1.15
Message-ID: <4B980C67.4030903@amu.edu.pl>

Hi!

I encountered following problem with R spatstat with plot.ppm trying 
reporduce some trend analysis on my old data:

to reproduce it just enough:

x1=runif(100)
y1=runif(100)

e=1
w=0
s=0
n=1

x=x1*(e-w)+w
y=y1*(n-s)+s

wind=owin(c(w,e),c(s,n))
pp=ppp(x,y,window=wind)
pp_m=ppm(pp, ~polynom(x,y,2))
plot(pp_m)

everything is OK!

but if coordinates are greater for example:
e=10000
w=1000
s=1000
n=10000

x=x1*(e-w)+w
y=y1*(n-s)+s

wind=owin(c(w,e),c(s,n))
pp=ppp(x,y,window=wind)
pp_m=ppm(pp, ~polynom(x,y,2))
plot(pp_m)


Error occured:

Error in solve.default(fisher) :
  system is computationally singular: reciprocal condition number = 
4.33811e-18
Error in mmi %*% vc : requires numeric/complex matrix/vector arguments


Till version 1.15 of spastat and R 2.8 t works!

Thanks for help
Jarek


From Debabrata.Midya at services.nsw.gov.au  Thu Mar 11 01:45:37 2010
From: Debabrata.Midya at services.nsw.gov.au (Debabrata Midya)
Date: Thu, 11 Mar 2010 11:45:37 +1100
Subject: [R-sig-Geo] Interfacing R with GRASS from R - Windows XP
Message-ID: <4B98D7E0.5860.00D0.0@services.nsw.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100311/410546f3/attachment.pl>

From milton.ruser at gmail.com  Thu Mar 11 05:04:11 2010
From: milton.ruser at gmail.com (milton ruser)
Date: Wed, 10 Mar 2010 23:04:11 -0500
Subject: [R-sig-Geo] Interfacing R with GRASS from R - Windows XP
In-Reply-To: <4B98D7E0.5860.00D0.0@services.nsw.gov.au>
References: <4B98D7E0.5860.00D0.0@services.nsw.gov.au>
Message-ID: <3aaf1a031003102004n6a8d5337qcf45d75f359ca14e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100310/cd68262e/attachment.pl>

From hengl at spatial-analyst.net  Thu Mar 11 09:26:23 2010
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Thu, 11 Mar 2010 09:26:23 +0100
Subject: [R-sig-Geo] Geocode for Bogota
In-Reply-To: <3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com>
References: <3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com>
Message-ID: <000c01cac0f4$894898f0$9bd9cad0$@net>

Google has an API that allows you to geocode addresses (or anything that spatial coordinates in their database) e.g.:

> readLines(url("http://maps.google.com/maps/geo?q=1600+Amphitheatre+Parkway,+Mountain+View,+CA
&output=csv&key=abcdefg"), n=1, warn=FALSE)
[1] 200.00000 8.00000 37.42197 -122.08414

See also:

http://spatial-analyst.net/wiki/index.php?title=Mapping_research_hot-spots

They limit, however, the number of geocode requests to 15,000 in a 24 hour period. If the url connection breaks, then it might be a good idea to run the same loop one more time and set add a while command to look for the missing coordinates.

HTH,

T. Hengl
http://home.medewerker.uva.nl/t.hengl/ 


> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] On Behalf Of Juan Tomas Sayago
> Sent: Wednesday, March 10, 2010 12:06 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Geocode for Bogota
> 
> Dear List,
> I need to geocode or to convert from address to coordenates.
> If someone knows what program I should use and some tips for  it.
> Thanks
> Juan
> 
> --
> Juan Tom?s Sayago
> Universidad Central
> http://sites.google.com/site/juantomassayago/
> Objetivo: Garantizar a cada ser humano que habite en el pa?s, una cantidad m?nima
> de agua con calidad segura para el consumo humano, en forma regular, permanente y
> suficiente para la vida y la salud
> 
> 	[[alternative HTML version deleted]]


From dave at mun.ca  Thu Mar 11 13:23:35 2010
From: dave at mun.ca (Dave Fifield)
Date: Thu, 11 Mar 2010 08:53:35 -0330
Subject: [R-sig-Geo]  A function to calculate speed between two points
In-Reply-To: <mailman.13.1268305204.17885.r-sig-geo@stat.math.ethz.ch>
References: <mailman.13.1268305204.17885.r-sig-geo@stat.math.ethz.ch>
Message-ID: <1AF25AB7FF31483CA16414AED8FC8C13@alca>

Hi Lucy,

The R package adehabitat has classes and functions to deal with animal
tracking data. When you import your data into adehabitat (into an object of
class ltraj, using as.ltraj), the speed, turning angles, etc. for each point
are calculated automatically for you and stored in the resulting data frame.

Cheers,
Dave
--
Dave Fifield
dave at mun.ca
Cognitive and Behavioural Ecology Programme
Memorial University of Newfoundland
St. John's, NL
Canada


>   
> Message: 3
> Date: Wed, 10 Mar 2010 17:42:01 +0000
> From: Lucy Hawkes <l.hawkes at bangor.ac.uk>
> To: R-sig-Geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] A function to calculate speed between two points
> Message-ID:
> 	<93fa48a61003100942i35c0fd7fjda484d95b6e63d0c at mail.gmail.com>
> Content-Type: text/plain
> 
> Hello,
> 
> I am a new spatial R user, and am analysing animal tracking data. I would
> like to calculate the speed the animal travelled between points (assuming
> linearity etc). However, even though I can find various functions for
> distance, turning angles and analyses, I can't find one for speed.
> 
> I'm sure I'm probably missing what's right in front of me, but can anyone
> suggest where to look next?
> 
> With best wishes
> 
> Lucy
> 
> -- 
> ____________________________
> Dr Lucy Hawkes
> Post Doctoral Research Officer
> Bangor University
> School of Biological Sciences
> Brambell Laboratories E30
> Deiniol Road, Bangor, LL57 2UW
> T: +44 (1248) 388 813
> E: l.hawkes at bangor.ac.uk


From michal.palenik at freemap.sk  Thu Mar 11 13:34:43 2010
From: michal.palenik at freemap.sk (Michal Palenik)
Date: Thu, 11 Mar 2010 13:34:43 +0100
Subject: [R-sig-Geo] Geocode for Bogota
In-Reply-To: <000c01cac0f4$894898f0$9bd9cad0$@net>
References: <3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com>
	<000c01cac0f4$894898f0$9bd9cad0$@net>
Message-ID: <20100311123443.GA16156@idefix>

or start your own www.openstreetmap.org geocoder
see
http://wiki.openstreetmap.org/wiki/Nominatim
if you take just the database for a part of the world (not the whole
several GB version), it is very fast

michal palenik
On Thu, Mar 11, 2010 at 09:26:23AM +0100, Tomislav Hengl wrote:
> Google has an API that allows you to geocode addresses (or anything that spatial coordinates in their database) e.g.:
> 
> > readLines(url("http://maps.google.com/maps/geo?q=1600+Amphitheatre+Parkway,+Mountain+View,+CA
> &output=csv&key=abcdefg"), n=1, warn=FALSE)
> [1] 200.00000 8.00000 37.42197 -122.08414
> 
> See also:
> 
> http://spatial-analyst.net/wiki/index.php?title=Mapping_research_hot-spots
> 
> They limit, however, the number of geocode requests to 15,000 in a 24 hour period. If the url connection breaks, then it might be a good idea to run the same loop one more time and set add a while command to look for the missing coordinates.
> 
> HTH,
> 
> T. Hengl
> http://home.medewerker.uva.nl/t.hengl/ 
> 
> 
> > -----Original Message-----
> > From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> > bounces at stat.math.ethz.ch] On Behalf Of Juan Tomas Sayago
> > Sent: Wednesday, March 10, 2010 12:06 AM
> > To: r-sig-geo at stat.math.ethz.ch
> > Subject: [R-sig-Geo] Geocode for Bogota
> > 
> > Dear List,
> > I need to geocode or to convert from address to coordenates.
> > If someone knows what program I should use and some tips for  it.
> > Thanks
> > Juan
> > 
> > --
> > Juan Tom?s Sayago
> > Universidad Central
> > http://sites.google.com/site/juantomassayago/
> > Objetivo: Garantizar a cada ser humano que habite en el pa?s, una cantidad m?nima
> > de agua con calidad segura para el consumo humano, en forma regular, permanente y
> > suficiente para la vida y la salud
> > 
> > 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
www.freemap.sk


From h.wickham at gmail.com  Thu Mar 11 16:57:39 2010
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 11 Mar 2010 09:57:39 -0600
Subject: [R-sig-Geo] Geocode for Bogota
In-Reply-To: <000c01cac0f4$894898f0$9bd9cad0$@net>
References: <3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com> 
	<000c01cac0f4$894898f0$9bd9cad0$@net>
Message-ID: <f8e6ff051003110757y4ce7179erd4f0792f6a2d655d@mail.gmail.com>

> They limit, however, the number of geocode requests to 15,000 in a 24 hour period. If the url connection breaks, then it might be a good idea to run the same loop one more time and set add a while command to look for the missing coordinates.

It's also against the terms of service to use it in this way (to save
on your local computer and as input to further analyses).

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From jay.douillard at ubc.ca  Thu Mar 11 18:21:22 2010
From: jay.douillard at ubc.ca (Jay Douillard)
Date: Thu, 11 Mar 2010 09:21:22 -0800 (PST)
Subject: [R-sig-Geo] GWR with GWT file
In-Reply-To: <27574786.68391268094423657.JavaMail.root@verrazzano>
Message-ID: <28594376.111061268328082154.JavaMail.root@verrazzano>

I'm working on a project where the distance between two polygons may be a poor measure of connectivity(contigious polygons that may have an impassible mountain chain between them. To get a better measure of distance I've used road network distances from population weighted centroids of the polygons. I've created a row standarized gwt style file using arcgis's network tools, and a bit of table editing. I can successfully import this into R.
File format in "old style GWT"
for example: 
473
1 2 .111
1 3 .22
1 4 .66
2 1 .11


Is possible to use your own weighting scheme in spgwr? Is it using a listw object? I couldn't find any indication in the documentation.

thanks!
   

----
Jay Douillard
Geospatial Technical Lead
604.827.4401
Human Early Learning Partnership 
www.earlylearning.ubc.ca


From dan.putler at sauder.ubc.ca  Thu Mar 11 18:45:37 2010
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Thu, 11 Mar 2010 09:45:37 -0800
Subject: [R-sig-Geo] Geocode for Bogota
In-Reply-To: <8743_1268323125_1268323125_f8e6ff051003110757y4ce7179erd4f0792f6a2d655d@mail.gmail.com>
References: <3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com>
	<000c01cac0f4$894898f0$9bd9cad0$@net>
	<8743_1268323125_1268323125_f8e6ff051003110757y4ce7179erd4f0792f6a2d655d@mail.gmail.com>
Message-ID: <1268329537.6908.34.camel@whitebox>

I'm afraid Hadley is correct. Section 10.12 of Google Maps/Google Earth
APIs Terms of Service states:

10.12 use or display the Content without a corresponding Google map,
unless you are explicitly permitted to do so in the Maps APIs
Documentation, the Street View API Documentation, or through written
permission from Google (for example, you must not use geocodes obtained
through the Service except in conjunction with a Google map, but the
Street View API Documentation explicitly permits you to display Street
View imagery without a corresponding Google map);

The full terms of service are available from
http://code.google.com/apis/maps/terms.html

Yahoo! Maps API Terms of Use:
http://info.yahoo.com/legal/us/yahoo/maps/mapsapi/mapsapi-2141.html
has similar language in sections 1(f)(vii) and 1(f)(viii).

I think very highly of Open Street Map, but the ability to actually use
OSM data to accurately geocode locations is only going to be possible in
a very limited number of areas (Karlsruhe, Germany perhaps?) since OSM
mappers have appropriately tagged an extremely tiny fraction of the map.

The legal answer to Juan Tom?s Sayago original post is to either obtain
a public road network file with address range information (which may be
available from a local or national government agency, very possible in
Canada, the US, and recently the UK, but I have no idea about Bogota or
Columbia) and use this data in conjunction with the PAGC geocoder
engine: http://www.pagcgeo.org to create a shapefile set that can then
be read into R. Alternatively, he could purchase a commercial
application and a commercial road network layer, or pay a supplier to
geocode his address list.

Dan

On Thu, 2010-03-11 at 07:57 -0800, hadley wickham wrote:
> > They limit, however, the number of geocode requests to 15,000 in a 24 hour period. If the url connection breaks, then it might be a good idea to run the same loop one more time and set add a while command to look for the missing coordinates.
> 
> It's also against the terms of service to use it in this way (to save
> on your local computer and as input to further analyses).
> 
> Hadley
> 
-- 
Dan Putler
Sauder School of Business
University of British Columbia


From yud at mail.montclair.edu  Thu Mar 11 19:18:17 2010
From: yud at mail.montclair.edu (Danlin Yu)
Date: Thu, 11 Mar 2010 13:18:17 -0500
Subject: [R-sig-Geo] GWR with GWT file
In-Reply-To: <28594376.111061268328082154.JavaMail.root@verrazzano>
References: <28594376.111061268328082154.JavaMail.root@verrazzano>
Message-ID: <4B9933E9.9070604@mail.montclair.edu>

Jay:

Some time ago, the alternative weighting scheme issue was raised, but no 
solution as far as I know was present. As for now, I don't think SPGWR 
is taking other weighting schemes than the coordinates determined 
distance. I believe it is doable, however, by implementing some sort of 
alternative distance and replace the *coord* argument in the gwr function.

Hope this helps.

Cheers,
Danlin Yu

Jay Douillard ??:
> I'm working on a project where the distance between two polygons may be a poor measure of connectivity(contigious polygons that may have an impassible mountain chain between them. To get a better measure of distance I've used road network distances from population weighted centroids of the polygons. I've created a row standarized gwt style file using arcgis's network tools, and a bit of table editing. I can successfully import this into R.
> File format in "old style GWT"
> for example: 
> 473
> 1 2 .111
> 1 3 .22
> 1 4 .66
> 2 1 .11
>
>
> Is possible to use your own weighting scheme in spgwr? Is it using a listw object? I couldn't find any indication in the documentation.
>
> thanks!
>    
>
> ----
> Jay Douillard
> Geospatial Technical Lead
> 604.827.4401
> Human Early Learning Partnership 
> www.earlylearning.ubc.ca
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
___________________________________________
Danlin Yu, Ph.D.
Assistant Professor of GIS and Urban Geography
Department of Earth & Environmental Studies
Montclair State University
Montclair, NJ, 07043
Tel: 973-655-4313
Fax: 973-655-4072
email: yud at mail.montclair.edu
webpage: csam.montclair.edu/~yu


From Roger.Bivand at nhh.no  Thu Mar 11 19:21:39 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 11 Mar 2010 19:21:39 +0100 (CET)
Subject: [R-sig-Geo] GWR with GWT file
In-Reply-To: <28594376.111061268328082154.JavaMail.root@verrazzano>
References: <28594376.111061268328082154.JavaMail.root@verrazzano>
Message-ID: <alpine.LRH.2.00.1003111914160.6724@reclus.nhh.no>

On Thu, 11 Mar 2010, Jay Douillard wrote:

> I'm working on a project where the distance between two polygons may be 
> a poor measure of connectivity(contigious polygons that may have an 
> impassible mountain chain between them. To get a better measure of 
> distance I've used road network distances from population weighted 
> centroids of the polygons. I've created a row standarized gwt style file 
> using arcgis's network tools, and a bit of table editing. I can 
> successfully import this into R. File format in "old style GWT" for 
> example:

> 473
> 1 2 .111
> 1 3 .22
> 1 4 .66
> 2 1 .11
>
>
> Is possible to use your own weighting scheme in spgwr? Is it using a 
> listw object? I couldn't find any indication in the documentation.

Jay,

It isn't, but it probably wouldn't be too hard to do under certain 
conditions. The non-neighbours would be treated as outside the bandwidth, 
I suppose, otherwise one is looking at a full matrix for asymmetric road 
networks. The source for spgwr is on the r-spatial project on sourceforge, 
so you could check out what there is and see how one might add a listw= 
argument to gwr() for a given bandwidth first - branching around the 
spDistsN1() in .GWR_int() after passing the listw object through.

Roger

>
> thanks!
>
>
> ----
> Jay Douillard
> Geospatial Technical Lead
> 604.827.4401
> Human Early Learning Partnership
> www.earlylearning.ubc.ca
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Scott.Minkoff at Colorado.EDU  Thu Mar 11 19:57:26 2010
From: Scott.Minkoff at Colorado.EDU (Scott L Minkoff)
Date: Thu, 11 Mar 2010 11:57:26 -0700
Subject: [R-sig-Geo] inverse distance weighting
Message-ID: <001701cac14c$b2aedd00$180c9700$@minkoff@colorado.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100311/47887891/attachment.pl>

From Roger.Bivand at nhh.no  Thu Mar 11 20:09:13 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 11 Mar 2010 20:09:13 +0100 (CET)
Subject: [R-sig-Geo] inverse distance weighting
In-Reply-To: <001701cac14c$b2aedd00$180c9700$@minkoff@colorado.edu>
References: <001701cac14c$b2aedd00$180c9700$@minkoff@colorado.edu>
Message-ID: <alpine.LRH.2.00.1003112003340.6724@reclus.nhh.no>

On Thu, 11 Mar 2010, Scott L Minkoff wrote:

> Hello,
>
>
>
> I am new to analyzing spatial data in R and was having trouble finding an
> answer to my question in the list archives.  I am interested in doing
> spatial regression with an inverse distance matrix.  To do this, I created
> the weights matrix outside of R (in ArcGIS) and then used the mat2listw
> function to convert it to a list that could be used in a spatial regression
> with the spdep package.  I am wondering whether this is an appropriate way
> to do this and, if not, what would be?
>

No, not appropriate as such, unless your distances are neither Euclidean 
nor Great Circle. See the examples on ?nbdists and ?nb2listw, or on the 
use og the glist= argument to nb2listw() to move the weights from your 
imported object via mat2listw(). When you use mat2listw(), there is no 
automatic way of setting the style of the listw object, so although it can 
be used for some things, it needs feeding through nb2listw() to tidy 
things up.

Roger

>
>
> Thanks in advance,
>
> Scott Minkoff
>
> University of Colorado at Boulder
>
> Department of Political Science
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From tgriffin at uaex.edu  Thu Mar 11 20:08:43 2010
From: tgriffin at uaex.edu (Terry Griffin)
Date: Thu, 11 Mar 2010 13:08:43 -0600
Subject: [R-sig-Geo] inverse distance weighting
In-Reply-To: <001701cac14c$b2aedd00$180c9700$@minkoff@colorado.edu>
References: <001701cac14c$b2aedd00$180c9700$@minkoff@colorado.edu>
Message-ID: <4B98EB5B.CF06.00FB.0@uaex.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100311/d73b757e/attachment.pl>

From ceedave at mac.com  Fri Mar 12 00:04:04 2010
From: ceedave at mac.com (Christopher D White)
Date: Thu, 11 Mar 2010 17:04:04 -0600
Subject: [R-sig-Geo] Difficulties plotting variofit() value
Message-ID: <7E90C489-7935-4728-8ECD-E247A8B9CECA@mac.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100311/1094ecf5/attachment.pl>

From paulojus at c3sl.ufpr.br  Fri Mar 12 00:26:01 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Thu, 11 Mar 2010 20:26:01 -0300 (BRT)
Subject: [R-sig-Geo] Difficulties plotting variofit() value
In-Reply-To: <7E90C489-7935-4728-8ECD-E247A8B9CECA@mac.com>
References: <7E90C489-7935-4728-8ECD-E247A8B9CECA@mac.com>
Message-ID: <alpine.DEB.2.00.1003112022001.28061@dalmore.c3sl.ufpr.br>

Christopher,
The reason is because there is no plot method for the variofit object.
(only lines). (Maybe it should have be...)

The ideia is then to overlay the fitted varigram on a empiralcal one
as in the following example:

require(geoR)
v <- variog(s100, max.dist=1.1)
plot(v)
vf <- variofit(s100)
lines(vf)

Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus



On Thu, 11 Mar 2010, Christopher D White wrote:

> Hello,
>
> I'm rather new on the list, so maybe a bit naive but educable.
>
> I entered an emperical variogram, a matrix of initial parameter vectors, etc., and ran variofit. The results appear reasonable in terms of the nugget and range (see the structure below). But when I try plot(ghf) it fails:
>> ghf
> variofit: model parameters estimated by WLS (weighted least squares):
> covariance model is: exponential
> parameter estimates:
>  tausq sigmasq     phi
> 31.5821 40.1984  1.6064
> Practical Range with cor=0.05 for asymptotic range: 4.812493
>
> variofit: minimised weighted sum of squares = 63.8023
>> plot(ghf)
> Error in plot.window(...) : need finite 'xlim' values
> In addition: Warning messages:
> 1: In min(x) : no non-missing arguments to min; returning Inf
> 2: In max(x) : no non-missing arguments to max; returning -Inf
> 3: In min(x) : no non-missing arguments to min; returning Inf
> 4: In max(x) : no non-missing arguments to max; returning -Inf
>
> If I fix(ghf), this is what it looks like:
>
> structure(list(nugget = 31.5820997227246, cov.pars = c(40.1983931188586,
> 1.60644948107876), cov.model = "exponential", kappa = 0.5, value = 63.8022691526071,
>    trend = "cte", beta.ols = 22.5254647252906, practicalRange = 4.81249254536764,
>    max.dist = 9.95561289775773, minimisation.function = "optim",
>    weights = "cressie", method = "WLS", fix.nugget = FALSE,
>    fix.kappa = TRUE, lambda = 0.333333333333333, message = "optim convergence code: 0",
>    call = quote(variofit(vario = gho, ini.cov.pars = covpars,
>        cov.model = covmod, weights = "cressie"))), .Names = c("nugget",
> "cov.pars", "cov.model", "kappa", "value", "trend", "beta.ols",
> "practicalRange", "max.dist", "minimisation.function", "weights",
> "method", "fix.nugget", "fix.kappa", "lambda", "message", "call"
> ), class = c("variomodel", "variofit"))
>
> Any clues?
>
> Thanks!
> Chris
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Debabrata.Midya at services.nsw.gov.au  Fri Mar 12 01:12:59 2010
From: Debabrata.Midya at services.nsw.gov.au (Debabrata Midya)
Date: Fri, 12 Mar 2010 11:12:59 +1100
Subject: [R-sig-Geo] Interfacing R with GRASS from R - Windows XP
In-Reply-To: <9a8a6c631003110741g72fe1df4l2edac7631caa9da5@mail.gmail.com>
References: <4B98D7E0.5860.00D0.0@services.nsw.gov.au>
	<9a8a6c631003110741g72fe1df4l2edac7631caa9da5@mail.gmail.com>
Message-ID: <4B9A21BA.5860.00D0.0@services.nsw.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100312/53b401cc/attachment.pl>

From tech_dev at wildintellect.com  Fri Mar 12 02:04:14 2010
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Thu, 11 Mar 2010 17:04:14 -0800
Subject: [R-sig-Geo] Interfacing R with GRASS from R - Windows XP
In-Reply-To: <4B9A21BA.5860.00D0.0@services.nsw.gov.au>
References: <4B98D7E0.5860.00D0.0@services.nsw.gov.au>	<9a8a6c631003110741g72fe1df4l2edac7631caa9da5@mail.gmail.com>
	<4B9A21BA.5860.00D0.0@services.nsw.gov.au>
Message-ID: <4B99930E.6020406@wildintellect.com>

http://trac.osgeo.org/osgeo4w/

On 03/11/2010 04:12 PM, Debabrata Midya wrote:
> Dennis,
>  
> Thanks for your reply.
>  
> May I request you to assist me in the followings:
>  
> 1. Where can I get a copy of 32-bit GRASS on Windows XP.
>  
> 2. I s there any tutorial to start with R and GRASS,
>  
>     - To interface R with GRASS from R
>  
>     - To interface R with GRASS from GRASS
>  
> Once again, thank you very much for the time you have given.
> 
> I am looking forward for your reply.
> 
> Regards,
> 
> Deb
> 
>>>> Dennis Murphy <djmuser at gmail.com> 12/03/2010 2:41 am >>>
> Hi:
> 
> Is it possible you have a 64-bit GRASS installation and a 32-bit R?
> If that's the case, you might need to install 32-bit GRASS; 32-bit software
> doesn't usually play nice with 64-bit software, and R falls in that set.
> 
> HTH,
> Dennis
> 
> On Wed, Mar 10, 2010 at 4:45 PM, Debabrata Midya <Debabrata.Midya at services.nsw.gov.au> wrote:
> 
> 
> Dear OSGeo users,
> 
> 
> Thanks in advance.
> 
> I am Deb, Statistician at NSW Department of Services, Technology & Administration, Sydney, Australia.
> 
> I am new to this Group.
> 
> I want to interface R with GRASS from R.
> 
> I have faced problem to do so. I have provided the steps below the way I have tried.
> 
> 1. I am using R-2.10.1 and GRASS-64-SVN on Windows XP.
> 
> I have installed R and GRASS (WinGRASS-6.4.0SVN-r40852-1-Setup.exe)
> 
> I have provided the path of GRASS (F:\GRASS-64-SVN) to access to bin and lib directories.
> 
> 2. The result of executing this R command is given below:
> 
>> library(spgrass6)
> Loading required package: sp
> Loading required package: rgdal
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
> Path to GDAL shared files: F:/R-2.10.1/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: F:/R-2.10.1/library/rgdal/proj
> Loading required package: XML
> GRASS GIS interface loaded with GRASS version: (GRASS not running)
> 
> 3. The result of gmeta6() is given below:
> 
>> G <- gmeta6()
> Error in system(cmd0, intern = TRUE) : g.region.exe not found
> In addition: Warning message:
> In list.files(paste(Sys.getenv("GISBASE"), "bin", sep = "/"), pattern = ".bat$") :
> list.files: '/bin' is not a readable directory
> Error in parseGRASS(cmd) : g.region not found
> 
> 4. I have also given my session Info:
> 
>> sessionInfo()
> R version 2.10.1 (2009-12-14)
> i386-pc-mingw32
> 
> locale:
> [1] LC_COLLATE=English_Australia.1252 LC_CTYPE=English_Australia.1252 LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
> 
> attached base packages:
> [1] stats graphics grDevices utils datasets methods base
> 
> other attached packages:
> [1] spgrass6_0.6-15 XML_2.6-0 rgdal_0.6-25 sp_0.9-60
> 
> loaded via a namespace (and not attached):
> [1] grid_2.10.1 lattice_0.17-26 tools_2.10.1
> 
> Once again, thank you very much for the time you have given.
> 
> I am looking forward for your reply.
> 
> Regards,
> 
> 
> Deb
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
>


From Debabrata.Midya at services.nsw.gov.au  Fri Mar 12 02:31:30 2010
From: Debabrata.Midya at services.nsw.gov.au (Debabrata Midya)
Date: Fri, 12 Mar 2010 12:31:30 +1100
Subject: [R-sig-Geo] Interfacing R with GRASS from R - Windows XP
In-Reply-To: <4B99930E.6020406@wildintellect.com>
References: <4B98D7E0.5860.00D0.0@services.nsw.gov.au>	<9a8a6c631003110741g72fe1df4l2edac7631caa9da5@mail.gmail.com>
	<4B9A21BA.5860.00D0.0@services.nsw.gov.au><4B9A21BA.5860.00D0.0@services.nsw.gov.au>
	<4B99930E.6020406@wildintellect.com>
Message-ID: <4B9A3421.5860.00D0.0@services.nsw.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100312/110f8ab7/attachment.pl>

From hengl at spatial-analyst.net  Fri Mar 12 09:23:56 2010
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Fri, 12 Mar 2010 09:23:56 +0100
Subject: [R-sig-Geo] Geocode for Bogota
In-Reply-To: <1268329537.6908.34.camel@whitebox>
References: <3364ce111003091505s755e1dc2u8e6aff6924a69b34@mail.gmail.com>	
	<000c01cac0f4$894898f0$9bd9cad0$@net>	
	<8743_1268323125_1268323125_f8e6ff051003110757y4ce7179erd4f0792f6a2d655d@mail.gmail.com>
	<1268329537.6908.34.camel@whitebox>
Message-ID: <000001cac1bd$5bda8df0$138fa9d0$@net>

> -----Original Message-----
> From: Dan Putler [mailto:dan.putler at sauder.ubc.ca]
> Sent: Thursday, March 11, 2010 6:46 PM
> To: hadley wickham
> Cc: Tomislav Hengl; r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Geocode for Bogota
> 
> I'm afraid Hadley is correct. Section 10.12 of Google Maps/Google Earth
> APIs Terms of Service states:
> 
> 10.12 use or display the Content without a corresponding Google map,
> unless you are explicitly permitted to do so in the Maps APIs
> Documentation, the Street View API Documentation, or through written
> permission from Google (for example, you must not use geocodes obtained
> through the Service except in conjunction with a Google map, but the
> Street View API Documentation explicitly permits you to display Street
> View imagery without a corresponding Google map);

Thank you for pointing us to the Terms of service (which is obviously very important). I still think that the situation with Google Maps API is not as bad (the speed and quality at which Google is building a digital data is impressive). In my case (http://spatial-analyst.net/wiki/index.php?title=Mapping_research_hot-spots) I use Google Maps API only to grab the coordinates of points and run analysis. I attach my own variables to the points and distribute only the end result of analysis (e.g. http://spatial-analyst.net/wiki/index.php?title=Image:Fig_geostatworld.jpg). Would this then also be against their terms of service? I do not think so - I use the work somebody did to geocode things, but distribute only end results of my analysis (my own content). I guess it is a sort of trick to go around this problem (e.g. to still use their service and not break any Terms of service).

But you are absolutely right: we should focus our efforts on building/promoting open access data portals such as Open Street Map.

T. Hengl
http://home.medewerker.uva.nl/t.hengl/ 

> 
> The full terms of service are available from
> http://code.google.com/apis/maps/terms.html
> 
> Yahoo! Maps API Terms of Use:
> http://info.yahoo.com/legal/us/yahoo/maps/mapsapi/mapsapi-2141.html
> has similar language in sections 1(f)(vii) and 1(f)(viii).
> 
> I think very highly of Open Street Map, but the ability to actually use
> OSM data to accurately geocode locations is only going to be possible in
> a very limited number of areas (Karlsruhe, Germany perhaps?) since OSM
> mappers have appropriately tagged an extremely tiny fraction of the map.
> 
> The legal answer to Juan Tom?s Sayago original post is to either obtain
> a public road network file with address range information (which may be
> available from a local or national government agency, very possible in
> Canada, the US, and recently the UK, but I have no idea about Bogota or
> Columbia) and use this data in conjunction with the PAGC geocoder
> engine: http://www.pagcgeo.org to create a shapefile set that can then
> be read into R. Alternatively, he could purchase a commercial
> application and a commercial road network layer, or pay a supplier to
> geocode his address list.
> 
> Dan
> 
> On Thu, 2010-03-11 at 07:57 -0800, hadley wickham wrote:
> > > They limit, however, the number of geocode requests to 15,000 in a 24 hour
> period. If the url connection breaks, then it might be a good idea to run the
> same loop one more time and set add a while command to look for the missing
> coordinates.
> >
> > It's also against the terms of service to use it in this way (to save
> > on your local computer and as input to further analyses).
> >
> > Hadley
> >
> --
> Dan Putler
> Sauder School of Business
> University of British Columbia


From axel.hille at gmx.net  Sun Mar 14 13:03:49 2010
From: axel.hille at gmx.net (Axel Hille)
Date: Sun, 14 Mar 2010 13:03:49 +0100
Subject: [R-sig-Geo] Geneland output raster grid does not fit when plotted
 together with SpatialLines and SpatialPolygons
Message-ID: <20100314120349.136940@gmx.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100314/7a73af2b/attachment.pl>

From Debabrata.Midya at services.nsw.gov.au  Mon Mar 15 02:30:23 2010
From: Debabrata.Midya at services.nsw.gov.au (Debabrata Midya)
Date: Mon, 15 Mar 2010 12:30:23 +1100
Subject: [R-sig-Geo] GRASS-R: To work with spearfish sample data set
Message-ID: <4B9E285E.5860.00D0.0@services.nsw.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100315/6c2d16c5/attachment.pl>

From zua3 at cornell.edu  Mon Mar 15 02:45:58 2010
From: zua3 at cornell.edu (Zia Ahmed)
Date: Sun, 14 Mar 2010 21:45:58 -0400
Subject: [R-sig-Geo] Box-cox transformation and Conditional Sequential
	Gaussian Simulation!
In-Reply-To: <4B9E285E.5860.00D0.0@services.nsw.gov.au>
References: <4B9E285E.5860.00D0.0@services.nsw.gov.au>
Message-ID: <4B9D9156.90005@cornell.edu>

I have a basic question related  to the data transformation CSG 
simulation. Can  I use Box-cox transformation of the data instead of 
normal score transformation before performing  CSG simulation? 
Suggestion will be appreciated.
Thanks
ZIa


From Roger.Bivand at nhh.no  Mon Mar 15 08:48:23 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 15 Mar 2010 08:48:23 +0100 (CET)
Subject: [R-sig-Geo] GRASS-R: To work with spearfish sample data set
In-Reply-To: <4B9E285E.5860.00D0.0@services.nsw.gov.au>
References: <4B9E285E.5860.00D0.0@services.nsw.gov.au>
Message-ID: <alpine.LRH.2.00.1003150835460.25252@reclus.nhh.no>

On Mon, 15 Mar 2010, Debabrata Midya wrote:

> Dear OSGeo users,
>

Arguably, you should read the GRASS book [1] carefully first, then 
consider using GRASS mailing lists - use of the R interface is discussed 
in chapter 10. Basic use of the interface as of January 2009 is also shown 
on a screen video [2]. A mailing list is not a good place to give hands-on 
training from the ground up. The questions below also suggest that getting 
to know file systems might be a helpful thing to do before reading the 
GRASS book.

Hope this helps,

Roger

[1] http://www.grassbook.org/

[2] http://spatial.nhh.no/wun09/wun_grass.swf

>
> Thanks in advance.
>
> I need your assistance to work with the above data set. I have installed this data set from http://casoilresource.lawr.ucdavis.edu/drupal/node/438. This is a winzip file and I have extracted all files into the directory \speafish60 directory. The files structure after extraction is like this:
>
> - \speafish60\PERMANANENT
>  - \speafish60\PERMANANENT\bdlg
>  - \speafish60\PERMANANENT\cats
>  - \speafish60\PERMANANENT\cell
>  - and so on
> - \speafish60\user1
>
> I have installed R-2.10.1 on windows XP.
>
> I have installed http://trac.osgeo.org/osgeo4w/.
>
> I am able to interact with GRASS and R.
>
> # set region in GRASS
>
> g.region rast=elevation.dem
>
> I have issued this command at Cmd > at GRASS GIS Layer Manager Window.
>
> But I have received the error below:
>
> ERROR: Raster map <elevation.dem> not found
>
> How can I change the directory name in GRASS to access the data.
>
> Once again, thank you very much for the time you have given.
>
> I am looking forward for your reply.
>
> Regards,
>
>
> Deb
>
> *************************************************************************************
>
> This email message, including any attached files, is confidential and
> intended solely for the use of the individual or entity to whom it is
> addressed.
>
> The Department of Services, Technology and Administration prohibits the
> right to publish, copy, distribute or disclose any information contained in
> this email, or its attachments, by any party other than the intended
> recipient. If you have received this email in error please notify the sender
> and delete it from your system.
>
> No employee or agent is authorised to conclude any binding agreement
> on behalf of the Department of Services, Technology and Administration
> by email. The views or opinions presented in this email are solely those of
> the author and do not necessarily represent those of the Department,
> except where the sender expressly, and with authority, states them to be
> the views of the Department of Services, Technology and Administration.
>
> The Department of Services, Technology and Administration accepts no
> liability for any loss or damage arising from the use of this email and
> recommends that the recipient check this email and any attached files for
> the presence of viruses.
>
> *************************************************************************************
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From tobias.verbeke at openanalytics.eu  Mon Mar 15 13:29:33 2010
From: tobias.verbeke at openanalytics.eu (tobias.verbeke at openanalytics.eu)
Date: Mon, 15 Mar 2010 13:29:33 +0100
Subject: [R-sig-Geo] test for CSR in three dimensions
Message-ID: <388cc5948ff7ceefdce6b409d36eceb9@imap1>


Dear list, 

Is there any functionality available to test 
CSR for a three-dimensional point pattern ?
    
I am aware there is basic infrastructure for 3D
point patterns in spatstat

> methods(class = "pp3")
[1] crossdist.pp3  nnclean.pp3    nndist.pp3     nnwhich.pp3   
pairdist.pp3  
[6] plot.pp3       print.pp3      summary.pp3    unitname<-.pp3
unitname.pp3  

(as well as through rpoispp3, K3est, F3est, G3est), but would appreciate
any hints on possibilities to combine these building blocks
into a test for CSR. 

Pointers to asymptotic results will be appreciated by my computer, 
pointers to simple Monte Carlo procedures will be appreciated by 
myself..

Many thanks in advance, 
Tobias


From zua3 at cornell.edu  Mon Mar 15 14:35:13 2010
From: zua3 at cornell.edu (Zia Ahmed)
Date: Mon, 15 Mar 2010 09:35:13 -0400
Subject: [R-sig-Geo] Box-cox transformation and Conditional Sequential
 Gaussian Simulation!
In-Reply-To: <4B9DDB3A.20207@uni-muenster.de>
References: <4B9E285E.5860.00D0.0@services.nsw.gov.au>
	<4B9D9156.90005@cornell.edu> <4B9DDB3A.20207@uni-muenster.de>
Message-ID: <4B9E3791.2050702@cornell.edu>

Thank you so much! I have used Box-cox transformation. I need to sure 
before submitting my paper for publication.
I used following codes for CSGS  of ground water arsenic concentration.

Zia

data(tala)

was.bc<-box.cox(tala$was, 0.47) 
tala.bc = cbind(tala, was.bc)

coordinates(tala.bc) <- ~ x + y  
coordinates(tala.grid) <-~ x + y 

v.ok.was<-variogram(was.bc~1,data=tala.bc)
plot(v.ok.was, pl=F, pch=20, cex=1, col="Black")
m.ok.was<-vgm(.06,"Exp",4000,0.02)
(m.ok.f.was<-fit.variogram(v.ok.was, m.ok.was))

# Simulation
#--------------
set.seed(130)
sim.was<-krige(was.bc~1,tala.bc,tala.grid,model=m.ok.f.was, nmax=50, 
nsim = 1000)

# Back-transformation
#-----------------
for(i in 1:length(sim.was at data)){sim.was at data[[i]] <- 
(((sim.was[[i]]*0.47+1)^k.was))}
sim.data.was<-as.data.frame(sim.was)
summary(sim.data.was)




Edzer Pebesma wrote:
> Yes, you can. It is less flexible than the normal score transform -- try
> for instance transforming a bimodal distribution -- but has the
> advantage that the back-transform is straightforward. How do you for
> example use the inverse normal score transformation simulated values
> outside the range of the data?
>
> Zia Ahmed wrote:
>   
>> I have a basic question related  to the data transformation CSG
>> simulation. Can  I use Box-cox transformation of the data instead of
>> normal score transformation before performing  CSG simulation?
>> Suggestion will be appreciated.
>> Thanks
>> ZIa
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>
>   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100315/0422138f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100315/0422138f/attachment.vcf>

From sylvain.willart at gmail.com  Mon Mar 15 14:37:34 2010
From: sylvain.willart at gmail.com (sylvain willart)
Date: Mon, 15 Mar 2010 14:37:34 +0100
Subject: [R-sig-Geo] Null Distances in Neighbour Matrix
Message-ID: <79473eea1003150637r4e8f53cey120661b7fd2c3ee@mail.gmail.com>

Hello,

I am new to this list as I just begin to work on spatial data...

I mostly use spdep (and lme for the variogram) but I recently came
across a problem I don't know how to deal with,

The project I'm working on is a study on the localization of
physicians in a metropolitan area. I have the adress of each of them
that I coded in Long/Lat.
However, some of them are grouped in the same practice, sharing the
same adress, and hence the same Long/Lat.
This causes a "null distance" error when I try to compute a neighbour
matrix and a variogram.

any clue ?

thanks in advance,

sylvain


From marcelino.delacruz at upm.es  Mon Mar 15 15:19:47 2010
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Mon, 15 Mar 2010 15:19:47 +0100
Subject: [R-sig-Geo] test for CSR in three dimensions
In-Reply-To: <388cc5948ff7ceefdce6b409d36eceb9@imap1>
References: <388cc5948ff7ceefdce6b409d36eceb9@imap1>
Message-ID: <201003151419.o2FEJLYJ016182@edison.ccupm.upm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100315/ff1833c5/attachment.pl>

From tobias.verbeke at openanalytics.eu  Mon Mar 15 18:04:49 2010
From: tobias.verbeke at openanalytics.eu (tobias.verbeke at openanalytics.eu)
Date: Mon, 15 Mar 2010 18:04:49 +0100
Subject: [R-sig-Geo] test for CSR in three dimensions
In-Reply-To: <201003151419.o2FEJLYJ016182@edison.ccupm.upm.es>
References: <388cc5948ff7ceefdce6b409d36eceb9@imap1>
	<201003151419.o2FEJLYJ016182@edison.ccupm.upm.es>
Message-ID: <e3d6f5424f6fd4887900e5c3d5b22407@imap1>


Dear Marcelino, 

Many thanks for your prompt response and the
code for a visual test. 

Cressie (1993, p. 635, 639, 642) mentions quite
some statistics for formal testing in 2D.

In the mean time I tracked already the generalization
to n dimensions of Pielou's statistic (Cressie, p. 635)

Howard B. Stauffer (1979). A generalization of 
Pielou's index of non-randomness,
Journal of Theoretical Biology 77 (1), p. 19-25

I will report back to the list if I find others
(and implemented one).

Thanks again,
Tobias

On Mon, 15 Mar 2010 15:19:47 +0100, Marcelino de la Cruz
<marcelino.delacruz at upm.es> wrote:
> A simple MonteCarlo procedure:
> 
> #sample data:
> X <- rpoispp3(50)
> 
> 
> n <- dim(X$data)[1]
> volume <- volume.box3(as.box3(X))
> 
> lambda <- n / volume
> 
> 
> # observed isotropic  corrected K
> kobs <- K3est(X, rmax=1,nrval=101)$iso
> 
> #99 simulated CSR patterns
> 
> Xsim<- vector("list", 99)
> for  (i in 1: 99){
>     Xsim[[i]] <- rpoispp3(lambda, domain = as.box3(X))
> }
> 
> #simulated K functions
>   ksim <- sapply(Xsim, function(x) K3est(x, rmax=1,nrval=101)$iso)
> 
> # "visual CSR test"
> plot(0:100, kobs, xlab="r", ylab="K3est(r)", type="l")
> matplot(0:100,t(apply(ksim,1,range)), lty=2,col=2, type="l", add=T)
> 
> # another one:
>   plot(0:100, (3*kobs/(4*pi*(0:100)^3)), xlab="r", ylab="L3est(r)",
>   type="l")
>   matplot(0:100,(3*t(apply(ksim,1,range))/(4*pi*(0:100)^3)), 
> lty=2,col=2, type="l", add=T)
> 
> HTH,
> 
> Marcelino
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> At 13:29 15/03/2010, tobias.verbeke at openanalytics.eu wrote:
> 
>>Dear list,
>>
>>Is there any functionality available to test
>>CSR for a three-dimensional point pattern ?
>>
>>I am aware there is basic infrastructure for 3D
>>point patterns in spatstat
>>
>> > methods(class = "pp3")
>>[1] crossdist.pp3  nnclean.pp3    nndist.pp3     nnwhich.pp3
>>pairdist.pp3
>>[6] plot.pp3       print.pp3      summary.pp3    unitname<-.pp3
>>unitname.pp3
>>
>>(as well as through rpoispp3, K3est, F3est, G3est), but would appreciate
>>any hints on possibilities to combine these building blocks
>>into a test for CSR.
>>
>>Pointers to asymptotic results will be appreciated by my computer,
>>pointers to simple Monte Carlo procedures will be appreciated by
>>myself..
>>
>>Many thanks in advance,
>>Tobias
>>
>>_______________________________________________
>>R-sig-Geo mailing list
>>R-sig-Geo at stat.math.ethz.ch
>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> ________________________________
> 
> Marcelino de la Cruz Rot
> 
> Departamento de  Biolog?a Vegetal
> E.U.T.I. Agr?cola
> Universidad Polit?cnica de Madrid
> 28040-Madrid
> Tel.: 91 336 54 35
> Fax: 91 336 56 56
> marcelino.delacruz at upm.es
> _________________________________


From marcelino.delacruz at upm.es  Mon Mar 15 19:13:59 2010
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Mon, 15 Mar 2010 19:13:59 +0100
Subject: [R-sig-Geo] test for CSR in three dimensions
In-Reply-To: <e3d6f5424f6fd4887900e5c3d5b22407@imap1>
References: <388cc5948ff7ceefdce6b409d36eceb9@imap1>
	<201003151419.o2FEJLYJ016182@edison.ccupm.upm.es>
	<e3d6f5424f6fd4887900e5c3d5b22407@imap1>
Message-ID: <201003151813.o2FIDY7d025228@edison.ccupm.upm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100315/606ba094/attachment.pl>

From zev at zevross.com  Mon Mar 15 21:46:25 2010
From: zev at zevross.com (Zev Ross)
Date: Mon, 15 Mar 2010 16:46:25 -0400
Subject: [R-sig-Geo] GSTAT - can a spline be used in the drift?
Message-ID: <4B9E9CA1.3000402@zevross.com>

Hi All,

Sorry for the re-post, I didn't get an answer the first time around and 
thought I'd give it another try. I am noticing in GSTAT that if I 
include a spline as part of the drift in an external drift kriging model 
that the prediction, oddly, depends on how many observations I have in 
the "newdata" argument.

Using the meuse data as an example, you'll see that the predictions at 
the same first 5 records will be different if I include just those five 
records (second example below) or a larger dataset that includes those 
five records.

Perhaps using a spline in the drift is not supported and I should use a 
polynomial? Can anyone explain?

Zev


library(splines)
data(meuse)
data(meuse.grid)

coordinates(meuse) = ~x + y
coordinates(meuse.grid) = ~x + y

lznr.vgm = variogram(log(zinc) ~ ns(dist,3), meuse)
lznr.fit = fit.variogram(lznr.vgm, model = vgm(1, "Exp", 300,+ 1))
plot(lznr.vgm, lznr.fit)
preds<-krige(log(zinc) ~ ns(dist,3), meuse, meuse.grid, lznr.fit)
preds[["var1.pred"]][1:5] # these predictions will be different from 
those below

data(meuse.grid)
meuse.grid<-meuse.grid[1:5,]
coordinates(meuse.grid) = ~x + y
preds<-krige(log(zinc) ~ ns(dist,3), meuse, meuse.grid, lznr.fit)
preds[["var1.pred"]][1:5] # these predictions are different from those 
above

-- 
Zev Ross
ZevRoss Spatial Analysis
120 N Aurora, Suite 3A
Ithaca, NY 14850
607-277-0004 (phone)
866-877-3690 (fax, toll-free)
zev at zevross.com


From reeves at nceas.ucsb.edu  Tue Mar 16 07:10:06 2010
From: reeves at nceas.ucsb.edu (reeves at nceas.ucsb.edu)
Date: Mon, 15 Mar 2010 23:10:06 -0700 (PDT)
Subject: [R-sig-Geo] Byte-value tif files not properly read by readGDAL
Message-ID: <1414.71.102.138.91.1268719806.squirrel@webmail.nceas.ucsb.edu>

Hello List:

I am reading an 8 bit format raster .tif image, containing 0s and 1s and
written using the Export Data utility of ArcMap GIS on a Windows 7
platform.

The image read into R does not consist of 0s and 1s, rather,  0s, 1s, and
128s.
Information from the R session (ver 2.10.1, update packages run).


R version 2.10.1 (2009-12-14)
Copyright (C) 2009 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> utils:::menuInstallPkgs()
--- Please select a CRAN mirror for use in this session ---
trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/maptools_0.7-29.zip'
Content type 'application/zip' length 1041813 bytes (1017 Kb)
opened URL
downloaded 1017 Kb

trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/PBSmapping_2.59.zip'
Content type 'application/zip' length 6813737 bytes (6.5 Mb)
opened URL
downloaded 6.5 Mb

trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/rgdal_0.6-25.zip'
Content type 'application/zip' length 8105836 bytes (7.7 Mb)
opened URL
downloaded 7.7 Mb

trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/sp_0.9-61.zip'
Content type 'application/zip' length 706791 bytes (690 Kb)
opened URL
downloaded 690 Kb

package 'maptools' successfully unpacked and MD5 sums checked
package 'PBSmapping' successfully unpacked and MD5 sums checked
package 'rgdal' successfully unpacked and MD5 sums checked
package 'sp' successfully unpacked and MD5 sums checked

The downloaded packages are in
        D:\Documents and Settings\Rick Reeves\Local
Settings\Temp\RtmpHbLM1L\downloaded_packages
> update.packages()
foreign :
 Version 0.8-38 installed in D:/PROGRA~1/R/R-210~1.1/library
 Version 0.8-39 available at http://cran.cnr.Berkeley.edu
Update (y/N/c)?  y
lattice :
 Version 0.17-26 installed in D:/PROGRA~1/R/R-210~1.1/library
 Version 0.18-3 available at http://cran.cnr.Berkeley.edu
Update (y/N/c)?  y
MASS :
 Version 7.3-4 installed in D:/PROGRA~1/R/R-210~1.1/library
 Version 7.3-5 available at http://cran.cnr.Berkeley.edu
Update (y/N/c)?  y
Matrix :
 Version 0.999375-33 installed in D:/PROGRA~1/R/R-210~1.1/library
 Version 0.999375-37 available at http://cran.cnr.Berkeley.edu
Update (y/N/c)?  y
rpart :
 Version 3.1-45 installed in D:/PROGRA~1/R/R-210~1.1/library
 Version 3.1-46 available at http://cran.cnr.Berkeley.edu
Update (y/N/c)?  y
survival :
 Version 2.35-7 installed in D:/PROGRA~1/R/R-210~1.1/library
 Version 2.35-8 available at http://cran.cnr.Berkeley.edu
Update (y/N/c)?  y
trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/foreign_0.8-39.zip'
Content type 'application/zip' length 169133 bytes (165 Kb)
opened URL
downloaded 165 Kb

trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/lattice_0.18-3.zip'
Content type 'application/zip' length 625273 bytes (610 Kb)
opened URL
downloaded 610 Kb

trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/MASS_7.3-5.zip'
Content type 'application/zip' length 798653 bytes (779 Kb)
opened URL
downloaded 779 Kb

trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/Matrix_0.999375-37.zip'
Content type 'application/zip' length 3243307 bytes (3.1 Mb)
opened URL
downloaded 3.1 Mb

trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/rpart_3.1-46.zip'
Content type 'application/zip' length 162680 bytes (158 Kb)
opened URL
downloaded 158 Kb

trying URL
'http://cran.cnr.Berkeley.edu/bin/windows/contrib/2.10/survival_2.35-8.zip'
Content type 'application/zip' length 2445387 bytes (2.3 Mb)
opened URL
downloaded 2.3 Mb

package 'foreign' successfully unpacked and MD5 sums checked
package 'lattice' successfully unpacked and MD5 sums checked
package 'MASS' successfully unpacked and MD5 sums checked
package 'Matrix' successfully unpacked and MD5 sums checked
package 'rpart' successfully unpacked and MD5 sums checked
package 'survival' successfully unpacked and MD5 sums checked

The downloaded packages are in
        D:\Documents and Settings\Rick Reeves\Local
Settings\Temp\RtmpHbLM1L\downloaded_packages
> require(rgdal)
Loading required package: rgdal
Loading required package: sp
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
Path to GDAL shared files: D:/PROGRA~1/R/R-210~1.1/library/rgdal/gdal
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: D:/PROGRA~1/R/R-210~1.1/library/rgdal/proj
> setwd("F:/Projects/NCEAS/Balch")
> CheatgrassMapInfo = GDALinfo("BrteNVModisWGS8Bit.tif")
> CheatgrassMapInfo
rows        1681
columns     1748
bands       1
origin.x        -120.1789
origin.y        37.95729
res.x       0.002427655
res.y       0.002427655
oblique.x   0
oblique.y   0
driver      GTiff
projection  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
file        BrteNVModisWGS8Bit.tif
apparent band summary:
  GDType Bmin Bmax
1   Byte -128  127
Metadata:
TIFFTAG_SOFTWARE=IMAGINE TIFF Support
Copyright 1991 - 1999 by ERDAS, Inc. All Rights Reserved
@(#)$RCSfile: etif.c $ $Revision: 1.10.1.9.1.9.2.11 $ $Date: 2004/09/15
18:42:01EDT $
TIFFTAG_XRESOLUTION=1
TIFFTAG_YRESOLUTION=1
TIFFTAG_RESOLUTIONUNIT=1 (unitless)
AREA_OR_POINT=Area
> CheatgrassMapIn = readGDAL("BrteNVModisWGS8Bit.tif")
BrteNVModisWGS8Bit.tif has GDAL driver GTiff
and has 1681 rows and 1748 columns
> summary(CheatgrassMapIn at data$band1)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  0.000   0.000   0.000   5.248   1.000 128.000
> summary(ToUnsigned(CheatgrassMapIn at data$band1))
Error: could not find function "ToUnsigned"
Error in summary(ToUnsigned(CheatgrassMapIn at data$band1)) :
  error in evaluating the argument 'object' in selecting a method for
function 'summary'
> summary(ToUnSigned(CheatgrassMapIn at data$band1))
Error: could not find function "ToUnSigned"
Error in summary(ToUnSigned(CheatgrassMapIn at data$band1)) :
  error in evaluating the argument 'object' in selecting a method for
function 'summary'
> summary(toUnSigned(CheatgrassMapIn at data$band1))
Error in toUnSigned(CheatgrassMapIn at data$band1) : already unsigned
Error in summary(toUnSigned(CheatgrassMapIn at data$band1)) :
  error in evaluating the argument 'object' in selecting a method for
function 'summary'
> summary(toUnSigned(CheatgrassMapIn at data$band1,8))
Error in toUnSigned(CheatgrassMapIn at data$band1, 8) : already unsigned
Error in summary(toUnSigned(CheatgrassMapIn at data$band1, 8)) :
  error in evaluating the argument 'object' in selecting a method for
function 'summary'
> str(CheatgrassMapIn)
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
  ..@ data       :'data.frame': 2938388 obs. of  1 variable:
  .. ..$ band1: int [1:2938388] 128 128 128 128 128 128 128 128 128 128 ...
  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
  .. .. ..@ cellcentre.offset: Named num [1:2] -120.2 38
  .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
  .. .. ..@ cellsize         : num [1:2] 0.00243 0.00243
  .. .. ..@ cells.dim        : int [1:2] 1748 1681
  ..@ grid.index : int(0)
  ..@ coords     : num [1:2, 1:2] -120.2 -115.9 38 42
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "x" "y"
  ..@ bbox       : num [1:2, 1:2] -120.2 38 -115.9 42
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "x" "y"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
+no_defs +towgs84=0,0,0"
> summary(toUnSigned(CheatgrassMapIn$band1,8))
Error in toUnSigned(CheatgrassMapIn$band1, 8) : already unsigned
Error in summary(toUnSigned(CheatgrassMapIn$band1, 8)) :
  error in evaluating the argument 'object' in selecting a method for
function 'summary'
> unique(CheatgrassMapIn$band1)
[1] 128   0   1
> table(CheatgrassMapIn$band1)

      0       1     128
2142594  680644  115150
> summary(CheatgrassMapIn$band1)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  0.000   0.000   0.000   5.248   1.000 128.000

Again, the values in CheatgrassMapIn$band1 should be 0 or 1, somehow the
value 128 has appeared. There is a conflict between output of GDALinfo and
the summary(CheatgrassMapIn$band1) statement.

I do not see a parameter for readGDAL for specifying word size or sign
treatment. Can anyone offer advice/insight?

Rick Reeves
NCEAS


From Roger.Bivand at nhh.no  Tue Mar 16 09:50:20 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 16 Mar 2010 09:50:20 +0100 (CET)
Subject: [R-sig-Geo] Byte-value tif files not properly read by readGDAL
In-Reply-To: <1414.71.102.138.91.1268719806.squirrel@webmail.nceas.ucsb.edu>
References: <1414.71.102.138.91.1268719806.squirrel@webmail.nceas.ucsb.edu>
Message-ID: <alpine.LRH.2.00.1003160931420.8634@reclus.nhh.no>

On Mon, 15 Mar 2010, reeves at nceas.ucsb.edu wrote:

> Hello List:
>
> I am reading an 8 bit format raster .tif image, containing 0s and 1s and
> written using the Export Data utility of ArcMap GIS on a Windows 7
> platform.
>
> The image read into R does not consist of 0s and 1s, rather,  0s, 1s, and
> 128s.

Rick,

When you display the image, are the 128s in the locations of NODATA? (Read 
decimated to save time displaying - raster display should get faster in R 
2.11.* when Northern Hemisphere Spring comes). Much of what you provide 
below simply makes things harder to read, please only provide the output 
of sessionInfo(), and the message returned when rgdal is loaded. As 
table() of the band shows 0, 1, and 128 (included below), then 128 is 
likely to be the encoding used by the software creating the file for 
NODATA. As is clearly explained, rgdal does no more than interface the 
GDAL drivers for the GDAL version loaded - here the most recent.

> Information from the R session (ver 2.10.1, update packages run).
........
>
>
>> require(rgdal)
> Loading required package: rgdal
> Loading required package: sp
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
> Path to GDAL shared files: D:/PROGRA~1/R/R-210~1.1/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: D:/PROGRA~1/R/R-210~1.1/library/rgdal/proj
>> setwd("F:/Projects/NCEAS/Balch")
>> CheatgrassMapInfo = GDALinfo("BrteNVModisWGS8Bit.tif")
>> CheatgrassMapInfo
> rows        1681
> columns     1748
> bands       1
> origin.x        -120.1789
> origin.y        37.95729
> res.x       0.002427655
> res.y       0.002427655
> oblique.x   0
> oblique.y   0
> driver      GTiff
> projection  +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
> file        BrteNVModisWGS8Bit.tif
> apparent band summary:
>  GDType Bmin Bmax
> 1   Byte -128  127
> Metadata:
> TIFFTAG_SOFTWARE=IMAGINE TIFF Support
> Copyright 1991 - 1999 by ERDAS, Inc. All Rights Reserved
> @(#)$RCSfile: etif.c $ $Revision: 1.10.1.9.1.9.2.11 $ $Date: 2004/09/15
> 18:42:01EDT $
> TIFFTAG_XRESOLUTION=1
> TIFFTAG_YRESOLUTION=1
> TIFFTAG_RESOLUTIONUNIT=1 (unitless)
> AREA_OR_POINT=Area
>> CheatgrassMapIn = readGDAL("BrteNVModisWGS8Bit.tif")
> BrteNVModisWGS8Bit.tif has GDAL driver GTiff
> and has 1681 rows and 1748 columns
>> summary(CheatgrassMapIn at data$band1)
>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>  0.000   0.000   0.000   5.248   1.000 128.000
......
>> summary(toUnSigned(CheatgrassMapIn at data$band1))
> Error in toUnSigned(CheatgrassMapIn at data$band1) : already unsigned
.....

Well, if the values are 0, 1, and 128, they are unsigned, there are no 
negative values and Byte can use the 0:255 range, stored in R as integer, 
as you see here:

>> str(CheatgrassMapIn)
> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>  ..@ data       :'data.frame': 2938388 obs. of  1 variable:
>  .. ..$ band1: int [1:2938388] 128 128 128 128 128 128 128 128 128 128 ...
>  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>  .. .. ..@ cellcentre.offset: Named num [1:2] -120.2 38
>  .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
>  .. .. ..@ cellsize         : num [1:2] 0.00243 0.00243
>  .. .. ..@ cells.dim        : int [1:2] 1748 1681
>  ..@ grid.index : int(0)
>  ..@ coords     : num [1:2, 1:2] -120.2 -115.9 38 42
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : NULL
>  .. .. ..$ : chr [1:2] "x" "y"
>  ..@ bbox       : num [1:2, 1:2] -120.2 38 -115.9 42
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : chr [1:2] "x" "y"
>  .. .. ..$ : chr [1:2] "min" "max"
>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>  .. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
> +no_defs +towgs84=0,0,0"
...........
>> unique(CheatgrassMapIn$band1)
> [1] 128   0   1
>> table(CheatgrassMapIn$band1)
>
>      0       1     128
> 2142594  680644  115150
>> summary(CheatgrassMapIn$band1)
>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>  0.000   0.000   0.000   5.248   1.000 128.000
>
> Again, the values in CheatgrassMapIn$band1 should be 0 or 1, somehow the
> value 128 has appeared. There is a conflict between output of GDALinfo and
> the summary(CheatgrassMapIn$band1) statement.
>

No - in the absence of any input from the file metadata, the GDAL driver 
takes a guess at whether the Byte is signed or unsigned (GDALinfo() says 
"apparent"). The first guess is signed, but it reads unsigned, which is 
probably the intention in the creating software. Double-check with 
gdalinfo externally, but also search the Arc documentation to see how it 
is encoding NODATA, and whether you can encourage the creating software to 
declare the NODATA encoding so that the GDAL driver has a reasonable 
chance of guessing right.

Hope this helps,

Roger

> I do not see a parameter for readGDAL for specifying word size or sign
> treatment. Can anyone offer advice/insight?
>
> Rick Reeves
> NCEAS
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From ervan.rutishauser at cirad.fr  Tue Mar 16 16:17:44 2010
From: ervan.rutishauser at cirad.fr (Ervan Rutishauser)
Date: Tue, 16 Mar 2010 16:17:44 +0100
Subject: [R-sig-Geo] Dividing an irregular plot region into equal sub-regions
Message-ID: <000001cac51b$e513f640$af3be2c0$@rutishauser@cirad.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100316/94ca8b1a/attachment.pl>

From cara.tobin at epfl.ch  Tue Mar 16 17:31:59 2010
From: cara.tobin at epfl.ch (Tobin Cara)
Date: Tue, 16 Mar 2010 17:31:59 +0100
Subject: [R-sig-Geo] performing normal quantile transform
Message-ID: <EDB94195DABE64488928DD39E53B8FC68BF118AC95@REX2.intranet.epfl.ch>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100316/edeb3932/attachment.pl>

From rotate at gmx.li  Tue Mar 16 20:49:31 2010
From: rotate at gmx.li (Bastian =?ISO-8859-1?Q?P=F6schl?=)
Date: Tue, 16 Mar 2010 20:49:31 +0100
Subject: [R-sig-Geo] how to calculate with grids?
Message-ID: <1268768971.3337.1.camel@TSBP.fritz.box>

Dear useRs,
        
        I try to subtract one ascii grid from another.
        
        By now i havn't managed to get a proper output.
        Sorry I am not able to provide the files for testing because
        they are very big.
        
        The grids are read by 
        
        dem1<-readAsciiGrid("grid1.asc", as.image = FALSE, plot.image =
        FALSE, colname = "height_old", proj4string = crs)
        dem2<-readAsciiGrid("dem2.asc", as.image = FALSE, plot.image =
        FALSE, colname = "height_new", proj4string = crs)
        
        The cell dimension is not equal (i tried to convert them into
        SpatialPointDataFrames to subtract the data, but struggled
        because of the different extensions.
        The cellsize is equal
        
        1> summary(dem1)
        Object of class SpatialGridDataFrame
        Coordinates:
                      min     max
        coords.x1 3493070 3495230
        coords.x2 5404550 5405920
        Is projected: TRUE 
        proj4string :
        [+proj=tmerc +lat_0=0 +lon_0=9 +k=1 +x_0=3500000 +y_0=0
        +ellps=bessel +datum=potsdam +units=m +no_defs]
        Number of points: 2
        Grid attributes:
          cellcentre.offset cellsize cells.dim
        1         3493070.5        1      2160
        2         5404550.5        1      1370
        Data attributes:
              Min.    1st Qu.     Median       Mean    3rd Qu.
        Max.       NA's 
          420.0000   433.4856   443.1912   442.5298   450.7338
        465.0000 80438.0000 
        
        1> summary(dem2)
        Object of class SpatialGridDataFrame
        Coordinates:
                        min       max
        coords.x1 3492999.5 3495000.5
        coords.x2 5403999.5 5406000.5
        Is projected: TRUE 
        proj4string :
        [+proj=tmerc +lat_0=0 +lon_0=9 +k=1 +x_0=3500000 +y_0=0
        +ellps=bessel +datum=potsdam +units=m +no_defs]
        Number of points: 2
        Grid attributes:
          cellcentre.offset cellsize cells.dim
        1           3493000        1      2001
        2           5404000        1      2001
        Data attributes:
            Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
        396.3400 425.7900 439.0900 437.6107 449.2700 470.1700 
        
        
        
        I found some hints in the help archive.
        http://finzi.psych.upenn.edu/Rhelp10/2009-February/187216.html
        tells about combining grids in an array, what i tried, but
        failed.
        
        I hope somebody can help me and give some advice how grids can
        be merged and/or calculations can be don within the grid format.
        
        This would be great.
        
        Thank you,
        
        Bastian


From r.hijmans at gmail.com  Tue Mar 16 21:39:52 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 16 Mar 2010 13:39:52 -0700
Subject: [R-sig-Geo] how to calculate with grids?
In-Reply-To: <1268768971.3337.1.camel@TSBP.fritz.box>
References: <1268768971.3337.1.camel@TSBP.fritz.box>
Message-ID: <dc22b2571003161339r3c03fce0u44ecb08c4ab7cb3b@mail.gmail.com>

Bastian,

These rasters have a different extent and origin. So you cannot just
subtract them. This often some unfortunate processing choices earlier
on. But if that is not the case, I think you need to resample (and
hence distort) your data. You can use the raster package for this. Had
the origin been the same you could have used the 'crop' function only,
and not 'resample'.

install.packages("raster", repos="http://R-Forge.R-project.org")
library(raster)

dem1 <- raster("grid1.asc")
dem2 <- raster("dem2.asc")
intersect <- crop(dem2, dem1)
dem1r <- resample(dem1, intersect, method='bilinear', progress='text')
dem3 <- intersect - dem1r
plot(dem3)

#or vice versa, resample to dem2 rather than to dem1
intersect2 <- crop(dem1, dem2)
dem2r <- resample(dem2, intersect2, method='bilinear', progress='text')
dem4 <- dem2r - intersect2
plot(dem4)

Good luck,
Robert

On Tue, Mar 16, 2010 at 12:49 PM, Bastian P?schl <rotate at gmx.li> wrote:
> Dear useRs,
>
> ? ? ? ?I try to subtract one ascii grid from another.
>
> ? ? ? ?By now i havn't managed to get a proper output.
> ? ? ? ?Sorry I am not able to provide the files for testing because
> ? ? ? ?they are very big.
>
> ? ? ? ?The grids are read by
>
> ? ? ? ?dem1<-readAsciiGrid("grid1.asc", as.image = FALSE, plot.image =
> ? ? ? ?FALSE, colname = "height_old", proj4string = crs)
> ? ? ? ?dem2<-readAsciiGrid("dem2.asc", as.image = FALSE, plot.image =
> ? ? ? ?FALSE, colname = "height_new", proj4string = crs)
>
> ? ? ? ?The cell dimension is not equal (i tried to convert them into
> ? ? ? ?SpatialPointDataFrames to subtract the data, but struggled
> ? ? ? ?because of the different extensions.
> ? ? ? ?The cellsize is equal
>
> ? ? ? ?1> summary(dem1)
> ? ? ? ?Object of class SpatialGridDataFrame
> ? ? ? ?Coordinates:
> ? ? ? ? ? ? ? ? ? ? ?min ? ? max
> ? ? ? ?coords.x1 3493070 3495230
> ? ? ? ?coords.x2 5404550 5405920
> ? ? ? ?Is projected: TRUE
> ? ? ? ?proj4string :
> ? ? ? ?[+proj=tmerc +lat_0=0 +lon_0=9 +k=1 +x_0=3500000 +y_0=0
> ? ? ? ?+ellps=bessel +datum=potsdam +units=m +no_defs]
> ? ? ? ?Number of points: 2
> ? ? ? ?Grid attributes:
> ? ? ? ? ?cellcentre.offset cellsize cells.dim
> ? ? ? ?1 ? ? ? ? 3493070.5 ? ? ? ?1 ? ? ?2160
> ? ? ? ?2 ? ? ? ? 5404550.5 ? ? ? ?1 ? ? ?1370
> ? ? ? ?Data attributes:
> ? ? ? ? ? ? ?Min. ? ?1st Qu. ? ? Median ? ? ? Mean ? ?3rd Qu.
> ? ? ? ?Max. ? ? ? NA's
> ? ? ? ? ?420.0000 ? 433.4856 ? 443.1912 ? 442.5298 ? 450.7338
> ? ? ? ?465.0000 80438.0000
>
> ? ? ? ?1> summary(dem2)
> ? ? ? ?Object of class SpatialGridDataFrame
> ? ? ? ?Coordinates:
> ? ? ? ? ? ? ? ? ? ? ? ?min ? ? ? max
> ? ? ? ?coords.x1 3492999.5 3495000.5
> ? ? ? ?coords.x2 5403999.5 5406000.5
> ? ? ? ?Is projected: TRUE
> ? ? ? ?proj4string :
> ? ? ? ?[+proj=tmerc +lat_0=0 +lon_0=9 +k=1 +x_0=3500000 +y_0=0
> ? ? ? ?+ellps=bessel +datum=potsdam +units=m +no_defs]
> ? ? ? ?Number of points: 2
> ? ? ? ?Grid attributes:
> ? ? ? ? ?cellcentre.offset cellsize cells.dim
> ? ? ? ?1 ? ? ? ? ? 3493000 ? ? ? ?1 ? ? ?2001
> ? ? ? ?2 ? ? ? ? ? 5404000 ? ? ? ?1 ? ? ?2001
> ? ? ? ?Data attributes:
> ? ? ? ? ? ?Min. ?1st Qu. ? Median ? ? Mean ?3rd Qu. ? ? Max.
> ? ? ? ?396.3400 425.7900 439.0900 437.6107 449.2700 470.1700
>
>
>
> ? ? ? ?I found some hints in the help archive.
> ? ? ? ?http://finzi.psych.upenn.edu/Rhelp10/2009-February/187216.html
> ? ? ? ?tells about combining grids in an array, what i tried, but
> ? ? ? ?failed.
>
> ? ? ? ?I hope somebody can help me and give some advice how grids can
> ? ? ? ?be merged and/or calculations can be don within the grid format.
>
> ? ? ? ?This would be great.
>
> ? ? ? ?Thank you,
>
> ? ? ? ?Bastian
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mfitzpatrick at umces.edu  Tue Mar 16 22:13:26 2010
From: mfitzpatrick at umces.edu (Matt Fitzpatrick)
Date: Tue, 16 Mar 2010 17:13:26 -0400
Subject: [R-sig-Geo] maptools - what happened to Map2poly?
Message-ID: <4B9FF476.4090600@umces.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100316/7ae30c8e/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Mar 16 22:26:47 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 16 Mar 2010 22:26:47 +0100
Subject: [R-sig-Geo] maptools - what happened to Map2poly?
In-Reply-To: <4B9FF476.4090600@umces.edu>
References: <4B9FF476.4090600@umces.edu>
Message-ID: <4B9FF797.90600@uni-muenster.de>

Matt, please try map2SpatialPolygons or map2SpatialLines (both in
package maptools)

Matt Fitzpatrick wrote:
> Hello - Can anyone refer me to the function that replaced map2poly? 
> 
> Thanks,
> Matt
> 
> <http://www.al.umces.edu/people/faculty/mattfitzpatrick.htm>
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From adrian at maths.uwa.edu.au  Wed Mar 17 03:48:37 2010
From: adrian at maths.uwa.edu.au (Adrian Baddeley)
Date: Wed, 17 Mar 2010 10:48:37 +0800
Subject: [R-sig-Geo] test for CSR in three dimensions
Message-ID: <4BA04305.5090603@maths.uwa.edu.au>

Tobias Verbeke writes:

 >  Is there any functionality available to test
 >  CSR for a three-dimensional point pattern ?

In 'spatstat' you can use the functions K3est, G3est, F3est to estimate 
the three-dimensional versions of the K-function, the nearest neighbour 
distance function, and the empty space function. Using simulation 
envelopes, these functions can form the basis of a Monte Carlo test for 
CSR. A realisation of CSR in three dimensions can be simulated using 
'rpoispp3'.

Currently (in spatstat 1.18-0) the envelope command cannot be used 
directly to generate simulation envelopes. However this will be possible 
in the next version 1.18-1.

In spatstat 1.18-1 you will be able to type (if X is a 3D point pattern)
       plot(envelope(X, K3est, nsim=19))
but in spatstat 1.18-0 you would have to use code similar to the 
suggestion of Marcelino de la Cruz as follows below (thanks, Marcelino!)

Adrian Baddeley

=============================================================

n <- nrow(coords(X))
volume <- volume.box3(as.box3(X))
lambda <- n / volume


# observed isotropic  corrected K
kobs <- K3est(X, rmax=1,nrval=101)$iso

#99 simulated CSR patterns

Xsim<- vector("list", 99)
for  (i in 1: 99){
     Xsim[[i]] <- rpoispp3(lambda, domain = as.box3(X))
}

#simulated K functions
   ksim <- sapply(Xsim, function(x) K3est(x, rmax=1,nrval=101)$iso)

# pointwise Monte Carlo test
plot(0:100, kobs, xlab="r", ylab="K3est(r)", type="l")
matplot(0:100,t(apply(ksim,1,range)), lty=2,col=2, type="l", add=T)


From Roger.Bivand at nhh.no  Wed Mar 17 08:28:56 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 17 Mar 2010 08:28:56 +0100 (CET)
Subject: [R-sig-Geo] maptools - what happened to Map2poly?
In-Reply-To: <4B9FF476.4090600@umces.edu>
References: <4B9FF476.4090600@umces.edu>
Message-ID: <alpine.LRH.2.00.1003170808520.12071@reclus.nhh.no>

On Tue, 16 Mar 2010, Matt Fitzpatrick wrote:

> Hello - Can anyone refer me to the function that replaced map2poly?

(note - Map2poly(), please refer to functions by their correct names - 
the function discarded attribute data from an imported shapefile (S3 
class "Map") to make a list of polygons. The data representation is not 
robust nor supported in further development).

That function was long deprecated (a warning was shown that the underlying 
representation would be withdrawn from the user namespace). See otherwise 
many replies to questions about this over the last three months, for 
example:

https://stat.ethz.ch/pipermail/r-help/2010-March/231949.html

https://stat.ethz.ch/pipermail/r-sig-geo/2010-February/007610.html

https://stat.ethz.ch/pipermail/r-sig-geo/2010-February/007611.html

https://stat.ethz.ch/pipermail/r-sig-geo/2009-December/007253.html

etc. As you will see, many of the questioners also use HTML mail, not text 
mail, so perhaps both reading the posting guide and searching the 
archives, as well as reading warning messages, might be a good idea.

The sp package has been in place for five years now, so removing direct 
access to its inadequate antecedents in maptools isn't unexpected. Legacy 
scripts can be adapted as shown in the replies; replacing read.shape() 
with readShapeSpatial() should be sufficient for most uses as the plot() 
method for the deprecated S3 "polylist" class has similar arguments to the 
plot() method in the sp package for objects inheriting from the S4 
"SpatialPolygons" class. If need be, use the ::: operator to access 
commands in maptools no longer in the user namespace.

Alternatively, stay with an antiquated version of maptools, your choice.

Roger

>
> Thanks,
> Matt
>
> <http://www.al.umces.edu/people/faculty/mattfitzpatrick.htm>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From tobias.verbeke at openanalytics.eu  Wed Mar 17 17:31:29 2010
From: tobias.verbeke at openanalytics.eu (Tobias Verbeke)
Date: Wed, 17 Mar 2010 17:31:29 +0100
Subject: [R-sig-Geo] test for CSR in three dimensions
In-Reply-To: <4BA04305.5090603@maths.uwa.edu.au>
References: <4BA04305.5090603@maths.uwa.edu.au>
Message-ID: <4BA103E1.80800@openanalytics.eu>

Adrian Baddeley wrote:
> Tobias Verbeke writes:
> 
>  >  Is there any functionality available to test
>  >  CSR for a three-dimensional point pattern ?
> 
> In 'spatstat' you can use the functions K3est, G3est, F3est to estimate 
> the three-dimensional versions of the K-function, the nearest neighbour 
> distance function, and the empty space function. Using simulation 
> envelopes, these functions can form the basis of a Monte Carlo test for 
> CSR. A realisation of CSR in three dimensions can be simulated using 
> 'rpoispp3'.
> 
> Currently (in spatstat 1.18-0) the envelope command cannot be used 
> directly to generate simulation envelopes. However this will be possible 
> in the next version 1.18-1.

Wonderful !

Many thanks,
Tobias

> In spatstat 1.18-1 you will be able to type (if X is a 3D point pattern)
>       plot(envelope(X, K3est, nsim=19))
> but in spatstat 1.18-0 you would have to use code similar to the 
> suggestion of Marcelino de la Cruz as follows below (thanks, Marcelino!)
> 
> Adrian Baddeley
> 
> =============================================================
> 
> n <- nrow(coords(X))
> volume <- volume.box3(as.box3(X))
> lambda <- n / volume
> 
> 
> # observed isotropic  corrected K
> kobs <- K3est(X, rmax=1,nrval=101)$iso
> 
> #99 simulated CSR patterns
> 
> Xsim<- vector("list", 99)
> for  (i in 1: 99){
>     Xsim[[i]] <- rpoispp3(lambda, domain = as.box3(X))
> }
> 
> #simulated K functions
>   ksim <- sapply(Xsim, function(x) K3est(x, rmax=1,nrval=101)$iso)
> 
> # pointwise Monte Carlo test
> plot(0:100, kobs, xlab="r", ylab="K3est(r)", type="l")
> matplot(0:100,t(apply(ksim,1,range)), lty=2,col=2, type="l", add=T)
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
>


From Roger.Bivand at nhh.no  Thu Mar 18 09:05:59 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Mar 2010 09:05:59 +0100 (CET)
Subject: [R-sig-Geo] Null Distances in Neighbour Matrix
In-Reply-To: <79473eea1003150637r4e8f53cey120661b7fd2c3ee@mail.gmail.com>
References: <79473eea1003150637r4e8f53cey120661b7fd2c3ee@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1003180850540.15553@reclus.nhh.no>

On Mon, 15 Mar 2010, sylvain willart wrote:

> Hello,
>
> I am new to this list as I just begin to work on spatial data...
>
> I mostly use spdep (and lme for the variogram) but I recently came
> across a problem I don't know how to deal with,
>
> The project I'm working on is a study on the localization of physicians 
> in a metropolitan area. I have the adress of each of them that I coded 
> in Long/Lat. However, some of them are grouped in the same practice, 
> sharing the same adress, and hence the same Long/Lat. This causes a 
> "null distance" error when I try to compute a neighbour matrix and a 
> variogram.

You will need to introduce a trivial non-zero distance to disambiguate the 
points that have zero distance in both cases. Use the sp function 
zerodist() to find the observations that match, and jitter them:

library(sp)
set.seed(1)
xy <- cbind(runif(10), runif(10))
xy <- rbind(xy, xy[1:2,])
xy[c(1,2,11,12),]
library(spdep)
a <- dnearneigh(xy, 0, 0.35)
a[[1]]
zerodist(SpatialPoints(xy))
js <- c(zerodist(SpatialPoints(xy)))
xy[js, 1] <- jitter(xy[js, 1], amount=0.00001)
xy[js, 2] <- jitter(xy[js, 2])
xy[c(1,2,11,12),]
b <- dnearneigh(xy, 0, 0.35)
b[[1]]

and similarly for the variogram case.

Hope this helps,

Roger

>
> any clue ?
>
> thanks in advance,
>
> sylvain
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From e.jahanshiri at gmail.com  Thu Mar 18 12:31:19 2010
From: e.jahanshiri at gmail.com (Ebrahim Jahanshiri)
Date: Thu, 18 Mar 2010 19:31:19 +0800
Subject: [R-sig-Geo] Back-transforming krigged variables
In-Reply-To: <4B8BB26F.6020603@uni-muenster.de>
References: <b0a6ce471003010123v3eaa92feqa60b944e08c34877@mail.gmail.com>
	<4B8BB26F.6020603@uni-muenster.de>
Message-ID: <b0a6ce471003180431h464ff0e0h8306269d15659462@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100318/8b7aaf6f/attachment.pl>

From Gindo.Tampubolon at manchester.ac.uk  Thu Mar 18 14:55:32 2010
From: Gindo.Tampubolon at manchester.ac.uk (Gindo Tampubolon)
Date: Thu, 18 Mar 2010 13:55:32 +0000
Subject: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
Message-ID: <20100318135532183.00000005944@h-s-h000960>

 
Dear all,

Can anyone tell me how to read ArcGIS 9.3 generated .swm file [spatial weight matrix] into R?

I am stumped at page 242 of the ASDAR book [Bivand et al 2008]. I use a SpatialPolygonsDataFrame object and tried to generate neighbours list using poly2nb(). It took more than 24 hours [European data NUTS level 3 about 1500 regions]. After finishing, the result is a null set.

So I generate a rook weight matrix in ArcGIS 9.3 [and convert it to a table there]. How do I import this matrix to R?


I looked at RArcInfo and rgdal packages but could not find anything obvious; I'm experimenting with read.gwt2nb() but ArcGIS created swm based on numeric ID instead of NUTS_CODE alphanumeric; needs tweaking perhaps.

Many thanks

Gindo


From Roger.Bivand at nhh.no  Thu Mar 18 15:23:21 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Mar 2010 15:23:21 +0100 (CET)
Subject: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
In-Reply-To: <20100318135532183.00000005944@h-s-h000960>
References: <20100318135532183.00000005944@h-s-h000960>
Message-ID: <alpine.LRH.2.00.1003181516150.15553@reclus.nhh.no>

On Thu, 18 Mar 2010, Gindo Tampubolon wrote:

> Dear all,
>
> Can anyone tell me how to read ArcGIS 9.3 generated .swm file [spatial 
> weight matrix] into R?

Well, make a number of small samples available on a website - most people 
do not have access to Arc, so helping is hard. Is there an ESRI site with 
shapefiles and matching sample *.swm files?

>
> I am stumped at page 242 of the ASDAR book [Bivand et al 2008]. I use a 
> SpatialPolygonsDataFrame object and tried to generate neighbours list 
> using poly2nb(). It took more than 24 hours [European data NUTS level 3 
> about 1500 regions]. After finishing, the result is a null set.
>

Always try a subset first. Most likely you need the snap= argument, if the 
boundaries do not touch but are close to each other. Almost certainly your 
input map also had far too much detail in shorelines and river borders, 
leading to your machine getting overloaded (Windows?). Displaying on such 
a map would also be dominated by line detail.

> So I generate a rook weight matrix in ArcGIS 9.3 [and convert it to a 
> table there]. How do I import this matrix to R?

Contribute by making sample files available. To read a matrix if you must, 
use read.table().

Roger

>
>
> I looked at RArcInfo and rgdal packages but could not find anything 
> obvious; I'm experimenting with read.gwt2nb() but ArcGIS created swm 
> based on numeric ID instead of NUTS_CODE alphanumeric; needs tweaking 
> perhaps.
>
> Many thanks
>
> Gindo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From caspar.hallmann at gmail.com  Thu Mar 18 16:38:25 2010
From: caspar.hallmann at gmail.com (caspar hallmann)
Date: Thu, 18 Mar 2010 16:38:25 +0100
Subject: [R-sig-Geo] writeOGR issue in dbf
Message-ID: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>

Dear list,

I am using writeOGR to create an ESRI shapefile from a
SpatialPointsDataFrame. When opening the shapefile in ArcMap and ask
for the attributes, I get an error "A column was specified that does
not exist".
Similarly, when opening the dbf of the shapefile in Paradox I get
"Unable to open table. Corrupt table/index header".
This does not only happen to my own Dataset but also the meuse data.

data(meuse)
coordinates(meuse)=~x+y
class(meuse)
writeOGR(meuse,".","test",driver="ESRI Shapefile")
# then try ArcMap or Paradox fails as mentioned above.
#Strangely, when i do
write.dbf(read.dbf("test.dbf"),file="test2")
#then renaming test2 into test, my attribute tables open up fine, and
Paradox stops complaining.

any clues?

Caspar.

> sessionInfo()
R version 2.10.1 (2009-12-14)
i386-pc-mingw32

locale:
[1] LC_COLLATE=Dutch_Netherlands.1252  LC_CTYPE=Dutch_Netherlands.1252
   LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
[5] LC_TIME=Dutch_Netherlands.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
 [1] pscl_1.03.3        coda_0.13-4        mvtnorm_0.9-9
automap_1.0-5      MASS_7.3-5         lme4_0.999375-32
Matrix_0.999375-33 maptools_0.7-29
 [9] lattice_0.18-3     foreign_0.8-39     raster_0.9.9-24
rgdal_0.6-24       gstat_0.9-66       sp_0.9-57

loaded via a namespace (and not attached):
[1] grid_2.10.1  tools_2.10.1


From Roger.Bivand at nhh.no  Thu Mar 18 17:26:33 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Mar 2010 17:26:33 +0100 (CET)
Subject: [R-sig-Geo] writeOGR issue in dbf
In-Reply-To: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
References: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1003181714030.15553@reclus.nhh.no>

On Thu, 18 Mar 2010, caspar hallmann wrote:

> Dear list,
>
> I am using writeOGR to create an ESRI shapefile from a
> SpatialPointsDataFrame. When opening the shapefile in ArcMap and ask
> for the attributes, I get an error "A column was specified that does
> not exist".

I only have other tools using OGR (GRASS, QGIS) and Excel 2003 SP3 on 
Windows XP. Your example cannot be reproduced using those. I suspect from 
trying to interpret the entrails of ESRI "help", that an integer column is 
required reproducing the FID values already encoded in the *.shp. Try:

meuse$FIDs <- 1:nrow(meuse)

and write out again. This doesn't match your simple copying to get it to 
read, though. If others could comment who have access to Arc (which 
version), that would be useful. Please include a copy of the messages 
displayed when rgdal is loaded, so that we have control of the versions.

Does changing locale make a difference?

Roger

> Similarly, when opening the dbf of the shapefile in Paradox I get
> "Unable to open table. Corrupt table/index header".
> This does not only happen to my own Dataset but also the meuse data.
>
> data(meuse)
> coordinates(meuse)=~x+y
> class(meuse)
> writeOGR(meuse,".","test",driver="ESRI Shapefile")
> # then try ArcMap or Paradox fails as mentioned above.
> #Strangely, when i do
> write.dbf(read.dbf("test.dbf"),file="test2")
> #then renaming test2 into test, my attribute tables open up fine, and
> Paradox stops complaining.
>
> any clues?
>
> Caspar.
>
>> sessionInfo()
> R version 2.10.1 (2009-12-14)
> i386-pc-mingw32
>
> locale:
> [1] LC_COLLATE=Dutch_Netherlands.1252  LC_CTYPE=Dutch_Netherlands.1252
>   LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
> [5] LC_TIME=Dutch_Netherlands.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] pscl_1.03.3        coda_0.13-4        mvtnorm_0.9-9
> automap_1.0-5      MASS_7.3-5         lme4_0.999375-32
> Matrix_0.999375-33 maptools_0.7-29
> [9] lattice_0.18-3     foreign_0.8-39     raster_0.9.9-24
> rgdal_0.6-24       gstat_0.9-66       sp_0.9-57
>
> loaded via a namespace (and not attached):
> [1] grid_2.10.1  tools_2.10.1
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Thu Mar 18 17:29:16 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 18 Mar 2010 09:29:16 -0700
Subject: [R-sig-Geo] writeOGR issue in dbf
In-Reply-To: <alpine.LRH.2.00.1003181714030.15553@reclus.nhh.no>
References: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
	<alpine.LRH.2.00.1003181714030.15553@reclus.nhh.no>
Message-ID: <dc22b2571003180929g1c77c65ah1e0f1098c91144ad@mail.gmail.com>

I think the problem is an illegal variable name  "dist.m"

This works for me:

data(meuse)
coordinates(meuse)=~x+y
names(meuse)[12] = 'distm'
writeOGR(meuse,".","test",driver="ESRI Shapefile")

Robert

On Thu, Mar 18, 2010 at 9:26 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Thu, 18 Mar 2010, caspar hallmann wrote:
>
>> Dear list,
>>
>> I am using writeOGR to create an ESRI shapefile from a
>> SpatialPointsDataFrame. When opening the shapefile in ArcMap and ask
>> for the attributes, I get an error "A column was specified that does
>> not exist".
>
> I only have other tools using OGR (GRASS, QGIS) and Excel 2003 SP3 on
> Windows XP. Your example cannot be reproduced using those. I suspect from
> trying to interpret the entrails of ESRI "help", that an integer column is
> required reproducing the FID values already encoded in the *.shp. Try:
>
> meuse$FIDs <- 1:nrow(meuse)
>
> and write out again. This doesn't match your simple copying to get it to
> read, though. If others could comment who have access to Arc (which
> version), that would be useful. Please include a copy of the messages
> displayed when rgdal is loaded, so that we have control of the versions.
>
> Does changing locale make a difference?
>
> Roger
>
>> Similarly, when opening the dbf of the shapefile in Paradox I get
>> "Unable to open table. Corrupt table/index header".
>> This does not only happen to my own Dataset but also the meuse data.
>>
>> data(meuse)
>> coordinates(meuse)=~x+y
>> class(meuse)
>> writeOGR(meuse,".","test",driver="ESRI Shapefile")
>> # then try ArcMap or Paradox fails as mentioned above.
>> #Strangely, when i do
>> write.dbf(read.dbf("test.dbf"),file="test2")
>> #then renaming test2 into test, my attribute tables open up fine, and
>> Paradox stops complaining.
>>
>> any clues?
>>
>> Caspar.
>>
>>> sessionInfo()
>>
>> R version 2.10.1 (2009-12-14)
>> i386-pc-mingw32
>>
>> locale:
>> [1] LC_COLLATE=Dutch_Netherlands.1252 ?LC_CTYPE=Dutch_Netherlands.1252
>> ?LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
>> [5] LC_TIME=Dutch_Netherlands.1252
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] pscl_1.03.3 ? ? ? ?coda_0.13-4 ? ? ? ?mvtnorm_0.9-9
>> automap_1.0-5 ? ? ?MASS_7.3-5 ? ? ? ? lme4_0.999375-32
>> Matrix_0.999375-33 maptools_0.7-29
>> [9] lattice_0.18-3 ? ? foreign_0.8-39 ? ? raster_0.9.9-24
>> rgdal_0.6-24 ? ? ? gstat_0.9-66 ? ? ? sp_0.9-57
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.10.1 ?tools_2.10.1
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Gindo.Tampubolon at manchester.ac.uk  Thu Mar 18 17:29:44 2010
From: Gindo.Tampubolon at manchester.ac.uk (Gindo Tampubolon)
Date: Thu, 18 Mar 2010 16:29:44 +0000
Subject: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
In-Reply-To: <alpine.LRH.2.00.1003181516150.15553@reclus.nhh.no>
References: <20100318135532183.00000005944@h-s-h000960>
	<alpine.LRH.2.00.1003181516150.15553@reclus.nhh.no>
Message-ID: <20100318162944311.00000003440@h-s-h000960>

Dear Roger and all,

Sorry for not putting a sample. Yes, Windows seems to be overloaded.
http://sites.google.com/site/tehtareknow/home/spatial-weight-matrix/

Thanks for the tip and any more help much appreciated,
Gindo

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: 18 March 2010 14:23
To: Gindo Tampubolon
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file

On Thu, 18 Mar 2010, Gindo Tampubolon wrote:

> Dear all,
>
> Can anyone tell me how to read ArcGIS 9.3 generated .swm file [spatial
> weight matrix] into R?

Well, make a number of small samples available on a website - most people
do not have access to Arc, so helping is hard. Is there an ESRI site with
shapefiles and matching sample *.swm files?

>
> I am stumped at page 242 of the ASDAR book [Bivand et al 2008]. I use a
> SpatialPolygonsDataFrame object and tried to generate neighbours list
> using poly2nb(). It took more than 24 hours [European data NUTS level 3
> about 1500 regions]. After finishing, the result is a null set.
>

Always try a subset first. Most likely you need the snap= argument, if the
boundaries do not touch but are close to each other. Almost certainly your
input map also had far too much detail in shorelines and river borders,
leading to your machine getting overloaded (Windows?). Displaying on such
a map would also be dominated by line detail.

> So I generate a rook weight matrix in ArcGIS 9.3 [and convert it to a
> table there]. How do I import this matrix to R?

Contribute by making sample files available. To read a matrix if you must,
use read.table().

Roger

>
>
> I looked at RArcInfo and rgdal packages but could not find anything
> obvious; I'm experimenting with read.gwt2nb() but ArcGIS created swm
> based on numeric ID instead of NUTS_CODE alphanumeric; needs tweaking
> perhaps.
>
> Many thanks
>
> Gindo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From zua3 at cornell.edu  Thu Mar 18 17:35:18 2010
From: zua3 at cornell.edu (Zia Ahmed)
Date: Thu, 18 Mar 2010 12:35:18 -0400
Subject: [R-sig-Geo] Help: R-function to plot all CSGS realization
 variograms in single a plot
In-Reply-To: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
References: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
Message-ID: <4BA25646.8080407@cornell.edu>

Hi,
 I am trying to plot 100 variograms from 100 CSGS realizations  in a 
single plot with the observed  variogram model. I used following codes 
to plot them  together. But problem is this code is: I have to create 
variogram for all realizations,  ie  100  times I  have to repeat this  
code!
This their  any  way  to run following codes with in a loop to create a 
plot of variograms of all realizations with observed variogram model. 
Help will  be appreciated. 
Thanks
Zia


library(gstat)
data(meuse)
data(meuse.grid)
coordinates(meuse) = ~x + y
coordinates(meuse.grid) = ~x + y

# Variogram log Zn

lzn.vgm = variogram(log(zinc) ~ 1, meuse)
lzn.fit = fit.variogram(lzn.vgm, model = vgm(1, "Sph", 900, 1))

#Conditional simulation

lzn.sim = krige(log(zinc) ~ 1, meuse, meuse.grid, model = lzn.fit,
nmax = 30, nsim = 100)

# Variogram of all relizations

var.sim1<-variogram(sim1~1, lzn.sim)    # Realization 1
var.sim2<-variogram(sim2~1, lzn.sim)    # Realization 2
var.sim3<-variogram(sim3~1, lzn.sim)    # Realization 3
var.sim4<-variogram(sim4~1, lzn.sim)    # Realization 4
.
.
.
var.sim100<-variogram(sim100~1, lzn.sim)    # Realization 100

# Vriogram of observed data and all relaizations
##################################################

plot(lzn.vgm$gamma ~ lzn.vgm$dist, xlim = c(0, max(lzn.vgm$dist) * 1.05),
ylim = c(0, max(lzn.vgm$gamma) * 1.2), pch = 21, col = "black",cex=.8,
cex.axis = 0.85, cex.lab=.8, xlab =  "Distance (m)", ylab = "Semivariance")

lines(variogramLine(fit.variogram(lzn.vgm,  lzn.fit),  # Sim1
maxdist = max(lzn.vgm$dist)), col = "red", lwd=2)

lines(variogramLine(fit.variogram(var.sim1, lzn.fit),  # sim2
maxdist = max(lzn.vgm$dist)), col = "black", lty=1)

lines(variogramLine(fit.variogram(var.sim2, lzn.fit), # Sim3
maxdist = max(lzn.vgm$dist)), col = "black", lty=1)

lines(variogramLine(fit.variogram(var.sim3, lzn.fit), # Sim4
maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
.
.
.
.
lines(variogramLine(fit.variogram(var.sim100, lzn.fit), # Sim100
maxdist = max(lzn.vgm$dist)), col = "black", lty=1) 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100318/795b65be/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100318/795b65be/attachment.vcf>

From wxrichte at gw.dec.state.ny.us  Thu Mar 18 17:40:21 2010
From: wxrichte at gw.dec.state.ny.us (Wayne Richter)
Date: Thu, 18 Mar 2010 12:40:21 -0400
Subject: [R-sig-Geo] writeOGR issue in dbf
In-Reply-To: <dc22b2571003180929g1c77c65ah1e0f1098c91144ad@mail.gmail.com>
References: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
	<alpine.LRH.2.00.1003181714030.15553@reclus.nhh.no>
	<dc22b2571003180929g1c77c65ah1e0f1098c91144ad@mail.gmail.com>
Message-ID: <4BA21F36.DA06.00D2.1@gw.dec.state.ny.us>

This should indeed be the problem. From the Help: "Field names must start with a letter. Field names must contain only letters, numbers, and underscores." Unfortunately, ESRI software can behave in a cryptic, inconsistent or unhelpful way when it encounters a field name that it doesn't like. A hidden trailing space can really mess you up.



Wayne Richter
New York State Department of Environmental Conservation
625 Broadway
Albany, New York 12233-4756
518-402-8974

>>> 
From: 	"Robert J. Hijmans" <r.hijmans at gmail.com>
To:	caspar hallmann <caspar.hallmann at gmail.com>
CC:	r-sig-geo <r-sig-geo at stat.math.ethz.ch>
Date: 	3/18/2010 12:30 PM
Subject: 	Re: [R-sig-Geo] writeOGR issue in dbf

I think the problem is an illegal variable name  "dist.m"

This works for me:

data(meuse)
coordinates(meuse)=~x+y
names(meuse)[12] = 'distm'
writeOGR(meuse,".","test",driver="ESRI Shapefile")

Robert

On Thu, Mar 18, 2010 at 9:26 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Thu, 18 Mar 2010, caspar hallmann wrote:
>
>> Dear list,
>>
>> I am using writeOGR to create an ESRI shapefile from a
>> SpatialPointsDataFrame. When opening the shapefile in ArcMap and ask
>> for the attributes, I get an error "A column was specified that does
>> not exist".
>
> I only have other tools using OGR (GRASS, QGIS) and Excel 2003 SP3 on
> Windows XP. Your example cannot be reproduced using those. I suspect from
> trying to interpret the entrails of ESRI "help", that an integer column is
> required reproducing the FID values already encoded in the *.shp. Try:
>
> meuse$FIDs <- 1:nrow(meuse)
>
> and write out again. This doesn't match your simple copying to get it to
> read, though. If others could comment who have access to Arc (which
> version), that would be useful. Please include a copy of the messages
> displayed when rgdal is loaded, so that we have control of the versions.
>
> Does changing locale make a difference?
>
> Roger
>
>> Similarly, when opening the dbf of the shapefile in Paradox I get
>> "Unable to open table. Corrupt table/index header".
>> This does not only happen to my own Dataset but also the meuse data.
>>
>> data(meuse)
>> coordinates(meuse)=~x+y
>> class(meuse)
>> writeOGR(meuse,".","test",driver="ESRI Shapefile")
>> # then try ArcMap or Paradox fails as mentioned above.
>> #Strangely, when i do
>> write.dbf(read.dbf("test.dbf"),file="test2")
>> #then renaming test2 into test, my attribute tables open up fine, and
>> Paradox stops complaining.
>>
>> any clues?
>>
>> Caspar.
>>
>>> sessionInfo()
>>
>> R version 2.10.1 (2009-12-14)
>> i386-pc-mingw32
>>
>> locale:
>> [1] LC_COLLATE=Dutch_Netherlands.1252  LC_CTYPE=Dutch_Netherlands.1252
>>  LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
>> [5] LC_TIME=Dutch_Netherlands.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] pscl_1.03.3        coda_0.13-4        mvtnorm_0.9-9
>> automap_1.0-5      MASS_7.3-5         lme4_0.999375-32
>> Matrix_0.999375-33 maptools_0.7-29
>> [9] lattice_0.18-3     foreign_0.8-39     raster_0.9.9-24
>> rgdal_0.6-24       gstat_0.9-66       sp_0.9-57
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.10.1  tools_2.10.1
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch 
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no 
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch 
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Thu Mar 18 18:03:46 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 18 Mar 2010 10:03:46 -0700
Subject: [R-sig-Geo] writeOGR issue in dbf
In-Reply-To: <4BA21F36.DA06.00D2.1@gw.dec.state.ny.us>
References: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
	<alpine.LRH.2.00.1003181714030.15553@reclus.nhh.no>
	<dc22b2571003180929g1c77c65ah1e0f1098c91144ad@mail.gmail.com>
	<4BA21F36.DA06.00D2.1@gw.dec.state.ny.us>
Message-ID: <dc22b2571003181003y4e61dc8bx467e3e4ecdc1712@mail.gmail.com>

I believe that this is part of the DBF specification (there is also a
limit on the number of characters in a variable name. 12?). This was
largely ignored by ArcView (and the versions of excel that write dbf
files), but apparently not by ArcGIS (apart from the missing warning
message, that is probably a good thing). Perhaps a future version of
readOGR could check for and fix variable names that are not DBF
compliant when writing shp files?
Robert

On Thu, Mar 18, 2010 at 9:40 AM, Wayne Richter
<wxrichte at gw.dec.state.ny.us> wrote:
> This should indeed be the problem. From the Help: "Field names must start with a letter. Field names must contain only letters, numbers, and underscores." Unfortunately, ESRI software can behave in a cryptic, inconsistent or unhelpful way when it encounters a field name that it doesn't like. A hidden trailing space can really mess you up.
>
>
>
> Wayne Richter
> New York State Department of Environmental Conservation
> 625 Broadway
> Albany, New York 12233-4756
> 518-402-8974
>
>>>>
> From: ? "Robert J. Hijmans" <r.hijmans at gmail.com>
> To: ? ? caspar hallmann <caspar.hallmann at gmail.com>
> CC: ? ? r-sig-geo <r-sig-geo at stat.math.ethz.ch>
> Date: ? 3/18/2010 12:30 PM
> Subject: ? ? ? ?Re: [R-sig-Geo] writeOGR issue in dbf
>
> I think the problem is an illegal variable name ?"dist.m"
>
> This works for me:
>
> data(meuse)
> coordinates(meuse)=~x+y
> names(meuse)[12] = 'distm'
> writeOGR(meuse,".","test",driver="ESRI Shapefile")
>
> Robert
>
> On Thu, Mar 18, 2010 at 9:26 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Thu, 18 Mar 2010, caspar hallmann wrote:
>>
>>> Dear list,
>>>
>>> I am using writeOGR to create an ESRI shapefile from a
>>> SpatialPointsDataFrame. When opening the shapefile in ArcMap and ask
>>> for the attributes, I get an error "A column was specified that does
>>> not exist".
>>
>> I only have other tools using OGR (GRASS, QGIS) and Excel 2003 SP3 on
>> Windows XP. Your example cannot be reproduced using those. I suspect from
>> trying to interpret the entrails of ESRI "help", that an integer column is
>> required reproducing the FID values already encoded in the *.shp. Try:
>>
>> meuse$FIDs <- 1:nrow(meuse)
>>
>> and write out again. This doesn't match your simple copying to get it to
>> read, though. If others could comment who have access to Arc (which
>> version), that would be useful. Please include a copy of the messages
>> displayed when rgdal is loaded, so that we have control of the versions.
>>
>> Does changing locale make a difference?
>>
>> Roger
>>
>>> Similarly, when opening the dbf of the shapefile in Paradox I get
>>> "Unable to open table. Corrupt table/index header".
>>> This does not only happen to my own Dataset but also the meuse data.
>>>
>>> data(meuse)
>>> coordinates(meuse)=~x+y
>>> class(meuse)
>>> writeOGR(meuse,".","test",driver="ESRI Shapefile")
>>> # then try ArcMap or Paradox fails as mentioned above.
>>> #Strangely, when i do
>>> write.dbf(read.dbf("test.dbf"),file="test2")
>>> #then renaming test2 into test, my attribute tables open up fine, and
>>> Paradox stops complaining.
>>>
>>> any clues?
>>>
>>> Caspar.
>>>
>>>> sessionInfo()
>>>
>>> R version 2.10.1 (2009-12-14)
>>> i386-pc-mingw32
>>>
>>> locale:
>>> [1] LC_COLLATE=Dutch_Netherlands.1252 ?LC_CTYPE=Dutch_Netherlands.1252
>>> ?LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
>>> [5] LC_TIME=Dutch_Netherlands.1252
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] pscl_1.03.3 ? ? ? ?coda_0.13-4 ? ? ? ?mvtnorm_0.9-9
>>> automap_1.0-5 ? ? ?MASS_7.3-5 ? ? ? ? lme4_0.999375-32
>>> Matrix_0.999375-33 maptools_0.7-29
>>> [9] lattice_0.18-3 ? ? foreign_0.8-39 ? ? raster_0.9.9-24
>>> rgdal_0.6-24 ? ? ? gstat_0.9-66 ? ? ? sp_0.9-57
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.10.1 ?tools_2.10.1
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From michael.denslow at gmail.com  Thu Mar 18 20:12:45 2010
From: michael.denslow at gmail.com (Michael Denslow)
Date: Thu, 18 Mar 2010 15:12:45 -0400
Subject: [R-sig-Geo] to many characters in .dbf file?
Message-ID: <b440a3f81003181212k4435f363rc459527bf9d68494@mail.gmail.com>

Dear r-sig-geo,

I am in a bit of a bind. I am trying to write a shape file using
writeOGR() in rgdal.
I just realized that I may have too many characters in the cells as
they are getting cut off when the shape file is created. The cells are
unchanged in the SpatialPointsDataFrame. But when I inspect the .dbf
they are all truncated.
The cells that are cut off contain literature citations, so some are
very long (hundreds of characters). Is there a solution to this
problem?
This shape file is being imported into Geoserver so I am some what
limited as to the formats that I can use.

Any advice?

Thanks in advance,
Michael


-- 
Michael Denslow

I.W. Carpenter Jr. Herbarium [BOON]
Department of Biology
Appalachian State University
Boone, North Carolina U.S.A.
-- AND --
Communications Manager
Southeast Regional Network of Expertise and Collections
sernec.org

36.214177, -81.681480 +/- 3103 meters


From Roger.Bivand at nhh.no  Thu Mar 18 20:19:40 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Mar 2010 20:19:40 +0100 (CET)
Subject: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
In-Reply-To: <20100318162944311.00000003440@h-s-h000960>
References: <20100318135532183.00000005944@h-s-h000960>
	<alpine.LRH.2.00.1003181516150.15553@reclus.nhh.no>
	<20100318162944311.00000003440@h-s-h000960>
Message-ID: <alpine.LRH.2.00.1003182010530.19560@reclus.nhh.no>

On Thu, 18 Mar 2010, Gindo Tampubolon wrote:

> Dear Roger and all,
>
> Sorry for not putting a sample. Yes, Windows seems to be overloaded.
> http://sites.google.com/site/tehtareknow/home/spatial-weight-matrix/

The *.swm file is a binary file in an unknown format. The DBF file can be 
read as follows:

library(foreign)
x <- read.dbf("spatialweightmatrix3.dbf")
from_IDs <- sort(unique(x$FID2))
to_IDs <- sort(unique(x$NID))
# find the IDs used
all.equal(from_IDs, to_IDs)
o <- order(x$FID2, x$NID)
# order the object
xx <- x[o,]
# convert manually to a spatial.neighbours representation
sn <- data.frame(from=match(xx$FID2, from_IDs), to=match(xx$NID+1,
   to_IDs), weihts=xx$WEIGHT)
attr(sn, "n") <- length(from_IDs)
attr(sn, "region.id") <- as.character(from_IDs)
class(sn) <- c("spatial.neighbour", class(sn))
library(spdep)
lw <- sn2listw(sn)
lw
summary(sapply(lw$weights, sum))
table(card(lw$neighbours))

There are only 1331 observations, so unconnected ones appear to be 
dropped, and are probably the "holes" in attr(lw, "region.id") which 
should span 0:1356, but is missing 25 values. The FID2 are probably the 
FID of the polygon objects.

Hope this helps,

Roger


>
> Thanks for the tip and any more help much appreciated,
> Gindo
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: 18 March 2010 14:23
> To: Gindo Tampubolon
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
>
> On Thu, 18 Mar 2010, Gindo Tampubolon wrote:
>
>> Dear all,
>>
>> Can anyone tell me how to read ArcGIS 9.3 generated .swm file [spatial
>> weight matrix] into R?
>
> Well, make a number of small samples available on a website - most people
> do not have access to Arc, so helping is hard. Is there an ESRI site with
> shapefiles and matching sample *.swm files?
>
>>
>> I am stumped at page 242 of the ASDAR book [Bivand et al 2008]. I use a
>> SpatialPolygonsDataFrame object and tried to generate neighbours list
>> using poly2nb(). It took more than 24 hours [European data NUTS level 3
>> about 1500 regions]. After finishing, the result is a null set.
>>
>
> Always try a subset first. Most likely you need the snap= argument, if the
> boundaries do not touch but are close to each other. Almost certainly your
> input map also had far too much detail in shorelines and river borders,
> leading to your machine getting overloaded (Windows?). Displaying on such
> a map would also be dominated by line detail.
>
>> So I generate a rook weight matrix in ArcGIS 9.3 [and convert it to a
>> table there]. How do I import this matrix to R?
>
> Contribute by making sample files available. To read a matrix if you must,
> use read.table().
>
> Roger
>
>>
>>
>> I looked at RArcInfo and rgdal packages but could not find anything
>> obvious; I'm experimenting with read.gwt2nb() but ArcGIS created swm
>> based on numeric ID instead of NUTS_CODE alphanumeric; needs tweaking
>> perhaps.
>>
>> Many thanks
>>
>> Gindo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From wxrichte at gw.dec.state.ny.us  Thu Mar 18 20:23:39 2010
From: wxrichte at gw.dec.state.ny.us (Wayne Richter)
Date: Thu, 18 Mar 2010 15:23:39 -0400
Subject: [R-sig-Geo] to many characters in .dbf file?
In-Reply-To: <b440a3f81003181212k4435f363rc459527bf9d68494@mail.gmail.com>
References: <b440a3f81003181212k4435f363rc459527bf9d68494@mail.gmail.com>
Message-ID: <4BA2457B.DA06.00D2.1@gw.dec.state.ny.us>

A shapefile limits the width of a character field to 254 characters: http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?TopicName=Geoprocessing%20considerations%20for%20shapefile%20output. Perhaps you will need to export your long field into a different format.


>>> 
From: 	Michael Denslow <michael.denslow at gmail.com>
To:	r-sig-geo <r-sig-geo at stat.math.ethz.ch>
Date: 	3/18/2010 3:13 PM
Subject: 	[R-sig-Geo] to many characters in .dbf file?

Dear r-sig-geo,

I am in a bit of a bind. I am trying to write a shape file using
writeOGR() in rgdal.
I just realized that I may have too many characters in the cells as
they are getting cut off when the shape file is created. The cells are
unchanged in the SpatialPointsDataFrame. But when I inspect the .dbf
they are all truncated.
The cells that are cut off contain literature citations, so some are
very long (hundreds of characters). Is there a solution to this
problem?
This shape file is being imported into Geoserver so I am some what
limited as to the formats that I can use.

Any advice?

Thanks in advance,
Michael


-- 
Michael Denslow

I.W. Carpenter Jr. Herbarium [BOON]
Department of Biology
Appalachian State University
Boone, North Carolina U.S.A.
-- AND --
Communications Manager
Southeast Regional Network of Expertise and Collections
sernec.org

36.214177, -81.681480 +/- 3103 meters

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch 
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Thu Mar 18 20:27:39 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Mar 2010 20:27:39 +0100 (CET)
Subject: [R-sig-Geo] to many characters in .dbf file?
In-Reply-To: <b440a3f81003181212k4435f363rc459527bf9d68494@mail.gmail.com>
References: <b440a3f81003181212k4435f363rc459527bf9d68494@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1003182024490.19560@reclus.nhh.no>

On Thu, 18 Mar 2010, Michael Denslow wrote:

> Dear r-sig-geo,
>
> I am in a bit of a bind. I am trying to write a shape file using 
> writeOGR() in rgdal. I just realized that I may have too many characters 
> in the cells as they are getting cut off when the shape file is created. 
> The cells are unchanged in the SpatialPointsDataFrame. But when I 
> inspect the .dbf they are all truncated. The cells that are cut off 
> contain literature citations, so some are very long (hundreds of 
> characters). Is there a solution to this problem? This shape file is 
> being imported into Geoserver so I am some what limited as to the 
> formats that I can use.

The OGR driver truncates (I think to 254 characters), so use 
writeSpatialShape() in maptools instead, passing your large number through 
the max_nchar= argument. Please read the details in ?write.dbf - field 
widths above 254 are not portable.

Roger

>
> Any advice?
>
> Thanks in advance,
> Michael
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Thu Mar 18 20:40:57 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Mar 2010 20:40:57 +0100 (CET)
Subject: [R-sig-Geo] writeOGR issue in dbf
In-Reply-To: <dc22b2571003181003y4e61dc8bx467e3e4ecdc1712@mail.gmail.com>
References: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
	<alpine.LRH.2.00.1003181714030.15553@reclus.nhh.no>
	<dc22b2571003180929g1c77c65ah1e0f1098c91144ad@mail.gmail.com>
	<4BA21F36.DA06.00D2.1@gw.dec.state.ny.us>
	<dc22b2571003181003y4e61dc8bx467e3e4ecdc1712@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1003182027530.19560@reclus.nhh.no>

On Thu, 18 Mar 2010, Robert J. Hijmans wrote:

> I believe that this is part of the DBF specification (there is also a
> limit on the number of characters in a variable name. 12?). This was
> largely ignored by ArcView (and the versions of excel that write dbf
> files), but apparently not by ArcGIS (apart from the missing warning
> message, that is probably a good thing). Perhaps a future version of
> readOGR could check for and fix variable names that are not DBF
> compliant when writing shp files?

Since OGR uses drivers, incorporating lots of driver-specific fixes is not 
a practical solution, as many others accept field names that DBF chokes 
on. If I get a well-tested patch in R for writeOGR() with no side-effects, 
I might consider it. There is C code in foreign/src/Rdbfwrite.c, but I 
think that it will permit a leading underscore - it crops to 11 characters 
plus a closing \0. The only driver-specific check in writeOGR() now is to 
to warn when KML files not in geographical coordinates are written.

Roger

> Robert
>
> On Thu, Mar 18, 2010 at 9:40 AM, Wayne Richter
> <wxrichte at gw.dec.state.ny.us> wrote:
>> This should indeed be the problem. From the Help: "Field names must start with a letter. Field names must contain only letters, numbers, and underscores." Unfortunately, ESRI software can behave in a cryptic, inconsistent or unhelpful way when it encounters a field name that it doesn't like. A hidden trailing space can really mess you up.
>>
>>
>>
>> Wayne Richter
>> New York State Department of Environmental Conservation
>> 625 Broadway
>> Albany, New York 12233-4756
>> 518-402-8974
>>
>>>>>
>> From: ? "Robert J. Hijmans" <r.hijmans at gmail.com>
>> To: ? ? caspar hallmann <caspar.hallmann at gmail.com>
>> CC: ? ? r-sig-geo <r-sig-geo at stat.math.ethz.ch>
>> Date: ? 3/18/2010 12:30 PM
>> Subject: ? ? ? ?Re: [R-sig-Geo] writeOGR issue in dbf
>>
>> I think the problem is an illegal variable name ?"dist.m"
>>
>> This works for me:
>>
>> data(meuse)
>> coordinates(meuse)=~x+y
>> names(meuse)[12] = 'distm'
>> writeOGR(meuse,".","test",driver="ESRI Shapefile")
>>
>> Robert
>>
>> On Thu, Mar 18, 2010 at 9:26 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> On Thu, 18 Mar 2010, caspar hallmann wrote:
>>>
>>>> Dear list,
>>>>
>>>> I am using writeOGR to create an ESRI shapefile from a
>>>> SpatialPointsDataFrame. When opening the shapefile in ArcMap and ask
>>>> for the attributes, I get an error "A column was specified that does
>>>> not exist".
>>>
>>> I only have other tools using OGR (GRASS, QGIS) and Excel 2003 SP3 on
>>> Windows XP. Your example cannot be reproduced using those. I suspect from
>>> trying to interpret the entrails of ESRI "help", that an integer column is
>>> required reproducing the FID values already encoded in the *.shp. Try:
>>>
>>> meuse$FIDs <- 1:nrow(meuse)
>>>
>>> and write out again. This doesn't match your simple copying to get it to
>>> read, though. If others could comment who have access to Arc (which
>>> version), that would be useful. Please include a copy of the messages
>>> displayed when rgdal is loaded, so that we have control of the versions.
>>>
>>> Does changing locale make a difference?
>>>
>>> Roger
>>>
>>>> Similarly, when opening the dbf of the shapefile in Paradox I get
>>>> "Unable to open table. Corrupt table/index header".
>>>> This does not only happen to my own Dataset but also the meuse data.
>>>>
>>>> data(meuse)
>>>> coordinates(meuse)=~x+y
>>>> class(meuse)
>>>> writeOGR(meuse,".","test",driver="ESRI Shapefile")
>>>> # then try ArcMap or Paradox fails as mentioned above.
>>>> #Strangely, when i do
>>>> write.dbf(read.dbf("test.dbf"),file="test2")
>>>> #then renaming test2 into test, my attribute tables open up fine, and
>>>> Paradox stops complaining.
>>>>
>>>> any clues?
>>>>
>>>> Caspar.
>>>>
>>>>> sessionInfo()
>>>>
>>>> R version 2.10.1 (2009-12-14)
>>>> i386-pc-mingw32
>>>>
>>>> locale:
>>>> [1] LC_COLLATE=Dutch_Netherlands.1252 ?LC_CTYPE=Dutch_Netherlands.1252
>>>> ?LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
>>>> [5] LC_TIME=Dutch_Netherlands.1252
>>>>
>>>> attached base packages:
>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>
>>>> other attached packages:
>>>> [1] pscl_1.03.3 ? ? ? ?coda_0.13-4 ? ? ? ?mvtnorm_0.9-9
>>>> automap_1.0-5 ? ? ?MASS_7.3-5 ? ? ? ? lme4_0.999375-32
>>>> Matrix_0.999375-33 maptools_0.7-29
>>>> [9] lattice_0.18-3 ? ? foreign_0.8-39 ? ? raster_0.9.9-24
>>>> rgdal_0.6-24 ? ? ? gstat_0.9-66 ? ? ? sp_0.9-57
>>>>
>>>> loaded via a namespace (and not attached):
>>>> [1] grid_2.10.1 ?tools_2.10.1
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From edzer.pebesma at uni-muenster.de  Thu Mar 18 21:45:00 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 18 Mar 2010 21:45:00 +0100
Subject: [R-sig-Geo] Back-transforming krigged variables
In-Reply-To: <b0a6ce471003180431h464ff0e0h8306269d15659462@mail.gmail.com>
References: <b0a6ce471003010123v3eaa92feqa60b944e08c34877@mail.gmail.com>	
	<4B8BB26F.6020603@uni-muenster.de>
	<b0a6ce471003180431h464ff0e0h8306269d15659462@mail.gmail.com>
Message-ID: <4BA290CC.3010004@uni-muenster.de>

What happens in kigeTg doesn't look that hard. Have you tried?

Ebrahim Jahanshiri wrote:
> Thank you very much.
> However I found no couterpart for that in cokriging. Is there any way to do
> that manually? I mean to get "m" manually?
> 
> On Mon, Mar 1, 2010 at 8:26 PM, Edzer Pebesma <edzer.pebesma at uni-muenster.de
>> wrote:
> 
>> Ebrahim Jahanshiri wrote:
>>
>>> I am wondering if there is any function or option to back-transform the
>>> result of the lognormal kriging in gstat yet.
>>>
>>>
>> You can use krigeTg, which does trans-Gaussian kriging for all Box-Cox
>> transforms; passing it a lambda parameter with value 0, log-normal kriging
>> is used. Pls look at the examples, the back-transformed values have funny
>> names like var1TG.pred.
>>
>> The whole think has been implemented for ordinary kriging only; if someone
>> can point me out a source that describes how to do this for universal /
>> external drift kriging, I'd be happy to look into how to implement it.
>>
>>> Although for simple kriging it is fairly straight forward, that is, it is
>>>
>>> possible to do back-transform using the vector of predicted values and
>>> kriging variances, but for ordinary kriging, it might be difficult because
>>> we dont have lagrange multiplier (according to my web help search) to do
>>> the
>>> back-transformation. I am wondering if there has been any advancement in
>>> that matter?
>>>
>>> thank you
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e
>> 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763
>> http://ifgi.uni-muenster.de http://www.52north.org/geostatistics
>> e.pebesma at wwu.de
>>
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Thu Mar 18 22:13:26 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 18 Mar 2010 22:13:26 +0100
Subject: [R-sig-Geo] Help: R-function to plot all CSGS realization
 variograms in single a plot
In-Reply-To: <4BA25646.8080407@cornell.edu>
References: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
	<4BA25646.8080407@cornell.edu>
Message-ID: <4BA29776.90505@uni-muenster.de>

Zia, time to find out about for-loops, and lists:

library(gstat)
data(meuse)
data(meuse.grid)
coordinates(meuse) = ~x + y
coordinates(meuse.grid) = ~x + y

# Variogram log Zn

lzn.vgm = variogram(log(zinc) ~ 1, meuse)
lzn.fit = fit.variogram(lzn.vgm, model = vgm(1, "Sph", 900, 1))

#Conditional simulation

nsim = 100
lzn.sim = krige(log(zinc) ~ 1, meuse, meuse.grid, model = lzn.fit,
    nmax = 30, nsim = nsim)

# Variogram of all realizations

m = out = list()
for (i in 1:nsim) {
    s = paste("sim", i, sep="")
    f = as.formula(paste(s, "~1"))
    v = variogram(f, lzn.sim)
    v$id = rep(s, nrow(v))
    out[[s]] = v
    m[[s]] = fit.variogram(v, lzn.fit)
}
plot(do.call(rbind, out), m, layout=c(10,10), skip = FALSE,
    scales = list(y = list(relation = "same")))


Zia Ahmed wrote:
> Hi,
> I am trying to plot 100 variograms from 100 CSGS realizations  in a
> single plot with the observed  variogram model. I used following codes
> to plot them  together. But problem is this code is: I have to create
> variogram for all realizations,  ie  100  times I  have to repeat this 
> code!
> This their  any  way  to run following codes with in a loop to create a
> plot of variograms of all realizations with observed variogram model.
> Help will  be appreciated. Thanks
> Zia
> 
> 
> library(gstat)
> data(meuse)
> data(meuse.grid)
> coordinates(meuse) = ~x + y
> coordinates(meuse.grid) = ~x + y
> 
> # Variogram log Zn
> 
> lzn.vgm = variogram(log(zinc) ~ 1, meuse)
> lzn.fit = fit.variogram(lzn.vgm, model = vgm(1, "Sph", 900, 1))
> 
> #Conditional simulation
> 
> lzn.sim = krige(log(zinc) ~ 1, meuse, meuse.grid, model = lzn.fit,
> nmax = 30, nsim = 100)
> 
> # Variogram of all relizations
> 
> var.sim1<-variogram(sim1~1, lzn.sim)    # Realization 1
> var.sim2<-variogram(sim2~1, lzn.sim)    # Realization 2
> var.sim3<-variogram(sim3~1, lzn.sim)    # Realization 3
> var.sim4<-variogram(sim4~1, lzn.sim)    # Realization 4
> .
> .
> .
> var.sim100<-variogram(sim100~1, lzn.sim)    # Realization 100
> 
> # Vriogram of observed data and all relaizations
> ##################################################
> 
> plot(lzn.vgm$gamma ~ lzn.vgm$dist, xlim = c(0, max(lzn.vgm$dist) * 1.05),
> ylim = c(0, max(lzn.vgm$gamma) * 1.2), pch = 21, col = "black",cex=.8,
> cex.axis = 0.85, cex.lab=.8, xlab =  "Distance (m)", ylab = "Semivariance")
> 
> lines(variogramLine(fit.variogram(lzn.vgm,  lzn.fit),  # Sim1
> maxdist = max(lzn.vgm$dist)), col = "red", lwd=2)
> 
> lines(variogramLine(fit.variogram(var.sim1, lzn.fit),  # sim2
> maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
> 
> lines(variogramLine(fit.variogram(var.sim2, lzn.fit), # Sim3
> maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
> 
> lines(variogramLine(fit.variogram(var.sim3, lzn.fit), # Sim4
> maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
> .
> .
> .
> .
> lines(variogramLine(fit.variogram(var.sim100, lzn.fit), # Sim100
> maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From zua3 at cornell.edu  Thu Mar 18 22:35:03 2010
From: zua3 at cornell.edu (Zia Ahmed)
Date: Thu, 18 Mar 2010 17:35:03 -0400
Subject: [R-sig-Geo] Help: R-function to plot all CSGS realization
 variograms in single a plot
In-Reply-To: <4BA29776.90505@uni-muenster.de>
References: <b552b8401003180838g23327775n88d264e53a3ae186@mail.gmail.com>
	<4BA25646.8080407@cornell.edu> <4BA29776.90505@uni-muenster.de>
Message-ID: <4BA29C87.3010102@cornell.edu>

Thank you so much! It works.
However, I want to plot them in one figure with observed variogram model 
.  Is it possible? I know it will be looked very clumsy!
Thanks again
Zia

Edzer Pebesma wrote:
> Zia, time to find out about for-loops, and lists:
>
> library(gstat)
> data(meuse)
> data(meuse.grid)
> coordinates(meuse) = ~x + y
> coordinates(meuse.grid) = ~x + y
>
> # Variogram log Zn
>
> lzn.vgm = variogram(log(zinc) ~ 1, meuse)
> lzn.fit = fit.variogram(lzn.vgm, model = vgm(1, "Sph", 900, 1))
>
> #Conditional simulation
>
> nsim = 100
> lzn.sim = krige(log(zinc) ~ 1, meuse, meuse.grid, model = lzn.fit,
>     nmax = 30, nsim = nsim)
>
> # Variogram of all realizations
>
> m = out = list()
> for (i in 1:nsim) {
>     s = paste("sim", i, sep="")
>     f = as.formula(paste(s, "~1"))
>     v = variogram(f, lzn.sim)
>     v$id = rep(s, nrow(v))
>     out[[s]] = v
>     m[[s]] = fit.variogram(v, lzn.fit)
> }
> plot(do.call(rbind, out), m, layout=c(10,10), skip = FALSE,
>     scales = list(y = list(relation = "same")))
>
>
> Zia Ahmed wrote:
>   
>> Hi,
>> I am trying to plot 100 variograms from 100 CSGS realizations  in a
>> single plot with the observed  variogram model. I used following codes
>> to plot them  together. But problem is this code is: I have to create
>> variogram for all realizations,  ie  100  times I  have to repeat this 
>> code!
>> This their  any  way  to run following codes with in a loop to create a
>> plot of variograms of all realizations with observed variogram model.
>> Help will  be appreciated. Thanks
>> Zia
>>
>>
>> library(gstat)
>> data(meuse)
>> data(meuse.grid)
>> coordinates(meuse) = ~x + y
>> coordinates(meuse.grid) = ~x + y
>>
>> # Variogram log Zn
>>
>> lzn.vgm = variogram(log(zinc) ~ 1, meuse)
>> lzn.fit = fit.variogram(lzn.vgm, model = vgm(1, "Sph", 900, 1))
>>
>> #Conditional simulation
>>
>> lzn.sim = krige(log(zinc) ~ 1, meuse, meuse.grid, model = lzn.fit,
>> nmax = 30, nsim = 100)
>>
>> # Variogram of all relizations
>>
>> var.sim1<-variogram(sim1~1, lzn.sim)    # Realization 1
>> var.sim2<-variogram(sim2~1, lzn.sim)    # Realization 2
>> var.sim3<-variogram(sim3~1, lzn.sim)    # Realization 3
>> var.sim4<-variogram(sim4~1, lzn.sim)    # Realization 4
>> .
>> .
>> .
>> var.sim100<-variogram(sim100~1, lzn.sim)    # Realization 100
>>
>> # Vriogram of observed data and all relaizations
>> ##################################################
>>
>> plot(lzn.vgm$gamma ~ lzn.vgm$dist, xlim = c(0, max(lzn.vgm$dist) * 1.05),
>> ylim = c(0, max(lzn.vgm$gamma) * 1.2), pch = 21, col = "black",cex=.8,
>> cex.axis = 0.85, cex.lab=.8, xlab =  "Distance (m)", ylab = "Semivariance")
>>
>> lines(variogramLine(fit.variogram(lzn.vgm,  lzn.fit),  # Sim1
>> maxdist = max(lzn.vgm$dist)), col = "red", lwd=2)
>>
>> lines(variogramLine(fit.variogram(var.sim1, lzn.fit),  # sim2
>> maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
>>
>> lines(variogramLine(fit.variogram(var.sim2, lzn.fit), # Sim3
>> maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
>>
>> lines(variogramLine(fit.variogram(var.sim3, lzn.fit), # Sim4
>> maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
>> .
>> .
>> .
>> .
>> lines(variogramLine(fit.variogram(var.sim100, lzn.fit), # Sim100
>> maxdist = max(lzn.vgm$dist)), col = "black", lty=1)
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>
>   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100318/5bde31d0/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100318/5bde31d0/attachment.vcf>

From rajkumar at mail.riaex.com  Thu Mar 18 23:16:28 2010
From: rajkumar at mail.riaex.com (rajkumar at mail.riaex.com)
Date: Thu, 18 Mar 2010 15:16:28 -0700 (PDT)
Subject: [R-sig-Geo] unionSpatialPolygons
Message-ID: <1807.76.204.17.117.1268950588.squirrel@www.riaex.com>

Hi,

I have a Raster and converted to Polygons  using pol<-rasterToPolygons(r2)
I have 1429 polygons and I would like to combine the attached polygon into
a bigger polygon. what should I do to create index to use
unionSpatialPolygons?

Thanks
Rajkumar


From michael.denslow at gmail.com  Fri Mar 19 02:34:38 2010
From: michael.denslow at gmail.com (Michael Denslow)
Date: Thu, 18 Mar 2010 21:34:38 -0400
Subject: [R-sig-Geo] to many characters in .dbf file?
In-Reply-To: <alpine.LRH.2.00.1003182024490.19560@reclus.nhh.no>
References: <b440a3f81003181212k4435f363rc459527bf9d68494@mail.gmail.com>
	<alpine.LRH.2.00.1003182024490.19560@reclus.nhh.no>
Message-ID: <b440a3f81003181834t4682e64bt9ac96d4f20c3e203@mail.gmail.com>

Hi Roger!

<SNIP>

>
> The OGR driver truncates (I think to 254 characters), so use
> writeSpatialShape() in maptools instead, passing your large number through
> the max_nchar= argument. Please read the details in ?write.dbf - field
> widths above 254 are not portable.

writeSpatialShape() worked for me. The file was read by Geoserver with
the extra text as well.

Thanks!
Michael



> Roger
>
>>
>> Any advice?
>>
>> Thanks in advance,
>> Michael
>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>



-- 
Michael Denslow

I.W. Carpenter Jr. Herbarium [BOON]
Department of Biology
Appalachian State University
Boone, North Carolina U.S.A.
-- AND --
Communications Manager
Southeast Regional Network of Expertise and Collections
sernec.org

36.214177, -81.681480 +/- 3103 meters


From e.jahanshiri at gmail.com  Fri Mar 19 05:39:32 2010
From: e.jahanshiri at gmail.com (Ebrahim Jahanshiri)
Date: Fri, 19 Mar 2010 12:39:32 +0800
Subject: [R-sig-Geo] Back-transforming krigged variables
In-Reply-To: <4BA290CC.3010004@uni-muenster.de>
References: <b0a6ce471003010123v3eaa92feqa60b944e08c34877@mail.gmail.com>
	<4B8BB26F.6020603@uni-muenster.de>
	<b0a6ce471003180431h464ff0e0h8306269d15659462@mail.gmail.com>
	<4BA290CC.3010004@uni-muenster.de>
Message-ID: <b0a6ce471003182139t5ca4e1eam3641e527fbbd1c04@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100319/bdc97a83/attachment.pl>

From Gindo.Tampubolon at manchester.ac.uk  Fri Mar 19 09:54:29 2010
From: Gindo.Tampubolon at manchester.ac.uk (Gindo Tampubolon)
Date: Fri, 19 Mar 2010 08:54:29 +0000
Subject: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
In-Reply-To: <alpine.LRH.2.00.1003182010530.19560@reclus.nhh.no>
References: <20100318135532183.00000005944@h-s-h000960>
	<alpine.LRH.2.00.1003181516150.15553@reclus.nhh.no>
	<20100318162944311.00000003440@h-s-h000960>
	<alpine.LRH.2.00.1003182010530.19560@reclus.nhh.no>
Message-ID: <20100319085429555.00000006020@h-s-h000960>

Thanks ever so much Roger.
Prompt and precise.

Gindo
-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: 18 March 2010 19:20
To: Gindo Tampubolon
Cc: r-sig-geo at stat.math.ethz.ch
Subject: RE: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file

On Thu, 18 Mar 2010, Gindo Tampubolon wrote:

> Dear Roger and all,
>
> Sorry for not putting a sample. Yes, Windows seems to be overloaded.
> http://sites.google.com/site/tehtareknow/home/spatial-weight-matrix/

The *.swm file is a binary file in an unknown format. The DBF file can be
read as follows:

library(foreign)
x <- read.dbf("spatialweightmatrix3.dbf")
from_IDs <- sort(unique(x$FID2))
to_IDs <- sort(unique(x$NID))
# find the IDs used
all.equal(from_IDs, to_IDs)
o <- order(x$FID2, x$NID)
# order the object
xx <- x[o,]
# convert manually to a spatial.neighbours representation
sn <- data.frame(from=match(xx$FID2, from_IDs), to=match(xx$NID+1,
   to_IDs), weihts=xx$WEIGHT)
attr(sn, "n") <- length(from_IDs)
attr(sn, "region.id") <- as.character(from_IDs)
class(sn) <- c("spatial.neighbour", class(sn))
library(spdep)
lw <- sn2listw(sn)
lw
summary(sapply(lw$weights, sum))
table(card(lw$neighbours))

There are only 1331 observations, so unconnected ones appear to be
dropped, and are probably the "holes" in attr(lw, "region.id") which
should span 0:1356, but is missing 25 values. The FID2 are probably the
FID of the polygon objects.

Hope this helps,

Roger


>
> Thanks for the tip and any more help much appreciated,
> Gindo
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: 18 March 2010 14:23
> To: Gindo Tampubolon
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
>
> On Thu, 18 Mar 2010, Gindo Tampubolon wrote:
>
>> Dear all,
>>
>> Can anyone tell me how to read ArcGIS 9.3 generated .swm file [spatial
>> weight matrix] into R?
>
> Well, make a number of small samples available on a website - most people
> do not have access to Arc, so helping is hard. Is there an ESRI site with
> shapefiles and matching sample *.swm files?
>
>>
>> I am stumped at page 242 of the ASDAR book [Bivand et al 2008]. I use a
>> SpatialPolygonsDataFrame object and tried to generate neighbours list
>> using poly2nb(). It took more than 24 hours [European data NUTS level 3
>> about 1500 regions]. After finishing, the result is a null set.
>>
>
> Always try a subset first. Most likely you need the snap= argument, if the
> boundaries do not touch but are close to each other. Almost certainly your
> input map also had far too much detail in shorelines and river borders,
> leading to your machine getting overloaded (Windows?). Displaying on such
> a map would also be dominated by line detail.
>
>> So I generate a rook weight matrix in ArcGIS 9.3 [and convert it to a
>> table there]. How do I import this matrix to R?
>
> Contribute by making sample files available. To read a matrix if you must,
> use read.table().
>
> Roger
>
>>
>>
>> I looked at RArcInfo and rgdal packages but could not find anything
>> obvious; I'm experimenting with read.gwt2nb() but ArcGIS created swm
>> based on numeric ID instead of NUTS_CODE alphanumeric; needs tweaking
>> perhaps.
>>
>> Many thanks
>>
>> Gindo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From axel.hille at gmx.net  Fri Mar 19 10:02:28 2010
From: axel.hille at gmx.net (Axel Hille)
Date: Fri, 19 Mar 2010 10:02:28 +0100
Subject: [R-sig-Geo] raster grid does not fit to SpatialLines and -lPolygons
 plotted overlays
Message-ID: <20100319090228.290730@gmx.net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100319/4f53819a/attachment.pl>

From Roger.Bivand at nhh.no  Fri Mar 19 11:13:34 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 19 Mar 2010 11:13:34 +0100 (CET)
Subject: [R-sig-Geo] unionSpatialPolygons
In-Reply-To: <1807.76.204.17.117.1268950588.squirrel@www.riaex.com>
References: <1807.76.204.17.117.1268950588.squirrel@www.riaex.com>
Message-ID: <alpine.LRH.2.00.1003191101230.24170@reclus.nhh.no>

On Thu, 18 Mar 2010, rajkumar at mail.riaex.com wrote:

> Hi,
>
> I have a Raster and converted to Polygons  using pol<-rasterToPolygons(r2)
> I have 1429 polygons and I would like to combine the attached polygon into
> a bigger polygon. what should I do to create index to use
> unionSpatialPolygons?

Create a vector (should be a factor) with the output unit IDs, as in ?by 
(INDICES=) or ?aggregate (by=) in base R. unionSpatialPolygons() only 
takes a single vector, so the extension to list arguments doesn't work (if 
anyone needs it, use interaction() to create a single factor from more 
than one). In your case either subset the polygons you wish to dissolve, 
create the ID variable, dissolve, then add back to the dataset, or run the 
operation on the whole data set, where union is a no-op for singleton IDs 
(it only runs for ID counts > 1). Play with by() first to see how the 
index works.

Roger

PS. An affiliation seems appropriate - is this for education, research, 
what?

>
> Thanks
> Rajkumar
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Fri Mar 19 11:43:16 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 19 Mar 2010 11:43:16 +0100 (CET)
Subject: [R-sig-Geo] raster grid does not fit to SpatialLines and
 -lPolygons plotted overlays
In-Reply-To: <20100319090228.290730@gmx.net>
References: <20100319090228.290730@gmx.net>
Message-ID: <alpine.LRH.2.00.1003191126090.24170@reclus.nhh.no>

On Fri, 19 Mar 2010, Axel Hille wrote:

> Dear OSGEO list members,
>
> I try it again hoping that someone could give me some hint.
> I have the problem that a raster grid does not fit to two additional
> spatial objects in the coordinate space of the plot, when plotted as
> overlay.
> I presume I need to recenter the raster grid but don`t know how? Any help
> is welcome.

Don't presume, it is usually misleading.

You have not motivated this or your previous question, and are writing 
from a German free email provider, so we have no idea whether this is 
homework or what. Remember that a concise motivation and an informative 
affiliation assist helpers in perceiving "where you are coming from". The 
reason for no reply to your earlier question was most likely that you are 
not clear enough (or concise enough - most of the printout you included 
was irrelevant and obscures the issue).

Most likely the coordinate reference systems of the data differ, but I 
don't know if you know what a coordinate reference system is - a graduate 
geography student would, and wouldn't ask this question.

Your workflow (point data to Geneland, grid interpolation in a "haplo" of 
unknown provenance, Arc ASCII grid read in) leaves lots of possibilities 
for the raster to get out of register with respect to the (assumed) UTM32 
points. Do you know definitely that the boundary polygons and rivers are 
also in UTM32? They are declared as such, but are the declarations 
correct? Do the input points plot correctly (are they in UTM32?)? Have you 
exported the input points/rivers/boundaries to KML to double-check in GE?

Try interpolating with some other tool and see whether the same problem 
occurs, or whether it is created in Geneland/haplo.

Hope this helps,

Roger

> Cheers
> Axel Hille
>
> Infos to problem:
> First, I exported the "Geneland" (R-package) output
> file (population assignments, georeferenced ) , where the coordinates of
> the individual samples are given in meters in the UTM-32N projection
> (Middle Europe)
> R-2.10.1-code:
> < head(mat.neu)
> <??? UTM.32E UTM.32N
> < 1 555799.2 5538765
> < 2 555825.5 5538792
>
> by means of the function "haplo" by Cristoph Heibl as an ARCView ascii
> raster grid
>
> R-2.10.1 "file.show":
> < gncols 100
> < nrows 100
> < xllcorner -276050.539270941
> < yllcorner 4802126.61354771
> < cellsize 14070.0737708024
> < NODATA_value -9999
> < 0.3275 0.3225 0.315 0.325 ..........
>
> With readAsciGrid of "maptools" I read in the file,
>
> R-2.10.1-code:
> < (file1 <-? paste(MCMC.PATH.TRANS3,"trans3.map.arcgis1",sep=""))
> < x.grid <- readAsciiGrid(file1, as.image=FALSE, proj4string=
> CRS("+init=epsg:32632"))
> < summary(x.grid)
> < Object of class SpatialGridDataFrame
> < Coordinates:
> <???????????????? min???? max
> < coords.x1 -276050.5 1130957
> < coords.x2 4802126.6 6209134
> < Is projected: TRUE
> < proj4string :
> < [+init=epsg:32632 +proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m
> +no_defs +towgs84=0,0,0]
> < Number of points: 2
> < Grid attributes:
> <?? cellcentre.offset cellsize cells.dim
> < 1???????? -269015.5 14070.07?????? 100
> < 2???????? 4809161.7 14070.07?????? 100
> < Data attributes:
> <??? Min. 1st Qu.? Median??? Mean 3rd Qu.??? Max.
> <? 0.0000? 0.3187? 0.3325? 0.3427? 0.3463? 1.0000
>
> Then I wanted to plot it and add two additional Spatial objects, a
> SpatialPolygonsDataFrame (European map in the same projection)
> and a SpatialLine object (rivers),
>
> R-2.10.1-code:
> str(eur.SPpdf2, max.level=2)
>> Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots
>> ?? ..@ data?????? :'data.frame': 66 obs. of? 20 variables:
>> ?? .. ..- attr(*, "data_types")= chr [1:20] "C" "C" "C" "C" ...
>> ?? ..@ polygons?? :List of 66
>> ?? ..@ plotOrder? : int [1:66] 12 47 44 59 38 33 11 34 1 5 ...
>> ?? ..@ bbox?????? : num [1:2, 1:2] -1112905 4041472 1351429
> 6597694
>> ?? .. ..- attr(*, "dimnames")=List of 2
>> ?? ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>
> R-2.10.1-code:
> summary(eur.SPpdf2)
>> Object of class SpatialPolygonsDataFrame
>> Coordinates:
>> ??????? min???? max
>> x -1112905 1351429
>> y? 4041472 6597694
>> Is projected: TRUE
>> proj4string :
>> [+init=epsg:32632 +proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m
> +no_defs +towgs84=0,0,0]
>> Data attributes:???? LAYER??? FIPS_ADMIN GMI_ADMIN .......
>
> R-2.10.1-code:
> eur.river.SPldf2 <- spTransform(eur.river.SPldf,
> CRS("+init=epsg:32632"))?? # UTM32N
> bb.river <- eur.river.SPldf2 at bbox
> bb.river
>> ????????? min?????? max
>> r1? 298399.7? 849034.5
>> r2 5265325.5 5749782.6
> ?
> The plot is ok for the vector shapes, but the raster does not align within
> the coordinate space.
> As I'm not so familiar with the information given for the raster file I#m
> asking the rgeo users
> what to do to place the raster correctly within the plot.
> Raster infos:
> object.size(x.grid)
>> [1] 82916
> object.size(slot(x.grid, "grid"))
>> [1] 556
> object.size(slot(x.grid, "grid.index"))
>> [1] 24
> object.size(slot(x.grid, "coords"))
>> [1] 344
>
> object.size(slot(x.grid, "bbox"))
>> [1] 440
> ?
> The plot is ok for the vector shapes, but the raster does not align within
> the coordinate space.
> As I'm not so familiar with the information given for the raster file I#m
> asking the rgeo users
> what to do to place the raster correctly within the plot.
> Raster infos:
> object.size(x.grid)
>> [1] 82916
> object.size(slot(x.grid, "grid"))
>> [1] 556
> object.size(slot(x.grid, "grid.index"))
>> [1] 24
> object.size(slot(x.grid, "coords"))
>> [1] 344
>
> object.size(slot(x.grid, "bbox"))
>> [1] 440
>
> x.grid at bbox
>> ???????????????? min???? max
>> coords.x1 -276050.5 1130957
>> coords.x2 4802126.6 6209134
>> x.grid at bbox["coords.x1", ]
>> ?????? min?????? max
>> -276050.5 1130956.8
>
>> print(slot(slot(x.grid, "grid"), "cellsize"), digits=20)
> [1] 14070.0737708024 14070.0737708024
>
>> print(slot(slot(x.grid, "grid"), "cellcentre.offset"), digits=20)
> [1] -269015.50238554 4809161.65043311
>
>> print(slot(slot(x.grid, "grid"), "cells.dim"), digits=20)
> [1] 100 100
>>
>
>        x.grid at bbox["coords.x1", ]
>> ?????? min?????? max
>> -276050.5 1130956.8
>
>> print(slot(slot(x.grid, "grid"), "cellsize"), digits=20)
> [1] 14070.0737708024 14070.0737708024
>
>> print(slot(slot(x.grid, "grid"), "cellcentre.offset"), digits=20)
> [1] -269015.50238554 4809161.65043311
>
>> print(slot(slot(x.grid, "grid"), "cells.dim"), digits=20)
> [1] 100 100
>>
> -- GMX DSL: Internet, Telefon und Entertainment f?r nur 19,99 EUR/mtl.!
>        http://portal.gmx.net/de/go/dsl02
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From anaumov at gmail.com  Fri Mar 19 15:45:32 2010
From: anaumov at gmail.com (Aleksey Naumov)
Date: Fri, 19 Mar 2010 10:45:32 -0400
Subject: [R-sig-Geo] Changing color ramp in spplot()
Message-ID: <1fc68841003190745s6366fd5bpd1be20c8e31ed3aa@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100319/4e6af2da/attachment.pl>

From edzer.pebesma at uni-muenster.de  Fri Mar 19 16:04:22 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 19 Mar 2010 16:04:22 +0100
Subject: [R-sig-Geo] Changing color ramp in spplot()
In-Reply-To: <1fc68841003190745s6366fd5bpd1be20c8e31ed3aa@mail.gmail.com>
References: <1fc68841003190745s6366fd5bpd1be20c8e31ed3aa@mail.gmail.com>
Message-ID: <4BA39276.1080908@uni-muenster.de>

Aleksey,

It seems you missed the documentation of ?spplot, or misunderstood. It
describes a col.regions argument, which accepts a color ramp.

spplot is a relatively thin wrapper around the functions xyplot (for
points or lines) or levelplot (for areas) in package lattice. If you
want to do all kind of fancy things, you might want to have a look at
their documentation.

Best regards,

Aleksey Naumov wrote:
> Dear R experts,
> 
> I am new to using the "sp" package and I am wondering how does one change
> color palette in spplot()? The problem is that when I do:
>> library(sp)
>> data(meuse)
>> coordinates(meuse) = c("x","y")
>> spplot(meuse, "zinc")
> 
> the middle class (zinc concentrations (803.4, 1149]) is plotted in white and
> is therefore not visible on the graph. I guess this is due to the default
> cyan-magenta color palette used in "lattice". I tried changing the colors
> via (a) manipulating the lattice settings, and (b) arguments to spplot, but
> could not get it to work. How does one go about changing the default color
> ramp?
> 
> I also tried using the "panel" argument to extend the default
> panel.pointsplot panel function used here, to make sure that all points are
> visible (perhaps, as open circles, which are then filled in by
> panel.pointsplot), but could not figure out how to do it right.
> 
> Would appreciate any ideas.
> 
> Thank you,
> Aleksey
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From anaumov at gmail.com  Fri Mar 19 17:38:53 2010
From: anaumov at gmail.com (Aleksey Naumov)
Date: Fri, 19 Mar 2010 12:38:53 -0400
Subject: [R-sig-Geo] Changing color ramp in spplot()
In-Reply-To: <4BA39276.1080908@uni-muenster.de>
References: <1fc68841003190745s6366fd5bpd1be20c8e31ed3aa@mail.gmail.com>
	<4BA39276.1080908@uni-muenster.de>
Message-ID: <1fc68841003190938p617fce43re858bfb7659b5149@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100319/a77fbfaf/attachment.pl>

From muhammad.rahiz at ouce.ox.ac.uk  Fri Mar 19 18:18:57 2010
From: muhammad.rahiz at ouce.ox.ac.uk (Muhammad Rahiz)
Date: Fri, 19 Mar 2010 17:18:57 +0000
Subject: [R-sig-Geo] AsciiGrid - draw boundary
Message-ID: <4BA3B201.7060802@ouce.ox.ac.uk>

Dear all,

I'm working with data in the form of an ascii grid (British Ordnance 
survey grid). I've plotted the data using image.plot with success and 
would like to draw a boundary around the region so that values which are 
zero and the white plotting region can be easily distinguished.

Has anyone any experience with this? Appreciate some guidance...

Thanks       

Muhammad


From zua3 at cornell.edu  Fri Mar 19 19:23:31 2010
From: zua3 at cornell.edu (Zia Ahmed)
Date: Fri, 19 Mar 2010 14:23:31 -0400
Subject: [R-sig-Geo] How do I calculate the proportion of simulated values
 exceeding a particular thresh values?
In-Reply-To: <4BA3B201.7060802@ouce.ox.ac.uk>
References: <4BA3B201.7060802@ouce.ox.ac.uk>
Message-ID: <4BA3C123.4010603@cornell.edu>

Hi all,

After CSGS realization, I like to calculate  proportion of simulated 
values exceeding a particular thresh values.(Suppose in a prediction 
grid,  out of ten realizations,   in five realizations- simulated value 
exceed  a target threshold value,  here proportion is 0.5). I want  all 
calculate this proportion in all by prediction grid. If some help me 
write the code - it will help me a lot. Here meuse data example:
Thanks


library(gstat)
data(meuse)
data(meuse.grid)
coordinates(meuse) = ~x + y
coordinates(meuse.grid) = ~x + y

# Variogram log Zn

lzn.vgm = variogram(log(zinc) ~ 1, meuse)
lzn.fit = fit.variogram(lzn.vgm, model = vgm(1, "Sph", 900, 1))

#Conditional simulation

nsim = 10
lzn.sim = krige(log(zinc) ~ 1, meuse, meuse.grid, model = lzn.fit, nmax 
= 30, nsim = nsim)

# target values.
###########
target.zn <- log(100)




-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100319/f201c892/attachment.vcf>

From edzer.pebesma at uni-muenster.de  Fri Mar 19 19:38:48 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 19 Mar 2010 19:38:48 +0100
Subject: [R-sig-Geo] Changing color ramp in spplot()
In-Reply-To: <1fc68841003190938p617fce43re858bfb7659b5149@mail.gmail.com>
References: <1fc68841003190745s6366fd5bpd1be20c8e31ed3aa@mail.gmail.com>	
	<4BA39276.1080908@uni-muenster.de>
	<1fc68841003190938p617fce43re858bfb7659b5149@mail.gmail.com>
Message-ID: <4BA3C4B8.1080800@uni-muenster.de>

Aleksey Naumov wrote:
> Edzer,
> 
> Thank you for your help. I did overlook col.regions argument in spplot.
> However, in trying to trace down the exact meaning of this argument, I could
> not find it in either xyplot() or it's panel function panel.xyplot(), which,
> as you indicated, would be used in this case (since we are plotting points).
> Instead, I found col.regions in panel.levelplot; so is panel.levelplot()
> used in this case, even though we are not plotting areas?

no, for points spplot maps its col.regions argument to a col argument it
passes on to xyplot. Also, it has its own panel function, you see it by

sp:::panel.pointsplot

> 
> The following syntax works for me:
>> spplot(meuse, "zinc", col.regions=colorRampPalette(c('blue', 'gray80',
> 'red'))(5))
> 
> but it requires that I specify the number of colors explicitly (5 in this
> case). Is there a way to specify just a palette function, and the number of
> colors would be figured out automatically by lattice? Simply providing the
> palette function like colorRampPalette or cm.colors does not work:
>> spplot(meuse, "zinc", cuts=7, col.regions=cm.colors)
> Error in col.regions[cols] : object of type 'closure' is not subsettable

no, you need to pass colors, not a color palette generating function.

> 
> Thank you,
> Aleksey
> 
> 
> 
> On Fri, Mar 19, 2010 at 11:04 AM, Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
> 
>> Aleksey,
>>
>> It seems you missed the documentation of ?spplot, or misunderstood. It
>> describes a col.regions argument, which accepts a color ramp.
>>
>> spplot is a relatively thin wrapper around the functions xyplot (for
>> points or lines) or levelplot (for areas) in package lattice. If you
>> want to do all kind of fancy things, you might want to have a look at
>> their documentation.
>>
>> Best regards,
>>
>> Aleksey Naumov wrote:
>>> Dear R experts,
>>>
>>> I am new to using the "sp" package and I am wondering how does one change
>>> color palette in spplot()? The problem is that when I do:
>>>> library(sp)
>>>> data(meuse)
>>>> coordinates(meuse) = c("x","y")
>>>> spplot(meuse, "zinc")
>>> the middle class (zinc concentrations (803.4, 1149]) is plotted in white
>> and
>>> is therefore not visible on the graph. I guess this is due to the default
>>> cyan-magenta color palette used in "lattice". I tried changing the colors
>>> via (a) manipulating the lattice settings, and (b) arguments to spplot,
>> but
>>> could not get it to work. How does one go about changing the default
>> color
>>> ramp?
>>>
>>> I also tried using the "panel" argument to extend the default
>>> panel.pointsplot panel function used here, to make sure that all points
>> are
>>> visible (perhaps, as open circles, which are then filled in by
>>> panel.pointsplot), but could not figure out how to do it right.
>>>
>>> Would appreciate any ideas.
>>>
>>> Thank you,
>>> Aleksey
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From iuri at proxima.adm.br  Fri Mar 19 19:52:31 2010
From: iuri at proxima.adm.br (Iuri Gavronski)
Date: Fri, 19 Mar 2010 15:52:31 -0300
Subject: [R-sig-Geo] Changing color ramp in spplot()
In-Reply-To: <4BA3C4B8.1080800@uni-muenster.de>
References: <1fc68841003190745s6366fd5bpd1be20c8e31ed3aa@mail.gmail.com> 
	<4BA39276.1080908@uni-muenster.de>
	<1fc68841003190938p617fce43re858bfb7659b5149@mail.gmail.com> 
	<4BA3C4B8.1080800@uni-muenster.de>
Message-ID: <1daa4e8d1003191152l4a1a4dcbr733841e2a6cae365@mail.gmail.com>

>>> spplot(meuse, "zinc", cuts=7, col.regions=cm.colors)
>> Error in col.regions[cols] : object of type 'closure' is not subsettable
>
> no, you need to pass colors, not a color palette generating function.

Have you tried?
spplot(meuse, "zinc", cuts=7, col.regions=cm.colors())


From edzer.pebesma at uni-muenster.de  Fri Mar 19 20:31:00 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 19 Mar 2010 20:31:00 +0100
Subject: [R-sig-Geo] Changing color ramp in spplot()
In-Reply-To: <1daa4e8d1003191152l4a1a4dcbr733841e2a6cae365@mail.gmail.com>
References: <1fc68841003190745s6366fd5bpd1be20c8e31ed3aa@mail.gmail.com>
	<4BA39276.1080908@uni-muenster.de>
	<1fc68841003190938p617fce43re858bfb7659b5149@mail.gmail.com>
	<4BA3C4B8.1080800@uni-muenster.de>
	<1daa4e8d1003191152l4a1a4dcbr733841e2a6cae365@mail.gmail.com>
Message-ID: <4BA3D0F4.1030606@uni-muenster.de>

Iuri Gavronski wrote:
>>>> spplot(meuse, "zinc", cuts=7, col.regions=cm.colors)
>>> Error in col.regions[cols] : object of type 'closure' is not subsettable
>> no, you need to pass colors, not a color palette generating function.
> 
> Have you tried?
> spplot(meuse, "zinc", cuts=7, col.regions=cm.colors())

Have you tried:

cm.colors()

or

?cm.colors

?
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mark_connolly at acm.org  Fri Mar 19 22:38:06 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Fri, 19 Mar 2010 17:38:06 -0400
Subject: [R-sig-Geo] intamapInteractive and unmet spcosa dependency
Message-ID: <4BA3EEBE.2030703@acm.org>

My install.package is complaining that package ?spcosa? is not available 
when I attempt to install intamapInteractive (or spcosa, for that matter).

Any insight from anyone?


From edzer.pebesma at uni-muenster.de  Fri Mar 19 23:00:24 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 19 Mar 2010 23:00:24 +0100
Subject: [R-sig-Geo] intamapInteractive and unmet spcosa dependency
In-Reply-To: <4BA3EEBE.2030703@acm.org>
References: <4BA3EEBE.2030703@acm.org>
Message-ID: <4BA3F3F8.9080603@uni-muenster.de>

Are you working with the new 64-bits windows beta version, or mac-osx?
package rgdal does not compile there, and spcosa (and hence
intamapInteractive) depend on it.

The CRAN pages report "CRAN checks" worth checking in such cases, see
http://cran.r-project.org/package=spcosa

Another dependency that now keeps spcosa back on the win64 port will be
its dependency on rJava.

Mark Connolly wrote:
> My install.package is complaining that package ?spcosa? is not available
> when I attempt to install intamapInteractive (or spcosa, for that matter).
> 
> Any insight from anyone?
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mark_connolly at acm.org  Fri Mar 19 23:03:09 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Fri, 19 Mar 2010 18:03:09 -0400
Subject: [R-sig-Geo] intamapInteractive and unmet spcosa dependency
In-Reply-To: <4BA3F3F8.9080603@uni-muenster.de>
References: <4BA3EEBE.2030703@acm.org> <4BA3F3F8.9080603@uni-muenster.de>
Message-ID: <4BA3F49D.4040803@acm.org>

Linux 64 bit.  I thought I saw the package checks as good.  I'll look again.

On 03/19/2010 06:00 PM, Edzer Pebesma wrote:
> Are you working with the new 64-bits windows beta version, or mac-osx?
> package rgdal does not compile there, and spcosa (and hence
> intamapInteractive) depend on it.
>
> The CRAN pages report "CRAN checks" worth checking in such cases, see
> http://cran.r-project.org/package=spcosa
>
> Another dependency that now keeps spcosa back on the win64 port will be
> its dependency on rJava.
>
> Mark Connolly wrote:
>    
>> My install.package is complaining that package ?spcosa? is not available
>> when I attempt to install intamapInteractive (or spcosa, for that matter).
>>
>> Any insight from anyone?
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>      
>


From mark_connolly at acm.org  Fri Mar 19 23:17:14 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Fri, 19 Mar 2010 18:17:14 -0400
Subject: [R-sig-Geo] intamapInteractive and unmet spcosa dependency
In-Reply-To: <4BA3F3F8.9080603@uni-muenster.de>
References: <4BA3EEBE.2030703@acm.org> <4BA3F3F8.9080603@uni-muenster.de>
Message-ID: <4BA3F7EA.8060008@acm.org>

It does look as though the issue is rgdal.  For some reason, Cran 
package check is not showing any issue for gcc fedora 64.  Interesting.

I have gdal on my system.  Is the rgdal compile an impossibility?


On 03/19/2010 06:00 PM, Edzer Pebesma wrote:
> Are you working with the new 64-bits windows beta version, or mac-osx?
> package rgdal does not compile there, and spcosa (and hence
> intamapInteractive) depend on it.
>
> The CRAN pages report "CRAN checks" worth checking in such cases, see
> http://cran.r-project.org/package=spcosa
>
> Another dependency that now keeps spcosa back on the win64 port will be
> its dependency on rJava.
>
> Mark Connolly wrote:
>    
>> My install.package is complaining that package ?spcosa? is not available
>> when I attempt to install intamapInteractive (or spcosa, for that matter).
>>
>> Any insight from anyone?
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>      
>


From edzer.pebesma at uni-muenster.de  Fri Mar 19 23:24:34 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 19 Mar 2010 23:24:34 +0100
Subject: [R-sig-Geo] intamapInteractive and unmet spcosa dependency
In-Reply-To: <4BA3F7EA.8060008@acm.org>
References: <4BA3EEBE.2030703@acm.org> <4BA3F3F8.9080603@uni-muenster.de>
	<4BA3F7EA.8060008@acm.org>
Message-ID: <4BA3F9A2.4020104@uni-muenster.de>

Do you have the development libraries + header files installed as well
there? On debian/ubuntu the package is called libgdal1-dev

Mark Connolly wrote:
> It does look as though the issue is rgdal.  For some reason, Cran
> package check is not showing any issue for gcc fedora 64.  Interesting.
> 
> I have gdal on my system.  Is the rgdal compile an impossibility?
> 
> 
> On 03/19/2010 06:00 PM, Edzer Pebesma wrote:
>> Are you working with the new 64-bits windows beta version, or mac-osx?
>> package rgdal does not compile there, and spcosa (and hence
>> intamapInteractive) depend on it.
>>
>> The CRAN pages report "CRAN checks" worth checking in such cases, see
>> http://cran.r-project.org/package=spcosa
>>
>> Another dependency that now keeps spcosa back on the win64 port will be
>> its dependency on rJava.
>>
>> Mark Connolly wrote:
>>   
>>> My install.package is complaining that package ?spcosa? is not available
>>> when I attempt to install intamapInteractive (or spcosa, for that
>>> matter).
>>>
>>> Any insight from anyone?
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>      
>>    
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mark_connolly at acm.org  Fri Mar 19 23:29:53 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Fri, 19 Mar 2010 18:29:53 -0400
Subject: [R-sig-Geo] intamapInteractive and unmet spcosa dependency
In-Reply-To: <4BA3F9A2.4020104@uni-muenster.de>
References: <4BA3EEBE.2030703@acm.org> <4BA3F3F8.9080603@uni-muenster.de>
	<4BA3F7EA.8060008@acm.org> <4BA3F9A2.4020104@uni-muenster.de>
Message-ID: <4BA3FAE1.3050307@acm.org>

Yes.  I downloaded the rgdal source to install from the command line.  
Looks like I need to go to R 2.10 from 2.9 first.  I'll give it a shot.

Thanks

On 03/19/2010 06:24 PM, Edzer Pebesma wrote:
> Do you have the development libraries + header files installed as well
> there? On debian/ubuntu the package is called libgdal1-dev
>
> Mark Connolly wrote:
>    
>> It does look as though the issue is rgdal.  For some reason, Cran
>> package check is not showing any issue for gcc fedora 64.  Interesting.
>>
>> I have gdal on my system.  Is the rgdal compile an impossibility?
>>
>>
>> On 03/19/2010 06:00 PM, Edzer Pebesma wrote:
>>      
>>> Are you working with the new 64-bits windows beta version, or mac-osx?
>>> package rgdal does not compile there, and spcosa (and hence
>>> intamapInteractive) depend on it.
>>>
>>> The CRAN pages report "CRAN checks" worth checking in such cases, see
>>> http://cran.r-project.org/package=spcosa
>>>
>>> Another dependency that now keeps spcosa back on the win64 port will be
>>> its dependency on rJava.
>>>
>>> Mark Connolly wrote:
>>>
>>>        
>>>> My install.package is complaining that package ?spcosa? is not available
>>>> when I attempt to install intamapInteractive (or spcosa, for that
>>>> matter).
>>>>
>>>> Any insight from anyone?
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>          
>>>
>>>        
>>      
>


From edzer.pebesma at uni-muenster.de  Sat Mar 20 00:35:57 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 20 Mar 2010 00:35:57 +0100
Subject: [R-sig-Geo] intamapInteractive and unmet spcosa dependency
In-Reply-To: <4BA407EF.30006@acm.org>
References: <4BA3EEBE.2030703@acm.org> <4BA3F3F8.9080603@uni-muenster.de>
	<4BA3F7EA.8060008@acm.org> <4BA3F9A2.4020104@uni-muenster.de>
	<4BA407EF.30006@acm.org>
Message-ID: <4BA40A5D.30302@uni-muenster.de>



Mark Connolly wrote:
> Moving to the latest version of R did the trick.
> 
> The intamap suite looks very interesting.  I gave it a little exercise
> on the website interpolating with copulas.  Out of my ignorance, this
> seems to be a shift away from kriging?

Kriging as of linear kriging, yes; indicator and disjunctive kriging
however have long tried similar things that now copulas seem to cope
with much better. An nice feature is that dependency can be dependent on
where we are in the distribution; I believe however that the copulas
implemented in intamap (Gaussian, chi-sq) do not provide this.

I'm interested in hearing your experience!

> 
> 
> 
> On 03/19/2010 06:24 PM, Edzer Pebesma wrote:
>> Do you have the development libraries + header files installed as well
>> there? On debian/ubuntu the package is called libgdal1-dev
>>
>> Mark Connolly wrote:
>>   
>>> It does look as though the issue is rgdal.  For some reason, Cran
>>> package check is not showing any issue for gcc fedora 64.  Interesting.
>>>
>>> I have gdal on my system.  Is the rgdal compile an impossibility?
>>>
>>>
>>> On 03/19/2010 06:00 PM, Edzer Pebesma wrote:
>>>     
>>>> Are you working with the new 64-bits windows beta version, or mac-osx?
>>>> package rgdal does not compile there, and spcosa (and hence
>>>> intamapInteractive) depend on it.
>>>>
>>>> The CRAN pages report "CRAN checks" worth checking in such cases, see
>>>> http://cran.r-project.org/package=spcosa
>>>>
>>>> Another dependency that now keeps spcosa back on the win64 port will be
>>>> its dependency on rJava.
>>>>
>>>> Mark Connolly wrote:
>>>>
>>>>       
>>>>> My install.package is complaining that package ?spcosa? is not
>>>>> available
>>>>> when I attempt to install intamapInteractive (or spcosa, for that
>>>>> matter).
>>>>>
>>>>> Any insight from anyone?
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>          
>>>>
>>>>        
>>>      
>>    
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mark_connolly at acm.org  Sat Mar 20 00:25:35 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Fri, 19 Mar 2010 19:25:35 -0400
Subject: [R-sig-Geo] intamapInteractive and unmet spcosa dependency
In-Reply-To: <4BA3F9A2.4020104@uni-muenster.de>
References: <4BA3EEBE.2030703@acm.org> <4BA3F3F8.9080603@uni-muenster.de>
	<4BA3F7EA.8060008@acm.org> <4BA3F9A2.4020104@uni-muenster.de>
Message-ID: <4BA407EF.30006@acm.org>

Moving to the latest version of R did the trick.

The intamap suite looks very interesting.  I gave it a little exercise 
on the website interpolating with copulas.  Out of my ignorance, this 
seems to be a shift away from kriging?



On 03/19/2010 06:24 PM, Edzer Pebesma wrote:
> Do you have the development libraries + header files installed as well
> there? On debian/ubuntu the package is called libgdal1-dev
>
> Mark Connolly wrote:
>    
>> It does look as though the issue is rgdal.  For some reason, Cran
>> package check is not showing any issue for gcc fedora 64.  Interesting.
>>
>> I have gdal on my system.  Is the rgdal compile an impossibility?
>>
>>
>> On 03/19/2010 06:00 PM, Edzer Pebesma wrote:
>>      
>>> Are you working with the new 64-bits windows beta version, or mac-osx?
>>> package rgdal does not compile there, and spcosa (and hence
>>> intamapInteractive) depend on it.
>>>
>>> The CRAN pages report "CRAN checks" worth checking in such cases, see
>>> http://cran.r-project.org/package=spcosa
>>>
>>> Another dependency that now keeps spcosa back on the win64 port will be
>>> its dependency on rJava.
>>>
>>> Mark Connolly wrote:
>>>
>>>        
>>>> My install.package is complaining that package ?spcosa? is not available
>>>> when I attempt to install intamapInteractive (or spcosa, for that
>>>> matter).
>>>>
>>>> Any insight from anyone?
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>          
>>>
>>>        
>>      
>


From salmaaries at hotmail.com  Sat Mar 20 15:09:26 2010
From: salmaaries at hotmail.com (salma anwar)
Date: Sat, 20 Mar 2010 14:09:26 +0000
Subject: [R-sig-Geo] Plotting envelopes of a fitted Strauss Model
Message-ID: <SNT124-W15307D4A2725FD61158390D1290@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100320/8fde048f/attachment.pl>

From Adrian.Baddeley at csiro.au  Mon Mar 22 06:23:09 2010
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Mon, 22 Mar 2010 13:23:09 +0800
Subject: [R-sig-Geo] Plotting envelopes of a fitted Strauss Model
Message-ID: <57DC18C299094D4299F837570C5DF1C52B0F8FA8F3@EXWA-MBX01.nexus.csiro.au>

salma anwar <salmaaries at hotmail.com> writes:

> When I try to plot the envelopes of a fitted multitype Strauss model, I get an error message. 
> Can somebody please give clues about what could be the reason?
> Below is the code and the error message:
> plot (envelope (modelA, Kest, nsim=99, global=TRUE))
> Error in rmh.default(rmodel, rstart, rcontr, preponly = TRUE, verbose = FALSE) :
>  Expanded simulation window is not contained in several of the trend windows.
> Bailing out.

*short answer*: type
       plot (envelope (modelA, Kest, nsim=99, global=TRUE, control=list(expand=1,nrep=1e5))

*long answer*:

Which version of spatstat are you using? (The envelope command has been completely restructured in version 1.18-0 and 1.18-1).

You didn't provide the code that created the fitted model, 'modelA'. My guess is that 'modelA' involves covariates that were supplied as pixel images. 

When you run the envelope command on a fitted model (other than a Poisson model), the simulated patterns are generated using rmh(). The behaviour of rmh() is controlled by the arguments 'start' and 'control' (which are passed from envelope() to rmh()). If you look at help(envelope) it says that the default values are start=NULL and control=list(expand=1.5, nrep=1e5). The parameter 'nrep' controls the number of iterations of the Metropolis-Hastings algorithm. The parameter 'expand' determines the window in which simulated patterns are generated. By default, rmh generates simulated patterns on a window that is larger than the original data window, to reduce edge effects: this is called 'expansion'. 

If the model depends on covariates, then in order to simulate point patterns from the model, rmh() must know the values of the covariates in the window where the point process is to be simulated. The error message from rmh.default says that the (default) expanded simulation window is larger than the domain of the covariate images in modelA.

The simplest solution is to tell rmh not to expand the simulation window. You do this by setting 
 control=list(nrep=1e5, expand=1) which signifies no expansion (when 'expand' is a number, it is interpreted as the ratio of expanded area to original area, so a value of 1 means no expansion). 

Alternatively if you do have data giving the covariate values on a larger domain, you could use this data
For more information, see help(envelope), help(rmh.default) and help(rmhcontrol).

Adrian Baddeley

From gianni.lavaredo at gmail.com  Tue Mar 23 02:39:33 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 23 Mar 2010 02:39:33 +0100
Subject: [R-sig-Geo] create square buffer
Message-ID: <518dff331003221839l3e6498f2r62cd65888ecc4420@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100323/f1706914/attachment.pl>

From gianni.lavaredo at gmail.com  Tue Mar 23 03:51:03 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 23 Mar 2010 03:51:03 +0100
Subject: [R-sig-Geo] plot a ellispe in R
Message-ID: <518dff331003221951y10339b6au9521c4ae9ebb2a19@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100323/9a493fa3/attachment.pl>

From gianni.lavaredo at gmail.com  Tue Mar 23 05:27:42 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 23 Mar 2010 05:27:42 +0100
Subject: [R-sig-Geo] create a asymmetric ellipse
Message-ID: <518dff331003222127va3d1f77l3173bd8eb2b70ee9@mail.gmail.com>

Dear Researchers,

nobody know same fuction to draw an asymmetric ellipse as the fig starting
from a data.frame

cc <- data.frame(ID = 1, xx= 4256300, yy= 336235, N = 5.3, S= 2.1, W = 3.5,
E= 0.3)

or

cc <- data.frame(ID = 1, xx= 4256300, yy= 336235, y = 7.4, x=3.8)

where xx and yy are the coordiante of centre
thanks for help (i need)

Gianni
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100323/a8eae03d/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Senza titolo (1).jpg
Type: image/jpeg
Size: 8406 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100323/a8eae03d/attachment.jpg>

From alobolistas at gmail.com  Tue Mar 23 07:32:20 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 23 Mar 2010 07:32:20 +0100
Subject: [R-sig-Geo] rgdal: problem with grid data
Message-ID: <4BA86074.8010709@gmail.com>

Hi!

  I read a grid file into R with
isrlc <- 
readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri")

While isrlc seems correct,  I'm getting an empty shapefile when I attempt to write:

writeOGR(isrlc,dsn="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah", 
layer="ISR_cov2",driver="ESRI Shapefile")

Data from
http://www.diva-gis.org/data/cov/ISR_cov.zip

Thanks

Agus


From mdsumner at gmail.com  Tue Mar 23 07:49:35 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 23 Mar 2010 17:49:35 +1100
Subject: [R-sig-Geo] rgdal: problem with grid data
In-Reply-To: <4BA86074.8010709@gmail.com>
References: <4BA86074.8010709@gmail.com>
Message-ID: <522664f81003222349g39cc0c4ya756547d80c1d2f6@mail.gmail.com>

What are you expecting to get - a point for every raster cell?  If so,
use gridded(isrlc) <- FALSE to convert to a SPDF first - then the
write will work.

More complicated conversions are possible, such as with
as.SpatialPolygons.GridTopology.

Cheers, Mike.





On Tue, Mar 23, 2010 at 5:32 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
>
> ?I read a grid file into R with
> isrlc <-
> readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri")
>
> While isrlc seems correct, ?I'm getting an empty shapefile when I attempt to
> write:
>
> writeOGR(isrlc,dsn="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah",
> layer="ISR_cov2",driver="ESRI Shapefile")
>
> Data from
> http://www.diva-gis.org/data/cov/ISR_cov.zip
>
> Thanks
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mdsumner at gmail.com  Tue Mar 23 07:55:32 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 23 Mar 2010 17:55:32 +1100
Subject: [R-sig-Geo] rgdal: problem with grid data
In-Reply-To: <522664f81003222349g39cc0c4ya756547d80c1d2f6@mail.gmail.com>
References: <4BA86074.8010709@gmail.com>
	<522664f81003222349g39cc0c4ya756547d80c1d2f6@mail.gmail.com>
Message-ID: <522664f81003222355n2402acddk80d55103941e48fc@mail.gmail.com>

As a follow up, arguably writeOGR should either complain that it got a
raster, or perform the conversion to points automatically. I'm not
sure why writeOGR writes an empty shapefile in that case, but some
software cannot read them - so a warning at least would be helpful I
think. Roger?

Cheers, Mike.

On Tue, Mar 23, 2010 at 5:49 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> What are you expecting to get - a point for every raster cell? ?If so,
> use gridded(isrlc) <- FALSE to convert to a SPDF first - then the
> write will work.
>
> More complicated conversions are possible, such as with
> as.SpatialPolygons.GridTopology.
>
> Cheers, Mike.
>
>
>
>
>
> On Tue, Mar 23, 2010 at 5:32 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi!
>>
>> ?I read a grid file into R with
>> isrlc <-
>> readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri")
>>
>> While isrlc seems correct, ?I'm getting an empty shapefile when I attempt to
>> write:
>>
>> writeOGR(isrlc,dsn="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah",
>> layer="ISR_cov2",driver="ESRI Shapefile")
>>
>> Data from
>> http://www.diva-gis.org/data/cov/ISR_cov.zip
>>
>> Thanks
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From alobolistas at gmail.com  Tue Mar 23 08:01:48 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 23 Mar 2010 08:01:48 +0100
Subject: [R-sig-Geo] [Fwd: Re:  rgdal: problem with grid data]
Message-ID: <4BA8675C.2090705@gmail.com>



-------- Original Message --------
Subject: Re: [R-sig-Geo] rgdal: problem with grid data
Date: Tue, 23 Mar 2010 07:53:38 +0100
From: Agustin Lobo <aloboaleu at gmail.com>
Reply-To: Agustin.Lobo at ija.csic.es
To: Michael Sumner <mdsumner at gmail.com>
CC: sig-geo <r-sig-geo at stat.math.ethz.ch>
References: <4BA86074.8010709 at gmail.com> 
<522664f81003222349g39cc0c4ya756547d80c1d2f6 at mail.gmail.com>

ok, I see, I have to convert to Spatial Polygons data frame first, right?
Ideally, I should be able of clumping those cells with the same value,
so this is a bit more complicated than I expected. But should be possible.
I'll try and let the list know.
Thanks

Agus

Michael Sumner wrote:
> What are you expecting to get - a point for every raster cell?  If so,
> use gridded(isrlc) <- FALSE to convert to a SPDF first - then the
> write will work.
> 
> More complicated conversions are possible, such as with
> as.SpatialPolygons.GridTopology.
> 
> Cheers, Mike.
> 
> 
> 
> 
> 
> On Tue, Mar 23, 2010 at 5:32 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi!
>>
>>  I read a grid file into R with
>> isrlc <-
>> readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri")
>>
>> While isrlc seems correct,  I'm getting an empty shapefile when I attempt to
>> write:
>>
>> writeOGR(isrlc,dsn="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah",
>> layer="ISR_cov2",driver="ESRI Shapefile")
>>
>> Data from
>> http://www.diva-gis.org/data/cov/ISR_cov.zip
>>
>> Thanks
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster


From rpruner at ufl.edu  Tue Mar 23 16:37:03 2010
From: rpruner at ufl.edu (Raya A. Pruner)
Date: Tue, 23 Mar 2010 11:37:03 -0400 (EDT)
Subject: [R-sig-Geo] envelopes to inhomogeneous k-function based on fitted
 models: with spatstat
Message-ID: <1539989911.256261269358623602.JavaMail.osg@osgjas02.cns.ufl.edu>

I have created fitted models for an inhomogeneous point pattern 
using spatstat.  I have used the script below to do so.  I would 
like to create envelopes for the fitted K-function.  However, when 
using the envelope(), it doesn't seem to recognize the lamda 
parameter


##inhomogeneous functions based on top fit covariate model###
lam <- fitted(invert.cord.model, location=nestsF.ppp, 
dataonly=TRUE)
Ki <- Kinhom(nests.ppp, lam, correction="translate")
plot(Ki, sqrt(./pi) - r ~ r, xlab="r(meters)", main="Inhomogeneous 
L-Function- Controlling for Inverts")

g1 <- pcf(Ki, spar=0.9, method="b")
plot(g1, main="Inhomogeneous Pair Correlation Function: Inverts")


Thanks in advance!!
Raya

--
Raya A Pruner - Graduate Student
University of Florida
Department of Wildlife Ecology and Conservation
PO Box 110430
Gainesville, FL 32611-0430
352-214-3262


From b.rowlingson at lancaster.ac.uk  Tue Mar 23 18:47:18 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 23 Mar 2010 17:47:18 +0000
Subject: [R-sig-Geo] create a asymmetric ellipse
In-Reply-To: <518dff331003222127va3d1f77l3173bd8eb2b70ee9@mail.gmail.com>
References: <518dff331003222127va3d1f77l3173bd8eb2b70ee9@mail.gmail.com>
Message-ID: <d8ad40b51003231047i5883726ftd7e19fbbb09db675@mail.gmail.com>

On Tue, Mar 23, 2010 at 4:27 AM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> Dear Researchers,
>
> nobody know same fuction to draw an asymmetric ellipse as the fig starting
> from a data.frame
>
> cc <- data.frame(ID = 1, xx= 4256300, yy= 336235, N = 5.3, S= 2.1, W = 3.5,
> E= 0.3)
>
> or
>
> cc <- data.frame(ID = 1, xx= 4256300, yy= 336235, y = 7.4, x=3.8)
>
> where xx and yy are the coordiante of centre
> thanks for help (i need)

 This looks like a very strange shape - I'm not sure just saying
'asymmetric ellipse' is good enough.

 Are you after any smooth curve centred at (x,y) passing through
(x+W,y), (x,y+N), (x-E,y), (x,y-S)?

 Do you require the gradients of the curve to be 0 or infinite (ie the
tangent is horizontal or vertical) at those four points?

 How smooth (differentiable) do you want it to be? Could it just be
defined in polar coordinates as four elliptical parts?

 Do you want some kind of 'Oval'? Any of the ones mentioned here take
your fancy:

http://mathworld.wolfram.com/Oval.html

Barry


From marcelino.delacruz at upm.es  Tue Mar 23 18:53:12 2010
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Tue, 23 Mar 2010 18:53:12 +0100
Subject: [R-sig-Geo] envelopes to inhomogeneous k-function based on
 fitted models: with spatstat
In-Reply-To: <1539989911.256261269358623602.JavaMail.osg@osgjas02.cns.uf l.edu>
References: <1539989911.256261269358623602.JavaMail.osg@osgjas02.cns.ufl.edu>
Message-ID: <201003231753.o2NHr6lF015211@edison.ccupm.upm.es>


Hi Raya,


You should have provided the code that you tried 
and that "doesn't seem to recognize the lamda parameter".

Anyway, I think that the problem is that you have 
estimated the intensity at the data points only 
(your argument dataonly=TRUE). When computing the 
envelope of the Kinhom function, for each 
simulated pattern you will need an estimate of 
the intensity at the locations of each of the 
simulated points, while your "lam" object has 
only the intensity at the original point locations.

So the easiest way is using a a pixel image 
(object of class "im") assumed to contain the 
values of the intensity function at all locations 
in the window as your lambda.

Try something like this:

lam <- predict.ppm(invert.cord.model, type="trend")

or

lam <- predict.ppm(invert.cord.model, type="trend", covariates= mycovariates)

if your model includes covariates.

Then

Ki.env <- envelope( nests.ppp,  Kinhom, 
lambda=lam, simulate = expression( rpoispp(lam)), correction="translate")

if your model is an heterogeneous poisson or 
using other simulation function (rmh, rMaternI, 
rStrauss, etc) whenever appropirate.


By the way, beware of the  type of prediction 
that you want from your model. By default, 
fitted.ppm  has argument  type="lambda", which 
gives you  the conditional intensity ("lambda") . 
I think you really need the trend, i.e. you should have asked for

lam <- fitted(invert.cord.model, 
location=nestsF.ppp, dataonly=TRUE, type="trend")


Cheers,

Marcelino



At 16:37 23/03/2010, Raya A. Pruner wrote:
>I have created fitted models for an 
>inhomogeneous point pattern using spatstat.  I 
>have used the script below to do so.  I would 
>like to create envelopes for the fitted 
>K-function.  However, when using the envelope(), 
>it doesn't seem to recognize the lamda parameter
>
>
>##inhomogeneous functions based on top fit covariate model###
>lam <- fitted(invert.cord.model, location=nestsF.ppp, dataonly=TRUE)
>Ki <- Kinhom(nests.ppp, lam, correction="translate")
>plot(Ki, sqrt(./pi) - r ~ r, xlab="r(meters)", 
>main="Inhomogeneous L-Function- Controlling for Inverts")
>
>g1 <- pcf(Ki, spar=0.9, method="b")
>plot(g1, main="Inhomogeneous Pair Correlation Function: Inverts")
>
>
>Thanks in advance!!
>Raya
>
>--
>Raya A Pruner - Graduate Student
>University of Florida
>Department of Wildlife Ecology and Conservation
>PO Box 110430
>Gainesville, FL 32611-0430
>352-214-3262
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

________________________________

Marcelino de la Cruz Rot

Departamento de  Biolog?a Vegetal
E.U.T.I. Agr?cola
Universidad Polit?cnica de Madrid
28040-Madrid
Tel.: 91 336 54 35
Fax: 91 336 56 56
marcelino.delacruz at upm.es
_________________________________ 


From burtonshank at gmail.com  Tue Mar 23 21:09:38 2010
From: burtonshank at gmail.com (Burton Shank)
Date: Tue, 23 Mar 2010 16:09:38 -0400
Subject: [R-sig-Geo] specifying limits of "z-values" in spplot
Message-ID: <4619261003231309y22074678o29c54a523060eb07@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100323/91ba44cd/attachment.pl>

From jorgefernandosaraiva at gmail.com  Tue Mar 23 22:04:05 2010
From: jorgefernandosaraiva at gmail.com (Jorge Fernando Saraiva de Menezes)
Date: Tue, 23 Mar 2010 18:04:05 -0300
Subject: [R-sig-Geo] overlay of spatial polygons with GDALReadOnlyDataset
Message-ID: <d81b9e0a1003231404x1cc03c99p9f3585cd39e2a7f4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100323/babea558/attachment.pl>

From r.hijmans at gmail.com  Tue Mar 23 22:23:01 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 23 Mar 2010 14:23:01 -0700
Subject: [R-sig-Geo] overlay of spatial polygons with GDALReadOnlyDataset
In-Reply-To: <d81b9e0a1003231404x1cc03c99p9f3585cd39e2a7f4@mail.gmail.com>
References: <d81b9e0a1003231404x1cc03c99p9f3585cd39e2a7f4@mail.gmail.com>
Message-ID: <dc22b2571003231423k7cf8e99cod4b50f5129c27c57@mail.gmail.com>

Jorge,

You can probably use the raster package. It is not clear what you want
to accomplish with the overlay, but it could be something like this:

Let p be a SpatialPolygons* object

library(raster)
r = raster('filename')
rp = polygonsToRaster(p, r)
z = zonal(rp, r)

or

library(raster)
r = raster(filename)
pv = polygonValues(r, p)


Best, Robert


On Tue, Mar 23, 2010 at 2:04 PM, Jorge Fernando Saraiva de Menezes
<jorgefernandosaraiva at gmail.com> wrote:
> Dear all,
>
> I'm sorry if this is a too basic question, but I'm trying to make a
> overlay() of spatial polygon with a srtm ASCII altitude map. I tried to read
> this map using readasciigrid, but it is to big for the computer's memory.
> The only way that I find to read this map ?is use GDAL.open, but doesn't
> seems to have a method to do overlay with GDALReadOnlyDataset. There is some
> way to use overlay or something like it,with this kind of data, or another
> way to make overlay() with big grids?
>
> Thanks,
> Jorge
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From b.rowlingson at lancaster.ac.uk  Tue Mar 23 23:03:18 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 23 Mar 2010 22:03:18 +0000
Subject: [R-sig-Geo] create a asymmetric ellipse
In-Reply-To: <518dff331003222127va3d1f77l3173bd8eb2b70ee9@mail.gmail.com>
References: <518dff331003222127va3d1f77l3173bd8eb2b70ee9@mail.gmail.com>
Message-ID: <d8ad40b51003231503r663e39b1l7320ac4c0a03416e@mail.gmail.com>

Here's a solution for four elliptical quadrants:

elly <- function(N,S,W,E,x=0,y=0,n=100){

  xo=yo=double(n*4)
  step=pi/(2*n)

  xf=c(E,W,W,E)
  yf=c(N,N,S,S)
  j=1
  for(q in 1:4){
    for(i in 1:n){
      theta=(q-1)*(pi/2)+(i-1)*step
      xo[j]=xf[q]*cos(theta)
      yo[j]=yf[q]*sin(theta)
      j=j+1
    }
  }

  return(cbind(xo+x,yo+y))
}

then try:

plot(elly(10,5,3,5),type='l')

Barry


From acioryx at gmail.com  Wed Mar 24 00:48:45 2010
From: acioryx at gmail.com (sam oryx)
Date: Tue, 23 Mar 2010 18:48:45 -0500
Subject: [R-sig-Geo] k-function
Message-ID: <f3a973fa1003231648r1668c83bgf73cee1c00db83ca@mail.gmail.com>

Dear all,



I have been trying to use a bounding area that is not a square for
estimating the k-function;



*infokhat <-khat(events,polyline,distances,newstyle=TRUE)*

* *

Error in bbox(poly) : object not a >= 2-column array



Is it possible to define a bounding area that has several points not as a
square?

below is my code



Thanks,



Sam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100323/ca2d27a4/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: study area.jpg
Type: image/jpeg
Size: 44104 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100323/ca2d27a4/attachment.jpg>

From edzer.pebesma at uni-muenster.de  Wed Mar 24 08:12:24 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 24 Mar 2010 08:12:24 +0100
Subject: [R-sig-Geo] create a asymmetric ellipse
In-Reply-To: <d8ad40b51003231503r663e39b1l7320ac4c0a03416e@mail.gmail.com>
References: <518dff331003222127va3d1f77l3173bd8eb2b70ee9@mail.gmail.com>
	<d8ad40b51003231503r663e39b1l7320ac4c0a03416e@mail.gmail.com>
Message-ID: <4BA9BB58.9040108@uni-muenster.de>

Nice one, Barry! It shows up even nicer (IMO) when you add

plot(elly(10,5,3,5),type='l', asp=1)


Barry Rowlingson wrote:
> Here's a solution for four elliptical quadrants:
> 
> elly <- function(N,S,W,E,x=0,y=0,n=100){
> 
>   xo=yo=double(n*4)
>   step=pi/(2*n)
> 
>   xf=c(E,W,W,E)
>   yf=c(N,N,S,S)
>   j=1
>   for(q in 1:4){
>     for(i in 1:n){
>       theta=(q-1)*(pi/2)+(i-1)*step
>       xo[j]=xf[q]*cos(theta)
>       yo[j]=yf[q]*sin(theta)
>       j=j+1
>     }
>   }
> 
>   return(cbind(xo+x,yo+y))
> }
> 
> then try:
> 
> plot(elly(10,5,3,5),type='l')
> 
> Barry
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From b.rowlingson at lancaster.ac.uk  Wed Mar 24 10:18:48 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 24 Mar 2010 09:18:48 +0000
Subject: [R-sig-Geo] k-function
In-Reply-To: <f3a973fa1003231648r1668c83bgf73cee1c00db83ca@mail.gmail.com>
References: <f3a973fa1003231648r1668c83bgf73cee1c00db83ca@mail.gmail.com>
Message-ID: <d8ad40b51003240218v39fa6ab0h3d74a35eb1a6c9a0@mail.gmail.com>

On Tue, Mar 23, 2010 at 11:48 PM, sam oryx <acioryx at gmail.com> wrote:
> Dear all,
>
>
>
> I have been trying to use a bounding area that is not a square for
> estimating the k-function;
>
>
>
> infokhat <-khat(events,polyline,distances,newstyle=TRUE)
>
>
>
> Error in bbox(poly) : object not a >= 2-column array
>
>
>
> Is it possible to define a bounding area that has several points not as a
> square?

 If you read the help for khat you'll see that the polygon argument
can be a polygon ring of points. What are you feeding it?

 The simplest thing to feed khat as a polygon is a 2-column matrix of
x,y coordinates in each row.

Barry


From alobolistas at gmail.com  Wed Mar 24 10:35:18 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 24 Mar 2010 10:35:18 +0100
Subject: [R-sig-Geo] Converting GRID to SHAPE in R (was: Re: [Fwd: Re:
 rgdal: problem with grid data])
In-Reply-To: <522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
References: <4BA8675C.2090705@gmail.com>
	<522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
Message-ID: <4BA9DCD6.7040700@gmail.com>

Thanks for all the inputs I've got. I've
tried the following solution, but the steps
with as.SpatialPolygons.GridTopology() and
unionSpatialPolygons() take too long a time, had to abort the
second one after 1h, so
the procedure does not seem to be a really working
solution (note than I'm using the landcover map of a tiny country as example)

#Data from http://www.diva-gis.org/data/cov/ISR_cov.zip

isrlc <-
readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri")

 > class(isrlc)
[1] "SpatialGridDataFrame"
attr(,"package")
[1] "sp"

isrlcSP <- as.SpatialPolygons.GridTopology(getGridTopology(isrlc))

 > class(isrlcSP)
[1] "SpatialPolygons"
attr(,"package")
[1] "sp"

isrlcSPU <- unionSpatialPolygons(isrlcSP, isrlc at data[,1])
Aborted after 1h

A second solution is saving as gtif, then gdal_polygonize:

gdal_translate isr_cov.gri isr_cov.tif
gdal_polygonize.py -f 'ESRI Shapefile' isr_cov.tif isr_cov

which takes longer for writing the commands than the actual execution time!
Then we still have to attach the legend, which can be easily done in R. So I 
think the best is writing a function using system() for the above 2 commands, then
reading the grid and the shape, attach the legend to the SPDF and save again as
shape.

So, problem solved. I'll post the function to the list as soon as I make it.

Agus


Michael Sumner wrote:
> Hi, I'm not sure on the license status of gpclib in maptools - not for
> commercial use now - but I'm sure Roger will comment on that on the
> list. This seems to work:
> 
> library(maptools)
> 
> gdata <- image2Grid(list(x = 1:nrow(volcano), y = 1:ncol(volcano), z = volcano))
> 
> SpP_grd <- as.SpatialPolygons.GridTopology(getGridTopology(gdata))
> 
> 
> unionpoly <-   unionSpatialPolygons(SpP_grd, gdata$z)
> 
> 
> trdata <- data.frame(z = sort(unique(gdata$z)), row.names =
> sapply(slot(unionpoly, "polygons"), function(i) slot(i, "ID")))
> 
> 
> SpPDF <- SpatialPolygonsDataFrame(unionpoly, trdata)
> 
> 
> I checked the result in GIS and it seems to work perfectly.
> 
> Cheers, Mike.
> 
> On Tue, Mar 23, 2010 at 6:01 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>
>> -------- Original Message --------
>> Subject: Re: [R-sig-Geo] rgdal: problem with grid data
>> Date: Tue, 23 Mar 2010 07:53:38 +0100
>> From: Agustin Lobo <aloboaleu at gmail.com>
>> Reply-To: Agustin.Lobo at ija.csic.es
>> To: Michael Sumner <mdsumner at gmail.com>
>> CC: sig-geo <r-sig-geo at stat.math.ethz.ch>
>> References: <4BA86074.8010709 at gmail.com>
>> <522664f81003222349g39cc0c4ya756547d80c1d2f6 at mail.gmail.com>
>>
>> ok, I see, I have to convert to Spatial Polygons data frame first, right?
>> Ideally, I should be able of clumping those cells with the same value,
>> so this is a bit more complicated than I expected. But should be possible.
>> I'll try and let the list know.
>> Thanks
>>
>> Agus
>>
>> Michael Sumner wrote:
>>> What are you expecting to get - a point for every raster cell?  If so,
>>> use gridded(isrlc) <- FALSE to convert to a SPDF first - then the
>>> write will work.
>>>
>>> More complicated conversions are possible, such as with
>>> as.SpatialPolygons.GridTopology.
>>>
>>> Cheers, Mike.
>>>
>>>
>>>
>>>
>>>
>>> On Tue, Mar 23, 2010 at 5:32 PM, Agustin Lobo <alobolistas at gmail.com>
>>> wrote:
>>>> Hi!
>>>>
>>>>  I read a grid file into R with
>>>> isrlc <-
>>>>
>>>> readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri")
>>>>
>>>> While isrlc seems correct,  I'm getting an empty shapefile when I attempt
>>>> to
>>>> write:
>>>>
>>>>
>>>> writeOGR(isrlc,dsn="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah",
>>>> layer="ISR_cov2",driver="ESRI Shapefile")
>>>>
>>>> Data from
>>>> http://www.diva-gis.org/data/cov/ISR_cov.zip
>>>>
>>>> Thanks
>>>>
>>>> Agus
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>> --
>> Dr. Agustin Lobo
>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>> LLuis Sole Sabaris s/n
>> 08028 Barcelona
>> Spain
>> Tel. 34 934095410
>> Fax. 34 934110012
>> email: Agustin.Lobo at ija.csic.es
>> http://www.ija.csic.es/gt/obster
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From alobolistas at gmail.com  Wed Mar 24 11:09:58 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 24 Mar 2010 11:09:58 +0100
Subject: [R-sig-Geo] Converting GRID to SHAPE in R
In-Reply-To: <4BA9DCD6.7040700@gmail.com>
References: <4BA8675C.2090705@gmail.com>
	<522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
	<4BA9DCD6.7040700@gmail.com>
Message-ID: <4BA9E4F6.4050007@gmail.com>

One further problem: it seems that readGDAL()
does not read the info from the grd file, just the gri.
Thus the legend is ignored.

Agus

Agustin Lobo wrote:
> Thanks for all the inputs I've got. I've
> tried the following solution, but the steps
> with as.SpatialPolygons.GridTopology() and
> unionSpatialPolygons() take too long a time, had to abort the
> second one after 1h, so
> the procedure does not seem to be a really working
> solution (note than I'm using the landcover map of a tiny country as 
> example)
> 
> #Data from http://www.diva-gis.org/data/cov/ISR_cov.zip
> 
> isrlc <-
> readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri") 
> 
> 
>  > class(isrlc)
> [1] "SpatialGridDataFrame"
> attr(,"package")
> [1] "sp"
> 
> isrlcSP <- as.SpatialPolygons.GridTopology(getGridTopology(isrlc))
> 
>  > class(isrlcSP)
> [1] "SpatialPolygons"
> attr(,"package")
> [1] "sp"
> 
> isrlcSPU <- unionSpatialPolygons(isrlcSP, isrlc at data[,1])
> Aborted after 1h
> 
> A second solution is saving as gtif, then gdal_polygonize:
> 
> gdal_translate isr_cov.gri isr_cov.tif
> gdal_polygonize.py -f 'ESRI Shapefile' isr_cov.tif isr_cov
> 
> which takes longer for writing the commands than the actual execution time!
> Then we still have to attach the legend, which can be easily done in R. 
> So I think the best is writing a function using system() for the above 2 
> commands, then
> reading the grid and the shape, attach the legend to the SPDF and save 
> again as
> shape.
> 
> So, problem solved. I'll post the function to the list as soon as I make 
> it.
> 
> Agus
> 
> 
> Michael Sumner wrote:
>> Hi, I'm not sure on the license status of gpclib in maptools - not for
>> commercial use now - but I'm sure Roger will comment on that on the
>> list. This seems to work:
>>
>> library(maptools)
>>
>> gdata <- image2Grid(list(x = 1:nrow(volcano), y = 1:ncol(volcano), z = 
>> volcano))
>>
>> SpP_grd <- as.SpatialPolygons.GridTopology(getGridTopology(gdata))
>>
>>
>> unionpoly <-   unionSpatialPolygons(SpP_grd, gdata$z)
>>
>>
>> trdata <- data.frame(z = sort(unique(gdata$z)), row.names =
>> sapply(slot(unionpoly, "polygons"), function(i) slot(i, "ID")))
>>
>>
>> SpPDF <- SpatialPolygonsDataFrame(unionpoly, trdata)
>>
>>
>> I checked the result in GIS and it seems to work perfectly.
>>
>> Cheers, Mike.
>>
>> On Tue, Mar 23, 2010 at 6:01 PM, Agustin Lobo <alobolistas at gmail.com> 
>> wrote:
>>>
>>> -------- Original Message --------
>>> Subject: Re: [R-sig-Geo] rgdal: problem with grid data
>>> Date: Tue, 23 Mar 2010 07:53:38 +0100
>>> From: Agustin Lobo <aloboaleu at gmail.com>
>>> Reply-To: Agustin.Lobo at ija.csic.es
>>> To: Michael Sumner <mdsumner at gmail.com>
>>> CC: sig-geo <r-sig-geo at stat.math.ethz.ch>
>>> References: <4BA86074.8010709 at gmail.com>
>>> <522664f81003222349g39cc0c4ya756547d80c1d2f6 at mail.gmail.com>
>>>
>>> ok, I see, I have to convert to Spatial Polygons data frame first, 
>>> right?
>>> Ideally, I should be able of clumping those cells with the same value,
>>> so this is a bit more complicated than I expected. But should be 
>>> possible.
>>> I'll try and let the list know.
>>> Thanks
>>>
>>> Agus
>>>
>>> Michael Sumner wrote:
>>>> What are you expecting to get - a point for every raster cell?  If so,
>>>> use gridded(isrlc) <- FALSE to convert to a SPDF first - then the
>>>> write will work.
>>>>
>>>> More complicated conversions are possible, such as with
>>>> as.SpatialPolygons.GridTopology.
>>>>
>>>> Cheers, Mike.
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> On Tue, Mar 23, 2010 at 5:32 PM, Agustin Lobo <alobolistas at gmail.com>
>>>> wrote:
>>>>> Hi!
>>>>>
>>>>>  I read a grid file into R with
>>>>> isrlc <-
>>>>>
>>>>> readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri") 
>>>>>
>>>>>
>>>>> While isrlc seems correct,  I'm getting an empty shapefile when I 
>>>>> attempt
>>>>> to
>>>>> write:
>>>>>
>>>>>
>>>>> writeOGR(isrlc,dsn="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah", 
>>>>>
>>>>> layer="ISR_cov2",driver="ESRI Shapefile")
>>>>>
>>>>> Data from
>>>>> http://www.diva-gis.org/data/cov/ISR_cov.zip
>>>>>
>>>>> Thanks
>>>>>
>>>>> Agus
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>> -- 
>>> Dr. Agustin Lobo
>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>> LLuis Sole Sabaris s/n
>>> 08028 Barcelona
>>> Spain
>>> Tel. 34 934095410
>>> Fax. 34 934110012
>>> email: Agustin.Lobo at ija.csic.es
>>> http://www.ija.csic.es/gt/obster
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
> 
>


From msassi at eco.unipv.it  Wed Mar 24 12:38:51 2010
From: msassi at eco.unipv.it (Maria Sassi)
Date: Wed, 24 Mar 2010 12:38:51 +0100
Subject: [R-sig-Geo] spatial W-matrix
Message-ID: <002001cacb46$93508f40$292fccc1@Sassi2>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100324/b25f7a27/attachment.pl>

From saldanha.plangeo at gmail.com  Wed Mar 24 13:01:19 2010
From: saldanha.plangeo at gmail.com (Raphael Saldanha)
Date: Wed, 24 Mar 2010 09:01:19 -0300
Subject: [R-sig-Geo] spatial W-matrix
In-Reply-To: <002001cacb46$93508f40$292fccc1@Sassi2>
References: <002001cacb46$93508f40$292fccc1@Sassi2>
Message-ID: <c85849371003240501r6502d2cfxd186d52e995003c7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100324/a1fb4928/attachment.pl>

From alobolistas at gmail.com  Wed Mar 24 14:39:48 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 24 Mar 2010 14:39:48 +0100
Subject: [R-sig-Geo] Converting GRID to SHAPE in R
In-Reply-To: <4BA9E4F6.4050007@gmail.com>
References: <4BA8675C.2090705@gmail.com>
	<522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
	<4BA9DCD6.7040700@gmail.com> <4BA9E4F6.4050007@gmail.com>
Message-ID: <4BAA1624.6070102@gmail.com>

This is the function I've made. Instead of reading the shape files
(which takes a long time) I read the dbf file.
I also read the grd file,
writing back a modified dbf including the legend.
The only problem is that both read.dbf() and
write.dbf() read and write many more cases than those actually
present in the dbf file (hence the na.omit() after read.dbf() )
Roger, do you want me to send you the actual dbf file?

This is not perfect, but works and it's fast. Don't know
if this is a general solution dor grd files.

"migrid2shp" <- 
function(dirin="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov", 
infname="ISR_cov", 
dirout="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah", 
ofname="ISR_cov")
{
require(rgdal)
require(foreign)
comm1 <- paste("gdal_translate ",paste(dirin,"/",infname,".gri",sep=""), " 
delme.tif")
system(comm1,inter=T)
comm2 <- paste("gdal_polygonize.py -f 'ESRI Shapefile' delme.tif ", 
paste(dirout,"/",ofname,sep=""), ofname)
system(comm2,inter=T)
system(paste("rm delme.tif"))

indbf <- read.dbf(paste(dirout,"/",ofname,"/",ofname, ".dbf",sep=""))
indbf <- na.omit(indbf)
a <- matrix(scan(paste(dirin,"/",infname,".grd",sep=""),what=" 
",skip=25,sep="=",fill=T),byrow=T,ncol=2)
b <- grep("Label", a[,1])
a <- a[b,]
n <- length(unlist(strsplit(a[,1],"Label")))
b <- as.numeric(unlist(strsplit(a[,1],"Label"))[seq(2,n,by=2)])
a[1:length(b),1] <-b
a <- data.frame(class=a[1:length(b),1], description=a[1:length(b),2])
row.names(a) <- a[,1]

b <- a[match(indbf$DN,a$class),]
indbf2 <- cbind(indbf,b)
write.dbf(indbf2,file=paste(dirout,"/",ofname,"/", ofname,".dbf", sep=""))
print(paste(dirout,"/",ofname,"/", ofname,".dbf", sep=""))
}



Agustin Lobo wrote:
> One further problem: it seems that readGDAL()
> does not read the info from the grd file, just the gri.
> Thus the legend is ignored.
> 
> Agus
> 
> Agustin Lobo wrote:
>> Thanks for all the inputs I've got. I've
>> tried the following solution, but the steps
>> with as.SpatialPolygons.GridTopology() and
>> unionSpatialPolygons() take too long a time, had to abort the
>> second one after 1h, so
>> the procedure does not seem to be a really working
>> solution (note than I'm using the landcover map of a tiny country as 
>> example)
>>
>> #Data from http://www.diva-gis.org/data/cov/ISR_cov.zip
>>
>> isrlc <-
>> readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri") 
>>
>>
>>  > class(isrlc)
>> [1] "SpatialGridDataFrame"
>> attr(,"package")
>> [1] "sp"
>>
>> isrlcSP <- as.SpatialPolygons.GridTopology(getGridTopology(isrlc))
>>
>>  > class(isrlcSP)
>> [1] "SpatialPolygons"
>> attr(,"package")
>> [1] "sp"
>>
>> isrlcSPU <- unionSpatialPolygons(isrlcSP, isrlc at data[,1])
>> Aborted after 1h
>>
>> A second solution is saving as gtif, then gdal_polygonize:
>>
>> gdal_translate isr_cov.gri isr_cov.tif
>> gdal_polygonize.py -f 'ESRI Shapefile' isr_cov.tif isr_cov
>>
>> which takes longer for writing the commands than the actual execution 
>> time!
>> Then we still have to attach the legend, which can be easily done in 
>> R. So I think the best is writing a function using system() for the 
>> above 2 commands, then
>> reading the grid and the shape, attach the legend to the SPDF and save 
>> again as
>> shape.
>>
>> So, problem solved. I'll post the function to the list as soon as I 
>> make it.
>>
>> Agus
>>
>>
>> Michael Sumner wrote:
>>> Hi, I'm not sure on the license status of gpclib in maptools - not for
>>> commercial use now - but I'm sure Roger will comment on that on the
>>> list. This seems to work:
>>>
>>> library(maptools)
>>>
>>> gdata <- image2Grid(list(x = 1:nrow(volcano), y = 1:ncol(volcano), z 
>>> = volcano))
>>>
>>> SpP_grd <- as.SpatialPolygons.GridTopology(getGridTopology(gdata))
>>>
>>>
>>> unionpoly <-   unionSpatialPolygons(SpP_grd, gdata$z)
>>>
>>>
>>> trdata <- data.frame(z = sort(unique(gdata$z)), row.names =
>>> sapply(slot(unionpoly, "polygons"), function(i) slot(i, "ID")))
>>>
>>>
>>> SpPDF <- SpatialPolygonsDataFrame(unionpoly, trdata)
>>>
>>>
>>> I checked the result in GIS and it seems to work perfectly.
>>>
>>> Cheers, Mike.
>>>
>>> On Tue, Mar 23, 2010 at 6:01 PM, Agustin Lobo <alobolistas at gmail.com> 
>>> wrote:
>>>>
>>>> -------- Original Message --------
>>>> Subject: Re: [R-sig-Geo] rgdal: problem with grid data
>>>> Date: Tue, 23 Mar 2010 07:53:38 +0100
>>>> From: Agustin Lobo <aloboaleu at gmail.com>
>>>> Reply-To: Agustin.Lobo at ija.csic.es
>>>> To: Michael Sumner <mdsumner at gmail.com>
>>>> CC: sig-geo <r-sig-geo at stat.math.ethz.ch>
>>>> References: <4BA86074.8010709 at gmail.com>
>>>> <522664f81003222349g39cc0c4ya756547d80c1d2f6 at mail.gmail.com>
>>>>
>>>> ok, I see, I have to convert to Spatial Polygons data frame first, 
>>>> right?
>>>> Ideally, I should be able of clumping those cells with the same value,
>>>> so this is a bit more complicated than I expected. But should be 
>>>> possible.
>>>> I'll try and let the list know.
>>>> Thanks
>>>>
>>>> Agus
>>>>
>>>> Michael Sumner wrote:
>>>>> What are you expecting to get - a point for every raster cell?  If so,
>>>>> use gridded(isrlc) <- FALSE to convert to a SPDF first - then the
>>>>> write will work.
>>>>>
>>>>> More complicated conversions are possible, such as with
>>>>> as.SpatialPolygons.GridTopology.
>>>>>
>>>>> Cheers, Mike.
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Tue, Mar 23, 2010 at 5:32 PM, Agustin Lobo <alobolistas at gmail.com>
>>>>> wrote:
>>>>>> Hi!
>>>>>>
>>>>>>  I read a grid file into R with
>>>>>> isrlc <-
>>>>>>
>>>>>> readGDAL("/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah/ISR_cov/isr_cov.gri") 
>>>>>>
>>>>>>
>>>>>> While isrlc seems correct,  I'm getting an empty shapefile when I 
>>>>>> attempt
>>>>>> to
>>>>>> write:
>>>>>>
>>>>>>
>>>>>> writeOGR(isrlc,dsn="/media/Transcend/MASTER_ICTA2007_2008/GEODATA_miniprojs/Kefah", 
>>>>>>
>>>>>> layer="ISR_cov2",driver="ESRI Shapefile")
>>>>>>
>>>>>> Data from
>>>>>> http://www.diva-gis.org/data/cov/ISR_cov.zip
>>>>>>
>>>>>> Thanks
>>>>>>
>>>>>> Agus
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>> -- 
>>>> Dr. Agustin Lobo
>>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>> LLuis Sole Sabaris s/n
>>>> 08028 Barcelona
>>>> Spain
>>>> Tel. 34 934095410
>>>> Fax. 34 934110012
>>>> email: Agustin.Lobo at ija.csic.es
>>>> http://www.ija.csic.es/gt/obster
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>>
> 
>


From N.A.Batchelor at sms.ed.ac.uk  Wed Mar 24 16:44:44 2010
From: N.A.Batchelor at sms.ed.ac.uk (Nicola Batchelor)
Date: Wed, 24 Mar 2010 15:44:44 -0000
Subject: [R-sig-Geo] Multivariate spatio-temporal modelling
In-Reply-To: <mailman.7.1262257203.27135.r-sig-geo@stat.math.ethz.ch>
References: <mailman.7.1262257203.27135.r-sig-geo@stat.math.ethz.ch>
Message-ID: <5C8337BDED2B4D33B47FE204AB363D1F@soton.ac.uk>

Dear list.

I've completed a spatial GLM analysis of a dataset with one outcome variable
(binomial) using geoRglm.  I now want to go on to extend this analysis in 2
ways: 1) incorporating a temporal element and 2) using a second (related)
outcome variable.

As far as I am aware, geoRglm doesn't have the functionality for
spatio-temporal modelling, or for multivariate modelling.  Is this correct?
>From a brief look around on the web it seems like spBayes could be the thing
for the job.

Can anyone give me a wee bit of advice as to whether spBayes could
potentially be right for what I want to do (or if there is anything else
which I could use)? Basically, I want to carry out spatio-temporal modelling
of joint distribution data for 2 related disease measures (will be disease
prevalence or counts in humans and animals). The outputs I want (if
possible) are estimates of covariate effects on both human and animal
disease, the relationship between human and animal disease and a
spatio-temporal prediction. 

Please forgive me if I use the wrong technical terms as my first analysis
with geoRglm was my first ever introduction to geostatistics and spatial
modelling...perhaps I am being overambitious!

Many thanks in advance,

Nicola Batchelor
University of Edinburgh and University of Southampton


-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.


From yud at mail.montclair.edu  Wed Mar 24 18:14:00 2010
From: yud at mail.montclair.edu (Danlin Yu)
Date: Wed, 24 Mar 2010 13:14:00 -0400
Subject: [R-sig-Geo] Multivariate spatio-temporal modelling
In-Reply-To: <5C8337BDED2B4D33B47FE204AB363D1F@soton.ac.uk>
References: <mailman.7.1262257203.27135.r-sig-geo@stat.math.ethz.ch>
	<5C8337BDED2B4D33B47FE204AB363D1F@soton.ac.uk>
Message-ID: <4BAA4858.5020004@mail.montclair.edu>

Dear Nicola Batchelor:

I am also quite interested in spatiotemporal modeling, specifically 
spatiotemporal regression analysis. I am not quite sure whether this 
would help, but I am developing a "geographically weighted panel 
regression" method combining both spgwr and plm packages. The 
development is in a very early stage. If you are interested and more 
importantly, if you are looking for a regression-like analysis, we might 
be able to discuss further for the codes and relevant information.

Best,
Danlin



Nicola Batchelor ??:
> Dear list.
>
> I've completed a spatial GLM analysis of a dataset with one outcome variable
> (binomial) using geoRglm.  I now want to go on to extend this analysis in 2
> ways: 1) incorporating a temporal element and 2) using a second (related)
> outcome variable.
>
> As far as I am aware, geoRglm doesn't have the functionality for
> spatio-temporal modelling, or for multivariate modelling.  Is this correct?
> >From a brief look around on the web it seems like spBayes could be the thing
> for the job.
>
> Can anyone give me a wee bit of advice as to whether spBayes could
> potentially be right for what I want to do (or if there is anything else
> which I could use)? Basically, I want to carry out spatio-temporal modelling
> of joint distribution data for 2 related disease measures (will be disease
> prevalence or counts in humans and animals). The outputs I want (if
> possible) are estimates of covariate effects on both human and animal
> disease, the relationship between human and animal disease and a
> spatio-temporal prediction. 
>
> Please forgive me if I use the wrong technical terms as my first analysis
> with geoRglm was my first ever introduction to geostatistics and spatial
> modelling...perhaps I am being overambitious!
>
> Many thanks in advance,
>
> Nicola Batchelor
> University of Edinburgh and University of Southampton
>
>
>   

-- 
___________________________________________
Danlin Yu, Ph.D.
Assistant Professor of GIS and Urban Geography
Department of Earth & Environmental Studies
Montclair State University
Montclair, NJ, 07043
Tel: 973-655-4313
Fax: 973-655-4072
email: yud at mail.montclair.edu
webpage: csam.montclair.edu/~yu


From julien.beguin.1 at ulaval.ca  Wed Mar 24 23:02:53 2010
From: julien.beguin.1 at ulaval.ca (Julien Beguin)
Date: Wed, 24 Mar 2010 18:02:53 -0400
Subject: [R-sig-Geo] CAR model with geoRglm
Message-ID: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F67C@EXCH-MBX-F.ulaval.ca>

Dear all,

I am fitting a CAR model in WinBugs with proportional data (binomial distirbution) as response and a couple of independent variables. I have 1873 cells and Bugs does not seem to like so much (1 minute by iteration) when I estimate a spatial random effect for each cell (1st order neigboorhood). 

I have heard about the geoRglm package for making spatial binomial regression using MCMC estimations, but never used it. Is someone know if this method could easely handle 1873 cells (at least faster than WinBugs) or I am better to be patient and continue with Bugs.

Can you give me some advice please? I would really appreciate it.

Cheers,

Julien Beguin
----------------   
Ph.D. Student
Laval University

From paulojus at c3sl.ufpr.br  Wed Mar 24 23:26:35 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 24 Mar 2010 19:26:35 -0300 (BRT)
Subject: [R-sig-Geo] CAR model with geoRglm
In-Reply-To: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F67C@EXCH-MBX-F.ulaval.ca>
References: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F67C@EXCH-MBX-F.ulaval.ca>
Message-ID: <alpine.DEB.2.00.1003241924330.2020@bowmore.c3sl.ufpr.br>

Dear Julien

geoRglm fitis continuoaus spatial models and therefore CAR is not
included.
One recent and exclente alternative is the INLA package
(not in CRAN) available at www.r-inla.org
which fits a wide range of Markov random fields models

The web-site has intructions and example.
More details in the JRSS-B read paper by Rue, Chopin and Martino (2009)


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus



On Wed, 24 Mar 2010, Julien Beguin wrote:

> Dear all,
>
> I am fitting a CAR model in WinBugs with proportional data (binomial distirbution) as response and a couple of independent variables. I have 1873 cells and Bugs does not seem to like so much (1 minute by iteration) when I estimate a spatial random effect for each cell (1st order neigboorhood).
>
> I have heard about the geoRglm package for making spatial binomial regression using MCMC estimations, but never used it. Is someone know if this method could easely handle 1873 cells (at least faster than WinBugs) or I am better to be patient and continue with Bugs.
>
> Can you give me some advice please? I would really appreciate it.
>
> Cheers,
>
> Julien Beguin
> ----------------
> Ph.D. Student
> Laval University
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From N.A.Batchelor at sms.ed.ac.uk  Thu Mar 25 10:55:12 2010
From: N.A.Batchelor at sms.ed.ac.uk (Nicola Batchelor)
Date: Thu, 25 Mar 2010 09:55:12 -0000
Subject: [R-sig-Geo] Multivariate spatio-temporal modelling
In-Reply-To: <4BAA4858.5020004@mail.montclair.edu>
References: <mailman.7.1262257203.27135.r-sig-geo@stat.math.ethz.ch>
	<5C8337BDED2B4D33B47FE204AB363D1F@soton.ac.uk>
	<4BAA4858.5020004@mail.montclair.edu>
Message-ID: <669493A1BB5C41AEABB3056B5EF22357@soton.ac.uk>

Hi Danlin,

Thanks.  If Im honest I don't know much about GWR and also I'm rubbish at
coding (I come from an epidemiology background, not spatial analysis), so
ideally for me whichever package I use will have lots of instructions!  

At the moment I'm just putting together a grant proposal so I just wanted to
make sure that it is possible to do what I want to do, but it seems like it
is possible.  I'll talk with my supervisor about the methods and let him
know about the possibility of a geographically weighted panel regression and
see what he thinks.

Thanks again,
Nicola


-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.


-----Original Message-----
From: Danlin Yu [mailto:yud at mail.montclair.edu] 
Sent: 24 March 2010 17:14
To: Nicola Batchelor
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Multivariate spatio-temporal modelling

Dear Nicola Batchelor:

I am also quite interested in spatiotemporal modeling, specifically 
spatiotemporal regression analysis. I am not quite sure whether this 
would help, but I am developing a "geographically weighted panel 
regression" method combining both spgwr and plm packages. The 
development is in a very early stage. If you are interested and more 
importantly, if you are looking for a regression-like analysis, we might 
be able to discuss further for the codes and relevant information.

Best,
Danlin



Nicola Batchelor ??:
> Dear list.
>
> I've completed a spatial GLM analysis of a dataset with one outcome
variable
> (binomial) using geoRglm.  I now want to go on to extend this analysis in
2
> ways: 1) incorporating a temporal element and 2) using a second (related)
> outcome variable.
>
> As far as I am aware, geoRglm doesn't have the functionality for
> spatio-temporal modelling, or for multivariate modelling.  Is this
correct?
> >From a brief look around on the web it seems like spBayes could be the
thing
> for the job.
>
> Can anyone give me a wee bit of advice as to whether spBayes could
> potentially be right for what I want to do (or if there is anything else
> which I could use)? Basically, I want to carry out spatio-temporal
modelling
> of joint distribution data for 2 related disease measures (will be disease
> prevalence or counts in humans and animals). The outputs I want (if
> possible) are estimates of covariate effects on both human and animal
> disease, the relationship between human and animal disease and a
> spatio-temporal prediction. 
>
> Please forgive me if I use the wrong technical terms as my first analysis
> with geoRglm was my first ever introduction to geostatistics and spatial
> modelling...perhaps I am being overambitious!
>
> Many thanks in advance,
>
> Nicola Batchelor
> University of Edinburgh and University of Southampton
>
>
>   

-- 
___________________________________________
Danlin Yu, Ph.D.
Assistant Professor of GIS and Urban Geography
Department of Earth & Environmental Studies
Montclair State University
Montclair, NJ, 07043
Tel: 973-655-4313
Fax: 973-655-4072
email: yud at mail.montclair.edu
webpage: csam.montclair.edu/~yu


From N.A.Batchelor at sms.ed.ac.uk  Thu Mar 25 11:19:17 2010
From: N.A.Batchelor at sms.ed.ac.uk (Nicola Batchelor)
Date: Thu, 25 Mar 2010 10:19:17 -0000
Subject: [R-sig-Geo] Multivariate spatio-temporal modelling
In-Reply-To: <4BAA561F.9080808@msu.edu>
References: <4BAA561F.9080808@msu.edu>
Message-ID: <318E8005B7DD4CFA8BEE64C955105214@soton.ac.uk>

Hi Andy,

I was just reading something you wrote about spBayes and was thinking about
emailing you for advice!

The data I currently have is 1000's of village locations with counts of
human disease (and population data, so I could calculate rates/prevalence)
over about 20 years - I'll probably take a sample of these villages for use
in the analysis rather than use all of them as there are probably too many.
I also have a number of locations (far less - probably about 30) with
livestock (reservoir for the parasite) prevalence data from various time
points. So the human data is more flexible - could be used as counts or
rates, but the animal data is a proportion, so would have to be used as a
binomial variable which might constrain the analysis to a binomial GLM.

My ideal scenario would be the ability to create a multivariate
spatio-temporal model with the primary aim of predicting human disease
(spatially, and also perhaps forecasting if possible) based on
environmental/climatic covariates, and also with the input of animal
prevalence information.  I'm only at the grant writing stage at the moment,
so wanted to check this is something which I can do before committing myself
to it!

My supervisor is very keen on the temporal aspect of the work. Personally
I'm more interested in incorporating animal sampling data to improve the
predictions as there is a big problem of under-reporting for this disease
(particularly in areas far from health centres), and I hope that the use of
animal sampling data could improve predictions.  I was hoping that we'd be
able to combine these two aims in one model...is that not possible? Also, do
you know what the limitations of the model fitting is in terms of number of
observation locations?

Sorry if my questions are a bit niave, but I have no experience of
spatio-temporal modelling and am just trying to get my head around what is
possible for this grant!

Thanks very much for your input,
Nicola




-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.


-----Original Message-----
From: Andrew Finley [mailto:finleya at msu.edu] 
Sent: 24 March 2010 18:13
To: N.A.Batchelor at sms.ed.ac.uk
Subject: [R-sig-Geo] Multivariate spatio-temporal modelling

Hi Nicola,
Sorry to answer you off the list. One of my grad students forwarded your 
posting to me.

So based on your description you should be able to use spMvGLM to fit 
this model for any given time point (in its current state this function 
will not be able to fit a full space-time model). So at a given location 
you have disease counts for humans and animals (assuming humans != 
animals ;-)? Or do you have disease rates. If so would you want to fit a 
multivariate spatial binomial regression? Also how many data points do 
you have?

Feel free to answer back on the list (I'm now an official subscriber).
Kind regards-
Andy

-- 
Andrew Finley, PhD
Natural Resources Building
Michigan State University
East Lansing, MI 48824-1222
Phone: 517-432-7219
Fax: 517-432-1143
web: http://blue.for.msu.edu





Dear list.

I've completed a spatial GLM analysis of a dataset with one outcome variable
(binomial) using geoRglm.  I now want to go on to extend this analysis in 2
ways: 1) incorporating a temporal element and 2) using a second (related)
outcome variable.

As far as I am aware, geoRglm doesn't have the functionality for
spatio-temporal modelling, or for multivariate modelling.  Is this correct?
>From a brief look around on the web it seems like spBayes could be the thing
for the job.

Can anyone give me a wee bit of advice as to whether spBayes could
potentially be right for what I want to do (or if there is anything else
which I could use)? Basically, I want to carry out spatio-temporal modelling
of joint distribution data for 2 related disease measures (will be disease
prevalence or counts in humans and animals). The outputs I want (if
possible) are estimates of covariate effects on both human and animal
disease, the relationship between human and animal disease and a
spatio-temporal prediction. 

Please forgive me if I use the wrong technical terms as my first analysis
with geoRglm was my first ever introduction to geostatistics and spatial
modelling...perhaps I am being overambitious!

Many thanks in advance,

Nicola Batchelor
University of Edinburgh and University of Southampton


From julien.beguin.1 at ulaval.ca  Thu Mar 25 15:51:50 2010
From: julien.beguin.1 at ulaval.ca (Julien Beguin)
Date: Thu, 25 Mar 2010 10:51:50 -0400
Subject: [R-sig-Geo] RE :  CAR model with geoRglm
In-Reply-To: <alpine.DEB.2.00.1003241924330.2020@bowmore.c3sl.ufpr.br>
References: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F67C@EXCH-MBX-F.ulaval.ca>,
	<alpine.DEB.2.00.1003241924330.2020@bowmore.c3sl.ufpr.br>
Message-ID: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F67F@EXCH-MBX-F.ulaval.ca>

Thank you Paulo. Indeed, it seems a very VERY promising approach for a large kind of spatial models and sounds like a revolution, at least for me. 

Julien
----------------
Ph.D. Student
Laval University

________________________________________
De : Paulo Justiniano Ribeiro Jr [paulojus at c3sl.ufpr.br]
Date d'envoi : 24 mars 2010 18:26
? : Julien Beguin
Cc : r-sig-geo at stat.math.ethz.ch
Objet : Re: [R-sig-Geo] CAR model with geoRglm

Dear Julien

geoRglm fitis continuoaus spatial models and therefore CAR is not
included.
One recent and exclente alternative is the INLA package
(not in CRAN) available at www.r-inla.org
which fits a wide range of Markov random fields models

The web-site has intructions and example.
More details in the JRSS-B read paper by Rue, Chopin and Martino (2009)


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus



On Wed, 24 Mar 2010, Julien Beguin wrote:

> Dear all,
>
> I am fitting a CAR model in WinBugs with proportional data (binomial distirbution) as response and a couple of independent variables. I have 1873 cells and Bugs does not seem to like so much (1 minute by iteration) when I estimate a spatial random effect for each cell (1st order neigboorhood).
>
> I have heard about the geoRglm package for making spatial binomial regression using MCMC estimations, but never used it. Is someone know if this method could easely handle 1873 cells (at least faster than WinBugs) or I am better to be patient and continue with Bugs.
>
> Can you give me some advice please? I would really appreciate it.
>
> Cheers,
>
> Julien Beguin
> ----------------
> Ph.D. Student
> Laval University
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

From alobolistas at gmail.com  Thu Mar 25 18:28:40 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 25 Mar 2010 18:28:40 +0100
Subject: [R-sig-Geo] [Fwd: Re: raster to polygons]
Message-ID: <4BAB9D48.2060103@gmail.com>

-------- Original Message --------
Subject: Re: raster to polygons
Date: Thu, 25 Mar 2010 18:08:44 +0100
From: Agustin Lobo <Agustin.Lobo at ija.csic.es>
Reply-To: Agustin.Lobo at ija.csic.es
To: Tim (LWF) <Tim.Haering at lwf.bayern.de>,  sig-geo <r-sig-geo at stat.math.ethz.ch>
References: 
<70FC67C4A585D1489E66225A4E0238BA7C8B29 at RZS-EXC-CL06.rz-sued.bayern.de> 
<4BAA436A.2040106 at ija.csic.es> 
<70FC67C4A585D1489E66225A4E0238BA7C90E3 at RZS-EXC-CL06.rz-sued.bayern.de>

Tim,

1. You do not need the first conversion:
> comm1 <- paste("gdal_translate ",paste(dirin,"/",infname,".tif",sep=""), 
"delme.tif")
> system(comm1,inter=T)
as this is transforming to tif and you already start from a tif.
2. If your input is not a grid image, then you do not need all the part
starting with read.dbf()
3. Both gdal_translate and gdal_polygonize.py are part of gdal utilities
(not just the gdal library that you must have if you use rgdal) and
my function uses system() to execute them as external commands in the OS (linux
ubuntu in my case). The good thing of gdal_polygonize.py is that
it is very fast and memory efficient. But it looks like you do not have them,
and I'm not sure how cumbersome installing this will be under windows now, it
used to be tricky. Check in gdal.com,
and/or other people from this lists might advice you, but perhaps you can carry
out the same
type of operation with grass or saga through R. My experience in stalling packages
like gdal or grass in windows through osgeo4w is that it implies a time that
is better invested on using linux. Perhaps installing saga for windows is
easier, I have only tried it on linux systems.
4. Finally, check package raster, perhaps Robert Hijmans has included a function
equivalent to gdal_polygonize.py That would be the very best in my opinion.

Agus


H?ring wrote:
> Hi Agus,
> 
> Yes, I get your message. Thanks for that! Unfortunately I was not successful applying your function to my raster. My input file is in tif-format. Hopefully I changed your code correctly... Here is what I did:
> 
> # I have a xyz-file "xyzdat":
> "migrid2shp" <-
> function(dirin="D:/temp",
> infname=" gridfile ",
> dirout="D:/temp",
> ofname="grid_out")
> {
> require(rgdal)
> require(foreign)
> comm1 <- paste("gdal_translate ",paste(dirin,"/",infname,".tif",sep=""), "delme.tif")
> system(comm1,inter=T)
> comm2 <- paste("gdal_polygonize.py -f 'ESRI Shapefile' delme.tif ",
> paste(dirout,"/",ofname,sep=""), ofname)
> system(comm2,inter=T)
> system(paste("rm delme.tif"))
> 
> indbf <- read.dbf(paste(dirout,"/",ofname,"/",ofname, ".dbf",sep=""))
> indbf <- na.omit(indbf)
> a <- matrix(scan(paste(dirin,"/",infname,".tif",sep=""),what="",skip=25,sep="=",fill=T),byrow=T,ncol=2)
> b <- grep("Label", a[,1])
> a <- a[b,]
> n <- length(unlist(strsplit(a[,1],"Label")))
> b <- as.numeric(unlist(strsplit(a[,1],"Label"))[seq(2,n,by=2)])
> a[1:length(b),1] <-b
> a <- data.frame(class=a[1:length(b),1], description=a[1:length(b),2])
> row.names(a) <- a[,1]
> 
> b <- a[match(indbf$DN,a$class),]
> indbf2 <- cbind(indbf,b)
> write.dbf(indbf2,file=paste(dirout,"/",ofname,"/", ofname,".dbf", sep=""))
> print(paste(dirout,"/",ofname,"/", ofname,".dbf", sep=""))
> }
> 
> migrid2shp()
> 
> R gives me following error message:
> Error in system(comm1, inter = T) : gdal_translate not found
> 
> I`m using R 2.10.1 and rgdal based on GDAL 1.7.1 under Windows XP.
> 
> Any ideas?
> 
> Thanks a lot
> TIM
> 
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster


From jay.douillard at ubc.ca  Thu Mar 25 21:16:29 2010
From: jay.douillard at ubc.ca (Jay Douillard)
Date: Thu, 25 Mar 2010 13:16:29 -0700 (PDT)
Subject: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
In-Reply-To: <29088014.121331269545728547.JavaMail.root@verrazzano>
Message-ID: <17256511.121951269548189606.JavaMail.root@verrazzano>

Gindo,

You can use the Convert Spatial Weight Matrix to Table function in the arcmap toolbox. This results in a GAL/GWT text based file. Open the file in a text editor and remove the headings, and place a number representing the number of neighbours you have in as the header of the first column( I have no idea why arcgis does just output a true GAL/GWT file).

Then:
 
nb <-read.gwt2nb("<weight file from arc>.gwt",region.id=<objectid>)
listw <-nb2listw(nb, glist=attr(nb, "GeoDa")$dist)

see:

http://hosho.ees.hokudai.ac.jp/~kubo/Rdoc/library/spdep/html/read.gwt2nb.html
http://hosho.ees.hokudai.ac.jp/~kubo/Rdoc/library/spdep/html/nb2listw.html


----
Jay Douillard
Geospatial Technical Lead
604.827.4401
Human Early Learning Partnership 
www.earlylearning.ubc.ca


----- Original Message -----
From: "Gindo Tampubolon" <Gindo.Tampubolon at manchester.ac.uk>
To: "Roger Bivand" <Roger.Bivand at nhh.no>
Cc: r-sig-geo at stat.math.ethz.ch
Sent: Friday, March 19, 2010 1:54:29 AM GMT -08:00 US/Canada Pacific
Subject: Re: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file

Thanks ever so much Roger.
Prompt and precise.

Gindo
-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: 18 March 2010 19:20
To: Gindo Tampubolon
Cc: r-sig-geo at stat.math.ethz.ch
Subject: RE: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file

On Thu, 18 Mar 2010, Gindo Tampubolon wrote:

> Dear Roger and all,
>
> Sorry for not putting a sample. Yes, Windows seems to be overloaded.
> http://sites.google.com/site/tehtareknow/home/spatial-weight-matrix/

The *.swm file is a binary file in an unknown format. The DBF file can be
read as follows:

library(foreign)
x <- read.dbf("spatialweightmatrix3.dbf")
from_IDs <- sort(unique(x$FID2))
to_IDs <- sort(unique(x$NID))
# find the IDs used
all.equal(from_IDs, to_IDs)
o <- order(x$FID2, x$NID)
# order the object
xx <- x[o,]
# convert manually to a spatial.neighbours representation
sn <- data.frame(from=match(xx$FID2, from_IDs), to=match(xx$NID+1,
   to_IDs), weihts=xx$WEIGHT)
attr(sn, "n") <- length(from_IDs)
attr(sn, "region.id") <- as.character(from_IDs)
class(sn) <- c("spatial.neighbour", class(sn))
library(spdep)
lw <- sn2listw(sn)
lw
summary(sapply(lw$weights, sum))
table(card(lw$neighbours))

There are only 1331 observations, so unconnected ones appear to be
dropped, and are probably the "holes" in attr(lw, "region.id") which
should span 0:1356, but is missing 25 values. The FID2 are probably the
FID of the polygon objects.

Hope this helps,

Roger


>
> Thanks for the tip and any more help much appreciated,
> Gindo
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: 18 March 2010 14:23
> To: Gindo Tampubolon
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] Reading ArcGIS 9.3 spatial weight matrix [swm] file
>
> On Thu, 18 Mar 2010, Gindo Tampubolon wrote:
>
>> Dear all,
>>
>> Can anyone tell me how to read ArcGIS 9.3 generated .swm file [spatial
>> weight matrix] into R?
>
> Well, make a number of small samples available on a website - most people
> do not have access to Arc, so helping is hard. Is there an ESRI site with
> shapefiles and matching sample *.swm files?
>
>>
>> I am stumped at page 242 of the ASDAR book [Bivand et al 2008]. I use a
>> SpatialPolygonsDataFrame object and tried to generate neighbours list
>> using poly2nb(). It took more than 24 hours [European data NUTS level 3
>> about 1500 regions]. After finishing, the result is a null set.
>>
>
> Always try a subset first. Most likely you need the snap= argument, if the
> boundaries do not touch but are close to each other. Almost certainly your
> input map also had far too much detail in shorelines and river borders,
> leading to your machine getting overloaded (Windows?). Displaying on such
> a map would also be dominated by line detail.
>
>> So I generate a rook weight matrix in ArcGIS 9.3 [and convert it to a
>> table there]. How do I import this matrix to R?
>
> Contribute by making sample files available. To read a matrix if you must,
> use read.table().
>
> Roger
>
>>
>>
>> I looked at RArcInfo and rgdal packages but could not find anything
>> obvious; I'm experimenting with read.gwt2nb() but ArcGIS created swm
>> based on numeric ID instead of NUTS_CODE alphanumeric; needs tweaking
>> perhaps.
>>
>> Many thanks
>>
>> Gindo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>
>

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From stefano at casalegno.net  Fri Mar 26 17:51:13 2010
From: stefano at casalegno.net (Stefano Casalegno)
Date: Fri, 26 Mar 2010 17:51:13 +0100
Subject: [R-sig-Geo] Spatial ecological modeling with R - summer school
In-Reply-To: <4B1FF44D.6070705@spatial-analyst.net>
References: <b440a3f80912090927i63bd62d1m312c8b7b3d7eff09@mail.gmail.com>
	<4B1FF44D.6070705@spatial-analyst.net>
Message-ID: <7F733388-BD1D-467C-9EE9-3AD9DA7AA029@casalegno.net>

Dear r-sig-geo,

This is to inform you about a new hands-on training on spatial  
ecological modeling using R,  Linux bash,  Grass and other open  
source tools.
We organize it as two weeks summer school in Copenhagen University  -  
Denmark ( 28 June - 9 july).

more informations:
http://en.sl.life.ku.dk/Forskning/ForskerskolenREFOLANA/ 
Activities_courses.aspx#opensource
http://www.spatial-ecology.net

Please sponsor this training in your institute if possible.
Thanks in advance

Stafano


From viton.1 at osu.edu  Fri Mar 26 19:42:19 2010
From: viton.1 at osu.edu (Philip A. Viton)
Date: Fri, 26 Mar 2010 14:42:19 -0400
Subject: [R-sig-Geo] spdep: making nb object from csv data
Message-ID: <201003261842.o2QIgKrQ000539@defang6.it.ohio-state.edu>


Suppose I have a data frame with a bunch of spatial data
indexed by a region.id, say r_id. I also have a csv file
with spatial neighbors whose format is: row 1 = labels;
column 1 = region id whose order is different from r_id, and
the rest is a square 0/1 indicator matrix of spatial neighbors.

How can I import the csv data into R as an nb object, so
that the order matches the region order in the dataframe?
(I suppose it would be fairly easy to use the data in the csv file
to construct a gal file and then use read.gal;
but I'm hoping there's a more straightforward way).

Thanks!

------------------------
Philip A. Viton
City Planning, Ohio State University
275 West Woodruff Avenue, Columbus OH 43210
viton.1 at osu.edu


From Roger.Bivand at nhh.no  Fri Mar 26 20:04:55 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 26 Mar 2010 20:04:55 +0100 (CET)
Subject: [R-sig-Geo] spdep: making nb object from csv data
In-Reply-To: <201003261842.o2QIgKrQ000539@defang6.it.ohio-state.edu>
References: <201003261842.o2QIgKrQ000539@defang6.it.ohio-state.edu>
Message-ID: <alpine.LRH.2.00.1003261953210.4275@reclus.nhh.no>

On Fri, 26 Mar 2010, Philip A. Viton wrote:

>
> Suppose I have a data frame with a bunch of spatial data
> indexed by a region.id, say r_id. I also have a csv file
> with spatial neighbors whose format is: row 1 = labels;
> column 1 = region id whose order is different from r_id, and
> the rest is a square 0/1 indicator matrix of spatial neighbors.
>
> How can I import the csv data into R as an nb object, so
> that the order matches the region order in the dataframe?
> (I suppose it would be fairly easy to use the data in the csv file
> to construct a gal file and then use read.gal;
> but I'm hoping there's a more straightforward way).

I guess it is easier not to randomise the ids, but I think that we can get 
the fish out of this fish soup.

First read the csv file (into a data frame). Most likely the column 
headers will be taken as col.names, with the first column the row names. 
Check that the r_id match the column names, and the values in the first 
column. Use match() to do this, and examine the length of the output and 
its contents. If it looks OK, use the output of match to re-order the 
matrix created by dropping the first column of the csv data.frame and 
coercing with as.matrix().

If:

o <- match(r_id, col_nms)
m <- as.matrix(csv_df[, -1])
m1 <- m[o, o]

then mat2listw(m1)

should be what you need. However, do check everything twice, including the 
order of the arguments to match() - I always have to as they feel 
counter-intuitive. If you have some centroid coordinates in the data 
frame, use them with the plot method for nb objects to double-check.

Hope this helps,

Roger

>
> Thanks!
>
> ------------------------
> Philip A. Viton
> City Planning, Ohio State University
> 275 West Woodruff Avenue, Columbus OH 43210
> viton.1 at osu.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pierre.roudier at gmail.com  Fri Mar 26 20:13:11 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Sat, 27 Mar 2010 06:13:11 +1100
Subject: [R-sig-Geo] Continuous colorbar legend for a SpatialPointsDataFrame
	object
Message-ID: <e4178da61003261213n5953c494j1bf08dc0490fadc9@mail.gmail.com>

Dear R users,

I am trying to produce a plot of a SpatialPointsDataFrame object,
including 15000 spatial observations, that are NOT regularly gridded.

My problem is that I do need an important number of colours in my
colour ramp : I'm using the option cuts=30. As a consequence, I end up
with a very small map, and a huge scale with coloured dots, like in
this simple example:

require(sp)
data(meuse)
coordinates(meuse) <- ~x+y
spplot(meuse,zcol="elev",cuts=30)

Is there a way to get a continuous colorbar legend on the side of the
plot, the way a SpatialPixelDataFrame would be plotted:

require(sp)
data(meuse.grid)
coordinates(meuse.grid) <- ~x+y
gridded(meuse.grid) <- TRUE
spplot(meuse.grid,zcol="dist",cuts=30)

Thanks,

Dr. Pierre Roudier
Postdoctoral Fellow
The University of Sydney


From alp97 at hotmail.com  Sat Mar 27 11:49:26 2010
From: alp97 at hotmail.com (Alper ALTINOK)
Date: Sat, 27 Mar 2010 10:49:26 +0000
Subject: [R-sig-Geo] hotspot analysis for random samples from same area,
	different years.
Message-ID: <SNT144-w218AC95DAF4C8BF37FE0A9BC220@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100327/b9f4520e/attachment.pl>

From jgarcia at ija.csic.es  Sun Mar 28 11:38:20 2010
From: jgarcia at ija.csic.es (jgarcia at ija.csic.es)
Date: Sun, 28 Mar 2010 11:38:20 +0200 (CEST)
Subject: [R-sig-Geo] closeAllConnections() in spgrass6. Side effect?
In-Reply-To: <4BAA1624.6070102@gmail.com>
References: <4BA8675C.2090705@gmail.com>
	<522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
	<4BA9DCD6.7040700@gmail.com> <4BA9E4F6.4050007@gmail.com>
	<4BAA1624.6070102@gmail.com>
Message-ID: <50797.86.0.54.218.1269769100.squirrel@paleo.ija.csic.es>

Hi Roger and the others,

I've noticed that readRAST6() uses closeAllConnection(), as it is trying
to close a raw "socket" type connection I had opened for parallel
processing (snow package).

Isn't this a side effect and perhaps closeAllConnection() should be
replaced here by any other alternative?

Thanks (also for the package) and best regards,
Javier

---
Javier Garc?a-Pintado
75 Trotsworth Court
Christchurh Road
Virginia Water
GU25 4AH
Surrey
United Kingdom


From Roger.Bivand at nhh.no  Sun Mar 28 16:48:39 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 28 Mar 2010 16:48:39 +0200 (CEST)
Subject: [R-sig-Geo] closeAllConnections() in spgrass6. Side effect?
In-Reply-To: <50797.86.0.54.218.1269769100.squirrel@paleo.ija.csic.es>
References: <4BA8675C.2090705@gmail.com>
	<522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
	<4BA9DCD6.7040700@gmail.com> <4BA9E4F6.4050007@gmail.com>
	<4BAA1624.6070102@gmail.com>
	<50797.86.0.54.218.1269769100.squirrel@paleo.ija.csic.es>
Message-ID: <alpine.LRH.2.00.1003281644030.19177@reclus.nhh.no>

On Sun, 28 Mar 2010, jgarcia at ija.csic.es wrote:

> Hi Roger and the others,
>
> I've noticed that readRAST6() uses closeAllConnection(), as it is trying
> to close a raw "socket" type connection I had opened for parallel
> processing (snow package).
>
> Isn't this a side effect and perhaps closeAllConnection() should be
> replaced here by any other alternative?
>
> Thanks (also for the package) and best regards,

Javier,

Could you try a change in the package source from sourceforge, check out 
the CVS source from:

cvs -z3 \
-d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial co \
-P spgrass6

I've added a flag to permit the call to closeAllConnections() to be 
avoided; you would use close_OK=FALSE. For most users it is still needed, 
as the number of connections opened in trying to guess what the GDAL GRASS 
plugin needs is not well-specified.

Hope this helps,

Roger

> Javier
>
> ---
> Javier Garc?a-Pintado
> 75 Trotsworth Court
> Christchurh Road
> Virginia Water
> GU25 4AH
> Surrey
> United Kingdom
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From cara.tobin at epfl.ch  Mon Mar 29 10:03:15 2010
From: cara.tobin at epfl.ch (Tobin Cara)
Date: Mon, 29 Mar 2010 10:03:15 +0200
Subject: [R-sig-Geo] anistropy with residuals from KED
Message-ID: <EDB94195DABE64488928DD39E53B8FC68BF118ACC4@REX2.intranet.epfl.ch>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100329/3abf6b07/attachment.pl>

From jgarcia at ija.csic.es  Mon Mar 29 10:15:13 2010
From: jgarcia at ija.csic.es (jgarcia at ija.csic.es)
Date: Mon, 29 Mar 2010 10:15:13 +0200 (CEST)
Subject: [R-sig-Geo] closeAllConnections() in spgrass6. Side effect?
In-Reply-To: <alpine.LRH.2.00.1003281644030.19177@reclus.nhh.no>
References: <4BA8675C.2090705@gmail.com>
	<522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
	<4BA9DCD6.7040700@gmail.com> <4BA9E4F6.4050007@gmail.com>
	<4BAA1624.6070102@gmail.com>
	<50797.86.0.54.218.1269769100.squirrel@paleo.ija.csic.es>
	<alpine.LRH.2.00.1003281644030.19177@reclus.nhh.no>
Message-ID: <56090.86.0.54.218.1269850513.squirrel@paleo.ija.csic.es>

Sure! Thank you very much :-)
Javier

---
> On Sun, 28 Mar 2010, jgarcia at ija.csic.es wrote:
>
>> Hi Roger and the others,
>>
>> I've noticed that readRAST6() uses closeAllConnection(), as it is trying
>> to close a raw "socket" type connection I had opened for parallel
>> processing (snow package).
>>
>> Isn't this a side effect and perhaps closeAllConnection() should be
>> replaced here by any other alternative?
>>
>> Thanks (also for the package) and best regards,
>
> Javier,
>
> Could you try a change in the package source from sourceforge, check out
> the CVS source from:
>
> cvs -z3 \
> -d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial co \
> -P spgrass6
>
> I've added a flag to permit the call to closeAllConnections() to be
> avoided; you would use close_OK=FALSE. For most users it is still needed,
> as the number of connections opened in trying to guess what the GDAL GRASS
> plugin needs is not well-specified.
>
> Hope this helps,
>
> Roger
>
>> Javier
>>
>> ---
>> Javier Garc?a-Pintado
>> 75 Trotsworth Court
>> Christchurh Road
>> Virginia Water
>> GU25 4AH
>> Surrey
>> United Kingdom
>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From jgarcia at ija.csic.es  Mon Mar 29 12:20:03 2010
From: jgarcia at ija.csic.es (jgarcia at ija.csic.es)
Date: Mon, 29 Mar 2010 12:20:03 +0200 (CEST)
Subject: [R-sig-Geo] closeAllConnections() in spgrass6. Side effect?
In-Reply-To: <alpine.LRH.2.00.1003281644030.19177@reclus.nhh.no>
References: <4BA8675C.2090705@gmail.com>
	<522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
	<4BA9DCD6.7040700@gmail.com> <4BA9E4F6.4050007@gmail.com>
	<4BAA1624.6070102@gmail.com>
	<50797.86.0.54.218.1269769100.squirrel@paleo.ija.csic.es>
	<alpine.LRH.2.00.1003281644030.19177@reclus.nhh.no>
Message-ID: <56789.86.0.54.218.1269858003.squirrel@paleo.ija.csic.es>

Hi Roger,
Just to confirm that everything goes OK.
Thanks again,
Javier
---
> On Sun, 28 Mar 2010, jgarcia at ija.csic.es wrote:
>
>> Hi Roger and the others,
>>
>> I've noticed that readRAST6() uses closeAllConnection(), as it is trying
>> to close a raw "socket" type connection I had opened for parallel
>> processing (snow package).
>>
>> Isn't this a side effect and perhaps closeAllConnection() should be
>> replaced here by any other alternative?
>>
>> Thanks (also for the package) and best regards,
>
> Javier,
>
> Could you try a change in the package source from sourceforge, check out
> the CVS source from:
>
> cvs -z3 \
> -d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial co \
> -P spgrass6
>
> I've added a flag to permit the call to closeAllConnections() to be
> avoided; you would use close_OK=FALSE. For most users it is still needed,
> as the number of connections opened in trying to guess what the GDAL GRASS
> plugin needs is not well-specified.
>
> Hope this helps,
>
> Roger
>
>> Javier
>>
>> ---
>> Javier Garc?a-Pintado
>> 75 Trotsworth Court
>> Christchurh Road
>> Virginia Water
>> GU25 4AH
>> Surrey
>> United Kingdom
>>
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From Roger.Bivand at nhh.no  Mon Mar 29 13:09:56 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 29 Mar 2010 13:09:56 +0200 (CEST)
Subject: [R-sig-Geo] closeAllConnections() in spgrass6. Side effect?
In-Reply-To: <56789.86.0.54.218.1269858003.squirrel@paleo.ija.csic.es>
References: <4BA8675C.2090705@gmail.com>
	<522664f81003230037w62c3b22dnd309cc9661ba91f1@mail.gmail.com>
	<4BA9DCD6.7040700@gmail.com> <4BA9E4F6.4050007@gmail.com>
	<4BAA1624.6070102@gmail.com>
	<50797.86.0.54.218.1269769100.squirrel@paleo.ija.csic.es>
	<alpine.LRH.2.00.1003281644030.19177@reclus.nhh.no>
	<56789.86.0.54.218.1269858003.squirrel@paleo.ija.csic.es>
Message-ID: <alpine.LRH.2.00.1003291309340.22521@reclus.nhh.no>

On Mon, 29 Mar 2010, jgarcia at ija.csic.es wrote:

> Hi Roger,
> Just to confirm that everything goes OK.

Thanks, fresh spgrass6 submitted to CRAN.

Roger

> Thanks again,
> Javier
> ---
>> On Sun, 28 Mar 2010, jgarcia at ija.csic.es wrote:
>>
>>> Hi Roger and the others,
>>>
>>> I've noticed that readRAST6() uses closeAllConnection(), as it is trying
>>> to close a raw "socket" type connection I had opened for parallel
>>> processing (snow package).
>>>
>>> Isn't this a side effect and perhaps closeAllConnection() should be
>>> replaced here by any other alternative?
>>>
>>> Thanks (also for the package) and best regards,
>>
>> Javier,
>>
>> Could you try a change in the package source from sourceforge, check out
>> the CVS source from:
>>
>> cvs -z3 \
>> -d:pserver:anonymous at r-spatial.cvs.sourceforge.net:/cvsroot/r-spatial co \
>> -P spgrass6
>>
>> I've added a flag to permit the call to closeAllConnections() to be
>> avoided; you would use close_OK=FALSE. For most users it is still needed,
>> as the number of connections opened in trying to guess what the GDAL GRASS
>> plugin needs is not well-specified.
>>
>> Hope this helps,
>>
>> Roger
>>
>>> Javier
>>>
>>> ---
>>> Javier Garc?a-Pintado
>>> 75 Trotsworth Court
>>> Christchurh Road
>>> Virginia Water
>>> GU25 4AH
>>> Surrey
>>> United Kingdom
>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From haenlein at escpeurope.eu  Mon Mar 29 13:20:19 2010
From: haenlein at escpeurope.eu (Michael Haenlein)
Date: Mon, 29 Mar 2010 13:20:19 +0200
Subject: [R-sig-Geo] Simulation of spatially autocorrelated values
Message-ID: <45101cb11003290420q7456857bw1453e9531f7c7395@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100329/a5a4e265/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Mar 29 15:23:11 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 29 Mar 2010 15:23:11 +0200
Subject: [R-sig-Geo] anistropy with residuals from KED
In-Reply-To: <EDB94195DABE64488928DD39E53B8FC68BF118ACC4@REX2.intranet.epfl.ch>
References: <EDB94195DABE64488928DD39E53B8FC68BF118ACC4@REX2.intranet.epfl.ch>
Message-ID: <4BB0A9BF.1010600@uni-muenster.de>

In general, the hope (and expectation) is that detrended residuals carry
less information in the sense of less structure than the raw data. The
rate with which this happens varies. I don't see any reasons why
detrending would "typically" lead to isotropic residuals; it could be
that the author has experienced this effect a number of times. You might
want to contact him; I believe he listens on the ai-geostats mailing list.

Tobin Cara wrote:
> Hello,
> 
> I was reading in Goovaerts book on Geostatistics for Natural Resources Evaluation that the residuals from KED are typically isotropic. In other words, any anisotropy must be accounted for in the trend model not in the residual semivariogram.
> 
> Is it the case in practice that anisotropy is never detected when finding the semivariogram with residuals or is it ignored (hopefully not)?
> 
> Thank you,
> 
> Cara
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Mon Mar 29 16:23:55 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 29 Mar 2010 16:23:55 +0200 (CEST)
Subject: [R-sig-Geo] Simulation of spatially autocorrelated values
In-Reply-To: <45101cb11003290420q7456857bw1453e9531f7c7395@mail.gmail.com>
References: <45101cb11003290420q7456857bw1453e9531f7c7395@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1003291613470.22521@reclus.nhh.no>

On Mon, 29 Mar 2010, Michael Haenlein wrote:

> Dear all,
>
> my name is Michael Haenlein and I am Associate Professor of Marketing at
> ESCP Europe in Paris, France.
>
> For a research project I'm currently working on, I would like to simulate a
> given degree of spatial auto correlation within an artificial network. The
> problem is as follows: I have a network with a given number of nodes
> (locations) and a given number of relationships between those nodes. Each
> node i has a value xi of a certain type of metric. Assume for example that
> the nodes are different cities and the xi is the average income of people
> living in the respective city. I have drawn the xi independently from a
> probability distribution so that there is no spatial auto correlation in the
> data set. I now would like to "adjust" the individual xi in order to reach a
> predefined level of spatial auto correlation such as a pre-defined level of
> Moran's I. So starting from a situation without spatial auto correlation,
> I'd like to use some iterative process to reach a Moran's I value of let's
> say 0.60.
>
> Can anyone give me advice on how this can be done?

Michael,

Please look at ?invIrW in spdep and its references, and possibly also the 
notes on p. 30 of:

http://www.bias-project.org.uk/ASDARcourse/unit6_slides.pdf

which use an alternative approach to the same question. Here \rho is the 
autoregressive coefficient, not I, and you might need to use some tricks 
to get to a specified global I.

You could treat APLE ?aple as half-way-house, or consider using the set of 
eigenvectors that whitens out equivalent autocorrelation - see 
?SpatialFiltering for references about the links between the solution to 
the eigenproblem of a doubly-centred W and autocorrelation.

Hope this helps,

Roger

>
> Any help is very much appreciated!
>
> Thanks in advance,
>
> Michael
>
>
>
> Michael Haenlein
> Associate Professor of Marketing
> ESCP Europe
> Paris, France
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From famuvie at alumni.uv.es  Mon Mar 29 16:41:59 2010
From: famuvie at alumni.uv.es (=?ISO-8859-1?Q?Facundo_Mu=F1oz?=)
Date: Mon, 29 Mar 2010 16:41:59 +0200
Subject: [R-sig-Geo] anistropy with residuals from KED
In-Reply-To: <4BB0A9BF.1010600@uni-muenster.de>
References: <EDB94195DABE64488928DD39E53B8FC68BF118ACC4@REX2.intranet.epfl.ch>
	<4BB0A9BF.1010600@uni-muenster.de>
Message-ID: <4BB0BC37.2090805@alumni.uv.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100329/aa9a9456/attachment.pl>

From etiennebr at gmail.com  Mon Mar 29 22:39:53 2010
From: etiennebr at gmail.com (Etienne Bellemare Racine)
Date: Mon, 29 Mar 2010 16:39:53 -0400
Subject: [R-sig-Geo] Specify merging mode
Message-ID: <4BB11019.9080607@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100329/f77182d3/attachment.pl>

From r.hijmans at gmail.com  Tue Mar 30 04:43:37 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 29 Mar 2010 19:43:37 -0700
Subject: [R-sig-Geo] Specify merging mode
In-Reply-To: <4BB11019.9080607@gmail.com>
References: <4BB11019.9080607@gmail.com>
Message-ID: <dc22b2571003291943t3ce0c36cnbe3e712f09119807@mail.gmail.com>

Dear Etienne,

This is not in raster (as a single function) but it is a good idea
that I'll look at (and merge needs to be improved for speed also). A
function that would blend overlapping layers based on distance to
their edges would also be useful.

Here are two ways in which you can accomplish what you asked for:

r <- raster()
r1 <- crop(r, extent(-10, 10, -10, 10))
r2 <- crop(r, extent(0, 20, 0, 20))

r1[] <- 1:ncell(r1)
r2[] <- 1:ncell(r2)

# the trick, first merge with empty RasterLayers
r1 <- merge(r1, raster(r2))
r2 <- merge(raster(r1), r2)

# Now combine with a function
rm = mean(r1, r2, na.rm=TRUE)
plot(rm)


# alternative solution:

r <- raster()
r1 <- crop(r, extent(-10, 10, -10, 10))
r2 <- crop(r, extent(0, 20, 0, 20))
r1[] <- 1:ncell(r1)
r2[] <- 1:ncell(r2)

x = (r1 + r2) / 2   # this returns the spatial intersection or r1 & r2
rm = merge(x, r1, r2)
plot(rma)

Robert


On Mon, Mar 29, 2010 at 1:39 PM, Etienne Bellemare Racine
<etiennebr at gmail.com> wrote:
> Hi list,
>
> In the raster package, is it possible to specify which way I want to
> blend the two rasters. e.g. :
>
> r1 <- raster(xmn = -10, ymn = -10, xmx = 10, ymx = 10)
> r2 <- raster(xmn = 0, ymn = 0, xmx = 20, ymx = 20)
>
> r1[] <- 1:ncell(r1)
> r2[] <- 1:ncell(r2)
>
> rm <- merge(r1, r2)
> plot(rm)
>
> You get the first raster on top (r1), but I would like to merge them
> with a function.
>
> I would like to use something like e.g. fun = mean or max. If it's not
> in the raster package, is there any package that allow to merge images
> and specify the way it merge.
>
> Thanks,
> Etienne
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From etiennebr at gmail.com  Tue Mar 30 16:48:39 2010
From: etiennebr at gmail.com (Etienne Bellemare Racine)
Date: Tue, 30 Mar 2010 10:48:39 -0400
Subject: [R-sig-Geo] Specify merging mode
In-Reply-To: <dc22b2571003291943t3ce0c36cnbe3e712f09119807@mail.gmail.com>
References: <4BB11019.9080607@gmail.com>
	<dc22b2571003291943t3ce0c36cnbe3e712f09119807@mail.gmail.com>
Message-ID: <4BB20F47.5020808@gmail.com>

Thanks Robert,

 From what you showed, I tried to wrap the operations in a generic 
function for my own purpose, but I don't know why, I can only apply some 
functions e.g. a mean function is ok, but not a max function. Could you 
point what's wrong ? What's the better way to apply a function to a 
raster list ? My problem is that I have a variable number of rasters to 
merge.

r <- raster()
r1 <- crop(r, extent(-10, 10, -10, 10))
r2 <- crop(r, extent(0, 20, 0, 20))
r3 <- crop(r, extent(10, 30, 10, 30))

r1[] <- 1:ncell(r1)
r2[] <- 1:ncell(r2)
r3[] <- 1:ncell(r3)

fmerge <- function(rasters, fun, ...){
    ex <- raster(unionExtent(rasters))
    res(ex) <- res(rasters[[1]])
    ex[] <- NA
   
    for( i in 1:length(rasters) )
        rasters[[i]] <- merge(rasters[[i]], ex)
   
    do.call( fun, c(rasters, ...) )
}

rfm <- fmerge(rasters, mean, na.rm=T)  #ok
rfx <- fmerge(rasters, max, na.rm=T)   #wrong

Etienne

Robert J. Hijmans wrote :
> Dear Etienne,
>
> This is not in raster (as a single function) but it is a good idea
> that I'll look at (and merge needs to be improved for speed also). A
> function that would blend overlapping layers based on distance to
> their edges would also be useful.
>
> Here are two ways in which you can accomplish what you asked for:
>
> r <- raster()
> r1 <- crop(r, extent(-10, 10, -10, 10))
> r2 <- crop(r, extent(0, 20, 0, 20))
>
> r1[] <- 1:ncell(r1)
> r2[] <- 1:ncell(r2)
>
> # the trick, first merge with empty RasterLayers
> r1 <- merge(r1, raster(r2))
> r2 <- merge(raster(r1), r2)
>
> # Now combine with a function
> rm = mean(r1, r2, na.rm=TRUE)
> plot(rm)
>
>
> # alternative solution:
>
> r <- raster()
> r1 <- crop(r, extent(-10, 10, -10, 10))
> r2 <- crop(r, extent(0, 20, 0, 20))
> r1[] <- 1:ncell(r1)
> r2[] <- 1:ncell(r2)
>
> x = (r1 + r2) / 2   # this returns the spatial intersection or r1 & r2
> rm = merge(x, r1, r2)
> plot(rma)
>
> Robert
>
>
> On Mon, Mar 29, 2010 at 1:39 PM, Etienne Bellemare Racine
> <etiennebr at gmail.com> wrote:
>   
>> Hi list,
>>
>> In the raster package, is it possible to specify which way I want to
>> blend the two rasters. e.g. :
>>
>> r1 <- raster(xmn = -10, ymn = -10, xmx = 10, ymx = 10)
>> r2 <- raster(xmn = 0, ymn = 0, xmx = 20, ymx = 20)
>>
>> r1[] <- 1:ncell(r1)
>> r2[] <- 1:ncell(r2)
>>
>> rm <- merge(r1, r2)
>> plot(rm)
>>
>> You get the first raster on top (r1), but I would like to merge them
>> with a function.
>>
>> I would like to use something like e.g. fun = mean or max. If it's not
>> in the raster package, is there any package that allow to merge images
>> and specify the way it merge.
>>
>> Thanks,
>> Etienne
>>
>>        [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>


From etiennebr at gmail.com  Tue Mar 30 17:32:22 2010
From: etiennebr at gmail.com (Etienne Bellemare Racine)
Date: Tue, 30 Mar 2010 11:32:22 -0400
Subject: [R-sig-Geo] Specify merging mode
In-Reply-To: <4BB20F47.5020808@gmail.com>
References: <4BB11019.9080607@gmail.com>
	<dc22b2571003291943t3ce0c36cnbe3e712f09119807@mail.gmail.com>
	<4BB20F47.5020808@gmail.com>
Message-ID: <4BB21986.7080405@gmail.com>

A correction to my previous example, a line was missing :

Thanks (again) Robert,

 From what you showed, I tried to wrap the operations in a generic 
function for my own purpose, but I don't know why, I can only apply some 
functions e.g. a mean function is ok, but not a max function. Could you 
point what's wrong ? What's the better way to apply a function to a 
raster list ? My problem is that I have a variable number of rasters to 
merge.

r <- raster()
r1 <- crop(r, extent(-10, 10, -10, 10))
r2 <- crop(r, extent(0, 20, 0, 20))
r3 <- crop(r, extent(10, 30, 10, 30))

r1[] <- 1:ncell(r1)
r2[] <- 1:ncell(r2)
r3[] <- 1:ncell(r3)
rasters <- list(r1, r2, r3)

fmerge <- function(rasters, fun, ...){
   ex <- raster(unionExtent(rasters))
   res(ex) <- res(rasters[[1]])
   ex[] <- NA
     for( i in 1:length(rasters) )
       rasters[[i]] <- merge(rasters[[i]], ex)
     do.call( fun, c(rasters, ...) )
}

rfm <- fmerge(rasters, mean, na.rm=T)  #ok
rfx <- fmerge(rasters, max, na.rm=T)   #wrong

Etienne
> Robert J. Hijmans wrote :
>> Dear Etienne,
>>
>> This is not in raster (as a single function) but it is a good idea
>> that I'll look at (and merge needs to be improved for speed also). A
>> function that would blend overlapping layers based on distance to
>> their edges would also be useful.
>>
>> Here are two ways in which you can accomplish what you asked for:
>>
>> r <- raster()
>> r1 <- crop(r, extent(-10, 10, -10, 10))
>> r2 <- crop(r, extent(0, 20, 0, 20))
>>
>> r1[] <- 1:ncell(r1)
>> r2[] <- 1:ncell(r2)
>>
>> # the trick, first merge with empty RasterLayers
>> r1 <- merge(r1, raster(r2))
>> r2 <- merge(raster(r1), r2)
>>
>> # Now combine with a function
>> rm = mean(r1, r2, na.rm=TRUE)
>> plot(rm)
>>
>>
>> # alternative solution:
>>
>> r <- raster()
>> r1 <- crop(r, extent(-10, 10, -10, 10))
>> r2 <- crop(r, extent(0, 20, 0, 20))
>> r1[] <- 1:ncell(r1)
>> r2[] <- 1:ncell(r2)
>>
>> x = (r1 + r2) / 2   # this returns the spatial intersection or r1 & r2
>> rm = merge(x, r1, r2)
>> plot(rma)
>>
>> Robert
>>
>>
>> On Mon, Mar 29, 2010 at 1:39 PM, Etienne Bellemare Racine
>> <etiennebr at gmail.com> wrote:
>>  
>>> Hi list,
>>>
>>> In the raster package, is it possible to specify which way I want to
>>> blend the two rasters. e.g. :
>>>
>>> r1 <- raster(xmn = -10, ymn = -10, xmx = 10, ymx = 10)
>>> r2 <- raster(xmn = 0, ymn = 0, xmx = 20, ymx = 20)
>>>
>>> r1[] <- 1:ncell(r1)
>>> r2[] <- 1:ncell(r2)
>>>
>>> rm <- merge(r1, r2)
>>> plot(rm)
>>>
>>> You get the first raster on top (r1), but I would like to merge them
>>> with a function.
>>>
>>> I would like to use something like e.g. fun = mean or max. If it's not
>>> in the raster package, is there any package that allow to merge images
>>> and specify the way it merge.
>>>
>>> Thanks,
>>> Etienne
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>


From macq at llnl.gov  Wed Mar 31 01:45:07 2010
From: macq at llnl.gov (Don MacQueen)
Date: Tue, 30 Mar 2010 16:45:07 -0700
Subject: [R-sig-Geo] Reading and using shapefile metadata?
Message-ID: <p0624080bc7d839e53455@[128.115.67.9]>

I'm reading shapefiles from the US Census Bureau known as Tiger files. See
   http://www.census.gov/geo/www/tiger/tgrshp2008/tgrshp2008.html

An example is:

   kc.edges.ll <- 
readOGR(file.path(tiger.king.dir,'tl_2009_53033_edges'),'tl_2009_53033_edges')

which creates (in this case) a SpatialLinesDataFrame.

The directory ( "dsn" argument to readOGR()) in this example includes 
six files:
    tl_2009_53033_edges.dbf
    tl_2009_53033_edges.prj
    tl_2009_53033_edges.shp
    tl_2009_53033_edges.shp.xml
    tl_2009_53033_edges.shx

The Tiger documentation says that the .shp.xml file contains 
metadata, and indeed it does. For example, here is an excerpt:
(I have removed indentation)

<attr>
<attrlabl>MTFCC</attrlabl>
<attrdef>MAF/TIGER feature class code of the primary feature for the 
edge</attrdef>
<attrdefs>U.S. Census Bureau</attrdefs>
<attrdomv>
	<edom>
	<edomv>C3023</edomv>
	<edomvd>Island</edomvd>
	<edomvds>U.S. Census Bureau</edomvds>
	</edom>

In brief, this section of metadata decodes the codes in the "MTFCC" 
column in kc.edges.ll at data into human-friendly text string.

I would like to be able to somehow link to or display the decoded 
values when I look at the data.

Is there some function or package or something that I can use to gain 
access to the xml metadata and work with it in subsequent scripts 
that operate on this kc.edges.ll SpatialLinesDataFrame object?

R, QGis, or even GRASS tools would be much appreciated.

Thanks
-Don
-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062


From dan.putler at sauder.ubc.ca  Wed Mar 31 02:11:07 2010
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Tue, 30 Mar 2010 17:11:07 -0700
Subject: [R-sig-Geo] Reading and using shapefile metadata?
In-Reply-To: <19471_1269992758_1269992758_p0624080bc7d839e53455@[128.115.67.9]>
References: <19471_1269992758_1269992758_p0624080bc7d839e53455@[128.115.67.9]>
Message-ID: <1269994267.7193.13.camel@whitebox>

Hi Don,

In R, the only thing I can think to do is parse the XML (using the R XML
package), creating a data frame that has the attribute labels as one
column and the human friendly text strings in another. You can then
merge this data frame with the SpatialLinesDataFrame containing the
edges.

Dan
  
On Tue, 2010-03-30 at 16:45 -0700, Don MacQueen wrote:
> I'm reading shapefiles from the US Census Bureau known as Tiger files. See
>    http://www.census.gov/geo/www/tiger/tgrshp2008/tgrshp2008.html
> 
> An example is:
> 
>    kc.edges.ll <- 
> readOGR(file.path(tiger.king.dir,'tl_2009_53033_edges'),'tl_2009_53033_edges')
> 
> which creates (in this case) a SpatialLinesDataFrame.
> 
> The directory ( "dsn" argument to readOGR()) in this example includes 
> six files:
>     tl_2009_53033_edges.dbf
>     tl_2009_53033_edges.prj
>     tl_2009_53033_edges.shp
>     tl_2009_53033_edges.shp.xml
>     tl_2009_53033_edges.shx
> 
> The Tiger documentation says that the .shp.xml file contains 
> metadata, and indeed it does. For example, here is an excerpt:
> (I have removed indentation)
> 
> <attr>
> <attrlabl>MTFCC</attrlabl>
> <attrdef>MAF/TIGER feature class code of the primary feature for the 
> edge</attrdef>
> <attrdefs>U.S. Census Bureau</attrdefs>
> <attrdomv>
> 	<edom>
> 	<edomv>C3023</edomv>
> 	<edomvd>Island</edomvd>
> 	<edomvds>U.S. Census Bureau</edomvds>
> 	</edom>
> 
> In brief, this section of metadata decodes the codes in the "MTFCC" 
> column in kc.edges.ll at data into human-friendly text string.
> 
> I would like to be able to somehow link to or display the decoded 
> values when I look at the data.
> 
> Is there some function or package or something that I can use to gain 
> access to the xml metadata and work with it in subsequent scripts 
> that operate on this kc.edges.ll SpatialLinesDataFrame object?
> 
> R, QGis, or even GRASS tools would be much appreciated.
> 
> Thanks
> -Don
-- 
Dan Putler
Sauder School of Business
University of British Columbia


From etiennebr at gmail.com  Wed Mar 31 13:47:44 2010
From: etiennebr at gmail.com (Etienne Bellemare Racine)
Date: Wed, 31 Mar 2010 07:47:44 -0400
Subject: [R-sig-Geo] RE :  CAR model with geoRglm
In-Reply-To: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F67F@EXCH-MBX-F.ulaval.ca>
References: <B56D7C27B4408243B93FBC46ABECB5A0011A83C8F67C@EXCH-MBX-F.ulaval.ca>,
	<alpine.DEB.2.00.1003241924330.2020@bowmore.c3sl.ufpr.br>
	<B56D7C27B4408243B93FBC46ABECB5A0011A83C8F67F@EXCH-MBX-F.ulaval.ca>
Message-ID: <4BB33660.70102@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100331/33a234fc/attachment.pl>

From patrick.giraudoux at univ-fcomte.fr  Wed Mar 31 16:45:07 2010
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Wed, 31 Mar 2010 16:45:07 +0200
Subject: [R-sig-Geo] lognormal kriging and backtransfomation
In-Reply-To: <4B338FEB.70604@uni-muenster.de>
References: <4B323023.7050108@univ-fcomte.fr> <4B338FEB.70604@uni-muenster.de>
Message-ID: <4BB35FF3.6010105@univ-fcomte.fr>

Dear Edzer,

We are revising a paper and it appears that one of the referee ask 
(innocently ?) about how we have back transformed the predicted values 
obtained from a lognormal kriging. Quite naively we initially did it 
using a simple exponential, but the question drove us to think this 
question was not that innocent, and to some more reading... It happened 
that things are not so simple and that a quite complex formula has been 
proposed in Cressie (2006) Block Kriging for Lognormal Spatial 
Processes. Mathematical geology 38(4): 413-443 and used at least in 
Rawlins et al (2006). It is however a far beyond my understanding using 
"Lagrange multipliers" and so on...

Do you know if this back transformation has been implemented in gstat or 
elsewhere ?

If not, any though about how to do it from gstat outputs ?

Thanks in advance for any hint,

Patrick


From r.hijmans at gmail.com  Wed Mar 31 21:24:50 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 31 Mar 2010 12:24:50 -0700
Subject: [R-sig-Geo] Specify merging mode
In-Reply-To: <4BB21986.7080405@gmail.com>
References: <4BB11019.9080607@gmail.com>
	<dc22b2571003291943t3ce0c36cnbe3e712f09119807@mail.gmail.com>
	<4BB20F47.5020808@gmail.com> <4BB21986.7080405@gmail.com>
Message-ID: <t2idc22b2571003311224vd8579c4ft1b7cda381e48c4f6@mail.gmail.com>

Etienne,

This is an interesting problem. I do not know what is going on, but
have insufficient time to study this right now.

This slightly adjusted code works in unexpected ways:

fmerge <- function(rasters, fun, ...){
	ex <- raster(unionExtent(rasters))	
	res(ex) <- res(rasters[[1]])
	for( i in 1:length(rasters) )
		rasters[[i]] <- merge(rasters[[i]], ex)
	fun(rasters[[1]], rasters[-1], na.rm=TRUE)  # to force the first
argument to be a RasterLayer object
}

rfmn <- fmerge(rasters, fun=mean, na.rm=T) ? #works
rfx <- fmerge(rasters, fun=max, na.rm=T) ? #wrong
fun = max
rfx <- fmerge(rasters, fun=max, na.rm=T) ? #works
rfn <- fmerge(rasters, fun=min, na.rm=T) ? #works, but still returns max !
fun = min
rfn <- fmerge(rasters, fun=min, na.rm=T) ? #works

So something or other that is different in the environment of the
function fmerge...  I suspect it has something to do with mean being a
normal generic while min and max are primitive functions and part of a
group-generic.


This is an alternative approach that I believe does work:

fmerge <- function(rasters, fun, ...){
	ex <- raster(unionExtent(rasters))
	res(ex) <- res(rasters[[1]])
	for( i in 1:length(rasters) )
	? 	rasters[[i]] <- merge(rasters[[i]], ex)
	rasters <- stack(rasters)
	fun(rasters, ...)
}

rfm <- fmerge(rasters, mean, na.rm=T) ?#ok
rfx <- fmerge(rasters, max, na.rm=T) ? #wrong


Also, I have now added a function 'mosaic' in raster (version 1.0.0-6)
that does this (merging with a function). mosaic() should make the
above functions redundant, but I would like to figure out what's going
on nevertheless. Ideas, anyone?

Robert







1.0.0-6

On Tue, Mar 30, 2010 at 8:32 AM, Etienne Bellemare Racine
<etiennebr at gmail.com> wrote:
> A correction to my previous example, a line was missing :
>
> Thanks (again) Robert,
>
> From what you showed, I tried to wrap the operations in a generic function
> for my own purpose, but I don't know why, I can only apply some functions
> e.g. a mean function is ok, but not a max function. Could you point what's
> wrong ? What's the better way to apply a function to a raster list ? My
> problem is that I have a variable number of rasters to merge.
>
> r <- raster()
> r1 <- crop(r, extent(-10, 10, -10, 10))
> r2 <- crop(r, extent(0, 20, 0, 20))
> r3 <- crop(r, extent(10, 30, 10, 30))
>
> r1[] <- 1:ncell(r1)
> r2[] <- 1:ncell(r2)
> r3[] <- 1:ncell(r3)
> rasters <- list(r1, r2, r3)
>
> fmerge <- function(rasters, fun, ...){
> ?ex <- raster(unionExtent(rasters))
> ?res(ex) <- res(rasters[[1]])
> ?ex[] <- NA
> ? ?for( i in 1:length(rasters) )
> ? ? ?rasters[[i]] <- merge(rasters[[i]], ex)
> ? ?do.call( fun, c(rasters, ...) )
> }
>
> rfm <- fmerge(rasters, mean, na.rm=T) ?#ok
> rfx <- fmerge(rasters, max, na.rm=T) ? #wrong
>
> Etienne
>>
>> Robert J. Hijmans wrote :
>>>
>>> Dear Etienne,
>>>
>>> This is not in raster (as a single function) but it is a good idea
>>> that I'll look at (and merge needs to be improved for speed also). A
>>> function that would blend overlapping layers based on distance to
>>> their edges would also be useful.
>>>
>>> Here are two ways in which you can accomplish what you asked for:
>>>
>>> r <- raster()
>>> r1 <- crop(r, extent(-10, 10, -10, 10))
>>> r2 <- crop(r, extent(0, 20, 0, 20))
>>>
>>> r1[] <- 1:ncell(r1)
>>> r2[] <- 1:ncell(r2)
>>>
>>> # the trick, first merge with empty RasterLayers
>>> r1 <- merge(r1, raster(r2))
>>> r2 <- merge(raster(r1), r2)
>>>
>>> # Now combine with a function
>>> rm = mean(r1, r2, na.rm=TRUE)
>>> plot(rm)
>>>
>>>
>>> # alternative solution:
>>>
>>> r <- raster()
>>> r1 <- crop(r, extent(-10, 10, -10, 10))
>>> r2 <- crop(r, extent(0, 20, 0, 20))
>>> r1[] <- 1:ncell(r1)
>>> r2[] <- 1:ncell(r2)
>>>
>>> x = (r1 + r2) / 2 ? # this returns the spatial intersection or r1 & r2
>>> rm = merge(x, r1, r2)
>>> plot(rma)
>>>
>>> Robert
>>>
>>>
>>> On Mon, Mar 29, 2010 at 1:39 PM, Etienne Bellemare Racine
>>> <etiennebr at gmail.com> wrote:
>>>
>>>>
>>>> Hi list,
>>>>
>>>> In the raster package, is it possible to specify which way I want to
>>>> blend the two rasters. e.g. :
>>>>
>>>> r1 <- raster(xmn = -10, ymn = -10, xmx = 10, ymx = 10)
>>>> r2 <- raster(xmn = 0, ymn = 0, xmx = 20, ymx = 20)
>>>>
>>>> r1[] <- 1:ncell(r1)
>>>> r2[] <- 1:ncell(r2)
>>>>
>>>> rm <- merge(r1, r2)
>>>> plot(rm)
>>>>
>>>> You get the first raster on top (r1), but I would like to merge them
>>>> with a function.
>>>>
>>>> I would like to use something like e.g. fun = mean or max. If it's not
>>>> in the raster package, is there any package that allow to merge images
>>>> and specify the way it merge.
>>>>
>>>> Thanks,
>>>> Etienne
>>>>
>>>> ? ? ? [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>


