From Ded.V at seznam.cz  Thu Dec  1 13:11:10 2016
From: Ded.V at seznam.cz (Vilem Ded)
Date: Thu, 01 Dec 2016 13:11:10 +0100 (CET)
Subject: [R-sig-Geo]
	=?utf-8?q?PostGIS_layer_to_R_using_OGR_driver_imports?=
	=?utf-8?q?__unwanted_raster_column_as_String?=
References: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
	<4F58C8D16A2DF6F4.b050fa7c-0295-4ff8-ab5c-9d4a699efe1f@mail.outlook.com>
	<Fgc.AnNM.6Odi8GU{dPt.1OFjfp@seznam.cz>
	<E953A98FD6EAA7479A68EE8C24491F6B80DC00AD@COLON.valuta.nhh.no>
Message-ID: <HK.AnN5.35sEPyTYQAw.1OG1DU@seznam.cz>

>Hey Vil,

>I know it doesn't answer the problem of using rgdal to load PostGIS layers
>(especially rasters), but have you tried to use rpostgis::pgGetRast to load
>rasters in R? Might not be the most computer efficient, but should get you
>there...
>
>Mathieu. 

Thanks for ideas. I have already managed to load PostGIS layers with postGIStools::get_postgis_query() which gives me more flexibility.  But I would really expect that rgdal can do it too.

>OK, what does ogr2ogr do in GDAL2? I do not have any experience of the driver you are using, so others will have to try to repicate - do you have a >reproducible case? What does rgdal::ogrListLayers() say?
>
>Roger

Ok, sorry, I will try to make it more reproducible.

PostgreSQL database: version psql (9.6.1, server 9.5.5)
Postgis full version gave me:
POSTGIS="2.2.2 r14797" GEOS="3.4.2-CAPI-1.8.2 r3921" PROJ="Rel. 4.8.0, 6 March 2012" GDAL="GDAL 1.10.1, released 2013/08/26" LIBXML="2.9.1" LIBJSON="0.11.99" (core procs from "2.2.1 r14555" need upgrade) RASTER (raster procs from "2.2.1 r14555" need upgrade)

I have noticed that there is GDAL version 1.10.1 and RASTER need upgrade.
Thus I have upgraded postgis from source.
now Postgis full version gives me:
POSTGIS="2.3.1 r15264" GEOS="3.6.0-CAPI-1.10.0 r0" PROJ="Rel. 4.8.0, 6 March 2012" GDAL="GDAL 2.1.2, released 2016/10/24" LIBXML="2.9.1" RASTER

SQL command \d table gives:

                   Table "macfish.laketable"
         Column          |          Type           | Modifiers 
-------------------------+-------------------------+-----------
 lt_lake                 | character varying(40)   | not null
 lt_elevation            | double precision        | 
 lt_depthrast            | raster                  | 
 lt_mac_exclude          | geometry(Polygon,32633) | 
 lt_shoreline_pol_smooth | geometry(Polygon,32633) | 
 lt_shoreline_pol_simple | geometry(Polygon,32633) | 
 lt_shoreline_pol        | geometry(Polygon,32633) |


Spatial columns are listed in list got by sql command  "select * from geometry_columns;"
raster has also SRID 32633  (checked with ST_SRID()) and raster column is listed in list got by sql command "select * from raster_columns ;"  as :
 r_table_catalog | r_table_schema |  r_table_name  | r_raster_column | srid  | scale_x | scale_y | blocksize_x | blocksize_y | same_alignment | regular_blocking | num_bands | pixel_types | nodata_values | out_db |  extent  | spatial_index 
 macfishdb       | macfish        | laketable      | lt_depthrast    |     0 |         |         |             |             | f              | f                |           |             |               |        |         | f

command
ogr2ogr -f "ESRI Shapefile" abc.shp PG:"dbname=DB host=HOST user=USER password=PSSWD port=5432" "SHEMA.TABLE(SPATIAL_COLUMN)"
gives me (as before) lines:

 Warning 6: Normalized/laundered field name: 'lt_elevation' to 'lt_elevati'
 Warning 6: Normalized/laundered field name: 'lt_elevation' to 'lt_elevati'
Warning 1: Value '01000001004CB551378E00F03F4CB551378E00F..... loooong string of hexadecimal values ' 

After that, abc.shp contains the proper shp file. But there is still column named 'lt_depthra' of length 256 chars. These are the same hexadecimal characters as in Warning 1 of ogr2ogr commad.


In R:
library(rgdal) gives me :
Loading required package: sp
rgdal: version: 1.2-4, (SVN revision 643)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.1.2, released 2016/10/24
 Path to GDAL shared files: /usr/local/share/gdal
 Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-3 


Command
rgdal::ogrListLayers(dns = "dbname=DB host=HOST user=USER password=PSSWD port=5432" ) 
gives me:
 [1] "macfish.shoreline"         "macfish.position_old"      "macfish.laketable"         "macfish.firstpos"         
 [5] "macfish.loggerspos"           
attr(,"driver")
[1] "PostgreSQL"
attr(,"nlayers")
[1] 5

which is list of all tables (SHEMA.TABLE) in my database which contain one or more spatial columns.

R version 3.3.2 (2016-10-31)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Debian GNU/Linux 8 (jessie)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rgdal_1.2-4 sp_1.2-3   

loaded via a namespace (and not attached):
[1] tools_3.3.2     grid_3.3.2      lattice_0.20-33

command 
gdal-config --version 
gives me: 2.1.2

I hope its better description. I really dont know what to provide next. I will let it be for some time (too much work). As Mathieu suggested, I can solve that by other packages than rgdal. 
Thank you for everything :)




________________________________________
Fra: Vilem Ded [Ded.V at seznam.cz]
Sendt: 30. november 2016 2:56
Til: Roger Bivand
Kopi: R-Sig_Geo"
Emne: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports  unwanted raster column as String

Hi,
thx for idea. When rgdal is attached:

Loading required package: sp
rgdal: version: 1.1-10, (SVN revision 622)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26
 Path to GDAL shared files: /usr/share/gdal/1.10
 Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-3

gdal-config --version  really showed version 1, so I have installed gdal2 from source.

Now the rgdal attaching gives me:

Loading required package: sp
rgdal: version: 1.2-4, (SVN revision 643)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.1.2, released 2016/10/24
 Path to GDAL shared files: /usr/local/share/gdal
 Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-3

readOGR throws an error when running the same command as before:

obj <- rgdal::readOGR(dsn="PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer = "SCHEMA.TABLE(LAYER)")
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv,  :
  Layer not found

And now ,as expected from error, function ogrInfo() works differently. It throws the same error and work only without specification of LAYER (e.g. layer = "SCHEMA.TABLE")

Some more ideas? Thank you.





---------- P?vodn? zpr?va ----------
Od: Roger Bivand
Komu: Roger Bivand , Vilem Ded , Help
 R-Sig_Geo
Datum: 30. 11. 2016 12:53:32
P?edm?t: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports
 unwanted raster column as String



Briefly, could you add a copy of the startup messages when rgdal is attached, and the version of gdal shown by gdal-config --version? Maybe gdal2 would do better if you are on gdal1?


Roger


Roger Bivand

Norwegian School of Economics

Bergen, Norway




Fra: Vilem Ded

Sendt: onsdag 30. november, 11.11

Emne: [R-sig-Geo] PostGIS layer to R using OGR driver imports unwanted raster column as String

Til: Help R-Sig_Geo


Hi, right to the point. I  am trying to load spatial layer from postgis database to R: obj

From edzer.pebesma at uni-muenster.de  Thu Dec  1 13:34:30 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 1 Dec 2016 13:34:30 +0100
Subject: [R-sig-Geo] PostGIS layer to R using OGR driver imports
 unwanted raster column as String
In-Reply-To: <HK.AnN5.35sEPyTYQAw.1OG1DU@seznam.cz>
References: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
	<4F58C8D16A2DF6F4.b050fa7c-0295-4ff8-ab5c-9d4a699efe1f@mail.outlook.com>
	<Fgc.AnNM.6Odi8GU{dPt.1OFjfp@seznam.cz>
	<E953A98FD6EAA7479A68EE8C24491F6B80DC00AD@COLON.valuta.nhh.no>
	<HK.AnN5.35sEPyTYQAw.1OG1DU@seznam.cz>
Message-ID: <3d8659b1-df5b-ffdc-f27b-b5bd185ff72d@uni-muenster.de>

Your table (layer) contains multiple geometry columns. This is a rather
new feature (afaik) in PostGIS, and in GDAL. I'm not sure whether
readOGR has adapted to it, and why it should cause troubles when it
occurs rather than simply returning you the table with the first
geometry column (sp objects in R can have only one geometry column).

You could try to use sf::st_read, which has similar syntax as readOGR,
see https://edzer.github.io/sfr/articles/sf2.html , and if that is
successful, convert to sp with as(x, "Spatial"). sf::st_read has an
argument, iGeomField, which can be used to specify (by integer) which
geometry column you want to import.

On 01/12/16 13:11, Vilem Ded wrote:
>> Hey Vil,
> 
>> I know it doesn't answer the problem of using rgdal to load PostGIS layers
>> (especially rasters), but have you tried to use rpostgis::pgGetRast to load
>> rasters in R? Might not be the most computer efficient, but should get you
>> there...
>>
>> Mathieu. 
> 
> Thanks for ideas. I have already managed to load PostGIS layers with postGIStools::get_postgis_query() which gives me more flexibility.  But I would really expect that rgdal can do it too.
> 
>> OK, what does ogr2ogr do in GDAL2? I do not have any experience of the driver you are using, so others will have to try to repicate - do you have a >reproducible case? What does rgdal::ogrListLayers() say?
>>
>> Roger
> 
> Ok, sorry, I will try to make it more reproducible.
> 
> PostgreSQL database: version psql (9.6.1, server 9.5.5)
> Postgis full version gave me:
> POSTGIS="2.2.2 r14797" GEOS="3.4.2-CAPI-1.8.2 r3921" PROJ="Rel. 4.8.0, 6 March 2012" GDAL="GDAL 1.10.1, released 2013/08/26" LIBXML="2.9.1" LIBJSON="0.11.99" (core procs from "2.2.1 r14555" need upgrade) RASTER (raster procs from "2.2.1 r14555" need upgrade)
> 
> I have noticed that there is GDAL version 1.10.1 and RASTER need upgrade.
> Thus I have upgraded postgis from source.
> now Postgis full version gives me:
> POSTGIS="2.3.1 r15264" GEOS="3.6.0-CAPI-1.10.0 r0" PROJ="Rel. 4.8.0, 6 March 2012" GDAL="GDAL 2.1.2, released 2016/10/24" LIBXML="2.9.1" RASTER
> 
> SQL command \d table gives:
> 
>                    Table "macfish.laketable"
>          Column          |          Type           | Modifiers 
> -------------------------+-------------------------+-----------
>  lt_lake                 | character varying(40)   | not null
>  lt_elevation            | double precision        | 
>  lt_depthrast            | raster                  | 
>  lt_mac_exclude          | geometry(Polygon,32633) | 
>  lt_shoreline_pol_smooth | geometry(Polygon,32633) | 
>  lt_shoreline_pol_simple | geometry(Polygon,32633) | 
>  lt_shoreline_pol        | geometry(Polygon,32633) |
> 
> 
> Spatial columns are listed in list got by sql command  "select * from geometry_columns;"
> raster has also SRID 32633  (checked with ST_SRID()) and raster column is listed in list got by sql command "select * from raster_columns ;"  as :
>  r_table_catalog | r_table_schema |  r_table_name  | r_raster_column | srid  | scale_x | scale_y | blocksize_x | blocksize_y | same_alignment | regular_blocking | num_bands | pixel_types | nodata_values | out_db |  extent  | spatial_index 
>  macfishdb       | macfish        | laketable      | lt_depthrast    |     0 |         |         |             |             | f              | f                |           |             |               |        |         | f
> 
> command
> ogr2ogr -f "ESRI Shapefile" abc.shp PG:"dbname=DB host=HOST user=USER password=PSSWD port=5432" "SHEMA.TABLE(SPATIAL_COLUMN)"
> gives me (as before) lines:
> 
>  Warning 6: Normalized/laundered field name: 'lt_elevation' to 'lt_elevati'
>  Warning 6: Normalized/laundered field name: 'lt_elevation' to 'lt_elevati'
> Warning 1: Value '01000001004CB551378E00F03F4CB551378E00F..... loooong string of hexadecimal values ' 
> 
> After that, abc.shp contains the proper shp file. But there is still column named 'lt_depthra' of length 256 chars. These are the same hexadecimal characters as in Warning 1 of ogr2ogr commad.
> 
> 
> In R:
> library(rgdal) gives me :
> Loading required package: sp
> rgdal: version: 1.2-4, (SVN revision 643)
>  Geospatial Data Abstraction Library extensions to R successfully loaded
>  Loaded GDAL runtime: GDAL 2.1.2, released 2016/10/24
>  Path to GDAL shared files: /usr/local/share/gdal
>  Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>  Path to PROJ.4 shared files: (autodetected)
>  Linking to sp version: 1.2-3 
> 
> 
> Command
> rgdal::ogrListLayers(dns = "dbname=DB host=HOST user=USER password=PSSWD port=5432" ) 
> gives me:
>  [1] "macfish.shoreline"         "macfish.position_old"      "macfish.laketable"         "macfish.firstpos"         
>  [5] "macfish.loggerspos"           
> attr(,"driver")
> [1] "PostgreSQL"
> attr(,"nlayers")
> [1] 5
> 
> which is list of all tables (SHEMA.TABLE) in my database which contain one or more spatial columns.
> 
> R version 3.3.2 (2016-10-31)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Debian GNU/Linux 8 (jessie)
> 
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                 
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base     
> 
> other attached packages:
> [1] rgdal_1.2-4 sp_1.2-3   
> 
> loaded via a namespace (and not attached):
> [1] tools_3.3.2     grid_3.3.2      lattice_0.20-33
> 
> command 
> gdal-config --version 
> gives me: 2.1.2
> 
> I hope its better description. I really dont know what to provide next. I will let it be for some time (too much work). As Mathieu suggested, I can solve that by other packages than rgdal. 
> Thank you for everything :)
> 
> 
> 
> 
> ________________________________________
> Fra: Vilem Ded [Ded.V at seznam.cz]
> Sendt: 30. november 2016 2:56
> Til: Roger Bivand
> Kopi: R-Sig_Geo"
> Emne: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports  unwanted raster column as String
> 
> Hi,
> thx for idea. When rgdal is attached:
> 
> Loading required package: sp
> rgdal: version: 1.1-10, (SVN revision 622)
>  Geospatial Data Abstraction Library extensions to R successfully loaded
>  Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26
>  Path to GDAL shared files: /usr/share/gdal/1.10
>  Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>  Path to PROJ.4 shared files: (autodetected)
>  Linking to sp version: 1.2-3
> 
> gdal-config --version  really showed version 1, so I have installed gdal2 from source.
> 
> Now the rgdal attaching gives me:
> 
> Loading required package: sp
> rgdal: version: 1.2-4, (SVN revision 643)
>  Geospatial Data Abstraction Library extensions to R successfully loaded
>  Loaded GDAL runtime: GDAL 2.1.2, released 2016/10/24
>  Path to GDAL shared files: /usr/local/share/gdal
>  Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>  Path to PROJ.4 shared files: (autodetected)
>  Linking to sp version: 1.2-3
> 
> readOGR throws an error when running the same command as before:
> 
> obj <- rgdal::readOGR(dsn="PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer = "SCHEMA.TABLE(LAYER)")
> Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv,  :
>   Layer not found
> 
> And now ,as expected from error, function ogrInfo() works differently. It throws the same error and work only without specification of LAYER (e.g. layer = "SCHEMA.TABLE")
> 
> Some more ideas? Thank you.
> 
> 
> 
> 
> 
> ---------- P?vodn? zpr?va ----------
> Od: Roger Bivand
> Komu: Roger Bivand , Vilem Ded , Help
>  R-Sig_Geo
> Datum: 30. 11. 2016 12:53:32
> P?edm?t: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports
>  unwanted raster column as String
> 
> 
> 
> Briefly, could you add a copy of the startup messages when rgdal is attached, and the version of gdal shown by gdal-config --version? Maybe gdal2 would do better if you are on gdal1?
> 
> 
> Roger
> 
> 
> Roger Bivand
> 
> Norwegian School of Economics
> 
> Bergen, Norway
> 
> 
> 
> 
> Fra: Vilem Ded
> 
> Sendt: onsdag 30. november, 11.11
> 
> Emne: [R-sig-Geo] PostGIS layer to R using OGR driver imports unwanted raster column as String
> 
> Til: Help R-Sig_Geo
> 
> 
> Hi, right to the point. I  am trying to load spatial layer from postgis database to R: obj
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161201/3f72c4e4/attachment.bin>

From Roger.Bivand at nhh.no  Thu Dec  1 13:38:52 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 1 Dec 2016 13:38:52 +0100
Subject: [R-sig-Geo] PostGIS layer to R using OGR driver imports^J
 unwanted raster column as String
In-Reply-To: <HK.AnN5.35sEPyTYQAw.1OG1DU@seznam.cz>
References: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
	<4F58C8D16A2DF6F4.b050fa7c-0295-4ff8-ab5c-9d4a699efe1f@mail.outlook.com>
	<Fgc.AnNM.6Odi8GU{dPt.1OFjfp@seznam.cz>
	<E953A98FD6EAA7479A68EE8C24491F6B80DC00AD@COLON.valuta.nhh.no>
	<HK.AnN5.35sEPyTYQAw.1OG1DU@seznam.cz>
Message-ID: <alpine.LFD.2.20.1612011333130.2605@reclus.nhh.no>

On Thu, 1 Dec 2016, Vilem Ded wrote:

>> Hey Vil,
>
>> I know it doesn't answer the problem of using rgdal to load PostGIS layers
>> (especially rasters), but have you tried to use rpostgis::pgGetRast to load
>> rasters in R? Might not be the most computer efficient, but should get you
>> there...
>>
>> Mathieu. 
>
> Thanks for ideas. I have already managed to load PostGIS layers with postGIStools::get_postgis_query() which gives me more flexibility.  But I would really expect that rgdal can do it too.
>
>> OK, what does ogr2ogr do in GDAL2? I do not have any experience of the driver you are using, so others will have to try to repicate - do you have a >reproducible case? What does rgdal::ogrListLayers() say?
>>
>> Roger
>
> Ok, sorry, I will try to make it more reproducible.
>
> PostgreSQL database: version psql (9.6.1, server 9.5.5)
> Postgis full version gave me:
> POSTGIS="2.2.2 r14797" GEOS="3.4.2-CAPI-1.8.2 r3921" PROJ="Rel. 4.8.0, 6 March 2012" GDAL="GDAL 1.10.1, released 2013/08/26" LIBXML="2.9.1" LIBJSON="0.11.99" (core procs from "2.2.1 r14555" need upgrade) RASTER (raster procs from "2.2.1 r14555" need upgrade)
>
> I have noticed that there is GDAL version 1.10.1 and RASTER need upgrade.
> Thus I have upgraded postgis from source.
> now Postgis full version gives me:
> POSTGIS="2.3.1 r15264" GEOS="3.6.0-CAPI-1.10.0 r0" PROJ="Rel. 4.8.0, 6 March 2012" GDAL="GDAL 2.1.2, released 2016/10/24" LIBXML="2.9.1" RASTER
>
> SQL command \d table gives:
>
>                   Table "macfish.laketable"
>         Column          |          Type           | Modifiers 
> -------------------------+-------------------------+-----------
> lt_lake                 | character varying(40)   | not null
> lt_elevation            | double precision        | 
> lt_depthrast            | raster                  | 
> lt_mac_exclude          | geometry(Polygon,32633) | 
> lt_shoreline_pol_smooth | geometry(Polygon,32633) | 
> lt_shoreline_pol_simple | geometry(Polygon,32633) | 
> lt_shoreline_pol        | geometry(Polygon,32633) |
>
>
> Spatial columns are listed in list got by sql command  "select * from geometry_columns;"
> raster has also SRID 32633  (checked with ST_SRID()) and raster column is listed in list got by sql command "select * from raster_columns ;"  as :
> r_table_catalog | r_table_schema |  r_table_name  | r_raster_column | srid  | scale_x | scale_y | blocksize_x | blocksize_y | same_alignment | regular_blocking | num_bands | pixel_types | nodata_values | out_db |  extent  | spatial_index 
> macfishdb       | macfish        | laketable      | lt_depthrast    |     0 |         |         |             |             | f              | f                |           |             |               |        |         | f
>
> command
> ogr2ogr -f "ESRI Shapefile" abc.shp PG:"dbname=DB host=HOST user=USER password=PSSWD port=5432" "SHEMA.TABLE(SPATIAL_COLUMN)"
> gives me (as before) lines:
>
> Warning 6: Normalized/laundered field name: 'lt_elevation' to 'lt_elevati'
> Warning 6: Normalized/laundered field name: 'lt_elevation' to 'lt_elevati'
> Warning 1: Value '01000001004CB551378E00F03F4CB551378E00F..... loooong string of hexadecimal values ' 
>
> After that, abc.shp contains the proper shp file. But there is still 
> column named 'lt_depthra' of length 256 chars. These are the same 
> hexadecimal characters as in Warning 1 of ogr2ogr commad.

What does ogrinfo say? Does it (for the GDAL version you are using, now 
2.1.2?) say anything other than string? Does it say what the SQL query 
says? What driver does it say that it is using (rgdal::ogrListLayers() 
below says PostgreSQL)? This must be an issue with the OGR drivers, and 
possibly competition between vector and raster drivers. This probably 
cannot be fixed at the rgdal level, probably only in GDAL or its drivers. 
Using the OGR/GDAL command line tools makes it possible to isolate the 
issue.

Roger

>
>
> In R:
> library(rgdal) gives me :
> Loading required package: sp
> rgdal: version: 1.2-4, (SVN revision 643)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 2.1.2, released 2016/10/24
> Path to GDAL shared files: /usr/local/share/gdal
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: (autodetected)
> Linking to sp version: 1.2-3 
>
>
> Command
> rgdal::ogrListLayers(dns = "dbname=DB host=HOST user=USER password=PSSWD port=5432" ) 
> gives me:
> [1] "macfish.shoreline"         "macfish.position_old"      "macfish.laketable"         "macfish.firstpos" 
> [5] "macfish.loggerspos" 
> attr(,"driver")
> [1] "PostgreSQL"
> attr(,"nlayers")
> [1] 5
>
> which is list of all tables (SHEMA.TABLE) in my database which contain one or more spatial columns.
>
> R version 3.3.2 (2016-10-31)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Debian GNU/Linux 8 (jessie)
>
> locale:
> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8 
> [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C 
> [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C 
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base 
>
> other attached packages:
> [1] rgdal_1.2-4 sp_1.2-3 
>
> loaded via a namespace (and not attached):
> [1] tools_3.3.2     grid_3.3.2      lattice_0.20-33
>
> command 
> gdal-config --version 
> gives me: 2.1.2
>
> I hope its better description. I really dont know what to provide next. I will let it be for some time (too much work). As Mathieu suggested, I can solve that by other packages than rgdal. 
> Thank you for everything :)
>
>
>
>
> ________________________________________
> Fra: Vilem Ded [Ded.V at seznam.cz]
> Sendt: 30. november 2016 2:56
> Til: Roger Bivand
> Kopi: R-Sig_Geo"
> Emne: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports  unwanted raster column as String
>
> Hi,
> thx for idea. When rgdal is attached:
>
> Loading required package: sp
> rgdal: version: 1.1-10, (SVN revision 622)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26
> Path to GDAL shared files: /usr/share/gdal/1.10
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: (autodetected)
> Linking to sp version: 1.2-3
>
> gdal-config --version  really showed version 1, so I have installed gdal2 from source.
>
> Now the rgdal attaching gives me:
>
> Loading required package: sp
> rgdal: version: 1.2-4, (SVN revision 643)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 2.1.2, released 2016/10/24
> Path to GDAL shared files: /usr/local/share/gdal
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: (autodetected)
> Linking to sp version: 1.2-3
>
> readOGR throws an error when running the same command as before:
>
> obj <- rgdal::readOGR(dsn="PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer = "SCHEMA.TABLE(LAYER)")
> Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv,  :
>  Layer not found
>
> And now ,as expected from error, function ogrInfo() works differently. It throws the same error and work only without specification of LAYER (e.g. layer = "SCHEMA.TABLE")
>
> Some more ideas? Thank you.
>
>
>
>
>
> ---------- P?vodn? zpr?va ----------
> Od: Roger Bivand
> Komu: Roger Bivand , Vilem Ded , Help
> R-Sig_Geo
> Datum: 30. 11. 2016 12:53:32
> P?edm?t: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports
> unwanted raster column as String
>
>
>
> Briefly, could you add a copy of the startup messages when rgdal is attached, and the version of gdal shown by gdal-config --version? Maybe gdal2 would do better if you are on gdal1?
>
>
> Roger
>
>
> Roger Bivand
>
> Norwegian School of Economics
>
> Bergen, Norway
>
>
>
>
> Fra: Vilem Ded
>
> Sendt: onsdag 30. november, 11.11
>
> Emne: [R-sig-Geo] PostGIS layer to R using OGR driver imports unwanted raster column as String
>
> Til: Help R-Sig_Geo
>
>
> Hi, right to the point. I  am trying to load spatial layer from postgis database to R: obj

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From martazores at gmail.com  Mon Dec  5 17:34:13 2016
From: martazores at gmail.com (marta azores)
Date: Mon, 5 Dec 2016 15:34:13 -0100
Subject: [R-sig-Geo] loop xy cbind
In-Reply-To: <CAE3WKgT8tDYCoi1D=2RiEMfXXacMgs-TzU8gdvt1xq099Oz1hQ@mail.gmail.com>
References: <CAE3WKgT8tDYCoi1D=2RiEMfXXacMgs-TzU8gdvt1xq099Oz1hQ@mail.gmail.com>
Message-ID: <CAE3WKgQKsY306=axRM2YZ8UpFZRSWs7X0eRKuoqP2LBaF49mOA@mail.gmail.com>

2016-12-05 12:52 GMT-01:00 marta azores <martazores at gmail.com>:

> Hi everyone,
> I would like to create a loop to split my dataframe with locations by
> transect, , with the objective to get 2 lines, one for each transect .
> I have this script to achieve that... but the results are different that I
> want. I only get the first position (x,y).
>
>  Anyone has an idea to fix that?
> Thanks in advance
>
> Marta
>
>
>
> #script
> #
> ###################################
> #boat <- read.table("C:/mini.csv", header=TRUE, sep=",", na.strings="NA",
> #dec=".",strip.white=TRUE)#
>
> library(plyr)
> library(loop)
>
> boat
>
> #  Idkey IdkeyL     Long1     Lat1  Date      Hour MiniSurvey Sort1 Year
> #1  1968  1968L -28.64475 38.67035 40302 0.7291667      25595     1 2010
> #2  1968  1968L -28.72917 38.66908 40302 0.7437500      25595     2 2010
> #3  1968  1968L -28.74920 38.67173 40302 0.7479167      25595     3 2010
> #4  1969  1969L -28.70907 38.66965 40302 0.7562500      25595     4 2010
> #5  1969  1969L -28.63157 38.64717 40302 0.7715278      25596     5 2010
> #6  1969  1969L -28.87397 38.26693 40303 0.3340278      25597     6 2010
> boat_split <- split(boat, boat$Idkey)
> boat_xy<-(boat_split, cbind(boat$Long1,boat$Lat1))
>
> summary(boat_split)
> #     Length Class      Mode
> #1968 9      data.frame list
> #1969 9      data.frame list
>
> new_names <- c("1968","1969")
> for (i in 1:length(boat_split)) {
>   assign(new_names[i], boat_split[[i]]);
> boat_xy<-cbind(boat$Long1[[i]],boat$Lat1[[i]])}
>
> boat_xy#results
> #     [,1]     [,2]
> #[1,] -28.72917 38.66908
>
> #However, I was expecting a list of dataframes by Idkey
> (c("1968","1969")), with the coordinates, something like that:
> $`1968`
>  -28.72917 38.66908
>  -28.72917 38.66908
>  -28.74920 38.67173
> $`1969`
>  -28.70907 38.66965
>  -28.63157 38.64717
>  -28.87397 38.26693
> class(boat_split)#list
>
> #to get lines : apply this function
> library(sp)
> Sl1 <- Line(boat_xy)
>
>
>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Wed Dec  7 17:49:46 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 7 Dec 2016 10:49:46 -0600
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
Message-ID: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>

Dear list members,

Is there a way to plot a simple features (sf) multipolygon (imported
shapefile) using ggplot2?

Similar to plotting a SpatialPolygonDataFrame  with ggplot2 using the
function fortify first to convert the SPDF to a data frame.

Best,

Manuel


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Wed Dec  7 18:21:23 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 7 Dec 2016 18:21:23 +0100
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
In-Reply-To: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
References: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
Message-ID: <cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>



On 07/12/16 17:49, Manuel Sp?nola wrote:
> Dear list members,
> 
> Is there a way to plot a simple features (sf) multipolygon (imported
> shapefile) using ggplot2?

Short answer is: not yet, I'm waiting for some help on this.

There has been quite some discussion about this issue here:

https://github.com/edzer/sfr/issues/88
> 
> Similar to plotting a SpatialPolygonDataFrame  with ggplot2 using the
> function fortify first to convert the SPDF to a data frame.
> 

I think there is now a majority opinion that fortify is not such a good
idea for simple feature (or in general: spatial) geometries.

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161207/4cfefc1e/attachment.bin>

From mdsumner at gmail.com  Wed Dec  7 23:43:48 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 07 Dec 2016 22:43:48 +0000
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
In-Reply-To: <cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
References: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
	<cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
Message-ID: <CAAcGz9_QX-Ep5j5V=8BdL61fSWcF9vLUhNE7mJsmsPwFkgEa=Q@mail.gmail.com>

On Thu, Dec 8, 2016, 04:21 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
wrote:



On 07/12/16 17:49, Manuel Sp?nola wrote:
> Dear list members,
>
> Is there a way to plot a simple features (sf) multipolygon (imported
> shapefile) using ggplot2?

Short answer is: not yet, I'm waiting for some help on this.

There has been quite some discussion about this issue here:

https://github.com/edzer/sfr/issues/88
>
> Similar to plotting a SpatialPolygonDataFrame  with ggplot2 using the
> function fortify first to convert the SPDF to a data frame.
>

I think there is now a majority opinion that fortify is not such a good
idea for simple feature (or in general: spatial) geometries.


It's not a great idea, but you can do it and it already works.

- it treats a layer as a set of grouped coordinates, rather than as
separate objects

- it wastes memory, by copying identifying attributes from the nested list
hierarchy to each coordinate

- it can't work with mixed topology types (lines and polys for example)

- it's not supported

Why not leverage the existing sp-fortify method by casting to Spatial?

library(sf)

## from ?st_read

nc <- st_read(system.file("shape/nc.shp", package="sf"), "nc", crs = 4267)

## a unique ID?

length(unique(nc$NAME)) == nrow(nc)
library(ggplot2)
nc_f <- fortify(as(nc, "Spatial"), region = "NAME")
ggplot(nc_f) + aes(x = long, y = lat, group = group, fill = id) +
ggpolypath::geom_polypath() + guides(fill = FALSE)


There are non-sp ways to do this, but none that are stable yet. Using
ggpolypath ensures that holes will work, but if you don't need holes
geom_polygon is fine.

Let me know if you have problems getting what you want, but please provide
reproducible examples.  It's not easy to navigate here, there are many
traps and it's easy to get it wrong.

(While the integrated  sf-ggplot2-geom will be awesome, it will be be
embedded within a plot-only context, and I want those idioms available
independently, and for going beyond simple features. )

Cheers, Mike.




--
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
<+49%20251%208333081>
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Thu Dec  8 05:33:44 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 7 Dec 2016 22:33:44 -0600
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
In-Reply-To: <cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
References: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
	<cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
Message-ID: <CABkCotT0xS02D2NkNNAyUvP-3Er2LTjJQ7YBHu1cU+39DTgv=Q@mail.gmail.com>

Thank you very much Edzer.

Manuel

2016-12-07 11:21 GMT-06:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:

>
>
> On 07/12/16 17:49, Manuel Sp?nola wrote:
> > Dear list members,
> >
> > Is there a way to plot a simple features (sf) multipolygon (imported
> > shapefile) using ggplot2?
>
> Short answer is: not yet, I'm waiting for some help on this.
>
> There has been quite some discussion about this issue here:
>
> https://github.com/edzer/sfr/issues/88
> >
> > Similar to plotting a SpatialPolygonDataFrame  with ggplot2 using the
> > function fortify first to convert the SPDF to a data frame.
> >
>
> I think there is now a majority opinion that fortify is not such a good
> idea for simple feature (or in general: spatial) geometries.
>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Thu Dec  8 05:34:59 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 7 Dec 2016 22:34:59 -0600
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
In-Reply-To: <CAAcGz9_QX-Ep5j5V=8BdL61fSWcF9vLUhNE7mJsmsPwFkgEa=Q@mail.gmail.com>
References: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
	<cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
	<CAAcGz9_QX-Ep5j5V=8BdL61fSWcF9vLUhNE7mJsmsPwFkgEa=Q@mail.gmail.com>
Message-ID: <CABkCotT39us119Pgu-h1ctULnZvgnGDV5+8nh7Rn3bi5vFKSEQ@mail.gmail.com>

Thank you very much Michael.

It works.

Manuel

2016-12-07 16:43 GMT-06:00 Michael Sumner <mdsumner at gmail.com>:

> On Thu, Dec 8, 2016, 04:21 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> wrote:
>
>
>
> On 07/12/16 17:49, Manuel Sp?nola wrote:
> > Dear list members,
> >
> > Is there a way to plot a simple features (sf) multipolygon (imported
> > shapefile) using ggplot2?
>
> Short answer is: not yet, I'm waiting for some help on this.
>
> There has been quite some discussion about this issue here:
>
> https://github.com/edzer/sfr/issues/88
> >
> > Similar to plotting a SpatialPolygonDataFrame  with ggplot2 using the
> > function fortify first to convert the SPDF to a data frame.
> >
>
> I think there is now a majority opinion that fortify is not such a good
> idea for simple feature (or in general: spatial) geometries.
>
>
> It's not a great idea, but you can do it and it already works.
>
> - it treats a layer as a set of grouped coordinates, rather than as
> separate objects
>
> - it wastes memory, by copying identifying attributes from the nested list
> hierarchy to each coordinate
>
> - it can't work with mixed topology types (lines and polys for example)
>
> - it's not supported
>
> Why not leverage the existing sp-fortify method by casting to Spatial?
>
> library(sf)
>
> ## from ?st_read
>
> nc <- st_read(system.file("shape/nc.shp", package="sf"), "nc", crs = 4267)
>
> ## a unique ID?
>
> length(unique(nc$NAME)) == nrow(nc)
> library(ggplot2)
> nc_f <- fortify(as(nc, "Spatial"), region = "NAME")
> ggplot(nc_f) + aes(x = long, y = lat, group = group, fill = id) +
> ggpolypath::geom_polypath() + guides(fill = FALSE)
>
>
> There are non-sp ways to do this, but none that are stable yet. Using
> ggpolypath ensures that holes will work, but if you don't need holes
> geom_polygon is fine.
>
> Let me know if you have problems getting what you want, but please provide
> reproducible examples.  It's not easy to navigate here, there are many
> traps and it's easy to get it wrong.
>
> (While the integrated  sf-ggplot2-geom will be awesome, it will be be
> embedded within a plot-only context, and I want those idioms available
> independently, and for going beyond simple features. )
>
> Cheers, Mike.
>
>
>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> <+49%20251%208333081>
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo




-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Thu Dec  8 12:19:06 2016
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 8 Dec 2016 11:19:06 +0000
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
In-Reply-To: <CAAcGz9_QX-Ep5j5V=8BdL61fSWcF9vLUhNE7mJsmsPwFkgEa=Q@mail.gmail.com>
References: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
	<cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
	<CAAcGz9_QX-Ep5j5V=8BdL61fSWcF9vLUhNE7mJsmsPwFkgEa=Q@mail.gmail.com>
Message-ID: <CANVKczNxm887P=mneqQ2BD97YrW0COrPAHAMhW_-OUi6JRuQsw@mail.gmail.com>

On Wed, Dec 7, 2016 at 10:43 PM, Michael Sumner <mdsumner at gmail.com> wrote:

> I think there is now a majority opinion that fortify is not such a good
> idea for simple feature (or in general: spatial) geometries.
>
>
> It's not a great idea, but you can do it and it already works.

It works, for some values of "works". There appears to be serious
problems if polygons are clipped using xlim and ylim. I have a feeling
I've seen this before, and possibly may even have reported it, but the
problem still exists. I have a vaguer feeling Hadley Wickham may have
even been made aware, but its also possible that I just noticed it,
went "Gah!" and carried on using base graphics without telling anyone.

Anyway, hopefully reproducible examples here. The columbus example is
especially gross:

https://gist.github.com/barryrowlingson/79f0964777496e78c57d6be825ea68f3

It seems that if a fortified data set has points that are outside the
bounding box, they are removed and then the polygon drawn from the
remaining points. This can seriously mash features, as seen in the
gist example.

But maybe its my R version (3.3.1) or my ggplot2 version (updated just
now from CRAN) or grid graphics package or graphics device?

Barry


From mdsumner at gmail.com  Thu Dec  8 12:44:30 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 08 Dec 2016 11:44:30 +0000
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
In-Reply-To: <CANVKczNxm887P=mneqQ2BD97YrW0COrPAHAMhW_-OUi6JRuQsw@mail.gmail.com>
References: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
	<cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
	<CAAcGz9_QX-Ep5j5V=8BdL61fSWcF9vLUhNE7mJsmsPwFkgEa=Q@mail.gmail.com>
	<CANVKczNxm887P=mneqQ2BD97YrW0COrPAHAMhW_-OUi6JRuQsw@mail.gmail.com>
Message-ID: <CAAcGz99rXWQoSy-Hw258_ijEvUwPOhgm-yOpZrHQaTVUq218Nw@mail.gmail.com>

On Thu, 8 Dec 2016 at 22:19 Barry Rowlingson <b.rowlingson at lancaster.ac.uk>
wrote:

> On Wed, Dec 7, 2016 at 10:43 PM, Michael Sumner <mdsumner at gmail.com>
> wrote:
>
> > I think there is now a majority opinion that fortify is not such a good
> > idea for simple feature (or in general: spatial) geometries.
> >
> >
> > It's not a great idea, but you can do it and it already works.
>
> It works, for some values of "works". There appears to be serious
> problems if polygons are clipped using xlim and ylim. I have a feeling
> I've seen this before, and possibly may even have reported it, but the
> problem still exists. I have a vaguer feeling Hadley Wickham may have
> even been made aware, but its also possible that I just noticed it,
> went "Gah!" and carried on using base graphics without telling anyone.
>
>
I suspect it's related to what's happening here too,

https://github.com/hrbrmstr/ggalt/issues/21

 there are limits to what you can do without having perfectly stretchable
infinitely precise edges (but then you are Mike Bostock:
https://bost.ocks.org/mike/example/ with the cunning trickery of ArcInfo
vectors brought into the web-age )

Sometimes you do want non-topological clipping though, it was a saviour
when I wanted this map:

https://github.com/mdsumner/tissot#som

It was good enough for the task, which is a value of "works". To me this is
where the user should be allowed to learn how things work. The faster they
can get to the "not work" result, the faster they can decide on the right
way to get their job done.

There are plenty of things that also can't be done using the proper tools
that "always work". I also say "Gah!" and sometimes more descriptive
expletives, and use whatever I need to finish it. That's good right?

I'll add this to the here-be-dragons-in-the-fish-soup list. Thanks!

Cheers, Mike.



> Anyway, hopefully reproducible examples here. The columbus example is
> especially gross:
>
> https://gist.github.com/barryrowlingson/79f0964777496e78c57d6be825ea68f3
>
> It seems that if a fortified data set has points that are outside the
> bounding box, they are removed and then the polygon drawn from the
> remaining points. This can seriously mash features, as seen in the
> gist example.
>
> But maybe its my R version (3.3.1) or my ggplot2 version (updated just
> now from CRAN) or grid graphics package or graphics device?
>
> Barry
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From thierry.onkelinx at inbo.be  Thu Dec  8 14:19:41 2016
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Thu, 8 Dec 2016 14:19:41 +0100
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
In-Reply-To: <CANVKczNxm887P=mneqQ2BD97YrW0COrPAHAMhW_-OUi6JRuQsw@mail.gmail.com>
References: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
	<cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
	<CAAcGz9_QX-Ep5j5V=8BdL61fSWcF9vLUhNE7mJsmsPwFkgEa=Q@mail.gmail.com>
	<CANVKczNxm887P=mneqQ2BD97YrW0COrPAHAMhW_-OUi6JRuQsw@mail.gmail.com>
Message-ID: <CAJuCY5yESe2Xu9amJ73CRqy-Z25dNVS9v-6ZjEeZ1_m9AiD2JQ@mail.gmail.com>

Hi Barry,

xlim(c(-100, 100)) is the ggplot shorthand for scale_x_continuous(limits =
c(-100, 100)) This sets x coordinates outside the limits to NA. The
solution is to use coord_cartesian(xlim = c(-100, 100))

See http://rpubs.com/INBOstats/zoom_in for more details and some examples.

Best regards,


ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

2016-12-08 12:19 GMT+01:00 Barry Rowlingson <b.rowlingson at lancaster.ac.uk>:

> On Wed, Dec 7, 2016 at 10:43 PM, Michael Sumner <mdsumner at gmail.com>
> wrote:
>
> > I think there is now a majority opinion that fortify is not such a good
> > idea for simple feature (or in general: spatial) geometries.
> >
> >
> > It's not a great idea, but you can do it and it already works.
>
> It works, for some values of "works". There appears to be serious
> problems if polygons are clipped using xlim and ylim. I have a feeling
> I've seen this before, and possibly may even have reported it, but the
> problem still exists. I have a vaguer feeling Hadley Wickham may have
> even been made aware, but its also possible that I just noticed it,
> went "Gah!" and carried on using base graphics without telling anyone.
>
> Anyway, hopefully reproducible examples here. The columbus example is
> especially gross:
>
> https://gist.github.com/barryrowlingson/79f0964777496e78c57d6be825ea68f3
>
> It seems that if a fortified data set has points that are outside the
> bounding box, they are removed and then the polygon drawn from the
> remaining points. This can seriously mash features, as seen in the
> gist example.
>
> But maybe its my R version (3.3.1) or my ggplot2 version (updated just
> now from CRAN) or grid graphics package or graphics device?
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Thu Dec  8 15:48:56 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 8 Dec 2016 15:48:56 +0100
Subject: [R-sig-Geo] sp::spDists*
Message-ID: <5f120dcd-0b4a-33f4-52a0-6da70a511cae@uni-muenster.de>

While building support for geosphere distance functions in sf and
comparing results from geosphere::distMeeuws with those of sp::spDists,
I found a typo in the C code underlying the great circle distance
computation functions in sp (sp::spDists, sp::spDistsN1) [*]:

https://github.com/edzer/sp/commit/d8374ff7efc6735cba9a054748c602bed0672f23

Before:
> library(sf)
Linking to GEOS 3.5.0, GDAL 2.1.0, proj.4 4.9.2
> library(sp)
> library(units)
>
> x = st_sfc(
+ st_point(c(0,0)),
+ st_point(c(1,0)),
+ st_point(c(2,0)),
+ st_point(c(3,0)),
+ crs = 4326
+ )
>
> y = st_sfc(
+ st_point(c(0,10)),
+ st_point(c(1,0)),
+ st_point(c(2,0)),
+ st_point(c(3,0)),
+ st_point(c(4,0)),
+ crs = 4326
+ )
>
> st_distance(x, y)
Units: m
        [,1]     [,2]     [,3]     [,4]     [,5]
[1,] 1105855 111319.5 222639.0 333958.5 445278.0
[2,] 1111387      0.0 111319.5 222639.0 333958.5
[3,] 1127822 111319.5      0.0 111319.5 222639.0
[4,] 1154693 222639.0 111319.5      0.0 111319.5
>
> d.sf = st_distance(x, y, geosphere::distMeeus)
> d.sp = spDists(as(x, "Spatial"), as(y, "Spatial"))
> units(d.sp) = make_unit("km")
> d.sf - d.sp
Units: m
         [,1]         [,2]         [,3]         [,4] [,5]
[1,] 1851.990 0.000000e+00 0.000000e+00 0.000000e+00    0
[2,] 1842.938 0.000000e+00 0.000000e+00 2.910383e-11    0
[3,] 1816.564 0.000000e+00 0.000000e+00 1.455192e-11    0
[4,] 1775.032 2.910383e-11 1.455192e-11 0.000000e+00    0
>



After:

> library(sf)
Linking to GEOS 3.5.0, GDAL 2.1.0, proj.4 4.9.2
> library(sp)
> library(units)
>
> x = st_sfc(
+ st_point(c(0,0)),
+ st_point(c(1,0)),
+ st_point(c(2,0)),
+ st_point(c(3,0)),
+ crs = 4326
+ )
>
> y = st_sfc(
+ st_point(c(0,10)),
+ st_point(c(1,0)),
+ st_point(c(2,0)),
+ st_point(c(3,0)),
+ st_point(c(4,0)),
+ crs = 4326
+ )
>
> st_distance(x, y)
Units: m
        [,1]     [,2]     [,3]     [,4]     [,5]
[1,] 1105855 111319.5 222639.0 333958.5 445278.0
[2,] 1111387      0.0 111319.5 222639.0 333958.5
[3,] 1127822 111319.5      0.0 111319.5 222639.0
[4,] 1154693 222639.0 111319.5      0.0 111319.5
>
> d.sf = st_distance(x, y, geosphere::distMeeus)
> d.sp = spDists(as(x, "Spatial"), as(y, "Spatial"))
> units(d.sp) = make_unit("km")
> d.sf - d.sp
Units: m
              [,1]         [,2]         [,3]         [,4] [,5]
[1,] -2.328306e-10 0.000000e+00 0.000000e+00 0.000000e+00    0
[2,]  2.328306e-10 0.000000e+00 0.000000e+00 2.910383e-11    0
[3,]  0.000000e+00 0.000000e+00 0.000000e+00 1.455192e-11    0
[4,]  0.000000e+00 2.910383e-11 1.455192e-11 0.000000e+00    0
>

[*] assuming the source code of
http://www.abecedarical.com/javascript/script_greatcircle.html is
correct; I don't have access to the Meeuws book mentioned there under (1).

The same C function is used by gstat; I corrected that as well.
-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dist.R
Type: text/x-r-source
Size: 562 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161208/a3918d17/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161208/a3918d17/attachment-0001.bin>

From b.rowlingson at lancaster.ac.uk  Thu Dec  8 16:17:18 2016
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 8 Dec 2016 15:17:18 +0000
Subject: [R-sig-Geo] Plotting simple features sf with ggplot2
In-Reply-To: <CAJuCY5yESe2Xu9amJ73CRqy-Z25dNVS9v-6ZjEeZ1_m9AiD2JQ@mail.gmail.com>
References: <CABkCotQt9J4iDtyZYxp_Wzs7CrqqHfgHHqXZpBFG4fr7rG0MMw@mail.gmail.com>
	<cd2fd7c4-3717-d3d0-04e1-78f6b406abb3@uni-muenster.de>
	<CAAcGz9_QX-Ep5j5V=8BdL61fSWcF9vLUhNE7mJsmsPwFkgEa=Q@mail.gmail.com>
	<CANVKczNxm887P=mneqQ2BD97YrW0COrPAHAMhW_-OUi6JRuQsw@mail.gmail.com>
	<CAJuCY5yESe2Xu9amJ73CRqy-Z25dNVS9v-6ZjEeZ1_m9AiD2JQ@mail.gmail.com>
Message-ID: <CANVKczM-9UNG7AGO5G-bqLWeZeO3PAA2F6RoPuuDP3pNS0pzqQ@mail.gmail.com>

Ah, sadly my vague memories and recalls didn't stretch to that.

Thanks

On Thu, Dec 8, 2016 at 1:19 PM, Thierry Onkelinx
<thierry.onkelinx at inbo.be> wrote:
> Hi Barry,
>
> xlim(c(-100, 100)) is the ggplot shorthand for scale_x_continuous(limits =
> c(-100, 100)) This sets x coordinates outside the limits to NA. The
> solution is to use coord_cartesian(xlim = c(-100, 100))
>
> See http://rpubs.com/INBOstats/zoom_in for more details and some examples.
>
> Best regards,
>
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
> Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to say
> what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
>
> 2016-12-08 12:19 GMT+01:00 Barry Rowlingson <b.rowlingson at lancaster.ac.uk>:
>
>> On Wed, Dec 7, 2016 at 10:43 PM, Michael Sumner <mdsumner at gmail.com>
>> wrote:
>>
>> > I think there is now a majority opinion that fortify is not such a good
>> > idea for simple feature (or in general: spatial) geometries.
>> >
>> >
>> > It's not a great idea, but you can do it and it already works.
>>
>> It works, for some values of "works". There appears to be serious
>> problems if polygons are clipped using xlim and ylim. I have a feeling
>> I've seen this before, and possibly may even have reported it, but the
>> problem still exists. I have a vaguer feeling Hadley Wickham may have
>> even been made aware, but its also possible that I just noticed it,
>> went "Gah!" and carried on using base graphics without telling anyone.
>>
>> Anyway, hopefully reproducible examples here. The columbus example is
>> especially gross:
>>
>> https://gist.github.com/barryrowlingson/79f0964777496e78c57d6be825ea68f3
>>
>> It seems that if a fortified data set has points that are outside the
>> bounding box, they are removed and then the polygon drawn from the
>> remaining points. This can seriously mash features, as seen in the
>> gist example.
>>
>> But maybe its my R version (3.3.1) or my ggplot2 version (updated just
>> now from CRAN) or grid graphics package or graphics device?
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mtreglia at gmail.com  Fri Dec  9 21:02:48 2016
From: mtreglia at gmail.com (Michael Treglia)
Date: Fri, 9 Dec 2016 15:02:48 -0500
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple Features
Message-ID: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>

Hi All,

Getting going with Simple Features - awesome job Developers, and thanks for
your time!

Quick question - I'm working on bringing in PostGIS layers to work with in
R - I've got the db connection made using the RPostgreSQL connection and
have successfully imported data from the public schema. However, I'm not
figuring out how to bring in layers from other schema. Sorry if I'm just
missing something obvious.

I've tried a few different iterations, as detailed below, for table 'ipis'
in schema 'staging'

Try 1: specify table without naming schema
> test <- st_read_db(conn, 'ipis')
Error in postgresqlExecStatement(conn, statement, ...) :
  RS-DBI driver: (could not Retrieve the result : ERROR:  relation "ipis"
does not exist
LINE 1: select * from  ipis ;
                       ^
)
Error in .subset2(x, i, exact = exact) : subscript out of bounds


Try 2: specify schema with table as i would in postgres directly
> test <- st_read_db(conn, 'staging.ipis')
Error in .subset2(x, i, exact = exact) : subscript out of bounds


Try 3: Specify schema as I would with RPostgreSQL operations (e.g.,
dbExistsTable)
> test <- st_read_db(conn, c('staging','ipis') )
Error in postgresqlExecStatement(conn, statement, ...) :
  RS-DBI driver: (could not Retrieve the result : ERROR:  relation
"staging" does not exist
LINE 1: select * from  staging ;
                       ^
)
Error in .subset2(x, i, exact = exact) : subscript out of bounds

I've verified R can see the table using:
> dbExistsTable(conn, c('staging','ipis'))
[1] TRUE


Thanks in advance for any suggestions!
Best,
Mike T


PS - I was originally trying to use rgdal to read these layers in, but
found rgdal did not have the PostgreSQL/PostGIS driver with it on Windows -
if that's a simple fix too, I'm all ears.

	[[alternative HTML version deleted]]


From a_roy001 at uni-muenster.de  Fri Dec  9 21:34:06 2016
From: a_roy001 at uni-muenster.de (Avipsa Roy)
Date: Fri, 09 Dec 2016 21:34:06 +0100 (CET)
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
 Features
In-Reply-To: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
Message-ID: <permail-201612092034068218e1ae000054c6-a_roy001@message-id.uni-muenster.de>

Hi Michael,

You can check if the execute permission is granted to your user id on the schema you are trying to access?

Thanks & Regards,
Avipsa Roy

Michael Treglia wrote on 2016-12-09:
> Hi All,

> Getting going with Simple Features - awesome job Developers, and thanks for
> your time!

> Quick question - I'm working on bringing in PostGIS layers to work with in
> R - I've got the db connection made using the RPostgreSQL connection and
> have successfully imported data from the public schema. However, I'm not
> figuring out how to bring in layers from other schema. Sorry if I'm just
> missing something obvious.

> I've tried a few different iterations, as detailed below, for table 'ipis'
> in schema 'staging'

> Try 1: specify table without naming schema
> > test <- st_read_db(conn, 'ipis')
> Error in postgresqlExecStatement(conn, statement, ...) :
>   RS-DBI driver: (could not Retrieve the result : ERROR:  relation "ipis"
> does not exist
> LINE 1: select * from  ipis ;
>                        ^
> )
> Error in .subset2(x, i, exact = exact) : subscript out of bounds


> Try 2: specify schema with table as i would in postgres directly
> > test <- st_read_db(conn, 'staging.ipis')
> Error in .subset2(x, i, exact = exact) : subscript out of bounds


> Try 3: Specify schema as I would with RPostgreSQL operations (e.g.,
> dbExistsTable)
> > test <- st_read_db(conn, c('staging','ipis') )
> Error in postgresqlExecStatement(conn, statement, ...) :
>   RS-DBI driver: (could not Retrieve the result : ERROR:  relation
> "staging" does not exist
> LINE 1: select * from  staging ;
>                        ^
> )
> Error in .subset2(x, i, exact = exact) : subscript out of bounds

> I've verified R can see the table using:
> > dbExistsTable(conn, c('staging','ipis'))
> [1] TRUE


> Thanks in advance for any suggestions!
> Best,
> Mike T


> PS - I was originally trying to use rgdal to read these layers in, but
> found rgdal did not have the PostgreSQL/PostGIS driver with it on Windows -
> if that's a simple fix too, I'm all ears.

> 	[[alternative HTML version deleted]]

> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jeandaniel.sylvain at gmail.com  Fri Dec  9 21:46:11 2016
From: jeandaniel.sylvain at gmail.com (jds-linux)
Date: Fri, 9 Dec 2016 15:46:11 -0500
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
 Features
In-Reply-To: <permail-201612092034068218e1ae000054c6-a_roy001@message-id.uni-muenster.de>
References: <permail-201612092034068218e1ae000054c6-a_roy001@message-id.uni-muenster.de>
Message-ID: <fee5f36a-2865-f3cb-195b-2ce1cff3cbcb@gmail.com>

Dear Michael.

To add on Avipsa answer. You may use this query to grant your user 
(maybe not full secure)

GRANT ALL ON ALL TABLES IN SCHEMA public to MICHAEL with grant option;

To my knowledge Rpostgresql does not support postgis geometry. To 
retreive geometry in R, you should take a look at Rpostgis.

https://cran.r-project.org/web/packages/rpostgis/index.html

Regards.

Jean-Daniel

On 12/09/2016 03:34 PM, Avipsa Roy wrote:
> Hi Michael,
>
> You can check if the execute permission is granted to your user id on the schema you are trying to access?
>
> Thanks & Regards,
> Avipsa Roy
>
> Michael Treglia wrote on 2016-12-09:
>> Hi All,
>> Getting going with Simple Features - awesome job Developers, and thanks for
>> your time!
>> Quick question - I'm working on bringing in PostGIS layers to work with in
>> R - I've got the db connection made using the RPostgreSQL connection and
>> have successfully imported data from the public schema. However, I'm not
>> figuring out how to bring in layers from other schema. Sorry if I'm just
>> missing something obvious.
>> I've tried a few different iterations, as detailed below, for table 'ipis'
>> in schema 'staging'
>> Try 1: specify table without naming schema
>>> test <- st_read_db(conn, 'ipis')
>> Error in postgresqlExecStatement(conn, statement, ...) :
>>    RS-DBI driver: (could not Retrieve the result : ERROR:  relation "ipis"
>> does not exist
>> LINE 1: select * from  ipis ;
>>                         ^
>> )
>> Error in .subset2(x, i, exact = exact) : subscript out of bounds
>
>> Try 2: specify schema with table as i would in postgres directly
>>> test <- st_read_db(conn, 'staging.ipis')
>> Error in .subset2(x, i, exact = exact) : subscript out of bounds
>
>> Try 3: Specify schema as I would with RPostgreSQL operations (e.g.,
>> dbExistsTable)
>>> test <- st_read_db(conn, c('staging','ipis') )
>> Error in postgresqlExecStatement(conn, statement, ...) :
>>    RS-DBI driver: (could not Retrieve the result : ERROR:  relation
>> "staging" does not exist
>> LINE 1: select * from  staging ;
>>                         ^
>> )
>> Error in .subset2(x, i, exact = exact) : subscript out of bounds
>> I've verified R can see the table using:
>>> dbExistsTable(conn, c('staging','ipis'))
>> [1] TRUE
>
>> Thanks in advance for any suggestions!
>> Best,
>> Mike T
>
>> PS - I was originally trying to use rgdal to read these layers in, but
>> found rgdal did not have the PostgreSQL/PostGIS driver with it on Windows -
>> if that's a simple fix too, I'm all ears.
>> 	[[alternative HTML version deleted]]
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Fri Dec  9 22:04:32 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 9 Dec 2016 22:04:32 +0100
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
 Features
In-Reply-To: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
References: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
Message-ID: <591bd1be-81f1-30e9-a39f-c28bbb361036@uni-muenster.de>



On 09/12/16 21:02, Michael Treglia wrote:
> Hi All,
> 
> Getting going with Simple Features - awesome job Developers, and thanks for
> your time!
> 
> Quick question - I'm working on bringing in PostGIS layers to work with in
> R - I've got the db connection made using the RPostgreSQL connection and
> have successfully imported data from the public schema. However, I'm not
> figuring out how to bring in layers from other schema. Sorry if I'm just
> missing something obvious.
> 
> I've tried a few different iterations, as detailed below, for table 'ipis'
> in schema 'staging'
> 
> Try 1: specify table without naming schema
>> test <- st_read_db(conn, 'ipis')
> Error in postgresqlExecStatement(conn, statement, ...) :
>   RS-DBI driver: (could not Retrieve the result : ERROR:  relation "ipis"
> does not exist
> LINE 1: select * from  ipis ;
>                        ^
> )
> Error in .subset2(x, i, exact = exact) : subscript out of bounds
> 
> 
> Try 2: specify schema with table as i would in postgres directly
>> test <- st_read_db(conn, 'staging.ipis')
> Error in .subset2(x, i, exact = exact) : subscript out of bounds

thanks, this doesn't work indeed; the bug is fixed, but it may take a
while until this works on windows. A work-around for now may be:

test = st_read_db(conn, table = "ipis",
   query = "select * from 'staging.ipis'")

> 
> 
> Try 3: Specify schema as I would with RPostgreSQL operations (e.g.,
> dbExistsTable)
>> test <- st_read_db(conn, c('staging','ipis') )
> Error in postgresqlExecStatement(conn, statement, ...) :
>   RS-DBI driver: (could not Retrieve the result : ERROR:  relation
> "staging" does not exist
> LINE 1: select * from  staging ;
>                        ^
> )
> Error in .subset2(x, i, exact = exact) : subscript out of bounds
> 
> I've verified R can see the table using:
>> dbExistsTable(conn, c('staging','ipis'))
> [1] TRUE
> 
> 
> Thanks in advance for any suggestions!
> Best,
> Mike T
> 
> 
> PS - I was originally trying to use rgdal to read these layers in, but
> found rgdal did not have the PostgreSQL/PostGIS driver with it on Windows -
> if that's a simple fix too, I'm all ears.

Switch to linux? Small step, these days.

> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161209/e24e29ca/attachment.bin>

From mtreglia at gmail.com  Fri Dec  9 22:20:43 2016
From: mtreglia at gmail.com (Michael Treglia)
Date: Fri, 9 Dec 2016 16:20:43 -0500
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
	Features
In-Reply-To: <permail-201612092034068218e1ae000054c6-a_roy001@message-id.uni-muenster.de>
References: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
	<permail-201612092034068218e1ae000054c6-a_roy001@message-id.uni-muenster.de>
Message-ID: <CAPKp32sZtsde2G4DtdN2-8s_5RreMPy_omqiRwGiXXxW-FQWqg@mail.gmail.com>

Hi Avipsa,

Thanks for the quick response! The role of the username is Superuser, so I
should have all permissions, right? Or is there something else I will need
to check on?

Best,
Mike


On Fri, Dec 9, 2016 at 3:34 PM, Avipsa Roy <a_roy001 at uni-muenster.de> wrote:

> Hi Michael,
>
> You can check if the execute permission is granted to your user id on the
> schema you are trying to access?
>
> Thanks & Regards,
> Avipsa Roy
>
> Michael Treglia wrote on 2016-12-09:
> > Hi All,
>
> > Getting going with Simple Features - awesome job Developers, and thanks
> for
> > your time!
>
> > Quick question - I'm working on bringing in PostGIS layers to work with
> in
> > R - I've got the db connection made using the RPostgreSQL connection and
> > have successfully imported data from the public schema. However, I'm not
> > figuring out how to bring in layers from other schema. Sorry if I'm just
> > missing something obvious.
>
> > I've tried a few different iterations, as detailed below, for table
> 'ipis'
> > in schema 'staging'
>
> > Try 1: specify table without naming schema
> > > test <- st_read_db(conn, 'ipis')
> > Error in postgresqlExecStatement(conn, statement, ...) :
> >   RS-DBI driver: (could not Retrieve the result : ERROR:  relation "ipis"
> > does not exist
> > LINE 1: select * from  ipis ;
> >                        ^
> > )
> > Error in .subset2(x, i, exact = exact) : subscript out of bounds
>
>
> > Try 2: specify schema with table as i would in postgres directly
> > > test <- st_read_db(conn, 'staging.ipis')
> > Error in .subset2(x, i, exact = exact) : subscript out of bounds
>
>
> > Try 3: Specify schema as I would with RPostgreSQL operations (e.g.,
> > dbExistsTable)
> > > test <- st_read_db(conn, c('staging','ipis') )
> > Error in postgresqlExecStatement(conn, statement, ...) :
> >   RS-DBI driver: (could not Retrieve the result : ERROR:  relation
> > "staging" does not exist
> > LINE 1: select * from  staging ;
> >                        ^
> > )
> > Error in .subset2(x, i, exact = exact) : subscript out of bounds
>
> > I've verified R can see the table using:
> > > dbExistsTable(conn, c('staging','ipis'))
> > [1] TRUE
>
>
> > Thanks in advance for any suggestions!
> > Best,
> > Mike T
>
>
> > PS - I was originally trying to use rgdal to read these layers in, but
> > found rgdal did not have the PostgreSQL/PostGIS driver with it on
> Windows -
> > if that's a simple fix too, I'm all ears.
>
> >       [[alternative HTML version deleted]]
>
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From a_roy001 at uni-muenster.de  Fri Dec  9 22:30:45 2016
From: a_roy001 at uni-muenster.de (Avipsa)
Date: Fri, 9 Dec 2016 21:30:45 +0000 (UTC)
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
 Features
In-Reply-To: <CAPKp32sZtsde2G4DtdN2-8s_5RreMPy_omqiRwGiXXxW-FQWqg@mail.gmail.com>
References: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
	<permail-201612092034068218e1ae000054c6-a_roy001@message-id.uni-muenster.de>
	<CAPKp32sZtsde2G4DtdN2-8s_5RreMPy_omqiRwGiXXxW-FQWqg@mail.gmail.com>
Message-ID: <D6046D4890211996.4E8F91A3-186A-4339-A002-6F4241C626E9@mail.outlook.com>

Hi Michael,
Ideally if you are the superuser you should have access to all tables and schemas. Sometimes it happens that when you make an odbc connection from R you still need to explicitly grant access to non-public/user-specific tables. I would suggest to use the GRANT ALL ON <SCHEMA> TO <USER> , as Edzer mentioned in the previous email.
Thanks & Regards,
Avipsa Roy
Institute f?r Geoinformatics 
Westf?lische Wilhelms- Universit?t M?nster

		_____________________________
From: Michael Treglia <mtreglia at gmail.com>
Sent: Friday, December 9, 2016 10:20 PM
Subject: Re: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple Features
To: Avipsa Roy <a_roy001 at uni-muenster.de>
Cc:  <r-sig-geo at r-project.org>


Hi Avipsa,
Thanks for the quick response! The role of the username is Superuser, so I should have all permissions, right? Or is there something else I will need to check on?
Best,Mike

On Fri, Dec 9, 2016 at 3:34 PM, Avipsa Roy <a_roy001 at uni-muenster.de> wrote:
Hi Michael,

You can check if the execute permission is granted to your user id on the schema you are trying to access?

Thanks & Regards,
Avipsa Roy

Michael Treglia wrote on 2016-12-09:
> Hi All,

> Getting going with Simple Features - awesome job Developers, and thanks for
> your time!

> Quick question - I'm working on bringing in PostGIS layers to work with in
> R - I've got the db connection made using the RPostgreSQL connection and
> have successfully imported data from the public schema. However, I'm not
> figuring out how to bring in layers from other schema. Sorry if I'm just
> missing something obvious.

> I've tried a few different iterations, as detailed below, for table 'ipis'
> in schema 'staging'

> Try 1: specify table without naming schema
> > test <- st_read_db(conn, 'ipis')
> Error in postgresqlExecStatement(conn, statement, ...) :
>? ?RS-DBI driver: (could not Retrieve the result : ERROR:? relation "ipis"
> does not exist
> LINE 1: select * from? ipis ;
>? ? ? ? ? ? ? ? ? ? ? ? ^
> )
> Error in .subset2(x, i, exact = exact) : subscript out of bounds


> Try 2: specify schema with table as i would in postgres directly
> > test <- st_read_db(conn, 'staging.ipis')
> Error in .subset2(x, i, exact = exact) : subscript out of bounds


> Try 3: Specify schema as I would with RPostgreSQL operations (e.g.,
> dbExistsTable)
> > test <- st_read_db(conn, c('staging','ipis') )
> Error in postgresqlExecStatement(conn, statement, ...) :
>? ?RS-DBI driver: (could not Retrieve the result : ERROR:? relation
> "staging" does not exist
> LINE 1: select * from? staging ;
>? ? ? ? ? ? ? ? ? ? ? ? ^
> )
> Error in .subset2(x, i, exact = exact) : subscript out of bounds

> I've verified R can see the table using:
> > dbExistsTable(conn, c('staging','ipis'))
> [1] TRUE


> Thanks in advance for any suggestions!
> Best,
> Mike T


> PS - I was originally trying to use rgdal to read these layers in, but
> found rgdal did not have the PostgreSQL/PostGIS driver with it on Windows -
> if that's a simple fix too, I'm all ears.

>? ? ? ?[[alternative HTML version deleted]]

> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo




	
	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Sat Dec 10 00:06:19 2016
From: mtreglia at gmail.com (Michael Treglia)
Date: Fri, 9 Dec 2016 18:06:19 -0500
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
	Features
In-Reply-To: <591bd1be-81f1-30e9-a39f-c28bbb361036@uni-muenster.de>
References: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
	<591bd1be-81f1-30e9-a39f-c28bbb361036@uni-muenster.de>
Message-ID: <CAPKp32uCySSFvwnp_ipe6o8kH5yqG78J5xW9UfZapM0HG=mbqA@mail.gmail.com>

Thanks so much, everybody.

Edzer - your primary fix works - tested on Windows and on an Ubuntu VM. (I
installed from GitHub on both - my Ubuntu VM was behind on things, so it
was a good excuse to upgrade gdal, etc. there :-)) Thanks for the quick fix!

just FYI, Your alternative suggestion threw an error though:

>   test = st_read_db(conn, table = "ipis",
+    query = "select * from 'staging.ipis'")
Error in postgresqlExecStatement(conn, statement, ...) :
  RS-DBI driver: (could not Retrieve the result : ERROR:  syntax error at
or near "'staging.ipis'"
LINE 1: select * from 'staging.ipis'
                      ^
)
Error in CPL_hex_to_raw(sapply(x, skip0x, USE.NAMES = FALSE)) :
  not compatible with STRSXP




On Fri, Dec 9, 2016 at 4:04 PM, Edzer Pebesma <edzer.pebesma at uni-muenster.de
> wrote:

>
>
> On 09/12/16 21:02, Michael Treglia wrote:
> > Hi All,
> >
> > Getting going with Simple Features - awesome job Developers, and thanks
> for
> > your time!
> >
> > Quick question - I'm working on bringing in PostGIS layers to work with
> in
> > R - I've got the db connection made using the RPostgreSQL connection and
> > have successfully imported data from the public schema. However, I'm not
> > figuring out how to bring in layers from other schema. Sorry if I'm just
> > missing something obvious.
> >
> > I've tried a few different iterations, as detailed below, for table
> 'ipis'
> > in schema 'staging'
> >
> > Try 1: specify table without naming schema
> >> test <- st_read_db(conn, 'ipis')
> > Error in postgresqlExecStatement(conn, statement, ...) :
> >   RS-DBI driver: (could not Retrieve the result : ERROR:  relation "ipis"
> > does not exist
> > LINE 1: select * from  ipis ;
> >                        ^
> > )
> > Error in .subset2(x, i, exact = exact) : subscript out of bounds
> >
> >
> > Try 2: specify schema with table as i would in postgres directly
> >> test <- st_read_db(conn, 'staging.ipis')
> > Error in .subset2(x, i, exact = exact) : subscript out of bounds
>
> thanks, this doesn't work indeed; the bug is fixed, but it may take a
> while until this works on windows. A work-around for now may be:
>
> test = st_read_db(conn, table = "ipis",
>    query = "select * from 'staging.ipis'")


> >
> >
> > Try 3: Specify schema as I would with RPostgreSQL operations (e.g.,
> > dbExistsTable)
> >> test <- st_read_db(conn, c('staging','ipis') )
> > Error in postgresqlExecStatement(conn, statement, ...) :
> >   RS-DBI driver: (could not Retrieve the result : ERROR:  relation
> > "staging" does not exist
> > LINE 1: select * from  staging ;
> >                        ^
> > )
> > Error in .subset2(x, i, exact = exact) : subscript out of bounds
> >
> > I've verified R can see the table using:
> >> dbExistsTable(conn, c('staging','ipis'))
> > [1] TRUE
> >
> >
> > Thanks in advance for any suggestions!
> > Best,
> > Mike T
> >
> >
> > PS - I was originally trying to use rgdal to read these layers in, but
> > found rgdal did not have the PostgreSQL/PostGIS driver with it on
> Windows -
> > if that's a simple fix too, I'm all ears.
>
> Switch to linux? Small step, these days.
>

Definitely - I often use a Linux VM as mentioned above, but like to have
things running across envs when I can. (with sf working for me, given your
fix, I'm all set for now!)

Best,
mike

>
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Lee.Hachadoorian+L at gmail.com  Sat Dec 10 01:47:47 2016
From: Lee.Hachadoorian+L at gmail.com (Lee Hachadoorian)
Date: Fri, 9 Dec 2016 19:47:47 -0500
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
	Features
In-Reply-To: <CAPKp32uCySSFvwnp_ipe6o8kH5yqG78J5xW9UfZapM0HG=mbqA@mail.gmail.com>
References: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
	<591bd1be-81f1-30e9-a39f-c28bbb361036@uni-muenster.de>
	<CAPKp32uCySSFvwnp_ipe6o8kH5yqG78J5xW9UfZapM0HG=mbqA@mail.gmail.com>
Message-ID: <CANnCtnLwUtc_xNzddz2yBpq-_WrVrnf34mG3t2TUyOoubsPzRA@mail.gmail.com>

On Fri, Dec 9, 2016 at 6:06 PM, Michael Treglia <mtreglia at gmail.com> wrote:

> > >
> > > PS - I was originally trying to use rgdal to read these layers in, but
> > > found rgdal did not have the PostgreSQL/PostGIS driver with it on
> > Windows -
> > > if that's a simple fix too, I'm all ears.
> >
> > Switch to linux? Small step, these days.
> >
>
> Definitely - I often use a Linux VM as mentioned above, but like to have
> things running across envs when I can. (with sf working for me, given your
> fix, I'm all set for now!)
>

A couple of years ago I wrote a function that can load PostGIS geometries
using RPostgreSQL instead of rgdal. It converts to WKT in SQL and then
converts the WKT to R spatial objects using the rgeos library.

Code below. Blogged here:
https://geospatial.commons.gc.cuny.edu/2014/01/14/load-postgis-geometries-in-r-without-rgdal/

```
library(RPostgreSQL)
library(rgeos)
library(sp)

# Load data from the PostGIS server
conn = dbConnect(
  dbDriver("PostgreSQL"), dbname=dbname, host=host, port=5432,
  user=user, password=password
  )

strSQL = "
  SELECT gid, ST_AsText(geom) AS wkt_geometry, attr1, attr2[, ...]
  FROM geo_layer"
dfTemp = dbGetQuery(conn, strSQL)
row.names(dfTemp) = dfTemp$gid

# Create spatial polygons
# To set the PROJ4 string, enter the EPSG SRID and uncomment the
# following two lines:
# EPSG = make_EPSG()
# p4s = EPSG[which(EPSG$code == SRID), "prj4"]
for (i in seq(nrow(dfTemp))) {
  if (i == 1) {
    spTemp = readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i])
    # If the PROJ4 string has been set, use the following instead
    # spTemp = readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i], p4s)
  }
  else {
    spTemp = rbind(
      spTemp, readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i])
      # If the PROJ4 string has been set, use the following instead
      # spTemp, readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i], p4s)
    )
  }
}

# Create SpatialPolygonsDataFrame, drop WKT field from attributes
spdfFinal = SpatialPolygonsDataFrame(spTemp, dfTemp[-2])
```

-- 
Lee Hachadoorian
Assistant Professor of Instruction, Geography and Urban Studies
Assistant Director, Professional Science Master's in GIS
Temple University

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Sun Dec 11 00:02:24 2016
From: mtreglia at gmail.com (Michael Treglia)
Date: Sat, 10 Dec 2016 18:02:24 -0500
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
	Features
In-Reply-To: <CANnCtnLwUtc_xNzddz2yBpq-_WrVrnf34mG3t2TUyOoubsPzRA@mail.gmail.com>
References: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
	<591bd1be-81f1-30e9-a39f-c28bbb361036@uni-muenster.de>
	<CAPKp32uCySSFvwnp_ipe6o8kH5yqG78J5xW9UfZapM0HG=mbqA@mail.gmail.com>
	<CANnCtnLwUtc_xNzddz2yBpq-_WrVrnf34mG3t2TUyOoubsPzRA@mail.gmail.com>
Message-ID: <CAPKp32v+4Mbz9fWAVNrP8Jco_-QzygtqKZV4+43DEdxMF1uHKA@mail.gmail.com>

Oh, cool Lee! That's great to have around!

Thanks,
Mike

On Fri, Dec 9, 2016 at 7:47 PM, Lee Hachadoorian <
Lee.Hachadoorian+L at gmail.com> wrote:

>
>
> On Fri, Dec 9, 2016 at 6:06 PM, Michael Treglia <mtreglia at gmail.com>
> wrote:
>
>> > >
>> > > PS - I was originally trying to use rgdal to read these layers in, but
>> > > found rgdal did not have the PostgreSQL/PostGIS driver with it on
>> > Windows -
>> > > if that's a simple fix too, I'm all ears.
>> >
>> > Switch to linux? Small step, these days.
>> >
>>
>> Definitely - I often use a Linux VM as mentioned above, but like to have
>> things running across envs when I can. (with sf working for me, given your
>> fix, I'm all set for now!)
>>
>
> A couple of years ago I wrote a function that can load PostGIS geometries
> using RPostgreSQL instead of rgdal. It converts to WKT in SQL and then
> converts the WKT to R spatial objects using the rgeos library.
>
> Code below. Blogged here: https://geospatial.commons.gc.cuny.edu/2014/01/
> 14/load-postgis-geometries-in-r-without-rgdal/
>
> ```
> library(RPostgreSQL)
> library(rgeos)
> library(sp)
>
> # Load data from the PostGIS server
> conn = dbConnect(
>   dbDriver("PostgreSQL"), dbname=dbname, host=host, port=5432,
>   user=user, password=password
>   )
>
> strSQL = "
>   SELECT gid, ST_AsText(geom) AS wkt_geometry, attr1, attr2[, ...]
>   FROM geo_layer"
> dfTemp = dbGetQuery(conn, strSQL)
> row.names(dfTemp) = dfTemp$gid
>
> # Create spatial polygons
> # To set the PROJ4 string, enter the EPSG SRID and uncomment the
> # following two lines:
> # EPSG = make_EPSG()
> # p4s = EPSG[which(EPSG$code == SRID), "prj4"]
> for (i in seq(nrow(dfTemp))) {
>   if (i == 1) {
>     spTemp = readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i])
>     # If the PROJ4 string has been set, use the following instead
>     # spTemp = readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i], p4s)
>   }
>   else {
>     spTemp = rbind(
>       spTemp, readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i])
>       # If the PROJ4 string has been set, use the following instead
>       # spTemp, readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i], p4s)
>     )
>   }
> }
>
> # Create SpatialPolygonsDataFrame, drop WKT field from attributes
> spdfFinal = SpatialPolygonsDataFrame(spTemp, dfTemp[-2])
> ```
>
> --
> Lee Hachadoorian
> Assistant Professor of Instruction, Geography and Urban Studies
> Assistant Director, Professional Science Master's in GIS
> Temple University
>

	[[alternative HTML version deleted]]


From basille.web at ase-research.org  Sun Dec 11 07:25:38 2016
From: basille.web at ase-research.org (Mathieu Basille)
Date: Sun, 11 Dec 2016 01:25:38 -0500
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
 Features
In-Reply-To: <CAPKp32v+4Mbz9fWAVNrP8Jco_-QzygtqKZV4+43DEdxMF1uHKA@mail.gmail.com>
References: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
	<591bd1be-81f1-30e9-a39f-c28bbb361036@uni-muenster.de>
	<CAPKp32uCySSFvwnp_ipe6o8kH5yqG78J5xW9UfZapM0HG=mbqA@mail.gmail.com>
	<CANnCtnLwUtc_xNzddz2yBpq-_WrVrnf34mG3t2TUyOoubsPzRA@mail.gmail.com>
	<CAPKp32v+4Mbz9fWAVNrP8Jco_-QzygtqKZV4+43DEdxMF1uHKA@mail.gmail.com>
Message-ID: <0f8b0210-df30-e460-b905-c5fb576b1612@ase-research.org>

Hi Michael,

As pointed out earlier in that thread by Jean-Daniel, if you're only
interested in loading PostGIS geometries in R, and not in Simple Features
themselves, you may want to give a look at rpostgis, which present a
standard and flexible solution (using rgeos and RPostgreSQL in the background):

https://cran.r-project.org/package=rpostgis

Mathieu.


On 12/10/2016 06:02 PM, Michael Treglia wrote:
> Oh, cool Lee! That's great to have around!
> 
> Thanks,
> Mike
> 
> On Fri, Dec 9, 2016 at 7:47 PM, Lee Hachadoorian <
> Lee.Hachadoorian+L at gmail.com> wrote:
> 
>>
>>
>> On Fri, Dec 9, 2016 at 6:06 PM, Michael Treglia <mtreglia at gmail.com>
>> wrote:
>>
>>>>>
>>>>> PS - I was originally trying to use rgdal to read these layers in, but
>>>>> found rgdal did not have the PostgreSQL/PostGIS driver with it on
>>>> Windows -
>>>>> if that's a simple fix too, I'm all ears.
>>>>
>>>> Switch to linux? Small step, these days.
>>>>
>>>
>>> Definitely - I often use a Linux VM as mentioned above, but like to have
>>> things running across envs when I can. (with sf working for me, given your
>>> fix, I'm all set for now!)
>>>
>>
>> A couple of years ago I wrote a function that can load PostGIS geometries
>> using RPostgreSQL instead of rgdal. It converts to WKT in SQL and then
>> converts the WKT to R spatial objects using the rgeos library.
>>
>> Code below. Blogged here: https://geospatial.commons.gc.cuny.edu/2014/01/
>> 14/load-postgis-geometries-in-r-without-rgdal/
>>
>> ```
>> library(RPostgreSQL)
>> library(rgeos)
>> library(sp)
>>
>> # Load data from the PostGIS server
>> conn = dbConnect(
>>   dbDriver("PostgreSQL"), dbname=dbname, host=host, port=5432,
>>   user=user, password=password
>>   )
>>
>> strSQL = "
>>   SELECT gid, ST_AsText(geom) AS wkt_geometry, attr1, attr2[, ...]
>>   FROM geo_layer"
>> dfTemp = dbGetQuery(conn, strSQL)
>> row.names(dfTemp) = dfTemp$gid
>>
>> # Create spatial polygons
>> # To set the PROJ4 string, enter the EPSG SRID and uncomment the
>> # following two lines:
>> # EPSG = make_EPSG()
>> # p4s = EPSG[which(EPSG$code == SRID), "prj4"]
>> for (i in seq(nrow(dfTemp))) {
>>   if (i == 1) {
>>     spTemp = readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i])
>>     # If the PROJ4 string has been set, use the following instead
>>     # spTemp = readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i], p4s)
>>   }
>>   else {
>>     spTemp = rbind(
>>       spTemp, readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i])
>>       # If the PROJ4 string has been set, use the following instead
>>       # spTemp, readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i], p4s)
>>     )
>>   }
>> }
>>
>> # Create SpatialPolygonsDataFrame, drop WKT field from attributes
>> spdfFinal = SpatialPolygonsDataFrame(spTemp, dfTemp[-2])
>> ```
>>
>> --
>> Lee Hachadoorian
>> Assistant Professor of Instruction, Geography and Urban Studies
>> Assistant Director, Professional Science Master's in GIS
>> Temple University
>>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 

Mathieu Basille

basille at ufl.edu | http://ase-research.org/basille
+1 954-577-6314 | University of Florida FLREC

  ? Le tout est de tout dire, et je manque de mots
  Et je manque de temps, et je manque d'audace. ?
  ? Paul ?luard

This message is signed to guarantee its authenticity.
For a true private correspondence, use my public key
to encrypt your messages:

  http://mathieu.basille.net/pub.asc

Learn more: http://mzl.la/1BsOGiZ


From mtreglia at gmail.com  Mon Dec 12 16:42:47 2016
From: mtreglia at gmail.com (Michael Treglia)
Date: Mon, 12 Dec 2016 10:42:47 -0500
Subject: [R-sig-Geo] Specifying Schema for PostGIS Layer with Simple
	Features
In-Reply-To: <0f8b0210-df30-e460-b905-c5fb576b1612@ase-research.org>
References: <CAPKp32tTB-rop409C7Aiwa7SMfHFCUaeYo8iP-f5CYSu6KmekQ@mail.gmail.com>
	<591bd1be-81f1-30e9-a39f-c28bbb361036@uni-muenster.de>
	<CAPKp32uCySSFvwnp_ipe6o8kH5yqG78J5xW9UfZapM0HG=mbqA@mail.gmail.com>
	<CANnCtnLwUtc_xNzddz2yBpq-_WrVrnf34mG3t2TUyOoubsPzRA@mail.gmail.com>
	<CAPKp32v+4Mbz9fWAVNrP8Jco_-QzygtqKZV4+43DEdxMF1uHKA@mail.gmail.com>
	<0f8b0210-df30-e460-b905-c5fb576b1612@ase-research.org>
Message-ID: <CAPKp32vz0-fk_vEuvA3NQ8h0Jm=Drqb1cQzp000mOfELAcdO8w@mail.gmail.com>

Thanks so much Matthieu! This looks like a great package!

Best,
Mike

On Sun, Dec 11, 2016 at 1:25 AM, Mathieu Basille <
basille.web at ase-research.org> wrote:

> Hi Michael,
>
> As pointed out earlier in that thread by Jean-Daniel, if you're only
> interested in loading PostGIS geometries in R, and not in Simple Features
> themselves, you may want to give a look at rpostgis, which present a
> standard and flexible solution (using rgeos and RPostgreSQL in the
> background):
>
> https://cran.r-project.org/package=rpostgis
>
> Mathieu.
>
>
> On 12/10/2016 06:02 PM, Michael Treglia wrote:
> > Oh, cool Lee! That's great to have around!
> >
> > Thanks,
> > Mike
> >
> > On Fri, Dec 9, 2016 at 7:47 PM, Lee Hachadoorian <
> > Lee.Hachadoorian+L at gmail.com> wrote:
> >
> >>
> >>
> >> On Fri, Dec 9, 2016 at 6:06 PM, Michael Treglia <mtreglia at gmail.com>
> >> wrote:
> >>
> >>>>>
> >>>>> PS - I was originally trying to use rgdal to read these layers in,
> but
> >>>>> found rgdal did not have the PostgreSQL/PostGIS driver with it on
> >>>> Windows -
> >>>>> if that's a simple fix too, I'm all ears.
> >>>>
> >>>> Switch to linux? Small step, these days.
> >>>>
> >>>
> >>> Definitely - I often use a Linux VM as mentioned above, but like to
> have
> >>> things running across envs when I can. (with sf working for me, given
> your
> >>> fix, I'm all set for now!)
> >>>
> >>
> >> A couple of years ago I wrote a function that can load PostGIS
> geometries
> >> using RPostgreSQL instead of rgdal. It converts to WKT in SQL and then
> >> converts the WKT to R spatial objects using the rgeos library.
> >>
> >> Code below. Blogged here: https://geospatial.commons.gc.
> cuny.edu/2014/01/
> >> 14/load-postgis-geometries-in-r-without-rgdal/
> >>
> >> ```
> >> library(RPostgreSQL)
> >> library(rgeos)
> >> library(sp)
> >>
> >> # Load data from the PostGIS server
> >> conn = dbConnect(
> >>   dbDriver("PostgreSQL"), dbname=dbname, host=host, port=5432,
> >>   user=user, password=password
> >>   )
> >>
> >> strSQL = "
> >>   SELECT gid, ST_AsText(geom) AS wkt_geometry, attr1, attr2[, ...]
> >>   FROM geo_layer"
> >> dfTemp = dbGetQuery(conn, strSQL)
> >> row.names(dfTemp) = dfTemp$gid
> >>
> >> # Create spatial polygons
> >> # To set the PROJ4 string, enter the EPSG SRID and uncomment the
> >> # following two lines:
> >> # EPSG = make_EPSG()
> >> # p4s = EPSG[which(EPSG$code == SRID), "prj4"]
> >> for (i in seq(nrow(dfTemp))) {
> >>   if (i == 1) {
> >>     spTemp = readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i])
> >>     # If the PROJ4 string has been set, use the following instead
> >>     # spTemp = readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i], p4s)
> >>   }
> >>   else {
> >>     spTemp = rbind(
> >>       spTemp, readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i])
> >>       # If the PROJ4 string has been set, use the following instead
> >>       # spTemp, readWKT(dfTemp$wkt_geometry[i], dfTemp$gid[i], p4s)
> >>     )
> >>   }
> >> }
> >>
> >> # Create SpatialPolygonsDataFrame, drop WKT field from attributes
> >> spdfFinal = SpatialPolygonsDataFrame(spTemp, dfTemp[-2])
> >> ```
> >>
> >> --
> >> Lee Hachadoorian
> >> Assistant Professor of Instruction, Geography and Urban Studies
> >> Assistant Director, Professional Science Master's in GIS
> >> Temple University
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
>
> Mathieu Basille
>
> basille at ufl.edu | http://ase-research.org/basille
> +1 954-577-6314 | University of Florida FLREC
>
>   ? Le tout est de tout dire, et je manque de mots
>   Et je manque de temps, et je manque d'audace. ?
>   ? Paul ?luard
>
> This message is signed to guarantee its authenticity.
> For a true private correspondence, use my public key
> to encrypt your messages:
>
>   http://mathieu.basille.net/pub.asc
>
> Learn more: http://mzl.la/1BsOGiZ
>
>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Tue Dec 13 19:28:06 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 13 Dec 2016 12:28:06 -0600
Subject: [R-sig-Geo] Landscape connectivity in R
Message-ID: <CABkCotQdKFbz6wRsor+EbxyPbO0eMopytc8QpnoNw0nqtXSGNQ@mail.gmail.com>

Dear list members,

Is there any R package, besides grainscape, to assess landscape
connectivity?

Best,

Manuel

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From r-sig-geo at forreststevens.com  Tue Dec 13 20:31:30 2016
From: r-sig-geo at forreststevens.com (Forrest Stevens)
Date: Tue, 13 Dec 2016 19:31:30 +0000
Subject: [R-sig-Geo] Landscape connectivity in R
In-Reply-To: <CABkCotQdKFbz6wRsor+EbxyPbO0eMopytc8QpnoNw0nqtXSGNQ@mail.gmail.com>
References: <CABkCotQdKFbz6wRsor+EbxyPbO0eMopytc8QpnoNw0nqtXSGNQ@mail.gmail.com>
Message-ID: <CAEBQMM=oMBWWms_EiZJin7c-jpa_PQGMdOTYfkx9_sWVC9eY_w@mail.gmail.com>

Check out sdmtools if fragstats like patch/class metrics are what you're
looking for: https://cran.r-project.org/web/packages/SDMTools/index.html

Sincerely,
Forrest

On Tue, Dec 13, 2016 at 1:29 PM Manuel Sp?nola <mspinola10 at gmail.com> wrote:

> Dear list members,
>
> Is there any R package, besides grainscape, to assess landscape
> connectivity?
>
> Best,
>
> Manuel
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Tue Dec 13 20:43:34 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 13 Dec 2016 13:43:34 -0600
Subject: [R-sig-Geo] Landscape connectivity in R
In-Reply-To: <CAEBQMM=oMBWWms_EiZJin7c-jpa_PQGMdOTYfkx9_sWVC9eY_w@mail.gmail.com>
References: <CABkCotQdKFbz6wRsor+EbxyPbO0eMopytc8QpnoNw0nqtXSGNQ@mail.gmail.com>
	<CAEBQMM=oMBWWms_EiZJin7c-jpa_PQGMdOTYfkx9_sWVC9eY_w@mail.gmail.com>
Message-ID: <CABkCotSauiFrqTXnymtANkJx2Ah4_emnee80-hEvF0aeFf0qwA@mail.gmail.com>

Thank you very much Forrest.

I am looking for something different related to landscape connectivity
(corredor design).  Your suggestion is more for landscape metrics for what
I usually use the land.metrics function from the SpatialEco package for
that.

Best,

Manuel

2016-12-13 13:31 GMT-06:00 Forrest Stevens <r-sig-geo at forreststevens.com>:

> Check out sdmtools if fragstats like patch/class metrics are what you're
> looking for: https://cran.r-project.org/web/packages/SDMTools/index.html
>
> Sincerely,
> Forrest
>
> On Tue, Dec 13, 2016 at 1:29 PM Manuel Sp?nola <mspinola10 at gmail.com>
> wrote:
>
>> Dear list members,
>>
>> Is there any R package, besides grainscape, to assess landscape
>> connectivity?
>>
>> Best,
>>
>> Manuel
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.cr <mspinola at una.ac.cr>
>> mspinola10 at gmail.com
>> Tel?fono: (506) 8706 - 4662
>> Personal website: Lobito de r?o <https://sites.google.com/
>> site/lobitoderio/>
>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From jerome.mathieu at upmc.fr  Tue Dec 13 21:00:21 2016
From: jerome.mathieu at upmc.fr (=?UTF-8?Q?J=C3=A9rome_Mathieu?=)
Date: Tue, 13 Dec 2016 21:00:21 +0100
Subject: [R-sig-Geo] Landscape connectivity in R
In-Reply-To: <CABkCotSauiFrqTXnymtANkJx2Ah4_emnee80-hEvF0aeFf0qwA@mail.gmail.com>
References: <CABkCotQdKFbz6wRsor+EbxyPbO0eMopytc8QpnoNw0nqtXSGNQ@mail.gmail.com>
	<CAEBQMM=oMBWWms_EiZJin7c-jpa_PQGMdOTYfkx9_sWVC9eY_w@mail.gmail.com>
	<CABkCotSauiFrqTXnymtANkJx2Ah4_emnee80-hEvF0aeFf0qwA@mail.gmail.com>
Message-ID: <CALEhSiRLk_Ktc4QKwXTsDohBZt5oiS=KUy1VfYDSmbtL9kokWg@mail.gmail.com>

Hi Manuel,

Perhaps the package "gdistance" can do what you're looking for.

Jerome

2016-12-13 20:43 GMT+01:00 Manuel Sp?nola <mspinola10 at gmail.com>:

> Thank you very much Forrest.
>
> I am looking for something different related to landscape connectivity
> (corredor design).  Your suggestion is more for landscape metrics for what
> I usually use the land.metrics function from the SpatialEco package for
> that.
>
> Best,
>
> Manuel
>
> 2016-12-13 13:31 GMT-06:00 Forrest Stevens <r-sig-geo at forreststevens.com>:
>
> > Check out sdmtools if fragstats like patch/class metrics are what you're
> > looking for: https://cran.r-project.org/web/packages/SDMTools/index.html
> >
> > Sincerely,
> > Forrest
> >
> > On Tue, Dec 13, 2016 at 1:29 PM Manuel Sp?nola <mspinola10 at gmail.com>
> > wrote:
> >
> >> Dear list members,
> >>
> >> Is there any R package, besides grainscape, to assess landscape
> >> connectivity?
> >>
> >> Best,
> >>
> >> Manuel
> >>
> >> --
> >> *Manuel Sp?nola, Ph.D.*
> >> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> >> Universidad Nacional
> >> Apartado 1350-3000
> >> Heredia
> >> COSTA RICA
> >> mspinola at una.cr <mspinola at una.ac.cr>
> >> mspinola10 at gmail.com
> >> Tel?fono: (506) 8706 - 4662
> >> Personal website: Lobito de r?o <https://sites.google.com/
> >> site/lobitoderio/>
> >> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <https://sites.google.com/
> site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
J?r?me Mathieu <http://www.jerome-mathieu.com/>
Universit? Pierre & Marie Curie <http://www.upmc.fr/>
Institute of Ecology and Environmental Science (Paris)
<https://ieesparis.ufr918.upmc.fr/>
Team EERI

4 place Jussieu
Tour 44-45, 5th floor, door 514
75005 Paris

tel: 01 44 27 34 22

	[[alternative HTML version deleted]]


From zaholdenfs at gmail.com  Tue Dec 13 21:29:58 2016
From: zaholdenfs at gmail.com (Zack Holden)
Date: Tue, 13 Dec 2016 13:29:58 -0700
Subject: [R-sig-Geo] Landscape connectivity in R
In-Reply-To: <CABkCotSauiFrqTXnymtANkJx2Ah4_emnee80-hEvF0aeFf0qwA@mail.gmail.com>
References: <CABkCotQdKFbz6wRsor+EbxyPbO0eMopytc8QpnoNw0nqtXSGNQ@mail.gmail.com>
	<CAEBQMM=oMBWWms_EiZJin7c-jpa_PQGMdOTYfkx9_sWVC9eY_w@mail.gmail.com>
	<CABkCotSauiFrqTXnymtANkJx2Ah4_emnee80-hEvF0aeFf0qwA@mail.gmail.com>
Message-ID: <CAGC_mZQ3n5eNq70rmoPVkrkKJWsrYKO=hRpzE2H5msPp9Ew_2Q@mail.gmail.com>

Hi Manuel,
You may want to check out the gdistance library.

https://cran.r-project.org/web/packages/gdistance/gdistance.pdf

Zack


On Tue, Dec 13, 2016 at 12:43 PM, Manuel Sp?nola <mspinola10 at gmail.com>
wrote:

> Thank you very much Forrest.
>
> I am looking for something different related to landscape connectivity
> (corredor design).  Your suggestion is more for landscape metrics for what
> I usually use the land.metrics function from the SpatialEco package for
> that.
>
> Best,
>
> Manuel
>
> 2016-12-13 13:31 GMT-06:00 Forrest Stevens <r-sig-geo at forreststevens.com>:
>
> > Check out sdmtools if fragstats like patch/class metrics are what you're
> > looking for: https://cran.r-project.org/web/packages/SDMTools/index.html
> >
> > Sincerely,
> > Forrest
> >
> > On Tue, Dec 13, 2016 at 1:29 PM Manuel Sp?nola <mspinola10 at gmail.com>
> > wrote:
> >
> >> Dear list members,
> >>
> >> Is there any R package, besides grainscape, to assess landscape
> >> connectivity?
> >>
> >> Best,
> >>
> >> Manuel
> >>
> >> --
> >> *Manuel Sp?nola, Ph.D.*
> >> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> >> Universidad Nacional
> >> Apartado 1350-3000
> >> Heredia
> >> COSTA RICA
> >> mspinola at una.cr <mspinola at una.ac.cr>
> >> mspinola10 at gmail.com
> >> Tel?fono: (506) 8706 - 4662
> >> Personal website: Lobito de r?o <https://sites.google.com/
> >> site/lobitoderio/>
> >> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <https://sites.google.com/
> site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From reudenbach at uni-marburg.de  Tue Dec 13 21:56:26 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Tue, 13 Dec 2016 21:56:26 +0100
Subject: [R-sig-Geo] Landscape connectivity in R
In-Reply-To: <CALEhSiRLk_Ktc4QKwXTsDohBZt5oiS=KUy1VfYDSmbtL9kokWg@mail.gmail.com>
References: <CABkCotQdKFbz6wRsor+EbxyPbO0eMopytc8QpnoNw0nqtXSGNQ@mail.gmail.com>
	<CAEBQMM=oMBWWms_EiZJin7c-jpa_PQGMdOTYfkx9_sWVC9eY_w@mail.gmail.com>
	<CABkCotSauiFrqTXnymtANkJx2Ah4_emnee80-hEvF0aeFf0qwA@mail.gmail.com>
	<CALEhSiRLk_Ktc4QKwXTsDohBZt5oiS=KUy1VfYDSmbtL9kokWg@mail.gmail.com>
Message-ID: <bca5cb67-7d43-5452-1099-a74af60d864f@uni-marburg.de>

Hi Manuel,

Probably you know  better than me that there are tons of papers dealing 
with this question out there. Unfortunately up to my mind your question 
focus a more a conceptual  (as described e.g. by Rudnick et al 2012  
Meiklejohn et al. 2012 or Kindlmann & Burel 2008) than a technical 
problem.  You can easily calculate this suggested metrics and measures  
with some R packages e.g. as the suggested ones. But as far as I got it 
you are looking for R-tools that magically ;-) connect these 
metrics/locations. Technically this is done by network analysis on 
graphs or cost analysis  on raster data.  If you want to do derive 
corridors the raster concept seems to be advantageous  because it 
provides zones or something like real areas (corridors).

If you want to to it on a data set that is bigger than about 700*700 
pixels  and you do not want to rely on grainscape you should risk a 
glimpse on fully developed GIS Software packages like GRASS GIS. It 
provides powerful support for all kind of cost analysis . Your corridor 
problem is a a typical least cost path problem that needs a solid 
parametrization of the friction datasets and and landscape patterns as 
derived from the typical metrics. After this you can define your 
corridor analysis. If you are interested in an applied example you may 
have a look at github (https://github.com/gisma/robubu)  where you find  
(among other stuff)  a simple example of an R-driven implemetation of a 
GRASS cost analysis to estimate the movement patterns and connectivity 
corridors of running beetle occurrences in high asia.

cheers Chris



On 13.12.2016 21:00, J?rome Mathieu wrote:
> Hi Manuel,
>
> Perhaps the package "gdistance" can do what you're looking for.
>
> Jerome
>
> 2016-12-13 20:43 GMT+01:00 Manuel Sp?nola <mspinola10 at gmail.com>:
>
>> Thank you very much Forrest.
>>
>> I am looking for something different related to landscape connectivity
>> (corredor design).  Your suggestion is more for landscape metrics for what
>> I usually use the land.metrics function from the SpatialEco package for
>> that.
>>
>> Best,
>>
>> Manuel
>>
>> 2016-12-13 13:31 GMT-06:00 Forrest Stevens <r-sig-geo at forreststevens.com>:
>>
>>> Check out sdmtools if fragstats like patch/class metrics are what you're
>>> looking for: https://cran.r-project.org/web/packages/SDMTools/index.html
>>>
>>> Sincerely,
>>> Forrest
>>>
>>> On Tue, Dec 13, 2016 at 1:29 PM Manuel Sp?nola <mspinola10 at gmail.com>
>>> wrote:
>>>
>>>> Dear list members,
>>>>
>>>> Is there any R package, besides grainscape, to assess landscape
>>>> connectivity?
>>>>
>>>> Best,
>>>>
>>>> Manuel
>>>>
>>>> --
>>>> *Manuel Sp?nola, Ph.D.*
>>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>>> Universidad Nacional
>>>> Apartado 1350-3000
>>>> Heredia
>>>> COSTA RICA
>>>> mspinola at una.cr <mspinola at una.ac.cr>
>>>> mspinola10 at gmail.com
>>>> Tel?fono: (506) 8706 - 4662
>>>> Personal website: Lobito de r?o <https://sites.google.com/
>>>> site/lobitoderio/>
>>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.cr <mspinola at una.ac.cr>
>> mspinola10 at gmail.com
>> Tel?fono: (506) 8706 - 4662
>> Personal website: Lobito de r?o <https://sites.google.com/
>> site/lobitoderio/>
>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>
>>          [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032 Marburg, fon: ++49.(0)6421.2824296, fax: ++49.(0)6421.2828950, web: gis-ma.org, giswerk.org, moc.environmentalinformatics-marburg.de


From mspinola10 at gmail.com  Tue Dec 13 22:31:05 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Tue, 13 Dec 2016 15:31:05 -0600
Subject: [R-sig-Geo] Landscape connectivity in R
In-Reply-To: <bca5cb67-7d43-5452-1099-a74af60d864f@uni-marburg.de>
References: <CABkCotQdKFbz6wRsor+EbxyPbO0eMopytc8QpnoNw0nqtXSGNQ@mail.gmail.com>
	<CAEBQMM=oMBWWms_EiZJin7c-jpa_PQGMdOTYfkx9_sWVC9eY_w@mail.gmail.com>
	<CABkCotSauiFrqTXnymtANkJx2Ah4_emnee80-hEvF0aeFf0qwA@mail.gmail.com>
	<CALEhSiRLk_Ktc4QKwXTsDohBZt5oiS=KUy1VfYDSmbtL9kokWg@mail.gmail.com>
	<bca5cb67-7d43-5452-1099-a74af60d864f@uni-marburg.de>
Message-ID: <CABkCotRE=2NZtwoR4Cz+JSrTNeoPxLLUsN=Uny3gROb_ZPvFPA@mail.gmail.com>

Thank you all.

Grainscape is great, but I think, is not being updated, so I don't know
what is going to happen with the package in the future, so I was looking
for new alternatives.

Manuel



2016-12-13 14:56 GMT-06:00 Chris Reudenbach <reudenbach at uni-marburg.de>:

> Hi Manuel,
>
> Probably you know  better than me that there are tons of papers dealing
> with this question out there. Unfortunately up to my mind your question
> focus a more a conceptual  (as described e.g. by Rudnick et al 2012
> Meiklejohn et al. 2012 or Kindlmann & Burel 2008) than a technical
> problem.  You can easily calculate this suggested metrics and measures
> with some R packages e.g. as the suggested ones. But as far as I got it you
> are looking for R-tools that magically ;-) connect these metrics/locations.
> Technically this is done by network analysis on graphs or cost analysis  on
> raster data.  If you want to do derive corridors the raster concept seems
> to be advantageous  because it provides zones or something like real areas
> (corridors).
>
> If you want to to it on a data set that is bigger than about 700*700
> pixels  and you do not want to rely on grainscape you should risk a glimpse
> on fully developed GIS Software packages like GRASS GIS. It provides
> powerful support for all kind of cost analysis . Your corridor problem is a
> a typical least cost path problem that needs a solid parametrization of the
> friction datasets and and landscape patterns as derived from the typical
> metrics. After this you can define your corridor analysis. If you are
> interested in an applied example you may have a look at github (
> https://github.com/gisma/robubu)  where you find  (among other stuff)  a
> simple example of an R-driven implemetation of a GRASS cost analysis to
> estimate the movement patterns and connectivity corridors of running beetle
> occurrences in high asia.
>
> cheers Chris
>
>
>
>
> On 13.12.2016 21:00, J?rome Mathieu wrote:
>
>> Hi Manuel,
>>
>> Perhaps the package "gdistance" can do what you're looking for.
>>
>> Jerome
>>
>> 2016-12-13 20:43 GMT+01:00 Manuel Sp?nola <mspinola10 at gmail.com>:
>>
>> Thank you very much Forrest.
>>>
>>> I am looking for something different related to landscape connectivity
>>> (corredor design).  Your suggestion is more for landscape metrics for
>>> what
>>> I usually use the land.metrics function from the SpatialEco package for
>>> that.
>>>
>>> Best,
>>>
>>> Manuel
>>>
>>> 2016-12-13 13:31 GMT-06:00 Forrest Stevens <r-sig-geo at forreststevens.com
>>> >:
>>>
>>> Check out sdmtools if fragstats like patch/class metrics are what you're
>>>> looking for: https://cran.r-project.org/web
>>>> /packages/SDMTools/index.html
>>>>
>>>> Sincerely,
>>>> Forrest
>>>>
>>>> On Tue, Dec 13, 2016 at 1:29 PM Manuel Sp?nola <mspinola10 at gmail.com>
>>>> wrote:
>>>>
>>>> Dear list members,
>>>>>
>>>>> Is there any R package, besides grainscape, to assess landscape
>>>>> connectivity?
>>>>>
>>>>> Best,
>>>>>
>>>>> Manuel
>>>>>
>>>>> --
>>>>> *Manuel Sp?nola, Ph.D.*
>>>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>>>> Universidad Nacional
>>>>> Apartado 1350-3000
>>>>> Heredia
>>>>> COSTA RICA
>>>>> mspinola at una.cr <mspinola at una.ac.cr>
>>>>> mspinola10 at gmail.com
>>>>> Tel?fono: (506) 8706 - 4662
>>>>> Personal website: Lobito de r?o <https://sites.google.com/
>>>>> site/lobitoderio/>
>>>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>>>>
>>>>>          [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>>
>>> --
>>> *Manuel Sp?nola, Ph.D.*
>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>> Universidad Nacional
>>> Apartado 1350-3000
>>> Heredia
>>> COSTA RICA
>>> mspinola at una.cr <mspinola at una.ac.cr>
>>> mspinola10 at gmail.com
>>> Tel?fono: (506) 8706 - 4662
>>> Personal website: Lobito de r?o <https://sites.google.com/
>>> site/lobitoderio/>
>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>>
> --
> Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of
> Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032
> Marburg, fon: ++49.(0)6421.2824296, fax: ++49.(0)6421.2828950, web:
> gis-ma.org, giswerk.org, moc.environmentalinformatics-marburg.de
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From mauriziomarchi85 at gmail.com  Wed Dec 14 00:17:09 2016
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Wed, 14 Dec 2016 00:17:09 +0100
Subject: [R-sig-Geo] Spatial points pattern generation
Message-ID: <CANJhsN2iGeRegdpXnWE7a2pRgq8sF09QhxSug56mzSFgph74Jg@mail.gmail.com>

Hello everybody, working with the spatstat package I would need to generate
some artificial spatial points pattern with an associate mark. More in
detail I would like to create 3 or 4 examples with approximately 1000 trees
on a square of 100x100 metres (1 hectare) with

1) Completely random distribution
2) Clustered distribution
3) Regular distribution
4) Mixed distribution

all the points must have an associated mark (e.g. in case of trees a
diameter in centimeters) and the autocorrelation must be detectable (the
exercise is exactly aimed to study the presence of autocorrelation)

Thanks, maurizio

-- 
Maurizio Marchi
Skype ID: maurizioxyz
linux user 552742

	[[alternative HTML version deleted]]


From r.turner at auckland.ac.nz  Wed Dec 14 01:18:28 2016
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Wed, 14 Dec 2016 13:18:28 +1300
Subject: [R-sig-Geo] [FORGED]  Spatial points pattern generation
In-Reply-To: <CANJhsN2iGeRegdpXnWE7a2pRgq8sF09QhxSug56mzSFgph74Jg@mail.gmail.com>
References: <CANJhsN2iGeRegdpXnWE7a2pRgq8sF09QhxSug56mzSFgph74Jg@mail.gmail.com>
Message-ID: <c269c139-b495-bfa8-f1a0-cf71a1862c91@auckland.ac.nz>


On 14/12/16 12:17, Maurizio Marchi wrote:

> Hello everybody, working with the spatstat package I would need to generate
> some artificial spatial points pattern with an associate mark. More in
> detail I would like to create 3 or 4 examples with approximately 1000 trees
> on a square of 100x100 metres (1 hectare) with
>
> 1) Completely random distribution
> 2) Clustered distribution
> 3) Regular distribution
> 4) Mixed distribution
>
> all the points must have an associated mark (e.g. in case of trees a
> diameter in centimeters) and the autocorrelation must be detectable (the
> exercise is exactly aimed to study the presence of autocorrelation)

"Completely random" patterns can be generated using rpoispp().

Clustered patterns can be generated using (amongst other functions)

   * rThomos()
   * rMatern()
   * rLGCP()

or more generally using rNeymanScott().

Regular patterns can be generated using rmh() with 'cif="strauss"'
or using rStrauss().

Not quite sure what you mean by a "Mixed distribution".  Perhaps you 
want to do something like generate patterns from 1), 2) and 3) and then 
superimpose them into a single pattern using superimpose().

Marks are assigned to points of a pattern by means of the syntax

     marks(X) <- m

where m is a vector or factor of length equal to npoints(X) or a data 
frame with nrows(m) = npoints(X).

How you generate the marks is up to you.

Read the (incredibly well written :-) ) help for the functions referred 
to above, or better still read the (even more incredibly well
written :-) ) book to which you can find a pointer by pointing your 
browser at http://spatstat.github.io.

That's about all I can say in response to such a general question.  If 
you have further focussed and specific questions, please get back to me.

cheers,

Rolf Turner

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From patrick.schratz at gmail.com  Wed Dec 14 18:04:08 2016
From: patrick.schratz at gmail.com (Patrick Schratz)
Date: Wed, 14 Dec 2016 18:04:08 +0100
Subject: [R-sig-Geo] Training school on "Statistical Analysis of
 Hyperspectral and High-Dimensional Remote-Sensing Data" using R
Message-ID: <CAE=-a0SD6TNMMsZ4M5SV2VHTqB5GgO6K1vy4+0+tXE-LLwp_NA@mail.gmail.com>

Dear all,

here at the University of Jena we (the GIScience group
<http://www.geographie.uni-jena.de/Mitarbeiter_Geoinformatik.html> at the
Department of Geography) are organizing a training school (*13 - 17 March
2017*) on "*Statistical Analysis of Hyperspectral and High-Dimensional
Remote-Sensing Data*" using the statistical programming language R.

It would be highly appreciated if you could distribute this E-Mail and the
attached flyer (A4) among your team/students/interested people!

More information on how to apply for the training school can be found at
http://tinyurl.com/MSCJLIFE.
Please also have look at the flyer for the program (
http://tinyurl.com/MSCJ-Flyer) and general information about the training
school.

Looking forward to welcoming you in Jena!

On behalf of the organizing team,
Patrick Schratz

-- 
PhD Student at Department of Geography - GIScience group
Friedrich-Schiller-University Jena, Germany
Tel.:  +49-3641-9-48973
<http://www.linkedin.com/in/patrick-schratz-94666b101?trk=hp-identity-name>
<https://www.researchgate.net/home>  <https://twitter.com/pjs_228>
<http://www.neo.uni-jena.de/>
<http://stackoverflow.com/users/4185785/pat-s>  <https://github.com/pat-s>
<http://www.geographie.uni-jena.de/Schratz.html>

	[[alternative HTML version deleted]]


From zhang_t_y at hotmail.com  Mon Dec 19 07:50:54 2016
From: zhang_t_y at hotmail.com (Zhang Tianyi)
Date: Mon, 19 Dec 2016 06:50:54 +0000
Subject: [R-sig-Geo] How to adjust two maps with different extent in R
Message-ID: <SG2PR0601MB13282B5626E303561470CF83B8910@SG2PR0601MB1328.apcprd06.prod.outlook.com>

Two maps with different extents

I am using R to process two maps (raster package). I have two maps with both WGS84 coordinates see figure. [image of map] <https://i.stack.imgur.com/bD84y.png>

But one layer is from -180 to 180 in longitude (the map on surface) another one is from 0 to 360 (the map on the bottom).

I need to adjust the bottom layer to -180 to 180 so that they can match. How can I do that?

I think I need to find all grid greater than 180 and then minus 360. But I cannot find the longitude vector and cannot modify it from the Raster data.

Description of the map is:

class       : RasterLayer
dimensions  : 94, 192, 18048  (nrow, ncol, ncell)
resolution  : 1.865234, 1.883872  (x, y)
extent      : 0, 358.125, -88.542, 88.542  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
data source : in memory
names       : TMAX_2015_01_01
values      : 220.9, 324.3  (min, max)


Regadrs,
Tianyi Zhang

	[[alternative HTML version deleted]]


From nlee at valleywater.org  Mon Dec 19 08:21:40 2016
From: nlee at valleywater.org (Nahm Lee)
Date: Mon, 19 Dec 2016 07:21:40 +0000
Subject: [R-sig-Geo] How to adjust two maps with different extent in R
In-Reply-To: <SG2PR0601MB13282B5626E303561470CF83B8910@SG2PR0601MB1328.apcprd06.prod.outlook.com>
References: <SG2PR0601MB13282B5626E303561470CF83B8910@SG2PR0601MB1328.apcprd06.prod.outlook.com>
Message-ID: <4F96A3E542010442B8785D2CC2384147CCDFCCCE@SRVEXCHMBX2.scvwd.gov>

spTransform(ws_soil,CRS=CRS("+proj=longlat +ellps=WGS84 +pm=+360 +datum=WGS84 +no_defs"))

You need to play with "+pm=+360"

-Nahm Lee

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Zhang Tianyi
Sent: Sunday, December 18, 2016 10:51 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] How to adjust two maps with different extent in R

Two maps with different extents

I am using R to process two maps (raster package). I have two maps with both WGS84 coordinates see figure. [image of map] <https://i.stack.imgur.com/bD84y.png>

But one layer is from -180 to 180 in longitude (the map on surface) another one is from 0 to 360 (the map on the bottom).

I need to adjust the bottom layer to -180 to 180 so that they can match. How can I do that?

I think I need to find all grid greater than 180 and then minus 360. But I cannot find the longitude vector and cannot modify it from the Raster data.

Description of the map is:

class       : RasterLayer
dimensions  : 94, 192, 18048  (nrow, ncol, ncell) resolution  : 1.865234, 1.883872  (x, y)
extent      : 0, 358.125, -88.542, 88.542  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 data source : in memory
names       : TMAX_2015_01_01
values      : 220.9, 324.3  (min, max)


Regadrs,
Tianyi Zhang

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From f.rodriguez.sanc at gmail.com  Mon Dec 19 12:28:06 2016
From: f.rodriguez.sanc at gmail.com (Francisco Rodriguez Sanchez)
Date: Mon, 19 Dec 2016 12:28:06 +0100
Subject: [R-sig-Geo] How to adjust two maps with different extent in R
In-Reply-To: <SG2PR0601MB13282B5626E303561470CF83B8910@SG2PR0601MB1328.apcprd06.prod.outlook.com>
References: <SG2PR0601MB13282B5626E303561470CF83B8910@SG2PR0601MB1328.apcprd06.prod.outlook.com>
Message-ID: <fec28ad1-79ea-5362-abf9-e3e4b4903000@gmail.com>

Hi Tianyi,

I think raster::rotate will do what you need

https://www.rdocumentation.org/packages/raster/versions/2.5-8/topics/rotate

Cheers,

Paco


El 19/12/2016 a las 07:50, Zhang Tianyi escribi?:
> Two maps with different extents
>
> I am using R to process two maps (raster package). I have two maps with both WGS84 coordinates see figure. [image of map] <https://i.stack.imgur.com/bD84y.png>
>
> But one layer is from -180 to 180 in longitude (the map on surface) another one is from 0 to 360 (the map on the bottom).
>
> I need to adjust the bottom layer to -180 to 180 so that they can match. How can I do that?
>
> I think I need to find all grid greater than 180 and then minus 360. But I cannot find the longitude vector and cannot modify it from the Raster data.
>
> Description of the map is:
>
> class       : RasterLayer
> dimensions  : 94, 192, 18048  (nrow, ncol, ncell)
> resolution  : 1.865234, 1.883872  (x, y)
> extent      : 0, 358.125, -88.542, 88.542  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source : in memory
> names       : TMAX_2015_01_01
> values      : 220.9, 324.3  (min, max)
>
>
> Regadrs,
> Tianyi Zhang
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr Francisco Rodriguez-Sanchez
Integrative Ecology Group
Estacion Biologica de Do?ana - CSIC
Avda. Americo Vespucio s/n
41092 Sevilla (Spain)
http://bit.ly/frod_san


From zhang_t_y at hotmail.com  Tue Dec 20 08:15:43 2016
From: zhang_t_y at hotmail.com (Zhang Tianyi)
Date: Tue, 20 Dec 2016 07:15:43 +0000
Subject: [R-sig-Geo] =?gb2312?b?tPC4tDogIEhvdyB0byBhZGp1c3QgdHdvIG1hcHMg?=
 =?gb2312?b?d2l0aCBkaWZmZXJlbnQgZXh0ZW50IGluIFI=?=
In-Reply-To: <fec28ad1-79ea-5362-abf9-e3e4b4903000@gmail.com>
References: <SG2PR0601MB13282B5626E303561470CF83B8910@SG2PR0601MB1328.apcprd06.prod.outlook.com>,
	<fec28ad1-79ea-5362-abf9-e3e4b4903000@gmail.com>
Message-ID: <SG2PR0601MB13287A66801E68E0790080D4B8900@SG2PR0601MB1328.apcprd06.prod.outlook.com>

Thank you!! This works!


________________________________
??????: R-sig-Geo <r-sig-geo-bounces at r-project.org> ???? Francisco Rodriguez Sanchez <f.rodriguez.sanc at gmail.com>
????????: 2016??12??19?? 19:28
??????: r-sig-geo at r-project.org
????: Re: [R-sig-Geo] How to adjust two maps with different extent in R

Hi Tianyi,

I think raster::rotate will do what you need

https://www.rdocumentation.org/packages/raster/versions/2.5-8/topics/rotate
rotate | RDocumentation<https://www.rdocumentation.org/packages/raster/versions/2.5-8/topics/rotate>
www.rdocumentation.org
Rotate a Raster* object that has x coordinates (longitude) from 0 to 360, to standard coordinates between -180 and 180 degrees. Longitude between 0 and 360 is frequently used in global climate models.




Cheers,

Paco


El 19/12/2016 a las 07:50, Zhang Tianyi escribi??:
> Two maps with different extents
>
> I am using R to process two maps (raster package). I have two maps with both WGS84 coordinates see figure. [image of map] <https://i.stack.imgur.com/bD84y.png>
>
> But one layer is from -180 to 180 in longitude (the map on surface) another one is from 0 to 360 (the map on the bottom).
>
> I need to adjust the bottom layer to -180 to 180 so that they can match. How can I do that?
>
> I think I need to find all grid greater than 180 and then minus 360. But I cannot find the longitude vector and cannot modify it from the Raster data.
>
> Description of the map is:
>
> class       : RasterLayer
> dimensions  : 94, 192, 18048  (nrow, ncol, ncell)
> resolution  : 1.865234, 1.883872  (x, y)
> extent      : 0, 358.125, -88.542, 88.542  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source : in memory
> names       : TMAX_2015_01_01
> values      : 220.9, 324.3  (min, max)
>
>
> Regadrs,
> Tianyi Zhang
>
>        [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Dr Francisco Rodriguez-Sanchez
Integrative Ecology Group
Estacion Biologica de Do?ana - CSIC
Avda. Americo Vespucio s/n
41092 Sevilla (Spain)
http://bit.ly/frod_san

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

[https://i.stack.imgur.com/bD84y.png]

	[[alternative HTML version deleted]]


From truongngocphuong at gmail.com  Tue Dec 20 15:05:22 2016
From: truongngocphuong at gmail.com (Truong Ngoc Phuong)
Date: Tue, 20 Dec 2016 15:05:22 +0100
Subject: [R-sig-Geo] Does over() in sp work with "fun=sum"?
Message-ID: <CAF3q0Y0t_kZEd-bdgxLvBgQjEyNTKTkrY_RVJwsJatA8Ngyu9g@mail.gmail.com>

Dear list,
I try to simply aggregate some gridded data, but it seems like there is no
difference between "fun=mean" or "fun=sum". Did i do some thing wrong?

> pop.v = over(gridv, pop_u, fun=sum)$band1
> summary(pop.v)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  74.00   89.00   97.00   92.89  100.00  105.00
> pop.v = over(gridv, pop_u, fun=mean)$band1
> summary(pop.v)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  74.00   89.00   97.00   92.89  100.00  105.00

Thanks,
Phuong

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Tue Dec 20 16:09:57 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 20 Dec 2016 16:09:57 +0100
Subject: [R-sig-Geo] Does over() in sp work with "fun=sum"?
In-Reply-To: <CAF3q0Y0t_kZEd-bdgxLvBgQjEyNTKTkrY_RVJwsJatA8Ngyu9g@mail.gmail.com>
References: <CAF3q0Y0t_kZEd-bdgxLvBgQjEyNTKTkrY_RVJwsJatA8Ngyu9g@mail.gmail.com>
Message-ID: <34556b9f-209c-c33e-010e-ede784c340b6@uni-muenster.de>

Hi Phuong, according to the documentation, the aggregation function
argument of over is named 'fn', not 'fun'.

Note that if you have count data, sp::over may not correctly
redistribute them the way you'd like, i.e. such that the total remains
the same. I'm working on an area-weighted interpolation in [1] that
deals both with extensive (count) and intensive (e.g. population
density) variables. This is still on github.

Best regards,

[1] https://github.com/edzer/sfr/blob/master/R/geom.R#L468-L488

On 20/12/16 15:05, Truong Ngoc Phuong wrote:
> Dear list,
> I try to simply aggregate some gridded data, but it seems like there is no
> difference between "fun=mean" or "fun=sum". Did i do some thing wrong?
> 
>> pop.v = over(gridv, pop_u, fun=sum)$band1
>> summary(pop.v)
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>   74.00   89.00   97.00   92.89  100.00  105.00
>> pop.v = over(gridv, pop_u, fun=mean)$band1
>> summary(pop.v)
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>   74.00   89.00   97.00   92.89  100.00  105.00
> 
> Thanks,
> Phuong
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161220/8c8323a4/attachment.bin>

From peter.vanhorssen at wxs.nl  Tue Dec 20 21:29:26 2016
From: peter.vanhorssen at wxs.nl (peter van horssen)
Date: Tue, 20 Dec 2016 21:29:26 +0100
Subject: [R-sig-Geo] simple features : st_segmentize question
Message-ID: <aa5e5721-146f-3901-2e3f-ace5d571fab3@wxs.nl>

Hi All,

st_segmentize in sf gives us the possibility to split line element in 
equal parts
I have a multilinestring object with 3 lines en split these in equal 
parts (1/10 of the line)

# example
pts = rbind(c(0,0),c(1,0),c(2,1),c(3,1))

ls1=st_linestring(pts[1:2,])
ls2=st_linestring(pts[2:3,])
ls3=st_linestring(pts[3:4,])

mls <- st_sf(n=4:6,st_sfc(ls1,ls2,ls3))

class(mls)
str(mls)

line.seg <- st_segmentize(mls,1/10)
# this works fine
plot(line.seg)
points(line.seg[[1]])
points(line.seg[[2]])
points(line.seg[[3]])

#by the way : how can I plot all these points in one go ?

The question is how to make a _different_ number of segments for each 
line ( and use the value in column 'n')
I tried:
st_segmentize(mls,1/mls$n)
but this throws an error:
"Error in CPL_gdal_segmentize(st_geometry(x), dfMaxLength) :
   expecting a single value"

Is there any way to achieve this ?

thanks in advance,
Peter


	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Tue Dec 20 22:41:43 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 20 Dec 2016 22:41:43 +0100
Subject: [R-sig-Geo] simple features : st_segmentize question
In-Reply-To: <aa5e5721-146f-3901-2e3f-ace5d571fab3@wxs.nl>
References: <aa5e5721-146f-3901-2e3f-ace5d571fab3@wxs.nl>
Message-ID: <31f37e61-9db6-cb35-746b-7282452ae606@uni-muenster.de>



On 20/12/16 21:29, peter van horssen wrote:
> Hi All,

Hi!

> 
> st_segmentize in sf gives us the possibility to split line element in 
> equal parts
> I have a multilinestring object with 3 lines en split these in equal 
> parts (1/10 of the line)
> 
> # example
> pts = rbind(c(0,0),c(1,0),c(2,1),c(3,1))
> 
> ls1=st_linestring(pts[1:2,])
> ls2=st_linestring(pts[2:3,])
> ls3=st_linestring(pts[3:4,])
> 
> mls <- st_sf(n=4:6,st_sfc(ls1,ls2,ls3))
> 
> class(mls)
> str(mls)
> 
> line.seg <- st_segmentize(mls,1/10)
> # this works fine
> plot(line.seg)
> points(line.seg[[1]])
> points(line.seg[[2]])
> points(line.seg[[3]])
> 
> #by the way : how can I plot all these points in one go ?

Good question! Maybe add to https://github.com/edzer/sfr/issues/110 ?

> 
> The question is how to make a _different_ number of segments for each 
> line ( and use the value in column 'n')
> I tried:
> st_segmentize(mls,1/mls$n)
> but this throws an error:
> "Error in CPL_gdal_segmentize(st_geometry(x), dfMaxLength) :
>    expecting a single value"
> 
> Is there any way to achieve this ?

x = st_line_sample(mls, mls$n)
plot(x, col = 2, add = TRUE)


-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161220/71f53d58/attachment.bin>

From michiel.vandijk at wur.nl  Wed Dec 21 16:06:11 2016
From: michiel.vandijk at wur.nl (Dijk, Michiel van)
Date: Wed, 21 Dec 2016 15:06:11 +0000
Subject: [R-sig-Geo] Scaling coarse raster to finer raster using overlapping
	area weights
Message-ID: <f1328f40693d4bd1b75d6a11c2d2b85a@scomp5296.wurnet.nl>

Hi,

I hope you can help me with the following. I have a coarse raster (0.5 x 0.5 degree) with information on global water demand (WD), which I want to combine with a higher resolution (5 arc min) global raster (which I have both in raster and polygon format). The higher resolution raster contains the locations of simulation units (SIMUs) that are related to a model. I would like to redistribute the  global water demand raster over the SIMUs. I first started with the 'resample' function in the raster package but this function allocates the total value for water demand to the cells with smaller resolution, resulting in much too large total water demand. What I am looking for is some sort of weighted disaggregation of values in the water demand raster to the SIMU raster using the share in overlapping area between cells in the two rasters. 

For example:
Suppose we have cell A in the water demand raster and this cell contains SIMUa, SIMUb and SIMUc (which can have different sizes). I would like to allocate the following value to SIMUa: Value in cell A x (Area SIMUa)/(Area cell A). Off course the first problem is that it is very well possible that only a part of SIMUa overlaps with Cell A so before I can start I need to (1) find the overlap between the Water demand raster and the SIMU raster and (2) calculate the area of SIMUa that overlaps with cell A. Here I already run into problems. 

I looked on the web for solutions and came across similar issues but none of it really worked. This post seems to come close:
http://gis.stackexchange.com/questions/155701/overlaying-grids-with-a-polygon-to-determine-the-average-value-of-the-overlappin

however when I run the gInteresects command to find the overlap  I get the following error: 

Error in RGEOSBinPredFunc(spgeom1, spgeom2, byid, func) : 
  rgeos_binpredfunc_prepared: maximum returned dense matrix size exceeded

I assume that this is a memory issue but I could not find any information on the internet to solve this. Any recommendations to help me solve this particular issue or suggestions on other/better solutions to down scale the water demand raster are welcome. 

Many thanks,
Michiel


M. (Michiel) van Dijk, PhD
Research scholar | Ecosystems Services and Management (ESM) | International Institute for Applied Systems Analysis (IIASA) Senior researcher (out of office) | International Policy Division (IB) | Wageningen Economic Research

|Schlossplatz 1 - A-2361 Laxenburg, Austria, room s-138
S +43 2236 807 537
Skype: michiel.van.dijk
S https://www.researchgate.net/profile/Michiel_Van_Dijk/
/ http://nl.linkedin.com/pub/michiel-van-dijk/1a/805/346

www.iiasa.ac.at
www.wur.eu/economic-research


From edzer.pebesma at uni-muenster.de  Wed Dec 21 16:23:13 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 21 Dec 2016 16:23:13 +0100
Subject: [R-sig-Geo] Scaling coarse raster to finer raster using
 overlapping area weights
In-Reply-To: <f1328f40693d4bd1b75d6a11c2d2b85a@scomp5296.wurnet.nl>
References: <f1328f40693d4bd1b75d6a11c2d2b85a@scomp5296.wurnet.nl>
Message-ID: <bcc5270b-51c2-426e-3078-c8b525892cf9@uni-muenster.de>

Hi Michiel,

in my first reply to this list yesterday I mentioned the function
sf::st_interpolate_aw (area-weighted) which has an argument "extensive"
that has to be set to TRUE or FALSE; when TRUE, amounts are
redistributed proportionality to the target area. It seems you have an
extensive variable (amount), so you could use that.

For this you need to install package sf from source, by

devtools::install_github("edzer/sfr")

Both datasets need to be polygon. Let me know if it works, or when you
have trouble getting it to work (more likely!)

Best regards,

On 21/12/16 16:06, Dijk, Michiel van wrote:
> Hi,
> 
> I hope you can help me with the following. I have a coarse raster (0.5 x 0.5 degree) with information on global water demand (WD), which I want to combine with a higher resolution (5 arc min) global raster (which I have both in raster and polygon format). The higher resolution raster contains the locations of simulation units (SIMUs) that are related to a model. I would like to redistribute the  global water demand raster over the SIMUs. I first started with the 'resample' function in the raster package but this function allocates the total value for water demand to the cells with smaller resolution, resulting in much too large total water demand. What I am looking for is some sort of weighted disaggregation of values in the water demand raster to the SIMU raster using the share in overlapping area between cells in the two rasters. 
> 
> For example:
> Suppose we have cell A in the water demand raster and this cell contains SIMUa, SIMUb and SIMUc (which can have different sizes). I would like to allocate the following value to SIMUa: Value in cell A x (Area SIMUa)/(Area cell A). Off course the first problem is that it is very well possible that only a part of SIMUa overlaps with Cell A so before I can start I need to (1) find the overlap between the Water demand raster and the SIMU raster and (2) calculate the area of SIMUa that overlaps with cell A. Here I already run into problems. 
> 
> I looked on the web for solutions and came across similar issues but none of it really worked. This post seems to come close:
> http://gis.stackexchange.com/questions/155701/overlaying-grids-with-a-polygon-to-determine-the-average-value-of-the-overlappin
> 
> however when I run the gInteresects command to find the overlap  I get the following error: 
> 
> Error in RGEOSBinPredFunc(spgeom1, spgeom2, byid, func) : 
>   rgeos_binpredfunc_prepared: maximum returned dense matrix size exceeded
> 
> I assume that this is a memory issue but I could not find any information on the internet to solve this. Any recommendations to help me solve this particular issue or suggestions on other/better solutions to down scale the water demand raster are welcome. 
> 
> Many thanks,
> Michiel
> 
> 
> M. (Michiel) van Dijk, PhD
> Research scholar | Ecosystems Services and Management (ESM) | International Institute for Applied Systems Analysis (IIASA) Senior researcher (out of office) | International Policy Division (IB) | Wageningen Economic Research
> 
> |Schlossplatz 1 - A-2361 Laxenburg, Austria, room s-138
> S +43 2236 807 537
> Skype: michiel.van.dijk
> S https://www.researchgate.net/profile/Michiel_Van_Dijk/
> / http://nl.linkedin.com/pub/michiel-van-dijk/1a/805/346
> 
> www.iiasa.ac.at
> www.wur.eu/economic-research
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161221/49fac2be/attachment.bin>

From btupper at bigelow.org  Wed Dec 21 17:14:56 2016
From: btupper at bigelow.org (Ben Tupper)
Date: Wed, 21 Dec 2016 11:14:56 -0500
Subject: [R-sig-Geo] rasterVis::streamplot with colorkey
Message-ID: <8A9B3872-7E96-4843-934B-D2ED2F6C5E34@bigelow.org>

Hello,

We have wind data that we would like to draw with rasterVis::streamplot(). We would like to include a colorkey to associate with the region but it seems that deep down rasterVis::streamplot has hardwired `colorkey = FALSE`  I'm not sure how to circumvent this to allow for a color key. So, in brief...  

How do I draw a streamplot with a colorkey?

Below is my example and sessionInfo() output.

Thanks so much,
Ben

### begin example
library(raster)
library(rasterVis)
library(RColorBrewer)

V = volcano/10
V = V - mean(V)
U = V[nrow(V):1,]

V = raster::raster(V)
U = raster::raster(U)
S = raster::stack(U,V)

rasterVis::streamplot(S,
    isField = 'dXY',
    par.settings = rasterVis::streamTheme(
        region = rev(RColorBrewer::brewer.pal(n=4, name= 'Greys')),
        symbol = hexbin::BTC(n=9,beg=20)),
    droplet = list(pc = 1),
    scales = list(draw = TRUE),
    colorkey = TRUE) 

# Error in .local(x, data, ...) : 
#  formal argument "colorkey" matched by multiple actual arguments

### end example


> sessionInfo()
R version 3.3.1 (2016-06-21)
Platform: x86_64-apple-darwin13.4.0 (64-bit)
Running under: OS X 10.11.6 (El Capitan)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rasterVis_0.40      latticeExtra_0.6-28 RColorBrewer_1.1-2  lattice_0.20-33     raster_2.5-8        sp_1.2-3           

loaded via a namespace (and not attached):
[1] zoo_1.7-13        parallel_3.3.1    hexbin_1.27.1     Rcpp_0.12.6       grid_3.3.1        viridisLite_0.1.3





Ben Tupper
Bigelow Laboratory for Ocean Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org


From michiel.vandijk at wur.nl  Wed Dec 21 17:19:15 2016
From: michiel.vandijk at wur.nl (Dijk, Michiel van)
Date: Wed, 21 Dec 2016 16:19:15 +0000
Subject: [R-sig-Geo] Scaling coarse raster to finer raster using
 overlapping area weights
In-Reply-To: <bcc5270b-51c2-426e-3078-c8b525892cf9@uni-muenster.de>
References: <f1328f40693d4bd1b75d6a11c2d2b85a@scomp5296.wurnet.nl>
	<bcc5270b-51c2-426e-3078-c8b525892cf9@uni-muenster.de>
Message-ID: <479c2eeca3784bb78fefb0850e959bea@scomp5296.wurnet.nl>

Hi Edzer,

Thanks for the swift reply. Unfortunately, already with installing the package something goes wrong. I get the following message:

*** arch - i386
rm -f RcppExports.o bbox.o gdal.o gdal_geom.o gdal_read.o gdal_write.o geos.o proj.o wkb.o sf.dll
mkdir -p ../inst
"C:/PROGRA~1/R/R-33~1.2/bin/i386/Rscript.exe" "../tools/winlibs.R"
cp -r ../windows/gdal2-2.1.1/share/gdal ../inst/
cp: cannot stat '../windows/gdal2-2.1.1/share/gdal': No such file or directory
make: *** [winlibs] Error 1
Warning: running command 'make -f "Makevars.win" -f "C:/PROGRA~1/R/R-33~1.2/etc/i386/Makeconf" -f "C:/PROGRA~1/R/R-33~1.2/share/make/winshlib.mk" CXX='$(CXX1X) $(CXX1XSTD)' CXXFLAGS='$(CXX1XFLAGS)' CXXPICFLAGS='$(CXX1XPICFLAGS)' SHLIB_LDFLAGS='$(SHLIB_CXX1XLDFLAGS)' SHLIB_LD='$(SHLIB_CXX1XLD)' SHLIB="sf.dll" OBJECTS="RcppExports.o bbox.o gdal.o gdal_geom.o gdal_read.o gdal_write.o geos.o proj.o wkb.o"' had status 2
ERROR: compilation failed for package 'sf'
* removing 'C:/Users/vandijkm/R/library/3.3.2/sf

It seems it is unable to find the gdal files. I have gdal installed but not in the .../Windows/ folder. Perhaps that is the problem?
Best,
Michiel

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: 21 December 2016 16:23
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Scaling coarse raster to finer raster using overlapping area weights

Hi Michiel,

in my first reply to this list yesterday I mentioned the function sf::st_interpolate_aw (area-weighted) which has an argument "extensive"
that has to be set to TRUE or FALSE; when TRUE, amounts are redistributed proportionality to the target area. It seems you have an extensive variable (amount), so you could use that.

For this you need to install package sf from source, by

devtools::install_github("edzer/sfr")

Both datasets need to be polygon. Let me know if it works, or when you have trouble getting it to work (more likely!)

Best regards,

On 21/12/16 16:06, Dijk, Michiel van wrote:
> Hi,
> 
> I hope you can help me with the following. I have a coarse raster (0.5 x 0.5 degree) with information on global water demand (WD), which I want to combine with a higher resolution (5 arc min) global raster (which I have both in raster and polygon format). The higher resolution raster contains the locations of simulation units (SIMUs) that are related to a model. I would like to redistribute the  global water demand raster over the SIMUs. I first started with the 'resample' function in the raster package but this function allocates the total value for water demand to the cells with smaller resolution, resulting in much too large total water demand. What I am looking for is some sort of weighted disaggregation of values in the water demand raster to the SIMU raster using the share in overlapping area between cells in the two rasters. 
> 
> For example:
> Suppose we have cell A in the water demand raster and this cell contains SIMUa, SIMUb and SIMUc (which can have different sizes). I would like to allocate the following value to SIMUa: Value in cell A x (Area SIMUa)/(Area cell A). Off course the first problem is that it is very well possible that only a part of SIMUa overlaps with Cell A so before I can start I need to (1) find the overlap between the Water demand raster and the SIMU raster and (2) calculate the area of SIMUa that overlaps with cell A. Here I already run into problems. 
> 
> I looked on the web for solutions and came across similar issues but none of it really worked. This post seems to come close:
> http://gis.stackexchange.com/questions/155701/overlaying-grids-with-a-
> polygon-to-determine-the-average-value-of-the-overlappin
> 
> however when I run the gInteresects command to find the overlap  I get the following error: 
> 
> Error in RGEOSBinPredFunc(spgeom1, spgeom2, byid, func) : 
>   rgeos_binpredfunc_prepared: maximum returned dense matrix size 
> exceeded
> 
> I assume that this is a memory issue but I could not find any information on the internet to solve this. Any recommendations to help me solve this particular issue or suggestions on other/better solutions to down scale the water demand raster are welcome. 
> 
> Many thanks,
> Michiel
> 
> 
> M. (Michiel) van Dijk, PhD
> Research scholar | Ecosystems Services and Management (ESM) | 
> International Institute for Applied Systems Analysis (IIASA) Senior 
> researcher (out of office) | International Policy Division (IB) | 
> Wageningen Economic Research
> 
> |Schlossplatz 1 - A-2361 Laxenburg, Austria, room s-138
> S +43 2236 807 537
> Skype: michiel.van.dijk
> S https://www.researchgate.net/profile/Michiel_Van_Dijk/
> / http://nl.linkedin.com/pub/michiel-van-dijk/1a/805/346
> 
> www.iiasa.ac.at
> www.wur.eu/economic-research
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

--
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/


From Pierre.Racine at sbf.ulaval.ca  Wed Dec 21 17:25:19 2016
From: Pierre.Racine at sbf.ulaval.ca (Pierre Racine)
Date: Wed, 21 Dec 2016 16:25:19 +0000
Subject: [R-sig-Geo] Building a vector of random sf st_points
Message-ID: <31ac0b1b926f4b5da6b59487dd989a42@ul-exc-pr-mbx14.ulaval.ca>

Hi,

Very new to spatial R. I'm trying to find the best way to build a sf dataframe of random points inside an extent. I built a matrix of random coordinates and now I try to convert this matrix to a vector of st_point.

I was expecting that something like:

PTS <- matrix(seq(1,6), 3, 2)
ptsdf <- apply(PTS, 1, st_point)

would work but it doesn't. Why?

Thanks,

Pierre


From edzer.pebesma at uni-muenster.de  Wed Dec 21 17:36:17 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 21 Dec 2016 17:36:17 +0100
Subject: [R-sig-Geo] Building a vector of random sf st_points
In-Reply-To: <31ac0b1b926f4b5da6b59487dd989a42@ul-exc-pr-mbx14.ulaval.ca>
References: <31ac0b1b926f4b5da6b59487dd989a42@ul-exc-pr-mbx14.ulaval.ca>
Message-ID: <ae7cce0f-0f6e-5829-c8b7-5035c5242842@uni-muenster.de>



On 21/12/16 17:25, Pierre Racine wrote:
> Hi,

Hi Pierre!

> 
> Very new to spatial R. I'm trying to find the best way to build a sf dataframe of random points inside an extent. I built a matrix of random coordinates and now I try to convert this matrix to a vector of st_point.
> 
> I was expecting that something like:
> 
> PTS <- matrix(seq(1,6), 3, 2)

> st_sfc(lapply(seq_len(nrow(PTS)), function(i) st_point(PTS[i,])))
Geometry set for 3 features
geometry type:  POINT
dimension:      XY
bbox:           xmin: 1 ymin: 4 xmax: 3 ymax: 6
epsg (SRID):    NA
proj4string:    NA
POINT(1 4)
POINT(2 5)
POINT(3 6)


> ptsdf <- apply(PTS, 1, st_point)
> 
> would work but it doesn't. Why?

apply wants to to mold the output into a matrix; it can, and so it does.
We want a list of POINT objects, so need to use lapply.

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161221/8d2aef38/attachment.bin>

From peter.vanhorssen at wxs.nl  Thu Dec 22 13:20:02 2016
From: peter.vanhorssen at wxs.nl (peter van horssen)
Date: Thu, 22 Dec 2016 13:20:02 +0100
Subject: [R-sig-Geo] simple features : st_segmentize question
In-Reply-To: <31f37e61-9db6-cb35-746b-7282452ae606@uni-muenster.de>
References: <aa5e5721-146f-3901-2e3f-ace5d571fab3@wxs.nl>
	<31f37e61-9db6-cb35-746b-7282452ae606@uni-muenster.de>
Message-ID: <84d3ae2c-1002-d997-57b5-66b77ad36133@wxs.nl>

Thanks for solution, it works.

after :
x = st_line_sample(mls, mls$n)
x
#Geometry set for 3 features
#geometry type:  MULTIPOINT
#dimension:      XY
#bbox:           xmin: 0.05 ymin: 0 xmax: 2.9975 ymax: 1
#epsg (SRID):    NA
#proj4string:    NA
#MULTIPOINT(0.05 0, 0.15 0, 0.25 0, 0.35 0, 0.45...
#MULTIPOINT(1.005 0.005, 1.015 0.015, 1.025 0.02...
#MULTIPOINT(2.0025 1, 2.0075 1, 2.0125 1, 2.0175...

I get a multipoint object and of course I want a 'plain' point object !
So I end up in this https://github.com/edzer/sfr/issues/114 How to go 
from MULTIPOINT to just point?  but thats oke. Lots of development is 
going on there.

BTW the postgis command to 'un multi' a geometry is st_dump, all though 
it is not a very a attractive name, this might be used also in r::sf ?

greetings, Peter

Op 20-12-2016 om 22:41 schreef Edzer Pebesma:
>
> On 20/12/16 21:29, peter van horssen wrote:
>> Hi All,
> Hi!
>
>> st_segmentize in sf gives us the possibility to split line element in
>> equal parts
>> I have a multilinestring object with 3 lines en split these in equal
>> parts (1/10 of the line)
>>
>> # example
>> pts = rbind(c(0,0),c(1,0),c(2,1),c(3,1))
>>
>> ls1=st_linestring(pts[1:2,])
>> ls2=st_linestring(pts[2:3,])
>> ls3=st_linestring(pts[3:4,])
>>
>> mls <- st_sf(n=4:6,st_sfc(ls1,ls2,ls3))
>>
>> class(mls)
>> str(mls)
>>
>> line.seg <- st_segmentize(mls,1/10)
>> # this works fine
>> plot(line.seg)
>> points(line.seg[[1]])
>> points(line.seg[[2]])
>> points(line.seg[[3]])
>>
>> #by the way : how can I plot all these points in one go ?
> Good question! Maybe add to https://github.com/edzer/sfr/issues/110 ?
>
>> The question is how to make a _different_ number of segments for each
>> line ( and use the value in column 'n')
>> I tried:
>> st_segmentize(mls,1/mls$n)
>> but this throws an error:
>> "Error in CPL_gdal_segmentize(st_geometry(x), dfMaxLength) :
>>     expecting a single value"
>>
>> Is there any way to achieve this ?
> x = st_line_sample(mls, mls$n)
> plot(x, col = 2, add = TRUE)
>
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From michiel.vandijk at wur.nl  Fri Dec 23 13:04:47 2016
From: michiel.vandijk at wur.nl (Dijk, Michiel van)
Date: Fri, 23 Dec 2016 12:04:47 +0000
Subject: [R-sig-Geo] Scaling coarse raster to finer raster using
 overlapping area weights
In-Reply-To: <479c2eeca3784bb78fefb0850e959bea@scomp5296.wurnet.nl>
References: <f1328f40693d4bd1b75d6a11c2d2b85a@scomp5296.wurnet.nl>
	<bcc5270b-51c2-426e-3078-c8b525892cf9@uni-muenster.de>
	<479c2eeca3784bb78fefb0850e959bea@scomp5296.wurnet.nl>
Message-ID: <5f8c296d264c4277929ae78ea8446538@scomp5296.wurnet.nl>

Dear all,

Just to inform you that the installation problem I had before is fixed (thanks Jeroen Ooms!). I have a setwd() line in my Rprofile.site which seemed to break the installation (probably should change that). Jeroen somehow created a fix in the package and now the installation works on my machine too (even with the setwd() in  Rprofile.site).

I will try the package after Christmas.
Good holidays!
Michiel 

-----Original Message-----
From: Dijk, Michiel van 
Sent: 21 December 2016 17:19
To: Edzer Pebesma; r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] Scaling coarse raster to finer raster using overlapping area weights

Hi Edzer,

Thanks for the swift reply. Unfortunately, already with installing the package something goes wrong. I get the following message:

*** arch - i386
rm -f RcppExports.o bbox.o gdal.o gdal_geom.o gdal_read.o gdal_write.o geos.o proj.o wkb.o sf.dll mkdir -p ../inst "C:/PROGRA~1/R/R-33~1.2/bin/i386/Rscript.exe" "../tools/winlibs.R"
cp -r ../windows/gdal2-2.1.1/share/gdal ../inst/
cp: cannot stat '../windows/gdal2-2.1.1/share/gdal': No such file or directory
make: *** [winlibs] Error 1
Warning: running command 'make -f "Makevars.win" -f "C:/PROGRA~1/R/R-33~1.2/etc/i386/Makeconf" -f "C:/PROGRA~1/R/R-33~1.2/share/make/winshlib.mk" CXX='$(CXX1X) $(CXX1XSTD)' CXXFLAGS='$(CXX1XFLAGS)' CXXPICFLAGS='$(CXX1XPICFLAGS)' SHLIB_LDFLAGS='$(SHLIB_CXX1XLDFLAGS)' SHLIB_LD='$(SHLIB_CXX1XLD)' SHLIB="sf.dll" OBJECTS="RcppExports.o bbox.o gdal.o gdal_geom.o gdal_read.o gdal_write.o geos.o proj.o wkb.o"' had status 2
ERROR: compilation failed for package 'sf'
* removing 'C:/Users/vandijkm/R/library/3.3.2/sf

It seems it is unable to find the gdal files. I have gdal installed but not in the .../Windows/ folder. Perhaps that is the problem?
Best,
Michiel

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: 21 December 2016 16:23
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Scaling coarse raster to finer raster using overlapping area weights

Hi Michiel,

in my first reply to this list yesterday I mentioned the function sf::st_interpolate_aw (area-weighted) which has an argument "extensive"
that has to be set to TRUE or FALSE; when TRUE, amounts are redistributed proportionality to the target area. It seems you have an extensive variable (amount), so you could use that.

For this you need to install package sf from source, by

devtools::install_github("edzer/sfr")

Both datasets need to be polygon. Let me know if it works, or when you have trouble getting it to work (more likely!)

Best regards,

On 21/12/16 16:06, Dijk, Michiel van wrote:
> Hi,
> 
> I hope you can help me with the following. I have a coarse raster (0.5 x 0.5 degree) with information on global water demand (WD), which I want to combine with a higher resolution (5 arc min) global raster (which I have both in raster and polygon format). The higher resolution raster contains the locations of simulation units (SIMUs) that are related to a model. I would like to redistribute the  global water demand raster over the SIMUs. I first started with the 'resample' function in the raster package but this function allocates the total value for water demand to the cells with smaller resolution, resulting in much too large total water demand. What I am looking for is some sort of weighted disaggregation of values in the water demand raster to the SIMU raster using the share in overlapping area between cells in the two rasters. 
> 
> For example:
> Suppose we have cell A in the water demand raster and this cell contains SIMUa, SIMUb and SIMUc (which can have different sizes). I would like to allocate the following value to SIMUa: Value in cell A x (Area SIMUa)/(Area cell A). Off course the first problem is that it is very well possible that only a part of SIMUa overlaps with Cell A so before I can start I need to (1) find the overlap between the Water demand raster and the SIMU raster and (2) calculate the area of SIMUa that overlaps with cell A. Here I already run into problems. 
> 
> I looked on the web for solutions and came across similar issues but none of it really worked. This post seems to come close:
> http://gis.stackexchange.com/questions/155701/overlaying-grids-with-a-
> polygon-to-determine-the-average-value-of-the-overlappin
> 
> however when I run the gInteresects command to find the overlap  I get the following error: 
> 
> Error in RGEOSBinPredFunc(spgeom1, spgeom2, byid, func) : 
>   rgeos_binpredfunc_prepared: maximum returned dense matrix size 
> exceeded
> 
> I assume that this is a memory issue but I could not find any information on the internet to solve this. Any recommendations to help me solve this particular issue or suggestions on other/better solutions to down scale the water demand raster are welcome. 
> 
> Many thanks,
> Michiel
> 
> 
> M. (Michiel) van Dijk, PhD
> Research scholar | Ecosystems Services and Management (ESM) | 
> International Institute for Applied Systems Analysis (IIASA) Senior 
> researcher (out of office) | International Policy Division (IB) | 
> Wageningen Economic Research
> 
> |Schlossplatz 1 - A-2361 Laxenburg, Austria, room s-138
> S +43 2236 807 537
> Skype: michiel.van.dijk
> S https://www.researchgate.net/profile/Michiel_Van_Dijk/
> / http://nl.linkedin.com/pub/michiel-van-dijk/1a/805/346
> 
> www.iiasa.ac.at
> www.wur.eu/economic-research
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

--
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/


From englishchristophera at gmail.com  Fri Dec 23 13:36:44 2016
From: englishchristophera at gmail.com (chris english)
Date: Fri, 23 Dec 2016 07:36:44 -0500
Subject: [R-sig-Geo] rasterVis::streamplot with colorkey
In-Reply-To: <8A9B3872-7E96-4843-934B-D2ED2F6C5E34@bigelow.org>
References: <8A9B3872-7E96-4843-934B-D2ED2F6C5E34@bigelow.org>
Message-ID: <CAASFQpS02Qu4nREPUTM9-1BUttg2242KacpdnwOmLxpMkY+5_w@mail.gmail.com>

Ben,

Not so much hard wired (colorkey) but coming in a couple of times so which
to use? As kind of explained here:
http://stackoverflow.com/questions/34320868/map-with-panel-plots,

and further, more directly on rasterVis from Augustin Lobo:
http://rpubs.com/alobo/rasterVis_Intro1

which looks like it will get you to the results you want, though I haven't
worked it through your example.
HTH,
Chris



On Wed, Dec 21, 2016 at 11:14 AM, Ben Tupper <btupper at bigelow.org> wrote:

> Hello,
>
> We have wind data that we would like to draw with rasterVis::streamplot().
> We would like to include a colorkey to associate with the region but it
> seems that deep down rasterVis::streamplot has hardwired `colorkey =
> FALSE`  I'm not sure how to circumvent this to allow for a color key. So,
> in brief...
>
> How do I draw a streamplot with a colorkey?
>
> Below is my example and sessionInfo() output.
>
> Thanks so much,
> Ben
>
> ### begin example
> library(raster)
> library(rasterVis)
> library(RColorBrewer)
>
> V = volcano/10
> V = V - mean(V)
> U = V[nrow(V):1,]
>
> V = raster::raster(V)
> U = raster::raster(U)
> S = raster::stack(U,V)
>
> rasterVis::streamplot(S,
>     isField = 'dXY',
>     par.settings = rasterVis::streamTheme(
>         region = rev(RColorBrewer::brewer.pal(n=4, name= 'Greys')),
>         symbol = hexbin::BTC(n=9,beg=20)),
>     droplet = list(pc = 1),
>     scales = list(draw = TRUE),
>     colorkey = TRUE)
>
> # Error in .local(x, data, ...) :
> #  formal argument "colorkey" matched by multiple actual arguments
>
> ### end example
>
>
> > sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-apple-darwin13.4.0 (64-bit)
> Running under: OS X 10.11.6 (El Capitan)
>
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rasterVis_0.40      latticeExtra_0.6-28 RColorBrewer_1.1-2
> lattice_0.20-33     raster_2.5-8        sp_1.2-3
>
> loaded via a namespace (and not attached):
> [1] zoo_1.7-13        parallel_3.3.1    hexbin_1.27.1     Rcpp_0.12.6
>  grid_3.3.1        viridisLite_0.1.3
>
>
>
>
>
> Ben Tupper
> Bigelow Laboratory for Ocean Sciences
> 60 Bigelow Drive, P.O. Box 380
> East Boothbay, Maine 04544
> http://www.bigelow.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From btupper at bigelow.org  Fri Dec 23 14:46:17 2016
From: btupper at bigelow.org (Ben Tupper)
Date: Fri, 23 Dec 2016 08:46:17 -0500
Subject: [R-sig-Geo] rasterVis::streamplot with colorkey
In-Reply-To: <CAASFQpS02Qu4nREPUTM9-1BUttg2242KacpdnwOmLxpMkY+5_w@mail.gmail.com>
References: <8A9B3872-7E96-4843-934B-D2ED2F6C5E34@bigelow.org>
	<CAASFQpS02Qu4nREPUTM9-1BUttg2242KacpdnwOmLxpMkY+5_w@mail.gmail.com>
Message-ID: <AFA95D78-6A36-4DD0-8E70-53FC1DAB11D3@bigelow.org>

Hi,

Thanks so much for the tips!

Today the package author has kindly added a colorkey argument to streamplot function with a FALSE default value.  Setting it to TRUE draws the colorkey.  Woooohooo!

https://github.com/oscarperpinan/rastervis/commit/ea1c49e945616e8c7dc203069dbc2a1e2d91baf7

Cheers,
ben


> On Dec 23, 2016, at 7:36 AM, chris english <englishchristophera at gmail.com> wrote:
> 
> Ben,
> 
> Not so much hard wired (colorkey) but coming in a couple of times so which to use? As kind of explained here:
> http://stackoverflow.com/questions/34320868/map-with-panel-plots <http://stackoverflow.com/questions/34320868/map-with-panel-plots>,
> 
> and further, more directly on rasterVis from Augustin Lobo:
> http://rpubs.com/alobo/rasterVis_Intro1 <http://rpubs.com/alobo/rasterVis_Intro1>
> 
> which looks like it will get you to the results you want, though I haven't worked it through your example.
> HTH,
> Chris
> 
> 
> 
> On Wed, Dec 21, 2016 at 11:14 AM, Ben Tupper <btupper at bigelow.org <mailto:btupper at bigelow.org>> wrote:
> Hello,
> 
> We have wind data that we would like to draw with rasterVis::streamplot(). We would like to include a colorkey to associate with the region but it seems that deep down rasterVis::streamplot has hardwired `colorkey = FALSE`  I'm not sure how to circumvent this to allow for a color key. So, in brief...
> 
> How do I draw a streamplot with a colorkey?
> 
> Below is my example and sessionInfo() output.
> 
> Thanks so much,
> Ben
> 
> ### begin example
> library(raster)
> library(rasterVis)
> library(RColorBrewer)
> 
> V = volcano/10
> V = V - mean(V)
> U = V[nrow(V):1,]
> 
> V = raster::raster(V)
> U = raster::raster(U)
> S = raster::stack(U,V)
> 
> rasterVis::streamplot(S,
>     isField = 'dXY',
>     par.settings = rasterVis::streamTheme(
>         region = rev(RColorBrewer::brewer.pal(n=4, name= 'Greys')),
>         symbol = hexbin::BTC(n=9,beg=20)),
>     droplet = list(pc = 1),
>     scales = list(draw = TRUE),
>     colorkey = TRUE)
> 
> # Error in .local(x, data, ...) :
> #  formal argument "colorkey" matched by multiple actual arguments
> 
> ### end example
> 
> 
> > sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-apple-darwin13.4.0 (64-bit)
> Running under: OS X 10.11.6 (El Capitan)
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] rasterVis_0.40      latticeExtra_0.6-28 RColorBrewer_1.1-2  lattice_0.20-33     raster_2.5-8        sp_1.2-3
> 
> loaded via a namespace (and not attached):
> [1] zoo_1.7-13        parallel_3.3.1    hexbin_1.27.1     Rcpp_0.12.6       grid_3.3.1        viridisLite_0.1.3
> 
> 
> 
> 
> 
> Ben Tupper
> Bigelow Laboratory for Ocean Sciences
> 60 Bigelow Drive, P.O. Box 380
> East Boothbay, Maine 04544
> http://www.bigelow.org <http://www.bigelow.org/>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> 

Ben Tupper
Bigelow Laboratory for Ocean Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org




	[[alternative HTML version deleted]]


From maaz at iastate.edu  Fri Dec 23 15:42:34 2016
From: maaz at iastate.edu (Maaz Gardezi)
Date: Fri, 23 Dec 2016 08:42:34 -0600
Subject: [R-sig-Geo] Aggregating census tract to county
Message-ID: <CALcs7UKWaaPAkieDng5CH1Vn8cqX17iNSMfXmB8sd4VuFx9MSQ@mail.gmail.com>

Hello,

Can anyone tell me what's the most appropriate method to aggregate census
tract data to the county level?

Best
Maaz

	[[alternative HTML version deleted]]


From juta.kawalerowicz at nuffield.ox.ac.uk  Fri Dec 23 16:25:32 2016
From: juta.kawalerowicz at nuffield.ox.ac.uk (Juta Kawalerowicz)
Date: Fri, 23 Dec 2016 16:25:32 +0100
Subject: [R-sig-Geo] Aggregating census tract to county
In-Reply-To: <d1303d8f-9368-43d0-938c-0ba4db254b42@HUB03.ad.oak.ox.ac.uk>
References: <d1303d8f-9368-43d0-938c-0ba4db254b42@HUB03.ad.oak.ox.ac.uk>
Message-ID: <CAHMizkPRbAWY2DB2T1suHGuZRePukt5CRJgDRZG7LsL=1dZ8Kw@mail.gmail.com>

Maaz this depends on what you have - do you have a lookup file (csv or
else) which tells you which country does each census tract falls into? If
you do then first merge lookup file with counts in census tracts and then
use aggregate function. If you don't then you can create your own lookup
file with shapefiles with census tracts and countries by using over
function, check
https://cran.r-project.org/web/packages/sp/vignettes/over.pdf for details

Juta

On Fri, Dec 23, 2016 at 3:42 PM, Maaz Gardezi <maaz at iastate.edu> wrote:

> Hello,
>
> Can anyone tell me what's the most appropriate method to aggregate census
> tract data to the county level?
>
> Best
> Maaz
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From maaz at iastate.edu  Sat Dec 24 04:35:29 2016
From: maaz at iastate.edu (Maaz Gardezi)
Date: Fri, 23 Dec 2016 21:35:29 -0600
Subject: [R-sig-Geo] Aggregating census tract to county
In-Reply-To: <CAHMizkPRbAWY2DB2T1suHGuZRePukt5CRJgDRZG7LsL=1dZ8Kw@mail.gmail.com>
References: <d1303d8f-9368-43d0-938c-0ba4db254b42@HUB03.ad.oak.ox.ac.uk>
	<CAHMizkPRbAWY2DB2T1suHGuZRePukt5CRJgDRZG7LsL=1dZ8Kw@mail.gmail.com>
Message-ID: <CALcs7ULS72=HKBdweWc+NgCCmtgu5TODEfQdfGSXVfHL4swF5w@mail.gmail.com>

Juta,
Thanks for your reply. My question also has a methodological dimension to
it. Would it be OK to aggregate census tract data (on lets say female
headed household) to the county level by simply adding all the tracts
together? Will that aggregated number represent to some degree the county
level measure for the number of FHH.
Regards,

Maaz


On Fri, Dec 23, 2016 at 9:25 AM, Juta Kawalerowicz <
juta.kawalerowicz at nuffield.ox.ac.uk> wrote:

> Maaz this depends on what you have - do you have a lookup file (csv or
> else) which tells you which country does each census tract falls into? If
> you do then first merge lookup file with counts in census tracts and then
> use aggregate function. If you don't then you can create your own lookup
> file with shapefiles with census tracts and countries by using over
> function, check https://cran.r-project.org/web/packages/sp/vignettes/
> over.pdf for details
>
> Juta
>
> On Fri, Dec 23, 2016 at 3:42 PM, Maaz Gardezi <maaz at iastate.edu> wrote:
>
>> Hello,
>>
>> Can anyone tell me what's the most appropriate method to aggregate census
>> tract data to the county level?
>>
>> Best
>> Maaz
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From milujisb at gmail.com  Sat Dec 24 16:28:11 2016
From: milujisb at gmail.com (Miluji Sb)
Date: Sat, 24 Dec 2016 16:28:11 +0100
Subject: [R-sig-Geo] Convert SpatialPointsDataFrame to SpatialPolygons or
	SpatialPolygonsDataFrame
Message-ID: <CAMLwc7M5k5qmf8DC_euPsVeby2+4v07PjbKqCBZEyPJ9GMLO+Q@mail.gmail.com>

I have a SpatialPointsDataFrame with the following attributes. Is it
possible to convert this to a SpatialPolygons or SpatialPolygonsDataFrame?
Thank you!

Sincerely,

Milu

class       : SpatialPointsDataFrame
features    : 21441
extent      : -179.5, 179.5, -89.5, 83.5  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +a=6367470 +b=6367470 +no_defs
variables   : 7
names       : ID_cell,    lon,   lat, Field4, Field5, Field6, Field7
min values  :    2304,    0.5,   0.5,     NA,     NA,     NA,     NA
max values  :   64800, -179.5, -89.5,     NA,     NA,     NA,     NA

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Mon Dec 26 07:24:22 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 26 Dec 2016 06:24:22 +0000
Subject: [R-sig-Geo] Convert SpatialPointsDataFrame to SpatialPolygons
	or SpatialPolygonsDataFrame
In-Reply-To: <CAMLwc7M5k5qmf8DC_euPsVeby2+4v07PjbKqCBZEyPJ9GMLO+Q@mail.gmail.com>
References: <CAMLwc7M5k5qmf8DC_euPsVeby2+4v07PjbKqCBZEyPJ9GMLO+Q@mail.gmail.com>
Message-ID: <CAAcGz998RWz3s2guU4fB=qdvqCfZ607SbUofF472T+iqdX0H+w@mail.gmail.com>

It is but you will need at least a grouping ID for each polygon ring within
each object, and an order within each ring. Is ID_cell the object ID?

If there is only a single ring polygon within each object and the order is
native it's simplest, but the constructors require very particular
arrangements of your data, there is no abstractions for this. See
raster::spPolygons and spbabel::sp for alternative constructors, but other
wise see Polygon, Polygons, SpatialPolygons and SpatialPolygonsDataFrame in
sp.

There's not enough information in your post to be sure of what you have,
but I'm happy to help if you provide more detail about how your data is
organized. You could post sample data, or describe them in more detail. Do
you have actual  polygons here or are you attempting to estimate them from
point data?

To add more alternatives the new sf package simplifies the constructors a
lot, for a new family of classes, but still you need to nest matrices of
coordinates manually to use them rather than specify their organization
abstractly.  I'm working on tools to do that, but there is only spbabel so
far (it's really just a two-level grouping of coordinates for spatial
objects and their parts, but various legacies make it ever more
complicated).

Cheers, Mike

On Sun, Dec 25, 2016, 02:28 Miluji Sb <milujisb at gmail.com> wrote:

I have a SpatialPointsDataFrame with the following attributes. Is it
possible to convert this to a SpatialPolygons or SpatialPolygonsDataFrame?
Thank you!

Sincerely,

Milu

class       : SpatialPointsDataFrame
features    : 21441
extent      : -179.5, 179.5, -89.5, 83.5  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +a=6367470 +b=6367470 +no_defs
variables   : 7
names       : ID_cell,    lon,   lat, Field4, Field5, Field6, Field7
min values  :    2304,    0.5,   0.5,     NA,     NA,     NA,     NA
max values  :   64800, -179.5, -89.5,     NA,     NA,     NA,     NA

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From milujisb at gmail.com  Mon Dec 26 12:39:05 2016
From: milujisb at gmail.com (Miluji Sb)
Date: Mon, 26 Dec 2016 12:39:05 +0100
Subject: [R-sig-Geo] Convert SpatialPointsDataFrame to SpatialPolygons
	or SpatialPolygonsDataFrame
In-Reply-To: <CAAcGz998RWz3s2guU4fB=qdvqCfZ607SbUofF472T+iqdX0H+w@mail.gmail.com>
References: <CAMLwc7M5k5qmf8DC_euPsVeby2+4v07PjbKqCBZEyPJ9GMLO+Q@mail.gmail.com>
	<CAAcGz998RWz3s2guU4fB=qdvqCfZ607SbUofF472T+iqdX0H+w@mail.gmail.com>
Message-ID: <CAMLwc7M4UWM5WnnPQWDiKLcfn6KUNmsLN_47dV+MC7tkQVFg9Q@mail.gmail.com>

Dear Michael,

Merry Christmas and seasons's greetings! Thank you for your reply, I am
providing more information and my attempts to convert
to SpatialPolygonsDataFrame below.

The original SpatialPointsDataFrame has the following attributes:

class       : SpatialPointsDataFrame
features    : 21441
extent      : -179.5, 179.5, -89.5, 83.5  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=WGS84
variables   : 3
names       : ID_cell,    lon,   lat
min values  :    2304, -179.5, -89.5
max values  :   64800,  179.5,  83.5

The data looks like this:

dput(head(shp at data,20))
structure(list(ID_cell = c(2304L, 2305L, 2306L, 2307L, 2308L,
2309L, 2310L, 2311L, 2618L, 2619L, 2620L, 2621L, 2622L, 2623L,
2624L, 2625L, 2626L, 2627L, 2628L, 2629L), lon = c(-36.5, -35.5,
-34.5, -33.5, -32.5, -31.5, -30.5, -29.5, -82.5, -81.5, -80.5,
-79.5, -78.5, -77.5, -76.5, -75.5, -74.5, -73.5, -72.5, -71.5
), lat = c(83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 82.5,
82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5
)), .Names = c("ID_cell", "lon", "lat"), data_types = c("N",
"F", "F", "C", "C", "C", "C"), row.names = c("0", "1", "2", "3",
"4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15",
"16", "17", "18", "19"), class = "data.frame")

I tried the following:

x = as(SpatialPixelsDataFrame(shp, shp at data, tolerance=.00086),
"SpatialPolygonsDataFrame"), it seemed to have worked but got the following
warning:

Warning message:
In points2grid(points, tolerance, round) :
  grid has empty column/rows in dimension 2

Now the converted SpatialPolygonsDataFrame has the following attributes:

class       : SpatialPolygonsDataFrame
features    : 21441
extent      : -180, 180, -90, 84  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=WGS84
variables   : 3
names       : ID_cell,    lon,   lat
min values  :    2304, -179.5, -89.5
max values  :   64800,  179.5,  83.5

structure(list(ID_cell = c(2304L, 2305L, 2306L, 2307L, 2308L,
2309L, 2310L, 2311L, 2618L, 2619L, 2620L, 2621L, 2622L, 2623L,
2624L, 2625L, 2626L, 2627L, 2628L, 2629L), lon = c(-36.5, -35.5,
-34.5, -33.5, -32.5, -31.5, -30.5, -29.5, -82.5, -81.5, -80.5,
-79.5, -78.5, -77.5, -76.5, -75.5, -74.5, -73.5, -72.5, -71.5
), lat = c(83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 82.5,
82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5
)), .Names = c("ID_cell", "lon", "lat"), data_types = c("N",
"F", "F", "C", "C", "C", "C"), row.names = c("g144", "g145",
"g146", "g147", "g148", "g149", "g150", "g151", "g458", "g459",
"g460", "g461", "g462", "g463", "g464", "g465", "g466", "g467",
"g468", "g469"), class = "data.frame")

Is this correct or even on the right track? I hope I have provided enough
information. Thank you so much.

SIncerely,

Milu

On Mon, Dec 26, 2016 at 7:24 AM, Michael Sumner <mdsumner at gmail.com> wrote:

> It is but you will need at least a grouping ID for each polygon ring
> within each object, and an order within each ring. Is ID_cell the object ID?
>
> If there is only a single ring polygon within each object and the order is
> native it's simplest, but the constructors require very particular
> arrangements of your data, there is no abstractions for this. See
> raster::spPolygons and spbabel::sp for alternative constructors, but other
> wise see Polygon, Polygons, SpatialPolygons and SpatialPolygonsDataFrame in
> sp.
>
> There's not enough information in your post to be sure of what you have,
> but I'm happy to help if you provide more detail about how your data is
> organized. You could post sample data, or describe them in more detail. Do
> you have actual  polygons here or are you attempting to estimate them from
> point data?
>
> To add more alternatives the new sf package simplifies the constructors a
> lot, for a new family of classes, but still you need to nest matrices of
> coordinates manually to use them rather than specify their organization
> abstractly.  I'm working on tools to do that, but there is only spbabel so
> far (it's really just a two-level grouping of coordinates for spatial
> objects and their parts, but various legacies make it ever more
> complicated).
>
> Cheers, Mike
>
> On Sun, Dec 25, 2016, 02:28 Miluji Sb <milujisb at gmail.com> wrote:
>
> I have a SpatialPointsDataFrame with the following attributes. Is it
> possible to convert this to a SpatialPolygons or SpatialPolygonsDataFrame?
> Thank you!
>
> Sincerely,
>
> Milu
>
> class       : SpatialPointsDataFrame
> features    : 21441
> extent      : -179.5, 179.5, -89.5, 83.5  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +a=6367470 +b=6367470 +no_defs
> variables   : 7
> names       : ID_cell,    lon,   lat, Field4, Field5, Field6, Field7
> min values  :    2304,    0.5,   0.5,     NA,     NA,     NA,     NA
> max values  :   64800, -179.5, -89.5,     NA,     NA,     NA,     NA
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Mon Dec 26 13:12:15 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 26 Dec 2016 12:12:15 +0000
Subject: [R-sig-Geo] Convert SpatialPointsDataFrame to SpatialPolygons
	or SpatialPolygonsDataFrame
In-Reply-To: <CAMLwc7M4UWM5WnnPQWDiKLcfn6KUNmsLN_47dV+MC7tkQVFg9Q@mail.gmail.com>
References: <CAMLwc7M5k5qmf8DC_euPsVeby2+4v07PjbKqCBZEyPJ9GMLO+Q@mail.gmail.com>
	<CAAcGz998RWz3s2guU4fB=qdvqCfZ607SbUofF472T+iqdX0H+w@mail.gmail.com>
	<CAMLwc7M4UWM5WnnPQWDiKLcfn6KUNmsLN_47dV+MC7tkQVFg9Q@mail.gmail.com>
Message-ID: <CAAcGz9_nQ6RnY+EXO3nmwBtmubFsDDdP3jHqZJ4180F-ZOfOFg@mail.gmail.com>

On Mon, 26 Dec 2016 at 22:39 Miluji Sb <milujisb at gmail.com> wrote:

> Dear Michael,
>
> Merry Christmas and seasons's greetings! Thank you for your reply, I am
> providing more information and my attempts to convert
> to SpatialPolygonsDataFrame below.
>
> The original SpatialPointsDataFrame has the following attributes:
>
> class       : SpatialPointsDataFrame
> features    : 21441
> extent      : -179.5, 179.5, -89.5, 83.5  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +ellps=WGS84
> variables   : 3
> names       : ID_cell,    lon,   lat
> min values  :    2304, -179.5, -89.5
> max values  :   64800,  179.5,  83.5
>
> The data looks like this:
>
> dput(head(shp at data,20))
> structure(list(ID_cell = c(2304L, 2305L, 2306L, 2307L, 2308L,
> 2309L, 2310L, 2311L, 2618L, 2619L, 2620L, 2621L, 2622L, 2623L,
> 2624L, 2625L, 2626L, 2627L, 2628L, 2629L), lon = c(-36.5, -35.5,
> -34.5, -33.5, -32.5, -31.5, -30.5, -29.5, -82.5, -81.5, -80.5,
> -79.5, -78.5, -77.5, -76.5, -75.5, -74.5, -73.5, -72.5, -71.5
> ), lat = c(83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 82.5,
> 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5
> )), .Names = c("ID_cell", "lon", "lat"), data_types = c("N",
> "F", "F", "C", "C", "C", "C"), row.names = c("0", "1", "2", "3",
> "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15",
> "16", "17", "18", "19"), class = "data.frame")
>
> I tried the following:
>
> x = as(SpatialPixelsDataFrame(shp, shp at data, tolerance=.00086),
> "SpatialPolygonsDataFrame"), it seemed to have worked but got the following
> warning:
>
> Warning message:
> In points2grid(points, tolerance, round) :
>   grid has empty column/rows in dimension 2
>
> Now the converted SpatialPolygonsDataFrame has the following attributes:
>
> class       : SpatialPolygonsDataFrame
> features    : 21441
> extent      : -180, 180, -90, 84  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +ellps=WGS84
> variables   : 3
> names       : ID_cell,    lon,   lat
> min values  :    2304, -179.5, -89.5
> max values  :   64800,  179.5,  83.5
>
> structure(list(ID_cell = c(2304L, 2305L, 2306L, 2307L, 2308L,
> 2309L, 2310L, 2311L, 2618L, 2619L, 2620L, 2621L, 2622L, 2623L,
> 2624L, 2625L, 2626L, 2627L, 2628L, 2629L), lon = c(-36.5, -35.5,
> -34.5, -33.5, -32.5, -31.5, -30.5, -29.5, -82.5, -81.5, -80.5,
> -79.5, -78.5, -77.5, -76.5, -75.5, -74.5, -73.5, -72.5, -71.5
> ), lat = c(83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 82.5,
> 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5
> )), .Names = c("ID_cell", "lon", "lat"), data_types = c("N",
> "F", "F", "C", "C", "C", "C"), row.names = c("g144", "g145",
> "g146", "g147", "g148", "g149", "g150", "g151", "g458", "g459",
> "g460", "g461", "g462", "g463", "g464", "g465", "g466", "g467",
> "g468", "g469"), class = "data.frame")
>
> Is this correct or even on the right track? I hope I have provided enough
> information. Thank you so much.
>
>
That is certainly one correct conversion of a set of points, interpreted as
a regular grid of cells about the points-as-centres, then converted to
polygons (quite different from the wrong guess I made at first). It's
extremely inefficient because of all the redundant coordinates stored for
every polygon, but that may not be a concern.

Without knowing your requirements it's not possible to know if this is a
useful way to go. You can avoid the redundancy by keeping the thing as a
grid, and I would explore the raster package for an alternative to the
SpatialPixelsDataFrame used here, it doesn't allow mixed columns of data
types on a data frame but does have a lot of high-level tools for regular,
numeric grids.

We still don't know why you wanted polygons, or whether the tolerance of
"regular" used will affect the results you are after but other than that
and the inefficiencies inherent in the storage I don't see any real problem
with what you're doing.

If you can detail why you want to do this, and what comes next, there's
probably better advice to be given.

Cheers, Mike.

SIncerely,
>
> Milu
>
> On Mon, Dec 26, 2016 at 7:24 AM, Michael Sumner <mdsumner at gmail.com>
> wrote:
>
> It is but you will need at least a grouping ID for each polygon ring
> within each object, and an order within each ring. Is ID_cell the object ID?
>
> If there is only a single ring polygon within each object and the order is
> native it's simplest, but the constructors require very particular
> arrangements of your data, there is no abstractions for this. See
> raster::spPolygons and spbabel::sp for alternative constructors, but other
> wise see Polygon, Polygons, SpatialPolygons and SpatialPolygonsDataFrame in
> sp.
>
> There's not enough information in your post to be sure of what you have,
> but I'm happy to help if you provide more detail about how your data is
> organized. You could post sample data, or describe them in more detail. Do
> you have actual  polygons here or are you attempting to estimate them from
> point data?
>
> To add more alternatives the new sf package simplifies the constructors a
> lot, for a new family of classes, but still you need to nest matrices of
> coordinates manually to use them rather than specify their organization
> abstractly.  I'm working on tools to do that, but there is only spbabel so
> far (it's really just a two-level grouping of coordinates for spatial
> objects and their parts, but various legacies make it ever more
> complicated).
>
> Cheers, Mike
>
> On Sun, Dec 25, 2016, 02:28 Miluji Sb <milujisb at gmail.com> wrote:
>
> I have a SpatialPointsDataFrame with the following attributes. Is it
> possible to convert this to a SpatialPolygons or SpatialPolygonsDataFrame?
> Thank you!
>
> Sincerely,
>
> Milu
>
> class       : SpatialPointsDataFrame
> features    : 21441
> extent      : -179.5, 179.5, -89.5, 83.5  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +a=6367470 +b=6367470 +no_defs
> variables   : 7
> names       : ID_cell,    lon,   lat, Field4, Field5, Field6, Field7
> min values  :    2304,    0.5,   0.5,     NA,     NA,     NA,     NA
> max values  :   64800, -179.5, -89.5,     NA,     NA,     NA,     NA
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>
> --
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From milujisb at gmail.com  Mon Dec 26 13:32:56 2016
From: milujisb at gmail.com (Miluji Sb)
Date: Mon, 26 Dec 2016 13:32:56 +0100
Subject: [R-sig-Geo] Convert SpatialPointsDataFrame to SpatialPolygons
	or SpatialPolygonsDataFrame
In-Reply-To: <CAAcGz9_nQ6RnY+EXO3nmwBtmubFsDDdP3jHqZJ4180F-ZOfOFg@mail.gmail.com>
References: <CAMLwc7M5k5qmf8DC_euPsVeby2+4v07PjbKqCBZEyPJ9GMLO+Q@mail.gmail.com>
	<CAAcGz998RWz3s2guU4fB=qdvqCfZ607SbUofF472T+iqdX0H+w@mail.gmail.com>
	<CAMLwc7M4UWM5WnnPQWDiKLcfn6KUNmsLN_47dV+MC7tkQVFg9Q@mail.gmail.com>
	<CAAcGz9_nQ6RnY+EXO3nmwBtmubFsDDdP3jHqZJ4180F-ZOfOFg@mail.gmail.com>
Message-ID: <CAMLwc7OERmY1h3S_n12a_+-6GW6iTi84Sa+zqO9m0e=Ueo-3Dw@mail.gmail.com>

Dear Michael,

Thank you again for your reply. Apologies for not answering your question
earlier. My goal is to extract data a GeoTIFF file using the nightlights
package. The requirement of the package is that shapefile must be in a
SpatialPolygons or SpatialPolygonsDataFrame. Thanks!

Sincerely,

Milu

On Mon, Dec 26, 2016 at 1:12 PM, Michael Sumner <mdsumner at gmail.com> wrote:

>
>
> On Mon, 26 Dec 2016 at 22:39 Miluji Sb <milujisb at gmail.com> wrote:
>
>> Dear Michael,
>>
>> Merry Christmas and seasons's greetings! Thank you for your reply, I am
>> providing more information and my attempts to convert
>> to SpatialPolygonsDataFrame below.
>>
>> The original SpatialPointsDataFrame has the following attributes:
>>
>> class       : SpatialPointsDataFrame
>> features    : 21441
>> extent      : -179.5, 179.5, -89.5, 83.5  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=longlat +ellps=WGS84
>> variables   : 3
>> names       : ID_cell,    lon,   lat
>> min values  :    2304, -179.5, -89.5
>> max values  :   64800,  179.5,  83.5
>>
>> The data looks like this:
>>
>> dput(head(shp at data,20))
>> structure(list(ID_cell = c(2304L, 2305L, 2306L, 2307L, 2308L,
>> 2309L, 2310L, 2311L, 2618L, 2619L, 2620L, 2621L, 2622L, 2623L,
>> 2624L, 2625L, 2626L, 2627L, 2628L, 2629L), lon = c(-36.5, -35.5,
>> -34.5, -33.5, -32.5, -31.5, -30.5, -29.5, -82.5, -81.5, -80.5,
>> -79.5, -78.5, -77.5, -76.5, -75.5, -74.5, -73.5, -72.5, -71.5
>> ), lat = c(83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 82.5,
>> 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5
>> )), .Names = c("ID_cell", "lon", "lat"), data_types = c("N",
>> "F", "F", "C", "C", "C", "C"), row.names = c("0", "1", "2", "3",
>> "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15",
>> "16", "17", "18", "19"), class = "data.frame")
>>
>> I tried the following:
>>
>> x = as(SpatialPixelsDataFrame(shp, shp at data, tolerance=.00086),
>> "SpatialPolygonsDataFrame"), it seemed to have worked but got the following
>> warning:
>>
>> Warning message:
>> In points2grid(points, tolerance, round) :
>>   grid has empty column/rows in dimension 2
>>
>> Now the converted SpatialPolygonsDataFrame has the following attributes:
>>
>> class       : SpatialPolygonsDataFrame
>> features    : 21441
>> extent      : -180, 180, -90, 84  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=longlat +ellps=WGS84
>> variables   : 3
>> names       : ID_cell,    lon,   lat
>> min values  :    2304, -179.5, -89.5
>> max values  :   64800,  179.5,  83.5
>>
>> structure(list(ID_cell = c(2304L, 2305L, 2306L, 2307L, 2308L,
>> 2309L, 2310L, 2311L, 2618L, 2619L, 2620L, 2621L, 2622L, 2623L,
>> 2624L, 2625L, 2626L, 2627L, 2628L, 2629L), lon = c(-36.5, -35.5,
>> -34.5, -33.5, -32.5, -31.5, -30.5, -29.5, -82.5, -81.5, -80.5,
>> -79.5, -78.5, -77.5, -76.5, -75.5, -74.5, -73.5, -72.5, -71.5
>> ), lat = c(83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 83.5, 82.5,
>> 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5, 82.5
>> )), .Names = c("ID_cell", "lon", "lat"), data_types = c("N",
>> "F", "F", "C", "C", "C", "C"), row.names = c("g144", "g145",
>> "g146", "g147", "g148", "g149", "g150", "g151", "g458", "g459",
>> "g460", "g461", "g462", "g463", "g464", "g465", "g466", "g467",
>> "g468", "g469"), class = "data.frame")
>>
>> Is this correct or even on the right track? I hope I have provided enough
>> information. Thank you so much.
>>
>>
> That is certainly one correct conversion of a set of points, interpreted
> as a regular grid of cells about the points-as-centres, then converted to
> polygons (quite different from the wrong guess I made at first). It's
> extremely inefficient because of all the redundant coordinates stored for
> every polygon, but that may not be a concern.
>
> Without knowing your requirements it's not possible to know if this is a
> useful way to go. You can avoid the redundancy by keeping the thing as a
> grid, and I would explore the raster package for an alternative to the
> SpatialPixelsDataFrame used here, it doesn't allow mixed columns of data
> types on a data frame but does have a lot of high-level tools for regular,
> numeric grids.
>
> We still don't know why you wanted polygons, or whether the tolerance of
> "regular" used will affect the results you are after but other than that
> and the inefficiencies inherent in the storage I don't see any real problem
> with what you're doing.
>
> If you can detail why you want to do this, and what comes next, there's
> probably better advice to be given.
>
> Cheers, Mike.
>
> SIncerely,
>>
>> Milu
>>
>> On Mon, Dec 26, 2016 at 7:24 AM, Michael Sumner <mdsumner at gmail.com>
>> wrote:
>>
>> It is but you will need at least a grouping ID for each polygon ring
>> within each object, and an order within each ring. Is ID_cell the object ID?
>>
>> If there is only a single ring polygon within each object and the order
>> is native it's simplest, but the constructors require very particular
>> arrangements of your data, there is no abstractions for this. See
>> raster::spPolygons and spbabel::sp for alternative constructors, but other
>> wise see Polygon, Polygons, SpatialPolygons and SpatialPolygonsDataFrame in
>> sp.
>>
>> There's not enough information in your post to be sure of what you have,
>> but I'm happy to help if you provide more detail about how your data is
>> organized. You could post sample data, or describe them in more detail. Do
>> you have actual  polygons here or are you attempting to estimate them from
>> point data?
>>
>> To add more alternatives the new sf package simplifies the constructors a
>> lot, for a new family of classes, but still you need to nest matrices of
>> coordinates manually to use them rather than specify their organization
>> abstractly.  I'm working on tools to do that, but there is only spbabel so
>> far (it's really just a two-level grouping of coordinates for spatial
>> objects and their parts, but various legacies make it ever more
>> complicated).
>>
>> Cheers, Mike
>>
>> On Sun, Dec 25, 2016, 02:28 Miluji Sb <milujisb at gmail.com> wrote:
>>
>> I have a SpatialPointsDataFrame with the following attributes. Is it
>> possible to convert this to a SpatialPolygons or SpatialPolygonsDataFrame?
>> Thank you!
>>
>> Sincerely,
>>
>> Milu
>>
>> class       : SpatialPointsDataFrame
>> features    : 21441
>> extent      : -179.5, 179.5, -89.5, 83.5  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=longlat +a=6367470 +b=6367470 +no_defs
>> variables   : 7
>> names       : ID_cell,    lon,   lat, Field4, Field5, Field6, Field7
>> min values  :    2304,    0.5,   0.5,     NA,     NA,     NA,     NA
>> max values  :   64800, -179.5, -89.5,     NA,     NA,     NA,     NA
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Dr. Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> 203 Channel Highway
>> Kingston Tasmania 7050 Australia
>>
>>
>> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>

	[[alternative HTML version deleted]]


From amit.boshale at yahoo.com  Tue Dec 27 11:49:25 2016
From: amit.boshale at yahoo.com (Amit Boshale)
Date: Tue, 27 Dec 2016 10:49:25 +0000 (UTC)
Subject: [R-sig-Geo] plotKML RasterBrickTimeSeries (timeseries charts) in
 parallel and regions
References: <1939289357.3727750.1482835765461.ref@mail.yahoo.com>
Message-ID: <1939289357.3727750.1482835765461@mail.yahoo.com>

I am trying to plot a very large timeseries charts associated with RasterBrickTimeSeries-class in plotKML. The idea is to divide the RasterBrickTimeSeries into regions, and to use snowfall multicore as well.A reproducible example is below:library(plotKML)
library(raster)
library(sp)
library(snowfall)
data(LST)
#create a sample point for each cell
pnts <- LST[,47:48] # lon and lat columns
pnts <- cbind(1:nrow(pnts), pnts)
coordinates(pnts) <- ~lon + lat
proj4string(pnts) <- CRS("+proj=longlat +datum=WGS84")

gridded(LST) <- ~lon+lat
proj4string(LST) <- CRS("+proj=longlat +datum=WGS84")
## get the dates from the file names:
dates <- sapply(strsplit(names(LST), "LST"), function(x){x[[2]]})
datesf <- format(as.Date(dates, "%Y_%m_%d"), "%Y-%m-%dT%H:%M:%SZ")
## begin / end dates +/- 4 days:
TimeSpan.begin = as.POSIXct(unclass(as.POSIXct(datesf))-4*24*60*60, origin="1970-01-01") 
TimeSpan.end = as.POSIXct(unclass(as.POSIXct(datesf))+4*24*60*60, origin="1970-01-01")

LST_ll <- brick(LST[1:5])
LST_ll at title = "Land Surface Temperature images"
LST.ts <- new("RasterBrickTimeSeries", variable = "LST", sampled = pnts, 
              rasters = LST_ll, TimeSpan.begin = TimeSpan.begin[1:5], 
              TimeSpan.end = TimeSpan.end[1:5])
data(SAGA_pal)
## plot images in Google Earth:
plotKML(LST.ts, colour_scale=SAGA_pal[[1]])Till here the code is fine, a chart is plotted for each pointTrying the kml.tiles on pnts works:tiles.LST.ts <- kml.tiles(pnts, block.x=0.05, size=0.4)Tiles are produced and work fine, but of course it plots only the point locations not the actual charts.I am not much interested in plotting the raster themselves, rather the timeseries charts only. Hence, plotKML.GDALobj might not be the best optionIs there a way to use kml.tiles on the LST.ts (i.e. RasterBrickTimeSeries) to plot the timeseries charts in parallels and 
regions?
Best, Amit
p.s. I asked this question on?gis.stackexchange, but didn't get answers yet. I though, I might have better chances here! 

  
|  
|   
|   
|   |    |

   |

  |
|  
|   |  
plotKML RasterBrickTimeSeries (timeseries charts) in parallel and regions
 I am trying to plot a very large timeseries charts associated with RasterBrickTimeSeries-class in plotKML. The i...  |   |

  |

  |

 
 
	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Wed Dec 28 21:40:14 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 28 Dec 2016 21:40:14 +0100
Subject: [R-sig-Geo] sp::spDists*
In-Reply-To: <5f120dcd-0b4a-33f4-52a0-6da70a511cae@uni-muenster.de>
References: <5f120dcd-0b4a-33f4-52a0-6da70a511cae@uni-muenster.de>
Message-ID: <bf691a97-3b05-641a-ab5a-58093e232fca@uni-muenster.de>

The problem described below has been corrected ins sp 1.2-4 which is now
on CRAN; new releases of gstat, spgwr and spdep will follow to correct
for the same bug.

On 08/12/16 15:48, Edzer Pebesma wrote:
> While building support for geosphere distance functions in sf and
> comparing results from geosphere::distMeeuws with those of sp::spDists,
> I found a typo in the C code underlying the great circle distance
> computation functions in sp (sp::spDists, sp::spDistsN1) [*]:
> 
> https://github.com/edzer/sp/commit/d8374ff7efc6735cba9a054748c602bed0672f23
> 
> Before:
>> library(sf)
> Linking to GEOS 3.5.0, GDAL 2.1.0, proj.4 4.9.2
>> library(sp)
>> library(units)
>>
>> x = st_sfc(
> + st_point(c(0,0)),
> + st_point(c(1,0)),
> + st_point(c(2,0)),
> + st_point(c(3,0)),
> + crs = 4326
> + )
>>
>> y = st_sfc(
> + st_point(c(0,10)),
> + st_point(c(1,0)),
> + st_point(c(2,0)),
> + st_point(c(3,0)),
> + st_point(c(4,0)),
> + crs = 4326
> + )
>>
>> st_distance(x, y)
> Units: m
>         [,1]     [,2]     [,3]     [,4]     [,5]
> [1,] 1105855 111319.5 222639.0 333958.5 445278.0
> [2,] 1111387      0.0 111319.5 222639.0 333958.5
> [3,] 1127822 111319.5      0.0 111319.5 222639.0
> [4,] 1154693 222639.0 111319.5      0.0 111319.5
>>
>> d.sf = st_distance(x, y, geosphere::distMeeus)
>> d.sp = spDists(as(x, "Spatial"), as(y, "Spatial"))
>> units(d.sp) = make_unit("km")
>> d.sf - d.sp
> Units: m
>          [,1]         [,2]         [,3]         [,4] [,5]
> [1,] 1851.990 0.000000e+00 0.000000e+00 0.000000e+00    0
> [2,] 1842.938 0.000000e+00 0.000000e+00 2.910383e-11    0
> [3,] 1816.564 0.000000e+00 0.000000e+00 1.455192e-11    0
> [4,] 1775.032 2.910383e-11 1.455192e-11 0.000000e+00    0
>>
> 
> 
> 
> After:
> 
>> library(sf)
> Linking to GEOS 3.5.0, GDAL 2.1.0, proj.4 4.9.2
>> library(sp)
>> library(units)
>>
>> x = st_sfc(
> + st_point(c(0,0)),
> + st_point(c(1,0)),
> + st_point(c(2,0)),
> + st_point(c(3,0)),
> + crs = 4326
> + )
>>
>> y = st_sfc(
> + st_point(c(0,10)),
> + st_point(c(1,0)),
> + st_point(c(2,0)),
> + st_point(c(3,0)),
> + st_point(c(4,0)),
> + crs = 4326
> + )
>>
>> st_distance(x, y)
> Units: m
>         [,1]     [,2]     [,3]     [,4]     [,5]
> [1,] 1105855 111319.5 222639.0 333958.5 445278.0
> [2,] 1111387      0.0 111319.5 222639.0 333958.5
> [3,] 1127822 111319.5      0.0 111319.5 222639.0
> [4,] 1154693 222639.0 111319.5      0.0 111319.5
>>
>> d.sf = st_distance(x, y, geosphere::distMeeus)
>> d.sp = spDists(as(x, "Spatial"), as(y, "Spatial"))
>> units(d.sp) = make_unit("km")
>> d.sf - d.sp
> Units: m
>               [,1]         [,2]         [,3]         [,4] [,5]
> [1,] -2.328306e-10 0.000000e+00 0.000000e+00 0.000000e+00    0
> [2,]  2.328306e-10 0.000000e+00 0.000000e+00 2.910383e-11    0
> [3,]  0.000000e+00 0.000000e+00 0.000000e+00 1.455192e-11    0
> [4,]  0.000000e+00 2.910383e-11 1.455192e-11 0.000000e+00    0
>>
> 
> [*] assuming the source code of
> http://www.abecedarical.com/javascript/script_greatcircle.html is
> correct; I don't have access to the Meeuws book mentioned there under (1).
> 
> The same C function is used by gstat; I corrected that as well.
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161228/cff759a4/attachment.bin>

From mazatlanmexico at yahoo.com  Thu Dec 29 18:51:33 2016
From: mazatlanmexico at yahoo.com (Felipe Carrillo)
Date: Thu, 29 Dec 2016 17:51:33 +0000 (UTC)
Subject: [R-sig-Geo] display location on google earth
References: <929651399.3321544.1483033893031.ref@mail.yahoo.com>
Message-ID: <929651399.3321544.1483033893031@mail.yahoo.com>

Hi;I have a shapefile named 'Wolf' that I can display in google with the following code:??# Show the shapefile on top of google
?writeOGR(Wolf, "Wolf.kml", "Wolf", driver="KML")?????? 
?system("open Wolf.kml") 

However, I am having problems with a single set of coordinates that I would like to use to display a location.Could someone show me how to display on google with the following coordinates?
?Latitude 38?34'02",?? Longitude 121?23'14"?? NAD27
I have tried:
?require(rgdal)
?library(sp) 
lat <- '38.34477586' 
?lon <- '-121.23387625' 

?# make a data frame 
?coords <- as.data.frame(cbind(lon=lon,lat=lat))
?coords
?# make it a spatial object 
?coordinates(coords) <- ~lat+lon 
?coords <- spTransform(coords)

But I am getting the following error:
Error in (function (classes, fdef, mtable)? : 
? unable to find an inherited method for function ?spTransform? for signature ?"CRS", "missing"?






	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Thu Dec 29 19:19:30 2016
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 29 Dec 2016 18:19:30 +0000
Subject: [R-sig-Geo] display location on google earth
In-Reply-To: <929651399.3321544.1483033893031@mail.yahoo.com>
References: <929651399.3321544.1483033893031.ref@mail.yahoo.com>
	<929651399.3321544.1483033893031@mail.yahoo.com>
Message-ID: <CANVKczP5A0D6QKzjDqwK7-vJM6-QMvzVJwxPibB42_-kHiMkWQ@mail.gmail.com>

You made a couple of little mistakes! See below:

On Thu, Dec 29, 2016 at 5:51 PM, Felipe Carrillo via R-sig-Geo
<r-sig-geo at r-project.org> wrote:
> Hi;I have a shapefile named 'Wolf' that I can display in google with the following code:  # Show the shapefile on top of google
>  writeOGR(Wolf, "Wolf.kml", "Wolf", driver="KML")
>  system("open Wolf.kml")
>
> However, I am having problems with a single set of coordinates that I would like to use to display a location.Could someone show me how to display on google with the following coordinates?
>  Latitude 38?34'02",   Longitude 121?23'14"   NAD27
> I have tried:
>  require(rgdal)
>  library(sp)

You've defined lat and lon here as characters - these should be numeric:

> lat <- '38.34477586'
>  lon <- '-121.23387625'

  lon <- -121.23387625
  lat <- 38.34477586


>  # make a data frame
>  coords <- as.data.frame(cbind(lon=lon,lat=lat))
>  coords
>  # make it a spatial object
>  coordinates(coords) <- ~lat+lon

Here you've got your lat-lon the wrong way round. coordinate
assignment wants lon first, so:

coordinates(coords)=~lon+lat

>  coords <- spTransform(coords)
>
> But I am getting the following error:
> Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?spTransform? for signature ?"CRS", "missing"?

That error is because you've tried to transform something without giving a CRS.

You seem to have lat-long in NAD27 datum, which I think is EPSG code
4267. So first give it that code:

proj4string(coords)=CRS("+init=epsg:4267")

and now you can convert to whatever you want:

 spTransform(coords, "+init=epsg:4326")

SpatialPoints:
        lon      lat
1 -121.2349 38.34469
Coordinate Reference System (CRS) arguments: +init=epsg:4326
+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0

Which seems to concur with this converter tool:

http://tagis.dep.wv.gov/convert/

which returns:

38.344689,-121.234935

but I'm no expert when it comes to datum shifts in CRS transformations...

>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mazatlanmexico at yahoo.com  Thu Dec 29 21:08:18 2016
From: mazatlanmexico at yahoo.com (Felipe Carrillo)
Date: Thu, 29 Dec 2016 20:08:18 +0000 (UTC)
Subject: [R-sig-Geo] display location on google earth
In-Reply-To: <CANVKczP5A0D6QKzjDqwK7-vJM6-QMvzVJwxPibB42_-kHiMkWQ@mail.gmail.com>
References: <929651399.3321544.1483033893031.ref@mail.yahoo.com>
	<929651399.3321544.1483033893031@mail.yahoo.com>
	<CANVKczP5A0D6QKzjDqwK7-vJM6-QMvzVJwxPibB42_-kHiMkWQ@mail.gmail.com>
Message-ID: <645276922.3423911.1483042098810@mail.yahoo.com>

Thanks for the advice, it is working now.?
 

    On Thursday, December 29, 2016 10:19 AM, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> wrote:
 
 

 You made a couple of little mistakes! See below:

On Thu, Dec 29, 2016 at 5:51 PM, Felipe Carrillo via R-sig-Geo
<r-sig-geo at r-project.org> wrote:
> Hi;I have a shapefile named 'Wolf' that I can display in google with the following code:? # Show the shapefile on top of google
>? writeOGR(Wolf, "Wolf.kml", "Wolf", driver="KML")
>? system("open Wolf.kml")
>
> However, I am having problems with a single set of coordinates that I would like to use to display a location.Could someone show me how to display on google with the following coordinates?
>? Latitude 38?34'02",? Longitude 121?23'14"? NAD27
> I have tried:
>? require(rgdal)
>? library(sp)

You've defined lat and lon here as characters - these should be numeric:

> lat <- '38.34477586'
>? lon <- '-121.23387625'

? lon <- -121.23387625
? lat <- 38.34477586


>? # make a data frame
>? coords <- as.data.frame(cbind(lon=lon,lat=lat))
>? coords
>? # make it a spatial object
>? coordinates(coords) <- ~lat+lon

Here you've got your lat-lon the wrong way round. coordinate
assignment wants lon first, so:

coordinates(coords)=~lon+lat

>? coords <- spTransform(coords)
>
> But I am getting the following error:
> Error in (function (classes, fdef, mtable)? :
>? unable to find an inherited method for function ?spTransform? for signature ?"CRS", "missing"?

That error is because you've tried to transform something without giving a CRS.

You seem to have lat-long in NAD27 datum, which I think is EPSG code
4267. So first give it that code:

proj4string(coords)=CRS("+init=epsg:4267")

and now you can convert to whatever you want:

 spTransform(coords, "+init=epsg:4326")

SpatialPoints:
? ? ? ? lon? ? ? lat
1 -121.2349 38.34469
Coordinate Reference System (CRS) arguments: +init=epsg:4326
+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0

Which seems to concur with this converter tool:

http://tagis.dep.wv.gov/convert/

which returns:

38.344689,-121.234935

but I'm no expert when it comes to datum shifts in CRS transformations...

>
>
>
>
>
>? ? ? ? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

 
   
	[[alternative HTML version deleted]]


