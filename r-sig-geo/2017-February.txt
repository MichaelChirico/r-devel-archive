From konno_kazuma at mailplus.pl  Wed Feb  1 13:19:39 2017
From: konno_kazuma at mailplus.pl (=?UTF-8?Q?Kamil_Konowalik?=)
Date: Wed, 01 Feb 2017 13:19:39 +0100
Subject: [R-sig-Geo] =?utf-8?q?Problem_with_operations_on_large_files_=28?=
	=?utf-8?q?=22cannot_allocate_vector_of_size_xx=22=29?=
Message-ID: <87fe5d0.57600903.5891d25b.c1411@mailplus.pl>

Hi All,
I have a problem with operations on large datasets. I have a several raster files (43) and I would like to make a PCA on them. 
I'm using those simple commands:

files <- list.files("G:/GIS/raster_TIFF",pattern='tif',full.names=TRUE)
s <- raster::stack(files)
pca<-princomp(na.omit(values(s)), cor=TRUE)

But after the last one I'm getting an error: "cannot allocate vector of size 6.6 Gb".
I searched the internet and there are some advices but I couldn't found anything helpful. I'm using Windows 7 64 bit with 8 GB of RAM so it is not an issue with 32 bit. Also I would prefer to find a solution which can use my current resources rather than buying additional RAM. I thought that maybe "bigmemory" package will be a solution but I couldn't make it work. I tried also different file types (ASCII, RASTER, GTiff) but that doesn't help neither. 
It should be a simple and a common problem but I can't figure answer on my own so if you have any working solution I would appreciate it. 
Thanks in advance!
Best regards,
Kamil


From bfalevlist at gmail.com  Wed Feb  1 13:52:32 2017
From: bfalevlist at gmail.com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Wed, 1 Feb 2017 13:52:32 +0100
Subject: [R-sig-Geo] Problem with operations on large files ("cannot
 allocate vector of size xx")
In-Reply-To: <87fe5d0.57600903.5891d25b.c1411@mailplus.pl>
References: <87fe5d0.57600903.5891d25b.c1411@mailplus.pl>
Message-ID: <04fcb20c-a417-22ee-d64e-18be50f10d2a@gmail.com>

Dear Kamil,

Have you tried this?:
memory.limit(10000) # increase the memory limit of R from the default 
4006 MB to 10000MB
See details:
https://stat.ethz.ch/R-manual/R-devel/library/base/html/Memory-limits.html

I have 64 bit Windows with 64 bit R, but without memory.limit() I get 
similar error when working with large data.

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2017.02.01. 13:19 keltez?ssel, Kamil Konowalik ?rta:
> Hi All,
> I have a problem with operations on large datasets. I have a several raster files (43) and I would like to make a PCA on them.
> I'm using those simple commands:
>
> files <- list.files("G:/GIS/raster_TIFF",pattern='tif',full.names=TRUE)
> s <- raster::stack(files)
> pca<-princomp(na.omit(values(s)), cor=TRUE)
>
> But after the last one I'm getting an error: "cannot allocate vector of size 6.6 Gb".
> I searched the internet and there are some advices but I couldn't found anything helpful. I'm using Windows 7 64 bit with 8 GB of RAM so it is not an issue with 32 bit. Also I would prefer to find a solution which can use my current resources rather than buying additional RAM. I thought that maybe "bigmemory" package will be a solution but I couldn't make it work. I tried also different file types (ASCII, RASTER, GTiff) but that doesn't help neither.
> It should be a simple and a common problem but I can't figure answer on my own so if you have any working solution I would appreciate it.
> Thanks in advance!
> Best regards,
> Kamil
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From benjamin.leutner at uni-wuerzburg.de  Wed Feb  1 14:01:25 2017
From: benjamin.leutner at uni-wuerzburg.de (Benjamin Leutner)
Date: Wed, 1 Feb 2017 14:01:25 +0100
Subject: [R-sig-Geo] Problem with operations on large files ("cannot
 allocate vector of size xx")
In-Reply-To: <87fe5d0.57600903.5891d25b.c1411@mailplus.pl>
References: <87fe5d0.57600903.5891d25b.c1411@mailplus.pl>
Message-ID: <d9b928c4-bb62-7539-beca-39305fa2c9e9@uni-wuerzburg.de>

You can have a look at the code of rasterPCA in my RStoolbox package, it 
does exactly that.
Either you fit the PCA only on a subset of pixels and apply it to all, 
or you calculate the covariance or correlation matrix first in a 
stepwise fashion and then build the PCA from it.

Cheers,
Benjamin

On 01.02.2017 13:19, Kamil Konowalik wrote:
> Hi All,
> I have a problem with operations on large datasets. I have a several raster files (43) and I would like to make a PCA on them.
> I'm using those simple commands:
>
> files <- list.files("G:/GIS/raster_TIFF",pattern='tif',full.names=TRUE)
> s <- raster::stack(files)
> pca<-princomp(na.omit(values(s)), cor=TRUE)
>
> But after the last one I'm getting an error: "cannot allocate vector of size 6.6 Gb".
> I searched the internet and there are some advices but I couldn't found anything helpful. I'm using Windows 7 64 bit with 8 GB of RAM so it is not an issue with 32 bit. Also I would prefer to find a solution which can use my current resources rather than buying additional RAM. I thought that maybe "bigmemory" package will be a solution but I couldn't make it work. I tried also different file types (ASCII, RASTER, GTiff) but that doesn't help neither.
> It should be a simple and a common problem but I can't figure answer on my own so if you have any working solution I would appreciate it.
> Thanks in advance!
> Best regards,
> Kamil
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From konno_kazuma at mailplus.pl  Wed Feb  1 14:07:19 2017
From: konno_kazuma at mailplus.pl (=?UTF-8?Q?Kamil_Konowalik?=)
Date: Wed, 01 Feb 2017 14:07:19 +0100
Subject: [R-sig-Geo]
	=?utf-8?q?Problem_with_operations_on_large_files_=28?=
	=?utf-8?q?=22cannotallocate_vector_of_size_xx=22=29?=
In-Reply-To: <04fcb20c-a417-22ee-d64e-18be50f10d2a@gmail.com>
References: <87fe5d0.57600903.5891d25b.c1411@mailplus.pl>
	<04fcb20c-a417-22ee-d64e-18be50f10d2a@gmail.com>
Message-ID: <4152063.49d47aad.5891dd87.b5ee@mailplus.pl>

Hi ?kos,
no - it's not that. I tried it already - my maximum RAM is 8 Gb but something is taken by Windows and other things. So even though I see that I should be able to finish operation (after rm() and gc() I have around 7Gb free) I always get "Error: cannot allocate vector of size 6.6 Gb".
But thanks for the suggestion!
Best regards,
Kamil


Dnia 1 lutego 2017 13:52 Bede-Fazekas ?kos <bfalevlist at gmail.com> napisa?(a):

> Dear Kamil,
> 
> Have you tried this?:
> memory.limit(10000) # increase the memory limit of R from the default 
> 4006 MB to 10000MB
> See details:
> https://stat.ethz.ch/R-manual/R-devel/library/base/html/Memory-limits.html
> 
> I have 64 bit Windows with 64 bit R, but without memory.limit() I get 
> similar error when working with large data.
> 
> HTH,
> ?kos Bede-Fazekas
> Hungarian Academy of Sciences
> 
> 2017.02.01. 13:19 keltez?ssel, Kamil Konowalik ?rta:
> > Hi All,
> > I have a problem with operations on large datasets. I have a several raster files (43) and I would like to make a PCA on them.
> > I'm using those simple commands:
> >
> > files <- list.files("G:/GIS/raster_TIFF",pattern='tif',full.names=TRUE)
> > s <- raster::stack(files)
> > pca<-princomp(na.omit(values(s)), cor=TRUE)
> >
> > But after the last one I'm getting an error: "cannot allocate vector of size 6.6 Gb".
> > I searched the internet and there are some advices but I couldn't found anything helpful. I'm using Windows 7 64 bit with 8 GB of RAM so it is not an issue with 32 bit. Also I would prefer to find a solution which can use my current resources rather than buying additional RAM. I thought that maybe "bigmemory" package will be a solution but I couldn't make it work. I tried also different file types (ASCII, RASTER, GTiff) but that doesn't help neither.
> > It should be a simple and a common problem but I can't figure answer on my own so if you have any working solution I would appreciate it.
> > Thanks in advance!
> > Best regards,
> > Kamil
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From martazores at gmail.com  Wed Feb  1 16:25:55 2017
From: martazores at gmail.com (marta azores)
Date: Wed, 1 Feb 2017 14:25:55 -0100
Subject: [R-sig-Geo] extract the attributes, lines to point
Message-ID: <CAE3WKgQXjZOuxu2N0_a0+NoJBhLf47bf=M8a0yATt2N-rBiNcA@mail.gmail.com>

Hi everyone,

I have to overlap points and lines, with the aim to get a data frame or
similar with the results of the intersection. For example:
Points Overlap
p1          Line1
p1          Line2
p2          Line1
p4          Line1

I have two dataset (lixo and boats) with location points and other
attributes.
I created spatial points data frame (sightings-"lixo") with the lixo
dataset and spatial lines data frame (transect boats-"line")
with the boat dataset. I used the function rgeos:gInstersect and I buffer
the lines, to get the intersections I expect.
But the gIntersect only says If the intersection is happening,  true or
false. I saw the function gUnion,
but it seems to get the area of the intersection, and not to extract
information from the attributes of the objects.
I though that may be I can use the function over with the line.buffer
because they are spatialpolygon.
However, I can't because my original database (11 spatial points) has
different row number than the final polygon (1 feature).

I think, I'm complicating the process. Is it possible to extract the
attributes between this kind of spatial objects?

Thanks in advance,

Marta



#script
##############
lixo <- read.table(paste0(path_data,"lixo4pontosDT.csv"), header=TRUE,
sep=",", na.strings="NA", dec=".", strip.white=TRUE)
sp::coordinates(lixo) <- ~Long1+Lat
sp::proj4string(lixo) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
lixo<-sp::spTransform(lixo, CRS("+proj=laea +lat_0=30 +lon_0=-30 +x_0=0
+y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))
raster::plot(lixo,add=TRUE)
str(lixo)
lixo
lixo
int <- gIntersects(line,lixo, byid = TRUE) # find which poinTs intersect
#Error: is.logical(byid) is not TRUE
class(int) # it's outputed a matrix
plot(gBuffer(line,width=0.002))
plot(int)
plot(lixo,add=TRUE)
line.buf<-gBuffer(line,width=0.002)
line.buf
#intersects works
int.buf <- gIntersects(line.buf,lixo, byid = TRUE) # find which poinTs
intersect
int.buf
Pnt_union <- gUnion(line.buf,lixo)
Pnt_union<- rgeos::gUnion(line.buf, lixo)

Pnt_union
plot(int.buf)
plot(line)
plot(line.buf,col='blue',add=TRUE);
plot(line,add=TRUE)
plot(Sptsdf,add=TRUE,pch=16,axes=TRUE)
title(paste("Intersects:",gIntersects(line.buf,Sptsdf),
"\nDisjoint:",gDisjoint(line,Sptsdf)))
library(rgeos)
#############
lixo#SpatialPointsDataFrame
line.buf#SpatialPolygons
str(line.buf)
pos
poldf = SpatialPolygonsDataFrame(line.buf, pos)#not make senses line.buf (1
feature), pos( 11 features)
join <- over(lixo, line.buf)
join
# Integrate this vegetation data into the SpatialPoints object
ptsrand <- SpatialPointsDataFrame(lixo, join)
head(ptsrand)
##################################
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170201/0a7cc8f7/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: boat2905.csv
Type: text/csv
Size: 585 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170201/0a7cc8f7/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lixo4pontosDT.csv
Type: text/csv
Size: 196 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170201/0a7cc8f7/attachment-0001.bin>

From Roger.Bivand at nhh.no  Thu Feb  2 09:22:05 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 2 Feb 2017 09:22:05 +0100
Subject: [R-sig-Geo] Warning: Mac OSX rgdal CRAN binary: proj gdal shared
	files missing
Message-ID: <alpine.LFD.2.20.1702020910510.2906@reclus.nhh.no>

If you are using the Mac OSX rgdal CRAN binary, be warned that 1.2-5 is 
missing two directories containing projection metadata, including datum 
shift files and proj_defs.dat. The two directories were omitted from the 
CRAN binary build of 17 December 2016. The resolution is given in:

https://stat.ethz.ch/pipermail/r-sig-geo/2017-January/025350.html

and reads:

Please see if you can download the equivalent Windows binary package:

https://cran.r-project.org/bin/windows/contrib/3.3/rgdal_1.2-5.zip

unzip it (do not install it), and copy the proj/ and gdal/ folders with
their contents to the folder shown (in R) by:

system.file("", package="rgdal")

For rgdal queries, always state verbatim the output of sessionInfo() and
the output of the startup messages shown when rgdal is loaded and
attached.

Roger Bivand
(rgdal source maintainer)

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584


From mauriziomarchi85 at gmail.com  Fri Feb  3 12:48:27 2017
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Fri, 3 Feb 2017 12:48:27 +0100
Subject: [R-sig-Geo] Problem with operations on large files
 ("cannotallocate vector of size xx")
Message-ID: <CANJhsN1ex7aDP9D_qYapoO2yy9Lg0Sz=ZeuARpHBO6TskU7pEA@mail.gmail.com>

Dear Kamil,
I have two suggestions:

1)
to run PCA on a subset of pixels, randomly selected using the sampleRandom
function of the raster package and then calculate the pca components as
rasters. Something like this where "r" is the RasterStack:
Rsampl<-sampleRandom(WCmaps,n)
#here n is the number of points randomly created; try with 5000 but you can
increase and you
#will see that after a specific value the results will not change
significantly so you will stop
pca<-prcomp(Rsampl,scale=T,center=T,retx=T)
#where "scale=T,center=T" is the same of "cor=T" in the princomp function
pca
summary(pca)
rastersPCA<-stack(predict(r,pca,index=1:n,progress='text'))
#here "n" is the number of components you want to create, generally up to
99% of the explained cumulative variance or those who explained at least 1
time the variance

2)
to run PCA on coarser rasters. Again "r" is the original RasterStack
AggregatedRasterStack<-aggregate(r,fact=n,fun=mean)
#n here is the number of pixels to be considered to calculate the mean. For
instance if you have
#a pixel of 1km edge, fact=5 will create a rasterStack with 5 km of spatial
resolution
pca<-prcomp(na.omit(values(AggregatedRasterStack)),scale=T,center=T,retx=T)
#where again "scale=T,center=T" is the same of "cor=T" in the princomp
function
pca
summary(pca)
rastersPCA<-stack(predict(r,pca,index=1:n,progress='text'))
#here "n" is the number of components you want to create, generally up to
99% of the explained cumulative variance or those who explained at least 1
time the variance

Under a statistical point of view, the first is a random sampling while the
second is a sort of regular sampling

Regards, maurizio

--
Maurizio Marchi,
PhD - Forest Science, Ecological Modelling
Council for Agricultural Research and Economics (CREA, Italy)
SkypeID: maurizioxyzhttps://scholar.google.it/citations?user=_2X6fu8AAAAJ&hl=en
#-----#http://ec.europa.eu/environment/life/project/Projects/index.cfm?fuseaction=search.dspPage&n_proj_id=5035www.selpibio.euwww.eufgis.org

	[[alternative HTML version deleted]]


From tcorms at gmail.com  Fri Feb  3 14:47:17 2017
From: tcorms at gmail.com (Tina Cormier)
Date: Fri, 3 Feb 2017 08:47:17 -0500
Subject: [R-sig-Geo] Problem with operations on large files
 ("cannotallocate vector of size xx")
In-Reply-To: <CANJhsN1ex7aDP9D_qYapoO2yy9Lg0Sz=ZeuARpHBO6TskU7pEA@mail.gmail.com>
References: <CANJhsN1ex7aDP9D_qYapoO2yy9Lg0Sz=ZeuARpHBO6TskU7pEA@mail.gmail.com>
Message-ID: <CAFfx76_sU_VV1rKmS_=pvYyxcwpku+okWqN28OZvpd_fzaVAWQ@mail.gmail.com>

Hi Kamil,

If you don't need the PCA raster as an output, just the stats, I think
Maurizio's first idea is the way to go. If you do need the raster, but can
sacrifice some resolution, his second option (using aggregate first, then
calculating the PCA) is the way to go.

A third option, if you need a PCA raster output at it's original
resolution, would be to calculate the PCA in blocks using the blockSize
function and then loop over each block to calculate the PCA for those
cells, and putting it all back together at the end. That should alleviate
your memory issues.

Take a look at this vignette for an example, and I have pasted a slightly
adapted version of it below as well:
https://cran.r-project.org/web/packages/raster/vignettes/functions.pdf

# Note that you do not have to write the file to disk here - you can write
to the raster object created before the loop (the variable 'out') and hold
it in memory using setValues instead of writeStart, writeValues, and
writeStop.

# In the example in the pdf, this is written as a function. You can do it
either way.

# x is your stack
out <- raster(x) # assuming you are writing just the 1st pca to file -
otherwise this would be stack instead of raster.
bs <- blockSize(x)
out <- writeStart(out, filename, overwrite=TRUE)

# Loop over each block and do your calculation
for (i in 1:bs$n) {
    v <- getValues(x, row=bs$row[i], nrows=bs$nrows[i] )

   # Replace the next line with your pca analysis and would need code to
get it back to a raster
   # format (as long as you know the positions of the NAs, that's easy. Let
me know if you need help.
      v <- v + 5

      out <- writeValues(out, v, bs$row[i])
   }
out <- writeStop(out)
return(out)
##################

Hope that helps! Good luck!
Tina


On Fri, Feb 3, 2017 at 6:48 AM, Maurizio Marchi <mauriziomarchi85 at gmail.com>
wrote:

> Dear Kamil,
> I have two suggestions:
>
> 1)
> to run PCA on a subset of pixels, randomly selected using the sampleRandom
> function of the raster package and then calculate the pca components as
> rasters. Something like this where "r" is the RasterStack:
> Rsampl<-sampleRandom(WCmaps,n)
> #here n is the number of points randomly created; try with 5000 but you can
> increase and you
> #will see that after a specific value the results will not change
> significantly so you will stop
> pca<-prcomp(Rsampl,scale=T,center=T,retx=T)
> #where "scale=T,center=T" is the same of "cor=T" in the princomp function
> pca
> summary(pca)
> rastersPCA<-stack(predict(r,pca,index=1:n,progress='text'))
> #here "n" is the number of components you want to create, generally up to
> 99% of the explained cumulative variance or those who explained at least 1
> time the variance
>
> 2)
> to run PCA on coarser rasters. Again "r" is the original RasterStack
> AggregatedRasterStack<-aggregate(r,fact=n,fun=mean)
> #n here is the number of pixels to be considered to calculate the mean. For
> instance if you have
> #a pixel of 1km edge, fact=5 will create a rasterStack with 5 km of spatial
> resolution
> pca<-prcomp(na.omit(values(AggregatedRasterStack)),scale=
> T,center=T,retx=T)
> #where again "scale=T,center=T" is the same of "cor=T" in the princomp
> function
> pca
> summary(pca)
> rastersPCA<-stack(predict(r,pca,index=1:n,progress='text'))
> #here "n" is the number of components you want to create, generally up to
> 99% of the explained cumulative variance or those who explained at least 1
> time the variance
>
> Under a statistical point of view, the first is a random sampling while the
> second is a sort of regular sampling
>
> Regards, maurizio
>
> --
> Maurizio Marchi,
> PhD - Forest Science, Ecological Modelling
> Council for Agricultural Research and Economics (CREA, Italy)
> SkypeID: maurizioxyzhttps://scholar.google.it/citations?user=_
> 2X6fu8AAAAJ&hl=en
> #-----#http://ec.europa.eu/environment/life/project/
> Projects/index.cfm?fuseaction=search.dspPage&n_proj_id=
> 5035www.selpibio.euwww.eufgis.org
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mauriziomarchi85 at gmail.com  Fri Feb  3 15:10:50 2017
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Fri, 3 Feb 2017 15:10:50 +0100
Subject: [R-sig-Geo] Problem with operations on large files
 ("cannotallocate vector of size xx")
Message-ID: <CANJhsN12VpJWfXUQ8fsksmv047Hm6ePtBJhroo0Pt1VTrksMOw@mail.gmail.com>

Yes, Tina is right, anyway consider also that, looking at my code, the
prcomp function and the predict functions can be run with different
objects. For instance the pca can be run on a 5 km raster map (aggregated)
or on the random samples (you will see that with an adequate number of
points the results will be the same) but the predict function can be
launched on the original dataset (1km) obtaining the pca components with
the desired spatial resolution

Regards, maurizio

?--
Maurizio Marchi,
PhD - Forest Science, Ecological Modelling
Council for Agricultural Research and Economics (CREA, Italy)
SkypeID: maurizioxyz
https://scholar.google.it/citations?user=_2X6fu8AAAAJ&hl=en
#-----#
http://ec.europa.eu/environment/life/project/Projects/index.cfm?fuseaction=search.dspPage&n_proj_id=5035
www.selpibio.eu
??www.eufgis.org?

	[[alternative HTML version deleted]]


From benjamin.leutner at uni-wuerzburg.de  Fri Feb  3 15:24:56 2017
From: benjamin.leutner at uni-wuerzburg.de (Benjamin Leutner)
Date: Fri, 3 Feb 2017 15:24:56 +0100
Subject: [R-sig-Geo] Problem with operations on large files
 ("cannotallocate vector of size xx")
In-Reply-To: <CANJhsN12VpJWfXUQ8fsksmv047Hm6ePtBJhroo0Pt1VTrksMOw@mail.gmail.com>
References: <CANJhsN12VpJWfXUQ8fsksmv047Hm6ePtBJhroo0Pt1VTrksMOw@mail.gmail.com>
Message-ID: <ae4f00b9-d11f-f45b-2637-3ab495b8cca5@uni-wuerzburg.de>

Hi,

Blockwise calculation does not make sense with PCA as you will end-up 
with different components in each block.

As I wrote earlier, to calculate the PCA  based on all pixels you should 
calculate the covariance matrix first, which can be done in a memory 
safe way (raster::layerStats) and then feed that into princomp.
see:
https://github.com/bleutner/RStoolbox/blob/master/R/rasterPCA.R

cheers,
Benjamin

On 03.02.2017 15:10, Maurizio Marchi wrote:
> Yes, Tina is right, anyway consider also that, looking at my code, the
> prcomp function and the predict functions can be run with different
> objects. For instance the pca can be run on a 5 km raster map (aggregated)
> or on the random samples (you will see that with an adequate number of
> points the results will be the same) but the predict function can be
> launched on the original dataset (1km) obtaining the pca components with
> the desired spatial resolution
>
> Regards, maurizio
>
> ?--
> Maurizio Marchi,
> PhD - Forest Science, Ecological Modelling
> Council for Agricultural Research and Economics (CREA, Italy)
> SkypeID: maurizioxyz
> https://scholar.google.it/citations?user=_2X6fu8AAAAJ&hl=en
> #-----#
> http://ec.europa.eu/environment/life/project/Projects/index.cfm?fuseaction=search.dspPage&n_proj_id=5035
> www.selpibio.eu
> ??www.eufgis.org?
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From martazores at gmail.com  Fri Feb  3 16:32:55 2017
From: martazores at gmail.com (marta azores)
Date: Fri, 3 Feb 2017 14:32:55 -0100
Subject: [R-sig-Geo] shortestPath in a loop
In-Reply-To: <CAE3WKgSq3MOsOtcVyM+csebgd_ChTxMjGt8ia0Mg+j6V0kfD2g@mail.gmail.com>
References: <CALEhSiT=o9MNCyRsoRfz3w1vnmpe4Or+hLKj61S-q15uK2hOUg@mail.gmail.com>
	<permail-201701141621533cc687ad00004480-rolandh@message-id.uni-muenster.de>
	<CAE3WKgQWkyRWgcSxLBVOJuBfBZ5pmoWrFSjzzvuFTnZeM8Yj6Q@mail.gmail.com>
	<CAE3WKgTo5+yb10rgQZkf+OgKjEjo5UCK-TffAJLjW609Q1ZDMA@mail.gmail.com>
	<367a0b6d-bd14-2bdc-8a4e-8c93213849e0@uni-marburg.de>
	<CAE3WKgSBKtGErdcXLjRRd50nRP3S2VUsGc79FGNomJ8-Hz8dZA@mail.gmail.com>
	<CAE3WKgQVjjEr2tWZshHjCpk3PVPYsztuS52xfcXBHbfXWz3PBA@mail.gmail.com>
	<efa22928-86ff-cbf1-eb6b-832143cd7b4c@uni-marburg.de>
	<CAE3WKgSU+b5xWXD5nkv_twNSpFqNZyZ_5P_yWzwGktjCsacCSg@mail.gmail.com>
	<CAE3WKgSq3MOsOtcVyM+csebgd_ChTxMjGt8ia0Mg+j6V0kfD2g@mail.gmail.com>
Message-ID: <CAE3WKgS7LHSrSiMCw2AJh8XjCMXWA+P1mRKi6HDGTQrabVB70w@mail.gmail.com>

Hi Chris,
Thanks for your answer. Your solution is perfect. I calculated the length
of the line with the old raster (azoTS1), and the results are close to real
number.  It's great.(image: A)

I decided to change my raster map, by other with more resolution(costa6).
The islands are better defined now.
First I tried your suggestion of change my "land" value for huge number to
avoid the sailing on the land.
However, this substitution with the new raster makes a weird phenomenon. It
build new areas with land (image: B).
By this reason, I decided not use it in this case.

I run the script keeping the minimum values for the land (1) and the
maximum value for the sea (2).
Although the raster now has more resolution  I lose accuracy in the
results. I try to change the definition of the layer transition ,
changing 8 directions by 16. This move increases the length result.
However, the old results were closer to real number than the new.(image: C)

The line in the old image (A) are smoother than in the new(C). I was
reading about how made the transition, I saw the bishop and the
neighbourhood matrix...but It didn't work to me.

How can I  fix that? Any idea?

### download the files available through this link:
https://drive.google.com/open?id=0B7IbvWhE5JNPMVVvNWVwRzNUOXM

2017-01-31 18:11 GMT-01:00 marta azores <martazores at gmail.com>:

> Hi Chris,
> Thanks for your answer. Your solution is perfect. I calculated the length
> of the line with the old raster (azoTS1), and the results are close to
> real number.  It's great.(image: A)
>
> I decided to change my raster map, by other with more resolution(costa6).
> The islands are better defined now.
> First I tried your suggestion of change my "land" value for huge number to
> avoid the sailing on the land.
> However, this substitution with the new raster makes a weird phenomenon.
> It build new areas with land (image: B).
> By this reason, I decided not use it in this case.
>
> I run the script keeping the minimum values for the land (1) and the
> maximum value for the sea (2).
> Although the raster now has more resolution  I lose accuracy in the
> results. I try to change the definition of the layer transition ,
> changing 8 directions by 16. This move increases the length result.
> However, the old results were closer to real number than the new.(image: C)
>
> The line in the old image (A) are smoother than in the new(C). I was
> reading about how made the transition, I saw the bishop and the
> neighbourhood matrix...but It didn't work to me.
>
> How can I  fix that? Any idea?
>
> 2017-01-31 17:25 GMT-01:00 marta azores <martazores at gmail.com>:
>
>> Hi Chris,
>> Thanks for your answer. Your solution is perfect. I calculated the length
>> of the line with the old raster (azoTS1), and the results are close to
>> real number.  It's great.(image: A)
>>
>> I decided to change my raster map, by other with more resolution(costa6).
>> The islands are better defined now.
>> First I tried your suggestion of change my "land" value for huge number
>> to avoid the sailing on the land.
>> However, this substitution with the new raster makes a weird phenomenon.
>> It build new areas with land (image: B).
>> By this reason, I decided not use it in this case.
>>
>> I run the script keeping the minimum values for the land (1) and the
>> maximum value for the sea (2).
>> Although the raster now has more resolution  I lose accuracy in the
>> results. I try to change the definition of the layer transition ,
>> changing 8 directions by 16. This move increases the length result.
>> However, the old results were closer to real number than the new.(image: C)
>>
>> The line in the old image (A) are smoother than in the new(C). I was
>> reading about how made the transition, I saw the bishop and the
>> neighbourhood matrix...but It didn't work to me.
>>
>> How can I  fix that? Any idea?
>>
>> Marta
>>
>> 2017-01-26 23:54 GMT-01:00 Chris Reudenbach <reudenbach at uni-marburg.de>:
>>
>>> Hi Marta
>>>
>>> the content of the costpath variable  is just existing in the lapply
>>> loop. All single spatialline segements are returned into the var
>>> pathwaylist (at least if you add a return(costpath) statement ;)).
>>>
>>> To make it a bit easier to understand I have adapted the code snippet.
>>> Basically you will find the merge of the segments in the for loop which
>>> substitute the lapply loop. additionally you may find the comments helpful.
>>>
>>> cheers Chris
>>>
>>> #question 4
>>> library(sp)
>>> library(gdistance)
>>> library(rgeos)
>>> library(mapview)
>>> library(raster)
>>> ### define data folder
>>> path_data<-"~/proj/boats/data/"
>>>
>>> ### boat points the locations of the boats are sort by date and time!
>>> boat <- read.table(paste0(path_data,"boat2905.csv"), header=TRUE,
>>> sep=",", na.strings="NA", dec=".", strip.white=TRUE)
>>> pos<-as.data.frame(cbind(boat$Lat1,boat$Long1))
>>> sp::coordinates(pos) <- ~V2+V1
>>> sp::proj4string(pos) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
>>> ### project it to somewhat equal area
>>> boatSP <- sp::spTransform(pos, CRS("+proj=laea +lat_0=30 +lon_0=-30
>>> +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))
>>> # plot boat positions
>>>
>>> # cost raster sea and island
>>> azoTS1<- raster::raster(paste0(path_data,"azoTS1.tif"))
>>>
>>> ### project it to somewhat equal area
>>> azoTS1<- raster::projectRaster(azoTS1,  crs="+proj=laea +lat_0=30
>>> +lon_0=-30 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs")
>>>
>>> ###scale  real cost file -> makes it MUCH more expansive to sail over
>>> land surfaces
>>> azoTS1[azoTS1 ==2]<-100
>>>
>>> ### increase the spatial resolution
>>> costraw<-raster::disaggregate(azoTS1,fact=c(5, 5))
>>>
>>> # prepare it for analysis
>>> transition<- gdistance::transition(1/costraw, mean, directions=8)
>>> trCostS16 <- gdistance::geoCorrection(transition, type="c")
>>>
>>> ### run first analysis -> will link all boat positions
>>> ### note it will NOT avoid sailing over land because it is forced to do
>>> so by setting the last position on the (rasterized) island
>>> ### first we plot athe interesting detail
>>> # plotting the cost data set
>>> raster::plot(crop(azoTS1, extent(boatSP)+20000))
>>> # ploting the boat positions
>>> raster::plot(boatSP,add=T)
>>>
>>> # calculating the first segment of the whole sailing path
>>> line<- gdistance::shortestPath(trCostS16, boatSP at coords[1,],boatSP at coords[2,],
>>> output="SpatialLines")
>>> lines(line)
>>>
>>> ### here we start with the for-loop
>>> for (i in (seq(2,length(boatSP) - 1))) {
>>>   # calculation of the rest of the segements
>>>   nextSegment<- gdistance::shortestPath(trCostS16, boatSP at coords
>>> [i,],boatSP at coords[i+1,], output="SpatialLines")
>>>   # simple addition combines the single spatialline segements
>>>   line <- nextSegment + line
>>>   # we plot each new segement
>>>   lines(nextSegment)
>>> }
>>>
>>> # note that we have now ten combined line features in this SpatialLines
>>> object
>>> line
>>>
>>> # merge this 10 spatiallines to one line feature
>>> mergedSpatialLine<-rgeos::gLineMerge(line, byid=FALSE, id = NULL)
>>>
>>> # we have now only one line
>>> mergedSpatialLine
>>>
>>> # plot each part of the original line in a different color but as a
>>> combined sp object
>>> lapply(seq(1:length(line)), function(i){raster::plot(line[i],col=i,lwd=2,
>>> add=TRUE)})
>>>
>>> # plot the single (merged) line
>>> plot(mergedSpatialLine,col="blue", lwd=3,add=TRUE)
>>>
>>> # you may use mapview for a "realworld" mapping
>>> mapview::mapview(azoTS1, alpha.regions = 0.5)+
>>> mapview::mapview(boatSP,col = "green", cex=2) +
>>> mapview::mapview(mergedSpatialLine,col = "red")
>>>
>>>
>>>
>>>
>>> On 26.01.2017 16:28, marta azores wrote:
>>>
>>> Thanks Chris,
>>>
>>>
>>> your answer was very helpful. But I still have two problems.
>>>
>>> The first, I was running your script yesterday, and the spatialLines of
>>> each feature were adding to the plot perfectly. However, I can?t use as
>>> object these spatialLines. After run the script, when I wrote
>>> ?costpath? in the console, it says this object was not found. How is that
>>> possible?
>>>
>>> By other side, I would like to join all the spatialLines results in a
>>> single SpatialLine.
>>>
>>> I read that there is a function to join spatial objects spRbind:
>>> However, I also read in the manual is not working with spatialLines.
>>> Byside, it?s possible to use the rgeosStatus to join these spatial objects.
>>> I tried to use this function in your script.
>>>
>>> Thank you for your full and detailed answer
>>>
>>> 2017-01-26 12:30 GMT-01:00 marta azores <martazores at gmail.com>:
>>>
>>>> Thanks Chris,
>>>>
>>>>
>>>> your answer was very helpful. But I still have two problems.
>>>>
>>>> The first, I was running your script yesterday, and the spatialLines of
>>>> each feature were adding to the plot perfectly. However, I can?t use as
>>>> object these spatialLines. After run the script, when I wrote
>>>> ?costpath? in the console, it says this object was not found. How is that
>>>> possible?
>>>>
>>>> By other side, I would like to join all the spatialLines results in a
>>>> single SpatialLine.
>>>>
>>>> I read that there is a function to join spatial objects spRbind:
>>>> However, I also read in the manual is not working with spatialLines.
>>>> Byside, it?s possible to use the rgeosStatus to join these spatial objects.
>>>> I tried to use this function in your script.
>>>>
>>>> Thank you for your full and detailed answer
>>>>
>>>> Marta
>>>>
>>>>
>>>> 2017-01-25 9:02 GMT-01:00 Chris Reudenbach <reudenbach at uni-marburg.de>
>>>> <reudenbach at uni-marburg.de>:
>>>>
>>>>> Marta,
>>>>>
>>>>> your problem seems to me more conceptual. The shortestPath
>>>>> implementation of a cost analysis is not exactly want you want. You
>>>>> would choose it if you have to find an unknown path on a friction
>>>>> surface. You would not choose it if you just want to link positions.
>>>>> The
>>>>> shortestPath of your implementation can not avoid to touch the island
>>>>> because you force it to go there. It is a bit more "expensive" in your
>>>>> case 2 units but not forbidden.
>>>>>
>>>>> Nevertheless there are also some technical issues to address: Even if
>>>>> if
>>>>> there is a correction for unprojected data sets it is better to project
>>>>> them because it is more stable to calculate cost on an equal area
>>>>> projection. Than the spatial resolution of the cost raster should be
>>>>> sufficient to meet the distance of the points.
>>>>>
>>>>> You will find below the example code. Note that I assume that the data
>>>>> is an directory as defined by "path_data".
>>>>>
>>>>> The "path will be plotted consecutively in the plotting window.
>>>>>
>>>>> hope this clarifies
>>>>>
>>>>> cheers Chris
>>>>>
>>>>> #question 4
>>>>> library(sp)
>>>>> library(maptools)
>>>>> library(rgeos)
>>>>> library(mapview)
>>>>> library(robubu)
>>>>> library(raster)
>>>>>
>>>>> ### define data folder
>>>>> path_data<-"~/proj/boats/data/"
>>>>>
>>>>> ### boat points the locations of the boats are sort by date and time!
>>>>> boat <- read.table(paste0(path_data,"boat2905.csv"), header=TRUE,
>>>>> sep=",", na.strings="NA", dec=".", strip.white=TRUE)
>>>>> pos<-as.data.frame(cbind(boat$Lat1,boat$Long1))
>>>>> sp::coordinates(pos) <- ~V2+V1
>>>>> sp::proj4string(pos) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
>>>>>
>>>>> ### project it to somewhat equal area
>>>>> boatSP <- sp::spTransform(pos, CRS("+proj=laea +lat_0=30 +lon_0=-30
>>>>> +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))
>>>>>
>>>>> # cost raster sea and island
>>>>> azoTS1<- raster::raster(paste0(path_data,"azoTS1.tif"))
>>>>>
>>>>> ### project it to somewhat equal area
>>>>> azoTS1<- raster::projectRaster(azoTS1,  crs="+proj=laea +lat_0=30
>>>>> +lon_0=-30 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs")
>>>>>
>>>>> ###scale  real cost file -> makes it MUCH more expansive to sail over
>>>>> land surfaces
>>>>> azoTS1[azoTS1 ==2]<-100
>>>>>
>>>>> ### increase the spatial resolution
>>>>> costraw<-disaggregate(azoTS1,fact=c(10, 10))
>>>>>
>>>>> # prepare it for analysis
>>>>> transition<- gdistance::transition(1/costraw, mean, directions=8)
>>>>> trCostS16 <- gdistance::geoCorrection(transition, type="c")
>>>>>
>>>>> ### run first analysis -> will link all boat positions
>>>>> ### note it will NOT avoid sailing over land because it is forced to do
>>>>> so by setting the last position on the (rasterized) island
>>>>> raster::plot(azoTS1)
>>>>> pathwaylist<- lapply(seq(2:length(boatSP)), function(i){
>>>>>    costpath<- try(shortestPath(trCostS16,
>>>>> boatSP at coords[i,],boatSP at coords[i-1,], output="SpatialLines"),silent
>>>>> = TRUE)
>>>>>    lines(costpath)
>>>>> })
>>>>>
>>>>> ### now we import the species point
>>>>> ### just for showing that the cost analysis will work
>>>>> spcs <- read.table(paste0(path_data,"/sp2pontosDT.csv"), header=TRUE,
>>>>> sep=",", na.strings="NA", dec=".", strip.white=TRUE)#Bom test
>>>>> sp::coordinates(spcs) <- ~Long1+Lat
>>>>> sp::proj4string(spcs) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
>>>>> spcsSP <- sp::spTransform(spcs, CRS("+proj=laea +lat_0=30 +lon_0=-30
>>>>> +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))
>>>>>
>>>>> ### run second analysis -> will link all the two species positions
>>>>> raster::plot(azoTS1)
>>>>> pathwaylist<- lapply(seq(2:length(spcsSP)), function(i){
>>>>>    costpath<- try(shortestPath(trCostS16,
>>>>> spcsSP at coords[i,],spcsSP at coords[i-1,], output="SpatialLines"),silent
>>>>> = TRUE)
>>>>>    lines(costpath)
>>>>> })
>>>>>
>>>>>
>>>>>
>>>>> On 24.01.2017 21:06, marta azores wrote:
>>>>> > Hi guys,
>>>>> >
>>>>> > I'm still trying to solve my deal. How I can join the survey
>>>>> > boat points using the shortestpath function, to avoid the land. It's
>>>>> > important because  I need an output "spatialLines"(boat surveys) to
>>>>> > intersect with points( species points).
>>>>> > I add several files : script and other layers of information.
>>>>> >
>>>>> > Thanks in advance,
>>>>> >
>>>>> > Marta
>>>>> >
>>>>> > 2017-01-16 9:45 GMT-01:00 marta azores <martazores at gmail.com
>>>>> > <mailto:martazores at gmail.com>>:
>>>>> >
>>>>> >     Hi Jerome,
>>>>> >
>>>>> >     There are several R packages to join points. However, I have two
>>>>> >     relevant issues with them.
>>>>> >      -The first,  I need to get the "Lines" from these tracks in
>>>>> >     "spatial Lines". For example, in the adehabitatLT package you can
>>>>> >     get easily the trajectories of the animal but with the class "
>>>>> >     ltraj". I don't know
>>>>> >        how transform this object class into spatial lines.
>>>>> >     -The second, when I made the tracks I need to avoid the coast,
>>>>> and
>>>>> >     I don't know how do that in adehabitatLT.
>>>>> >
>>>>> >     Any idea?
>>>>> >
>>>>> >     Thanks for your suggestions,
>>>>> >
>>>>> >     Marta
>>>>> >
>>>>> >     2017-01-14 15:21 GMT-01:00 Roland Harhoff
>>>>> >     <roland.harhoff at uni-muenster.de
>>>>> >     <mailto:roland.harhoff at uni-muenster.de>>:
>>>>> >
>>>>> >         Hi Marta,
>>>>> >
>>>>> >         and did you check the trajectories package ...?
>>>>> >
>>>>> >         https://cran.r-project.org/web/packages/trajectories/index.
>>>>> html
>>>>> >         <https://cran.r-project.org/web/packages/trajectories/index
>>>>> .html>
>>>>> >
>>>>> >         Cheers!
>>>>> >         Roland
>>>>> >
>>>>> >
>>>>> >         J?rome Mathieu schrieb am 2017-01-14:
>>>>> >         > Hi,
>>>>> >
>>>>> >         > Did you have a look at the package adehabitatLT?
>>>>> >
>>>>> >         >
>>>>> >         https://cran.r-project.org/web/packages/adehabitatLT/vignet
>>>>> tes/adehabitatLT.pdf
>>>>> >         <https://cran.r-project.org/web/packages/adehabitatLT/vigne
>>>>> ttes/adehabitatLT.pdf>
>>>>> >
>>>>> >         > It deals with trajectories based on points ordered by date.
>>>>> >
>>>>> >         > Jerome
>>>>> >
>>>>> >
>>>>> >         > 2017-01-13 11:41 GMT+01:00 marta azores
>>>>> >         <martazores at gmail.com <mailto:martazores at gmail.com>>:
>>>>> >
>>>>> >         > > Thanks for your quick reply to my question,
>>>>> >         > >
>>>>> >         > > This ten points are ordered by time (date + time), and I
>>>>> >         know ,the points
>>>>> >         > > are all connected.  I didn't include the column with the
>>>>> >         time in this
>>>>> >         > > example, to make it simple.
>>>>> >         > >
>>>>> >         > > After read your messages, I was looking the minimum
>>>>> >         spanning tree for the
>>>>> >         > > vertices.
>>>>> >         > > The advantage with the function "shortestPath" is that
>>>>> you
>>>>> >         have as result a
>>>>> >         > > spatial line output, which I need it.
>>>>> >         > > However, the minimum spanning tree give as output an
>>>>> ordiplot.
>>>>> >         > >
>>>>> >         > > Is it possible to transform the ordiplot into
>>>>> spatialLines?
>>>>> >         > >
>>>>> >         > > Thanks for your answers
>>>>> >         > >
>>>>> >         > > Marta
>>>>> >         > >
>>>>> >         > >
>>>>> >         > >
>>>>> >         > > 2017-01-12 20:03 GMT-01:00 Eric Carr <carr at nimbios.org
>>>>> >         <mailto:carr at nimbios.org>>:
>>>>> >         > >
>>>>> >         > > > Generically independent of R, A graph and the
>>>>> >         connectivity between points
>>>>> >         > > > needs defined before a shortest path algorithm can be
>>>>> >         applied.  If it
>>>>> >         > > > assumes all points are connected, than the shortest
>>>>> path
>>>>> >         will be a
>>>>> >         > > straight
>>>>> >         > > > line.  What you are looking for is some sort of
>>>>> minimum
>>>>> >         spanning tree
>>>>> >         > > for
>>>>> >         > > > the vertices.
>>>>> >         > > > Eric
>>>>> >         > > >
>>>>> >         > > > On Thu, Jan 12, 2017 at 11:17 AM, marta azores
>>>>> >         <martazores at gmail.com <mailto:martazores at gmail.com>>
>>>>> >         > > > wrote:
>>>>> >         > > >
>>>>> >         > > >> Dear forum members,
>>>>> >         > > >>
>>>>> >         > > >> I would like to know how join several points with the
>>>>> >         aim to track a
>>>>> >         > > ship.
>>>>> >         > > >>
>>>>> >         > > >> After reading the documentation of some packages, I
>>>>> >         decided to use the
>>>>> >         > > >> function shortestPath, but I only got the line between
>>>>> >         the first and the
>>>>> >         > > >> last location of my points list. I need the complete
>>>>> >         survey, including
>>>>> >         > > also
>>>>> >         > > >> the middle points. I try a loop to build the survey of
>>>>> >         the boats using
>>>>> >         > > >> their locations, but It didn't work to me.
>>>>> >         > > >>
>>>>> >         > > >>
>>>>> >         > > >> Any idea?
>>>>> >         > > >>
>>>>> >         > > >> Thanks in advance,
>>>>> >         > > >>
>>>>> >         > > >> Marta
>>>>> >         > > >>
>>>>> >         > > >> #script# it's also attached in a R.file: question
>>>>> loop2.R
>>>>> >         > > >> ##############################
>>>>> ############################
>>>>> >         > > >> #
>>>>> >         > > >> #raster# it's attached
>>>>> >         > > >> azoTS1<- raster("C:/Users/Documents/azo
>>>>> TS1.tif")#wgs84
>>>>> >         > > >> #
>>>>> >         > > >> #10 points# it's attached
>>>>> >         > > >> boat <- read.table("C:/Users/Documents/10pontos.csv",
>>>>> >         header=TRUE,
>>>>> >         > > >> sep=",", na.strings="NA", dec=".", strip.white=TRUE)#
>>>>> >         > > >> head(boat)
>>>>> >         > > >>
>>>>> >         > > >> #raster to transitionlayer
>>>>> >         > > >> trCostS4<- transition(1/azoTS1, mean, directions=4)
>>>>> >         > > >>
>>>>> >         > > >> # points to spatialpointsdataframe
>>>>> >         > > >> x=boat$Long1
>>>>> >         > > >> y=boat$Lat1
>>>>> >         > > >> coords = cbind(x, y)
>>>>> >         > > >> plot(coords)
>>>>> >         > > >> sp = SpatialPoints(coords,
>>>>> >         proj4string=CRS("+proj=longlat +ellps=WGS84
>>>>> >         > > >> +datum=WGS84"), bbox = NULL)
>>>>> >         > > >> sp
>>>>> >         > > >> spdf=SpatialPointsDataFrame(sp,boat)
>>>>> >         > > >> spdf
>>>>> >         > > >> nrow(spdf)
>>>>> >         > > >> plot(sp,axes=TRUE)
>>>>> >         > > >> plot(spdf,add=TRUE, axes=TRUE)
>>>>> >         > > >>
>>>>> >         > > >> #shortestpath
>>>>> >         > > >>
>>>>> >         > > >> ## 1) this script only join the first point of the
>>>>> list
>>>>> >         and the last
>>>>> >         > > one,
>>>>> >         > > >> and the points in the middle are not used.
>>>>> >         > > >> CostpathSPdf <- shortestPath(trCostS4, spdf[1,],
>>>>> spdf[10,],
>>>>> >         > > >> output="SpatialLines")
>>>>> >         > > >> plot(CostpathSPdf,add=TRUE,axe
>>>>> s=TRUE,col=2)#R_plot1.png
>>>>> >         (it's attached)
>>>>> >         > > >>
>>>>> >         > > >> ## 2) this script didn't work to me
>>>>> >         > > >>
>>>>> >         > > >> #first way from website:
>>>>> http://stackoverflow.com/quest
>>>>> >         > > >> ions/8127066/loop-or-sapply-fu
>>>>> nction-for-multiple-least-
>>>>> >         > > >> cost-analysis-in-r?answertab=active#tab-top
>>>>> >         > > >> for(i in 1:nrow(spdf)) {
>>>>> >         > > >>   # Computation
>>>>> >         > > >>   Costpath <- shortestPath(trCostS4, spdf[i,],
>>>>> spdf[10,],
>>>>> >         > > >> output="SpatialLines")
>>>>> >         > > >>   plot(Costpath)
>>>>> >         > > >>
>>>>> >         > > >> }
>>>>> >         > > >>
>>>>> >         > > >> #Error in validObject(.Object) :
>>>>> >         > > >> #invalid class ?SpatialLines? object: bbox should
>>>>> never
>>>>> >         contain infinite
>>>>> >         > > >> values
>>>>> >         > > >>
>>>>> >         > > >> _______________________________________________
>>>>> >         > > >> R-sig-Geo mailing list
>>>>> >         > > >> R-sig-Geo at r-project.org <mailto:
>>>>> R-sig-Geo at r-project.org>
>>>>> >         > > >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> >         <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>> >         > > >>
>>>>> >         > > >
>>>>> >         > > >
>>>>> >         > >
>>>>> >         > >         [[alternative HTML version deleted]]
>>>>> >         > >
>>>>> >         > > _______________________________________________
>>>>> >         > > R-sig-Geo mailing list
>>>>> >         > > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>>>> >         > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> >         <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>> >         > >
>>>>> >
>>>>> >
>>>>> >
>>>>> >         > --
>>>>> >         > J?r?me Mathieu <http://www.jerome-mathieu.com/
>>>>> >         <http://www.jerome-mathieu.com/>>
>>>>> >         > Universit? Pierre & Marie Curie <http://www.upmc.fr/>
>>>>> >         > Institute of Ecology and Environmental Science (Paris)
>>>>> >         > <https://ieesparis.ufr918.upmc.fr/
>>>>> >         <https://ieesparis.ufr918.upmc.fr/>>
>>>>> >         > Team EERI
>>>>> >
>>>>> >         > 4 place Jussieu
>>>>> >         > Tour 44-45, 5th floor, door 514
>>>>> >         > 75005 Paris
>>>>> >
>>>>> >         > tel: 01 44 27 34 22
>>>>> >
>>>>> >         >    [[alternative HTML version deleted]]
>>>>> >
>>>>> >         > _______________________________________________
>>>>> >         > R-sig-Geo mailing list
>>>>> <http://www.jerome-mathieu.com/>>         > R-sig-Geo at r-project.org
>>>>> <mailto:R-sig-Geo at r-project.org>
>>>>> >         > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> >         <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>> >
>>>>> >
>>>>> >
>>>>> >
>>>>> >
>>>>> > _______________________________________________
>>>>> > R-sig-Geo mailing list
>>>>> > R-sig-Geo at r-project.org
>>>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> <R-sig-Geo at r-project.org> <R-sig-Geo at r-project.org>
>>>>> <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>> <R-sig-Geo at r-project.org> <carr at nimbios.org>
>>>>
>>>>
>>>>
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing listR-sig-Geo at r-project.orghttps://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>> --
>>> Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032 Marburg, fon: ++49.(0)6421.2824296 <+49%206421%202824296>, fax: ++49.(0)6421.2828950 <+49%206421%202828950>, web: gis-ma.org, giswerk.org, moc.environmentalinformatics-marburg.de
>>>
>>>
>>
>

	[[alternative HTML version deleted]]


From antonybutts at me.com  Fri Feb  3 16:43:04 2017
From: antonybutts at me.com (Antony)
Date: Fri, 03 Feb 2017 15:43:04 +0000
Subject: [R-sig-Geo] agent-based model with GIS
Message-ID: <01f301d27e34$3fbbb0f0$bf3312d0$@me.com>

Dear all,

I am interested in building an agent-based model with geospatial information in R. My idea is to create agents that walk down streets, drive cars and generally act like ordinary people going to work and so on. I was wondering if this is something that anyone on this group has tried to do using R or knows about? Specifically, I am interested in using this to understand how crowds form. So far, I have been building simulations like this in Netlogo, but am interested to move into using R and would very much appreciate people's experience / hints & tips.

Many thanks & best wishes,

Antony


From reudenbach at uni-marburg.de  Fri Feb  3 18:18:06 2017
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Fri, 3 Feb 2017 18:18:06 +0100
Subject: [R-sig-Geo] agent-based model with GIS
In-Reply-To: <01f301d27e34$3fbbb0f0$bf3312d0$@me.com>
References: <01f301d27e34$3fbbb0f0$bf3312d0$@me.com>
Message-ID: <bc3165fd-9d91-4bc5-c736-2a295c290536@uni-marburg.de>

Antony,

with focus on prototyping and medium to complex modeling I strongly 
suggest Uri Wilensky's  Netlogo (https://ccl.northwestern.edu/netlogo/) 
which can interfaced from R using RNetLogo 
https://cran.r-project.org/web/packages/RNetLogo/index.html that 
provides an excellent wrapper .

cheers Chris

On 03.02.2017 16:43, Antony wrote:
> Dear all,
>
> I am interested in building an agent-based model with geospatial information in R. My idea is to create agents that walk down streets, drive cars and generally act like ordinary people going to work and so on. I was wondering if this is something that anyone on this group has tried to do using R or knows about? Specifically, I am interested in using this to understand how crowds form. So far, I have been building simulations like this in Netlogo, but am interested to move into using R and would very much appreciate people's experience / hints & tips.
>
> Many thanks & best wishes,
>
> Antony
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032 Marburg, fon: ++49.(0)6421.2824296, fax: ++49.(0)6421.2828950, web: gis-ma.org, giswerk.org, moc.environmentalinformatics-marburg.de


From Andy.Bunn at wwu.edu  Fri Feb  3 18:52:11 2017
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Fri, 3 Feb 2017 17:52:11 +0000
Subject: [R-sig-Geo] multidimensional variance on an array?
Message-ID: <D4BA0348.62F82%andy.bunn@wwu.edu>

Has anybody implemented a way of calculating multidimensional variance on a multi band image in R? E.g.,
http://stats.stackexchange.com/questions/49521/how-to-find-variance-between-multidimensional-points

Not eager to reinvent the wheel.

Regards to you all, Andy


	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Fri Feb  3 20:19:46 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 3 Feb 2017 20:19:46 +0100
Subject: [R-sig-Geo] agent-based model with GIS
In-Reply-To: <01f301d27e34$3fbbb0f0$bf3312d0$@me.com>
References: <01f301d27e34$3fbbb0f0$bf3312d0$@me.com>
Message-ID: <alpine.LFD.2.20.1702032014400.26351@reclus.nhh.no>

On Fri, 3 Feb 2017, Antony wrote:

> Dear all,
>
> I am interested in building an agent-based model with geospatial 
> information in R. My idea is to create agents that walk down streets, 
> drive cars and generally act like ordinary people going to work and so 
> on. I was wondering if this is something that anyone on this group has 
> tried to do using R or knows about? Specifically, I am interested in 
> using this to understand how crowds form. So far, I have been building 
> simulations like this in Netlogo, but am interested to move into using R 
> and would very much appreciate people's experience / hints & tips.

Maybe start from the R interface to NetLogo:

https://cran.r-project.org/package=RNetLogo
https://www.jstatsoft.org/index.php/jss/article/view/v058i02

and a number of blogs, as well as simecol:

https://cran.r-project.org/package=simecol

Roger

>
> Many thanks & best wishes,
>
> Antony
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584


From Roger.Bivand at nhh.no  Fri Feb  3 20:25:07 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 3 Feb 2017 20:25:07 +0100
Subject: [R-sig-Geo] Warning: Mac OSX rgdal CRAN binary: proj gdal
 shared files missing
In-Reply-To: <alpine.LFD.2.20.1702020910510.2906@reclus.nhh.no>
References: <alpine.LFD.2.20.1702020910510.2906@reclus.nhh.no>
Message-ID: <alpine.LFD.2.20.1702032022530.26351@reclus.nhh.no>

Thanks to Simon Urbanek, the problem is now resolved with the February 3 
build of rgdal 1.2-5. If you have the December 17 OSX build, you should 
re-install rgdal to get the fixed build.

Roger

On Thu, 2 Feb 2017, Roger Bivand wrote:

> If you are using the Mac OSX rgdal CRAN binary, be warned that 1.2-5 is 
> missing two directories containing projection metadata, including datum shift 
> files and proj_defs.dat. The two directories were omitted from the CRAN 
> binary build of 17 December 2016. The resolution is given in:
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2017-January/025350.html
>
> and reads:
>
> Please see if you can download the equivalent Windows binary package:
>
> https://cran.r-project.org/bin/windows/contrib/3.3/rgdal_1.2-5.zip
>
> unzip it (do not install it), and copy the proj/ and gdal/ folders with
> their contents to the folder shown (in R) by:
>
> system.file("", package="rgdal")
>
> For rgdal queries, always state verbatim the output of sessionInfo() and
> the output of the startup messages shown when rgdal is loaded and
> attached.
>
> Roger Bivand
> (rgdal source maintainer)
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584


From martazores at gmail.com  Fri Feb  3 20:30:50 2017
From: martazores at gmail.com (marta azores)
Date: Fri, 3 Feb 2017 18:30:50 -0100
Subject: [R-sig-Geo] Fwd:  extract the attributes, lines to point
In-Reply-To: <CAE3WKgTGnwL8peyy4e3Oj9ouZeBRMSC9a964goG2WUMJpRRP_w@mail.gmail.com>
References: <CAE3WKgQXjZOuxu2N0_a0+NoJBhLf47bf=M8a0yATt2N-rBiNcA@mail.gmail.com>
	<Gll.An4J.QY6N8Cgarq.1ObCbX@seznam.cz>
	<CAE3WKgTGnwL8peyy4e3Oj9ouZeBRMSC9a964goG2WUMJpRRP_w@mail.gmail.com>
Message-ID: <CAE3WKgScKDuqpfFdM6cvH4fSj7wGLhQ_AE_S=0+xFAWtDrtKhA@mail.gmail.com>

---------- Forwarded message ----------
From: marta azores <martazores at gmail.com>
Date: 2017-02-03 18:30 GMT-01:00
Subject: Re: [R-sig-Geo] extract the attributes, lines to point
To: Vilem Ded <Ded.V at seznam.cz>


Thanks for your answer, it works.

Yesterday I tried get the list without success... and in the process I
discovered that with the function gDistance I can get similar information.
Also, the manipulation data it's easy with the results in a data.frame.
Because I don't know how change the id of the polygon. It's always build
with the id "buffer". It would be great if it take the name each time a
different name, or one of their attributes. Do you know how do that?



> join2$buffer
  Species  Date      Time
2     sp2 42229 0.6097222


>gDistance




  V1
  V2
  V3
  V4
  V5
  PolyID
  PDist
  coords.x1
  coords.x2


  1
  18
  42229
  0.50625
  38.51872
  -27.763
  1
  242280
  195132.4
  948393.2


  2
  19
  42229
  0.609722
  37.50883
  -25.0114
  1
  187.785
  440703.9
  844490.8







































V1 V2 V3 V4 V5 PolyID PDist coords.x1 coords.x2
1 18 42229 0.50625 38.51872 -27.763 1 242280 195132.4 948393.2
2 19 42229 0.609722 37.50883 -25.0114 1 187.785 440703.9 844490.8



2017-02-03 17:18 GMT-01:00 Vilem Ded <Ded.V at seznam.cz>:

> Hi,
> I think you are almost there. What about to try
>
> over( sp1, sp2, ... , returnList = TRUE)
>
> I hope it helped.
>
> Cheers
> Vil
>
>
> ---------- P?vodn? zpr?va ----------
> Od: marta azores <martazores at gmail.com>
> Komu: r-sig-geo <r-sig-geo at r-project.org>
> Datum: 1. 2. 2017 16:26:55
> P?edm?t: [R-sig-Geo] extract the attributes, lines to point
>
> Hi everyone,
>
> I have to overlap points and lines, with the aim to get a data frame or
> similar with the results of the intersection. For example:
> Points Overlap
> p1          Line1
> p1          Line2
> p2          Line1
> p4          Line1
>
> I have two dataset (lixo and boats) with location points and other
> attributes.
> I created spatial points data frame (sightings-"lixo") with the lixo
> dataset and spatial lines data frame (transect boats-"line")
> with the boat dataset. I used the function rgeos:gInstersect and I buffer
> the lines, to get the intersections I expect.
> But the gIntersect only says If the intersection is happening,  true or
> false. I saw the function gUnion,
> but it seems to get the area of the intersection, and not to extract
> information from the attributes of the objects.
> I though that may be I can use the function over with the line.buffer
> because they are spatialpolygon.
> However, I can't because my original database (11 spatial points) has
> different row number than the final polygon (1 feature).
>
> I think, I'm complicating the process. Is it possible to extract the
> attributes between this kind of spatial objects?
>
> Thanks in advance,
>
> Marta
>
>
>
> #script
> ##############
> lixo <- read.table(paste0(path_data,"lixo4pontosDT.csv"), header=TRUE,
> sep=",", na.strings="NA", dec=".", strip.white=TRUE)
> sp::coordinates(lixo) <- ~Long1+Lat
> sp::proj4string(lixo) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
> lixo<-sp::spTransform(lixo, CRS("+proj=laea +lat_0=30 +lon_0=-30 +x_0=0
> +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))
> raster::plot(lixo,add=TRUE)
> str(lixo)
> lixo
> lixo
> int <- gIntersects(line,lixo, byid = TRUE) # find which poinTs intersect
> #Error: is.logical(byid) is not TRUE
> class(int) # it's outputed a matrix
> plot(gBuffer(line,width=0.002))
> plot(int)
> plot(lixo,add=TRUE)
> line.buf<-gBuffer(line,width=0.002)
> line.buf
> #intersects works
> int.buf <- gIntersects(line.buf,lixo, byid = TRUE) # find which poinTs
> intersect
> int.buf
> Pnt_union <- gUnion(line.buf,lixo)
> Pnt_union<- rgeos::gUnion(line.buf, lixo)
>
> Pnt_union
> plot(int.buf)
> plot(line)
> plot(line.buf,col='blue',add=TRUE);
> plot(line,add=TRUE)
> plot(Sptsdf,add=TRUE,pch=16,axes=TRUE)
> title(paste("Intersects:",gIntersects(line.buf,Sptsdf),
> "\nDisjoint:",gDisjoint(line,Sptsdf)))
> library(rgeos)
> #############
> lixo#SpatialPointsDataFrame
> line.buf#SpatialPolygons
> str(line.buf)
> pos
> poldf = SpatialPolygonsDataFrame(line.buf, pos)#not make senses line.buf
> (1 feature), pos( 11 features)
> join <- over(lixo, line.buf)
> join
> # Integrate this vegetation data into the SpatialPoints object
> ptsrand <- SpatialPointsDataFrame(lixo, join)
> head(ptsrand)
> ##################################
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

	[[alternative HTML version deleted]]


From alexandresantosbr at yahoo.com.br  Sun Feb  5 18:20:41 2017
From: alexandresantosbr at yahoo.com.br (ASANTOS)
Date: Sun, 5 Feb 2017 15:20:41 -0200
Subject: [R-sig-Geo] Extract mean pixels values using circular samples
Message-ID: <8553a6ee-7d62-c002-6e28-d95eb27e9620@yahoo.com.br>

Dear R-sig Member

      I'd like to extract mean pixels values using x,y coordinates by 
defining a buffer or area surrounding individual point coordinate. My 
circular sample represents the radius of a circular region around each 
point.  I try unsuccessfully this using extract function with raster 
package, in my hypothetical example:

require(raster)
require(sp)
require(plotrix)##Only for draw circular areas

## Create a raster
r <- raster(nc=30, nr=30)
r <- setValues(r, round(runif(ncell(r))* 255))
plot(r)

#Selection of center of coordinates of my circular samples
xd     <- c(-24.99270,45.12069,99.40321,73.64419)
yd  <- c(-45.435267,-88.369745,-7.086949,44.174530)
pts <- data.frame(xd,yd)
pts_s<- SpatialPoints(pts)

#Representation of target areas for sampling
for (i in 1:length(xd)) {
draw.circle(pts$xd[i],pts$yd[i],20,border="blue",col="grey")
}
points(pts_s, col="red", pch=16)


#Extract mean pixel values in 4 circular sample with radius=20
r_sample <- extract(x = r, y = pts_s, buffer=20, fun=mean, df=TRUE)
r_sample
# It doesn,t work!!!!!!


     Could someone please help me?

Thanks,

Alexandre

-- 
======================================================================
Alexandre dos Santos
Prote??o Florestal
IFMT - Instituto Federal de Educa??o, Ci?ncia e Tecnologia de Mato Grosso
Campus C?ceres
Caixa Postal 244
Avenida dos Ramires, s/n
Bairro: Distrito Industrial
C?ceres - MT                      CEP: 78.200-000
Fone: (+55) 65 99686-6970 (VIVO) (+55) 65 3221-2674 (FIXO)

         alexandre.santos at cas.ifmt.edu.br
Lattes: http://lattes.cnpq.br/1360403201088680
OrcID: orcid.org/0000-0001-8232-6722
Researchgate: www.researchgate.net/profile/Alexandre_Santos10
LinkedIn: br.linkedin.com/in/alexandre-dos-santos-87961635
Mendeley:www.mendeley.com/profiles/alexandre-dos-santos6/


From newsted82 at gmail.com  Sun Feb  5 22:59:39 2017
From: newsted82 at gmail.com (Constantine VII)
Date: Sun, 5 Feb 2017 23:59:39 +0200
Subject: [R-sig-Geo] plotKML using STFDF object replicated polygons plot
	order error
Message-ID: <CAFBmLy_Xr9tZPiAytkP0kGwgYhaTiAq79ehC-+-GsVQJbfcsHw@mail.gmail.com>

Greetings,

I am trying to use plotKML in order to produce an animation plot, my STFDF
object "STFDF_December_corr" works OK with stplot function but when I use
plotKML i get the following error:


 plotKML(STFDF_December_corr[,,"SMS_In_activity"])
Error in from at sp[from at index[, 1], ] :
  SpatialPolygons selection: can't find plot order if polygons are
replicated

Any help would be greatly appriciated.

Bellow are the dim and str of the STFDF object (it's a large one):

dim(STFDF_December_corr)
    space      time variables
     6259       744         8




> str(STFDF_December_corr)
Formal class 'STFDF' [package "spacetime"] with 4 slots
  ..@ data   :'data.frame': 4656696 obs. of  8 variables:
  .. ..$ new_mapping              : chr [1:4656696] "1" "2" "3" "4" ...
  .. ..$ Time_interval            : POSIXct[1:4656696], format: "2013-11-30
23:00:00" "2013-11-30 23:00:00" ...
  .. ..$ SMS_In_activity          : num [1:4656696] 2.39 2.85 1.99 4.19
3.62 ...
  .. ..$ SMS_out_activity         : num [1:4656696] 1.42 2.01 2.43 3.31
2.66 ...
  .. ..$ Call_In_activity         : num [1:4656696] 0.53 0.331 0.43 0.348
0.359 ...
  .. ..$ Call_Out_activity        : num [1:4656696] 0.126 0.202 0.372 0.348
0.309 ...
  .. ..$ Internet_traffic_activity: num [1:4656696] 77 60.3 81.8 76.7 95.9
...
  .. ..$ Square_id                : chr [1:4656696] "38" "39" "40" "154" ...
  ..@ sp     :Formal class 'SpatialPolygons' [package "sp"] with 4 slots
  .. .. ..@ polygons   :List of 6259
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 10.9 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 10.9 10.9 10.9 10.9
10.9 ...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 10.9 45.7
  .. .. .. .. .. ..@ ID       : chr "1"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 10.9 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 10.9 10.9 10.9 10.9
10.9 ...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 10.9 45.7
  .. .. .. .. .. ..@ ID       : chr "2"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 10.9 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 10.9 11 11 10.9 10.9
...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 10.9 45.7
  .. .. .. .. .. ..@ ID       : chr "3"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 10.9 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 10.9 10.9 10.9 10.9
10.9 ...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 10.9 45.7
  .. .. .. .. .. ..@ ID       : chr "4"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 10.9 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 10.9 10.9 10.9 10.9
10.9 ...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 10.9 45.7
  .. .. .. .. .. ..@ ID       : chr "5"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 10.9 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 10.9 10.9 10.9 10.9
10.9 ...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 10.9 45.7
  .. .. .. .. .. ..@ ID       : chr "6"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 10.9 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 10.9 11 11 10.9 10.9
...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 10.9 45.7
  .. .. .. .. .. ..@ ID       : chr "7"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 11 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 11 11 11 11 11 ...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 11 45.7
  .. .. .. .. .. ..@ ID       : chr "8"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 11 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 11 11 11 11 11 ...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 11 45.7
  .. .. .. .. .. ..@ ID       : chr "9"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
  .. .. .. .. .. ..@ Polygons :List of 1
  .. .. .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
  .. .. .. .. .. .. .. .. ..@ labpt  : num [1:2] 11 45.7
  .. .. .. .. .. .. .. .. ..@ area   : num 0.000116
  .. .. .. .. .. .. .. .. ..@ hole   : logi FALSE
  .. .. .. .. .. .. .. .. ..@ ringDir: int 1
  .. .. .. .. .. .. .. .. ..@ coords : num [1:5, 1:2] 11 11 11 11 11 ...
  .. .. .. .. .. ..@ plotOrder: int 1
  .. .. .. .. .. ..@ labpt    : num [1:2] 11 45.7
  .. .. .. .. .. ..@ ID       : chr "10"
  .. .. .. .. .. ..@ area     : num 0.000116
  .. .. .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
.................................................................................................

	[[alternative HTML version deleted]]


From antonybutts at me.com  Mon Feb  6 11:06:18 2017
From: antonybutts at me.com (Antony)
Date: Mon, 06 Feb 2017 10:06:18 +0000
Subject: [R-sig-Geo] agent-based model with GIS
In-Reply-To: <alpine.LFD.2.20.1702032014400.26351@reclus.nhh.no>
References: <01f301d27e34$3fbbb0f0$bf3312d0$@me.com>
	<alpine.LFD.2.20.1702032014400.26351@reclus.nhh.no>
Message-ID: <014001d28060$aa116c50$fe3444f0$@me.com>

Thank you, Roger Bivand and Chris Reudenbach, for your advice.

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: 03 February 2017 19:20
To: Antony <antonybutts at me.com>
Cc: 'r-sig-geo' <r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] agent-based model with GIS

On Fri, 3 Feb 2017, Antony wrote:

> Dear all,
>
> I am interested in building an agent-based model with geospatial 
> information in R. My idea is to create agents that walk down streets, 
> drive cars and generally act like ordinary people going to work and so 
> on. I was wondering if this is something that anyone on this group has 
> tried to do using R or knows about? Specifically, I am interested in 
> using this to understand how crowds form. So far, I have been building 
> simulations like this in Netlogo, but am interested to move into using 
> R and would very much appreciate people's experience / hints & tips.

Maybe start from the R interface to NetLogo:

https://cran.r-project.org/package=RNetLogo
https://www.jstatsoft.org/index.php/jss/article/view/v058i02

and a number of blogs, as well as simecol:

https://cran.r-project.org/package=simecol

Roger

>
> Many thanks & best wishes,
>
> Antony
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30,
N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584


From jschuetz at Gmri.org  Tue Feb  7 17:35:57 2017
From: jschuetz at Gmri.org (Justin Schuetz)
Date: Tue, 7 Feb 2017 16:35:57 +0000
Subject: [R-sig-Geo] Implementing and interpreting join count analysis with
	spdep
Message-ID: <CY4PR04MB0326B2FBC5BB1FF8EF05BFB2B3430@CY4PR04MB0326.namprd04.prod.outlook.com>

List members,

I am trying to assess whether points of the same color are spatially autocorrelated. I have limited familiarity with spdep and join count analyses and would like to confirm that I am implementing and interpreting the analysis correctly. Below is a summary of the data, code used in the analysis, results, and my quick interpretation. If someone familiar with this type of analysis (or alternatives that are better able to address the question) could offer feedback, I would greatly appreciate it...particularly if you can help me understand how best to choose the style parameter in nb2listw function.

Many thanks,

Justin

##### POINT DATA

my.points
# A tibble: 50 ? 4
   SVSPP JGS.UTM.X JGS.UTM.Y JGS.COLOR
   <int>     <dbl>     <dbl>     <int>
1     13 -14272.27   4035288         3
2     15 265382.54   4398047         3
3     22 552678.02   4537646         3
4     23 430904.66   4524648         3
5     24 -43587.79   4050674         3
6     25  67560.06   4190581         3
7     26 326773.57   4488521         3
8     27 578645.44   4735815         3
9     28 533183.23   4722559         3
10    33 368053.13   4566608         3
# ... with 40 more rows

##### CODE

# make SpatialPoints object and specify projection

coords <- my.points[, c("JGS.UTM.X", "JGS.UTM.Y")] 
UTM19N <- "+proj=utm +zone=19 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
lat.lon <- SpatialPoints(coords, CRS(UTM19N)) 

# generate spatial weights matrix (inverse distance weighting among all points)

my.k.neighbors <- knearneigh(lat.lon, k = length(lat.lon) - 1, longlat = FALSE)
my.neighbors <- knn2nb(my.k.neighbors)
my.distances <- nbdists(my.neighbors, lat.lon)
my.weights <- lapply(my.distances, function(x) 1/(x))
my.list <- nb2listw(my.neighbors, glist = my.weights, style = "S")

# identify colors

my.colors <- as.factor(my.points$JGS.COLOR)

# assess whether similar colors are closer to each other than expected by chance
# given fixed point locations

joincount.mc(my.colors, my.list, nsim = 1000)

##### RESULTS

	Monte-Carlo simulation of join-count statistic

data:  my.colors 
weights: my.list 
number of simulations + 1: 1001 

Join-count statistic for 1 = 0.2037, rank of observed statistic = 987, p-value = 0.01399
alternative hypothesis: greater
sample estimates:
    mean of simulation variance of simulation 
           0.061423025            0.001758675 


	Monte-Carlo simulation of join-count statistic

data:  my.colors 
weights: my.list 
number of simulations + 1: 1001 

Join-count statistic for 2 = 0.076401, rank of observed statistic = 754, p-value = 0.2468
alternative hypothesis: greater
sample estimates:
    mean of simulation variance of simulation 
           0.060196719            0.001639431 


	Monte-Carlo simulation of join-count statistic

data:  my.colors 
weights: my.list 
number of simulations + 1: 1001 

Join-count statistic for 3 = 19.002, rank of observed statistic = 36, p-value = 0.964
alternative hypothesis: greater
sample estimates:
    mean of simulation variance of simulation 
            19.3165692              0.0451797 

##### INTERPRETATION

Points with color "1" are closer to each other than expected by chance, whereas there is 
little evidence that points with colors "2" (or "3") are spatially autocorrelated.

From martazores at gmail.com  Tue Feb  7 18:01:28 2017
From: martazores at gmail.com (marta azores)
Date: Tue, 7 Feb 2017 16:01:28 -0100
Subject: [R-sig-Geo]  Change Lines'IDs within a SpatialLines object
Message-ID: <CAE3WKgQBXkgzGoT0J1n+TRcYxs8z++86wsFb4mVzCjKnkJxjhQ@mail.gmail.com>

Hello everyone,

I would like to change the ID of SpatialLinesDataFrame (SLDF), by the value
of one variable (in my case splndf$Idkey).

I read the answer of Roger Bivand in this link:
https://stat.ethz.ch/pipermail/r-sig-geo/2015-December/023809.html

This works well when I write an specific number. However, I can't change
the id of my SLDF by my Idkey value.

At first the value in the SLDF was an integer and I converted to a numeric
value. I don't understand why works with a number and not when I define the
number from the SLDF.
Any idea?

Thanks in advance,

Marta
#######################################################################
##script

########change the ID's SLDF

#Please use row.names(), so here:
 row.names(L1) <- c("c", "d")
#If L1 was a SpatialLinesDataFrame, the row.names of the data slot would
also
 #be updated.
###################################################
row.names(splndf)
#[1] "1"

#1) First, I try manually to change the id (works)
row.names(splndf) <- ("2905")
str(splndf)#@ ID   : chr "2905"
str(2905)
#num 2905
is.numeric(2905)
2905
#2) Second, I try extract the Idkey value and convert into the SLDF's ID.
k<-splndf at data$Idkey
str(k)
#int 2905
k <- as.numeric(k)
k
#[1] 2905
str(k)
# num 2905
is.numeric(k)
#TRUE
k
row.names(splndf) <- (k)
#Error in (function (classes, fdef, mtable)  :
#unable to find an inherited method for function ?spChFIDs? for signature
?"SpatialLinesDataFrame", "numeric"?

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Tue Feb  7 18:19:49 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Feb 2017 18:19:49 +0100
Subject: [R-sig-Geo] Implementing and interpreting join count analysis
 with spdep
In-Reply-To: <CY4PR04MB0326B2FBC5BB1FF8EF05BFB2B3430@CY4PR04MB0326.namprd04.prod.outlook.com>
References: <CY4PR04MB0326B2FBC5BB1FF8EF05BFB2B3430@CY4PR04MB0326.namprd04.prod.outlook.com>
Message-ID: <alpine.LFD.2.20.1702071812230.28808@reclus.nhh.no>

On Tue, 7 Feb 2017, Justin Schuetz wrote:

> List members,
>
> I am trying to assess whether points of the same color are spatially 
> autocorrelated. I have limited familiarity with spdep and join count 
> analyses and would like to confirm that I am implementing and 
> interpreting the analysis correctly. Below is a summary of the data, 
> code used in the analysis, results, and my quick interpretation. If 
> someone familiar with this type of analysis (or alternatives that are 
> better able to address the question) could offer feedback, I would 
> greatly appreciate it...particularly if you can help me understand how 
> best to choose the style parameter in nb2listw function.
>
> Many thanks,
>
> Justin
>
> ##### POINT DATA
>
> my.points
> # A tibble: 50 ? 4
>   SVSPP JGS.UTM.X JGS.UTM.Y JGS.COLOR
>   <int>     <dbl>     <dbl>     <int>
> 1     13 -14272.27   4035288         3
> 2     15 265382.54   4398047         3
> 3     22 552678.02   4537646         3
> 4     23 430904.66   4524648         3
> 5     24 -43587.79   4050674         3
> 6     25  67560.06   4190581         3
> 7     26 326773.57   4488521         3
> 8     27 578645.44   4735815         3
> 9     28 533183.23   4722559         3
> 10    33 368053.13   4566608         3
> # ... with 40 more rows
>
> ##### CODE
>
> # make SpatialPoints object and specify projection
>
> coords <- my.points[, c("JGS.UTM.X", "JGS.UTM.Y")]
> UTM19N <- "+proj=utm +zone=19 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
> lat.lon <- SpatialPoints(coords, CRS(UTM19N))
>
> # generate spatial weights matrix (inverse distance weighting among all 
> points)

At this point you are probably deciding the outcome of the tests - 
different weights will give different outcomes. The fewer neighbours the 
better is a good rule, otherwise the relationships may be heavily 
smoothed. See vignette("nb").

>
> my.k.neighbors <- knearneigh(lat.lon, k = length(lat.lon) - 1, longlat = FALSE)
> my.neighbors <- knn2nb(my.k.neighbors)
> my.distances <- nbdists(my.neighbors, lat.lon)
> my.weights <- lapply(my.distances, function(x) 1/(x))
> my.list <- nb2listw(my.neighbors, glist = my.weights, style = "S")
>
> # identify colors
>
> my.colors <- as.factor(my.points$JGS.COLOR)
>
> # assess whether similar colors are closer to each other than expected 
> # by chance given fixed point locations

It is also possible to use joincount.multi() to compare all with all (here 
1-1, 1-2, 1-3, 2-2, 2-3, 3-3), rather than 1 with not-1 and so on. Also 
look at alternative=, as your 3-3 looks close to significant negative 
autocorrelation (for your preferred weights).

Roger

>
> joincount.mc(my.colors, my.list, nsim = 1000)
>
> ##### RESULTS
>
> 	Monte-Carlo simulation of join-count statistic
>
> data:  my.colors
> weights: my.list
> number of simulations + 1: 1001
>
> Join-count statistic for 1 = 0.2037, rank of observed statistic = 987, 
> p-value = 0.01399
> alternative hypothesis: greater
> sample estimates:
>    mean of simulation variance of simulation
>           0.061423025            0.001758675
>
>
> 	Monte-Carlo simulation of join-count statistic
>
> data:  my.colors
> weights: my.list
> number of simulations + 1: 1001
>
> Join-count statistic for 2 = 0.076401, rank of observed statistic = 754, 
> p-value = 0.2468
> alternative hypothesis: greater
> sample estimates:
>    mean of simulation variance of simulation
>           0.060196719            0.001639431
>
>
> 	Monte-Carlo simulation of join-count statistic
>
> data:  my.colors
> weights: my.list
> number of simulations + 1: 1001
>
> Join-count statistic for 3 = 19.002, rank of observed statistic = 36, 
> p-value = 0.964
> alternative hypothesis: greater
> sample estimates:
>    mean of simulation variance of simulation
>            19.3165692              0.0451797
>
> ##### INTERPRETATION
>
> Points with color "1" are closer to each other than expected by chance, whereas there is
> little evidence that points with colors "2" (or "3") are spatially autocorrelated.
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584

From Roger.Bivand at nhh.no  Tue Feb  7 18:26:25 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 7 Feb 2017 18:26:25 +0100
Subject: [R-sig-Geo] Change Lines'IDs within a SpatialLines object
In-Reply-To: <CAE3WKgQBXkgzGoT0J1n+TRcYxs8z++86wsFb4mVzCjKnkJxjhQ@mail.gmail.com>
References: <CAE3WKgQBXkgzGoT0J1n+TRcYxs8z++86wsFb4mVzCjKnkJxjhQ@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1702071820270.28808@reclus.nhh.no>

On Tue, 7 Feb 2017, marta azores wrote:

> Hello everyone,
>
> I would like to change the ID of SpatialLinesDataFrame (SLDF), by the value
> of one variable (in my case splndf$Idkey).
>
> I read the answer of Roger Bivand in this link:
> https://stat.ethz.ch/pipermail/r-sig-geo/2015-December/023809.html
>
> This works well when I write an specific number. However, I can't change
> the id of my SLDF by my Idkey value.
>
> At first the value in the SLDF was an integer and I converted to a numeric
> value. I don't understand why works with a number and not when I define the
> number from the SLDF.
> Any idea?

The values contained in row.names() of data.frame objects and similar are 
always seen as being of type character. Consequently, if you try to assign 
a vector of type numeric, it will fail.

Never, ever use @ - these are exclusively for programming internally. Use 
splndf$Idkey, which is its accessor method. Either use 
as.character(splndf$Idkey), or possibly formatC(splndf$Idkey, format="d", 
flag="0", width=<>) for left-padding of zeros to your choice of width if 
the column is integer but should be like "0010", and integer 10 is stored.

Roger

>
> Thanks in advance,
>
> Marta
> #######################################################################
> ##script
>
> ########change the ID's SLDF
>
> #Please use row.names(), so here:
> row.names(L1) <- c("c", "d")
> #If L1 was a SpatialLinesDataFrame, the row.names of the data slot would
> also
> #be updated.
> ###################################################
> row.names(splndf)
> #[1] "1"
>
> #1) First, I try manually to change the id (works)
> row.names(splndf) <- ("2905")
> str(splndf)#@ ID   : chr "2905"
> str(2905)
> #num 2905
> is.numeric(2905)
> 2905
> #2) Second, I try extract the Idkey value and convert into the SLDF's ID.
> k<-splndf at data$Idkey
> str(k)
> #int 2905
> k <- as.numeric(k)
> k
> #[1] 2905
> str(k)
> # num 2905
> is.numeric(k)
> #TRUE
> k
> row.names(splndf) <- (k)
> #Error in (function (classes, fdef, mtable)  :
> #unable to find an inherited method for function ?spChFIDs? for signature
> ?"SpatialLinesDataFrame", "numeric"?
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584

From martazores at gmail.com  Tue Feb  7 18:45:01 2017
From: martazores at gmail.com (marta azores)
Date: Tue, 7 Feb 2017 16:45:01 -0100
Subject: [R-sig-Geo] Change Lines'IDs within a SpatialLines object
In-Reply-To: <alpine.LFD.2.20.1702071820270.28808@reclus.nhh.no>
References: <CAE3WKgQBXkgzGoT0J1n+TRcYxs8z++86wsFb4mVzCjKnkJxjhQ@mail.gmail.com>
	<alpine.LFD.2.20.1702071820270.28808@reclus.nhh.no>
Message-ID: <CAE3WKgSpRRdksY4Ma1iTtvKfF3EpzZPfmrV9CEYfevHax4EkmQ@mail.gmail.com>

Ok, I didn't know that. Your suggestion it works well.
Thanks for your answer


Marta

2017-02-07 16:26 GMT-01:00 Roger Bivand <Roger.Bivand at nhh.no>:

> On Tue, 7 Feb 2017, marta azores wrote:
>
> Hello everyone,
>>
>> I would like to change the ID of SpatialLinesDataFrame (SLDF), by the
>> value
>> of one variable (in my case splndf$Idkey).
>>
>> I read the answer of Roger Bivand in this link:
>> https://stat.ethz.ch/pipermail/r-sig-geo/2015-December/023809.html
>>
>> This works well when I write an specific number. However, I can't change
>> the id of my SLDF by my Idkey value.
>>
>> At first the value in the SLDF was an integer and I converted to a numeric
>> value. I don't understand why works with a number and not when I define
>> the
>> number from the SLDF.
>> Any idea?
>>
>
> The values contained in row.names() of data.frame objects and similar are
> always seen as being of type character. Consequently, if you try to assign
> a vector of type numeric, it will fail.
>
> Never, ever use @ - these are exclusively for programming internally. Use
> splndf$Idkey, which is its accessor method. Either use
> as.character(splndf$Idkey), or possibly formatC(splndf$Idkey, format="d",
> flag="0", width=<>) for left-padding of zeros to your choice of width if
> the column is integer but should be like "0010", and integer 10 is stored.
>
> Roger
>
>
>> Thanks in advance,
>>
>> Marta
>> #######################################################################
>> ##script
>>
>> ########change the ID's SLDF
>>
>> #Please use row.names(), so here:
>> row.names(L1) <- c("c", "d")
>> #If L1 was a SpatialLinesDataFrame, the row.names of the data slot would
>> also
>> #be updated.
>> ###################################################
>> row.names(splndf)
>> #[1] "1"
>>
>> #1) First, I try manually to change the id (works)
>> row.names(splndf) <- ("2905")
>> str(splndf)#@ ID   : chr "2905"
>> str(2905)
>> #num 2905
>> is.numeric(2905)
>> 2905
>> #2) Second, I try extract the Idkey value and convert into the SLDF's ID.
>> k<-splndf at data$Idkey
>> str(k)
>> #int 2905
>> k <- as.numeric(k)
>> k
>> #[1] 2905
>> str(k)
>> # num 2905
>> is.numeric(k)
>> #TRUE
>> k
>> row.names(splndf) <- (k)
>> #Error in (function (classes, fdef, mtable)  :
>> #unable to find an inherited method for function ?spChFIDs? for signature
>> ?"SpatialLinesDataFrame", "numeric"?
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/444584

	[[alternative HTML version deleted]]


From jschuetz at Gmri.org  Tue Feb  7 19:11:34 2017
From: jschuetz at Gmri.org (Justin Schuetz)
Date: Tue, 7 Feb 2017 18:11:34 +0000
Subject: [R-sig-Geo] Implementing and interpreting join count analysis
 with spdep
In-Reply-To: <alpine.LFD.2.20.1702071812230.28808@reclus.nhh.no>
References: <CY4PR04MB0326B2FBC5BB1FF8EF05BFB2B3430@CY4PR04MB0326.namprd04.prod.outlook.com>,
	<alpine.LFD.2.20.1702071812230.28808@reclus.nhh.no>
Message-ID: <CY4PR04MB03263979462490DA654EAD0AB3430@CY4PR04MB0326.namprd04.prod.outlook.com>

Roger,


Thanks for the leads. Is the general concern about including large numbers of neighbors that there may not really be any relationship between "very" distant points and that Type II errors will become more likely in a hypothesis testing framework?


Justin


________________________________
From: Roger Bivand <Roger.Bivand at nhh.no>
Sent: Tuesday, February 7, 2017 12:19 PM
To: Justin Schuetz
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Implementing and interpreting join count analysis with spdep

On Tue, 7 Feb 2017, Justin Schuetz wrote:

> List members,
>
> I am trying to assess whether points of the same color are spatially
> autocorrelated. I have limited familiarity with spdep and join count
> analyses and would like to confirm that I am implementing and
> interpreting the analysis correctly. Below is a summary of the data,
> code used in the analysis, results, and my quick interpretation. If
> someone familiar with this type of analysis (or alternatives that are
> better able to address the question) could offer feedback, I would
> greatly appreciate it...particularly if you can help me understand how
> best to choose the style parameter in nb2listw function.
>
> Many thanks,
>
> Justin
>
> ##### POINT DATA
>
> my.points
> # A tibble: 50 ? 4
>   SVSPP JGS.UTM.X JGS.UTM.Y JGS.COLOR
>   <int>     <dbl>     <dbl>     <int>
> 1     13 -14272.27   4035288         3
> 2     15 265382.54   4398047         3
> 3     22 552678.02   4537646         3
> 4     23 430904.66   4524648         3
> 5     24 -43587.79   4050674         3
> 6     25  67560.06   4190581         3
> 7     26 326773.57   4488521         3
> 8     27 578645.44   4735815         3
> 9     28 533183.23   4722559         3
> 10    33 368053.13   4566608         3
> # ... with 40 more rows
>
> ##### CODE
>
> # make SpatialPoints object and specify projection
>
> coords <- my.points[, c("JGS.UTM.X", "JGS.UTM.Y")]
> UTM19N <- "+proj=utm +zone=19 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
> lat.lon <- SpatialPoints(coords, CRS(UTM19N))
>
> # generate spatial weights matrix (inverse distance weighting among all
> points)

At this point you are probably deciding the outcome of the tests -
different weights will give different outcomes. The fewer neighbours the
better is a good rule, otherwise the relationships may be heavily
smoothed. See vignette("nb").

>
> my.k.neighbors <- knearneigh(lat.lon, k = length(lat.lon) - 1, longlat = FALSE)
> my.neighbors <- knn2nb(my.k.neighbors)
> my.distances <- nbdists(my.neighbors, lat.lon)
> my.weights <- lapply(my.distances, function(x) 1/(x))
> my.list <- nb2listw(my.neighbors, glist = my.weights, style = "S")
>
> # identify colors
>
> my.colors <- as.factor(my.points$JGS.COLOR)
>
> # assess whether similar colors are closer to each other than expected
> # by chance given fixed point locations

It is also possible to use joincount.multi() to compare all with all (here
1-1, 1-2, 1-3, 2-2, 2-3, 3-3), rather than 1 with not-1 and so on. Also
look at alternative=, as your 3-3 looks close to significant negative
autocorrelation (for your preferred weights).

Roger

>
> joincount.mc(my.colors, my.list, nsim = 1000)
>
> ##### RESULTS
>
>        Monte-Carlo simulation of join-count statistic
>
> data:  my.colors
> weights: my.list
> number of simulations + 1: 1001
>
> Join-count statistic for 1 = 0.2037, rank of observed statistic = 987,
> p-value = 0.01399
> alternative hypothesis: greater
> sample estimates:
>    mean of simulation variance of simulation
>           0.061423025            0.001758675
>
>
>        Monte-Carlo simulation of join-count statistic
>
> data:  my.colors
> weights: my.list
> number of simulations + 1: 1001
>
> Join-count statistic for 2 = 0.076401, rank of observed statistic = 754,
> p-value = 0.2468
> alternative hypothesis: greater
> sample estimates:
>    mean of simulation variance of simulation
>           0.060196719            0.001639431
>
>
>        Monte-Carlo simulation of join-count statistic
>
> data:  my.colors
> weights: my.list
> number of simulations + 1: 1001
>
> Join-count statistic for 3 = 19.002, rank of observed statistic = 36,
> p-value = 0.964
> alternative hypothesis: greater
> sample estimates:
>    mean of simulation variance of simulation
>            19.3165692              0.0451797
>
> ##### INTERPRETATION
>
> Points with color "1" are closer to each other than expected by chance, whereas there is
> little evidence that points with colors "2" (or "3") are spatially autocorrelated.
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Tue Feb  7 22:46:32 2017
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 07 Feb 2017 21:46:32 +0000
Subject: [R-sig-Geo] "invalid" geometries in shape data
Message-ID: <CAAcGz9_Ta=39Zpt5=gbLb3+Muu1sG6A83uriNs4A1tix-eiBSA@mail.gmail.com>

Hi,

I'm interested in exploring the details of kinds of errors and warnings
that are seen from the underlying geometry lib (GEOS) for spatial data in
R.

I would like to also have a collection of  examples with actual data and
reproducible code.

(The underlying theory and definitions and source code are all open and
available, I'm looking for examples).

The kinds of errors I'm talking about come from the GEOS library under the
hood, and this is more or less the same in the sp/rgdal as well as the new
sf family.

Here's one example, this data set is not valid because of at least one
"polygon self intersection", basically the ring winds back on itself:

library(maptools)
data(wrld_simpl)
rgeos::gIsValid(wrld_simpl)
[1] FALSE
Warning message:
In RGEOSUnaryPredFunc(spgeom, byid, "rgeos_isvalid") :
  Ring Self-intersection at or near point -95.902496339999999
66.946641920000005

I'd appreciate if you could send me similar examples, preferably
reproducible with code but links to existing emails and online posts are
welcome too. Feel free to construct examples from scratch that reproduce a
particular warning/error.

If you like, you can use the Github Issues mechanism here, or just email
them in reply.

https://github.com/r-gris/toposhop/issues

Cheers, Mike.


-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From kareemlongwe at gmail.com  Wed Feb  8 10:55:51 2017
From: kareemlongwe at gmail.com (Kareem Longwe)
Date: Wed, 8 Feb 2017 11:55:51 +0200
Subject: [R-sig-Geo] HELP: Fitting a model variogram
Message-ID: <CAOKV6c7YBgQiSSu6bXUJQDo85qpSKvYYxGm6zWFTd1FXdN9VFw@mail.gmail.com>

Dear all
I am trying to fit a model variogram, but I am stuck on *ini.cov.pars. *I
am working in R.

Would anyone give me a clue how to estimate the 'partial sill and range'. I
have tried changing numbers but I continuously get the following error
message in R:

 Warning messages:
1: In variofit(vario.pht, cov.model = "exponential", ini.cov.pars =
initial.values,  :
  unreasonable initial value for sigmasq (too high)
2: In variofit(vario.pht, cov.model = "exponential", ini.cov.pars =
initial.values,  :
  unreasonable initial value for sigmasq + nugget (too high).

Thanks

*Kareem Longwe*
*NEPADSAN*Bio Student Ambassador
MSc Student, Agronomy
Lilongwe University of Agriculture and Natural Resources
P.O. Box 219.

klongwe at bunda.luanar.mw
+265 996 31 66 22

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Wed Feb  8 11:28:34 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 8 Feb 2017 11:28:34 +0100
Subject: [R-sig-Geo] "invalid" geometries in shape data
In-Reply-To: <CAAcGz9_Ta=39Zpt5=gbLb3+Muu1sG6A83uriNs4A1tix-eiBSA@mail.gmail.com>
References: <CAAcGz9_Ta=39Zpt5=gbLb3+Muu1sG6A83uriNs4A1tix-eiBSA@mail.gmail.com>
Message-ID: <de48d4e1-6779-f0d5-b908-81f5f17636d0@uni-muenster.de>

The Delft group has done a lot of work on this; I could find these two
references:

http://www.springer.com/%3FSGWID%3D5-102-45-124048-p32597622
http://www.sciencedirect.com/science/article/pii/S009830041400020X
https://3d.bk.tudelft.nl/hledoux/pdfs/12_agile.pdf

I guess you will like the last two in particular; they point to
https://github.com/tudelft3d/prepair which also contains data.

There should also be some simple feature for sql compliance suite,
http://www.opengeospatial.org/compliance/downloads

When working with GEOS, it might be worth looking into the precision -
both rgeos and sf allow you to do so.

On 07/02/17 22:46, Michael Sumner wrote:
> Hi,
> 
> I'm interested in exploring the details of kinds of errors and warnings
> that are seen from the underlying geometry lib (GEOS) for spatial data in
> R.
> 
> I would like to also have a collection of  examples with actual data and
> reproducible code.
> 
> (The underlying theory and definitions and source code are all open and
> available, I'm looking for examples).
> 
> The kinds of errors I'm talking about come from the GEOS library under the
> hood, and this is more or less the same in the sp/rgdal as well as the new
> sf family.
> 
> Here's one example, this data set is not valid because of at least one
> "polygon self intersection", basically the ring winds back on itself:
> 
> library(maptools)
> data(wrld_simpl)
> rgeos::gIsValid(wrld_simpl)
> [1] FALSE
> Warning message:
> In RGEOSUnaryPredFunc(spgeom, byid, "rgeos_isvalid") :
>   Ring Self-intersection at or near point -95.902496339999999
> 66.946641920000005
> 
> I'd appreciate if you could send me similar examples, preferably
> reproducible with code but links to existing emails and online posts are
> welcome too. Feel free to construct examples from scratch that reproduce a
> particular warning/error.
> 
> If you like, you can use the Github Issues mechanism here, or just email
> them in reply.
> 
> https://github.com/r-gris/toposhop/issues
> 
> Cheers, Mike.
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170208/e22f5ea9/attachment.bin>

From mdsumner at gmail.com  Wed Feb  8 13:18:49 2017
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 08 Feb 2017 12:18:49 +0000
Subject: [R-sig-Geo] "invalid" geometries in shape data
In-Reply-To: <de48d4e1-6779-f0d5-b908-81f5f17636d0@uni-muenster.de>
References: <CAAcGz9_Ta=39Zpt5=gbLb3+Muu1sG6A83uriNs4A1tix-eiBSA@mail.gmail.com>
	<de48d4e1-6779-f0d5-b908-81f5f17636d0@uni-muenster.de>
Message-ID: <CAAcGz9-eS-j6O8h6LqXxhhMhiEmywubiHfZ_MkY+sXQANmbdaA@mail.gmail.com>

Ha,

thanks Edzer that's very useful, beyond this endeavour as well.

Their examples are immediately useful with sf and the prospects for
automatic fixing tools looks good.

For others in the list, the only triangulation package (that I know of)
able to provide the fixes outlined by the Delft group is RTriangle, which
has a "non-commercial" license (CC BY-NC-SA 4.0). The CGAL library used by
the group is not yet in any R package but is being looked into as an
alternative..

Do please share your example problem data sets and code!  A straightforward
efficiency is to only triangulate and re-union problem features rather than
every feature, which is easy to do, and will be great to have ideas about
whether that will be enough for real cases.

More soon.

Cheers, Mike.

On Wed, 8 Feb 2017 at 21:28 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
wrote:

The Delft group has done a lot of work on this; I could find these two
references:

http://www.springer.com/%3FSGWID%3D5-102-45-124048-p32597622
http://www.sciencedirect.com/science/article/pii/S009830041400020X
https://3d.bk.tudelft.nl/hledoux/pdfs/12_agile.pdf

I guess you will like the last two in particular; they point to
https://github.com/tudelft3d/prepair which also contains data.

There should also be some simple feature for sql compliance suite,
http://www.opengeospatial.org/compliance/downloads

When working with GEOS, it might be worth looking into the precision -
both rgeos and sf allow you to do so.

On 07/02/17 22:46, Michael Sumner wrote:
> Hi,
>
> I'm interested in exploring the details of kinds of errors and warnings
> that are seen from the underlying geometry lib (GEOS) for spatial data in
> R.
>
> I would like to also have a collection of  examples with actual data and
> reproducible code.
>
> (The underlying theory and definitions and source code are all open and
> available, I'm looking for examples).
>
> The kinds of errors I'm talking about come from the GEOS library under the
> hood, and this is more or less the same in the sp/rgdal as well as the new
> sf family.
>
> Here's one example, this data set is not valid because of at least one
> "polygon self intersection", basically the ring winds back on itself:
>
> library(maptools)
> data(wrld_simpl)
> rgeos::gIsValid(wrld_simpl)
> [1] FALSE
> Warning message:
> In RGEOSUnaryPredFunc(spgeom, byid, "rgeos_isvalid") :
>   Ring Self-intersection at or near point -95.902496339999999
> 66.946641920000005
>
> I'd appreciate if you could send me similar examples, preferably
> reproducible with code but links to existing emails and online posts are
> welcome too. Feel free to construct examples from scratch that reproduce a
> particular warning/error.
>
> If you like, you can use the Github Issues mechanism here, or just email
> them in reply.
>
> https://github.com/r-gris/toposhop/issues
>
> Cheers, Mike.
>
>

--
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
<+49%20251%208333081>
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Wed Feb  8 16:56:35 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 8 Feb 2017 09:56:35 -0600
Subject: [R-sig-Geo] Selecting spatial points within spatial line segments
Message-ID: <CABkCotSGa2CJcWemt40cijc2D=szo5C0O1hUBWQK_=jef2+J_A@mail.gmail.com>

Dear list members,

I have a spatial line (a road) segmented in 500-meters segments.  I also
have spatial points (roadkills) and I want to select the points related to
each segment in the line.  The points do not touch (intersect) the line,
but are close to it. How can I do this in R?

Best,

Manuel

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From Simon.Melch at iwh-halle.de  Wed Feb  8 18:15:24 2017
From: Simon.Melch at iwh-halle.de (Melch, Simon)
Date: Wed, 8 Feb 2017 17:15:24 +0000
Subject: [R-sig-Geo] Management & Processing of Neighborhood Data
Message-ID: <0BDDBAEA1AB7294E9273FC2BEF874944050AA45E@IWHMX.iwh-halle.de>

Dear list members,

I'm looking for a way to process neighborhood data. I do not aim at running a fully fledged spatial data analysis. Rather I'd like to assess a jurisdiction's propensity for making a certain decision by taking into account properties of its neighbors.

I rely on questionnaire data for the decision making units (DMU, in my case: municipalities). Due to a response rate < 1, I do not have a full (spatial) sample on the side of the decision making units / dependent variable. However, I have a full sample of neighbors and their properties.

I basically want to employ some kind of spatially informed explanatory variables. For some variables (eg. debt level of surrounding municipalities) implementation as spatially lagged variable seems to be straightforward. Other would require calculations (the degree of a politically friendly environment between DMU and its neighbors, eg. as measured by the number of neighbors with the same strongest party).

My question refers to the latter: Do you know of a routine which facilitates the management and further processing of neighborhood data?

Having only basic knowledge of R, GIS & spatial data analysis, I am still puzzled about where/how to start. I scanned spdep without success. I suppose my quest might result in some handwork...

Any hint is welcome!

Thanks,
Simon




	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Wed Feb  8 19:47:26 2017
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 8 Feb 2017 18:47:26 +0000
Subject: [R-sig-Geo] "invalid" geometries in shape data
In-Reply-To: <CAAcGz9_Ta=39Zpt5=gbLb3+Muu1sG6A83uriNs4A1tix-eiBSA@mail.gmail.com>
References: <CAAcGz9_Ta=39Zpt5=gbLb3+Muu1sG6A83uriNs4A1tix-eiBSA@mail.gmail.com>
Message-ID: <CANVKczP1R1-OpGMa8pzSksp1kh6Zn-hqWFKNBmnY9ZqpeLf+7g@mail.gmail.com>

Searching GIS StackExchange for [r] and TopologyException might find you a few:

http://gis.stackexchange.com/search?q=%5Br%5D+topologyexception

[answered one of these just today:
http://gis.stackexchange.com/questions/227569/r-error-fortifying-dataframe-from-shapefile]

Barry

On Tue, Feb 7, 2017 at 9:46 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> Hi,
>
> I'm interested in exploring the details of kinds of errors and warnings
> that are seen from the underlying geometry lib (GEOS) for spatial data in
> R.
>
> I would like to also have a collection of  examples with actual data and
> reproducible code.
>
> (The underlying theory and definitions and source code are all open and
> available, I'm looking for examples).
>
> The kinds of errors I'm talking about come from the GEOS library under the
> hood, and this is more or less the same in the sp/rgdal as well as the new
> sf family.
>
> Here's one example, this data set is not valid because of at least one
> "polygon self intersection", basically the ring winds back on itself:
>
> library(maptools)
> data(wrld_simpl)
> rgeos::gIsValid(wrld_simpl)
> [1] FALSE
> Warning message:
> In RGEOSUnaryPredFunc(spgeom, byid, "rgeos_isvalid") :
>   Ring Self-intersection at or near point -95.902496339999999
> 66.946641920000005
>
> I'd appreciate if you could send me similar examples, preferably
> reproducible with code but links to existing emails and online posts are
> welcome too. Feel free to construct examples from scratch that reproduce a
> particular warning/error.
>
> If you like, you can use the Github Issues mechanism here, or just email
> them in reply.
>
> https://github.com/r-gris/toposhop/issues
>
> Cheers, Mike.
>
>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From kmcoulib at gmail.com  Wed Feb  8 21:26:41 2017
From: kmcoulib at gmail.com (Kapo Coulibaly)
Date: Wed, 8 Feb 2017 12:26:41 -0800
Subject: [R-sig-Geo] HELP: Fitting a model variogram
In-Reply-To: <CAOKV6c7YBgQiSSu6bXUJQDo85qpSKvYYxGm6zWFTd1FXdN9VFw@mail.gmail.com>
References: <CAOKV6c7YBgQiSSu6bXUJQDo85qpSKvYYxGm6zWFTd1FXdN9VFw@mail.gmail.com>
Message-ID: <CANcefXZHvHEV-fDK5OK7vdmc8GJbqNknA04P6AS28NWW2ghkhQ@mail.gmail.com>

Can you share your variogram (a graph) and your initial parameters?

On Wed, Feb 8, 2017 at 1:55 AM, Kareem Longwe <kareemlongwe at gmail.com>
wrote:

> Dear all
> I am trying to fit a model variogram, but I am stuck on *ini.cov.pars. *I
> am working in R.
>
> Would anyone give me a clue how to estimate the 'partial sill and range'. I
> have tried changing numbers but I continuously get the following error
> message in R:
>
>  Warning messages:
> 1: In variofit(vario.pht, cov.model = "exponential", ini.cov.pars =
> initial.values,  :
>   unreasonable initial value for sigmasq (too high)
> 2: In variofit(vario.pht, cov.model = "exponential", ini.cov.pars =
> initial.values,  :
>   unreasonable initial value for sigmasq + nugget (too high).
>
> Thanks
>
> *Kareem Longwe*
> *NEPADSAN*Bio Student Ambassador
> MSc Student, Agronomy
> Lilongwe University of Agriculture and Natural Resources
> P.O. Box 219.
>
> klongwe at bunda.luanar.mw
> +265 996 31 66 22
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From basille.web at ase-research.org  Wed Feb  8 21:46:36 2017
From: basille.web at ase-research.org (Mathieu Basille)
Date: Wed, 8 Feb 2017 15:46:36 -0500
Subject: [R-sig-Geo] =?utf-8?q?Workshop=3A_Next_Generation_Data_Management?=
 =?utf-8?q?_in_Movement_Ecology_=28Florida=2C_May_8=E2=80=9312_2017=29?=
Message-ID: <68497c38-2191-7c2a-cdee-6bc5dcaf17e2@ase-research.org>

* Venue: Fort Lauderdale REC, Davie, Florida

* Contact: Mathieu Basille (basille at ufl.edu)

* Instructors: Simona Picardi, David Bucklin & Mathieu Basille (UF WEC)

* Guest lecturers: Anne Berger (Leibniz Institute for Zoo and Wildlife
Research, Germany), Hamish Campbell (Charles Darwin University, Australia),
Francesca Cagnacci (Fondazione Edmund Mach, Italy) & Ferdinando Urbano
(Independent researcher, Italy)

* Attendance: Reserved for Natural Resource managers (for a fee) and UF
students (with tuition waiver). Limited seats are available on a first come
? first served basis. Natural Resource managers, please register on
Eventbrite.com [1].

* More info on: http://ase-research.org/training/PostGIS_2017/


Recent technological progress has allowed ecologists to obtain a huge
amount and diversity of animal movement data sets of increasing spatial and
temporal resolution and size, together with complex associated information
related to the environmental context, such as habitat types based on remote
sensing, population density, and weather. Based on several years of
experience on multiple species, this intensive five-day workshop is
designed to teach participants how to handle, manage, store and retrieve
movement data in a spatial database, and how to eventually feed them to
analysis tools. In the first part of the course, participants will be
exposed to basics of spatial databases for wildlife tracking data, using
PostgreSQL/PostGIS, the reference free and open-source database system. The
second part will focus on the integration of environmental data in the
process. The third part will tackle the specifics of movement data, and how
to connect the database to the R statistical environment for analysis. Step
by step, using reproducible, hands-on exercises that will be released
on-line, we will provide a complete and seamless procedure from raw data to
final analysis that will enable participants to fully manage and integrate
complex animal movement data sets. Although the workshop is intended for a
wide audience, basic knowledge of SQL, spatial databases and R are highly
recommended to get the best experience.

Participants will have to bring their own laptop computers, with necessary
software installed (instructions for open-source software will be provided).

Reference: Urbano, F. & Cagnacci, F. (ed.) (2014) Spatial Database for GPS
Wildlife Tracking Data: A Practical Guide to Creating a Data Management
System with PostgreSQL/PostGIS and R. Springer, 257 pp. DOI:
10.1007/978-3-319-03743-1


[1]
https://www.eventbrite.com/e/next-generation-data-management-in-movement-ecology-tickets-31849319171


-- 

Mathieu Basille

basille at ufl.edu | http://ase-research.org/basille
+1 954-577-6314 | University of Florida FLREC

  ? Le tout est de tout dire, et je manque de mots
  Et je manque de temps, et je manque d'audace. ?
  ? Paul ?luard


From r.turner at auckland.ac.nz  Thu Feb  9 00:06:33 2017
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Thu, 9 Feb 2017 10:06:33 +1100
Subject: [R-sig-Geo] [FORGED] Selecting spatial points within spatial
 line segments
In-Reply-To: <CABkCotSGa2CJcWemt40cijc2D=szo5C0O1hUBWQK_=jef2+J_A@mail.gmail.com>
References: <CABkCotSGa2CJcWemt40cijc2D=szo5C0O1hUBWQK_=jef2+J_A@mail.gmail.com>
Message-ID: <37bcdc50-78ef-bd79-cd9c-00d1214a4b8f@auckland.ac.nz>

On 09/02/17 02:56, Manuel Sp?nola wrote:
> Dear list members,
>
> I have a spatial line (a road) segmented in 500-meters segments.  I also
> have spatial points (roadkills) and I want to select the points related to
> each segment in the line.  The points do not touch (intersect) the line,
> but are close to it. How can I do this in R?


The project2segment() function from the spatstat package will probably 
do what you want.

cheers,

Rolf Turner

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From englishchristophera at gmail.com  Thu Feb  9 01:34:09 2017
From: englishchristophera at gmail.com (chris english)
Date: Wed, 8 Feb 2017 19:34:09 -0500
Subject: [R-sig-Geo] "invalid" geometries in shape data
In-Reply-To: <CANVKczP1R1-OpGMa8pzSksp1kh6Zn-hqWFKNBmnY9ZqpeLf+7g@mail.gmail.com>
References: <CAAcGz9_Ta=39Zpt5=gbLb3+Muu1sG6A83uriNs4A1tix-eiBSA@mail.gmail.com>
	<CANVKczP1R1-OpGMa8pzSksp1kh6Zn-hqWFKNBmnY9ZqpeLf+7g@mail.gmail.com>
Message-ID: <CAASFQpRFGZU6PL_2edmDND9G5gHTAvxyroN95RFci+gHkd3BDQ@mail.gmail.com>

Michael,

I'll forward to rgis/toposhop/issues some 'flat' triangles (i.e. co-linear)
that come up in my neuro
data. Even Roualt says that TRIANGLE will be in GDAL 2.2 release in May and
has been
wrestling with it since Nov/Dec last.

PostGIS tests first three points of polygon for co-linearity but doesn't
detail precision,
presumably at level provided. stryk seems generally pragmatic in these
things. Even was
miffed in a Dec tweet about triangle having four points (.."and its called
Simple Features),
but coming where it does in the polygon hierarchy, it is going to be
closed.

geophys::TriangleInfo tests for co-linearity using sign of determinant
through the dt function,
though determinant (proper) would likely be quicker for evaluating lots of
them as it is direct call to
.Internal.

I am still trying to wrap my head around RTriangle. I think it must be
sturdy for triangle(s), but in
some sense its goal of mesh propagation upon/within a polygon system is
seemingly time travel
compared to my 'this thing is a triangle, aren't it?" None of the methods
I've seen so far seem to test
for 'no internal boundary', including CGAL. And none of this addresses
'automatic fixing tool' that
you or Delft suggests.

My data, from the wild, seems amenable to a jitter after a test by either
atan2 or determinant to
establish candidates for jittering. determinant seems like it would work
best with sf approach to
st_geometry(sfc) as they are lists and one can discern, following geophys'
approach building out
(adding 1s to a 3rd col of) a 2x4 triangle/polygon matrix to 3x4 and
evaluating on first 3x3 square.

I've said as much as I know to this point, triangles are coming.

Chris

On Wed, Feb 8, 2017 at 1:47 PM, Barry Rowlingson <
b.rowlingson at lancaster.ac.uk> wrote:

> Searching GIS StackExchange for [r] and TopologyException might find you a
> few:
>
> http://gis.stackexchange.com/search?q=%5Br%5D+topologyexception
>
> [answered one of these just today:
> http://gis.stackexchange.com/questions/227569/r-error-
> fortifying-dataframe-from-shapefile]
>
> Barry
>
> On Tue, Feb 7, 2017 at 9:46 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> > Hi,
> >
> > I'm interested in exploring the details of kinds of errors and warnings
> > that are seen from the underlying geometry lib (GEOS) for spatial data in
> > R.
> >
> > I would like to also have a collection of  examples with actual data and
> > reproducible code.
> >
> > (The underlying theory and definitions and source code are all open and
> > available, I'm looking for examples).
> >
> > The kinds of errors I'm talking about come from the GEOS library under
> the
> > hood, and this is more or less the same in the sp/rgdal as well as the
> new
> > sf family.
> >
> > Here's one example, this data set is not valid because of at least one
> > "polygon self intersection", basically the ring winds back on itself:
> >
> > library(maptools)
> > data(wrld_simpl)
> > rgeos::gIsValid(wrld_simpl)
> > [1] FALSE
> > Warning message:
> > In RGEOSUnaryPredFunc(spgeom, byid, "rgeos_isvalid") :
> >   Ring Self-intersection at or near point -95.902496339999999
> > 66.946641920000005
> >
> > I'd appreciate if you could send me similar examples, preferably
> > reproducible with code but links to existing emails and online posts are
> > welcome too. Feel free to construct examples from scratch that reproduce
> a
> > particular warning/error.
> >
> > If you like, you can use the Github Issues mechanism here, or just email
> > them in reply.
> >
> > https://github.com/r-gris/toposhop/issues
> >
> > Cheers, Mike.
> >
> >
> > --
> > Dr. Michael Sumner
> > Software and Database Engineer
> > Australian Antarctic Division
> > 203 Channel Highway
> > Kingston Tasmania 7050 Australia
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From safeeqkhan at gmail.com  Thu Feb  9 05:27:36 2017
From: safeeqkhan at gmail.com (Safeeq Khan)
Date: Wed, 8 Feb 2017 20:27:36 -0800
Subject: [R-sig-Geo] Creating a raster and setting extent in R
Message-ID: <CAKKP_JYJZW6oQDTz8h311myuu9LMZ42fD0YZPscuHDjxuhPcpQ@mail.gmail.com>

I am trying to create a raster with 922 columns and 444 rows at
0.06250-degree spatial resolution. However, after I set the following
extent the resolution of the resulting raster comes out to be 0.06243221.
It seems like the extent function is only reading the first 4 digits after
the decimal for both xmn and xmx.

Here is a sample code I am trying:

r <- raster(ncol=922, nrow=444)

bb <- extent(235.40625,292.96875,25.15625, 52.84375)

extent(r) <- bb

r <- setExtent(r, bb)

I have also tried to only set the extent and resolution but then I only get
921 columns and 443 rows.

r <- raster() bb <- extent(235.40625,292.96875,25.15625, 52.84375)
extent(r) <- bb res(r) <-0.06250 r <- setExtent(r, bb)

Any thought?

Best,

Safeeq

	[[alternative HTML version deleted]]


From Javi.Navarro at csiro.au  Thu Feb  9 06:13:41 2017
From: Javi.Navarro at csiro.au (Javi.Navarro at csiro.au)
Date: Thu, 9 Feb 2017 05:13:41 +0000
Subject: [R-sig-Geo] Spatial.tools rasterEngine subscript out of bounds;
 setting blocksize works but why?
Message-ID: <a9b7eb040fec4efa8f848337fa6969aa@exch3-mel.nexus.csiro.au>

Hi all,

I've had an issue using rasterEngine (spatial.tools) to speed up a moving window analysis on some .tiff rasters.

I managed to solve the issue but I would like to gain an understanding as to why my code didn't work in the first place.

The short version is: When I call rasterEngine to process a comparably large raster (6GB as opposed to 1GB), rasterEngine exits nearly at the end and sends out a subscript out of bounds error (see below). I noticed the difference with other rasters was that in this case rasterEngine divided the task in an odd number of iterations (319) whereas in succesfully-processed rasters the iterations were always an even number. When I specified a blocksize to force rasterEngine to process the large raster in an even number of iterations, it worked well.

Why would this be? We want to publish an R package (and a paper) for ecological modelling and we're improving it by using rasterEngine, so understanding the root of this issue would be handy.

The long version follows:

I ran our code for 3 regions, 2 of them worked well but the third and largest didn't (details below):

Region 1 (OK): 12620 cols x 9766 rows
	       10m x 10m
	       Uncompressed size 940MB

Region 2 (OK): 15158 cols x 11389 rows
	       10m x 10m
	       Uncompressed size 1.29GB

Region 3 (FAIL): 28348 cols x 27995 rows
		 10m x 10m
		 Uncompressed size 5.91GB

Region 3 TEST 1 (OK): 14174 cols x 13998 rows
		      20m x 20m
		      Uncompressed size 1.48GB

Region 3 TEST 2 (OK): 18899 cols x 18663 rows
		      15m x 15m
		      Uncompressed size 2.63GB

In the failed attempt rasterEngine exits with this error:

Iteration:  318  of  319 
Error in X[, texture_tr$row[j]:texture_tr$row2[j], , drop = FALSE] : 
  subscript out of bounds
Calls: calc.moving.window ... focal_hpc_focal_processing -> mapply -> <Anonymous> -> sapply -> lapply -> FUN
Timing stopped at: 708.364 131.9 5757.259 
Execution halted

And the code invoking rasterEngine is this:

calc.moving.window <- function(r.input, func, r.output.name, circular_filter, radius, res, val, block_size){
  system.time(
    r.output <- rasterEngine(
      inraster=r.input,
      fun=func,
      args = list(circ_filter = circular_filter, dim = 1+(2*radius/res), centre = 1+(radius/res), value = val),
      window_dims=c(1+(2*radius/res),1+(2*radius/res)), # ncol = 1+(2*radius/res), nrow = 1+(2*radius/res) in the neighborhood
      filename = r.output.name,
      compileFunction=FALSE,
      debugmode=FALSE,
      setMinMax=FALSE,
      verbose=TRUE,
      additional_header = NULL,
      outformat = "GTiff",
      blocksize = block_size # Note before I found a fix for the error this line didn't exist
    )
  )
  
  writeRaster(r.output, r.output.name, format="GTiff")
}

I specified a blocksize of 140 rows, therefore forcing rasterEngine to perform 200 iterations. Then the code ran well.

I tried this in different machines, one in Windows 2012 R2 64bit (16 cores, 64GB RAM) runnng R_3.1.3 and latest version of spatial.tools and another Linux machine (requesting 16 cores, 6GB RAM) running R_3.2.5 and latest version of spatial.tools. Same results in both, same workaround.

Many thanks,

Javi

Javier Navarro
Experimental Scientist 
Health and Biosecurity 
CSIRO
E javi.navarro at csiro.au T +61 7 3833 5723 M +61 403 664 056
EcoSciences Precinct
Site Address: 41 Boggo Road, Dutton Park QLD?4102, Australia
Postal Address: GPO Box 2583, Brisbane?QLD 4001, Australia
www.csiro.au | http://people.csiro.au/N/J/Javi-Navarro.aspx


PLEASE NOTE
The information contained in this email may be confidential or privileged. Any unauthorised use or disclosure is prohibited. If you have received this email in error, please delete it immediately and notify?the sender by return email. Thank you. To the extent permitted by law, CSIRO does not represent, warrant and/or guarantee that the integrity of this communication has been maintained or that the communication is free of errors, virus, interception or interference. 
Please consider the environment before printing this email.


From Roger.Bivand at nhh.no  Thu Feb  9 09:47:30 2017
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 9 Feb 2017 09:47:30 +0100
Subject: [R-sig-Geo] Implementing and interpreting join count analysis
 with spdep
In-Reply-To: <CY4PR04MB03263979462490DA654EAD0AB3430@CY4PR04MB0326.namprd04.prod.outlook.com>
References: <CY4PR04MB0326B2FBC5BB1FF8EF05BFB2B3430@CY4PR04MB0326.namprd04.prod.outlook.com>,
	<alpine.LFD.2.20.1702071812230.28808@reclus.nhh.no>
	<CY4PR04MB03263979462490DA654EAD0AB3430@CY4PR04MB0326.namprd04.prod.outlook.com>
Message-ID: <alpine.LFD.2.20.1702090933430.12547@reclus.nhh.no>

On Tue, 7 Feb 2017, Justin Schuetz wrote:

> Roger,
>
>
> Thanks for the leads. Is the general concern about including large 
> numbers of neighbors that there may not really be any relationship 
> between "very" distant points and that Type II errors will become more 
> likely in a hypothesis testing framework?

No, two issues here.

One is that the data generation process involves not (I - \rho W) but 
either (I - \rho W)^{-1} (CAR) or (I - \rho W)^{-1} (I - \rho W^T)^{-1} 
(SAR), so is dense anyway. Under certain assumptions, (I - \rho W)^{-1} is 
\sum_{i=0}^{Inf} (\rho W)^i, so the sum of a power series in the 
autoregressive coefficient \rho and the spatial weights. So if W are only 
contiguous neighbours, W %*% W are neighbours of neighbours, and so on. So 
including all neighbours in W, even with inverse distance weighting, 
"double-guesses" the form of the relationship. Most of these measures came 
into being anyway for areal support rather than point support - the name 
"join-count" tells us this.

The other is that the tests only make sense if we are confident that the 
join counts are not being influenced by our partitioning of the surface 
(or choice of points), nor by omitted variables. It could be that the join 
counts are more related to elevation or temperature (say) than to being 
neighbours - think of this as residuals from a regression (multinomial 
here). Which join counts would we expect to see after taking into account 
what we know about the drivers of the multinomial response?

Roger

>
>
> Justin
>
>
> ________________________________
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Sent: Tuesday, February 7, 2017 12:19 PM
> To: Justin Schuetz
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Implementing and interpreting join count analysis with spdep
>
> On Tue, 7 Feb 2017, Justin Schuetz wrote:
>
>> List members,
>>
>> I am trying to assess whether points of the same color are spatially
>> autocorrelated. I have limited familiarity with spdep and join count
>> analyses and would like to confirm that I am implementing and
>> interpreting the analysis correctly. Below is a summary of the data,
>> code used in the analysis, results, and my quick interpretation. If
>> someone familiar with this type of analysis (or alternatives that are
>> better able to address the question) could offer feedback, I would
>> greatly appreciate it...particularly if you can help me understand how
>> best to choose the style parameter in nb2listw function.
>>
>> Many thanks,
>>
>> Justin
>>
>> ##### POINT DATA
>>
>> my.points
>> # A tibble: 50 ? 4
>>   SVSPP JGS.UTM.X JGS.UTM.Y JGS.COLOR
>>   <int>     <dbl>     <dbl>     <int>
>> 1     13 -14272.27   4035288         3
>> 2     15 265382.54   4398047         3
>> 3     22 552678.02   4537646         3
>> 4     23 430904.66   4524648         3
>> 5     24 -43587.79   4050674         3
>> 6     25  67560.06   4190581         3
>> 7     26 326773.57   4488521         3
>> 8     27 578645.44   4735815         3
>> 9     28 533183.23   4722559         3
>> 10    33 368053.13   4566608         3
>> # ... with 40 more rows
>>
>> ##### CODE
>>
>> # make SpatialPoints object and specify projection
>>
>> coords <- my.points[, c("JGS.UTM.X", "JGS.UTM.Y")]
>> UTM19N <- "+proj=utm +zone=19 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
>> lat.lon <- SpatialPoints(coords, CRS(UTM19N))
>>
>> # generate spatial weights matrix (inverse distance weighting among all
>> points)
>
> At this point you are probably deciding the outcome of the tests -
> different weights will give different outcomes. The fewer neighbours the
> better is a good rule, otherwise the relationships may be heavily
> smoothed. See vignette("nb").
>
>>
>> my.k.neighbors <- knearneigh(lat.lon, k = length(lat.lon) - 1, longlat = FALSE)
>> my.neighbors <- knn2nb(my.k.neighbors)
>> my.distances <- nbdists(my.neighbors, lat.lon)
>> my.weights <- lapply(my.distances, function(x) 1/(x))
>> my.list <- nb2listw(my.neighbors, glist = my.weights, style = "S")
>>
>> # identify colors
>>
>> my.colors <- as.factor(my.points$JGS.COLOR)
>>
>> # assess whether similar colors are closer to each other than expected
>> # by chance given fixed point locations
>
> It is also possible to use joincount.multi() to compare all with all (here
> 1-1, 1-2, 1-3, 2-2, 2-3, 3-3), rather than 1 with not-1 and so on. Also
> look at alternative=, as your 3-3 looks close to significant negative
> autocorrelation (for your preferred weights).
>
> Roger
>
>>
>> joincount.mc(my.colors, my.list, nsim = 1000)
>>
>> ##### RESULTS
>>
>>        Monte-Carlo simulation of join-count statistic
>>
>> data:  my.colors
>> weights: my.list
>> number of simulations + 1: 1001
>>
>> Join-count statistic for 1 = 0.2037, rank of observed statistic = 987,
>> p-value = 0.01399
>> alternative hypothesis: greater
>> sample estimates:
>>    mean of simulation variance of simulation
>>           0.061423025            0.001758675
>>
>>
>>        Monte-Carlo simulation of join-count statistic
>>
>> data:  my.colors
>> weights: my.list
>> number of simulations + 1: 1001
>>
>> Join-count statistic for 2 = 0.076401, rank of observed statistic = 754,
>> p-value = 0.2468
>> alternative hypothesis: greater
>> sample estimates:
>>    mean of simulation variance of simulation
>>           0.060196719            0.001639431
>>
>>
>>        Monte-Carlo simulation of join-count statistic
>>
>> data:  my.colors
>> weights: my.list
>> number of simulations + 1: 1001
>>
>> Join-count statistic for 3 = 19.002, rank of observed statistic = 36,
>> p-value = 0.964
>> alternative hypothesis: greater
>> sample estimates:
>>    mean of simulation variance of simulation
>>            19.3165692              0.0451797
>>
>> ##### INTERPRETATION
>>
>> Points with color "1" are closer to each other than expected by chance, whereas there is
>> little evidence that points with colors "2" (or "3") are spatially autocorrelated.
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/444584
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584

From martazores at gmail.com  Thu Feb  9 17:38:32 2017
From: martazores at gmail.com (marta azores)
Date: Thu, 9 Feb 2017 15:38:32 -0100
Subject: [R-sig-Geo] shortestPath in a loop
In-Reply-To: <6e297ccf-e330-0570-78e5-6a06c5f2283d@uni-marburg.de>
References: <CALEhSiT=o9MNCyRsoRfz3w1vnmpe4Or+hLKj61S-q15uK2hOUg@mail.gmail.com>
	<permail-201701141621533cc687ad00004480-rolandh@message-id.uni-muenster.de>
	<CAE3WKgQWkyRWgcSxLBVOJuBfBZ5pmoWrFSjzzvuFTnZeM8Yj6Q@mail.gmail.com>
	<CAE3WKgTo5+yb10rgQZkf+OgKjEjo5UCK-TffAJLjW609Q1ZDMA@mail.gmail.com>
	<367a0b6d-bd14-2bdc-8a4e-8c93213849e0@uni-marburg.de>
	<CAE3WKgSBKtGErdcXLjRRd50nRP3S2VUsGc79FGNomJ8-Hz8dZA@mail.gmail.com>
	<CAE3WKgQVjjEr2tWZshHjCpk3PVPYsztuS52xfcXBHbfXWz3PBA@mail.gmail.com>
	<efa22928-86ff-cbf1-eb6b-832143cd7b4c@uni-marburg.de>
	<CAE3WKgSU+b5xWXD5nkv_twNSpFqNZyZ_5P_yWzwGktjCsacCSg@mail.gmail.com>
	<CAE3WKgSq3MOsOtcVyM+csebgd_ChTxMjGt8ia0Mg+j6V0kfD2g@mail.gmail.com>
	<CAE3WKgS7LHSrSiMCw2AJh8XjCMXWA+P1mRKi6HDGTQrabVB70w@mail.gmail.com>
	<6e297ccf-e330-0570-78e5-6a06c5f2283d@uni-marburg.de>
Message-ID: <CAE3WKgR1q9GiZfG5q34UgOQtW8UGrR_D-JHyZAftoE1=ywoO8A@mail.gmail.com>

Hi everyone,
the problem was in the projection (+proj=lae) and in the transitionFunction
(mean). If we use the utm projection and the min transitionFunction. It
works properly.
Thanks for your help, in all the process.
:)

Marta

2017-02-03 16:18 GMT-01:00 Chris Reudenbach <reudenbach at uni-marburg.de>:

> Hi Marta,
>
> I am bit of busy wo I will answer later.
>
> cheers chris
>
>
>
> On 03.02.2017 16:32, marta azores wrote:
>
>> Hi Chris,
>> Thanks for your answer. Your solution is perfect. I calculated the length
>> of the line with the old raster (azoTS1), and the results are close to
>> real
>> number.  It's great.(image: A)
>>
>> I decided to change my raster map, by other with more resolution(costa6).
>> The islands are better defined now.
>> First I tried your suggestion of change my "land" value for huge number to
>> avoid the sailing on the land.
>> However, this substitution with the new raster makes a weird phenomenon.
>> It
>> build new areas with land (image: B).
>> By this reason, I decided not use it in this case.
>>
>> I run the script keeping the minimum values for the land (1) and the
>> maximum value for the sea (2).
>> Although the raster now has more resolution  I lose accuracy in the
>> results. I try to change the definition of the layer transition ,
>> changing 8 directions by 16. This move increases the length result.
>> However, the old results were closer to real number than the new.(image:
>> C)
>>
>> The line in the old image (A) are smoother than in the new(C). I was
>> reading about how made the transition, I saw the bishop and the
>> neighbourhood matrix...but It didn't work to me.
>>
>> How can I  fix that? Any idea?
>>
>> ### download the files available through this link:
>> https://drive.google.com/open?id=0B7IbvWhE5JNPMVVvNWVwRzNUOXM
>>
>> 2017-01-31 18:11 GMT-01:00 marta azores <martazores at gmail.com>:
>>
>> Hi Chris,
>>> Thanks for your answer. Your solution is perfect. I calculated the length
>>> of the line with the old raster (azoTS1), and the results are close to
>>> real number.  It's great.(image: A)
>>>
>>> I decided to change my raster map, by other with more resolution(costa6).
>>> The islands are better defined now.
>>> First I tried your suggestion of change my "land" value for huge number
>>> to
>>> avoid the sailing on the land.
>>> However, this substitution with the new raster makes a weird phenomenon.
>>> It build new areas with land (image: B).
>>> By this reason, I decided not use it in this case.
>>>
>>> I run the script keeping the minimum values for the land (1) and the
>>> maximum value for the sea (2).
>>> Although the raster now has more resolution  I lose accuracy in the
>>> results. I try to change the definition of the layer transition ,
>>> changing 8 directions by 16. This move increases the length result.
>>> However, the old results were closer to real number than the new.(image:
>>> C)
>>>
>>> The line in the old image (A) are smoother than in the new(C). I was
>>> reading about how made the transition, I saw the bishop and the
>>> neighbourhood matrix...but It didn't work to me.
>>>
>>> How can I  fix that? Any idea?
>>>
>>> 2017-01-31 17:25 GMT-01:00 marta azores <martazores at gmail.com>:
>>>
>>> Hi Chris,
>>>> Thanks for your answer. Your solution is perfect. I calculated the
>>>> length
>>>> of the line with the old raster (azoTS1), and the results are close to
>>>> real number.  It's great.(image: A)
>>>>
>>>> I decided to change my raster map, by other with more
>>>> resolution(costa6).
>>>> The islands are better defined now.
>>>> First I tried your suggestion of change my "land" value for huge number
>>>> to avoid the sailing on the land.
>>>> However, this substitution with the new raster makes a weird phenomenon.
>>>> It build new areas with land (image: B).
>>>> By this reason, I decided not use it in this case.
>>>>
>>>> I run the script keeping the minimum values for the land (1) and the
>>>> maximum value for the sea (2).
>>>> Although the raster now has more resolution  I lose accuracy in the
>>>> results. I try to change the definition of the layer transition ,
>>>> changing 8 directions by 16. This move increases the length result.
>>>> However, the old results were closer to real number than the
>>>> new.(image: C)
>>>>
>>>> The line in the old image (A) are smoother than in the new(C). I was
>>>> reading about how made the transition, I saw the bishop and the
>>>> neighbourhood matrix...but It didn't work to me.
>>>>
>>>> How can I  fix that? Any idea?
>>>>
>>>> Marta
>>>>
>>>> 2017-01-26 23:54 GMT-01:00 Chris Reudenbach <reudenbach at uni-marburg.de
>>>> >:
>>>>
>>>> Hi Marta
>>>>>
>>>>> the content of the costpath variable  is just existing in the lapply
>>>>> loop. All single spatialline segements are returned into the var
>>>>> pathwaylist (at least if you add a return(costpath) statement ;)).
>>>>>
>>>>> To make it a bit easier to understand I have adapted the code snippet.
>>>>> Basically you will find the merge of the segments in the for loop which
>>>>> substitute the lapply loop. additionally you may find the comments
>>>>> helpful.
>>>>>
>>>>> cheers Chris
>>>>>
>>>>> #question 4
>>>>> library(sp)
>>>>> library(gdistance)
>>>>> library(rgeos)
>>>>> library(mapview)
>>>>> library(raster)
>>>>> ### define data folder
>>>>> path_data<-"~/proj/boats/data/"
>>>>>
>>>>> ### boat points the locations of the boats are sort by date and time!
>>>>> boat <- read.table(paste0(path_data,"boat2905.csv"), header=TRUE,
>>>>> sep=",", na.strings="NA", dec=".", strip.white=TRUE)
>>>>> pos<-as.data.frame(cbind(boat$Lat1,boat$Long1))
>>>>> sp::coordinates(pos) <- ~V2+V1
>>>>> sp::proj4string(pos) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
>>>>> ### project it to somewhat equal area
>>>>> boatSP <- sp::spTransform(pos, CRS("+proj=laea +lat_0=30 +lon_0=-30
>>>>> +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))
>>>>> # plot boat positions
>>>>>
>>>>> # cost raster sea and island
>>>>> azoTS1<- raster::raster(paste0(path_data,"azoTS1.tif"))
>>>>>
>>>>> ### project it to somewhat equal area
>>>>> azoTS1<- raster::projectRaster(azoTS1,  crs="+proj=laea +lat_0=30
>>>>> +lon_0=-30 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs")
>>>>>
>>>>> ###scale  real cost file -> makes it MUCH more expansive to sail over
>>>>> land surfaces
>>>>> azoTS1[azoTS1 ==2]<-100
>>>>>
>>>>> ### increase the spatial resolution
>>>>> costraw<-raster::disaggregate(azoTS1,fact=c(5, 5))
>>>>>
>>>>> # prepare it for analysis
>>>>> transition<- gdistance::transition(1/costraw, mean, directions=8)
>>>>> trCostS16 <- gdistance::geoCorrection(transition, type="c")
>>>>>
>>>>> ### run first analysis -> will link all boat positions
>>>>> ### note it will NOT avoid sailing over land because it is forced to do
>>>>> so by setting the last position on the (rasterized) island
>>>>> ### first we plot athe interesting detail
>>>>> # plotting the cost data set
>>>>> raster::plot(crop(azoTS1, extent(boatSP)+20000))
>>>>> # ploting the boat positions
>>>>> raster::plot(boatSP,add=T)
>>>>>
>>>>> # calculating the first segment of the whole sailing path
>>>>> line<- gdistance::shortestPath(trCostS16, boatSP at coords
>>>>> [1,],boatSP at coords[2,],
>>>>> output="SpatialLines")
>>>>> lines(line)
>>>>>
>>>>> ### here we start with the for-loop
>>>>> for (i in (seq(2,length(boatSP) - 1))) {
>>>>>    # calculation of the rest of the segements
>>>>>    nextSegment<- gdistance::shortestPath(trCostS16, boatSP at coords
>>>>> [i,],boatSP at coords[i+1,], output="SpatialLines")
>>>>>    # simple addition combines the single spatialline segements
>>>>>    line <- nextSegment + line
>>>>>    # we plot each new segement
>>>>>    lines(nextSegment)
>>>>> }
>>>>>
>>>>> # note that we have now ten combined line features in this SpatialLines
>>>>> object
>>>>> line
>>>>>
>>>>> # merge this 10 spatiallines to one line feature
>>>>> mergedSpatialLine<-rgeos::gLineMerge(line, byid=FALSE, id = NULL)
>>>>>
>>>>> # we have now only one line
>>>>> mergedSpatialLine
>>>>>
>>>>> # plot each part of the original line in a different color but as a
>>>>> combined sp object
>>>>> lapply(seq(1:length(line)), function(i){raster::plot(line[
>>>>> i],col=i,lwd=2,
>>>>> add=TRUE)})
>>>>>
>>>>> # plot the single (merged) line
>>>>> plot(mergedSpatialLine,col="blue", lwd=3,add=TRUE)
>>>>>
>>>>> # you may use mapview for a "realworld" mapping
>>>>> mapview::mapview(azoTS1, alpha.regions = 0.5)+
>>>>> mapview::mapview(boatSP,col = "green", cex=2) +
>>>>> mapview::mapview(mergedSpatialLine,col = "red")
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On 26.01.2017 16:28, marta azores wrote:
>>>>>
>>>>> Thanks Chris,
>>>>>
>>>>>
>>>>> your answer was very helpful. But I still have two problems.
>>>>>
>>>>> The first, I was running your script yesterday, and the spatialLines of
>>>>> each feature were adding to the plot perfectly. However, I can?t use as
>>>>> object these spatialLines. After run the script, when I wrote
>>>>> ?costpath? in the console, it says this object was not found. How is
>>>>> that
>>>>> possible?
>>>>>
>>>>> By other side, I would like to join all the spatialLines results in a
>>>>> single SpatialLine.
>>>>>
>>>>> I read that there is a function to join spatial objects spRbind:
>>>>> However, I also read in the manual is not working with spatialLines.
>>>>> Byside, it?s possible to use the rgeosStatus to join these spatial
>>>>> objects.
>>>>> I tried to use this function in your script.
>>>>>
>>>>> Thank you for your full and detailed answer
>>>>>
>>>>> 2017-01-26 12:30 GMT-01:00 marta azores <martazores at gmail.com>:
>>>>>
>>>>> Thanks Chris,
>>>>>>
>>>>>>
>>>>>> your answer was very helpful. But I still have two problems.
>>>>>>
>>>>>> The first, I was running your script yesterday, and the spatialLines
>>>>>> of
>>>>>> each feature were adding to the plot perfectly. However, I can?t use
>>>>>> as
>>>>>> object these spatialLines. After run the script, when I wrote
>>>>>> ?costpath? in the console, it says this object was not found. How is
>>>>>> that
>>>>>> possible?
>>>>>>
>>>>>> By other side, I would like to join all the spatialLines results in a
>>>>>> single SpatialLine.
>>>>>>
>>>>>> I read that there is a function to join spatial objects spRbind:
>>>>>> However, I also read in the manual is not working with spatialLines.
>>>>>> Byside, it?s possible to use the rgeosStatus to join these spatial
>>>>>> objects.
>>>>>> I tried to use this function in your script.
>>>>>>
>>>>>> Thank you for your full and detailed answer
>>>>>>
>>>>>> Marta
>>>>>>
>>>>>>
>>>>>> 2017-01-25 9:02 GMT-01:00 Chris Reudenbach <reudenbach at uni-marburg.de
>>>>>> >
>>>>>> <reudenbach at uni-marburg.de>:
>>>>>>
>>>>>> Marta,
>>>>>>>
>>>>>>> your problem seems to me more conceptual. The shortestPath
>>>>>>> implementation of a cost analysis is not exactly want you want. You
>>>>>>> would choose it if you have to find an unknown path on a friction
>>>>>>> surface. You would not choose it if you just want to link positions.
>>>>>>> The
>>>>>>> shortestPath of your implementation can not avoid to touch the island
>>>>>>> because you force it to go there. It is a bit more "expensive" in
>>>>>>> your
>>>>>>> case 2 units but not forbidden.
>>>>>>>
>>>>>>> Nevertheless there are also some technical issues to address: Even if
>>>>>>> if
>>>>>>> there is a correction for unprojected data sets it is better to
>>>>>>> project
>>>>>>> them because it is more stable to calculate cost on an equal area
>>>>>>> projection. Than the spatial resolution of the cost raster should be
>>>>>>> sufficient to meet the distance of the points.
>>>>>>>
>>>>>>> You will find below the example code. Note that I assume that the
>>>>>>> data
>>>>>>> is an directory as defined by "path_data".
>>>>>>>
>>>>>>> The "path will be plotted consecutively in the plotting window.
>>>>>>>
>>>>>>> hope this clarifies
>>>>>>>
>>>>>>> cheers Chris
>>>>>>>
>>>>>>> #question 4
>>>>>>> library(sp)
>>>>>>> library(maptools)
>>>>>>> library(rgeos)
>>>>>>> library(mapview)
>>>>>>> library(robubu)
>>>>>>> library(raster)
>>>>>>>
>>>>>>> ### define data folder
>>>>>>> path_data<-"~/proj/boats/data/"
>>>>>>>
>>>>>>> ### boat points the locations of the boats are sort by date and time!
>>>>>>> boat <- read.table(paste0(path_data,"boat2905.csv"), header=TRUE,
>>>>>>> sep=",", na.strings="NA", dec=".", strip.white=TRUE)
>>>>>>> pos<-as.data.frame(cbind(boat$Lat1,boat$Long1))
>>>>>>> sp::coordinates(pos) <- ~V2+V1
>>>>>>> sp::proj4string(pos) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
>>>>>>>
>>>>>>> ### project it to somewhat equal area
>>>>>>> boatSP <- sp::spTransform(pos, CRS("+proj=laea +lat_0=30 +lon_0=-30
>>>>>>> +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))
>>>>>>>
>>>>>>> # cost raster sea and island
>>>>>>> azoTS1<- raster::raster(paste0(path_data,"azoTS1.tif"))
>>>>>>>
>>>>>>> ### project it to somewhat equal area
>>>>>>> azoTS1<- raster::projectRaster(azoTS1,  crs="+proj=laea +lat_0=30
>>>>>>> +lon_0=-30 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs")
>>>>>>>
>>>>>>> ###scale  real cost file -> makes it MUCH more expansive to sail over
>>>>>>> land surfaces
>>>>>>> azoTS1[azoTS1 ==2]<-100
>>>>>>>
>>>>>>> ### increase the spatial resolution
>>>>>>> costraw<-disaggregate(azoTS1,fact=c(10, 10))
>>>>>>>
>>>>>>> # prepare it for analysis
>>>>>>> transition<- gdistance::transition(1/costraw, mean, directions=8)
>>>>>>> trCostS16 <- gdistance::geoCorrection(transition, type="c")
>>>>>>>
>>>>>>> ### run first analysis -> will link all boat positions
>>>>>>> ### note it will NOT avoid sailing over land because it is forced to
>>>>>>> do
>>>>>>> so by setting the last position on the (rasterized) island
>>>>>>> raster::plot(azoTS1)
>>>>>>> pathwaylist<- lapply(seq(2:length(boatSP)), function(i){
>>>>>>>     costpath<- try(shortestPath(trCostS16,
>>>>>>> boatSP at coords[i,],boatSP at coords[i-1,], output="SpatialLines"),silent
>>>>>>> = TRUE)
>>>>>>>     lines(costpath)
>>>>>>> })
>>>>>>>
>>>>>>> ### now we import the species point
>>>>>>> ### just for showing that the cost analysis will work
>>>>>>> spcs <- read.table(paste0(path_data,"/sp2pontosDT.csv"),
>>>>>>> header=TRUE,
>>>>>>> sep=",", na.strings="NA", dec=".", strip.white=TRUE)#Bom test
>>>>>>> sp::coordinates(spcs) <- ~Long1+Lat
>>>>>>> sp::proj4string(spcs) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
>>>>>>> spcsSP <- sp::spTransform(spcs, CRS("+proj=laea +lat_0=30 +lon_0=-30
>>>>>>> +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))
>>>>>>>
>>>>>>> ### run second analysis -> will link all the two species positions
>>>>>>> raster::plot(azoTS1)
>>>>>>> pathwaylist<- lapply(seq(2:length(spcsSP)), function(i){
>>>>>>>     costpath<- try(shortestPath(trCostS16,
>>>>>>> spcsSP at coords[i,],spcsSP at coords[i-1,], output="SpatialLines"),silent
>>>>>>> = TRUE)
>>>>>>>     lines(costpath)
>>>>>>> })
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On 24.01.2017 21:06, marta azores wrote:
>>>>>>>
>>>>>>>> Hi guys,
>>>>>>>>
>>>>>>>> I'm still trying to solve my deal. How I can join the survey
>>>>>>>> boat points using the shortestpath function, to avoid the land. It's
>>>>>>>> important because  I need an output "spatialLines"(boat surveys) to
>>>>>>>> intersect with points( species points).
>>>>>>>> I add several files : script and other layers of information.
>>>>>>>>
>>>>>>>> Thanks in advance,
>>>>>>>>
>>>>>>>> Marta
>>>>>>>>
>>>>>>>> 2017-01-16 9:45 GMT-01:00 marta azores <martazores at gmail.com
>>>>>>>> <mailto:martazores at gmail.com>>:
>>>>>>>>
>>>>>>>>      Hi Jerome,
>>>>>>>>
>>>>>>>>      There are several R packages to join points. However, I have
>>>>>>>> two
>>>>>>>>      relevant issues with them.
>>>>>>>>       -The first,  I need to get the "Lines" from these tracks in
>>>>>>>>      "spatial Lines". For example, in the adehabitatLT package you
>>>>>>>> can
>>>>>>>>      get easily the trajectories of the animal but with the class "
>>>>>>>>      ltraj". I don't know
>>>>>>>>         how transform this object class into spatial lines.
>>>>>>>>      -The second, when I made the tracks I need to avoid the coast,
>>>>>>>>
>>>>>>> and
>>>>>>>
>>>>>>>>      I don't know how do that in adehabitatLT.
>>>>>>>>
>>>>>>>>      Any idea?
>>>>>>>>
>>>>>>>>      Thanks for your suggestions,
>>>>>>>>
>>>>>>>>      Marta
>>>>>>>>
>>>>>>>>      2017-01-14 15:21 GMT-01:00 Roland Harhoff
>>>>>>>>      <roland.harhoff at uni-muenster.de
>>>>>>>>      <mailto:roland.harhoff at uni-muenster.de>>:
>>>>>>>>
>>>>>>>>          Hi Marta,
>>>>>>>>
>>>>>>>>          and did you check the trajectories package ...?
>>>>>>>>
>>>>>>>>          https://cran.r-project.org/web/packages/trajectories/index
>>>>>>>> .
>>>>>>>>
>>>>>>> html
>>>>>>>
>>>>>>>>          <https://cran.r-project.org/w
>>>>>>>> eb/packages/trajectories/index
>>>>>>>>
>>>>>>> .html>
>>>>>>>
>>>>>>>>          Cheers!
>>>>>>>>          Roland
>>>>>>>>
>>>>>>>>
>>>>>>>>          J?rome Mathieu schrieb am 2017-01-14:
>>>>>>>>          > Hi,
>>>>>>>>
>>>>>>>>          > Did you have a look at the package adehabitatLT?
>>>>>>>>
>>>>>>>>          >
>>>>>>>>          https://cran.r-project.org/we
>>>>>>>> b/packages/adehabitatLT/vignet
>>>>>>>>
>>>>>>> tes/adehabitatLT.pdf
>>>>>>>
>>>>>>>>          <https://cran.r-project.org/w
>>>>>>>> eb/packages/adehabitatLT/vigne
>>>>>>>>
>>>>>>> ttes/adehabitatLT.pdf>
>>>>>>>
>>>>>>>>          > It deals with trajectories based on points ordered by
>>>>>>>> date.
>>>>>>>>
>>>>>>>>          > Jerome
>>>>>>>>
>>>>>>>>
>>>>>>>>          > 2017-01-13 11:41 GMT+01:00 marta azores
>>>>>>>>          <martazores at gmail.com <mailto:martazores at gmail.com>>:
>>>>>>>>
>>>>>>>>          > > Thanks for your quick reply to my question,
>>>>>>>>          > >
>>>>>>>>          > > This ten points are ordered by time (date + time), and
>>>>>>>> I
>>>>>>>>          know ,the points
>>>>>>>>          > > are all connected.  I didn't include the column with
>>>>>>>> the
>>>>>>>>          time in this
>>>>>>>>          > > example, to make it simple.
>>>>>>>>          > >
>>>>>>>>          > > After read your messages, I was looking the minimum
>>>>>>>>          spanning tree for the
>>>>>>>>          > > vertices.
>>>>>>>>          > > The advantage with the function "shortestPath" is that
>>>>>>>>
>>>>>>> you
>>>>>>>
>>>>>>>>          have as result a
>>>>>>>>          > > spatial line output, which I need it.
>>>>>>>>          > > However, the minimum spanning tree give as output an
>>>>>>>>
>>>>>>> ordiplot.
>>>>>>>
>>>>>>>>          > >
>>>>>>>>          > > Is it possible to transform the ordiplot into
>>>>>>>>
>>>>>>> spatialLines?
>>>>>>>
>>>>>>>>          > >
>>>>>>>>          > > Thanks for your answers
>>>>>>>>          > >
>>>>>>>>          > > Marta
>>>>>>>>          > >
>>>>>>>>          > >
>>>>>>>>          > >
>>>>>>>>          > > 2017-01-12 20:03 GMT-01:00 Eric Carr <carr at nimbios.org
>>>>>>>>          <mailto:carr at nimbios.org>>:
>>>>>>>>          > >
>>>>>>>>          > > > Generically independent of R, A graph and the
>>>>>>>>          connectivity between points
>>>>>>>>          > > > needs defined before a shortest path algorithm can be
>>>>>>>>          applied.  If it
>>>>>>>>          > > > assumes all points are connected, than the shortest
>>>>>>>>
>>>>>>> path
>>>>>>>
>>>>>>>>          will be a
>>>>>>>>          > > straight
>>>>>>>>          > > > line.  What you are looking for is some sort of
>>>>>>>>
>>>>>>> minimum
>>>>>>>
>>>>>>>>          spanning tree
>>>>>>>>          > > for
>>>>>>>>          > > > the vertices.
>>>>>>>>          > > > Eric
>>>>>>>>          > > >
>>>>>>>>          > > > On Thu, Jan 12, 2017 at 11:17 AM, marta azores
>>>>>>>>          <martazores at gmail.com <mailto:martazores at gmail.com>>
>>>>>>>>          > > > wrote:
>>>>>>>>          > > >
>>>>>>>>          > > >> Dear forum members,
>>>>>>>>          > > >>
>>>>>>>>          > > >> I would like to know how join several points with
>>>>>>>> the
>>>>>>>>          aim to track a
>>>>>>>>          > > ship.
>>>>>>>>          > > >>
>>>>>>>>          > > >> After reading the documentation of some packages, I
>>>>>>>>          decided to use the
>>>>>>>>          > > >> function shortestPath, but I only got the line
>>>>>>>> between
>>>>>>>>          the first and the
>>>>>>>>          > > >> last location of my points list. I need the complete
>>>>>>>>          survey, including
>>>>>>>>          > > also
>>>>>>>>          > > >> the middle points. I try a loop to build the survey
>>>>>>>> of
>>>>>>>>          the boats using
>>>>>>>>          > > >> their locations, but It didn't work to me.
>>>>>>>>          > > >>
>>>>>>>>          > > >>
>>>>>>>>          > > >> Any idea?
>>>>>>>>          > > >>
>>>>>>>>          > > >> Thanks in advance,
>>>>>>>>          > > >>
>>>>>>>>          > > >> Marta
>>>>>>>>          > > >>
>>>>>>>>          > > >> #script# it's also attached in a R.file: question
>>>>>>>>
>>>>>>> loop2.R
>>>>>>>
>>>>>>>>          > > >> ##############################
>>>>>>>>
>>>>>>> ############################
>>>>>>>
>>>>>>>>          > > >> #
>>>>>>>>          > > >> #raster# it's attached
>>>>>>>>          > > >> azoTS1<- raster("C:/Users/Documents/azo
>>>>>>>>
>>>>>>> TS1.tif")#wgs84
>>>>>>>
>>>>>>>>          > > >> #
>>>>>>>>          > > >> #10 points# it's attached
>>>>>>>>          > > >> boat <- read.table("C:/Users/Documents
>>>>>>>> /10pontos.csv",
>>>>>>>>          header=TRUE,
>>>>>>>>          > > >> sep=",", na.strings="NA", dec=".",
>>>>>>>> strip.white=TRUE)#
>>>>>>>>          > > >> head(boat)
>>>>>>>>          > > >>
>>>>>>>>          > > >> #raster to transitionlayer
>>>>>>>>          > > >> trCostS4<- transition(1/azoTS1, mean, directions=4)
>>>>>>>>          > > >>
>>>>>>>>          > > >> # points to spatialpointsdataframe
>>>>>>>>          > > >> x=boat$Long1
>>>>>>>>          > > >> y=boat$Lat1
>>>>>>>>          > > >> coords = cbind(x, y)
>>>>>>>>          > > >> plot(coords)
>>>>>>>>          > > >> sp = SpatialPoints(coords,
>>>>>>>>          proj4string=CRS("+proj=longlat +ellps=WGS84
>>>>>>>>          > > >> +datum=WGS84"), bbox = NULL)
>>>>>>>>          > > >> sp
>>>>>>>>          > > >> spdf=SpatialPointsDataFrame(sp,boat)
>>>>>>>>          > > >> spdf
>>>>>>>>          > > >> nrow(spdf)
>>>>>>>>          > > >> plot(sp,axes=TRUE)
>>>>>>>>          > > >> plot(spdf,add=TRUE, axes=TRUE)
>>>>>>>>          > > >>
>>>>>>>>          > > >> #shortestpath
>>>>>>>>          > > >>
>>>>>>>>          > > >> ## 1) this script only join the first point of the
>>>>>>>>
>>>>>>> list
>>>>>>>
>>>>>>>>          and the last
>>>>>>>>          > > one,
>>>>>>>>          > > >> and the points in the middle are not used.
>>>>>>>>          > > >> CostpathSPdf <- shortestPath(trCostS4, spdf[1,],
>>>>>>>>
>>>>>>> spdf[10,],
>>>>>>>
>>>>>>>>          > > >> output="SpatialLines")
>>>>>>>>          > > >> plot(CostpathSPdf,add=TRUE,axe
>>>>>>>>
>>>>>>> s=TRUE,col=2)#R_plot1.png
>>>>>>>
>>>>>>>>          (it's attached)
>>>>>>>>          > > >>
>>>>>>>>          > > >> ## 2) this script didn't work to me
>>>>>>>>          > > >>
>>>>>>>>          > > >> #first way from website:
>>>>>>>>
>>>>>>> http://stackoverflow.com/quest
>>>>>>>
>>>>>>>>          > > >> ions/8127066/loop-or-sapply-fu
>>>>>>>>
>>>>>>> nction-for-multiple-least-
>>>>>>>
>>>>>>>>          > > >> cost-analysis-in-r?answertab=active#tab-top
>>>>>>>>          > > >> for(i in 1:nrow(spdf)) {
>>>>>>>>          > > >>   # Computation
>>>>>>>>          > > >>   Costpath <- shortestPath(trCostS4, spdf[i,],
>>>>>>>>
>>>>>>> spdf[10,],
>>>>>>>
>>>>>>>>          > > >> output="SpatialLines")
>>>>>>>>          > > >>   plot(Costpath)
>>>>>>>>          > > >>
>>>>>>>>          > > >> }
>>>>>>>>          > > >>
>>>>>>>>          > > >> #Error in validObject(.Object) :
>>>>>>>>          > > >> #invalid class ?SpatialLines? object: bbox should
>>>>>>>>
>>>>>>> never
>>>>>>>
>>>>>>>>          contain infinite
>>>>>>>>          > > >> values
>>>>>>>>          > > >>
>>>>>>>>          > > >> _______________________________________________
>>>>>>>>          > > >> R-sig-Geo mailing list
>>>>>>>>          > > >> R-sig-Geo at r-project.org <mailto:
>>>>>>>>
>>>>>>> R-sig-Geo at r-project.org>
>>>>>>>
>>>>>>>>          > > >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>          <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>>>          > > >>
>>>>>>>>          > > >
>>>>>>>>          > > >
>>>>>>>>          > >
>>>>>>>>          > >         [[alternative HTML version deleted]]
>>>>>>>>          > >
>>>>>>>>          > > _______________________________________________
>>>>>>>>          > > R-sig-Geo mailing list
>>>>>>>>          > > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.or
>>>>>>>> g>
>>>>>>>>          > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>          <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>>>          > >
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>          > --
>>>>>>>>          > J?r?me Mathieu <http://www.jerome-mathieu.com/
>>>>>>>>          <http://www.jerome-mathieu.com/>>
>>>>>>>>          > Universit? Pierre & Marie Curie <http://www.upmc.fr/>
>>>>>>>>          > Institute of Ecology and Environmental Science (Paris)
>>>>>>>>          > <https://ieesparis.ufr918.upmc.fr/
>>>>>>>>          <https://ieesparis.ufr918.upmc.fr/>>
>>>>>>>>          > Team EERI
>>>>>>>>
>>>>>>>>          > 4 place Jussieu
>>>>>>>>          > Tour 44-45, 5th floor, door 514
>>>>>>>>          > 75005 Paris
>>>>>>>>
>>>>>>>>          > tel: 01 44 27 34 22
>>>>>>>>
>>>>>>>>          >    [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>>          > _______________________________________________
>>>>>>>>          > R-sig-Geo mailing list
>>>>>>>>
>>>>>>> <http://www.jerome-mathieu.com/>>         > R-sig-Geo at r-project.org
>>>>>>> <mailto:R-sig-Geo at r-project.org>
>>>>>>>
>>>>>>>>          > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>          <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>
>>>>>>>          [[alternative HTML version deleted]]
>>>>>>>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>> <R-sig-Geo at r-project.org> <R-sig-Geo at r-project.org>
>>>>>>> <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>> <R-sig-Geo at r-project.org> <carr at nimbios.org>
>>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing listR-sig-Geo at r-project.orghttps://
>>>>> stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>> --
>>>>> Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of
>>>>> Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032
>>>>> Marburg, fon: ++49.(0)6421.2824296 <+49%206421%202824296>, fax:
>>>>> ++49.(0)6421.2828950 <+49%206421%202828950>, web: gis-ma.org,
>>>>> giswerk.org, moc.environmentalinformatics-marburg.de
>>>>>
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of
> Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032
> Marburg, fon: ++49.(0)6421.2824296, fax: ++49.(0)6421.2828950, web:
> gis-ma.org, giswerk.org, moc.environmentalinformatics-marburg.de
>
>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Thu Feb  9 18:21:44 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 9 Feb 2017 11:21:44 -0600
Subject: [R-sig-Geo] [FORGED] Selecting spatial points within spatial
	line segments
In-Reply-To: <37bcdc50-78ef-bd79-cd9c-00d1214a4b8f@auckland.ac.nz>
References: <CABkCotSGa2CJcWemt40cijc2D=szo5C0O1hUBWQK_=jef2+J_A@mail.gmail.com>
	<37bcdc50-78ef-bd79-cd9c-00d1214a4b8f@auckland.ac.nz>
Message-ID: <CABkCotQTvxMDKCzm887OS9T3YaSYd-oaP=f-okL5ix7cv46RYA@mail.gmail.com>

Thank you very much Rolf.

Manuel

2017-02-08 17:06 GMT-06:00 Rolf Turner <r.turner at auckland.ac.nz>:

> On 09/02/17 02:56, Manuel Sp?nola wrote:
>
>> Dear list members,
>>
>> I have a spatial line (a road) segmented in 500-meters segments.  I also
>> have spatial points (roadkills) and I want to select the points related to
>> each segment in the line.  The points do not touch (intersect) the line,
>> but are close to it. How can I do this in R?
>>
>
>
> The project2segment() function from the spatstat package will probably do
> what you want.
>
> cheers,
>
> Rolf Turner
>
> --
> Technical Editor ANZJS
> Department of Statistics
> University of Auckland
> Phone: +64-9-373-7599 ext. 88276
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Fri Feb 10 03:03:45 2017
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 10 Feb 2017 02:03:45 +0000
Subject: [R-sig-Geo] "invalid" geometries in shape data
In-Reply-To: <CAASFQpRFGZU6PL_2edmDND9G5gHTAvxyroN95RFci+gHkd3BDQ@mail.gmail.com>
References: <CAAcGz9_Ta=39Zpt5=gbLb3+Muu1sG6A83uriNs4A1tix-eiBSA@mail.gmail.com>
	<CANVKczP1R1-OpGMa8pzSksp1kh6Zn-hqWFKNBmnY9ZqpeLf+7g@mail.gmail.com>
	<CAASFQpRFGZU6PL_2edmDND9G5gHTAvxyroN95RFci+gHkd3BDQ@mail.gmail.com>
Message-ID: <CAAcGz9_P7EOmvLSdTm5i7dntwjf6yU2ncAOToAb2p72Zf7p9fw@mail.gmail.com>

On Thu, Feb 9, 2017, 11:34 chris english <englishchristophera at gmail.com>
wrote:

> Michael,
>
> I'll forward to rgis/toposhop/issues some 'flat' triangles (i.e.
> co-linear) that come up in my neuro
> data. Even Roualt says that TRIANGLE will be in GDAL 2.2 release in May
> and has been
> wrestling with it since Nov/Dec last.
>
> PostGIS tests first three points of polygon for co-linearity but doesn't
> detail precision,
> presumably at level provided. stryk seems generally pragmatic in these
> things. Even was
> miffed in a Dec tweet about triangle having four points (.."and its called
> Simple Features),
> but coming where it does in the polygon hierarchy, it is going to be
> closed.
>

Thanks Chris, appreciate the pointers.

Simple features is a bit silly for sure, but it does have a strict logic
for path-based geometry and it fits the very fast special case
optimizations that are available to planar operations.

It's just a shame that GIS has no higher standard to at least aim for, but
there's a convergence on the horizon for many disparate projects that have
broken the mould. Most of them have to one way or another for real data,
note the dozens of track or GPS data packages on CRAN, they have no common
foundation but usually express much overlapping logic).

GIS logic with multiple levels of grouping are easy for database
techniques, and computer graphics array indexing and primitives can be
expressed as tables with no problems. I think R is better suited than many
platforms for designing a better standard but there's no consistent
discussion around this or even wide recognition that there is any problem.

If you know of discussions I'd appreciate any connections. I will follow up
what you've added here.

Fwiw, it seems rgeos::gBuffer(x, width = 0) will fix many problems (thanks
Barry). The machinery that decomposes a feature and rebuilds it again in
value form is something that should be a standalone tool. That's something
that I will pursue from this.

Cheers, Mike


> geophys::TriangleInfo tests for co-linearity using sign of determinant
> through the dt function,
> though determinant (proper) would likely be quicker for evaluating lots of
> them as it is direct call to
> .Internal.
>
> I am still trying to wrap my head around RTriangle. I think it must be
> sturdy for triangle(s), but in
> some sense its goal of mesh propagation upon/within a polygon system is
> seemingly time travel
> compared to my 'this thing is a triangle, aren't it?" None of the methods
> I've seen so far seem to test
> for 'no internal boundary', including CGAL. And none of this addresses
> 'automatic fixing tool' that
> you or Delft suggests.
>
> My data, from the wild, seems amenable to a jitter after a test by either
> atan2 or determinant to
> establish candidates for jittering. determinant seems like it would work
> best with sf approach to
> st_geometry(sfc) as they are lists and one can discern, following geophys'
> approach building out
> (adding 1s to a 3rd col of) a 2x4 triangle/polygon matrix to 3x4 and
> evaluating on first 3x3 square.
>
> I've said as much as I know to this point, triangles are coming.
>
> Chris
>
> On Wed, Feb 8, 2017 at 1:47 PM, Barry Rowlingson <
> b.rowlingson at lancaster.ac.uk> wrote:
>
> Searching GIS StackExchange for [r] and TopologyException might find you a
> few:
>
> http://gis.stackexchange.com/search?q=%5Br%5D+topologyexception
>
> [answered one of these just today:
>
> http://gis.stackexchange.com/questions/227569/r-error-fortifying-dataframe-from-shapefile
> ]
>
> Barry
>
> On Tue, Feb 7, 2017 at 9:46 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> > Hi,
> >
> > I'm interested in exploring the details of kinds of errors and warnings
> > that are seen from the underlying geometry lib (GEOS) for spatial data in
> > R.
> >
> > I would like to also have a collection of  examples with actual data and
> > reproducible code.
> >
> > (The underlying theory and definitions and source code are all open and
> > available, I'm looking for examples).
> >
> > The kinds of errors I'm talking about come from the GEOS library under
> the
> > hood, and this is more or less the same in the sp/rgdal as well as the
> new
> > sf family.
> >
> > Here's one example, this data set is not valid because of at least one
> > "polygon self intersection", basically the ring winds back on itself:
> >
> > library(maptools)
> > data(wrld_simpl)
> > rgeos::gIsValid(wrld_simpl)
> > [1] FALSE
> > Warning message:
> > In RGEOSUnaryPredFunc(spgeom, byid, "rgeos_isvalid") :
> >   Ring Self-intersection at or near point -95.902496339999999
> > 66.946641920000005
> >
> > I'd appreciate if you could send me similar examples, preferably
> > reproducible with code but links to existing emails and online posts are
> > welcome too. Feel free to construct examples from scratch that reproduce
> a
> > particular warning/error.
> >
> > If you like, you can use the Github Issues mechanism here, or just email
> > them in reply.
> >
> > https://github.com/r-gris/toposhop/issues
> >
> > Cheers, Mike.
> >
> >
> > --
> > Dr. Michael Sumner
> > Software and Database Engineer
> > Australian Antarctic Division
> > 203 Channel Highway
> > Kingston Tasmania 7050 Australia
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> --
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From tristan.bourgeois at gmail.com  Fri Feb 10 14:21:41 2017
From: tristan.bourgeois at gmail.com (Tristan Bourgeois)
Date: Fri, 10 Feb 2017 14:21:41 +0100
Subject: [R-sig-Geo] Creating points along polylines
Message-ID: <CACNjsfWFupYVhDsEXj4XnvS5wiL8qb_zq=COe7bydabUG7Z5Gw@mail.gmail.com>

Dear all,

I'm looking for a way to create points along polylines in 2 different cases
:

- First case :

I want to create points along  2 polyline layers (hydrographic network)
with a step between each point of *x *meters (as the QGIs pluggin "Locate
points along lines" is able to do)

Then, for these two "Points layers" I want to join the created points from
one layer to the nearest points of the other one (as the  QGIs pluggin
"MMGIS / HubDistance" does so)


- Second case :

I have a polyline layer (hydrographic network) which is sectionned into
several parts. I want to create points at each sections' extremities and
get teh coordinates of each of these points.

Hope my explanations are enough clear ?

Thanks in advance and have a sweet weekend !

Cheers.



-- 
Tristan Bourgeois

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Fri Feb 10 16:25:57 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Fri, 10 Feb 2017 09:25:57 -0600
Subject: [R-sig-Geo] Colors for factors in leaflet r
Message-ID: <CABkCotQ0UBQgEvz6FaUhUpfxEg3=Uqr101=jnJ_NLmLRhTouXg@mail.gmail.com>

Dear list members,

I am trying to add a legend to a leaflet map but I got the following error

data(meuse)
coordinates(meuse) <- ~x+y
proj4string(meuse) <- CRS("+init=epsg:28992")
WGS84 <- CRS("+proj=longlat +ellps=WGS84")
meuse <- spTransform(meuse, WGS84)

pal <- colorFactor(palette = c("red", "blue", "green"), levels = meuse$soil)
meuse$soil
leaflet(meuse) %>%
  addTiles() %>%
  addCircleMarkers(stroke = FALSE, fillOpacity = 1) %>%
  addLegend("topright", color = ~pal(soil), labels=c("Type 1", "Type 2",
"Type 3"), title="Soil type")

Duplicate levels detected
 Show Traceback
Error in addLegend(., "topright", color = ~pal(soil), labels = c("Type 1",
: 'colors' and 'labels' must be of the same length



Best,

Manuel

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From macqueen1 at llnl.gov  Fri Feb 10 17:32:21 2017
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Fri, 10 Feb 2017 16:32:21 +0000
Subject: [R-sig-Geo] Creating points along polylines
In-Reply-To: <CACNjsfWFupYVhDsEXj4XnvS5wiL8qb_zq=COe7bydabUG7Z5Gw@mail.gmail.com>
References: <CACNjsfWFupYVhDsEXj4XnvS5wiL8qb_zq=COe7bydabUG7Z5Gw@mail.gmail.com>
Message-ID: <37EB8D19-B7B7-451F-AB0B-A34CB7A9577B@llnl.gov>

sp::spsample can create equally spaced points along lines

I don't know if there's a function that will directly find the nearest points between two layers, but if necessary you can program it yourself, possibly starting with spatstat::crossdist to calculate the distances.

More generally, I would look into the rgeos and spatstat packages. And visit the CRAN spatial task view; that might lead you to additional packages.

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062


On 2/10/17, 5:21 AM, "R-sig-Geo on behalf of Tristan Bourgeois" <r-sig-geo-bounces at r-project.org on behalf of tristan.bourgeois at gmail.com> wrote:

    Dear all,
    
    I'm looking for a way to create points along polylines in 2 different cases
    :
    
    - First case :
    
    I want to create points along  2 polyline layers (hydrographic network)
    with a step between each point of *x *meters (as the QGIs pluggin "Locate
    points along lines" is able to do)
    
    Then, for these two "Points layers" I want to join the created points from
    one layer to the nearest points of the other one (as the  QGIs pluggin
    "MMGIS / HubDistance" does so)
    
    
    - Second case :
    
    I have a polyline layer (hydrographic network) which is sectionned into
    several parts. I want to create points at each sections' extremities and
    get teh coordinates of each of these points.
    
    Hope my explanations are enough clear ?
    
    Thanks in advance and have a sweet weekend !
    
    Cheers.
    
    
    
    -- 
    Tristan Bourgeois
    
    	[[alternative HTML version deleted]]
    
    _______________________________________________
    R-sig-Geo mailing list
    R-sig-Geo at r-project.org
    https://stat.ethz.ch/mailman/listinfo/r-sig-geo
    


From jschuetz at Gmri.org  Sat Feb 11 17:47:07 2017
From: jschuetz at Gmri.org (Justin Schuetz)
Date: Sat, 11 Feb 2017 16:47:07 +0000
Subject: [R-sig-Geo] Implementing and interpreting join count analysis
 with spdep
In-Reply-To: <alpine.LFD.2.20.1702090933430.12547@reclus.nhh.no>
References: <CY4PR04MB0326B2FBC5BB1FF8EF05BFB2B3430@CY4PR04MB0326.namprd04.prod.outlook.com>,
	<alpine.LFD.2.20.1702071812230.28808@reclus.nhh.no>
	<CY4PR04MB03263979462490DA654EAD0AB3430@CY4PR04MB0326.namprd04.prod.outlook.com>,
	<alpine.LFD.2.20.1702090933430.12547@reclus.nhh.no>
Message-ID: <CY4PR04MB03265866A79AADFA9879A3FAB3470@CY4PR04MB0326.namprd04.prod.outlook.com>

Roger,


Thank you. This helps and gives me some more things to think about!


Cheers,


Justin

________________________________
From: Roger Bivand <Roger.Bivand at nhh.no>
Sent: Thursday, February 9, 2017 3:47:30 AM
To: Justin Schuetz
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Implementing and interpreting join count analysis with spdep

On Tue, 7 Feb 2017, Justin Schuetz wrote:

> Roger,
>
>
> Thanks for the leads. Is the general concern about including large
> numbers of neighbors that there may not really be any relationship
> between "very" distant points and that Type II errors will become more
> likely in a hypothesis testing framework?

No, two issues here.

One is that the data generation process involves not (I - \rho W) but
either (I - \rho W)^{-1} (CAR) or (I - \rho W)^{-1} (I - \rho W^T)^{-1}
(SAR), so is dense anyway. Under certain assumptions, (I - \rho W)^{-1} is
\sum_{i=0}^{Inf} (\rho W)^i, so the sum of a power series in the
autoregressive coefficient \rho and the spatial weights. So if W are only
contiguous neighbours, W %*% W are neighbours of neighbours, and so on. So
including all neighbours in W, even with inverse distance weighting,
"double-guesses" the form of the relationship. Most of these measures came
into being anyway for areal support rather than point support - the name
"join-count" tells us this.

The other is that the tests only make sense if we are confident that the
join counts are not being influenced by our partitioning of the surface
(or choice of points), nor by omitted variables. It could be that the join
counts are more related to elevation or temperature (say) than to being
neighbours - think of this as residuals from a regression (multinomial
here). Which join counts would we expect to see after taking into account
what we know about the drivers of the multinomial response?

Roger

>
>
> Justin
>
>
> ________________________________
> From: Roger Bivand <Roger.Bivand at nhh.no>
> Sent: Tuesday, February 7, 2017 12:19 PM
> To: Justin Schuetz
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Implementing and interpreting join count analysis with spdep
>
> On Tue, 7 Feb 2017, Justin Schuetz wrote:
>
>> List members,
>>
>> I am trying to assess whether points of the same color are spatially
>> autocorrelated. I have limited familiarity with spdep and join count
>> analyses and would like to confirm that I am implementing and
>> interpreting the analysis correctly. Below is a summary of the data,
>> code used in the analysis, results, and my quick interpretation. If
>> someone familiar with this type of analysis (or alternatives that are
>> better able to address the question) could offer feedback, I would
>> greatly appreciate it...particularly if you can help me understand how
>> best to choose the style parameter in nb2listw function.
>>
>> Many thanks,
>>
>> Justin
>>
>> ##### POINT DATA
>>
>> my.points
>> # A tibble: 50 ? 4
>>   SVSPP JGS.UTM.X JGS.UTM.Y JGS.COLOR
>>   <int>     <dbl>     <dbl>     <int>
>> 1     13 -14272.27   4035288         3
>> 2     15 265382.54   4398047         3
>> 3     22 552678.02   4537646         3
>> 4     23 430904.66   4524648         3
>> 5     24 -43587.79   4050674         3
>> 6     25  67560.06   4190581         3
>> 7     26 326773.57   4488521         3
>> 8     27 578645.44   4735815         3
>> 9     28 533183.23   4722559         3
>> 10    33 368053.13   4566608         3
>> # ... with 40 more rows
>>
>> ##### CODE
>>
>> # make SpatialPoints object and specify projection
>>
>> coords <- my.points[, c("JGS.UTM.X", "JGS.UTM.Y")]
>> UTM19N <- "+proj=utm +zone=19 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
>> lat.lon <- SpatialPoints(coords, CRS(UTM19N))
>>
>> # generate spatial weights matrix (inverse distance weighting among all
>> points)
>
> At this point you are probably deciding the outcome of the tests -
> different weights will give different outcomes. The fewer neighbours the
> better is a good rule, otherwise the relationships may be heavily
> smoothed. See vignette("nb").
>
>>
>> my.k.neighbors <- knearneigh(lat.lon, k = length(lat.lon) - 1, longlat = FALSE)
>> my.neighbors <- knn2nb(my.k.neighbors)
>> my.distances <- nbdists(my.neighbors, lat.lon)
>> my.weights <- lapply(my.distances, function(x) 1/(x))
>> my.list <- nb2listw(my.neighbors, glist = my.weights, style = "S")
>>
>> # identify colors
>>
>> my.colors <- as.factor(my.points$JGS.COLOR)
>>
>> # assess whether similar colors are closer to each other than expected
>> # by chance given fixed point locations
>
> It is also possible to use joincount.multi() to compare all with all (here
> 1-1, 1-2, 1-3, 2-2, 2-3, 3-3), rather than 1 with not-1 and so on. Also
> look at alternative=, as your 3-3 looks close to significant negative
> autocorrelation (for your preferred weights).
>
> Roger
>
>>
>> joincount.mc(my.colors, my.list, nsim = 1000)
>>
>> ##### RESULTS
>>
>>        Monte-Carlo simulation of join-count statistic
>>
>> data:  my.colors
>> weights: my.list
>> number of simulations + 1: 1001
>>
>> Join-count statistic for 1 = 0.2037, rank of observed statistic = 987,
>> p-value = 0.01399
>> alternative hypothesis: greater
>> sample estimates:
>>    mean of simulation variance of simulation
>>           0.061423025            0.001758675
>>
>>
>>        Monte-Carlo simulation of join-count statistic
>>
>> data:  my.colors
>> weights: my.list
>> number of simulations + 1: 1001
>>
>> Join-count statistic for 2 = 0.076401, rank of observed statistic = 754,
>> p-value = 0.2468
>> alternative hypothesis: greater
>> sample estimates:
>>    mean of simulation variance of simulation
>>           0.060196719            0.001639431
>>
>>
>>        Monte-Carlo simulation of join-count statistic
>>
>> data:  my.colors
>> weights: my.list
>> number of simulations + 1: 1001
>>
>> Join-count statistic for 3 = 19.002, rank of observed statistic = 36,
>> p-value = 0.964
>> alternative hypothesis: greater
>> sample estimates:
>>    mean of simulation variance of simulation
>>            19.3165692              0.0451797
>>
>> ##### INTERPRETATION
>>
>> Points with color "1" are closer to each other than expected by chance, whereas there is
>> little evidence that points with colors "2" (or "3") are spatially autocorrelated.
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/444584
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/444584

	[[alternative HTML version deleted]]


From HodgessE at uhd.edu  Sat Feb 11 20:48:30 2017
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sat, 11 Feb 2017 19:48:30 +0000
Subject: [R-sig-Geo] a recommendation for a large spatial data set, please
Message-ID: <1486842510618.96658@uhd.edu>

Hello everyone.


Hope you are having a great weekend.


Could anyone recommend a nice spatial data set with about 15-20K observations please?  I'm testing out some functions and programs and need to check with a large set.


Free is good, too.


Thanks,

Erin



Erin M. Hodgess
Associate Professor
Department of Mathematics and Statistics
University of Houston - Downtown
mailto: hodgesse at uhd.edu

	[[alternative HTML version deleted]]


From HodgessE at uhd.edu  Sat Feb 11 21:15:38 2017
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sat, 11 Feb 2017 20:15:38 +0000
Subject: [R-sig-Geo] a recommendation for a large spatial data set,
	please
In-Reply-To: <1486842510618.96658@uhd.edu>
References: <1486842510618.96658@uhd.edu>
Message-ID: <1486844138522.19098@uhd.edu>

I found a perfect one in the plotKML package; the USAWgrids data.

Thanks,
Erin



Erin M. Hodgess
Associate Professor
Department of Mathematics and Statistics
University of Houston - Downtown
mailto: hodgesse at uhd.edu

________________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Hodgess, Erin <HodgessE at uhd.edu>
Sent: Saturday, February 11, 2017 1:48 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] a recommendation for a large spatial data set, please

Hello everyone.


Hope you are having a great weekend.


Could anyone recommend a nice spatial data set with about 15-20K observations please?  I'm testing out some functions and programs and need to check with a large set.


Free is good, too.


Thanks,

Erin



Erin M. Hodgess
Associate Professor
Department of Mathematics and Statistics
University of Houston - Downtown
mailto: hodgesse at uhd.edu

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From robertomhorn at gmail.com  Sun Feb 12 02:34:54 2017
From: robertomhorn at gmail.com (Roberto Horn)
Date: Sat, 11 Feb 2017 23:34:54 -0200
Subject: [R-sig-Geo] Package to download Landsat images
Message-ID: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>

I`m looking for a package that enables me to download Landsat images
automatically based in some criteria (e.g. coordinate, shapefile,
cloud cover).

Searching the internet I found
https://github.com/olivierhagolle/LANDSAT-Download/ but the code is in
python.

Thanks

With best regards


From thi_veloso at yahoo.com.br  Sun Feb 12 07:41:18 2017
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Sun, 12 Feb 2017 06:41:18 +0000 (UTC)
Subject: [R-sig-Geo] Calculate anomalies on time-series rasters
References: <923688136.2641564.1486881678233.ref@mail.yahoo.com>
Message-ID: <923688136.2641564.1486881678233@mail.yahoo.com>

Dear all,

I have a netcdf file with monthly temperatures values covering the period of January 1961 to December 2010:

library(raster)
# Create date sequence
idx = seq(as.Date("1961/1/1"), as.Date("2010/12/31"), by = "month")

# Create raster stack and assign dates
r = raster(ncol=5, nrow=5)
s = stack(lapply(1:length(idx), function(x) setValues(r, runif(ncell(r)))))
s = setZ(s, idx)

First, let's consider only the period from 1961-1990 and take the global monthly means (aka climatologies)

# Split 1961-1990 period and take climatology
s61.90 = subset(s, which(getZ(s)>=as.Date('1961-01-01') & getZ(s)<=as.Date('1990-12-31')))
s61.90.mon = zApply(s61.90, by=months, mean, name=month.abb[])

s61.90.mon is a raster with 12 layers, one for each monthly mean temperature.

Now what I need to do is calculate the monthly 'anomaly' for the remainder period (Jan 1991 to Dev 2010), i.e. the difference of a single month of the period from the corresponding month in the climatological mean.

# Here I split the remainder of the time series (1991 to 2010)
s91.2010 = subset(s, which(getZ(s)>=as.Date('1991-01-01') & getZ(s)<=as.Date('2010-12-31')))

In other words, I need to subtract 'jan' in the raster s.61.90.mon from every 'jan' in the raster s91.2010, and so on for every other month.


I was wondering what is the best way to do that using raster (and possibly zoo) functions?

Thank you very much in advance, -- Thiago V. dos Santos

PhD candidate
Land and Atmospheric Science
University of Minnesota


From mdsumner at gmail.com  Sun Feb 12 10:14:16 2017
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 12 Feb 2017 09:14:16 +0000
Subject: [R-sig-Geo] Calculate anomalies on time-series rasters
In-Reply-To: <923688136.2641564.1486881678233@mail.yahoo.com>
References: <923688136.2641564.1486881678233.ref@mail.yahoo.com>
	<923688136.2641564.1486881678233@mail.yahoo.com>
Message-ID: <CAAcGz99pgHYQ1M_N=MGZoKT6PLUOacyFVP-ycAZRYZjXqvMu6A@mail.gmail.com>

I believe the "remote" package has functions for doing exactly this.

HTH

On Sun, Feb 12, 2017, 17:42 Thiago V. dos Santos via R-sig-Geo <
r-sig-geo at r-project.org> wrote:

> Dear all,
>
> I have a netcdf file with monthly temperatures values covering the period
> of January 1961 to December 2010:
>
> library(raster)
> # Create date sequence
> idx = seq(as.Date("1961/1/1"), as.Date("2010/12/31"), by = "month")
>
> # Create raster stack and assign dates
> r = raster(ncol=5, nrow=5)
> s = stack(lapply(1:length(idx), function(x) setValues(r, runif(ncell(r)))))
> s = setZ(s, idx)
>
> First, let's consider only the period from 1961-1990 and take the global
> monthly means (aka climatologies)
>
> # Split 1961-1990 period and take climatology
> s61.90 = subset(s, which(getZ(s)>=as.Date('1961-01-01') &
> getZ(s)<=as.Date('1990-12-31')))
> s61.90.mon = zApply(s61.90, by=months, mean, name=month.abb[])
>
> s61.90.mon is a raster with 12 layers, one for each monthly mean
> temperature.
>
> Now what I need to do is calculate the monthly 'anomaly' for the remainder
> period (Jan 1991 to Dev 2010), i.e. the difference of a single month of the
> period from the corresponding month in the climatological mean.
>
> # Here I split the remainder of the time series (1991 to 2010)
> s91.2010 = subset(s, which(getZ(s)>=as.Date('1991-01-01') &
> getZ(s)<=as.Date('2010-12-31')))
>
> In other words, I need to subtract 'jan' in the raster s.61.90.mon from
> every 'jan' in the raster s91.2010, and so on for every other month.
>
>
> I was wondering what is the best way to do that using raster (and possibly
> zoo) functions?
>
> Thank you very much in advance, -- Thiago V. dos Santos
>
> PhD candidate
> Land and Atmospheric Science
> University of Minnesota
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From patrick.schratz at gmail.com  Sun Feb 12 11:21:46 2017
From: patrick.schratz at gmail.com (Patrick Schratz)
Date: Sun, 12 Feb 2017 11:21:46 +0100
Subject: [R-sig-Geo] Package to download Landsat images
In-Reply-To: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>
References: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>
Message-ID: <d28b9a65-5067-4f5b-ac1a-baaec0b786f6@Spark>

Did you check the 'landsat' / 'landsat8' Packages?

--
PhD Student at Department of Geography - GIScience group
Friedrich-Schiller-University Jena, Germany
Tel.: +49-3641-9-48973 (tel:+49-3641-9-48973)
Web: https://pat-s.github.io/

On 12 Feb 2017, 02:35 +0100, Roberto Horn <robertomhorn at gmail.com>, wrote:
> I`m looking for a package that enables me to download Landsat images
> automatically based in some criteria (e.g. coordinate, shapefile,
> cloud cover).
>
> Searching the internet I found
> https://github.com/olivierhagolle/LANDSAT-Download/ but the code is in
> python.
>
> Thanks
>
> With best regards
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From amsantac at hotmail.com  Sun Feb 12 14:48:07 2017
From: amsantac at hotmail.com (Ali Santacruz)
Date: Sun, 12 Feb 2017 13:48:07 +0000
Subject: [R-sig-Geo] Package to download Landsat images
In-Reply-To: <d28b9a65-5067-4f5b-ac1a-baaec0b786f6@Spark>
References: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>,
	<d28b9a65-5067-4f5b-ac1a-baaec0b786f6@Spark>
Message-ID: <MWHPR10MB18727FEF5A02E4F79843918FC9460@MWHPR10MB1872.namprd10.prod.outlook.com>


Also take a look at the SkyWatchr (https://cran.r-project.org/package=SkyWatchr) package,


Regards,


Ali

________________________________
De: R-sig-Geo <r-sig-geo-bounces at r-project.org> en nombre de Patrick Schratz <patrick.schratz at gmail.com>
Enviado: domingo, 12 de febrero de 2017 05:21:46 a. m.
Para: r-sig-geo at r-project.org; Roberto Horn
Asunto: Re: [R-sig-Geo] Package to download Landsat images

Did you check the 'landsat' / 'landsat8' Packages?

--
PhD Student at Department of Geography - GIScience group
Friedrich-Schiller-University Jena, Germany
Tel.: +49-3641-9-48973 (tel:+49-3641-9-48973)
Web: https://pat-s.github.io/

On 12 Feb 2017, 02:35 +0100, Roberto Horn <robertomhorn at gmail.com>, wrote:
> I`m looking for a package that enables me to download Landsat images
> automatically based in some criteria (e.g. coordinate, shapefile,
> cloud cover).
>
> Searching the internet I found
> https://github.com/olivierhagolle/LANDSAT-Download/ but the code is in
> python.
>
> Thanks
>
> With best regards
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From joseph.stachelek at gmail.com  Sun Feb 12 15:40:32 2017
From: joseph.stachelek at gmail.com (Joseph Stachelek)
Date: Sun, 12 Feb 2017 09:40:32 -0500
Subject: [R-sig-Geo] Package to download Landsat images
In-Reply-To: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>
References: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>
Message-ID: <1486910432.3985.0.camel@gmail.com>

Hi Roberto,

You might try the getlandsat package:?
https://github.com/ropenscilabs/getlandsat

On Sat, 2017-02-11 at 23:34 -0200, Roberto Horn wrote:
> I`m looking for a package that enables me to download Landsat images
> automatically based in some criteria (e.g. coordinate, shapefile,
> cloud cover).
> 
> Searching the internet I found
> https://github.com/olivierhagolle/LANDSAT-Download/ but the code is
> in
> python.
> 
> Thanks
> 
> With best regards
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From kent3737 at gmail.com  Sun Feb 12 18:53:32 2017
From: kent3737 at gmail.com (Kent Johnson)
Date: Sun, 12 Feb 2017 12:53:32 -0500
Subject: [R-sig-Geo] Colors for factors in leaflet r
Message-ID: <CAPP0wyhy62zzWpOFUYofcmA38Hb0ufhmvb2eusSoB=rW0S9Uvw@mail.gmail.com>

I think you want this:

pal <- colorFactor(palette = c("red", "blue", "green"), levels =
levels(meuse$soil))
leaflet(meuse) %>%
  addTiles() %>%
  addCircleMarkers(stroke = FALSE, fillOpacity = 1, color = ~pal(soil)) %>%
  addLegend("topright", pal, values=~soil, labels=c("Type 1", "Type 2",
"Type 3"), title="Soil type")

Kent


> From: Manuel Sp?nola <mspinola10 at gmail.com>
> To: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Subject: [R-sig-Geo] Colors for factors in leaflet r
>
> I am trying to add a legend to a leaflet map but I got the following error
>
> data(meuse)
> coordinates(meuse) <- ~x+y
> proj4string(meuse) <- CRS("+init=epsg:28992")
> WGS84 <- CRS("+proj=longlat +ellps=WGS84")
> meuse <- spTransform(meuse, WGS84)
>
> pal <- colorFactor(palette = c("red", "blue", "green"), levels =
> meuse$soil)
> meuse$soil
> leaflet(meuse) %>%
>   addTiles() %>%
>   addCircleMarkers(stroke = FALSE, fillOpacity = 1) %>%
>   addLegend("topright", color = ~pal(soil), labels=c("Type 1", "Type 2",
> "Type 3"), title="Soil type")

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Sun Feb 12 19:24:47 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sun, 12 Feb 2017 12:24:47 -0600
Subject: [R-sig-Geo] Colors for factors in leaflet r
In-Reply-To: <CAPP0wyhy62zzWpOFUYofcmA38Hb0ufhmvb2eusSoB=rW0S9Uvw@mail.gmail.com>
References: <CAPP0wyhy62zzWpOFUYofcmA38Hb0ufhmvb2eusSoB=rW0S9Uvw@mail.gmail.com>
Message-ID: <CABkCotSgf1s_LGLzAth+vKwC9ijTW7V1fTm1JzKDPYQTUms9ZQ@mail.gmail.com>

Thank you very much Kent.

Manuel

2017-02-12 11:53 GMT-06:00 Kent Johnson <kent3737 at gmail.com>:

> I think you want this:
>
> pal <- colorFactor(palette = c("red", "blue", "green"), levels =
> levels(meuse$soil))
> leaflet(meuse) %>%
>   addTiles() %>%
>   addCircleMarkers(stroke = FALSE, fillOpacity = 1, color = ~pal(soil)) %>%
>   addLegend("topright", pal, values=~soil, labels=c("Type 1", "Type 2",
> "Type 3"), title="Soil type")
>
> Kent
>
>
>> From: Manuel Sp?nola <mspinola10 at gmail.com>
>> To: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
>> Subject: [R-sig-Geo] Colors for factors in leaflet r
>>
>> I am trying to add a legend to a leaflet map but I got the following error
>>
>> data(meuse)
>> coordinates(meuse) <- ~x+y
>> proj4string(meuse) <- CRS("+init=epsg:28992")
>> WGS84 <- CRS("+proj=longlat +ellps=WGS84")
>> meuse <- spTransform(meuse, WGS84)
>>
>> pal <- colorFactor(palette = c("red", "blue", "green"), levels =
>> meuse$soil)
>> meuse$soil
>> leaflet(meuse) %>%
>>   addTiles() %>%
>>   addCircleMarkers(stroke = FALSE, fillOpacity = 1) %>%
>>   addLegend("topright", color = ~pal(soil), labels=c("Type 1", "Type 2",
>> "Type 3"), title="Soil type")
>
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From antonybutts at me.com  Sun Feb 12 20:30:06 2017
From: antonybutts at me.com (Antony)
Date: Sun, 12 Feb 2017 19:30:06 +0000
Subject: [R-sig-Geo] animating markers in leaflet using javascript plugins
Message-ID: <20ee01d28566$6bbd6b60$43384220$@me.com>

Dear all,

I have decided to display the output of my agent-based model using RShiny
and leaflet. i.e. agents animated moving down streets

However, I don't know javascript so I'm having trouble incorporating
javascript libraries that do this working with leaflet in R. I've checked
around the web and there's various routines and so on and tutorials on how
to do this, but nothing quite works and I'm still stuck.

I was wondering if anyone has ever done this before and would kindly be
willing to share their code or offer advice?

Many thanks in advance if anyone can help.

Best,

Antony


From loic.dutrieux at conabio.gob.mx  Mon Feb 13 00:22:36 2017
From: loic.dutrieux at conabio.gob.mx (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Sun, 12 Feb 2017 17:22:36 -0600
Subject: [R-sig-Geo] Calculate anomalies on time-series rasters
In-Reply-To: <CAAcGz99pgHYQ1M_N=MGZoKT6PLUOacyFVP-ycAZRYZjXqvMu6A@mail.gmail.com>
References: <923688136.2641564.1486881678233.ref@mail.yahoo.com>
	<923688136.2641564.1486881678233@mail.yahoo.com>
	<CAAcGz99pgHYQ1M_N=MGZoKT6PLUOacyFVP-ycAZRYZjXqvMu6A@mail.gmail.com>
Message-ID: <240dd328-9165-f88e-d679-a4a0ac605ce4@conabio.gob.mx>



On 12/02/2017 03:14, Michael Sumner wrote:
> I believe the "remote" package has functions for doing exactly this.
> 
> HTH
> 
> On Sun, Feb 12, 2017, 17:42 Thiago V. dos Santos via R-sig-Geo <
> r-sig-geo at r-project.org> wrote:
> 
>> Dear all,
>>
>> I have a netcdf file with monthly temperatures values covering the period
>> of January 1961 to December 2010:
>>
>> library(raster)
>> # Create date sequence
>> idx = seq(as.Date("1961/1/1"), as.Date("2010/12/31"), by = "month")
>>
>> # Create raster stack and assign dates
>> r = raster(ncol=5, nrow=5)
>> s = stack(lapply(1:length(idx), function(x) setValues(r, runif(ncell(r)))))
>> s = setZ(s, idx)
>>
>> First, let's consider only the period from 1961-1990 and take the global
>> monthly means (aka climatologies)
>>
>> # Split 1961-1990 period and take climatology
>> s61.90 = subset(s, which(getZ(s)>=as.Date('1961-01-01') &
>> getZ(s)<=as.Date('1990-12-31')))
>> s61.90.mon = zApply(s61.90, by=months, mean, name=month.abb[])
>>
>> s61.90.mon is a raster with 12 layers, one for each monthly mean
>> temperature.
>>
>> Now what I need to do is calculate the monthly 'anomaly' for the remainder
>> period (Jan 1991 to Dev 2010), i.e. the difference of a single month of the
>> period from the corresponding month in the climatological mean.
>>
>> # Here I split the remainder of the time series (1991 to 2010)
>> s91.2010 = subset(s, which(getZ(s)>=as.Date('1991-01-01') &
>> getZ(s)<=as.Date('2010-12-31')))
>>
>> In other words, I need to subtract 'jan' in the raster s.61.90.mon from
>> every 'jan' in the raster s91.2010, and so on for every other month.
>>
>>
>> I was wondering what is the best way to do that using raster (and possibly
>> zoo) functions?

If you're confident about the order of the layers in your rasterStacks
you could use overlay. See the note about recycling in the function help.

# lenght(x) needs to be a multiple of length(y), so that it can be recycled
# e.g. c(10, 10, 10, 10, 10, 10) - c(5, 7)
fun <- function(x, y) {
  x - y
}

annomalies <- overlay(x = s91.2010, y = s61.90.mon, fun = fun)

However, it looks like your climatologies are in alphabetic and not
chronological order, so you'll have to double check that.

Cheers,
Lo?c

>>
>> Thank you very much in advance, -- Thiago V. dos Santos
>>
>> PhD candidate
>> Land and Atmospheric Science
>> University of Minnesota
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>


From mel at mbacou.com  Mon Feb 13 04:57:51 2017
From: mel at mbacou.com (Bacou, Melanie)
Date: Sun, 12 Feb 2017 22:57:51 -0500
Subject: [R-sig-Geo] Package to download Landsat images
In-Reply-To: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>
References: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>
Message-ID: <ed7f4da0-45d5-62b3-bd44-c929c939694f@mbacou.com>

I have not tested yet, but there is an R package to interact with 2 NASA 
APIs:
- Earth Observatory Natural Event Tracker (EONET) web service
- Earth Imagery API and Earth Imagery Assets API (Landsat8)

https://github.com/Eflores89/nasadata
http://www.gis-blog.com/nasadata/

--Mel.


On 2/11/2017 8:34 PM, Roberto Horn wrote:
> I`m looking for a package that enables me to download Landsat images
> automatically based in some criteria (e.g. coordinate, shapefile,
> cloud cover).
>
> Searching the internet I found
> https://github.com/olivierhagolle/LANDSAT-Download/ but the code is in
> python.
>
> Thanks
>
> With best regards
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From robertomhorn at gmail.com  Mon Feb 13 15:53:50 2017
From: robertomhorn at gmail.com (Roberto Horn)
Date: Mon, 13 Feb 2017 12:53:50 -0200
Subject: [R-sig-Geo] Package to download Landsat images
In-Reply-To: <1486910432.3985.0.camel@gmail.com>
References: <CAG42j+M4MfNg_1St7Az7L4KREcbph1uOGWD4yow4HguV+7eXTg@mail.gmail.com>
	<1486910432.3985.0.camel@gmail.com>
Message-ID: <CAG42j+Nf5tkySXt=F4FAP_5MjVfXpOwz4JhVC8v5oQqzZK=R2g@mail.gmail.com>

Thanks for the help. I`ll adapt and use what I can.


With best regards.


From thi_veloso at yahoo.com.br  Mon Feb 13 18:08:38 2017
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Mon, 13 Feb 2017 17:08:38 +0000 (UTC)
Subject: [R-sig-Geo] Calculate anomalies on time-series rasters
In-Reply-To: <240dd328-9165-f88e-d679-a4a0ac605ce4@conabio.gob.mx>
References: <923688136.2641564.1486881678233.ref@mail.yahoo.com>
	<923688136.2641564.1486881678233@mail.yahoo.com>
	<CAAcGz99pgHYQ1M_N=MGZoKT6PLUOacyFVP-ycAZRYZjXqvMu6A@mail.gmail.com>
	<240dd328-9165-f88e-d679-a4a0ac605ce4@conabio.gob.mx>
Message-ID: <989443705.3473096.1487005718798@mail.yahoo.com>

Thanks for the input, Michael and Loic.

It looks like remote's "anomalize" might work, but the overlay approach was more convenient to use based on the shape of my data.
 
Greetings,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota



On Sunday, February 12, 2017 5:24 PM, Lo?c Dutrieux <loic.dutrieux at conabio.gob.mx> wrote:


On 12/02/2017 03:14, Michael Sumner wrote:
> I believe the "remote" package has functions for doing exactly this.
> 
> HTH
> 
> On Sun, Feb 12, 2017, 17:42 Thiago V. dos Santos via R-sig-Geo <
> r-sig-geo at r-project.org> wrote:
> 
>> Dear all,
>>
>> I have a netcdf file with monthly temperatures values covering the period
>> of January 1961 to December 2010:
>>
>> library(raster)
>> # Create date sequence
>> idx = seq(as.Date("1961/1/1"), as.Date("2010/12/31"), by = "month")
>>
>> # Create raster stack and assign dates
>> r = raster(ncol=5, nrow=5)
>> s = stack(lapply(1:length(idx), function(x) setValues(r, runif(ncell(r)))))
>> s = setZ(s, idx)
>>
>> First, let's consider only the period from 1961-1990 and take the global
>> monthly means (aka climatologies)
>>
>> # Split 1961-1990 period and take climatology
>> s61.90 = subset(s, which(getZ(s)>=as.Date('1961-01-01') &
>> getZ(s)<=as.Date('1990-12-31')))
>> s61.90.mon = zApply(s61.90, by=months, mean, name=month.abb[])
>>
>> s61.90.mon is a raster with 12 layers, one for each monthly mean
>> temperature.
>>
>> Now what I need to do is calculate the monthly 'anomaly' for the remainder
>> period (Jan 1991 to Dev 2010), i.e. the difference of a single month of the
>> period from the corresponding month in the climatological mean.
>>
>> # Here I split the remainder of the time series (1991 to 2010)
>> s91.2010 = subset(s, which(getZ(s)>=as.Date('1991-01-01') &
>> getZ(s)<=as.Date('2010-12-31')))
>>
>> In other words, I need to subtract 'jan' in the raster s.61.90.mon from
>> every 'jan' in the raster s91.2010, and so on for every other month.
>>
>>
>> I was wondering what is the best way to do that using raster (and possibly
>> zoo) functions?

If you're confident about the order of the layers in your rasterStacks
you could use overlay. See the note about recycling in the function help.

# lenght(x) needs to be a multiple of length(y), so that it can be recycled
# e.g. c(10, 10, 10, 10, 10, 10) - c(5, 7)
fun <- function(x, y) {
  x - y
}

annomalies <- overlay(x = s91.2010, y = s61.90.mon, fun = fun)

However, it looks like your climatologies are in alphabetic and not
chronological order, so you'll have to double check that.

Cheers,
Lo?c

>>
>> Thank you very much in advance, -- Thiago V. dos Santos
>>
>> PhD candidate
>> Land and Atmospheric Science
>> University of Minnesota
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

>>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From karimabdullah at yahoo.com  Tue Feb 14 23:53:18 2017
From: karimabdullah at yahoo.com (abdullah karim)
Date: Tue, 14 Feb 2017 22:53:18 +0000 (UTC)
Subject: [R-sig-Geo] Spatio-Temporal Kriging: Memory Issues
References: <2086690565.4912005.1487112798575.ref@mail.yahoo.com>
Message-ID: <2086690565.4912005.1487112798575@mail.yahoo.com>

Dear RUsers,


I wastrying to perform spatio-temporal kriging using krigeST. But looks like I amhaving some memory issues. I get the error:


?Error:cannot allocate vector of size 8.9 GB?


I ampredicting using the following code:

>>predicted<- krigeST(values ~ 1, data, prediction.grd, v.model)


Here "data" has STSDF structure and "?prediction.grd" has STF structure. I fitted?separable, productsum and metric models in different times.
I was workingwith the yearly data of around 4600 stations (these are water level monitoringwells). They have yearly data for 19 years. I am trying to interpolate it using 0.5 mile by 0.5 mile pixel sizes(or grid size). I want to cover a total area of around 55000 square miles. But code stopped working and that error message came out.


Then I kept all those 4600 stations, but chopped my area of prediction to around1600 square miles (over a county) as I want to capture the overall effects ofall stations while predicting. But this did not work as well yielding the same error as above.?

I am afraid, R is inverting a huge matrix to get the weights each time.
However,when I work with small number of stations (around 500) and predicting over amuch smaller area of around 1600 square miles (over a county), the code worksnicely and gives accurate results using different fitted models. Sometimes I have to use a coarser pixel sizes to reduce myprediction locations. But I don't think this an accurate option.


Can anyonehelp me so that I can use all the 4600 stations with finer pixel sizes? I canpredict over small areas and then merge them. But again I have to keep all mystations while doing that. Is going parallel an option (but I really want toavoid it)? Please let me know if you used nearest neighbors with anisotropy.
I can share my code if you want.


Thanks!


Abdullah??PhD StudentTexas Tech University



	[[alternative HTML version deleted]]


From roelofcoster at gmail.com  Wed Feb 15 15:10:20 2017
From: roelofcoster at gmail.com (Roelof Coster)
Date: Wed, 15 Feb 2017 15:10:20 +0100
Subject: [R-sig-Geo] Spatio-Temporal Kriging: Memory Issues
Message-ID: <CAPTd6_v_oMfU8rfV+E_dQqvOKV3tAyt9vnm7WgiVoKBfzg29HQ@mail.gmail.com>

Hello Karim,

You might want to use local kriging, as in:

predicted<- krigeST(values ~ 1, data, prediction.grd, v.model, nmax = 500,
stAni = 1)

The nmax parameter is the number of observations that will be used for each
location. The stAni is a parameter controlling whether observations that
are 'spatially' or 'temporally' near will be preferred.

Local kriging may also be theoretically better because it only assumes
local stationarity rather than the existence of a constant mean for the
entire domain.

Hope this helps!

Roelof

	[[alternative HTML version deleted]]


From karimabdullah at yahoo.com  Thu Feb 16 00:58:34 2017
From: karimabdullah at yahoo.com (abdullah karim)
Date: Wed, 15 Feb 2017 23:58:34 +0000 (UTC)
Subject: [R-sig-Geo] Spatio-Temporal Kriging: Memory Issues
In-Reply-To: <CAPTd6_v_oMfU8rfV+E_dQqvOKV3tAyt9vnm7WgiVoKBfzg29HQ@mail.gmail.com>
References: <CAPTd6_v_oMfU8rfV+E_dQqvOKV3tAyt9vnm7WgiVoKBfzg29HQ@mail.gmail.com>
Message-ID: <2010332852.144904.1487203114101@mail.yahoo.com>

Dear Dr. Coster,
Thank you very much. That worked perfectly.?
-Abdullah? 

    On Wednesday, February 15, 2017 8:11 AM, Roelof Coster <roelofcoster at gmail.com> wrote:
 

 Hello Karim,

You might want to use local kriging, as in:

predicted<- krigeST(values ~ 1, data, prediction.grd, v.model, nmax = 500,
stAni = 1)

The nmax parameter is the number of observations that will be used for each
location. The stAni is a parameter controlling whether observations that
are 'spatially' or 'temporally' near will be preferred.

Local kriging may also be theoretically better because it only assumes
local stationarity rather than the existence of a constant mean for the
entire domain.

Hope this helps!

Roelof

??? [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


   
	[[alternative HTML version deleted]]


From renaud.lancelot at cirad.fr  Fri Feb 17 13:10:51 2017
From: renaud.lancelot at cirad.fr (lancelot)
Date: Fri, 17 Feb 2017 13:10:51 +0100
Subject: [R-sig-Geo] How to fit a spatial hurdle model with the INLA package
	?
Message-ID: <89d397ee-0eaf-74a4-1752-6cbfd78bce99@cirad.fr>

Dear all,

I am looking for an example (dataset and code) of fitting a spatial 
hurdle model (zero-inflated model with a single source of zeros) using 
the INLA package for R. With this approach, two models are jointly fitted:

(1) the probability to observe at least one event (the single source of 
zeros)

(2) the (strictly > 0) count of events

The spatial correlation might be represented by a conditional 
auto-regressive model.

I am aware of the R-!NLA documentation available at http://www.r-inla.org/

All the best

Renaud
-- 
Renaud Lancelot
UMR Animaux, Sant?, Territoires, Risques et ?cosyst?mes
     Animals, Health, Territories, Risks & Ecosystems (ASTRE)
Adjoint au Directeur / Deputy director

http://umr-astre.cirad.fr/
CIRAD, UMR ASTRE, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 98
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69
Twitter: @RenaudLancelot


From thierry.onkelinx at inbo.be  Fri Feb 17 15:29:04 2017
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Fri, 17 Feb 2017 15:29:04 +0100
Subject: [R-sig-Geo] How to fit a spatial hurdle model with the INLA
 package ?
In-Reply-To: <89d397ee-0eaf-74a4-1752-6cbfd78bce99@cirad.fr>
References: <89d397ee-0eaf-74a4-1752-6cbfd78bce99@cirad.fr>
Message-ID: <CAJuCY5wfqzmjsr_sHe11ja8kCuBd0YTFLtStC2QacVsu9GYbTg@mail.gmail.com>

Dear Renaud,

IMHO you can't. INLA currently only fits zero-inflated distributions (with
a single zero-inflation parameter). A hurdle model would require to fit a
zero-truncated distribution.

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

2017-02-17 13:10 GMT+01:00 lancelot <renaud.lancelot at cirad.fr>:

> Dear all,
>
> I am looking for an example (dataset and code) of fitting a spatial hurdle
> model (zero-inflated model with a single source of zeros) using the INLA
> package for R. With this approach, two models are jointly fitted:
>
> (1) the probability to observe at least one event (the single source of
> zeros)
>
> (2) the (strictly > 0) count of events
>
> The spatial correlation might be represented by a conditional
> auto-regressive model.
>
> I am aware of the R-!NLA documentation available at http://www.r-inla.org/
>
> All the best
>
> Renaud
> --
> Renaud Lancelot
> UMR Animaux, Sant?, Territoires, Risques et ?cosyst?mes
>     Animals, Health, Territories, Risks & Ecosystems (ASTRE)
> Adjoint au Directeur / Deputy director
>
> http://umr-astre.cirad.fr/
> CIRAD, UMR ASTRE, Campus International de Baillarguet TA A-DIR / B
> F34398 Montpellier
>
> Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 98
> Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69
> Twitter: @RenaudLancelot
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From martazores at gmail.com  Fri Feb 17 17:21:27 2017
From: martazores at gmail.com (marta azores)
Date: Fri, 17 Feb 2017 15:21:27 -0100
Subject: [R-sig-Geo] multiple lines
Message-ID: <CAE3WKgQuD25UBABVn_b4geQLKTBLzij29viuGZ0HNjDxrURxCg@mail.gmail.com>

Hello
I am trying to create multiple lines based on boat positions and calculate
the distance for each boat track. I have already managed to create a single
line with all the positions and calculate the distance but I can't managed
to divided the line by transects which are previously defined based on the
boat positions. These transects are not consecutive as they can be from
different days and boats. This is an example of my data:

 dput(effort)
 structure(list(Ref = c(1L, 2L, 3L, 4L, 5L, 6L, 7L, 8L, 9L, 15L,
 16L), Effort = c(1L, 1L, 1L, 1L, 0L, 1L, 1L, 1L, 0L, 1L, 0L),
  Trip = structure(c(1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L,
  2L), .Label = c("P001.01", "P0010.01"), class = "factor"),
 Code = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
 1L), .Label = "P1968", class = "factor"), Date = structure(c(1L,
 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L), .Label = c("04/05/2010",
 "19/05/2010"), class = "factor"), Time = structure(c(5L,
 6L, 7L, 9L, 10L, 1L, 2L, 3L, 4L, 8L, 11L), .Label = c("08:12",
 "08:25", "08:43", "08:59", "17:30", "17:51", "17:57", "18:02",
 "18:09", "18:31", "18:39"), class = "factor"), LAT = c(38.67173,
 38.67035, 38.66965, 38.66908, 38.64717, 38.22252, 38.26693,
 38.18948, 38.17187, 38.25057, 38.18335), LONG = c(-28.7492,
-28.64475, -28.70907, -28.72917, -28.63157, -28.90358, -28.87397,
-29.07098, -28.9542, -28.8876, -28.92818), transect = c(1L, 1L, 1L,
1L, 1L, 2L, 2L, 2L, 2L, 4L, 4L)), .Names = c("Ref", "Effort", "Trip",
"Code", "Date", "Time", "LAT", "LONG", "transect"), class =
"data.frame", row.names = c(NA, -11L))

The code that I have applied so far is this:

### boat points the locations of the boats are sort by date and time!
effort <- read.table(paste0(path_data,"effort_test.csv"), header=TRUE,
   sep=",", na.strings="NA", dec=".", strip.white=TRUE)
pos<-as.data.frame(cbind(effort$LAT,effort$LONG, effort$transect))
str(pos)
sp::coordinates(pos) <- ~V2+V1
sp::proj4string(pos) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
### project it to somewhat equal area
effortSP <- sp::spTransform(pos, CRS("+proj=laea +lat_0=30 +lon_0=-30
+x_0=0   +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))# plot boat
positions
# cost raster sea and island
azoTS1<- raster::raster(paste0(path_data,"azoTS1.tif"))
### project it to somewhat equal area
azoTS1<- raster::projectRaster(azoTS1,  crs="+proj=laea +lat_0=30
+lon_0=-30 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs")
###scale  real cost file
azoTS1[azoTS1 ==2]<-100
plot(azoTS1)
### increase the spatial resolution
costraw<-raster::disaggregate(azoTS1,fact=c(5, 5))
# prepare it for analysis
transition<- gdistance::transition(1/costraw, mean, directions=8)
trCostS16 <- gdistance::geoCorrection(transition, type="c")
# calculating the first segment of the whole sailing path
line<- gdistance::shortestPath(trCostS16,
effortSP at coords[1,],effortSP at coords[2,], output="SpatialLines")
lines(line)
### here we start with the for-loopfor (i in (seq(2,length(effortSP) -
1))) {# calculation of the rest of the segements
nextSegment<- gdistance::shortestPath(trCostS16,
effortSP at coords[i,],effortSP at coords[i+1,], output="SpatialLines")#
simple addition combines the single spatialline segements
line <- nextSegment + line# we plot each new segement
lines(nextSegment)}

	[[alternative HTML version deleted]]


From renaud.lancelot at cirad.fr  Fri Feb 17 17:38:47 2017
From: renaud.lancelot at cirad.fr (lancelot)
Date: Fri, 17 Feb 2017 17:38:47 +0100
Subject: [R-sig-Geo] How to fit a spatial hurdle model with the INLA
 package ?
In-Reply-To: <CAJuCY5wfqzmjsr_sHe11ja8kCuBd0YTFLtStC2QacVsu9GYbTg@mail.gmail.com>
References: <89d397ee-0eaf-74a4-1752-6cbfd78bce99@cirad.fr>
	<CAJuCY5wfqzmjsr_sHe11ja8kCuBd0YTFLtStC2QacVsu9GYbTg@mail.gmail.com>
Message-ID: <779f425d-252b-9286-bf1c-9e1f6d549571@cirad.fr>

Dear Thierry,

Thank you for your reply. I wonder whether it would be possible to do 
something with zero-inflated models of type 0: see 
http://www.math.ntnu.no/inla/r-inla.org/doc/likelihood/zeroinflated.pdf, 
first equation on page 1.

All the best

Renaud

Le 17/02/2017 ? 15:29, Thierry Onkelinx a ?crit :
> Dear Renaud,
>
> IMHO you can't. INLA currently only fits zero-inflated distributions
> (with a single zero-inflation parameter). A hurdle model would require
> to fit a zero-truncated distribution.
>
> Best regards,
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
> and Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to
> say what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of
> data. ~ John Tukey
>
> 2017-02-17 13:10 GMT+01:00 lancelot <renaud.lancelot at cirad.fr
> <mailto:renaud.lancelot at cirad.fr>>:
>
>     Dear all,
>
>     I am looking for an example (dataset and code) of fitting a spatial
>     hurdle model (zero-inflated model with a single source of zeros)
>     using the INLA package for R. With this approach, two models are
>     jointly fitted:
>
>     (1) the probability to observe at least one event (the single source
>     of zeros)
>
>     (2) the (strictly > 0) count of events
>
>     The spatial correlation might be represented by a conditional
>     auto-regressive model.
>
>     I am aware of the R-!NLA documentation available at
>     http://www.r-inla.org/
>
>     All the best
>
>     Renaud
>     --
>     Renaud Lancelot
>     UMR Animaux, Sant?, Territoires, Risques et ?cosyst?mes
>         Animals, Health, Territories, Risks & Ecosystems (ASTRE)
>     Adjoint au Directeur / Deputy director
>
>     http://umr-astre.cirad.fr/
>     CIRAD, UMR ASTRE, Campus International de Baillarguet TA A-DIR / B
>     F34398 Montpellier
>
>     Tel.  +33 4 67 59 37 17 <tel:%2B33%204%2067%2059%2037%2017>  -  Fax
>     +33 4 67 59 37 98 <tel:%2B33%204%2067%2059%2037%2098>
>     Secr. +33 4 67 59 37 37 <tel:%2B33%204%2067%2059%2037%2037>  - Cell.
>     +33 6 77 52 08 69 <tel:%2B33%206%2077%2052%2008%2069>
>     Twitter: @RenaudLancelot
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>

-- 
Renaud Lancelot
UMR Animaux, Sant?, Territoires, Risques et ?cosyst?mes
     Animals, Health, Territories, Risks & Ecosystems (ASTRE)
Adjoint au Directeur / Deputy director

http://umr-astre.cirad.fr/
CIRAD, UMR ASTRE, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 98
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69
Twitter: @RenaudLancelot


From thierry.onkelinx at inbo.be  Fri Feb 17 18:07:05 2017
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Fri, 17 Feb 2017 18:07:05 +0100
Subject: [R-sig-Geo] How to fit a spatial hurdle model with the INLA
 package ?
In-Reply-To: <779f425d-252b-9286-bf1c-9e1f6d549571@cirad.fr>
References: <89d397ee-0eaf-74a4-1752-6cbfd78bce99@cirad.fr>
	<CAJuCY5wfqzmjsr_sHe11ja8kCuBd0YTFLtStC2QacVsu9GYbTg@mail.gmail.com>
	<779f425d-252b-9286-bf1c-9e1f6d549571@cirad.fr>
Message-ID: <CAJuCY5xs8T7-uny+Yydp_cGk50=gdmciFwRdeyKWMoBz47DvpQ@mail.gmail.com>

That allows for a hurdle model with an intercept only model for the zeroes.
Your initial question suggests that you want a more complex model for the
zeroes.

Op 17 feb. 2017 5:38 p.m. schreef "lancelot" <renaud.lancelot at cirad.fr>:

Dear Thierry,

Thank you for your reply. I wonder whether it would be possible to do
something with zero-inflated models of type 0: see
http://www.math.ntnu.no/inla/r-inla.org/doc/likelihood/zeroinflated.pdf,
first equation on page 1.

All the best

Renaud


Le 17/02/2017 ? 15:29, Thierry Onkelinx a ?crit :

> Dear Renaud,
>
> IMHO you can't. INLA currently only fits zero-inflated distributions
> (with a single zero-inflation parameter). A hurdle model would require
> to fit a zero-truncated distribution.
>
> Best regards,
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
> and Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to
> say what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of
> data. ~ John Tukey
>
> 2017-02-17 13:10 GMT+01:00 lancelot <renaud.lancelot at cirad.fr
> <mailto:renaud.lancelot at cirad.fr>>:
>
>
>     Dear all,
>
>     I am looking for an example (dataset and code) of fitting a spatial
>     hurdle model (zero-inflated model with a single source of zeros)
>     using the INLA package for R. With this approach, two models are
>     jointly fitted:
>
>     (1) the probability to observe at least one event (the single source
>     of zeros)
>
>     (2) the (strictly > 0) count of events
>
>     The spatial correlation might be represented by a conditional
>     auto-regressive model.
>
>     I am aware of the R-!NLA documentation available at
>     http://www.r-inla.org/
>
>     All the best
>
>     Renaud
>     --
>     Renaud Lancelot
>     UMR Animaux, Sant?, Territoires, Risques et ?cosyst?mes
>         Animals, Health, Territories, Risks & Ecosystems (ASTRE)
>     Adjoint au Directeur / Deputy director
>
>     http://umr-astre.cirad.fr/
>     CIRAD, UMR ASTRE, Campus International de Baillarguet TA A-DIR / B
>     F34398 Montpellier
>
>     Tel.  +33 4 67 59 37 17 <tel:%2B33%204%2067%2059%2037%2017>  -  Fax
>     +33 4 67 59 37 98 <tel:%2B33%204%2067%2059%2037%2098>
>     Secr. +33 4 67 59 37 37 <tel:%2B33%204%2067%2059%2037%2037>  - Cell.
>     +33 6 77 52 08 69 <tel:%2B33%206%2077%2052%2008%2069>
>
>     Twitter: @RenaudLancelot
>
>     _______________________________________________
>     R-sig-Geo mailing list
>     R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>     https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>     <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>
>
-- 
Renaud Lancelot
UMR Animaux, Sant?, Territoires, Risques et ?cosyst?mes
    Animals, Health, Territories, Risks & Ecosystems (ASTRE)
Adjoint au Directeur / Deputy director

http://umr-astre.cirad.fr/
CIRAD, UMR ASTRE, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 98
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69
Twitter: @RenaudLancelot

	[[alternative HTML version deleted]]


From famuvie at alumni.uv.es  Fri Feb 17 20:36:10 2017
From: famuvie at alumni.uv.es (=?UTF-8?Q?Facundo_Mu=c3=b1oz?=)
Date: Fri, 17 Feb 2017 20:36:10 +0100
Subject: [R-sig-Geo] How to fit a spatial hurdle model with the INLA
 package ?
In-Reply-To: <89d397ee-0eaf-74a4-1752-6cbfd78bce99@cirad.fr>
References: <89d397ee-0eaf-74a4-1752-6cbfd78bce99@cirad.fr>
Message-ID: <c857d9f3-3f0c-bfe5-fb4e-8a386e8e1006@alumni.uv.es>

Are you aware of Quiroz et al. 2015? I think it is what you need, or
very close. And they provide data and code.

There is also Mu?oz et al. 2016 (Disclaimer, that's me), which uses a
joint model Bernoulli for zeros and Gamma for >0, with spatial-temporal
effect via SPDE. The data and code are available as a companion R
package at https://github.com/famuvie/2016_RisingAshes.


Hope it helps.

?acu.-


Quiroz, Z. C., M. O. Prates, and H. Rue (2015, March). A bayesian
approach to estimate the biomass of anchovies off the coast of per?.
/Biometrics/ /71 /(1), 208-217. http://dx.doi.org/10.1111/biom.12227

Mu?oz, F., B. Mar?ais, J. Dufour, and A. Dowkiw (2016, December). Rising
out of the ashes: Additive genetic variation for crown and collar
resistance to hymenoscyphus fraxineus in fraxinus excelsior.
/Phytopathology/ /106 /(12), 1535-1543.
http://dx.doi.org/10.1094/phyto-11-15-0284-r




El 17/02/2017 a las 13:10, lancelot escribi?:
> Dear all,
>
> I am looking for an example (dataset and code) of fitting a spatial
> hurdle model (zero-inflated model with a single source of zeros) using
> the INLA package for R. With this approach, two models are jointly
> fitted:
>
> (1) the probability to observe at least one event (the single source
> of zeros)
>
> (2) the (strictly > 0) count of events
>
> The spatial correlation might be represented by a conditional
> auto-regressive model.
>
> I am aware of the R-!NLA documentation available at
> http://www.r-inla.org/
>
> All the best
>
> Renaud


	[[alternative HTML version deleted]]


From diogo.galves at gmail.com  Sat Feb 18 01:41:44 2017
From: diogo.galves at gmail.com (Diogo Gomes Alves)
Date: Sat, 18 Feb 2017 08:41:44 +0800
Subject: [R-sig-Geo] Calculating distances on terrain with topographic
	variables
Message-ID: <CA+QCnmf0B048w64siG=bBUXn1hYZMvJQfjC0sBVd9O79eLVUXg@mail.gmail.com>

Hello,

I'm trying to calculate pairwise distances among points, having in hand
five topographic variables: mean elevation, slope, convexity, aspect and
stage. It's a 280x220m plot divided into 20x20m quadrats (11 rows and 14
columns). So the total amount of quadrats is 154. I have these topographic
variables from each quadrat or more precisely from each x,y point at the
centre of each quadrat (x and y are simply the distance in meters from the
origin). Since it's a study of animal movement in a very steep terrain, I'd
like to get the actual distance between each pair of quadrats (x,y points)
and an index of terrain resistance or something like that.

I've tried different modeling methods, using gdistance and its least-cost
distance analysis, for instance, but I didn't get any closer to a
satisfactory result.

I really appreciate any help,


Thanks a lot,
Dim

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Sun Feb 19 02:43:03 2017
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 19 Feb 2017 01:43:03 +0000
Subject: [R-sig-Geo] multiple lines
In-Reply-To: <CAE3WKgQuD25UBABVn_b4geQLKTBLzij29viuGZ0HNjDxrURxCg@mail.gmail.com>
References: <CAE3WKgQuD25UBABVn_b4geQLKTBLzij29viuGZ0HNjDxrURxCg@mail.gmail.com>
Message-ID: <CAAcGz9-XW86wrenR86gg_mnq=_VWdP_cQupE8m5Srswphp+jBw@mail.gmail.com>

There's a number of questions I have, and a few notes.

You want line segments (two points, start,end) in x,y,time, identified by
boat?

Spatial is not really suited to this kind of multidimensional line data,
but there are specialized tools like spacetime and spatstat, no real
coherence between them but you might find a sub-domain that fits for you.
Explore the Spatiotemporal CRAN Task View for options.

In Spatial, or in sf, this would be a data set of line segment features,
with time start-end and other grouping observations, like boat ID.

There's no need to project your raster, which is costly and lossy, you can
transform the boat data to the CRS of the raster.

I may be able to help more if you clarify a bit.

Cheers, Mike

On Sat, Feb 18, 2017, 03:21 marta azores <martazores at gmail.com> wrote:

> Hello
> I am trying to create multiple lines based on boat positions and calculate
> the distance for each boat track. I have already managed to create a single
> line with all the positions and calculate the distance but I can't managed
> to divided the line by transects which are previously defined based on the
> boat positions. These transects are not consecutive as they can be from
> different days and boats. This is an example of my data:
>
>  dput(effort)
>  structure(list(Ref = c(1L, 2L, 3L, 4L, 5L, 6L, 7L, 8L, 9L, 15L,
>  16L), Effort = c(1L, 1L, 1L, 1L, 0L, 1L, 1L, 1L, 0L, 1L, 0L),
>   Trip = structure(c(1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L,
>   2L), .Label = c("P001.01", "P0010.01"), class = "factor"),
>  Code = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
>  1L), .Label = "P1968", class = "factor"), Date = structure(c(1L,
>  1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L), .Label = c("04/05/2010",
>  "19/05/2010"), class = "factor"), Time = structure(c(5L,
>  6L, 7L, 9L, 10L, 1L, 2L, 3L, 4L, 8L, 11L), .Label = c("08:12",
>  "08:25", "08:43", "08:59", "17:30", "17:51", "17:57", "18:02",
>  "18:09", "18:31", "18:39"), class = "factor"), LAT = c(38.67173,
>  38.67035, 38.66965, 38.66908, 38.64717, 38.22252, 38.26693,
>  38.18948, 38.17187, 38.25057, 38.18335), LONG = c(-28.7492,
> -28.64475, -28.70907, -28.72917, -28.63157, -28.90358, -28.87397,
> -29.07098, -28.9542, -28.8876, -28.92818), transect = c(1L, 1L, 1L,
> 1L, 1L, 2L, 2L, 2L, 2L, 4L, 4L)), .Names = c("Ref", "Effort", "Trip",
> "Code", "Date", "Time", "LAT", "LONG", "transect"), class =
> "data.frame", row.names = c(NA, -11L))
>
> The code that I have applied so far is this:
>
> ### boat points the locations of the boats are sort by date and time!
> effort <- read.table(paste0(path_data,"effort_test.csv"), header=TRUE,
>    sep=",", na.strings="NA", dec=".", strip.white=TRUE)
> pos<-as.data.frame(cbind(effort$LAT,effort$LONG, effort$transect))
> str(pos)
> sp::coordinates(pos) <- ~V2+V1
> sp::proj4string(pos) <-CRS("+proj=longlat +datum=WGS84 +no_defs")
> ### project it to somewhat equal area
> effortSP <- sp::spTransform(pos, CRS("+proj=laea +lat_0=30 +lon_0=-30
> +x_0=0   +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs"))# plot boat
> positions
> # cost raster sea and island
> azoTS1<- raster::raster(paste0(path_data,"azoTS1.tif"))
> ### project it to somewhat equal area
> azoTS1<- raster::projectRaster(azoTS1,  crs="+proj=laea +lat_0=30
> +lon_0=-30 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs")
> ###scale  real cost file
> azoTS1[azoTS1 ==2]<-100
> plot(azoTS1)
> ### increase the spatial resolution
> costraw<-raster::disaggregate(azoTS1,fact=c(5, 5))
> # prepare it for analysis
> transition<- gdistance::transition(1/costraw, mean, directions=8)
> trCostS16 <- gdistance::geoCorrection(transition, type="c")
> # calculating the first segment of the whole sailing path
> line<- gdistance::shortestPath(trCostS16,
> effortSP at coords[1,],effortSP at coords[2,], output="SpatialLines")
> lines(line)
> ### here we start with the for-loopfor (i in (seq(2,length(effortSP) -
> 1))) {# calculation of the rest of the segements
> nextSegment<- gdistance::shortestPath(trCostS16,
> effortSP at coords[i,],effortSP at coords[i+1,], output="SpatialLines")#
> simple addition combines the single spatialline segements
> line <- nextSegment + line# we plot each new segement
> lines(nextSegment)}
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From er.rutishauser at gmail.com  Mon Feb 20 09:45:02 2017
From: er.rutishauser at gmail.com (Ervan Rutishauser)
Date: Mon, 20 Feb 2017 09:45:02 +0100
Subject: [R-sig-Geo] Optimizing spatial query in R
Message-ID: <CAJ7XRod0RTOmkwdpZmfTN86+Z2Ra39ne+02mVFPTw129418=CA@mail.gmail.com>

Dear All,

I am desperately trying to fasten my algorithm to estimate the fraction of
tree crown that overlap a given 10x10 subplot in a forest plot. I have
combined a set of spatial functions (gDistance, extract)  & objects
(SpatialGrid, SpatialPolygons) in a way that is probably not the most
efficient, as it takes dozen of hours to run for a 50000 subplots (50 ha
forest plot).

My detailed problem and a reproducible example are posted on Stackoverflow
<http://stackoverflow.com/questions/42303559/optimizing-spatial-query-in-r> and
append below, if you wanna have a look. Apart of Amazon Web Server, is
anyone aware of a sever where to execute (and save results back) R codes
online?
Thanks for any help.
Best regards,


# A. Define objects
    require(sp)
    require(raster)
    require(rgdal)
    require(rgeos)
    require(dismo)
    radius=25   # max search radius around 10 x 10 m cells
    res <- vector() # where to store results

    # Create a fake set of trees with x,y coordinates and trunk diameter (=dbh)
    set.seed(0)
    survey <- data.frame(x=sample(99,1000,replace=T),y=sample(99,1000,replace=T),dbh=sample(100,1000,replace=T))
    coordinates(survey) <- ~x+y

    # Define 10 x 10 subplots
    grid10 <- SpatialGrid(GridTopology(c(5,5),c(10,10),c(10,10)))
    survey$subplot <- over(survey,grid10)
# B. Now find fraction of tree crown overlapping each subplot
    for (i in 1:100) {
        # Extract centro?d of each the ith cell
        centro <- expand.grid(x=seq(5,95,10),y=seq(5,95,10))[i,]
        corner <-
data.frame(x=c(centro$x-5,centro$x+5,centro$x+5,centro$x-5),y=c(centro$y-5,centro$y-5,centro$y+5,centro$y+5))


        # Find trees in a max radius (define above)
        tem <- survey[which((centro$x-survey$x)^2+(centro$y-survey$y)^2<=radius^2),]


        # Define tree crown based on tree diameter
        tem$crownr <- exp(-.438+.658*log(tem$dbh/10)) # crown radius in meter

        # Compute the distance from each tree to cell's borders
        pDist <- vector()
        for (k in 1:nrow(tem))  {
            pDist[k] <-
gDistance(tem[k,],SpatialPolygons(list(Polygons(list(Polygon(corner)),1))))
        }

        # Keeps only trees whose crown is lower than the above
distance (=overlap)
        overlap.trees <- tem[which(pDist<=tem$crownr),]
        overlap.trees$crowna <-overlap.trees$crownr^2*pi  # compute crown area

        # Creat polygons from overlapping crowns
        c1 <- circles(coordinates(overlap.trees),overlap.trees$crownr,
lonlat=F, dissolve=F)
        crown <- polygons(c1)
        Crown <-
SpatialPolygonsDataFrame(polygons(c1),data=data.frame(dbh=overlap.trees$dbh,crown.area=overlap.trees$crowna))

        # Create a fine grid points to retrieve the fraction of
overlapping crowns
        max.dist <- ceiling(sqrt(which.max((centro$x -
overlap.trees$x)^2 + (centro$y - overlap.trees$y)^2))) # max distance
to narrow search

        finegrid <-
as.data.frame(expand.grid(x=seq(centro$x-max.dist,centro$x+max.dist,1),y=seq(centro$y-max.dist,centro$y+max.dist,1)))
        coordinates(finegrid) <- ~ x+y
        A <- extract(Crown,finegrid)
        Crown at data$ID <- seq(1,length(crown),1)
        B <- as.data.frame(table(A$poly.ID))
        B <- merge(B,Crown at data,by.x="Var1",by.y="ID",all.x=T)
        B$overlap <- B$Freq/B$crown.area
        B$overlap[B$overlap>1] <- 1
        res[i] <- sum(B$overlap)
    }
# C. Check the result
    res  # sum of crown fraction overlapping each cell (works fine)

-- 
_____________________________
Ervan Rutishauser, PhD
? <http://carboforexpert.ch/>STRI post-doctoral fellow
CarboForExpert?
? <http://carboforexpert.ch/>
?Skype: ervan-CH

	[[alternative HTML version deleted]]


From reudenbach at uni-marburg.de  Mon Feb 20 10:56:28 2017
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Mon, 20 Feb 2017 10:56:28 +0100
Subject: [R-sig-Geo] Optimizing spatial query in R
In-Reply-To: <CAJ7XRod0RTOmkwdpZmfTN86+Z2Ra39ne+02mVFPTw129418=CA@mail.gmail.com>
References: <CAJ7XRod0RTOmkwdpZmfTN86+Z2Ra39ne+02mVFPTw129418=CA@mail.gmail.com>
Message-ID: <286984d0-5e80-897d-41ed-4e08c6fe22bd@uni-marburg.de>

Ervan,

Just on the run, especially if you deal with real data and some 100K 
-1000K of vectors I think the fastest way to do so is to engage GDAL 
GRASS7/SAGA and their ability to deal highly efficient with this kind 
of topological and geometrical queries.

A very good pure R alternative is to use the sf package that is ways 
faster and more satble than sp. It also provides this type of GIS 
functionality like st_overlaps() etc.

cheers Chris



On 20.02.2017 09:45, Ervan Rutishauser wrote:
> Dear All,
>
> I am desperately trying to fasten my algorithm to estimate the fraction of
> tree crown that overlap a given 10x10 subplot in a forest plot. I have
> combined a set of spatial functions (gDistance, extract)  & objects
> (SpatialGrid, SpatialPolygons) in a way that is probably not the most
> efficient, as it takes dozen of hours to run for a 50000 subplots (50 ha
> forest plot).
>
> My detailed problem and a reproducible example are posted on Stackoverflow
> <http://stackoverflow.com/questions/42303559/optimizing-spatial-query-in-r> and
> append below, if you wanna have a look. Apart of Amazon Web Server, is
> anyone aware of a sever where to execute (and save results back) R codes
> online?
> Thanks for any help.
> Best regards,
>
>
> # A. Define objects
>      require(sp)
>      require(raster)
>      require(rgdal)
>      require(rgeos)
>      require(dismo)
>      radius=25   # max search radius around 10 x 10 m cells
>      res <- vector() # where to store results
>
>      # Create a fake set of trees with x,y coordinates and trunk diameter (=dbh)
>      set.seed(0)
>      survey <- data.frame(x=sample(99,1000,replace=T),y=sample(99,1000,replace=T),dbh=sample(100,1000,replace=T))
>      coordinates(survey) <- ~x+y
>
>      # Define 10 x 10 subplots
>      grid10 <- SpatialGrid(GridTopology(c(5,5),c(10,10),c(10,10)))
>      survey$subplot <- over(survey,grid10)
> # B. Now find fraction of tree crown overlapping each subplot
>      for (i in 1:100) {
>          # Extract centro?d of each the ith cell
>          centro <- expand.grid(x=seq(5,95,10),y=seq(5,95,10))[i,]
>          corner <-
> data.frame(x=c(centro$x-5,centro$x+5,centro$x+5,centro$x-5),y=c(centro$y-5,centro$y-5,centro$y+5,centro$y+5))
>
>
>          # Find trees in a max radius (define above)
>          tem <- survey[which((centro$x-survey$x)^2+(centro$y-survey$y)^2<=radius^2),]
>
>
>          # Define tree crown based on tree diameter
>          tem$crownr <- exp(-.438+.658*log(tem$dbh/10)) # crown radius in meter
>
>          # Compute the distance from each tree to cell's borders
>          pDist <- vector()
>          for (k in 1:nrow(tem))  {
>              pDist[k] <-
> gDistance(tem[k,],SpatialPolygons(list(Polygons(list(Polygon(corner)),1))))
>          }
>
>          # Keeps only trees whose crown is lower than the above
> distance (=overlap)
>          overlap.trees <- tem[which(pDist<=tem$crownr),]
>          overlap.trees$crowna <-overlap.trees$crownr^2*pi  # compute crown area
>
>          # Creat polygons from overlapping crowns
>          c1 <- circles(coordinates(overlap.trees),overlap.trees$crownr,
> lonlat=F, dissolve=F)
>          crown <- polygons(c1)
>          Crown <-
> SpatialPolygonsDataFrame(polygons(c1),data=data.frame(dbh=overlap.trees$dbh,crown.area=overlap.trees$crowna))
>
>          # Create a fine grid points to retrieve the fraction of
> overlapping crowns
>          max.dist <- ceiling(sqrt(which.max((centro$x -
> overlap.trees$x)^2 + (centro$y - overlap.trees$y)^2))) # max distance
> to narrow search
>
>          finegrid <-
> as.data.frame(expand.grid(x=seq(centro$x-max.dist,centro$x+max.dist,1),y=seq(centro$y-max.dist,centro$y+max.dist,1)))
>          coordinates(finegrid) <- ~ x+y
>          A <- extract(Crown,finegrid)
>          Crown at data$ID <- seq(1,length(crown),1)
>          B <- as.data.frame(table(A$poly.ID))
>          B <- merge(B,Crown at data,by.x="Var1",by.y="ID",all.x=T)
>          B$overlap <- B$Freq/B$crown.area
>          B$overlap[B$overlap>1] <- 1
>          res[i] <- sum(B$overlap)
>      }
> # C. Check the result
>      res  # sum of crown fraction overlapping each cell (works fine)
>

-- 
Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of 
Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032 
Marburg, fon: ++49.(0)6421.2824296, fax: ++49.(0)6421.2828950, web: 
gis-ma.org, giswerk.org, moc.environmentalinformatics-marburg.de


From er.rutishauser at gmail.com  Mon Feb 20 11:03:51 2017
From: er.rutishauser at gmail.com (Ervan Rutishauser)
Date: Mon, 20 Feb 2017 11:03:51 +0100
Subject: [R-sig-Geo] Optimizing spatial query in R
In-Reply-To: <286984d0-5e80-897d-41ed-4e08c6fe22bd@uni-marburg.de>
References: <CAJ7XRod0RTOmkwdpZmfTN86+Z2Ra39ne+02mVFPTw129418=CA@mail.gmail.com>
	<286984d0-5e80-897d-41ed-4e08c6fe22bd@uni-marburg.de>
Message-ID: <CAJ7XRodDHMkR=vYsMb14eAZZWgH08gkBTwAXc+50PJicgjbGUA@mail.gmail.com>

Dear Chris,

Thanks for your prompt reply and pointing out the "sf" package . I wasn't
aware of it, but I am glad to see it has been released only 2 weeks ago ;)
I'll have a look right now.

Tsch?ss
Ervan

On 20 February 2017 at 10:56, Chris Reudenbach <reudenbach at uni-marburg.de>
wrote:

> Ervan,
>
> Just on the run, especially if you deal with real data and some 100K
> -1000K of vectors I think the fastest way to do so is to engage GDAL
> GRASS7/SAGA and their ability to deal highly efficient with this kind of
> topological and geometrical queries.
>
> A very good pure R alternative is to use the sf package that is ways
> faster and more satble than sp. It also provides this type of GIS
> functionality like st_overlaps() etc.
>
> cheers Chris
>
>
>
> On 20.02.2017 09:45, Ervan Rutishauser wrote:
>
>> Dear All,
>>
>> I am desperately trying to fasten my algorithm to estimate the fraction of
>> tree crown that overlap a given 10x10 subplot in a forest plot. I have
>> combined a set of spatial functions (gDistance, extract)  & objects
>> (SpatialGrid, SpatialPolygons) in a way that is probably not the most
>> efficient, as it takes dozen of hours to run for a 50000 subplots (50 ha
>> forest plot).
>>
>> My detailed problem and a reproducible example are posted on Stackoverflow
>> <http://stackoverflow.com/questions/42303559/optimizing-spat
>> ial-query-in-r> and
>>
>> append below, if you wanna have a look. Apart of Amazon Web Server, is
>> anyone aware of a sever where to execute (and save results back) R codes
>> online?
>> Thanks for any help.
>> Best regards,
>>
>>
>> # A. Define objects
>>      require(sp)
>>      require(raster)
>>      require(rgdal)
>>      require(rgeos)
>>      require(dismo)
>>      radius=25   # max search radius around 10 x 10 m cells
>>      res <- vector() # where to store results
>>
>>      # Create a fake set of trees with x,y coordinates and trunk diameter
>> (=dbh)
>>      set.seed(0)
>>      survey <- data.frame(x=sample(99,1000,re
>> place=T),y=sample(99,1000,replace=T),dbh=sample(100,1000,replace=T))
>>      coordinates(survey) <- ~x+y
>>
>>      # Define 10 x 10 subplots
>>      grid10 <- SpatialGrid(GridTopology(c(5,5),c(10,10),c(10,10)))
>>      survey$subplot <- over(survey,grid10)
>> # B. Now find fraction of tree crown overlapping each subplot
>>      for (i in 1:100) {
>>          # Extract centro?d of each the ith cell
>>          centro <- expand.grid(x=seq(5,95,10),y=seq(5,95,10))[i,]
>>          corner <-
>> data.frame(x=c(centro$x-5,centro$x+5,centro$x+5,centro$x-5),
>> y=c(centro$y-5,centro$y-5,centro$y+5,centro$y+5))
>>
>>
>>          # Find trees in a max radius (define above)
>>          tem <- survey[which((centro$x-survey$
>> x)^2+(centro$y-survey$y)^2<=radius^2),]
>>
>>
>>          # Define tree crown based on tree diameter
>>          tem$crownr <- exp(-.438+.658*log(tem$dbh/10)) # crown radius in
>> meter
>>
>>          # Compute the distance from each tree to cell's borders
>>          pDist <- vector()
>>          for (k in 1:nrow(tem))  {
>>              pDist[k] <-
>> gDistance(tem[k,],SpatialPolygons(list(Polygons(list(
>> Polygon(corner)),1))))
>>          }
>>
>>          # Keeps only trees whose crown is lower than the above
>> distance (=overlap)
>>          overlap.trees <- tem[which(pDist<=tem$crownr),]
>>          overlap.trees$crowna <-overlap.trees$crownr^2*pi  # compute
>> crown area
>>
>>          # Creat polygons from overlapping crowns
>>          c1 <- circles(coordinates(overlap.trees),overlap.trees$crownr,
>> lonlat=F, dissolve=F)
>>          crown <- polygons(c1)
>>          Crown <-
>> SpatialPolygonsDataFrame(polygons(c1),data=data.frame(dbh=
>> overlap.trees$dbh,crown.area=overlap.trees$crowna))
>>
>>          # Create a fine grid points to retrieve the fraction of
>> overlapping crowns
>>          max.dist <- ceiling(sqrt(which.max((centro$x -
>> overlap.trees$x)^2 + (centro$y - overlap.trees$y)^2))) # max distance
>> to narrow search
>>
>>          finegrid <-
>> as.data.frame(expand.grid(x=seq(centro$x-max.dist,centro$x+
>> max.dist,1),y=seq(centro$y-max.dist,centro$y+max.dist,1)))
>>          coordinates(finegrid) <- ~ x+y
>>          A <- extract(Crown,finegrid)
>>          Crown at data$ID <- seq(1,length(crown),1)
>>          B <- as.data.frame(table(A$poly.ID))
>>          B <- merge(B,Crown at data,by.x="Var1",by.y="ID",all.x=T)
>>          B$overlap <- B$Freq/B$crown.area
>>          B$overlap[B$overlap>1] <- 1
>>          res[i] <- sum(B$overlap)
>>      }
>> # C. Check the result
>>      res  # sum of crown fraction overlapping each cell (works fine)
>>
>>
> --
> Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of
> Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032
> Marburg, fon: ++49.(0)6421.2824296, fax: ++49.(0)6421.2828950, web:
> gis-ma.org, giswerk.org, moc.environmentalinformatics-marburg.de
>
>


-- 
_____________________________
Ervan Rutishauser, PhD
? <http://carboforexpert.ch/>STRI post-doctoral fellow
CarboForExpert?
? <http://carboforexpert.ch/>
?Skype: ervan-CH

	[[alternative HTML version deleted]]


From roman.lustrik at gmail.com  Mon Feb 20 11:04:17 2017
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 20 Feb 2017 11:04:17 +0100
Subject: [R-sig-Geo] Optimizing spatial query in R
In-Reply-To: <286984d0-5e80-897d-41ed-4e08c6fe22bd@uni-marburg.de>
References: <CAJ7XRod0RTOmkwdpZmfTN86+Z2Ra39ne+02mVFPTw129418=CA@mail.gmail.com>
	<286984d0-5e80-897d-41ed-4e08c6fe22bd@uni-marburg.de>
Message-ID: <CAHT1vpgDPs2bazvCf_vpGrLjbTH5nVY9dQAGDh2qo-TfjCiVrQ@mail.gmail.com>

The biggest bottleneck was creating a SpatialPolygons object and
calculating gDistance. After computing the SP object outside the for loop,
the run time came down dramatically (see SO post).

Cheers,
Roman

On Mon, Feb 20, 2017 at 10:56 AM, Chris Reudenbach <
reudenbach at uni-marburg.de> wrote:

> Ervan,
>
> Just on the run, especially if you deal with real data and some 100K
> -1000K of vectors I think the fastest way to do so is to engage GDAL
> GRASS7/SAGA and their ability to deal highly efficient with this kind of
> topological and geometrical queries.
>
> A very good pure R alternative is to use the sf package that is ways
> faster and more satble than sp. It also provides this type of GIS
> functionality like st_overlaps() etc.
>
> cheers Chris
>
>
>
>
> On 20.02.2017 09:45, Ervan Rutishauser wrote:
>
>> Dear All,
>>
>> I am desperately trying to fasten my algorithm to estimate the fraction of
>> tree crown that overlap a given 10x10 subplot in a forest plot. I have
>> combined a set of spatial functions (gDistance, extract)  & objects
>> (SpatialGrid, SpatialPolygons) in a way that is probably not the most
>> efficient, as it takes dozen of hours to run for a 50000 subplots (50 ha
>> forest plot).
>>
>> My detailed problem and a reproducible example are posted on Stackoverflow
>> <http://stackoverflow.com/questions/42303559/optimizing-spat
>> ial-query-in-r> and
>> append below, if you wanna have a look. Apart of Amazon Web Server, is
>> anyone aware of a sever where to execute (and save results back) R codes
>> online?
>> Thanks for any help.
>> Best regards,
>>
>>
>> # A. Define objects
>>      require(sp)
>>      require(raster)
>>      require(rgdal)
>>      require(rgeos)
>>      require(dismo)
>>      radius=25   # max search radius around 10 x 10 m cells
>>      res <- vector() # where to store results
>>
>>      # Create a fake set of trees with x,y coordinates and trunk diameter
>> (=dbh)
>>      set.seed(0)
>>      survey <- data.frame(x=sample(99,1000,re
>> place=T),y=sample(99,1000,replace=T),dbh=sample(100,1000,replace=T))
>>      coordinates(survey) <- ~x+y
>>
>>      # Define 10 x 10 subplots
>>      grid10 <- SpatialGrid(GridTopology(c(5,5),c(10,10),c(10,10)))
>>      survey$subplot <- over(survey,grid10)
>> # B. Now find fraction of tree crown overlapping each subplot
>>      for (i in 1:100) {
>>          # Extract centro?d of each the ith cell
>>          centro <- expand.grid(x=seq(5,95,10),y=seq(5,95,10))[i,]
>>          corner <-
>> data.frame(x=c(centro$x-5,centro$x+5,centro$x+5,centro$x-5),
>> y=c(centro$y-5,centro$y-5,centro$y+5,centro$y+5))
>>
>>
>>          # Find trees in a max radius (define above)
>>          tem <- survey[which((centro$x-survey$
>> x)^2+(centro$y-survey$y)^2<=radius^2),]
>>
>>
>>          # Define tree crown based on tree diameter
>>          tem$crownr <- exp(-.438+.658*log(tem$dbh/10)) # crown radius in
>> meter
>>
>>          # Compute the distance from each tree to cell's borders
>>          pDist <- vector()
>>          for (k in 1:nrow(tem))  {
>>              pDist[k] <-
>> gDistance(tem[k,],SpatialPolygons(list(Polygons(list(
>> Polygon(corner)),1))))
>>          }
>>
>>          # Keeps only trees whose crown is lower than the above
>> distance (=overlap)
>>          overlap.trees <- tem[which(pDist<=tem$crownr),]
>>          overlap.trees$crowna <-overlap.trees$crownr^2*pi  # compute
>> crown area
>>
>>          # Creat polygons from overlapping crowns
>>          c1 <- circles(coordinates(overlap.trees),overlap.trees$crownr,
>> lonlat=F, dissolve=F)
>>          crown <- polygons(c1)
>>          Crown <-
>> SpatialPolygonsDataFrame(polygons(c1),data=data.frame(dbh=
>> overlap.trees$dbh,crown.area=overlap.trees$crowna))
>>
>>          # Create a fine grid points to retrieve the fraction of
>> overlapping crowns
>>          max.dist <- ceiling(sqrt(which.max((centro$x -
>> overlap.trees$x)^2 + (centro$y - overlap.trees$y)^2))) # max distance
>> to narrow search
>>
>>          finegrid <-
>> as.data.frame(expand.grid(x=seq(centro$x-max.dist,centro$x+
>> max.dist,1),y=seq(centro$y-max.dist,centro$y+max.dist,1)))
>>          coordinates(finegrid) <- ~ x+y
>>          A <- extract(Crown,finegrid)
>>          Crown at data$ID <- seq(1,length(crown),1)
>>          B <- as.data.frame(table(A$poly.ID))
>>          B <- merge(B,Crown at data,by.x="Var1",by.y="ID",all.x=T)
>>          B$overlap <- B$Freq/B$crown.area
>>          B$overlap[B$overlap>1] <- 1
>>          res[i] <- sum(B$overlap)
>>      }
>> # C. Check the result
>>      res  # sum of crown fraction overlapping each cell (works fine)
>>
>>
> --
> Dr Christoph Reudenbach, Philipps-University of Marburg, Faculty of
> Geography, GIS and Environmental Modeling, Deutschhausstr. 10, D-35032
> Marburg, fon: ++49.(0)6421.2824296, fax: ++49.(0)6421.2828950, web:
> gis-ma.org, giswerk.org, moc.environmentalinformatics-marburg.de
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
In God we trust, all others bring data.

	[[alternative HTML version deleted]]


From tkeitt at utexas.edu  Tue Feb 21 04:15:29 2017
From: tkeitt at utexas.edu (Tim Keitt)
Date: Mon, 20 Feb 2017 21:15:29 -0600
Subject: [R-sig-Geo] Optimizing spatial query in R
In-Reply-To: <CAJ7XRod0RTOmkwdpZmfTN86+Z2Ra39ne+02mVFPTw129418=CA@mail.gmail.com>
References: <CAJ7XRod0RTOmkwdpZmfTN86+Z2Ra39ne+02mVFPTw129418=CA@mail.gmail.com>
Message-ID: <CANnL8grgfPw5Ot0MxPMnbOVtX8rSscAXfNSH2RqL3zZRTVpfqA@mail.gmail.com>

I generally use postgis for this sort of thing.

THK

http://www.keittlab.org/

On Mon, Feb 20, 2017 at 2:45 AM, Ervan Rutishauser <er.rutishauser at gmail.com
> wrote:

> Dear All,
>
> I am desperately trying to fasten my algorithm to estimate the fraction of
> tree crown that overlap a given 10x10 subplot in a forest plot. I have
> combined a set of spatial functions (gDistance, extract)  & objects
> (SpatialGrid, SpatialPolygons) in a way that is probably not the most
> efficient, as it takes dozen of hours to run for a 50000 subplots (50 ha
> forest plot).
>
> My detailed problem and a reproducible example are posted on Stackoverflow
> <http://stackoverflow.com/questions/42303559/optimizing-spatial-query-in-r>
> and
> append below, if you wanna have a look. Apart of Amazon Web Server, is
> anyone aware of a sever where to execute (and save results back) R codes
> online?
> Thanks for any help.
> Best regards,
>
>
> # A. Define objects
>     require(sp)
>     require(raster)
>     require(rgdal)
>     require(rgeos)
>     require(dismo)
>     radius=25   # max search radius around 10 x 10 m cells
>     res <- vector() # where to store results
>
>     # Create a fake set of trees with x,y coordinates and trunk diameter
> (=dbh)
>     set.seed(0)
>     survey <- data.frame(x=sample(99,1000,replace=T),y=sample(99,1000,
> replace=T),dbh=sample(100,1000,replace=T))
>     coordinates(survey) <- ~x+y
>
>     # Define 10 x 10 subplots
>     grid10 <- SpatialGrid(GridTopology(c(5,5),c(10,10),c(10,10)))
>     survey$subplot <- over(survey,grid10)
> # B. Now find fraction of tree crown overlapping each subplot
>     for (i in 1:100) {
>         # Extract centro?d of each the ith cell
>         centro <- expand.grid(x=seq(5,95,10),y=seq(5,95,10))[i,]
>         corner <-
> data.frame(x=c(centro$x-5,centro$x+5,centro$x+5,centro$
> x-5),y=c(centro$y-5,centro$y-5,centro$y+5,centro$y+5))
>
>
>         # Find trees in a max radius (define above)
>         tem <- survey[which((centro$x-survey$x)^2+(centro$y-survey$y)^2<=
> radius^2),]
>
>
>         # Define tree crown based on tree diameter
>         tem$crownr <- exp(-.438+.658*log(tem$dbh/10)) # crown radius in
> meter
>
>         # Compute the distance from each tree to cell's borders
>         pDist <- vector()
>         for (k in 1:nrow(tem))  {
>             pDist[k] <-
> gDistance(tem[k,],SpatialPolygons(list(Polygons(
> list(Polygon(corner)),1))))
>         }
>
>         # Keeps only trees whose crown is lower than the above
> distance (=overlap)
>         overlap.trees <- tem[which(pDist<=tem$crownr),]
>         overlap.trees$crowna <-overlap.trees$crownr^2*pi  # compute crown
> area
>
>         # Creat polygons from overlapping crowns
>         c1 <- circles(coordinates(overlap.trees),overlap.trees$crownr,
> lonlat=F, dissolve=F)
>         crown <- polygons(c1)
>         Crown <-
> SpatialPolygonsDataFrame(polygons(c1),data=data.frame(
> dbh=overlap.trees$dbh,crown.area=overlap.trees$crowna))
>
>         # Create a fine grid points to retrieve the fraction of
> overlapping crowns
>         max.dist <- ceiling(sqrt(which.max((centro$x -
> overlap.trees$x)^2 + (centro$y - overlap.trees$y)^2))) # max distance
> to narrow search
>
>         finegrid <-
> as.data.frame(expand.grid(x=seq(centro$x-max.dist,centro$
> x+max.dist,1),y=seq(centro$y-max.dist,centro$y+max.dist,1)))
>         coordinates(finegrid) <- ~ x+y
>         A <- extract(Crown,finegrid)
>         Crown at data$ID <- seq(1,length(crown),1)
>         B <- as.data.frame(table(A$poly.ID))
>         B <- merge(B,Crown at data,by.x="Var1",by.y="ID",all.x=T)
>         B$overlap <- B$Freq/B$crown.area
>         B$overlap[B$overlap>1] <- 1
>         res[i] <- sum(B$overlap)
>     }
> # C. Check the result
>     res  # sum of crown fraction overlapping each cell (works fine)
>
> --
> _____________________________
> Ervan Rutishauser, PhD
> ? <http://carboforexpert.ch/>STRI post-doctoral fellow
> CarboForExpert?
> ? <http://carboforexpert.ch/>
> ?Skype: ervan-CH
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From tristan.bourgeois at gmail.com  Wed Feb 22 11:49:56 2017
From: tristan.bourgeois at gmail.com (Tristan Bourgeois)
Date: Wed, 22 Feb 2017 11:49:56 +0100
Subject: [R-sig-Geo] Subset a SpLineDF
Message-ID: <CACNjsfXMDvKFjawonTZDWQZXm6kUUySYS7yhzpWkP1=0jovehA@mail.gmail.com>

Dear all,

I'm facing a problem I can't solve even if the solution should not be so
hard to find.

I want to delete the duplicates in a spatial  line dataframe .Those
duplicates have been created by shapesfiles merging on QGis (boundary
rivers are duplicated by the merging of neighbouring departments layers)

So here's the code I wrote :


TRONCON_TOPO_DSAV_coord <-readOGR(dsn = "Sorties/Tron?on
BDTOPO/TRONCON_TOPO_DSAV/Avec coordonn?es", layer =
"TRONCON_TOPO_DSAV_coord")
TRONCON_TOPO_DSAV_coord at data
$doublon<-duplicated(TRONCON_TOPO_DSAV_coord at data$ID)### Create a fied for
duplicate identification
TRONCON_TOPO_DSAV_coord at data<-subset(TRONCON_TOPO_DSAV_coord at data
,TRONCON_TOPO_DSAV_coord at data$doublon=="FALSE")### Subset to delete the
duplicate
TRONCON_TOPO_DSAV_coord at data ### Checking results

writeOGR(TRONCON_TOPO_DSAV_coord,dsn =
path,layer="TRONCON_TOPO_DSAV_coord_unique_test",driver ="ESRI Shapefile")


When I want to export my OGR file,  I get this error message :"Error in
writeOGR(TRONCON_TOPO_DSAV_coord, dsn = path, layer =
"TRONCON_TOPO_DSAV_coord_unique_test",  :
  number of objects mismatch


It seems that I have not the same number of objects in the different
shapefile slots.  How to update these objets after my subset ?


Cheers !

"
-- 
Tristan Bourgeois
Hydromorphologist
Seine Normandie Water Agency
Rouen, France

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Wed Feb 22 15:12:44 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 22 Feb 2017 15:12:44 +0100
Subject: [R-sig-Geo] Subset a SpLineDF
In-Reply-To: <CACNjsfXMDvKFjawonTZDWQZXm6kUUySYS7yhzpWkP1=0jovehA@mail.gmail.com>
References: <CACNjsfXMDvKFjawonTZDWQZXm6kUUySYS7yhzpWkP1=0jovehA@mail.gmail.com>
Message-ID: <c2d75407-0e1c-cdcc-1e9c-d16b81f030c1@uni-muenster.de>

By assigning slots directly, you always take a serious risk that you
create objects that are considered invalid in a next step, as is the
case in your example.

My guess is that when you subset @data, you should also replace the
@lines slot with the corresponding subset of @lines (which is a list).

The more straightforward (and safe) way is to subset the whole object as
if it were a data.frame:

TRONCON_TOPO_DSAV_coor[! TRONCON_TOPO_DSAV_coord$doublon, ]

(note the absence of @)


On 22/02/17 11:49, Tristan Bourgeois wrote:
> Dear all,
> 
> I'm facing a problem I can't solve even if the solution should not be so
> hard to find.
> 
> I want to delete the duplicates in a spatial  line dataframe .Those
> duplicates have been created by shapesfiles merging on QGis (boundary
> rivers are duplicated by the merging of neighbouring departments layers)
> 
> So here's the code I wrote :
> 
> 
> TRONCON_TOPO_DSAV_coord <-readOGR(dsn = "Sorties/Tron?on
> BDTOPO/TRONCON_TOPO_DSAV/Avec coordonn?es", layer =
> "TRONCON_TOPO_DSAV_coord")
> TRONCON_TOPO_DSAV_coord at data
> $doublon<-duplicated(TRONCON_TOPO_DSAV_coord at data$ID)### Create a fied for
> duplicate identification
> TRONCON_TOPO_DSAV_coord at data<-subset(TRONCON_TOPO_DSAV_coord at data
> ,TRONCON_TOPO_DSAV_coord at data$doublon=="FALSE")### Subset to delete the
> duplicate
> TRONCON_TOPO_DSAV_coord at data ### Checking results
> 
> writeOGR(TRONCON_TOPO_DSAV_coord,dsn =
> path,layer="TRONCON_TOPO_DSAV_coord_unique_test",driver ="ESRI Shapefile")
> 
> 
> When I want to export my OGR file,  I get this error message :"Error in
> writeOGR(TRONCON_TOPO_DSAV_coord, dsn = path, layer =
> "TRONCON_TOPO_DSAV_coord_unique_test",  :
>   number of objects mismatch
> 
> 
> It seems that I have not the same number of objects in the different
> shapefile slots.  How to update these objets after my subset ?
> 
> 
> Cheers !
> 
> "
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170222/c2f0b74d/attachment.bin>

From f.montserrat at gmail.com  Wed Feb 22 17:45:33 2017
From: f.montserrat at gmail.com (Francesc Montserrat)
Date: Wed, 22 Feb 2017 13:45:33 -0300
Subject: [R-sig-Geo] calculate selected area from stacked raster object
Message-ID: <0e18e730-0d55-c407-014e-c6e7d14217fc@gmail.com>

Dear List,

As I have only recently started using R for spatial analysis, and I am 
not a geographer or spatial data specialist by any means, I have a -what 
I presume to be- relatively simple question. I am trying to calculate 
the area of part of a stacked raster object that meets certain 
conditions. More specifically, from a dataset from the deep sea in the 
south Atlantic, I have stacked two raster objects (depth and slope) that 
are further identical in coordinate system (WGS84), x-y (Lat-Long) 
position and projection. From the stacked raster object, I would like to 
extract the part that sits between (say) 1000 and 4000 m depth, with a 
slope of more than 10 degrees. I would like to know what the areal 
extent is in square km and I would like to add it to a previously 
plotted map. Below is a reproducible example:

# Raster object containing depth values
dpt <-  raster(ncol=623, nrow=815, xmx=-31.72083, xmn=-38.50417, 
ymn=-33.8875, ymx=-28.70417)
values(dpt) <- sample(-200:-5000, size=(nrow(dpt)*ncol(dpt)), replace=T)

# Raster object containing slope values
slp <- raster(ncol=623, nrow=815, xmx=-31.72083, xmn=-38.50417, 
ymn=-33.8875, ymx=-28.70417)
values(slp) <- sample(0:30, size=(nrow(slp)*ncol(slp)), replace=T)

# Stack raster objects
stk <- stack(dpt,slp)


# Colour palette
colrs <- 
colorRampPalette(c("navyblue","dodgerblue3","cyan2","green2","darkgoldenrod1"))
# Plot raster map; does not look like ocean floor because of "sample"
plot(dpt, xlab="Longitude", ylab="Latitude", col=colrs(100), font.lab=2, 
cex.lab=1.5, las=1)


# Create a blank copy of previous raster plot
selectAtt <- raster(dpt)
# Fill in cells where Attribute(s) meet(s) conditions
selectAtt[stk$layer.1 <= -1000 & stk$layer.1 >= -4000 & stk$layer.2 >= 
10] <- 90
# Set object projection
projection(selectAtt) <- CRS("+proj=longlat +ellps=WGS84")
# Plot selection in previous raster
plot(selectAtt, col="red", add=TRUE, legend=F, proj4string=crswgs84)

#####>>> What is the area (within total area) with both depth (layer.1) 
and slope (layer.2) meeting given conditions ?

a <- stk[stk$layer.1 <= -1000 & stk$layer.1 >= -4000 & stk$layer.2 >= 10]
area(a, na.rm=T)

# This gives me the error message:
Error in (function (classes, fdef, mtable)  :
             unable to find an inherited method for function ?area? for 
signature ?"matrix"?

I have tried to find what this actually means, but I cannot find a way 
to solve this. What am I missing here ? Any help is greatly appreciated !


From ticianaz at hotmail.com  Wed Feb 22 18:03:46 2017
From: ticianaz at hotmail.com (Ticiana Grecco Zanon)
Date: Wed, 22 Feb 2017 17:03:46 +0000
Subject: [R-sig-Geo] Origin and Destination-specific doubly constrained model
Message-ID: <DM3PR17MB077925A34B328DC59969E4E3CC500@DM3PR17MB0779.namprd17.prod.outlook.com>

Hello everybody,


I would like to share a difficulty I have that it can be very easy for somebody in this forum.


I have calculated a distance parameter for the whole system in a doubly constrained model :

Model01 <- glm(Flow~Origin+Destination+log(Dij), family=poisson(link="log"),data=Base)


Now I would  like to do it, now origin-specific in the sense of Fotheringham (1981, 1983 and so one), that is, for each origin, a distance decay paramater with the purpose to see the spatial structure of the flows.


I suppose it is as bellow meanwhhile I am not sure.


Model02 <- glm(Flow~Origin+Destination+factor(Origin)xlog(Dij), family=poisson(link="log"),data=Base)


Thanks in advance,

Ticiana


	[[alternative HTML version deleted]]


From martazores at gmail.com  Thu Feb 23 20:27:26 2017
From: martazores at gmail.com (marta azores)
Date: Thu, 23 Feb 2017 18:27:26 -0100
Subject: [R-sig-Geo] split SLDF with attributes
Message-ID: <CAE3WKgS9ynXxcLTv1st3b_PDiSuNCYVxPsWsickB+Gai=GvKkA@mail.gmail.com>

Hi all,

I am working with a large datasets of boat positions, and based on this
points I created a SpatialLinesDataFrame. Now, I would like to
split/divide SpatialLinesDataframe
into n segments of 10km and keep the attributes. So far, I have tried
multiple things:

1.      The function from this website: http://rstudio-pubs-static.s3.
amazonaws.com/10685_1f7266d60db7432486517a111c76ac8b.html. The problem with
it is that the function cuts the lines in segments of 10km but it is not
possible to get the attributes.

2.      I have also tried the function from this website:
http://stackoverflow.com/questions/38700246/how-do-i-split-divide-polyline-
shapefiles-into-equally-length-smaller-segments. The problem is that do not
cut the segments in 10km, and it seems to cut the segments with random
lengths.

3.      On the follwoing website: http://r-sig-geo.2731867.n2.
nabble.com/split-divide-SpatialLines-sp-into-n-segments-td7583234.html#
a7583629 propose to divide lines by segments but do not specify how it is
possible to do in based on the length of the segment.

Is there any function to do this in R? Or does somebody know the solution
for that?

My data looks like this:

#Script:

path_data <- "C:/R/"

mergedDF_1_DF_short<- shapefile(path_data,"mergedDF_1_DF_short")


https://drive.google.com/drive/folders/0B7IbvWhE5JNPT0oxUklpd3ZnRzA?usp=sharing

	[[alternative HTML version deleted]]


From loic.dutrieux at conabio.gob.mx  Thu Feb 23 23:44:05 2017
From: loic.dutrieux at conabio.gob.mx (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Thu, 23 Feb 2017 16:44:05 -0600
Subject: [R-sig-Geo] calculate selected area from stacked raster object
In-Reply-To: <0e18e730-0d55-c407-014e-c6e7d14217fc@gmail.com>
References: <0e18e730-0d55-c407-014e-c6e7d14217fc@gmail.com>
Message-ID: <ad0f098d-5bfd-6b5c-712a-27a3dcf99dd3@conabio.gob.mx>

Thanks for providing an example, see the suggestion inline

On 22/02/2017 10:45, Francesc Montserrat wrote:
> Dear List,
> 
> As I have only recently started using R for spatial analysis, and I am
> not a geographer or spatial data specialist by any means, I have a -what
> I presume to be- relatively simple question. I am trying to calculate
> the area of part of a stacked raster object that meets certain
> conditions. More specifically, from a dataset from the deep sea in the
> south Atlantic, I have stacked two raster objects (depth and slope) that
> are further identical in coordinate system (WGS84), x-y (Lat-Long)
> position and projection. From the stacked raster object, I would like to
> extract the part that sits between (say) 1000 and 4000 m depth, with a
> slope of more than 10 degrees. I would like to know what the areal
> extent is in square km and I would like to add it to a previously
> plotted map. Below is a reproducible example:
> 
> # Raster object containing depth values
> dpt <-  raster(ncol=623, nrow=815, xmx=-31.72083, xmn=-38.50417,
> ymn=-33.8875, ymx=-28.70417)
> values(dpt) <- sample(-200:-5000, size=(nrow(dpt)*ncol(dpt)), replace=T)
> 
> # Raster object containing slope values
> slp <- raster(ncol=623, nrow=815, xmx=-31.72083, xmn=-38.50417,
> ymn=-33.8875, ymx=-28.70417)
> values(slp) <- sample(0:30, size=(nrow(slp)*ncol(slp)), replace=T)
> 
> # Stack raster objects
> stk <- stack(dpt,slp)
> 
# Define function to be passed to calc
fun <- function(x) {
  # consider x to be a vector of length 2
  ifelse(x[1] <= -1000 & x[1] >= -4000 & x[2] >= 10, 1, NA)
}

condition_raster <- calc(x = stk, fun = fun)
area_raster <- area(condition_raster, na.rm = TRUE)
cellStats(area_raster, 'sum')

Cheers,
Lo?c

> 
> # Colour palette
> colrs <-
> colorRampPalette(c("navyblue","dodgerblue3","cyan2","green2","darkgoldenrod1"))
> 
> # Plot raster map; does not look like ocean floor because of "sample"
> plot(dpt, xlab="Longitude", ylab="Latitude", col=colrs(100), font.lab=2,
> cex.lab=1.5, las=1)
> 
> 
> # Create a blank copy of previous raster plot
> selectAtt <- raster(dpt)
> # Fill in cells where Attribute(s) meet(s) conditions
> selectAtt[stk$layer.1 <= -1000 & stk$layer.1 >= -4000 & stk$layer.2 >=
> 10] <- 90
> # Set object projection
> projection(selectAtt) <- CRS("+proj=longlat +ellps=WGS84")
> # Plot selection in previous raster
> plot(selectAtt, col="red", add=TRUE, legend=F, proj4string=crswgs84)
> 
> #####>>> What is the area (within total area) with both depth (layer.1)
> and slope (layer.2) meeting given conditions ?
> 
> a <- stk[stk$layer.1 <= -1000 & stk$layer.1 >= -4000 & stk$layer.2 >= 10]
> area(a, na.rm=T)
> 
> # This gives me the error message:
> Error in (function (classes, fdef, mtable)  :
>             unable to find an inherited method for function ?area? for
> signature ?"matrix"?
> 
> I have tried to find what this actually means, but I cannot find a way
> to solve this. What am I missing here ? Any help is greatly appreciated !
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mel at mbacou.com  Fri Feb 24 07:45:47 2017
From: mel at mbacou.com (Bacou, Melanie)
Date: Fri, 24 Feb 2017 01:45:47 -0500
Subject: [R-sig-Geo] split SLDF with attributes
In-Reply-To: <CAE3WKgS9ynXxcLTv1st3b_PDiSuNCYVxPsWsickB+Gai=GvKkA@mail.gmail.com>
References: <CAE3WKgS9ynXxcLTv1st3b_PDiSuNCYVxPsWsickB+Gai=GvKkA@mail.gmail.com>
Message-ID: <172de96d-0a8d-d7aa-4706-5d2cac7caa0c@mbacou.com>

Marta,
Option 1) using CreateSegments() seems to do what you want. Why don't 
you simply use rgeos::over() or rgeos::gTouches() between your old and 
new SLDFs to match the index positions of your old attributes to your 
new segments?

--Mel.


On 2/23/2017 2:27 PM, marta azores wrote:
> Hi all,
>
> I am working with a large datasets of boat positions, and based on this
> points I created a SpatialLinesDataFrame. Now, I would like to
> split/divide SpatialLinesDataframe
> into n segments of 10km and keep the attributes. So far, I have tried
> multiple things:
>
> 1.      The function from this website: http://rstudio-pubs-static.s3.
> amazonaws.com/10685_1f7266d60db7432486517a111c76ac8b.html. The problem with
> it is that the function cuts the lines in segments of 10km but it is not
> possible to get the attributes.
>
> 2.      I have also tried the function from this website:
> http://stackoverflow.com/questions/38700246/how-do-i-split-divide-polyline-
> shapefiles-into-equally-length-smaller-segments. The problem is that do not
> cut the segments in 10km, and it seems to cut the segments with random
> lengths.
>
> 3.      On the follwoing website: http://r-sig-geo.2731867.n2.
> nabble.com/split-divide-SpatialLines-sp-into-n-segments-td7583234.html#
> a7583629 propose to divide lines by segments but do not specify how it is
> possible to do in based on the length of the segment.
>
> Is there any function to do this in R? Or does somebody know the solution
> for that?
>
> My data looks like this:
>
> #Script:
>
> path_data <- "C:/R/"
>
> mergedDF_1_DF_short<- shapefile(path_data,"mergedDF_1_DF_short")
>
>
> https://drive.google.com/drive/folders/0B7IbvWhE5JNPT0oxUklpd3ZnRzA?usp=sharing
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From martazores at gmail.com  Fri Feb 24 16:31:21 2017
From: martazores at gmail.com (marta azores)
Date: Fri, 24 Feb 2017 14:31:21 -0100
Subject: [R-sig-Geo] split SLDF with attributes
In-Reply-To: <172de96d-0a8d-d7aa-4706-5d2cac7caa0c@mbacou.com>
References: <CAE3WKgS9ynXxcLTv1st3b_PDiSuNCYVxPsWsickB+Gai=GvKkA@mail.gmail.com>
	<172de96d-0a8d-d7aa-4706-5d2cac7caa0c@mbacou.com>
Message-ID: <CAE3WKgSvGOjrJoPJmTeofzsUcF+fw53CqqgjUw5FW_g10FKsYw@mail.gmail.com>

Thanks for your answer Mel,
Option1) Createsegments: this script cut the SLDF...but as autoridades said
um the website...The results are spatiallines, not SLDF. Then, they don't
jeep the attributes.
Option2) rgeos:over I know this tool, but O have several lines crossing
among them. I am afraid, that can be a bit messy.
I doesn't know the gTouches...I check it after your suggestion..
But I think the rgeos:Over os the best option for me.
Thanks for your suggestion
Marta



No dia sexta-feira, 24 de fevereiro de 2017, Bacou, Melanie <mel at mbacou.com>
escreveu:

> Marta,
> Option 1) using CreateSegments() seems to do what you want. Why don't you
> simply use rgeos::over() or rgeos::gTouches() between your old and new
> SLDFs to match the index positions of your old attributes to your new
> segments?
>
> --Mel.
>
>
> On 2/23/2017 2:27 PM, marta azores wrote:
>
>> Hi all,
>>
>> I am working with a large datasets of boat positions, and based on this
>> points I created a SpatialLinesDataFrame. Now, I would like to
>> split/divide SpatialLinesDataframe
>> into n segments of 10km and keep the attributes. So far, I have tried
>> multiple things:
>>
>> 1.      The function from this website: http://rstudio-pubs-static.s3.
>> amazonaws.com/10685_1f7266d60db7432486517a111c76ac8b.html. The problem
>> with
>> it is that the function cuts the lines in segments of 10km but it is not
>> possible to get the attributes.
>>
>> 2.      I have also tried the function from this website:
>> http://stackoverflow.com/questions/38700246/how-do-i-split-
>> divide-polyline-
>> shapefiles-into-equally-length-smaller-segments. The problem is that do
>> not
>> cut the segments in 10km, and it seems to cut the segments with random
>> lengths.
>>
>> 3.      On the follwoing website: http://r-sig-geo.2731867.n2.
>> nabble.com/split-divide-SpatialLines-sp-into-n-segments-td7583234.html#
>> a7583629 propose to divide lines by segments but do not specify how it is
>> possible to do in based on the length of the segment.
>>
>> Is there any function to do this in R? Or does somebody know the solution
>> for that?
>>
>> My data looks like this:
>>
>> #Script:
>>
>> path_data <- "C:/R/"
>>
>> mergedDF_1_DF_short<- shapefile(path_data,"mergedDF_1_DF_short")
>>
>>
>> https://drive.google.com/drive/folders/0B7IbvWhE5JNPT0oxUklp
>> d3ZnRzA?usp=sharing
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From mel at mbacou.com  Fri Feb 24 22:13:41 2017
From: mel at mbacou.com (Bacou, Melanie)
Date: Fri, 24 Feb 2017 16:13:41 -0500
Subject: [R-sig-Geo] split SLDF with attributes
In-Reply-To: <CAE3WKgSvGOjrJoPJmTeofzsUcF+fw53CqqgjUw5FW_g10FKsYw@mail.gmail.com>
References: <CAE3WKgS9ynXxcLTv1st3b_PDiSuNCYVxPsWsickB+Gai=GvKkA@mail.gmail.com>
	<172de96d-0a8d-d7aa-4706-5d2cac7caa0c@mbacou.com>
	<CAE3WKgSvGOjrJoPJmTeofzsUcF+fw53CqqgjUw5FW_g10FKsYw@mail.gmail.com>
Message-ID: <2a9c2dbe-9197-1e8f-6d8d-63861d42943d@mbacou.com>

Marta,
Since you have intersecting lines in your SLDF, another approach might 
be to use a loop (!) through your SpatialLines objects and carry the 
attributes, something like:

library(raster)

sldf_in <- shapefile("mergedDF_1_DF_short")

# Init a list to keep all segments
sldf_list <- vector("list", nrow(sldf_in))
names(sldf_list) <- row.names(sldf_in)

for (i in names(sldf_list)) {
   sl <- SegmentSpatialLines(as(sldf_in[i,], "SpatialLines"), 
length=10000, merge.last=TRUE)
   df <- sldf_in[i,]@data
   df <- df[rep(seq_len(nrow(df)), length(sl)), ]
   df$ID <- i
   sldf_list[[i]] <- SpatialLinesDataFrame(sl, df, match.ID=FALSE)
   # Make arbitrary unique IDs (for combining in next step)
   sldf_list[[i]] <- spChFIDs(sldf_list[[i]], paste(i, 
row.names(sldf_list[[i]]), sep="-"))
}

# Combine into a unique SLDF
sldf_out <- do.call(rbind, sldf_list)


--Mel.



On 2/24/2017 10:31 AM, marta azores wrote:
> Thanks for your answer Mel,
> Option1) Createsegments: this script cut the SLDF...but as autoridades 
> said um the website...The results are spatiallines, not SLDF. Then, 
> they don't jeep the attributes.
> Option2) rgeos:over I know this tool, but O have several lines 
> crossing among them. I am afraid, that can be a bit messy.
> I doesn't know the gTouches...I check it after your suggestion..
> But I think the rgeos:Over os the best option for me.
> Thanks for your suggestion
> Marta
>
>
>
> No dia sexta-feira, 24 de fevereiro de 2017, Bacou, Melanie 
> <mel at mbacou.com <mailto:mel at mbacou.com>> escreveu:
>
>     Marta,
>     Option 1) using CreateSegments() seems to do what you want. Why
>     don't you simply use rgeos::over() or rgeos::gTouches() between
>     your old and new SLDFs to match the index positions of your old
>     attributes to your new segments?
>
>     --Mel.
>
>
>     On 2/23/2017 2:27 PM, marta azores wrote:
>
>         Hi all,
>
>         I am working with a large datasets of boat positions, and
>         based on this
>         points I created a SpatialLinesDataFrame. Now, I would like to
>         split/divide SpatialLinesDataframe
>         into n segments of 10km and keep the attributes. So far, I
>         have tried
>         multiple things:
>
>         1.      The function from this website:
>         http://rstudio-pubs-static.s3.
>         amazonaws.com/10685_1f7266d60db7432486517a111c76ac8b.html
>         <http://amazonaws.com/10685_1f7266d60db7432486517a111c76ac8b.html>.
>         The problem with
>         it is that the function cuts the lines in segments of 10km but
>         it is not
>         possible to get the attributes.
>
>         2.      I have also tried the function from this website:
>         http://stackoverflow.com/questions/38700246/how-do-i-split-divide-polyline-
>         <http://stackoverflow.com/questions/38700246/how-do-i-split-divide-polyline->
>         shapefiles-into-equally-length-smaller-segments. The problem
>         is that do not
>         cut the segments in 10km, and it seems to cut the segments
>         with random
>         lengths.
>
>         3.      On the follwoing website: http://r-sig-geo.2731867.n2.
>         nabble.com/split-divide-SpatialLines-sp-into-n-segments-td7583234.html#
>         <http://nabble.com/split-divide-SpatialLines-sp-into-n-segments-td7583234.html#>
>         a7583629 propose to divide lines by segments but do not
>         specify how it is
>         possible to do in based on the length of the segment.
>
>         Is there any function to do this in R? Or does somebody know
>         the solution
>         for that?
>
>         My data looks like this:
>
>         #Script:
>
>         path_data <- "C:/R/"
>
>         mergedDF_1_DF_short<- shapefile(path_data,"mergedDF_1_DF_short")
>
>
>         https://drive.google.com/drive/folders/0B7IbvWhE5JNPT0oxUklpd3ZnRzA?usp=sharing
>         <https://drive.google.com/drive/folders/0B7IbvWhE5JNPT0oxUklpd3ZnRzA?usp=sharing>
>
>                 [[alternative HTML version deleted]]
>
>         _______________________________________________
>         R-sig-Geo mailing list
>         R-sig-Geo at r-project.org
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>         <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>


	[[alternative HTML version deleted]]


From Tom.Hilinski at colostate.edu  Sat Feb 25 20:03:18 2017
From: Tom.Hilinski at colostate.edu (Tom Hilinski)
Date: Sat, 25 Feb 2017 12:03:18 -0700
Subject: [R-sig-Geo] raster brick from netcdf - specify range
Message-ID: <5fe72f8d-21f6-7998-fe36-cceb35ac6e13@ColoState.edu>

Want to read part of a netcdf file into a raster brick. The file (in
ncdf4 order) contains a variable
pre[lon, lat, time]
and those dimensions are: 720, 360, 1356

The following reads in all time layers:
rb <- brick( filename, varname=varname, nl=2 )

> rb
class       : RasterBrick
dimensions  : 360, 720, 259200, 1356  (nrow, ncol, ncell, nlayers)
resolution  : 0.5, 0.5  (x, y)
extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
z-value     : 12, 1367 (min, max)
varname     : pre

Likewise, I've had no success limiting the read using xmn, xmx, ymn,
ymx, or template. The help page for brick suggests that all these should
work, or at least, it does not seem say that they don't work for netcdf
files.

My workaround requires directly reading the netcdf file, then making a
brick from that array, but when reading finer resolution data, the
memory use and speed could be an issue due to creating 2 objects instead
of 1.

raster version = 2.5-8

I'd appreciate any suggestions about this.


From alobolistas at gmail.com  Sun Feb 26 11:41:14 2017
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 26 Feb 2017 11:41:14 +0100
Subject: [R-sig-Geo] Assign a unique ID number to each patch in a raster
In-Reply-To: <5279176F-2E00-40D6-9ECD-3F5421837704@bigelow.org>
References: <CY1PR05MB2730189CEEB4C9EC0AE442E199770@CY1PR05MB2730.namprd05.prod.outlook.com>
	<5279176F-2E00-40D6-9ECD-3F5421837704@bigelow.org>
Message-ID: <CAG4NRe+-kkLQwvJ7ziPmWBjHRkuj_=AqqC26fyv5AC2vYF6Ybw@mail.gmail.com>

I think Nelly points out that package raster lacks a more general
clumping tool (i.e., the equivalent to r.clump in grass) that I've
often missed too.
I'm not sure circumventing the way Ben suggest would work for large
raster layers, for which package raster was designed.
I have a note to myself regarding this
https://gist.github.com/johnbaums/6d155cfca28e02b05ad5
and
www.openforis.org/tools/geospatial-toolkit.html
but have not tried it.

Agus

On Fri, Jan 27, 2017 at 1:19 AM, Ben Tupper <btupper at bigelow.org> wrote:
> Hi,
>
> I think you are asking for connected component labeling. raster::clump() expects your features to be like islands surrounded by NA or 0 background. There might be more Raster* centric ways to do it, but you could use plain old vanilla image processing using the very good imager package ( https://cran.r-project.org/web/packages/imager/ <https://cran.r-project.org/web/packages/imager/> ).  The steps below show in color your actual values with the connected component IDs labeled on each cell.  I used the 8-connected labeling but 4-connected is also available.
>
> library(raster)
> library(imager)
>
> set.seed(10)
> nc <- 8
> nr <- 8
> MIN <- 1
> MAX <- 4
> LUT <- c("orange", "green", "darkgoldenrod", "cornflowerblue")
>
> r <- raster(ncols=nc, nrows=nr)
> r[] <- round(runif(ncell(r),MIN, MAX),digits=0)
> cc <- r
>
> img <- imager::as.cimg(as.matrix(r))
> labeled <- imager::label(img, high_connectivity = TRUE)
> cc[] <- as.matrix(labeled)
>
> plot(r, col = LUT)
> txt <- cc[]
> xy <- raster::xyFromCell(cc, 1:raster::ncell(cc))
> text(xy[,1], xy[,2], txt )
>
>
> Cheers,
> Ben
>> On Jan 26, 2017, at 4:48 PM, Nelly Reduan <nell.redu at hotmail.fr> wrote:
>>
>> Hello,
>> I would like to assign a unique ID number to each patch (a patch is composed of a set of adjacent cells) as shown in this figure:
>>  <2328.png>
>>
>> I tested the clump function (package raster) by applying an eight adjacent cells rule but this function mixes all cell values into single patch.
>>
>> Here is a code example to create a raster. The raster contains values ranged from 1 to 9.
>> r <- raster(ncols=12, nrows=12)
>> r[] <- round(runif(ncell(r),1,9),digits=0)
>> plot(r)
>>
>> Is there a way to assign a unique ID number to grouping cells that form a patch for each class (i.e., values 1, 2, 3, 4, 5, 6, 7, 8, 9) ?
>>
>> Thanks a lot for your time
>> Nell
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> Ben Tupper
> Bigelow Laboratory for Ocean Sciences
> 60 Bigelow Drive, P.O. Box 380
> East Boothbay, Maine 04544
> http://www.bigelow.org
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Sun Feb 26 12:15:54 2017
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 26 Feb 2017 12:15:54 +0100
Subject: [R-sig-Geo] rasterTopolygons: singleparts often needed
Message-ID: <CAG4NReL+635VOfaJK4C8xZLfHGSoo18UH4kH5Lht77L9KjHYjg@mail.gmail.com>

Could raster::rasterTopolygons() be modified in future versions
to optionally output singlepart polygons? e.g, in the following
r <-raster(nrow=16, ncol=16)
d <- rep(rep(1:4,rep(4,4)),8)
r[] <- c(d,rev(d))
plot(r)
v <- rasterToPolygons(r,dissolve=TRUE)
plot(v[1,])
dim(v at data)

the new option
v <- rasterToPolygons(r,dissolve=TRUE,single=TRUE)
would result on
plot(v[1,])
displaying one single square and
dim(v at data)
would be 8 rows and 1 column

(equivalent to gdal_polygonize)

Agus


From johnbaums at gmail.com  Sun Feb 26 13:09:34 2017
From: johnbaums at gmail.com (John Baumgartner)
Date: Sun, 26 Feb 2017 12:09:34 +0000
Subject: [R-sig-Geo] Assign a unique ID number to each patch in a raster
In-Reply-To: <CAG4NRe+-kkLQwvJ7ziPmWBjHRkuj_=AqqC26fyv5AC2vYF6Ybw@mail.gmail.com>
References: <CY1PR05MB2730189CEEB4C9EC0AE442E199770@CY1PR05MB2730.namprd05.prod.outlook.com>
	<5279176F-2E00-40D6-9ECD-3F5421837704@bigelow.org>
	<CAG4NRe+-kkLQwvJ7ziPmWBjHRkuj_=AqqC26fyv5AC2vYF6Ybw@mail.gmail.com>
Message-ID: <CACpmSOsq8SpwBsVHtxR_oyTPF-3GGTvLSybLzjqf5kMBB+H-8A@mail.gmail.com>

Yes, my gist mentioned by Agustin should do the trick. See the example in
the comment at https://gist.github.com/johnbaums/6d155cfca28e02b05ad5.

On Sun, 26 Feb 2017 at 21:42, Agustin Lobo <alobolistas at gmail.com> wrote:

> I think Nelly points out that package raster lacks a more general
>
> clumping tool (i.e., the equivalent to r.clump in grass) that I've
>
> often missed too.
>
> I'm not sure circumventing the way Ben suggest would work for large
>
> raster layers, for which package raster was designed.
>
> I have a note to myself regarding this
>
> https://gist.github.com/johnbaums/6d155cfca28e02b05ad5
>
> and
>
> www.openforis.org/tools/geospatial-toolkit.html
>
> but have not tried it.
>
>
>
> Agus
>
>
>
> On Fri, Jan 27, 2017 at 1:19 AM, Ben Tupper <btupper at bigelow.org> wrote:
>
> > Hi,
>
> >
>
> > I think you are asking for connected component labeling. raster::clump()
> expects your features to be like islands surrounded by NA or 0 background.
> There might be more Raster* centric ways to do it, but you could use plain
> old vanilla image processing using the very good imager package (
> https://cran.r-project.org/web/packages/imager/ <
> https://cran.r-project.org/web/packages/imager/> ).  The steps below show
> in color your actual values with the connected component IDs labeled on
> each cell.  I used the 8-connected labeling but 4-connected is also
> available.
>
> >
>
> > library(raster)
>
> > library(imager)
>
> >
>
> > set.seed(10)
>
> > nc <- 8
>
> > nr <- 8
>
> > MIN <- 1
>
> > MAX <- 4
>
> > LUT <- c("orange", "green", "darkgoldenrod", "cornflowerblue")
>
> >
>
> > r <- raster(ncols=nc, nrows=nr)
>
> > r[] <- round(runif(ncell(r),MIN, MAX),digits=0)
>
> > cc <- r
>
> >
>
> > img <- imager::as.cimg(as.matrix(r))
>
> > labeled <- imager::label(img, high_connectivity = TRUE)
>
> > cc[] <- as.matrix(labeled)
>
> >
>
> > plot(r, col = LUT)
>
> > txt <- cc[]
>
> > xy <- raster::xyFromCell(cc, 1:raster::ncell(cc))
>
> > text(xy[,1], xy[,2], txt )
>
> >
>
> >
>
> > Cheers,
>
> > Ben
>
> >> On Jan 26, 2017, at 4:48 PM, Nelly Reduan <nell.redu at hotmail.fr> wrote:
>
> >>
>
> >> Hello,
>
> >> I would like to assign a unique ID number to each patch (a patch is
> composed of a set of adjacent cells) as shown in this figure:
>
> >>  <2328.png>
>
> >>
>
> >> I tested the clump function (package raster) by applying an eight
> adjacent cells rule but this function mixes all cell values into single
> patch.
>
> >>
>
> >> Here is a code example to create a raster. The raster contains values
> ranged from 1 to 9.
>
> >> r <- raster(ncols=12, nrows=12)
>
> >> r[] <- round(runif(ncell(r),1,9),digits=0)
>
> >> plot(r)
>
> >>
>
> >> Is there a way to assign a unique ID number to grouping cells that form
> a patch for each class (i.e., values 1, 2, 3, 4, 5, 6, 7, 8, 9) ?
>
> >>
>
> >> Thanks a lot for your time
>
> >> Nell
>
> >>
>
> >>
>
> >> _______________________________________________
>
> >> R-sig-Geo mailing list
>
> >> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
> > Ben Tupper
>
> > Bigelow Laboratory for Ocean Sciences
>
> > 60 Bigelow Drive, P.O. Box 380
>
> > East Boothbay, Maine 04544
>
> > http://www.bigelow.org
>
> >
>
> >
>
> >
>
> >
>
> >         [[alternative HTML version deleted]]
>
> >
>
> > _______________________________________________
>
> > R-sig-Geo mailing list
>
> > R-sig-Geo at r-project.org
>
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> _______________________________________________
>
> R-sig-Geo mailing list
>
> R-sig-Geo at r-project.org
>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

	[[alternative HTML version deleted]]


From johnbaums at gmail.com  Sun Feb 26 13:14:45 2017
From: johnbaums at gmail.com (John Baumgartner)
Date: Sun, 26 Feb 2017 12:14:45 +0000
Subject: [R-sig-Geo] rasterTopolygons: singleparts often needed
In-Reply-To: <CAG4NReL+635VOfaJK4C8xZLfHGSoo18UH4kH5Lht77L9KjHYjg@mail.gmail.com>
References: <CAG4NReL+635VOfaJK4C8xZLfHGSoo18UH4kH5Lht77L9KjHYjg@mail.gmail.com>
Message-ID: <CACpmSOv=x60tUO4R1k-Mgkget3RRKAiVD04_d69PU+M17w+mLw@mail.gmail.com>

Not at my computer, but does sp::disaggregate(v) return your singlepart
polygons?

On Sun, 26 Feb 2017 at 22:40, Agustin Lobo <alobolistas at gmail.com> wrote:

> Could raster::rasterTopolygons() be modified in future versions
>
> to optionally output singlepart polygons? e.g, in the following
>
> r <-raster(nrow=16, ncol=16)
>
> d <- rep(rep(1:4,rep(4,4)),8)
>
> r[] <- c(d,rev(d))
>
> plot(r)
>
> v <- rasterToPolygons(r,dissolve=TRUE)
>
> plot(v[1,])
>
> dim(v at data)
>
>
>
> the new option
>
> v <- rasterToPolygons(r,dissolve=TRUE,single=TRUE)
>
> would result on
>
> plot(v[1,])
>
> displaying one single square and
>
> dim(v at data)
>
> would be 8 rows and 1 column
>
>
>
> (equivalent to gdal_polygonize)
>
>
>
> Agus
>
>
>
> _______________________________________________
>
> R-sig-Geo mailing list
>
> R-sig-Geo at r-project.org
>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Sun Feb 26 13:23:10 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sun, 26 Feb 2017 06:23:10 -0600
Subject: [R-sig-Geo] How to draw a legend when plotting sf (simple feature)
	objects
Message-ID: <CABkCotTbjzvEh1dwsb0E5Z4Qn28Hp5Zfm1xbx8oFaMjCNYsy0A@mail.gmail.com>

Dear list members,

How can I draw a legend when plotting an sf (simple feature) object.

nc = st_read(system.file("gpkg/nc.gpkg", package="sf"), quiet = TRUE)

plot(nc["SID79"])



Best,

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Sun Feb 26 18:46:25 2017
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 26 Feb 2017 18:46:25 +0100
Subject: [R-sig-Geo] How to draw a legend when plotting sf (simple
 feature) objects
In-Reply-To: <CABkCotTbjzvEh1dwsb0E5Z4Qn28Hp5Zfm1xbx8oFaMjCNYsy0A@mail.gmail.com>
References: <CABkCotTbjzvEh1dwsb0E5Z4Qn28Hp5Zfm1xbx8oFaMjCNYsy0A@mail.gmail.com>
Message-ID: <a327b658-aeb8-70a7-aedf-86bc4b262fdd@uni-muenster.de>



On 26/02/17 13:23, Manuel Sp?nola wrote:
> Dear list members,
> 
> How can I draw a legend when plotting an sf (simple feature) object.
> 
> nc = st_read(system.file("gpkg/nc.gpkg", package="sf"), quiet = TRUE)
> 
> plot(nc["SID79"])
> 

You're in base plot, so at this moment you can add elements
incrementally to the plot, see e.g. ?legend.

I have no plans of making this easy or automatic, because I don't think
that base plot is the right place for it (although packages raster,
spatstat and fields try hard), but would happily consider contributions.

geom_sf in ggplot2 (now in sf branch on github) will follow up
sp::spplot for sf objects; see e.g.

https://github.com/edzer/sfr/issues/88#issuecomment-276738460

nc <- sf::st_read(system.file("shape/nc.shp", package = "sf"), quiet = TRUE)
ggplot(nc) + geom_sf(aes(fill = SID79))

Trying this with the gpkg you read in above fails for me; it looks like
ggplot now wrongly assumes that geometry columns are always called
`geometry' (despite the docs), which is not the case.
-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20170226/ab55b362/attachment.bin>

From mspinola10 at gmail.com  Sun Feb 26 19:17:25 2017
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sun, 26 Feb 2017 12:17:25 -0600
Subject: [R-sig-Geo] How to draw a legend when plotting sf (simple
 feature) objects
In-Reply-To: <a327b658-aeb8-70a7-aedf-86bc4b262fdd@uni-muenster.de>
References: <CABkCotTbjzvEh1dwsb0E5Z4Qn28Hp5Zfm1xbx8oFaMjCNYsy0A@mail.gmail.com>
	<a327b658-aeb8-70a7-aedf-86bc4b262fdd@uni-muenster.de>
Message-ID: <CABkCotS+XYzUB9BdE=uk=BxcSJ-zaMEZ+t_zmpHaNnossOfF2Q@mail.gmail.com>

Thank you very much Edzer,

it works for me:

> ggplot(nc) + geom_sf(aes(fill = SID79))
Warning message:
st_crs<- : replacing crs does not reproject data; use st_transform for that

2017-02-26 11:46 GMT-06:00 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:

>
>
> On 26/02/17 13:23, Manuel Sp?nola wrote:
> > Dear list members,
> >
> > How can I draw a legend when plotting an sf (simple feature) object.
> >
> > nc = st_read(system.file("gpkg/nc.gpkg", package="sf"), quiet = TRUE)
> >
> > plot(nc["SID79"])
> >
>
> You're in base plot, so at this moment you can add elements
> incrementally to the plot, see e.g. ?legend.
>
> I have no plans of making this easy or automatic, because I don't think
> that base plot is the right place for it (although packages raster,
> spatstat and fields try hard), but would happily consider contributions.
>
> geom_sf in ggplot2 (now in sf branch on github) will follow up
> sp::spplot for sf objects; see e.g.
>
> https://github.com/edzer/sfr/issues/88#issuecomment-276738460
>
> nc <- sf::st_read(system.file("shape/nc.shp", package = "sf"), quiet =
> TRUE)
> ggplot(nc) + geom_sf(aes(fill = SID79))
>
> Trying this with the gpkg you read in above fails for me; it looks like
> ggplot now wrongly assumes that geometry columns are always called
> `geometry' (despite the docs), which is not the case.
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From alobolistas at gmail.com  Sun Feb 26 20:39:32 2017
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 26 Feb 2017 20:39:32 +0100
Subject: [R-sig-Geo] rasterTopolygons: singleparts often needed
In-Reply-To: <CACpmSOv=x60tUO4R1k-Mgkget3RRKAiVD04_d69PU+M17w+mLw@mail.gmail.com>
References: <CAG4NReL+635VOfaJK4C8xZLfHGSoo18UH4kH5Lht77L9KjHYjg@mail.gmail.com>
	<CACpmSOv=x60tUO4R1k-Mgkget3RRKAiVD04_d69PU+M17w+mLw@mail.gmail.com>
Message-ID: <CAG4NReJVFqd_n7wKvRO-UhPOmdsncT3Md4mni+5bdek8kTgXUQ@mail.gmail.com>

Yes, this is correct. I refer to integrating disaggregate as an option, as
I think that this is what the user needs in most cases.
Agus

On Sun, Feb 26, 2017 at 1:14 PM, John Baumgartner <johnbaums at gmail.com> wrote:
> Not at my computer, but does sp::disaggregate(v) return your singlepart
> polygons?
>
> On Sun, 26 Feb 2017 at 22:40, Agustin Lobo <alobolistas at gmail.com> wrote:
>
>> Could raster::rasterTopolygons() be modified in future versions
>>
>> to optionally output singlepart polygons? e.g, in the following
>>
>> r <-raster(nrow=16, ncol=16)
>>
>> d <- rep(rep(1:4,rep(4,4)),8)
>>
>> r[] <- c(d,rev(d))
>>
>> plot(r)
>>
>> v <- rasterToPolygons(r,dissolve=TRUE)
>>
>> plot(v[1,])
>>
>> dim(v at data)
>>
>>
>>
>> the new option
>>
>> v <- rasterToPolygons(r,dissolve=TRUE,single=TRUE)
>>
>> would result on
>>
>> plot(v[1,])
>>
>> displaying one single square and
>>
>> dim(v at data)
>>
>> would be 8 rows and 1 column
>>
>>
>>
>> (equivalent to gdal_polygonize)
>>
>>
>>
>> Agus
>>
>>
>>
>> _______________________________________________
>>
>> R-sig-Geo mailing list
>>
>> R-sig-Geo at r-project.org
>>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


