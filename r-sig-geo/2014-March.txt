From sidup.sirabaha at gmail.com  Sun Mar  2 02:50:54 2014
From: sidup.sirabaha at gmail.com (Hj Sidup Hj Sirabaha)
Date: Sun, 2 Mar 2014 09:50:54 +0800
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 126, Issue 22
In-Reply-To: <mailman.13.1393326005.19947.r-sig-geo@r-project.org>
References: <mailman.13.1393326005.19947.r-sig-geo@r-project.org>
Message-ID: <EE028EB7-D18F-452D-A415-7E6ADA13ABB9@gmail.com>

ry

Sent from my iPhone

> On 25 Feb, 2014, at 7:00 pm, r-sig-geo-request at r-project.org wrote:
> 
> Send R-sig-Geo mailing list submissions to
>    r-sig-geo at r-project.org
> 
> To subscribe or unsubscribe via the World Wide Web, visit
>    https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help' to
>    r-sig-geo-request at r-project.org
> 
> You can reach the person managing the list at
>    r-sig-geo-owner at r-project.org
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of R-sig-Geo digest..."hpjtk c nhutb
> 
> 
> Today's Topics:
> 
>   1. ifelse with multiple rasters (Laura Poggio)
>   2. Fwd: ifelse with multiple rasters (Laura Poggio)
>   3. Re: Fwd: ifelse with multiple rasters (Jonathan Greenberg)
>   4. How to do an anamorphosis on R? (Gilles Benjamin Leduc)
>   5. Re: Fwd: ifelse with multiple rasters (Laura Poggio)
>   6. Extract time series value for a given coodinate from an
>      unusual NetCDF file (ping yang)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Mon, 24 Feb 2014 14:15:22 +0000
> From: Laura Poggio <laura.poggio at gmail.com>
> To: R geo forum <r-sig-geo at stat.math.ethz.ch>
> Subject: [R-sig-Geo] ifelse with multiple rasters
> Message-ID:
>    <CAKmfgFPL1PKzx0DGBYRGQXM5gGhzbAzB8fDceYoT8vW6JmeFLA at mail.gmail.com>
> Content-Type: text/plain
> 
> Dear list,
> I am struggling to find a way to do a simple if statement with multiple
> rasters in raster.
> 
> For example:
> ifelse(rst_a==0 & rst_B=1,2,0)
> 
> Which is the simplest and most efficient way to implement it? especially
> when considering large (>10,000,000 cells) rasters?
> 
> Thank you in advance
> 
> Laura
> 
>    [[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------
> 
> Message: 2
> Date: Mon, 24 Feb 2014 14:16:33 +0000
> From: Laura Poggio <laura.poggio at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Fwd: ifelse with multiple rasters
> Message-ID:
>    <CAKmfgFNOZpi0QR4KPrCddAf9O12rYKv0EAeSu5Rom7qVfPWRSA at mail.gmail.com>
> Content-Type: text/plain
> 
> Dear list,
> I am struggling to find a way to do a simple if statement with multiple
> rasters in raster.
> 
> For example:
> ifelse(rst_a==0 & rst_B=1,2,0)
> 
> Which is the simplest and most efficient way to implement it? especially
> when considering large (>10,000,000 cells) rasters?
> 
> Thank you in advance
> 
> Laura
> 
>    [[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------
> 
> Message: 3
> Date: Mon, 24 Feb 2014 08:50:06 -0600
> From: Jonathan Greenberg <jgrn at illinois.edu>
> To: Laura Poggio <laura.poggio at gmail.com>
> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Fwd: ifelse with multiple rasters
> Message-ID:
>    <CABG0rfuEW28tOCMm841mAjVgZaZHkTBBJdSn9Lein1i75byrXw at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
> 
> Laura:
> 
> If this is a straight masking procedure, you can do some
> multiplication tricks in raster like:
> 
> output = rst_a*rst_B*2
> 
> or look at
> ?overlay
> 
> or take a look at
> ?mask
> 
> I suspect mask and overlay are faster than the raster algebra
> statement (Robert, is this correct?)
> 
> If you want to use rasterEngine for parallel processing, you can do
> something like this:
> 
> library(spatial.tools)
> 
> # Set X to the number of CPUs you want top use and uncomment this for
> parallel processing:
> # sfQuickInit(cpus=X)
> 
> rst_test <- function(rst_a,rst_B)
> {
> return(ifelse(rst_a==0 & rst_B==1,2,0))
> }
> 
> # Fill in the rasters you intend to use here:
> raster_check <-
> rasterEngine(rst_a=someraster,rst_B=someotherraster,fun=rst_test)
> 
> # Uncomment to stop the parallel engine if need be:
> # sfQuickStop()
> 
> --j
> 
>> On Mon, Feb 24, 2014 at 8:16 AM, Laura Poggio <laura.poggio at gmail.com> wrote:
>> Dear list,
>> I am struggling to find a way to do a simple if statement with multiple
>> rasters in raster.
>> 
>> For example:
>> ifelse(rst_a==0 & rst_B=1,2,0)
>> 
>> Which is the simplest and most efficient way to implement it? especially
>> when considering large (>10,000,000 cells) rasters?
>> 
>> Thank you in advance
>> 
>> Laura
>> 
>>        [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
> -- 
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
> 
> 
> 
> ------------------------------
> 
> Message: 4
> Date: Mon, 24 Feb 2014 15:24:35 +0000
> From: "Gilles Benjamin Leduc" <gbl1 at hi.is>
> To: R-sig-Geo at r-project.org
> Subject: [R-sig-Geo] How to do an anamorphosis on R?
> Message-ID: <3011-530b6400-7f-7f728600 at 71854736>
> Content-Type: text/plain; charset="utf-8"
> 
> Hi all, 
> 
> I would like to make an anamorphosis map, id est, a map where some other distance measurement are used instead geographical distance. In my case I would like to plot an anamorphosis of Iceland using genetical distence insteand of geographical distence. 
> I have got .shp maps and equivalents. 
> How to make such a distortion? 
> Best regards 
> Benjamin
> 
> 
> 
> ------------------------------
> 
> Message: 5
> Date: Mon, 24 Feb 2014 15:50:10 +0000
> From: Laura Poggio <laura.poggio at gmail.com>
> To: Jonathan Greenberg <jgrn at illinois.edu>
> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Fwd: ifelse with multiple rasters
> Message-ID:
>    <CAKmfgFPBUrzqa9PS26R62YEP8EtNWUqz9fuaXjYwR-eQZWzZXQ at mail.gmail.com>
> Content-Type: text/plain
> 
> Dear Jonathan,
> thank you very much. I will have a closer look to overlay, but I think that
> your example with Spatial.tools is the most straightforward for the way I
> think... and it can be used with multiple processors.
> 
> Thanks
> 
> Laura
> 
> 
>> On 24 February 2014 14:50, Jonathan Greenberg <jgrn at illinois.edu> wrote:
>> 
>> Laura:
>> 
>> If this is a straight masking procedure, you can do some
>> multiplication tricks in raster like:
>> 
>> output = rst_a*rst_B*2
>> 
>> or look at
>> ?overlay
>> 
>> or take a look at
>> ?mask
>> 
>> I suspect mask and overlay are faster than the raster algebra
>> statement (Robert, is this correct?)
>> 
>> If you want to use rasterEngine for parallel processing, you can do
>> something like this:
>> 
>> library(spatial.tools)
>> 
>> # Set X to the number of CPUs you want top use and uncomment this for
>> parallel processing:
>> # sfQuickInit(cpus=X)
>> 
>> rst_test <- function(rst_a,rst_B)
>> {
>> return(ifelse(rst_a==0 & rst_B==1,2,0))
>> }
>> 
>> # Fill in the rasters you intend to use here:
>> raster_check <-
>> rasterEngine(rst_a=someraster,rst_B=someotherraster,fun=rst_test)
>> 
>> # Uncomment to stop the parallel engine if need be:
>> # sfQuickStop()
>> 
>> --j
>> 
>> On Mon, Feb 24, 2014 at 8:16 AM, Laura Poggio <laura.poggio at gmail.com>
>> wrote:
>>> Dear list,
>>> I am struggling to find a way to do a simple if statement with multiple
>>> rasters in raster.
>>> 
>>> For example:
>>> ifelse(rst_a==0 & rst_B=1,2,0)
>>> 
>>> Which is the simplest and most efficient way to implement it? especially
>>> when considering large (>10,000,000 cells) rasters?
>>> 
>>> Thank you in advance
>>> 
>>> Laura
>>> 
>>>        [[alternative HTML version deleted]]
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
>> 
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
> 
>    [[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------
> 
> Message: 6
> Date: Mon, 24 Feb 2014 21:27:55 -0600
> From: ping yang <pingyang.whu at gmail.com>
> To: r-sig-geo <r-sig-geo at r-project.org>
> Subject: [R-sig-Geo] Extract time series value for a given coodinate
>    from an unusual NetCDF file
> Message-ID:
>    <CAK8gSG9+gqx6W=496oHysYnm9qiPdkAkt5UcGwL6opxsDY18QA at mail.gmail.com>
> Content-Type: text/plain
> 
> Hi r-sig-geo,
> 
> previously I used following code to extract time series value for a given
> coodinate from a netcdf file:
>  require(raster)
>  require(ncdf)
>  require(sp)
>  X1 <- -90.5167
>  Y1 <- 33.45
>  MS <- cbind(X1,Y1)
>  p <- SpatialPoints(MS)
>  year <- 1981
>  setwd("e:/PRISM/NetCDF/")
>  filename <- paste("PRISM_MS")
>  pptfile <- paste("ppt","_",year,".nc",sep='')
>  b_ppt <- brick(pptfile,varname='ppt')
>  ppt <- extract(b_ppt,coordinates(p))
> 
> it was successful. However, when I use the same method for another NetCDF
> (which has unusual dimension),  i got errors, then I check the difference,
> it showed that the dimension for the two files are different:
> The file is working has following information:
> Netcdf file 1:
> class       : RasterBrick
> *dimensions  : 621, 1405, 872505, 365  (nrow, ncol, ncell, nlayers)*
> resolution  : 0.04166667, 0.04166667  (x, y)
> extent      : -125.0208, -66.47917, 24.0625, 49.9375  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=longlat +datum=NAD83 +no_defs +ellps=GRS80
> +towgs84=0,0,0
> data source : e:\PRISM\NetCDF\ppt_1981.nc
> names       : X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14,
> X15, ...
> unknown     : 1, 365 (min, max)
> varname     : ppt
> 
> The one is not working with above code has following information
> NetCDF file 2:
> class       : RasterBrick
> *dimensions  : 1386, 365, 505890, 585  (nrow, ncol, ncell, nlayers) *
> resolution  : 1, 0.041666  (x, y)
> extent      : 29584.5, 29949.5, -124.793, -67.04392  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=longlat +datum=WGS84
> data source : e:\UoIGriddedWeather\pr_1981.nc
> names       : X49.3960227966309, X49.3543586730957, X49.3126907348633,
> X49.2710266113281, X49.2293586730957, X49.1876945495605, X49.1460266113281,
> X49.104362487793, X49.0626945495605, X49.0210304260254, X48.979362487793,
> X48.9376983642578, X48.8960304260254, X48.8543663024902, X48.8126983642578,
> ...
> degrees_north: 25.0630779266357, 49.3960227966309 (min, max)
> varname     : precipitation_amount
> 
> The dimension in the NetCDF file 2 is not correct. should be 585, 1386,
> 505890,365.
> 
> Has someone encountered the same problem before? How to resolve this?
> 
> Look forward suggestions and solutions.
> 
> Thanks,
> 
> Ping
> 
>    [[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> End of R-sig-Geo Digest, Vol 126, Issue 22
> ******************************************


From moshersteven at gmail.com  Sun Mar  2 03:59:40 2014
From: moshersteven at gmail.com (steven mosher)
Date: Sat, 1 Mar 2014 18:59:40 -0800
Subject: [R-sig-Geo] New Global Temperature datasets
Message-ID: <CAFFLneQ=fND8YhLJypedO+vgxNLj6gPpGJbFs9sKQxOtLUkQmQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140301/aa1ce1d6/attachment.pl>

From lavoie.raphael at gmail.com  Mon Mar  3 16:47:48 2014
From: lavoie.raphael at gmail.com (=?ISO-8859-1?Q?Rapha=EBl_Lavoie?=)
Date: Mon, 3 Mar 2014 10:47:48 -0500
Subject: [R-sig-Geo] Circular density estimate to a raster for mapping
	in GIS - help
In-Reply-To: <CALEdrgZ3k5y0jJLXEKEP9APr_Bjewwggi89541vV6BLvE5_ZcQ@mail.gmail.com>
References: <CALEdrgZ3k5y0jJLXEKEP9APr_Bjewwggi89541vV6BLvE5_ZcQ@mail.gmail.com>
Message-ID: <CALEdrgY=nRP6BMnREBwJFwOoQrKtNXK00PiFvcLA2F6-VRpFMw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140303/c8c8fc94/attachment.pl>

From gduveiller at gmail.com  Mon Mar  3 17:37:13 2014
From: gduveiller at gmail.com (Gregory Duveiller)
Date: Mon, 3 Mar 2014 17:37:13 +0100
Subject: [R-sig-Geo] Problem installing rgdal on linux CentOS 6
Message-ID: <CAHntiskSBTRwDeeu0yuP56zNM6e3aaA_i_PtEbuwk0ZBukyytQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140303/2968d564/attachment.pl>

From bakare at ualberta.ca  Mon Mar  3 17:57:16 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Mon, 3 Mar 2014 09:57:16 -0700
Subject: [R-sig-Geo] GSTAT ordinary kriging prediction with large
	observation
In-Reply-To: <5310F0C5.3020509@uni-muenster.de>
References: <CAJRR3XOQz12yBaK3oRX9piVNFuX9Ey7nyG6DUG3YDihBJiwj3Q@mail.gmail.com>
	<5310F0C5.3020509@uni-muenster.de>
Message-ID: <CAJRR3XP1wtVFqVFrObuknSGhF6-fv+Riec3GfSe8vn8UyTXmTw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140303/6b9dce7c/attachment.pl>

From antonio.rrz at gmail.com  Mon Mar  3 19:32:12 2014
From: antonio.rrz at gmail.com (Antonio Rodriges)
Date: Mon, 3 Mar 2014 20:32:12 +0200
Subject: [R-sig-Geo] R raster object -> an ArcGIS readable format
Message-ID: <CAPrLoNeEB3VSuBxOofOoTAvv++hLhAYkKV0eh=erpCiW0POqVQ@mail.gmail.com>

Dear Community,

What are the ways to export a raster R object to a format that ArcGIS
will readily read? Can anyone suggest any code?

Thank you


From Roger.Bivand at nhh.no  Mon Mar  3 19:47:58 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 3 Mar 2014 19:47:58 +0100
Subject: [R-sig-Geo] Problem installing rgdal on linux CentOS 6
In-Reply-To: <CAHntiskSBTRwDeeu0yuP56zNM6e3aaA_i_PtEbuwk0ZBukyytQ@mail.gmail.com>
References: <CAHntiskSBTRwDeeu0yuP56zNM6e3aaA_i_PtEbuwk0ZBukyytQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1403031925160.24354@reclus.nhh.no>

On Mon, 3 Mar 2014, Gregory Duveiller wrote:

> Dear list,
>
> I am relatively new to linux and I am trying, unsuccesfully, to install
> 'rgdal' on a CentOS machine.
>
> When I type in R:
>
> $ install.packages('rgdal')

When istalling a source package with system dependencies that you are 
unsure that you meet, it does make a lot of sense to download the package 
from your CRAN mirror, and look in the inst/ directory for files offering 
help. Not only does the CRAN page for rgdal offer help:

SystemRequirements: for building from source: GDAL >= 1.6.3 library from 
http://trac.osgeo.org/gdal/wiki/DownloadSource and PROJ.4 (proj >= 4.4.9) 
from http://trac.osgeo.org/proj/; GDAL OSX frameworks built by William 
Kyngesburye at http://www.kyngchaos.com/ may be used for source installs 
on OSX.

but the source package includes an inst/README file. This explains in some 
detail which variants of binary packages might be needed to install the 
source package.

Always use what the package and its maintainer(s) say, never ever trust 
hearsay (on stackoverflow.com, on which I refuse to post, especially given 
its choice of gamifying). I do agree with the advice given on that so 
thread that you should prefer to install from source, but in the case of 
PROJ, you also need to download the other packages.

Reading the inst/README file, you'll see:

"If installing PROJ.4 from RPM binaries, note that four RPM files are
required: "proj", "proj-devel", "proj-epsg" and "proj-nad". The third and
fourth files, "proj-epsg" and "proj-nad", contain all of the support files
placed in /usr/share/proj, and are required for any use of "proj" itself."

so that, in addition to gdal and its -devel extra, you need several proj 
packages. The README file also notes that RPM and Debian packagers are 
fickle and things fall apart with depressing regularity, and/or users are 
consigned to using very out of date versions of PROJ and GDAL.

Learn to install system dependencies from source on systems where you have 
chosen to be in control. On OSX and Wndows, we/CRAN are in control, and 
sort things out for you.

>
> the installation stops with the following error:
>
> checking for proj_api.h... no
> configure: error: proj_api.h not found in standard or given locations.
> ERROR: configuration failed for package 'rgdal'
>
> I understand, from posts such as (
> http://stackoverflow.com/questions/15248815/rgdal-package-installation)
> that I need to install parts of GDAL and PROJ.4 from the terminal. But I do
> not understand which ones nor how to do so under CentOS. Currently I
> already ran these commands in the terminal:
>
> $ sudo yum install gdal
> $ sudo yum install proj
>

Actually, the so answerer wrote (for debian):

sudo apt-get install libgdal1-dev libproj-dev

which suggests gdal-devel, proj-devel, proj-nad, proj-epsg are needed too, 
and I don't think that they are installed. List the contents of proj and 
proj-devel, and you'll see that proj only lets you run the programs 
provided, but proj-devel provides the headers needed to compile and link 
other code to proj - that's why they are called -devel.

Bottom line, the help is in the inst/README file in the package, where one 
should expect to find it.

Hope this clarifies,

Roger

> And both resulted in the message Package xxx already installed and latest
> version
> Nothing to do
>
> Can anybody help?
>
> Thanks in advance and regards...
> Gregory Duveiller
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From nature.aseem at gmail.com  Mon Mar  3 20:00:49 2014
From: nature.aseem at gmail.com (Aseem Sharma)
Date: Mon, 3 Mar 2014 11:00:49 -0800
Subject: [R-sig-Geo] writeRaster error [Error in dim.create.ncdf(nc, d,
 verbose) : NA/NaN/Inf in foreign function call (arg 5)]
Message-ID: <CAPB42Uy_x6mRimE9TshNXJQJ-R7=M2BRQ4s0Utc96phtzxzkAg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140303/f6548aa9/attachment.pl>

From tech_dev at wildintellect.com  Mon Mar  3 20:05:05 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Mon, 03 Mar 2014 11:05:05 -0800
Subject: [R-sig-Geo] R raster object -> an ArcGIS readable format
In-Reply-To: <CAPrLoNeEB3VSuBxOofOoTAvv++hLhAYkKV0eh=erpCiW0POqVQ@mail.gmail.com>
References: <CAPrLoNeEB3VSuBxOofOoTAvv++hLhAYkKV0eh=erpCiW0POqVQ@mail.gmail.com>
Message-ID: <5314D261.2020400@wildintellect.com>

On 03/03/2014 10:32 AM, Antonio Rodriges wrote:
> Dear Community,
> 
> What are the ways to export a raster R object to a format that ArcGIS
> will readily read? Can anyone suggest any code?
> 
> Thank you
> 


If we're talking about the Raster package then.
writeRaster()

See pg 200 in the help file
http://cran.r-project.org/web/packages/raster/raster.pdf for writeFormats()

Depending on how many bands I find geotiff to be a decent format but
most formats on the list are readable by Arc.

Otherwise if you need additional formats or are just using the sp
package see the rgdal package for export options.

Enjoy,
Alex


From franz.grassmann at gmail.com  Mon Mar  3 23:27:28 2014
From: franz.grassmann at gmail.com (Franz Grassmann)
Date: Mon, 3 Mar 2014 23:27:28 +0100
Subject: [R-sig-Geo] Speeding up raster calculations
Message-ID: <F3208234-7886-4478-9842-1845A02F0DC4@gmail.com>

Dear list members!

Maybe, someone has a good idea how to speed up my raster-calculation, or knows the right way how to deal with my ?problem?.

For my master thesis, I use the focal-function and its focalWeight (?raster?-package) for some raster calculations. For every cell of my map, I sum up the ?resources? of the surrounding cells by a certain weight that declines with distance (Its about foraging bees?). I got a map that holds the resources, and a certain focalWeight for every species of my model.

The command code looks similar to this:

result.raster <- focal(x = resource.map, 
                          fun = function(x) {sum(x)/sum(fW)},
                          w = fW)

It takes very long to create my raster, because the fW is quiet large for some species. I can?t use the focal_hpc()-command, because it doesn?t support the kind of focalWeight I use. For my analysis I also have to run this calculations for a number of species, seasons and scenarios.

My questions: Did I choose the right way to solve my tasks, or is there another, faster way for my calculations? I hope I didn?t choose the wrong package or program...
I am no programmer, but I am very interested in this topic an would welcome every tip on how to solve this, or hint where to read/learn more about this.

Best regards,
Franz Grassmann

From r.hijmans at gmail.com  Tue Mar  4 02:34:24 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 3 Mar 2014 17:34:24 -0800
Subject: [R-sig-Geo] writeRaster error [Error in dim.create.ncdf(nc, d,
 verbose) : NA/NaN/Inf in foreign function call (arg 5)]
In-Reply-To: <CAPB42Uy_x6mRimE9TshNXJQJ-R7=M2BRQ4s0Utc96phtzxzkAg@mail.gmail.com>
References: <CAPB42Uy_x6mRimE9TshNXJQJ-R7=M2BRQ4s0Utc96phtzxzkAg@mail.gmail.com>
Message-ID: <CANtt_hy8+yxgeiMEOtpquTyscW4jMEu95xPWWMwS3Bs=E3v6KQ@mail.gmail.com>

Aseem provided me with some more info. writeRaster fails when the
'z-value' cannot be converted to an integer. In his case:

> head(getZ(ncdata.qtr))
[1] "1950 Q1" "1950 Q2" "1950 Q3" "1950 Q4" "1951 Q1" "1951 Q2"

The work around is to change these values using the setZ function.
This has been fixed (with a warning) for the next version of the raster package.

Robert

PS. always show sessionInfo(), traceback() and do not include very
large amounts of data in your postings!


On Mon, Mar 3, 2014 at 11:00 AM, Aseem Sharma <nature.aseem at gmail.com> wrote:
> Hi,
> I am getting error(as below) when trying to write seasonal ( quarterly)
> data in netCDF.
> My data details and sample data are below.
> My code is
>
> library(raster)
> library(ncdf)
> writeRaster(ncdata.qtr,
> filename="QtrYTmax.nc",inf.rm=TRUE,na.rm=T,NaN.rm=T,format="CDF",overwrite=TRUE,verbose=T)
>
> but his gives me the error
>
> *Error in dim.create.ncdf(nc, d, verbose) : *
> *  NA/NaN/Inf in foreign function call (arg 5)*
>
> how to fix this error ?
> Data details
>> ncdata.qtr
> class       : RasterBrick
> dimensions  : 33, 49, 1617, 245  (nrow, ncol, ncell, nlayers)
> resolution  : 0.08333333, 0.08333333  (x, y)
> extent      : -122.75, -118.6667, 51.33333, 54.08333  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=longlat +datum=WGS84
> data source : in memory
> names       :      X1950.Q1,      X1950.Q2,      X1950.Q3,      X1950.Q4,
>    X1951.Q1,      X1951.Q2,      X1951.Q3,      X1951.Q4,      X1952.Q1,
>    X1952.Q2,      X1952.Q3,      X1952.Q4,      X1953.Q1,      X1953.Q2,
>    X1953.Q3, ...
> min values  : -16.365362537,  -1.802713221,  13.207888594,   0.351344078,  -
> 9.179404557,   0.165412183,  11.963329482,   0.847261630, -10.691397610,
> 1.387089575,  11.250096523,   4.754960467,  -7.522046683,  -0.010559140,
>  10.562655678, ...
> max values  :   -8.27851364,   11.63900332,   25.79347971,   11.56013953,
> -1.62892469,   12.18758037,   25.73696717,   11.55020404,   -3.60472369,
> 13.42343698,   23.57975216,   13.90885632,    1.45158215,   13.67788500,
> 23.25788837, ...
> year.qtr    : 1950 Q1, 2011 Q1 (min, max)
>
>
> Thank you,
>
> aseem
>
>
> ------------------
>
> "Namaste ??????"
>
> Aseem Sharma
>
> Graduate Research Assistant
>
> Northern Hydrometeorology Group(NHG)
>
> Natural Resources and Environmental Studies Institute(NRESi)
>
> University of Northern British Columbia
>
> Prince George, BC, V2N 4Z9, Canada
>
> Tel: 250-960-5427
>
> Web: http://www.unbc.ca/
>
>
>  "All know the Way, but few actually walk it."
> "????? ?????? ???? ?"
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jgrn at illinois.edu  Tue Mar  4 03:22:56 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Mon, 3 Mar 2014 20:22:56 -0600
Subject: [R-sig-Geo] Speeding up raster calculations
In-Reply-To: <F3208234-7886-4478-9842-1845A02F0DC4@gmail.com>
References: <F3208234-7886-4478-9842-1845A02F0DC4@gmail.com>
Message-ID: <CABG0rfvCA0oHLCXrWTaFJ9Kp6WmzXc5NgoMKTbtYFWRbHkCMPw@mail.gmail.com>

Franz:

I'm not sure what you mean that you can't use focal_hpc for your
problem -- it seems like your problem would be fine for use with that
function -- its a bit easier to use rasterEngine, by the way.  You can
use > 1 input raster into your functions if you are using
rasterEngine, and you can pass non-raster parameters to the function
as well.  If you had a simple set of data to test, perhaps I can help
you write the function.

As a heads up, focal window algorithms are slow, and get slower the
larger the window size.  rasterEngine/focal_hpc in spatial.tools will
use parallel processing to speed it up, however.

--j

--j

On Mon, Mar 3, 2014 at 4:27 PM, Franz Grassmann
<franz.grassmann at gmail.com> wrote:
> Dear list members!
>
> Maybe, someone has a good idea how to speed up my raster-calculation, or knows the right way how to deal with my "problem".
>
> For my master thesis, I use the focal-function and its focalWeight ("raster"-package) for some raster calculations. For every cell of my map, I sum up the "resources" of the surrounding cells by a certain weight that declines with distance (Its about foraging bees...). I got a map that holds the resources, and a certain focalWeight for every species of my model.
>
> The command code looks similar to this:
>
> result.raster <- focal(x = resource.map,
>                           fun = function(x) {sum(x)/sum(fW)},
>                           w = fW)
>
> It takes very long to create my raster, because the fW is quiet large for some species. I can't use the focal_hpc()-command, because it doesn't support the kind of focalWeight I use. For my analysis I also have to run this calculations for a number of species, seasons and scenarios.
>
> My questions: Did I choose the right way to solve my tasks, or is there another, faster way for my calculations? I hope I didn't choose the wrong package or program...
> I am no programmer, but I am very interested in this topic an would welcome every tip on how to solve this, or hint where to read/learn more about this.
>
> Best regards,
> Franz Grassmann
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jgrn at illinois.edu  Tue Mar  4 04:01:46 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Mon, 3 Mar 2014 21:01:46 -0600
Subject: [R-sig-Geo] Speeding up raster calculations
In-Reply-To: <CABG0rfvCA0oHLCXrWTaFJ9Kp6WmzXc5NgoMKTbtYFWRbHkCMPw@mail.gmail.com>
References: <F3208234-7886-4478-9842-1845A02F0DC4@gmail.com>
	<CABG0rfvCA0oHLCXrWTaFJ9Kp6WmzXc5NgoMKTbtYFWRbHkCMPw@mail.gmail.com>
Message-ID: <CABG0rftjW8vVRf8VF09B4ChpBgGfRzTmUjWL5WH_fu4MtY58mw@mail.gmail.com>

Franz:

Here is an example of a weighted by distance from center of the window
function using rasterEngine.  I'd recommend grabbing the latest
version from r-forge (1.3.4 at the time of this email).  I'm
calculating a distance matrix within the function that can be used to
create the weights.  You'd probably want to make the distance matrix
once outside of the function and feed it in as an args=.

library(spatial.tools)

focal_function_with_distance <- function(resource_map,inverse_distance_weight)
{

# You can actually do this calculation once outside of the function,
and feed it in as a weight.
# Create a vector of x-distances from the center of the window:
x_vector <- -floor(dim(resource_map)[1]/2):floor(dim(resource_map)[1]/2)
# Create a vector of y-distance from the center of the window:
y_vector <- -floor(dim(resource_map)[2]/2):floor(dim(resource_map)[2]/2)
# Now turn them into matrices:
x_matrix <- matrix(data=x_vector,ncol=dim(resource_map)[1],nrow=dim(resource_map)[2],byrow=TRUE)
y_matrix <- matrix(data=y_vector,ncol=dim(resource_map)[1],nrow=dim(resource_map)[2],byrow=FALSE)
# Now create a window of the same size as the local window that
contains the distance to the
# center of the window:
distance_matrix <- sqrt(x_matrix^2 + y_matrix^2)

# Some random weighting function:
# Avoid dividing by 0:
weighted_matrix <- 1/(distance_matrix+0.00001)^inverse_distance_weight

# Calculate the mean of the weight times the local window:
weighted_mean <- mean(resource_map*array(weighted_matrix,dim=dim(resource_map)))

# Return the value:
return(weighted_mean)
}



tahoe_lidar_highesthit <-
  raster(system.file("external/tahoe_lidar_highesthit.tif",
package="spatial.tools"))

# Turn on the parallel engine:
sfQuickInit()
# Use rasterEngine.  Turn debugmode=TRUE if you want to debug your
function on a single window.
# This uses a 5 x 5 window:

weighted_by_distance_raster <-
rasterEngine(resource_map=tahoe_lidar_highesthit,fun=focal_function_with_distance,
args=list(inverse_distance_weight=2),window_dims=c(5,5),debugmode=FALSE)

# When you are done it is usually a good idea to shut down the engine
unless you plan
# on doing more rasterEngine runs:
sfQuickStop()

On Mon, Mar 3, 2014 at 8:22 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
> Franz:
>
> I'm not sure what you mean that you can't use focal_hpc for your
> problem -- it seems like your problem would be fine for use with that
> function -- its a bit easier to use rasterEngine, by the way.  You can
> use > 1 input raster into your functions if you are using
> rasterEngine, and you can pass non-raster parameters to the function
> as well.  If you had a simple set of data to test, perhaps I can help
> you write the function.
>
> As a heads up, focal window algorithms are slow, and get slower the
> larger the window size.  rasterEngine/focal_hpc in spatial.tools will
> use parallel processing to speed it up, however.
>
> --j
>
> --j
>
> On Mon, Mar 3, 2014 at 4:27 PM, Franz Grassmann
> <franz.grassmann at gmail.com> wrote:
>> Dear list members!
>>
>> Maybe, someone has a good idea how to speed up my raster-calculation, or knows the right way how to deal with my "problem".
>>
>> For my master thesis, I use the focal-function and its focalWeight ("raster"-package) for some raster calculations. For every cell of my map, I sum up the "resources" of the surrounding cells by a certain weight that declines with distance (Its about foraging bees...). I got a map that holds the resources, and a certain focalWeight for every species of my model.
>>
>> The command code looks similar to this:
>>
>> result.raster <- focal(x = resource.map,
>>                           fun = function(x) {sum(x)/sum(fW)},
>>                           w = fW)
>>
>> It takes very long to create my raster, because the fW is quiet large for some species. I can't use the focal_hpc()-command, because it doesn't support the kind of focalWeight I use. For my analysis I also have to run this calculations for a number of species, seasons and scenarios.
>>
>> My questions: Did I choose the right way to solve my tasks, or is there another, faster way for my calculations? I hope I didn't choose the wrong package or program...
>> I am no programmer, but I am very interested in this topic an would welcome every tip on how to solve this, or hint where to read/learn more about this.
>>
>> Best regards,
>> Franz Grassmann
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From antonio.rrz at gmail.com  Tue Mar  4 11:34:09 2014
From: antonio.rrz at gmail.com (Antonio Rodriges)
Date: Tue, 4 Mar 2014 12:34:09 +0200
Subject: [R-sig-Geo] R raster object -> an ArcGIS readable format
In-Reply-To: <5314D261.2020400@wildintellect.com>
References: <CAPrLoNeEB3VSuBxOofOoTAvv++hLhAYkKV0eh=erpCiW0POqVQ@mail.gmail.com>
	<5314D261.2020400@wildintellect.com>
Message-ID: <CAPrLoNf8YFFNsd=0cv4=fj11O4xA1U1EpjbaDhUqXjMHqUUBCw@mail.gmail.com>

Alex,

Many thanks for your help!

2014-03-03 21:05 GMT+02:00 Alex Mandel <tech_dev at wildintellect.com>:
> On 03/03/2014 10:32 AM, Antonio Rodriges wrote:
>> Dear Community,
>>
>> What are the ways to export a raster R object to a format that ArcGIS
>> will readily read? Can anyone suggest any code?
>>
>> Thank you
>>
>
>
> If we're talking about the Raster package then.
> writeRaster()
>
> See pg 200 in the help file
> http://cran.r-project.org/web/packages/raster/raster.pdf for writeFormats()
>
> Depending on how many bands I find geotiff to be a decent format but
> most formats on the list are readable by Arc.
>
> Otherwise if you need additional formats or are just using the sp
> package see the rgdal package for export options.
>
> Enjoy,
> Alex
>


From franz.grassmann at gmail.com  Tue Mar  4 16:42:13 2014
From: franz.grassmann at gmail.com (Franz Grassmann)
Date: Tue, 4 Mar 2014 16:42:13 +0100
Subject: [R-sig-Geo] Speeding up raster calculations
In-Reply-To: <CABG0rftjW8vVRf8VF09B4ChpBgGfRzTmUjWL5WH_fu4MtY58mw@mail.gmail.com>
References: <F3208234-7886-4478-9842-1845A02F0DC4@gmail.com>
	<CABG0rfvCA0oHLCXrWTaFJ9Kp6WmzXc5NgoMKTbtYFWRbHkCMPw@mail.gmail.com>
	<CABG0rftjW8vVRf8VF09B4ChpBgGfRzTmUjWL5WH_fu4MtY58mw@mail.gmail.com>
Message-ID: <0625410E-10B7-4CEA-A63D-4D1B889D9A80@gmail.com>

Hi Jonathan!

Thanks for your very quick reply! It is exactly what I was looking for the last weeks. I came across your rasterEngine-Tutorial at the GEARS Laboratory some weeks ago, and I tried to do a similar approach, unfortunately I never got it working. BUT: After I read your answer this morning, I tried the whole day to apply the code you wrote for me, and I think i got i working by now (it is really fast, and I only used 2 cores so far?.)!

I was very important for me that you showed me that it IS a good way to deal with that task, and so I tried until I got it - many thanks!

Should I post the final code, after finishing it (I still have to optimize the distance_matrix) so that others who have similar questions may read this?

Nice greetings from Austria,
Franz



Am 04.03.2014 um 04:01 schrieb Jonathan Greenberg <jgrn at illinois.edu>:

> Franz:
> 
> Here is an example of a weighted by distance from center of the window
> function using rasterEngine.  I'd recommend grabbing the latest
> version from r-forge (1.3.4 at the time of this email).  I'm
> calculating a distance matrix within the function that can be used to
> create the weights.  You'd probably want to make the distance matrix
> once outside of the function and feed it in as an args=.
> 
> library(spatial.tools)
> 
> focal_function_with_distance <- function(resource_map,inverse_distance_weight)
> {
> 
> # You can actually do this calculation once outside of the function,
> and feed it in as a weight.
> # Create a vector of x-distances from the center of the window:
> x_vector <- -floor(dim(resource_map)[1]/2):floor(dim(resource_map)[1]/2)
> # Create a vector of y-distance from the center of the window:
> y_vector <- -floor(dim(resource_map)[2]/2):floor(dim(resource_map)[2]/2)
> # Now turn them into matrices:
> x_matrix <- matrix(data=x_vector,ncol=dim(resource_map)[1],nrow=dim(resource_map)[2],byrow=TRUE)
> y_matrix <- matrix(data=y_vector,ncol=dim(resource_map)[1],nrow=dim(resource_map)[2],byrow=FALSE)
> # Now create a window of the same size as the local window that
> contains the distance to the
> # center of the window:
> distance_matrix <- sqrt(x_matrix^2 + y_matrix^2)
> 
> # Some random weighting function:
> # Avoid dividing by 0:
> weighted_matrix <- 1/(distance_matrix+0.00001)^inverse_distance_weight
> 
> # Calculate the mean of the weight times the local window:
> weighted_mean <- mean(resource_map*array(weighted_matrix,dim=dim(resource_map)))
> 
> # Return the value:
> return(weighted_mean)
> }
> 
> 
> 
> tahoe_lidar_highesthit <-
>  raster(system.file("external/tahoe_lidar_highesthit.tif",
> package="spatial.tools"))
> 
> # Turn on the parallel engine:
> sfQuickInit()
> # Use rasterEngine.  Turn debugmode=TRUE if you want to debug your
> function on a single window.
> # This uses a 5 x 5 window:
> 
> weighted_by_distance_raster <-
> rasterEngine(resource_map=tahoe_lidar_highesthit,fun=focal_function_with_distance,
> args=list(inverse_distance_weight=2),window_dims=c(5,5),debugmode=FALSE)
> 
> # When you are done it is usually a good idea to shut down the engine
> unless you plan
> # on doing more rasterEngine runs:
> sfQuickStop()
> 
> On Mon, Mar 3, 2014 at 8:22 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
>> Franz:
>> 
>> I'm not sure what you mean that you can't use focal_hpc for your
>> problem -- it seems like your problem would be fine for use with that
>> function -- its a bit easier to use rasterEngine, by the way.  You can
>> use > 1 input raster into your functions if you are using
>> rasterEngine, and you can pass non-raster parameters to the function
>> as well.  If you had a simple set of data to test, perhaps I can help
>> you write the function.
>> 
>> As a heads up, focal window algorithms are slow, and get slower the
>> larger the window size.  rasterEngine/focal_hpc in spatial.tools will
>> use parallel processing to speed it up, however.
>> 
>> --j
>> 
>> --j
>> 
>> On Mon, Mar 3, 2014 at 4:27 PM, Franz Grassmann
>> <franz.grassmann at gmail.com> wrote:
>>> Dear list members!
>>> 
>>> Maybe, someone has a good idea how to speed up my raster-calculation, or knows the right way how to deal with my "problem".
>>> 
>>> For my master thesis, I use the focal-function and its focalWeight ("raster"-package) for some raster calculations. For every cell of my map, I sum up the "resources" of the surrounding cells by a certain weight that declines with distance (Its about foraging bees...). I got a map that holds the resources, and a certain focalWeight for every species of my model.
>>> 
>>> The command code looks similar to this:
>>> 
>>> result.raster <- focal(x = resource.map,
>>>                          fun = function(x) {sum(x)/sum(fW)},
>>>                          w = fW)
>>> 
>>> It takes very long to create my raster, because the fW is quiet large for some species. I can't use the focal_hpc()-command, because it doesn't support the kind of focalWeight I use. For my analysis I also have to run this calculations for a number of species, seasons and scenarios.
>>> 
>>> My questions: Did I choose the right way to solve my tasks, or is there another, faster way for my calculations? I hope I didn't choose the wrong package or program...
>>> I am no programmer, but I am very interested in this topic an would welcome every tip on how to solve this, or hint where to read/learn more about this.
>>> 
>>> Best regards,
>>> Franz Grassmann
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
>> 
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
> 
> 
> 
> -- 
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From bakare at ualberta.ca  Tue Mar  4 17:10:42 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Tue, 4 Mar 2014 09:10:42 -0700
Subject: [R-sig-Geo] block ordinary kriging - gstat
Message-ID: <CAJRR3XNrcn+MfmuRaZNq-y=2QbVrSRr90MTV=Q7Q+f=4y48OTg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140304/19d07c47/attachment.pl>

From jgrn at illinois.edu  Tue Mar  4 17:34:41 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 4 Mar 2014 10:34:41 -0600
Subject: [R-sig-Geo] Speeding up raster calculations
In-Reply-To: <0625410E-10B7-4CEA-A63D-4D1B889D9A80@gmail.com>
References: <F3208234-7886-4478-9842-1845A02F0DC4@gmail.com>
	<CABG0rfvCA0oHLCXrWTaFJ9Kp6WmzXc5NgoMKTbtYFWRbHkCMPw@mail.gmail.com>
	<CABG0rftjW8vVRf8VF09B4ChpBgGfRzTmUjWL5WH_fu4MtY58mw@mail.gmail.com>
	<0625410E-10B7-4CEA-A63D-4D1B889D9A80@gmail.com>
Message-ID: <CABG0rfuGcGgmw2-HRz+c=xvMtTarQGxLYdqcvusWBXekH-3wfA@mail.gmail.com>

Franz:

It's always nice to have examples sent back to the list for posterity,
as long as you are comfortable with making the knowledge public!

--j

On Tue, Mar 4, 2014 at 9:42 AM, Franz Grassmann
<franz.grassmann at gmail.com> wrote:
> Hi Jonathan!
>
> Thanks for your very quick reply! It is exactly what I was looking for the last weeks. I came across your rasterEngine-Tutorial at the GEARS Laboratory some weeks ago, and I tried to do a similar approach, unfortunately I never got it working. BUT: After I read your answer this morning, I tried the whole day to apply the code you wrote for me, and I think i got i working by now (it is really fast, and I only used 2 cores so far....)!
>
> I was very important for me that you showed me that it IS a good way to deal with that task, and so I tried until I got it - many thanks!
>
> Should I post the final code, after finishing it (I still have to optimize the distance_matrix) so that others who have similar questions may read this?
>
> Nice greetings from Austria,
> Franz
>
>
>
> Am 04.03.2014 um 04:01 schrieb Jonathan Greenberg <jgrn at illinois.edu>:
>
>> Franz:
>>
>> Here is an example of a weighted by distance from center of the window
>> function using rasterEngine.  I'd recommend grabbing the latest
>> version from r-forge (1.3.4 at the time of this email).  I'm
>> calculating a distance matrix within the function that can be used to
>> create the weights.  You'd probably want to make the distance matrix
>> once outside of the function and feed it in as an args=.
>>
>> library(spatial.tools)
>>
>> focal_function_with_distance <- function(resource_map,inverse_distance_weight)
>> {
>>
>> # You can actually do this calculation once outside of the function,
>> and feed it in as a weight.
>> # Create a vector of x-distances from the center of the window:
>> x_vector <- -floor(dim(resource_map)[1]/2):floor(dim(resource_map)[1]/2)
>> # Create a vector of y-distance from the center of the window:
>> y_vector <- -floor(dim(resource_map)[2]/2):floor(dim(resource_map)[2]/2)
>> # Now turn them into matrices:
>> x_matrix <- matrix(data=x_vector,ncol=dim(resource_map)[1],nrow=dim(resource_map)[2],byrow=TRUE)
>> y_matrix <- matrix(data=y_vector,ncol=dim(resource_map)[1],nrow=dim(resource_map)[2],byrow=FALSE)
>> # Now create a window of the same size as the local window that
>> contains the distance to the
>> # center of the window:
>> distance_matrix <- sqrt(x_matrix^2 + y_matrix^2)
>>
>> # Some random weighting function:
>> # Avoid dividing by 0:
>> weighted_matrix <- 1/(distance_matrix+0.00001)^inverse_distance_weight
>>
>> # Calculate the mean of the weight times the local window:
>> weighted_mean <- mean(resource_map*array(weighted_matrix,dim=dim(resource_map)))
>>
>> # Return the value:
>> return(weighted_mean)
>> }
>>
>>
>>
>> tahoe_lidar_highesthit <-
>>  raster(system.file("external/tahoe_lidar_highesthit.tif",
>> package="spatial.tools"))
>>
>> # Turn on the parallel engine:
>> sfQuickInit()
>> # Use rasterEngine.  Turn debugmode=TRUE if you want to debug your
>> function on a single window.
>> # This uses a 5 x 5 window:
>>
>> weighted_by_distance_raster <-
>> rasterEngine(resource_map=tahoe_lidar_highesthit,fun=focal_function_with_distance,
>> args=list(inverse_distance_weight=2),window_dims=c(5,5),debugmode=FALSE)
>>
>> # When you are done it is usually a good idea to shut down the engine
>> unless you plan
>> # on doing more rasterEngine runs:
>> sfQuickStop()
>>
>> On Mon, Mar 3, 2014 at 8:22 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
>>> Franz:
>>>
>>> I'm not sure what you mean that you can't use focal_hpc for your
>>> problem -- it seems like your problem would be fine for use with that
>>> function -- its a bit easier to use rasterEngine, by the way.  You can
>>> use > 1 input raster into your functions if you are using
>>> rasterEngine, and you can pass non-raster parameters to the function
>>> as well.  If you had a simple set of data to test, perhaps I can help
>>> you write the function.
>>>
>>> As a heads up, focal window algorithms are slow, and get slower the
>>> larger the window size.  rasterEngine/focal_hpc in spatial.tools will
>>> use parallel processing to speed it up, however.
>>>
>>> --j
>>>
>>> --j
>>>
>>> On Mon, Mar 3, 2014 at 4:27 PM, Franz Grassmann
>>> <franz.grassmann at gmail.com> wrote:
>>>> Dear list members!
>>>>
>>>> Maybe, someone has a good idea how to speed up my raster-calculation, or knows the right way how to deal with my "problem".
>>>>
>>>> For my master thesis, I use the focal-function and its focalWeight ("raster"-package) for some raster calculations. For every cell of my map, I sum up the "resources" of the surrounding cells by a certain weight that declines with distance (Its about foraging bees...). I got a map that holds the resources, and a certain focalWeight for every species of my model.
>>>>
>>>> The command code looks similar to this:
>>>>
>>>> result.raster <- focal(x = resource.map,
>>>>                          fun = function(x) {sum(x)/sum(fW)},
>>>>                          w = fW)
>>>>
>>>> It takes very long to create my raster, because the fW is quiet large for some species. I can't use the focal_hpc()-command, because it doesn't support the kind of focalWeight I use. For my analysis I also have to run this calculations for a number of species, seasons and scenarios.
>>>>
>>>> My questions: Did I choose the right way to solve my tasks, or is there another, faster way for my calculations? I hope I didn't choose the wrong package or program...
>>>> I am no programmer, but I am very interested in this topic an would welcome every tip on how to solve this, or hint where to read/learn more about this.
>>>>
>>>> Best regards,
>>>> Franz Grassmann
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>> --
>>> Jonathan A. Greenberg, PhD
>>> Assistant Professor
>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>> Department of Geography and Geographic Information Science
>>> University of Illinois at Urbana-Champaign
>>> 259 Computing Applications Building, MC-150
>>> 605 East Springfield Avenue
>>> Champaign, IL  61820-6371
>>> Phone: 217-300-1924
>>> http://www.geog.illinois.edu/~jgrn/
>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jgrn at illinois.edu  Tue Mar  4 17:38:28 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 4 Mar 2014 10:38:28 -0600
Subject: [R-sig-Geo] Circular density estimate to a raster for mapping
 in GIS - help
In-Reply-To: <CALEdrgY=nRP6BMnREBwJFwOoQrKtNXK00PiFvcLA2F6-VRpFMw@mail.gmail.com>
References: <CALEdrgZ3k5y0jJLXEKEP9APr_Bjewwggi89541vV6BLvE5_ZcQ@mail.gmail.com>
	<CALEdrgY=nRP6BMnREBwJFwOoQrKtNXK00PiFvcLA2F6-VRpFMw@mail.gmail.com>
Message-ID: <CABG0rfv05GpL1JDujckiyW7uZGfjD+Vck_UJYG8BpnQ459g1FQ@mail.gmail.com>

Raphael:

This sounds a bit like how one does skyview calculations with solar
models -- same type of output.  Can you simply have one raster layer
per angle, and then stack all of them?  The z-profile for each pixel
would then be the probability as a function of the angle for that
given pixel.

--j

On Mon, Mar 3, 2014 at 9:47 AM, Rapha?l Lavoie <lavoie.raphael at gmail.com> wrote:
> Hi all,
>
> I created a circular density estimate using package "circular" from bearings
> (directions) from 0 to 360? assuming a von Mises distribution.
>
> #############
> library(circular)
> Bearing<-
> c(186,197,158,206,206,185,186,224,183,173,175,240,201,197,
> 175,173,226,227,233,193,175,217,171,193,190,186,222,185,
> 208,194,230,184,223,183,190,229,228,234,187)
> circular(Bearing, type=c("angles", "directions"), units=c("degrees"),
> template=c("geographics"))
> plot(Bear <- circular(Bearing, type=c("angles"), units=c("degrees"),
> rotation = c("clock"), zero=1.570796), ticks=T, stack=T, bins=360,
> xlim=c(-2,1), ylim=c(-2,1))
> mle.vonmises(Bear, mu=NULL, kappa=NULL, bias=FALSE,
> control.circular=list(units="degrees")) ## estimated (?SE)
> x <- rvonmises(n=39, mu=199.2, kappa=7.351,
> control.circular=list(units="degrees"))
> res25 <- density(x, bw=25, control.circular=list(units="degrees"),
> kernel="vonmises")
> circularp(res25$x)
> lines(res25, points.plot=F, xlim=c(-2,1))
> #############
>
> The output is probabilities that an object is going in a given direction
> (destination) from a specific location (origin). More specifically, there is
> a probability estimate for each direction (each 360 degree wedge).
>
> I would then like to create raster (0.5 x 0.5?) from that circular
> distribution with the center being the point of origin and the different
> directions displaying the underlying probabilities that an object is going
> in a direction (destination). Imagine a pie chart with 360 pie slices having
> each a specific probability. I tried to use the "raster" package, but can't
> figure out how to include the probability density to create the raster. Can
> anyone help?
>
> Thanks!
> Raph
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From alessandracarioli at gmail.com  Wed Mar  5 12:10:38 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Wed, 5 Mar 2014 12:10:38 +0100
Subject: [R-sig-Geo] Map colouring via classInt and colour Brewer
Message-ID: <1BF57715-3C91-480B-9615-B42F0DF0E40D@gmail.com>

Dear all,

I have been trying to colour my maps using the same variable at different points in time employing the classInt and the RColorBrewer palettes.
Although the matching between the map areas and data file is correct (I have checked), the colouring is wrong every time. I am sure the error is quite silly but I can?t understand where it lies?
I have tried using a custom made palette or fixed breaks, but the colouring just does not work the right way!
Any help on the matter would be greatly appreciated!

Ale

Library(classInt)
#number of class intervals
nclassint <- 7
# variable to be plotted
varofint <- varT1
#define class intervals
cat3 <- classIntervals(varofint, nclassint,style = "jenks")
categ <- cat3
colpal   = brewer.pal(nclassint,"RdBu")
# Code for map: I want the reverse of the palette, from blue to red
colors <- findColours(categ,rev(colpal))
bins <- categ$brks
lb <- length(bins)


plot(shapefile, col=rev(colpal),axes=F)
title("Total Fertility Rate 1981", cex=1)
legend(1096133,4844461,fill=rev(colpal),legend=paste(round(bins[-length(bins)],2)
                                        ,"-",round(bins[-1],2)),cex=0.6, bg="white")


From Roger.Bivand at nhh.no  Wed Mar  5 13:26:33 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 5 Mar 2014 13:26:33 +0100
Subject: [R-sig-Geo] Map colouring via classInt and colour Brewer
In-Reply-To: <1BF57715-3C91-480B-9615-B42F0DF0E40D@gmail.com>
References: <1BF57715-3C91-480B-9615-B42F0DF0E40D@gmail.com>
Message-ID: <alpine.LRH.2.03.1403051321430.8011@reclus.nhh.no>

On Wed, 5 Mar 2014, Alessandra Carioli wrote:

> Dear all,
>
> I have been trying to colour my maps using the same variable at 
> different points in time employing the classInt and the RColorBrewer 
> palettes. Although the matching between the map areas and data file is 
> correct (I have checked), the colouring is wrong every time. I am sure 
> the error is quite silly but I can?t understand where it lies? I have 
> tried using a custom made palette or fixed breaks, but the colouring 
> just does not work the right way! Any help on the matter would be 
> greatly appreciated!
>
> Ale
>
> Library(classInt)
> #number of class intervals
> nclassint <- 7
> # variable to be plotted
> varofint <- varT1

length(varofint)


> #define class intervals
> cat3 <- classIntervals(varofint, nclassint,style = "jenks")
> categ <- cat3
> colpal   = brewer.pal(nclassint,"RdBu")

length(rev(colpal))


> # Code for map: I want the reverse of the palette, from blue to red
> colors <- findColours(categ,rev(colpal))
> bins <- categ$brks
> lb <- length(bins)
>
>
> plot(shapefile, col=rev(colpal),axes=F)

length(varofint) == length(rev(colpal)) # FALSE, so rev(colpal) will be 
recycled,

plot(shapefile, col=rep(rev(colpal), length.out=100),axes=F)

when what you want is:

plot(shapefile, col=colors, axes=F)

Because recycling may be desired, it doesn't generate a warning.

Roger


> title("Total Fertility Rate 1981", cex=1)
> legend(1096133,4844461,fill=rev(colpal),legend=paste(round(bins[-length(bins)],2)
>                                        ,"-",round(bins[-1],2)),cex=0.6, bg="white")
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Wed Mar  5 13:38:20 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 5 Mar 2014 13:38:20 +0100
Subject: [R-sig-Geo] Map colouring via classInt and colour Brewer
In-Reply-To: <alpine.LRH.2.03.1403051321430.8011@reclus.nhh.no>
References: <1BF57715-3C91-480B-9615-B42F0DF0E40D@gmail.com>
	<alpine.LRH.2.03.1403051321430.8011@reclus.nhh.no>
Message-ID: <alpine.LRH.2.03.1403051329180.8011@reclus.nhh.no>

On Wed, 5 Mar 2014, Roger Bivand wrote:

> On Wed, 5 Mar 2014, Alessandra Carioli wrote:
>
>> Dear all,
>> 
>> I have been trying to colour my maps using the same variable at different 
>> points in time employing the classInt and the RColorBrewer palettes. 
>> Although the matching between the map areas and data file is correct (I 
>> have checked), the colouring is wrong every time. I am sure the error is 
>> quite silly but I can?t understand where it lies? I have tried using a 
>> custom made palette or fixed breaks, but the colouring just does not work 
>> the right way! Any help on the matter would be greatly appreciated!
>> 
>> Ale
>> 
>> Library(classInt)
>> #number of class intervals
>> nclassint <- 7
>> # variable to be plotted
>> varofint <- varT1
>
> length(varofint)
>
>
>> #define class intervals
>> cat3 <- classIntervals(varofint, nclassint,style = "jenks")
>> categ <- cat3
>> colpal   = brewer.pal(nclassint,"RdBu")
>
> length(rev(colpal))
>
>
>> # Code for map: I want the reverse of the palette, from blue to red
>> colors <- findColours(categ,rev(colpal))
>> bins <- categ$brks
>> lb <- length(bins)
>> 
>> 
>> plot(shapefile, col=rev(colpal),axes=F)
>
> length(varofint) == length(rev(colpal)) # FALSE, so rev(colpal) will be 
> recycled,
>
> plot(shapefile, col=rep(rev(colpal), length.out=100),axes=F)

This should be:

plot(shapefile, col=rep(rev(colpal), length.out=length(varofint)), ...

I was using North Carolina to replicate with - I wanted to demonstrate the 
consequences of unintended recycling in a reproducible way. The top of the 
code was:

library(maptools)
shapefile <- readShapeSpatial(system.file("shapes/sids.shp",
  package="maptools")[1], IDvar="FIPSNO",
  proj4string=CRS("+proj=longlat +ellps=clrk66"))
varofint <- shapefile$BIR74
library(classInt)
nclassint <- 7
cat3 <- classIntervals(varofint, nclassint, style = "jenks")
categ <- cat3
library(RColorBrewer)
colpal   = brewer.pal(nclassint, "RdBu")
colors <- findColours(categ, rev(colpal))
opar <- par(mfrow=c(2,1))
plot(shapefile, col=rev(colpal), axes=FALSE)
plot(shapefile, col=rep(rev(colpal), length.out=length(varofint)),
  axes=FALSE)
par(opar)

but the intention was:

plot(shapefile, col=colors, axes=FALSE)

Roger

>
> when what you want is:
>
> plot(shapefile, col=colors, axes=F)
>
> Because recycling may be desired, it doesn't generate a warning.
>
> Roger
>
>
>> title("Total Fertility Rate 1981", cex=1)
>> legend(1096133,4844461,fill=rev(colpal),legend=paste(round(bins[-length(bins)],2)
>>                                        ,"-",round(bins[-1],2)),cex=0.6, 
>> bg="white")
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From HodgessE at uhd.edu  Wed Mar  5 21:03:22 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Wed, 5 Mar 2014 20:03:22 +0000
Subject: [R-sig-Geo] a comparison question
Message-ID: <FF9DB805FC41CC4E95825A50F680630217B1E243@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140305/bc78374f/attachment.pl>

From bakare at ualberta.ca  Thu Mar  6 00:09:53 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Wed, 5 Mar 2014 16:09:53 -0700
Subject: [R-sig-Geo] Interpolation grid for ordinary kriging outside data
	area
Message-ID: <CAJRR3XNZzUfBtQjap4SfGtc7AXdSyqmo3kUfu5GrFYEfO33Gfg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140305/ef12a20d/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Mar  6 12:03:21 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 6 Mar 2014 11:03:21 +0000
Subject: [R-sig-Geo] Interpolation grid for ordinary kriging outside
	data area
In-Reply-To: <3242a13cab9243568b1b894ea96456ba@EX-0-HT0.lancs.local>
References: <3242a13cab9243568b1b894ea96456ba@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNTfkEL42nh=6u_-H_6_CFRr7-pujmq1npkDoZXA9fyRQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140306/bec57c2c/attachment.pl>

From potts.a at gmail.com  Thu Mar  6 13:18:57 2014
From: potts.a at gmail.com (Alastair Potts)
Date: Thu, 6 Mar 2014 14:18:57 +0200
Subject: [R-sig-Geo] Least cost path analysis - gdistance - transition
	function formula
Message-ID: <CAG_8N1YPf2xyr1K+oUv45dp0ggz9JTpHCbw8AuGZtf-uo31XOg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140306/64037e62/attachment.pl>

From kridox at ymail.com  Thu Mar  6 14:17:27 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Thu, 6 Mar 2014 22:17:27 +0900
Subject: [R-sig-Geo] clusterR and Raster* object with "non-standard" x
	coordinates
Message-ID: <CAAcyNCzDufu-FUqYsx27qz9am8Sr9uQ0ipb-afAwXHcoHHpVYg@mail.gmail.com>

Hello,

I would like to know whether it is mandatory to use a Raster* object
with standard coordinates, between -180 and 180 degrees, in order to
use the "clusterR" function?

In my case, "clusterR" fails for Raster* object with "non-standard" x
coordinates, i.e. form 0 to 360. But it works after rotating the same
Raster* object.

Regards,
Pascal

-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From jacobvanetten at yahoo.com  Thu Mar  6 15:24:17 2014
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Thu, 6 Mar 2014 14:24:17 +0000 (GMT)
Subject: [R-sig-Geo] Least cost path analysis - gdistance -
	transition	function formula
In-Reply-To: <CAG_8N1YPf2xyr1K+oUv45dp0ggz9JTpHCbw8AuGZtf-uo31XOg@mail.gmail.com>
References: <CAG_8N1YPf2xyr1K+oUv45dp0ggz9JTpHCbw8AuGZtf-uo31XOg@mail.gmail.com>
Message-ID: <1394115857.88869.YahooMailNeo@web133205.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140306/09a6c5ff/attachment.pl>

From bakare at ualberta.ca  Fri Mar  7 00:14:38 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Thu, 6 Mar 2014 16:14:38 -0700
Subject: [R-sig-Geo] krige function for interpolation - methodology
Message-ID: <CAJRR3XP+bz2sYTRM6LNEQD3U_wgfyTZ1Gt7X3RfHKWhkzg_0eA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140306/9cf3aa0d/attachment.pl>

From mauriziomarchi85 at gmail.com  Fri Mar  7 10:44:27 2014
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Fri, 7 Mar 2014 10:44:27 +0100
Subject: [R-sig-Geo] Temporary files biomod2
Message-ID: <CANJhsN1cUmFc9okHb7s+jXsdgRF5Cv5cHArCdbzH0ef5KQbW1Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140307/8aa671f8/attachment.pl>

From roman.lustrik at gmail.com  Fri Mar  7 10:58:17 2014
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 7 Mar 2014 10:58:17 +0100
Subject: [R-sig-Geo] Temporary files biomod2
In-Reply-To: <CANJhsN1cUmFc9okHb7s+jXsdgRF5Cv5cHArCdbzH0ef5KQbW1Q@mail.gmail.com>
References: <CANJhsN1cUmFc9okHb7s+jXsdgRF5Cv5cHArCdbzH0ef5KQbW1Q@mail.gmail.com>
Message-ID: <CAHT1vpiMXMqAfiVP-m76Av8=R44Q7URDDkkg4SHpgUB4dpcFfw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140307/014ca67f/attachment.pl>

From edzer.pebesma at uni-muenster.de  Fri Mar  7 11:32:55 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 07 Mar 2014 11:32:55 +0100
Subject: [R-sig-Geo] krige function for interpolation - methodology
In-Reply-To: <CAJRR3XP+bz2sYTRM6LNEQD3U_wgfyTZ1Gt7X3RfHKWhkzg_0eA@mail.gmail.com>
References: <CAJRR3XP+bz2sYTRM6LNEQD3U_wgfyTZ1Gt7X3RfHKWhkzg_0eA@mail.gmail.com>
Message-ID: <5319A057.5040800@uni-muenster.de>

Please do read documentation before you post. This list is not meant to
remind you it is there.

Look up parameter maxdist in ?krige.

On 03/07/2014 12:14 AM, Moshood Agba Bakare wrote:
> Hi,
> I used the krige function of gstat to obtain predicted value for the grid
> points using block ordinary kriging. I defined my grid  spacing of 100m
> with block size of 10m x 10m using 100 nearest obervation in the local
> neighborhood of unsampled locations for prediction.
> 
> I do not understand how this krige function will capture the number of
> nearest observations in the local neighborhood for prediction.
> 
>  Could anyone please explain how it will capture the 100 obervations for
> the prediction? does this function define the search radius to capture
> nearest observation for prediction? Even though I define my nmax to be 100
> (nmax=100), is it possible that number of observations less than hundred
> can be used if the unsampled location is within sparse region of the field?
> 
> 
> prd_ok <- krige(id="yield",yield ~ 1, canmod.sp, newdata = grd,
> model=exp.mod,
> block=c(10,10),nmax=100)
> 
> Thanks
> 
> Moshood
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140307/f78d1a1d/attachment.bin>

From marceivissa at gmail.com  Fri Mar  7 14:24:50 2014
From: marceivissa at gmail.com (=?ISO-8859-1?Q?Marc_Mar=ED_Dell=27Olmo?=)
Date: Fri, 7 Mar 2014 14:24:50 +0100
Subject: [R-sig-Geo] Quantile map with plotGoogleMaps (legend problem)
Message-ID: <CAAZSCQ7_EwKnEZa27B5WaHdve91yW8LZC0jFx9jZWvHkaqbEhw@mail.gmail.com>

Dear all,

I'm trying to do a quantile map (specifically septile map) with
plotGoogleMaps. I obtain the map, but this map don't display the
legend with the septiles intervals. Moreover, I can display the map
with firefox, but I have problems with explorer...

This is the sintax that I have used:
carto<-readShapeSpatial("C:/duda/carto.shp")
proj4string(carto) <- CRS("+proj=longlat +datum=WGS84 +no_defs")
plotGoogleMaps(carto, zcol="RMEs", filename="C:/duda/map.html",
mapTypeId='ROADMAP', colPalette= brewer.pal(7,"Reds"),
strokeColor="white", openMap=T)


With the following link you can download the data to execute this
syntax and the file "map.html" with the map:

https://dl.dropboxusercontent.com/u/14934021/duda.zip


Thank you very much!


Marc


From milan.kili11 at gmail.com  Fri Mar  7 14:46:02 2014
From: milan.kili11 at gmail.com (Milan Kilibarda)
Date: Fri, 7 Mar 2014 14:46:02 +0100
Subject: [R-sig-Geo] Quantile map with plotGoogleMaps (legend problem)
In-Reply-To: <CAAZSCQ7_EwKnEZa27B5WaHdve91yW8LZC0jFx9jZWvHkaqbEhw@mail.gmail.com>
References: <CAAZSCQ7_EwKnEZa27B5WaHdve91yW8LZC0jFx9jZWvHkaqbEhw@mail.gmail.com>
Message-ID: <CAPSaU--7Dnhd5i5BFJWZAC+9WDgYFkTHcS3JoqbjfUGBjBeqew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140307/b27c559d/attachment.pl>

From marceivissa at gmail.com  Fri Mar  7 14:59:13 2014
From: marceivissa at gmail.com (=?ISO-8859-1?Q?Marc_Mar=ED_Dell=27Olmo?=)
Date: Fri, 7 Mar 2014 14:59:13 +0100
Subject: [R-sig-Geo] Quantile map with plotGoogleMaps (legend problem)
In-Reply-To: <CAPSaU--7Dnhd5i5BFJWZAC+9WDgYFkTHcS3JoqbjfUGBjBeqew@mail.gmail.com>
References: <CAAZSCQ7_EwKnEZa27B5WaHdve91yW8LZC0jFx9jZWvHkaqbEhw@mail.gmail.com>
	<CAPSaU--7Dnhd5i5BFJWZAC+9WDgYFkTHcS3JoqbjfUGBjBeqew@mail.gmail.com>
Message-ID: <CAAZSCQ4eRwid8gD=jpqMOoAuJ8xVMZi-i7X8OpzhsGuf+N_iQg@mail.gmail.com>

Dear Milan,

yes, with your reproducible example I can see the legend. But, with my
data I can't see it...

It is very strange. I will try it at home, because I'm using the job
computer and maybe not having administrator rights could be a
problem... I don't know...

Thank you!


2014-03-07 14:46 GMT+01:00 Milan Kilibarda <milan.kili11 at gmail.com>:
> Hi Mark,
>
> I reproduce your example without any problem, and it works in Chrome,
> Mozilla and IE.
>
> Here is your example:
>
> https://dl.dropboxusercontent.com/u/20743714/duda.zip
>
> Here is reproducible example:
>
> library(plotGoogleMaps)
> nc <- readShapeSpatial(
> system.file("shapes/sids.shp",package="maptools")[1],
>                                     proj4string=CRS("+proj=longlat
> +datum=NAD27"))
> library(RColorBrewer)
>
> m<-plotGoogleMaps(nc,zcol="NWBIR74",filename='MyMap6.htm',
> mapTypeId='TERRAIN',colPalette= brewer.pal(7,"Reds"),
> strokeColor="white")
>
> Check your version of R and packages.
>
> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United
> Kingdom.1252
> [3] LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C
> [5] LC_TIME=English_United Kingdom.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] RColorBrewer_1.0-5 plotGoogleMaps_2.0 lattice_0.20-24    maptools_0.8-29
> rgdal_0.8-16
> [6] sp_1.0-14
>
> loaded via a namespace (and not attached):
> [1] foreign_0.8-59 grid_3.0.2     tools_3.0.2
>
> Best,
>
> Milan
>
>
>
>
> On Fri, Mar 7, 2014 at 2:24 PM, Marc Mar? Dell'Olmo <marceivissa at gmail.com>
> wrote:
>>
>> Dear all,
>>
>> I'm trying to do a quantile map (specifically septile map) with
>> plotGoogleMaps. I obtain the map, but this map don't display the
>> legend with the septiles intervals. Moreover, I can display the map
>> with firefox, but I have problems with explorer...
>>
>> This is the sintax that I have used:
>> carto<-readShapeSpatial("C:/duda/carto.shp")
>> proj4string(carto) <- CRS("+proj=longlat +datum=WGS84 +no_defs")
>> plotGoogleMaps(carto, zcol="RMEs", filename="C:/duda/map.html",
>> mapTypeId='ROADMAP', colPalette= brewer.pal(7,"Reds"),
>> strokeColor="white", openMap=T)
>>
>>
>> With the following link you can download the data to execute this
>> syntax and the file "map.html" with the map:
>>
>> https://dl.dropboxusercontent.com/u/14934021/duda.zip
>>
>>
>> Thank you very much!
>>
>>
>> Marc
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
> Dr. Milan Kilibarda
>
> University of Belgrade,
> Faculty of Civil Engineering,
> Department of Geodesy and Geoinformatics,
> Address: Bulevar kralja Aleksandra 73  11000 Belgrade, Serbia,
> Mail:  kili at grf.bg.ac.rs
>
> tel:+381 11 3218516


From markpayneatwork at gmail.com  Fri Mar  7 15:29:53 2014
From: markpayneatwork at gmail.com (Mark Payne)
Date: Fri, 7 Mar 2014 15:29:53 +0100
Subject: [R-sig-Geo] Spplot: Specifying individual point symbols
Message-ID: <CAGBzUO_z+kWOZYcnm-+Ab0zAgkYEPkSm6X7Qn9oKm2Bt4Oszyg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140307/5b67f7c7/attachment.pl>

From oscar.perpinan at upm.es  Fri Mar  7 16:25:56 2014
From: oscar.perpinan at upm.es (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Fri, 7 Mar 2014 16:25:56 +0100
Subject: [R-sig-Geo] Spplot: Specifying individual point symbols
In-Reply-To: <CAGBzUO_z+kWOZYcnm-+Ab0zAgkYEPkSm6X7Qn9oKm2Bt4Oszyg@mail.gmail.com>
References: <CAGBzUO_z+kWOZYcnm-+Ab0zAgkYEPkSm6X7Qn9oKm2Bt4Oszyg@mail.gmail.com>
Message-ID: <CAMLL7b=ZnNj8WcSTOAAYvCpPO_BGtM-TcmL=yFXcR659xxThbA@mail.gmail.com>

Use groups instead:

spplot(meuse["elev"], groups=ifelse(meuse$dist < 0.3, 1, 2), pch=c(1, 16))

Oscar.
-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


2014-03-07 15:29 GMT+01:00 Mark Payne <markpayneatwork at gmail.com>:
> Hi,
>
> I have a problem where I would like to have both the colour and the symbol
> varying in an spplot plot. Unfortunately, specifying a list of pch values
> doesn't seem to work. See the following example
>
> library(sp)
> data(meuse)
> coordinates(meuse) <- ~x +y
> #Lets plot the elevation
> spplot(meuse,"elev")
> #And now the distance
> spplot(meuse,"dist")
> #Lets plot the points close to the river with open points
> spplot(meuse,"elev",
>        colorkey=TRUE,
>        pch=ifelse(meuse$dist<0.3,1,16))
>
> What I'm aiming for is to have all the points close to the river open
> circles (pch=1), and all the points further from the river to be closed
> (pch=16). However, the pch symbols don't seem to be propigating through
> into the panel function correctly. The problem seems to arise somewhere the
> Fill.call.groups() function, but I can't quite figure out where....
>
> This type of trick is legitimate in lattice, which is where my inspiration
> came from eg:
>
> x <- rnorm(1000)
> y <- rnorm(1000)
> z <- sqrt(x^2 + y^2)
> xyplot(y~x,pch=ifelse(z<1,16,1),asp="iso",cex=1)
>
> As you can see, I have managed to change the symbol according  to the
> distance from the centre.
>
> Am I asking too much of spplot to try and achieve this type of thing - we
> are starting to getting pretty complex here! Or am I doing something wrong?
>
> Best wishes,
>
> Mark
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From WissnerM at finance.nyc.gov  Fri Mar  7 16:47:30 2014
From: WissnerM at finance.nyc.gov (Wissner, Michael (DOF))
Date: Fri, 7 Mar 2014 15:47:30 +0000
Subject: [R-sig-Geo] a comparison question
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217B1E243@challenger.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F680630217B1E243@challenger.uhd.campus>
Message-ID: <72FA1158C2C8F542822355A9E9D7503A1C3432A9@MSPWPA-CTWDG1E.cs.nycnet>

Erin,

My (basic) understanding of these two techniques is that kriging outputs a predictive surface with values derived from a variogram while GWR executes a regression equation on each feature in a dataset with a spatial weighting component.  So I think the answer to your question is that it depends on what output you're looking for and what you're trying to accomplish.

>From ESRI's How Kriging Works (http://help.arcgis.com/en/arcgisdesktop/10.0/help/index.html#//009z00000076000000.htm)... "it has been said that kriging uses the data twice: the first time to estimate the spatial autocorrelation of the data and the second to make the predictions."

>From ESRI's How GWR Works (http://help.arcgis.com/en/arcgisdesktop/10.0/help/index.html#//005p00000031000000)... "GWR provides a local model of the variable or process you are trying to understand/predict by fitting a regression equation to every feature in the dataset. GWR constructs these separate equations by incorporating the dependent and explanatory variables of features falling within the bandwidth of each target feature."

Thus, kriging fits a model based on the paired distances then applies that to predict an entire surface of a single z-value (variable). I think consensus among geostatisticians says that kriging is the best for spatial prediction of a single variable.
GWR permits a whole set of explanatory variables to be analyzed and included in a spatially weighted regression model unique to each feature.  I think this technique more suited for exploring how a complete set of independent variables varies in its explanatory power across the spaces analyzed.

I hope this is useful.  I am by no means an authority on this and will keep a close eye on this thread.  

Chao, mike




-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Hodgess, Erin
Sent: Wednesday, March 05, 2014 3:03 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] a comparison question

 Hello everyone:

Here is a comparison question, please:  is kriging better than GWR, please?  Or are they even comparable, please?

Thanks,
Erin


	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From halley.brantley at gmail.com  Fri Mar  7 17:10:16 2014
From: halley.brantley at gmail.com (Halley Brantley)
Date: Fri, 7 Mar 2014 11:10:16 -0500
Subject: [R-sig-Geo] Error importing data from a personal geodatabase using
	rgdal
Message-ID: <CAAHt3jOkB9kW0TEqo=0nznfKteD6svRoDUKe8etJfvpgVpc3tw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140307/18114506/attachment.pl>

From Roger.Bivand at nhh.no  Fri Mar  7 17:35:51 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 7 Mar 2014 17:35:51 +0100
Subject: [R-sig-Geo] a comparison question
In-Reply-To: <72FA1158C2C8F542822355A9E9D7503A1C3432A9@MSPWPA-CTWDG1E.cs.nycnet>
References: <FF9DB805FC41CC4E95825A50F680630217B1E243@challenger.uhd.campus>
	<72FA1158C2C8F542822355A9E9D7503A1C3432A9@MSPWPA-CTWDG1E.cs.nycnet>
Message-ID: <alpine.LRH.2.03.1403071729100.4463@reclus.nhh.no>

On Fri, 7 Mar 2014, Wissner, Michael (DOF) wrote:

> Erin,
>
> My (basic) understanding of these two techniques is that kriging outputs 
> a predictive surface with values derived from a variogram while GWR 
> executes a regression equation on each feature in a dataset with a 
> spatial weighting component.  So I think the answer to your question is 
> that it depends on what output you're looking for and what you're trying 
> to accomplish.
>
>> From ESRI's How Kriging Works 
>> (http://help.arcgis.com/en/arcgisdesktop/10.0/help/index.html#//009z00000076000000.htm)... 
>> "it has been said that kriging uses the data twice: the first time to 
>> estimate the spatial autocorrelation of the data and the second to make 
>> the predictions."
>
>> From ESRI's How GWR Works 
>> (http://help.arcgis.com/en/arcgisdesktop/10.0/help/index.html#//005p00000031000000)... 
>> "GWR provides a local model of the variable or process you are trying 
>> to understand/predict by fitting a regression equation to every feature 
>> in the dataset. GWR constructs these separate equations by 
>> incorporating the dependent and explanatory variables of features 
>> falling within the bandwidth of each target feature."
>
> Thus, kriging fits a model based on the paired distances then applies 
> that to predict an entire surface of a single z-value (variable). I 
> think consensus among geostatisticians says that kriging is the best for 
> spatial prediction of a single variable. GWR permits a whole set of 
> explanatory variables to be analyzed and included in a spatially 
> weighted regression model unique to each feature.  I think this 
> technique more suited for exploring how a complete set of independent 
> variables varies in its explanatory power across the spaces analyzed.

OK with regard to kriging; ESRI's help page for GWR does not refer to:

Paez A, Farber S, Wheeler D, 2011, "A simulation-based study of 
geographically weighted regression as a method for investigating spatially 
varying relationships", Environment and Planning A 43(12) 2992-3010

which spgwr::gwr does refer to. Until you have read and understood this 
article, never even consider using GWR, irrespective of what ESRI or the 
authors of GWR say. Not only are there local collinearity (mentioned by 
ESRI) problems, but GWR creates patterns in local for random input data, 
see the gwr() examples. Use, if at all, very carefully.

Hope this helps,

Roger

>
> I hope this is useful.  I am by no means an authority on this and will 
> keep a close eye on this thread.
>
> Chao, mike
>
>
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Hodgess, Erin
> Sent: Wednesday, March 05, 2014 3:03 PM
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] a comparison question
>
> Hello everyone:
>
> Here is a comparison question, please:  is kriging better than GWR, please?  Or are they even comparable, please?
>
> Thanks,
> Erin
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alexandresantosbr at yahoo.com.br  Fri Mar  7 18:36:34 2014
From: alexandresantosbr at yahoo.com.br (ASANTOS)
Date: Fri, 07 Mar 2014 13:36:34 -0400
Subject: [R-sig-Geo] Rectification satellite image with shapefile
Message-ID: <531A03A2.8070400@yahoo.com.br>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140307/1135413f/attachment.pl>

From HodgessE at uhd.edu  Fri Mar  7 20:19:57 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Fri, 7 Mar 2014 19:19:57 +0000
Subject: [R-sig-Geo] a comparison question
In-Reply-To: <alpine.LRH.2.03.1403071729100.4463@reclus.nhh.no>
References: <FF9DB805FC41CC4E95825A50F680630217B1E243@challenger.uhd.campus>
	<72FA1158C2C8F542822355A9E9D7503A1C3432A9@MSPWPA-CTWDG1E.cs.nycnet>,
	<alpine.LRH.2.03.1403071729100.4463@reclus.nhh.no>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217B285BC@columbia.uhd.campus>

Thanks to both very much!
________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: Friday, March 07, 2014 10:35 AM
To: Wissner, Michael (DOF)
Cc: Hodgess, Erin; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] a comparison question

On Fri, 7 Mar 2014, Wissner, Michael (DOF) wrote:

> Erin,
>
> My (basic) understanding of these two techniques is that kriging outputs
> a predictive surface with values derived from a variogram while GWR
> executes a regression equation on each feature in a dataset with a
> spatial weighting component.  So I think the answer to your question is
> that it depends on what output you're looking for and what you're trying
> to accomplish.
>
>> From ESRI's How Kriging Works
>> (http://help.arcgis.com/en/arcgisdesktop/10.0/help/index.html#//009z00000076000000.htm)...
>> "it has been said that kriging uses the data twice: the first time to
>> estimate the spatial autocorrelation of the data and the second to make
>> the predictions."
>
>> From ESRI's How GWR Works
>> (http://help.arcgis.com/en/arcgisdesktop/10.0/help/index.html#//005p00000031000000)...
>> "GWR provides a local model of the variable or process you are trying
>> to understand/predict by fitting a regression equation to every feature
>> in the dataset. GWR constructs these separate equations by
>> incorporating the dependent and explanatory variables of features
>> falling within the bandwidth of each target feature."
>
> Thus, kriging fits a model based on the paired distances then applies
> that to predict an entire surface of a single z-value (variable). I
> think consensus among geostatisticians says that kriging is the best for
> spatial prediction of a single variable. GWR permits a whole set of
> explanatory variables to be analyzed and included in a spatially
> weighted regression model unique to each feature.  I think this
> technique more suited for exploring how a complete set of independent
> variables varies in its explanatory power across the spaces analyzed.

OK with regard to kriging; ESRI's help page for GWR does not refer to:

Paez A, Farber S, Wheeler D, 2011, "A simulation-based study of
geographically weighted regression as a method for investigating spatially
varying relationships", Environment and Planning A 43(12) 2992-3010

which spgwr::gwr does refer to. Until you have read and understood this
article, never even consider using GWR, irrespective of what ESRI or the
authors of GWR say. Not only are there local collinearity (mentioned by
ESRI) problems, but GWR creates patterns in local for random input data,
see the gwr() examples. Use, if at all, very carefully.

Hope this helps,

Roger

>
> I hope this is useful.  I am by no means an authority on this and will
> keep a close eye on this thread.
>
> Chao, mike
>
>
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Hodgess, Erin
> Sent: Wednesday, March 05, 2014 3:03 PM
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] a comparison question
>
> Hello everyone:
>
> Here is a comparison question, please:  is kriging better than GWR, please?  Or are they even comparable, please?
>
> Thanks,
> Erin
>
>
>       [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From lyndon.estes at gmail.com  Fri Mar  7 21:29:59 2014
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Fri, 7 Mar 2014 15:29:59 -0500
Subject: [R-sig-Geo] Fill color in first plotted spatial object lost when
	writing plot to postscript
Message-ID: <CALuVVab0r8EtWcsjQFE0GemDT5F=XjbnZyg5pos9z5ay5BPMkw@mail.gmail.com>

Dear List,

I am trying to create some maps with postscript, which start with a
base map (of Africa, with grey fill, or with a raster with a single
grey color for all non-NA pixels), and then have a raster that
partially covers the area plotted using a divergent color scheme.  The
grey background helps show the color scheme more effectively.  This
works fine with the pdf and png functions, but for some reason that I
have yet to figure out does not work when using postscript.  The
following toy code demonstrates the problem:

library(raster)
r <- raster(xmn = 0, xmx = 1, ymn = 0, ymx = 1)
res(r) <- 0.1
r[] <- 1
r2 <- raster(xmn = 0, xmx = 1, ymn = 0, ymx = 1)
res(r2) <- 0.1
r2[] <- sample(1:20, ncell(r2), replace = TRUE)
r2[1:(ncol(r2) * (nrow(r2) / 2))] <- NA

# Produces grey background, as desired
png("testfig.png", height = 400, width = 400)
plot(r, col = "grey", legend = FALSE)
plot(r2, add = TRUE)
dev.off()

# Background is white
postscript("testfig.eps", height = 4, width = 4, horizontal = FALSE,
colormodel = "rgb")
plot(r, col = "grey", legend = FALSE)
plot(r2, add = TRUE)
dev.off()


Any pointers on why this is happening, or a reference to the correct
listserv, will be much appreciated.  My sessionInfo() follows, and I
am using OS X 10.7.5 (this could be a mac issue I guess).

Thanks, Lyndon

R version 3.0.2 (2013-09-25)
Platform: x86_64-apple-darwin10.8.0 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] ncdf4_1.10        TeachingDemos_2.9 xtable_1.7-1      zyp_0.10-1
     Kendall_2.2
[6] rgeos_0.3-3       rgdal_0.8-16      raster_2.2-12     sp_1.0-14

loaded via a namespace (and not attached):
[1] boot_1.3-9      grid_3.0.2      lattice_0.20-23 tools_3.0.2


From marceivissa at gmail.com  Fri Mar  7 21:32:57 2014
From: marceivissa at gmail.com (=?ISO-8859-1?Q?Marc_Mar=ED_Dell=27Olmo?=)
Date: Fri, 7 Mar 2014 21:32:57 +0100
Subject: [R-sig-Geo] Quantile map with plotGoogleMaps (legend problem)
In-Reply-To: <CAPSaU--7Dnhd5i5BFJWZAC+9WDgYFkTHcS3JoqbjfUGBjBeqew@mail.gmail.com>
References: <CAAZSCQ7_EwKnEZa27B5WaHdve91yW8LZC0jFx9jZWvHkaqbEhw@mail.gmail.com>
	<CAPSaU--7Dnhd5i5BFJWZAC+9WDgYFkTHcS3JoqbjfUGBjBeqew@mail.gmail.com>
Message-ID: <CAAZSCQ7dp2HXyMd5MuF2syhthKHmwhaGt8w2-EKHiT07LhshjQ@mail.gmail.com>

Dear Milan,

The problem with the legend using plotGoogleMaps persists at home. Are
you sure that when you reproduce my example you can see the legend
with the cut values and the boxes with red colours??

Here you can see how I obtain the map:
https://dl.dropboxusercontent.com/u/14934021/map_firefox.pdf

It is very strange, because with your reproducible example I obtain a
correct legend. By the way, my R version is 3.0.2 and packages are
updated. Do you have any idea of what is happening?

Thank you!

Marc




2014-03-07 14:46 GMT+01:00 Milan Kilibarda <milan.kili11 at gmail.com>:
> Hi Mark,
>
> I reproduce your example without any problem, and it works in Chrome,
> Mozilla and IE.
>
> Here is your example:
>
> https://dl.dropboxusercontent.com/u/20743714/duda.zip
>
> Here is reproducible example:
>
> library(plotGoogleMaps)
> nc <- readShapeSpatial(
> system.file("shapes/sids.shp",package="maptools")[1],
>                                     proj4string=CRS("+proj=longlat
> +datum=NAD27"))
> library(RColorBrewer)
>
> m<-plotGoogleMaps(nc,zcol="NWBIR74",filename='MyMap6.htm',
> mapTypeId='TERRAIN',colPalette= brewer.pal(7,"Reds"),
> strokeColor="white")
>
> Check your version of R and packages.
>
> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United
> Kingdom.1252
> [3] LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C
> [5] LC_TIME=English_United Kingdom.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] RColorBrewer_1.0-5 plotGoogleMaps_2.0 lattice_0.20-24    maptools_0.8-29
> rgdal_0.8-16
> [6] sp_1.0-14
>
> loaded via a namespace (and not attached):
> [1] foreign_0.8-59 grid_3.0.2     tools_3.0.2
>
> Best,
>
> Milan
>
>
>
>
> On Fri, Mar 7, 2014 at 2:24 PM, Marc Mar? Dell'Olmo <marceivissa at gmail.com>
> wrote:
>>
>> Dear all,
>>
>> I'm trying to do a quantile map (specifically septile map) with
>> plotGoogleMaps. I obtain the map, but this map don't display the
>> legend with the septiles intervals. Moreover, I can display the map
>> with firefox, but I have problems with explorer...
>>
>> This is the sintax that I have used:
>> carto<-readShapeSpatial("C:/duda/carto.shp")
>> proj4string(carto) <- CRS("+proj=longlat +datum=WGS84 +no_defs")
>> plotGoogleMaps(carto, zcol="RMEs", filename="C:/duda/map.html",
>> mapTypeId='ROADMAP', colPalette= brewer.pal(7,"Reds"),
>> strokeColor="white", openMap=T)
>>
>>
>> With the following link you can download the data to execute this
>> syntax and the file "map.html" with the map:
>>
>> https://dl.dropboxusercontent.com/u/14934021/duda.zip
>>
>>
>> Thank you very much!
>>
>>
>> Marc
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
> Dr. Milan Kilibarda
>
> University of Belgrade,
> Faculty of Civil Engineering,
> Department of Geodesy and Geoinformatics,
> Address: Bulevar kralja Aleksandra 73  11000 Belgrade, Serbia,
> Mail:  kili at grf.bg.ac.rs
>
> tel:+381 11 3218516


From d.g.rossiter at utwente.nl  Sat Mar  8 10:15:55 2014
From: d.g.rossiter at utwente.nl (d.g.rossiter at utwente.nl)
Date: Sat, 8 Mar 2014 09:15:55 +0000
Subject: [R-sig-Geo] Error fitting separable space-time variogram model
Message-ID: <2BB4CAA243815F4BA16E205054AA61D1169175DB@EXMBX22.ad.utwente.nl>

I am developing a tutorial on space-time geostatistics, expanding on the nice st.pdf vignette. I can successfully fit a metric variogram model to an s-t empirical variogram, but when I try to fit a separable model I get an error which I can't solve nor interpret:

"Error in vgm(1 - par[4], as.character(model$time$model[2]), par[3], par[4],  : 
   range should be positive"

A reproducible example follows. I updated all packages immediately before running this example. Thanks for your help.

System info:

> version
platform       x86_64-apple-darwin10.8.0   
arch           x86_64                      
os             darwin10.8.0                
system         x86_64, darwin10.8.0        
status                                     
major          3                           
minor          0.2                         
year           2013                        
month          09                          
day            25                          
svn rev        63987                       
language       R                           
version.string R version 3.0.2 (2013-09-25)
nickname       Frisbee Sailing             
> help(package="sp")$info[[1]][2]
[1] "Version:            1.0-14"
> help(package="spacetime")$info[[1]][2]
[1] "Version:            1.0-9"
> help(package="xts")$info[[1]][4]
[1] "Version:            0.9-7"
> help(package="gstat")$info[[1]][2]
[1] "Version:            1.0-18"


## condensed and adapted from st.pdf, 13-Feb-2013
require(sp); require(xts); require(spacetime); require(gstat)
## Germany & neighbours air quality
data(air)
rr <- rural[, "2005::2010"]
na.stations <- which(apply(as(rr, "xts"), 2, function(x) all(is.na(x))))
r5to10 <- rr[-na.stations,]
vst <- variogram(PM10 ~ 1, r5to10[,1:200])
plot(vst, map=FALSE)
## code from p. 8 of st.pdf
vgm.sep <- vgmST(stModel="separable",
                 space=vgm(0.9,"Exp", 123,0.1),
                 time=vgm(0.9,"Exp", 2.9, 0.1),
                 sill=60)
vgmf.sep <- fit.StVariogram(vst, vgm.sep, method = "L-BFGS-B") ## gives an error
## "Error in vgm(1 - par[4], as.character(model$time$model[2]), par[3], par[4],  : 
##  range should be positive"

## my system and package info
version
help(package="sp")$info[[1]][2]
help(package="spacetime")$info[[1]][2]
help(package="xts")$info[[1]][4]
help(package="gstat")$info[[1]][2]
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 496 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140308/80d9c668/attachment.bin>

From ben.graeler at uni-muenster.de  Sat Mar  8 12:16:38 2014
From: ben.graeler at uni-muenster.de (=?ISO-8859-1?Q?Benedikt_Gr=E4ler?=)
Date: Sat, 08 Mar 2014 12:16:38 +0100
Subject: [R-sig-Geo] Error fitting separable space-time variogram model
In-Reply-To: <2BB4CAA243815F4BA16E205054AA61D1169175DB@EXMBX22.ad.utwente.nl>
References: <2BB4CAA243815F4BA16E205054AA61D1169175DB@EXMBX22.ad.utwente.nl>
Message-ID: <9482f490-d5a5-4026-917b-99ba3ec2c949@email.android.com>

The error occurs when the internally used optim function tries a non-positive range. You can either try to use different start values for your model or provide boundary arguments as in optim to fit.StVariogram. These are passed on to optim via ..., see the help page of optim for details. The demo stkrige provides as well examples on how to limit the range of possible parameter values. 

Hth,

 Ben

On March 8, 2014 10:15:55 AM CET, d.g.rossiter at utwente.nl wrote:
>I am developing a tutorial on space-time geostatistics, expanding on
>the nice st.pdf vignette. I can successfully fit a metric variogram
>model to an s-t empirical variogram, but when I try to fit a separable
>model I get an error which I can't solve nor interpret:
>
>"Error in vgm(1 - par[4], as.character(model$time$model[2]), par[3],
>par[4],  : 
>   range should be positive"
>
>A reproducible example follows. I updated all packages immediately
>before running this example. Thanks for your help.
>
>System info:
>
>> version
>platform       x86_64-apple-darwin10.8.0   
>arch           x86_64                      
>os             darwin10.8.0                
>system         x86_64, darwin10.8.0        
>status                                     
>major          3                           
>minor          0.2                         
>year           2013                        
>month          09                          
>day            25                          
>svn rev        63987                       
>language       R                           
>version.string R version 3.0.2 (2013-09-25)
>nickname       Frisbee Sailing             
>> help(package="sp")$info[[1]][2]
>[1] "Version:            1.0-14"
>> help(package="spacetime")$info[[1]][2]
>[1] "Version:            1.0-9"
>> help(package="xts")$info[[1]][4]
>[1] "Version:            0.9-7"
>> help(package="gstat")$info[[1]][2]
>[1] "Version:            1.0-18"
>
>
>## condensed and adapted from st.pdf, 13-Feb-2013
>require(sp); require(xts); require(spacetime); require(gstat)
>## Germany & neighbours air quality
>data(air)
>rr <- rural[, "2005::2010"]
>na.stations <- which(apply(as(rr, "xts"), 2, function(x)
>all(is.na(x))))
>r5to10 <- rr[-na.stations,]
>vst <- variogram(PM10 ~ 1, r5to10[,1:200])
>plot(vst, map=FALSE)
>## code from p. 8 of st.pdf
>vgm.sep <- vgmST(stModel="separable",
>                 space=vgm(0.9,"Exp", 123,0.1),
>                 time=vgm(0.9,"Exp", 2.9, 0.1),
>                 sill=60)
>vgmf.sep <- fit.StVariogram(vst, vgm.sep, method = "L-BFGS-B") ## gives
>an error
>## "Error in vgm(1 - par[4], as.character(model$time$model[2]), par[3],
>par[4],  : 
>##  range should be positive"
>
>## my system and package info
>version
>help(package="sp")$info[[1]][2]
>help(package="spacetime")$info[[1]][2]
>help(package="xts")$info[[1]][4]
>help(package="gstat")$info[[1]][2]
>
>
>------------------------------------------------------------------------
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Benedikt Gr?ler

Institute for Geoinformatics
University of M?nster

http://www.ifgi.de/graeler

+49 251 83 33082


From mauriziomarchi85 at gmail.com  Sat Mar  8 14:21:55 2014
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Sat, 8 Mar 2014 14:21:55 +0100
Subject: [R-sig-Geo] Best raster of raster stack
Message-ID: <CANJhsN0vqgLSAmVxscgtAjid+=xiucsdZjQFE4Fuhsku4S1gnw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140308/62f7497e/attachment.pl>

From roman.lustrik at gmail.com  Sat Mar  8 15:01:24 2014
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 8 Mar 2014 15:01:24 +0100
Subject: [R-sig-Geo] Best raster of raster stack
In-Reply-To: <CANJhsN0vqgLSAmVxscgtAjid+=xiucsdZjQFE4Fuhsku4S1gnw@mail.gmail.com>
References: <CANJhsN0vqgLSAmVxscgtAjid+=xiucsdZjQFE4Fuhsku4S1gnw@mail.gmail.com>
Message-ID: <CAHT1vph_CPscmuMsTkQbpEz3_YmeDQCV_hVjjxhD9KW9z+pUSw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140308/505e9e39/attachment.pl>

From dicko.ahmadou at gmail.com  Sat Mar  8 15:21:05 2014
From: dicko.ahmadou at gmail.com (Ahmadou Dicko)
Date: Sat, 8 Mar 2014 14:21:05 +0000
Subject: [R-sig-Geo] Best raster of raster stack
In-Reply-To: <CAHT1vph_CPscmuMsTkQbpEz3_YmeDQCV_hVjjxhD9KW9z+pUSw@mail.gmail.com>
References: <CANJhsN0vqgLSAmVxscgtAjid+=xiucsdZjQFE4Fuhsku4S1gnw@mail.gmail.com>
	<CAHT1vph_CPscmuMsTkQbpEz3_YmeDQCV_hVjjxhD9KW9z+pUSw@mail.gmail.com>
Message-ID: <CAP8THHWPeKrJuCbJspZ+WvNCdBYtyhO=ze9FtkxCSo3qYT4eEg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140308/9f5abd11/attachment.pl>

From markpayneatwork at gmail.com  Sat Mar  8 16:43:23 2014
From: markpayneatwork at gmail.com (Mark Payne)
Date: Sat, 8 Mar 2014 16:43:23 +0100
Subject: [R-sig-Geo] Spplot: Specifying individual point symbols
In-Reply-To: <CAMLL7b=ZnNj8WcSTOAAYvCpPO_BGtM-TcmL=yFXcR659xxThbA@mail.gmail.com>
References: <CAGBzUO_z+kWOZYcnm-+Ab0zAgkYEPkSm6X7Qn9oKm2Bt4Oszyg@mail.gmail.com>
	<CAMLL7b=ZnNj8WcSTOAAYvCpPO_BGtM-TcmL=yFXcR659xxThbA@mail.gmail.com>
Message-ID: <CAGBzUO_KgSG9o4q6tph2ib5wpd7C7t=VJ3ppo-0QGxWFoqGHHA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140308/3f3e7ad4/attachment.pl>

From mauriziomarchi85 at gmail.com  Sat Mar  8 17:15:44 2014
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Sat, 8 Mar 2014 17:15:44 +0100
Subject: [R-sig-Geo] Best raster of raster stack
In-Reply-To: <CAP8THHWPeKrJuCbJspZ+WvNCdBYtyhO=ze9FtkxCSo3qYT4eEg@mail.gmail.com>
References: <CANJhsN0vqgLSAmVxscgtAjid+=xiucsdZjQFE4Fuhsku4S1gnw@mail.gmail.com>
	<CAHT1vph_CPscmuMsTkQbpEz3_YmeDQCV_hVjjxhD9KW9z+pUSw@mail.gmail.com>
	<CAP8THHWPeKrJuCbJspZ+WvNCdBYtyhO=ze9FtkxCSo3qYT4eEg@mail.gmail.com>
Message-ID: <CANJhsN1O-bdKxbtXtt6DoF3PMG6HrSmiQu3kd+HU6YmnNaQ0ww@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140308/06e8c84c/attachment.pl>

From jgrn at illinois.edu  Sat Mar  8 21:33:25 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sat, 8 Mar 2014 14:33:25 -0600
Subject: [R-sig-Geo] Best raster of raster stack
In-Reply-To: <CANJhsN1O-bdKxbtXtt6DoF3PMG6HrSmiQu3kd+HU6YmnNaQ0ww@mail.gmail.com>
References: <CANJhsN0vqgLSAmVxscgtAjid+=xiucsdZjQFE4Fuhsku4S1gnw@mail.gmail.com>
	<CAHT1vph_CPscmuMsTkQbpEz3_YmeDQCV_hVjjxhD9KW9z+pUSw@mail.gmail.com>
	<CAP8THHWPeKrJuCbJspZ+WvNCdBYtyhO=ze9FtkxCSo3qYT4eEg@mail.gmail.com>
	<CANJhsN1O-bdKxbtXtt6DoF3PMG6HrSmiQu3kd+HU6YmnNaQ0ww@mail.gmail.com>
Message-ID: <CABG0rfu9XcFB1omCsZoqFG9ev6gYxMssh=v5W+nEHKH6tFgDgQ@mail.gmail.com>

Just to throw yet another solution into the pot, here's how to do this
with rasterEngine (which will allow for parallel processing of your
input to potentially speed your process up):

# Individual rasters as inputs approach:
library(spatial.tools)
raster1 <- raster(system.file("external/tahoe_lidar_bareearth.tif",
package="spatial.tools"))
raster2 <- raster(system.file("external/tahoe_lidar_highesthit.tif",
package="spatial.tools"))

sfQuickInit() # Spawns a number of parallel workers = half your CPUs
(you can mod this with the cpus= parameter)
max_of_rasters <- function(raster1,raster2)
{
output <- pmax(raster1,raster2)
dim(output) <- c(dim(raster1)[1:2],1)
return(output)
}

max_of_rasters_output <-
rasterEngine(raster1=raster1,raster2=raster2,fun=max_of_rasters,debugmode=FALSE)

# Combining all the rasters into a single stack approach (probably
easier for your application):
max_of_stack <- function(stack1)
{
output <- apply(stack1,1:2,max)
dim(output) <- c(dim(stack1)[1:2],1)
return(output)
}

stack1 <- stack(raster1,raster2)
max_of_stack_output <-
rasterEngine(stack1=stack1,fun=max_of_stack,debugmode=FALSE)

sfQuickStop() # Turn off the parallel processing engine.

On Sat, Mar 8, 2014 at 10:15 AM, Maurizio Marchi
<mauriziomarchi85 at gmail.com> wrote:
> Tanks a lot for your suggestions. maybe there will be a lot of different
> ways to do that but merging your scripts I found exactly what I wanted to
> do:
>
> # beginning
> library(raster)
> r1 <- raster(matrix(c(1,1,1,2,2,2,4,4,4), ncol = 3))
> r2 <- raster(matrix(c(2,2,2,3,3,3,1,1,1), ncol = 3))
> r3 <- raster(matrix(c(5,5,5,1,1,1,2,2,2), ncol = 3))
> r <- stack(r1,r2,r3)
> plot(r)
> #?calc
> res1<-calc(r,fun=max) # single raster map with maximum values of all 3
> rasters
> plot(res1)
> # end
>
>  Now let's see if my i5 processor is able to process 22 raster maps
> with 77,760,000
> cells each.... :)
>
> thank You very much again!!
>
> --
> Maurizio Marchi, PhD student
> CRA-SEL (Arezzo, Italy)
> www.selvicoltura.eu
> ID skype: maurizioxyz
> *Ubuntu 12.04 LTS*
> *"Il bello dell'open-source ? che le domande possono essere poste alla
> fonte"*
> *utente linux 552.742*
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jgrn at illinois.edu  Sat Mar  8 21:37:30 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sat, 8 Mar 2014 14:37:30 -0600
Subject: [R-sig-Geo] Best raster of raster stack
In-Reply-To: <CABG0rfu9XcFB1omCsZoqFG9ev6gYxMssh=v5W+nEHKH6tFgDgQ@mail.gmail.com>
References: <CANJhsN0vqgLSAmVxscgtAjid+=xiucsdZjQFE4Fuhsku4S1gnw@mail.gmail.com>
	<CAHT1vph_CPscmuMsTkQbpEz3_YmeDQCV_hVjjxhD9KW9z+pUSw@mail.gmail.com>
	<CAP8THHWPeKrJuCbJspZ+WvNCdBYtyhO=ze9FtkxCSo3qYT4eEg@mail.gmail.com>
	<CANJhsN1O-bdKxbtXtt6DoF3PMG6HrSmiQu3kd+HU6YmnNaQ0ww@mail.gmail.com>
	<CABG0rfu9XcFB1omCsZoqFG9ev6gYxMssh=v5W+nEHKH6tFgDgQ@mail.gmail.com>
Message-ID: <CABG0rfsmHHdOjBZNeiP8gxaUtycrM1JNKxnUYzsRjBXYE8zOVQ@mail.gmail.com>

Small mod: the above works with version 1.3.4 or later of
spatial.tools (on R-forge, at the time of this email) -- if you are
using an earlier version (e.g. the one on CRAN at the time of this
email), you need to slightly modify the function headers to include
ellipses:

max_of_rasters <- function(raster1,raster2,...)

max_of_stack <- function(stack1,...)


On Sat, Mar 8, 2014 at 2:33 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
> Just to throw yet another solution into the pot, here's how to do this
> with rasterEngine (which will allow for parallel processing of your
> input to potentially speed your process up):
>
> # Individual rasters as inputs approach:
> library(spatial.tools)
> raster1 <- raster(system.file("external/tahoe_lidar_bareearth.tif",
> package="spatial.tools"))
> raster2 <- raster(system.file("external/tahoe_lidar_highesthit.tif",
> package="spatial.tools"))
>
> sfQuickInit() # Spawns a number of parallel workers = half your CPUs
> (you can mod this with the cpus= parameter)
> max_of_rasters <- function(raster1,raster2)
> {
> output <- pmax(raster1,raster2)
> dim(output) <- c(dim(raster1)[1:2],1)
> return(output)
> }
>
> max_of_rasters_output <-
> rasterEngine(raster1=raster1,raster2=raster2,fun=max_of_rasters,debugmode=FALSE)
>
> # Combining all the rasters into a single stack approach (probably
> easier for your application):
> max_of_stack <- function(stack1)
> {
> output <- apply(stack1,1:2,max)
> dim(output) <- c(dim(stack1)[1:2],1)
> return(output)
> }
>
> stack1 <- stack(raster1,raster2)
> max_of_stack_output <-
> rasterEngine(stack1=stack1,fun=max_of_stack,debugmode=FALSE)
>
> sfQuickStop() # Turn off the parallel processing engine.
>
> On Sat, Mar 8, 2014 at 10:15 AM, Maurizio Marchi
> <mauriziomarchi85 at gmail.com> wrote:
>> Tanks a lot for your suggestions. maybe there will be a lot of different
>> ways to do that but merging your scripts I found exactly what I wanted to
>> do:
>>
>> # beginning
>> library(raster)
>> r1 <- raster(matrix(c(1,1,1,2,2,2,4,4,4), ncol = 3))
>> r2 <- raster(matrix(c(2,2,2,3,3,3,1,1,1), ncol = 3))
>> r3 <- raster(matrix(c(5,5,5,1,1,1,2,2,2), ncol = 3))
>> r <- stack(r1,r2,r3)
>> plot(r)
>> #?calc
>> res1<-calc(r,fun=max) # single raster map with maximum values of all 3
>> rasters
>> plot(res1)
>> # end
>>
>>  Now let's see if my i5 processor is able to process 22 raster maps
>> with 77,760,000
>> cells each.... :)
>>
>> thank You very much again!!
>>
>> --
>> Maurizio Marchi, PhD student
>> CRA-SEL (Arezzo, Italy)
>> www.selvicoltura.eu
>> ID skype: maurizioxyz
>> *Ubuntu 12.04 LTS*
>> *"Il bello dell'open-source ? che le domande possono essere poste alla
>> fonte"*
>> *utente linux 552.742*
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From oscar.perpinan at upm.es  Mon Mar 10 10:03:29 2014
From: oscar.perpinan at upm.es (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Mon, 10 Mar 2014 10:03:29 +0100
Subject: [R-sig-Geo] Spplot: Specifying individual point symbols
In-Reply-To: <CAGBzUO_KgSG9o4q6tph2ib5wpd7C7t=VJ3ppo-0QGxWFoqGHHA@mail.gmail.com>
References: <CAGBzUO_z+kWOZYcnm-+Ab0zAgkYEPkSm6X7Qn9oKm2Bt4Oszyg@mail.gmail.com>
	<CAMLL7b=ZnNj8WcSTOAAYvCpPO_BGtM-TcmL=yFXcR659xxThbA@mail.gmail.com>
	<CAGBzUO_KgSG9o4q6tph2ib5wpd7C7t=VJ3ppo-0QGxWFoqGHHA@mail.gmail.com>
Message-ID: <CAMLL7bm=vFeCbbisemTobpHn68zu2Qunj-ZvTvRPRZcup7_CcA@mail.gmail.com>

I am using sp 1.0-14 and lattice 0.20.27.

Best,

Oscar.
-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


2014-03-08 16:43 GMT+01:00 Mark Payne <markpayneatwork at gmail.com>:
> Hi Oscar,
>
> Thanks for the reply. Unfortunately your example doesn't work for me. What
> version of sp and lattice do you have installed?
>
> Package: sp
> Version: 1.0-14
> Date: 2013-10-15
>
> Package: lattice
> Version: 0.20-15
> Date: 2013/03/24
>
> Mark
>
>
> On 7 March 2014 16:25, Oscar Perpi?an <oscar.perpinan at upm.es> wrote:
>
>> Use groups instead:
>>
>> spplot(meuse["elev"], groups=ifelse(meuse$dist < 0.3, 1, 2), pch=c(1, 16))
>>
>> Oscar.
>> -----------------------------------------------------------------
>> Oscar Perpi??n Lamigueiro
>> Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
>> Grupo de Sistemas Fotovoltaicos (IES-UPM)
>> URL: http://oscarperpinan.github.io
>> Twitter: @oscarperpinan
>>
>>
>> 2014-03-07 15:29 GMT+01:00 Mark Payne <markpayneatwork at gmail.com>:
>> > Hi,
>> >
>> > I have a problem where I would like to have both the colour and the
>> symbol
>> > varying in an spplot plot. Unfortunately, specifying a list of pch values
>> > doesn't seem to work. See the following example
>> >
>> > library(sp)
>> > data(meuse)
>> > coordinates(meuse) <- ~x +y
>> > #Lets plot the elevation
>> > spplot(meuse,"elev")
>> > #And now the distance
>> > spplot(meuse,"dist")
>> > #Lets plot the points close to the river with open points
>> > spplot(meuse,"elev",
>> >        colorkey=TRUE,
>> >        pch=ifelse(meuse$dist<0.3,1,16))
>> >
>> > What I'm aiming for is to have all the points close to the river open
>> > circles (pch=1), and all the points further from the river to be closed
>> > (pch=16). However, the pch symbols don't seem to be propigating through
>> > into the panel function correctly. The problem seems to arise somewhere
>> the
>> > Fill.call.groups() function, but I can't quite figure out where....
>> >
>> > This type of trick is legitimate in lattice, which is where my
>> inspiration
>> > came from eg:
>> >
>> > x <- rnorm(1000)
>> > y <- rnorm(1000)
>> > z <- sqrt(x^2 + y^2)
>> > xyplot(y~x,pch=ifelse(z<1,16,1),asp="iso",cex=1)
>> >
>> > As you can see, I have managed to change the symbol according  to the
>> > distance from the centre.
>> >
>> > Am I asking too much of spplot to try and achieve this type of thing - we
>> > are starting to getting pretty complex here! Or am I doing something
>> wrong?
>> >
>> > Best wishes,
>> >
>> > Mark
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hengl at spatial-analyst.net  Mon Mar 10 10:46:02 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 10 Mar 2014 10:46:02 +0100
Subject: [R-sig-Geo] First announcement and call for papers: "Spatial and
 spatio-temporal models for interpolating climatic and meteorological data"
 (special issue in Spatial Statistics journal)
Message-ID: <531D89DA.2000201@spatial-analyst.net>


If you are a meteorologist/climatologist, GIS scientist and/or involved 
with using global and continental meteo/climatic data for environmental 
modeling, consider submitting a research paper for a special issue of 
Spatial Statistics journal 
(http://www.journals.elsevier.com/spatial-statistics/) entitled "Spatial 
and spatio-temporal models for interpolating climatic and meteorological 
data" (associate editors: Hengl, Pebesma and Hijmans). Submissions for 
the special issue will open on 1st of July 2014 (with submission 
deadline of 15th of October 2014, and acceptance deadline on 1st of 
March 2015), i.e. just after the http://dailymeteo.org/2014 conference 
in Belgrade.

The DailyMeteo.org/2014 conference will be run as a five day event in 
the period 23-27 June 2014 starting with three days of workshops and 
package tutorials. The three-day workshops will consists of software 
tutorials including:

- Edzer Pebesma: spacetime / gstat package tutorials (spatial and 
spatio-temporal statistics with R)
- Milan Kilibarda: plotGoogleMaps / meteo package tutorials
- Tomislav Hengl: plotKML package tutorial (visualization of spatial and 
spatio-temporal data from R to Google Earth)
- Benedikt Gr?ler: gstat package tutorial (choosing and fitting 
spatio-temporal models for meteorological data)

After the workshops we will run a two-days conference will several 
keynote speakers / leading researchers in the field:

- prof. dr. Edzer Pebesma, University of M?nster, Germany: "Spatial and 
temporal support of meteorological observations and predictions"
- dr. Raymond Sluiter, KNMI, the Netherlands: "An operational R-based 
interpolation facility for climate and meteo data"
- dr. Gerard B.M. Heuvelink, Wageningen University: "Statistical 
modelling of space-time variability"
- dr. Robert Hijmans, University of California, Davis: "New global 
climate surfaces, and the trade-off between space and time"
- Mojca Dolinar, Environmental Agency of Republic of Slovenia: 
"Production of climate maps: operational issues and challenges"
- Prof. Slobodan Simonovic from Civil and Environmental Engineering 
Department of the University of Western Ontario: "Modeling resilience to 
climate change in space and time"

We aim at establishing an international consortium to support production 
of an open archive of meteorological images at high spatial (1 km) and 
temporal (1 day) resolution.

IMPORTANT DEADLINES:
March 30th 2014 - abstract submission / registration deadline
May 15th 2014 - deadline early birds
June 23-27 2014 - conference
July 1st of 2014 - submissions open

We are looking forward to seeing you in Belgrade!

For more info see: http://dailymeteo.org/2014

-- 
T. (Tom) Hengl
Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
Network: http://profiles.google.com/tom.hengl
Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ


From hislam at isrt.ac.bd  Mon Mar 10 14:57:38 2014
From: hislam at isrt.ac.bd (Humayera Islam)
Date: Mon, 10 Mar 2014 19:57:38 +0600
Subject: [R-sig-Geo] Fitting Spatio-Temporal Variogram using WLS
In-Reply-To: <CAKfowgv_V4gaQoR_2+JuqBGsKCcz5aDViON3=BFOXre2G_jUPQ@mail.gmail.com>
References: <CAKfowgv_V4gaQoR_2+JuqBGsKCcz5aDViON3=BFOXre2G_jUPQ@mail.gmail.com>
Message-ID: <CAKfowgtPmj3NB69bhjWGM1sYMQK70_du1=zR0RAis2UJ3d42zQ@mail.gmail.com>

I have been trying to fit a Spatio-Temporal Variogram using non-separable
classes of covariances using the WLS criterion(attached is my data file). But
I'm not getting any result using optim() or nls(). Here is the way I'm
using the optim() function for a single parametric model.

weights<-c(with(coord.smooth,table(tlag,slag)))
weights<-weights[-1]

##Parametric ST variogram Families
weightedLS<-function(par){
  Sigma<-par[1]
  Tau<-par[2]
  a<-par[3]
  b<-par[4]
  n<-weights
  observed<-coord.smooth[,3]
  h<-coord.smooth[,2]
  u<-coord.smooth[,1]
  eg1<-exp(-b^2*h^2/(a^2*u^2+1))/(a^2*u^2+1)
  pred<-Sigma*(1-eg1)+Tau
  wls<-sum(n*(observed/pred)-1)^2
  return(wls)

}

eg1.fit<-optim(c(0,0,0,0),fn=weightedLS,
               method="L-BFGS-B",lower=rep(0,4))



On Mon, Mar 10, 2014 at 7:42 PM, Humayera Islam <hislam at isrt.ac.bd> wrote:

> I have been trying to fit a Spatio-Temporal Variogram using non-separable
> classes of covariances using the WLS criterion, as described in papers such
> as Cressie and Huang(1999), Gneiting (2002). Attached is the .Rda file
> which includes a data set named coord.smooth having three variables time
> lag, space lag and variogram values. I have plotted a wireframe as well.
> But I'm not getting any result using optim() or nls(). Here is the way I'm
> using the optim() function for a single parametric model.
>
> weights<-c(with(coord.smooth,table(tlag,slag)))
> weights<-weights[-1]
> ##Cressie Huang (1991)
> ##Parametric ST variogram Families
> weightedLS<-function(par){
>   Sigma<-par[1]
>   Tau<-par[2]
>   a<-par[3]
>   b<-par[4]
>   n<-weights
>   observed<-coord.smooth[,3]
>   h<-coord.smooth[,2]
>   u<-coord.smooth[,1]
>   eg1<-exp(-b^2*h^2/(a^2*u^2+1))/(a^2*u^2+1)
>   pred<-Sigma*(1-eg1)+Tau
>   wls<-sum(n*(observed/pred)-1)^2
>   return(wls)
>
> }
>
> eg1.fit<-optim(c(0,0,0,0),fn=weightedLS,
>                method="L-BFGS-B",lower=rep(0,4))
> I have obtained the following error:
>
> Error in optim(c(0, 0, 0, 0), fn = weightedLS, method = "L-BFGS-B", lower
> = rep(0,  :
>   L-BFGS-B needs finite values of 'fn'
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140310/e2524186/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: coord.smooth.Rda
Type: application/octet-stream
Size: 25454 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140310/e2524186/attachment.obj>

From afischbach at usgs.gov  Mon Mar 10 20:19:11 2014
From: afischbach at usgs.gov (Anthony Fischbach)
Date: Mon, 10 Mar 2014 12:19:11 -0700 (PDT)
Subject: [R-sig-Geo] build polygons from ellipses,
 then sample points within the polygons
Message-ID: <1394479150872-7585922.post@n2.nabble.com>

I have estimated location error ellipses generated from a continuous-time
version of the correlated random walk model for animal telemetry data 
(see http://cran.r-project.org/web/packages/crawl/index.html, functions: 
crwMLE and crwPredict). 
>From these error ellipses, I wish to randomly select points.  
Toward this end, I have two questions.

Question 1: Is there a handy function that readily allows creation of
polygons from ellipses?
## toy example
ellipses<-data.frame(x=c(251753, 252966, 254179), 
						y=c(343394, 343315, 343237), 
						majorAxis=c(0.0, 2753.5, 2114.8), 
						minorAxis=c(0.0,  2754.1, 2118.0),
						angle=c(0,0,0)) ## dataFrame with Ellipse information
						## in this case the majorAxis is assumed to lie along the x axis
                                                ## x, y define the centroid
of the ellipse.
coordinates(ellipses) <- x~y  ## cast to a spatialPointsDataFrame
ellipses.poly <-
Wonder.function.that.Makes.spatialPolygons.from.ellipses(ellipses)

Question 2:  I know that there is a handy means to randomly generate
locations from within a SpatialPolygon.  Please help me find it.



-----
Tony Fischbach, Wildlife Biologist
Walrus Research Program
Alaska Science Center
U.S. Geological Survey
4210 University Drive
Anchorage, AK 99508-4650

AFischbach at usgs.gov
http://alaska.usgs.gov/science/biology/walrus
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/build-polygons-from-ellipses-then-sample-points-within-the-polygons-tp7585922.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From dr_achughes at hotmail.co.uk  Tue Mar 11 02:01:05 2014
From: dr_achughes at hotmail.co.uk (Alice C. Hughes)
Date: Tue, 11 Mar 2014 01:01:05 +0000
Subject: [R-sig-Geo] overlapping polygons in shapefile
In-Reply-To: <DUB126-W643259210632B46E501829DD770@phx.gbl>
References: <4947fa1d-dfc3-4e6c-94e9-911971b1e199@googlegroups.com>,
	<0297100C-6991-44B9-93C8-62DD0C947F52@gmail.com>,
	<9BEE83C6BF59174DBD2CB4A06EB6CBEB41DDB0C3@SINPRD0111MB368.apcprd01.prod.exchangelabs.com>,
	<a9fef564-116a-45d9-b24e-5de08cf0c383@googlegroups.com>,
	<CAE_Q_21Czd_9ybm0v_oKOpCsuiK63H9aGVSeh_4yO2MVGcTPBw@mail.gmail.com>,
	<DUB126-W643259210632B46E501829DD770@phx.gbl>
Message-ID: <DUB126-W528B387C6FE14D4A6809C5DD770@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140311/bfb424a1/attachment.pl>

From mdsumner at gmail.com  Tue Mar 11 09:42:37 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 11 Mar 2014 19:42:37 +1100
Subject: [R-sig-Geo] New code and package naming
In-Reply-To: <CANVKczPisxY0bxfmT+-+sRKY83WtL1VrGEFcmvWe6e01HrVCng@mail.gmail.com>
References: <CANnL8gpcVanRF_a_sP3TmUjSYRDy9s0pRPA1uNPgd7uB8K4j7Q@mail.gmail.com>
	<CANtt_hyzxf6jQJfUf6+JBM9YyWRcLU+kY_j1A4AFUw=00fcY2g@mail.gmail.com>
	<CANnL8gpKDazNoJwLTM5qwBrh5dM3UqoJ6ZtE49we3-=9Z00KRA@mail.gmail.com>
	<CANVKczPisxY0bxfmT+-+sRKY83WtL1VrGEFcmvWe6e01HrVCng@mail.gmail.com>
Message-ID: <CAAcGz9-yz7A98dnWBri6bCZEAdQXYRDD5rmmGXov8b45uOE2Jw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140311/b5975b04/attachment.pl>

From d.g.rossiter at utwente.nl  Tue Mar 11 16:07:17 2014
From: d.g.rossiter at utwente.nl (rossiter_nl)
Date: Tue, 11 Mar 2014 08:07:17 -0700 (PDT)
Subject: [R-sig-Geo] Error fitting separable space-time variogram model
In-Reply-To: <9482f490-d5a5-4026-917b-99ba3ec2c949@email.android.com>
References: <2BB4CAA243815F4BA16E205054AA61D1169175DB@EXMBX22.ad.utwente.nl>
	<9482f490-d5a5-4026-917b-99ba3ec2c949@email.android.com>
Message-ID: <1394550437136-7585925.post@n2.nabble.com>

Thank you for this help. Unfortunately the help page for fit.StVariogram 
gives no guidance on this, just "... arguments passed to optim". Looking at
?optim, we can see there are many control parameters, including bounds for
the box method "L-BFGS-B". But there is no mention of the parameters being
optimized in the various model forms (metric, separable etc.) and their
order, and no way to find out until the model is fit, then we can see the
attribute "pars" to see the order of parameters. The order in the call to
build the variogram model (which will be optimized) has the parameters in
the proper order (space range, then nugget; time range then nugget; sill)
once one realizes that the partial sills in the space and time models are
only proportional and will be adjusted according to the nugget. But that's
not obvious, it could be that the partial sills are adjusted and the nugget
follows along.

The examples in demo(stkrige) were very helpful; it might be good to include
a reference to that on the fit.StVariogram help page. Even better would be
to list the arguments to optim and their order for each model form. I did
not think to look at demo(package="gstat") to see if there were a demo on
space-time kriging, sorry for that.

Thanks for providing this nice functionality.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-fitting-separable-space-time-variogram-model-tp7585910p7585925.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From nature.aseem at gmail.com  Tue Mar 11 17:27:07 2014
From: nature.aseem at gmail.com (Aseem Sharma)
Date: Tue, 11 Mar 2014 09:27:07 -0700
Subject: [R-sig-Geo] Subset time for netCDF
Message-ID: <CAPB42UyVyfZ5jNbC7r2MmKh+=rxSuDG8MmuMHYibWBg6te0WUg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140311/dfc21161/attachment.pl>

From zaholdenfs at gmail.com  Tue Mar 11 17:48:49 2014
From: zaholdenfs at gmail.com (Zack Holden)
Date: Tue, 11 Mar 2014 10:48:49 -0600
Subject: [R-sig-Geo] Subset time for netCDF
In-Reply-To: <CAPB42UyVyfZ5jNbC7r2MmKh+=rxSuDG8MmuMHYibWBg6te0WUg@mail.gmail.com>
References: <CAPB42UyVyfZ5jNbC7r2MmKh+=rxSuDG8MmuMHYibWBg6te0WUg@mail.gmail.com>
Message-ID: <CAGC_mZTFtMp_3A7f553CNWvvFjiwJz=LRR0urAzLFZJ56mAamQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140311/616e14c7/attachment.pl>

From nature.aseem at gmail.com  Tue Mar 11 18:23:20 2014
From: nature.aseem at gmail.com (Aseem Sharma)
Date: Tue, 11 Mar 2014 10:23:20 -0700
Subject: [R-sig-Geo] Subset time for netCDF
In-Reply-To: <CAGC_mZTFtMp_3A7f553CNWvvFjiwJz=LRR0urAzLFZJ56mAamQ@mail.gmail.com>
References: <CAPB42UyVyfZ5jNbC7r2MmKh+=rxSuDG8MmuMHYibWBg6te0WUg@mail.gmail.com>
	<CAGC_mZTFtMp_3A7f553CNWvvFjiwJz=LRR0urAzLFZJ56mAamQ@mail.gmail.com>
Message-ID: <CAPB42UxcucoRrAi5pJ4Y0U4EkouAz3b8mMv1VTJav4CkzxGbuA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140311/18b99505/attachment.pl>

From Roger.Bivand at nhh.no  Tue Mar 11 20:56:02 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 11 Mar 2014 20:56:02 +0100
Subject: [R-sig-Geo] overlapping polygons in shapefile
In-Reply-To: <DUB126-W528B387C6FE14D4A6809C5DD770@phx.gbl>
References: <4947fa1d-dfc3-4e6c-94e9-911971b1e199@googlegroups.com>,
	<0297100C-6991-44B9-93C8-62DD0C947F52@gmail.com>,
	<9BEE83C6BF59174DBD2CB4A06EB6CBEB41DDB0C3@SINPRD0111MB368.apcprd01.prod.exchangelabs.com>,
	<a9fef564-116a-45d9-b24e-5de08cf0c383@googlegroups.com>, 
	<CAE_Q_21Czd_9ybm0v_oKOpCsuiK63H9aGVSeh_4yO2MVGcTPBw@mail.gmail.com>,
	<DUB126-W643259210632B46E501829DD770@phx.gbl>
	<DUB126-W528B387C6FE14D4A6809C5DD770@phx.gbl>
Message-ID: <alpine.LRH.2.03.1403112037140.8931@reclus.nhh.no>

On Tue, 11 Mar 2014, Alice C. Hughes wrote:

> Hi All
> This should be simple-but ArcGis keeps getting stuck at 22%...I have a 
> large shapefile, which contains multiple overlapping polygons for 
> various species-and I would like to count for any area how many polygons 
> overlap.A script would be really fantastic!Thanks in advance

Wouldn't it just? However, as usual, such scripts will only cause grief, 
as they will not (necessarily) match your workflow. Most likely, you 
have two choices, one to rasterise thr polygons separately (not 
together, because they overlap), then count overlapping cells.

If the shapefile is "large", like tens of thousands of polygons, you could 
try the rgeos package, first using gUnarySTRtreeQuery() or 
gBinarySTRtreeQuery() to identify possible overlapping candidates (these 
functions report intersecting bounding boxes of polygons).

Next try gOverlaps() subsetting the input objects by the output of the 
intersecting bounding boxes. Once you've found the overlaps, take their 
intersections with gIntersection(), and get the area with gArea(). Note 
that this only applies to planar, projected polygons. If they are in 
geographical coordinates, project before using gArea(). Look carefully at 
the byid= arguments in gOverlaps, gIntersection and gArea. Depending on 
the complexity of the setting, you may be using for loops and subsetting 
by indices - there are examples in Ch. 5 of ASDAR (2nd edition) of this 
kind of subsetting (or see the online code at www.asdar-book.org), about 
chunks 41-3 in http://www.asdar-book.org/book2ed/cm2_mod.R.

Hope this helps,

Roger

> Alice
>
> Alice C. HughesAssociate ProfessorCentre for Integrative 
> Conservation,Xishuangbanna Tropical Botanical Garden,Chinese Academy of 
> SciencesMenglun, Mengla, Yunnan 666303, P.R. ChinaPh: 
> 15198676559achughes at xtbg.ac.cn
>
> Date: Mon, 6 May 2013 14:33:29 +1000
> Subject: Re: [Trop-R] Kernel Density Estimation Bootstrap
> From: lhodgson86 at gmail.com
> To: tropical-r at googlegroups.com
>
> Hi Christian,
> This formatting shows that the data has been read in as a single column with 'V1' as the column name and 'x,y' as the value of row 1, and so on:
>
>> test<-read.table("test.csv")> test
>                V11              x,y
> 2   648501,89104003   641686,8917264
> 4   645984,89143285   647058,8913794
> 6   649659,89129257   649613,8912828
> .....
>
> You can check how many columns there are in a data frame using 'ncol':
>
> ncol(test)
> To troubleshoot, I would first try using read.csv:
>
> test=read.csv(test,as.is=TRUE)ncol(test)
>
> If this does not give you two columns, then I would check that the file really is in standard .csv format.
>
> Lauren
>
> On Mon, May 6, 2013 at 1:17 PM, Christian Gredzens <christian.gredzens at my.jcu.edu.au> wrote:
>
> Leila,
>
> Thanks for your reply. I'm using likelihood cross validation (CVh) instead of least squares cross validation (LSCV). To my knowledge adehabitatHR doesn't run CVh so I think I will need to write a script or find another program which can calculate CVh.
>
>
> I used GME from spatialecology.com to calculate all of my KDEs, but I don't think GME runs bootstrapping. So I'm trying to run it through the bootstrapping package in R. Here is what I need to do:
>
>
> 1) Create my spatial points layer
> =mydata
>
> 2) Run the bootstrapping script:
>
>> mydataboot<-boot(mydata, (KDE script), R=1000)
>
> mydata= my spatial points file
> (KDE script)= what formula to run the bootstrap on
>
> R=1000 = the number of iterations I would like to run
>
> The issue I'm having is getting the bootstrapping script to run the KDE formula=(KDE script)
>
> Cheers,
> Christian
>
> On Friday, May 3, 2013 12:58:55 AM UTC-7, Leila Brook wrote:
> Hi Christian,
>
> There is a package called adehabitatHR that does kernel density estimation with LSCV bandwidth using a function called kernelUD(). I don't know if this will is similar to what you want? You will need to have the data in UTM and in SpatialPoints or SpatialPointsDataFrame format, which you can do using the sp package.
>
>
>
> There is a great vignette for adehabitatHR that will help with data formatting and running the KDE. I  exported the utilisation distribution for ArcGIS using writeRaster() in the raster package, but you can also export as contours.
>
>
>
> Cheers
>
> Leila
>
>
>
> ________________________________________
>
> From: tropi... at googlegroups.com [tropi... at googlegroups.com] on behalf of Stewart Macdonald [stewartm... at gmail.com]
>
> Sent: Friday, 3 May 2013 5:12 PM
>
> To: tropi... at googlegroups.com
>
> Subject: Re: [Trop-R] Kernel Density Estimation Bootstrap
>
>
>
> Hi Christian,
>
>
>
> What sort of data are you trying to import? A series of lat/longs that are in a text (or Excel) file? If so, the rGDAL library can be used to create spatial points:
>
>
>
> ###############
>
> library(rgdal)
>
> # if you don't already have this installed, you can do: install.packages('rgdal')
>
>
>
> # read in the data from a tab-delimited text file that has a header line
>
> rawPoints <- read.table('/data.csv', header=TRUE, sep='\t')
>
>
>
> # format as a SpatialPoint class and define the projection/datum (WGS84)
>
> q <- cbind(rawPoints$recordLon, rawPoints$recordLat)
>
> colnames(q) <- c("x", "y")
>
> qqq <- SpatialPoints(q, proj4string=CRS("+init=epsg:4326"))
>
> ###############
>
>
>
> Note: the above is a copied-and-pasted fragment from a working script of mine. I assume this fragment will work for you.
>
>
>
> I can't help you with your second question, and the answer to your third question will depend on the format of the bootstrap data (e.g., more points, polygons, raster).
>
>
>
>
>
> Hope this helps,
>
>
>
> Stewart
>
>
>
>
>
>
>
>
>
> On 03/05/2013, at 4:57 PM, Christian Gredzens <christian... at my.jcu.edu.au> wrote:
>
>
>
>> Hi All,
>
>>
>
>> I would like to run a bootstrap within R on a spatial dataset using a kernel density estimation function. Can anyone help me with this? I am new to R and thus have very little experience. It seems relatively easy to run the actual bootstrap but I am having problems in the following areas:
>
>>
>
>> 1) I don't know how to import spatial data into R and assign it an appropriate projection
>
>> 2) I need to setup a kernel function using a specific bandwidth (likelihood cross-validation (CVh)) and create the script so it will run within the bootstrap script
>
>> 3) I need to export the bootstrap data as an ArcGIS 10 file.
>
>>
>
>> Best Regards,
>
>> Christian Gredzens
>
>>
>
>> Christian Gredzens
>
>> MSc Student
>
>> School of Marine and Tropical Biology
>
>> James Cook University
>
>> Townsville, QLD, Australia 4811
>
>> Christian... at my.jcu.edu.au
>
>> Phone: 04 3875 3652
>
>>
>
>> --
>
>> An R group for questions, tips and tricks relevant to spatial ecology and climate change.
>
>> All R questions welcome.
>
>> ---
>
>> You received this message because you are subscribed to the Google Groups "Tropical R" group.
>
>> To unsubscribe from this group and stop receiving emails from it, send an email to tropical-r+... at googlegroups.com.
>
>> To post to this group, send an email to tropi... at googlegroups.com.
>
>> To view this discussion on the web, visit https://groups.google.com/d/msg/tropical-r/-/DgXQECjrCaoJ.
>
>> For more options, visit https://groups.google.com/groups/opt_out.
>
>>
>
>>
>
>
>
> --
>
> An R group for questions, tips and tricks relevant to spatial ecology and climate change.
>
> All R questions welcome.
>
> ---
>
> You received this message because you are subscribed to the Google Groups "Tropical R" group.
>
> To unsubscribe from this group and stop receiving emails from it, send an email to tropical-r+... at googlegroups.com.
>
> To post to this group, send an email to tropi... at googlegroups.com.
>
> For more options, visit https://groups.google.com/groups/opt_out.
>
>
>
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From andreasft at gmail.com  Tue Mar 11 21:51:44 2014
From: andreasft at gmail.com (=?ISO-8859-1?Q?Andreas_For=F8_Tollefsen?=)
Date: Tue, 11 Mar 2014 21:51:44 +0100
Subject: [R-sig-Geo] Plots for sarlm objects
Message-ID: <CAGMz7DkMDR7=3kKDaE89Xdn9_5BBcQ1gOE0ccg8Wv98WLH=V7Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140311/3536a7db/attachment.pl>

From andreasft at gmail.com  Wed Mar 12 08:41:49 2014
From: andreasft at gmail.com (=?ISO-8859-1?Q?Andreas_For=F8_Tollefsen?=)
Date: Wed, 12 Mar 2014 08:41:49 +0100
Subject: [R-sig-Geo] Subset time for netCDF
In-Reply-To: <CAPB42UxcucoRrAi5pJ4Y0U4EkouAz3b8mMv1VTJav4CkzxGbuA@mail.gmail.com>
References: <CAPB42UyVyfZ5jNbC7r2MmKh+=rxSuDG8MmuMHYibWBg6te0WUg@mail.gmail.com>
	<CAGC_mZTFtMp_3A7f553CNWvvFjiwJz=LRR0urAzLFZJ56mAamQ@mail.gmail.com>
	<CAPB42UxcucoRrAi5pJ4Y0U4EkouAz3b8mMv1VTJav4CkzxGbuA@mail.gmail.com>
Message-ID: <CAGMz7D=z6JQPvfJpBJh7XcMHsBb+TJv1Zuf_bgiG-wg62f+31g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140312/2bf8724d/attachment.pl>

From Roger.Bivand at nhh.no  Wed Mar 12 09:59:16 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Mar 2014 09:59:16 +0100
Subject: [R-sig-Geo] Plots for sarlm objects
In-Reply-To: <CAGMz7DkMDR7=3kKDaE89Xdn9_5BBcQ1gOE0ccg8Wv98WLH=V7Q@mail.gmail.com>
References: <CAGMz7DkMDR7=3kKDaE89Xdn9_5BBcQ1gOE0ccg8Wv98WLH=V7Q@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1403120931330.11859@reclus.nhh.no>

On Tue, 11 Mar 2014, Andreas For? Tollefsen wrote:

> Hi,
>
> I wanted to ask if anyone know of particular diagnostics plot for sarlm
> objects.

Do you mean Haining-style plots (DOI: 10.1111/j.1467-9787.1994.tb00870.x) 
or others?

> In addition, it would be great to be able to plot create effect plots for
> the models fitted. Is this possible?
>

The answer is no, and more no now than before. Until a few years ago, 
lagsarlm() returned a fitted lm object from (y - \rho W y) ~ X, but it no 
longer does so (the fitted object included its fitting environment which 
made objects arbitrarily large on serialisation). You can re-create this 
with:

library(spdep)
data(oldcol)
COL.lag.eig <- lagsarlm(CRIME ~ INC + HOVAL, data=COL.OLD,
  nb2listw(COL.nb, style="W"))
lmobj <- lm(COL.lag.eig$tary ~ COL.lag.eig$tarX - 1)

but variable names, etc, are messed up. If you reconstruct them:

CRIME <- COL.lag.eig$tary
INC <- COL.lag.eig$tarX[,2]
HOVAL <- COL.lag.eig$tarX[,3]
lmobj <- lm(CRIME ~ INC + HOVAL)
library(effects)
plot(effect("INC:HOVAL", lmobj))

works, but the lm() variance-covariance of the coefficients matrix is 
wrong (omitted interaction with \rho). For errorsarlm(), the lm() 
variance-covariance is OK if the model is correctly specified. To do this 
properly would involve writing an Effect method to suit, and finding out 
how to add output components (terms?) to errorsarlm, lagsarlm and sacsarlm 
to permit them to flow through effect. The crucial thing would be to pass 
the correct variance-covariance matrix through, I think.

This is worth doing, contributions welcome!

Roger


> Thanks!
>
> Andreas
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Wed Mar 12 10:30:54 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Mar 2014 10:30:54 +0100
Subject: [R-sig-Geo] overlapping polygons in shapefile
Message-ID: <alpine.LRH.2.03.1403121028490.11859@reclus.nhh.no>

On Wed, 12 Mar 2014, Alice C. Hughes wrote:

Please do not take threads off-list - I am not offering private advice, 
and what is said on the list is intended to be public so that others can 
contribute.

> Hi
> 
> Thanks so much for the informative answer-but I'm not certain if it will 
> yield what I am looking for-basically I have distribution range polygons for 
> multiple species and I want to collapse them down to give the number or 
> species sugested to be in an area-whether that be 1 or 1000 in map form-so 
> basically you have a "heat-map" or species occurences: which tool would yield 
> this? I have all the polygons in one shapefile at present in geographic 
> projection and WGS 84, decimal degrees Thanks so much for your help

The whole point of using R is that users are encouraged to create and modify 
tools from parts (aka functions or methods). Most research problems are coerced 
into fixed subsets of problems that can be tackled with "other people's" tools. 
If researchers are to take responsibility for actually tackling research 
questions with the best alignment of data collection, data representation, 
workflow in data handling, analysis, it is their respopnsibility to ensure that 
the tools are as well aligned with the problem as possible. Otherwise, your 
ability to infer about the actual processes will have been amputated by the 
limitations imposed by using tools not matching your problem.

Change of support is particularly important here, so your ourput map of species 
incidence (don't call it a heatmap, it isn't measuring heat) depends crucially 
on steps in the workflow (for example, what is the error involved in 
delineating the range polygons?).

I was mislead by your phrasing to think that you also needed the areas of each 
species x species overlap (counts are a bit trivial), and you haven't said what 
you mean by area (is it a measure, a polygon, or a raster cell?). What does: 
"number o[f] species sugested to be in an area" mean? Do you mean a raster 
cell? Or the polygonal intersection output for each unique count? Or what?

gOverlaps(..., byid=TRUE) should give counts (it returns a matrix, and the 
rows/columns should be the counts if the polygons are species). However, if you 
have many polygons, do use the STR tree approach only to search for overlaps 
among polygons that actually have intersecting bounding boxes. You can count 
the number of overlaps in this way. If someone can provide random overlapping 
polygons in a SpatialPolygons object, it would be easier to show. All R lists 
do ask for reproducible cases with built-in or simulated data.

Roger

> 
> Alice
> 
> 
> 
> Alice C. HughesAssociate ProfessorCentre for Integrative 
> Conservation,Xishuangbanna Tropical Botanical Garden,Chinese Academy of 
> SciencesMenglun, Mengla, Yunnan 666303, P.R. ChinaPh: 
> 15198676559achughes at xtbg.ac.cn
> 
>> Date: Tue, 11 Mar 2014 20:56:02 +0100
>> From: Roger.Bivand at nhh.no
>> To: dr_achughes at hotmail.co.uk
>> CC: r-sig-geo at stat.math.ethz.ch
>> Subject: Re: [R-sig-Geo] overlapping polygons in shapefile
>> 
>> On Tue, 11 Mar 2014, Alice C. Hughes wrote:
>> 
>>> Hi All
>>> This should be simple-but ArcGis keeps getting stuck at 22%...I have a
>>> large shapefile, which contains multiple overlapping polygons for
>>> various species-and I would like to count for any area how many polygons
>>> overlap.A script would be really fantastic!Thanks in advance
>> 
>> Wouldn't it just? However, as usual, such scripts will only cause grief,
>> as they will not (necessarily) match your workflow. Most likely, you
>> have two choices, one to rasterise thr polygons separately (not
>> together, because they overlap), then count overlapping cells.
>> 
>> If the shapefile is "large", like tens of thousands of polygons, you could
>> try the rgeos package, first using gUnarySTRtreeQuery() or
>> gBinarySTRtreeQuery() to identify possible overlapping candidates (these
>> functions report intersecting bounding boxes of polygons).
>> 
>> Next try gOverlaps() subsetting the input objects by the output of the
>> intersecting bounding boxes. Once you've found the overlaps, take their
>> intersections with gIntersection(), and get the area with gArea(). Note
>> that this only applies to planar, projected polygons. If they are in
>> geographical coordinates, project before using gArea(). Look carefully at
>> the byid= arguments in gOverlaps, gIntersection and gArea. Depending on
>> the complexity of the setting, you may be using for loops and subsetting
>> by indices - there are examples in Ch. 5 of ASDAR (2nd edition) of this
>> kind of subsetting (or see the online code at www.asdar-book.org), about
>> chunks 41-3 in http://www.asdar-book.org/book2ed/cm2_mod.R.
>> 
>> Hope this helps,
>> 
>> Roger
>> 
>>> Alice
>>> 
>>> Alice C. HughesAssociate ProfessorCentre for Integrative
>>> Conservation,Xishuangbanna Tropical Botanical Garden,Chinese Academy of
>>> SciencesMenglun, Mengla, Yunnan 666303, P.R. ChinaPh:
>>> 15198676559achughes at xtbg.ac.cn
>>> 
>>> Date: Mon, 6 May 2013 14:33:29 +1000
>>> Subject: Re: [Trop-R] Kernel Density Estimation Bootstrap
>>> From: lhodgson86 at gmail.com
>>> To: tropical-r at googlegroups.com
>>> 
>>> Hi Christian,
>>> This formatting shows that the data has been read in as a single column 
>>> with 'V1' as the column name and 'x,y' as the value of row 1, and so on:
>>> 
>>>> test<-read.table("test.csv")> test
>>>                V11              x,y
>>> 2   648501,89104003   641686,8917264
>>> 4   645984,89143285   647058,8913794
>>> 6   649659,89129257   649613,8912828
>>> .....
>>> 
>>> You can check how many columns there are in a data frame using 'ncol':
>>> 
>>> ncol(test)
>>> To troubleshoot, I would first try using read.csv:
>>> 
>>> test=read.csv(test,as.is=TRUE)ncol(test)
>>> 
>>> If this does not give you two columns, then I would check that the file 
>>> really is in standard .csv format.
>>> 
>>> Lauren
>>> 
>>> On Mon, May 6, 2013 at 1:17 PM, Christian Gredzens 
>>> <christian.gredzens at my.jcu.edu.au> wrote:
>>> 
>>> Leila,
>>> 
>>> Thanks for your reply. I'm using likelihood cross validation (CVh) instead 
>>> of least squares cross validation (LSCV). To my knowledge adehabitatHR 
>>> doesn't run CVh so I think I will need to write a script or find another 
>>> program which can calculate CVh.
>>> 
>>> 
>>> I used GME from spatialecology.com to calculate all of my KDEs, but I don't 
>>> think GME runs bootstrapping. So I'm trying to run it through the 
>>> bootstrapping package in R. Here is what I need to do:
>>> 
>>> 
>>> 1) Create my spatial points layer
>>> =mydata
>>> 
>>> 2) Run the bootstrapping script:
>>> 
>>>> mydataboot<-boot(mydata, (KDE script), R=1000)
>>> 
>>> mydata= my spatial points file
>>> (KDE script)= what formula to run the bootstrap on
>>> 
>>> R=1000 = the number of iterations I would like to run
>>> 
>>> The issue I'm having is getting the bootstrapping script to run the KDE 
>>> formula=(KDE script)
>>> 
>>> Cheers,
>>> Christian
>>> 
>>> On Friday, May 3, 2013 12:58:55 AM UTC-7, Leila Brook wrote:
>>> Hi Christian,
>>> 
>>> There is a package called adehabitatHR that does kernel density estimation 
>>> with LSCV bandwidth using a function called kernelUD(). I don't know if 
>>> this will is similar to what you want? You will need to have the data in 
>>> UTM and in SpatialPoints or SpatialPointsDataFrame format, which you can do 
>>> using the sp package.
>>> 
>>> 
>>> 
>>> There is a great vignette for adehabitatHR that will help with data 
>>> formatting and running the KDE. I  exported the utilisation distribution 
>>> for ArcGIS using writeRaster() in the raster package, but you can also 
>>> export as contours.
>>> 
>>> 
>>> 
>>> Cheers
>>> 
>>> Leila
>>> 
>>> 
>>> 
>>> ________________________________________
>>> 
>>> From: tropi... at googlegroups.com [tropi... at googlegroups.com] on behalf of 
>>> Stewart Macdonald [stewartm... at gmail.com]
>>> 
>>> Sent: Friday, 3 May 2013 5:12 PM
>>> 
>>> To: tropi... at googlegroups.com
>>> 
>>> Subject: Re: [Trop-R] Kernel Density Estimation Bootstrap
>>> 
>>> 
>>> 
>>> Hi Christian,
>>> 
>>> 
>>> 
>>> What sort of data are you trying to import? A series of lat/longs that are 
>>> in a text (or Excel) file? If so, the rGDAL library can be used to create 
>>> spatial points:
>>> 
>>> 
>>> 
>>> ###############
>>> 
>>> library(rgdal)
>>> 
>>> # if you don't already have this installed, you can do: 
>>> install.packages('rgdal')
>>> 
>>> 
>>> 
>>> # read in the data from a tab-delimited text file that has a header line
>>> 
>>> rawPoints <- read.table('/data.csv', header=TRUE, sep='\t')
>>> 
>>> 
>>> 
>>> # format as a SpatialPoint class and define the projection/datum (WGS84)
>>> 
>>> q <- cbind(rawPoints$recordLon, rawPoints$recordLat)
>>> 
>>> colnames(q) <- c("x", "y")
>>> 
>>> qqq <- SpatialPoints(q, proj4string=CRS("+init=epsg:4326"))
>>> 
>>> ###############
>>> 
>>> 
>>> 
>>> Note: the above is a copied-and-pasted fragment from a working script of 
>>> mine. I assume this fragment will work for you.
>>> 
>>> 
>>> 
>>> I can't help you with your second question, and the answer to your third 
>>> question will depend on the format of the bootstrap data (e.g., more 
>>> points, polygons, raster).
>>> 
>>> 
>>> 
>>> 
>>> 
>>> Hope this helps,
>>> 
>>> 
>>> 
>>> Stewart
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> On 03/05/2013, at 4:57 PM, Christian Gredzens <christian... at my.jcu.edu.au> 
>>> wrote:
>>> 
>>> 
>>> 
>>>> Hi All,
>>> 
>>>> 
>>> 
>>>> I would like to run a bootstrap within R on a spatial dataset using a 
>>>> kernel density estimation function. Can anyone help me with this? I am new 
>>>> to R and thus have very little experience. It seems relatively easy to run 
>>>> the actual bootstrap but I am having problems in the following areas:
>>> 
>>>> 
>>> 
>>>> 1) I don't know how to import spatial data into R and assign it an 
>>>> appropriate projection
>>> 
>>>> 2) I need to setup a kernel function using a specific bandwidth 
>>>> (likelihood cross-validation (CVh)) and create the script so it will run 
>>>> within the bootstrap script
>>> 
>>>> 3) I need to export the bootstrap data as an ArcGIS 10 file.
>>> 
>>>> 
>>> 
>>>> Best Regards,
>>> 
>>>> Christian Gredzens
>>> 
>>>> 
>>> 
>>>> Christian Gredzens
>>> 
>>>> MSc Student
>>> 
>>>> School of Marine and Tropical Biology
>>> 
>>>> James Cook University
>>> 
>>>> Townsville, QLD, Australia 4811
>>> 
>>>> Christian... at my.jcu.edu.au
>>> 
>>>> Phone: 04 3875 3652
>>> 
>>>> 
>>> 
>>>> --
>>> 
>>>> An R group for questions, tips and tricks relevant to spatial ecology and 
>>>> climate change.
>>> 
>>>> All R questions welcome.
>>> 
>>>> ---
>>> 
>>>> You received this message because you are subscribed to the Google Groups 
>>>> "Tropical R" group.
>>> 
>>>> To unsubscribe from this group and stop receiving emails from it, send an 
>>>> email to tropical-r+... at googlegroups.com.
>>> 
>>>> To post to this group, send an email to tropi... at googlegroups.com.
>>> 
>>>> To view this discussion on the web, visit 
>>>> https://groups.google.com/d/msg/tropical-r/-/DgXQECjrCaoJ.
>>> 
>>>> For more options, visit https://groups.google.com/groups/opt_out.
>>> 
>>>> 
>>> 
>>>> 
>>> 
>>> 
>>> 
>>> --
>>> 
>>> An R group for questions, tips and tricks relevant to spatial ecology and 
>>> climate change.
>>> 
>>> All R questions welcome.
>>> 
>>> ---
>>> 
>>> You received this message because you are subscribed to the Google Groups 
>>> "Tropical R" group.
>>> 
>>> To unsubscribe from this group and stop receiving emails from it, send an 
>>> email to tropical-r+... at googlegroups.com.
>>> 
>>> To post to this group, send an email to tropi... at googlegroups.com.
>>> 
>>> For more options, visit https://groups.google.com/groups/opt_out.
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>> 
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> 
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Wed Mar 12 11:00:32 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Mar 2014 11:00:32 +0100
Subject: [R-sig-Geo] overlapping polygons in shapefile
In-Reply-To: <alpine.LRH.2.03.1403121028490.11859@reclus.nhh.no>
References: <alpine.LRH.2.03.1403121028490.11859@reclus.nhh.no>
Message-ID: <alpine.LRH.2.03.1403121041310.11859@reclus.nhh.no>

Initial example below, please scroll down:

On Wed, 12 Mar 2014, Roger Bivand wrote:

> On Wed, 12 Mar 2014, Alice C. Hughes wrote:
>
> Please do not take threads off-list - I am not offering private advice, and 
> what is said on the list is intended to be public so that others can 
> contribute.
>
>> Hi
>> 
>> Thanks so much for the informative answer-but I'm not certain if it will 
>> yield what I am looking for-basically I have distribution range polygons 
>> for multiple species and I want to collapse them down to give the number or 
>> species sugested to be in an area-whether that be 1 or 1000 in map form-so 
>> basically you have a "heat-map" or species occurences: which tool would 
>> yield this? I have all the polygons in one shapefile at present in 
>> geographic projection and WGS 84, decimal degrees Thanks so much for your 
>> help
>
> The whole point of using R is that users are encouraged to create and modify 
> tools from parts (aka functions or methods). Most research problems are 
> coerced into fixed subsets of problems that can be tackled with "other 
> people's" tools. If researchers are to take responsibility for actually 
> tackling research questions with the best alignment of data collection, data 
> representation, workflow in data handling, analysis, it is their 
> respopnsibility to ensure that the tools are as well aligned with the problem 
> as possible. Otherwise, your ability to infer about the actual processes will 
> have been amputated by the limitations imposed by using tools not matching 
> your problem.
>
> Change of support is particularly important here, so your ourput map of 
> species incidence (don't call it a heatmap, it isn't measuring heat) depends 
> crucially on steps in the workflow (for example, what is the error involved 
> in delineating the range polygons?).
>
> I was mislead by your phrasing to think that you also needed the areas of 
> each species x species overlap (counts are a bit trivial), and you haven't 
> said what you mean by area (is it a measure, a polygon, or a raster cell?). 
> What does: "number o[f] species sugested to be in an area" mean? Do you mean 
> a raster cell? Or the polygonal intersection output for each unique count? Or 
> what?
>
> gOverlaps(..., byid=TRUE) should give counts (it returns a matrix, and the 
> rows/columns should be the counts if the polygons are species). However, if 
> you have many polygons, do use the STR tree approach only to search for 
> overlaps among polygons that actually have intersecting bounding boxes. You 
> can count the number of overlaps in this way. If someone can provide random 
> overlapping polygons in a SpatialPolygons object, it would be easier to show. 
> All R lists do ask for reproducible cases with built-in or simulated data.

A first cut at an example:

library(sp)
library(rgeos)
box <- readWKT("POLYGON((0 0, 0 1000, 1000 1000, 1000 0, 0 0))")
plot(box)
set.seed(1)
pts <- spsample(box, n=2000, type="random")
pols <- gBuffer(pts, byid=TRUE, width=50)
plot(pols, add=TRUE)
STR <- gBinarySTRtreeQuery(pols, pols)
length(STR)
summary(sapply(STR, length))
res <- vector(mode="list", length=length(STR))
for(i in seq(along=STR)) res[[i]] <- gOverlaps(pols[i], pols[STR[[i]]],
   byid=TRUE)
summary(sapply(res, sum)-1) # to remove self-counting, i overlaps i

So then we have # overlap counts per input polygon - but what are the 
output reporting units? Should we actually be counting the number of 
polygons that a fine grid of points over box belong to? If we focus on 
this, then maybe:

GT <- GridTopology(c(0.5, 0.5), c(1, 1), c(1000, 1000))
SG <- SpatialGrid(GT)
o <- over(SG, pols, returnList=TRUE)
ct <- sapply(o, length)
summary(ct)
SGDF <- SpatialGridDataFrame(SG, data=data.frame(ct=ct))
spplot(SGDF, "ct", col.regions=bpy.colors(20))

is closer? I haven't checked why the overlaps and the grid over counts 
differ - homework for someone? How does the output resolution affect the 
detected number of hits?

Roger

>
> Roger
>
>> 
>> Alice
>> 
>> 
>> 
>> Alice C. HughesAssociate ProfessorCentre for Integrative 
>> Conservation,Xishuangbanna Tropical Botanical Garden,Chinese Academy of 
>> SciencesMenglun, Mengla, Yunnan 666303, P.R. ChinaPh: 
>> 15198676559achughes at xtbg.ac.cn
>> 
>>> Date: Tue, 11 Mar 2014 20:56:02 +0100
>>> From: Roger.Bivand at nhh.no
>>> To: dr_achughes at hotmail.co.uk
>>> CC: r-sig-geo at stat.math.ethz.ch
>>> Subject: Re: [R-sig-Geo] overlapping polygons in shapefile
>>> 
>>> On Tue, 11 Mar 2014, Alice C. Hughes wrote:
>>> 
>>>> Hi All
>>>> This should be simple-but ArcGis keeps getting stuck at 22%...I have a
>>>> large shapefile, which contains multiple overlapping polygons for
>>>> various species-and I would like to count for any area how many polygons
>>>> overlap.A script would be really fantastic!Thanks in advance
>>> 
>>> Wouldn't it just? However, as usual, such scripts will only cause grief,
>>> as they will not (necessarily) match your workflow. Most likely, you
>>> have two choices, one to rasterise thr polygons separately (not
>>> together, because they overlap), then count overlapping cells.
>>> 
>>> If the shapefile is "large", like tens of thousands of polygons, you could
>>> try the rgeos package, first using gUnarySTRtreeQuery() or
>>> gBinarySTRtreeQuery() to identify possible overlapping candidates (these
>>> functions report intersecting bounding boxes of polygons).
>>> 
>>> Next try gOverlaps() subsetting the input objects by the output of the
>>> intersecting bounding boxes. Once you've found the overlaps, take their
>>> intersections with gIntersection(), and get the area with gArea(). Note
>>> that this only applies to planar, projected polygons. If they are in
>>> geographical coordinates, project before using gArea(). Look carefully at
>>> the byid= arguments in gOverlaps, gIntersection and gArea. Depending on
>>> the complexity of the setting, you may be using for loops and subsetting
>>> by indices - there are examples in Ch. 5 of ASDAR (2nd edition) of this
>>> kind of subsetting (or see the online code at www.asdar-book.org), about
>>> chunks 41-3 in http://www.asdar-book.org/book2ed/cm2_mod.R.
>>> 
>>> Hope this helps,
>>> 
>>> Roger
>>> 
>>>> Alice
>>>> 
>>>> Alice C. HughesAssociate ProfessorCentre for Integrative
>>>> Conservation,Xishuangbanna Tropical Botanical Garden,Chinese Academy of
>>>> SciencesMenglun, Mengla, Yunnan 666303, P.R. ChinaPh:
>>>> 15198676559achughes at xtbg.ac.cn
>>>> 
>>>> Date: Mon, 6 May 2013 14:33:29 +1000
>>>> Subject: Re: [Trop-R] Kernel Density Estimation Bootstrap
>>>> From: lhodgson86 at gmail.com
>>>> To: tropical-r at googlegroups.com
>>>> 
>>>> Hi Christian,
>>>> This formatting shows that the data has been read in as a single column 
>>>> with 'V1' as the column name and 'x,y' as the value of row 1, and so on:
>>>> 
>>>>> test<-read.table("test.csv")> test
>>>>                V11              x,y
>>>> 2   648501,89104003   641686,8917264
>>>> 4   645984,89143285   647058,8913794
>>>> 6   649659,89129257   649613,8912828
>>>> .....
>>>> 
>>>> You can check how many columns there are in a data frame using 'ncol':
>>>> 
>>>> ncol(test)
>>>> To troubleshoot, I would first try using read.csv:
>>>> 
>>>> test=read.csv(test,as.is=TRUE)ncol(test)
>>>> 
>>>> If this does not give you two columns, then I would check that the file 
>>>> really is in standard .csv format.
>>>> 
>>>> Lauren
>>>> 
>>>> On Mon, May 6, 2013 at 1:17 PM, Christian Gredzens 
>>>> <christian.gredzens at my.jcu.edu.au> wrote:
>>>> 
>>>> Leila,
>>>> 
>>>> Thanks for your reply. I'm using likelihood cross validation (CVh) 
>>>> instead of least squares cross validation (LSCV). To my knowledge 
>>>> adehabitatHR doesn't run CVh so I think I will need to write a script or 
>>>> find another program which can calculate CVh.
>>>> 
>>>> 
>>>> I used GME from spatialecology.com to calculate all of my KDEs, but I 
>>>> don't think GME runs bootstrapping. So I'm trying to run it through the 
>>>> bootstrapping package in R. Here is what I need to do:
>>>> 
>>>> 
>>>> 1) Create my spatial points layer
>>>> =mydata
>>>> 
>>>> 2) Run the bootstrapping script:
>>>> 
>>>>> mydataboot<-boot(mydata, (KDE script), R=1000)
>>>> 
>>>> mydata= my spatial points file
>>>> (KDE script)= what formula to run the bootstrap on
>>>> 
>>>> R=1000 = the number of iterations I would like to run
>>>> 
>>>> The issue I'm having is getting the bootstrapping script to run the KDE 
>>>> formula=(KDE script)
>>>> 
>>>> Cheers,
>>>> Christian
>>>> 
>>>> On Friday, May 3, 2013 12:58:55 AM UTC-7, Leila Brook wrote:
>>>> Hi Christian,
>>>> 
>>>> There is a package called adehabitatHR that does kernel density 
>>>> estimation with LSCV bandwidth using a function called kernelUD(). I 
>>>> don't know if this will is similar to what you want? You will need to 
>>>> have the data in UTM and in SpatialPoints or SpatialPointsDataFrame 
>>>> format, which you can do using the sp package.
>>>> 
>>>> 
>>>> 
>>>> There is a great vignette for adehabitatHR that will help with data 
>>>> formatting and running the KDE. I  exported the utilisation distribution 
>>>> for ArcGIS using writeRaster() in the raster package, but you can also 
>>>> export as contours.
>>>> 
>>>> 
>>>> 
>>>> Cheers
>>>> 
>>>> Leila
>>>> 
>>>> 
>>>> 
>>>> ________________________________________
>>>> 
>>>> From: tropi... at googlegroups.com [tropi... at googlegroups.com] on behalf of 
>>>> Stewart Macdonald [stewartm... at gmail.com]
>>>> 
>>>> Sent: Friday, 3 May 2013 5:12 PM
>>>> 
>>>> To: tropi... at googlegroups.com
>>>> 
>>>> Subject: Re: [Trop-R] Kernel Density Estimation Bootstrap
>>>> 
>>>> 
>>>> 
>>>> Hi Christian,
>>>> 
>>>> 
>>>> 
>>>> What sort of data are you trying to import? A series of lat/longs that 
>>>> are in a text (or Excel) file? If so, the rGDAL library can be used to 
>>>> create spatial points:
>>>> 
>>>> 
>>>> 
>>>> ###############
>>>> 
>>>> library(rgdal)
>>>> 
>>>> # if you don't already have this installed, you can do: 
>>>> install.packages('rgdal')
>>>> 
>>>> 
>>>> 
>>>> # read in the data from a tab-delimited text file that has a header line
>>>> 
>>>> rawPoints <- read.table('/data.csv', header=TRUE, sep='\t')
>>>> 
>>>> 
>>>> 
>>>> # format as a SpatialPoint class and define the projection/datum (WGS84)
>>>> 
>>>> q <- cbind(rawPoints$recordLon, rawPoints$recordLat)
>>>> 
>>>> colnames(q) <- c("x", "y")
>>>> 
>>>> qqq <- SpatialPoints(q, proj4string=CRS("+init=epsg:4326"))
>>>> 
>>>> ###############
>>>> 
>>>> 
>>>> 
>>>> Note: the above is a copied-and-pasted fragment from a working script of 
>>>> mine. I assume this fragment will work for you.
>>>> 
>>>> 
>>>> 
>>>> I can't help you with your second question, and the answer to your third 
>>>> question will depend on the format of the bootstrap data (e.g., more 
>>>> points, polygons, raster).
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> Hope this helps,
>>>> 
>>>> 
>>>> 
>>>> Stewart
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> On 03/05/2013, at 4:57 PM, Christian Gredzens 
>>>> <christian... at my.jcu.edu.au> wrote:
>>>> 
>>>> 
>>>> 
>>>>> Hi All,
>>>> 
>>>>> 
>>>> 
>>>>> I would like to run a bootstrap within R on a spatial dataset using a 
>>>>> kernel density estimation function. Can anyone help me with this? I am 
>>>>> new to R and thus have very little experience. It seems relatively easy 
>>>>> to run the actual bootstrap but I am having problems in the following 
>>>>> areas:
>>>> 
>>>>> 
>>>> 
>>>>> 1) I don't know how to import spatial data into R and assign it an 
>>>>> appropriate projection
>>>> 
>>>>> 2) I need to setup a kernel function using a specific bandwidth 
>>>>> (likelihood cross-validation (CVh)) and create the script so it will run 
>>>>> within the bootstrap script
>>>> 
>>>>> 3) I need to export the bootstrap data as an ArcGIS 10 file.
>>>> 
>>>>> 
>>>> 
>>>>> Best Regards,
>>>> 
>>>>> Christian Gredzens
>>>> 
>>>>> 
>>>> 
>>>>> Christian Gredzens
>>>> 
>>>>> MSc Student
>>>> 
>>>>> School of Marine and Tropical Biology
>>>> 
>>>>> James Cook University
>>>> 
>>>>> Townsville, QLD, Australia 4811
>>>> 
>>>>> Christian... at my.jcu.edu.au
>>>> 
>>>>> Phone: 04 3875 3652
>>>> 
>>>>> 
>>>> 
>>>>> --
>>>> 
>>>>> An R group for questions, tips and tricks relevant to spatial ecology 
>>>>> and climate change.
>>>> 
>>>>> All R questions welcome.
>>>> 
>>>>> ---
>>>> 
>>>>> You received this message because you are subscribed to the Google 
>>>>> Groups "Tropical R" group.
>>>> 
>>>>> To unsubscribe from this group and stop receiving emails from it, send 
>>>>> an email to tropical-r+... at googlegroups.com.
>>>> 
>>>>> To post to this group, send an email to tropi... at googlegroups.com.
>>>> 
>>>>> To view this discussion on the web, visit 
>>>>> https://groups.google.com/d/msg/tropical-r/-/DgXQECjrCaoJ.
>>>> 
>>>>> For more options, visit https://groups.google.com/groups/opt_out.
>>>> 
>>>>> 
>>>> 
>>>>> 
>>>> 
>>>> 
>>>> 
>>>> --
>>>> 
>>>> An R group for questions, tips and tricks relevant to spatial ecology and 
>>>> climate change.
>>>> 
>>>> All R questions welcome.
>>>> 
>>>> ---
>>>> 
>>>> You received this message because you are subscribed to the Google Groups 
>>>> "Tropical R" group.
>>>> 
>>>> To unsubscribe from this group and stop receiving emails from it, send an 
>>>> email to tropical-r+... at googlegroups.com.
>>>> 
>>>> To post to this group, send an email to tropi... at googlegroups.com.
>>>> 
>>>> For more options, visit https://groups.google.com/groups/opt_out.
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From andreasft at gmail.com  Wed Mar 12 12:17:43 2014
From: andreasft at gmail.com (=?ISO-8859-1?Q?Andreas_For=F8_Tollefsen?=)
Date: Wed, 12 Mar 2014 12:17:43 +0100
Subject: [R-sig-Geo] Plots for sarlm objects
In-Reply-To: <alpine.LRH.2.03.1403120931330.11859@reclus.nhh.no>
References: <CAGMz7DkMDR7=3kKDaE89Xdn9_5BBcQ1gOE0ccg8Wv98WLH=V7Q@mail.gmail.com>
	<alpine.LRH.2.03.1403120931330.11859@reclus.nhh.no>
Message-ID: <CAGMz7D=p416-n=2r65jT0W3QOOoJHauQTBHQDyiRopmWv-nY5w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140312/d72aaefb/attachment.pl>

From valcu at orn.mpg.de  Wed Mar 12 12:19:48 2014
From: valcu at orn.mpg.de (Mihai Valcu)
Date: Wed, 12 Mar 2014 12:19:48 +0100
Subject: [R-sig-Geo] overlapping polygons in shapefile
In-Reply-To: <alpine.LRH.2.03.1403121041310.11859@reclus.nhh.no>
References: <alpine.LRH.2.03.1403121028490.11859@reclus.nhh.no>
	<alpine.LRH.2.03.1403121041310.11859@reclus.nhh.no>
Message-ID: <532042D4.7050400@orn.mpg.de>


Perhaps, rangeMapper can be of use. It is using spsample(, type = 
"regular") and over()  so it is similar with Roger's example below.

# Species richness of American wrens -----
require(rangeMapper); require(RSQLite); require(rgdal)
dbcon = rangeMap.start(file = "test.sqlite", overwrite = TRUE, dir = 
tempdir() )
f = system.file(package = "rangeMapper", "extdata", "wrens", 
"vector_combined")
r = readOGR(f, "wrens")
global.bbox.save(con = dbcon, bbox = f)
gridSize.save(dbcon, gridSize = 2) ; canvas.save(dbcon)
processRanges(spdf = r, con =  dbcon, ID = "sci_name" )
rangeMap.save(dbcon) # FUN is missing so species richness is computed by 
default. see ?rangeMap.save for other args
m = rangeMap.fetch(dbcon)
plot(m)
####

Mihai

On 3/12/2014 11:00 AM, Roger Bivand wrote:
> Initial example below, please scroll down:
>
> On Wed, 12 Mar 2014, Roger Bivand wrote:
>
>> On Wed, 12 Mar 2014, Alice C. Hughes wrote:
>>
>> Please do not take threads off-list - I am not offering private 
>> advice, and what is said on the list is intended to be public so that 
>> others can contribute.
>>
>>> Hi
>>>
>>> Thanks so much for the informative answer-but I'm not certain if it 
>>> will yield what I am looking for-basically I have distribution range 
>>> polygons for multiple species and I want to collapse them down to 
>>> give the number or species sugested to be in an area-whether that be 
>>> 1 or 1000 in map form-so basically you have a "heat-map" or species 
>>> occurences: which tool would yield this? I have all the polygons in 
>>> one shapefile at present in geographic projection and WGS 84, 
>>> decimal degrees Thanks so much for your help
>>
>> The whole point of using R is that users are encouraged to create and 
>> modify tools from parts (aka functions or methods). Most research 
>> problems are coerced into fixed subsets of problems that can be 
>> tackled with "other people's" tools. If researchers are to take 
>> responsibility for actually tackling research questions with the best 
>> alignment of data collection, data representation, workflow in data 
>> handling, analysis, it is their respopnsibility to ensure that the 
>> tools are as well aligned with the problem as possible. Otherwise, 
>> your ability to infer about the actual processes will have been 
>> amputated by the limitations imposed by using tools not matching your 
>> problem.
>>
>> Change of support is particularly important here, so your ourput map 
>> of species incidence (don't call it a heatmap, it isn't measuring 
>> heat) depends crucially on steps in the workflow (for example, what 
>> is the error involved in delineating the range polygons?).
>>
>> I was mislead by your phrasing to think that you also needed the 
>> areas of each species x species overlap (counts are a bit trivial), 
>> and you haven't said what you mean by area (is it a measure, a 
>> polygon, or a raster cell?). What does: "number o[f] species sugested 
>> to be in an area" mean? Do you mean a raster cell? Or the polygonal 
>> intersection output for each unique count? Or what?
>>
>> gOverlaps(..., byid=TRUE) should give counts (it returns a matrix, 
>> and the rows/columns should be the counts if the polygons are 
>> species). However, if you have many polygons, do use the STR tree 
>> approach only to search for overlaps among polygons that actually 
>> have intersecting bounding boxes. You can count the number of 
>> overlaps in this way. If someone can provide random overlapping 
>> polygons in a SpatialPolygons object, it would be easier to show. All 
>> R lists do ask for reproducible cases with built-in or simulated data.
>
> A first cut at an example:
>
> library(sp)
> library(rgeos)
> box <- readWKT("POLYGON((0 0, 0 1000, 1000 1000, 1000 0, 0 0))")
> plot(box)
> set.seed(1)
> pts <- spsample(box, n=2000, type="random")
> pols <- gBuffer(pts, byid=TRUE, width=50)
> plot(pols, add=TRUE)
> STR <- gBinarySTRtreeQuery(pols, pols)
> length(STR)
> summary(sapply(STR, length))
> res <- vector(mode="list", length=length(STR))
> for(i in seq(along=STR)) res[[i]] <- gOverlaps(pols[i], pols[STR[[i]]],
>   byid=TRUE)
> summary(sapply(res, sum)-1) # to remove self-counting, i overlaps i
>
> So then we have # overlap counts per input polygon - but what are the 
> output reporting units? Should we actually be counting the number of 
> polygons that a fine grid of points over box belong to? If we focus on 
> this, then maybe:
>
> GT <- GridTopology(c(0.5, 0.5), c(1, 1), c(1000, 1000))
> SG <- SpatialGrid(GT)
> o <- over(SG, pols, returnList=TRUE)
> ct <- sapply(o, length)
> summary(ct)
> SGDF <- SpatialGridDataFrame(SG, data=data.frame(ct=ct))
> spplot(SGDF, "ct", col.regions=bpy.colors(20))
>
> is closer? I haven't checked why the overlaps and the grid over counts 
> differ - homework for someone? How does the output resolution affect 
> the detected number of hits?
>
> Roger

-- 
+-----------------------------------------------+
   Mihai Valcu, PhD
   Max Planck Institute for Ornithology
   Behavioural Ecology and Evolutionary Genetics
   Eberhard-Gwinner Street 7
   D-82319 Seewiesen
	o Phone:  +49-(0)8157-932-343
	o Fax:    +49-(0)8157-932-400
	o Mobile: +49-(0)1522-363-0828
	o http://www.orn.mpg.de/valcu
+-----------------------------------------------+


From marceivissa at gmail.com  Wed Mar 12 14:28:37 2014
From: marceivissa at gmail.com (=?ISO-8859-1?Q?Marc_Mar=ED_Dell=27Olmo?=)
Date: Wed, 12 Mar 2014 14:28:37 +0100
Subject: [R-sig-Geo] Quantile map with plotGoogleMaps (legend problem)
In-Reply-To: <CAAZSCQ4eRwid8gD=jpqMOoAuJ8xVMZi-i7X8OpzhsGuf+N_iQg@mail.gmail.com>
References: <CAAZSCQ7_EwKnEZa27B5WaHdve91yW8LZC0jFx9jZWvHkaqbEhw@mail.gmail.com>
	<CAPSaU--7Dnhd5i5BFJWZAC+9WDgYFkTHcS3JoqbjfUGBjBeqew@mail.gmail.com>
	<CAAZSCQ4eRwid8gD=jpqMOoAuJ8xVMZi-i7X8OpzhsGuf+N_iQg@mail.gmail.com>
Message-ID: <CAAZSCQ6TQ9kcUdmG6Dy1V5qjP=0FjjY2pHUqa4cid_zn0wjg4w@mail.gmail.com>

Dear Milan,

I have solved the problem. I think that the problem occurs when the
png file is being saved.

I installed R in another computer and executing my syntax I obtained this error:

> library(RColorBrewer)
> library(rgdal)
>
> carto<-readShapeSpatial("C:/Users/mmari/Documents/ESTUDIS/Atles Interactiu/duda/carto.shp")
> proj4string(carto) <- CRS("+proj=longlat +datum=WGS84 +no_defs")
> plotGoogleMaps(carto, zcol="RMEs", filename="C:/Users/mmari/Documents/ESTUDIS/Atles Interactiu/duda/map.html",mapTypeId='ROADMAP', colPalette= brewer.pal(7,"Reds"),strokeColor="white", openMap=T)
Error en png(filename = paste(legendName, ".png", sep = ""), height = h,  :
  unable to start png() device
Adem?s: Mensajes de aviso perdidos
1: In png(filename = paste(legendName, ".png", sep = ""), height = h,  :
  unable to open file 'Legend17c025a8181c.png' for writing
2: In png(filename = paste(legendName, ".png", sep = ""), height = h,  :
  opening device failed

I have solved the problem by simply adding a working directory and not
including any path into the syntax. i.e.

library(plotGoogleMaps)
library(RColorBrewer)
library(rgdal)

setwd("C:/Users/mmari/Documents/ESTUDIS/Atles Interactiu/duda")

carto<-readShapeSpatial("carto.shp")
proj4string(carto) <- CRS("+proj=longlat +datum=WGS84 +no_defs")
plotGoogleMaps(carto, zcol="RMEs",
filename="map.html",mapTypeId='ROADMAP', colPalette=
brewer.pal(7,"Reds"),strokeColor="white", openMap=T)

Thus, the png file has been saved in the working directory with the htm file.

Thank you and congratulations on the great library that you've performed!!



2014-03-07 14:59 GMT+01:00 Marc Mar? Dell'Olmo <marceivissa at gmail.com>:
> Dear Milan,
>
> yes, with your reproducible example I can see the legend. But, with my
> data I can't see it...
>
> It is very strange. I will try it at home, because I'm using the job
> computer and maybe not having administrator rights could be a
> problem... I don't know...
>
> Thank you!
>
>
> 2014-03-07 14:46 GMT+01:00 Milan Kilibarda <milan.kili11 at gmail.com>:
>> Hi Mark,
>>
>> I reproduce your example without any problem, and it works in Chrome,
>> Mozilla and IE.
>>
>> Here is your example:
>>
>> https://dl.dropboxusercontent.com/u/20743714/duda.zip
>>
>> Here is reproducible example:
>>
>> library(plotGoogleMaps)
>> nc <- readShapeSpatial(
>> system.file("shapes/sids.shp",package="maptools")[1],
>>                                     proj4string=CRS("+proj=longlat
>> +datum=NAD27"))
>> library(RColorBrewer)
>>
>> m<-plotGoogleMaps(nc,zcol="NWBIR74",filename='MyMap6.htm',
>> mapTypeId='TERRAIN',colPalette= brewer.pal(7,"Reds"),
>> strokeColor="white")
>>
>> Check your version of R and packages.
>>
>> sessionInfo()
>> R version 3.0.2 (2013-09-25)
>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>
>> locale:
>> [1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United
>> Kingdom.1252
>> [3] LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C
>> [5] LC_TIME=English_United Kingdom.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] RColorBrewer_1.0-5 plotGoogleMaps_2.0 lattice_0.20-24    maptools_0.8-29
>> rgdal_0.8-16
>> [6] sp_1.0-14
>>
>> loaded via a namespace (and not attached):
>> [1] foreign_0.8-59 grid_3.0.2     tools_3.0.2
>>
>> Best,
>>
>> Milan
>>
>>
>>
>>
>> On Fri, Mar 7, 2014 at 2:24 PM, Marc Mar? Dell'Olmo <marceivissa at gmail.com>
>> wrote:
>>>
>>> Dear all,
>>>
>>> I'm trying to do a quantile map (specifically septile map) with
>>> plotGoogleMaps. I obtain the map, but this map don't display the
>>> legend with the septiles intervals. Moreover, I can display the map
>>> with firefox, but I have problems with explorer...
>>>
>>> This is the sintax that I have used:
>>> carto<-readShapeSpatial("C:/duda/carto.shp")
>>> proj4string(carto) <- CRS("+proj=longlat +datum=WGS84 +no_defs")
>>> plotGoogleMaps(carto, zcol="RMEs", filename="C:/duda/map.html",
>>> mapTypeId='ROADMAP', colPalette= brewer.pal(7,"Reds"),
>>> strokeColor="white", openMap=T)
>>>
>>>
>>> With the following link you can download the data to execute this
>>> syntax and the file "map.html" with the map:
>>>
>>> https://dl.dropboxusercontent.com/u/14934021/duda.zip
>>>
>>>
>>> Thank you very much!
>>>
>>>
>>> Marc
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>>
>> --
>> Dr. Milan Kilibarda
>>
>> University of Belgrade,
>> Faculty of Civil Engineering,
>> Department of Geodesy and Geoinformatics,
>> Address: Bulevar kralja Aleksandra 73  11000 Belgrade, Serbia,
>> Mail:  kili at grf.bg.ac.rs
>>
>> tel:+381 11 3218516


From hosseini at ecohealthalliance.org  Wed Mar 12 18:03:36 2014
From: hosseini at ecohealthalliance.org (Parviez Hosseini)
Date: Wed, 12 Mar 2014 10:03:36 -0700 (PDT)
Subject: [R-sig-Geo] using spplot to superimpose points and polygons on
 SpatialGridDataFrame
In-Reply-To: <Pine.LNX.4.64.0709240729570.19983@reclus.nhh.no>
References: <1722.71.102.146.37.1190590411.squirrel@webmail.nceas.ucsb.edu>
	<Pine.LNX.4.64.0709240729570.19983@reclus.nhh.no>
Message-ID: <1394643816258-7585938.post@n2.nabble.com>

I realize this is an old post, but this thread is still one of the top google
finds when trying to research the issue. 

I was able to reproduce the problem simply by replacing:

gridded(meuse.grid) <- TRUE ## original line

with 

gridded(meuse.grid) <- FALSE ## original line

Thus:
library(sp)
data(meuse)
data(meuse.grid)
coordinates(meuse) <- c("x", "y")
coordinates(meuse.grid) <- c("x", "y")
gridded(meuse.grid) <- FLASE  ## TRUE successfully overlays points.
pts <- list("sp.points", meuse, pch = 4, col = "black", cex=0.5)
greys <- grey(0:256 / 256)
spplot(meuse.grid, "dist", col.regions=greys, sp.layout=list(pts),
   cuts=length(greys)-1, colorkey=TRUE) 

runs quietly, but there no points produced by sp.layout=list(pts), they are
under the meuse.grid points






--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/using-spplot-to-superimpose-points-and-polygons-on-SpatialGridDataFrame-tp2763881p7585938.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From macqueen1 at llnl.gov  Wed Mar 12 18:28:31 2014
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Wed, 12 Mar 2014 17:28:31 +0000
Subject: [R-sig-Geo] build polygons from ellipses,
 then sample points within the polygons
In-Reply-To: <1394479150872-7585922.post@n2.nabble.com>
References: <1394479150872-7585922.post@n2.nabble.com>
Message-ID: <CF45E696.EF1CF%macqueen1@llnl.gov>

If you have the x,y coordinates of an ellipse, you can create a
SpatialPolygons or SpatialPolygonsDataFrame following the example in ?over
(package sp). 

For sampling, see ?spsample

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 3/10/14 12:19 PM, "Anthony Fischbach" <afischbach at usgs.gov> wrote:

>I have estimated location error ellipses generated from a continuous-time
>version of the correlated random walk model for animal telemetry data
>(see http://cran.r-project.org/web/packages/crawl/index.html, functions:
>crwMLE and crwPredict).
>>From these error ellipses, I wish to randomly select points.
>Toward this end, I have two questions.
>
>Question 1: Is there a handy function that readily allows creation of
>polygons from ellipses?
>## toy example
>ellipses<-data.frame(x=c(251753, 252966, 254179),
>						y=c(343394, 343315, 343237),
>						majorAxis=c(0.0, 2753.5, 2114.8),
>						minorAxis=c(0.0,  2754.1, 2118.0),
>						angle=c(0,0,0)) ## dataFrame with Ellipse information
>						## in this case the majorAxis is assumed to lie along the x axis
>                                                ## x, y define the
>centroid
>of the ellipse.
>coordinates(ellipses) <- x~y  ## cast to a spatialPointsDataFrame
>ellipses.poly <-
>Wonder.function.that.Makes.spatialPolygons.from.ellipses(ellipses)
>
>Question 2:  I know that there is a handy means to randomly generate
>locations from within a SpatialPolygon.  Please help me find it.
>
>
>
>-----
>Tony Fischbach, Wildlife Biologist
>Walrus Research Program
>Alaska Science Center
>U.S. Geological Survey
>4210 University Drive
>Anchorage, AK 99508-4650
>
>AFischbach at usgs.gov
>http://alaska.usgs.gov/science/biology/walrus
>--
>View this message in context:
>http://r-sig-geo.2731867.n2.nabble.com/build-polygons-from-ellipses-then-s
>ample-points-within-the-polygons-tp7585922.html
>Sent from the R-sig-geo mailing list archive at Nabble.com.
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From afischbach at usgs.gov  Wed Mar 12 18:55:20 2014
From: afischbach at usgs.gov (Anthony Fischbach)
Date: Wed, 12 Mar 2014 10:55:20 -0700 (PDT)
Subject: [R-sig-Geo] build polygons from ellipses,
 then sample points within the polygons
In-Reply-To: <CF45E696.EF1CF%macqueen1@llnl.gov>
References: <1394479150872-7585922.post@n2.nabble.com>
	<CF45E696.EF1CF%macqueen1@llnl.gov>
Message-ID: <1394646920737-7585940.post@n2.nabble.com>

What I am looking for is a means to generate spatialPolygons from the ellipse
specifications (x,y or central coordinate, axis-a and axis-b length, along
with implied orientation of the two axes, which in my case are N-S, E-W). 
Is there a handy function enabling this?



-----
Tony Fischbach, Wildlife Biologist
Walrus Research Program
Alaska Science Center
U.S. Geological Survey
4210 University Drive
Anchorage, AK 99508-4650

AFischbach at usgs.gov
http://alaska.usgs.gov/science/biology/walrus
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/build-polygons-from-ellipses-then-sample-points-within-the-polygons-tp7585922p7585940.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.turner at auckland.ac.nz  Wed Mar 12 21:58:24 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Thu, 13 Mar 2014 09:58:24 +1300
Subject: [R-sig-Geo] build polygons from ellipses,
 then sample points within the polygons
In-Reply-To: <1394646920737-7585940.post@n2.nabble.com>
References: <1394479150872-7585922.post@n2.nabble.com>
	<CF45E696.EF1CF%macqueen1@llnl.gov>
	<1394646920737-7585940.post@n2.nabble.com>
Message-ID: <5320CA70.1000809@auckland.ac.nz>

On 13/03/14 06:55, Anthony Fischbach wrote:
> What I am looking for is a means to generate spatialPolygons from the ellipse
> specifications (x,y or central coordinate, axis-a and axis-b length, along
> with implied orientation of the two axes, which in my case are N-S, E-W).
> Is there a handy function enabling this?

Easy enough to write one:

ellipse <- function (x0, y0, a, b, phi, npts = 200, plotit = FALSE,
                      add = FALSE, phil = FALSE, ...) {

# Build "horizontal" ellipse centred at 0:
     theta <- seq(0, 2 * pi, length = npts)
     xh <-  a * cos(theta)
     yh <-  b * sin(theta)

# Rotate through angle phi and shift centre:
     co <- cos(phi)
     si <- sin(phi)
     x  <- x0 + co*xh - si*yh
     y  <- x0 + si*xh + co*yh

# Plot the result if required:
     if (plotit) {
         if (add) {
             if (phil)
                 polygon(x, y, ...)
             else lines(x, y, ...)
         }
         else {
             if (phil) {
                 plot(x, y, type = "n", ...)
                 polygon(x, y, ...)
             }
             else plot(x, y, type = "l", ...)
         }
         return(invisible(list(x = x, y = y)))
     }
     list(x = x, y = y)
}

This creates an ellipse in the form of a *list*.  If you a 
SpatialPolgons object you will have to convert it.  E.g.:

A <- ellipse(3,7,5,2,pi/4)
B <- with(A,Polygon(cbind(x,y)))
C <- Polygons(list(B),1)
D <- SpatialPolygons(list(C))
plot(D)

The foregoing conversion is a result of trial-and-error mucking around 
on my part.  It can probably be done in a much sexier manner.  I don't 
really know what I'm doing with these incomprehensible S4 classes and 
methods.  Others may advise you as to how to do it properly.

Or you could use the spatstat package:

EW <- owin(poly=A)
X  <- runifpoint(50,win=EW) # 50 points distributed uniformly
                             # random on the interior of the ellipse.
plot(X)

cheers,

Rolf Turner


From edzer.pebesma at uni-muenster.de  Wed Mar 12 23:19:34 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 12 Mar 2014 23:19:34 +0100
Subject: [R-sig-Geo] using spplot to superimpose points and polygons on
 SpatialGridDataFrame
In-Reply-To: <1394643816258-7585938.post@n2.nabble.com>
References: <1722.71.102.146.37.1190590411.squirrel@webmail.nceas.ucsb.edu>	<Pine.LNX.4.64.0709240729570.19983@reclus.nhh.no>
	<1394643816258-7585938.post@n2.nabble.com>
Message-ID: <5320DD76.6000209@uni-muenster.de>



On 03/12/2014 06:03 PM, Parviez Hosseini wrote:
> I realize this is an old post, but this thread is still one of the top google
> finds when trying to research the issue. 
> 
> I was able to reproduce the problem simply by replacing:
> 
> gridded(meuse.grid) <- TRUE ## original line
> 
> with 
> 
> gridded(meuse.grid) <- FALSE ## original line
> 
> Thus:
> library(sp)
> data(meuse)
> data(meuse.grid)
> coordinates(meuse) <- c("x", "y")
> coordinates(meuse.grid) <- c("x", "y")
> gridded(meuse.grid) <- FLASE  ## TRUE successfully overlays points.
> pts <- list("sp.points", meuse, pch = 4, col = "black", cex=0.5)
> greys <- grey(0:256 / 256)
> spplot(meuse.grid, "dist", col.regions=greys, sp.layout=list(pts),
>    cuts=length(greys)-1, colorkey=TRUE) 
> 
> runs quietly, but there no points produced by sp.layout=list(pts), they are
> under the meuse.grid points

There are points produced by sp.layout=list(pts), but they are indeed
hidden by the big filled circles -- try:

spplot(meuse.grid["dist"], col.regions=greys, sp.layout=pts,
cuts=length(greys)-1, colorkey=TRUE, cex=.1)

according to the documentation, with

pts <- list("sp.points", meuse, pch = 16, col = "green", cex=2,first=FALSE)

it should plot on top, but doesn't.

The original thread, which you didn't quote, was from 2007. Is this a
problem for you?

> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/using-spplot-to-superimpose-points-and-polygons-on-SpatialGridDataFrame-tp2763881p7585938.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140312/0894946b/attachment.bin>

From Yan.Boulanger at RNCan-NRCan.gc.ca  Thu Mar 13 01:51:59 2014
From: Yan.Boulanger at RNCan-NRCan.gc.ca (Boulanger, Yan)
Date: Thu, 13 Mar 2014 00:51:59 +0000
Subject: [R-sig-Geo] loops in rasterEngine
Message-ID: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140313/67bf875b/attachment.pl>

From Yan.Boulanger at RNCan-NRCan.gc.ca  Thu Mar 13 02:55:49 2014
From: Yan.Boulanger at RNCan-NRCan.gc.ca (Boulanger, Yan)
Date: Thu, 13 Mar 2014 01:55:49 +0000
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
Message-ID: <D3557409FD94BA41AE028A1E573716D6470300B0@S-BSC-MBX2.nrn.nrcan.gc.ca>

Sorry, now it's much easier to see the code.
yan

Yan Boulanger, Chercheur scientifique / Research scientist 
Ressources Naturelles Canada, Canadian Forest Service 
Centre de Foresterie des Laurentides 
1055, rue du P.E.P.S.
C.P. 10380, succ. Sainte-Foy
Qu?bec (Qu?bec) Canada
G1V 4C7 
Tel. : +1 418 649-6859 


-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Boulanger, Yan
Sent: 12 mars 2014 20:52
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] loops in rasterEngine

Hi folks,

I guess I have a lot to learn to write functions but I'm stuck when using rasterEngine. It seems that it should be very easy to do but I'm missing something, apparently... I have a raster, Safranyik_zones_1961_1990, with values (integer) from 1 to 5. I would like to create five rasters for which value will be 1 when the raster Safranyik_zones_1961_1990 is equal to "i", and NA otherwise. I would like to run everything in a loop . Here's what I thought would be ok.

fun_zone <- function(Safranyik_zones,i,...) { 

Safranyik_zonesb <- Safranyik_zones Safranyik_zonesb[] <- NA 

Safranyik_zonesb[Safranyik_zones == i] <- 1

return(Safranyik_zonesb)

}

for (i in 1:5){

Safranyik_zones_1961_1990b <- rasterEngine(Safranyik_zones=Safranyik_zones_1961_1990,i=i, fun=fun_zone) 

assign(paste("Safranyik_zones_1961_1990b_",i, sep=""),Safranyik_zones_1961_1990b[[1]])

}

Of course, it says that ? i ? is missing...:

>Erreur dans Safranyik_zones == i : 'i' est manquant

Any help?

Thanks in advance,

Yan


Yan Boulanger, Chercheur scientifique / Research scientist Ressources Naturelles Canada, Canadian Forest Service Centre de Foresterie des Laurentides 1055, rue du P.E.P.S.
C.P. 10380, succ. Sainte-Foy
Qu?bec (Qu?bec) Canada
G1V 4C7
Tel. : +1 418 649-6859




	[[alternative HTML version deleted]]


From forrest at ufl.edu  Thu Mar 13 03:25:01 2014
From: forrest at ufl.edu (Forrest Stevens)
Date: Wed, 12 Mar 2014 22:25:01 -0400
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
Message-ID: <CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140312/7ab60fcd/attachment.pl>

From Yan.Boulanger at RNCan-NRCan.gc.ca  Thu Mar 13 04:29:00 2014
From: Yan.Boulanger at RNCan-NRCan.gc.ca (Boulanger, Yan)
Date: Thu, 13 Mar 2014 03:29:00 +0000
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>
Message-ID: <D3557409FD94BA41AE028A1E573716D6470300E7@S-BSC-MBX2.nrn.nrcan.gc.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140313/60a6ea82/attachment.pl>

From azvoleff at conservation.org  Thu Mar 13 15:06:15 2014
From: azvoleff at conservation.org (Alex Zvoleff)
Date: Thu, 13 Mar 2014 10:06:15 -0400
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <D3557409FD94BA41AE028A1E573716D6470300E7@S-BSC-MBX2.nrn.nrcan.gc.ca>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>
	<D3557409FD94BA41AE028A1E573716D6470300E7@S-BSC-MBX2.nrn.nrcan.gc.ca>
Message-ID: <CACwzsXG4Qp0=OggAoOO0X99xnZNTbQybP_qsTkQsOy2+eGUa2Q@mail.gmail.com>

On Wed, Mar 12, 2014 at 11:29 PM, Boulanger, Yan
<Yan.Boulanger at rncan-nrcan.gc.ca> wrote:
> Actually, I have several rasters of more than 440 000 000 pixels (MODIS covering all Canada) and I have a 32-cores machine so I would like to take advantage of it! ;-)
>
> Time is money (really?!!)

As mentioned earlier, I would be careful about using rasterEngine for
this kind of task. It may actually slow you down. I would recommend
testing on smaller subsets to determine your gains (or losses) from
doing this type of calculation in parallel versus sequentially. While
I have seen great speed increases for CPU intensive calculations from
using rasterEngine, it sounds like your processing is heavily IO
intensive. I am not sure 32 cores will help you unless you have a very
fast disk or RAID array.

Alex

>
> Thanks again!
> yan
>
> Yan Boulanger, Chercheur scientifique / Research scientist
> Ressources Naturelles Canada, Canadian Forest Service
> Centre de Foresterie des Laurentides
> 1055, rue du P.E.P.S.
> C.P. 10380, succ. Sainte-Foy
> Qu?bec (Qu?bec) Canada
> G1V 4C7
> Tel. : +1 418 649-6859
>
> From: Forrest Stevens [mailto:forrest at ufl.edu]
> Sent: 12 mars 2014 22:25
> To: Boulanger, Yan
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] loops in rasterEngine
>
> Hi Yan, I guess I would be surprised for such a simple process if rasterEngine() would be worth the overhead? Though, admittedly, Jonathan Greenberg might have more information on the topic.  To do such an operation this is the approach I would take without using rasterEngine():
>
>
> for (i in 1:5) {
>   assign(paste("Safranyik_zones_1961_1990b_",i, sep=""), Safranyik_zones_1961_1990b == i)
> }
>
>
> To do it using rasterEngine() this is the function definition that I would use. This of course requires that you've already created a cluster using one of the various supported parallel backends otherwise you'll gain nothing from the parallel processing.
>
>
> require("spatial.tools")
>
> ## Begin a parallel cluster and register it with foreach:
> ## The number of nodes/cores to use in the cluster
> cpus = 2
> cl <- makeCluster(spec = cpus, type = "PSOCK", methods = FALSE)
> ## Register the cluster with foreach:
> registerDoParallel(cl)
>
> ##       Or use the following, quick and dirty way:
> #sfQuickInit(cpus=2)
>
> fun_zone <- function( zones, i, ...) {
>   return(zones == i)
> }
>
> for (j in 1:5){
>   assign(paste("Safranyik_zones_1961_1990b_",j, sep=""), rasterEngine( zones=Safranyik_zones_1961_1990b, args=list("i"=j), fun=fun_zone) )
> }
>
> stopCluster(cl)
> #sfQuickStop()
>
>
> Hope this helps,
> Forrest
>
> --
> Forrest R. Stevens
> Ph.D. Candidate, QSE3 IGERT Fellow
> Department of Geography
> Land Use and Environmental Change Institute
> University of Florida
> www.clas.ufl.edu/users/forrest<http://www.clas.ufl.edu/users/forrest>
>
> On Wed, Mar 12, 2014 at 8:51 PM, Boulanger, Yan <Yan.Boulanger at rncan-nrcan.gc.ca<mailto:Yan.Boulanger at rncan-nrcan.gc.ca>> wrote:
> Hi folks,
>
> I guess I have a lot to learn to write functions but I'm stuck when using rasterEngine. It seems that it should be very easy to do but I'm missing something, apparently... I have a raster, Safranyik_zones_1961_1990, with values (integer) from 1 to 5. I would like to create five rasters for which value will be 1 when the raster Safranyik_zones_1961_1990 is equal to "i", and NA otherwise. I would like to run everything in a loop . Here's what I thought would be ok.
>
> fun_zone <- function(Safranyik_zones,i,...) {
> Safranyik_zonesb <- Safranyik_zones
> Safranyik_zonesb[] <- NA
> Safranyik_zonesb[Safranyik_zones == i] <- 1
> return(Safranyik_zonesb)
> }
>
> for (i in 1:5){
> Safranyik_zones_1961_1990b <- rasterEngine(Safranyik_zones=Safranyik_zones_1961_1990,i=i, fun=fun_zone)
> assign(paste("Safranyik_zones_1961_1990b_",i, sep=""),Safranyik_zones_1961_1990b[[1]])
> }
>
> Of course, it says that ? i ? is missing...:
>
>>Erreur dans Safranyik_zones == i : 'i' est manquant
>
> Any help?
>
> Thanks in advance,
>
> Yan
>
>
> Yan Boulanger, Chercheur scientifique / Research scientist
> Ressources Naturelles Canada, Canadian Forest Service
> Centre de Foresterie des Laurentides
> 1055, rue du P.E.P.S.
> C.P. 10380, succ. Sainte-Foy
> Qu?bec (Qu?bec) Canada
> G1V 4C7
> Tel. : +1 418 649-6859
>
>
>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Alex Zvoleff
Postdoctoral Associate
Tropical Ecology Assessment and Monitoring (TEAM) Network
Conservation International
2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
http://www.teamnetwork.org | http://www.conservation.org


From jgrn at illinois.edu  Thu Mar 13 17:17:39 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Thu, 13 Mar 2014 11:17:39 -0500
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <CACwzsXG4Qp0=OggAoOO0X99xnZNTbQybP_qsTkQsOy2+eGUa2Q@mail.gmail.com>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>
	<D3557409FD94BA41AE028A1E573716D6470300E7@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CACwzsXG4Qp0=OggAoOO0X99xnZNTbQybP_qsTkQsOy2+eGUa2Q@mail.gmail.com>
Message-ID: <CABG0rfv_E-_OSEGEO__2OTRMJOV2HNv3WG-JcHEALun=g+dkbA@mail.gmail.com>

Yan:

Looks like you are getting great help with this -- I want to echo
Alex's note that rasterEngine is not a catchall -- for REALLY simple
processes you'll get better performance using calc() or using LESS
workers (which may seem counter intuitive).  I'm submitting a paper
this week that showed that a function that just multiplies a raster by
10 ran faster than calc() only when using 4 workers
(sfQuickInit(cpus=4)) (vs. calc's 1), but was slower than calc if you
have less or more workers.  As a rule, rasterEngine, at present, is
slower than calc when operation in sequential mode.

Now, as an important note, if you grab the latest spatial.tools from
r-forge, I have added a feature that will return multiple rasters at
once, which seems like what you want to do.  You'll want to return a
list-of-arrays (each component will be written to its own raster) and
make sure you specify the output filenames (the components will be
matched against the output filenames).  This may result in a
significant speedup because you are only reading each raster once, and
returning all the outputs (vs. the example above reads/writes the
rasters for every i).

--j

On Thu, Mar 13, 2014 at 9:06 AM, Alex Zvoleff <azvoleff at conservation.org> wrote:
> On Wed, Mar 12, 2014 at 11:29 PM, Boulanger, Yan
> <Yan.Boulanger at rncan-nrcan.gc.ca> wrote:
>> Actually, I have several rasters of more than 440 000 000 pixels (MODIS covering all Canada) and I have a 32-cores machine so I would like to take advantage of it! ;-)
>>
>> Time is money (really?!!)
>
> As mentioned earlier, I would be careful about using rasterEngine for
> this kind of task. It may actually slow you down. I would recommend
> testing on smaller subsets to determine your gains (or losses) from
> doing this type of calculation in parallel versus sequentially. While
> I have seen great speed increases for CPU intensive calculations from
> using rasterEngine, it sounds like your processing is heavily IO
> intensive. I am not sure 32 cores will help you unless you have a very
> fast disk or RAID array.
>
> Alex
>
>>
>> Thanks again!
>> yan
>>
>> Yan Boulanger, Chercheur scientifique / Research scientist
>> Ressources Naturelles Canada, Canadian Forest Service
>> Centre de Foresterie des Laurentides
>> 1055, rue du P.E.P.S.
>> C.P. 10380, succ. Sainte-Foy
>> Qu?bec (Qu?bec) Canada
>> G1V 4C7
>> Tel. : +1 418 649-6859
>>
>> From: Forrest Stevens [mailto:forrest at ufl.edu]
>> Sent: 12 mars 2014 22:25
>> To: Boulanger, Yan
>> Cc: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] loops in rasterEngine
>>
>> Hi Yan, I guess I would be surprised for such a simple process if rasterEngine() would be worth the overhead? Though, admittedly, Jonathan Greenberg might have more information on the topic.  To do such an operation this is the approach I would take without using rasterEngine():
>>
>>
>> for (i in 1:5) {
>>   assign(paste("Safranyik_zones_1961_1990b_",i, sep=""), Safranyik_zones_1961_1990b == i)
>> }
>>
>>
>> To do it using rasterEngine() this is the function definition that I would use. This of course requires that you've already created a cluster using one of the various supported parallel backends otherwise you'll gain nothing from the parallel processing.
>>
>>
>> require("spatial.tools")
>>
>> ## Begin a parallel cluster and register it with foreach:
>> ## The number of nodes/cores to use in the cluster
>> cpus = 2
>> cl <- makeCluster(spec = cpus, type = "PSOCK", methods = FALSE)
>> ## Register the cluster with foreach:
>> registerDoParallel(cl)
>>
>> ##       Or use the following, quick and dirty way:
>> #sfQuickInit(cpus=2)
>>
>> fun_zone <- function( zones, i, ...) {
>>   return(zones == i)
>> }
>>
>> for (j in 1:5){
>>   assign(paste("Safranyik_zones_1961_1990b_",j, sep=""), rasterEngine( zones=Safranyik_zones_1961_1990b, args=list("i"=j), fun=fun_zone) )
>> }
>>
>> stopCluster(cl)
>> #sfQuickStop()
>>
>>
>> Hope this helps,
>> Forrest
>>
>> --
>> Forrest R. Stevens
>> Ph.D. Candidate, QSE3 IGERT Fellow
>> Department of Geography
>> Land Use and Environmental Change Institute
>> University of Florida
>> www.clas.ufl.edu/users/forrest<http://www.clas.ufl.edu/users/forrest>
>>
>> On Wed, Mar 12, 2014 at 8:51 PM, Boulanger, Yan <Yan.Boulanger at rncan-nrcan.gc.ca<mailto:Yan.Boulanger at rncan-nrcan.gc.ca>> wrote:
>> Hi folks,
>>
>> I guess I have a lot to learn to write functions but I'm stuck when using rasterEngine. It seems that it should be very easy to do but I'm missing something, apparently... I have a raster, Safranyik_zones_1961_1990, with values (integer) from 1 to 5. I would like to create five rasters for which value will be 1 when the raster Safranyik_zones_1961_1990 is equal to "i", and NA otherwise. I would like to run everything in a loop . Here's what I thought would be ok.
>>
>> fun_zone <- function(Safranyik_zones,i,...) {
>> Safranyik_zonesb <- Safranyik_zones
>> Safranyik_zonesb[] <- NA
>> Safranyik_zonesb[Safranyik_zones == i] <- 1
>> return(Safranyik_zonesb)
>> }
>>
>> for (i in 1:5){
>> Safranyik_zones_1961_1990b <- rasterEngine(Safranyik_zones=Safranyik_zones_1961_1990,i=i, fun=fun_zone)
>> assign(paste("Safranyik_zones_1961_1990b_",i, sep=""),Safranyik_zones_1961_1990b[[1]])
>> }
>>
>> Of course, it says that ? i ? is missing...:
>>
>>>Erreur dans Safranyik_zones == i : 'i' est manquant
>>
>> Any help?
>>
>> Thanks in advance,
>>
>> Yan
>>
>>
>> Yan Boulanger, Chercheur scientifique / Research scientist
>> Ressources Naturelles Canada, Canadian Forest Service
>> Centre de Foresterie des Laurentides
>> 1055, rue du P.E.P.S.
>> C.P. 10380, succ. Sainte-Foy
>> Qu?bec (Qu?bec) Canada
>> G1V 4C7
>> Tel. : +1 418 649-6859
>>
>>
>>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Alex Zvoleff
> Postdoctoral Associate
> Tropical Ecology Assessment and Monitoring (TEAM) Network
> Conservation International
> 2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
> Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
> http://www.teamnetwork.org | http://www.conservation.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From Yan.Boulanger at RNCan-NRCan.gc.ca  Thu Mar 13 17:20:30 2014
From: Yan.Boulanger at RNCan-NRCan.gc.ca (Boulanger, Yan)
Date: Thu, 13 Mar 2014 16:20:30 +0000
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <CABG0rfv_E-_OSEGEO__2OTRMJOV2HNv3WG-JcHEALun=g+dkbA@mail.gmail.com>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>
	<D3557409FD94BA41AE028A1E573716D6470300E7@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CACwzsXG4Qp0=OggAoOO0X99xnZNTbQybP_qsTkQsOy2+eGUa2Q@mail.gmail.com>
	<CABG0rfv_E-_OSEGEO__2OTRMJOV2HNv3WG-JcHEALun=g+dkbA@mail.gmail.com>
Message-ID: <D3557409FD94BA41AE028A1E573716D6470301EA@S-BSC-MBX2.nrn.nrcan.gc.ca>

Many thanks Jonathan, Alex and Forrest,

This is very helpful information. I'll see what's the best between calc and rasterEngine. 

Sincerely,

Yan

Yan Boulanger, Chercheur scientifique / Research scientist 
Ressources Naturelles Canada, Canadian Forest Service 
Centre de Foresterie des Laurentides 
1055, rue du P.E.P.S.
C.P. 10380, succ. Sainte-Foy
Qu?bec (Qu?bec) Canada
G1V 4C7 
Tel. : +1 418 649-6859 


-----Original Message-----
From: jgrn307 at gmail.com [mailto:jgrn307 at gmail.com] On Behalf Of Jonathan Greenberg
Sent: 13 mars 2014 12:18
To: Alex Zvoleff
Cc: Boulanger, Yan; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] loops in rasterEngine

Yan:

Looks like you are getting great help with this -- I want to echo Alex's note that rasterEngine is not a catchall -- for REALLY simple processes you'll get better performance using calc() or using LESS workers (which may seem counter intuitive).  I'm submitting a paper this week that showed that a function that just multiplies a raster by
10 ran faster than calc() only when using 4 workers
(sfQuickInit(cpus=4)) (vs. calc's 1), but was slower than calc if you have less or more workers.  As a rule, rasterEngine, at present, is slower than calc when operation in sequential mode.

Now, as an important note, if you grab the latest spatial.tools from r-forge, I have added a feature that will return multiple rasters at once, which seems like what you want to do.  You'll want to return a list-of-arrays (each component will be written to its own raster) and make sure you specify the output filenames (the components will be matched against the output filenames).  This may result in a significant speedup because you are only reading each raster once, and returning all the outputs (vs. the example above reads/writes the rasters for every i).

--j

On Thu, Mar 13, 2014 at 9:06 AM, Alex Zvoleff <azvoleff at conservation.org> wrote:
> On Wed, Mar 12, 2014 at 11:29 PM, Boulanger, Yan 
> <Yan.Boulanger at rncan-nrcan.gc.ca> wrote:
>> Actually, I have several rasters of more than 440 000 000 pixels 
>> (MODIS covering all Canada) and I have a 32-cores machine so I would 
>> like to take advantage of it! ;-)
>>
>> Time is money (really?!!)
>
> As mentioned earlier, I would be careful about using rasterEngine for 
> this kind of task. It may actually slow you down. I would recommend 
> testing on smaller subsets to determine your gains (or losses) from 
> doing this type of calculation in parallel versus sequentially. While 
> I have seen great speed increases for CPU intensive calculations from 
> using rasterEngine, it sounds like your processing is heavily IO 
> intensive. I am not sure 32 cores will help you unless you have a very 
> fast disk or RAID array.
>
> Alex
>
>>
>> Thanks again!
>> yan
>>
>> Yan Boulanger, Chercheur scientifique / Research scientist Ressources 
>> Naturelles Canada, Canadian Forest Service Centre de Foresterie des 
>> Laurentides 1055, rue du P.E.P.S.
>> C.P. 10380, succ. Sainte-Foy
>> Qu?bec (Qu?bec) Canada
>> G1V 4C7
>> Tel. : +1 418 649-6859
>>
>> From: Forrest Stevens [mailto:forrest at ufl.edu]
>> Sent: 12 mars 2014 22:25
>> To: Boulanger, Yan
>> Cc: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] loops in rasterEngine
>>
>> Hi Yan, I guess I would be surprised for such a simple process if rasterEngine() would be worth the overhead? Though, admittedly, Jonathan Greenberg might have more information on the topic.  To do such an operation this is the approach I would take without using rasterEngine():
>>
>>
>> for (i in 1:5) {
>>   assign(paste("Safranyik_zones_1961_1990b_",i, sep=""), 
>> Safranyik_zones_1961_1990b == i) }
>>
>>
>> To do it using rasterEngine() this is the function definition that I would use. This of course requires that you've already created a cluster using one of the various supported parallel backends otherwise you'll gain nothing from the parallel processing.
>>
>>
>> require("spatial.tools")
>>
>> ## Begin a parallel cluster and register it with foreach:
>> ## The number of nodes/cores to use in the cluster cpus = 2 cl <- 
>> makeCluster(spec = cpus, type = "PSOCK", methods = FALSE) ## Register 
>> the cluster with foreach:
>> registerDoParallel(cl)
>>
>> ##       Or use the following, quick and dirty way:
>> #sfQuickInit(cpus=2)
>>
>> fun_zone <- function( zones, i, ...) {
>>   return(zones == i)
>> }
>>
>> for (j in 1:5){
>>   assign(paste("Safranyik_zones_1961_1990b_",j, sep=""), 
>> rasterEngine( zones=Safranyik_zones_1961_1990b, args=list("i"=j), 
>> fun=fun_zone) ) }
>>
>> stopCluster(cl)
>> #sfQuickStop()
>>
>>
>> Hope this helps,
>> Forrest
>>
>> --
>> Forrest R. Stevens
>> Ph.D. Candidate, QSE3 IGERT Fellow
>> Department of Geography
>> Land Use and Environmental Change Institute University of Florida 
>> www.clas.ufl.edu/users/forrest<http://www.clas.ufl.edu/users/forrest>
>>
>> On Wed, Mar 12, 2014 at 8:51 PM, Boulanger, Yan <Yan.Boulanger at rncan-nrcan.gc.ca<mailto:Yan.Boulanger at rncan-nrcan.gc.ca>> wrote:
>> Hi folks,
>>
>> I guess I have a lot to learn to write functions but I'm stuck when using rasterEngine. It seems that it should be very easy to do but I'm missing something, apparently... I have a raster, Safranyik_zones_1961_1990, with values (integer) from 1 to 5. I would like to create five rasters for which value will be 1 when the raster Safranyik_zones_1961_1990 is equal to "i", and NA otherwise. I would like to run everything in a loop . Here's what I thought would be ok.
>>
>> fun_zone <- function(Safranyik_zones,i,...) { Safranyik_zonesb <- 
>> Safranyik_zones Safranyik_zonesb[] <- NA 
>> Safranyik_zonesb[Safranyik_zones == i] <- 1
>> return(Safranyik_zonesb)
>> }
>>
>> for (i in 1:5){
>> Safranyik_zones_1961_1990b <- 
>> rasterEngine(Safranyik_zones=Safranyik_zones_1961_1990,i=i, 
>> fun=fun_zone) assign(paste("Safranyik_zones_1961_1990b_",i, 
>> sep=""),Safranyik_zones_1961_1990b[[1]])
>> }
>>
>> Of course, it says that ? i ? is missing...:
>>
>>>Erreur dans Safranyik_zones == i : 'i' est manquant
>>
>> Any help?
>>
>> Thanks in advance,
>>
>> Yan
>>
>>
>> Yan Boulanger, Chercheur scientifique / Research scientist Ressources 
>> Naturelles Canada, Canadian Forest Service Centre de Foresterie des 
>> Laurentides 1055, rue du P.E.P.S.
>> C.P. 10380, succ. Sainte-Foy
>> Qu?bec (Qu?bec) Canada
>> G1V 4C7
>> Tel. : +1 418 649-6859
>>
>>
>>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Alex Zvoleff
> Postdoctoral Associate
> Tropical Ecology Assessment and Monitoring (TEAM) Network Conservation 
> International
> 2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
> Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff 
> http://www.teamnetwork.org | http://www.conservation.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



--
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory Department of Geography and Geographic Information Science University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From Yan.Boulanger at RNCan-NRCan.gc.ca  Thu Mar 13 17:26:10 2014
From: Yan.Boulanger at RNCan-NRCan.gc.ca (Boulanger, Yan)
Date: Thu, 13 Mar 2014 16:26:10 +0000
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <CABG0rfv_E-_OSEGEO__2OTRMJOV2HNv3WG-JcHEALun=g+dkbA@mail.gmail.com>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>
	<D3557409FD94BA41AE028A1E573716D6470300E7@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CACwzsXG4Qp0=OggAoOO0X99xnZNTbQybP_qsTkQsOy2+eGUa2Q@mail.gmail.com>
	<CABG0rfv_E-_OSEGEO__2OTRMJOV2HNv3WG-JcHEALun=g+dkbA@mail.gmail.com>
Message-ID: <D3557409FD94BA41AE028A1E573716D6470301FF@S-BSC-MBX2.nrn.nrcan.gc.ca>

Is it so that system.time in this case can strongly depend on how much data is placed in RAM? In my case, I'm far from being memory limited (RAM = 192 Gb) and most of the time, it's faster to put everything in memory and then process it. The major limiting speed factor here is I/O.

yan

Yan Boulanger, Chercheur scientifique / Research scientist 
Ressources Naturelles Canada, Canadian Forest Service 
Centre de Foresterie des Laurentides 
1055, rue du P.E.P.S.
C.P. 10380, succ. Sainte-Foy
Qu?bec (Qu?bec) Canada
G1V 4C7 
Tel. : +1 418 649-6859 


-----Original Message-----
From: jgrn307 at gmail.com [mailto:jgrn307 at gmail.com] On Behalf Of Jonathan Greenberg
Sent: 13 mars 2014 12:18
To: Alex Zvoleff
Cc: Boulanger, Yan; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] loops in rasterEngine

Yan:

Looks like you are getting great help with this -- I want to echo Alex's note that rasterEngine is not a catchall -- for REALLY simple processes you'll get better performance using calc() or using LESS workers (which may seem counter intuitive).  I'm submitting a paper this week that showed that a function that just multiplies a raster by
10 ran faster than calc() only when using 4 workers
(sfQuickInit(cpus=4)) (vs. calc's 1), but was slower than calc if you have less or more workers.  As a rule, rasterEngine, at present, is slower than calc when operation in sequential mode.

Now, as an important note, if you grab the latest spatial.tools from r-forge, I have added a feature that will return multiple rasters at once, which seems like what you want to do.  You'll want to return a list-of-arrays (each component will be written to its own raster) and make sure you specify the output filenames (the components will be matched against the output filenames).  This may result in a significant speedup because you are only reading each raster once, and returning all the outputs (vs. the example above reads/writes the rasters for every i).

--j

On Thu, Mar 13, 2014 at 9:06 AM, Alex Zvoleff <azvoleff at conservation.org> wrote:
> On Wed, Mar 12, 2014 at 11:29 PM, Boulanger, Yan 
> <Yan.Boulanger at rncan-nrcan.gc.ca> wrote:
>> Actually, I have several rasters of more than 440 000 000 pixels 
>> (MODIS covering all Canada) and I have a 32-cores machine so I would 
>> like to take advantage of it! ;-)
>>
>> Time is money (really?!!)
>
> As mentioned earlier, I would be careful about using rasterEngine for 
> this kind of task. It may actually slow you down. I would recommend 
> testing on smaller subsets to determine your gains (or losses) from 
> doing this type of calculation in parallel versus sequentially. While 
> I have seen great speed increases for CPU intensive calculations from 
> using rasterEngine, it sounds like your processing is heavily IO 
> intensive. I am not sure 32 cores will help you unless you have a very 
> fast disk or RAID array.
>
> Alex
>
>>
>> Thanks again!
>> yan
>>
>> Yan Boulanger, Chercheur scientifique / Research scientist Ressources 
>> Naturelles Canada, Canadian Forest Service Centre de Foresterie des 
>> Laurentides 1055, rue du P.E.P.S.
>> C.P. 10380, succ. Sainte-Foy
>> Qu?bec (Qu?bec) Canada
>> G1V 4C7
>> Tel. : +1 418 649-6859
>>
>> From: Forrest Stevens [mailto:forrest at ufl.edu]
>> Sent: 12 mars 2014 22:25
>> To: Boulanger, Yan
>> Cc: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] loops in rasterEngine
>>
>> Hi Yan, I guess I would be surprised for such a simple process if rasterEngine() would be worth the overhead? Though, admittedly, Jonathan Greenberg might have more information on the topic.  To do such an operation this is the approach I would take without using rasterEngine():
>>
>>
>> for (i in 1:5) {
>>   assign(paste("Safranyik_zones_1961_1990b_",i, sep=""), 
>> Safranyik_zones_1961_1990b == i) }
>>
>>
>> To do it using rasterEngine() this is the function definition that I would use. This of course requires that you've already created a cluster using one of the various supported parallel backends otherwise you'll gain nothing from the parallel processing.
>>
>>
>> require("spatial.tools")
>>
>> ## Begin a parallel cluster and register it with foreach:
>> ## The number of nodes/cores to use in the cluster cpus = 2 cl <- 
>> makeCluster(spec = cpus, type = "PSOCK", methods = FALSE) ## Register 
>> the cluster with foreach:
>> registerDoParallel(cl)
>>
>> ##       Or use the following, quick and dirty way:
>> #sfQuickInit(cpus=2)
>>
>> fun_zone <- function( zones, i, ...) {
>>   return(zones == i)
>> }
>>
>> for (j in 1:5){
>>   assign(paste("Safranyik_zones_1961_1990b_",j, sep=""), 
>> rasterEngine( zones=Safranyik_zones_1961_1990b, args=list("i"=j), 
>> fun=fun_zone) ) }
>>
>> stopCluster(cl)
>> #sfQuickStop()
>>
>>
>> Hope this helps,
>> Forrest
>>
>> --
>> Forrest R. Stevens
>> Ph.D. Candidate, QSE3 IGERT Fellow
>> Department of Geography
>> Land Use and Environmental Change Institute University of Florida 
>> www.clas.ufl.edu/users/forrest<http://www.clas.ufl.edu/users/forrest>
>>
>> On Wed, Mar 12, 2014 at 8:51 PM, Boulanger, Yan <Yan.Boulanger at rncan-nrcan.gc.ca<mailto:Yan.Boulanger at rncan-nrcan.gc.ca>> wrote:
>> Hi folks,
>>
>> I guess I have a lot to learn to write functions but I'm stuck when using rasterEngine. It seems that it should be very easy to do but I'm missing something, apparently... I have a raster, Safranyik_zones_1961_1990, with values (integer) from 1 to 5. I would like to create five rasters for which value will be 1 when the raster Safranyik_zones_1961_1990 is equal to "i", and NA otherwise. I would like to run everything in a loop . Here's what I thought would be ok.
>>
>> fun_zone <- function(Safranyik_zones,i,...) { Safranyik_zonesb <- 
>> Safranyik_zones Safranyik_zonesb[] <- NA 
>> Safranyik_zonesb[Safranyik_zones == i] <- 1
>> return(Safranyik_zonesb)
>> }
>>
>> for (i in 1:5){
>> Safranyik_zones_1961_1990b <- 
>> rasterEngine(Safranyik_zones=Safranyik_zones_1961_1990,i=i, 
>> fun=fun_zone) assign(paste("Safranyik_zones_1961_1990b_",i, 
>> sep=""),Safranyik_zones_1961_1990b[[1]])
>> }
>>
>> Of course, it says that ? i ? is missing...:
>>
>>>Erreur dans Safranyik_zones == i : 'i' est manquant
>>
>> Any help?
>>
>> Thanks in advance,
>>
>> Yan
>>
>>
>> Yan Boulanger, Chercheur scientifique / Research scientist Ressources 
>> Naturelles Canada, Canadian Forest Service Centre de Foresterie des 
>> Laurentides 1055, rue du P.E.P.S.
>> C.P. 10380, succ. Sainte-Foy
>> Qu?bec (Qu?bec) Canada
>> G1V 4C7
>> Tel. : +1 418 649-6859
>>
>>
>>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Alex Zvoleff
> Postdoctoral Associate
> Tropical Ecology Assessment and Monitoring (TEAM) Network Conservation 
> International
> 2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
> Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff 
> http://www.teamnetwork.org | http://www.conservation.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



--
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory Department of Geography and Geographic Information Science University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jgrn at illinois.edu  Thu Mar 13 17:41:24 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Thu, 13 Mar 2014 11:41:24 -0500
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <D3557409FD94BA41AE028A1E573716D6470301FF@S-BSC-MBX2.nrn.nrcan.gc.ca>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>
	<D3557409FD94BA41AE028A1E573716D6470300E7@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CACwzsXG4Qp0=OggAoOO0X99xnZNTbQybP_qsTkQsOy2+eGUa2Q@mail.gmail.com>
	<CABG0rfv_E-_OSEGEO__2OTRMJOV2HNv3WG-JcHEALun=g+dkbA@mail.gmail.com>
	<D3557409FD94BA41AE028A1E573716D6470301FF@S-BSC-MBX2.nrn.nrcan.gc.ca>
Message-ID: <CABG0rfvK_DUkmKjzV74J9wDz2R0OuYVL3s8nymxJ8krLiuReUQ@mail.gmail.com>

There is typically a diminishing returns with larger and larger
"chunks", but there is a low-end in terms of file size and chunk size
for how much parallel processing helps.  However, if you are only
reading and writing once, I don't see too much of an advantage of
loading everything into memory once, since that is what calc()/focal()
and rasterEngine() both do (read from the file once, process it, and
write the output), just in small sizes.  If you are using the same
input file over and over again than I do see it being helpful.  As a
general rule, we try to use chunking in raster processing because it
becomes almost infinitely scalable (almost :)

One issue that I've run into with R is that I've found it REALLY hard
to do a memory profile of a function -- if I could figure out the
memory footprint of a function (its MAX memory usage during its
execution), I could auto-optimize the chunk size.  Right now, I use a
conservative multiplier of the number of input bands divided by the
number of workers in the cluster, but this doesn't account for memory
spikes within the function itself.  Perhaps Robert can chime in on any
tricks for auto-optimizing the chunk size he's come across?

--j


On Thu, Mar 13, 2014 at 11:26 AM, Boulanger, Yan
<Yan.Boulanger at rncan-nrcan.gc.ca> wrote:
> Is it so that system.time in this case can strongly depend on how much data is placed in RAM? In my case, I'm far from being memory limited (RAM = 192 Gb) and most of the time, it's faster to put everything in memory and then process it. The major limiting speed factor here is I/O.
>
> yan
>
> Yan Boulanger, Chercheur scientifique / Research scientist
> Ressources Naturelles Canada, Canadian Forest Service
> Centre de Foresterie des Laurentides
> 1055, rue du P.E.P.S.
> C.P. 10380, succ. Sainte-Foy
> Qu?bec (Qu?bec) Canada
> G1V 4C7
> Tel. : +1 418 649-6859
>
>
> -----Original Message-----
> From: jgrn307 at gmail.com [mailto:jgrn307 at gmail.com] On Behalf Of Jonathan Greenberg
> Sent: 13 mars 2014 12:18
> To: Alex Zvoleff
> Cc: Boulanger, Yan; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] loops in rasterEngine
>
> Yan:
>
> Looks like you are getting great help with this -- I want to echo Alex's note that rasterEngine is not a catchall -- for REALLY simple processes you'll get better performance using calc() or using LESS workers (which may seem counter intuitive).  I'm submitting a paper this week that showed that a function that just multiplies a raster by
> 10 ran faster than calc() only when using 4 workers
> (sfQuickInit(cpus=4)) (vs. calc's 1), but was slower than calc if you have less or more workers.  As a rule, rasterEngine, at present, is slower than calc when operation in sequential mode.
>
> Now, as an important note, if you grab the latest spatial.tools from r-forge, I have added a feature that will return multiple rasters at once, which seems like what you want to do.  You'll want to return a list-of-arrays (each component will be written to its own raster) and make sure you specify the output filenames (the components will be matched against the output filenames).  This may result in a significant speedup because you are only reading each raster once, and returning all the outputs (vs. the example above reads/writes the rasters for every i).
>
> --j
>
> On Thu, Mar 13, 2014 at 9:06 AM, Alex Zvoleff <azvoleff at conservation.org> wrote:
>> On Wed, Mar 12, 2014 at 11:29 PM, Boulanger, Yan
>> <Yan.Boulanger at rncan-nrcan.gc.ca> wrote:
>>> Actually, I have several rasters of more than 440 000 000 pixels
>>> (MODIS covering all Canada) and I have a 32-cores machine so I would
>>> like to take advantage of it! ;-)
>>>
>>> Time is money (really?!!)
>>
>> As mentioned earlier, I would be careful about using rasterEngine for
>> this kind of task. It may actually slow you down. I would recommend
>> testing on smaller subsets to determine your gains (or losses) from
>> doing this type of calculation in parallel versus sequentially. While
>> I have seen great speed increases for CPU intensive calculations from
>> using rasterEngine, it sounds like your processing is heavily IO
>> intensive. I am not sure 32 cores will help you unless you have a very
>> fast disk or RAID array.
>>
>> Alex
>>
>>>
>>> Thanks again!
>>> yan
>>>
>>> Yan Boulanger, Chercheur scientifique / Research scientist Ressources
>>> Naturelles Canada, Canadian Forest Service Centre de Foresterie des
>>> Laurentides 1055, rue du P.E.P.S.
>>> C.P. 10380, succ. Sainte-Foy
>>> Qu?bec (Qu?bec) Canada
>>> G1V 4C7
>>> Tel. : +1 418 649-6859
>>>
>>> From: Forrest Stevens [mailto:forrest at ufl.edu]
>>> Sent: 12 mars 2014 22:25
>>> To: Boulanger, Yan
>>> Cc: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] loops in rasterEngine
>>>
>>> Hi Yan, I guess I would be surprised for such a simple process if rasterEngine() would be worth the overhead? Though, admittedly, Jonathan Greenberg might have more information on the topic.  To do such an operation this is the approach I would take without using rasterEngine():
>>>
>>>
>>> for (i in 1:5) {
>>>   assign(paste("Safranyik_zones_1961_1990b_",i, sep=""),
>>> Safranyik_zones_1961_1990b == i) }
>>>
>>>
>>> To do it using rasterEngine() this is the function definition that I would use. This of course requires that you've already created a cluster using one of the various supported parallel backends otherwise you'll gain nothing from the parallel processing.
>>>
>>>
>>> require("spatial.tools")
>>>
>>> ## Begin a parallel cluster and register it with foreach:
>>> ## The number of nodes/cores to use in the cluster cpus = 2 cl <-
>>> makeCluster(spec = cpus, type = "PSOCK", methods = FALSE) ## Register
>>> the cluster with foreach:
>>> registerDoParallel(cl)
>>>
>>> ##       Or use the following, quick and dirty way:
>>> #sfQuickInit(cpus=2)
>>>
>>> fun_zone <- function( zones, i, ...) {
>>>   return(zones == i)
>>> }
>>>
>>> for (j in 1:5){
>>>   assign(paste("Safranyik_zones_1961_1990b_",j, sep=""),
>>> rasterEngine( zones=Safranyik_zones_1961_1990b, args=list("i"=j),
>>> fun=fun_zone) ) }
>>>
>>> stopCluster(cl)
>>> #sfQuickStop()
>>>
>>>
>>> Hope this helps,
>>> Forrest
>>>
>>> --
>>> Forrest R. Stevens
>>> Ph.D. Candidate, QSE3 IGERT Fellow
>>> Department of Geography
>>> Land Use and Environmental Change Institute University of Florida
>>> www.clas.ufl.edu/users/forrest<http://www.clas.ufl.edu/users/forrest>
>>>
>>> On Wed, Mar 12, 2014 at 8:51 PM, Boulanger, Yan <Yan.Boulanger at rncan-nrcan.gc.ca<mailto:Yan.Boulanger at rncan-nrcan.gc.ca>> wrote:
>>> Hi folks,
>>>
>>> I guess I have a lot to learn to write functions but I'm stuck when using rasterEngine. It seems that it should be very easy to do but I'm missing something, apparently... I have a raster, Safranyik_zones_1961_1990, with values (integer) from 1 to 5. I would like to create five rasters for which value will be 1 when the raster Safranyik_zones_1961_1990 is equal to "i", and NA otherwise. I would like to run everything in a loop . Here's what I thought would be ok.
>>>
>>> fun_zone <- function(Safranyik_zones,i,...) { Safranyik_zonesb <-
>>> Safranyik_zones Safranyik_zonesb[] <- NA
>>> Safranyik_zonesb[Safranyik_zones == i] <- 1
>>> return(Safranyik_zonesb)
>>> }
>>>
>>> for (i in 1:5){
>>> Safranyik_zones_1961_1990b <-
>>> rasterEngine(Safranyik_zones=Safranyik_zones_1961_1990,i=i,
>>> fun=fun_zone) assign(paste("Safranyik_zones_1961_1990b_",i,
>>> sep=""),Safranyik_zones_1961_1990b[[1]])
>>> }
>>>
>>> Of course, it says that ? i ? is missing...:
>>>
>>>>Erreur dans Safranyik_zones == i : 'i' est manquant
>>>
>>> Any help?
>>>
>>> Thanks in advance,
>>>
>>> Yan
>>>
>>>
>>> Yan Boulanger, Chercheur scientifique / Research scientist Ressources
>>> Naturelles Canada, Canadian Forest Service Centre de Foresterie des
>>> Laurentides 1055, rue du P.E.P.S.
>>> C.P. 10380, succ. Sainte-Foy
>>> Qu?bec (Qu?bec) Canada
>>> G1V 4C7
>>> Tel. : +1 418 649-6859
>>>
>>>
>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> Alex Zvoleff
>> Postdoctoral Associate
>> Tropical Ecology Assessment and Monitoring (TEAM) Network Conservation
>> International
>> 2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
>> Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
>> http://www.teamnetwork.org | http://www.conservation.org
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory Department of Geography and Geographic Information Science University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jgrn at illinois.edu  Thu Mar 13 18:17:42 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Thu, 13 Mar 2014 12:17:42 -0500
Subject: [R-sig-Geo] loops in rasterEngine
In-Reply-To: <CABG0rfvK_DUkmKjzV74J9wDz2R0OuYVL3s8nymxJ8krLiuReUQ@mail.gmail.com>
References: <D3557409FD94BA41AE028A1E573716D647030096@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CAEBQMM=RMArHkPiRUFgB5Xc=gx7gMp8ETUg8DfcHc2P_5rpFXQ@mail.gmail.com>
	<D3557409FD94BA41AE028A1E573716D6470300E7@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CACwzsXG4Qp0=OggAoOO0X99xnZNTbQybP_qsTkQsOy2+eGUa2Q@mail.gmail.com>
	<CABG0rfv_E-_OSEGEO__2OTRMJOV2HNv3WG-JcHEALun=g+dkbA@mail.gmail.com>
	<D3557409FD94BA41AE028A1E573716D6470301FF@S-BSC-MBX2.nrn.nrcan.gc.ca>
	<CABG0rfvK_DUkmKjzV74J9wDz2R0OuYVL3s8nymxJ8krLiuReUQ@mail.gmail.com>
Message-ID: <CABG0rfsmoCBiGvtpTVArNBuZ4Oh1KT03+FKOaEq=i2g8Qg+b-w@mail.gmail.com>

Sorry for the barrage of emails, but here is a more relevant example
with two parallel solutions:

install.packages("spatial.tools",
repos="http://R-Forge.R-project.org",type="source")
library(spatial.tools)

# The function passed to rasterEngine does the looping via lapply:
classID_rasterEngine_function <- function(inraster,target_ids)
{
output <- lapply(target_ids,function(x,inraster) return(inraster ==
x),inraster=inraster)
return(output)
}

tahoe_lidar_highesthit <-
raster(system.file("external/tahoe_lidar_highesthit.tif",
package="spatial.tools"))

# We'll set up a set of input/outputs to loop through:
output_basenames <- c("boulanger_test1","boulanger_test2")
inrasters <- c(tahoe_lidar_highesthit, tahoe_lidar_highesthit)

# Here are the ids you want to map:
target_ids <- 1:3

### We'll do two parallel processing approaches.  The first will loop
through each input sequentially, and process the
### input in parallel:

# Parallel process applied within a file:
sfQuickInit()
for(i in seq(output_basenames))
{
output_filenames <- paste(output_basenames[i],target_ids,sep="_")
output <- rasterEngine(inraster=inrasters[[i]],fun=classID_rasterEngine_function,filename=output_filenames,
args=list(target_ids=target_ids))
}
sfQuickStop()

### Parallel process each individual file (rasterEngine will run
sequentially in this case):
## In this case, you are processing multiple input/outputs at once,
but rasterEngine will
## run sequentially.

sfQuickInit()
foreach(i=seq(output_basenames),.packages="spatial.tools") %dopar%
{
output_filenames <- paste(output_basenames[i],target_ids,sep="_")
# You could use calc() here instead:
output <- rasterEngine(inraster=inrasters[[i]],fun=classID_rasterEngine_function,
filename=output_filenames,args=list(target_ids=target_ids))
}
sfQuickStop()



On Thu, Mar 13, 2014 at 11:41 AM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
> There is typically a diminishing returns with larger and larger
> "chunks", but there is a low-end in terms of file size and chunk size
> for how much parallel processing helps.  However, if you are only
> reading and writing once, I don't see too much of an advantage of
> loading everything into memory once, since that is what calc()/focal()
> and rasterEngine() both do (read from the file once, process it, and
> write the output), just in small sizes.  If you are using the same
> input file over and over again than I do see it being helpful.  As a
> general rule, we try to use chunking in raster processing because it
> becomes almost infinitely scalable (almost :)
>
> One issue that I've run into with R is that I've found it REALLY hard
> to do a memory profile of a function -- if I could figure out the
> memory footprint of a function (its MAX memory usage during its
> execution), I could auto-optimize the chunk size.  Right now, I use a
> conservative multiplier of the number of input bands divided by the
> number of workers in the cluster, but this doesn't account for memory
> spikes within the function itself.  Perhaps Robert can chime in on any
> tricks for auto-optimizing the chunk size he's come across?
>
> --j
>
>
> On Thu, Mar 13, 2014 at 11:26 AM, Boulanger, Yan
> <Yan.Boulanger at rncan-nrcan.gc.ca> wrote:
>> Is it so that system.time in this case can strongly depend on how much data is placed in RAM? In my case, I'm far from being memory limited (RAM = 192 Gb) and most of the time, it's faster to put everything in memory and then process it. The major limiting speed factor here is I/O.
>>
>> yan
>>
>> Yan Boulanger, Chercheur scientifique / Research scientist
>> Ressources Naturelles Canada, Canadian Forest Service
>> Centre de Foresterie des Laurentides
>> 1055, rue du P.E.P.S.
>> C.P. 10380, succ. Sainte-Foy
>> Qu?bec (Qu?bec) Canada
>> G1V 4C7
>> Tel. : +1 418 649-6859
>>
>>
>> -----Original Message-----
>> From: jgrn307 at gmail.com [mailto:jgrn307 at gmail.com] On Behalf Of Jonathan Greenberg
>> Sent: 13 mars 2014 12:18
>> To: Alex Zvoleff
>> Cc: Boulanger, Yan; r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] loops in rasterEngine
>>
>> Yan:
>>
>> Looks like you are getting great help with this -- I want to echo Alex's note that rasterEngine is not a catchall -- for REALLY simple processes you'll get better performance using calc() or using LESS workers (which may seem counter intuitive).  I'm submitting a paper this week that showed that a function that just multiplies a raster by
>> 10 ran faster than calc() only when using 4 workers
>> (sfQuickInit(cpus=4)) (vs. calc's 1), but was slower than calc if you have less or more workers.  As a rule, rasterEngine, at present, is slower than calc when operation in sequential mode.
>>
>> Now, as an important note, if you grab the latest spatial.tools from r-forge, I have added a feature that will return multiple rasters at once, which seems like what you want to do.  You'll want to return a list-of-arrays (each component will be written to its own raster) and make sure you specify the output filenames (the components will be matched against the output filenames).  This may result in a significant speedup because you are only reading each raster once, and returning all the outputs (vs. the example above reads/writes the rasters for every i).
>>
>> --j
>>
>> On Thu, Mar 13, 2014 at 9:06 AM, Alex Zvoleff <azvoleff at conservation.org> wrote:
>>> On Wed, Mar 12, 2014 at 11:29 PM, Boulanger, Yan
>>> <Yan.Boulanger at rncan-nrcan.gc.ca> wrote:
>>>> Actually, I have several rasters of more than 440 000 000 pixels
>>>> (MODIS covering all Canada) and I have a 32-cores machine so I would
>>>> like to take advantage of it! ;-)
>>>>
>>>> Time is money (really?!!)
>>>
>>> As mentioned earlier, I would be careful about using rasterEngine for
>>> this kind of task. It may actually slow you down. I would recommend
>>> testing on smaller subsets to determine your gains (or losses) from
>>> doing this type of calculation in parallel versus sequentially. While
>>> I have seen great speed increases for CPU intensive calculations from
>>> using rasterEngine, it sounds like your processing is heavily IO
>>> intensive. I am not sure 32 cores will help you unless you have a very
>>> fast disk or RAID array.
>>>
>>> Alex
>>>
>>>>
>>>> Thanks again!
>>>> yan
>>>>
>>>> Yan Boulanger, Chercheur scientifique / Research scientist Ressources
>>>> Naturelles Canada, Canadian Forest Service Centre de Foresterie des
>>>> Laurentides 1055, rue du P.E.P.S.
>>>> C.P. 10380, succ. Sainte-Foy
>>>> Qu?bec (Qu?bec) Canada
>>>> G1V 4C7
>>>> Tel. : +1 418 649-6859
>>>>
>>>> From: Forrest Stevens [mailto:forrest at ufl.edu]
>>>> Sent: 12 mars 2014 22:25
>>>> To: Boulanger, Yan
>>>> Cc: r-sig-geo at r-project.org
>>>> Subject: Re: [R-sig-Geo] loops in rasterEngine
>>>>
>>>> Hi Yan, I guess I would be surprised for such a simple process if rasterEngine() would be worth the overhead? Though, admittedly, Jonathan Greenberg might have more information on the topic.  To do such an operation this is the approach I would take without using rasterEngine():
>>>>
>>>>
>>>> for (i in 1:5) {
>>>>   assign(paste("Safranyik_zones_1961_1990b_",i, sep=""),
>>>> Safranyik_zones_1961_1990b == i) }
>>>>
>>>>
>>>> To do it using rasterEngine() this is the function definition that I would use. This of course requires that you've already created a cluster using one of the various supported parallel backends otherwise you'll gain nothing from the parallel processing.
>>>>
>>>>
>>>> require("spatial.tools")
>>>>
>>>> ## Begin a parallel cluster and register it with foreach:
>>>> ## The number of nodes/cores to use in the cluster cpus = 2 cl <-
>>>> makeCluster(spec = cpus, type = "PSOCK", methods = FALSE) ## Register
>>>> the cluster with foreach:
>>>> registerDoParallel(cl)
>>>>
>>>> ##       Or use the following, quick and dirty way:
>>>> #sfQuickInit(cpus=2)
>>>>
>>>> fun_zone <- function( zones, i, ...) {
>>>>   return(zones == i)
>>>> }
>>>>
>>>> for (j in 1:5){
>>>>   assign(paste("Safranyik_zones_1961_1990b_",j, sep=""),
>>>> rasterEngine( zones=Safranyik_zones_1961_1990b, args=list("i"=j),
>>>> fun=fun_zone) ) }
>>>>
>>>> stopCluster(cl)
>>>> #sfQuickStop()
>>>>
>>>>
>>>> Hope this helps,
>>>> Forrest
>>>>
>>>> --
>>>> Forrest R. Stevens
>>>> Ph.D. Candidate, QSE3 IGERT Fellow
>>>> Department of Geography
>>>> Land Use and Environmental Change Institute University of Florida
>>>> www.clas.ufl.edu/users/forrest<http://www.clas.ufl.edu/users/forrest>
>>>>
>>>> On Wed, Mar 12, 2014 at 8:51 PM, Boulanger, Yan <Yan.Boulanger at rncan-nrcan.gc.ca<mailto:Yan.Boulanger at rncan-nrcan.gc.ca>> wrote:
>>>> Hi folks,
>>>>
>>>> I guess I have a lot to learn to write functions but I'm stuck when using rasterEngine. It seems that it should be very easy to do but I'm missing something, apparently... I have a raster, Safranyik_zones_1961_1990, with values (integer) from 1 to 5. I would like to create five rasters for which value will be 1 when the raster Safranyik_zones_1961_1990 is equal to "i", and NA otherwise. I would like to run everything in a loop . Here's what I thought would be ok.
>>>>
>>>> fun_zone <- function(Safranyik_zones,i,...) { Safranyik_zonesb <-
>>>> Safranyik_zones Safranyik_zonesb[] <- NA
>>>> Safranyik_zonesb[Safranyik_zones == i] <- 1
>>>> return(Safranyik_zonesb)
>>>> }
>>>>
>>>> for (i in 1:5){
>>>> Safranyik_zones_1961_1990b <-
>>>> rasterEngine(Safranyik_zones=Safranyik_zones_1961_1990,i=i,
>>>> fun=fun_zone) assign(paste("Safranyik_zones_1961_1990b_",i,
>>>> sep=""),Safranyik_zones_1961_1990b[[1]])
>>>> }
>>>>
>>>> Of course, it says that ? i ? is missing...:
>>>>
>>>>>Erreur dans Safranyik_zones == i : 'i' est manquant
>>>>
>>>> Any help?
>>>>
>>>> Thanks in advance,
>>>>
>>>> Yan
>>>>
>>>>
>>>> Yan Boulanger, Chercheur scientifique / Research scientist Ressources
>>>> Naturelles Canada, Canadian Forest Service Centre de Foresterie des
>>>> Laurentides 1055, rue du P.E.P.S.
>>>> C.P. 10380, succ. Sainte-Foy
>>>> Qu?bec (Qu?bec) Canada
>>>> G1V 4C7
>>>> Tel. : +1 418 649-6859
>>>>
>>>>
>>>>
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>>
>>> --
>>> Alex Zvoleff
>>> Postdoctoral Associate
>>> Tropical Ecology Assessment and Monitoring (TEAM) Network Conservation
>>> International
>>> 2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
>>> Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
>>> http://www.teamnetwork.org | http://www.conservation.org
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory Department of Geography and Geographic Information Science University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From spencer.meyer at maine.edu  Fri Mar 14 01:07:09 2014
From: spencer.meyer at maine.edu (Spencer Meyer)
Date: Thu, 13 Mar 2014 20:07:09 -0400
Subject: [R-sig-Geo] creating point sample of polygons using spsample
In-Reply-To: c459ddcbafa09c4b2b843fbf6ad12603@mail.gmail.com
References: 758bc4ee7a7da0572e3fd344105ed336@mail.gmail.com
	c459ddcbafa09c4b2b843fbf6ad12603@mail.gmail.com
Message-ID: <ddc1888cd851e4e504906a4624fd9648@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140313/e7ac7052/attachment.pl>

From sylvain.willart at gmail.com  Fri Mar 14 12:52:56 2014
From: sylvain.willart at gmail.com (sylvain willart)
Date: Fri, 14 Mar 2014 12:52:56 +0100
Subject: [R-sig-Geo] How to shrink a spatial shape ? Or calculate distances
 btw points and a polygon ?
Message-ID: <CABW9NAwhj+sVRxtj+31Sut4nCu1QBDbEeAWsL8=_SJkFtCT0pQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140314/5be8c274/attachment.pl>

From roman.lustrik at gmail.com  Fri Mar 14 13:11:26 2014
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 14 Mar 2014 13:11:26 +0100
Subject: [R-sig-Geo] How to shrink a spatial shape ? Or calculate
 distances btw points and a polygon ?
In-Reply-To: <CABW9NAwhj+sVRxtj+31Sut4nCu1QBDbEeAWsL8=_SJkFtCT0pQ@mail.gmail.com>
References: <CABW9NAwhj+sVRxtj+31Sut4nCu1QBDbEeAWsL8=_SJkFtCT0pQ@mail.gmail.com>
Message-ID: <CAHT1vpjL57H9HAo40Amqc+a8yzwAS+9CEw=_Aoisbv5WKDMcew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140314/def8149e/attachment.pl>

From tghoward at gw.dec.state.ny.us  Fri Mar 14 13:14:51 2014
From: tghoward at gw.dec.state.ny.us (Tim Howard)
Date: Fri, 14 Mar 2014 08:14:51 -0400
Subject: [R-sig-Geo] creating point sample of polygons using spsample
In-Reply-To: <mailman.11.1394794804.29850.r-sig-geo@r-project.org>
References: <mailman.11.1394794804.29850.r-sig-geo@r-project.org>
Message-ID: <5322BA7B020000D500B86B9B@gwsmtp.dec.state.ny.us>

Spencer,
If you have the energy to try a different approach, I've had good success using the spsurvey package for this kind of thing. It generates spatially-balanced random points and can accommodate what you need. The setup is kind of complex, but there are some pretty good vignettes, including this one:
 
http://cran.at.r-project.org/web/packages/spsurvey/vignettes/Area_Design.pdf 
 
You want the stratified, equal probability, GRTS survey design (begins on page 9). 

Cheers, 
Tim

> Date: Thu, 13 Mar 2014 20:07:09 -0400
> From: Spencer Meyer <spencer.meyer at maine.edu>
> To: r-sig-geo at r-project.org 
> >Subject: [R-sig-Geo] creating point sample of polygons using spsample
> Message-ID: <ddc1888cd851e4e504906a4624fd9648 at mail.gmail.com>
> Content-Type: text/plain
> 
> Greetings - I am using R 2.15.2 on Windows 7 and am seeking help with the
> spsample function in R. I have a polygon dataset (n= 5733) and I'm trying
> to use the spsample function to sample the polygons to create a point
> dataset. I'm using sapply to create the sample based on code I found here:
> 
> http://casoilresource.lawr.ucdavis.edu/drupal/node/644 
> 
> 
> 
> Problem #1
> 
> The polygons are vastly different sizes (1-309,000 hectares) so I'd like to
> vary the sample size (n) based on the size of the polygon. I've tried
> passing a vector of the size of each polygon to the function, but I don't
> believe I'm linking the vector to the index (i) properly. I have also tried
> accessing the slot "area" of the x at polygons slot but I cannot seem to get a
> slot of a slot. I have also tried using the "stratified" type and adjusting
> the cellsize but that does not appear to change the sample size differently
> for different polygons.
> 
> 
> 
> Problem #2
> 
> I am having trouble joining the attributes from my original polygons back
> to my resulting points. I have used the sample from the website listed
> above to attach the polygon ID to each point but I cannot also get the
> attributes. The method for extracting the ID relies on accessing the
> polygons slot but then I have to access the data slot to get the attributes
> and I can't seem to do both.
> 
> 
> 
> Here is my code so far. As you can see I'm an R rookie, particularly when
> it comes to understanding how different data classes relate to each other.
> 
> Thank you for your help!
> 
> _____________________________________________________________________
> 
> 
> 
> #### Create Sample Points in R
> ------------------------------------------------------
> 
> library(rgdal)
> 
> 
> 
> ## check polygons for holes
> 
> pls <- slot(poly.proj, "polygons")   #extract polygons from
> spatialpolygondataframe
> 
> pls_new <- lapply(pls, checkPolygonsHoles)  # check for holes
> 
> poly.new <- SpatialPolygonsDataFrame(SpatialPolygons(pls_new,
> 
>             proj4string=CRS(proj4string(poly.proj))), data=as(poly.proj,
> "data.frame"))  # fix holes
> 
> 
> 
> ## create point sample within polygons
> 
> ## followed http://casoilresource.lawr.ucdavis.edu/drupal/node/644 
> 
> 
> 
> # try three different approaches
> 
> polyPts = sapply(slot(poly.new, 'polygons'), function(i) spsample(i, n=100,
> type='hexagonal', offset=c(0,0)))  # works but doesn't vary sample by
> polygon size
> 
> 
> 
> polyPts2 = sapply(slot(poly.new, 'polygons'), function(i) spsample(i,
> n=as.integer((i at area/10000)), type='hexagonal', offset=c(0,0)))  # works
> but creates weird data structure that can't be used in merge below
> 
> 
> 
> polyPts3 = sapply(slot(poly.new, 'polygons'), function(i) spsample(i,
> n=myn[i], type='hexagonal', offset=c(0,0)))  # should work in theory but
> gets S4 index error.
> 
> 
> 
> # we now have a list of SpatialPoints objects, one entry per polygon of
> original data
> 
> # stack into a single SpatialPoints object
> 
> plot(poly.new)
> 
> polyPts.merged <- do.call('rbind', polyPts) # this works when n above is
> constant but not when varied
> 
> polyPts2.merged <- do.call('rbind', polyPts2)  # can't rbind the data. gets
> error about proj4string being null even though poly.new has it set
> 
> polyPts2.merged2 = ldply(polyPts2, rbind) # doesn't work - mixing object
> classes, I think.
> 
> polyPts2.merged3 = ldply(polyPts2, data.frame) # doesn't work either
> because the result should be spatial*dataframes
> 
> 
> 
> length(polyPts.merged)  # check to see if the sample points actually varied
> between the two methods
> 
> length(polyPts.merged2)
> 
> 
> 
> points(polyPts.merged, col='red', pch=3, cex=.25)  # plot results
> 
> points(polyPts.merged2, col='blue', pch=3, cex=.25)
> 
> 
> 
> # add an id, based on source polygon:
> 
> ids <- sapply(slot(poly.new, 'polygons'), function(i) slot(i, 'ID')) #
> extract the original IDs
> 
> # determine the number of ACTUAL sample points generated for each poly
> 
> npts <- sapply(polyPts, function(i) nrow(i at coords))
> 
> # generate a reconstituted vector of point IDs
> 
> pt_id <- rep(ids, npts)
> 
> # promote to SpatialPointsDataFrame
> 
> polyPts.final <- SpatialPointsDataFrame(polyPts.merged,
> data=data.frame(poly_id=pt_id))
> 
> # check:
> 
> plot(poly.new)
> 
> points(polyPts.final, col=polyPts.final$poly_id, pch=3, cex=0.5)
> 
> polyPts.final at proj4string <- poly.new at proj4string  # reassing projection
> 
> 
> 
> # get original attributes
> 
> test = over(polyPts.final, poly.new)
> 
> test2 = cbind(poly.new, test)
> 
> test3 = aggregate(polyPts.final, poly.new)
> 
> test2 = spCbind(polyPts.final,poly.new)
> 
> 
> 
> # another partial approach to recoving attribute data - doesn't work.
> 
> o <- match(polyPts.final$pt_id, poly.new$poly_id)
> 
> xtra1 <- poly.new[o,]
> 
> row.names(xtra1) <- xx$FIPSNO
> 
> xx1 <- spCbind(xx, xtra1)
> 
> names(xx1)
> 
> identical(xx1$CNTY_ID, xx1$CNTY_ID.1)
> 
> _____________________________________________________________________
> 
> 
> 
> 
> 
> Spencer R. Meyer
> Center for Research on Sustainable Forests
> 
> University of Maine
> spencer.meyer at maine.edu 
> 
> [[alternative HTML version deleted]]


From felipe.b4rros at gmail.com  Fri Mar 14 13:45:33 2014
From: felipe.b4rros at gmail.com (Felipe Sodre Barros)
Date: Fri, 14 Mar 2014 09:45:33 -0300
Subject: [R-sig-Geo] Fwd: Conceptual Question about using bivariate second
	order function
In-Reply-To: <CALA-_BVJFsSxTrGs5pSCfqEp9fJNPoUKHXaUHzvoh6jtM-NNow@mail.gmail.com>
References: <CALA-_BVJFsSxTrGs5pSCfqEp9fJNPoUKHXaUHzvoh6jtM-NNow@mail.gmail.com>
Message-ID: <CALA-_BXaajqdKenrix4D5ge22egLF9FYiK8wydj8q+EU=7qcuA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140314/ec58442f/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Fri Mar 14 15:49:37 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 14 Mar 2014 14:49:37 +0000
Subject: [R-sig-Geo] How to shrink a spatial shape ? Or calculate
 distances btw points and a polygon ?
In-Reply-To: <8db32ed495c14483a2030cca0ecf9ba6@EX-0-HT0.lancs.local>
References: <CABW9NAwhj+sVRxtj+31Sut4nCu1QBDbEeAWsL8=_SJkFtCT0pQ@mail.gmail.com>
	<8db32ed495c14483a2030cca0ecf9ba6@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNCuvmb57SAE3sWyAraqmq1NZruiYvPmdO_y3+X4++eBw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140314/bb857925/attachment.pl>

From ruben.vandekerchove at gmail.com  Fri Mar 14 16:10:08 2014
From: ruben.vandekerchove at gmail.com (Ruben Van De Kerchove)
Date: Fri, 14 Mar 2014 16:10:08 +0100
Subject: [R-sig-Geo] custom focal function on rasterstack
Message-ID: <CAO6WGrWsXiyXVZC1sEH=KJFF8Kr0R+W9Jww=pNeBjgNH9ULhsg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140314/d2f4d861/attachment.pl>

From jgrn at illinois.edu  Fri Mar 14 18:38:36 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 14 Mar 2014 12:38:36 -0500
Subject: [R-sig-Geo] custom focal function on rasterstack
In-Reply-To: <CAO6WGrWsXiyXVZC1sEH=KJFF8Kr0R+W9Jww=pNeBjgNH9ULhsg@mail.gmail.com>
References: <CAO6WGrWsXiyXVZC1sEH=KJFF8Kr0R+W9Jww=pNeBjgNH9ULhsg@mail.gmail.com>
Message-ID: <CABG0rfvRGK9jLUtLkGmoicwwQb8Ff+SkOTW_GEwc_7E6+0NeKg@mail.gmail.com>

Ruben:

Give rasterEngine, within the spatial.tools package a whirl.  Here's
the tutorial for it (some things are bit out of date, but this does
cover the focal analyses):

http://publish.illinois.edu/jgrn/software-and-datasets/rasterengine-tutorial/

Note there are examples of focal windows towards the end of the
tutorial.  If you use a parallel engine (e.g. sfQuickInit() ) it will
run your process in parallel -- I've found a significant speedup using
focal windows in parallel mode.

--j

On Fri, Mar 14, 2014 at 10:10 AM, Ruben Van De Kerchove
<ruben.vandekerchove at gmail.com> wrote:
> Hi,
>
> I have rasterstack consisting out of 252 rasters (hyperspectral image) for
> which I want to calculate the mean distance to the centroid in a 3*3(*252)
> moving window. As the focal function (from the raster package) only works
> for rasters, I am currently using the getValuesBlock function (in a loop),
> but this seems rather slow. Therefore, I was wondering, if there is a more
> efficient way to tackle this problem.
>
> Best,
> Ruben
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From milansharma2012 at yahoo.com  Fri Mar 14 19:56:58 2014
From: milansharma2012 at yahoo.com (Milan Sharma)
Date: Fri, 14 Mar 2014 11:56:58 -0700 (PDT)
Subject: [R-sig-Geo] How to shrink a spatial shape ? Or calculate
	distances btw points and a polygon ?
In-Reply-To: <CANVKczNCuvmb57SAE3sWyAraqmq1NZruiYvPmdO_y3+X4++eBw@mail.gmail.com>
References: <CABW9NAwhj+sVRxtj+31Sut4nCu1QBDbEeAWsL8=_SJkFtCT0pQ@mail.gmail.com>	<8db32ed495c14483a2030cca0ecf9ba6@EX-0-HT0.lancs.local>
	<CANVKczNCuvmb57SAE3sWyAraqmq1NZruiYvPmdO_y3+X4++eBw@mail.gmail.com>
Message-ID: <1394823418.80416.YahooMailNeo@web120004.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140314/e484e194/attachment.pl>

From milansharma2012 at yahoo.com  Fri Mar 14 19:56:58 2014
From: milansharma2012 at yahoo.com (Milan Sharma)
Date: Fri, 14 Mar 2014 11:56:58 -0700 (PDT)
Subject: [R-sig-Geo] How to shrink a spatial shape ? Or calculate
	distances btw points and a polygon ?
In-Reply-To: <CANVKczNCuvmb57SAE3sWyAraqmq1NZruiYvPmdO_y3+X4++eBw@mail.gmail.com>
References: <CABW9NAwhj+sVRxtj+31Sut4nCu1QBDbEeAWsL8=_SJkFtCT0pQ@mail.gmail.com>	<8db32ed495c14483a2030cca0ecf9ba6@EX-0-HT0.lancs.local>
	<CANVKczNCuvmb57SAE3sWyAraqmq1NZruiYvPmdO_y3+X4++eBw@mail.gmail.com>
Message-ID: <1394823418.80416.YahooMailNeo@web120004.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140314/e484e194/attachment-0001.pl>

From sylvain.willart at gmail.com  Fri Mar 14 22:35:44 2014
From: sylvain.willart at gmail.com (sylvain willart)
Date: Fri, 14 Mar 2014 22:35:44 +0100
Subject: [R-sig-Geo] How to shrink a spatial shape ? Or calculate
 distances btw points and a polygon ?
In-Reply-To: <CANVKczNCuvmb57SAE3sWyAraqmq1NZruiYvPmdO_y3+X4++eBw@mail.gmail.com>
References: <CABW9NAwhj+sVRxtj+31Sut4nCu1QBDbEeAWsL8=_SJkFtCT0pQ@mail.gmail.com>
	<8db32ed495c14483a2030cca0ecf9ba6@EX-0-HT0.lancs.local>
	<CANVKczNCuvmb57SAE3sWyAraqmq1NZruiYvPmdO_y3+X4++eBw@mail.gmail.com>
Message-ID: <CABW9NAzLZNOfWstA3DFZe7-VE1aaMSq=jUBuRyKTOrt1_bj-eA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140314/bc4abbd7/attachment.pl>

From r.turner at auckland.ac.nz  Fri Mar 14 23:42:28 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Sat, 15 Mar 2014 11:42:28 +1300
Subject: [R-sig-Geo] Fwd: Conceptual Question about using bivariate
 second order function
In-Reply-To: <CALA-_BXaajqdKenrix4D5ge22egLF9FYiK8wydj8q+EU=7qcuA@mail.gmail.com>
References: <CALA-_BVJFsSxTrGs5pSCfqEp9fJNPoUKHXaUHzvoh6jtM-NNow@mail.gmail.com>
	<CALA-_BXaajqdKenrix4D5ge22egLF9FYiK8wydj8q+EU=7qcuA@mail.gmail.com>
Message-ID: <532385D4.3090107@auckland.ac.nz>


On 15/03/14 01:45, Felipe Sodre Barros wrote:

> I have some questions that are more conceptual of the use of k-function,
> than a doubt of how to use it. So, I would like to know if any of you could
> help:
> I want to assess if the fires (mapped as a point) registered during the
> year of 2013 had the tendency of occur next to the occurences of a certain
> species (mapped as a point, too), and so  infer whether the fire is a
> threat or not.
> I've been studying the analysis of point processes and thought that I could
> use the bivarite K-function, but never saw any use of the bivariate
> K-function (or any other second order function) for analysis like this.
>
> So I would like to know if you know any research that already have used a
> second order function for  similar cases? Do you think this use of the
> bivariate second order function for this propose is conceptually
> consistently?
>
> Thanks in advance, and sorry for any english mistakes.

The multitype K function (e.g Kcross() in the spatstat package) will 
provided information about the expected number of points of one type 
within radius "r" of an arbitrary point of another type, for a range of 
values of "r".  This will give some insight as to whether points of type 
"fire" are "attracted to" points of type "species X".

This is probably not a good way of going at the problem however since 
fires and species locations are conceptually very different sorts of 
entity and considering them both to be points of a single pattern, 
distinguished by marks, seems to me to be highly inappropriate.

The way that I would approach the problem is to take the points at which 
the species of interest occur as a "given" and to *MODEL* the intensity 
of the fire pattern using the "species pattern" as a predictor. You 
could form the distance map of the species pattern and use the resulting 
image as a covariate from which to predict the intensity of the fires. 
A first order log-linear model for the intensity could easily be fitted 
using ppm().  There are various ways that non-parametric models could be 
fitted, e.g. using rhohat() or using quadrat counts where the "quadrats" 
are tiles of a tessellation formed in terms of level sets of the 
distance map.

To answer your question about whether any other researchers have used 
the multitype K function to analyse the relationship between points of 
different types:  Yes, I am sure that they have.  That is what the 
multitype K function is for.  See the references given in the help for 
the Kcross() function in spatstat.  Another piece of published research 
that I know of is "Spatial patterns in species-rich sclerophyll 
shrublands of southwestern Australia" by G.L.W. Perry, N.J. Enright, 
B.P. Miller, and B.B. Lamont, Journal of Vegetation Science, Volume 19, 
Issue 5, pages 705?716, October 2008.

However Perry et al. were looking at a pattern consisting of the 
locations of plants of different species, so the points of the marked 
pattern were all of a comparable nature, unlike your situation.

HTH

cheers,

Rolf Turner


From Roger.Bivand at nhh.no  Sat Mar 15 11:00:23 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 15 Mar 2014 11:00:23 +0100
Subject: [R-sig-Geo] Never post using an existing thread (this is also in
 the wrong thread)
In-Reply-To: <1394823418.80416.YahooMailNeo@web120004.mail.ne1.yahoo.com>
References: <CABW9NAwhj+sVRxtj+31Sut4nCu1QBDbEeAWsL8=_SJkFtCT0pQ@mail.gmail.com>
	<8db32ed495c14483a2030cca0ecf9ba6@EX-0-HT0.lancs.local>
	<CANVKczNCuvmb57SAE3sWyAraqmq1NZruiYvPmdO_y3+X4++eBw@mail.gmail.com>
	<1394823418.80416.YahooMailNeo@web120004.mail.ne1.yahoo.com>
Message-ID: <alpine.LRH.2.03.1403151055260.19022@reclus.nhh.no>

On Fri, 14 Mar 2014, Milan Sharma wrote:

Never post using an existing thread on a different topic (here: How to 
shrink a spatial shape? Or calculate distances btw points and a polygon?). 
This messes up the archives, and cannot be understood by those reading 
digested lists of postings, as well as confusing those active in the 
existing discussion thread.

If you want to post to the list, start a new, empty email, and remember 
not to post HTML, only plain text.

>
>
> Hi all,
> I know there are several postings on this problem, but that did not help to solve my problem
> sarlm<-lagsarlm(Agr_2001~Gras_2001+For_2001,data=data1,listw=qw)
> Error in solve.default(inf, tol = tol.solve) :
> system is computationally singular: reciprocal condition number = 4.22828e-37
> How do I solve this issue?
> Milan
>
>
>
> On Friday, March 14, 2014 1:55 PM, Barry Rowlingson <b.rowlingson at lancaster.ac.uk> wrote:
>
> On Fri, Mar 14, 2014 at 12:11 PM, Roman Lu??trik <roman.lustrik at gmail.com>wrote:
>
>> Can you plot a circle (or some other shape) around each store and find the
>> difference between your polygon and the 'store buffer'? Alternatively, you
>> can shrink your entire polygon. See `rgeos` package, say `gBuffer`
>> function.
>>
>
> Yes, you use gBuffer with a negative distance.:
>
>> require(rgeos)
>> p2 = readWKT("POLYGON((2 2,-2 2,-2 -2,2 -2,2 2),(1 1,-1 1,-1 -1,1 -1,1
> 1))")
>> plot(p2)
>> plot(gBuffer(p2,width=-0.2),add=TRUE,col="red")
>
> ?????? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From speedness at foxmail.com  Mon Mar 17 08:11:59 2014
From: speedness at foxmail.com (Archer_xy)
Date: Mon, 17 Mar 2014 00:11:59 -0700 (PDT)
Subject: [R-sig-Geo] how to use the jouncount.test for spatial
	autocorrelation test
Message-ID: <1395040319077-7585965.post@n2.nabble.com>

I want to test a species' presence / absence records for spatial
autocorrelation. My data contain >130,000 grids in GIS and with about 700
species' presence records.


I have read that the normal Moran's I can't deal with this kind of data, but
that the join count method in package spdep can do it. However, I'm new to R
and I still can't understand the information and code in the help for
joincount.mc or joincount.test.


My data is like this:

 gridnumber  species  
     1                 1     
     2                 0
     3                 0
     4                 1
     ??     
 I know how to read a shp.file into R and I know I must calculate the weight
of my data, but the following steps with spdep is beyond my ability.

Any advice in code will be very appreciated.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/how-to-use-the-jouncount-test-for-spatial-autocorrelation-test-tp7585965.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Mon Mar 17 09:50:31 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Mar 2014 09:50:31 +0100
Subject: [R-sig-Geo] how to use the jouncount.test for
 spatial	autocorrelation test
In-Reply-To: <1395040319077-7585965.post@n2.nabble.com>
References: <1395040319077-7585965.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1403170857230.6697@reclus.nhh.no>

On Mon, 17 Mar 2014, Archer_xy wrote:

> I want to test a species' presence / absence records for spatial
> autocorrelation. My data contain >130,000 grids in GIS and with about 700
> species' presence records.

This is not clear at all. See also below for a discussion of whether this 
is a sensible thing to do. If you are going to do it, start with one 
species and one spatial object. Run the example in joincount.test() and 
see how the input objects are structured. In the example, after starting R 
do:

library(spdep)
data(oldcol)
ls()
HICRIME <- cut(COL.OLD$CRIME, breaks=c(0,35,80), labels=c("low","high"))
ls()
# this constructs a factor, a categorical variable
table(HICRIME)
str(HICRIME)

# the list of spatial neighbours is part of the oldcol dataset
print(COL.nb)
class(COL.nb)
joincount.test(HICRIME, nb2listw(COL.nb, style="B"))

# nb2listw converts COL.nb to a binary weights object

You must create the spatial neighbours object for your spatial object. 
Your statement "data contain >130,000 grids in GIS" tells us nothing. 
Having 700 species is not the issue - once you have carried our a 
joincount test for one species, you can do the same for each in turn. If 
you mean that you have a grid with >130K cells (eg. 600*230), then you can 
use for example dnearneigh() to create this object with a suitable 
threshold (below 1.5 with 1x1 cells to create 8 neighbours for each cell 
except on the edges).

library(sp)
GT <- GridTopology(c(0.5, 0.5), c(1, 1), c(600, 230))
SG <- SpatialGrid(GT)
library(spdep)
nb <- dnearneigh(coordinates(SG), 0, 1.5)
# this step takes most time, but the object can be re-used
nb
table(card(nb)) # numbers of neighbours
lwb <- nb2listw(nb, style="B") 
set.seed(140317)
pts <- spsample(SG, n=50000, type="random") # generate random pattern
o <- over(pts, SG)
pa <- rep(0L, prod(slot(GT, "cells.dim")))
pa[o] <- 1L
paf <- factor(pa)
joincount.test(paf, lwb)

is an example, but it should be possible to the raster package focal 
approach too. SG could be read into R using rgdal::readGDAL(), but you 
have problems in ensuring that your tabular species data match the 
ordering of the raster cells - consider creating a SpatialGridDataFrame 
object with multiple species, or a stack or brick also with multiple 
species.

BUT! is this sensible? If your grids are "too small" with respect to the 
scale that applies to one species, you will find strong positive 
autocorrelation resulting simply from the size/resolution of the raster 
cells; if too large, negative autocorrelation. In addition, much of the 
"patchiness" is driven by ecological and environmental factors, to which 
the species respond. Consequently, calculating joincount statistics by 
species may actually tell you nothing at all, perhaps unless you have 
addressed these inhomogeneity issues. If your resolution matches the 
scales for all species and the study area is homogeneous in drivers, the 
results may make sense, but not necessarily otherwise.

>
>
> I have read that the normal Moran's I can't deal with this kind of data, but
> that the join count method in package spdep can do it. However, I'm new to R
> and I still can't understand the information and code in the help for
> joincount.mc or joincount.test.
>
>
> My data is like this:
>
> gridnumber  species
>     1                 1
>     2                 0
>     3                 0
>     4                 1
>     ?? 
> I know how to read a shp.file into R and I know I must calculate the weight
> of my data, but the following steps with spdep is beyond my ability.
>
> Any advice in code will be very appreciated.
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/how-to-use-the-jouncount-test-for-spatial-autocorrelation-test-tp7585965.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From Virgilio.Gomez at uclm.es  Mon Mar 17 17:12:35 2014
From: Virgilio.Gomez at uclm.es (Virgilio Gomez Rubio)
Date: Mon, 17 Mar 2014 17:12:35 +0100
Subject: [R-sig-Geo] One-day course on spatial and spatio-temporal modelling
	with R
Message-ID: <1395072755.2902.15.camel@Virgilio-Gomez>

Dear R users,

Please, see below information about a course on spatial and spatio-temporal 
modelling with R that we are organising in London.

Best wishes,

Virgilio

--

One-day introductory course on spatial and spatio-temporal modelling
with R

Faculty of Medicine
St. Mary's Campus
Imperial College London

9:00-17:00, 16th May 2014


* Course outline:

This one-day introductory course is aimed at researchers that have to
deal with the analysis of spatial and spatio-temporal data. The course
will tackle the problem of analysing spatio-temporal data with the R
programming language. Different types of spatial data will be covered,
such as point patterns, lattice data and data coming from irregular
measurements of continuos processes (geostatistics). In addition,
different worked examples will be presented showing how to proceed with
the analysis of a wide range of spatial data sets.

The topics of the course will contain an introduction to various R
packages for the analysis of spatial and spatio-temporal data data. This
includes data import/export, data management and visualisation, and how
to fit a broad range of models for spatial data. The worked examples
will focus on particular real data sets from Epidemiology, Environmental
Sciences, Ecology, Economics and others.

Although most of the lectures will include live demonstrations of the
software, a working knowledge of the R software is desirable to follow
the examples. R is distributed as free software, and it can be
downloaded from http://cran.r-project.org . Similarly, the course will
introduce the statistical concepts behind the analysis, but a basic
knowledge of statistics and regression analysis will be necessary.

The course will make particular emphasis on Bayesian inference for
spatial and spatio-temporal modelling. Hence, examples based on packages
R-INLA, BayesX and WinBUGS will be included. We will also discuss the
main differences among these and other packages for spatio-temporal
modelling.


*) Instructor:

Dr. Virgilio G?mez-Rubio, Universidad de Castilla-La Mancha


*) Organisers:

Dr. Marta Blangiardo (Imperial College London)
Dr. Virgilio G?mez-Rubio (Universidad de Castilla-La Mancha)


*) Booking and course fees:

Fees for the course are as follows:

- ?60 Students
- ?80 Academics
- ?160 Others (companies, government related agencies, etc.)

Registration for the course can be done on-line at

http://www5.imperial.ac.uk/medicine/coursebookings/rmodelling_0514.html


Updated information can be found here:

http://www.uclm.es/profesorado/vgomez/SSTMR/


From rvaldezr at gmail.com  Mon Mar 17 23:23:51 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Mon, 17 Mar 2014 16:23:51 -0600
Subject: [R-sig-Geo] Dramatically slow plotting
Message-ID: <C6943D80-CFC6-4787-A08C-789B6722AB03@gmail.com>

Hello, 

Recently, I acquired a MacBook Pro, Core i7, 8 GB ram. I Installed the newest R version, 3.0.3 from the web page. The problem is when I?m plotting maps, because is going very, very slow, about 3 or 4 minutes just for a single map, while I?ve done this in a few seconds in Windows with Core i5 and 4 GB ram.

This is what I have:

R version 3.0.3 (2014-03-06) -- "Warm Puppy"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin10.8.0 (64-bit)

[R.app GUI 1.63 (6660) x86_64-apple-darwin10.8.0]

I found a reproducible example in web and I took time with proc.time()

ptm <- proc.time()
library(sp)
library(lattice) # required for trellis.par.set():
trellis.par.set(sp.theme()) # sets color ramp to bpy.colors()

# prepare nc sids data set:
library(maptools)
nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
arrow = list("SpatialPolygonsRescale", layout.north.arrow(),
    offset = c(-76,34), scale = 0.5, which = 2)
#scale = list("SpatialPolygonsRescale", layout.scale.bar(),
#    offset = c(-77.5,34), scale = 1, fill=c("transparent","black"), which = 2)
#text1 = list("sp.text", c(-77.5,34.15), "0", which = 2)
#text2 = list("sp.text", c(-76.5,34.15), "1 degree", which = 2)
## multi-panel plot with filled polygons: North Carolina SIDS
spplot(nc, c("SID74", "SID79"), names.attr = c("1974","1979"),
    colorkey=list(space="bottom"), scales = list(draw = TRUE),
    main = "SIDS (sudden infant death syndrome) in North Carolina",
    sp.layout = list(arrow), as.table = TRUE)

#    sp.layout = list(arrow, scale, text1, text2), as.table = TRUE)
proc.time() - ptm

user  system elapsed 
  2.408   0.064   2.616

It was quick.

Then I did a single plot with my shape:

mapa <- readShapePoly(?Entidades_2013.shp?)
ptm <- proc.time()
spplot(mapa[1]); proc.time() - ptm

user  system elapsed 
 87.575   0.786  88.068

Why it take a lot of time? I worked with same shapes in Windows and never took that time.

Hope you can help me,

Regards,

Rolando Valdez


From alyssonstege at gmail.com  Tue Mar 18 22:54:19 2014
From: alyssonstege at gmail.com (Alysson Luiz Stege)
Date: Tue, 18 Mar 2014 18:54:19 -0300
Subject: [R-sig-Geo] Pseudo R^2 in spatial regressions and test
	Kelejian-Robinson
Message-ID: <CAMKsCCM7Ky1VKzA8JE8W8Z6YNu_-64EhjfyM5=jKuReCJmSzxA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140318/d1b5b5c1/attachment.pl>

From jgrn at illinois.edu  Wed Mar 19 04:14:23 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 18 Mar 2014 22:14:23 -0500
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
Message-ID: <CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ@mail.gmail.com>

R-sig-geo'ers:

I finally got around to building a parallel predict statement that
I've included in version 1.3.7 (or later) of spatial.tools (check
http://r-forge.r-project.org/R/?group_id=1492 for the status of the
build), "predict_rasterEngine".  It should, in theory, be a direct
swap-in for the standard generic predict() statement.  Currently, it
will work on any predict.* statement that has the following features:
1) The data is passed to the predict as a data frame via a newdata
parameter, and
2) The data is returned from the predict statement as a vector/matrix.

When using predict_rasterEngine, the object= parameter is your model,
and the newdata= parameter is the raster/brick/stack to apply the
model to on a pixel-by-pixel basis (note that the names of the layers
must match the names of the predictor variables, in most cases).

I was hoping to get some stress-testing on this, since it is a fairly
oft-requested function.  If a predict.* function you'd like to use
doesn't work, let me know which function it is (with some test data)
and I'll see if I can tweak it to work.

Right now, I have confirmed this works with randomForest.  Here's an example:

######################

packages_required <- c("spatial.tools","doParallel","randomForest")
lapply(packages_required, require, character.only=T)

# Load up a 3-band image:
tahoe_highrez <- setMinMax(
brick(system.file("external/tahoe_highrez.tif", package="spatial.tools")))
tahoe_highrez
plotRGB(tahoe_highrez)

# Load up some training points:
tahoe_highrez_training_points <- readOGR(
dsn=system.file("external", package="spatial.tools"),
layer="tahoe_highrez_training_points")

# Extract data to train the randomForest model:
tahoe_highrez_training_extract <- extract(
tahoe_highrez,
tahoe_highrez_training_points,
df=TRUE)

# Fuse it back with the SPECIES info:
tahoe_highrez_training_extract$SPECIES <- tahoe_highrez_training_points$SPECIES

# Note the names of the bands:
names(tahoe_highrez_training_extract) # the extracted data
names(tahoe_highrez) # the brick

# Generate a randomForest model:
tahoe_rf <- randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
data=tahoe_highrez_training_extract)

tahoe_rf

# This will run the predict in parallel:
sfQuickInit()
prediction_rf_class <-
predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
prediction_rf_prob <-
predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
sfQuickStop()

###############

--j




-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From corey.sparks at UTSA.EDU  Wed Mar 19 12:33:33 2014
From: corey.sparks at UTSA.EDU (Corey Sparks)
Date: Wed, 19 Mar 2014 04:33:33 -0700 (PDT)
Subject: [R-sig-Geo] Pseudo R^2 in spatial regressions and test
	Kelejian-Robinson
In-Reply-To: <CAMKsCCM7Ky1VKzA8JE8W8Z6YNu_-64EhjfyM5=jKuReCJmSzxA@mail.gmail.com>
References: <CAMKsCCM7Ky1VKzA8JE8W8Z6YNu_-64EhjfyM5=jKuReCJmSzxA@mail.gmail.com>
Message-ID: <1395228813085-7585973.post@n2.nabble.com>

The summary() method for the lagsarlm and errorsarlm has a Nagelkerke=T
option for printing the fake R^2



-----
Corey Sparks
Assistant professor
Department of Demography
The University of Texas at San Antonio
501 West Cesar E Chavez Blvd
San Antonio TX 78207
Corey.sparks 'at' utsa.edu
210 458 3166 &lt;tel:210%20458%203166&gt;
Latitude: 29.423614  /  Longitude: -98.504282
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Pseudo-R-2-in-spatial-regressions-and-test-Kelejian-Robinson-tp7585971p7585973.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alyssonstege at gmail.com  Wed Mar 19 14:24:19 2014
From: alyssonstege at gmail.com (alysson stege)
Date: Wed, 19 Mar 2014 06:24:19 -0700 (PDT)
Subject: [R-sig-Geo] Pseudo R^2 in spatial regressions and test
	Kelejian-Robinson
In-Reply-To: <1395228813085-7585973.post@n2.nabble.com>
References: <CAMKsCCM7Ky1VKzA8JE8W8Z6YNu_-64EhjfyM5=jKuReCJmSzxA@mail.gmail.com>
	<1395228813085-7585973.post@n2.nabble.com>
Message-ID: <1395235459665-7585974.post@n2.nabble.com>

Thanks Corey Sparks.
Your reply has helped me much.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Pseudo-R-2-in-spatial-regressions-and-test-Kelejian-Robinson-tp7585971p7585974.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From afischbach at usgs.gov  Wed Mar 19 20:14:21 2014
From: afischbach at usgs.gov (Anthony Fischbach)
Date: Wed, 19 Mar 2014 12:14:21 -0700 (PDT)
Subject: [R-sig-Geo] Opendap in R
In-Reply-To: <1395139650983-7585970.post@n2.nabble.com>
References: <1395139650983-7585970.post@n2.nabble.com>
Message-ID: <1395256461286-7585975.post@n2.nabble.com>

Attached is an example set of code that obtains NARR data using the OpenDAP
interface. NARR_openDAP_dcd_af2.r
<http://r-sig-geo.2731867.n2.nabble.com/file/n7585975/NARR_openDAP_dcd_af2.r>  
hth- 



-----
Tony Fischbach, Wildlife Biologist
Walrus Research Program
Alaska Science Center
U.S. Geological Survey
4210 University Drive
Anchorage, AK 99508-4650

AFischbach at usgs.gov
http://alaska.usgs.gov/science/biology/walrus
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Opendap-in-R-tp7585970p7585975.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From horning at amnh.org  Wed Mar 19 21:35:35 2014
From: horning at amnh.org (Ned Horning)
Date: Wed, 19 Mar 2014 16:35:35 -0400
Subject: [R-sig-Geo] More problems with sampleRandom using and extent
Message-ID: <5329FF97.1010105@amnh.org>

Hi -

I had a problem a while back using sampleRandom with an extent object to 
limit sampling within the extent and I thought it was fixed but now 
there seems to be another problem. When I run "sampleCells <- 
sampleRandom(predImage, size=20, sp=TRUE, ext=commonExt)" I get the 
following warnings and error:
--
Warning messages:
1: In doTryCatch(return(expr), name, parentenv, handler) :
   restarting interrupted promise evaluation
2: restarting interrupted promise evaluation
3: restarting interrupted promise evaluation
Error in xmin(object) :
   error in evaluating the argument 'x' in selecting a method for 
function 'xmin': Error: object 'rr' not found
--

Below is sample code to illustrate the problem. Any idea what the 
problem might be? I'm using raster version 2.2-31 with Ubuntu 12.04.

Thanks in advance for any insight.

Ned
--
library(raster)
crs_predImage <- CRS("+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs
+ellps=WGS84 +towgs84=0,0,0")
predImage <- raster(nrows=7561, ncols=8521, xmn=240585, xmx=496215,
                     ymn=5297985, ymx=5524815)
projection(predImage) <- crs_predImage
predImage[] <- 1

commonExt <- extent(366760.6 , 425233.5, 5396052, 5450158)

sampleCells <- sampleRandom(predImage, size=20, sp=TRUE, ext=commonExt)


From afischbach at usgs.gov  Wed Mar 19 21:43:39 2014
From: afischbach at usgs.gov (Anthony Fischbach)
Date: Wed, 19 Mar 2014 13:43:39 -0700 (PDT)
Subject: [R-sig-Geo] build polygons from ellipses,
 then sample points within the polygons
In-Reply-To: <5320CA70.1000809@auckland.ac.nz>
References: <1394479150872-7585922.post@n2.nabble.com>
	<CF45E696.EF1CF%macqueen1@llnl.gov>
	<1394646920737-7585940.post@n2.nabble.com>
	<5320CA70.1000809@auckland.ac.nz>
Message-ID: <1395261819332-7585978.post@n2.nabble.com>

Thank you Rolf.
Below is how I built it in the end.
I had to take measures to ensure that the ellipse polygon closed back on
itself.
Roger:  Would it be appropriate to include this function in sp or an
associated contributed package.
It seems that building spatialPolygons from ellipse specifications would be
a task required of many sp users.

## modified code from Rolf Turner
require(sp)
require(spatstat)
ellipseSP <- function (x0, y0, a, b, phi=pi/2, npts = 100, ...) {? ##
Returns SpatialPolygons ellipse
											      ## phi defaults to 90 degrees 
                                                                                             
## whereby a lies in the N-S and
                                                                                             
## b in the E-W directions
	theta <- seq(0, 2 * pi, length = npts)??????
	xh <- ?a * cos(theta)? ?????
	yh <- ?b * sin(theta)?  ?????
	co <- cos(phi)? ?????
	si <- sin(phi)? ? ???
	x ?<- x0 + co*xh - si*yh
	x[npts]<-x[1]	## force closure of polygon
	y ?<- x0 + si*xh + co*yh??
	y[npts]<-y[1]	## force closure of polygon
	return(SpatialPolygons(list(Polygons(list(with(list(x = x, y =
y),Polygon(cbind(x,y)))),1)))?)
}?  
## Example plot
eSP <- ellipseSP(x0=0, y0=0, a=8, b=4)? 
plot(eSP)?
##use sp::spsample to randomly select points from within the ellipse 
points(spsample(eSP, n=100, type="random"), col='red', pch=19, cex=.25)  
#



-----
Tony Fischbach, Wildlife Biologist
Walrus Research Program
Alaska Science Center
U.S. Geological Survey
4210 University Drive
Anchorage, AK 99508-4650

AFischbach at usgs.gov
http://alaska.usgs.gov/science/biology/walrus
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/build-polygons-from-ellipses-then-sample-points-within-the-polygons-tp7585922p7585978.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mspinola10 at gmail.com  Wed Mar 19 23:37:06 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 19 Mar 2014 16:37:06 -0600
Subject: [R-sig-Geo] Environmental Risk Surface
Message-ID: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140319/fbe1a9ad/attachment.pl>

From mtreglia at gmail.com  Thu Mar 20 02:08:55 2014
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 19 Mar 2014 20:08:55 -0500
Subject: [R-sig-Geo] Environmental Risk Surface
In-Reply-To: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>
References: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>
Message-ID: <CAPKp32tRvtmRpiit9ZeJKN4_6euBOqsCPysePSwAxzkDkufQ+g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140319/a8ec1544/attachment.pl>

From mspinola10 at gmail.com  Thu Mar 20 03:05:57 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 19 Mar 2014 20:05:57 -0600
Subject: [R-sig-Geo] Environmental Risk Surface
In-Reply-To: <CAPKp32tRvtmRpiit9ZeJKN4_6euBOqsCPysePSwAxzkDkufQ+g@mail.gmail.com>
References: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>
	<CAPKp32tRvtmRpiit9ZeJKN4_6euBOqsCPysePSwAxzkDkufQ+g@mail.gmail.com>
Message-ID: <CABkCotQ6Lt-mczBgm5eyK+sNmpySV+RzexyMzO4JhKd-3OABCw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140319/571986b1/attachment.pl>

From wclaster at apu.ac.jp  Thu Mar 20 03:19:21 2014
From: wclaster at apu.ac.jp (william claster)
Date: Thu, 20 Mar 2014 15:19:21 +1300
Subject: [R-sig-Geo] look for correlation between wind and some other
	quantity
Message-ID: <CAJnbHtJw-1GQi0JBv3jQAYuMbFURsKJsao5a8GWGcCKQiR90wQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140320/020591a5/attachment.pl>

From ruben.vandekerchove at gmail.com  Thu Mar 20 10:18:38 2014
From: ruben.vandekerchove at gmail.com (Ruben Van De Kerchove)
Date: Thu, 20 Mar 2014 10:18:38 +0100
Subject: [R-sig-Geo] custom focal function on rasterstack
In-Reply-To: <CABG0rfvRGK9jLUtLkGmoicwwQb8Ff+SkOTW_GEwc_7E6+0NeKg@mail.gmail.com>
References: <CAO6WGrWsXiyXVZC1sEH=KJFF8Kr0R+W9Jww=pNeBjgNH9ULhsg@mail.gmail.com>
	<CABG0rfvRGK9jLUtLkGmoicwwQb8Ff+SkOTW_GEwc_7E6+0NeKg@mail.gmail.com>
Message-ID: <CAO6WGrU-qDTgbNV6L+4eirgn-unDOeg3cQjHPfA=_wibZOGn5w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140320/30dc2818/attachment.pl>

From mtreglia at gmail.com  Thu Mar 20 16:07:25 2014
From: mtreglia at gmail.com (Michael Treglia)
Date: Thu, 20 Mar 2014 10:07:25 -0500
Subject: [R-sig-Geo] Environmental Risk Surface
In-Reply-To: <CABkCotQ6Lt-mczBgm5eyK+sNmpySV+RzexyMzO4JhKd-3OABCw@mail.gmail.com>
References: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>
	<CAPKp32tRvtmRpiit9ZeJKN4_6euBOqsCPysePSwAxzkDkufQ+g@mail.gmail.com>
	<CABkCotQ6Lt-mczBgm5eyK+sNmpySV+RzexyMzO4JhKd-3OABCw@mail.gmail.com>
Message-ID: <CAPKp32sJ3kZ9vXkx6Vm24qDPBA7Mh7tcyQeh8xsqmK9xWQyzSA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140320/f0c42f9e/attachment.pl>

From macqueen1 at llnl.gov  Thu Mar 20 16:44:34 2014
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Thu, 20 Mar 2014 15:44:34 +0000
Subject: [R-sig-Geo] Dramatically slow plotting
In-Reply-To: <C6943D80-CFC6-4787-A08C-789B6722AB03@gmail.com>
References: <C6943D80-CFC6-4787-A08C-789B6722AB03@gmail.com>
Message-ID: <CF505935.F00A5%macqueen1@llnl.gov>

I'm not sure this will help, but try
   usePolypath=FALSE
in your call to spplot().

For further information, see
  help.search('polypath')
I get:

Help files with alias or concept or title matching 'polypath' using fuzzy
matching:
   graphics::polypath                 Path Drawing
   sp::SpatialPolygons-class          Class "SpatialPolygons"

-Don

-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 3/17/14 3:23 PM, "Rolando Valdez" <rvaldezr at gmail.com> wrote:

>Hello, 
>
>Recently, I acquired a MacBook Pro, Core i7, 8 GB ram. I Installed the
>newest R version, 3.0.3 from the web page. The problem is when I?m
>plotting maps, because is going very, very slow, about 3 or 4 minutes
>just for a single map, while I?ve done this in a few seconds in Windows
>with Core i5 and 4 GB ram.
>
>This is what I have:
>
>R version 3.0.3 (2014-03-06) -- "Warm Puppy"
>Copyright (C) 2014 The R Foundation for Statistical Computing
>Platform: x86_64-apple-darwin10.8.0 (64-bit)
>
>[R.app GUI 1.63 (6660) x86_64-apple-darwin10.8.0]
>
>I found a reproducible example in web and I took time with proc.time()
>
>ptm <- proc.time()
>library(sp)
>library(lattice) # required for trellis.par.set():
>trellis.par.set(sp.theme()) # sets color ramp to bpy.colors()
>
># prepare nc sids data set:
>library(maptools)
>nc <- readShapePoly(system.file("shapes/sids.shp",
>package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>arrow = list("SpatialPolygonsRescale", layout.north.arrow(),
>    offset = c(-76,34), scale = 0.5, which = 2)
>#scale = list("SpatialPolygonsRescale", layout.scale.bar(),
>#    offset = c(-77.5,34), scale = 1, fill=c("transparent","black"),
>which = 2)
>#text1 = list("sp.text", c(-77.5,34.15), "0", which = 2)
>#text2 = list("sp.text", c(-76.5,34.15), "1 degree", which = 2)
>## multi-panel plot with filled polygons: North Carolina SIDS
>spplot(nc, c("SID74", "SID79"), names.attr = c("1974","1979"),
>    colorkey=list(space="bottom"), scales = list(draw = TRUE),
>    main = "SIDS (sudden infant death syndrome) in North Carolina",
>    sp.layout = list(arrow), as.table = TRUE)
>
>#    sp.layout = list(arrow, scale, text1, text2), as.table = TRUE)
>proc.time() - ptm
>
>user  system elapsed
>  2.408   0.064   2.616
>
>It was quick.
>
>Then I did a single plot with my shape:
>
>mapa <- readShapePoly(?Entidades_2013.shp?)
>ptm <- proc.time()
>spplot(mapa[1]); proc.time() - ptm
>
>user  system elapsed
> 87.575   0.786  88.068
>
>Why it take a lot of time? I worked with same shapes in Windows and never
>took that time.
>
>Hope you can help me,
>
>Regards,
>
>Rolando Valdez
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jgrn at illinois.edu  Thu Mar 20 16:51:38 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Thu, 20 Mar 2014 10:51:38 -0500
Subject: [R-sig-Geo] spatial.tools 1.3.8 now on CRAN
Message-ID: <CABG0rftUm4O90mNP5cWDjrio4MBRqRJdwr1xTgexXpj-frjvUA@mail.gmail.com>

Folks:

I've pushed a new version of spatial.tools to CRAN (1.3.8).  In
addition to the requisite bug fixes, there are a few new features and
functions:

rasterEngine/focal_hpc:
- Now can output multiple files (return a list-of-arrays, and
optionally specify the output filenames via e.g. the
filename=c("output1","output2")
- easier function debugging via debugmode=TRUE parameter
- creates both a Raster* header AND an ENVI header to allow for
immediate opening in most GIS programs
- force the calculation of the min/max via setMinMax=TRUE
- No longer requires ellipses in the user function
- processing_unit = "chunk" available for focal windows -- this can
help with vectorized operations, since an entire row can be processed
instead of one window at a time.  I'll expand on this in the next
iteration of the rasterEngine tutorial (forthcoming)
- load required packages for your function via .packages parameter
(previously, it required your function having a library/require
statement within it)
- (experimental) by setting compileFunction=TRUE, your function will
be byte-code compiled.  This can shave some time off the execution in
certain cases.

New functions (all will run in parallel if a cluster is running/registered):
-predict_rasterEngine: a direct swap-in for the generic predict()
statement for easier application of models to rasters/bricks
- raster_to_GLT and raster_to_IGM: create GLT (two-band column/row
values for each pixel) and IGM (two-band, geographic x and y values
for each pixel).  Helpful for e.g. geographic regression.

I'm working on updating the rasterEngine tutorial to reflect the new
features, hopefully in the next few days.

As always, if you have any suggestions/bug reports, please report them
to me!  Cheers!

--j

-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From mspinola10 at gmail.com  Thu Mar 20 17:00:58 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 20 Mar 2014 10:00:58 -0600
Subject: [R-sig-Geo] Environmental Risk Surface
In-Reply-To: <CAPKp32sJ3kZ9vXkx6Vm24qDPBA7Mh7tcyQeh8xsqmK9xWQyzSA@mail.gmail.com>
References: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>
	<CAPKp32tRvtmRpiit9ZeJKN4_6euBOqsCPysePSwAxzkDkufQ+g@mail.gmail.com>
	<CABkCotQ6Lt-mczBgm5eyK+sNmpySV+RzexyMzO4JhKd-3OABCw@mail.gmail.com>
	<CAPKp32sJ3kZ9vXkx6Vm24qDPBA7Mh7tcyQeh8xsqmK9xWQyzSA@mail.gmail.com>
Message-ID: <CABkCotQi1dFY7nPy2VBxKCJti_12zzvTMUtqubkATo6yTG-48Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140320/6a80f133/attachment.pl>

From tech_dev at wildintellect.com  Thu Mar 20 17:35:39 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Thu, 20 Mar 2014 09:35:39 -0700
Subject: [R-sig-Geo] Environmental Risk Surface
In-Reply-To: <CABkCotQi1dFY7nPy2VBxKCJti_12zzvTMUtqubkATo6yTG-48Q@mail.gmail.com>
References: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>	<CAPKp32tRvtmRpiit9ZeJKN4_6euBOqsCPysePSwAxzkDkufQ+g@mail.gmail.com>	<CABkCotQ6Lt-mczBgm5eyK+sNmpySV+RzexyMzO4JhKd-3OABCw@mail.gmail.com>	<CAPKp32sJ3kZ9vXkx6Vm24qDPBA7Mh7tcyQeh8xsqmK9xWQyzSA@mail.gmail.com>
	<CABkCotQi1dFY7nPy2VBxKCJti_12zzvTMUtqubkATo6yTG-48Q@mail.gmail.com>
Message-ID: <532B18DB.9080301@wildintellect.com>

All such tools are algorithms applied in some way via a raster
calculator. So the question is what formula or model of Risk Assessment
do you want to use. It can be a simple calculation based on your layers
and your knowledge of how important they are.

Or you can use many statistical formulas if you wanted. Marxan is just
one particular method of doing such calculations. There is no 1 way to
calculate risk. See http://cran.r-project.org/web/views/Environmetrics.html

Once you have the statistical model you want to apply, you can use
predict to generate values over your area based on your other layers.

The question is not if R can do it, but what do you want R to do.

Thanks,
Alex


On 03/20/2014 09:00 AM, Manuel Sp?nola wrote:
> Thank you very much Mike.
> 
> I have the rasters made with the package ratser, using the function
> rasterize, distance and distance from points.  I know how to model when you
> have presence or presence/absence data, but in this situation I don?t have
> those type of data and I am looking for a way to do a risk assessment in R.
>  I was reading, an apparently Environmental Risk Surface is something that
> could be done with that type of information.  A software like Marxan seems
> to do that type of analysis, but I don?t know the capabilities of R to do
> such type of analysis.
> 
> Best,
> 
> Manuel
> 
> 
> 2014-03-20 9:07 GMT-06:00 Michael Treglia <mtreglia at gmail.com>:
> 
>> Manuel,
>>
>> Please correct me if I misunderstand, but you've got vector layers of
>> Roads, Wetlands, and specific locations, and are need to make Raster layers
>> of how far each pixel would be from these types features, and then combine
>> these distance rasters through some sort of computation to map risk. Right?
>>
>> I don't think there is package that would do this all for you
>> automatically (and there are a lot of decisions you'll probably have to
>> make), but I think the Raster package should have all of the necessary
>> tools - in particular the functions rasterize(), distance() , and the
>> raster algebra functions [though to initially import shapefiles you'll have
>> to use another package, maybe rGDAL]. The documentation for the Raster
>> package is here: http://cran.r-project.org/web/packages/raster/index.html
>>
>> Post-back as you have specific questions on how to execute specific steps,
>> (and look at examples for specific steps in the documentation - the raster
>> package is very well documented).
>>
>> Cheers,
>> Mike
>>
>>
>> On Wed, Mar 19, 2014 at 9:05 PM, Manuel Sp?nola <mspinola10 at gmail.com>wrote:
>>
>>> Thank you Mike,
>>>
>>> I am thinking in overlay several raster layers, mainly distance raster
>>> (distance to roads, to specific locations, to wetlands, etc) to assess the
>>> risk of a disease spread that is not yet in the country but could enter
>>> through migratory birds.
>>>
>>> Best,
>>>
>>> Manuel
>>>
>>>
>>> 2014-03-19 19:08 GMT-06:00 Michael Treglia <mtreglia at gmail.com>:
>>>
>>> Hi Manuel,
>>>>
>>>> There may be multiple types of environmental risk surfaces, based on
>>>> different variables, and using different methods to effectively create
>>>> indices of risk. Can you provide some more detail about what you are trying
>>>> to do? If there is a paper that explains the general methodology, that
>>>> would be helpful? If not, perhaps an explanation of the general workflow
>>>> you are thinking, with the data types (raster/vector) would be helpful.
>>>> Also, are there specific steps for which you need help? (e.g.,
>>>> data-processing, multi-layer raster calculations, etc?)
>>>>
>>>> Cheers,
>>>> Mike
>>>>
>>>>
>>>>
>>>> 2014-03-19 17:37 GMT-05:00 Manuel Sp?nola <mspinola10 at gmail.com>:
>>>>
>>>>> Dear list members,
>>>>>
>>>>> Is there any way to do an Environmental Risk Surface in R?
>>>>>
>>>>> Best,
>>>>>
>>>>> Manuel
>>>>>
>>>>>
>>>>> --
>>>>> *Manuel Sp?nola, Ph.D.*
>>>>>
>>>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>>>> Universidad Nacional
>>>>> Apartado 1350-3000
>>>>> Heredia
>>>>> COSTA RICA
>>>>> mspinola at una.ac.cr
>>>>> mspinola10 at gmail.com
>>>>> Tel?fono: (506) 2277-3598
>>>>> Fax: (506) 2237-7036
>>>>> Personal website: Lobito de r?o <
>>>>> https://sites.google.com/site/lobitoderio/>
>>>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mspinola10 at gmail.com  Thu Mar 20 18:49:02 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 20 Mar 2014 11:49:02 -0600
Subject: [R-sig-Geo] Environmental Risk Surface
In-Reply-To: <532B18DB.9080301@wildintellect.com>
References: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>
	<CAPKp32tRvtmRpiit9ZeJKN4_6euBOqsCPysePSwAxzkDkufQ+g@mail.gmail.com>
	<CABkCotQ6Lt-mczBgm5eyK+sNmpySV+RzexyMzO4JhKd-3OABCw@mail.gmail.com>
	<CAPKp32sJ3kZ9vXkx6Vm24qDPBA7Mh7tcyQeh8xsqmK9xWQyzSA@mail.gmail.com>
	<CABkCotQi1dFY7nPy2VBxKCJti_12zzvTMUtqubkATo6yTG-48Q@mail.gmail.com>
	<532B18DB.9080301@wildintellect.com>
Message-ID: <CABkCotSFspikJg7Vs1zRZBX4BkChCuu1FfUEwarG+L-SCmaT-g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140320/99798eb4/attachment.pl>

From tech_dev at wildintellect.com  Thu Mar 20 19:09:19 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Thu, 20 Mar 2014 11:09:19 -0700
Subject: [R-sig-Geo] Environmental Risk Surface
In-Reply-To: <CABkCotSFspikJg7Vs1zRZBX4BkChCuu1FfUEwarG+L-SCmaT-g@mail.gmail.com>
References: <CABkCotT7vTXjPUBJ3Js=LV27wAnhitQ-v4=4v0hVQyS9VvFTPQ@mail.gmail.com>	<CAPKp32tRvtmRpiit9ZeJKN4_6euBOqsCPysePSwAxzkDkufQ+g@mail.gmail.com>	<CABkCotQ6Lt-mczBgm5eyK+sNmpySV+RzexyMzO4JhKd-3OABCw@mail.gmail.com>	<CAPKp32sJ3kZ9vXkx6Vm24qDPBA7Mh7tcyQeh8xsqmK9xWQyzSA@mail.gmail.com>	<CABkCotQi1dFY7nPy2VBxKCJti_12zzvTMUtqubkATo6yTG-48Q@mail.gmail.com>	<532B18DB.9080301@wildintellect.com>
	<CABkCotSFspikJg7Vs1zRZBX4BkChCuu1FfUEwarG+L-SCmaT-g@mail.gmail.com>
Message-ID: <532B2ECF.6050203@wildintellect.com>

http://cran.r-project.org/web/packages/raster/vignettes/Raster.pdf

See the part about Raster Algebra.

Enjoy,
Alex

On 03/20/2014 10:49 AM, Manuel Sp?nola wrote:
> Thank you very much Alex.
> 
> I want to do simple calculations.
> 
> Best,
> 
> Manuel
> 
> 
> 2014-03-20 10:35 GMT-06:00 Alex Mandel <tech_dev at wildintellect.com>:
> 
>> All such tools are algorithms applied in some way via a raster
>> calculator. So the question is what formula or model of Risk Assessment
>> do you want to use. It can be a simple calculation based on your layers
>> and your knowledge of how important they are.
>>
>> Or you can use many statistical formulas if you wanted. Marxan is just
>> one particular method of doing such calculations. There is no 1 way to
>> calculate risk. See
>> http://cran.r-project.org/web/views/Environmetrics.html
>>
>> Once you have the statistical model you want to apply, you can use
>> predict to generate values over your area based on your other layers.
>>
>> The question is not if R can do it, but what do you want R to do.
>>
>> Thanks,
>> Alex
>>
>>
>> On 03/20/2014 09:00 AM, Manuel Sp?nola wrote:
>>> Thank you very much Mike.
>>>
>>> I have the rasters made with the package ratser, using the function
>>> rasterize, distance and distance from points.  I know how to model when
>> you
>>> have presence or presence/absence data, but in this situation I don?t
>> have
>>> those type of data and I am looking for a way to do a risk assessment in
>> R.
>>>  I was reading, an apparently Environmental Risk Surface is something
>> that
>>> could be done with that type of information.  A software like Marxan
>> seems
>>> to do that type of analysis, but I don?t know the capabilities of R to do
>>> such type of analysis.
>>>
>>> Best,
>>>
>>> Manuel
>>>
>>>
>>> 2014-03-20 9:07 GMT-06:00 Michael Treglia <mtreglia at gmail.com>:
>>>
>>>> Manuel,
>>>>
>>>> Please correct me if I misunderstand, but you've got vector layers of
>>>> Roads, Wetlands, and specific locations, and are need to make Raster
>> layers
>>>> of how far each pixel would be from these types features, and then
>> combine
>>>> these distance rasters through some sort of computation to map risk.
>> Right?
>>>>
>>>> I don't think there is package that would do this all for you
>>>> automatically (and there are a lot of decisions you'll probably have to
>>>> make), but I think the Raster package should have all of the necessary
>>>> tools - in particular the functions rasterize(), distance() , and the
>>>> raster algebra functions [though to initially import shapefiles you'll
>> have
>>>> to use another package, maybe rGDAL]. The documentation for the Raster
>>>> package is here:
>> http://cran.r-project.org/web/packages/raster/index.html
>>>>
>>>> Post-back as you have specific questions on how to execute specific
>> steps,
>>>> (and look at examples for specific steps in the documentation - the
>> raster
>>>> package is very well documented).
>>>>
>>>> Cheers,
>>>> Mike
>>>>
>>>>
>>>> On Wed, Mar 19, 2014 at 9:05 PM, Manuel Sp?nola <mspinola10 at gmail.com
>>> wrote:
>>>>
>>>>> Thank you Mike,
>>>>>
>>>>> I am thinking in overlay several raster layers, mainly distance raster
>>>>> (distance to roads, to specific locations, to wetlands, etc) to assess
>> the
>>>>> risk of a disease spread that is not yet in the country but could enter
>>>>> through migratory birds.
>>>>>
>>>>> Best,
>>>>>
>>>>> Manuel
>>>>>
>>>>>
>>>>> 2014-03-19 19:08 GMT-06:00 Michael Treglia <mtreglia at gmail.com>:
>>>>>
>>>>> Hi Manuel,
>>>>>>
>>>>>> There may be multiple types of environmental risk surfaces, based on
>>>>>> different variables, and using different methods to effectively create
>>>>>> indices of risk. Can you provide some more detail about what you are
>> trying
>>>>>> to do? If there is a paper that explains the general methodology, that
>>>>>> would be helpful? If not, perhaps an explanation of the general
>> workflow
>>>>>> you are thinking, with the data types (raster/vector) would be
>> helpful.
>>>>>> Also, are there specific steps for which you need help? (e.g.,
>>>>>> data-processing, multi-layer raster calculations, etc?)
>>>>>>
>>>>>> Cheers,
>>>>>> Mike
>>>>>>
>>>>>>
>>>>>>
>>>>>> 2014-03-19 17:37 GMT-05:00 Manuel Sp?nola <mspinola10 at gmail.com>:
>>>>>>
>>>>>>> Dear list members,
>>>>>>>
>>>>>>> Is there any way to do an Environmental Risk Surface in R?
>>>>>>>
>>>>>>> Best,
>>>>>>>
>>>>>>> Manuel
>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> *Manuel Sp?nola, Ph.D.*
>>>>>>>
>>>>>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>>>>>> Universidad Nacional
>>>>>>> Apartado 1350-3000
>>>>>>> Heredia
>>>>>>> COSTA RICA
>>>>>>> mspinola at una.ac.cr
>>>>>>> mspinola10 at gmail.com
>>>>>>> Tel?fono: (506) 2277-3598
>>>>>>> Fax: (506) 2237-7036
>>>>>>> Personal website: Lobito de r?o <
>>>>>>> https://sites.google.com/site/lobitoderio/>
>>>>>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>>>>>>
>>>>>>>         [[alternative HTML version deleted]]
>>>>>>>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From smckay at rand.org  Thu Mar 20 21:45:51 2014
From: smckay at rand.org (Mckay, Shawn)
Date: Thu, 20 Mar 2014 20:45:51 +0000
Subject: [R-sig-Geo] preserving size ratios between pies in
	segmentGoogleMaps
Message-ID: <5D0948A37D1C384580C2C715171423C28432E4ED@smmb2.rand.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140320/388fd529/attachment.pl>

From gduveiller at gmail.com  Thu Mar 20 22:52:11 2014
From: gduveiller at gmail.com (Gregory Duveiller)
Date: Thu, 20 Mar 2014 22:52:11 +0100
Subject: [R-sig-Geo]  problem using levelplot() + layer() in a function
Message-ID: <11688937-7187-4762-B4BC-8CAA488F65E4@gmail.com>

Dear All?

I am trying to make figures overlaying raster and vectors using the package rasterVis and with the functions levelplot() + layer(). All works well except when I am trying to embed those lines in a function. When I do so, only the raster images come out, not the overlaid layers. Anyone knows what I need to do? The function I have written looks like this:

 makeFootprint=function(wstr,snr,FootPrint,flt,phi,scl,shf){
    
    elps=scl*ellipse(flt)%*%matrix(c(cos(phi),-sin(phi),sin(phi),cos(phi)),nrow=2)
    elps=elps+c(t(rep(shf[1]+wstr$cellctr$x,100)),t(rep(shf[2]+wstr$cellctr$y,100)))
    lncoords=data.frame(x=elps[,1],y=elps[,2])
    footprint=SpatialLines(list(Lines(list(Line(lncoords)),ID='pix')),snr at crs)
    
    pdf(file=paste(fpath,siteName,'_window',wstr$winID,'_footprint',FootPrint,'.pdf',sep=""),width=4,height=4)
    print(levelplot(wstr$r,col.regions=wstr$clrs,margin=FALSE,main=paste('t = ',FootPrint), colorkey = FALSE, scales=list(draw=FALSE)) +
      layer(sp.lines(wstr$spbox, lwd=2, col='black')) +
      layer(sp.lines(footprint, lwd=2, col='red')))
    dev.off()    
  }

The resulting PDF shows the desired raster background but a text replaces the ?layers?? mentioning ?Error using packet 1 object 'wstr' not found?. But the object in question is there correctly (it is actually a list with data used also to do the levelplot, which is rendered correctly). 

Any ideas?

Is there perhaps a way to include the layers within the levelplot function directly (and avoid ?adding? them?)


sessionInfo()
R version 3.0.2 (2013-09-25)
Platform: x86_64-apple-darwin10.8.0 (64-bit)

locale:
[1] C

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
[1] ellipse_0.3-8       rasterVis_0.27      hexbin_1.26.3      
[4] latticeExtra_0.6-26 lattice_0.20-27     raster_2.2-31      
[7] rgdal_0.8-16        sp_1.0-14           RColorBrewer_1.0-5 

loaded via a namespace (and not attached):
[1] zoo_1.7-11



Thanks 

Gregory 

From rvaldezr at gmail.com  Thu Mar 20 23:22:34 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Thu, 20 Mar 2014 16:22:34 -0600
Subject: [R-sig-Geo] Dramatically slow plotting
In-Reply-To: <em85d2f33e-8df2-48ab-b4ff-526406e7678b@lprc-gis>
References: <em85d2f33e-8df2-48ab-b4ff-526406e7678b@lprc-gis>
Message-ID: <4B310808-1B0C-4ECF-B668-9C9E490CB291@gmail.com>

Hi Ben,

I tried with X11(type=?Xlib?) and I had no changes in time. Then I tried with X11(type=?cairo?) and it reduced considerably the time, however, I got a low quality map.

I think, the Quartz gives a high quality plots, that?s why it takes a lot of time. 

Regards, 

Rolando Valdez

El 18/03/2014, a las 09:26, Ben <galuardi at MIT.EDU> escribi?:

> Hi Rolando,
> 
> I don't use Macs but I do use Linux and have similar issues. I found it that the plotting device type called by default is inordinately slow at plotting spatial objects. Try opening a different type of device and run the example
> 
> X11(type='Xlib')
> X11(type='cairo')
> 
> also, try
> 
> quartz()
> 
> which is mac specific (and possibly called by default)
> 
> help on X11 here:
> https://stat.ethz.ch/R-manual/R-devel/library/grDevices/html/x11.html
> 
> Cheers,
> Ben
> 
> 
> ------ Original Message ------
> From: "Rolando Valdez" <rvaldezr at gmail.com>
> To: r-sig-geo at r-project.org
> Sent: 3/17/2014 6:23:51 PM
> Subject: [R-sig-Geo] Dramatically slow plotting
> 
>> Hello,
>> 
>> Recently, I acquired a MacBook Pro, Core i7, 8 GB ram. I Installed the newest R version, 3.0.3 from the web page. The problem is when I?m plotting maps, because is going very, very slow, about 3 or 4 minutes just for a single map, while I?ve done this in a few seconds in Windows with Core i5 and 4 GB ram.
>> 
>> This is what I have:
>> 
>> R version 3.0.3 (2014-03-06) -- "Warm Puppy"
>> Copyright (C) 2014 The R Foundation for Statistical Computing
>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>> 
>> [R.app GUI 1.63 (6660) x86_64-apple-darwin10.8.0]
>> 
>> I found a reproducible example in web and I took time with proc.time()
>> 
>> ptm <- proc.time()
>> library(sp)
>> library(lattice) # required for trellis.par.set():
>> trellis.par.set(sp.theme()) # sets color ramp to bpy.colors()
>> 
>> # prepare nc sids data set:
>> library(maptools)
>> nc <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>> arrow = list("SpatialPolygonsRescale", layout.north.arrow(),
>>    offset = c(-76,34), scale = 0.5, which = 2)
>> #scale = list("SpatialPolygonsRescale", layout.scale.bar(),
>> # offset = c(-77.5,34), scale = 1, fill=c("transparent","black"), which = 2)
>> #text1 = list("sp.text", c(-77.5,34.15), "0", which = 2)
>> #text2 = list("sp.text", c(-76.5,34.15), "1 degree", which = 2)
>> ## multi-panel plot with filled polygons: North Carolina SIDS
>> spplot(nc, c("SID74", "SID79"), names.attr = c("1974","1979"),
>>    colorkey=list(space="bottom"), scales = list(draw = TRUE),
>>    main = "SIDS (sudden infant death syndrome) in North Carolina",
>>    sp.layout = list(arrow), as.table = TRUE)
>> 
>> # sp.layout = list(arrow, scale, text1, text2), as.table = TRUE)
>> proc.time() - ptm
>> 
>> user system elapsed
>>  2.408 0.064 2.616
>> 
>> It was quick.
>> 
>> Then I did a single plot with my shape:
>> 
>> mapa <- readShapePoly(?Entidades_2013.shp?)
>> ptm <- proc.time()
>> spplot(mapa[1]); proc.time() - ptm
>> 
>> user system elapsed
>> 87.575 0.786 88.068
>> 
>> Why it take a lot of time? I worked with same shapes in Windows and never took that time.
>> 
>> Hope you can help me,
>> 
>> Regards,
>> 
>> Rolando Valdez
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

Rolando Valdez


From rvaldezr at gmail.com  Thu Mar 20 23:32:59 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Thu, 20 Mar 2014 16:32:59 -0600
Subject: [R-sig-Geo] Dramatically slow plotting
In-Reply-To: <CF505935.F00A5%macqueen1@llnl.gov>
References: <C6943D80-CFC6-4787-A08C-789B6722AB03@gmail.com>
	<CF505935.F00A5%macqueen1@llnl.gov>
Message-ID: <1BBBF272-1D89-438D-948B-D00CDA62B5FE@gmail.com>

Hi Don,

It didn?t work, it took a lot of time too. Thanks anyways

Regards,

El 20/03/2014, a las 09:44, MacQueen, Don <macqueen1 at llnl.gov> escribi?:

> I'm not sure this will help, but try
>   usePolypath=FALSE
> in your call to spplot().
> 
> For further information, see
>  help.search('polypath')
> I get:
> 
> Help files with alias or concept or title matching 'polypath' using fuzzy
> matching:
>   graphics::polypath                 Path Drawing
>   sp::SpatialPolygons-class          Class "SpatialPolygons"
> 
> -Don
> 
> -- 
> Don MacQueen
> 
> Lawrence Livermore National Laboratory
> 7000 East Ave., L-627
> Livermore, CA 94550
> 925-423-1062
> 
> 
> 
> 
> 
> On 3/17/14 3:23 PM, "Rolando Valdez" <rvaldezr at gmail.com> wrote:
> 
>> Hello, 
>> 
>> Recently, I acquired a MacBook Pro, Core i7, 8 GB ram. I Installed the
>> newest R version, 3.0.3 from the web page. The problem is when I?m
>> plotting maps, because is going very, very slow, about 3 or 4 minutes
>> just for a single map, while I?ve done this in a few seconds in Windows
>> with Core i5 and 4 GB ram.
>> 
>> This is what I have:
>> 
>> R version 3.0.3 (2014-03-06) -- "Warm Puppy"
>> Copyright (C) 2014 The R Foundation for Statistical Computing
>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>> 
>> [R.app GUI 1.63 (6660) x86_64-apple-darwin10.8.0]
>> 
>> I found a reproducible example in web and I took time with proc.time()
>> 
>> ptm <- proc.time()
>> library(sp)
>> library(lattice) # required for trellis.par.set():
>> trellis.par.set(sp.theme()) # sets color ramp to bpy.colors()
>> 
>> # prepare nc sids data set:
>> library(maptools)
>> nc <- readShapePoly(system.file("shapes/sids.shp",
>> package="maptools")[1], proj4string=CRS("+proj=longlat +datum=NAD27"))
>> arrow = list("SpatialPolygonsRescale", layout.north.arrow(),
>>   offset = c(-76,34), scale = 0.5, which = 2)
>> #scale = list("SpatialPolygonsRescale", layout.scale.bar(),
>> #    offset = c(-77.5,34), scale = 1, fill=c("transparent","black"),
>> which = 2)
>> #text1 = list("sp.text", c(-77.5,34.15), "0", which = 2)
>> #text2 = list("sp.text", c(-76.5,34.15), "1 degree", which = 2)
>> ## multi-panel plot with filled polygons: North Carolina SIDS
>> spplot(nc, c("SID74", "SID79"), names.attr = c("1974","1979"),
>>   colorkey=list(space="bottom"), scales = list(draw = TRUE),
>>   main = "SIDS (sudden infant death syndrome) in North Carolina",
>>   sp.layout = list(arrow), as.table = TRUE)
>> 
>> #    sp.layout = list(arrow, scale, text1, text2), as.table = TRUE)
>> proc.time() - ptm
>> 
>> user  system elapsed
>> 2.408   0.064   2.616
>> 
>> It was quick.
>> 
>> Then I did a single plot with my shape:
>> 
>> mapa <- readShapePoly(?Entidades_2013.shp?)
>> ptm <- proc.time()
>> spplot(mapa[1]); proc.time() - ptm
>> 
>> user  system elapsed
>> 87.575   0.786  88.068
>> 
>> Why it take a lot of time? I worked with same shapes in Windows and never
>> took that time.
>> 
>> Hope you can help me,
>> 
>> Regards,
>> 
>> Rolando Valdez
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Rolando Valdez


From smckay at rand.org  Thu Mar 20 23:56:13 2014
From: smckay at rand.org (Mckay, Shawn)
Date: Thu, 20 Mar 2014 22:56:13 +0000
Subject: [R-sig-Geo] preserving size ratios between pies in
	segmentGoogleMaps
Message-ID: <5D0948A37D1C384580C2C715171423C28432E571@smmb2.rand.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140320/a059fdef/attachment.pl>

From kridox at ymail.com  Fri Mar 21 00:59:12 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Fri, 21 Mar 2014 08:59:12 +0900
Subject: [R-sig-Geo] problem using levelplot() + layer() in a function
In-Reply-To: <11688937-7187-4762-B4BC-8CAA488F65E4@gmail.com>
References: <11688937-7187-4762-B4BC-8CAA488F65E4@gmail.com>
Message-ID: <CAAcyNCzd9FKQvk+++0-AWMMjEUK6xuvHBH5d1NKqP7YnWZ3RQg@mail.gmail.com>

Hello,

You maybe can try this:

Obj <- levelplot(wstr$r,col.regions=wstr$clrs,margin=FALSE,main=paste('t
= ',FootPrint), colorkey = FALSE, scales=list(draw=FALSE)) +
      layer(sp.lines(wstr$spbox, lwd=2, col='black')) +
      layer(sp.lines(footprint, lwd=2, col='red'))
pdf(file=paste(fpath,siteName,'_window',wstr$winID,'_footprint',FootPrint,'.pdf',sep=""),width=4,height=4)
print(Obj)
dev.off()

HTH
Pascal

On Fri, Mar 21, 2014 at 6:52 AM, Gregory Duveiller <gduveiller at gmail.com> wrote:
> Dear All?
>
> I am trying to make figures overlaying raster and vectors using the package rasterVis and with the functions levelplot() + layer(). All works well except when I am trying to embed those lines in a function. When I do so, only the raster images come out, not the overlaid layers. Anyone knows what I need to do? The function I have written looks like this:
>
>  makeFootprint=function(wstr,snr,FootPrint,flt,phi,scl,shf){
>
>     elps=scl*ellipse(flt)%*%matrix(c(cos(phi),-sin(phi),sin(phi),cos(phi)),nrow=2)
>     elps=elps+c(t(rep(shf[1]+wstr$cellctr$x,100)),t(rep(shf[2]+wstr$cellctr$y,100)))
>     lncoords=data.frame(x=elps[,1],y=elps[,2])
>     footprint=SpatialLines(list(Lines(list(Line(lncoords)),ID='pix')),snr at crs)
>
>     pdf(file=paste(fpath,siteName,'_window',wstr$winID,'_footprint',FootPrint,'.pdf',sep=""),width=4,height=4)
>     print(levelplot(wstr$r,col.regions=wstr$clrs,margin=FALSE,main=paste('t = ',FootPrint), colorkey = FALSE, scales=list(draw=FALSE)) +
>       layer(sp.lines(wstr$spbox, lwd=2, col='black')) +
>       layer(sp.lines(footprint, lwd=2, col='red')))
>     dev.off()
>   }
>
> The resulting PDF shows the desired raster background but a text replaces the ?layers?? mentioning ?Error using packet 1 object 'wstr' not found?. But the object in question is there correctly (it is actually a list with data used also to do the levelplot, which is rendered correctly).
>
> Any ideas?
>
> Is there perhaps a way to include the layers within the levelplot function directly (and avoid ?adding? them?)
>
>
> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>
> locale:
> [1] C
>
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] ellipse_0.3-8       rasterVis_0.27      hexbin_1.26.3
> [4] latticeExtra_0.6-26 lattice_0.20-27     raster_2.2-31
> [7] rgdal_0.8-16        sp_1.0-14           RColorBrewer_1.0-5
>
> loaded via a namespace (and not attached):
> [1] zoo_1.7-11
>
>
>
> Thanks
>
> Gregory
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From andreasft at gmail.com  Fri Mar 21 09:44:37 2014
From: andreasft at gmail.com (=?ISO-8859-1?Q?Andreas_For=F8_Tollefsen?=)
Date: Fri, 21 Mar 2014 09:44:37 +0100
Subject: [R-sig-Geo] NAs not permitted in row index
Message-ID: <CAGMz7Dny7Ni6p558fHEB8F37eVL_JNb0DB5gJF2f7TQ3kUubfA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140321/ae006e75/attachment.pl>

From ben.graeler at uni-muenster.de  Fri Mar 21 10:14:34 2014
From: ben.graeler at uni-muenster.de (=?ISO-8859-1?Q?Benedikt_Gr=E4ler?=)
Date: Fri, 21 Mar 2014 10:14:34 +0100
Subject: [R-sig-Geo] NAs not permitted in row index
In-Reply-To: <CAGMz7Dny7Ni6p558fHEB8F37eVL_JNb0DB5gJF2f7TQ3kUubfA@mail.gmail.com>
References: <CAGMz7Dny7Ni6p558fHEB8F37eVL_JNb0DB5gJF2f7TQ3kUubfA@mail.gmail.com>
Message-ID: <532C02FA.3070700@uni-muenster.de>

Dear Andreas,

I would presume that your variable "gwno" contains NAs and the simple
comparison by "pgcell1$gwno==385" returns a vector of TRUE, FALSE and NA
(See the example below.). Most likely you want to drop these "empty"
locations by setting the NAs in the boolean vector as well to FALSE.

HTH,

 Ben

library(sp)
data(meuse)

coordinates(meuse) <- ~x+y
# still works
meuse[meuse$ffreq == 2,]

# set some values to NA
meuse[meuse$ffreq == 3,] <- NA

# This does not work any more
meuse[meuse$ffreq == 2,]

# But subset still does the job
subset(meuse, ffreq == 2)

# This now has many NAs ("incomparables")
meuse$ffreq == 2


On 21.03.2014 09:44, Andreas For? Tollefsen wrote:
> Dear list,
> 
> I seem to have a problem with subsetting a SpatialPolygonsDataFrame. If I
> remember correctly, I have subsetted the spdf before using the first
> syntax. However, this does not seem to work.
> Any idea why?
> 
> 
>> pgtest <- pgcell1[pgcell1$gwno==385,]
> Error in pgcell1[pgcell1$gwno == 385, ] : NAs not permitted in row index
>> pgtest <- subset(pgcell1, gwno==385)
> This works.
> 
> Thanks!
> 
> Andreas
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Benedikt Gr?ler

ifgi - Institute for Geoinformatics
University of Muenster

http://ifgi.uni-muenster.de/graeler

Phone: +49 251 83-33082
Mail: ben.graeler at uni-muenster.de

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 560 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140321/bf705a22/attachment.bin>

From oscar.perpinan at upm.es  Fri Mar 21 12:45:22 2014
From: oscar.perpinan at upm.es (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Fri, 21 Mar 2014 12:45:22 +0100
Subject: [R-sig-Geo] problem using levelplot() + layer() in a function
In-Reply-To: <11688937-7187-4762-B4BC-8CAA488F65E4@gmail.com>
References: <11688937-7187-4762-B4BC-8CAA488F65E4@gmail.com>
Message-ID: <CAMLL7bn2ouOQ-vi4+17B=gew9ueL9YN4sf=WaEXtMWw1mvo-VQ@mail.gmail.com>

Hello,


The key point is that "the evaluation used in 'layer' is non-standard,
and can be confusing at first: you typically refer to variables as if
inside the panel function ('x', 'y', etc); you can usually refer to
objects which exist in the global environment (workspace), but it is
safer to pass them in by name in the 'data' argument to 'layer'. (And
this should not to be confused with the 'data' argument to the
original 'xyplot'.)"

Try these three examples:

library(rasterVis)

r <- raster()
r <- init(r, runif)

foo1 <- function(r){
    rBox <- as(extent(r), 'SpatialPolygons')
    levelplot(r) +
        layer(sp.polygons(rBox, fill='black', alpha=0.2),
              data=list(rBox=rBox))
    }

foo2 <- function(r){
    levelplot(r) +
        layer({
            rBox <- as(extent(r), 'SpatialPolygons')
            sp.polygons(rBox, fill='black', alpha=0.2)
        })
}

foo3 <- function(r){
    rBox <- as(extent(r), 'SpatialPolygons')
    levelplot(r, panel=function(...){
        panel.levelplot.raster(...)
        sp.polygons(rBox, fill='black', alpha=0.2)
    })
    }


This same problem was the subject of a recent discussion in this post:
http://procomun.wordpress.com/2013/04/24/stamen-maps-with-spplot/comment-page-1/#comment-881.
There are more examples of using layer inside a function in this gist:
https://gist.github.com/oscarperpinan/7482848

Best,

Oscar.
-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


2014-03-20 22:52 GMT+01:00 Gregory Duveiller <gduveiller at gmail.com>:
> Dear All...
>
> I am trying to make figures overlaying raster and vectors using the package rasterVis and with the functions levelplot() + layer(). All works well except when I am trying to embed those lines in a function. When I do so, only the raster images come out, not the overlaid layers. Anyone knows what I need to do? The function I have written looks like this:
>
>  makeFootprint=function(wstr,snr,FootPrint,flt,phi,scl,shf){
>
>     elps=scl*ellipse(flt)%*%matrix(c(cos(phi),-sin(phi),sin(phi),cos(phi)),nrow=2)
>     elps=elps+c(t(rep(shf[1]+wstr$cellctr$x,100)),t(rep(shf[2]+wstr$cellctr$y,100)))
>     lncoords=data.frame(x=elps[,1],y=elps[,2])
>     footprint=SpatialLines(list(Lines(list(Line(lncoords)),ID='pix')),snr at crs)
>
>     pdf(file=paste(fpath,siteName,'_window',wstr$winID,'_footprint',FootPrint,'.pdf',sep=""),width=4,height=4)
>     print(levelplot(wstr$r,col.regions=wstr$clrs,margin=FALSE,main=paste('t = ',FootPrint), colorkey = FALSE, scales=list(draw=FALSE)) +
>       layer(sp.lines(wstr$spbox, lwd=2, col='black')) +
>       layer(sp.lines(footprint, lwd=2, col='red')))
>     dev.off()
>   }
>
> The resulting PDF shows the desired raster background but a text replaces the 'layers'... mentioning "Error using packet 1 object 'wstr' not found". But the object in question is there correctly (it is actually a list with data used also to do the levelplot, which is rendered correctly).
>
> Any ideas?
>
> Is there perhaps a way to include the layers within the levelplot function directly (and avoid 'adding' them?)
>
>
> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>
> locale:
> [1] C
>
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] ellipse_0.3-8       rasterVis_0.27      hexbin_1.26.3
> [4] latticeExtra_0.6-26 lattice_0.20-27     raster_2.2-31
> [7] rgdal_0.8-16        sp_1.0-14           RColorBrewer_1.0-5
>
> loaded via a namespace (and not attached):
> [1] zoo_1.7-11
>
>
>
> Thanks
>
> Gregory
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jacobvanetten at yahoo.com  Fri Mar 21 13:24:54 2014
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Fri, 21 Mar 2014 12:24:54 +0000 (GMT)
Subject: [R-sig-Geo] Passage function error in gdistance
In-Reply-To: <4812d81553b14e94ac1dfa5c6c458021@SIXPR06MB319.apcprd06.prod.outlook.com>
References: <4812d81553b14e94ac1dfa5c6c458021@SIXPR06MB319.apcprd06.prod.outlook.com>
Message-ID: <1395404694.67470.YahooMailNeo@web133204.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140321/98977507/attachment.pl>

From andreasft at gmail.com  Fri Mar 21 13:57:59 2014
From: andreasft at gmail.com (=?ISO-8859-1?Q?Andreas_For=F8_Tollefsen?=)
Date: Fri, 21 Mar 2014 13:57:59 +0100
Subject: [R-sig-Geo] NAs not permitted in row index
In-Reply-To: <532C02FA.3070700@uni-muenster.de>
References: <CAGMz7Dny7Ni6p558fHEB8F37eVL_JNb0DB5gJF2f7TQ3kUubfA@mail.gmail.com>
	<532C02FA.3070700@uni-muenster.de>
Message-ID: <CAGMz7DnyYcAj-e7XZkATko+O5Hvzce+5G6=QpCbaAnaMKh1XfQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140321/d67d2b74/attachment.pl>

From robinsleith at gmail.com  Fri Mar 21 14:30:18 2014
From: robinsleith at gmail.com (Robin Sleith)
Date: Fri, 21 Mar 2014 09:30:18 -0400
Subject: [R-sig-Geo] Selecting Random Polygons
Message-ID: <CAHG9Mf31BQ9YbM-v7vGcN7_X60D8-1Uddw7ERngxt+MNG5L-sQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140321/5456c038/attachment.pl>

From bernd.vogelgesang at gmx.de  Fri Mar 21 15:25:55 2014
From: bernd.vogelgesang at gmx.de (Bernd Vogelgesang)
Date: Fri, 21 Mar 2014 15:25:55 +0100
Subject: [R-sig-Geo] Growing a raster and sum up values
Message-ID: <op.xc2s1hpfl2i25i@bernd-terra-pc>

Dear list,

I'm searching for a solution with R that should replace a now very  
tiresome vector based process in QGIS.
For better understanding, I uploaded a screen-shot:
http://gofile.me/29yAV/7YDnipt9

The situation:
There is a piece of land which will serve as an ecological compensation  
area for building activities in other places.
The area got surveyed and was divided in zones of different ecological  
value, which is described by a credit/m2-system.

In the example, you can see the bigger parts having 25 credits/m2, others  
have 17.
The northern patch is an area with a total of 41200. The investor is  
obliged to compensate an activity somewhere which will cause the loss of  
this amount of credits.

To extract the patch of 41200 credits, I made an overlay with a vector  
grid, then marked some grid cells and used the statist-plugin in QGIS to  
calculate the sum of credits for the selected grid cells. I added and  
removed parts until I approximately got the desired value and then  
exported the selection as a new shape file.

This approach takes a very long time and is very error-prone, plus that I  
have to repair topologies all the time with grass cause there are always  
errors. In the mean-time, the desired values changed, so I have to redo it  
again ...

My idea now was to make things easier by rasterizing the vector and  
finding an algorithm that will grow my patch from a seeding point until it  
reaches the desired credits value.

But ... I have no idea where and how to start.

So my first question would be:
How I can create a one-pixel-raster (by a point coordinate) at a certain  
location above the existing raster, and then let it add pixels to all  
sides (e.g. clockwise) while the underlying raster values get summed up  
until it reaches the desired sum value?

It should not grow outside the underlying raster.

After that, I will try to find out how to implement further logics:
- Respect already created patches (not grow new patch over already  
existent ones).
- Setting a preferred growing direction (left, right , up, down etc.)


I do not expect a working example, just some hints for possible packages  
and buzzwords for further googling. I'm also equipped with Rogers book  
(Though I haven't read it yet ;) ).

Cheers
Bernd


-- 
Bernd Vogelgesang
Siedlerstra?e 2
91083 Baiersdorf/Igelsdorf
Tel: 09133-825374


From edzer.pebesma at uni-muenster.de  Fri Mar 21 16:12:02 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 21 Mar 2014 16:12:02 +0100
Subject: [R-sig-Geo] Selecting Random Polygons
In-Reply-To: <CAHG9Mf31BQ9YbM-v7vGcN7_X60D8-1Uddw7ERngxt+MNG5L-sQ@mail.gmail.com>
References: <CAHG9Mf31BQ9YbM-v7vGcN7_X60D8-1Uddw7ERngxt+MNG5L-sQ@mail.gmail.com>
Message-ID: <532C56C2.2010606@uni-muenster.de>

require(sp)
# select 20 random polygons:
nysample = nylakes[sample(4466,20),]
plot(nysample)
# sample a single random point inside each polygon:
pts = do.call(rbind,
  lapply(nysample at polygons, spsample, n=1, type="random"))
plot(p, add=TRUE, col='red')

hth,

On 03/21/2014 02:30 PM, Robin Sleith wrote:
> Hello,
> I have a set of spatial polygons (nylakes) and I would like to randomly
> select a number of polygons from nylakes. I do not need an output file of
> polygons necessarily, just a set of points would do. I have tried spsample,
> but it places multiple points per polygon, even when stratified is
> selected. Any thoughts? Info below.
> 
> Thank you
> Robin
> 
>> nylakes
> class       : SpatialPolygons
> features    : 4466
> extent      : -80, -71.88637, 40.29375, 45.48771  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> 
> twenty <- spsample(nylakes, 20, type='random')
> twenty <- spsample(nylakes, 20, type='stratified')
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140321/697eefce/attachment.bin>

From azvoleff at conservation.org  Fri Mar 21 17:12:16 2014
From: azvoleff at conservation.org (Alex Zvoleff)
Date: Fri, 21 Mar 2014 12:12:16 -0400
Subject: [R-sig-Geo] Supplying a datatype argument to rasterEngine in
	spatial.tools
Message-ID: <CACwzsXELCfVVop2o59Vjkqj1cak-fcM-=rzEY=JuBSF0aWxTsQ@mail.gmail.com>

Thanks Jonathan for the updated version of spatial.tools - very useful
in my work. Is there way to pass a "datatype" argument (as for
writeRaster) to rasterEngine to specify the output datatype? I see
"dataType" linked under "See Also" in the help, but it is not
otherwise mentioned. I have tried adding it as an argument to
rasterEngine anyway, but it appears to be ignored. I am running
spatial.tools 1.3.8 on R 3.0.3.

Thanks,
Alex

-- 
Alex Zvoleff
Postdoctoral Associate
Tropical Ecology Assessment and Monitoring (TEAM) Network
Conservation International
2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
http://www.teamnetwork.org | http://www.conservation.org


From gduveiller at gmail.com  Fri Mar 21 17:22:20 2014
From: gduveiller at gmail.com (Gregory Duveiller)
Date: Fri, 21 Mar 2014 17:22:20 +0100
Subject: [R-sig-Geo] problem using levelplot() + layer() in a function
In-Reply-To: <CAMLL7bn2ouOQ-vi4+17B=gew9ueL9YN4sf=WaEXtMWw1mvo-VQ@mail.gmail.com>
References: <11688937-7187-4762-B4BC-8CAA488F65E4@gmail.com>
	<CAMLL7bn2ouOQ-vi4+17B=gew9ueL9YN4sf=WaEXtMWw1mvo-VQ@mail.gmail.com>
Message-ID: <CAHntiskFmPKGaoJQXBi-QmRTe45Te5p+mzF_9gJ0Z3H-cyQNng@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140321/8c8b2cc0/attachment.pl>

From jgrn at illinois.edu  Fri Mar 21 17:56:02 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 21 Mar 2014 11:56:02 -0500
Subject: [R-sig-Geo] Supplying a datatype argument to rasterEngine in
	spatial.tools
In-Reply-To: <CACwzsXELCfVVop2o59Vjkqj1cak-fcM-=rzEY=JuBSF0aWxTsQ@mail.gmail.com>
References: <CACwzsXELCfVVop2o59Vjkqj1cak-fcM-=rzEY=JuBSF0aWxTsQ@mail.gmail.com>
Message-ID: <CABG0rfvpUkawqrAoBcMLVAYHE=V4pYD2Cb+xbrtsP=emeWs6-A@mail.gmail.com>

Alex:

I am assuming you are talking about outputting something other than a
floating point raster?  It is high on my list of to-dos.  I also want
to make sure I support factors datatypes as well, since the Raster*
format supports them.  I've already started on the basic tweaks I need
to make, but it'll be a bit longer before I get to it. Stay tuned!

--j

On Fri, Mar 21, 2014 at 11:12 AM, Alex Zvoleff
<azvoleff at conservation.org> wrote:
> Thanks Jonathan for the updated version of spatial.tools - very useful
> in my work. Is there way to pass a "datatype" argument (as for
> writeRaster) to rasterEngine to specify the output datatype? I see
> "dataType" linked under "See Also" in the help, but it is not
> otherwise mentioned. I have tried adding it as an argument to
> rasterEngine anyway, but it appears to be ignored. I am running
> spatial.tools 1.3.8 on R 3.0.3.
>
> Thanks,
> Alex
>
> --
> Alex Zvoleff
> Postdoctoral Associate
> Tropical Ecology Assessment and Monitoring (TEAM) Network
> Conservation International
> 2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
> Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
> http://www.teamnetwork.org | http://www.conservation.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From oscar.perpinan at upm.es  Fri Mar 21 19:23:13 2014
From: oscar.perpinan at upm.es (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Fri, 21 Mar 2014 19:23:13 +0100
Subject: [R-sig-Geo] problem using levelplot() + layer() in a function
In-Reply-To: <CAHntiskFmPKGaoJQXBi-QmRTe45Te5p+mzF_9gJ0Z3H-cyQNng@mail.gmail.com>
References: <11688937-7187-4762-B4BC-8CAA488F65E4@gmail.com>
	<CAMLL7bn2ouOQ-vi4+17B=gew9ueL9YN4sf=WaEXtMWw1mvo-VQ@mail.gmail.com>
	<CAHntiskFmPKGaoJQXBi-QmRTe45Te5p+mzF_9gJ0Z3H-cyQNng@mail.gmail.com>
Message-ID: <CAMLL7bnFD1R_RDUExp=sRwC3RnpDCKXMeknrSiJ_s=Ro0dv=YQ@mail.gmail.com>

> The idea of Pascal I had tried already and it doesn't work. At the end, I
> had found out a way out using this:
>
>     print(levelplot(wstr$r,col.regions=wstr$clrs,margin=FALSE,main=paste('t
> = ',FootPrint), colorkey = T, scales=list(draw=FALSE),
>               panel=function(...){
>                 panel.levelplot(...)
>                 panel.polygon(wstr$spbox,lwd=2)
>                 panel.polygon(lncoords,lwd=2, border='red')}))
> Oscar: I suppose this is your third function you had proposed...

Yes, exactly.

> the others still do not seem to work... I must admit it is not too clear to me why,
> but at least the last one works...

Could you please post the code you are using? All of them should work.

Best,

Oscar.


From azvoleff at conservation.org  Fri Mar 21 19:24:09 2014
From: azvoleff at conservation.org (Alex Zvoleff)
Date: Fri, 21 Mar 2014 14:24:09 -0400
Subject: [R-sig-Geo] Supplying a datatype argument to rasterEngine in
	spatial.tools
In-Reply-To: <CABG0rfvpUkawqrAoBcMLVAYHE=V4pYD2Cb+xbrtsP=emeWs6-A@mail.gmail.com>
References: <CACwzsXELCfVVop2o59Vjkqj1cak-fcM-=rzEY=JuBSF0aWxTsQ@mail.gmail.com>
	<CABG0rfvpUkawqrAoBcMLVAYHE=V4pYD2Cb+xbrtsP=emeWs6-A@mail.gmail.com>
Message-ID: <CACwzsXHtyTToDr=J6sZ=RJ_B9YwdjdWx8cJn3XdzTOtu6iQWog@mail.gmail.com>

On Fri, Mar 21, 2014 at 12:56 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
> I am assuming you are talking about outputting something other than a
> floating point raster?

Yes, I have a series of fairly large 8 bit unsigned integer rasters to
process, that start to get unmanageable when stored as 64 bit floats.

> It is high on my list of to-dos.  I also want
> to make sure I support factors datatypes as well, since the Raster*
> format supports them.  I've already started on the basic tweaks I need
> to make, but it'll be a bit longer before I get to it. Stay tuned!

Excellent! And thanks again.

> --j
>
> On Fri, Mar 21, 2014 at 11:12 AM, Alex Zvoleff
> <azvoleff at conservation.org> wrote:
>> Thanks Jonathan for the updated version of spatial.tools - very useful
>> in my work. Is there way to pass a "datatype" argument (as for
>> writeRaster) to rasterEngine to specify the output datatype? I see
>> "dataType" linked under "See Also" in the help, but it is not
>> otherwise mentioned. I have tried adding it as an argument to
>> rasterEngine anyway, but it appears to be ignored. I am running
>> spatial.tools 1.3.8 on R 3.0.3.
>>
>> Thanks,
>> Alex
>>
>> --
>> Alex Zvoleff
>> Postdoctoral Associate
>> Tropical Ecology Assessment and Monitoring (TEAM) Network
>> Conservation International
>> 2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
>> Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
>> http://www.teamnetwork.org | http://www.conservation.org
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Alex Zvoleff
Postdoctoral Associate
Tropical Ecology Assessment and Monitoring (TEAM) Network
Conservation International
2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
http://www.teamnetwork.org | http://www.conservation.org


From mguycooper at gmail.com  Sun Mar 23 05:06:14 2014
From: mguycooper at gmail.com (Matthew Cooper)
Date: Sat, 22 Mar 2014 21:06:14 -0700
Subject: [R-sig-Geo] re-projecting raster brick, output has no values
Message-ID: <CANmmKZJqPqFG2fWCO=hN15zKpkDd1gzH=sQLkRNUzRADm0_aNg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140322/ada38714/attachment.pl>

From r.hijmans at gmail.com  Sun Mar 23 06:31:08 2014
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 22 Mar 2014 22:31:08 -0700
Subject: [R-sig-Geo] re-projecting raster brick, output has no values
In-Reply-To: <CANmmKZJqPqFG2fWCO=hN15zKpkDd1gzH=sQLkRNUzRADm0_aNg@mail.gmail.com>
References: <CANmmKZJqPqFG2fWCO=hN15zKpkDd1gzH=sQLkRNUzRADm0_aNg@mail.gmail.com>
Message-ID: <CANtt_hykLN-8XQB1n0Rkkpoa=7KOBSmWTJJ=5eWshEgfEWXX3A@mail.gmail.com>

Matt,

The x (longitude) coordinates are not valid for lat/lon. It looks like
they are using 0 to 360 instead of -180 to 180 ---- which is what
climate modelers do. For global datasets you can use 'rotate' to fix
this, but that function does not (yet) work for smaller extents. In
this case you can fix the problem with the shift function, as in the
example below that puts the raster in Oregon (which I am assuming is
where it should be).

library(raster)
r <- raster(nrow=121, ncol=121, xmn=237.9958, xmx=239.0041,
ymn=43.99583, ymx=45.00413)
values(r) <- 1:ncell(r)
x <- shift(r, -360)

utmproj <- "+proj=utm +zone=10 +ellps=GRS80 +units=m +no_defs"
p <- projectRaster(x, res=800, crs=utmproj, method="bilinear")
p

Robert



On Sat, Mar 22, 2014 at 9:06 PM, Matthew Cooper <mguycooper at gmail.com> wrote:
> Hi all,
>
> I have created a raster brick and the data is in lat/long coordinate
> system. I would like to re-project the brick to UTM and then save the data.
> The output of my code gives me NA and -Inf for the values of the
> re-projected raster brick:
>
> install.packages("rgdal")
> install.packages("raster")
> install.packages("sp")
> library(rgdal)
> library(raster)
> library(sp)
>
> f <- "K:/PRISM_US800m_2010edition/ppt_east_prism.nc"
> b <- brick(f,lvar=4)
> NAvalue(b) <- -1e+34
>
> b
>
> class       : RasterBrick
> dimensions  : 121, 121, 14641, 348  (nrow, ncol, ncell, nlayers)
> resolution  : 0.008333, 0.008333  (x, y)
> extent      : 237.9958, 239.0041, 43.99583, 45.00413  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
> data source : K:\PRISM_US800m_2010edition\ppt_east_prism.nc
> names       : X1981.04162597656, X1981.125, X1981.20837402344,
> X1981.29174804688, X1981.375, X1981.45837402344, X1981.54174804688,
> X1981.625, X1981.70837402344, X1981.79174804688, X1981.875,
> X1981.95837402344, X1982.04174804688, X1982.125, X1982.20837402344, ...
> year        : 1981.04162597656, 2009.95837402344 (min, max)
> varname     : PPT_EAST
>
> utmproj <- "+proj=utm +zone=10 +ellps=GRS80 +units=m +no_defs"
> bnew <-
> projectRaster(b,res=800,crs=utmproj,method="bilinear",alignOnly=FALSE,over=FALSE)
>
>  bnew
> class       : RasterBrick
> dimensions  : 152, 113, 17176, 348  (nrow, ncol, ncell, nlayers)
> resolution  : 800, 800  (x, y)
> extent      : 574481.3, 664881.3, 4867763, 4989363  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=utm +zone=10 +ellps=GRS80 +units=m +no_defs
> data source : in memory
> names       : X1981.04162597656, X1981.125, X1981.20837402344,
> X1981.29174804688, X1981.375, X1981.45837402344, X1981.54174804688,
> X1981.625, X1981.70837402344, X1981.79174804688, X1981.875,
> X1981.95837402344, X1982.04174804688, X1982.125, X1982.20837402344, ...
> min values  :                NA,        NA,                NA,
>    NA,        NA,                NA,                NA,        NA,
>        NA,                NA,        NA,                NA,
>  NA,        NA,                NA, ...
> max values  :                 ?,         ?,                 ?,
>     ?,         ?,                 ?,                 ?,         ?,
>         ?,                 ?,         ?,                 ?,
> ?,         ?,                 ?, ...
>
> Any ideas? Thank you.
>
> Matt
>
> --
> *Matt Cooper*
> Water Resources Graduate Program
> College of Earth, Ocean and Atmospheric Sciences
> Oregon State University
>
> (831) 566 9149
> matthew.cooper at geo.oregonstate.edu
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mspinola10 at gmail.com  Sun Mar 23 18:40:41 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 23 Mar 2014 11:40:41 -0600
Subject: [R-sig-Geo] How to rescale a raster in R?
Message-ID: <CABkCotQoHnouPqF17SovERCvfDdpndvH8KJU9zjxwup4d2wrPg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140323/9ac66682/attachment.pl>

From mguycooper at gmail.com  Sun Mar 23 19:23:05 2014
From: mguycooper at gmail.com (Matthew Cooper)
Date: Sun, 23 Mar 2014 11:23:05 -0700
Subject: [R-sig-Geo] re-projecting raster brick, output has no values
In-Reply-To: <CANtt_hykLN-8XQB1n0Rkkpoa=7KOBSmWTJJ=5eWshEgfEWXX3A@mail.gmail.com>
References: <CANmmKZJqPqFG2fWCO=hN15zKpkDd1gzH=sQLkRNUzRADm0_aNg@mail.gmail.com>
	<CANtt_hykLN-8XQB1n0Rkkpoa=7KOBSmWTJJ=5eWshEgfEWXX3A@mail.gmail.com>
Message-ID: <CANmmKZKPnT7-MT9xWaZNt3tTriyDfYnQR=zezN=kacg9HnuVxg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140323/fe458967/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun Mar 23 20:35:48 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 23 Mar 2014 20:35:48 +0100
Subject: [R-sig-Geo] How to rescale a raster in R?
In-Reply-To: <CABkCotQoHnouPqF17SovERCvfDdpndvH8KJU9zjxwup4d2wrPg@mail.gmail.com>
References: <CABkCotQoHnouPqF17SovERCvfDdpndvH8KJU9zjxwup4d2wrPg@mail.gmail.com>
Message-ID: <532F3794.2020406@uni-muenster.de>

require(raster)
r = raster()
r[] = rnorm(180*360)
plot((r-cellStats(r,"min"))/(cellStats(r,"max")-cellStats(r,"min")))

raster::scale, like base::scale, centers to mean zero and scales to unit
variance.

On 03/23/2014 06:40 PM, Manuel Sp?nola wrote:
> Dear list members,
> 
> I want to rescale a raster between 0 and 1, how can I do that in R?
> 
> I know that there is a scale function in the raster package, but I don?t
> know how to use it for rescaling.
> 
> Best,
> 
> Manuel
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140323/5e638e4e/attachment.bin>

From tech_dev at wildintellect.com  Sun Mar 23 21:46:19 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Sun, 23 Mar 2014 13:46:19 -0700
Subject: [R-sig-Geo] Spatial auto-correlation globally (sphere)
Message-ID: <532F481B.5090504@wildintellect.com>

Has anyone seen a method for creating a neighbor list, for use in
spatial auto-correlation tests, that treats the earth as a sphere so
that relationships can go shortest distance. I'm trying to make a
neighbor list of all countries in the world.

Yes I realize that the relatedness may not be distance and I might
weight on some other factor but I need the neighbor list to start.

Example, US <-> Japan, China or Russia should be a line across the Pacific

Perhaps I need to develop the neighbor list using some sort of social
diagramming tool instead.

Any leads would be appreciated.

Thanks,
Alex


From agus.camacho at gmail.com  Sun Mar 23 22:39:43 2014
From: agus.camacho at gmail.com (Agus Camacho)
Date: Sun, 23 Mar 2014 18:39:43 -0300
Subject: [R-sig-Geo] problem calculating the proportion of overlap between
	two geographic rasters
Message-ID: <CALsJ7pQxXujxx5R=FuqD7uWd=D=FZtSNMMSR+==7sKLorf6Rug@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140323/00f5a58d/attachment.pl>

From Roger.Bivand at nhh.no  Sun Mar 23 22:41:51 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 23 Mar 2014 22:41:51 +0100
Subject: [R-sig-Geo] Spatial auto-correlation globally (sphere)
In-Reply-To: <532F481B.5090504@wildintellect.com>
References: <532F481B.5090504@wildintellect.com>
Message-ID: <alpine.LRH.2.03.1403232204230.14003@reclus.nhh.no>

On Sun, 23 Mar 2014, Alex Mandel wrote:

> Has anyone seen a method for creating a neighbor list, for use in
> spatial auto-correlation tests, that treats the earth as a sphere so
> that relationships can go shortest distance. I'm trying to make a
> neighbor list of all countries in the world.

Please start by specifying the support you intend to use (centroid point 
support, polygonal support, what?). If point support, setting longlat=TRUE 
in dnearneigh() in spdep with a matrix of coordinates, or using an object 
inheriting from SpatialPoints with the appropriate CRS will give you Great 
Circle distances; polygons are more complicated. Have you looked at the 
cshapes package, also mentioned in the Spatial Task View, which appears to 
do what you want to do? It has an R Journal article:

http://journal.r-project.org/archive/2010-1/RJournal_2010-1_Weidmann+Skrede~Gleditsch.pdf

Roger

>
> Yes I realize that the relatedness may not be distance and I might
> weight on some other factor but I need the neighbor list to start.
>
> Example, US <-> Japan, China or Russia should be a line across the Pacific
>
> Perhaps I need to develop the neighbor list using some sort of social
> diagramming tool instead.
>
> Any leads would be appreciated.
>
> Thanks,
> Alex
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From julleeyaw at yahoo.ca  Sun Mar 23 22:44:44 2014
From: julleeyaw at yahoo.ca (Julie Lee-Yaw)
Date: Sun, 23 Mar 2014 14:44:44 -0700 (PDT)
Subject: [R-sig-Geo] Managing temporary files created when using the Raster
	package
Message-ID: <1395611084.323.YahooMailNeo@web124501.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140323/56d34a21/attachment.pl>

From rvaldezr at gmail.com  Sun Mar 23 22:46:28 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Sun, 23 Mar 2014 15:46:28 -0600
Subject: [R-sig-Geo] Fwd:  Spatial auto-correlation globally (sphere)
References: <532F481B.5090504@wildintellect.com>
Message-ID: <0F4A2CD9-F83B-4FC4-9999-2CC16F6F955D@gmail.com>

Hi,

I?m not sure what kind of data you have. I work with shapes layers.

Without more information, I expose you what have I done with my data:

> library(rgdal)
> library(sp)
> library(spdep)
> library(lattice)
> library(RANN)
> library(maptools)
Checking rgeos availability: TRUE
> library(rgeos)
> map <-readOGR(".", "zm?) #Reading the shape file.
> neigh=poly2nb(map, queen=FALSE)
> mapaxy=coordinates(map)
> k1=knn2nb(knearneigh(mapaxy, k=1)) #First order matrix weights
> dist=unlist(nbdists(k1, mapaxy))
> summary(dist)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1021    4359    8492   13510   15290  273900 
> wdist20=dnearneigh(mapaxy, d1=0, d2=20000) #Consider relationships within a 20km radio.
> l20=nb2listw(wdist20, style="W", zero.policy=TRUE) #Creating a matrix weights considering 20 km radio.
> summary(l20, zero.policy=TRUE)
Characteristics of weights list object:
Neighbour list object:
Number of regions: 345 
Number of nonzero links: 3296 
Percentage nonzero weights: 2.769166 
Average number of links: 9.553623 
64 regions with no links:
1 2 3 4 25 26 27 28 29 30 31 32 33 34 35 36 37 38 42 44 45 46 47 48 49 56 57 61 62 63 65 66 86 87 88 93 149 150 152 166 167 168 170 172 177 179 228 229 236 237 239 241 242 243 244 284 285 291 298 309 314 315 334 335
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 26 27 28 29 30 31 33 
64 30 21 11 15 20 14 10  9 10 15 12  7  8 10 11 12  9  5 11  2  3  2  1  2  2  4  1  3 
34 35 36 37 38 
 7  3  3  5  3 
30 least connected regions:
23 24 40 41 58 59 60 64 148 151 181 202 212 213 224 225 226 227 230 231 232 233 234 235 294 308 322 325 329 333 with 1 link
3 most connected regions:
262 275 282 with 38 links

Weights style: W 
Weights constants summary:
    n    nn  S0       S1       S2
W 281 78961 281 126.7744 1149.688

After that, you can to do the autocorrelation test (Moran test) with your statistical data:

> test=moran.test(datos$ind_alim, listw=l20, randomisation=TRUE, zero.policy=TRUE)
> test

	Moran's I test under randomisation

data:  datos$ind_alim  
weights: l20  

Moran I statistic standard deviate = 3.762, p-value = 8.428e-05
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.135908714      -0.003571429       0.001374638

Other option you have, is to create the neighbor list object with GeoDa.

Hope this example helps,

Regards. 

Inicio del mensaje reenviado:

> De: Alex Mandel <tech_dev at wildintellect.com>
> Asunto: [R-sig-Geo] Spatial auto-correlation globally (sphere)
> Fecha: 23 de marzo de 2014 14:46:19 GMT-6
> Para: Aide R SIG GEO <r-sig-geo at stat.math.ethz.ch>
> Responder a: tech at wildintellect.com
> 
> Has anyone seen a method for creating a neighbor list, for use in
> spatial auto-correlation tests, that treats the earth as a sphere so
> that relationships can go shortest distance. I'm trying to make a
> neighbor list of all countries in the world.
> 
> Yes I realize that the relatedness may not be distance and I might
> weight on some other factor but I need the neighbor list to start.
> 
> Example, US <-> Japan, China or Russia should be a line across the Pacific
> 
> Perhaps I need to develop the neighbor list using some sort of social
> diagramming tool instead.
> 
> Any leads would be appreciated.
> 
> Thanks,
> Alex
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Rolando Valdez


From jgrn at illinois.edu  Sun Mar 23 23:58:50 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sun, 23 Mar 2014 17:58:50 -0500
Subject: [R-sig-Geo] Managing temporary files created when using the
 Raster package
In-Reply-To: <1395611084.323.YahooMailNeo@web124501.mail.ne1.yahoo.com>
References: <1395611084.323.YahooMailNeo@web124501.mail.ne1.yahoo.com>
Message-ID: <CABG0rft_iVuZ-0FT0==_=npG0UmLO9wkfjOt9aBB+xn3QyWJhg@mail.gmail.com>

Julie:

Why not just build a ?file.remove into your script?  Also, most raster
functions allow you to explicitly set a filename (see e.g. ?calc -->
the filename= parameter), rather than letting it generate a random
filename -- this would likely make it easier for you to figure out the
appropriate file to delete.

--j

On Sun, Mar 23, 2014 at 4:44 PM, Julie Lee-Yaw <julleeyaw at yahoo.ca> wrote:
> Hi
>
> I am doing a lot of raster calculations repeatedly (in a loop of sorts). As might be expected, this process is generating a lot of temporary files and filing up my hard drive before my script finishes. The first step in my script is to stack a set of very large rasters. This stack is then the input for the function that I'm using (e.g. the loop). Can I add in a line in my loop (e.g. removeTmpFiles) to delete temporary files created during the loop without ruining the integrity of the raster stack?
>
> For example:
>
> files<-list.files(pattern=".tif")
> myStack<-stack(files)
>
> myFunction<-function(x, rasterStack, y, z){
> # several calculations using the raster stack and x, y, z
> # non-raster results from the calculations get saved to file using write.csv()
> removeTmpFiles(h=0) # remove temp. raster files from disk???
> }
>
> lapply(x=list_of_x_values, myFunction, rasterStack=myStack, y=something, z=somethingelse)
>
> Is the removeTmpFiles line appropriate here?
>
> Thanks for the help!
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jgrn at illinois.edu  Mon Mar 24 00:05:03 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sun, 23 Mar 2014 18:05:03 -0500
Subject: [R-sig-Geo] problem calculating the proportion of overlap
 between two geographic rasters
In-Reply-To: <CALsJ7pQxXujxx5R=FuqD7uWd=D=FZtSNMMSR+==7sKLorf6Rug@mail.gmail.com>
References: <CALsJ7pQxXujxx5R=FuqD7uWd=D=FZtSNMMSR+==7sKLorf6Rug@mail.gmail.com>
Message-ID: <CABG0rft82HUvD8uE4pHMpddwq_J_b7iAhnQ74=kf1CcSjUmfEg@mail.gmail.com>

Argus:

Can't you just use the ?freq function for this purpose?

--j

On Sun, Mar 23, 2014 at 4:39 PM, Agus Camacho <agus.camacho at gmail.com> wrote:
> Hello list,
>
> Im trying to calculate the porportion of overlap among two rasters. I think
> i got it done, but when I apply the script on identical rasters, the
> proportion obtained is not 1!
> Someone could please explain me what I could be missing here?
>
> Here comes a reproducible example:
>
> library(raster)
>
> #generate 2 identical  raster layers b and d that take values 0 and 1.
>
> wgs84 <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
> d <- raster()
> extent(d) <- extent(119.4993, 141.0993, -36.65831, -29.85831)
> res(d) <- c(0.08, 0.08)
> projection(d) <- CRS(wgs84)
> values(d) <- sample(c(0, 1), ncell(d), replace=TRUE)
> b=d
>
> # calculate each layers' area
> a=raster::area(d)
> s=cellStats(a, 'sum')
>
> #sum both layers, so as to have value 2 were both layers present value 1
> soma=sum(b,d)
> overl=sum(values(area(soma))[which(values(soma)==2)])# sum cell sizes of
> cells with value 2 within soma
>
> overl/s# i think this should give 1 but it does not.
>
> # visualizing
> library(maps)
> map(regions = "australia")
> image(d, add = TRUE, col = "blue")
> image(soma, add = TRUE, col = "green")
>
>
> Thanks in advance!
> Agus
> --
> Agust?n Camacho Guerrero.
> Doutor em Zoologia.
> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
> Bioci?ncias, USP.
> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
> S?o Paulo - SP, CEP: 05508-090, Brasil.
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From tech_dev at wildintellect.com  Mon Mar 24 07:20:53 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Sun, 23 Mar 2014 23:20:53 -0700
Subject: [R-sig-Geo] Spatial auto-correlation globally (sphere)
In-Reply-To: <alpine.LRH.2.03.1403232204230.14003@reclus.nhh.no>
References: <532F481B.5090504@wildintellect.com>
	<alpine.LRH.2.03.1403232204230.14003@reclus.nhh.no>
Message-ID: <532FCEC5.6010708@wildintellect.com>

Thanks it looks like cshapes might be exactly what I was looking for and
more. I thought I knew what most of the Spatial packages were for,
clearly there are still a few more to wander through. It's odd that the
Task View pages don't have the same short description lines next to
packages the way the normal package list on the website does.

I think I was leaning towards polygons, I wasn't sure since the wrapping
of the dateline was the bigger problem to solve in my mind.
Cshapes has an interesting way of doing that where they look for the
nearest 2 nodes that make up the borders rather than directly testing
polygons or line edges. So it's really all points then.

The reason for the package is actually quite similar what I planned to
do with it so that paper you linked is very useful.

Thanks,
Alex


On 03/23/2014 02:41 PM, Roger Bivand wrote:
> On Sun, 23 Mar 2014, Alex Mandel wrote:
> 
>> Has anyone seen a method for creating a neighbor list, for use in
>> spatial auto-correlation tests, that treats the earth as a sphere so
>> that relationships can go shortest distance. I'm trying to make a
>> neighbor list of all countries in the world.
> 
> Please start by specifying the support you intend to use (centroid point
> support, polygonal support, what?). If point support, setting
> longlat=TRUE in dnearneigh() in spdep with a matrix of coordinates, or
> using an object inheriting from SpatialPoints with the appropriate CRS
> will give you Great Circle distances; polygons are more complicated.
> Have you looked at the cshapes package, also mentioned in the Spatial
> Task View, which appears to do what you want to do? It has an R Journal
> article:
> 
> http://journal.r-project.org/archive/2010-1/RJournal_2010-1_Weidmann+Skrede~Gleditsch.pdf
> 
> 
> Roger
> 
>>
>> Yes I realize that the relatedness may not be distance and I might
>> weight on some other factor but I need the neighbor list to start.
>>
>> Example, US <-> Japan, China or Russia should be a line across the
>> Pacific
>>
>> Perhaps I need to develop the neighbor list using some sort of social
>> diagramming tool instead.
>>
>> Any leads would be appreciated.
>>
>> Thanks,
>> Alex
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From jonasschmedtmann_23 at hotmail.com  Mon Mar 24 12:49:53 2014
From: jonasschmedtmann_23 at hotmail.com (Jonas Schmedtmann)
Date: Mon, 24 Mar 2014 11:49:53 +0000
Subject: [R-sig-Geo] Proj4 natgrid coordinate transformation error
Message-ID: <BLU0-SMTP12439435DD3CEBCFE1BA790847A0@phx.gbl>

Hi everyone,
I?m trying to use the nadgird parameter for coordinate transformation from the portuguese Hayford Gauss IGeoE system to UTM 29 WGS84 used in Landsat images for Portugal. I have the following code, which produces an error, so I wonder if I got everything right in my proj4strings. I?ve tried a lot of things, and an intensive google search did not solve my problem either. I got the file 'ptLX_e89.gsb? from a professor of mine so I assume there?s nothing wrong with it.

> PROJ4_IGEOE<-CRS("+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +units=m +nadgrids=ptLX_e89.gsb +wktext +no_defs")
> PROJ4_UTM<-CRS("+proj=utm +zone=29 +ellps=WGS84 +datum=WGS84 +units=m")
> area<-readShapePoly("../01 Dados/02 Dados espaciais/AREA_ESTUDO", proj4string=PROJ4_IGEOE)
> area_wgs84<-spTransform(area, PROJ4_UTM)
Error in .spTransform_Polygon(input[[i]], to_args = to_args, from_args = from_args,  : 
  error in pj_transform: failed to load datum shift file
> 

I?d appreciate any help. Thanks in advance!
Jonas Schmedtmann

From Roger.Bivand at nhh.no  Mon Mar 24 13:11:51 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 24 Mar 2014 13:11:51 +0100
Subject: [R-sig-Geo] Proj4 natgrid coordinate transformation error
In-Reply-To: <BLU0-SMTP12439435DD3CEBCFE1BA790847A0@phx.gbl>
References: <BLU0-SMTP12439435DD3CEBCFE1BA790847A0@phx.gbl>
Message-ID: <alpine.LRH.2.03.1403241305590.16355@reclus.nhh.no>

On Mon, 24 Mar 2014, Jonas Schmedtmann wrote:

> Hi everyone,
> I?m trying to use the nadgird parameter for coordinate transformation 
> from the portuguese Hayford Gauss IGeoE system to UTM 29 WGS84 used in 
> Landsat images for Portugal. I have the following code, which produces 
> an error, so I wonder if I got everything right in my proj4strings. I?ve 
> tried a lot of things, and an intensive google search did not solve my 
> problem either. I got the file 'ptLX_e89.gsb? from a professor of mine 
> so I assume there?s nothing wrong with it.

The error message says: failed to load datum shift file, suggesting that 
it isn't where it should be.

You didn't report your output from sessionInfo(), not the messages printed 
when rgdal is loaded. The resolution is system-dependent, but at base the 
file must be where PROJ expects to find it. If your rgdal is the CRAN 
Windows oe OSX binary, the directory should be system.file("proj", package 
= "rgdal")[1]; if PROJ is provided externally, where the share/proj 
directory is (default /usr/local/share/proj for source installs).

Roger

>
>> PROJ4_IGEOE<-CRS("+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +units=m +nadgrids=ptLX_e89.gsb +wktext +no_defs")
>> PROJ4_UTM<-CRS("+proj=utm +zone=29 +ellps=WGS84 +datum=WGS84 +units=m")
>> area<-readShapePoly("../01 Dados/02 Dados espaciais/AREA_ESTUDO", proj4string=PROJ4_IGEOE)
>> area_wgs84<-spTransform(area, PROJ4_UTM)
> Error in .spTransform_Polygon(input[[i]], to_args = to_args, from_args = from_args,  :
>  error in pj_transform: failed to load datum shift file
>>
>
> I?d appreciate any help. Thanks in advance!
> Jonas Schmedtmann
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From mspinola10 at gmail.com  Mon Mar 24 17:58:56 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Mon, 24 Mar 2014 10:58:56 -0600
Subject: [R-sig-Geo] How to rescale a raster in R?
In-Reply-To: <532F3794.2020406@uni-muenster.de>
References: <CABkCotQoHnouPqF17SovERCvfDdpndvH8KJU9zjxwup4d2wrPg@mail.gmail.com>
	<532F3794.2020406@uni-muenster.de>
Message-ID: <CABkCotQ-cMLF06yJUPMWwp-V2nSW9OsFaYTB2GKGUBG_Ws6OtQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140324/c542ac67/attachment.pl>

From mspinola10 at gmail.com  Mon Mar 24 19:02:20 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Mon, 24 Mar 2014 12:02:20 -0600
Subject: [R-sig-Geo] How to read or import a kml file in R
Message-ID: <CABkCotQY_x1vQZBuh-s2S6nUXd0_vvoPL7oH=sTXgMd8xu1pmA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140324/c39b77e2/attachment.pl>

From HodgessE at uhd.edu  Mon Mar 24 19:16:57 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Mon, 24 Mar 2014 18:16:57 +0000
Subject: [R-sig-Geo] How to read or import a kml file in R
In-Reply-To: <CABkCotQY_x1vQZBuh-s2S6nUXd0_vvoPL7oH=sTXgMd8xu1pmA@mail.gmail.com>
References: <CABkCotQY_x1vQZBuh-s2S6nUXd0_vvoPL7oH=sTXgMd8xu1pmA@mail.gmail.com>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217B3FF20@columbia.uhd.campus>

Hello Manuel:

Not sure what you're trying to do.  KML files display in Google Earth & Google Maps.

You can create KML files in R but not display them.

Hope this helps!

Sincerely,
Erin

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Manuel Sp?nola [mspinola10 at gmail.com]
Sent: Monday, March 24, 2014 1:02 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] How to read or import a kml file in R

Dear list members,

How to read a .kml file in R.  I was reading some threads on this, but I
stll don't understand how to do it.

The name of my file is "Circuito Tamarindo.kml"

Best,

Manuel

--
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Tel?fono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

        [[alternative HTML version deleted]]



From tech_dev at wildintellect.com  Mon Mar 24 19:30:04 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Mon, 24 Mar 2014 11:30:04 -0700
Subject: [R-sig-Geo] How to read or import a kml file in R
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217B3FF20@columbia.uhd.campus>
References: <CABkCotQY_x1vQZBuh-s2S6nUXd0_vvoPL7oH=sTXgMd8xu1pmA@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F680630217B3FF20@columbia.uhd.campus>
Message-ID: <533079AC.50607@wildintellect.com>

Well that hardly seems the whole story.
rgdal package's readOGR should be able to import kml into an sp object,
which can be analyzed or plotted.

https://stat.ethz.ch/pipermail/r-sig-geo/2010-May/008370.html

I think Erin was confusing it with KMZ files which are a bundle of kml +
images(sometimes) that are hard to use anywhere but Google Earth. Though
the trick is to just unzip them and use the components individually.

Thanks,
Alex

On 03/24/2014 11:16 AM, Hodgess, Erin wrote:
> Hello Manuel:
> 
> Not sure what you're trying to do.  KML files display in Google Earth & Google Maps.
> 
> You can create KML files in R but not display them.
> 
> Hope this helps!
> 
> Sincerely,
> Erin
> 
> ________________________________________
> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Manuel Sp?nola [mspinola10 at gmail.com]
> Sent: Monday, March 24, 2014 1:02 PM
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] How to read or import a kml file in R
> 
> Dear list members,
> 
> How to read a .kml file in R.  I was reading some threads on this, but I
> stll don't understand how to do it.
> 
> The name of my file is "Circuito Tamarindo.kml"
> 
> Best,
> 
> Manuel
> 
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> 
>         [[alternative HTML version deleted]]
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From HodgessE at uhd.edu  Mon Mar 24 19:38:07 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Mon, 24 Mar 2014 18:38:07 +0000
Subject: [R-sig-Geo] How to read or import a kml file in R
In-Reply-To: <533079AC.50607@wildintellect.com>
References: <CABkCotQY_x1vQZBuh-s2S6nUXd0_vvoPL7oH=sTXgMd8xu1pmA@mail.gmail.com>
	<FF9DB805FC41CC4E95825A50F680630217B3FF20@columbia.uhd.campus>,
	<533079AC.50607@wildintellect.com>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217B3FF3C@columbia.uhd.campus>

I didn't realize that readOGR could do that.  Very cool!  Thanks for the good info.

________________________________________
From: Alex Mandel [tech_dev at wildintellect.com]
Sent: Monday, March 24, 2014 1:30 PM
To: Hodgess, Erin; Manuel Sp?nola; r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] How to read or import a kml file in R

Well that hardly seems the whole story.
rgdal package's readOGR should be able to import kml into an sp object,
which can be analyzed or plotted.

https://stat.ethz.ch/pipermail/r-sig-geo/2010-May/008370.html

I think Erin was confusing it with KMZ files which are a bundle of kml +
images(sometimes) that are hard to use anywhere but Google Earth. Though
the trick is to just unzip them and use the components individually.

Thanks,
Alex

On 03/24/2014 11:16 AM, Hodgess, Erin wrote:
> Hello Manuel:
>
> Not sure what you're trying to do.  KML files display in Google Earth & Google Maps.
>
> You can create KML files in R but not display them.
>
> Hope this helps!
>
> Sincerely,
> Erin
>
> ________________________________________
> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Manuel Sp?nola [mspinola10 at gmail.com]
> Sent: Monday, March 24, 2014 1:02 PM
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] How to read or import a kml file in R
>
> Dear list members,
>
> How to read a .kml file in R.  I was reading some threads on this, but I
> stll don't understand how to do it.
>
> The name of my file is "Circuito Tamarindo.kml"
>
> Best,
>
> Manuel
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From tech_dev at wildintellect.com  Mon Mar 24 20:37:44 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Mon, 24 Mar 2014 12:37:44 -0700
Subject: [R-sig-Geo] How to read or import a kml file in R
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217B3FF3C@columbia.uhd.campus>
References: <CABkCotQY_x1vQZBuh-s2S6nUXd0_vvoPL7oH=sTXgMd8xu1pmA@mail.gmail.com>	<FF9DB805FC41CC4E95825A50F680630217B3FF20@columbia.uhd.campus>,
	<533079AC.50607@wildintellect.com>
	<FF9DB805FC41CC4E95825A50F680630217B3FF3C@columbia.uhd.campus>
Message-ID: <53308988.6030901@wildintellect.com>

Ya, there are some exceptions. ie Styling is not really supported,
though work on the OGR side is in progress on that. Also there are some
kml files that merely have urls to some web server where the kml really
is (ie exports from Google maps). These notoriously don't work with OGR
or other kml engines.

The hack is to use google earth to open them and then save them back out
to yet another kml that actually has the data (I'm oversimplifying the
steps).

http://gdal.org/ogr/ogr_formats.html

FYI, if you use the Libkml driver you might get more details than the
traditional OGR kml drivers. Libkml behaves more like google earth,
since it's also written by google.

Thanks,
Alex

On 03/24/2014 11:38 AM, Hodgess, Erin wrote:
> I didn't realize that readOGR could do that.  Very cool!  Thanks for the good info.
> 
> ________________________________________
> From: Alex Mandel [tech_dev at wildintellect.com]
> Sent: Monday, March 24, 2014 1:30 PM
> To: Hodgess, Erin; Manuel Sp?nola; r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] How to read or import a kml file in R
> 
> Well that hardly seems the whole story.
> rgdal package's readOGR should be able to import kml into an sp object,
> which can be analyzed or plotted.
> 
> https://stat.ethz.ch/pipermail/r-sig-geo/2010-May/008370.html
> 
> I think Erin was confusing it with KMZ files which are a bundle of kml +
> images(sometimes) that are hard to use anywhere but Google Earth. Though
> the trick is to just unzip them and use the components individually.
> 
> Thanks,
> Alex
> 
> On 03/24/2014 11:16 AM, Hodgess, Erin wrote:
>> Hello Manuel:
>>
>> Not sure what you're trying to do.  KML files display in Google Earth & Google Maps.
>>
>> You can create KML files in R but not display them.
>>
>> Hope this helps!
>>
>> Sincerely,
>> Erin
>>
>> ________________________________________
>> From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Manuel Sp?nola [mspinola10 at gmail.com]
>> Sent: Monday, March 24, 2014 1:02 PM
>> To: r-sig-geo at r-project.org
>> Subject: [R-sig-Geo] How to read or import a kml file in R
>>
>> Dear list members,
>>
>> How to read a .kml file in R.  I was reading some threads on this, but I
>> stll don't understand how to do it.
>>
>> The name of my file is "Circuito Tamarindo.kml"
>>
>> Best,
>>
>> Manuel
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.ac.cr
>> mspinola10 at gmail.com
>> Tel?fono: (506) 2277-3598
>> Fax: (506) 2237-7036
>> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alyssonstege at gmail.com  Mon Mar 24 21:11:43 2014
From: alyssonstege at gmail.com (Alysson Luiz Stege)
Date: Mon, 24 Mar 2014 17:11:43 -0300
Subject: [R-sig-Geo] Pseudo R^2 in Spatial simultaneous autoregressive error
 model estimation by GMM
Message-ID: <CAMKsCCOCQTmg-fTRcSmoov1_aPakD2tqQqnLzRamkX=yvZDfAQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140324/d83062a8/attachment.pl>

From dododave at gmail.com  Mon Mar 24 22:55:11 2014
From: dododave at gmail.com (dododave)
Date: Mon, 24 Mar 2014 14:55:11 -0700 (PDT)
Subject: [R-sig-Geo] NDVI value averaging with a polygon
Message-ID: <1395698111172-7586033.post@n2.nabble.com>

Hi everyone.

I am trying to average NDVI values of a raster, but within a polygon. The
NDVI raster has pixel values between 0 and 255, and the polygon is an
irregular shape so I cannot simply use the extent function.

Any help appreciated!
Dave



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/NDVI-value-averaging-with-a-polygon-tp7586033.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From vitale232 at gmail.com  Mon Mar 24 23:28:12 2014
From: vitale232 at gmail.com (Andrew Vitale)
Date: Mon, 24 Mar 2014 15:28:12 -0700
Subject: [R-sig-Geo] NDVI value averaging with a polygon
In-Reply-To: <1395698111172-7586033.post@n2.nabble.com>
References: <1395698111172-7586033.post@n2.nabble.com>
Message-ID: <CAFTcope7XpUeew8oFvpo_kvWZeG+fTmPVeRJa8cuTebPQcjCZQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140324/ef459c8b/attachment.pl>

From dododave at gmail.com  Tue Mar 25 00:08:35 2014
From: dododave at gmail.com (dododave)
Date: Mon, 24 Mar 2014 16:08:35 -0700 (PDT)
Subject: [R-sig-Geo] NDVI value averaging with a polygon
In-Reply-To: <CAFTcope7XpUeew8oFvpo_kvWZeG+fTmPVeRJa8cuTebPQcjCZQ@mail.gmail.com>
References: <1395698111172-7586033.post@n2.nabble.com>
	<CAFTcope7XpUeew8oFvpo_kvWZeG+fTmPVeRJa8cuTebPQcjCZQ@mail.gmail.com>
Message-ID: <1395702515512-7586035.post@n2.nabble.com>

Thanks, Andrew. That worked nicely. I'll remember the extract function now!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/NDVI-value-averaging-with-a-polygon-tp7586033p7586035.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From haaszoology at gmail.com  Tue Mar 25 00:15:08 2014
From: haaszoology at gmail.com (Sarah Haas)
Date: Mon, 24 Mar 2014 19:15:08 -0400
Subject: [R-sig-Geo] Upscaling residuals to hectare for regression kriging
Message-ID: <CAHQ5qVdnchb1-k7Siycd9xMUqY0Ypq1r5ARsN0BtQ==MeW=Ymg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140324/18a7a118/attachment.pl>

From milan.kili11 at gmail.com  Tue Mar 25 12:25:14 2014
From: milan.kili11 at gmail.com (Milan Kilibarda)
Date: Tue, 25 Mar 2014 12:25:14 +0100
Subject: [R-sig-Geo] preserving size ratios between pies in
	segmentGoogleMaps
In-Reply-To: <5D0948A37D1C384580C2C715171423C28432E571@smmb2.rand.org>
References: <5D0948A37D1C384580C2C715171423C28432E571@smmb2.rand.org>
Message-ID: <CAPSaU-9MYT1A8W9DW2k6U6kLSqFMbQ4x6eMMGdnm5=5hv-9z-A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140325/750bee4f/attachment.pl>

From dododave at gmail.com  Tue Mar 25 17:37:06 2014
From: dododave at gmail.com (dododave)
Date: Tue, 25 Mar 2014 09:37:06 -0700 (PDT)
Subject: [R-sig-Geo] reading .hdf files
Message-ID: <1395765426821-7586038.post@n2.nabble.com>

Hi all,

I am trying to load an hdf raster file consisting of NDVI values so that I
can calculate the mean values within a polygon. I have been able to do this
with GEOtiff files, but not with .hdf, which is strange because GIS programs
can readily load them.

I have looked into rgdal package, but that doesn't seem to have an hdf
driver

Thanks for any help,
Dave



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Tue Mar 25 17:54:00 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 25 Mar 2014 16:54:00 +0000
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <981677722b494abf8e9b3be59a889828@EX-0-HT0.lancs.local>
References: <981677722b494abf8e9b3be59a889828@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140325/3ca6dfd4/attachment.pl>

From jgrn at illinois.edu  Tue Mar 25 18:09:22 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 25 Mar 2014 12:09:22 -0500
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
References: <981677722b494abf8e9b3be59a889828@EX-0-HT0.lancs.local>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
Message-ID: <CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>

Dave:

We wrote a package initially inspired by this issue -- gdalUtils,
which are wrappers for the GDAL/OGR utilities.  There are even some
hdf helper functions we included (e.g. ?get_subdatasets).  Note that
if you are on a Windows or Mac box, it is important you install the
correct version of GDAL first.

Currently, you'll need to extract out the subdataset you want via
?gdal_translate -- there is an example using an HDF4 file in the help.

I would recommend grabbing the R-forge version, since I have a few
fixes in there that aren't on the latest CRAN:

install.packages("gdalUtils", repos="http://R-Forge.R-project.org")

Good luck!

--j

On Tue, Mar 25, 2014 at 11:54 AM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> HDF is a richer file format, and can do more than just store rasters. It
> can contain multiple objects of different dimension.
>
> There's a few ad-hoc standards for regular raster data in HDF though, where
> objects in the HDF specify the coordinates on the axes - which might be
> lat, lon, time, height  in a 4-D data set and then the 4d hypercube of data
> itself.
>
> See the Binary Data Formats section here:
>
>  http://cran.r-project.org/doc/manuals/r-release/R-data.html
>
> for some packages that can read HDF, but you might have to dig into the
> metadata to work out how to get the NDVI raster for 01/2012 from your HDF
> file. Without a sample, we're guessing...
>
> Barry
>
>
>
> On Tue, Mar 25, 2014 at 4:37 PM, dododave <dododave at gmail.com> wrote:
>
>> Hi all,
>>
>> I am trying to load an hdf raster file consisting of NDVI values so that I
>> can calculate the mean values within a polygon. I have been able to do this
>> with GEOtiff files, but not with .hdf, which is strange because GIS
>> programs
>> can readily load them.
>>
>> I have looked into rgdal package, but that doesn't seem to have an hdf
>> driver
>>
>> Thanks for any help,
>> Dave
>>
>>
>>
>> --
>> View this message in context:
>> http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From dododave at gmail.com  Tue Mar 25 18:40:12 2014
From: dododave at gmail.com (dododave)
Date: Tue, 25 Mar 2014 10:40:12 -0700 (PDT)
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
Message-ID: <1395769212329-7586041.post@n2.nabble.com>

Thank-you Jonathan. I have done as you suggested and installed the latest
version of GDAL and gdalUtils, and then followed the example in the
gdal_translate help.

To convert the hdf file test.hdf to .tif format, I use the following code;

hdf4_dataset <- system.file("test.hdf", package="gdalUtils")
gdal_translate(hdf4_dataset,"test.tif",sd_index=1)
#I renamed the file to test.hdf for simplicity

But this did not work. I got this error;

Error in split1[[1]] : subscript out of bounds
In addition: Warning message:
running command '"C:\Program Files\QGIS Dufour\bin\gdalinfo.exe" ""' had
status 1 

The hdf file I was trying to load was;
ftp://ftp.orbit.nesdis.noaa.gov/pub/corp/scsb/wguo/GVIx/GVIx_VH_16km/NVI/GVIX_NL_G16_C07_NVI_Y2005_P26.hdf

Thanks,
Dave



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586041.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jgrn at illinois.edu  Tue Mar 25 19:52:47 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 25 Mar 2014 13:52:47 -0500
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <1395769212329-7586041.post@n2.nabble.com>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
	<1395769212329-7586041.post@n2.nabble.com>
Message-ID: <CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>

Hi Dave:

In all likelihood, it couldn't find your GDAL install.  What OS are
you using?  What GDAL install did you use?  Can you restart R, and
then paste the output of:

library("gdalUtils")
gdal_setInstallation(verbose=TRUE)

And then the output of:

getOption("gdalUtils_gdalPath")

Thanks!

--j

On Tue, Mar 25, 2014 at 12:40 PM, dododave <dododave at gmail.com> wrote:
> Thank-you Jonathan. I have done as you suggested and installed the latest
> version of GDAL and gdalUtils, and then followed the example in the
> gdal_translate help.
>
> To convert the hdf file test.hdf to .tif format, I use the following code;
>
> hdf4_dataset <- system.file("test.hdf", package="gdalUtils")
> gdal_translate(hdf4_dataset,"test.tif",sd_index=1)
> #I renamed the file to test.hdf for simplicity
>
> But this did not work. I got this error;
>
> Error in split1[[1]] : subscript out of bounds
> In addition: Warning message:
> running command '"C:\Program Files\QGIS Dufour\bin\gdalinfo.exe" ""' had
> status 1
>
> The hdf file I was trying to load was;
> ftp://ftp.orbit.nesdis.noaa.gov/pub/corp/scsb/wguo/GVIx/GVIx_VH_16km/NVI/GVIX_NL_G16_C07_NVI_Y2005_P26.hdf
>
> Thanks,
> Dave
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586041.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From horning at amnh.org  Tue Mar 25 19:58:28 2014
From: horning at amnh.org (Ned Horning)
Date: Tue, 25 Mar 2014 14:58:28 -0400
Subject: [R-sig-Geo] More problems with sampleRandom using and extent
In-Reply-To: <5329FF97.1010105@amnh.org>
References: <5329FF97.1010105@amnh.org>
Message-ID: <5331D1D4.8080406@amnh.org>

I didn't get any feedback about this issue so I am reposting the 
question. Basically I would like to know if this is indeed a bug in the 
Raster package or if it's a user problem. There is sample code at the 
bottom of the email. Any help would be appreciated.

All the best,

Ned

On 03/19/2014 04:35 PM, Ned Horning wrote:
> Hi -
>
> I had a problem a while back using sampleRandom with an extent object 
> to limit sampling within the extent and I thought it was fixed but now 
> there seems to be another problem. When I run "sampleCells <- 
> sampleRandom(predImage, size=20, sp=TRUE, ext=commonExt)" I get the 
> following warnings and error:
> -- 
> Warning messages:
> 1: In doTryCatch(return(expr), name, parentenv, handler) :
>   restarting interrupted promise evaluation
> 2: restarting interrupted promise evaluation
> 3: restarting interrupted promise evaluation
> Error in xmin(object) :
>   error in evaluating the argument 'x' in selecting a method for 
> function 'xmin': Error: object 'rr' not found
> -- 
>
> Below is sample code to illustrate the problem. Any idea what the 
> problem might be? I'm using raster version 2.2-31 with Ubuntu 12.04.
>
> Thanks in advance for any insight.
>
> Ned
> -- 
> library(raster)
> crs_predImage <- CRS("+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs
> +ellps=WGS84 +towgs84=0,0,0")
> predImage <- raster(nrows=7561, ncols=8521, xmn=240585, xmx=496215,
>                     ymn=5297985, ymx=5524815)
> projection(predImage) <- crs_predImage
> predImage[] <- 1
>
> commonExt <- extent(366760.6 , 425233.5, 5396052, 5450158)
>
> sampleCells <- sampleRandom(predImage, size=20, sp=TRUE, ext=commonExt)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From jgrn at illinois.edu  Tue Mar 25 20:07:58 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 25 Mar 2014 14:07:58 -0500
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
	<1395769212329-7586041.post@n2.nabble.com>
	<CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>
Message-ID: <CABG0rftV-Mnurwin0j=uAwU8e9hOftYoLHGtPRcN2dkcqGA=Wg@mail.gmail.com>

Ok, I actually think you probably got it working somewhat correctly
(if it returns something in the previous step) -- I think the issue
you are having is a few things:

1) Don't use the system.file for your own file -- the system.file()
call is specifically for demo files within a package.  Set the working
directory to where your HDF file is located and do:
setwd("path/to/your/hdf/files")
hdf_file <- "GVIX_NL_G16_C07_NVI_Y2005_P26.hdf"

Note you should be able to now do:
gdalinfo(hdf_file)

2) You are using an oddly formatted hdf file -- the get_subdatasets()
routine and the sd_index= parameter only work when the subdatasets are
named following a generally agreed-upon standard, the
"SUBDATASET_n_NAME" format (common to e.g. MODIS, Landsat LEDAPS, and
a lot of other products).  In your case, since it doesn't follow these
conventions, you can instead use the sds=TRUE parameter which will
extract ALL subdatasets it finds.  The one annoying part about this is
that GDAL won't append the correct suffix (at least, not with version
1.10.0 and earlier), so you will need to rename the output:
outfile="testout"
gdal_translate(hdf_file,outfile,sds=TRUE,verbose=TRUE)
# Notice you now have a file named "testout" with no extension.  Let's
rename it:
file.rename(outfile,paste(outfile,".tif",sep="")) # Only if a tif.
Mod this if a different output format.

Hope this helps!  I'll make it more clear in future documentation when
the sd_index parameter works.

--j



On Tue, Mar 25, 2014 at 1:52 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
> Hi Dave:
>
> In all likelihood, it couldn't find your GDAL install.  What OS are
> you using?  What GDAL install did you use?  Can you restart R, and
> then paste the output of:
>
> library("gdalUtils")
> gdal_setInstallation(verbose=TRUE)
>
> And then the output of:
>
> getOption("gdalUtils_gdalPath")
>
> Thanks!
>
> --j
>
> On Tue, Mar 25, 2014 at 12:40 PM, dododave <dododave at gmail.com> wrote:
>> Thank-you Jonathan. I have done as you suggested and installed the latest
>> version of GDAL and gdalUtils, and then followed the example in the
>> gdal_translate help.
>>
>> To convert the hdf file test.hdf to .tif format, I use the following code;
>>
>> hdf4_dataset <- system.file("test.hdf", package="gdalUtils")
>> gdal_translate(hdf4_dataset,"test.tif",sd_index=1)
>> #I renamed the file to test.hdf for simplicity
>>
>> But this did not work. I got this error;
>>
>> Error in split1[[1]] : subscript out of bounds
>> In addition: Warning message:
>> running command '"C:\Program Files\QGIS Dufour\bin\gdalinfo.exe" ""' had
>> status 1
>>
>> The hdf file I was trying to load was;
>> ftp://ftp.orbit.nesdis.noaa.gov/pub/corp/scsb/wguo/GVIx/GVIx_VH_16km/NVI/GVIX_NL_G16_C07_NVI_Y2005_P26.hdf
>>
>> Thanks,
>> Dave
>>
>>
>>
>> --
>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586041.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From alobolistas at gmail.com  Wed Mar 26 11:56:03 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 26 Mar 2014 11:56:03 +0100
Subject: [R-sig-Geo] Problem with rgdal
Message-ID: <CAG4NReJtk3WeYzFXRma-WievTE9wA7Zc5wAgRtQ30ZVw-KViZA@mail.gmail.com>

I get this weird behaviour (on linuxmint based of ubuntu raring):

> rlm1ext <- spTransform(rlm1ext, CRS("+init=epsg:4326"))
Error in spTransform(rlm1ext, CRS("+init=epsg:4326")) :
  load package rgdal for spTransform methods

despite rgdal had been loaded:

> require(rgdal)
Loading required package: rgdal
rgdal: version: 0.8-16, (SVN revision 498)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
Path to GDAL shared files: /usr/share/gdal/1.10
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files: (autodetected)

Any suggestion on what is going wrong?
Agus

> sessionInfo()
R version 3.0.2 (2013-09-25)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
LC_PAPER=es_ES.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgeos_0.3-2     ggmap_2.3       ggplot2_0.9.3.1 rgdal_0.8-16
raster_2.2-31   sp_1.0-14

loaded via a namespace (and not attached):
 [1] colorspace_1.2-4    dichromat_2.0-0     digest_0.6.4
grid_3.0.2          gtable_0.1.2
 [6] labeling_0.2        lattice_0.20-24     mapproj_1.2-1
maps_2.3-6          MASS_7.3-29
[11] munsell_0.4.2       plyr_1.8            png_0.1-7
proto_0.3-10        RColorBrewer_1.0-5
[16] reshape2_1.2.2      RgoogleMaps_1.2.0.5 rjson_0.2.13
RJSONIO_1.0-3       scales_0.2.3
[21] stringr_0.6.2       tools_3.0.2


From mdsumner at gmail.com  Wed Mar 26 12:06:17 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 26 Mar 2014 22:06:17 +1100
Subject: [R-sig-Geo] Problem with rgdal
In-Reply-To: <CAG4NReJtk3WeYzFXRma-WievTE9wA7Zc5wAgRtQ30ZVw-KViZA@mail.gmail.com>
References: <CAG4NReJtk3WeYzFXRma-WievTE9wA7Zc5wAgRtQ30ZVw-KViZA@mail.gmail.com>
Message-ID: <CAAcGz98hHzKSaHOofMN4tcS90CyUnuEwqwy_EM0aD2dqFG4A=g@mail.gmail.com>

I suspect that your rlm1ext is not spTransform-able.

library(rgdal)
spTransform(1, CRS("+init=epsg:4326"))
Error in spTransform(1, CRS("+init=epsg:4326")) :
  load package rgdal for spTransform methods

It might be hard to test that there couldn't ever be a method for
spTransform for some given input, but this does seem a little too
open-ended.

Cheers, Mike.

On Wed, Mar 26, 2014 at 9:56 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> I get this weird behaviour (on linuxmint based of ubuntu raring):
>
>> rlm1ext <- spTransform(rlm1ext, CRS("+init=epsg:4326"))
> Error in spTransform(rlm1ext, CRS("+init=epsg:4326")) :
>   load package rgdal for spTransform methods
>
> despite rgdal had been loaded:
>
>> require(rgdal)
> Loading required package: rgdal
> rgdal: version: 0.8-16, (SVN revision 498)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
> Path to GDAL shared files: /usr/share/gdal/1.10
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: (autodetected)
>
> Any suggestion on what is going wrong?
> Agus
>
>> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
> LC_PAPER=es_ES.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgeos_0.3-2     ggmap_2.3       ggplot2_0.9.3.1 rgdal_0.8-16
> raster_2.2-31   sp_1.0-14
>
> loaded via a namespace (and not attached):
>  [1] colorspace_1.2-4    dichromat_2.0-0     digest_0.6.4
> grid_3.0.2          gtable_0.1.2
>  [6] labeling_0.2        lattice_0.20-24     mapproj_1.2-1
> maps_2.3-6          MASS_7.3-29
> [11] munsell_0.4.2       plyr_1.8            png_0.1-7
> proto_0.3-10        RColorBrewer_1.0-5
> [16] reshape2_1.2.2      RgoogleMaps_1.2.0.5 rjson_0.2.13
> RJSONIO_1.0-3       scales_0.2.3
> [21] stringr_0.6.2       tools_3.0.2
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com


From alobolistas at gmail.com  Wed Mar 26 12:24:22 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 26 Mar 2014 12:24:22 +0100
Subject: [R-sig-Geo] Problem with rgdal
In-Reply-To: <CAAcGz98hHzKSaHOofMN4tcS90CyUnuEwqwy_EM0aD2dqFG4A=g@mail.gmail.com>
References: <CAG4NReJtk3WeYzFXRma-WievTE9wA7Zc5wAgRtQ30ZVw-KViZA@mail.gmail.com>
	<CAAcGz98hHzKSaHOofMN4tcS90CyUnuEwqwy_EM0aD2dqFG4A=g@mail.gmail.com>
Message-ID: <CAG4NReKG8LOoYkiMcnGVM0pyz2fXcMvWsL-csX3A3v4zsC3LhQ@mail.gmail.com>

right, I had a typo in the previous line of the code:
rlm1ext <- as(extent(rlm1), 'SpatialPolygons')
projection(rlm1ext <- projection(rlm1))

instead of
projection(rlm1ext) <- projection(rlm1)

The problem is that I remembered having that error message
"load package rgdal for spTransform methods"
with gdal-related installation problems and got into a totally wrong direction,

Thanks!

Agus

On Wed, Mar 26, 2014 at 12:06 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> I suspect that your rlm1ext is not spTransform-able.
>
> library(rgdal)
> spTransform(1, CRS("+init=epsg:4326"))
> Error in spTransform(1, CRS("+init=epsg:4326")) :
>   load package rgdal for spTransform methods
>
> It might be hard to test that there couldn't ever be a method for
> spTransform for some given input, but this does seem a little too
> open-ended.
>
> Cheers, Mike.
>
> On Wed, Mar 26, 2014 at 9:56 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> I get this weird behaviour (on linuxmint based of ubuntu raring):
>>
>>> rlm1ext <- spTransform(rlm1ext, CRS("+init=epsg:4326"))
>> Error in spTransform(rlm1ext, CRS("+init=epsg:4326")) :
>>   load package rgdal for spTransform methods
>>
>> despite rgdal had been loaded:
>>
>>> require(rgdal)
>> Loading required package: rgdal
>> rgdal: version: 0.8-16, (SVN revision 498)
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>> Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
>> Path to GDAL shared files: /usr/share/gdal/1.10
>> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>> Path to PROJ.4 shared files: (autodetected)
>>
>> Any suggestion on what is going wrong?
>> Agus
>>
>>> sessionInfo()
>> R version 3.0.2 (2013-09-25)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>>
>> locale:
>>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>> LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
>>  [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
>> LC_PAPER=es_ES.UTF-8       LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] rgeos_0.3-2     ggmap_2.3       ggplot2_0.9.3.1 rgdal_0.8-16
>> raster_2.2-31   sp_1.0-14
>>
>> loaded via a namespace (and not attached):
>>  [1] colorspace_1.2-4    dichromat_2.0-0     digest_0.6.4
>> grid_3.0.2          gtable_0.1.2
>>  [6] labeling_0.2        lattice_0.20-24     mapproj_1.2-1
>> maps_2.3-6          MASS_7.3-29
>> [11] munsell_0.4.2       plyr_1.8            png_0.1-7
>> proto_0.3-10        RColorBrewer_1.0-5
>> [16] reshape2_1.2.2      RgoogleMaps_1.2.0.5 rjson_0.2.13
>> RJSONIO_1.0-3       scales_0.2.3
>> [21] stringr_0.6.2       tools_3.0.2
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From tghoward at gw.dec.state.ny.us  Wed Mar 26 12:49:42 2014
From: tghoward at gw.dec.state.ny.us (Tim Howard)
Date: Wed, 26 Mar 2014 07:49:42 -0400
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
In-Reply-To: <mailman.11.1395226805.12505.r-sig-geo@r-project.org>
References: <mailman.11.1395226805.12505.r-sig-geo@r-project.org>
Message-ID: <53328696020000D500B873C9@gwsmtp.dec.state.ny.us>

Jonathan,
Thank you for putting this together and for the example. I'm doing two things differently with randomForest ... I think perhaps one of them the function isn't handling.  
 
First, based on recommendations from Andy Liaw (and ?randomForest), I don't use the formula interface but use x=<many columns>, y=<a column> in the call. Does predict_rasterEngine handle the absence of a formula in the object?
 
Second, I have many large rasters I want to run the predict on, so making a brick would be difficult. I use a rasterStack instead. Does your example work with a rasterStack? 
 
I can dive deeper if any of this isn't clear or if these two tweaks work just fine for you. I was just trying to swap out this version of predict with another parallel version to evaluate speed and, while the alternate version works fine, predict_rasterEngine bailed on me. 
 
Thanks in advance. 
Tim Howard
 
 

>>>>>>
Date: Tue, 18 Mar 2014 22:14:23 -0500
From: Jonathan Greenberg <jgrn at illinois.edu>
To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
Message-ID:
<CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

R-sig-geo'ers:

I finally got around to building a parallel predict statement that
I've included in version 1.3.7 (or later) of spatial.tools (check
http://r-forge.r-project.org/R/?group_id=1492 for the status of the
build), "predict_rasterEngine".  It should, in theory, be a direct
swap-in for the standard generic predict() statement.  Currently, it
will work on any predict.* statement that has the following features:
1) The data is passed to the predict as a data frame via a newdata
parameter, and
2) The data is returned from the predict statement as a vector/matrix.

When using predict_rasterEngine, the object= parameter is your model,
and the newdata= parameter is the raster/brick/stack to apply the
model to on a pixel-by-pixel basis (note that the names of the layers
must match the names of the predictor variables, in most cases).

I was hoping to get some stress-testing on this, since it is a fairly
oft-requested function.  If a predict.* function you'd like to use
doesn't work, let me know which function it is (with some test data)
and I'll see if I can tweak it to work.

Right now, I have confirmed this works with randomForest.  Here's an example:

######################

packages_required <- c("spatial.tools","doParallel","randomForest")
lapply(packages_required, require, character.only=T)

# Load up a 3-band image:
tahoe_highrez <- setMinMax(
brick(system.file("external/tahoe_highrez.tif", package="spatial.tools")))
tahoe_highrez
plotRGB(tahoe_highrez)

# Load up some training points:
tahoe_highrez_training_points <- readOGR(
dsn=system.file("external", package="spatial.tools"),
layer="tahoe_highrez_training_points")

# Extract data to train the randomForest model:
tahoe_highrez_training_extract <- extract(
tahoe_highrez,
tahoe_highrez_training_points,
df=TRUE)

# Fuse it back with the SPECIES info:
tahoe_highrez_training_extract$SPECIES <- tahoe_highrez_training_points$SPECIES

# Note the names of the bands:
names(tahoe_highrez_training_extract) # the extracted data
names(tahoe_highrez) # the brick

# Generate a randomForest model:
tahoe_rf <- randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
data=tahoe_highrez_training_extract)

tahoe_rf

# This will run the predict in parallel:
sfQuickInit()
prediction_rf_class <-
predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
prediction_rf_prob <-
predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
sfQuickStop()

###############

--j
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140326/360372bf/attachment.html>

From alobolistas at gmail.com  Wed Mar 26 14:29:38 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 26 Mar 2014 14:29:38 +0100
Subject: [R-sig-Geo] ggmap and sp polygons?
Message-ID: <CAG4NReLb-7d0dgBKo=8oQhwbPoYD691+29jxO5eMd-tK6aT1dw@mail.gmail.com>

I have a ggmap layer made with
gmap <- get_map(location=rlm1ext at bbox, maptype='hybrid',
source='google', crop=FALSE,zoom=6)

which I can plot with
ggmap(gmap)


Is there any way I could graphically overlay an spatialPolygonsDF imported
from a shape file?


Thanks

Agus


From alobolistas at gmail.com  Wed Mar 26 14:36:23 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 26 Mar 2014 14:36:23 +0100
Subject: [R-sig-Geo] ggmap and sp polygons?
In-Reply-To: <CAG4NReLb-7d0dgBKo=8oQhwbPoYD691+29jxO5eMd-tK6aT1dw@mail.gmail.com>
References: <CAG4NReLb-7d0dgBKo=8oQhwbPoYD691+29jxO5eMd-tK6aT1dw@mail.gmail.com>
Message-ID: <CAG4NReJRb-MvHL7sGSm17ih-anXmHZgRDLs6JuHk8DwfNRBq5A@mail.gmail.com>

Actually the answer is more or less here
https://gist.github.com/oscarperpinan/7482848

Agus

On Wed, Mar 26, 2014 at 2:29 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> I have a ggmap layer made with
> gmap <- get_map(location=rlm1ext at bbox, maptype='hybrid',
> source='google', crop=FALSE,zoom=6)
>
> which I can plot with
> ggmap(gmap)
>
>
> Is there any way I could graphically overlay an spatialPolygonsDF imported
> from a shape file?
>
>
> Thanks
>
> Agus


From jgrn at illinois.edu  Wed Mar 26 15:23:29 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 26 Mar 2014 09:23:29 -0500
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
In-Reply-To: <53328696020000D500B873C9@gwsmtp.dec.state.ny.us>
References: <mailman.11.1395226805.12505.r-sig-geo@r-project.org>
	<53328696020000D500B873C9@gwsmtp.dec.state.ny.us>
Message-ID: <CABG0rfvSaVDg2M8hFZNu40Z16kHwkDcDsdt+EHHhi7cPOXiomQ@mail.gmail.com>

Hi Tim:

Re: stack, yep, it should work.  In general, you get a decreased
performance from stacks since you are having to read from multiple
files rather than a single one, but it will still benefit from
parallel processing.

Re: formula -- the best way for me to test this is to crop out a piece
of your image and send me the random forest model (use ?save), and the
call you were using.  In theory you should be able to use anything you
would normally use on a data frame, but I'd have to play with it to
confirm!  If you can set up those on e.g. google drive I can test it
out.  Cheers!

--j

On Wed, Mar 26, 2014 at 6:49 AM, Tim Howard <tghoward at gw.dec.state.ny.us> wrote:
> Jonathan,
> Thank you for putting this together and for the example. I'm doing two
> things differently with randomForest ... I think perhaps one of them the
> function isn't handling.
>
> First, based on recommendations from Andy Liaw (and ?randomForest), I don't
> use the formula interface but use x=<many columns>, y=<a column> in the
> call. Does predict_rasterEngine handle the absence of a formula in the
> object?
>
> Second, I have many large rasters I want to run the predict on, so making a
> brick would be difficult. I use a rasterStack instead. Does your example
> work with a rasterStack?
>
> I can dive deeper if any of this isn't clear or if these two tweaks work
> just fine for you. I was just trying to swap out this version of predict
> with another parallel version to evaluate speed and, while the alternate
> version works fine, predict_rasterEngine bailed on me.
>
> Thanks in advance.
> Tim Howard
>
>
>
>>>>>>>
> Date: Tue, 18 Mar 2014 22:14:23 -0500
> From: Jonathan Greenberg <jgrn at illinois.edu>
> To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
> Subject: [R-sig-Geo] Parallel predict now in spatial.tools
> Message-ID:
> <CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> R-sig-geo'ers:
>
> I finally got around to building a parallel predict statement that
> I've included in version 1.3.7 (or later) of spatial.tools (check
> http://r-forge.r-project.org/R/?group_id=1492 for the status of the
> build), "predict_rasterEngine".  It should, in theory, be a direct
> swap-in for the standard generic predict() statement.  Currently, it
> will work on any predict.* statement that has the following features:
> 1) The data is passed to the predict as a data frame via a newdata
> parameter, and
> 2) The data is returned from the predict statement as a vector/matrix.
>
> When using predict_rasterEngine, the object= parameter is your model,
> and the newdata= parameter is the raster/brick/stack to apply the
> model to on a pixel-by-pixel basis (note that the names of the layers
> must match the names of the predictor variables, in most cases).
>
> I was hoping to get some stress-testing on this, since it is a fairly
> oft-requested function.  If a predict.* function you'd like to use
> doesn't work, let me know which function it is (with some test data)
> and I'll see if I can tweak it to work.
>
> Right now, I have confirmed this works with randomForest.  Here's an
> example:
>
> ######################
>
> packages_required <- c("spatial.tools","doParallel","randomForest")
> lapply(packages_required, require, character.only=T)
>
> # Load up a 3-band image:
> tahoe_highrez <- setMinMax(
> brick(system.file("external/tahoe_highrez.tif", package="spatial.tools")))
> tahoe_highrez
> plotRGB(tahoe_highrez)
>
> # Load up some training points:
> tahoe_highrez_training_points <- readOGR(
> dsn=system.file("external", package="spatial.tools"),
> layer="tahoe_highrez_training_points")
>
> # Extract data to train the randomForest model:
> tahoe_highrez_training_extract <- extract(
> tahoe_highrez,
> tahoe_highrez_training_points,
> df=TRUE)
>
> # Fuse it back with the SPECIES info:
> tahoe_highrez_training_extract$SPECIES <-
> tahoe_highrez_training_points$SPECIES
>
> # Note the names of the bands:
> names(tahoe_highrez_training_extract) # the extracted data
> names(tahoe_highrez) # the brick
>
> # Generate a randomForest model:
> tahoe_rf <-
> randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
> data=tahoe_highrez_training_extract)
>
> tahoe_rf
>
> # This will run the predict in parallel:
> sfQuickInit()
> prediction_rf_class <-
> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
> prediction_rf_prob <-
> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
> sfQuickStop()
>
> ###############
>
> --j



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From tghoward at gw.dec.state.ny.us  Wed Mar 26 15:48:29 2014
From: tghoward at gw.dec.state.ny.us (Tim Howard)
Date: Wed, 26 Mar 2014 10:48:29 -0400
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
In-Reply-To: <CABG0rfvSaVDg2M8hFZNu40Z16kHwkDcDsdt+EHHhi7cPOXiomQ@mail.gmail.com>
References: <mailman.11.1395226805.12505.r-sig-geo@r-project.org>
	<53328696020000D500B873C9@gwsmtp.dec.state.ny.us>
	<CABG0rfvSaVDg2M8hFZNu40Z16kHwkDcDsdt+EHHhi7cPOXiomQ@mail.gmail.com>
Message-ID: <5332B07D020000D500B87413@gwsmtp.dec.state.ny.us>

Jonathan,
Thanks for your quick reply. I just tried your Tahoe example using x and y in the call rather than a formula and it worked fine, so I was barking up the wrong tree. Sorry. I'll try to delve deeper and put together a subset example for you to check out if I can't get anywhere. 
 
Thanks,
Tim

>>> Jonathan Greenberg <jgrn at illinois.edu> 3/26/2014 10:23 AM >>>
Hi Tim:

Re: stack, yep, it should work.  In general, you get a decreased
performance from stacks since you are having to read from multiple
files rather than a single one, but it will still benefit from
parallel processing.

Re: formula -- the best way for me to test this is to crop out a piece
of your image and send me the random forest model (use ?save), and the
call you were using.  In theory you should be able to use anything you
would normally use on a data frame, but I'd have to play with it to
confirm!  If you can set up those on e.g. google drive I can test it
out.  Cheers!

--j

On Wed, Mar 26, 2014 at 6:49 AM, Tim Howard <tghoward at gw.dec.state.ny.us> wrote:
> Jonathan,
> Thank you for putting this together and for the example. I'm doing two
> things differently with randomForest ... I think perhaps one of them the
> function isn't handling.
>
> First, based on recommendations from Andy Liaw (and ?randomForest), I don't
> use the formula interface but use x=<many columns>, y=<a column> in the
> call. Does predict_rasterEngine handle the absence of a formula in the
> object?
>
> Second, I have many large rasters I want to run the predict on, so making a
> brick would be difficult. I use a rasterStack instead. Does your example
> work with a rasterStack?
>
> I can dive deeper if any of this isn't clear or if these two tweaks work
> just fine for you. I was just trying to swap out this version of predict
> with another parallel version to evaluate speed and, while the alternate
> version works fine, predict_rasterEngine bailed on me.
>
> Thanks in advance.
> Tim Howard
>
>
>
>>>>>>>
> Date: Tue, 18 Mar 2014 22:14:23 -0500
> From: Jonathan Greenberg <jgrn at illinois.edu>
> To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
> Subject: [R-sig-Geo] Parallel predict now in spatial.tools
> Message-ID:
> <CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> R-sig-geo'ers:
>
> I finally got around to building a parallel predict statement that
> I've included in version 1.3.7 (or later) of spatial.tools (check
> http://r-forge.r-project.org/R/?group_id=1492 for the status of the
> build), "predict_rasterEngine".  It should, in theory, be a direct
> swap-in for the standard generic predict() statement.  Currently, it
> will work on any predict.* statement that has the following features:
> 1) The data is passed to the predict as a data frame via a newdata
> parameter, and
> 2) The data is returned from the predict statement as a vector/matrix.
>
> When using predict_rasterEngine, the object= parameter is your model,
> and the newdata= parameter is the raster/brick/stack to apply the
> model to on a pixel-by-pixel basis (note that the names of the layers
> must match the names of the predictor variables, in most cases).
>
> I was hoping to get some stress-testing on this, since it is a fairly
> oft-requested function.  If a predict.* function you'd like to use
> doesn't work, let me know which function it is (with some test data)
> and I'll see if I can tweak it to work.
>
> Right now, I have confirmed this works with randomForest.  Here's an
> example:
>
> ######################
>
> packages_required <- c("spatial.tools","doParallel","randomForest")
> lapply(packages_required, require, character.only=T)
>
> # Load up a 3-band image:
> tahoe_highrez <- setMinMax(
> brick(system.file("external/tahoe_highrez.tif", package="spatial.tools")))
> tahoe_highrez
> plotRGB(tahoe_highrez)
>
> # Load up some training points:
> tahoe_highrez_training_points <- readOGR(
> dsn=system.file("external", package="spatial.tools"),
> layer="tahoe_highrez_training_points")
>
> # Extract data to train the randomForest model:
> tahoe_highrez_training_extract <- extract(
> tahoe_highrez,
> tahoe_highrez_training_points,
> df=TRUE)
>
> # Fuse it back with the SPECIES info:
> tahoe_highrez_training_extract$SPECIES <-
> tahoe_highrez_training_points$SPECIES
>
> # Note the names of the bands:
> names(tahoe_highrez_training_extract) # the extracted data
> names(tahoe_highrez) # the brick
>
> # Generate a randomForest model:
> tahoe_rf <-
> randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
> data=tahoe_highrez_training_extract)
>
> tahoe_rf
>
> # This will run the predict in parallel:
> sfQuickInit()
> prediction_rf_class <-
> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
> prediction_rf_prob <-
> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
> sfQuickStop()
>
> ###############
>
> --j



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140326/08b9e97e/attachment.html>

From jgrn at illinois.edu  Wed Mar 26 15:54:52 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 26 Mar 2014 09:54:52 -0500
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
In-Reply-To: <5332B07D020000D500B87413@gwsmtp.dec.state.ny.us>
References: <mailman.11.1395226805.12505.r-sig-geo@r-project.org>
	<53328696020000D500B873C9@gwsmtp.dec.state.ny.us>
	<CABG0rfvSaVDg2M8hFZNu40Z16kHwkDcDsdt+EHHhi7cPOXiomQ@mail.gmail.com>
	<5332B07D020000D500B87413@gwsmtp.dec.state.ny.us>
Message-ID: <CABG0rfvgkNcjAcvd0PK9Vb9nCVebyDmNUPoeFVh=WDZuJDum2w@mail.gmail.com>

Tim:

One thing to make sure is if the stack has the bands named properly
(they need to match the formula), e.g.:
names(mystack) <- c("b1","b2",...)

If you can also pass along the error you are getting, that will go a
long way towards figuring out the issue!  Cheers!

--j

On Wed, Mar 26, 2014 at 9:48 AM, Tim Howard <tghoward at gw.dec.state.ny.us> wrote:
> Jonathan,
> Thanks for your quick reply. I just tried your Tahoe example using x and y
> in the call rather than a formula and it worked fine, so I was barking up
> the wrong tree. Sorry. I'll try to delve deeper and put together a subset
> example for you to check out if I can't get anywhere.
>
> Thanks,
> Tim
>
>>>> Jonathan Greenberg <jgrn at illinois.edu> 3/26/2014 10:23 AM >>>
>
> Hi Tim:
>
> Re: stack, yep, it should work.  In general, you get a decreased
> performance from stacks since you are having to read from multiple
> files rather than a single one, but it will still benefit from
> parallel processing.
>
> Re: formula -- the best way for me to test this is to crop out a piece
> of your image and send me the random forest model (use ?save), and the
> call you were using.  In theory you should be able to use anything you
> would normally use on a data frame, but I'd have to play with it to
> confirm!  If you can set up those on e.g. google drive I can test it
> out.  Cheers!
>
> --j
>
> On Wed, Mar 26, 2014 at 6:49 AM, Tim Howard <tghoward at gw.dec.state.ny.us>
> wrote:
>> Jonathan,
>> Thank you for putting this together and for the example. I'm doing two
>> things differently with randomForest ... I think perhaps one of them the
>> function isn't handling.
>>
>> First, based on recommendations from Andy Liaw (and ?randomForest), I
>> don't
>> use the formula interface but use x=<many columns>, y=<a column> in the
>> call. Does predict_rasterEngine handle the absence of a formula in the
>> object?
>>
>> Second, I have many large rasters I want to run the predict on, so making
>> a
>> brick would be difficult. I use a rasterStack instead. Does your example
>> work with a rasterStack?
>>
>> I can dive deeper if any of this isn't clear or if these two tweaks work
>> just fine for you. I was just trying to swap out this version of predict
>> with another parallel version to evaluate speed and, while the alternate
>> version works fine, predict_rasterEngine bailed on me.
>>
>> Thanks in advance.
>> Tim Howard
>>
>>
>>
>>>>>>>>
>> Date: Tue, 18 Mar 2014 22:14:23 -0500
>> From: Jonathan Greenberg <jgrn at illinois.edu>
>> To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
>> Subject: [R-sig-Geo] Parallel predict now in spatial.tools
>> Message-ID:
>> <CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ at mail.gmail.com>
>> Content-Type: text/plain; charset=ISO-8859-1
>>
>> R-sig-geo'ers:
>>
>> I finally got around to building a parallel predict statement that
>> I've included in version 1.3.7 (or later) of spatial.tools (check
>> http://r-forge.r-project.org/R/?group_id=1492 for the status of the
>> build), "predict_rasterEngine".  It should, in theory, be a direct
>> swap-in for the standard generic predict() statement.  Currently, it
>> will work on any predict.* statement that has the following features:
>> 1) The data is passed to the predict as a data frame via a newdata
>> parameter, and
>> 2) The data is returned from the predict statement as a vector/matrix.
>>
>> When using predict_rasterEngine, the object= parameter is your model,
>> and the newdata= parameter is the raster/brick/stack to apply the
>> model to on a pixel-by-pixel basis (note that the names of the layers
>> must match the names of the predictor variables, in most cases).
>>
>> I was hoping to get some stress-testing on this, since it is a fairly
>> oft-requested function.  If a predict.* function you'd like to use
>> doesn't work, let me know which function it is (with some test data)
>> and I'll see if I can tweak it to work.
>>
>> Right now, I have confirmed this works with randomForest.  Here's an
>> example:
>>
>> ######################
>>
>> packages_required <- c("spatial.tools","doParallel","randomForest")
>> lapply(packages_required, require, character.only=T)
>>
>> # Load up a 3-band image:
>> tahoe_highrez <- setMinMax(
>> brick(system.file("external/tahoe_highrez.tif", package="spatial.tools")))
>> tahoe_highrez
>> plotRGB(tahoe_highrez)
>>
>> # Load up some training points:
>> tahoe_highrez_training_points <- readOGR(
>> dsn=system.file("external", package="spatial.tools"),
>> layer="tahoe_highrez_training_points")
>>
>> # Extract data to train the randomForest model:
>> tahoe_highrez_training_extract <- extract(
>> tahoe_highrez,
>> tahoe_highrez_training_points,
>> df=TRUE)
>>
>> # Fuse it back with the SPECIES info:
>> tahoe_highrez_training_extract$SPECIES <-
>> tahoe_highrez_training_points$SPECIES
>>
>> # Note the names of the bands:
>> names(tahoe_highrez_training_extract) # the extracted data
>> names(tahoe_highrez) # the brick
>>
>> # Generate a randomForest model:
>> tahoe_rf <-
>> randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
>> data=tahoe_highrez_training_extract)
>>
>> tahoe_rf
>>
>> # This will run the predict in parallel:
>> sfQuickInit()
>> prediction_rf_class <-
>>
>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
>> prediction_rf_prob <-
>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
>> sfQuickStop()
>>
>> ###############
>>
>> --j
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From nature.aseem at gmail.com  Thu Mar 27 00:10:08 2014
From: nature.aseem at gmail.com (Aseem Sharma)
Date: Wed, 26 Mar 2014 16:10:08 -0700
Subject: [R-sig-Geo] Display Long Lat in place of Easting and Northing in
	ggplot2
Message-ID: <CAPB42UyABi4CLbR21fBuE=bM+t-KBofQvwTMutqJnkL0ZrKd_A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140326/b6df63b2/attachment.pl>

From bakare at ualberta.ca  Thu Mar 27 03:04:22 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Wed, 26 Mar 2014 20:04:22 -0600
Subject: [R-sig-Geo] Practical range spatial dependency- Exponential
	variogram model
Message-ID: <CAJRR3XNGX0sW0SPJnR3pZNFXq4CAsjcSoAVFZy-BEvQ6SSOkJA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140326/08872b73/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Mar 27 11:50:17 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 27 Mar 2014 10:50:17 +0000
Subject: [R-sig-Geo] Display Long Lat in place of Easting and Northing
	in ggplot2
In-Reply-To: <cc5a693c00864933a4f577898577b695@EX-0-HT0.lancs.local>
References: <cc5a693c00864933a4f577898577b695@EX-0-HT0.lancs.local>
Message-ID: <CANVKczM68NG6J8SGywyKtC3xmmZP=w14M=SCLxM755c=x6-GpQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140327/f268efb5/attachment.pl>

From alessandracarioli at gmail.com  Thu Mar 27 12:34:21 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Thu, 27 Mar 2014 12:34:21 +0100
Subject: [R-sig-Geo] cluster maps with NAs
References: <365A3BB0-30AA-4A53-B811-490ECD3E26BF@nidi.nl>
Message-ID: <5C2A2190-9F69-4FA3-9E50-847B1EBC5075@gmail.com>

Dear All,

I am doing cluster maps (spatial polygons) for some variables which contain NAs. Everything goes smoothly until I try to derive the 4 sectors High-High/Low?Low. At that point I get this error message:

Error in if (varofint[[i]] >= m.varofint & varlag[[i]] >= m.varlag) sec[i] <- 1 : missing value where TRUE/FALSE needed

I have tried a couple of things to get around the problem but nothing seems to work so far. Any help on the issue is greatly appreciated!

Ale

Here is my code:

library(spdep)
listw <- nb2listw(nb) #nb is my neighbor matrix
varofint #variable to be plotted
varofint.name <- "Princeton Index 1997 Clusters?
varlag <-lag.listw(listw, varofint, NAOK=T) 
# Calculate Mean of Variable of interest and lagged value of variable of interest
m.varofint <- mean(varofint,na.rm=T)
m.varlag <- mean(varlag,na.rm=T)
# Calculate Lisa Test
lisa.FOQ <- localmoran(varofint,listw, alternative="two.sided",na.action=na.exclude)
# Get significance level
vec <- c(1:n)
significance <- 0.05
vec <- ifelse(lisa.FOQ[,5] < significance, 1,0)
plot.only.significant <- TRUE # to plot only significant areas below 0.05
# Derive sector HERE IS THE PROBLEM
sec <- c(1:n)
for (i in 1:n) {
 if (varofint[[i]]>=m.varofint & varlag[[i]]>=m.varlag) sec[i] <- 1
 if (varofint[[i]]<m.varofint & varlag[[i]]<m.varlag) sec[i] <- 2
 if (varofint[[i]]<m.varofint & varlag[[i]]>=m.varlag) sec[i] <- 3
 if (varofint[[i]]>=m.varofint & varlag[[i]]<m.varlag) sec[i] <- 4
}

# Define colors for sectors: this works fine
sec.all <- sec
colors1 <- c(1:n)
for (i in 1:n) {
 if (sec.all[i]==1) colors1[i] <- ?red"
 if (sec.all[i]==2) colors1[i] <- ?blue"
 if (sec.all[i]==3) colors1[i] <- ?lightblue"
 if (sec.all[i]==4) colors1[i] <- ?pink"
 if (sec.all[i]==0) colors1[i] <- ?white"
}
loc.m.data <- sec*vec
colors2 <- colors1
for (i in 1:n) {
 if (loc.m.data[i]==0) colors2[i] <- ?white? # ERROR MESSAGE COMES AGAIN
}


From liov2067 at gmail.com  Thu Mar 27 12:55:51 2014
From: liov2067 at gmail.com (=?ISO-8859-1?Q?Luis_Iv=E1n_Ortiz_Valencia?=)
Date: Thu, 27 Mar 2014 08:55:51 -0300
Subject: [R-sig-Geo] cluster maps with NAs
In-Reply-To: <5C2A2190-9F69-4FA3-9E50-847B1EBC5075@gmail.com>
References: <365A3BB0-30AA-4A53-B811-490ECD3E26BF@nidi.nl>
	<5C2A2190-9F69-4FA3-9E50-847B1EBC5075@gmail.com>
Message-ID: <CAJ+S-MG59CO6Xq+C7YoguaegPLv04vyXxhYLyHovBE2H=x_E2g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140327/15b87ee1/attachment.pl>

From rolandh at uni-muenster.de  Thu Mar 27 12:59:34 2014
From: rolandh at uni-muenster.de (rolandh at uni-muenster.de)
Date: Thu, 27 Mar 2014 12:59:34 +0100 (CET)
Subject: [R-sig-Geo] spplot of SpatialGridDateFrame (sparsely populated with
	data) fails
Message-ID: <permail-201403271159349e949f53000074df-rolandh@message-id.uni-muenster.de>

Hello R-users!

I want to plot SpatialGridDataFrames with spplot() and I get some strange /
unexpected / irregular results in some special cases:

For testing and illustration issues I have created 4 SpatialGridDataFrames by
aggregation from the same SpatialPointDataFrame (attribute)  (which is
populated with a lot of NA values). When I check the data, I see that there is
just one grid cell that is populated with data in the SpatialGridDataFrames.

If I try to plot these four SpatialGridDataFrames with spplot(), just one of
the spplots finishes successfully.
The others throw an error...


Overview of the creation of the SpatialGridDataFrames and the errors /
returns:

a) spGridDF_builtByMeanAsAggFct
Packages used: raster, sp.
I built a raster layer and aggregated the data by using the method rasterize()
and the aggregation function "mean".
Then I used as(... , "SpatialGridDataFrame"). When I try to plot with spplot()
I get:
Error in validObject(.Object) :
  invalid class ?SpatialPoints? object: invalid object for slot "coords" in
  class "SpatialPoints": got class "numeric", should be or extend class
  "matrix"
I get the same error when I use "median" or "sd" as aggregation function.

b) spGridDF_builtByMinAsAggFct
Here I did the same as above (!) but I just used "min" (!) as aggregation
function and spplot() finishes successfully! The plot contains one grid cell.
That is fine and it is what I expected. I also get a plot when I use "max" as
aggregation function.
I do not understand the relationship of the selected aggregation function and
the spplot result (error, success).

c) spGridDF_builtByPkgSP_minAsAggFct
Packages used: sp
After the creation of the grid I aggregated the data using the method
aggregate() with "min" as aggregation function.
When I try to plot with spplot() I get:
Error in seq.default(zrng[1], zrng[2], length.out = cuts + 2) :
  'from' cannot be NA, NaN or infinite
Zus?tzlich: Warnmeldungen: (warnings)
1: In asMethod(object) :
  complete map seems to be NA's -- no selection was made
2: In min(x) : kein nicht-fehlendes Argument f?r min; gebe Inf zur?ck
3: In max(x) : kein nicht-fehlendes Argument f?r max; gebe -Inf zur?ck

d) spGridDF_builtByPkgSP_withoutNA_minAsAggFct
In this case I did the same as above [case c)], but I removed the NA values in
the SpatialPointDataFrame with subset(spdf_wgs,
complete.cases(spdf_wgs[[attribute]])) before I used the aggregate() method.
When I try to plot with spplot() I get (again):
Error in validObject(.Object) :
  invalid class ?SpatialPoints? object: invalid object for slot "coords" in
  class "SpatialPoints": got class "numeric", should be or extend class
  "matrix"


If you want to check the data, you may get an .RData file containing the 4
SpatialGridDataFrames and the SpatialPointDataFrame on:
https://github.com/LarsGH/Geosoftware2GroupC/tree/master/R/spplot_problem.RData


What may be the problem causing spplot to fail?

And, even more important, how may I avoid that problem?


I would be very happy if someone could please help me.

Thank you very much in advance!

Greetings!

Roland


###
>sessionInfo()

R version 3.0.3 (2014-03-06)
Platform: i686-pc-linux-gnu (32-bit)

locale:
 [1] LC_CTYPE=de_DE.UTF-8       LC_NUMERIC=C               LC_TIME=de_DE.UTF-8
 LC_COLLATE=de_DE.UTF-8
 [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=de_DE.UTF-8
 LC_PAPER=de_DE.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
 LC_MEASUREMENT=de_DE.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
 [1] colorRamps_2.3      plyr_1.8            Cairo_1.5-5
 latticeExtra_0.6-26 RColorBrewer_1.0-5
 [6] ggmap_2.3           ggplot2_0.9.3.1     raster_2.2-12
 lattice_0.20-27     RCurl_1.95-4.1
[11] bitops_1.0-6        maptools_0.8-27     rgdal_0.8-14        sp_1.0-14
futile.logger_1.3.7
[16] rjson_0.2.13

loaded via a namespace (and not attached):
 [1] colorspace_1.2-4     dichromat_2.0-0      digest_0.6.4
 foreign_0.8-59       futile.options_1.0.0
 [6] grid_3.0.3           gtable_0.1.2         labeling_0.2
 lambda.r_1.1.6       mapproj_1.2-2
[11] maps_2.3-6           MASS_7.3-30          munsell_0.4.2        png_0.1-7
proto_0.3-10
[16] reshape2_1.2.2       RgoogleMaps_1.2.0.5  RJSONIO_1.0-3
scales_0.2.3         stringr_0.6.2
[21] tools_3.0.3
###

###
>library(help=sp)

                Information on package ?sp?

Description:

Package:            sp
Version:            1.0-14
Date:               2013-10-15
Title:              classes and methods for spatial data
Authors at R:          c(person("Edzer", "Pebesma", role = c("aut", "cre"), email
=
                    "edzer.pebesma at uni-muenster.de"), person("Roger",
                    "Bivand", role = "aut", email =
                    "Roger.Bivand at nhh.no"), person("Barry", "Rowlingson", role
                    = "ctb"),
                    person("Virgilio", "Gomez-Rubio", role = "ctb"))
Depends:            R (>= 2.14.0)
Imports:            methods, graphics, utils, lattice, grid
Suggests:           RColorBrewer, rgdal (>= 0.8-7), rgeos (>= 0.2-20), gstat
Description:        A package that provides classes and methods for spatial
data. The classes
                    document where the spatial location information resides,
                    for 2D or 3D data.
                    Utility functions are provided, e.g. for plotting data as
                    maps, spatial
                    selection, as well as methods for retrieving coordinates,
                    for subsetting, print,
                    summary, etc.
License:            GPL (>= 2)
URL:                https://r-forge.r-project.org/projects/rspatial/
                    http://rspatial.r-forge.r-project.org/
Collate:            AAA.R Class-CRS.R CRS-methods.R Class-Spatial.R
Spatial-methods.R projected.R
                    Class-SpatialPoints.R SpatialPoints-methods.R
                    Class-SpatialPointsDataFrame.R
                    SpatialPointsDataFrame-methods.R Class-GridTopology.R
                    Class-SpatialGrid.R
                    Class-SpatialGridDataFrame.R Class-SpatialLines.R
                    SpatialLines-methods.R
                    Class-SpatialLinesDataFrame.R
                    SpatialLinesDataFrame-methods.R
                    Class-SpatialPolygons.R Class-SpatialPolygonsDataFrame.R
                    SpatialPolygons-methods.R
                    SpatialPolygonsDataFrame-methods.R
                    GridTopology-methods.R SpatialGrid-methods.R
                    SpatialGridDataFrame-methods.R
                    SpatialPolygons-internals.R point.in.polygon.R
                    SpatialPolygons-displayMethods.R
                    zerodist.R image.R stack.R bpy.colors.R bubble.R mapasp.R
                    select.spatial.R
                    gridded.R asciigrid.R spplot.R over.R overlay.R spsample.R
                    recenter.R dms.R
                    gridlines.R spdists.R rbind.R flipSGDF.R chfids.R
                    loadmeuse.R compassRose.R
                    surfaceArea.R spOptions.R subset.R disaggregate.R
                    sp_spat1.R merge.R
Packaged:           2013-10-23 11:03:37 UTC; edzer
Author:             Edzer Pebesma [aut, cre], Roger Bivand [aut], Barry
Rowlingson [ctb], Virgilio
                    Gomez-Rubio [ctb]
Maintainer:         Edzer Pebesma <edzer.pebesma at uni-muenster.de>
NeedsCompilation:   yes
Repository:         CRAN
Date/Publication:   2013-10-24 09:38:03
Built:              R 3.0.2; i686-pc-linux-gnu; 2013-12-11 13:36:45 UTC; unix
###


From edzer.pebesma at uni-muenster.de  Thu Mar 27 13:03:19 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 27 Mar 2014 13:03:19 +0100
Subject: [R-sig-Geo] Practical range spatial dependency- Exponential
 variogram model
In-Reply-To: <CAJRR3XNGX0sW0SPJnR3pZNFXq4CAsjcSoAVFZy-BEvQ6SSOkJA@mail.gmail.com>
References: <CAJRR3XNGX0sW0SPJnR3pZNFXq4CAsjcSoAVFZy-BEvQ6SSOkJA@mail.gmail.com>
Message-ID: <53341387.10104@uni-muenster.de>



On 03/27/2014 03:04 AM, Moshood Agba Bakare wrote:
> Dear All,
> 
> An exponential model is fitted to empirical semivariogram using *gstat of R
> package*. The variogram parameters obtained is
>   model      psill   range
> 1   Nug 0.04281109 0.00000
> 2   Exp 0.76810071 5.45954
> where the nugget effect is 0.04, sill is approximately 0.80, and range is
> 5.5.
> Since exponential model approaches the sill asymptotically, its practical
> range of spatial dependency is reported by literature to be distance at
> which the semivariance is 95% of the sill.
> Having obtained 5.5 as my range from the analysis, how do I estimate the
> practical range at 95% of sill?

3 * range:

> 1-exp(-3)
[1] 0.9502129

which can be confirmed by:

> variogramLine(vgm(1, "Exp", 1), dist_vector = 3)
  dist     gamma
1    3 0.9502129

> 
> Thank you.
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140327/d8dd29b8/attachment.bin>

From alessandracarioli at gmail.com  Thu Mar 27 13:46:32 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Thu, 27 Mar 2014 13:46:32 +0100
Subject: [R-sig-Geo] cluster maps with NAs
In-Reply-To: <CAJ+S-MH_5Z3tyeV8pL4cMtye7+G+NehSZjgcfKDs=aAbfSE8MQ@mail.gmail.com>
References: <365A3BB0-30AA-4A53-B811-490ECD3E26BF@nidi.nl>
	<5C2A2190-9F69-4FA3-9E50-847B1EBC5075@gmail.com>
	<CAJ+S-MG59CO6Xq+C7YoguaegPLv04vyXxhYLyHovBE2H=x_E2g@mail.gmail.com>
	<C174A1C0-1E0A-4EAD-94D2-D7EC0CE5F1E1@gmail.com>
	<CAJ+S-MFBb--43LjUs1d4kJwx_gjwLPQbVQnV_t4aB+uswPtkVQ@mail.gmail.com>
	<84EF3357-078A-4EA7-A345-14E2E8D9306B@gmail.com>
	<CAJ+S-MH_5Z3tyeV8pL4cMtye7+G+NehSZjgcfKDs=aAbfSE8MQ@mail.gmail.com>
Message-ID: <2401C491-5CAE-45B2-BA8E-749FB2650818@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140327/192082b7/attachment.pl>

From alessandracarioli at gmail.com  Thu Mar 27 15:35:19 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Thu, 27 Mar 2014 15:35:19 +0100
Subject: [R-sig-Geo] cluster maps with NAs
In-Reply-To: <CAJ+S-MH_v0VXrN8qj27iGGDo_SUFrcHYTbdr8y2xnjB55L9npQ@mail.gmail.com>
References: <365A3BB0-30AA-4A53-B811-490ECD3E26BF@nidi.nl>
	<5C2A2190-9F69-4FA3-9E50-847B1EBC5075@gmail.com>
	<CAJ+S-MG59CO6Xq+C7YoguaegPLv04vyXxhYLyHovBE2H=x_E2g@mail.gmail.com>
	<C174A1C0-1E0A-4EAD-94D2-D7EC0CE5F1E1@gmail.com>
	<CAJ+S-MFBb--43LjUs1d4kJwx_gjwLPQbVQnV_t4aB+uswPtkVQ@mail.gmail.com>
	<84EF3357-078A-4EA7-A345-14E2E8D9306B@gmail.com>
	<CAJ+S-MH_5Z3tyeV8pL4cMtye7+G+NehSZjgcfKDs=aAbfSE8MQ@mail.gmail.com>
	<2401C491-5CAE-45B2-BA8E-749FB2650818@gmail.com>
	<CAJ+S-MGD4t8FAkKQDqBU4YZqg6Krt4Bb=+uFGKu725qNNoEAig@mail.gmail.com>
	<DF8623A6-7D2F-4E5E-9D2C-80014466AF9D@gmail.com>
	<CAJ+S-MH_v0VXrN8qj27iGGDo_SUFrcHYTbdr8y2xnjB55L9npQ@mail.gmail.com>
Message-ID: <5F0AAC68-DAE1-4AF5-B750-AE6EB4AFC5FB@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140327/88fca113/attachment.pl>

From bakare at ualberta.ca  Thu Mar 27 18:25:26 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Thu, 27 Mar 2014 11:25:26 -0600
Subject: [R-sig-Geo] Cross validation fitted models- krige.cv
Message-ID: <CAJRR3XOuxX-0RkWEwkNdBVXSRMuX1CzbnY38WHUxxQ5EFuirQw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140327/001f594f/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Mar 27 19:06:32 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 27 Mar 2014 19:06:32 +0100
Subject: [R-sig-Geo] Cross validation fitted models- krige.cv
In-Reply-To: <CAJRR3XOuxX-0RkWEwkNdBVXSRMuX1CzbnY38WHUxxQ5EFuirQw@mail.gmail.com>
References: <CAJRR3XOuxX-0RkWEwkNdBVXSRMuX1CzbnY38WHUxxQ5EFuirQw@mail.gmail.com>
Message-ID: <533468A8.6090904@uni-muenster.de>



On 03/27/2014 06:25 PM, Moshood Agba Bakare wrote:
> Dear All,
> Common variogram models were fitted to empirical variogram with the
> following range of spatial dependency obtained.
> *model *                 *range*
> Spherical                14.2
> Gaussian                   7.5
> Exponential                5.5
> Linear                       10.4
> 
> I intend to cross validate the models to determine the best that capture
> the spatial pattern.I thought of defining *maxdist option *to be the value
> of range so the the prediction can be done by the points within the range
> of spatial dependency. Am I doing the right thing? Using range as maxdist,
> will it give me a reliable RMSE and MSDR diagnostic statistics?
> 
> #### Cross validation of the variogram models by ordinary kriging
> sph.kcv <- krige.cv(yield ~ 1, canmod.sp, model = sph.var,nmax = 100, nfold
> = 5, *maxdist = 14.2*)
> gau.kcv <- krige.cv(yield ~ 1, canmod.sp, model = gau.var,nmax = 100, nfold
> = 5,* maxdist = 7.5*)exp.kcv <- krige.cv(yield ~ 1, canmod.sp, model =
> exp.var,nmax = 100, nfold = 5, *maxdist = 5.5*)
>   lin.kcv <- krige.cv(yield ~ 1, canmod.sp, model =    lin.var,nmax = 100,
> nfold = 5, *maxdist=10.4*)
> 

See also my previous reply earlier today -- if you want to have
distances at which spatial correlation is below 5%, take range * 3 for
Exponential and range * sqrt(3) for Gaussian.

As you use ordinary kriging, also observations further away than the
(effective) range play a role in the prediction, so that is not a reason
why they should be ignored.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140327/db1369fb/attachment.bin>

From lockhart.katherine at gmail.com  Fri Mar 28 01:33:12 2014
From: lockhart.katherine at gmail.com (Katherine Lockhart)
Date: Thu, 27 Mar 2014 17:33:12 -0700
Subject: [R-sig-Geo] mcmcplots package: How to plot each parameter of a
 caterplot in a different color?
Message-ID: <CAMEAd6zexCvpYh0S+yKOuEZEjvjf572cgR+SUbHPezmMNLZkKg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140327/8a542704/attachment.pl>

From tghoward at gw.dec.state.ny.us  Fri Mar 28 14:58:33 2014
From: tghoward at gw.dec.state.ny.us (Tim Howard)
Date: Fri, 28 Mar 2014 09:58:33 -0400
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
Message-ID: <533547C9020000D500B875B9@gwsmtp.dec.state.ny.us>

Jonathan,
Thanks again for your reply. 
I'll reply inline ... please see below

>>>> Jonathan Greenberg <jgrn at illinois.edu> 03/26/14 10:55 AM >>>
>Tim:
>
>One thing to make sure is if the stack has the bands named properly
>>(they need to match the formula), e.g.:
>>names(mystack) <- c("b1","b2",...)

Yes, I think I'm good on layer names, as well as maintaining all the
levels in categorical data (a classic gotcha for RF). 

>
>If you can also pass along the error you are getting, that will go a
>long way towards figuring out the issue! Cheers!

I was a little reluctant to pass on the error message until I knew a
little more. The main reason being that the normal predict function with
raster *does* work even though you might not expect it with the error
message. Here is the error coming out of predict_rasterEngine:
 
> sfQuickInit(cpus=6)
socket cluster with 6 nodes on host ?localhost?
> prediction_rf_prob <- predict_rasterEngine(object=rf.full,
newdata=envStack, newtype='prob')
Error in predict.randomForest(object = object, newdata = newdata_df,
mget(model_parameters)) : 
  missing values in newdata
> sfQuickStop()
 

Again, I can run these exact data using raster:::predict and I get good
output.  To me that means I do not have 'missing values in newdata'. I
welcome thoughts otherwise, however. The predict call is structured like
this:

prediction_rf_prob <- predict(object=envStack, model=rf.full,
type='prob', progress = 'text')

So, I've tried recreating the problem by tweaking the Tahoe data. Below,
I've added a categorical layer to the brick. Unfortunately, it errors
out with a new error. (Null external pointer).  (Am I right that
raster:::predict and predict_rasterEngine use the term "object"
differently?)

I'll paste a replacement set of code for the Tahoe data below our
string.

I welcome comments on any of this!

Cheers, 
Tim

>--j
>
>On Wed, Mar 26, 2014 at 9:48 AM, Tim Howard
<tghoward at gw.dec.state.ny.us> wrote:
>> Jonathan,
>> Thanks for your quick reply. I just tried your Tahoe example using x
and y
>> in the call rather than a formula and it worked fine, so I was
barking up
>> the wrong tree. Sorry. I'll try to delve deeper and put together a
subset
>> example for you to check out if I can't get anywhere.
>>
>> Thanks,
>> Tim
>>
>>>>> Jonathan Greenberg <jgrn at illinois.edu> 3/26/2014 10:23 AM >>>
>>
>> Hi Tim:
>>
>> Re: stack, yep, it should work. In general, you get a decreased
>> performance from stacks since you are having to read from multiple
>> files rather than a single one, but it will still benefit from
>> parallel processing.
>>
>> Re: formula -- the best way for me to test this is to crop out a
piece
>> of your image and send me the random forest model (use ?save), and
the
>> call you were using. In theory you should be able to use anything you
>> would normally use on a data frame, but I'd have to play with it to
>> confirm! If you can set up those on e.g. google drive I can test it
>> out. Cheers!
>>
>> --j
>>
>> On Wed, Mar 26, 2014 at 6:49 AM, Tim Howard
<tghoward at gw.dec.state.ny.us>
>> wrote:
>>> Jonathan,
>>> Thank you for putting this together and for the example. I'm doing
two
>>> things differently with randomForest ... I think perhaps one of them
the
>>> function isn't handling.
>>>
>>> First, based on recommendations from Andy Liaw (and ?randomForest),
I
>>> don't
>>> use the formula interface but use x=<many columns>, y=<a column> in
the
>>> call. Does predict_rasterEngine handle the absence of a formula in
the
>>> object?
>>>
>>> Second, I have many large rasters I want to run the predict on, so
making
>>> a
>>> brick would be difficult. I use a rasterStack instead. Does your
example
>>> work with a rasterStack?
>>>
>>> I can dive deeper if any of this isn't clear or if these two tweaks
work
>>> just fine for you. I was just trying to swap out this version of
predict
>>> with another parallel version to evaluate speed and, while the
alternate
>>> version works>>> Date: Tue, 18 Mar 2014 22:14:23 -0500
>>> From: Jonathan Greenberg <jgrn at illinois.edu>
>>> To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
>>> Subject: [R-sig-Geo] Parallel predict now in spatial.tools
>>> Message-ID:
>>> <CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ at mail.gmail.com>
>>> Content-Type: text/plain; charset=ISO-8859-1
>>>
>>> R-sig-geo'ers:
>>>
>>> I finally got around to building a parallel predict statement that
>>> I've included in version 1.3.7 (or later) of spatial.tools (check
>>> http://r-forge.r-project.org/R/?group_id=1492 for the status of the
>>> build), "predict_rasterEngine". It should, in theory, be a direct
>>> swap-in for the standard generic predict() statement. Currently, it
>>> will work on any predict.* statement that has the following
features:
>>> 1) The data is passed to the predict as a data frame via a newdata
>>> parameter, and
>>> 2) The data is returned from the predict statement as a
vector/matrix.
>>>
>>> When using predict_rasterEngine, the object= parameter is your
model,
>>> and the newdata= parameter is the raster/brick/stack to apply the
>>> model to on a pixel-by-pixel basis (note that the names of the
layers
>>> must match the names of the predictor variables, in most cases).
>>>
>>> I was hoping to get some stress-testing on this, since it is a
fairly
>>> oft-requested function. If a predict.* function you'd like to use
>>> doesn't work, let me know which function it is (with some test data)
>>> and I'll see if I can tweak it to work.
>>>
>>> Right now, I have confirmed this works with randomForest. Here's an
>>> example:
>>>
>>> ######################
>>>
>>> packages_required <- c("spatial.tools","doParallel","randomForest")
>>> lapply(packages_required, require, character.only=T)
>>>
>>> # Load up a 3-band image:
>>> tahoe_highrez <- setMinMax(
>>> brick(system.file("external/tahoe_highrez.tif",
package="spatial.tools")))
>>> tahoe_highrez
>>> plotRGB(tahoe_highrez)
>>>
>>> # Load up some training points:
>>> tahoe_highrez_training_points <- readOGR(
>>> dsn=system.file("external", package="spatial.tools"),
>>> layer="tahoe_highrez_training_points")
>>>
>>> # Extract data to train the randomForest model:
>>> tahoe_highrez_training_extract <- extract(
>>> tahoe_highrez,
>>> tahoe_highrez_training_points,
>>> df=TRUE)
>>>
>>> # Fuse it back with the SPECIES info:
>>> tahoe_highrez_training_extract$SPECIES <-
>>> tahoe_highrez_training_points$SPECIES
>>>
>>> # Note the names of the bands:
>>> names(tahoe_highrez_training_extract) # the extracted data
>>> names(tahoe_highrez) # the brick
>>>
>>> # Generate a randomForest model:
>>> tahoe_rf <-
>>>
randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
>>> data=tahoe_highrez_training_extract)
>>>
>>> tahoe_rf
>>>
>>> # This will run the predict in parallel:
>>> sfQuickInit()
>>> prediction_rf_class <-
>>>
>>>
predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
>>> prediction_rf_prob <-
>>>
predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
>>> sfQuickStop()
>>>
>>> ###############
>>>
>>> --j
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL 61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype:
jgrn3007

#here is a script that adds a categorical layer to the tahoe brick,
creates a RF model
#and then tries both raster:::predict and  predict_rasterEngine.

packages_required <- c("spatial.tools","doParallel","randomForest")
lapply(packages_required, require, character.only=T)

# Load up a 3-band image:
tahoe_highrez <- setMinMax(
brick(system.file("external/tah#create a categorical layer from band 1
mat <- matrix(c(0,50,1,50,150,2,150,255,3),ncol=3,byrow=TRUE)
bnd1cat <- reclassify(tahoe_highrez[[1]], rcl=mat)
bnd1cat <- ratify(bnd1cat)
rat <- levels(bnd1cat)[[1]]
rat$types <- c('type1', 'type2', 'type3', 'type4')
rat$code <- c(1,2,3,4)
levels(bnd1cat) <- rat

#library(rasterVis) #if you want a categorical plot
#levelplot(bnd1_rc2)

tahoe_highrez <- addLayer(tahoe_highrez, bnd1cat)
names(tahoe_highrez) <-
c("tahoeOne","tahoeTwo","tahoeThree","tahoeCatFour")

# Load up some training points:
tahoe_highrez_training_points <- readOGR(
    dsn=system.file("external", package="spatial.tools"),
    layer="tahoe_highrez_training_points")

# Extract data to train the randomForest model:
tahoe_highrez_training_extract <-
extract(tahoe_highrez,tahoe_highrez_training_points,df=TRUE)

# Fuse it back with the SPECIES info:
tahoe_highrez_training_extract$SPECIES <-
tahoe_highrez_training_points$SPECIES

# Note the names of the bands:
names(tahoe_highrez_training_extract) # the extracted data
names(tahoe_highrez) # the brick

# convert to factor, ensure all the levels are there
tahoe_highrez_training_extract$tahoeCatFour <-
factor(tahoe_highrez_training_extract$tahoeCatFour)
levels(tahoe_highrez_training_extract$tahoeCatFour) <- c(1,2,3,4)
str(tahoe_highrez_training_extract)

# Generate a randomForest model:
tahoe_rf <- randomForest(y=tahoe_highrez_training_extract$SPECIES, 
                            x=tahoe_highrez_training_extract[,2:5],
                            data=tahoe_highrez_training_extract)


# try it with standard predict call -- this works                       
    
predict1_rf_prob <- predict(object=tahoe_highrez, model=tahoe_rf,
type="prob")

# try it with rasterEngine -- this fails
sfQuickInit()
predict2_rf_prob <-
predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
sfQuickStop()

plot(predict1_rf_prob)




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140328/5bb48236/attachment.html>

From jgrn at illinois.edu  Fri Mar 28 15:38:46 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 28 Mar 2014 09:38:46 -0500
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
In-Reply-To: <533547C9020000D500B875B9@gwsmtp.dec.state.ny.us>
References: <533547C9020000D500B875B9@gwsmtp.dec.state.ny.us>
Message-ID: <CABG0rfvZGnTHCaAnMaZ9OsBLLjXaTb-3obn6xySSk=ioDz3AAA@mail.gmail.com>

Tim:

I notice you have:

predict_rasterEngine(object=rf.full, newdata=envStack, newtype='prob')

Was that a typo in your email? If not, this might be your issue -- the
correct parameter is "type", not "newtype" -- I noticed you are using
"type" in the raster:::predict:

?predict.randomForest

If you still get that error when you use type="prob", I think the
issue is that the raster probably has NA values (that is what usually
triggers the "missing values in newdata" error for
predict.randomForest) -- this is a valid issue, so I'll need to fix
the code a bit to deal with it -- can you confirm if its the newtype
issue first?  I can probably push out a fix later this weekend if it
is, indeed, the NA issue.

Another important issue is that I don't, at present, support the RAT,
but I can also work on a fix for that.

You are correct re: the object is the model, and the newdata parameter
is the raster/brick/stack.

Cheers!

--j

On Fri, Mar 28, 2014 at 8:58 AM, Tim Howard <tghoward at gw.dec.state.ny.us> wrote:
> Jonathan,
> Thanks again for your reply.
> I'll reply inline ... please see below
>
>>>>> Jonathan Greenberg <jgrn at illinois.edu> 03/26/14 10:55 AM >>>
>
>>Tim:
>>
>>One thing to make sure is if the stack has the bands named properly
>>>(they need to match the formula), e.g.:
>>>names(mystack) <- c("b1","b2",...)
>
> Yes, I think I'm good on layer names, as well as maintaining all the levels
> in categorical data (a classic gotcha for RF).
>
>>
>>If you can also pass along the error you are getting, that will go a
>>long way towards figuring out the issue! Cheers!
>
> I was a little reluctant to pass on the error message until I knew a little
> more. The main reason being that the normal predict function with raster
> *does* work even though you might not expect it with the error message. Here
> is the error coming out of predict_rasterEngine:
>
>> sfQuickInit(cpus=6)
> socket cluster with 6 nodes on host 'localhost'
>> prediction_rf_prob <- predict_rasterEngine(object=rf.full,
>> newdata=envStack, newtype='prob')
> Error in predict.randomForest(object = object, newdata = newdata_df,
> mget(model_parameters)) :
>   missing values in newdata
>> sfQuickStop()
>
>
> Again, I can run these exact data using raster:::predict and I get good
> output.  To me that means I do not have 'missing values in newdata'. I
> welcome thoughts otherwise, however. The predict call is structured like
> this:
>
> prediction_rf_prob <- predict(object=envStack, model=rf.full, type='prob',
> progress = 'text')
>
> So, I've tried recreating the problem by tweaking the Tahoe data. Below,
> I've added a categorical layer to the brick. Unfortunately, it errors out
> with a new error. (Null external pointer).  (Am I right that
> raster:::predict and predict_rasterEngine use the term "object"
> differently?)
>
> I'll paste a replacement set of code for the Tahoe data below our string.
>
> I welcome comments on any of this!
>
> Cheers,
> Tim
>
>
>>--j
>>
>>On Wed, Mar 26, 2014 at 9:48 AM, Tim Howard <tghoward at gw.dec.state.ny.us>
>> wrote:
>>> Jonathan,
>>> Thanks for your quick reply. I just tried your Tahoe example using x and
>>> y
>>> in the call rather than a formula and it worked fine, so I was barking up
>>> the wrong tree. Sorry. I'll try to delve deeper and put together a subset
>>> example for you to check out if I can't get anywhere.
>>>
>>> Thanks,
>>> Tim
>>>
>>>>>> Jonathan Greenberg <jgrn at illinois.edu> 3/26/2014 10:23 AM >>>
>>>
>>> Hi Tim:
>>>
>>> Re: stack, yep, it should work. In general, you get a decreased
>>> performance from stacks since you are having to read from multiple
>>> files rather than a single one, but it will still benefit from
>>> parallel processing.
>>>
>>> Re: formula -- the best way for me to test this is to crop out a piece
>>> of your image and send me the random forest model (use ?save), and the
>>> call you were using. In theory you should be able to use anything you
>>> would normally use on a data frame, but I'd have to play with it to
>>> confirm! If you can set up those on e.g. google drive I can test it
>>> out. Cheers!
>>>
>>> --j
>>>
>>> On Wed, Mar 26, 2014 at 6:49 AM, Tim Howard <tghoward at gw.dec.state.ny.us>
>>> wrote:
>>>> Jonathan,
>>>> Thank you for putting this together and for the example. I'm doing two
>>>> things differently with randomForest ... I think perhaps one of them the
>>>> function isn't handling.
>>>>
>>>> First, based on recommendations from Andy Liaw (and ?randomForest), I
>>>> don't
>>>> use the formula interface but use x=<many columns>, y=<a column> in the
>>>> call. Does predict_rasterEngine handle the absence of a formula in the
>>>> object?
>>>>
>>>> Second, I have many large rasters I want to run the predict on, so
>>>> making
>>>> a
>>>> brick would be difficult. I use a rasterStack instead. Does your example
>>>> work with a rasterStack?
>>>>
>>>> I can dive deeper if any of this isn't clear or if these two tweaks work
>>>> just fine for you. I was just trying to swap out this version of predict
>>>> with another parallel version to evaluate speed and, while the alternate
>>>> version works fine, predict_rasterEngine bailed on me.
>>>>
>>>> Thanks in advance.
>>>> Tim Howard
>>>>
>>>>
>>>>
>>>>>>>>>>
>>>> Date: Tue, 18 Mar 2014 22:14:23 -0500
>>>> From: Jonathan Greenberg <jgrn at illinois.edu>
>>>> To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
>>>> Subject: [R-sig-Geo] Parallel predict now in spatial.tools
>>>> Message-ID:
>>>> <CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ at mail.gmail.com>
>>>> Content-Type: text/plain; charset=ISO-8859-1
>>>>
>>>> R-sig-geo'ers:
>>>>
>>>> I finally got around to building a parallel predict statement that
>>>> I've included in version 1.3.7 (or later) of spatial.tools (check
>>>> http://r-forge.r-project.org/R/?group_id=1492 for the status of the
>>>> build), "predict_rasterEngine". It should, in theory, be a direct
>>>> swap-in for the standard generic predict() statement. Currently, it
>>>> will work on any predict.* statement that has the following features:
>>>> 1) The data is passed to the predict as a data frame via a newdata
>>>> parameter, and
>>>> 2) The data is returned from the predict statement as a vector/matrix.
>>>>
>>>> When using predict_rasterEngine, the object= parameter is your model,
>>>> and the newdata= parameter is the raster/brick/stack to apply the
>>>> model to on a pixel-by-pixel basis (note that the names of the layers
>>>> must match the names of the predictor variables, in most cases).
>>>>
>>>> I was hoping to get some stress-testing on this, since it is a fairly
>>>> oft-requested function. If a predict.* function you'd like to use
>>>> doesn't work, let me know which function it is (with some test data)
>>>> and I'll see if I can tweak it to work.
>>>>
>>>> Right now, I have confirmed this works with randomForest. Here's an
>>>> example:
>>>>
>>>> ######################
>>>>
>>>> packages_required <- c("spatial.tools","doParallel","randomForest")
>>>> lapply(packages_required, require, character.only=T)
>>>>
>>>> # Load up a 3-band image:
>>>> tahoe_highrez <- setMinMax(
>>>> brick(system.file("external/tahoe_highrez.tif",
>>>> package="spatial.tools")))
>>>> tahoe_highrez
>>>> plotRGB(tahoe_highrez)
>>>>
>>>> # Load up some training points:
>>>> tahoe_highrez_training_points <- readOGR(
>>>> dsn=system.file("external", package="spatial.tools"),
>>>> layer="tahoe_highrez_training_points")
>>>>
>>>> # Extract data to train the randomForest model:
>>>> tahoe_highrez_training_extract <- extract(
>>>> tahoe_highrez,
>>>> tahoe_highrez_training_points,
>>>> df=TRUE)
>>>>
>>>> # Fuse it back with the SPECIES info:
>>>> tahoe_highrez_training_extract$SPECIES <-
>>>> tahoe_highrez_training_points$SPECIES
>>>>
>>>> # Note the names of the bands:
>>>> names(tahoe_highrez_training_extract) # the extracted data
>>>> names(tahoe_highrez) # the brick
>>>>
>>>> # Generate a randomForest model:
>>>> tahoe_rf <-
>>>> randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
>>>> data=tahoe_highrez_training_extract)
>>>>
>>>> tahoe_rf
>>>>
>>>> # This will run the predict in parallel:
>>>> sfQuickInit()
>>>> prediction_rf_class <-
>>>>
>>>>
>>>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
>>>> prediction_rf_prob <-
>>>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
>>>> sfQuickStop()
>>>>
>>>> ###############
>>>>
>>>> --j
>>>
>>>
>>>
>>> --
>>> Jonathan A. Greenberg, PhD
>>> Assistant Professor
>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>> Department of Geography and Geographic Information Science
>>> University of Illinois at Urbana-Champaign
>>> 259 Computing Applications Building, MC-150
>>> 605 East Springfield Avenue
>>> Champaign, IL 61820-6371
>>> Phone: 217-300-1924
>>> http://www.geog.illinois.edu/~jgrn/
>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
> #here is a script that adds a categorical layer to the tahoe brick, creates
> a RF model
> #and then tries both raster:::predict and predict_rasterEngine.
>
>
> packages_required <- c("spatial.tools","doParallel","randomForest")
> lapply(packages_required, require, character.only=T)
>
> # Load up a 3-band image:
> tahoe_highrez <- setMinMax(
> brick(system.file("external/tahoe_highrez.tif", package="spatial.tools")))
> tahoe_highrez
> plotRGB(tahoe_highrez)
>
> #create a categorical layer from band 1
> mat <- matrix(c(0,50,1,50,150,2,150,255,3),ncol=3,byrow=TRUE)
> bnd1cat <- reclassify(tahoe_highrez[[1]], rcl=mat)
> bnd1cat <- ratify(bnd1cat)
> rat <- levels(bnd1cat)[[1]]
> rat$types <- c('type1', 'type2', 'type3', 'type4')
> rat$code <- c(1,2,3,4)
> levels(bnd1cat) <- rat
>
> #library(rasterVis) #if you want a categorical plot
> #levelplot(bnd1_rc2)
>
> tahoe_highrez <- addLayer(tahoe_highrez, bnd1cat)
> names(tahoe_highrez) <- c("tahoeOne","tahoeTwo","tahoeThree","tahoeCatFour")
>
>
> # Load up some training points:
> tahoe_highrez_training_points <- readOGR(
>     dsn=system.file("external", package="spatial.tools"),
>     layer="tahoe_highrez_training_points")
>
> # Extract data to train the randomForest model:
> tahoe_highrez_training_extract <-
> extract(tahoe_highrez,tahoe_highrez_training_points,df=TRUE)
>
> # Fuse it back with the SPECIES info:
> tahoe_highrez_training_extract$SPECIES <-
> tahoe_highrez_training_points$SPECIES
>
> # Note the names of the bands:
> names(tahoe_highrez_training_extract) # the extracted data
> names(tahoe_highrez) # the brick
>
> # convert to factor, ensure all the levels are there
> tahoe_highrez_training_extract$tahoeCatFour <-
> factor(tahoe_highrez_training_extract$tahoeCatFour)
> levels(tahoe_highrez_training_extract$tahoeCatFour) <- c(1,2,3,4)
> str(tahoe_highrez_training_extract)
>
>
> # Generate a randomForest model:
> tahoe_rf <- randomForest(y=tahoe_highrez_training_extract$SPECIES,
>                             x=tahoe_highrez_training_extract[,2:5],
>                             data=tahoe_highrez_training_extract)
>
>
> # try it with standard predict call -- this works
> predict1_rf_prob <- predict(object=tahoe_highrez, model=tahoe_rf,
> type="prob")
>
> # try it with rasterEngine -- this fails
> sfQuickInit()
> predict2_rf_prob <-
> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
> sfQuickStop()
>
> plot(predict1_rf_prob)
>
>
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From tghoward at gw.dec.state.ny.us  Fri Mar 28 15:54:20 2014
From: tghoward at gw.dec.state.ny.us (Tim Howard)
Date: Fri, 28 Mar 2014 10:54:20 -0400
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
In-Reply-To: <CABG0rfvZGnTHCaAnMaZ9OsBLLjXaTb-3obn6xySSk=ioDz3AAA@mail.gmail.com>
References: <533547C9020000D500B875B9@gwsmtp.dec.state.ny.us>
	<CABG0rfvZGnTHCaAnMaZ9OsBLLjXaTb-3obn6xySSk=ioDz3AAA@mail.gmail.com>
Message-ID: <533554DC020000D500B875DD@gwsmtp.dec.state.ny.us>

Yes, I caught that typo after sending the email. The same happens with "type" rather than "newtype". Sorry. 

Yes, absolutely, there are NA values in the newdata.  My area of interest isn't rectangular and so the edges of all layers have NA values. Yes, it is definitely more efficient to skip all rows with any NA cells before sending it into RF. It is pretty critical to handle that for increased speed. 

I don't use the RAT either ... my first exposure to it was this morning trying to create a clearly categorical layer for the Tahoe data set. That's all. But I do have categorical data that are handled appropriately (without a RAT) in my data flow. I was just trying to add categorical data to the data flow in case that was what was  throwing your function.  It sounds like that issue might be moot.  That's what I get for guessing!

Thanks for your quick reply. 
Cheers, 
Tim

>>> Jonathan Greenberg <jgrn at illinois.edu> 03/28/14 10:38 AM >>>
Tim:

I notice you have:

predict_rasterEngine(object=rf.full, newdata=envStack, newtype='prob')

Was that a typo in your email? If not, this might be your issue -- the
correct parameter is "type", not "newtype" -- I noticed you are using
"type" in the raster:::predict:

?predict.randomForest

If you still get that error when you use type="prob", I think the
issue is that the raster probably has NA values (that is what usually
triggers the "missing values in newdata" error for
predict.randomForest) -- this is a valid issue, so I'll need to fix
the code a bit to deal with it -- can you confirm if its the newtype
issue first?  I can probably push out a fix later this weekend if it
is, indeed, the NA issue.

Another important issue is that I don't, at present, support the RAT,
but I can also work on a fix for that.

You are correct re: the object is the model, and the newdata parameter
is the raster/brick/stack.

Cheers!

--j

On Fri, Mar 28, 2014 at 8:58 AM, Tim Howard <tghoward at gw.dec.state.ny.us> wrote:
> Jonathan,
> Thanks again for your reply.
> I'll reply inline ... please see below
>
>>>>> Jonathan Greenberg <jgrn at illinois.edu> 03/26/14 10:55 AM >>>
>
>>Tim:
>>
>>One thing to make sure is if the stack has the bands named properly
>>>(they need to match the formula), e.g.:
>>>names(mystack) <- c("b1","b2",...)
>
> Yes, I think I'm good on layer names, as well as maintaining all the levels
> in categorical data (a classic gotcha for RF).
>
>>
>>If you can also pass along the error you are getting, that will go a
>>long way towards figuring out the issue! Cheers!
>
> I was a little reluctant to pass on the error message until I knew a little
> more. The main reason being that the normal predict function with raster
> *does* work even though you might not expect it with the error message. Here
> is the error coming out of predict_rasterEngine:
>
>> sfQuickInit(cpus=6)
> socket cluster with 6 nodes on host 'localhost'
>> prediction_rf_prob <- predict_rasterEngine(object=rf.full,
>> newdata=envStack, newtype='prob')
> Error in predict.randomForest(object = object, newdata = newdata_df,
> mget(model_parameters)) :
>   missing values in newdata
>> sfQuickStop()
>
>
> Again, I can run these exact data using raster:::predict and I get good
> output.  To me that means I do not have 'missing values in newdata'. I
> welcome thoughts otherwise, however. The predict call is structured like
> this:
>
> prediction_rf_prob <- predict(object=envStack, model=rf.full, type='prob',
> progress = 'text')
>
> So, I've tried recreating the problem by tweaking the Tahoe data. Below,
> I've added a categorical layer to the brick. Unfortunately, it errors out
> with a new error. (Null external pointer).  (Am I right that
> raster:::predict and predict_rasterEngine use the term "object"
> differently?)
>
> I'll paste a replacement set of code for the Tahoe data below our string.
>
> I welcome comments on any of this!
>
> Cheers,
> Tim
>
>
>>--j
>>
>>On Wed, Mar 26, 2014 at 9:48 AM, Tim Howard <tghoward at gw.dec.state.ny.us>
>> wrote:
>>> Jonathan,
>>> Thanks for your quick reply. I just tried your Tahoe example using x and
>>> y
>>> in the call rather than a formula and it worked fine, so I was barking up
>>> the wrong tree. Sorry. I'll try to delve deeper and put together a subset
>>> example for you to check out if I can't get anywhere.
>>>
>>> Thanks,
>>> Tim
>>>
>>>>>> Jonathan Greenberg <jgrn at illinois.edu> 3/26/2014 10:23 AM >>>
>>>
>>> Hi Tim:
>>>
>>> Re: stack, yep, it should work. In general, you get a decreased
>>> performance from stacks since you are having to read from multiple
>>> files rather than a single one, but it will still benefit from
>>> parallel processing.
>>>
>>> Re: formula -- the best way for me to test this is to crop out a piece
>>> of your image and send me the random forest model (use ?save), and the
>>> call you were using. In theory you should be able to use anything you
>>> would normally use on a data frame, but I'd have to play with it to
>>> confirm! If you can set up those on e.g. google drive I can test it
>>> out. Cheers!
>>>
>>> --j
>>>
>>> On Wed, Mar 26, 2014 at 6:49 AM, Tim Howard <tghoward at gw.dec.state.ny.us>
>>> wrote:
>>>> Jonathan,
>>>> Thank you for putting this together and for the example. I'm doing two
>>>> things differently with randomForest ... I think perhaps one of them the
>>>> function isn't handling.
>>>>
>>>> First, based on recommendations from Andy Liaw (and ?randomForest), I
>>>> don't
>>>> use the formula interface but use x=<many columns>, y=<a column> in the
>>>> call. Does predict_rasterEngine handle the absence of a formula in the
>>>> object?
>>>>
>>>> Second, I have many large rasters I want to run the predict on, so
>>>> making
>>>> a
>>>> brick would be difficult. I use a rasterStack instead. Does your example
>>>> work with a rasterStack?
>>>>
>>>> I can dive deeper if any of this isn't clear or if these two tweaks work
>>>> just fine for you. I was just trying to swap out this version of predict
>>>> with another parallel version to evaluate speed and, while the alternate
>>>> version works fine, predict_rasterEngine bailed on me.
>>>>
>>>> Thanks in advance.
>>>> Tim Howard
>>>>
>>>>
>>>>
>>>>>>>>>>
>>>> Date: Tue, 18 Mar 2014 22:14:23 -0500
>>>> From: Jonathan Greenberg <jgrn at illinois.edu>
>>>> To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
>>>> Subject: [R-sig-Geo] Parallel predict now in spatial.tools
>>>> Message-ID:
>>>> <CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ at mail.gmail.com>
>>>> Content-Type: text/plain; charset=ISO-8859-1
>>>>
>>>> R-sig-geo'ers:
>>>>
>>>> I finally got around to building a parallel predict statement that
>>>> I've included in version 1.3.7 (or later) of spatial.tools (check
>>>> http://r-forge.r-project.org/R/?group_id=1492 for the status of the
>>>> build), "predict_rasterEngine". It should, in theory, be a direct
>>>> swap-in for the standard generic predict() statement. Currently, it
>>>> will work on any predict.* statement that has the following features:
>>>> 1) The data is passed to the predict as a data frame via a newdata
>>>> parameter, and
>>>> 2) The data is returned from the predict statement as a vector/matrix.
>>>>
>>>> When using predict_rasterEngine, the object= parameter is your model,
>>>> and the newdata= parameter is the raster/brick/stack to apply the
>>>> model to on a pixel-by-pixel basis (note that the names of the layers
>>>> must match the names of the predictor variables, in most cases).
>>>>
>>>> I was hoping to get some stress-testing on this, since it is a fairly
>>>> oft-requested function. If a predict.* function you'd like to use
>>>> doesn't work, let me know which function it is (with some test data)
>>>> and I'll see if I can tweak it to work.
>>>>
>>>> Right now, I have confirmed this works with randomForest. Here's an
>>>> example:
>>>>
>>>> ######################
>>>>
>>>> packages_required <- c("spatial.tools","doParallel","randomForest")
>>>> lapply(packages_required, require, character.only=T)
>>>>
>>>> # Load up a 3-band image:
>>>> tahoe_highrez <- setMinMax(
>>>> brick(system.file("external/tahoe_highrez.tif",
>>>> package="spatial.tools")))
>>>> tahoe_highrez
>>>> plotRGB(tahoe_highrez)
>>>>
>>>> # Load up some training points:
>>>> tahoe_highrez_training_points <- readOGR(
>>>> dsn=system.file("external", package="spatial.tools"),
>>>> layer="tahoe_highrez_training_points")
>>>>
>>>> # Extract data to train the randomForest model:
>>>> tahoe_highrez_training_extract <- extract(
>>>> tahoe_highrez,
>>>> tahoe_highrez_training_points,
>>>> df=TRUE)
>>>>
>>>> # Fuse it back with the SPECIES info:
>>>> tahoe_highrez_training_extract$SPECIES <-
>>>> tahoe_highrez_training_points$SPECIES
>>>>
>>>> # Note the names of the bands:
>>>> names(tahoe_highrez_training_extract) # the extracted data
>>>> names(tahoe_highrez) # the brick
>>>>
>>>> # Generate a randomForest model:
>>>> tahoe_rf <-
>>>> randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
>>>> data=tahoe_highrez_training_extract)
>>>>
>>>> tahoe_rf
>>>>
>>>> # This will run the predict in parallel:
>>>> sfQuickInit()
>>>> prediction_rf_class <-
>>>>
>>>>
>>>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
>>>> prediction_rf_prob <-
>>>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
>>>> sfQuickStop()
>>>>
>>>> ###############
>>>>
>>>> --j
>>>
>>>
>>>
>>> --
>>> Jonathan A. Greenberg, PhD
>>> Assistant Professor
>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>> Department of Geography and Geographic Information Science
>>> University of Illinois at Urbana-Champaign
>>> 259 Computing Applications Building, MC-150
>>> 605 East Springfield Avenue
>>> Champaign, IL 61820-6371
>>> Phone: 217-300-1924
>>> http://www.geog.illinois.edu/~jgrn/
>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
> #here is a script that adds a categorical layer to the tahoe brick, creates
> a RF model
> #and then tries both raster:::predict and predict_rasterEngine.
>
>
> packages_required <- c("spatial.tools","doParallel","randomForest")
> lapply(packages_required, require, character.only=T)
>
> # Load up a 3-band image:
> tahoe_highrez <- setMinMax(
> brick(system.file("external/tahoe_highrez.tif", package="spatial.tools")))
> tahoe_highrez
> plotRGB(tahoe_highrez)
>
> #create a categorical layer from band 1
> mat <- matrix(c(0,50,1,50,150,2,150,255,3),ncol=3,byrow=TRUE)
> bnd1cat <- reclassify(tahoe_highrez[[1]], rcl=mat)
> bnd1cat <- ratify(bnd1cat)
> rat <- levels(bnd1cat)[[1]]
> rat$types <- c('type1', 'type2', 'type3', 'type4')
> rat$code <- c(1,2,3,4)
> levels(bnd1cat) <- rat
>
> #library(rasterVis) #if you want a categorical plot
> #levelplot(bnd1_rc2)
>
> tahoe_highrez <- addLayer(tahoe_highrez, bnd1cat)
> names(tahoe_highrez) <- c("tahoeOne","tahoeTwo","tahoeThree","tahoeCatFour")
>
>
> # Load up some training points:
> tahoe_highrez_training_points <- readOGR(
>     dsn=system.file("external", package="spatial.tools"),
>     layer="tahoe_highrez_training_points")
>
> # Extract data to train the randomForest model:
> tahoe_highrez_training_extract <-
> extract(tahoe_highrez,tahoe_highrez_training_points,df=TRUE)
>
> # Fuse it back with the SPECIES info:
> tahoe_highrez_training_extract$SPECIES <-
> tahoe_highrez_training_points$SPECIES
>
> # Note the names of the bands:
> names(tahoe_highrez_training_extract) # the extracted data
> names(tahoe_highrez) # the brick
>
> # convert to factor, ensure all the levels are there
> tahoe_highrez_training_extract$tahoeCatFour <-
> factor(tahoe_highrez_training_extract$tahoeCatFour)
> levels(tahoe_highrez_training_extract$tahoeCatFour) <- c(1,2,3,4)
> str(tahoe_highrez_training_extract)
>
>
> # Generate a randomForest model:
> tahoe_rf <- randomForest(y=tahoe_highrez_training_extract$SPECIES,
>                             x=tahoe_highrez_training_extract[,2:5],
>                             data=tahoe_highrez_training_extract)
>
>
> # try it with standard predict call -- this works
> predict1_rf_prob <- predict(object=tahoe_highrez, model=tahoe_rf,
> type="prob")
>
> # try it with rasterEngine -- this fails
> sfQuickInit()
> predict2_rf_prob <-
> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
> sfQuickStop()
>
> plot(predict1_rf_prob)
>
>
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140328/3c9804b7/attachment.html>

From mspinola10 at gmail.com  Fri Mar 28 16:06:01 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Fri, 28 Mar 2014 09:06:01 -0600
Subject: [R-sig-Geo] Projection and plot of the Ensemble Model in package
	biomod2
Message-ID: <CABkCotQCOy8ommfPt4dZUqA6mQYj1UdQ9JGqcRF-OtH-GssLqQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140328/bb7d8ea8/attachment.pl>

From mspinola10 at gmail.com  Fri Mar 28 16:08:27 2014
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Fri, 28 Mar 2014 09:08:27 -0600
Subject: [R-sig-Geo] Legend scale in a plot from the package biomod2
Message-ID: <CABkCotR6JtENJ25ugGt+uun71RHi8kuJi7izNQFjKxB1eUL1=w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140328/66b4a8da/attachment.pl>

From mur.teo at gmail.com  Fri Mar 28 16:34:39 2014
From: mur.teo at gmail.com (Matteo Mura)
Date: Fri, 28 Mar 2014 16:34:39 +0100
Subject: [R-sig-Geo] SamplingStrata
Message-ID: <CAC5WAObXkorfB5wXSa1Keek87MhevOgiEen1fC1O9JDnJ_EsLg@mail.gmail.com>

Dear all,

I am going to quickly explain you what I am trying to achieve.

I have a grid of 4692 hexagons (see
https://www.dropbox.com/s/rkim7v21i1p0bet/grid.jpeg). Each hexagon has
its univocal id (ID_ES).

In order to carry out a sampling procedure with different sampling
rates (SR) I have to:

- SR 50% => divide the map in (4692/2=) 2346 strata composed by 2
adiacent hexagons, and get as a result a dataframe where each row
contains the ID_ES of the 2 hexagons, e.g.:

ID_ES1 | ID_ES2
2345 | 1654

(please note that the ID_ES is not spatially progressive, in the sense
that the ID_ES=1 is not adiacent to ID_ES=2).

Same thing for the others different SR:

- SR 25% => (4692/4=) 1173 strata composed by 4 adiacent hexagons, and
get as a result a dataframe where each row contains the ID_ES of the 4
hexagons

- SR 10% => 467 strata of 10 adiacent hexagons + 2 strata of the
remains 11 adiacent hexagons and get as a result a dataframe where
each row contains the ID_ES of the 10 hexagons + 2 rows with the ID_ES
of the 11 hexagons.

Same procedure for SR of 5% (222 strata of 20 hex + 12 strata of 21
hex) and 1% (39 strata of 100 hex + 8 strata of 99 hex).

Hope I have been clear.

Thanks in advance!


From dododave at gmail.com  Fri Mar 28 17:11:53 2014
From: dododave at gmail.com (dododave)
Date: Fri, 28 Mar 2014 09:11:53 -0700 (PDT)
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <CABG0rftV-Mnurwin0j=uAwU8e9hOftYoLHGtPRcN2dkcqGA=Wg@mail.gmail.com>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
	<1395769212329-7586041.post@n2.nabble.com>
	<CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>
	<CABG0rftV-Mnurwin0j=uAwU8e9hOftYoLHGtPRcN2dkcqGA=Wg@mail.gmail.com>
Message-ID: <1396023113034-7586072.post@n2.nabble.com>

I am now able to convert the hdf files into GeoTiffs. I have a follow-up
question though. 

I now need to extract the mean ndvi value from within a polygon overlaid on
that GeoTiff. The issue I am having is that the code is returning NULL when
I do.

> 	rast <- raster("2011_P01.tif")
> 	mean.ndvi <- extract(rast, poly, fun=mean)
> mean.ndvi
[[1]]
NULL


Here is the output when I call rast;
> rast
class       : RasterLayer 
dimensions  : 904, 2500, 2260000  (nrow, ncol, ncell)
resolution  : 1, 1  (x, y)
extent      : 0, 2500, 0, 904  (xmin, xmax, ymin, ymax)
coord. ref. : NA 
data source : /Volumes/GOLONDRINA/tiff/2011_P01.tif 
names       : X2011_P01 
values      : -32768, 32767  (min, max)

Help appreciated!
Dave








Jonathan Greenberg-3 wrote
> Ok, I actually think you probably got it working somewhat correctly
> (if it returns something in the previous step) -- I think the issue
> you are having is a few things:
> 
> 1) Don't use the system.file for your own file -- the system.file()
> call is specifically for demo files within a package.  Set the working
> directory to where your HDF file is located and do:
> setwd("path/to/your/hdf/files")
> hdf_file <- "GVIX_NL_G16_C07_NVI_Y2005_P26.hdf"
> 
> Note you should be able to now do:
> gdalinfo(hdf_file)
> 
> 2) You are using an oddly formatted hdf file -- the get_subdatasets()
> routine and the sd_index= parameter only work when the subdatasets are
> named following a generally agreed-upon standard, the
> "SUBDATASET_n_NAME" format (common to e.g. MODIS, Landsat LEDAPS, and
> a lot of other products).  In your case, since it doesn't follow these
> conventions, you can instead use the sds=TRUE parameter which will
> extract ALL subdatasets it finds.  The one annoying part about this is
> that GDAL won't append the correct suffix (at least, not with version
> 1.10.0 and earlier), so you will need to rename the output:
> outfile="testout"
> gdal_translate(hdf_file,outfile,sds=TRUE,verbose=TRUE)
> # Notice you now have a file named "testout" with no extension.  Let's
> rename it:
> file.rename(outfile,paste(outfile,".tif",sep="")) # Only if a tif.
> Mod this if a different output format.
> 
> Hope this helps!  I'll make it more clear in future documentation when
> the sd_index parameter works.
> 
> --j
> 
> 
> 
> On Tue, Mar 25, 2014 at 1:52 PM, Jonathan Greenberg &lt;

> jgrn@

> &gt; wrote:
>> Hi Dave:
>>
>> In all likelihood, it couldn't find your GDAL install.  What OS are
>> you using?  What GDAL install did you use?  Can you restart R, and
>> then paste the output of:
>>
>> library("gdalUtils")
>> gdal_setInstallation(verbose=TRUE)
>>
>> And then the output of:
>>
>> getOption("gdalUtils_gdalPath")
>>
>> Thanks!
>>
>> --j
>>
>> On Tue, Mar 25, 2014 at 12:40 PM, dododave &lt;

> dododave@

> &gt; wrote:
>>> Thank-you Jonathan. I have done as you suggested and installed the
>>> latest
>>> version of GDAL and gdalUtils, and then followed the example in the
>>> gdal_translate help.
>>>
>>> To convert the hdf file test.hdf to .tif format, I use the following
>>> code;
>>>
>>> hdf4_dataset <- system.file("test.hdf", package="gdalUtils")
>>> gdal_translate(hdf4_dataset,"test.tif",sd_index=1)
>>> #I renamed the file to test.hdf for simplicity
>>>
>>> But this did not work. I got this error;
>>>
>>> Error in split1[[1]] : subscript out of bounds
>>> In addition: Warning message:
>>> running command '"C:\Program Files\QGIS Dufour\bin\gdalinfo.exe" ""' had
>>> status 1
>>>
>>> The hdf file I was trying to load was;
>>> ftp://ftp.orbit.nesdis.noaa.gov/pub/corp/scsb/wguo/GVIx/GVIx_VH_16km/NVI/GVIX_NL_G16_C07_NVI_Y2005_P26.hdf
>>>
>>> Thanks,
>>> Dave
>>>
>>>
>>>
>>> --
>>> View this message in context:
>>> http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586041.html
>>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> 

> R-sig-Geo@

>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: 

> jgrn307@

> , Gchat: jgrn307, Skype: jgrn3007
> 
> 
> 
> -- 
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: 

> jgrn307@

> , Gchat: jgrn307, Skype: jgrn3007
> 
> _______________________________________________
> R-sig-Geo mailing list

> R-sig-Geo@

> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


Jonathan Greenberg-3 wrote
> Ok, I actually think you probably got it working somewhat correctly
> (if it returns something in the previous step) -- I think the issue
> you are having is a few things:
> 
> 1) Don't use the system.file for your own file -- the system.file()
> call is specifically for demo files within a package.  Set the working
> directory to where your HDF file is located and do:
> setwd("path/to/your/hdf/files")
> hdf_file <- "GVIX_NL_G16_C07_NVI_Y2005_P26.hdf"
> 
> Note you should be able to now do:
> gdalinfo(hdf_file)
> 
> 2) You are using an oddly formatted hdf file -- the get_subdatasets()
> routine and the sd_index= parameter only work when the subdatasets are
> named following a generally agreed-upon standard, the
> "SUBDATASET_n_NAME" format (common to e.g. MODIS, Landsat LEDAPS, and
> a lot of other products).  In your case, since it doesn't follow these
> conventions, you can instead use the sds=TRUE parameter which will
> extract ALL subdatasets it finds.  The one annoying part about this is
> that GDAL won't append the correct suffix (at least, not with version
> 1.10.0 and earlier), so you will need to rename the output:
> outfile="testout"
> gdal_translate(hdf_file,outfile,sds=TRUE,verbose=TRUE)
> # Notice you now have a file named "testout" with no extension.  Let's
> rename it:
> file.rename(outfile,paste(outfile,".tif",sep="")) # Only if a tif.
> Mod this if a different output format.
> 
> Hope this helps!  I'll make it more clear in future documentation when
> the sd_index parameter works.
> 
> --j
> 
> 
> 
> On Tue, Mar 25, 2014 at 1:52 PM, Jonathan Greenberg &lt;

> jgrn@

> &gt; wrote:
>> Hi Dave:
>>
>> In all likelihood, it couldn't find your GDAL install.  What OS are
>> you using?  What GDAL install did you use?  Can you restart R, and
>> then paste the output of:
>>
>> library("gdalUtils")
>> gdal_setInstallation(verbose=TRUE)
>>
>> And then the output of:
>>
>> getOption("gdalUtils_gdalPath")
>>
>> Thanks!
>>
>> --j
>>
>> On Tue, Mar 25, 2014 at 12:40 PM, dododave &lt;

> dododave@

> &gt; wrote:
>>> Thank-you Jonathan. I have done as you suggested and installed the
>>> latest
>>> version of GDAL and gdalUtils, and then followed the example in the
>>> gdal_translate help.
>>>
>>> To convert the hdf file test.hdf to .tif format, I use the following
>>> code;
>>>
>>> hdf4_dataset <- system.file("test.hdf", package="gdalUtils")
>>> gdal_translate(hdf4_dataset,"test.tif",sd_index=1)
>>> #I renamed the file to test.hdf for simplicity
>>>
>>> But this did not work. I got this error;
>>>
>>> Error in split1[[1]] : subscript out of bounds
>>> In addition: Warning message:
>>> running command '"C:\Program Files\QGIS Dufour\bin\gdalinfo.exe" ""' had
>>> status 1
>>>
>>> The hdf file I was trying to load was;
>>> ftp://ftp.orbit.nesdis.noaa.gov/pub/corp/scsb/wguo/GVIx/GVIx_VH_16km/NVI/GVIX_NL_G16_C07_NVI_Y2005_P26.hdf
>>>
>>> Thanks,
>>> Dave
>>>
>>>
>>>
>>> --
>>> View this message in context:
>>> http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586041.html
>>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> 

> R-sig-Geo@

>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: 

> jgrn307@

> , Gchat: jgrn307, Skype: jgrn3007
> 
> 
> 
> -- 
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: 

> jgrn307@

> , Gchat: jgrn307, Skype: jgrn3007
> 
> _______________________________________________
> R-sig-Geo mailing list

> R-sig-Geo@

> https://stat.ethz.ch/mailman/listinfo/r-sig-geo





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586072.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jgrn at illinois.edu  Fri Mar 28 17:36:30 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 28 Mar 2014 11:36:30 -0500
Subject: [R-sig-Geo] Parallel predict now in spatial.tools
In-Reply-To: <533554DC020000D500B875DD@gwsmtp.dec.state.ny.us>
References: <533547C9020000D500B875B9@gwsmtp.dec.state.ny.us>
	<CABG0rfvZGnTHCaAnMaZ9OsBLLjXaTb-3obn6xySSk=ioDz3AAA@mail.gmail.com>
	<533554DC020000D500B875DD@gwsmtp.dec.state.ny.us>
Message-ID: <CABG0rft6D3Ce51_bJuNU7OxKQvNJnSGgFJE1F7HwAYUZkpbD3A@mail.gmail.com>

Tim:

Would you mind crop()'ing out a piece of your stack and also save()
the randomforest model so I can do some tests?  you can email them to
me directly or place them in a shared location.  Thanks!

--j

On Fri, Mar 28, 2014 at 9:54 AM, Tim Howard <tghoward at gw.dec.state.ny.us> wrote:
> Yes, I caught that typo after sending the email. The same happens with
> "type" rather than "newtype". Sorry.
>
> Yes, absolutely, there are NA values in the newdata.  My area of interest
> isn't rectangular and so the edges of all layers have NA values. Yes, it is
> definitely more efficient to skip all rows with any NA cells before sending
> it into RF. It is pretty critical to handle that for increased speed.
>
> I don't use the RAT either ... my first exposure to it was this morning
> trying to create a clearly categorical layer for the Tahoe data set. That's
> all. But I do have categorical data that are handled appropriately (without
> a RAT) in my data flow. I was just trying to add categorical data to the
> data flow in case that was what was  throwing your function.  It sounds like
> that issue might be moot.  That's what I get for guessing!
>
>
> Thanks for your quick reply.
> Cheers,
> Tim
>
>>>> Jonathan Greenberg <jgrn at illinois.edu> 03/28/14 10:38 AM >>>
>
> Tim:
>
> I notice you have:
>
> predict_rasterEngine(object=rf.full, newdata=envStack, newtype='prob')
>
> Was that a typo in your email? If not, this might be your issue -- the
> correct parameter is "type", not "newtype" -- I noticed you are using
> "type" in the raster:::predict:
>
> ?predict.randomForest
>
> If you still get that error when you use type="prob", I think the
> issue is that the raster probably has NA values (that is what usually
> triggers the "missing values in newdata" error for
> predict.randomForest) -- this is a valid issue, so I'll need to fix
> the code a bit to deal with it -- can you confirm if its the newtype
> issue first? I can probably push out a fix later this weekend if it
> is, indeed, the NA issue.
>
> Another important issue is that I don't, at present, support the RAT,
> but I can also work on a fix for that.
>
> You are correct re: the object is the model, and the newdata parameter
> is the raster/brick/stack.
>
> Cheers!
>
> --j
>
> On Fri, Mar 28, 2014 at 8:58 AM, Tim Howard <tghoward at gw.dec.state.ny.us>
> wrote:
>> Jonathan,
>> Thanks again for your reply.
>> I'll reply inline ... please see below
>>
>>>>>> Jonathan Greenberg <jgrn at illinois.edu> 03/26/14 10:55 AM >>>
>>
>>>Tim:
>>>
>>>One thing to make sure is if the stack has the bands named properly
>>>>(they need to match the formula), e.g.:
>>>>names(mystack) <- c("b1","b2",...)
>>
>> Yes, I think I'm good on layer names, as well as maintaining all the
>> levels
>> in categorical data (a classic gotcha for RF).
>>
>>>
>>>If you can also pass along the error you are getting, that will go a
>>>long way towards figuring out the issue! Cheers!
>>
>> I was a little reluctant to pass on the error message until I knew a
>> little
>> more. The main reason being that the normal predict function with raster
>> *does* work even though you might not expect it with the error message.
>> Here
>> is the error coming out of predict_rasterEngine:
>>
>>> sfQuickInit(cpus=6)
>> socket cluster with 6 nodes on host 'localhost'
>>> prediction_rf_prob <- predict_rasterEngine(object=rf.full,
>>> newdata=envStack, newtype='prob')
>> Error in predict.randomForest(object = object, newdata = newdata_df,
>> mget(model_parameters)) :
>> missing values in newdata
>>> sfQuickStop()
>>
>>
>> Again, I can run these exact data using raster:::predict and I get good
>> output. To me that means I do not have 'missing values in newdata'. I
>> welcome thoughts otherwise, however. The predict call is structured like
>> this:
>>
>> prediction_rf_prob <- predict(object=envStack, model=rf.full, type='prob',
>> progress = 'text')
>>
>> So, I've tried recreating the problem by tweaking the Tahoe data. Below,
>> I've added a categorical layer to the brick. Unfortunately, it errors out
>> with a new error. (Null external pointer). (Am I right that
>> raster:::predict and predict_rasterEngine use the term "object"
>> differently?)
>>
>> I'll paste a replacement set of code for the Tahoe data below our string.
>>
>> I welcome comments on any of this!
>>
>> Cheers,
>> Tim
>>
>>
>>>--j
>>>
>>>On Wed, Mar 26, 2014 at 9:48 AM, Tim Howard <tghoward at gw.dec.state.ny.us>
>>> wrote:
>>>> Jonathan,
>>>> Thanks for your quick reply. I just tried your Tahoe example using x and
>>>> y
>>>> in the call rather than a formula and it worked fine, so I was barking
>>>> up
>>>> the wrong tree. Sorry. I'll try to delve deeper and put together a
>>>> subset
>>>> example for you to check out if I can't get anywhere.
>>>>
>>>> Thanks,
>>>> Tim
>>>>
>>>>>>> Jonathan Greenberg <jgrn at illinois.edu> 3/26/2014 10:23 AM >>>
>>>>
>>>> Hi Tim:
>>>>
>>>> Re: stack, yep, it should work. In general, you get a decreased
>>>> performance from stacks since you are having to read from multiple
>>>> files rather than a single one, but it will still benefit from
>>>> parallel processing.
>>>>
>>>> Re: formula -- the best way for me to test this is to crop out a piece
>>>> of your image and send me the random forest model (use ?save), and the
>>>> call you were using. In theory you should be able to use anything you
>>>> would normally use on a data frame, but I'd have to play with it to
>>>> confirm! If you can set up those on e.g. google drive I can test it
>>>> out. Cheers!
>>>>
>>>> --j
>>>>
>>>> On Wed, Mar 26, 2014 at 6:49 AM, Tim Howard
>>>> <tghoward at gw.dec.state.ny.us>
>>>> wrote:
>>>>> Jonathan,
>>>>> Thank you for putting this together and for the example. I'm doing two
>>>>> things differently with randomForest ... I think perhaps one of them
>>>>> the
>>>>> function isn't handling.
>>>>>
>>>>> First, based on recommendations from Andy Liaw (and ?randomForest), I
>>>>> don't
>>>>> use the formula interface but use x=<many columns>, y=<a column> in the
>>>>> call. Does predict_rasterEngine handle the absence of a formula in the
>>>>> object?
>>>>>
>>>>> Second, I have many large rasters I want to run the predict on, so
>>>>> making
>>>>> a
>>>>> brick would be difficult. I use a rasterStack instead. Does your
>>>>> example
>>>>> work with a rasterStack?
>>>>>
>>>>> I can dive deeper if any of this isn't clear or if these two tweaks
>>>>> work
>>>>> just fine for you. I was just trying to swap out this version of
>>>>> predict
>>>>> with another parallel version to evaluate speed and, while the
>>>>> alternate
>>>>> version works fine, predict_rasterEngine bailed on me.
>>>>>
>>>>> Thanks in advance.
>>>>> Tim Howard
>>>>>
>>>>>
>>>>>
>>>>>>>>>>>
>>>>> Date: Tue, 18 Mar 2014 22:14:23 -0500
>>>>> From: Jonathan Greenberg <jgrn at illinois.edu>
>>>>> To: "r-sig-geo at r-project.org" <R-sig-Geo at r-project.org>
>>>>> Subject: [R-sig-Geo] Parallel predict now in spatial.tools
>>>>> Message-ID:
>>>>> <CABG0rfseg+p0h4HdYOK+_Za=OLMeTKHAT+TQn7g_FkEdYiunFQ at mail.gmail.com>
>>>>> Content-Type: text/plain; charset=ISO-8859-1
>>>>>
>>>>> R-sig-geo'ers:
>>>>>
>>>>> I finally got around to building a parallel predict statement that
>>>>> I've included in version 1.3.7 (or later) of spatial.tools (check
>>>>> http://r-forge.r-project.org/R/?group_id=1492 for the status of the
>>>>> build), "predict_rasterEngine". It should, in theory, be a direct
>>>>> swap-in for the standard generic predict() statement. Currently, it
>>>>> will work on any predict.* statement that has the following features:
>>>>> 1) The data is passed to the predict as a data frame via a newdata
>>>>> parameter, and
>>>>> 2) The data is returned from the predict statement as a vector/matrix.
>>>>>
>>>>> When using predict_rasterEngine, the object= parameter is your model,
>>>>> and the newdata= parameter is the raster/brick/stack to apply the
>>>>> model to on a pixel-by-pixel basis (note that the names of the layers
>>>>> must match the names of the predictor variables, in most cases).
>>>>>
>>>>> I was hoping to get some stress-testing on this, since it is a fairly
>>>>> oft-requested function. If a predict.* function you'd like to use
>>>>> doesn't work, let me know which function it is (with some test data)
>>>>> and I'll see if I can tweak it to work.
>>>>>
>>>>> Right now, I have confirmed this works with randomForest. Here's an
>>>>> example:
>>>>>
>>>>> ######################
>>>>>
>>>>> packages_required <- c("spatial.tools","doParallel","randomForest")
>>>>> lapply(packages_required, require, character.only=T)
>>>>>
>>>>> # Load up a 3-band image:
>>>>> tahoe_highrez <- setMinMax(
>>>>> brick(system.file("external/tahoe_highrez.tif",
>>>>> package="spatial.tools")))
>>>>> tahoe_highrez
>>>>> plotRGB(tahoe_highrez)
>>>>>
>>>>> # Load up some training points:
>>>>> tahoe_highrez_training_points <- readOGR(
>>>>> dsn=system.file("external", package="spatial.tools"),
>>>>> layer="tahoe_highrez_training_points")
>>>>>
>>>>> # Extract data to train the randomForest model:
>>>>> tahoe_highrez_training_extract <- extract(
>>>>> tahoe_highrez,
>>>>> tahoe_highrez_training_points,
>>>>> df=TRUE)
>>>>>
>>>>> # Fuse it back with the SPECIES info:
>>>>> tahoe_highrez_training_extract$SPECIES <-
>>>>> tahoe_highrez_training_points$SPECIES
>>>>>
>>>>> # Note the names of the bands:
>>>>> names(tahoe_highrez_training_extract) # the extracted data
>>>>> names(tahoe_highrez) # the brick
>>>>>
>>>>> # Generate a randomForest model:
>>>>> tahoe_rf <-
>>>>> randomForest(SPECIES~tahoe_highrez.1+tahoe_highrez.2+tahoe_highrez.3,
>>>>> data=tahoe_highrez_training_extract)
>>>>>
>>>>> tahoe_rf
>>>>>
>>>>> # This will run the predict in parallel:
>>>>> sfQuickInit()
>>>>> prediction_rf_class <-
>>>>>
>>>>>
>>>>>
>>>>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="response")
>>>>> prediction_rf_prob <-
>>>>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
>>>>> sfQuickStop()
>>>>>
>>>>> ###############
>>>>>
>>>>> --j
>>>>
>>>>
>>>>
>>>> --
>>>> Jonathan A. Greenberg, PhD
>>>> Assistant Professor
>>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>>> Department of Geography and Geographic Information Science
>>>> University of Illinois at Urbana-Champaign
>>>> 259 Computing Applications Building, MC-150
>>>> 605 East Springfield Avenue
>>>> Champaign, IL 61820-6371
>>>> Phone: 217-300-1924
>>>> http://www.geog.illinois.edu/~jgrn/
>>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>>
>> #here is a script that adds a categorical layer to the tahoe brick,
>> creates
>> a RF model
>> #and then tries both raster:::predict and predict_rasterEngine.
>>
>>
>> packages_required <- c("spatial.tools","doParallel","randomForest")
>> lapply(packages_required, require, character.only=T)
>>
>> # Load up a 3-band image:
>> tahoe_highrez <- setMinMax(
>> brick(system.file("external/tahoe_highrez.tif", package="spatial.tools")))
>> tahoe_highrez
>> plotRGB(tahoe_highrez)
>>
>> #create a categorical layer from band 1
>> mat <- matrix(c(0,50,1,50,150,2,150,255,3),ncol=3,byrow=TRUE)
>> bnd1cat <- reclassify(tahoe_highrez[[1]], rcl=mat)
>> bnd1cat <- ratify(bnd1cat)
>> rat <- levels(bnd1cat)[[1]]
>> rat$types <- c('type1', 'type2', 'type3', 'type4')
>> rat$code <- c(1,2,3,4)
>> levels(bnd1cat) <- rat
>>
>> #library(rasterVis) #if you want a categorical plot
>> #levelplot(bnd1_rc2)
>>
>> tahoe_highrez <- addLayer(tahoe_highrez, bnd1cat)
>> names(tahoe_highrez) <-
>> c("tahoeOne","tahoeTwo","tahoeThree","tahoeCatFour")
>>
>>
>> # Load up some training points:
>> tahoe_highrez_training_points <- readOGR(
>> dsn=system.file("external", package="spatial.tools"),
>> layer="tahoe_highrez_training_points")
>>
>> # Extract data to train the randomForest model:
>> tahoe_highrez_training_extract <-
>> extract(tahoe_highrez,tahoe_highrez_training_points,df=TRUE)
>>
>> # Fuse it back with the SPECIES info:
>> tahoe_highrez_training_extract$SPECIES <-
>> tahoe_highrez_training_points$SPECIES
>>
>> # Note the names of the bands:
>> names(tahoe_highrez_training_extract) # the extracted data
>> names(tahoe_highrez) # the brick
>>
>> # convert to factor, ensure all the levels are there
>> tahoe_highrez_training_extract$tahoeCatFour <-
>> factor(tahoe_highrez_training_extract$tahoeCatFour)
>> levels(tahoe_highrez_training_extract$tahoeCatFour) <- c(1,2,3,4)
>> str(tahoe_highrez_training_extract)
>>
>>
>> # Generate a randomForest model:
>> tahoe_rf <- randomForest(y=tahoe_highrez_training_extract$SPECIES,
>> x=tahoe_highrez_training_extract[,2:5],
>> data=tahoe_highrez_training_extract)
>>
>>
>> # try it with standard predict call -- this works
>> predict1_rf_prob <- predict(object=tahoe_highrez, model=tahoe_rf,
>> type="prob")
>>
>> # try it with rasterEngine -- this fails
>> sfQuickInit()
>> predict2_rf_prob <-
>> predict_rasterEngine(object=tahoe_rf,newdata=tahoe_highrez,type="prob")
>> sfQuickStop()
>>
>> plot(predict1_rf_prob)
>>
>>
>>
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL 61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From b.rowlingson at lancaster.ac.uk  Fri Mar 28 17:38:28 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 28 Mar 2014 16:38:28 +0000
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <b3bc6943b18f4e908e64411350e9955c@EX-1-HT0.lancs.local>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
	<1395769212329-7586041.post@n2.nabble.com>
	<CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>
	<CABG0rftV-Mnurwin0j=uAwU8e9hOftYoLHGtPRcN2dkcqGA=Wg@mail.gmail.com>
	<b3bc6943b18f4e908e64411350e9955c@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNACBRz73c7jd=Q7tkmMa4ffvCaS3cSxQfdxPP49n1dBg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140328/f8e220c9/attachment.pl>

From jgrn at illinois.edu  Fri Mar 28 19:08:11 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 28 Mar 2014 13:08:11 -0500
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <CANVKczNACBRz73c7jd=Q7tkmMa4ffvCaS3cSxQfdxPP49n1dBg@mail.gmail.com>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
	<1395769212329-7586041.post@n2.nabble.com>
	<CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>
	<CABG0rftV-Mnurwin0j=uAwU8e9hOftYoLHGtPRcN2dkcqGA=Wg@mail.gmail.com>
	<b3bc6943b18f4e908e64411350e9955c@EX-1-HT0.lancs.local>
	<CANVKczNACBRz73c7jd=Q7tkmMa4ffvCaS3cSxQfdxPP49n1dBg@mail.gmail.com>
Message-ID: <CABG0rfsAN+HMPcgKGQ5XyqaYOO4nHXb1ugFufT9p6AZMqX=zMQ@mail.gmail.com>

I want to follow up with this -- I confirmed Barry's suspicion that
that file you sent above ("GVIX_NL_G16_C07_NVI_Y2005_P26.hdf") has no
projection information (or bounding box or pixel resolution), so there
is no way to do the extract unless that is fixed.  Run a:

gdalinfo("GVIX_NL_G16_C07_NVI_Y2005_P26.hdf")

and you'll see there is not a properly set projection -- the .tif,
thus, also doesn't have any projection info.  This is an issue with
the input file, not with any of our functions.  You will need to set
your own projection, bounding box, and pixel sizes on the raster via
e.g. ?projection, ?res, ?extent

What are these files?  Are they satellite data?  Do you know if there
is another source for them that may have the information set
"properly"?

--j

On Fri, Mar 28, 2014 at 11:38 AM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Fri, Mar 28, 2014 at 4:11 PM, dododave <dododave at gmail.com> wrote:
>
>> I am now able to convert the hdf files into GeoTiffs. I have a follow-up
>> question though.
>>
>> I now need to extract the mean ndvi value from within a polygon overlaid on
>> that GeoTiff. The issue I am having is that the code is returning NULL when
>> I do.
>>
>> >       rast <- raster("2011_P01.tif")
>> >       mean.ndvi <- extract(rast, poly, fun=mean)
>> > mean.ndvi
>> [[1]]
>> NULL
>>
>>
>> Here is the output when I call rast;
>> > rast
>> class       : RasterLayer
>> dimensions  : 904, 2500, 2260000  (nrow, ncol, ncell)
>> resolution  : 1, 1  (x, y)
>> extent      : 0, 2500, 0, 904  (xmin, xmax, ymin, ymax)
>> coord. ref. : NA
>> data source : /Volumes/GOLONDRINA/tiff/2011_P01.tif
>> names       : X2011_P01
>> values      : -32768, 32767  (min, max)
>>
>> Help appreciated!
>>
>
> Are you sure your polygon is in the right place?
>
> r=raster()
> r[]=runif(180*360)
> pts=data.frame(x=c(-50,50,50,-50,-50),y=c(-50,-50,50,50,-50))
> poly = SpatialPolygons(list(Polygons(list(Polygon(pts)),ID=1)))
> extract(r,poly,fun=mean)
> [1] 0.4997085
>
>  - so that;s all good, but if I move the polygon way off the raster:
>
> poly2 = SpatialPolygons(list(Polygons(list(Polygon(pts+200)),ID=1)))
> extract(r,poly2,fun=mean)
> [[1]]
> NULL
>
>  I get what you're getting.  Check your polygon coordinates and CRS string
> is correct...
>
> Barry
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From dododave at gmail.com  Fri Mar 28 19:51:45 2014
From: dododave at gmail.com (dododave)
Date: Fri, 28 Mar 2014 11:51:45 -0700 (PDT)
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <CABG0rfsAN+HMPcgKGQ5XyqaYOO4nHXb1ugFufT9p6AZMqX=zMQ@mail.gmail.com>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
	<1395769212329-7586041.post@n2.nabble.com>
	<CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>
	<CABG0rftV-Mnurwin0j=uAwU8e9hOftYoLHGtPRcN2dkcqGA=Wg@mail.gmail.com>
	<CANVKczNACBRz73c7jd=Q7tkmMa4ffvCaS3cSxQfdxPP49n1dBg@mail.gmail.com>
	<CABG0rfsAN+HMPcgKGQ5XyqaYOO4nHXb1ugFufT9p6AZMqX=zMQ@mail.gmail.com>
Message-ID: <1396032705261-7586077.post@n2.nabble.com>

Yes, I checked the projection info from the newly converted tiff file, and it
is blank. I even tried to set the projection with the command below to match
my poly file; 

projection(rast) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"

but this isn't right. I tried to use the GDALinfo command to extract the
metadata, but that doesn't work either. The ftp site I downloaded the .hdf
files from is run by the NOAA, and I found some info;
	
Table 2 Description of File attributes (Meta data)
Meta data tag	Content
GRID_ROWS	Number of rows for data grid
GRID_COLUMNS	Number of columns for data grid
START_LATITUDE_RANGE	The latitude of the grid?s northern edge 
END_LATITUDE_RANGE	The latitude of the  grid?s southern edge
START_LONGITUDE_RANGE	The longitude of the grid?s western edge
END_LONGITUDE_RANGE	The longitude of the  grid?s eastern edge
PROJECTION	Projection type

But how do I view the metadata?



Jonathan Greenberg-3 wrote
> I want to follow up with this -- I confirmed Barry's suspicion that
> that file you sent above ("GVIX_NL_G16_C07_NVI_Y2005_P26.hdf") has no
> projection information (or bounding box or pixel resolution), so there
> is no way to do the extract unless that is fixed.  Run a:
> 
> gdalinfo("GVIX_NL_G16_C07_NVI_Y2005_P26.hdf")
> 
> and you'll see there is not a properly set projection -- the .tif,
> thus, also doesn't have any projection info.  This is an issue with
> the input file, not with any of our functions.  You will need to set
> your own projection, bounding box, and pixel sizes on the raster via
> e.g. ?projection, ?res, ?extent
> 
> What are these files?  Are they satellite data?  Do you know if there
> is another source for them that may have the information set
> "properly"?
> 
> --j
> 
> On Fri, Mar 28, 2014 at 11:38 AM, Barry Rowlingson
> &lt;

> b.rowlingson at .ac

> &gt; wrote:
>> On Fri, Mar 28, 2014 at 4:11 PM, dododave &lt;

> dododave@

> &gt; wrote:
>>
>>> I am now able to convert the hdf files into GeoTiffs. I have a follow-up
>>> question though.
>>>
>>> I now need to extract the mean ndvi value from within a polygon overlaid
>>> on
>>> that GeoTiff. The issue I am having is that the code is returning NULL
>>> when
>>> I do.
>>>
>>> >       rast <- raster("2011_P01.tif")
>>> >       mean.ndvi <- extract(rast, poly, fun=mean)
>>> > mean.ndvi
>>> [[1]]
>>> NULL
>>>
>>>
>>> Here is the output when I call rast;
>>> > rast
>>> class       : RasterLayer
>>> dimensions  : 904, 2500, 2260000  (nrow, ncol, ncell)
>>> resolution  : 1, 1  (x, y)
>>> extent      : 0, 2500, 0, 904  (xmin, xmax, ymin, ymax)
>>> coord. ref. : NA
>>> data source : /Volumes/GOLONDRINA/tiff/2011_P01.tif
>>> names       : X2011_P01
>>> values      : -32768, 32767  (min, max)
>>>
>>> Help appreciated!
>>>
>>
>> Are you sure your polygon is in the right place?
>>
>> r=raster()
>> r[]=runif(180*360)
>> pts=data.frame(x=c(-50,50,50,-50,-50),y=c(-50,-50,50,50,-50))
>> poly = SpatialPolygons(list(Polygons(list(Polygon(pts)),ID=1)))
>> extract(r,poly,fun=mean)
>> [1] 0.4997085
>>
>>  - so that;s all good, but if I move the polygon way off the raster:
>>
>> poly2 = SpatialPolygons(list(Polygons(list(Polygon(pts+200)),ID=1)))
>> extract(r,poly2,fun=mean)
>> [[1]]
>> NULL
>>
>>  I get what you're getting.  Check your polygon coordinates and CRS
>> string
>> is correct...
>>
>> Barry
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> 

> R-sig-Geo@

>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
> -- 
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: 

> jgrn307@

> , Gchat: jgrn307, Skype: jgrn3007
> 
> _______________________________________________
> R-sig-Geo mailing list

> R-sig-Geo@

> https://stat.ethz.ch/mailman/listinfo/r-sig-geo





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586077.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jgrn at illinois.edu  Fri Mar 28 19:58:38 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 28 Mar 2014 13:58:38 -0500
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <1396032705261-7586077.post@n2.nabble.com>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
	<1395769212329-7586041.post@n2.nabble.com>
	<CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>
	<CABG0rftV-Mnurwin0j=uAwU8e9hOftYoLHGtPRcN2dkcqGA=Wg@mail.gmail.com>
	<CANVKczNACBRz73c7jd=Q7tkmMa4ffvCaS3cSxQfdxPP49n1dBg@mail.gmail.com>
	<CABG0rfsAN+HMPcgKGQ5XyqaYOO4nHXb1ugFufT9p6AZMqX=zMQ@mail.gmail.com>
	<1396032705261-7586077.post@n2.nabble.com>
Message-ID: <CABG0rfvigyvaA4Up4kuZ1YPM-pNSZ-G1E7Gbj7-qmsrstr=YEQ@mail.gmail.com>

It's not just the projection -- you need to know the upper left
coordinates (or the full bounding box) and the pixel resolution, and
set those as well.  When you said you downloaded this from NOAA --
what is the main site describing the dataset?  What are you trying to
do with this data?

gdalUtils:::gdalinfo() will give you a "fuller" set of metadata of the
input data than rgdal:::GDALinfo does, just as a note.

--j

On Fri, Mar 28, 2014 at 1:51 PM, dododave <dododave at gmail.com> wrote:
> Yes, I checked the projection info from the newly converted tiff file, and it
> is blank. I even tried to set the projection with the command below to match
> my poly file;
>
> projection(rast) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
>
> but this isn't right. I tried to use the GDALinfo command to extract the
> metadata, but that doesn't work either. The ftp site I downloaded the .hdf
> files from is run by the NOAA, and I found some info;
>
> Table 2 Description of File attributes (Meta data)
> Meta data tag   Content
> GRID_ROWS       Number of rows for data grid
> GRID_COLUMNS    Number of columns for data grid
> START_LATITUDE_RANGE    The latitude of the grid's northern edge
> END_LATITUDE_RANGE      The latitude of the  grid's southern edge
> START_LONGITUDE_RANGE   The longitude of the grid's western edge
> END_LONGITUDE_RANGE     The longitude of the  grid's eastern edge
> PROJECTION      Projection type
>
> But how do I view the metadata?
>
>
>
> Jonathan Greenberg-3 wrote
>> I want to follow up with this -- I confirmed Barry's suspicion that
>> that file you sent above ("GVIX_NL_G16_C07_NVI_Y2005_P26.hdf") has no
>> projection information (or bounding box or pixel resolution), so there
>> is no way to do the extract unless that is fixed.  Run a:
>>
>> gdalinfo("GVIX_NL_G16_C07_NVI_Y2005_P26.hdf")
>>
>> and you'll see there is not a properly set projection -- the .tif,
>> thus, also doesn't have any projection info.  This is an issue with
>> the input file, not with any of our functions.  You will need to set
>> your own projection, bounding box, and pixel sizes on the raster via
>> e.g. ?projection, ?res, ?extent
>>
>> What are these files?  Are they satellite data?  Do you know if there
>> is another source for them that may have the information set
>> "properly"?
>>
>> --j
>>
>> On Fri, Mar 28, 2014 at 11:38 AM, Barry Rowlingson
>> &lt;
>
>> b.rowlingson at .ac
>
>> &gt; wrote:
>>> On Fri, Mar 28, 2014 at 4:11 PM, dododave &lt;
>
>> dododave@
>
>> &gt; wrote:
>>>
>>>> I am now able to convert the hdf files into GeoTiffs. I have a follow-up
>>>> question though.
>>>>
>>>> I now need to extract the mean ndvi value from within a polygon overlaid
>>>> on
>>>> that GeoTiff. The issue I am having is that the code is returning NULL
>>>> when
>>>> I do.
>>>>
>>>> >       rast <- raster("2011_P01.tif")
>>>> >       mean.ndvi <- extract(rast, poly, fun=mean)
>>>> > mean.ndvi
>>>> [[1]]
>>>> NULL
>>>>
>>>>
>>>> Here is the output when I call rast;
>>>> > rast
>>>> class       : RasterLayer
>>>> dimensions  : 904, 2500, 2260000  (nrow, ncol, ncell)
>>>> resolution  : 1, 1  (x, y)
>>>> extent      : 0, 2500, 0, 904  (xmin, xmax, ymin, ymax)
>>>> coord. ref. : NA
>>>> data source : /Volumes/GOLONDRINA/tiff/2011_P01.tif
>>>> names       : X2011_P01
>>>> values      : -32768, 32767  (min, max)
>>>>
>>>> Help appreciated!
>>>>
>>>
>>> Are you sure your polygon is in the right place?
>>>
>>> r=raster()
>>> r[]=runif(180*360)
>>> pts=data.frame(x=c(-50,50,50,-50,-50),y=c(-50,-50,50,50,-50))
>>> poly = SpatialPolygons(list(Polygons(list(Polygon(pts)),ID=1)))
>>> extract(r,poly,fun=mean)
>>> [1] 0.4997085
>>>
>>>  - so that;s all good, but if I move the polygon way off the raster:
>>>
>>> poly2 = SpatialPolygons(list(Polygons(list(Polygon(pts+200)),ID=1)))
>>> extract(r,poly2,fun=mean)
>>> [[1]]
>>> NULL
>>>
>>>  I get what you're getting.  Check your polygon coordinates and CRS
>>> string
>>> is correct...
>>>
>>> Barry
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>>
>
>> R-sig-Geo@
>
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN:
>
>> jgrn307@
>
>> , Gchat: jgrn307, Skype: jgrn3007
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>
>> R-sig-Geo@
>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586077.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From etiennebr at gmail.com  Fri Mar 28 20:19:27 2014
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Fri, 28 Mar 2014 15:19:27 -0400
Subject: [R-sig-Geo] Why is plotRGB so fast ?
Message-ID: <CALjAYt5PKgxCiy3EMM8x2=x4dLxL4n=sVy7G3KZVXZUH_JZ3Bg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140328/660b7056/attachment.pl>

From jgrn at illinois.edu  Fri Mar 28 20:34:15 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 28 Mar 2014 14:34:15 -0500
Subject: [R-sig-Geo] reading .hdf files
In-Reply-To: <CAE6kkfNX_dhiHVkr+Twvsx4b2nqohWOm3_50eWe5FNHTQWN36w@mail.gmail.com>
References: <1395765426821-7586038.post@n2.nabble.com>
	<CANVKczNyEhgTvRxBP3Pcqf5kA-eJXc+jjFK-JxW3x632UhsH3g@mail.gmail.com>
	<CABG0rfuDaO33AmSZsvk2yPCchGQNjG_hhPenEAxWjsn7z2vD-A@mail.gmail.com>
	<1395769212329-7586041.post@n2.nabble.com>
	<CABG0rfvRPAvPvgNDuQe2PtccCiUNCDf=cLSQOssYORRqiFpVuw@mail.gmail.com>
	<CABG0rftV-Mnurwin0j=uAwU8e9hOftYoLHGtPRcN2dkcqGA=Wg@mail.gmail.com>
	<CANVKczNACBRz73c7jd=Q7tkmMa4ffvCaS3cSxQfdxPP49n1dBg@mail.gmail.com>
	<CABG0rfsAN+HMPcgKGQ5XyqaYOO4nHXb1ugFufT9p6AZMqX=zMQ@mail.gmail.com>
	<1396032705261-7586077.post@n2.nabble.com>
	<CABG0rfvigyvaA4Up4kuZ1YPM-pNSZ-G1E7Gbj7-qmsrstr=YEQ@mail.gmail.com>
	<CAE6kkfPJpdTeoDdNMRWq1ff_NyCwoFfgamRgrnBqzRKTP0zBOg@mail.gmail.com>
	<CAE6kkfNX_dhiHVkr+Twvsx4b2nqohWOm3_50eWe5FNHTQWN36w@mail.gmail.com>
Message-ID: <CABG0rfuffra2UZZNUcRj3jPQUZFPupWzURksxv4f29SB-XpQWQ@mail.gmail.com>

David:

I don't see any information in that file re: pixel size -- the corner
coordinates appear to be pixel (not geography) coordinates, so they
won't help you.  If they did contain the right info, you could use
some basic text parsing to extract it from the output of gdalinfo().

So, you are left with a couple of choices:
1) Get the metadata on the file you are using from NOAA and see if
they can help you figure out the corner coordinates/pixel sizes OR;
2) (my suggestion) use a different data set.  Why are you using this
particular dataset?  If you want large-scale, well-calibrated NDVI,
the MODIS products are standardized and go back to 2000
(https://lpdaac.usgs.gov/products/modis_products_table/mod13q1).
Alternatively, if you want finer-scale NDVI (30m), you can get the
LANDSAT LEDAPS products (you want the surface reflectance product)
from Earth Explorer (http://landsat.usgs.gov/CDR_LSR.php)-- these go
back to at least 1985.  From these, you can just calculate the
per-image NDVI yourself (it is a simple calculation: (NIR - RED) /
(NIR + RED) ).

--j

On Fri, Mar 28, 2014 at 2:07 PM, David Bradley <dododave at gmail.com> wrote:
> Hi Jonathan,
>
> I am trying to extract mean ndvi values for the wintering range of
> individual tree swallows. we have placed geolocators (light sensitive
> tracking devices) on birds, and I would like to study their migration
> patterns and timing of arrival/departure from non-breeding and stopover
> sites, and see if they time arrival at these sites to vegetation greening
> (as a measure of flying insect abundance).
>
> Thanks,
> David
>
>
>
> On 28 March 2014 15:02, David Bradley <dododave at gmail.com> wrote:
>>
>> Great!
>>
>> > gdalUtils:::gdalinfo("GVIX_NN_G16_C07_NVI_Y2011_P01.hdf")
>>  [1] "Driver: HDF4Image/HDF4 Dataset"
>>  [2] "Files: GVIX_NN_G16_C07_NVI_Y2011_P01.hdf"
>>  [3] "Size is 2500, 904"
>>  [4] "Coordinate System is `'"
>>  [5] "Metadata:"
>>  [6] "  END_LATITUDE_RANGE=-55.15200043"
>>  [7] "  END_LONGITUDE_RANGE=180"
>>  [8] "  GRID_COLUMNS=2500"
>>  [9] "  GRID_ROWS=904"
>> [10] "  MISSING=-999"
>> [11] "  PROJECTION=Plate_Carree"
>> [12] "  RANGE_MAX=1"
>> [13] "  RANGE_MIN=-0.1000000015"
>> [14] "  SCALED=1"
>> [15] "  SCALED_MAX=1000"
>> [16] "  SCALED_MIN=-100"
>> [17] "  SCALED_MISSING=-999"
>> [18] "  START_LATITUDE_RANGE=75.02400208"
>> [19] "  START_LONGITUDE_RANGE=-180"
>> [20] "  UNITS=NONE"
>> [21] "Corner Coordinates:"
>> [22] "Upper Left  (    0.0,    0.0)"
>> [23] "Lower Left  (    0.0,  904.0)"
>> [24] "Upper Right ( 2500.0,    0.0)"
>> [25] "Lower Right ( 2500.0,  904.0)"
>> [26] "Center      ( 1250.0,  452.0)"
>> [27] "Band 1 Block=2500x400 Type=Int16, ColorInterp=Gray"
>>
>> If there any way this can be saved and re-applied to the tiff files and
>> the polygon shapefile?
>>
>>
>> On 28 March 2014 14:58, Jonathan Greenberg <jgrn at illinois.edu> wrote:
>>>
>>> It's not just the projection -- you need to know the upper left
>>> coordinates (or the full bounding box) and the pixel resolution, and
>>> set those as well.  When you said you downloaded this from NOAA --
>>> what is the main site describing the dataset?  What are you trying to
>>> do with this data?
>>>
>>> gdalUtils:::gdalinfo() will give you a "fuller" set of metadata of the
>>> input data than rgdal:::GDALinfo does, just as a note.
>>>
>>> --j
>>>
>>> On Fri, Mar 28, 2014 at 1:51 PM, dododave <dododave at gmail.com> wrote:
>>> > Yes, I checked the projection info from the newly converted tiff file,
>>> > and it
>>> > is blank. I even tried to set the projection with the command below to
>>> > match
>>> > my poly file;
>>> >
>>> > projection(rast) <- "+proj=longlat +datum=WGS84 +ellps=WGS84
>>> > +towgs84=0,0,0"
>>> >
>>> > but this isn't right. I tried to use the GDALinfo command to extract
>>> > the
>>> > metadata, but that doesn't work either. The ftp site I downloaded the
>>> > .hdf
>>> > files from is run by the NOAA, and I found some info;
>>> >
>>> > Table 2 Description of File attributes (Meta data)
>>> > Meta data tag   Content
>>> > GRID_ROWS       Number of rows for data grid
>>> > GRID_COLUMNS    Number of columns for data grid
>>> > START_LATITUDE_RANGE    The latitude of the grid's northern edge
>>> > END_LATITUDE_RANGE      The latitude of the  grid's southern edge
>>> > START_LONGITUDE_RANGE   The longitude of the grid's western edge
>>> > END_LONGITUDE_RANGE     The longitude of the  grid's eastern edge
>>> > PROJECTION      Projection type
>>> >
>>> > But how do I view the metadata?
>>> >
>>> >
>>> >
>>> > Jonathan Greenberg-3 wrote
>>> >> I want to follow up with this -- I confirmed Barry's suspicion that
>>> >> that file you sent above ("GVIX_NL_G16_C07_NVI_Y2005_P26.hdf") has no
>>> >> projection information (or bounding box or pixel resolution), so there
>>> >> is no way to do the extract unless that is fixed.  Run a:
>>> >>
>>> >> gdalinfo("GVIX_NL_G16_C07_NVI_Y2005_P26.hdf")
>>> >>
>>> >> and you'll see there is not a properly set projection -- the .tif,
>>> >> thus, also doesn't have any projection info.  This is an issue with
>>> >> the input file, not with any of our functions.  You will need to set
>>> >> your own projection, bounding box, and pixel sizes on the raster via
>>> >> e.g. ?projection, ?res, ?extent
>>> >>
>>> >> What are these files?  Are they satellite data?  Do you know if there
>>> >> is another source for them that may have the information set
>>> >> "properly"?
>>> >>
>>> >> --j
>>> >>
>>> >> On Fri, Mar 28, 2014 at 11:38 AM, Barry Rowlingson
>>> >> &lt;
>>> >
>>> >> b.rowlingson at .ac
>>> >
>>> >> &gt; wrote:
>>> >>> On Fri, Mar 28, 2014 at 4:11 PM, dododave &lt;
>>> >
>>> >> dododave@
>>> >
>>> >> &gt; wrote:
>>> >>>
>>> >>>> I am now able to convert the hdf files into GeoTiffs. I have a
>>> >>>> follow-up
>>> >>>> question though.
>>> >>>>
>>> >>>> I now need to extract the mean ndvi value from within a polygon
>>> >>>> overlaid
>>> >>>> on
>>> >>>> that GeoTiff. The issue I am having is that the code is returning
>>> >>>> NULL
>>> >>>> when
>>> >>>> I do.
>>> >>>>
>>> >>>> >       rast <- raster("2011_P01.tif")
>>> >>>> >       mean.ndvi <- extract(rast, poly, fun=mean)
>>> >>>> > mean.ndvi
>>> >>>> [[1]]
>>> >>>> NULL
>>> >>>>
>>> >>>>
>>> >>>> Here is the output when I call rast;
>>> >>>> > rast
>>> >>>> class       : RasterLayer
>>> >>>> dimensions  : 904, 2500, 2260000  (nrow, ncol, ncell)
>>> >>>> resolution  : 1, 1  (x, y)
>>> >>>> extent      : 0, 2500, 0, 904  (xmin, xmax, ymin, ymax)
>>> >>>> coord. ref. : NA
>>> >>>> data source : /Volumes/GOLONDRINA/tiff/2011_P01.tif
>>> >>>> names       : X2011_P01
>>> >>>> values      : -32768, 32767  (min, max)
>>> >>>>
>>> >>>> Help appreciated!
>>> >>>>
>>> >>>
>>> >>> Are you sure your polygon is in the right place?
>>> >>>
>>> >>> r=raster()
>>> >>> r[]=runif(180*360)
>>> >>> pts=data.frame(x=c(-50,50,50,-50,-50),y=c(-50,-50,50,50,-50))
>>> >>> poly = SpatialPolygons(list(Polygons(list(Polygon(pts)),ID=1)))
>>> >>> extract(r,poly,fun=mean)
>>> >>> [1] 0.4997085
>>> >>>
>>> >>>  - so that;s all good, but if I move the polygon way off the raster:
>>> >>>
>>> >>> poly2 = SpatialPolygons(list(Polygons(list(Polygon(pts+200)),ID=1)))
>>> >>> extract(r,poly2,fun=mean)
>>> >>> [[1]]
>>> >>> NULL
>>> >>>
>>> >>>  I get what you're getting.  Check your polygon coordinates and CRS
>>> >>> string
>>> >>> is correct...
>>> >>>
>>> >>> Barry
>>> >>>
>>> >>>         [[alternative HTML version deleted]]
>>> >>>
>>> >>> _______________________________________________
>>> >>> R-sig-Geo mailing list
>>> >>>
>>> >
>>> >> R-sig-Geo@
>>> >
>>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >>
>>> >>
>>> >>
>>> >> --
>>> >> Jonathan A. Greenberg, PhD
>>> >> Assistant Professor
>>> >> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>> >> Department of Geography and Geographic Information Science
>>> >> University of Illinois at Urbana-Champaign
>>> >> 259 Computing Applications Building, MC-150
>>> >> 605 East Springfield Avenue
>>> >> Champaign, IL  61820-6371
>>> >> Phone: 217-300-1924
>>> >> http://www.geog.illinois.edu/~jgrn/
>>> >> AIM: jgrn307, MSN:
>>> >
>>> >> jgrn307@
>>> >
>>> >> , Gchat: jgrn307, Skype: jgrn3007
>>> >>
>>> >> _______________________________________________
>>> >> R-sig-Geo mailing list
>>> >
>>> >> R-sig-Geo@
>>> >
>>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>> >
>>> >
>>> >
>>> >
>>> > --
>>> > View this message in context:
>>> > http://r-sig-geo.2731867.n2.nabble.com/reading-hdf-files-tp7586038p7586077.html
>>> > Sent from the R-sig-geo mailing list archive at Nabble.com.
>>> >
>>> > _______________________________________________
>>> > R-sig-Geo mailing list
>>> > R-sig-Geo at r-project.org
>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>> --
>>> Jonathan A. Greenberg, PhD
>>> Assistant Professor
>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>> Department of Geography and Geographic Information Science
>>> University of Illinois at Urbana-Champaign
>>> 259 Computing Applications Building, MC-150
>>> 605 East Springfield Avenue
>>> Champaign, IL  61820-6371
>>> Phone: 217-300-1924
>>> http://www.geog.illinois.edu/~jgrn/
>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>>
>>
>>
>>
>> --
>> David Bradley
>> A346 Paisley Road, Guelph
>> Ontario, N1H 2P9
>
>
>
>
> --
> David Bradley
> A346 Paisley Road, Guelph
> Ontario, N1H 2P9



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From laanders at nps.edu  Sat Mar 29 21:09:34 2014
From: laanders at nps.edu (laanders)
Date: Sat, 29 Mar 2014 13:09:34 -0700 (PDT)
Subject: [R-sig-Geo] Changing the units of shape file areas
Message-ID: <1396123774386-7586083.post@n2.nabble.com>

Hello!

I've been working with Philippine shape files I found at:
http://www.philgis.org/freegisdata.htm
Specifically, I've been looking at the barangay level shape files.  I'm
trying to get the area of each barangay so I can bet the population density
and plot a heat map.  Unfortunately, I don't understand the units of these
areas.  
Here's the R code I'm using to get the areas:  

###########################
BarangaysPlot <- readOGR("~/Barangays", layer = "Barangays?)  
ZCB <- BarangaysPlot[BarangaysPlot$NAME_2=="Zamboanga City?,]  ## Subsetting
the shape file to get ZamboCity

sapply(slot(ZCB, "polygons"), slot, "area?)  ## Get the areas

[1] 1.392389e-04 1.946191e-04 7.702360e-05 2.711882e-03 4.610627e-05
5.659337e-05
[7] 6.926905e-05 5.678706e-05 8.203009e-04 1.639304e-03 1.336925e-03
4.909287e-03
###########################

Since the areas are so small, I thought maybe there were either holes in the
shape files or I am dealing with the degree coordinate system.  The
coordinates are planar, so we're good there.  So to see if there were holes
I used the code provided by Dr. Bivand in an earlier post, I found there
were no holes.  According to the website, the current projection for these
shape files is WGS 1984.  So I then looked at spTransform() using the code I
mentioned earlier by Dr. Bivand.

###########################
## epsg for WGS 1984 is 4326
ZCBareas <- spTransform(ZCB, CRS("+init=epsg:4326"))  
## Gives some ?non-simple polygon objects"
sapply(slot(ZCBareas, "polygons"), function(x) length(slot(x, "Polygons")))  

## Gives any holes in the polygons; there are none
sapply(slot(ZCBareas, "polygons"), function(x) {   
xi <- slot(x, "Polygons") 
any(sapply(xi, slot, "hole")) 
}) 

## Gives the same areas as before
sapply(slot(ZCBareas, "polygons"), slot, "area?)  
###########################

Again, I'm just trying to find the areas in a unit I can understand to apply
to population densities.  
Any help would be much appreciated!! 
Lew



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Changing-the-units-of-shape-file-areas-tp7586083.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From HodgessE at uhd.edu  Sun Mar 30 04:56:13 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 30 Mar 2014 02:56:13 +0000
Subject: [R-sig-Geo] Back to krigeST and Dates
Message-ID: <FF9DB805FC41CC4E95825A50F680630217B4BB2C@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140330/36fbb5c7/attachment.pl>

From HodgessE at uhd.edu  Sun Mar 30 05:00:27 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 30 Mar 2014 03:00:27 +0000
Subject: [R-sig-Geo] Back to krigeST and Dates
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217B4BB2C@challenger.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F680630217B4BB2C@challenger.uhd.campus>
Message-ID: <FF9DB805FC41CC4E95825A50F680630217B4BB46@challenger.uhd.campus>

Never mind...I found the old post with the answer.  Sorry for the trouble.

________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Hodgess, Erin [HodgessE at uhd.edu]
Sent: Saturday, March 29, 2014 9:56 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Back to krigeST and Dates

Hello everyone!

I'm trying to use krigeST with quarterly data.  I get the error message:


        warning("The spatio-temporal variogram model does not carry a time unit attribute: krisgeST cannot check whether the temporal distance metrics coincide.")

I had run into that with annual data but thought that it would work with quarterly data.

I'm sure that this is something goofy that I'm just not seeing.  Any help would be much appreciated.

Sincerely,
Erin


        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From espada at agro.uba.ar  Sun Mar 30 15:33:12 2014
From: espada at agro.uba.ar (Ramiro Augusto Espada)
Date: Sun, 30 Mar 2014 10:33:12 -0300
Subject: [R-sig-Geo] Error plotting Variogram Map
Message-ID: <CAG=AKhXZcv6-vcO-q9LRmwHo47wRZivmwOxEA+Vth1C3cnfWUw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140330/3921ab40/attachment.pl>

From julleeyaw at yahoo.ca  Sun Mar 30 17:59:25 2014
From: julleeyaw at yahoo.ca (Julie Lee-Yaw)
Date: Sun, 30 Mar 2014 08:59:25 -0700 (PDT)
Subject: [R-sig-Geo] Managing temporary files created when using the
	Raster package
In-Reply-To: <CABG0rft_iVuZ-0FT0==_=npG0UmLO9wkfjOt9aBB+xn3QyWJhg@mail.gmail.com>
References: <1395611084.323.YahooMailNeo@web124501.mail.ne1.yahoo.com>
	<CABG0rft_iVuZ-0FT0==_=npG0UmLO9wkfjOt9aBB+xn3QyWJhg@mail.gmail.com>
Message-ID: <1396195165.86157.YahooMailNeo@web124505.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140330/2a3a3e33/attachment.pl>

From HodgessE at uhd.edu  Sun Mar 30 18:20:53 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 30 Mar 2014 16:20:53 +0000
Subject: [R-sig-Geo] plotKML problem
Message-ID: <FF9DB805FC41CC4E95825A50F680630217B4BD61@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140330/cb8d7804/attachment.pl>

From HodgessE at uhd.edu  Sun Mar 30 18:29:30 2014
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 30 Mar 2014 16:29:30 +0000
Subject: [R-sig-Geo] yet another plotKML question
Message-ID: <FF9DB805FC41CC4E95825A50F680630217B4BD94@challenger.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140330/9cea4c5f/attachment.pl>

From jgrn at illinois.edu  Sun Mar 30 18:42:00 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sun, 30 Mar 2014 11:42:00 -0500
Subject: [R-sig-Geo] Managing temporary files created when using the
 Raster package
In-Reply-To: <1396195165.86157.YahooMailNeo@web124505.mail.ne1.yahoo.com>
References: <1395611084.323.YahooMailNeo@web124501.mail.ne1.yahoo.com>
	<CABG0rft_iVuZ-0FT0==_=npG0UmLO9wkfjOt9aBB+xn3QyWJhg@mail.gmail.com>
	<1396195165.86157.YahooMailNeo@web124505.mail.ne1.yahoo.com>
Message-ID: <CABG0rfv22neWHaynA9EX56sa2JjC6ASTJBt3tq7ZcM8asjg8sg@mail.gmail.com>

Hi Julie:

Glad it worked out!  Just for the sake of preserving this info on the
interwebs and to add some "tweaks" to your solutions, first, raster's
temporary files are stored in:

rasterOptions()$tmpdir

This folder can be changed to:

rasterOptions(tmpdir="/pathto/new/temp/dir")

Re: list files, if you want to full path, I use:
normalizePath(list.files(pattern=glob2rx("temp*"),full.names =TRUE))

full.names=TRUE will give you the full path to the file, although it
will be a relative path -- normalizePath "fixes" this to the absolute
path.  The pattern parameter for list.files is a "regular expression"
(http://en.wikipedia.org/wiki/Regular_expression), which many people
aren't terribly familiar with -- if you are more familiar with the
wildcard approach (your example suggests you are -- I am too), to be
safe, wrap that in a glob2rx() function so it it created properly:

glob2rx("temp*")

The pattern="temp*", since it is interpreted as a regular expression,
is not interpreted the way you probably thought it was, and when you
remove files you should be careful about that.  You could end up
deleting different files than you thought.  "*" in regular expressions
means something different than it does in wildcard patterns.

Cheers!

--j

On Sun, Mar 30, 2014 at 10:59 AM, Julie Lee-Yaw <julleeyaw at yahoo.ca> wrote:
> Hi Jonathan,
>
> Thanks for this suggestion. It took me awhile to find all the places where
> temporary rasters were being generated. After finding them, I used filename
> in all commands that were generating the files, pointing them all to a
> temporary directory and calling them all "temp_" something. I then used the
> following lines of code to remove them at the end of each loop (note
> file.remove seemed to require me to be in the directory with the files to be
> removed...)
>
> path<-"./myPermanentDirectory" # inside this directory, I had created a temp
> directory to dump temp files in
> setwd(paste(path,"/tmpdir",sep="")) # change directory to where the
> temporary files are
> do.call(file.remove,list(list.files(pattern="temp*)))
> setwd(path) # go back to permanent directory
>
> Thanks!
>
> Julie
>
>
>
> ________________________________
> From: Jonathan Greenberg <jgrn at illinois.edu>
> To: Julie Lee-Yaw <julleeyaw at yahoo.ca>
> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Sent: Sunday, March 23, 2014 11:58:50 PM
> Subject: Re: [R-sig-Geo] Managing temporary files created when using the
> Raster package
>
> Julie:
>
> Why not just build a ?file.remove into your script?  Also, most raster
> functions allow you to explicitly set a filename (see e.g. ?calc -->
> the filename= parameter), rather than letting it generate a random
> filename -- this would likely make it easier for you to figure out the
> appropriate file to delete.
>
> --j
>
> On Sun, Mar 23, 2014 at 4:44 PM, Julie Lee-Yaw <julleeyaw at yahoo.ca> wrote:
>> Hi
>>
>> I am doing a lot of raster calculations repeatedly (in a loop of sorts).
>> As might be expected, this process is generating a lot of temporary files
>> and filing up my hard drive before my script finishes. The first step in my
>> script is to stack a set of very large rasters. This stack is then the input
>> for the function that I'm using (e.g. the loop). Can I add in a line in my
>> loop (e.g. removeTmpFiles) to delete temporary files created during the loop
>> without ruining the integrity of the raster stack?
>>
>> For example:
>>
>> files<-list.files(pattern=".tif")
>> myStack<-stack(files)
>>
>> myFunction<-function(x, rasterStack, y, z){
>> # several calculations using the raster stack and x, y, z
>> # non-raster results from the calculations get saved to file using
>> write.csv()
>> removeTmpFiles(h=0) # remove temp. raster files from disk???
>> }
>>
>> lapply(x=list_of_x_values, myFunction, rasterStack=myStack, y=something,
>> z=somethingelse)
>>
>> Is the removeTmpFiles line appropriate here?
>>
>> Thanks for the help!
>
>>        [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From E.Thomas at CGIAR.ORG  Sun Mar 30 20:10:26 2014
From: E.Thomas at CGIAR.ORG (Thomas, Evert (Bioversity-Colombia))
Date: Sun, 30 Mar 2014 18:10:26 +0000
Subject: [R-sig-Geo] Error gbif function in dismo package
Message-ID: <BAD0F95A023D904C8DAA193192ECE14042E919B3@CIATMB2.CIAT.CGIARAD.ORG>

Dear all

I am trying to use the gbif function from dismo package, but there seems to be a problem; this is what I get with the example from the vignette of dismo package...

gbif("solanum", "acaule*", geo=FALSE)

solanum acaule* : 2166 occurrences found
1-1000No such file or directoryfailed to load external entity "http://data.gbif.org/ws/rest/occurrence/list?scientificname=solanum+acaule*&mode=processed&format=darwin&startindex=0&maxresults=1000"
Error : 1: No such file or directory2: failed to load external entity http://data.gbif.org/ws/rest/occurrence/list?scientificname=solanum+acaule*&mode=processed&format=darwin&startindex=0&maxresults=1000

Does anyone have any idea what could be the problem? 

Many thanks in advance!

Evert


From ulmusnigra at yahoo.es  Sun Mar 30 21:21:22 2014
From: ulmusnigra at yahoo.es (Olmo)
Date: Sun, 30 Mar 2014 21:21:22 +0200
Subject: [R-sig-Geo] Error gbif function in dismo package
In-Reply-To: <BAD0F95A023D904C8DAA193192ECE14042E919B3@CIATMB2.CIAT.CGIARAD.ORG>
References: <BAD0F95A023D904C8DAA193192ECE14042E919B3@CIATMB2.CIAT.CGIARAD.ORG>
Message-ID: <20140330212122.2185c895@yahoo.es>

 Hi, what version of R and the dismo package are you running? my info
 is:

R version 3.0.3 (2014-03-06)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=es_ES.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=es_ES.UTF-8        LC_COLLATE=C              
 [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=es_ES.UTF-8   
 [7] LC_PAPER=es_ES.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods
base     

other attached packages:
[1] XML_3.98-1.1  dismo_0.9-3   raster_2.2-31 sp_1.0-14    

loaded via a namespace (and not attached):
[1] grid_3.0.3      lattice_0.20-27 tools_3.0.3 

And it works as expected, I see no error while using the code you
provided. 

 Good luck!

El Sun, 30 Mar 2014 18:10:26 +0000
"Thomas, Evert (Bioversity-Colombia)" <E.Thomas at cgiar.org> escribi?:
> Dear all
> 
> I am trying to use the gbif function from dismo package, but there
> seems to be a problem; this is what I get with the example from the
> vignette of dismo package...
> 
> gbif("solanum", "acaule*", geo=FALSE)
> 
> solanum acaule* : 2166 occurrences found
> 1-1000No such file or directoryfailed to load external entity
> "http://data.gbif.org/ws/rest/occurrence/list?scientificname=solanum+acaule*&mode=processed&format=darwin&startindex=0&maxresults=1000"
> Error : 1: No such file or directory2: failed to load external entity
> http://data.gbif.org/ws/rest/occurrence/list?scientificname=solanum+acaule*&mode=processed&format=darwin&startindex=0&maxresults=1000
> 
> Does anyone have any idea what could be the problem? 
> 
> Many thanks in advance!
> 
> Evert
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From gholt at uw.edu  Mon Mar 31 07:12:52 2014
From: gholt at uw.edu (Gordon Holtgrieve)
Date: Sun, 30 Mar 2014 22:12:52 -0700
Subject: [R-sig-Geo] Iteratively subsample a rater and reassemble
Message-ID: <CAMiGwMd63BJAO1CP7aGeBvNRj+oHGiYwWV4jJhdwG5B41YERCA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140330/82a77886/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Mar 31 11:02:10 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 31 Mar 2014 11:02:10 +0200
Subject: [R-sig-Geo] Error plotting Variogram Map
In-Reply-To: <CAG=AKhXZcv6-vcO-q9LRmwHo47wRZivmwOxEA+Vth1C3cnfWUw@mail.gmail.com>
References: <CAG=AKhXZcv6-vcO-q9LRmwHo47wRZivmwOxEA+Vth1C3cnfWUw@mail.gmail.com>
Message-ID: <53392F12.8090602@uni-muenster.de>



On 03/30/2014 03:33 PM, Ramiro Augusto Espada wrote:
> Hi !
> 
> I want to plot a variogram map for evaluate the isotropy of a variable, but
> I can?t because I get an error.
> 
>> plot(variogram(ECa~1, Obj, map=T, cutoff=0.0004, width=0.00004))
> *Error in .local(x, ...) : unused argument (select = 1)*
> 
> I have also tested with meuse data, but I get the same error.

Please share what you exactly did with the meuse data to get this error.

e.g.,

m = variogram(zinc~1,meuse,map=T,cutoff=1000,width=100)
plot(m)

works for me.

> 
> I apreciated any help with this.
> 
> regards
> Ramiro.
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140331/c440ad41/attachment.bin>

From ben.graeler at uni-muenster.de  Mon Mar 31 11:57:08 2014
From: ben.graeler at uni-muenster.de (=?ISO-8859-1?Q?Benedikt_Gr=E4ler?=)
Date: Mon, 31 Mar 2014 11:57:08 +0200
Subject: [R-sig-Geo] yet another plotKML question
In-Reply-To: <FF9DB805FC41CC4E95825A50F680630217B4BD94@challenger.uhd.campus>
References: <FF9DB805FC41CC4E95825A50F680630217B4BD94@challenger.uhd.campus>
Message-ID: <53393BF4.4080705@uni-muenster.de>

kml_layer.STFDF is called when you call kml_layer with a STFDF object
and for instance from inside plotKML via the method dispatch.

HTH,

 Ben

On 30.03.2014 18:29, Hodgess, Erin wrote:
> This is really goofy, so please forgive me in advance:  where is
> "kml_layer.STFDF" called from, please?
> 
> Sorry.
> 
> e
> 
> 
> [[alternative HTML version deleted]]
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Benedikt Gr?ler

ifgi - Institute for Geoinformatics
University of Muenster

http://ifgi.uni-muenster.de/graeler

Phone: +49 251 83-33082
Mail: ben.graeler at uni-muenster.de

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 560 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140331/8478ad33/attachment.bin>

From jgrn at illinois.edu  Mon Mar 31 18:11:46 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Mon, 31 Mar 2014 11:11:46 -0500
Subject: [R-sig-Geo] Iteratively subsample a rater and reassemble
In-Reply-To: <CAMiGwMd63BJAO1CP7aGeBvNRj+oHGiYwWV4jJhdwG5B41YERCA@mail.gmail.com>
References: <CAMiGwMd63BJAO1CP7aGeBvNRj+oHGiYwWV4jJhdwG5B41YERCA@mail.gmail.com>
Message-ID: <CABG0rfv_S_qxZUerLxZBexQWMJM2WM7vGPfxFtwgg1rKGUf2gw@mail.gmail.com>

Gordon:

To clarify, you are trying to determine a relative population density
per country, correct?  I think you should look at the ?subs function,
which will make it a lot easier to swap the country ID with the
population value -- you just need a data.frame of ID and population.
Then it seems if you create a new raster that has the population of
the country for each cell, you can simply divide the per-location
population by that raster.

--j

On Mon, Mar 31, 2014 at 12:12 AM, Gordon Holtgrieve <gholt at uw.edu> wrote:
> Hello,
>
> I have not worked with rasters much in R and am having a bit of trouble.
>
> I have a raster of global population and a second raster of countries
> identified by UN code (both at 1/2 degree resolution, but with different
> extents).  Ultimately I would like to end up with a raster where each
> country's population is rescaled to N(0,1).
>
> Can someone suggest the best way to do this?
>
> So far I have been able to mask the population raster to a given country
> and perform the rescale (with the plan to loop over countries) .  I'm stuck
> on how to "reassemble" into a complete raster with all the countries.
>
> #Code thus far -- although I'm sure there is a better way.
> rasterCountriesUN[rasterCountriesUN != 840] <- NA  #Mask countries not of
> interest
>
> rasterCountriesUN[rasterCountriesUN == 840] <- 1  #replace the UN code with
> 1
>
> cropPop2010 <- rasterCountriesUN*rasterPop2010  # crop population data
> raster
>
> cropPop2010[cropPop2010>0] <- scale(cropPop2010[cropPop2010>0]) #rescale
> cells > 0 (i.e., with people)
> # I have other calculations to do here using the scaled population data.
>
> ###??? How do I store these results and move to the next country?  Or is
> there  better way to go about this?
>
>
> Many thanks,
>
> --
> Gordon Holtgrieve, Ph.D.
> Assistant Professor
> University of Washington
> School of Aquatic & Fishery Sciences
> 1122 NE Boat Street
> Box 355020
> Seattle, WA 98105 USA
> 1-206-616-7041
> skype: gholtgrieve
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jecogeo at gmail.com  Mon Mar 31 18:18:27 2014
From: jecogeo at gmail.com (Jefferson Ferreira Ferreira)
Date: Mon, 31 Mar 2014 13:18:27 -0300
Subject: [R-sig-Geo] rbind error - duplicated row.names not allowed
Message-ID: <CAFFT+Y6nCMhOts9N=MXgWqtC69CJPyqX3YcYMTTxrHvRv88VOw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140331/c874bc01/attachment.pl>

From jgrn at illinois.edu  Mon Mar 31 18:48:43 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Mon, 31 Mar 2014 11:48:43 -0500
Subject: [R-sig-Geo] align_rasters function added to gdalUtils 0.3.5
Message-ID: <CABG0rfsRoRj3FLp7QtkdnAprnj4yqVcy=K7z0PETkVSDHphUkg@mail.gmail.com>

Folks:

I added a beta of a new function "align_rasters" to gdalUtils 0.3.5
(currently on r-forge): http://r-forge.r-project.org/R/?group_id=1695

This is a fairly frequently requested function, where you want to
"coerce" one raster to match the projection, extent, and resolution of
another one (e.g. setting up a time series stack, or taking data from
multiple sources for use with a species distribution model).  I have
something similar in spatial.tools (spatial_sync_raster), but
align_rasters is MUCH faster since it uses the native gdal binaries to
do the processing.

You should check out the options in ?gdalwarp to see what additional
parameters you can send to align_rasters, but for the most part the
only thing you might want to mod is the resampling method (e.g.
align_rasters(...,r="near") ).  Also, and this is somewhat untested,
you can use multi=TRUE and it will, in theory, run the alignment using
multiple processors.

Let me know if you run into any bugs or want to see any features added.  Cheers!

--j

-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From gholt at uw.edu  Mon Mar 31 19:12:52 2014
From: gholt at uw.edu (Gordon Holtgrieve)
Date: Mon, 31 Mar 2014 10:12:52 -0700
Subject: [R-sig-Geo] Iteratively subsample a rater and reassemble
In-Reply-To: <CABG0rfv_S_qxZUerLxZBexQWMJM2WM7vGPfxFtwgg1rKGUf2gw@mail.gmail.com>
References: <CAMiGwMd63BJAO1CP7aGeBvNRj+oHGiYwWV4jJhdwG5B41YERCA@mail.gmail.com>
	<CABG0rfv_S_qxZUerLxZBexQWMJM2WM7vGPfxFtwgg1rKGUf2gw@mail.gmail.com>
Message-ID: <CAMiGwMddwby-D1W5tcqVxz1uwAGc9oALTk0=F9=iP3y1odrPVA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140331/3365dbd0/attachment.pl>

From jgrn at illinois.edu  Mon Mar 31 20:27:04 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Mon, 31 Mar 2014 13:27:04 -0500
Subject: [R-sig-Geo] Iteratively subsample a rater and reassemble
In-Reply-To: <CAMiGwMddwby-D1W5tcqVxz1uwAGc9oALTk0=F9=iP3y1odrPVA@mail.gmail.com>
References: <CAMiGwMd63BJAO1CP7aGeBvNRj+oHGiYwWV4jJhdwG5B41YERCA@mail.gmail.com>
	<CABG0rfv_S_qxZUerLxZBexQWMJM2WM7vGPfxFtwgg1rKGUf2gw@mail.gmail.com>
	<CAMiGwMddwby-D1W5tcqVxz1uwAGc9oALTk0=F9=iP3y1odrPVA@mail.gmail.com>
Message-ID: <CABG0rftpvM2-4u-uQ2WqSNrxFijydcXc0KvDrqrwY+15q32oOw@mail.gmail.com>

Ok, so I think the way I described may work for what you are doing --
basically, make a raster where each pixel is the per-country
population value via ?subs linking the country code with the
population.  From that, you will have, for each pixel, an estimate for
the full country population, and a corresponding ACTUAL population for
each pixel, with which you can now do band math.

Given a raster of two countries A and B:

A A A B B B
A A A A B B
A A B B B B

And data.frame:
ID Population
A  100
B  200

A ?subs will return a raster:

100 100 100 200 200 200
100 100 100 100 200 200
100 100 200 200 200 200

A more brute-force (assuming you have enough memory) is to ?getValues
the entire raster, and convert it into a data.frame.  For small
rasters this is fine, for bigger rasters this is a more serious issue.

--j

On Mon, Mar 31, 2014 at 12:12 PM, Gordon Holtgrieve <gholt at uw.edu> wrote:
> Thanks for the reply Jonathan.
>
> I am actually trying to determine the relative population density spatially
> within each country, where the cell with the mean/median number of people
> set is to 0 (excluding cells with no population) and the variance from that
> is in units of SD.  This is the same as the scale() function.   I just want
> to do it on a per country basis rather than for the whole raster.
>
> Gordon
>
>
> On Mon, Mar 31, 2014 at 9:11 AM, Jonathan Greenberg <jgrn at illinois.edu>
> wrote:
>>
>> Gordon:
>>
>> To clarify, you are trying to determine a relative population density
>> per country, correct?  I think you should look at the ?subs function,
>> which will make it a lot easier to swap the country ID with the
>> population value -- you just need a data.frame of ID and population.
>> Then it seems if you create a new raster that has the population of
>> the country for each cell, you can simply divide the per-location
>> population by that raster.
>>
>> --j
>>
>> On Mon, Mar 31, 2014 at 12:12 AM, Gordon Holtgrieve <gholt at uw.edu> wrote:
>> > Hello,
>> >
>> > I have not worked with rasters much in R and am having a bit of trouble.
>> >
>> > I have a raster of global population and a second raster of countries
>> > identified by UN code (both at 1/2 degree resolution, but with different
>> > extents).  Ultimately I would like to end up with a raster where each
>> > country's population is rescaled to N(0,1).
>> >
>> > Can someone suggest the best way to do this?
>> >
>> > So far I have been able to mask the population raster to a given country
>> > and perform the rescale (with the plan to loop over countries) .  I'm
>> > stuck
>> > on how to "reassemble" into a complete raster with all the countries.
>> >
>> > #Code thus far -- although I'm sure there is a better way.
>> > rasterCountriesUN[rasterCountriesUN != 840] <- NA  #Mask countries not
>> > of
>> > interest
>> >
>> > rasterCountriesUN[rasterCountriesUN == 840] <- 1  #replace the UN code
>> > with
>> > 1
>> >
>> > cropPop2010 <- rasterCountriesUN*rasterPop2010  # crop population data
>> > raster
>> >
>> > cropPop2010[cropPop2010>0] <- scale(cropPop2010[cropPop2010>0]) #rescale
>> > cells > 0 (i.e., with people)
>> > # I have other calculations to do here using the scaled population data.
>> >
>> > ###??? How do I store these results and move to the next country?  Or is
>> > there  better way to go about this?
>> >
>> >
>> > Many thanks,
>> >
>> > --
>> > Gordon Holtgrieve, Ph.D.
>> > Assistant Professor
>> > University of Washington
>> > School of Aquatic & Fishery Sciences
>> > 1122 NE Boat Street
>> > Box 355020
>> > Seattle, WA 98105 USA
>> > 1-206-616-7041
>> > skype: gholtgrieve
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
>
>
>
> --
> Gordon Holtgrieve, Ph.D.
> Assistant Professor
> University of Washington
> School of Aquatic & Fishery Sciences
> 1122 NE Boat Street
> Box 355020
> Seattle, WA 98105 USA
> 1-206-616-7041
> skype: gholtgrieve



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From forrest at ufl.edu  Mon Mar 31 20:38:57 2014
From: forrest at ufl.edu (Forrest Stevens)
Date: Mon, 31 Mar 2014 14:38:57 -0400
Subject: [R-sig-Geo] Iteratively subsample a rater and reassemble
In-Reply-To: <CABG0rftpvM2-4u-uQ2WqSNrxFijydcXc0KvDrqrwY+15q32oOw@mail.gmail.com>
References: <CAMiGwMd63BJAO1CP7aGeBvNRj+oHGiYwWV4jJhdwG5B41YERCA@mail.gmail.com>
	<CABG0rfv_S_qxZUerLxZBexQWMJM2WM7vGPfxFtwgg1rKGUf2gw@mail.gmail.com>
	<CAMiGwMddwby-D1W5tcqVxz1uwAGc9oALTk0=F9=iP3y1odrPVA@mail.gmail.com>
	<CABG0rftpvM2-4u-uQ2WqSNrxFijydcXc0KvDrqrwY+15q32oOw@mail.gmail.com>
Message-ID: <CAEBQMMnqaHo+X7qwnEZTG780h8HGuDDecLYzx=MyFh5WGnODmg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140331/735d2620/attachment.pl>

