From alobolistas at gmail.com  Thu Jul  1 07:02:53 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 1 Jul 2010 07:02:53 +0200
Subject: [R-sig-Geo] polygonValues (raster): Very slow
In-Reply-To: <87A96661E65C5541AB4D20721C2DD7F880A316873F@EXCH-MBX-A.ulaval.ca>
References: <AANLkTikPNOMFUdF87TsWUcJCoqXX-Am7G5eeMXHDinPf@mail.gmail.com>
	<87A96661E65C5541AB4D20721C2DD7F880A316873F@EXCH-MBX-A.ulaval.ca>
Message-ID: <AANLkTim1qGtPyy2UPDEVduowmiE7ifkcBliQT1WQ7q8u@mail.gmail.com>

Pierre,

This looks great also, thanks. It's going to take a while, though, as
I'm working
on linux and will have to compile WKT and probably PostGis also (don't
know if the
later comes included with the binary distro of qgis).
Why don't you talk to the ubuntugis people for a regular ubuntu
package? You could use
the unstable branch if needed:
https://launchpad.net/~ubuntugis/+archive/ubuntugis-unstable
This would make things so much easier for people using ubuntu and WKT would be
tested by many more users.

I'll let you know how this works.

Agus



2010/6/30 Pierre Racine <Pierre.Racine at sbf.ulaval.ca>:
> Agustin,
>
> PostGIS WKT Raster was made to do exactly this kind of operation on large datasets. Give it a try!
>
> http://trac.osgeo.org/postgis/wiki/WKTRasterTutorial01
>
> Pierre
>
>>-----Original Message-----
>>From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
>>Agustin Lobo
>>Sent: 30 juin 2010 10:13
>>To: r-sig-geo
>>Cc: agustin.lobo at ija.csic.es
>>Subject: [R-sig-Geo] polygonValues (raster): Very slow
>>
>>Hi!
>>I'm trying:
>>
>>> eugrd025EFDC <- readOGR(dsn="eugrd025EFDC",layer="eugrd025EFDC")
>>v <- polygonValues(p=eugrd025EFDC, Br, weights=TRUE)
>>
>>where
>>
>>> str(eugrd025EFDC,max.level=2)
>>Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots
>> ?..@ data ? ? ? :'data.frame': ? ? ? ?18000 obs. of ?5 variables:
>> ?..@ polygons ? :List of 18000
>> ?.. .. [list output truncated]
>> ?..@ plotOrder ?: int [1:18000] 17901 17900 17902 17903 17899 17898
>>17904 17897 17905 17906 ...
>> ?..@ bbox ? ? ? : num [1:2, 1:2] 2484331 1314148 6575852 4328780
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>
>>> summary(Br)
>>Cells: ?13967442
>>NAs ?: ?0
>>
>>
>>Min. ? ? ? 0.00
>>1st Qu. ? ?0.00
>>Median ? ? 0.00
>>Mean ? ? ?48.82
>>3rd Qu. ? ?0.00
>>Max. ? ?4999.00
>>
>>so quite large objects.
>>
>>The problem is that ?polygonValues() has been running (and not
>>completed the task) for
>>more than 2 h on a intel core i7 machine with 16 Gb RAM (Dell
>>Precision M6500), so a pretty powerful machine.
>>Is there any way I could speed up this process?
>>Also, is there anything I could do in order to take better advantage
>>of the 8 processing threads?
>>Currently, I see only 1 cpu working for R processes and the rest
>>remain pretty inactive
>>
>>Thanks
>>
>>Agus
>>
>>_______________________________________________
>>R-sig-Geo mailing list
>>R-sig-Geo at stat.math.ethz.ch
>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Tord.Snall at ekol.slu.se  Thu Jul  1 10:59:41 2010
From: Tord.Snall at ekol.slu.se (=?iso-8859-1?Q?Tord_Sn=E4ll?=)
Date: Thu, 1 Jul 2010 10:59:41 +0200
Subject: [R-sig-Geo] make thousands SpatialPolygons()
Message-ID: <056219D4D86F5348B983EAC859B52FA0B9B35AAF61@exmbx3.ad.slu.se>

Hi,
I want to make approximately 10000 square polygons (300*300) based on coordinates in a data frame, and make a .shp-file out of these.

The .pdf "S Classes and Methods for Spatial Data: the sp Package" by Pebesma and Bivand contains an instruction on how to do this, and it works very well, e.g. 

i=1
Sr1 = Polygon(cbind(c(dat[i,"X"]-150,dat[i,"X"] - 150,dat[i,"X"]+150,dat[i,"X"]+150,dat[i,"X"]-150),
c(dat[i,"Y"]-150,dat[i,"Y"]+150,dat[i,"Y"]+150,dat[i,"Y"]-150,dat[i,"Y"]-150)))

Srs1 = Polygons(list(Sr1),paste("Number.",i,sep=""))

i=2
Sr2 = Polygon(cbind(c(dat[i,"X"]-150,dat[i,"X"] -150,dat[i,"X"]+150,dat[i,"X"]+150,dat[i,"X"]-150),
c(dat[i,"Y"]-150,dat[i,"Y"]+150,dat[i,"Y"]+150,dat[i,"Y"]-150,dat[i,"Y"]-150)))

Srs2 = Polygons(list(Sr2),paste("Number.",i,sep=""))

SpP = SpatialPolygons(list(Srs1, Srs2), 1:2)

SrDf = SpatialPolygonsDataFrame(SpP, dat[1:2,]) 

writePolyShape(SrDf, fn="TvaRutor")


However, my data frame "dat" has ~10000 coords and want to write a loop for doing what is done above. My problem is how to store Sr1, Srs1, Sr2, Srs2,... Sr10000, Srs10000 etc to be used in SpatialPolygons().

Help on this is much appreciated.

Cheers,
Tord


From Tord.Snall at ekol.slu.se  Thu Jul  1 11:31:46 2010
From: Tord.Snall at ekol.slu.se (=?iso-8859-1?Q?Tord_Sn=E4ll?=)
Date: Thu, 1 Jul 2010 11:31:46 +0200
Subject: [R-sig-Geo] make thousands SpatialPolygons()
In-Reply-To: <AANLkTinkFZoTyYBUQv0S5htPx01DafYu4ub5ha1GeG_e@mail.gmail.com>
References: <056219D4D86F5348B983EAC859B52FA0B9B35AAF61@exmbx3.ad.slu.se>
	<AANLkTinkFZoTyYBUQv0S5htPx01DafYu4ub5ha1GeG_e@mail.gmail.com>
Message-ID: <056219D4D86F5348B983EAC859B52FA0B9B35AAF7A@exmbx3.ad.slu.se>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100701/884431c6/attachment.pl>

From landis at isciences.com  Thu Jul  1 16:05:32 2010
From: landis at isciences.com (Matthew Landis)
Date: Thu, 01 Jul 2010 10:05:32 -0400
Subject: [R-sig-Geo] Gaussian grids in R
Message-ID: <4C2CA0AC.1020303@isciences.com>

Dear  R-sig-geo members,

I wonder if any of you have suggestions about how to import and use 
rasters with a spectral Gaussian T62 CRS in R.  I'm not very familiar 
with this coordinate system (commonly used for climate models), and I 
haven't been able to discover tools for dealing with them in R, either 
in PROJ.4 or mapproj or anywhere else, despite extensive scouring of the 
web.  Details of Gaussian grids can be seen at
http://en.wikipedia.org/wiki/Gaussian_grid and 
http://www.nco.ncep.noaa.gov/pmb/docs/on388/tableb.html#GRID98

Specifically, I'm trying to use output from the NCEP CFS climate models 
(see http://cfs.ncep.noaa.gov/cfs/monthly/tmp2m/ -- these are in GRIB 
format).  A different example of a T62 grid can be downloaded in netCDF 
format at http://www.sage.wisc.edu/iamdata/grid.php. 

The goal is to transform the CRS into geographic lat/lon coordinates to 
be more compatible with our other datasets.  The big problem with 
getting these data into a SpatialGrid or SpatialPixelsDataFrame is that 
the latitude cells are not equally spaced - they get smaller towards the 
poles.  I may be able to approximate it to a regular grid by ignoring 
the changes to the poles (they are rather small after all), but I'd 
rather do it properly if possible.

Code below shows extracting latitudes from a T62 grid and plotting the 
changes in cell size with latitude.

library('ncdf')
library('sp')
nc <- 'C:/scratch/cfs/pop_den_1995_T62.nc' # Downloaded  from 
http://www.sage.wisc.edu/iamdata/grid.php

# Open the file and get latitude and longitude
nc <- open.ncdf(ncfile)
lat <- get.var.ncdf(nc, varid = 'latitude')
lon <- get.var.ncdf(nc, varid = 'longitude')
close.ncdf(nc)

# Generate coordinates for each grid cell
x <- rep(lon, length(lat))
y <- rep(lat, each = length(lon))
sp <- SpatialPoints(cbind(x,y))
# temp <- SpatialPixels(points = sp) # Doesn't work.  points have to be 
regular grid

# Show how the cell size changes with latitude
cell.size <- diff(rev(lat))
plot(lat[-1], cell.size)

Many thanks for any suggestions!

Matt

-- 
~~~~~~~~~~~~~~~~~~~~~~~~~~
Matthew Landis, Ph.D.
Research Scientist
ISciences, LLC
61 Main St. Suite 200
Burlington VT 05401
802.864.2999
~~~~~~~~~~~~~~~~~~~~~~~~~~


From zev at zevross.com  Thu Jul  1 16:53:44 2010
From: zev at zevross.com (Zev Ross)
Date: Thu, 01 Jul 2010 10:53:44 -0400
Subject: [R-sig-Geo] Nugget from variogram.fit vs GLS
Message-ID: <4C2CABF8.6020400@zevross.com>

Hi All,

I'm verifying coefficients generated with GSTAT kriging with external 
drift using GLS. The coefficients match absolutely perfectly. The range 
also matches perfectly. But there is a big difference in what GLS gives 
as the output for the nugget. Can anyone explain why this is?

Zev

###### KED

# here's where I fit the variogram and the fit output

v.fit = fit.variogram(v, vgm(1.5, "Exp", 20, 0.5))

 > v.fit
   model    psill     range
1   Nug 1.302310 0.0000000
2   Exp 1.413246 0.8098587

# the fit is used in a KED model
g = gstat(formula=formula(MODEL), data = so2, model = v.fit)

# here I get the coefs (these coefs match those from GLS below perfectly)
UKcoef<-predict(g, lattice, BLUE=c(TRUE,TRUE))

###### GLS

# use the same parameters as above and fix them

nug<-v.fit[1,2] # this is 1.302
sill<-v.fit[1,2]+v.fit[2,2]
range<-v.fit[2,3]

theGLS<-gls(formula(so2FinalAll), data=so2, na.action=na.omit, 
correlation=corExp(c(range, nug/sill ),
     form=~X+Y, nugget=TRUE,fixed=TRUE), method="ML")

 > summary(theGLS)
Generalized least squares fit by maximum likelihood
   Model: formula(so2FinalAll)
   Data: so2
        AIC      BIC    logLik
   578.6551 593.7083 -284.3275

Correlation Structure: Exponential spatial correlation
  Formula: ~X + Y
  Parameter estimate(s):
     range    nugget
0.8098587 0.4795740

# note the nugget of 0.479 vs the 1.302 above.

-- 
Zev Ross
ZevRoss Spatial Analysis
120 N Aurora, Suite 3A
Ithaca, NY 14850
607-277-0004 (phone)
866-877-3690 (fax, toll-free)
zev at zevross.com


From alobolistas at gmail.com  Thu Jul  1 17:40:18 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 1 Jul 2010 17:40:18 +0200
Subject: [R-sig-Geo] spTransform changes the class
Message-ID: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>

Hi!

I use spTransform to reproject:

> class(eugrd025)
[1] "SpatialGrid"
attr(,"package")
[1] "sp"

> projection(eugrd025)
[1] "+proj=longlat +ellps=WGS84"

> eugrd025EFDC <- spTransform(eugrd025, CRSobj=CRS(projection(eugrd025EFDC_SPDF)))

> projection(eugrd025EFDC)
[1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
+ellps=GRS80 +units=m +no_defs"

This is good, but:
> class(eugrd025EFDC)
[1] "SpatialPoints"
attr(,"package")
[1] "sp"

Why is the class changed to SpatialPoints? I need a grid object for
> eugrd025EFDCr <- raster(eugrd025EFDC)
> Br025 <- resample(Br,eugrd025EFDCr)

don't I?

I also have the problem that the CRS of eugrd025EFDCr is not conserved:
> projection(Br)
[1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
+ellps=GRS80 +units=m +no_defs"

> projection(eugrd025EFDC)
[1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
+ellps=GRS80 +units=m +no_defs"

> projection(eugrd025EFDCr)
[1] "NA"

which I fix with
> projection(eugrd025EFDCr) <- CRS(projection(eugrd025EFDC))

and repeat
> Br025 <- resample(Br,eugrd025EFDCr)

Anyway, I get a much coarser raster than I want:
> dim(Br025)
[1] 10 10  1

because
> dim(eugrd025EFDCr)
[1] 10 10  1

While it should be 180x100:

> summary(eugrd025EFDC)
Object of class SpatialPoints
Coordinates:
       min     max
s1 2498538 6561151
s2 1327858 4313263
Is projected: TRUE
proj4string :
[+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80
+units=m +no_defs]
Number of points: 18000
> dim(Br025)
[1] 10 10  1

> summary(eugrd025)
Object of class SpatialGrid
Coordinates:
              min    max
coords.x1 -10.125 34.875
coords.x2  34.875 59.875
Is projected: FALSE
proj4string : [+proj=longlat +ellps=WGS84]
Number of points: 2
Grid attributes:
  cellcentre.offset cellsize cells.dim
1               -10     0.25       180
2                35     0.25       100

Is eugrd025EFDCr wrong because class(eugrd025EFDC) has been changed
from SpatialGrid to SpatialPoints?

Agus


From mdsumner at gmail.com  Thu Jul  1 17:46:22 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 2 Jul 2010 01:46:22 +1000
Subject: [R-sig-Geo] spTransform changes the class
In-Reply-To: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>
References: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>
Message-ID: <AANLkTilXPYugNjqbqqQYpKRFiGbIqz-8__TfQFRFjxL0@mail.gmail.com>

spTransform cannot reproject a grid - this will (usually) requires
destructive resampling of the data to a completely new grid. There are
functions in the raster package to do this: projectRaster.

I think this would work, but there may be important details that you
will need to investigate:

raster.eugrd025 <- raster(eugrd025)

eugrd025EFDC <- projectRaster(raster.eugrd025,
CRSobj=CRS(projection(eugrd025EFDC_SPDF)))

On Fri, Jul 2, 2010 at 1:40 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
>
> I use spTransform to reproject:
>
>> class(eugrd025)
> [1] "SpatialGrid"
> attr(,"package")
> [1] "sp"
>
>> projection(eugrd025)
> [1] "+proj=longlat +ellps=WGS84"
>
>> eugrd025EFDC <- spTransform(eugrd025, CRSobj=CRS(projection(eugrd025EFDC_SPDF)))
>
>> projection(eugrd025EFDC)
> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
> +ellps=GRS80 +units=m +no_defs"
>
> This is good, but:
>> class(eugrd025EFDC)
> [1] "SpatialPoints"
> attr(,"package")
> [1] "sp"
>
> Why is the class changed to SpatialPoints? I need a grid object for
>> eugrd025EFDCr <- raster(eugrd025EFDC)
>> Br025 <- resample(Br,eugrd025EFDCr)
>
> don't I?
>
> I also have the problem that the CRS of eugrd025EFDCr is not conserved:
>> projection(Br)
> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
> +ellps=GRS80 +units=m +no_defs"
>
>> projection(eugrd025EFDC)
> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
> +ellps=GRS80 +units=m +no_defs"
>
>> projection(eugrd025EFDCr)
> [1] "NA"
>
> which I fix with
>> projection(eugrd025EFDCr) <- CRS(projection(eugrd025EFDC))
>
> and repeat
>> Br025 <- resample(Br,eugrd025EFDCr)
>
> Anyway, I get a much coarser raster than I want:
>> dim(Br025)
> [1] 10 10 ?1
>
> because
>> dim(eugrd025EFDCr)
> [1] 10 10 ?1
>
> While it should be 180x100:
>
>> summary(eugrd025EFDC)
> Object of class SpatialPoints
> Coordinates:
> ? ? ? min ? ? max
> s1 2498538 6561151
> s2 1327858 4313263
> Is projected: TRUE
> proj4string :
> [+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80
> +units=m +no_defs]
> Number of points: 18000
>> dim(Br025)
> [1] 10 10 ?1
>
>> summary(eugrd025)
> Object of class SpatialGrid
> Coordinates:
> ? ? ? ? ? ? ?min ? ?max
> coords.x1 -10.125 34.875
> coords.x2 ?34.875 59.875
> Is projected: FALSE
> proj4string : [+proj=longlat +ellps=WGS84]
> Number of points: 2
> Grid attributes:
> ?cellcentre.offset cellsize cells.dim
> 1 ? ? ? ? ? ? ? -10 ? ? 0.25 ? ? ? 180
> 2 ? ? ? ? ? ? ? ?35 ? ? 0.25 ? ? ? 100
>
> Is eugrd025EFDCr wrong because class(eugrd025EFDC) has been changed
> from SpatialGrid to SpatialPoints?
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mdsumner at gmail.com  Thu Jul  1 17:48:37 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 2 Jul 2010 01:48:37 +1000
Subject: [R-sig-Geo] spTransform changes the class
In-Reply-To: <AANLkTilXPYugNjqbqqQYpKRFiGbIqz-8__TfQFRFjxL0@mail.gmail.com>
References: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>
	<AANLkTilXPYugNjqbqqQYpKRFiGbIqz-8__TfQFRFjxL0@mail.gmail.com>
Message-ID: <AANLkTimhW27mqRDJGuiql-pBinAloEcQliWM_bHf58Ke@mail.gmail.com>

Ah, sorry that was completely wrong. I think this is right, but still untested:

raster.eugrd025 <- raster(eugrd025)

pr <- projectExtent(raster.eugrd025, projection(eugrd025EFDC_SPDF))

eugrd025EFDC <- projectRaster(raster.eugrd025, pr)



On Fri, Jul 2, 2010 at 1:46 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> spTransform cannot reproject a grid - this will (usually) requires
> destructive resampling of the data to a completely new grid. There are
> functions in the raster package to do this: projectRaster.
>
> I think this would work, but there may be important details that you
> will need to investigate:
>
> raster.eugrd025 <- raster(eugrd025)
>
> eugrd025EFDC <- projectRaster(raster.eugrd025,
> CRSobj=CRS(projection(eugrd025EFDC_SPDF)))
>
> On Fri, Jul 2, 2010 at 1:40 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi!
>>
>> I use spTransform to reproject:
>>
>>> class(eugrd025)
>> [1] "SpatialGrid"
>> attr(,"package")
>> [1] "sp"
>>
>>> projection(eugrd025)
>> [1] "+proj=longlat +ellps=WGS84"
>>
>>> eugrd025EFDC <- spTransform(eugrd025, CRSobj=CRS(projection(eugrd025EFDC_SPDF)))
>>
>>> projection(eugrd025EFDC)
>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>> +ellps=GRS80 +units=m +no_defs"
>>
>> This is good, but:
>>> class(eugrd025EFDC)
>> [1] "SpatialPoints"
>> attr(,"package")
>> [1] "sp"
>>
>> Why is the class changed to SpatialPoints? I need a grid object for
>>> eugrd025EFDCr <- raster(eugrd025EFDC)
>>> Br025 <- resample(Br,eugrd025EFDCr)
>>
>> don't I?
>>
>> I also have the problem that the CRS of eugrd025EFDCr is not conserved:
>>> projection(Br)
>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>> +ellps=GRS80 +units=m +no_defs"
>>
>>> projection(eugrd025EFDC)
>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>> +ellps=GRS80 +units=m +no_defs"
>>
>>> projection(eugrd025EFDCr)
>> [1] "NA"
>>
>> which I fix with
>>> projection(eugrd025EFDCr) <- CRS(projection(eugrd025EFDC))
>>
>> and repeat
>>> Br025 <- resample(Br,eugrd025EFDCr)
>>
>> Anyway, I get a much coarser raster than I want:
>>> dim(Br025)
>> [1] 10 10 ?1
>>
>> because
>>> dim(eugrd025EFDCr)
>> [1] 10 10 ?1
>>
>> While it should be 180x100:
>>
>>> summary(eugrd025EFDC)
>> Object of class SpatialPoints
>> Coordinates:
>> ? ? ? min ? ? max
>> s1 2498538 6561151
>> s2 1327858 4313263
>> Is projected: TRUE
>> proj4string :
>> [+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80
>> +units=m +no_defs]
>> Number of points: 18000
>>> dim(Br025)
>> [1] 10 10 ?1
>>
>>> summary(eugrd025)
>> Object of class SpatialGrid
>> Coordinates:
>> ? ? ? ? ? ? ?min ? ?max
>> coords.x1 -10.125 34.875
>> coords.x2 ?34.875 59.875
>> Is projected: FALSE
>> proj4string : [+proj=longlat +ellps=WGS84]
>> Number of points: 2
>> Grid attributes:
>> ?cellcentre.offset cellsize cells.dim
>> 1 ? ? ? ? ? ? ? -10 ? ? 0.25 ? ? ? 180
>> 2 ? ? ? ? ? ? ? ?35 ? ? 0.25 ? ? ? 100
>>
>> Is eugrd025EFDCr wrong because class(eugrd025EFDC) has been changed
>> from SpatialGrid to SpatialPoints?
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From isabelle.boulangeat at gmail.com  Thu Jul  1 17:51:29 2010
From: isabelle.boulangeat at gmail.com (isabelle boulangeat)
Date: Thu, 1 Jul 2010 17:51:29 +0200
Subject: [R-sig-Geo] spTransform changes the class
In-Reply-To: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>
References: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>
Message-ID: <AANLkTilIHOx4X9GAhJmz1eTnyfNSLyNS4LX6D_tS9lqB@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100701/c34029db/attachment.pl>

From mdsumner at gmail.com  Thu Jul  1 18:00:29 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 2 Jul 2010 02:00:29 +1000
Subject: [R-sig-Geo] spTransform changes the class
In-Reply-To: <AANLkTilIHOx4X9GAhJmz1eTnyfNSLyNS4LX6D_tS9lqB@mail.gmail.com>
References: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>
	<AANLkTilIHOx4X9GAhJmz1eTnyfNSLyNS4LX6D_tS9lqB@mail.gmail.com>
Message-ID: <AANLkTil3EgTGoGnWOTIa_oG3SPkobrQZCMEx6E1fda_6@mail.gmail.com>

I forgot to mention the first time, spTransform will not reproject a
grid but it will coerce the grid to points and then return reprojected
versions of those. That's why Agustin sees the class change from grid
to points.

You can see this in the method definitions for SpatialGrid/PixelDataFrame, e.g.


setMethod("spTransform", signature("SpatialPixelsDataFrame", "CRS"),
	function(x, CRSobj, ...)
		spTransform(as(x, "SpatialPointsDataFrame"), CRSobj, ...))

setMethod("spTransform", signature("SpatialGridDataFrame", "CRS"),
	function(x, CRSobj, ...)
		spTransform(as(x, "SpatialPixelsDataFrame"), CRSobj, ...))


Cheers, Mike.

On Fri, Jul 2, 2010 at 1:51 AM, isabelle boulangeat
<isabelle.boulangeat at gmail.com> wrote:
> Hi!
>
> Are you sure that the *spTransform *method can be applied to a SpatialGrid
> object? I think it only works for SpatialPoints, SpatialLines and
> SpatialPolygons.
> If you are working with rasters, perhaps you should use the function
> *projectRaster
> *from the package raster.
>
> I hope it helps...
>
> Isa.
>
> 2010/7/1 Agustin Lobo <alobolistas at gmail.com>
>
>> Hi!
>>
>> I use spTransform to reproject:
>>
>> > class(eugrd025)
>> [1] "SpatialGrid"
>> attr(,"package")
>> [1] "sp"
>>
>> > projection(eugrd025)
>> [1] "+proj=longlat +ellps=WGS84"
>>
>> > eugrd025EFDC <- spTransform(eugrd025,
>> CRSobj=CRS(projection(eugrd025EFDC_SPDF)))
>>
>> > projection(eugrd025EFDC)
>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>> +ellps=GRS80 +units=m +no_defs"
>>
>> This is good, but:
>> > class(eugrd025EFDC)
>> [1] "SpatialPoints"
>> attr(,"package")
>> [1] "sp"
>>
>> Why is the class changed to SpatialPoints? I need a grid object for
>> > eugrd025EFDCr <- raster(eugrd025EFDC)
>> > Br025 <- resample(Br,eugrd025EFDCr)
>>
>> don't I?
>>
>> I also have the problem that the CRS of eugrd025EFDCr is not conserved:
>> > projection(Br)
>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>> +ellps=GRS80 +units=m +no_defs"
>>
>> > projection(eugrd025EFDC)
>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>> +ellps=GRS80 +units=m +no_defs"
>>
>> > projection(eugrd025EFDCr)
>> [1] "NA"
>>
>> which I fix with
>> > projection(eugrd025EFDCr) <- CRS(projection(eugrd025EFDC))
>>
>> and repeat
>> > Br025 <- resample(Br,eugrd025EFDCr)
>>
>> Anyway, I get a much coarser raster than I want:
>> > dim(Br025)
>> [1] 10 10 ?1
>>
>> because
>> > dim(eugrd025EFDCr)
>> [1] 10 10 ?1
>>
>> While it should be 180x100:
>>
>> > summary(eugrd025EFDC)
>> Object of class SpatialPoints
>> Coordinates:
>> ? ? ? min ? ? max
>> s1 2498538 6561151
>> s2 1327858 4313263
>> Is projected: TRUE
>> proj4string :
>> [+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80
>> +units=m +no_defs]
>> Number of points: 18000
>> > dim(Br025)
>> [1] 10 10 ?1
>>
>> > summary(eugrd025)
>> Object of class SpatialGrid
>> Coordinates:
>> ? ? ? ? ? ? ?min ? ?max
>> coords.x1 -10.125 34.875
>> coords.x2 ?34.875 59.875
>> Is projected: FALSE
>> proj4string : [+proj=longlat +ellps=WGS84]
>> Number of points: 2
>> Grid attributes:
>> ?cellcentre.offset cellsize cells.dim
>> 1 ? ? ? ? ? ? ? -10 ? ? 0.25 ? ? ? 180
>> 2 ? ? ? ? ? ? ? ?35 ? ? 0.25 ? ? ? 100
>>
>> Is eugrd025EFDCr wrong because class(eugrd025EFDC) has been changed
>> from SpatialGrid to SpatialPoints?
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Isabelle Boulangeat, PhD student
> Ecosystem dynamics and plant traits
>
> Bureau 203, +33 (0) 476 635 733
>
> Laboratoire d'?cologie Alpine (LECA)
> Grenoble, France
> lab' s website : http://www-leca.ujf-grenoble.fr/
> my website : http://j.boulangeat.free.fr/
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From r.hijmans at gmail.com  Thu Jul  1 18:21:15 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 1 Jul 2010 09:21:15 -0700
Subject: [R-sig-Geo] spTransform changes the class
In-Reply-To: <AANLkTimhW27mqRDJGuiql-pBinAloEcQliWM_bHf58Ke@mail.gmail.com>
References: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>
	<AANLkTilXPYugNjqbqqQYpKRFiGbIqz-8__TfQFRFjxL0@mail.gmail.com>
	<AANLkTimhW27mqRDJGuiql-pBinAloEcQliWM_bHf58Ke@mail.gmail.com>
Message-ID: <AANLkTimGVZrjjp9-D4uJIng3KgGaWwcTAFe-AxtfdpHA@mail.gmail.com>

The general idea is that for changing the projection of a raster you
provide the input RasterLayer and a Raster object with the spatial
parameters (projection, extent, resolution) to which it should be
transformed. For the latter, you can use the RasterLayer that you want
to project the input data to (I call it 'x').

prjgrd <- projectRaster(eugrd025, x, method='bilinear')

Note that it should *not* be necessary to resample after projection
because projecting a raster already implies resampling.

Robert

On Thu, Jul 1, 2010 at 8:48 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> Ah, sorry that was completely wrong. I think this is right, but still untested:
>
> raster.eugrd025 <- raster(eugrd025)
>
> pr <- projectExtent(raster.eugrd025, projection(eugrd025EFDC_SPDF))
>
> eugrd025EFDC <- projectRaster(raster.eugrd025, pr)
>
>
>
> On Fri, Jul 2, 2010 at 1:46 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> spTransform cannot reproject a grid - this will (usually) requires
>> destructive resampling of the data to a completely new grid. There are
>> functions in the raster package to do this: projectRaster.
>>
>> I think this would work, but there may be important details that you
>> will need to investigate:
>>
>> raster.eugrd025 <- raster(eugrd025)
>>
>> eugrd025EFDC <- projectRaster(raster.eugrd025,
>> CRSobj=CRS(projection(eugrd025EFDC_SPDF)))
>>
>> On Fri, Jul 2, 2010 at 1:40 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>> Hi!
>>>
>>> I use spTransform to reproject:
>>>
>>>> class(eugrd025)
>>> [1] "SpatialGrid"
>>> attr(,"package")
>>> [1] "sp"
>>>
>>>> projection(eugrd025)
>>> [1] "+proj=longlat +ellps=WGS84"
>>>
>>>> eugrd025EFDC <- spTransform(eugrd025, CRSobj=CRS(projection(eugrd025EFDC_SPDF)))
>>>
>>>> projection(eugrd025EFDC)
>>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>>> +ellps=GRS80 +units=m +no_defs"
>>>
>>> This is good, but:
>>>> class(eugrd025EFDC)
>>> [1] "SpatialPoints"
>>> attr(,"package")
>>> [1] "sp"
>>>
>>> Why is the class changed to SpatialPoints? I need a grid object for
>>>> eugrd025EFDCr <- raster(eugrd025EFDC)
>>>> Br025 <- resample(Br,eugrd025EFDCr)
>>>
>>> don't I?
>>>
>>> I also have the problem that the CRS of eugrd025EFDCr is not conserved:
>>>> projection(Br)
>>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>>> +ellps=GRS80 +units=m +no_defs"
>>>
>>>> projection(eugrd025EFDC)
>>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>>> +ellps=GRS80 +units=m +no_defs"
>>>
>>>> projection(eugrd025EFDCr)
>>> [1] "NA"
>>>
>>> which I fix with
>>>> projection(eugrd025EFDCr) <- CRS(projection(eugrd025EFDC))
>>>
>>> and repeat
>>>> Br025 <- resample(Br,eugrd025EFDCr)
>>>
>>> Anyway, I get a much coarser raster than I want:
>>>> dim(Br025)
>>> [1] 10 10 ?1
>>>
>>> because
>>>> dim(eugrd025EFDCr)
>>> [1] 10 10 ?1
>>>
>>> While it should be 180x100:
>>>
>>>> summary(eugrd025EFDC)
>>> Object of class SpatialPoints
>>> Coordinates:
>>> ? ? ? min ? ? max
>>> s1 2498538 6561151
>>> s2 1327858 4313263
>>> Is projected: TRUE
>>> proj4string :
>>> [+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80
>>> +units=m +no_defs]
>>> Number of points: 18000
>>>> dim(Br025)
>>> [1] 10 10 ?1
>>>
>>>> summary(eugrd025)
>>> Object of class SpatialGrid
>>> Coordinates:
>>> ? ? ? ? ? ? ?min ? ?max
>>> coords.x1 -10.125 34.875
>>> coords.x2 ?34.875 59.875
>>> Is projected: FALSE
>>> proj4string : [+proj=longlat +ellps=WGS84]
>>> Number of points: 2
>>> Grid attributes:
>>> ?cellcentre.offset cellsize cells.dim
>>> 1 ? ? ? ? ? ? ? -10 ? ? 0.25 ? ? ? 180
>>> 2 ? ? ? ? ? ? ? ?35 ? ? 0.25 ? ? ? 100
>>>
>>> Is eugrd025EFDCr wrong because class(eugrd025EFDC) has been changed
>>> from SpatialGrid to SpatialPoints?
>>>
>>> Agus
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Thu Jul  1 19:27:43 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 01 Jul 2010 19:27:43 +0200
Subject: [R-sig-Geo] Nugget from variogram.fit vs GLS
In-Reply-To: <4C2CABF8.6020400@zevross.com>
References: <4C2CABF8.6020400@zevross.com>
Message-ID: <4C2CD00F.6000607@uni-muenster.de>

Hi Zev,

it seems that gls returns the relative nugget rather than the absolute
returned by gstat:

> 1.30231/(1.413246+1.30231)
[1] 0.479574

Could that be? I'm quite surprised results are that similar, doesn't gls
use REML to fit variograms?

Best wishes from a vivid geostat 2010,

On 07/01/2010 04:53 PM, Zev Ross wrote:
> Hi All,
> 
> I'm verifying coefficients generated with GSTAT kriging with external
> drift using GLS. The coefficients match absolutely perfectly. The range
> also matches perfectly. But there is a big difference in what GLS gives
> as the output for the nugget. Can anyone explain why this is?
> 
> Zev
> 
> ###### KED
> 
> # here's where I fit the variogram and the fit output
> 
> v.fit = fit.variogram(v, vgm(1.5, "Exp", 20, 0.5))
> 
>> v.fit
>   model    psill     range
> 1   Nug 1.302310 0.0000000
> 2   Exp 1.413246 0.8098587
> 
> # the fit is used in a KED model
> g = gstat(formula=formula(MODEL), data = so2, model = v.fit)
> 
> # here I get the coefs (these coefs match those from GLS below perfectly)
> UKcoef<-predict(g, lattice, BLUE=c(TRUE,TRUE))
> 
> ###### GLS
> 
> # use the same parameters as above and fix them
> 
> nug<-v.fit[1,2] # this is 1.302
> sill<-v.fit[1,2]+v.fit[2,2]
> range<-v.fit[2,3]
> 
> theGLS<-gls(formula(so2FinalAll), data=so2, na.action=na.omit,
> correlation=corExp(c(range, nug/sill ),
>     form=~X+Y, nugget=TRUE,fixed=TRUE), method="ML")
> 
>> summary(theGLS)
> Generalized least squares fit by maximum likelihood
>   Model: formula(so2FinalAll)
>   Data: so2
>        AIC      BIC    logLik
>   578.6551 593.7083 -284.3275
> 
> Correlation Structure: Exponential spatial correlation
>  Formula: ~X + Y
>  Parameter estimate(s):
>     range    nugget
> 0.8098587 0.4795740
> 
> # note the nugget of 0.479 vs the 1.302 above.
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From alobolistas at gmail.com  Thu Jul  1 21:23:47 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 1 Jul 2010 21:23:47 +0200
Subject: [R-sig-Geo] spTransform changes the class
In-Reply-To: <AANLkTimGVZrjjp9-D4uJIng3KgGaWwcTAFe-AxtfdpHA@mail.gmail.com>
References: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com>
	<AANLkTilXPYugNjqbqqQYpKRFiGbIqz-8__TfQFRFjxL0@mail.gmail.com>
	<AANLkTimhW27mqRDJGuiql-pBinAloEcQliWM_bHf58Ke@mail.gmail.com>
	<AANLkTimGVZrjjp9-D4uJIng3KgGaWwcTAFe-AxtfdpHA@mail.gmail.com>
Message-ID: <AANLkTintZbuFV9hSKsnV86NAh2oSt26bNypeVYxDdtGg@mail.gmail.com>

Thank you all for your ideas.
Please note though that the goal is to create a raster as a reference
object for running resample().
The original data is a high resolution raster in EPSG 3035 (Br) that I
want to resample
to a lon,lat grid of 0.25 deg resolution (Frankly, I'm astonished that
such a simple operation
is so complicated in R, I think that it would be very simple in grass)

After having created the grid eugrd025, my first idea was just
considering that a grid is not
but a set of adjacent rectangular polygons and hence
raster::polygonValues() would solve my problem. Thus I converted the
grid eugrd025 to SpatialPolygons (eugrd025DF),
reprojected to EPSG 3035 (eugrd025EFDC_SPDF) and tried polygonValues()
. This did not work
(see [1])
and I was advised to try an "all raster approach", which is a good
approximation in this case as the resolution of the grid is much
larger than the resolution of the original raster Br.

Therefore, I needed a raster version of SpPolygons object
eugrd025EFDC_SPDF.  raster() does not
accept SpPolygons (which makes sense) , but SpPixels or SpGrids.
Unfortunately, while you can convert from SpPixels to SpPolygons, the
reverse, i.e.,
eugrd025EFDC_SPX <- as(eugrd025EFDC_SPDF, "SpatialPixels")
does not work

Indefatigable, I decided to use the original grid eugrd025, reproject
it via spTransform(), convert to raster using raster() and then
resample(), but spTransform() had a low blow ready for me:
spTransform() does not work with Spgrids, its help page
rgdal/html/spTransform-methods.html does not mention it and it
silently converts the output to Sppoints, which ultimately results
on a wrong resample() result.

Finally, the following mixture of Mike and Robert advices worked (fast)

> eugrd025r <- raster(eugrd025)
> Br025rEFDC <- projectRaster(Br,eugrd025r)

Thanks!

Agus

[1] http://r-sig-geo.2731867.n2.nabble.com/polygonValues-raster-Very-slow-tp5239776p5239776.html
2010/7/1 Robert J. Hijmans <r.hijmans at gmail.com>:
> The general idea is that for changing the projection of a raster you
> provide the input RasterLayer and a Raster object with the spatial
> parameters (projection, extent, resolution) to which it should be
> transformed. For the latter, you can use the RasterLayer that you want
> to project the input data to (I call it 'x').
>
> prjgrd <- projectRaster(eugrd025, x, method='bilinear')
>
> Note that it should *not* be necessary to resample after projection
> because projecting a raster already implies resampling.
>
> Robert
>
> On Thu, Jul 1, 2010 at 8:48 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> Ah, sorry that was completely wrong. I think this is right, but still untested:
>>
>> raster.eugrd025 <- raster(eugrd025)
>>
>> pr <- projectExtent(raster.eugrd025, projection(eugrd025EFDC_SPDF))
>>
>> eugrd025EFDC <- projectRaster(raster.eugrd025, pr)
>>
>>
>>
>> On Fri, Jul 2, 2010 at 1:46 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>>> spTransform cannot reproject a grid - this will (usually) requires
>>> destructive resampling of the data to a completely new grid. There are
>>> functions in the raster package to do this: projectRaster.
>>>
>>> I think this would work, but there may be important details that you
>>> will need to investigate:
>>>
>>> raster.eugrd025 <- raster(eugrd025)
>>>
>>> eugrd025EFDC <- projectRaster(raster.eugrd025,
>>> CRSobj=CRS(projection(eugrd025EFDC_SPDF)))
>>>
>>> On Fri, Jul 2, 2010 at 1:40 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>>> Hi!
>>>>
>>>> I use spTransform to reproject:
>>>>
>>>>> class(eugrd025)
>>>> [1] "SpatialGrid"
>>>> attr(,"package")
>>>> [1] "sp"
>>>>
>>>>> projection(eugrd025)
>>>> [1] "+proj=longlat +ellps=WGS84"
>>>>
>>>>> eugrd025EFDC <- spTransform(eugrd025, CRSobj=CRS(projection(eugrd025EFDC_SPDF)))
>>>>
>>>>> projection(eugrd025EFDC)
>>>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>>>> +ellps=GRS80 +units=m +no_defs"
>>>>
>>>> This is good, but:
>>>>> class(eugrd025EFDC)
>>>> [1] "SpatialPoints"
>>>> attr(,"package")
>>>> [1] "sp"
>>>>
>>>> Why is the class changed to SpatialPoints? I need a grid object for
>>>>> eugrd025EFDCr <- raster(eugrd025EFDC)
>>>>> Br025 <- resample(Br,eugrd025EFDCr)
>>>>
>>>> don't I?
>>>>
>>>> I also have the problem that the CRS of eugrd025EFDCr is not conserved:
>>>>> projection(Br)
>>>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>>>> +ellps=GRS80 +units=m +no_defs"
>>>>
>>>>> projection(eugrd025EFDC)
>>>> [1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
>>>> +ellps=GRS80 +units=m +no_defs"
>>>>
>>>>> projection(eugrd025EFDCr)
>>>> [1] "NA"
>>>>
>>>> which I fix with
>>>>> projection(eugrd025EFDCr) <- CRS(projection(eugrd025EFDC))
>>>>
>>>> and repeat
>>>>> Br025 <- resample(Br,eugrd025EFDCr)
>>>>
>>>> Anyway, I get a much coarser raster than I want:
>>>>> dim(Br025)
>>>> [1] 10 10 ?1
>>>>
>>>> because
>>>>> dim(eugrd025EFDCr)
>>>> [1] 10 10 ?1
>>>>
>>>> While it should be 180x100:
>>>>
>>>>> summary(eugrd025EFDC)
>>>> Object of class SpatialPoints
>>>> Coordinates:
>>>> ? ? ? min ? ? max
>>>> s1 2498538 6561151
>>>> s2 1327858 4313263
>>>> Is projected: TRUE
>>>> proj4string :
>>>> [+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80
>>>> +units=m +no_defs]
>>>> Number of points: 18000
>>>>> dim(Br025)
>>>> [1] 10 10 ?1
>>>>
>>>>> summary(eugrd025)
>>>> Object of class SpatialGrid
>>>> Coordinates:
>>>> ? ? ? ? ? ? ?min ? ?max
>>>> coords.x1 -10.125 34.875
>>>> coords.x2 ?34.875 59.875
>>>> Is projected: FALSE
>>>> proj4string : [+proj=longlat +ellps=WGS84]
>>>> Number of points: 2
>>>> Grid attributes:
>>>> ?cellcentre.offset cellsize cells.dim
>>>> 1 ? ? ? ? ? ? ? -10 ? ? 0.25 ? ? ? 180
>>>> 2 ? ? ? ? ? ? ? ?35 ? ? 0.25 ? ? ? 100
>>>>
>>>> Is eugrd025EFDCr wrong because class(eugrd025EFDC) has been changed
>>>> from SpatialGrid to SpatialPoints?
>>>>
>>>> Agus
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From Roger.Bivand at nhh.no  Fri Jul  2 10:21:48 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 2 Jul 2010 10:21:48 +0200
Subject: [R-sig-Geo] spTransform changes the class
References: <AANLkTikTQYFbwXfAVtl7NT6O0ae00lMH9PttGT9ffYq4@mail.gmail.com><AANLkTilXPYugNjqbqqQYpKRFiGbIqz-8__TfQFRFjxL0@mail.gmail.com><AANLkTimhW27mqRDJGuiql-pBinAloEcQliWM_bHf58Ke@mail.gmail.com><AANLkTimGVZrjjp9-D4uJIng3KgGaWwcTAFe-AxtfdpHA@mail.gmail.com>
	<AANLkTintZbuFV9hSKsnV86NAh2oSt26bNypeVYxDdtGg@mail.gmail.com>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C405131B@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100702/0fef9676/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jul  2 12:01:58 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 2 Jul 2010 12:01:58 +0200
Subject: [R-sig-Geo] mapproject
References: <AANLkTinKL_lozMQ2mxaxOnpq2Marh_pSOaNJnMh0riYc@mail.gmail.com><AANLkTinGKwqyHWbi3fmJ-iROnY_RbmDpEREmQBLP3Jll@mail.gmail.com>
	<AANLkTilu9GssvrCz4WB3Zv9H1reD-FZGW40U-gK5wP5_@mail.gmail.com>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C405131D@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100702/5b35c091/attachment.pl>

From ejjunju at gmail.com  Fri Jul  2 13:47:08 2010
From: ejjunju at gmail.com (Emmanuel Jjunju)
Date: Fri, 2 Jul 2010 13:47:08 +0200
Subject: [R-sig-Geo] Help with re-sampling a matrix: akin to cutting a
	cloth/paper into small pieces without interpolating
Message-ID: <AANLkTikOgF_adK9_7GUqFtCucgpktjhLRrHATiqvMLvB@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100702/d5dc86e7/attachment.pl>

From educheyne at avia-gis.be  Fri Jul  2 14:21:00 2010
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Fri, 2 Jul 2010 14:21:00 +0200
Subject: [R-sig-Geo] !SPAM: Re: Help with re-sampling a matrix: akin to
	cutting a cloth/paper into small pieces without interpolating
In-Reply-To: <AANLkTikOgF_adK9_7GUqFtCucgpktjhLRrHATiqvMLvB@mail.gmail.com>
References: <AANLkTikOgF_adK9_7GUqFtCucgpktjhLRrHATiqvMLvB@mail.gmail.com>
Message-ID: <6F8E265E-1F10-47E3-BABA-56BD44493570@avia-gis.be>

Dear Emmanuel
if you use the package maptools you should be able to create an image with the resolution that you want
something like  data.im.resampled<-as.im(matrix,dimyx=(floor(data.im$dim)*5))
for an image with a resolutin in x and y 5 times more fine
HTH
Els

On 2 Jul 2010, at 13:47, Emmanuel Jjunju wrote:

> #I have data in a matrix with longitude (x coordinates) regularly spaced at
> 2.8 degrees and lat (y coordinates) at 2.5 degrees.I want to Resample my
> matrix z to a different resolution of say 1x1 in R without using
> interpolation (e.g inter in Akima package) because this distorts the data
> i.e. The data should not vary smoothly in space. What I want is analogous to
> resample in a GIS withoout smoothing, something like assigning the new pixel
> with the average or maximum of the contents in the pixel location. Ideally
> think of it like cutting a piece of cloth into tiny bits that retain the
> information!
> 
> x<-seq(29,36,2.8)#lon
> y<-seq(-4,6,2.5)#lat
> z<-matrix(runif(length(x)*length(y)),length(x),length(y))# my original
> matrix
> par(mfrow=c(2,2))
> image(x,y,z,col=cm.colors(20))# plots the data as is
> 
> #Using Interpolation with Akima Interp
> library(akima)
> xd<-seq(29,36,1)# new lon
> yd<-seq(-4,6,1) # new lat
> old.kords<-expand.grid(x,y)
> zd<-interp(old.kords[,1],old.kords[,2],c(z),xd,yd)
> image(xd,yd,zd$z,col=cm.colors(20))# shows that interpolation has distorted
> the spatial pattern. What i want is similar pattern but with finer grid.
> Interp clearly cannot do this.
> 
> # so how do i resample without changing the pattern.
> 
> -- 
> <a href="http://inside-r.org/download" title="Download R"><img src="
> http://inside-r.org/sites/all/themes/rweb/assets/badges/download-r-badge-125-blue.png"
> border="0" /></a>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From ejjunju at gmail.com  Sat Jul  3 15:39:23 2010
From: ejjunju at gmail.com (Emmanuel Jjunju)
Date: Sat, 3 Jul 2010 15:39:23 +0200
Subject: [R-sig-Geo] Help with re-sampling a matrix: akin to cutting a
	cloth/paper into small pieces without interpolating
In-Reply-To: <AANLkTil5D06gfRZZt90TcLlEtWq_mkZWXBQJQ8ZDLlWe@mail.gmail.com>
References: <AANLkTikOgF_adK9_7GUqFtCucgpktjhLRrHATiqvMLvB@mail.gmail.com>
	<6F8E265E-1F10-47E3-BABA-56BD44493570@avia-gis.be>
	<AANLkTikNBQfb_bKIDnuNWuMdv4FWZBKJSX_xIBiMuIce@mail.gmail.com>
	<AANLkTil5D06gfRZZt90TcLlEtWq_mkZWXBQJQ8ZDLlWe@mail.gmail.com>
Message-ID: <AANLkTilHUyhf_Ex0l6JLUtJ7ATfTEkPoQ6wAwjCNGJ0T@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100703/a9a9d297/attachment.pl>

From roscao at gmail.com  Sat Jul  3 19:04:05 2010
From: roscao at gmail.com (Rosca Bogdan)
Date: Sat, 3 Jul 2010 20:04:05 +0300
Subject: [R-sig-Geo] Download MODIS images
Message-ID: <AANLkTinVPgiPqo453wiehtt__bOObI1UjB_U00jhRA8v@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100703/643d91c9/attachment.pl>

From shaofei.chen at utdallas.edu  Mon Jul  5 04:25:37 2010
From: shaofei.chen at utdallas.edu (Chen, Shaofei)
Date: Sun, 4 Jul 2010 21:25:37 -0500
Subject: [R-sig-Geo] Image a matrix
Message-ID: <733B27FBA86548149C196FE13DFFF528@shaofei>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100704/0b0cb5a1/attachment.pl>

From mdsumner at gmail.com  Mon Jul  5 04:41:31 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 5 Jul 2010 12:41:31 +1000
Subject: [R-sig-Geo] Image a matrix
In-Reply-To: <733B27FBA86548149C196FE13DFFF528@shaofei>
References: <733B27FBA86548149C196FE13DFFF528@shaofei>
Message-ID: <AANLkTik296eMb4ESnxdy3NWPgLmAevZrl9SiP4P44bmK@mail.gmail.com>

What about setting the aspect ratio?

image(volcano, asp = 1)

Note that plotting functions (including image.SpatialGridDataFrame)
will set the aspect ratio to 1, or if unprojected to a ratio based on
the latitude of  the data. See ?Spatial.

Cheers, Mike.

On Mon, Jul 5, 2010 at 12:25 PM, Chen, Shaofei
<shaofei.chen at utdallas.edu> wrote:
> Dear All,
>
> Using "image" function, we can map a matrix. If the matrix is square, the map will look fine. However, if the matrix is not square, the map will be distort. For example, the dimension of volcano in the help file is 87 by 61. So the unit length of x axis is different from it of ?y axis. I bet this is not good for geovisualization
> Is there anyway to image a non-square matrix without distortion? I think combining the data matrix with a matrix with "NA" to form a square is an option. But it looks not very clever.
> Thank you very much!
>
> Best,
> Shaofei
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From roman.lustrik at gmail.com  Mon Jul  5 10:58:59 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 5 Jul 2010 10:58:59 +0200
Subject: [R-sig-Geo] xyValues, S4 methods and the dreaded NA
Message-ID: <AANLkTimyVaTe7xCphgOP3s7XHCd1QTVkJMaxdzYvYsKG@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100705/af9fa3b4/attachment.pl>

From hengl at spatial-analyst.net  Mon Jul  5 11:40:44 2010
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 5 Jul 2010 11:40:44 +0200
Subject: [R-sig-Geo] Download MODIS images
In-Reply-To: <AANLkTinVPgiPqo453wiehtt__bOObI1UjB_U00jhRA8v@mail.gmail.com>
References: <AANLkTinVPgiPqo453wiehtt__bOObI1UjB_U00jhRA8v@mail.gmail.com>
Message-ID: <00b701cb1c26$240a7070$6c1f5150$@net>

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] On Behalf Of Rosca Bogdan
> Sent: Saturday, July 03, 2010 7:04 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Download MODIS images
> 
> Hi!
> I am trying to work with T. Hengl's script downloaded from:
> http://spatial-analyst.net/book/Rscripts in order to get modis images for my
> country. I have only modify the script in order to sample data according to
> my country border (Romania, which is not so far away from Croatia) and
> everything run smooth until these lines:
> 
> # download the blocks in a loop (year 2006):
> for (i in 268:313){
> getlist <- strsplit(getURL(paste(MOD11A2, dates$dirname[[i]], "/", sep=""),
> .opts=curlOptions(ftplistonly=
> TRUE)), "\r\n")[[1]]
> BLOCK1 <- getlist[grep(getlist,
> pattern="MOD11A2.********.h18v04.*************.hdf")[1]]
> BLOCK2 <- getlist[grep(getlist,
> pattern="MOD11A2.********.h19v04.*************.hdf")[1]]
> 
> # write up the file names back to the dates.txt:
> for(j in 2:3){
>   dates[i,j] <- get(paste("BLOCK", j-1, sep=""))
> }
> 
> # Download all blocks from the list to a local drive:
> # while(!is.na(dates[i,2])&!is.na(dates[i,3])&!is.na(dates[i,4])&!is.na
> (dates[i,5])&!is.na(dates[i,6])&!is.na(dates[i,7])&!is.na(dates[i,8])&!is.na
> (dates[i,9])&!is.na(dates[i,10])){
> download.file(paste(MOD11A2a, dates$dirname[[i]], "/", BLOCK1,sep=""),
> destfile=paste(getwd(), "/", BLOCK1, sep=""), mode='wb', method='wget',
> quiet=T, cacheOK=FALSE)
> download.file(paste(MOD11A2, dates$dirname[[i]], "/", BLOCK2,sep=""),
> destfile=paste(getwd(), "/", BLOCK2,sep=""), mode='wb', method='wget',
> quiet=T, cacheOK=FALSE)
> 
> # remove "." from the file name:
> dirname1 <- sub(sub(pattern="\\.", replacement="_", dates$dirname[[i]]),
> pattern="\\.", replacement="_", dates$dirname[[i]])
> # mosaic the blocks:
> mosaicname <- file(paste(MRT, "TmpMosaic.prm", sep=""), open="wt")
> write(paste(workd, BLOCK1, sep=""), mosaicname)
> write(paste(workd, BLOCK2, sep=""), mosaicname, append=T)
> close(mosaicname)
> # generate temporary mosaic:
> shell(cmd=paste(MRT, 'mrtmosaic -i ', MRT, 'TmpMosaic.prm -s "0 0 0 0 1 0 0
> 0 0 0 0 0" -o ', workd, 'TmpMosaic.hdf', sep=""))
> close(mosaicname)
> 
> # resample to UTM 33N:
> filename <- file(paste(MRT, "mrt", dirname1, ".prm", sep=""), open="wt")
> write(paste('INPUT_FILENAME = ', workd, 'TmpMosaic.hdf', sep=""), filename)
> write('  ', filename, append=TRUE)
> # write('SPECTRAL_SUBSET = ( 0 1 0 0 0 0 0 0 0 0 0 )', filename,
> append=TRUE)
> write('SPECTRAL_SUBSET = ( 1 )', filename, append=TRUE)
> write('  ', filename, append=TRUE)
> write('SPATIAL_SUBSET_TYPE = OUTPUT_PROJ_COORDS', filename, append=TRUE)
> write('  ', filename, append=TRUE)
> write(paste('SPATIAL_SUBSET_UL_CORNER = (', XUL, YUL, ')'), filename,
> append=TRUE)
> write(paste('SPATIAL_SUBSET_LR_CORNER = (', XLR, YLR, ')'), filename,
> append=TRUE)
> write('  ', filename, append=TRUE)
> write(paste('OUTPUT_FILENAME = ', workd, 'LST', dirname1, '.tif', sep=""),
> filename, append=TRUE)
> write('  ', filename, append=TRUE)
> write('RESAMPLING_TYPE = NEAREST_NEIGHBOR', filename, append=TRUE)
> write('  ', filename, append=TRUE)
> write('OUTPUT_PROJECTION_TYPE = UTM', filename, append=TRUE)
> write('  ', filename, append=TRUE)
> write('OUTPUT_PROJECTION_PARAMETERS = ( ', filename, append=TRUE)
> write(paste(lon.c, lat.c, '0.0'), filename, append=TRUE)
> write(' 0 0.0 0.0', filename, append=TRUE)
> write(' 0.0 0.0 0.0', filename, append=TRUE)
> write(' 0.0 0.0 0.0', filename, append=TRUE)
> write(' 0.0 0.0 0.0 )', filename, append=TRUE)
> write('  ', filename, append=TRUE)
> write('UTM_ZONE = 35', filename, append=TRUE)
> write('DATUM = WGS84', filename, append=TRUE)
> write('  ', filename, append=TRUE)
> write('OUTPUT_PIXEL_SIZE = 1000', filename, append=TRUE)
> write('  ', filename, append=TRUE)
> close(filename)
> 
> # Mosaic the images to get the whole area:
> shell(cmd=paste(MRT, 'resample -p ', MRT, 'mrt', dirname1, '.prm', sep=""))
> # delete all hdf files!
> # unlink(paste(getwd(), '/', BLOCK1, sep=""))
> # unlink(paste(getwd(), '/', BLOCK2, sep=""))
> }
> 
> I keep getting an error like this:
> Error in grep(getlist, pattern =
> "MOD11A2.********.h18v04.*************.hdf") :
>  invalid regular expression 'MOD11A2.********.h18v04.*************.hdf'
> In addition: Warning message:
> In grep(getlist, pattern = "MOD11A2.********.h18v04.*************.hdf") :
>  regcomp error:  'Invalid use of repetition operators'

Modify to:

> BLOCK1 <- getlist[grep(getlist, pattern="MOD11A2.*.h18v04.*.hdf")[1]]

One more thing. Connection with the NASA's FTP often breaks (security setting of their server?) so that the derived object might finish being empty or incomplete.

T. Hengl


> Please help.
> Thank's,
> Rosca Bogdan
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From thi_veloso at yahoo.com.br  Mon Jul  5 16:13:06 2010
From: thi_veloso at yahoo.com.br (Thiago Veloso)
Date: Mon, 5 Jul 2010 07:13:06 -0700 (PDT)
Subject: [R-sig-Geo] Spatial data interpolation on R
In-Reply-To: <AANLkTikb7y1VNWgD8TTLTvKkgEp_s2ySFjILMfvKiHZi@mail.gmail.com>
Message-ID: <994490.49713.qm@web54304.mail.re2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100705/1308381d/attachment.pl>

From r.hijmans at gmail.com  Mon Jul  5 21:07:39 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 5 Jul 2010 12:07:39 -0700
Subject: [R-sig-Geo] xyValues, S4 methods and the dreaded NA
In-Reply-To: <AANLkTimyVaTe7xCphgOP3s7XHCd1QTVkJMaxdzYvYsKG@mail.gmail.com>
References: <AANLkTimyVaTe7xCphgOP3s7XHCd1QTVkJMaxdzYvYsKG@mail.gmail.com>
Message-ID: <AANLkTilH7CEx4DW7bmpOdQjGwz_NzuKHP0c6r83FtT75@mail.gmail.com>

Roman,

xyValues (raster package) with a buffer argument, returned NA if the
both of the extreme NS or extreme EW points of the buffer where
outside the raster. This was correct for points outside the raster
with a small buffer, but not for points inside the raster with a very
large buffer (larger than the raster itself). I have fixed this, I
think, in version: 1.2-10 (5-July-2010). Should be available from
R-Forge in 24 hours.

You could have debugged this function by making .xyvBuf visible. E.g. like this:
.xyvBuf <- raster:::.xyvBuf
# and you also need to do this one, because it is inside  .xyvBuf
.couldBeLonLat <- raster:::.couldBeLonLat

Robert

On Mon, Jul 5, 2010 at 1:58 AM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:
> Dear List,
>
> I have a list of xy coordinates
>
>> origin.point
> [[1]]
> ? ? ? ? ? x ? ? ? ? y
> 196 35.65648 ?4.268407
> 267 26.97161 -0.921370
>
> [[2]]
> ? ? ? ? ? ?x ? ? ? ? y
> 2396 25.82682 -34.30095
> 2485 24.36276 -31.83600
> ...
>
> and I'm tryig to extract raster cell values within the radius like so:
>
> cell.num <- unlist(xyValues(object = rst, xy = origin.point, buffer = 50))
>
> For most coordinates, I get a list of vectors as expected, however, some
> fail and produce only (one) NA. The raster serving as object is always the
> same. For instance, in the list mentioned above, only coordinate 2 (
> xy[[1]][2,]) in list 1 is causing such problems. I have tried rounding the
> coordinates to no avail. Unfortunately I'm unable to reproduce the same
> behavior outside my function. If I do it manually like so
>
> cell.num1 <- unlist(xyValues(object = rst, xy = matrix(c(35.656483,
> 4.268407), nrow = 1, ncol = 2), buffer = 50)) #first coordinate
>
> cell.num2 <- unlist(xyValues(object = rst, xy = matrix(c(26.97161,
> -0.92137), nrow = 1, ncol = 2), buffer = 50)) #second coordinate
>
> things go through without a problem.
>
> This leads me to believe there is something in or around my custom function.
> What is confusing me is the unpredictable behavior which makes it harder for
> me to pinpoint the source where everything breaks. I tried following the
> xyValues() but debugging S4 methods is not something I'm versed at (yet?!).
> I have tried extracting xyValues() with
>
> selectMethod(xyValues, c('RasterLayer', 'matrix'))
>
> but the function calls even more internal functions and here is where I get
> stuck.
>
> I guess my questions are: what could be causing xyValues() to produce NA for
> particular coordinates (but working fine with others) and - how to debug
> xyValues() and it's internals like .xyvBuf, .readCells...? I would really
> like to get to the bottom of this and move on.
>
> Cheers,
> Roman
>
>
>
> --
> In God we trust, all others bring data.
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From glorenz2000 at yahoo.com  Mon Jul  5 23:02:25 2010
From: glorenz2000 at yahoo.com (Guido Lorenz)
Date: Mon, 5 Jul 2010 14:02:25 -0700 (PDT)
Subject: [R-sig-Geo] semivariogram calculation - discrepancy between gls and
	gstat
Message-ID: <920989.29900.qm@web30805.mail.mud.yahoo.com>

Dear R-sig-Geo members,

a semivariogram for spatial soil data, calculated by the gls (nlme library) function gives the following estimates:

> lmm.dap2b <- gls(Dap.sa ~ 1 + ID.sitio, Pd2006mm, correlation=corGaus(form=~(easting.m+northing.m)|ID.sitio, nugget=TRUE, metric="euclidean"), na.action=na.omit, method="REML")
> Variogram(lmm.dap2b)
      variog      dist n.pairs
1  0.3059585  2.828427     122
2  0.4040062  4.269282     125
3  0.5744688 18.110770     123
4  0.5266091 20.000000     125
....

whereas the variogram function of the gstat library gives, for similar distances (although different number of sample pairs), very different gamma values: 

 > variogram(Dap.sa ~ 1, locations = ~ easting.m + northing.m, data=Pd2006mm, cutoff=80)
    np      dist       gamma dir.hor dir.ver   id
1  219  3.225693 0.005578128       0       0 var1
2   20  6.478671 0.004254656       0       0 var1
3    3 13.513045 0.009896324       0       0 var1
4  307 19.201322 0.009708390       0       0 var1
.....  

Can anyone explain what is happening?

Thanks for any advice,
Guido Lorenz

Can anyone explain


From mnoe at lcg.unam.mx  Mon Jul  5 23:41:11 2010
From: mnoe at lcg.unam.mx (FloydGlz)
Date: Mon, 5 Jul 2010 14:41:11 -0700 (PDT)
Subject: [R-sig-Geo] Maptools, polylines to polygon and the .dwg format
Message-ID: <1278366071258-5257809.post@n2.nabble.com>


Let's see if i can explain myself properly...

Im doing some work on categorizing diseases per area, so i have a map (a
.dwg file) that has all the states and municipalities, and my end work has
to be the same map but with different colors depending on the number of
cases for each disease.

Now, for example, in this page, http://www.gadm.org/country, you can
download a map (i use Mexico for the example, and i download it as a shape
file), then, i load it to R with maptools and the readShapePoly function;
using this i can subset specific regions and colour it according to my
needs, pretty easy and useful. Another great thing, is that in the .dbf file
(im not 100% is that file but im guessing it is) contains all the ID's,
which i can access with the names() function of R, and i can search for a
specific name or state, BECAUSE IT EXISTS SUCH ID.

Now my problem is that i dont know how to manipulate this ID's, because in
the example they are already there, but with the data i have (the .dwg
file), is pretty much inexistent, how do i create/edit an attribute, so i
can add it to the .shp/.dbf file? if i want to create a category named
Municipalities, so each polygon (region of the map) has a unique name, how
do i do that?

For example, in the shp file of mexico listed in the example, one can create
a map with the following code

library(maptools)
mexmap <- readShapePoly("MEX_adm2.shp")
names(mexmap)
df <- which(mexmap[[5]] == "Distrito Federal")
plot(mexmap[df,])
library(gplots)
showpanel <- function(col){image(z=matrix(1:100, ncol=1), col=col, xaxt="n",
yaxt="n")}
showpanel(colorpanel(6,low="skyblue",high="darkblue")) #so i can see the
colors
colore <- colorpanel(6,low="skyblue",high="darkblue")
colore <- rep(colore,length.out=16)
plot(mexmap[df,],col=colore)

In the end is easier because i have the names i want, and i can manipulate
the regions needed. I want to do the same with my file.

I appreciate any suggestions, thank very much for your time.

------------------------------------
Melvin Jesus Noe Gonzalez
Undergraduate Genomics Student 
UNAM MEX
mnoe at lcg.unam.mx

-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Maptools-polylines-to-polygon-and-the-dwg-format-tp5257809p5257809.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Tue Jul  6 09:25:50 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 06 Jul 2010 09:25:50 +0200
Subject: [R-sig-Geo] semivariogram calculation - discrepancy between gls
 and	gstat
In-Reply-To: <920989.29900.qm@web30805.mail.mud.yahoo.com>
References: <920989.29900.qm@web30805.mail.mud.yahoo.com>
Message-ID: <4C32DA7E.1040800@uni-muenster.de>

Guido, I suspect that nlme works with models for spatial correlation and
not for spatial covariance, meaning that the variance (variog) gets
standardized - see ?corClasses in nlme. Do the variog values approach 1
for longer distances?

On 07/05/2010 11:02 PM, Guido Lorenz wrote:
> Dear R-sig-Geo members,
> 
> a semivariogram for spatial soil data, calculated by the gls (nlme library) function gives the following estimates:
> 
>> lmm.dap2b <- gls(Dap.sa ~ 1 + ID.sitio, Pd2006mm, correlation=corGaus(form=~(easting.m+northing.m)|ID.sitio, nugget=TRUE, metric="euclidean"), na.action=na.omit, method="REML")
>> Variogram(lmm.dap2b)
>       variog      dist n.pairs
> 1  0.3059585  2.828427     122
> 2  0.4040062  4.269282     125
> 3  0.5744688 18.110770     123
> 4  0.5266091 20.000000     125
> ....
> 
> whereas the variogram function of the gstat library gives, for similar distances (although different number of sample pairs), very different gamma values: 
> 
>  > variogram(Dap.sa ~ 1, locations = ~ easting.m + northing.m, data=Pd2006mm, cutoff=80)
>     np      dist       gamma dir.hor dir.ver   id
> 1  219  3.225693 0.005578128       0       0 var1
> 2   20  6.478671 0.004254656       0       0 var1
> 3    3 13.513045 0.009896324       0       0 var1
> 4  307 19.201322 0.009708390       0       0 var1
> .....  
> 
> Can anyone explain what is happening?
> 
> Thanks for any advice,
> Guido Lorenz
> 
> Can anyone explain
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From haenlein at escpeurope.eu  Tue Jul  6 12:17:53 2010
From: haenlein at escpeurope.eu (Michael Haenlein)
Date: Tue, 6 Jul 2010 12:17:53 +0200
Subject: [R-sig-Geo] Moran's I with binary weights
Message-ID: <AANLkTinIdWSI6tNf-W587I_ATqsuhdjjeaMsvDPA571g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100706/e7dfa2a6/attachment.pl>

From nikhil.list at gmail.com  Tue Jul  6 13:21:33 2010
From: nikhil.list at gmail.com (Nikhil Kaza)
Date: Tue, 6 Jul 2010 07:21:33 -0400
Subject: [R-sig-Geo] Maptools, polylines to polygon and the .dwg format
In-Reply-To: <1278366071258-5257809.post@n2.nabble.com>
References: <1278366071258-5257809.post@n2.nabble.com>
Message-ID: <74044718-DEA8-4995-9B1A-8F5753C02DB4@gmail.com>




I am not sure I understand. I havent worked with Dwg in a long time,  
but my sense is they are just geometric boundary files. There is no  
`data' attached to them.

Two options.
1. convert dwg to shapefile and do a spatial join. IF the dwg file is  
points, this what you should do.
2. if the dwg files are essentially boundaries of polygons in the  
shapefile, create a new table with ID of the polygon and count of  
diseases and then do a join with merge.



Nikhil Kaza
Asst. Professor,
City and Regional Planning
University of North Carolina

nikhil.list at gmail.com

On Jul 5, 2010, at 5:41 PM, FloydGlz wrote:

>
> Let's see if i can explain myself properly...
>
> Im doing some work on categorizing diseases per area, so i have a  
> map (a
> .dwg file) that has all the states and municipalities, and my end  
> work has
> to be the same map but with different colors depending on the number  
> of
> cases for each disease.
>
> Now, for example, in this page, http://www.gadm.org/country, you can
> download a map (i use Mexico for the example, and i download it as a  
> shape
> file), then, i load it to R with maptools and the readShapePoly  
> function;
> using this i can subset specific regions and colour it according to my
> needs, pretty easy and useful. Another great thing, is that in  
> the .dbf file
> (im not 100% is that file but im guessing it is) contains all the  
> ID's,
> which i can access with the names() function of R, and i can search  
> for a
> specific name or state, BECAUSE IT EXISTS SUCH ID.
>
> Now my problem is that i dont know how to manipulate this ID's,  
> because in
> the example they are already there, but with the data i have (the .dwg
> file), is pretty much inexistent, how do i create/edit an attribute,  
> so i
> can add it to the .shp/.dbf file? if i want to create a category named
> Municipalities, so each polygon (region of the map) has a unique  
> name, how
> do i do that?
>
> For example, in the shp file of mexico listed in the example, one  
> can create
> a map with the following code
>
> library(maptools)
> mexmap <- readShapePoly("MEX_adm2.shp")
> names(mexmap)
> df <- which(mexmap[[5]] == "Distrito Federal")
> plot(mexmap[df,])
> library(gplots)
> showpanel <- function(col){image(z=matrix(1:100, ncol=1), col=col,  
> xaxt="n",
> yaxt="n")}
> showpanel(colorpanel(6,low="skyblue",high="darkblue")) #so i can see  
> the
> colors
> colore <- colorpanel(6,low="skyblue",high="darkblue")
> colore <- rep(colore,length.out=16)
> plot(mexmap[df,],col=colore)
>
> In the end is easier because i have the names i want, and i can  
> manipulate
> the regions needed. I want to do the same with my file.
>
> I appreciate any suggestions, thank very much for your time.
>
> ------------------------------------
> Melvin Jesus Noe Gonzalez
> Undergraduate Genomics Student
> UNAM MEX
> mnoe at lcg.unam.mx
>
> -- 
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Maptools-polylines-to-polygon-and-the-dwg-format-tp5257809p5257809.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From pinaud at cebc.cnrs.fr  Tue Jul  6 16:52:06 2010
From: pinaud at cebc.cnrs.fr (Pinaud David)
Date: Tue, 06 Jul 2010 16:52:06 +0200
Subject: [R-sig-Geo] r.mapcalc with spgrass6
Message-ID: <4C334316.6050501@cebc.cnrs.fr>

Dear all,

I'm trying to use the GRASS function "r.mapcalc" using R package 
"spgrass6", but I've got some trouble with it, I'm not even able to 
parse this function:

 > library(rgdal)
Le chargement a n?cessit? le package : sp
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
Path to GDAL shared files: C:/PROGRA~1/R/R-211~1.1/library/rgdal/gdal
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
Path to PROJ.4 shared files: C:/PROGRA~1/R/R-211~1.1/library/rgdal/proj

 > library(spgrass6)
Le chargement a n?cessit? le package : XML
GRASS GIS interface loaded with GRASS version: (GRASS not running)

 > parseGRASS("r.mapcalc")
Error : syntax error, unexpected '-', expecting NAME or STRING
Parse error  does not seem to be XML, nor to identify a file name
Erreur dans parseGRASS("r.mapcalc") : r.mapcalc not parsed

I tried to change the XML encoding by
 > setXMLencoding("latin1")
without success.

For example,
 > parseGRASS("g.region")
is correctly running, I've got the description of the function.

Otherwise, my calculus with "r.mapcalc" within GRASS 6.4.0 is correctly 
running.

 > sessionInfo()
R version 2.11.1 (2010-05-31)
i386-pc-mingw32

locale:
[1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252    
LC_MONETARY=French_France.1252
[4] LC_NUMERIC=C                   LC_TIME=French_France.1252   

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

other attached packages:
[1] spgrass6_0.6-16 XML_3.1-0       rgdal_0.6-27    sp_0.9-65     

loaded via a namespace (and not attached):
[1] grid_2.11.1    lattice_0.18-8 tools_2.11.1 

 > get("SYS", envir = .GRASS_CACHE)
[1] "WinNat"


Am I missing something? Any idea?

Thank you very much for your help and patience.

David


-- 
***************************************************
David PINAUD
Ing?nieur de Recherche "Analyses spatiales"

Centre d'Etudes Biologiques de Chiz? - CNRS UPR1934
79360 Villiers-en-Bois, France 
poste 485
Tel: +33 (0)5.49.09.35.58
Fax: +33 (0)5.49.09.65.26
http://www.cebc.cnrs.fr/

***************************************************




__________ Information from ESET Mail Security, version of virus signature database 5255 (20100706) __________

The message was checked by ESET Mail Security.
http://www.eset.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: pinaud.vcf
Type: text/x-vcard
Size: 324 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100706/cf437547/attachment.vcf>

From jsebastiantello at yahoo.com  Tue Jul  6 20:05:13 2010
From: jsebastiantello at yahoo.com (J. Sebastian Tello)
Date: Tue, 6 Jul 2010 11:05:13 -0700 (PDT)
Subject: [R-sig-Geo] Pseudo R^2 in spatial regressions (SAR error or GLS)
Message-ID: <27794.52011.qm@web110315.mail.gq1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100706/3f4834ce/attachment.pl>

From jsebastiantello at yahoo.com  Tue Jul  6 20:29:51 2010
From: jsebastiantello at yahoo.com (J. Sebastian Tello)
Date: Tue, 6 Jul 2010 11:29:51 -0700 (PDT)
Subject: [R-sig-Geo] Pseudo R^2 in spatial regressions
Message-ID: <16710.37215.qm@web110308.mail.gq1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100706/5a335c3a/attachment.pl>

From mark_connolly at acm.org  Tue Jul  6 22:43:11 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Tue, 06 Jul 2010 16:43:11 -0400
Subject: [R-sig-Geo] package:automap
Message-ID: <4C33955F.5040401@acm.org>

This is often a really handy little package.  Thanks!


From glorenz2000 at yahoo.com  Tue Jul  6 23:35:39 2010
From: glorenz2000 at yahoo.com (Guido Lorenz)
Date: Tue, 6 Jul 2010 14:35:39 -0700 (PDT)
Subject: [R-sig-Geo] semivariogram calculation - discrepancy between gls
	and gstat
In-Reply-To: <4C32DA7E.1040800@uni-muenster.de>
References: <920989.29900.qm@web30805.mail.mud.yahoo.com>
	<4C32DA7E.1040800@uni-muenster.de>
Message-ID: <467660.65846.qm@web30803.mail.mud.yahoo.com>

Dear Edzer Pebesma,

thank your for your advice - you were right that the semivariance values are standardized by default in the output of the nlme-Variogram function. So, with the adequate "resType"-option in that function, I could reproduce nearly the same estimations as in the gstat module:

> Variogram(lmm.dap2b, resType="response")
        variog      dist n.pairs
1  0.005385495  2.828427     122
2  0.007111336  4.269282     125
3  0.010111828 18.110770     123
4  0.009269399 20.000000     125
5  0.006815940 21.603952     126
....
The detailed information about the Variogram function, with all the possible options, is found in the manual of the nlme package and not in the interactive help, so at the moment of my first mail, I had not read these details about the different modifiers. 

Many thanks for your help,
Guido Lorenz 


----- Original Message ----
From: Edzer Pebesma <edzer.pebesma at uni-muenster.de>
To: r-sig-geo at stat.math.ethz.ch
Sent: Tue, July 6, 2010 3:25:50 AM
Subject: Re: [R-sig-Geo] semivariogram calculation - discrepancy between gls and gstat

Guido, I suspect that nlme works with models for spatial correlation and
not for spatial covariance, meaning that the variance (variog) gets
standardized - see ?corClasses in nlme. Do the variog values approach 1
for longer distances?

On 07/05/2010 11:02 PM, Guido Lorenz wrote:
> Dear R-sig-Geo members,
> 
> a semivariogram for spatial soil data, calculated by the gls (nlme library) function gives the following estimates:
> 
>> lmm.dap2b <- gls(Dap.sa ~ 1 + ID.sitio, Pd2006mm, correlation=corGaus(form=~(easting.m+northing.m)|ID.sitio, nugget=TRUE, metric="euclidean"), na.action=na.omit, method="REML")
>> Variogram(lmm.dap2b)
>       variog      dist n.pairs
> 1  0.3059585  2.828427     122
> 2  0.4040062  4.269282     125
> 3  0.5744688 18.110770     123
> 4  0.5266091 20.000000     125
> ....
> 
> whereas the variogram function of the gstat library gives, for similar distances (although different number of sample pairs), very different gamma values: 
> 
>  > variogram(Dap.sa ~ 1, locations = ~ easting.m + northing.m, data=Pd2006mm, cutoff=80)
>     np      dist       gamma dir.hor dir.ver   id
> 1  219  3.225693 0.005578128       0       0 var1
> 2   20  6.478671 0.004254656       0       0 var1
> 3    3 13.513045 0.009896324       0       0 var1
> 4  307 19.201322 0.009708390       0       0 var1
> .....  
> 
> Can anyone explain what is happening?
> 
> Thanks for any advice,
> Guido Lorenz
> 
> Can anyone explain
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo






From Roger.Bivand at nhh.no  Tue Jul  6 23:39:55 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 6 Jul 2010 23:39:55 +0200 (CEST)
Subject: [R-sig-Geo] Pseudo R^2 in spatial regressions
In-Reply-To: <16710.37215.qm@web110308.mail.gq1.yahoo.com>
References: <16710.37215.qm@web110308.mail.gq1.yahoo.com>
Message-ID: <alpine.LRH.2.00.1007062334570.1106@reclus.nhh.no>

On Tue, 6 Jul 2010, J. Sebastian Tello wrote:

> Dear all,
>
> I am currently trying to find out if there is a way to calculate a pseudo R2 value from the output of SAR error models or spatial GLS models. I have seen this presented in publications, and the program SAM (Spatial analysis in macroecology) produces this value... but I need to implement the calculation of this pseudo R2 in a piece of R code I am writing. The authors of SAM say they calculate their pseudo R2 using Nagelkerke's 1991 furmulation, which I also have seen used in various other places; so I have tried to use it with R output from functions errorsarlm and gls in R, but the results do not make sense.
>
> Here is what I am doing:
>
>
> For SAR error model:
>
> my.lm<-lm(Y~X1+X2+X3, data=DATA)
>
> coords<-as.matrix(cbind(DATA$x,DATA$y))
> nb.5<-dnearneigh(coords,0,5)
> nb.5.w<-nb2listw(nb.5, glist=NULL, style="W", zero.policy=TRUE)
>
> my.sar.error<- errorsarlm(my.lm, listw=nb.5.w, na.action="na.omit")
>
> lL.B <- logLik(my.sar.error)
> lL.0 <- updata(my.sar.error, ~1)

Really? There is no update() method for sarlm objects. so do not expect 
anything sensible. Do however see the Nagelkerke=TRUE argument to the 
summary() methos for sarlm objects:

library(spdep)
data(oldcol)
COL.errW.eig <- errorsarlm(CRIME ~ INC + HOVAL, data=COL.OLD,
  nb2listw(COL.nb, style="W"))
summary(COL.errW.eig, Nagelkerke=TRUE)

Hope this helps,

Roger


> yN<-nrow(DATA)
>
> Nagelkerke<-(1-exp((lL.B-lL.0)*(-2/yN)))/(1-exp((lL.0)*(2/yN)))
> Nagelkerke[1]
>
>
>
> For the GLS it looks almost identical:
>
> exp.correl.structure<-corExp(form=~x+y)
> my.gls<-gls(Y~X1+X2+X3, data=DATA, correlation=exp.correl.structure,
> method="ML"))
>
> lL.B <- logLik(my.gls)
> lL.0 <- updata(my.gls, ~1)
> yN<-nrow(DATA)
>
> Nagelkerke<-(1-exp((lL.B-lL.0)*(-2/yN)))/(1-exp((lL.0)*(2/yN)))
> Nagelkerke[1]
>
> From running these analyses, I obtain that the pseudo R2 is of almost 0.997, while the ols R2 is of only 0.59. I know this two numbers are not really comparable (I do not expect them to be the same), but also the pseudo R2 produced by SAM is of around 0.55. So I am not sure what is wrong. I think the pseudo R2 I am obtaining is for the model after accountiong for all the spatial autocorrelation, rather than only from what can be predicted by the explanatory variables in the model. If any one knows of a way to do this, or has any ideas of approaches to take or resources to visit, I would appreciate the input.
>
> Thanks in advance,
>
> Sebastian
>
>
> J. Sebasti?n Tello
>
>
> Department of Biological Sciences
> 285 Life Sciences Building
> Louisiana State University
> Baton Rouge, LA, 70803
> (225) 578-4284 (office and lab.)
>
>
>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Jul  6 23:42:56 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 6 Jul 2010 23:42:56 +0200 (CEST)
Subject: [R-sig-Geo] r.mapcalc with spgrass6
In-Reply-To: <4C334316.6050501@cebc.cnrs.fr>
References: <4C334316.6050501@cebc.cnrs.fr>
Message-ID: <alpine.LRH.2.00.1007062340260.1106@reclus.nhh.no>

On Tue, 6 Jul 2010, Pinaud David wrote:

> Dear all,
>
> I'm trying to use the GRASS function "r.mapcalc" using R package "spgrass6", 
> but I've got some trouble with it, I'm not even able to parse this function:
>
>> library(rgdal)
> Le chargement a n?cessit? le package : sp
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.1, released 2010/02/08
> Path to GDAL shared files: C:/PROGRA~1/R/R-211~1.1/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: C:/PROGRA~1/R/R-211~1.1/library/rgdal/proj
>
>> library(spgrass6)
> Le chargement a n?cessit? le package : XML
> GRASS GIS interface loaded with GRASS version: (GRASS not running)
>
>> parseGRASS("r.mapcalc")
> Error : syntax error, unexpected '-', expecting NAME or STRING
> Parse error  does not seem to be XML, nor to identify a file name
> Erreur dans parseGRASS("r.mapcalc") : r.mapcalc not parsed

You cannot use r.mapcalc with execGRASS for obvious reasons - r.mapcalc 
wants to handle input itself. Use r.mapcalculator instead for scripting. 
or use r.mapcalcs directly.

Hope this helps,

Roger

>
> I tried to change the XML encoding by
>> setXMLencoding("latin1")
> without success.
>
> For example,
>> parseGRASS("g.region")
> is correctly running, I've got the description of the function.
>
> Otherwise, my calculus with "r.mapcalc" within GRASS 6.4.0 is correctly 
> running.
>
>> sessionInfo()
> R version 2.11.1 (2010-05-31)
> i386-pc-mingw32
>
> locale:
> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252 
> LC_MONETARY=French_France.1252
> [4] LC_NUMERIC=C                   LC_TIME=French_France.1252 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base 
> other attached packages:
> [1] spgrass6_0.6-16 XML_3.1-0       rgdal_0.6-27    sp_0.9-65 
> loaded via a namespace (and not attached):
> [1] grid_2.11.1    lattice_0.18-8 tools_2.11.1 
>> get("SYS", envir = .GRASS_CACHE)
> [1] "WinNat"
>
>
> Am I missing something? Any idea?
>
> Thank you very much for your help and patience.
>
> David
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Tue Jul  6 23:46:03 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 6 Jul 2010 23:46:03 +0200 (CEST)
Subject: [R-sig-Geo] Moran's I with binary weights
In-Reply-To: <AANLkTinIdWSI6tNf-W587I_ATqsuhdjjeaMsvDPA571g@mail.gmail.com>
References: <AANLkTinIdWSI6tNf-W587I_ATqsuhdjjeaMsvDPA571g@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007062343170.1106@reclus.nhh.no>

On Tue, 6 Jul 2010, Michael Haenlein wrote:

> Dear all,
>
> I have a brief question regarding Moran's I: Is there any research on the
> behavior of Moran's I for situations where the spatial weights matrix is
> binary, i.e. only includes either 1 or 0? Does Moran's I require weights
> that are distributed in a certain way in the [0,1] interval? Or is it
> sufficient to know who is connected to whom (i.e., binary weights)?
> Specifically, I'm interested in the question whether the use of binary
> weights introduces any form of bias in the estimated value of Moran's I.

Moran's I is fine with binary weights, and was originally developed for 
them. The "bias" is that entities with many neighbours get up-weighted, 
just as row-standardisation down-weights those entities in favour of those 
with few neighbours.

Roger

>
> Thanks very much for your reply in advance,
>
> Michael
>
>
> Michael Haenlein
> Associate Professor of Marketing
> ESCP Europe
> Paris, France
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jsebastiantello at yahoo.com  Wed Jul  7 00:40:12 2010
From: jsebastiantello at yahoo.com (J. Sebastian Tello)
Date: Tue, 6 Jul 2010 15:40:12 -0700 (PDT)
Subject: [R-sig-Geo] Pseudo R^2 in spatial regressions
In-Reply-To: <alpine.LRH.2.00.1007062334570.1106@reclus.nhh.no>
References: <16710.37215.qm@web110308.mail.gq1.yahoo.com>
	<alpine.LRH.2.00.1007062334570.1106@reclus.nhh.no>
Message-ID: <711444.91965.qm@web110310.mail.gq1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100706/c617a4ff/attachment.pl>

From mark_connolly at acm.org  Wed Jul  7 23:55:56 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Wed, 07 Jul 2010 17:55:56 -0400
Subject: [R-sig-Geo] plot.autoKrige and standard breaks for coloring
Message-ID: <4C34F7EC.1010709@acm.org>

plot.autoKrige does a nice job of laying out the predicted surface, the 
standard error and the fitted variogram (over the sample variogram).

Is there a way to set the breaks used for coloring the prediction 
surface so I can get the same breaks across a series of plots?  For 
example, with spplot, I can use 'at' to set the breaks at standard 
locations.  I can set col.regions with plot.autoKrige, but I can't seem 
to set the break locations.  Can this be done?

Thanks,
Mark


From r.hijmans at gmail.com  Thu Jul  8 07:48:36 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 7 Jul 2010 22:48:36 -0700
Subject: [R-sig-Geo] Spatial data interpolation on R
In-Reply-To: <994490.49713.qm@web54304.mail.re2.yahoo.com>
References: <AANLkTikb7y1VNWgD8TTLTvKkgEp_s2ySFjILMfvKiHZi@mail.gmail.com>
	<994490.49713.qm@web54304.mail.re2.yahoo.com>
Message-ID: <AANLkTikBUsaBiGT6VjXGCVUdfpBtOleLj43guV56Jomj@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100707/0a081a0e/attachment.pl>

From p.hiemstra at geo.uu.nl  Thu Jul  8 10:01:18 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 08 Jul 2010 10:01:18 +0200
Subject: [R-sig-Geo] plot.autoKrige and standard breaks for coloring
In-Reply-To: <4C34F7EC.1010709@acm.org>
References: <4C34F7EC.1010709@acm.org>
Message-ID: <4C3585CE.8090701@geo.uu.nl>

On 07/07/2010 11:55 PM, Mark Connolly wrote:
> plot.autoKrige does a nice job of laying out the predicted surface, 
> the standard error and the fitted variogram (over the sample variogram).
>
> Is there a way to set the breaks used for coloring the prediction 
> surface so I can get the same breaks across a series of plots?  For 
> example, with spplot, I can use 'at' to set the breaks at standard 
> locations.  I can set col.regions with plot.autoKrige, but I can't 
> seem to set the break locations.  Can this be done?
>
> Thanks,
> Mark
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Hi Mark,

Use the at parameter to set the breaks.

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770


From mark_connolly at acm.org  Thu Jul  8 11:40:17 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Thu, 08 Jul 2010 05:40:17 -0400
Subject: [R-sig-Geo] plot.autoKrige and standard breaks for coloring
In-Reply-To: <4C3585CE.8090701@geo.uu.nl>
References: <4C34F7EC.1010709@acm.org> <4C3585CE.8090701@geo.uu.nl>
Message-ID: <4C359D01.3040000@acm.org>

I was getting an error, but it looks as though I was over-specifying.

works:
plot(sl.ak,col.regions=plotclr, at=class$brks)

does not work (I was using an example for spplot that specified cuts for 
some unknown reason):
plot(sl.ak,col.regions=plotclr, at=class$brks, cuts=nclr)

So that's good. But, the breaks are appropriate for kriging prediction 
classes but not standard error classes.  Can I control both?


On 07/08/2010 04:01 AM, Paul Hiemstra wrote:
> On 07/07/2010 11:55 PM, Mark Connolly wrote:
>> plot.autoKrige does a nice job of laying out the predicted surface, 
>> the standard error and the fitted variogram (over the sample variogram).
>>
>> Is there a way to set the breaks used for coloring the prediction 
>> surface so I can get the same breaks across a series of plots?  For 
>> example, with spplot, I can use 'at' to set the breaks at standard 
>> locations.  I can set col.regions with plot.autoKrige, but I can't 
>> seem to set the break locations.  Can this be done?
>>
>> Thanks,
>> Mark
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> Hi Mark,
>
> Use the at parameter to set the breaks.
>
> cheers,
> Paul
>


From p.hiemstra at geo.uu.nl  Thu Jul  8 11:39:52 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 08 Jul 2010 11:39:52 +0200
Subject: [R-sig-Geo] plot.autoKrige and standard breaks for coloring
In-Reply-To: <4C359D01.3040000@acm.org>
References: <4C34F7EC.1010709@acm.org> <4C3585CE.8090701@geo.uu.nl>
	<4C359D01.3040000@acm.org>
Message-ID: <4C359CE8.8040909@geo.uu.nl>

Hi,

My advice would be to take the plot.autoKrige function and adapt it to 
your specific needs.

cheers,
Paul

On 07/08/2010 11:40 AM, Mark Connolly wrote:
> I was getting an error, but it looks as though I was over-specifying.
>
> works:
> plot(sl.ak,col.regions=plotclr, at=class$brks)
>
> does not work (I was using an example for spplot that specified cuts 
> for some unknown reason):
> plot(sl.ak,col.regions=plotclr, at=class$brks, cuts=nclr)
>
> So that's good. But, the breaks are appropriate for kriging prediction 
> classes but not standard error classes.  Can I control both?
>
>
> On 07/08/2010 04:01 AM, Paul Hiemstra wrote:
>> On 07/07/2010 11:55 PM, Mark Connolly wrote:
>>> plot.autoKrige does a nice job of laying out the predicted surface, 
>>> the standard error and the fitted variogram (over the sample 
>>> variogram).
>>>
>>> Is there a way to set the breaks used for coloring the prediction 
>>> surface so I can get the same breaks across a series of plots?  For 
>>> example, with spplot, I can use 'at' to set the breaks at standard 
>>> locations.  I can set col.regions with plot.autoKrige, but I can't 
>>> seem to set the break locations.  Can this be done?
>>>
>>> Thanks,
>>> Mark
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> Hi Mark,
>>
>> Use the at parameter to set the breaks.
>>
>> cheers,
>> Paul
>>
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770


From mark_connolly at acm.org  Thu Jul  8 11:46:58 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Thu, 08 Jul 2010 05:46:58 -0400
Subject: [R-sig-Geo] plot.autoKrige and standard breaks for coloring
In-Reply-To: <4C359CE8.8040909@geo.uu.nl>
References: <4C34F7EC.1010709@acm.org> <4C3585CE.8090701@geo.uu.nl>
	<4C359D01.3040000@acm.org> <4C359CE8.8040909@geo.uu.nl>
Message-ID: <4C359E92.4030801@acm.org>

Thanks.  I'll go that route.

On 07/08/2010 05:39 AM, Paul Hiemstra wrote:
> Hi,
>
> My advice would be to take the plot.autoKrige function and adapt it to 
> your specific needs.
>
> cheers,
> Paul
>
> On 07/08/2010 11:40 AM, Mark Connolly wrote:
>> I was getting an error, but it looks as though I was over-specifying.
>>
>> works:
>> plot(sl.ak,col.regions=plotclr, at=class$brks)
>>
>> does not work (I was using an example for spplot that specified cuts 
>> for some unknown reason):
>> plot(sl.ak,col.regions=plotclr, at=class$brks, cuts=nclr)
>>
>> So that's good. But, the breaks are appropriate for kriging 
>> prediction classes but not standard error classes.  Can I control both?
>>
>>
>> On 07/08/2010 04:01 AM, Paul Hiemstra wrote:
>>> On 07/07/2010 11:55 PM, Mark Connolly wrote:
>>>> plot.autoKrige does a nice job of laying out the predicted surface, 
>>>> the standard error and the fitted variogram (over the sample 
>>>> variogram).
>>>>
>>>> Is there a way to set the breaks used for coloring the prediction 
>>>> surface so I can get the same breaks across a series of plots?  For 
>>>> example, with spplot, I can use 'at' to set the breaks at standard 
>>>> locations.  I can set col.regions with plot.autoKrige, but I can't 
>>>> seem to set the break locations.  Can this be done?
>>>>
>>>> Thanks,
>>>> Mark
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> Hi Mark,
>>>
>>> Use the at parameter to set the breaks.
>>>
>>> cheers,
>>> Paul
>>>
>>
>
>


From nepsiva at gmail.com  Thu Jul  8 14:32:40 2010
From: nepsiva at gmail.com (Siva Sundaresan)
Date: Thu, 08 Jul 2010 15:32:40 +0300
Subject: [R-sig-Geo] rgdal package installation error
Message-ID: <4C35C568.40200@gmail.com>

I am trying to install the rgdal package under Ubuntu 8.10 with have 
gdal 1.7.2 installed. I get the following error:

On typing:

 > install.packages("rgdal")
Warning in install.packages("rgdal") :
   argument 'lib' is missing: using '/usr/local/lib/R/site-library'

<snip stuff that seems irrelevant>

checking for pj_init_plus in -lproj... yes
./proj_conf_test: error while loading shared libraries: libgdal.so.1: 
cannot open shared object file: No such file or directory
./proj_conf_test: error while loading shared libraries: libgdal.so.1: 
cannot open shared object file: No such file or directory
Package CPP flags: -I/usr/local/include
Package LIBS: -L/usr/local/lib -lgdal
configure: creating ./config.status
config.status: creating src/Makevars
** libs

<snip other g++ stuff>

installing to /usr/local/lib/R/site-library/rgdal/libs
** R
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices ...
** testing if installed package can be loaded
Error in dyn.load(file, DLLpath = DLLpath, ...) :
   unable to load shared library 
'/usr/local/lib/R/site-library/rgdal/libs/rgdal.so':
   libgdal.so.1: cannot open shared object file: No such file or directory
ERROR: loading failed
* removing ?/usr/local/lib/R/site-library/rgdal?

The downloaded packages are in
	?/tmp/RtmpQVVEl1/downloaded_packages?
Warning message:
In install.packages("rgdal") :
   installation of package 'rgdal' had non-zero exit status


I have tried uninstalling and reinstalling gdal (using sudo apt-get 
install). I have also tried downloading the rgdal tar.gz file and 
installing using R CMD INSTALL at the shell prompt. I still get the same 
error message as above.

If anyone can help me, I would be very grateful.

Thank you,
Siva


From thi_veloso at yahoo.com.br  Thu Jul  8 16:34:46 2010
From: thi_veloso at yahoo.com.br (Thiago Veloso)
Date: Thu, 8 Jul 2010 07:34:46 -0700 (PDT)
Subject: [R-sig-Geo] rgdal package installation error
In-Reply-To: <4C35C568.40200@gmail.com>
Message-ID: <557948.78308.qm@web54305.mail.re2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100708/dc0005a7/attachment.pl>

From snanand at msn.com  Thu Jul  8 18:15:11 2010
From: snanand at msn.com (Sathyanarayan Anand)
Date: Thu, 8 Jul 2010 16:15:11 +0000
Subject: [R-sig-Geo] Spatial car.normal compile error
Message-ID: <BAY123-W107083502993B1D5C4B008BCB40@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100708/cfedcb65/attachment.pl>

From benjamin.mazzotta at tufts.edu  Thu Jul  8 19:11:06 2010
From: benjamin.mazzotta at tufts.edu (Ben Mazzotta)
Date: Thu, 08 Jul 2010 13:11:06 -0400
Subject: [R-sig-Geo] rgdal package installation error
In-Reply-To: <4C35C568.40200@gmail.com>
References: <4C35C568.40200@gmail.com>
Message-ID: <4C3606AA.5050101@tufts.edu>

Could you show me the output of this command? Thanks

sudo aptitude search gdal



On 7/8/10 8:32 AM, Siva Sundaresan wrote:
> I am trying to install the rgdal package under Ubuntu 8.10 with have
> gdal 1.7.2 installed. I get the following error:
>
> On typing:
>
> > install.packages("rgdal")
> Warning in install.packages("rgdal") :
>   argument 'lib' is missing: using '/usr/local/lib/R/site-library'
>
> <snip stuff that seems irrelevant>
>
> checking for pj_init_plus in -lproj... yes
> ./proj_conf_test: error while loading shared libraries: libgdal.so.1:
> cannot open shared object file: No such file or directory
> ./proj_conf_test: error while loading shared libraries: libgdal.so.1:
> cannot open shared object file: No such file or directory
> Package CPP flags: -I/usr/local/include
> Package LIBS: -L/usr/local/lib -lgdal
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
>
> <snip other g++ stuff>
>
> installing to /usr/local/lib/R/site-library/rgdal/libs
> ** R
> ** inst
> ** preparing package for lazy loading
> ** help
> *** installing help indices
> ** building package indices ...
> ** testing if installed package can be loaded
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>   unable to load shared library
> '/usr/local/lib/R/site-library/rgdal/libs/rgdal.so':
>   libgdal.so.1: cannot open shared object file: No such file or directory
> ERROR: loading failed
> * removing ?/usr/local/lib/R/site-library/rgdal?
>
> The downloaded packages are in
>     ?/tmp/RtmpQVVEl1/downloaded_packages?
> Warning message:
> In install.packages("rgdal") :
>   installation of package 'rgdal' had non-zero exit status
>
>
> I have tried uninstalling and reinstalling gdal (using sudo apt-get
> install). I have also tried downloading the rgdal tar.gz file and
> installing using R CMD INSTALL at the shell prompt. I still get the
> same error message as above.
>
> If anyone can help me, I would be very grateful.
>
> Thank you,
> Siva
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Ben Mazzotta
PhD Candidate
Fletcher School, Tufts University


From eick at vistracks.com  Thu Jul  8 19:17:43 2010
From: eick at vistracks.com (Stephen G. Eick)
Date: Thu, 8 Jul 2010 12:17:43 -0500
Subject: [R-sig-Geo] RPostgreSQL
Message-ID: <003201cb1ec1$7ace6860$706b3920$@cs.uic.edu>

I'm trying to access some data that I've stored in  PostGIS database using
the package RPostgreSQL.  When I tried to load the package

 

> library(RPostgreSQL)

Error in inDL(x, as.logical(local), as.logical(now), ...) : 

  unable to load shared library
'c:/Users/eick/Documents/R/win-library/2.11/RPostgreSQL/libs/RPostgreSQL.dll
':

  LoadLibrary failure:  The specified module could not be found.

 

Error: package/namespace load failed for 'RPostgreSQL'

 



 

Thanks, Steve

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100708/8d2fbd84/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 19459 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100708/8d2fbd84/attachment.png>

From csfowler at u.washington.edu  Thu Jul  8 19:24:54 2010
From: csfowler at u.washington.edu (Chris Fowler)
Date: Thu, 08 Jul 2010 10:24:54 -0700
Subject: [R-sig-Geo] write.nb.gal doesn't include correct ID
Message-ID: <4C3609E6.3040007@u.washington.edu>

I am trying to write a rather large neighborhood list to a .gal file 
using the following code
write.nb.gal(Q1.nb, "Map 
Data/subWeights.gal",oldstyle=FALSE,shpfile="submap.shp",ind="ind")

where ind is an array of numbers representing FIPS codes at the census 
tract level (I also tried it using "STFID" which is the same data as a 
column in the shapefile submap.shp) while I don't get any errors, my 
.gal file uses the sequential id number from the shapefile (a 
meaningless 1 to n number assigned by ArcGIS in the creation of the 
shapefile). I have tried (in ArcGIS) converting the number assigned by 
ArcGIS to my FIPS codes using Field Calculator, but this doesn't seem to 
change anything. My concern is that the problem is perhaps the length of 
the FIPS codes which are 10 or 11 digits each?

Is there something that I am missing that will allow me to use the more 
meaningful FIPS codes in the gal file?

Thanks,

Chris Fowler


From jsebastiantello at yahoo.com  Thu Jul  8 20:19:31 2010
From: jsebastiantello at yahoo.com (J. Sebastian Tello)
Date: Thu, 8 Jul 2010 11:19:31 -0700 (PDT)
Subject: [R-sig-Geo] Pseudo R^2 (or other effect size) in spatial gls
	regressions
Message-ID: <900651.8529.qm@web110312.mail.gq1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100708/fe3d40ad/attachment.pl>

From nepsiva at gmail.com  Fri Jul  9 07:55:45 2010
From: nepsiva at gmail.com (Siva Sundaresan)
Date: Fri, 09 Jul 2010 08:55:45 +0300
Subject: [R-sig-Geo] rgdal package installation error
In-Reply-To: <557948.78308.qm@web54305.mail.re2.yahoo.com>
References: <557948.78308.qm@web54305.mail.re2.yahoo.com>
Message-ID: <4C36B9E1.3040502@gmail.com>

Dear Thiago,

Thanks! That did the trick.

I poked around the /usr/local/lib directory and I suspect the problem 
had something to do with libgdal.so.1, which I believe is a link to the 
gdal libraries(?). Once that link was created correctly (because of the 
installation of the GDAL libraries) it works ok.

Thanks for your help.

best,
Siva

Thiago Veloso wrote:
>   Dear Siva,
>   Installing GDAL libraries should do the trick. Search in Synaptic or download from this URL: http://packages.ubuntu.com/ro/hardy/libgdal1-1.4.0
>   Best regards,
>   Thiago.
> 
> --- On Thu, 8/7/10, Siva Sundaresan <nepsiva at gmail.com> wrote:
> 
> From: Siva Sundaresan <nepsiva at gmail.com>
> Subject: [R-sig-Geo] rgdal package installation error
> To: r-sig-geo at stat.math.ethz.ch
> Date: Thursday, 8 July, 2010, 9:32
> 
> I am trying to install the rgdal package under Ubuntu 8.10 with have gdal 1.7.2 installed. I get the following error:
> 
> On typing:
> 
>> install.packages("rgdal")
> Warning in install.packages("rgdal") :
>   argument 'lib' is missing: using '/usr/local/lib/R/site-library'
> 
> <snip stuff that seems irrelevant>
> 
> checking for pj_init_plus in -lproj... yes
> ./proj_conf_test: error while loading shared libraries: libgdal.so.1: cannot open shared object file: No such file or directory
> ./proj_conf_test: error while loading shared libraries: libgdal.so.1: cannot open shared object file: No such file or directory
> Package CPP flags: -I/usr/local/include
> Package LIBS: -L/usr/local/lib -lgdal
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
> 
> <snip other g++ stuff>
> 
> installing to /usr/local/lib/R/site-library/rgdal/libs
> ** R
> ** inst
> ** preparing package for lazy loading
> ** help
> *** installing help indices
> ** building package indices ...
> ** testing if installed package can be loaded
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>   unable to load shared library '/usr/local/lib/R/site-library/rgdal/libs/rgdal.so':
>   libgdal.so.1: cannot open shared object file: No such file or directory
> ERROR: loading failed
> * removing ?/usr/local/lib/R/site-library/rgdal?
> 
> The downloaded packages are in
>     ?/tmp/RtmpQVVEl1/downloaded_packages?
> Warning message:
> In install.packages("rgdal") :
>   installation of package 'rgdal' had non-zero exit status
> 
> 
> I have tried uninstalling and reinstalling gdal (using sudo apt-get install). I have also tried downloading the rgdal tar.gz file and installing using R CMD INSTALL at the shell prompt. I still get the same error message as above.
> 
> If anyone can help me, I would be very grateful.
> 
> Thank you,
> Siva
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
>       

-- 
Siva Sundaresan

Conservation Biology
Denver Zoological Foundation
Denver CO 80205 USA

Ecology & Evolutionary Biology
Princeton University
Princeton NJ 08544 USA

http://www.princeton.edu/~equids
http://savingstripes.wildlifedirect.org


From benjamin.mazzotta at tufts.edu  Fri Jul  9 18:49:42 2010
From: benjamin.mazzotta at tufts.edu (Ben Mazzotta)
Date: Fri, 09 Jul 2010 12:49:42 -0400
Subject: [R-sig-Geo] primer on manipulating variables in spatial polygons
	data frames?
Message-ID: <4C375326.20504@tufts.edu>

Do spatial polygon data frames have an equivalent of subscripting for 
data frames? Or perhaps a way to call variables akin to the get() command?

I'd like to be able to write apply() functions over the variables in a 
spatial polygons data frame, so that I can automate the generation of plots.

Roger et al. have done such great work on maptools() and related 
packages, I imagine this must be straightforward; but I can't find the 
documentation for it.  Can someone point me in the right direction?

Examples w/ comments below.

Thank you-
Ben

# This is a test of my ability to call columns of a spatial data frame.

library(maptools)
data(wrld_simpl)

df.obs <- nrow(wrld_simpl)*10 #enough data for ten rows

df <- runif(df.obs,1,10)    #create some data
df <- data.frame(matrix(df, nrow(wrld_simpl),10)) #slice it up

row.names(df) <- row.names(wrld_simpl)

newworld <- spCbind(wrld_simpl, df)
names(newworld)

# It is easy to call a column of the data by name.

class(newworld)
class(newworld$X1)
mean(newworld$X1)

# What about subscripts?
# The spatial polygons data frame doesn't have the right number of 
dimentions. :(
class(newworld[,1])

# Get commands?
varname <- "newworld$X1" #This is a variable name
class(get(varname))    #But the get command can't find it....

# How can I write an apply()-family command over the variables in the 
newworld spatial polygons data frame?




-- 
Ben Mazzotta, PhD Candidate
The Fletcher School, Tufts University
benjamin.mazzotta at tufts.edu


From greenberg at ucdavis.edu  Fri Jul  9 20:23:25 2010
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Fri, 9 Jul 2010 11:23:25 -0700
Subject: [R-sig-Geo] getValues() question
Message-ID: <AANLkTinnwdUmvGhqKFHweCzFJz5iua1dpYYTLHoLendA@mail.gmail.com>

r-sig-geo'ers and Robert:

If I want to pull out the values of a raster into a dataframe,
ignoring "masked" values, what is the quickest way to do this?  I can
use getValues() and "post-process" the output, but is there a way to
skip every loading these masked values into a memory in the first
place?

--j


From pmaurogut at hotmail.com  Fri Jul  9 20:58:30 2010
From: pmaurogut at hotmail.com (=?iso-8859-1?Q?Francisco_Mauro_Guti=E9rrez?=)
Date: Fri, 9 Jul 2010 20:58:30 +0200
Subject: [R-sig-Geo] Unable to read image because a memory limitation
Message-ID: <COL107-DS14B8663FDF9ABB836ADA34BDB50@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100709/1d16b80d/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Fri Jul  9 21:31:58 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 9 Jul 2010 20:31:58 +0100
Subject: [R-sig-Geo] Unable to read image because a memory limitation
In-Reply-To: <COL107-DS14B8663FDF9ABB836ADA34BDB50@phx.gbl>
References: <COL107-DS14B8663FDF9ABB836ADA34BDB50@phx.gbl>
Message-ID: <AANLkTik5BS6W__cLQbDzrpjx6TFbGJbpoP62GcgPHade@mail.gmail.com>

On Fri, Jul 9, 2010 at 7:58 PM, Francisco Mauro Guti?rrez
<pmaurogut at hotmail.com> wrote:

> My problem is that R provides an Error message saying that it is not
> possible to allocate a vector of 650 Mb. Does anyone now how can I increase
> the memory limit? It looks like I should increase it to be able to read the
> image.

 It depends on what else your computer is doing. And how much RAM your
machine has. This image has 5x5300x5500 =~ 150 mega-cells, and each
one will take up four bytes as a floating point number (single
precision) so there's your 650Mb. If your operating system doesn't
have 650Mb spare then R will fail at that point. If this is a Windows
PC with 1G of RAM then I can well imagine it not coping - in fact I'd
think if it was a 2G machine then it would still struggle. 4G might do
it, but it will still be slow.

 You might want to try sampling from the raster using the region.dim
and/or output.dim options of readGDAL until you can find a machine
with more RAM.

Barry


From jacobvanetten at yahoo.com  Fri Jul  9 23:00:51 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Fri, 9 Jul 2010 21:00:51 +0000 (GMT)
Subject: [R-sig-Geo] getValues() question
In-Reply-To: <AANLkTinnwdUmvGhqKFHweCzFJz5iua1dpYYTLHoLendA@mail.gmail.com>
Message-ID: <38809.52935.qm@web23703.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100709/792d609d/attachment.pl>

From moshersteven at gmail.com  Sat Jul 10 00:21:24 2010
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 9 Jul 2010 15:21:24 -0700
Subject: [R-sig-Geo] creating rasterStack from a matrix
Message-ID: <AANLkTilQRiMI81bZjKmVHCp6corvtjU_4KGDjqqV8ol3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100709/2a55ccf3/attachment.pl>

From r.hijmans at gmail.com  Sat Jul 10 05:18:43 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 9 Jul 2010 20:18:43 -0700
Subject: [R-sig-Geo] Unable to read image because a memory limitation
In-Reply-To: <AANLkTik5BS6W__cLQbDzrpjx6TFbGJbpoP62GcgPHade@mail.gmail.com>
References: <COL107-DS14B8663FDF9ABB836ADA34BDB50@phx.gbl>
	<AANLkTik5BS6W__cLQbDzrpjx6TFbGJbpoP62GcgPHade@mail.gmail.com>
Message-ID: <AANLkTimo4FHdYog3uAmkq2xyCfVhYgyI_IiYBtRwKMbr@mail.gmail.com>

Francisco,

You have not said why you want to read the image into memory, but
chances are that you do not need to, if you use the 'raster' package
to explore or manipulate your data.

Robert

On Fri, Jul 9, 2010 at 12:31 PM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Fri, Jul 9, 2010 at 7:58 PM, Francisco Mauro Guti?rrez
> <pmaurogut at hotmail.com> wrote:
>
>> My problem is that R provides an Error message saying that it is not
>> possible to allocate a vector of 650 Mb. Does anyone now how can I increase
>> the memory limit? It looks like I should increase it to be able to read the
>> image.
>
> ?It depends on what else your computer is doing. And how much RAM your
> machine has. This image has 5x5300x5500 =~ 150 mega-cells, and each
> one will take up four bytes as a floating point number (single
> precision) so there's your 650Mb. If your operating system doesn't
> have 650Mb spare then R will fail at that point. If this is a Windows
> PC with 1G of RAM then I can well imagine it not coping - in fact I'd
> think if it was a 2G machine then it would still struggle. 4G might do
> it, but it will still be slow.
>
> ?You might want to try sampling from the raster using the region.dim
> and/or output.dim options of readGDAL until you can find a machine
> with more RAM.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Sat Jul 10 05:24:08 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 9 Jul 2010 20:24:08 -0700
Subject: [R-sig-Geo] getValues() question
In-Reply-To: <38809.52935.qm@web23703.mail.ird.yahoo.com>
References: <AANLkTinnwdUmvGhqKFHweCzFJz5iua1dpYYTLHoLendA@mail.gmail.com>
	<38809.52935.qm@web23703.mail.ird.yahoo.com>
Message-ID: <AANLkTill4jkl9tAxC2ds6HGfkANRCzOavOFx44-tdTkw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100709/92b5d136/attachment.pl>

From r.hijmans at gmail.com  Sat Jul 10 05:35:51 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 9 Jul 2010 20:35:51 -0700
Subject: [R-sig-Geo] creating rasterStack from a matrix
In-Reply-To: <AANLkTilQRiMI81bZjKmVHCp6corvtjU_4KGDjqqV8ol3@mail.gmail.com>
References: <AANLkTilQRiMI81bZjKmVHCp6corvtjU_4KGDjqqV8ol3@mail.gmail.com>
Message-ID: <AANLkTimDi4E0a3lvhxik_z806pCKLUsOszNVStLRbq3v@mail.gmail.com>

Steven,

Not that I can think of. Something for the to-do list.

Below is how you could make a RasterBrick (which should be preferable
to a RasterStack for objects created in memory (and otherwise their
behavior is similar to a RasterStack).

globe<-brick(nrows=36, ncols=72)
id <- data.frame(cell=1:ncell(globe))
idv = merge(id, stackmatrix, by=1, all.x=T)
globe <- setValues(globe, as.matrix(idv))

Robert


On Fri, Jul 9, 2010 at 3:21 PM, steven mosher <moshersteven at gmail.com> wrote:
> Assuming I have a matrix of ?Nrows and Mcols ?where
> Column #1 is filled with a valid cell number for a raster. ALL cell numbers
> will not
> ?be present.
>
> Subsequent columns (2-M) contain the data that I want to place in a sequence
> of
> layers, so that in the end I have a rasterStack of M layers. M can be quite
> large,
> ( like 1000-2000) Essentially they are values at various time slices where
> time
> is M.
>
> In any case, if there is only one layer ( column 2) then assigning the
> values in column
> 2 to the cells in column 1 is straightforwd (assuming I read the manual
> correctly.
>
> That works like this:
> ( Create a dummy version of the data with 200 cells)
>
> stackmatrix<-matrix(NA,nrow=200,ncol=3)
> # fake values
> ?stackmatrix[,3]<-seq(0,199,by=1)
> ?stackmatrix[,2]<-seq(-59.9,-79.8,by=-.1)
> # toss some valid cell numbers in column 1
> ?stackmatrix[,1]<-seq(100,299,by=1)
> globe<-raster(nrows=36, ncols=72, xmn=-180, xmx=180, ymn=-90, ymx=90,
> + ? projs="+proj=longlat +datum=WGS84")
> # assign the values in column 2 to the cells in column 1.
> globe[stackmatrix[,1]]<-stackmatrix[,2]
>
>
> If I have a large number of columns and I want to create a large rasterStack
> with all the data, is there a slick way to do it
>
> Perhaps apply?
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Sat Jul 10 17:13:24 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 10 Jul 2010 17:13:24 +0200
Subject: [R-sig-Geo] primer on manipulating variables in spatial
 polygons data frames?
In-Reply-To: <4C375326.20504@tufts.edu>
References: <4C375326.20504@tufts.edu>
Message-ID: <4C388E14.5010805@uni-muenster.de>



On 07/09/2010 06:49 PM, Ben Mazzotta wrote:
> Do spatial polygon data frames have an equivalent of subscripting for
> data frames? Or perhaps a way to call variables akin to the get() command?

as with data.frames, for a SpatiaPolygonsDataFrame x, x["attr"] selects
the attribute, and x[1,] selects the first polygons associated with the
first entry in the attribute table.

> 
> I'd like to be able to write apply() functions over the variables in a
> spatial polygons data frame, so that I can automate the generation of
> plots.
> 
> Roger et al. have done such great work on maptools() and related
> packages, I imagine this must be straightforward; but I can't find the
> documentation for it.  Can someone point me in the right direction?
> 

vignette("sp")

or for a more extensive treatment the book "Applied spatial data
analysis with R" written by Roger et al.

> Examples w/ comments below.
> 
> Thank you-
> Ben
> 
> # This is a test of my ability to call columns of a spatial data frame.
> 
> library(maptools)
> data(wrld_simpl)
> 
> df.obs <- nrow(wrld_simpl)*10 #enough data for ten rows
> 
> df <- runif(df.obs,1,10)    #create some data
> df <- data.frame(matrix(df, nrow(wrld_simpl),10)) #slice it up
> 
> row.names(df) <- row.names(wrld_simpl)
> 
> newworld <- spCbind(wrld_simpl, df)
> names(newworld)
> 
> # It is easy to call a column of the data by name.
> 
> class(newworld)
> class(newworld$X1)
> mean(newworld$X1)
> 
> # What about subscripts?
> # The spatial polygons data frame doesn't have the right number of
> dimentions. :(
> class(newworld[,1])
> 
> # Get commands?
> varname <- "newworld$X1" #This is a variable name
> class(get(varname))    #But the get command can't find it....
> 
> # How can I write an apply()-family command over the variables in the
> newworld spatial polygons data frame?
> 
> 
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From carson.farmer at gmail.com  Sat Jul 10 19:43:03 2010
From: carson.farmer at gmail.com (Carson Farmer)
Date: Sat, 10 Jul 2010 18:43:03 +0100
Subject: [R-sig-Geo] WKT to sp objects
In-Reply-To: <AANLkTikdzZx3aJMH-NRWtB_M_rhxhEHaKYhh0UlVXKKf@mail.gmail.com>
References: <AANLkTikdzZx3aJMH-NRWtB_M_rhxhEHaKYhh0UlVXKKf@mail.gmail.com>
Message-ID: <AANLkTikSS3AoUuGwXrdka8X-FAF72FTWR91RbevjD0Lc@mail.gmail.com>

Hello list,

Does anyone know of a nice way to convert WKT strings to sp Spatial
objects? The list archives don't turn up anything conclusive beyond
the possibility of doing it using rgeos, but I was wondering if anyone
knew of a more 'stable', all R way of doing it?

Thanks for any hints or thoughts you might have.

Carson

--
Carson J. Q. Farmer
ISSP Doctoral Fellow
National Centre for Geocomputation
National University of Ireland, Maynooth,
http://www.carsonfarmer.com/


From b.rowlingson at lancaster.ac.uk  Sat Jul 10 19:48:26 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 10 Jul 2010 18:48:26 +0100
Subject: [R-sig-Geo] WKT to sp objects
In-Reply-To: <AANLkTikSS3AoUuGwXrdka8X-FAF72FTWR91RbevjD0Lc@mail.gmail.com>
References: <AANLkTikdzZx3aJMH-NRWtB_M_rhxhEHaKYhh0UlVXKKf@mail.gmail.com>
	<AANLkTikSS3AoUuGwXrdka8X-FAF72FTWR91RbevjD0Lc@mail.gmail.com>
Message-ID: <AANLkTikYboO4Wh51nr8GWrxejqx_b9pyeZ-yRezo0IB_@mail.gmail.com>

On Sat, Jul 10, 2010 at 6:43 PM, Carson Farmer <carson.farmer at gmail.com> wrote:
> Hello list,
>
> Does anyone know of a nice way to convert WKT strings to sp Spatial
> objects? The list archives don't turn up anything conclusive beyond
> the possibility of doing it using rgeos, but I was wondering if anyone
> knew of a more 'stable', all R way of doing it?

 I found a blog post for some desktop GIS that did it by having the
WKT in a CSV file, and then an OGR virtual vector file which specified
having its data in the CSV in WKT format.

http://www.mail-archive.com/jump-users at lists.jump-project.org/msg00124.html

 For all-R solution, you'd have to build the two files and then read
them with readOGR. Or is there anything in the gdal C code exposed
that does it?

Barry


From Roger.Bivand at nhh.no  Sat Jul 10 20:00:19 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 10 Jul 2010 20:00:19 +0200 (CEST)
Subject: [R-sig-Geo] WKT to sp objects
In-Reply-To: <AANLkTikSS3AoUuGwXrdka8X-FAF72FTWR91RbevjD0Lc@mail.gmail.com>
References: <AANLkTikdzZx3aJMH-NRWtB_M_rhxhEHaKYhh0UlVXKKf@mail.gmail.com>
	<AANLkTikSS3AoUuGwXrdka8X-FAF72FTWR91RbevjD0Lc@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007101957250.14750@reclus.nhh.no>

On Sat, 10 Jul 2010, Carson Farmer wrote:

> Hello list,
>
> Does anyone know of a nice way to convert WKT strings to sp Spatial
> objects? The list archives don't turn up anything conclusive beyond
> the possibility of doing it using rgeos, but I was wondering if anyone
> knew of a more 'stable', all R way of doing it?

Please do try to support the rgeos effort, the code for reading and 
writing is there already, and is used in the testing suited ported there. 
The GSoC project is almost at mid-term, so the more developers trying 
functionalities the better.

Best wishes,

Roger

>
> Thanks for any hints or thoughts you might have.
>
> Carson
>
> --
> Carson J. Q. Farmer
> ISSP Doctoral Fellow
> National Centre for Geocomputation
> National University of Ireland, Maynooth,
> http://www.carsonfarmer.com/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From carson.farmer at gmail.com  Sat Jul 10 20:06:51 2010
From: carson.farmer at gmail.com (Carson Farmer)
Date: Sat, 10 Jul 2010 19:06:51 +0100
Subject: [R-sig-Geo] WKT to sp objects
In-Reply-To: <alpine.LRH.2.00.1007101957250.14750@reclus.nhh.no>
References: <AANLkTikdzZx3aJMH-NRWtB_M_rhxhEHaKYhh0UlVXKKf@mail.gmail.com>
	<AANLkTikSS3AoUuGwXrdka8X-FAF72FTWR91RbevjD0Lc@mail.gmail.com>
	<alpine.LRH.2.00.1007101957250.14750@reclus.nhh.no>
Message-ID: <AANLkTimU8DLvut0goQQkEdkOxo8VQAcAzW3kf1Hv-hdE@mail.gmail.com>

I've actually just started playing around with rgeos, and it looks
like it will do what I need. I'll try to push it a bit more this week.
The reason I was looking for an all R solution was that the code would
be running on a server somewhere that I won't have access to, and at
this stage the server doesn't have rgeos installed (and the admins
probably won't want to install it for little ol' me either). In the
mean time, I'll fiddle about and see what I can come up with until I
can convince them to install rgeos.

Carson

On 10 July 2010 19:00, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Sat, 10 Jul 2010, Carson Farmer wrote:
>
>> Hello list,
>>
>> Does anyone know of a nice way to convert WKT strings to sp Spatial
>> objects? The list archives don't turn up anything conclusive beyond
>> the possibility of doing it using rgeos, but I was wondering if anyone
>> knew of a more 'stable', all R way of doing it?
>
> Please do try to support the rgeos effort, the code for reading and writing
> is there already, and is used in the testing suited ported there. The GSoC
> project is almost at mid-term, so the more developers trying functionalities
> the better.
>
> Best wishes,
>
> Roger
>
>>
>> Thanks for any hints or thoughts you might have.
>>
>> Carson
>>
>> --
>> Carson J. Q. Farmer
>> ISSP Doctoral Fellow
>> National Centre for Geocomputation
>> National University of Ireland, Maynooth,
>> http://www.carsonfarmer.com/
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>



-- 
Carson J. Q. Farmer
ISSP Doctoral Fellow
National Centre for Geocomputation
National University of Ireland, Maynooth,
http://www.carsonfarmer.com/


From edzer.pebesma at uni-muenster.de  Sat Jul 10 20:22:56 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 10 Jul 2010 20:22:56 +0200
Subject: [R-sig-Geo] Gaussian grids in R
In-Reply-To: <4C2CA0AC.1020303@isciences.com>
References: <4C2CA0AC.1020303@isciences.com>
Message-ID: <4C38BA80.1020104@uni-muenster.de>

Matt, why exactly would you want to coerce these data into a regular grid?

On 07/01/2010 04:05 PM, Matthew Landis wrote:
> Dear  R-sig-geo members,
> 
> I wonder if any of you have suggestions about how to import and use
> rasters with a spectral Gaussian T62 CRS in R.  I'm not very familiar
> with this coordinate system (commonly used for climate models), and I
> haven't been able to discover tools for dealing with them in R, either
> in PROJ.4 or mapproj or anywhere else, despite extensive scouring of the
> web.  Details of Gaussian grids can be seen at
> http://en.wikipedia.org/wiki/Gaussian_grid and
> http://www.nco.ncep.noaa.gov/pmb/docs/on388/tableb.html#GRID98
> 
> Specifically, I'm trying to use output from the NCEP CFS climate models
> (see http://cfs.ncep.noaa.gov/cfs/monthly/tmp2m/ -- these are in GRIB
> format).  A different example of a T62 grid can be downloaded in netCDF
> format at http://www.sage.wisc.edu/iamdata/grid.php.
> The goal is to transform the CRS into geographic lat/lon coordinates to
> be more compatible with our other datasets.  The big problem with
> getting these data into a SpatialGrid or SpatialPixelsDataFrame is that
> the latitude cells are not equally spaced - they get smaller towards the
> poles.  I may be able to approximate it to a regular grid by ignoring
> the changes to the poles (they are rather small after all), but I'd
> rather do it properly if possible.
> 
> Code below shows extracting latitudes from a T62 grid and plotting the
> changes in cell size with latitude.
> 
> library('ncdf')
> library('sp')
> nc <- 'C:/scratch/cfs/pop_den_1995_T62.nc' # Downloaded  from
> http://www.sage.wisc.edu/iamdata/grid.php
> 
> # Open the file and get latitude and longitude
> nc <- open.ncdf(ncfile)
> lat <- get.var.ncdf(nc, varid = 'latitude')
> lon <- get.var.ncdf(nc, varid = 'longitude')
> close.ncdf(nc)
> 
> # Generate coordinates for each grid cell
> x <- rep(lon, length(lat))
> y <- rep(lat, each = length(lon))
> sp <- SpatialPoints(cbind(x,y))
> # temp <- SpatialPixels(points = sp) # Doesn't work.  points have to be
> regular grid
> 
> # Show how the cell size changes with latitude
> cell.size <- diff(rev(lat))
> plot(lat[-1], cell.size)
> 
> Many thanks for any suggestions!
> 
> Matt
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From landis at isciences.com  Sun Jul 11 05:45:36 2010
From: landis at isciences.com (Matthew Landis)
Date: Sat, 10 Jul 2010 23:45:36 -0400
Subject: [R-sig-Geo] Gaussian grids in R
In-Reply-To: <4C38BA80.1020104@uni-muenster.de>
References: <4C2CA0AC.1020303@isciences.com> <4C38BA80.1020104@uni-muenster.de>
Message-ID: <4C393E60.4010304@isciences.com>

Edzer - I'm using the T62 grids of temperature and precip to feed a 
model.  The other datasets in the workflow are in geographic CRS, so I 
need to reproject the T62 data into geographic coordinates as well.

Since the T62 grid is nearly regular except with small variations 
towards the poles, my current strategy is to ignore the changes in cell 
size and pretend the grid is actually regular with a cell size 
corresponding to that of the lower latitudes.  I just thought it would 
be more satisfying to be able to specify the CRS more precisely.

Best,
Matt

On 7/10/2010 2:22 PM, Edzer Pebesma wrote:
> Matt, why exactly would you want to coerce these data into a regular grid?
>
> On 07/01/2010 04:05 PM, Matthew Landis wrote:
>    
>> Dear  R-sig-geo members,
>>
>> I wonder if any of you have suggestions about how to import and use
>> rasters with a spectral Gaussian T62 CRS in R.  I'm not very familiar
>> with this coordinate system (commonly used for climate models), and I
>> haven't been able to discover tools for dealing with them in R, either
>> in PROJ.4 or mapproj or anywhere else, despite extensive scouring of the
>> web.  Details of Gaussian grids can be seen at
>> http://en.wikipedia.org/wiki/Gaussian_grid and
>> http://www.nco.ncep.noaa.gov/pmb/docs/on388/tableb.html#GRID98
>>
>> Specifically, I'm trying to use output from the NCEP CFS climate models
>> (see http://cfs.ncep.noaa.gov/cfs/monthly/tmp2m/ -- these are in GRIB
>> format).  A different example of a T62 grid can be downloaded in netCDF
>> format at http://www.sage.wisc.edu/iamdata/grid.php.
>> The goal is to transform the CRS into geographic lat/lon coordinates to
>> be more compatible with our other datasets.  The big problem with
>> getting these data into a SpatialGrid or SpatialPixelsDataFrame is that
>> the latitude cells are not equally spaced - they get smaller towards the
>> poles.  I may be able to approximate it to a regular grid by ignoring
>> the changes to the poles (they are rather small after all), but I'd
>> rather do it properly if possible.
>>
>> Code below shows extracting latitudes from a T62 grid and plotting the
>> changes in cell size with latitude.
>>
>> library('ncdf')
>> library('sp')
>> nc<- 'C:/scratch/cfs/pop_den_1995_T62.nc' # Downloaded  from
>> http://www.sage.wisc.edu/iamdata/grid.php
>>
>> # Open the file and get latitude and longitude
>> nc<- open.ncdf(ncfile)
>> lat<- get.var.ncdf(nc, varid = 'latitude')
>> lon<- get.var.ncdf(nc, varid = 'longitude')
>> close.ncdf(nc)
>>
>> # Generate coordinates for each grid cell
>> x<- rep(lon, length(lat))
>> y<- rep(lat, each = length(lon))
>> sp<- SpatialPoints(cbind(x,y))
>> # temp<- SpatialPixels(points = sp) # Doesn't work.  points have to be
>> regular grid
>>
>> # Show how the cell size changes with latitude
>> cell.size<- diff(rev(lat))
>> plot(lat[-1], cell.size)
>>
>> Many thanks for any suggestions!
>>
>> Matt
>>
>>      
>


From p.hiemstra at geo.uu.nl  Mon Jul 12 09:41:01 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 12 Jul 2010 09:41:01 +0200
Subject: [R-sig-Geo] Gaussian grids in R
In-Reply-To: <4C393E60.4010304@isciences.com>
References: <4C2CA0AC.1020303@isciences.com> <4C38BA80.1020104@uni-muenster.de>
	<4C393E60.4010304@isciences.com>
Message-ID: <4C3AC70D.5050803@geo.uu.nl>

Hi Matt,

The crux here is to find the pro4 string associated with your 
projection. After finding that, you can use spTransform to reproject the 
data. However, after reprojection the T62 grid is not a grid any more. 
You already observed this, your pixelsize changes with latitude. This 
means that you have to perform some kind of interpolation, warping or 
resampling.

One option to find the proj4 string is to post a question on the proj4 
list [1]. The response on this is often quite good and fast.

Best,
Paul

[1] http://lists.maptools.org/mailman/listinfo/proj

On 07/11/2010 05:45 AM, Matthew Landis wrote:
> Edzer - I'm using the T62 grids of temperature and precip to feed a 
> model.  The other datasets in the workflow are in geographic CRS, so I 
> need to reproject the T62 data into geographic coordinates as well.
>
> Since the T62 grid is nearly regular except with small variations 
> towards the poles, my current strategy is to ignore the changes in 
> cell size and pretend the grid is actually regular with a cell size 
> corresponding to that of the lower latitudes.  I just thought it would 
> be more satisfying to be able to specify the CRS more precisely.
>
> Best,
> Matt
>
> On 7/10/2010 2:22 PM, Edzer Pebesma wrote:
>> Matt, why exactly would you want to coerce these data into a regular 
>> grid?
>>
>> On 07/01/2010 04:05 PM, Matthew Landis wrote:
>>> Dear  R-sig-geo members,
>>>
>>> I wonder if any of you have suggestions about how to import and use
>>> rasters with a spectral Gaussian T62 CRS in R.  I'm not very familiar
>>> with this coordinate system (commonly used for climate models), and I
>>> haven't been able to discover tools for dealing with them in R, either
>>> in PROJ.4 or mapproj or anywhere else, despite extensive scouring of 
>>> the
>>> web.  Details of Gaussian grids can be seen at
>>> http://en.wikipedia.org/wiki/Gaussian_grid and
>>> http://www.nco.ncep.noaa.gov/pmb/docs/on388/tableb.html#GRID98
>>>
>>> Specifically, I'm trying to use output from the NCEP CFS climate models
>>> (see http://cfs.ncep.noaa.gov/cfs/monthly/tmp2m/ -- these are in GRIB
>>> format).  A different example of a T62 grid can be downloaded in netCDF
>>> format at http://www.sage.wisc.edu/iamdata/grid.php.
>>> The goal is to transform the CRS into geographic lat/lon coordinates to
>>> be more compatible with our other datasets.  The big problem with
>>> getting these data into a SpatialGrid or SpatialPixelsDataFrame is that
>>> the latitude cells are not equally spaced - they get smaller towards 
>>> the
>>> poles.  I may be able to approximate it to a regular grid by ignoring
>>> the changes to the poles (they are rather small after all), but I'd
>>> rather do it properly if possible.
>>>
>>> Code below shows extracting latitudes from a T62 grid and plotting the
>>> changes in cell size with latitude.
>>>
>>> library('ncdf')
>>> library('sp')
>>> nc<- 'C:/scratch/cfs/pop_den_1995_T62.nc' # Downloaded  from
>>> http://www.sage.wisc.edu/iamdata/grid.php
>>>
>>> # Open the file and get latitude and longitude
>>> nc<- open.ncdf(ncfile)
>>> lat<- get.var.ncdf(nc, varid = 'latitude')
>>> lon<- get.var.ncdf(nc, varid = 'longitude')
>>> close.ncdf(nc)
>>>
>>> # Generate coordinates for each grid cell
>>> x<- rep(lon, length(lat))
>>> y<- rep(lat, each = length(lon))
>>> sp<- SpatialPoints(cbind(x,y))
>>> # temp<- SpatialPixels(points = sp) # Doesn't work.  points have to be
>>> regular grid
>>>
>>> # Show how the cell size changes with latitude
>>> cell.size<- diff(rev(lat))
>>> plot(lat[-1], cell.size)
>>>
>>> Many thanks for any suggestions!
>>>
>>> Matt
>>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770


From Roger.Bivand at nhh.no  Mon Jul 12 12:06:25 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 12 Jul 2010 12:06:25 +0200 (CEST)
Subject: [R-sig-Geo] Gaussian grids in R
In-Reply-To: <4C3AC70D.5050803@geo.uu.nl>
References: <4C2CA0AC.1020303@isciences.com> <4C38BA80.1020104@uni-muenster.de>
	<4C393E60.4010304@isciences.com> <4C3AC70D.5050803@geo.uu.nl>
Message-ID: <alpine.LRH.2.00.1007121135410.22495@reclus.nhh.no>

On Mon, 12 Jul 2010, Paul Hiemstra wrote:

> Hi Matt,
>
> The crux here is to find the pro4 string associated with your projection. 
> After finding that, you can use spTransform to reproject the data. However, 
> after reprojection the T62 grid is not a grid any more. You already observed 
> this, your pixelsize changes with latitude. This means that you have to 
> perform some kind of interpolation, warping or resampling.
>
> One option to find the proj4 string is to post a question on the proj4 list 
> [1]. The response on this is often quite good and fast.

The key thing is that these grids are not really grids, as the step in the 
y (latitude) direction varies with latitude. Their planar representation, 
see http://www.cccma.ec.gc.ca/data/grids/geom_llg_96x48.shtml for example, 
is also very misleading near the poles. They are point data in 
geographical coordinates, or very possibly polygon support data with 
near-trapezoidal form (the north and south borders are straight lines, the 
east and west borders curves), centred on the identifying point.

They are a "fudge" to get something like equal area "rectangular" cells on 
a sphere (typically displayed as squares). An alternative are 
icosahedral?hexagonal grids or spherical geodesic grids, see 
http://kiwi.atmos.colostate.edu/pubs/CISE.pdf. These are a different kind 
of "fudge", probably with superior characteristics, but less "obvious" 
than the "square"-seeming impressive sounding "Gaussian" grid. The name is 
apparently given by:

The gridpoints along the longitudes are equally spaced, while they are 
unequally  spaced along the latitudes, where they are defined by their 
Gaussian quadrature. There are no grid points at the poles.

http://en.wikipedia.org/wiki/Gaussian_grid

and is concocted by:

http://www.ncl.ucar.edu/Document/Functions/Built-in/gaus.shtml

(This is similar to the "trick" used in sp plot methods for sp objects in 
geographical coordinates, which stretches the y axis proportional to the 
distance of the central y coordinate from the Equator).

It might be useful to be able to generate the correct spatial support for 
these kinds of data, both point and polygon - summer exercise for someone? 
Then they could be interpolated into fixed grids (NCAR nomenclature).

This is a typical ontology question, where one research community gives 
priority to its prefered view of the world, here climate modellers 
prefering a representation that makes modelling easier, but isn't graceful 
either with the world as it really exists, or with the representations of 
other sciences.

Roger

>
> Best,
> Paul
>
> [1] http://lists.maptools.org/mailman/listinfo/proj
>
> On 07/11/2010 05:45 AM, Matthew Landis wrote:
>> Edzer - I'm using the T62 grids of temperature and precip to feed a model. 
>> The other datasets in the workflow are in geographic CRS, so I need to 
>> reproject the T62 data into geographic coordinates as well.
>> 
>> Since the T62 grid is nearly regular except with small variations towards 
>> the poles, my current strategy is to ignore the changes in cell size and 
>> pretend the grid is actually regular with a cell size corresponding to that 
>> of the lower latitudes.  I just thought it would be more satisfying to be 
>> able to specify the CRS more precisely.
>> 
>> Best,
>> Matt
>> 
>> On 7/10/2010 2:22 PM, Edzer Pebesma wrote:
>>> Matt, why exactly would you want to coerce these data into a regular grid?
>>> 
>>> On 07/01/2010 04:05 PM, Matthew Landis wrote:
>>>> Dear  R-sig-geo members,
>>>> 
>>>> I wonder if any of you have suggestions about how to import and use
>>>> rasters with a spectral Gaussian T62 CRS in R.  I'm not very familiar
>>>> with this coordinate system (commonly used for climate models), and I
>>>> haven't been able to discover tools for dealing with them in R, either
>>>> in PROJ.4 or mapproj or anywhere else, despite extensive scouring of the
>>>> web.  Details of Gaussian grids can be seen at
>>>> http://en.wikipedia.org/wiki/Gaussian_grid and
>>>> http://www.nco.ncep.noaa.gov/pmb/docs/on388/tableb.html#GRID98
>>>> 
>>>> Specifically, I'm trying to use output from the NCEP CFS climate models
>>>> (see http://cfs.ncep.noaa.gov/cfs/monthly/tmp2m/ -- these are in GRIB
>>>> format).  A different example of a T62 grid can be downloaded in netCDF
>>>> format at http://www.sage.wisc.edu/iamdata/grid.php.
>>>> The goal is to transform the CRS into geographic lat/lon coordinates to
>>>> be more compatible with our other datasets.  The big problem with
>>>> getting these data into a SpatialGrid or SpatialPixelsDataFrame is that
>>>> the latitude cells are not equally spaced - they get smaller towards the
>>>> poles.  I may be able to approximate it to a regular grid by ignoring
>>>> the changes to the poles (they are rather small after all), but I'd
>>>> rather do it properly if possible.
>>>> 
>>>> Code below shows extracting latitudes from a T62 grid and plotting the
>>>> changes in cell size with latitude.
>>>> 
>>>> library('ncdf')
>>>> library('sp')
>>>> nc<- 'C:/scratch/cfs/pop_den_1995_T62.nc' # Downloaded  from
>>>> http://www.sage.wisc.edu/iamdata/grid.php
>>>> 
>>>> # Open the file and get latitude and longitude
>>>> nc<- open.ncdf(ncfile)
>>>> lat<- get.var.ncdf(nc, varid = 'latitude')
>>>> lon<- get.var.ncdf(nc, varid = 'longitude')
>>>> close.ncdf(nc)
>>>> 
>>>> # Generate coordinates for each grid cell
>>>> x<- rep(lon, length(lat))
>>>> y<- rep(lat, each = length(lon))
>>>> sp<- SpatialPoints(cbind(x,y))
>>>> # temp<- SpatialPixels(points = sp) # Doesn't work.  points have to be
>>>> regular grid
>>>> 
>>>> # Show how the cell size changes with latitude
>>>> cell.size<- diff(rev(lat))
>>>> plot(lat[-1], cell.size)
>>>> 
>>>> Many thanks for any suggestions!
>>>> 
>>>> Matt
>>>> 
>>> 
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From landis at isciences.com  Mon Jul 12 14:12:34 2010
From: landis at isciences.com (Matthew Landis)
Date: Mon, 12 Jul 2010 08:12:34 -0400
Subject: [R-sig-Geo] Gaussian grids in R
In-Reply-To: <alpine.LRH.2.00.1007121135410.22495@reclus.nhh.no>
References: <4C2CA0AC.1020303@isciences.com> <4C38BA80.1020104@uni-muenster.de>
	<4C393E60.4010304@isciences.com> <4C3AC70D.5050803@geo.uu.nl>
	<alpine.LRH.2.00.1007121135410.22495@reclus.nhh.no>
Message-ID: <4C3B06B2.4080907@isciences.com>

Roger, Paul (and others off-list),

Thanks for helping to clarify my terminology.  This is what happens when 
an ecologist plays at geographer.  I will try the proj4 list as 
suggested, otherwise I will stick with the trick of simply changing the 
latitude coordinates to be on a regular grid.  Given the size of the 
changes relative to the size of the grid cells this does not seem to 
introduce much error, especially in the regions we care most about.

Matt

Roger Bivand wrote:
> On Mon, 12 Jul 2010, Paul Hiemstra wrote:
>
>> Hi Matt,
>>
>> The crux here is to find the pro4 string associated with your 
>> projection. After finding that, you can use spTransform to reproject 
>> the data. However, after reprojection the T62 grid is not a grid any 
>> more. You already observed this, your pixelsize changes with 
>> latitude. This means that you have to perform some kind of 
>> interpolation, warping or resampling.
>>
>> One option to find the proj4 string is to post a question on the 
>> proj4 list [1]. The response on this is often quite good and fast.
>
> The key thing is that these grids are not really grids, as the step in 
> the y (latitude) direction varies with latitude. Their planar 
> representation, see 
> http://www.cccma.ec.gc.ca/data/grids/geom_llg_96x48.shtml for example, 
> is also very misleading near the poles. They are point data in 
> geographical coordinates, or very possibly polygon support data with 
> near-trapezoidal form (the north and south borders are straight lines, 
> the east and west borders curves), centred on the identifying point.
>
> They are a "fudge" to get something like equal area "rectangular" 
> cells on a sphere (typically displayed as squares). An alternative are 
> icosahedral?hexagonal grids or spherical geodesic grids, see 
> http://kiwi.atmos.colostate.edu/pubs/CISE.pdf. These are a different 
> kind of "fudge", probably with superior characteristics, but less 
> "obvious" than the "square"-seeming impressive sounding "Gaussian" 
> grid. The name is apparently given by:
>
> The gridpoints along the longitudes are equally spaced, while they are 
> unequally  spaced along the latitudes, where they are defined by their 
> Gaussian quadrature. There are no grid points at the poles.
>
> http://en.wikipedia.org/wiki/Gaussian_grid
>
> and is concocted by:
>
> http://www.ncl.ucar.edu/Document/Functions/Built-in/gaus.shtml
>
> (This is similar to the "trick" used in sp plot methods for sp objects 
> in geographical coordinates, which stretches the y axis proportional 
> to the distance of the central y coordinate from the Equator).
>
> It might be useful to be able to generate the correct spatial support 
> for these kinds of data, both point and polygon - summer exercise for 
> someone? Then they could be interpolated into fixed grids (NCAR 
> nomenclature).
>
> This is a typical ontology question, where one research community 
> gives priority to its prefered view of the world, here climate 
> modellers prefering a representation that makes modelling easier, but 
> isn't graceful either with the world as it really exists, or with the 
> representations of other sciences.
>
> Roger
>
>>
>> Best,
>> Paul
>>
>> [1] http://lists.maptools.org/mailman/listinfo/proj
>>
>> On 07/11/2010 05:45 AM, Matthew Landis wrote:
>>> Edzer - I'm using the T62 grids of temperature and precip to feed a 
>>> model. The other datasets in the workflow are in geographic CRS, so 
>>> I need to reproject the T62 data into geographic coordinates as well.
>>>
>>> Since the T62 grid is nearly regular except with small variations 
>>> towards the poles, my current strategy is to ignore the changes in 
>>> cell size and pretend the grid is actually regular with a cell size 
>>> corresponding to that of the lower latitudes.  I just thought it 
>>> would be more satisfying to be able to specify the CRS more precisely.
>>>
>>> Best,
>>> Matt
>>>
>>> On 7/10/2010 2:22 PM, Edzer Pebesma wrote:
>>>> Matt, why exactly would you want to coerce these data into a 
>>>> regular grid?
>>>>
>>>> On 07/01/2010 04:05 PM, Matthew Landis wrote:
>>>>> Dear  R-sig-geo members,
>>>>>
>>>>> I wonder if any of you have suggestions about how to import and use
>>>>> rasters with a spectral Gaussian T62 CRS in R.  I'm not very familiar
>>>>> with this coordinate system (commonly used for climate models), and I
>>>>> haven't been able to discover tools for dealing with them in R, 
>>>>> either
>>>>> in PROJ.4 or mapproj or anywhere else, despite extensive scouring 
>>>>> of the
>>>>> web.  Details of Gaussian grids can be seen at
>>>>> http://en.wikipedia.org/wiki/Gaussian_grid and
>>>>> http://www.nco.ncep.noaa.gov/pmb/docs/on388/tableb.html#GRID98
>>>>>
>>>>> Specifically, I'm trying to use output from the NCEP CFS climate 
>>>>> models
>>>>> (see http://cfs.ncep.noaa.gov/cfs/monthly/tmp2m/ -- these are in GRIB
>>>>> format).  A different example of a T62 grid can be downloaded in 
>>>>> netCDF
>>>>> format at http://www.sage.wisc.edu/iamdata/grid.php.
>>>>> The goal is to transform the CRS into geographic lat/lon 
>>>>> coordinates to
>>>>> be more compatible with our other datasets.  The big problem with
>>>>> getting these data into a SpatialGrid or SpatialPixelsDataFrame is 
>>>>> that
>>>>> the latitude cells are not equally spaced - they get smaller 
>>>>> towards the
>>>>> poles.  I may be able to approximate it to a regular grid by ignoring
>>>>> the changes to the poles (they are rather small after all), but I'd
>>>>> rather do it properly if possible.
>>>>>
>>>>> Code below shows extracting latitudes from a T62 grid and plotting 
>>>>> the
>>>>> changes in cell size with latitude.
>>>>>
>>>>> library('ncdf')
>>>>> library('sp')
>>>>> nc<- 'C:/scratch/cfs/pop_den_1995_T62.nc' # Downloaded  from
>>>>> http://www.sage.wisc.edu/iamdata/grid.php
>>>>>
>>>>> # Open the file and get latitude and longitude
>>>>> nc<- open.ncdf(ncfile)
>>>>> lat<- get.var.ncdf(nc, varid = 'latitude')
>>>>> lon<- get.var.ncdf(nc, varid = 'longitude')
>>>>> close.ncdf(nc)
>>>>>
>>>>> # Generate coordinates for each grid cell
>>>>> x<- rep(lon, length(lat))
>>>>> y<- rep(lat, each = length(lon))
>>>>> sp<- SpatialPoints(cbind(x,y))
>>>>> # temp<- SpatialPixels(points = sp) # Doesn't work.  points have 
>>>>> to be
>>>>> regular grid
>>>>>
>>>>> # Show how the cell size changes with latitude
>>>>> cell.size<- diff(rev(lat))
>>>>> plot(lat[-1], cell.size)
>>>>>
>>>>> Many thanks for any suggestions!
>>>>>
>>>>> Matt
>>>>>
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>


-- 
~~~~~~~~~~~~~~~~~~~~~~~~~~
Matthew Landis, Ph.D.
Research Scientist
ISciences, LLC
61 Main St. Suite 200
Burlington VT 05401
802.864.2999
~~~~~~~~~~~~~~~~~~~~~~~~~~


From Roger.Bivand at nhh.no  Mon Jul 12 14:17:29 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 12 Jul 2010 14:17:29 +0200 (CEST)
Subject: [R-sig-Geo] write.nb.gal doesn't include correct ID
In-Reply-To: <4C3609E6.3040007@u.washington.edu>
References: <4C3609E6.3040007@u.washington.edu>
Message-ID: <alpine.LRH.2.00.1007121410290.22495@reclus.nhh.no>

On Thu, 8 Jul 2010, Chris Fowler wrote:

> I am trying to write a rather large neighborhood list to a .gal file using 
> the following code
> write.nb.gal(Q1.nb, "Map 
> Data/subWeights.gal",oldstyle=FALSE,shpfile="submap.shp",ind="ind")
>
> where ind is an array of numbers representing FIPS codes at the census tract 
> level (I also tried it using "STFID" which is the same data as a column in 
> the shapefile submap.shp) while I don't get any errors, my .gal file uses the 
> sequential id number from the shapefile (a meaningless 1 to n number assigned 
> by ArcGIS in the creation of the shapefile). I have tried (in ArcGIS) 
> converting the number assigned by ArcGIS to my FIPS codes using Field 
> Calculator, but this doesn't seem to change anything. My concern is that the 
> problem is perhaps the length of the FIPS codes which are 10 or 11 digits 
> each?
>
> Is there something that I am missing that will allow me to use the more 
> meaningful FIPS codes in the gal file?


You must include more of your workflow. I suspect that the correct values 
are not being set when the "nb" object is created (synax and argument 
names may vary between functions). Please also explain which other 
software you are using - ArcGIS is by no means available to everybody, I 
for example have no access to this product.

Work from a canned example, such as:

library(spdep)
example(nc.sids)
nbs <- poly2nb(nc.sids, row.names=nc.sids$CNTY_ID)
writeSpatialShape(nc.sids, "nc_sids.shp")
write.nb.gal(nbs, "nc_sids.gal", oldstyle=FALSE, shpfile="nc_sids.shp",
   ind="CNTY_ID")

and explain again what the problem is. By the way, Arc typically assigns a 
FID which is 0-based, the 1-based indices are the default in functions 
making "nb" objects when no alternative is given, so your analysis is more 
likely guessing than actually what is happening. Note that you may also 
run into problems with apparently numeric identifiers (like some FIPS) 
that begin with "0", you'll have to feel your way there.

Hope this helps,

Roger

>
> Thanks,
>
> Chris Fowler
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Jul 12 14:25:40 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 12 Jul 2010 14:25:40 +0200 (CEST)
Subject: [R-sig-Geo] write.nb.gal doesn't include correct ID
In-Reply-To: <alpine.LRH.2.00.1007121410290.22495@reclus.nhh.no>
References: <4C3609E6.3040007@u.washington.edu>
	<alpine.LRH.2.00.1007121410290.22495@reclus.nhh.no>
Message-ID: <alpine.LRH.2.00.1007121423140.22495@reclus.nhh.no>

On Mon, 12 Jul 2010, Roger Bivand wrote:

> On Thu, 8 Jul 2010, Chris Fowler wrote:
>
>> I am trying to write a rather large neighborhood list to a .gal file using 
>> the following code
>> write.nb.gal(Q1.nb, "Map 
>> Data/subWeights.gal",oldstyle=FALSE,shpfile="submap.shp",ind="ind")
>> 
>> where ind is an array of numbers representing FIPS codes at the census 
>> tract level (I also tried it using "STFID" which is the same data as a 
>> column in the shapefile submap.shp) while I don't get any errors, my .gal 
>> file uses the sequential id number from the shapefile (a meaningless 1 to n 
>> number assigned by ArcGIS in the creation of the shapefile). I have tried 
>> (in ArcGIS) converting the number assigned by ArcGIS to my FIPS codes using 
>> Field Calculator, but this doesn't seem to change anything. My concern is 
>> that the problem is perhaps the length of the FIPS codes which are 10 or 11 
>> digits each?
>> 
>> Is there something that I am missing that will allow me to use the more 
>> meaningful FIPS codes in the gal file?
>
>
> You must include more of your workflow. I suspect that the correct values are 
> not being set when the "nb" object is created (synax and argument names may 
> vary between functions). Please also explain which other software you are 
> using - ArcGIS is by no means available to everybody, I for example have no 
> access to this product.
>
> Work from a canned example, such as:
>
> library(spdep)
> example(nc.sids)
> nbs <- poly2nb(nc.sids, row.names=nc.sids$CNTY_ID)
> writeSpatialShape(nc.sids, "nc_sids.shp")
> write.nb.gal(nbs, "nc_sids.gal", oldstyle=FALSE, shpfile="nc_sids.shp",
>  ind="CNTY_ID")

By the way, these files read correctly in OpenGeoDa (here 0.9.8.14, 
Windows binary version running under Wine on Linux).

Roger

>
> and explain again what the problem is. By the way, Arc typically assigns a 
> FID which is 0-based, the 1-based indices are the default in functions making 
> "nb" objects when no alternative is given, so your analysis is more likely 
> guessing than actually what is happening. Note that you may also run into 
> problems with apparently numeric identifiers (like some FIPS) that begin with 
> "0", you'll have to feel your way there.
>
> Hope this helps,
>
> Roger
>
>> 
>> Thanks,
>> 
>> Chris Fowler
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From ageel_bushara at yahoo.com  Tue Jul 13 04:32:26 2010
From: ageel_bushara at yahoo.com (Ageel Ibrahim Bushara)
Date: Mon, 12 Jul 2010 19:32:26 -0700 (PDT)
Subject: [R-sig-Geo] Plotting short time series
Message-ID: <666545.94204.qm@web35807.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100712/b16a2b63/attachment.pl>

From vetter at pik-potsdam.de  Tue Jul 13 09:43:37 2010
From: vetter at pik-potsdam.de (Tobias Vetter)
Date: Tue, 13 Jul 2010 09:43:37 +0200
Subject: [R-sig-Geo] Plotting short time series
In-Reply-To: <666545.94204.qm@web35807.mail.mud.yahoo.com>
References: <666545.94204.qm@web35807.mail.mud.yahoo.com>
Message-ID: <4C3C1929.3060105@pik-potsdam.de>

Look
?axis.POSIXct
Greetings Tobias
> Dear all,
>  I 'm plotting flow time series, my time series is very short, and the length of 
> the time series is less than a week. When I plot it, it shows the x-axis in days 
> [Wed  thu fri sat sun mon   Tue], and I want it to show the x-axis in months. 
> For example one of my data file starts on May 7, 2007 at 8:00 am and ends on May 
> 12, 2007 at 23:45, the data time-step is 15 minutes. BTW, when I increase the 
> length of the time series to seven days or more, it shows the x-axis in months 
> .Even I have similar time series of 3-days length, and I want it to shows in 
> months . Here is the code:
> storm_measured <- read.csv ("storm_1_measured.csv")
> ts_measured<-as.POSIXct(strptime(storm_measured[,1],format="%d-%m-%y %H:%M"))
> plot(ts_measured, storm_measured[,2],ylab="Discharge [m^3/s]",type ="p")
>  
> What can I do to have x-axis shown in months instead of days [Wed through Tue], 
> or is there is a better way to do it?
>  
> Thanks,
> Ageel
>
>
>       
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Tue Jul 13 15:06:44 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 13 Jul 2010 15:06:44 +0200
Subject: [R-sig-Geo] spautolm
Message-ID: <4C3C64E4.4030403@uni-muenster.de>

spautolm gives me the following warning (from Matrix):

> sres1=spautolm(formula = <omitted>, listw=colw, family = "SAR", method
= "Matrix")
Warning message:
In determinant(x, TRUE) : This version of the Matrix package returns
|determinant(L)| instead of determinant(A), i.e., a
*DIFFERENT* value.
 If still necessary, do change your code, following
http://matrix.r-forge.r-project.org

Is this something I should worry about?
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Tue Jul 13 16:33:36 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 13 Jul 2010 16:33:36 +0200 (CEST)
Subject: [R-sig-Geo] spautolm
In-Reply-To: <4C3C64E4.4030403@uni-muenster.de>
References: <4C3C64E4.4030403@uni-muenster.de>
Message-ID: <alpine.LRH.2.00.1007131626250.29571@reclus.nhh.no>

On Tue, 13 Jul 2010, Edzer Pebesma wrote:

> spautolm gives me the following warning (from Matrix):
>
>> sres1=spautolm(formula = <omitted>, listw=colw, family = "SAR", method
> = "Matrix")
> Warning message:
> In determinant(x, TRUE) : This version of the Matrix package returns
> |determinant(L)| instead of determinant(A), i.e., a
> *DIFFERENT* value.
> If still necessary, do change your code, following
> http://matrix.r-forge.r-project.org
>
> Is this something I should worry about?
>

No, if you check with a different sparse method, say "LU" or "spam", 
you'll get the same result as with "Matrix". The log determinant code was 
changed before the change was made in Matrix, conditioning on the version 
of Matrix being used, at and following line 269 in:

https://r-forge.r-project.org/scm/viewvc.php/pkg/R/jacobian.R?annotate=282&root=spdep

The warning is still issued once per session by Matrix in case some 
developer hasn't noticed.

Hope this helps,

Roger

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From p.veneri at univpm.it  Tue Jul 13 18:14:09 2010
From: p.veneri at univpm.it (Paolo Veneri)
Date: Tue, 13 Jul 2010 18:14:09 +0200
Subject: [R-sig-Geo] How to estimate a SDM with IV method?
Message-ID: <04f1166316e24558f4052f44e5db2eaa.squirrel@mta01.univpm.it>


Hi,

I have a cross section of 158 spatial units. Robust LM tests suggest me to
estimate a Spatial Durbin Model (SDM). However, given the non-normality of
OLS residuals, the presence of
heteroschedasticity and the presence of one endogenous explanatory
variable, I should not use the classic "lagsarlm" function, since I should
not use ML methods.
The point is that I did not find any package in R that estimate a SDM with
IV method (hence correcting for endogeneity and heteroschedasticity).

Would you suggest any strategy?

Paolo


From Roger.Bivand at nhh.no  Tue Jul 13 21:33:45 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 13 Jul 2010 21:33:45 +0200 (CEST)
Subject: [R-sig-Geo] How to estimate a SDM with IV method?
In-Reply-To: <04f1166316e24558f4052f44e5db2eaa.squirrel@mta01.univpm.it>
References: <04f1166316e24558f4052f44e5db2eaa.squirrel@mta01.univpm.it>
Message-ID: <alpine.LRH.2.00.1007132132280.3901@reclus.nhh.no>

On Tue, 13 Jul 2010, Paolo Veneri wrote:

>
> Hi,
>
> I have a cross section of 158 spatial units. Robust LM tests suggest me to
> estimate a Spatial Durbin Model (SDM). However, given the non-normality of
> OLS residuals, the presence of
> heteroschedasticity and the presence of one endogenous explanatory
> variable, I should not use the classic "lagsarlm" function, since I should
> not use ML methods.
> The point is that I did not find any package in R that estimate a SDM with
> IV method (hence correcting for endogeneity and heteroschedasticity).
>
> Would you suggest any strategy?


You are quite correct that the structuring of the stsls (and equivalent 
heteroskedastic version in the sphet package) makes it effectively 
impossible to fit a Spatial Durbin model. Even if one tries (using higher 
lags by hand), the results are typically numerically unstable. So you are 
left with ML - I would not worry about the distribution of the residual 
too much, but analysis of outliers from the influence measures of the 
linear fit might suggest a missing variable, or possibly a dummy that 
could releive som heteroskedasticity. You could check this out on the 
linear model first, and then use ML to fit the improved SDM model.

The only SDM with heteroskedastic errors that I know of is the Bayesian 
approach in the Matlab toolbox, documented in LeSage and Pace (2009). As 
I'm sure you know, you need to take the impacts of the RHS variables into 
account, rather than interpreting the SDM coefficients - this is provided 
for in impacts() methods in spdep for the SDM model.

Hope this helps,

Roger


>
> Paolo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From tylerdeanrudolph at gmail.com  Tue Jul 13 23:23:40 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Tue, 13 Jul 2010 17:23:40 -0400
Subject: [R-sig-Geo] potential BUG in BBMM
Message-ID: <AANLkTilXuL68E_9pvN9QwHjjm_F_hIRlTX4fmZmQN4Ts@mail.gmail.com>

     I've been constructing utilization distributions for 63 animal movement
trajectories using a Brownian bridge movement model with BBMM.  I started
noticing after running the routine numerous times at different resolutions
that certain UDs would be grossly wrong, meaning instead of returning a
strongly negative exponential distribution of probabilities (UD$probability)
that sums to 1, there might be two big modes in opposite places, or negative
probability values, or simply "NaN" across the board.  I have found this
problem on Mac, Linux, and Windows machines in various versions of R
(including the most recent), and I was hoping someone in the R community
would be able to verify this and perhaps speculate on why this is occurring.


The problem appears to originate either 1) in the FORTRAN code that
estimates BMVar and calculates the BBMM, or 2) in the way R handles its
operation.  I've broken down BBMM into its essential parts, and in the
attached environment are all of the objects necessary to run the FORTRAN
code.  I have set it up in a loop here so it continually estimates a UD on
the same data then and produces a histogram, which I have found to be most
revealing in identifying problems.  If the code stops running it's because
the result was all "NaN".  If you run the loop repeatedly you may find, as I
have, that while the results may initially appear more-or-less consistent,
at other moments they will change, sometimes gradually, and sometimes
quickly.  If you are looking at it and it is not changing, I encourage you
to remove all objects, close and reopen R, reload the workspace and run the
same loop again.  If you do this numerous times you should eventually see
unusual results, meaning inconsistent estimation, or wacky probability
distributions, or "NaN".


################################################################################

##  Run the Fortran routine repeatedly with identical data
##  - all required objects are in workspace "BBMM_BUG.RData" -

require(BBMM)

par(mfrow=c(2,2))


repeat {
        ans <- .Fortran("BBMM", as.integer(n.locs), as.integer(grid.size),
        as.double(time.lag), as.double(T.Total), as.double(x),
        as.double(y), as.double(BMvar), as.double(location.error),
        as.double(area.grid$x), as.double(area.grid$y),
as.double(time.step),
        as.double(probability), PACKAGE = "BBMM")

    if(!sum(ans[[12]])=="NaN") { hist(ans[[12]]) } else { break }
}
#################################################################################



Tyler
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100713/25434b80/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BBMM_BUG.RData
Type: application/octet-stream
Size: 2896 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100713/25434b80/attachment.obj>

From Roger.Bivand at nhh.no  Wed Jul 14 11:33:07 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 14 Jul 2010 11:33:07 +0200 (CEST)
Subject: [R-sig-Geo] potential BUG in BBMM
In-Reply-To: <AANLkTilXuL68E_9pvN9QwHjjm_F_hIRlTX4fmZmQN4Ts@mail.gmail.com>
References: <AANLkTilXuL68E_9pvN9QwHjjm_F_hIRlTX4fmZmQN4Ts@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007141131560.8192@reclus.nhh.no>

On Tue, 13 Jul 2010, Tyler Dean Rudolph wrote:

>     I've been constructing utilization distributions for 63 animal movement
> trajectories using a Brownian bridge movement model with BBMM.  I started
> noticing after running the routine numerous times at different resolutions
> that certain UDs would be grossly wrong, meaning instead of returning a
> strongly negative exponential distribution of probabilities (UD$probability)
> that sums to 1, there might be two big modes in opposite places, or negative
> probability values, or simply "NaN" across the board.  I have found this
> problem on Mac, Linux, and Windows machines in various versions of R
> (including the most recent), and I was hoping someone in the R community
> would be able to verify this and perhaps speculate on why this is occurring.
>

Have you also contacted the package authors directly? They would be the 
best point of entry here, I think.

Roger

>
> The problem appears to originate either 1) in the FORTRAN code that
> estimates BMVar and calculates the BBMM, or 2) in the way R handles its
> operation.  I've broken down BBMM into its essential parts, and in the
> attached environment are all of the objects necessary to run the FORTRAN
> code.  I have set it up in a loop here so it continually estimates a UD on
> the same data then and produces a histogram, which I have found to be most
> revealing in identifying problems.  If the code stops running it's because
> the result was all "NaN".  If you run the loop repeatedly you may find, as I
> have, that while the results may initially appear more-or-less consistent,
> at other moments they will change, sometimes gradually, and sometimes
> quickly.  If you are looking at it and it is not changing, I encourage you
> to remove all objects, close and reopen R, reload the workspace and run the
> same loop again.  If you do this numerous times you should eventually see
> unusual results, meaning inconsistent estimation, or wacky probability
> distributions, or "NaN".
>
>
> ################################################################################
>
> ##  Run the Fortran routine repeatedly with identical data
> ##  - all required objects are in workspace "BBMM_BUG.RData" -
>
> require(BBMM)
>
> par(mfrow=c(2,2))
>
>
> repeat {
>        ans <- .Fortran("BBMM", as.integer(n.locs), as.integer(grid.size),
>        as.double(time.lag), as.double(T.Total), as.double(x),
>        as.double(y), as.double(BMvar), as.double(location.error),
>        as.double(area.grid$x), as.double(area.grid$y),
> as.double(time.step),
>        as.double(probability), PACKAGE = "BBMM")
>
>    if(!sum(ans[[12]])=="NaN") { hist(ans[[12]]) } else { break }
> }
> #################################################################################
>
>
>
> Tyler
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From prairie.picker at gmail.com  Wed Jul 14 17:15:42 2010
From: prairie.picker at gmail.com (Tyler Dean Rudolph)
Date: Wed, 14 Jul 2010 11:15:42 -0400
Subject: [R-sig-Geo] potential BUG in BBMM
In-Reply-To: <alpine.LRH.2.00.1007141131560.8192@reclus.nhh.no>
References: <AANLkTilXuL68E_9pvN9QwHjjm_F_hIRlTX4fmZmQN4Ts@mail.gmail.com>
	<alpine.LRH.2.00.1007141131560.8192@reclus.nhh.no>
Message-ID: <40EDE204-9BE1-4245-972B-3B384290DB54@gmail.com>

In fact I have been in fairly regular communication with Ryan Nielson  
about this, but I don't get the impression he has a lot of time to  
devote to resolving it. So far I have managed to circumvent all the  
potential problems he has suggested, and I have narrowed it down to  
this Fortran loop.  Now he seems of the mind that it is a problem with  
R - which I suppose is possible? - but whether it is the Fortran code,  
R, or something else I don't believe I have the tools to assess the  
problem any further.  I am certainly not imagining the problem, as  
I've mentioned, but if somebody more knowledgeable could at least  
reproduce it we might be somewhere closer to a solution.  In the  
meantime I have suggested that BBMM be used with caution, especially  
in big loops with large data sets, but Ryan hasn't commented on this,  
and at any rate I wouldn't mind getting a third or fourth opinion.

Tyler


On 2010-07-14, at 5:33, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Tue, 13 Jul 2010, Tyler Dean Rudolph wrote:
>
>>    I've been constructing utilization distributions for 63 animal  
>> movement
>> trajectories using a Brownian bridge movement model with BBMM.  I  
>> started
>> noticing after running the routine numerous times at different  
>> resolutions
>> that certain UDs would be grossly wrong, meaning instead of  
>> returning a
>> strongly negative exponential distribution of probabilities (UD 
>> $probability)
>> that sums to 1, there might be two big modes in opposite places, or  
>> negative
>> probability values, or simply "NaN" across the board.  I have found  
>> this
>> problem on Mac, Linux, and Windows machines in various versions of R
>> (including the most recent), and I was hoping someone in the R  
>> community
>> would be able to verify this and perhaps speculate on why this is  
>> occurring.
>>
>
> Have you also contacted the package authors directly? They would be  
> the best point of entry here, I think.
>
> Roger
>
>>
>> The problem appears to originate either 1) in the FORTRAN code that
>> estimates BMVar and calculates the BBMM, or 2) in the way R handles  
>> its
>> operation.  I've broken down BBMM into its essential parts, and in  
>> the
>> attached environment are all of the objects necessary to run the  
>> FORTRAN
>> code.  I have set it up in a loop here so it continually estimates  
>> a UD on
>> the same data then and produces a histogram, which I have found to  
>> be most
>> revealing in identifying problems.  If the code stops running it's  
>> because
>> the result was all "NaN".  If you run the loop repeatedly you may  
>> find, as I
>> have, that while the results may initially appear more-or-less  
>> consistent,
>> at other moments they will change, sometimes gradually, and sometimes
>> quickly.  If you are looking at it and it is not changing, I  
>> encourage you
>> to remove all objects, close and reopen R, reload the workspace and  
>> run the
>> same loop again.  If you do this numerous times you should  
>> eventually see
>> unusual results, meaning inconsistent estimation, or wacky  
>> probability
>> distributions, or "NaN".
>>
>>
>> ### 
>> ### 
>> ### 
>> ### 
>> ####################################################################
>>
>> ##  Run the Fortran routine repeatedly with identical data
>> ##  - all required objects are in workspace "BBMM_BUG.RData" -
>>
>> require(BBMM)
>>
>> par(mfrow=c(2,2))
>>
>>
>> repeat {
>>       ans <- .Fortran("BBMM", as.integer(n.locs), as.integer 
>> (grid.size),
>>       as.double(time.lag), as.double(T.Total), as.double(x),
>>       as.double(y), as.double(BMvar), as.double(location.error),
>>       as.double(area.grid$x), as.double(area.grid$y),
>> as.double(time.step),
>>       as.double(probability), PACKAGE = "BBMM")
>>
>>   if(!sum(ans[[12]])=="NaN") { hist(ans[[12]]) } else { break }
>> }
>> ### 
>> ### 
>> ### 
>> ### 
>> #####################################################################
>>
>>
>>
>> Tyler
>>
>
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian  
> School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From wgolet at gmri.org  Wed Jul 14 19:42:51 2010
From: wgolet at gmri.org (Walt Golet)
Date: Wed, 14 Jul 2010 13:42:51 -0400
Subject: [R-sig-Geo] display projected NetCDF files
Message-ID: <CF2DCCF10E8EE04BBF67CC4F47CCF4B1029C205C@lobstah.neptune.org>

Hello,
A new list member here with a question regarding the display of projected NetCDF files in R.  The initial grids (dimension 349 x 277) cover all of North America with the following borders:
12.2N;133.5W, 54.5N; 152.9W, 57.3N; 49.4W ,14.3N;65.1W in the Lambert Conformal Conic Grid.  I extracted a smaller grid (our area of interest) which becomes a 64 x 51 matrix for air temperature, longitude and latitude with new borders (40.614, -84.052)  (54.263, -76.513) (44.268,-52.644) (32.869,-63.768).  

#####Reading, extracting and sub setting the grid 
library(ncdf) 
  AIR1=open.ncdf("air.mon.mean.nc",write=FALSE,readunlim=TRUE)
      print(AIR1)
        AIR2=AIR1$var[[2]]
            AIR=get.var.ncdf(AIR1,AIR2,start=c(1,1,13,1),count=c(349,277,1,372))    
                   AIR_JAN_1979=AIR[234:297,120:170,1]  
                      AIR2LAT=AIR1$var[[3]]
                        AIR_LAT_19791=get.var.ncdf(AIR1,AIR2LAT,start=c(1,1),count=c(349,277))
                          AIR_LAT_1979=AIR_LAT_19791[234:297,120:170]
                      AIR2LONG=AIR1$var[[4]]
                 AIR_LONG_19791=get.var.ncdf(AIR1,AIR2LONG,start=c(1,1),count=c(349,277))
            AIR_LONG_1979=AIR_LONG_19791[234:297,120:170]  

#######file information on projection and orientation of grid 
int Lambert_Conformal[] "
           grid_mapping_name: lambert_conformal_conic"
          standard_parallel: 50" "            standard_parallel: 50"
           longitude_of_central_meridian: -107"
           latitude_of_projection_origin: 50"
           false_easting: 5632642.22547"
           false_northing: 4612545.65137"
 y  Size:277" #### Original size of grid, extracted one is only 64 x 51
          long_name: northward distance from southwest corner of domain in projection coordinates"
            units: m"
            standard_name: projection_y_coordinate"
       x  Size:349"
            long_name: eastward distance from southwest corner of domain in projection coordinates"
           units: m"
            standard_name: projection_x_coordinate"
        nbnds  Size:2"


simple plots such as filled.contour will plot the results, but are not projected properly.
I imagine there is a method within rgdal{spTransform} to correctly display this data in its projected format or perhaps transform these positions, but it eludes me at this time.  Somewhat similar questions have appeared online, but the answers I have found do not give correct projections.  Any help with this would be appreciated.  Thanks in advance for what may be a simple transformation,

Walt   


From alobolistas at gmail.com  Wed Jul 14 20:46:25 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 14 Jul 2010 20:46:25 +0200
Subject: [R-sig-Geo] Bug in rasterToPoints() ?
Message-ID: <AANLkTikVfLb8Wc52Ds7YBI2tgkNRUf1X4WvAWspfq_f2@mail.gmail.com>

Hi!
I'm trying:
> Br025SpPoints <- rasterToPoints(Br025,fun=function(x){x>0},asSpatialPoints=T)
Error in projection(x, asText = FALSE) : cannot use this x of class NULL
Calls: rasterToPoints ... SpatialPoints -> new -> initialize ->
initialize -> projection

> projection(Br025)
[1] "+proj=longlat +ellps=WGS84"

> class(Br025)
[1] "RasterLayer"
attr(,"package")
[1] "raster"

> summary(Br025)
Cells:  18000
NAs  :  0

Min.       0.00
1st Qu.    0.00
Median     0.00
Mean      25.47
3rd Qu.    0.00
Max.    3638.00

The same works (albeit extremely slowly because of its size) for a
projected raster:
> summary(Br)
Cells:  13967442
NAs  :  0


Min.       0.00
1st Qu.    0.00
Median     0.00
Mean      48.82
3rd Qu.    0.00
Max.    4999.00

> class(Br)
[1] "RasterLayer"
attr(,"package")
[1] "raster"

> projection(Br)
[1] "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
+ellps=GRS80 +units=m +no_defs"

Maybe longlat is not contemplated by rasterToPoints() ?

Thanks!

Agus


From jacobvanetten at yahoo.com  Wed Jul 14 22:27:17 2010
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Wed, 14 Jul 2010 20:27:17 +0000 (GMT)
Subject: [R-sig-Geo] Bug in rasterToPoints() ?
In-Reply-To: <AANLkTikVfLb8Wc52Ds7YBI2tgkNRUf1X4WvAWspfq_f2@mail.gmail.com>
Message-ID: <625212.38870.qm@web23707.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100714/1ce1b26d/attachment.pl>

From hilton at meteo.psu.edu  Thu Jul 15 01:24:55 2010
From: hilton at meteo.psu.edu (Timothy W. Hilton)
Date: Wed, 14 Jul 2010 16:24:55 -0700
Subject: [R-sig-Geo] maximum likelihood variogram parameter estimation,
 non-Euclidian distances
Message-ID: <20100714232455.GA4021@DN0a206908.SUNet>

Hello R-sig-Geo list,

I want to calculate maximum likelihood estimations for variogram
parameters (sill, range).  My data locations span North America, thus I
believe that UTM coordinates (or any other projection) will distort
distances between sites too much for me to use Euclidian coordinates.

As far as I can tell, geoR will not accept non-Euclidian coordinates or
allow the user to specify a distance function.  gstat accepts latitude
and longitude to define locations, but does not include maximum
likelihood estimation for the range (fit.variogram.reml estimates sill
only).

Is anyone aware of an R geostats package that handles my situation?

Many thanks!
Tim

--

Timothy W. Hilton
PhD Candidate, Department of Meteorology
The Pennsylvania State University
503 Walker Building, University Park, PA   16802
hilton at meteo.psu.edu


From snanand at msn.com  Thu Jul 15 07:45:20 2010
From: snanand at msn.com (Sathyanarayan Anand)
Date: Thu, 15 Jul 2010 05:45:20 +0000
Subject: [R-sig-Geo] openbugs on linux
Message-ID: <BAY123-W37D57F9468E25DCB2C99F3BCBB0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100715/12ea5ce9/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Jul 15 09:43:45 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 15 Jul 2010 09:43:45 +0200
Subject: [R-sig-Geo] maximum likelihood variogram parameter estimation,
 non-Euclidian distances
In-Reply-To: <20100714232455.GA4021@DN0a206908.SUNet>
References: <20100714232455.GA4021@DN0a206908.SUNet>
Message-ID: <4C3EBC31.7040602@uni-muenster.de>



On 07/15/2010 01:24 AM, Timothy W. Hilton wrote:
> Hello R-sig-Geo list,
> 
> I want to calculate maximum likelihood estimations for variogram
> parameters (sill, range).  My data locations span North America, thus I
> believe that UTM coordinates (or any other projection) will distort
> distances between sites too much for me to use Euclidian coordinates.
> 
> As far as I can tell, geoR will not accept non-Euclidian coordinates or
> allow the user to specify a distance function.  gstat accepts latitude
> and longitude to define locations, but does not include maximum
> likelihood estimation for the range (fit.variogram.reml estimates sill
> only).

True, but you could write your own brute-force loop around it, or
optimize() around it, trying range values and selecting the one with the
maximum likelihood, or write out the likelihood directly and use optim.

Another problem you might be facing is that not all of the usual
variogram models are suitable (in the sense of positive definite) for
spherical distance measures. I'm still searching for a good reference on
this issue.

> Is anyone aware of an R geostats package that handles my situation?
> 
> Many thanks!
> Tim
> 
> --
> 
> Timothy W. Hilton
> PhD Candidate, Department of Meteorology
> The Pennsylvania State University
> 503 Walker Building, University Park, PA   16802
> hilton at meteo.psu.edu
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From famuvie at alumni.uv.es  Thu Jul 15 10:38:49 2010
From: famuvie at alumni.uv.es (=?windows-1252?Q?Facundo_Mu=F1oz?=)
Date: Thu, 15 Jul 2010 10:38:49 +0200
Subject: [R-sig-Geo] maximum likelihood variogram parameter estimation,
 non-Euclidian distances
In-Reply-To: <20100714232455.GA4021@DN0a206908.SUNet>
References: <20100714232455.GA4021@DN0a206908.SUNet>
Message-ID: <4C3EC919.4060702@alumni.uv.es>

  Hi Tim,
I have been in a similar situation, and modified some functions in geoR 
in order to fit variograms, and perform kriging with non-Euclidean 
distances. In particular, you can use likfit() and get 
maximum-likelihood estimates for variogram models with non-Euclidean 
distances.
You can get the modified package (source) from 
http://www.geeitema.org/doc/guenmap//docs/modif.geoR.1.6-27.tar.gz.

Please note that this modifications do not perform positive-definiteness 
checking.
You should do that manually.
That is something I should implement.

Please let me know if you try it, and if you need any help.
?acu.-


On 15/07/10 01:24, Timothy W. Hilton wrote:
> Hello R-sig-Geo list,
>
> I want to calculate maximum likelihood estimations for variogram
> parameters (sill, range).  My data locations span North America, thus I
> believe that UTM coordinates (or any other projection) will distort
> distances between sites too much for me to use Euclidian coordinates.
>
> As far as I can tell, geoR will not accept non-Euclidian coordinates or
> allow the user to specify a distance function.  gstat accepts latitude
> and longitude to define locations, but does not include maximum
> likelihood estimation for the range (fit.variogram.reml estimates sill
> only).
>
> Is anyone aware of an R geostats package that handles my situation?
>
> Many thanks!
> Tim
>
> --
>
> Timothy W. Hilton
> PhD Candidate, Department of Meteorology
> The Pennsylvania State University
> 503 Walker Building, University Park, PA   16802
> hilton at meteo.psu.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From famuvie at alumni.uv.es  Thu Jul 15 11:34:33 2010
From: famuvie at alumni.uv.es (=?windows-1252?Q?Facundo_Mu=F1oz?=)
Date: Thu, 15 Jul 2010 11:34:33 +0200
Subject: [R-sig-Geo] openbugs on linux
In-Reply-To: <BAY123-W37D57F9468E25DCB2C99F3BCBB0@phx.gbl>
References: <BAY123-W37D57F9468E25DCB2C99F3BCBB0@phx.gbl>
Message-ID: <4C3ED629.7010803@alumni.uv.es>

  Hi, please check this code.
Is a comparison between INLA and OpenBUGS/BRugs, using a quite simple model.
(INLA -Integrated Nested Laplace Approximation- performs Bayesian 
inference without using MCMC)
The dataset of the example is included in the INLA package, so you 
should get it from http://www.r-inla.org/.

Hope it helps.
?acu.-

PD: Sorry about the comments in spanish.

library(BRugs)
library(INLA)

data(Epil) # datos en formato adecuado para inla, provenientes del 
paquete INLA
Epil.inla <- Epil
load(file="Epil.RData") # mismos datos en formato adecuado para bugs, 
sacados del WinBUGS
attach(Epil)

# BUGS

epil.model <- function()
{
for(j in 1:N)
{
for(k in 1:T)
{
y[j,k] ~ dpois(mu[j,k])
log(mu[j,k]) <- a0 + a.Base * (l.Base4[j]-bar.l.Base4)
+ a.Trt * (Trt[j]-bar.Trt)
+ a.BT * (BT[j]-bar.BT)
+ a.Age * (l.Age[j]-bar.l.Age)
+ a.V4 * (V4[k]-bar.V4)
+ b1[j] + b[j,k]
b[j,k] ~ dnorm(0.0, tau.b) # Efecto aleatorio individuo*visita
}
b1[j] ~ dnorm(0.0, tau.b1) # Efecto aleatorio del individuo
BT[j] <- Trt[j] * l.Base4[j] # Interacci?n
l.Base4[j] <- log(Base[j]/4)
l.Age[j] <- log(Age[j])
}
# Medias de covariables
bar.l.Base4 <- mean(l.Base4[])
bar.Trt <- mean(Trt[])
bar.BT <- mean(BT[])
bar.l.Age <- mean(l.Age[])
bar.V4 <- mean(V4[])

# Previas
a0 ~ dnorm(0.0, 1.0E-4)
a.Base ~ dnorm(0.0, 1.0E-4)
a.Trt ~ dnorm(0.0, 1.0E-4)
a.BT ~ dnorm(0.0, 1.0E-4)
a.Age ~ dnorm(0.0, 1.0E-4)
a.V4 ~ dnorm(0.0, 1.0E-4)
# sigma.b1~ dunif(0, 100)
# sigma.b ~ dunif(0, 100)
# tau.b1 <- 1.0/(sigma.b1*sigma.b1)
# tau.b <- 1.0/(sigma.b*sigma.b)
tau.b1 ~ dgamma(1.0E-3,1.0E-3); sigma.b1 <- 1.0 / sqrt(tau.b1)
tau.b ~ dgamma(1.0E-3,1.0E-3); sigma.b <- 1.0/ sqrt(tau.b)

# recalcular la interceptaci?n en la escala original
alpha0 <- a0 - a.Base*bar.l.Base4 - a.Trt*bar.Trt - a.BT*bar.BT - 
a.Age*bar.l.Age - a.V4*bar.V4
}


epil.data <- Epil # lista con N, T y los valores de todas las variables. 
La variable respuesta es bidimensional NxT.

epil.ini <- list(
list(a0 = 1, a.Base = 0, a.Trt = 0, a.BT = 0, a.Age = 0, a.V4 = 0, 
sigma.b1 = 1, sigma.b = 1, b1=rep(0,N), b=matrix(0,N,T)),
list(a0 = 0, a.Base = 1, a.Trt = 1, a.BT = 1, a.Age = 1, a.V4 = 1, 
sigma.b1 =10, sigma.b =10, b1=rep(1,N), b=matrix(1,N,T)),
list(a0 =-1, a.Base = 1, a.Trt =-1, a.BT = 1, a.Age =-1, a.V4 = 1, 
sigma.b1 =10, sigma.b = 1, b1=rep(-1,N),b=matrix(1,N,T)))

# para previas gamma sobre la precisi?n
epil.ini <- list(
list(a0 = 1, a.Base = 0, a.Trt = 0, a.BT = 0, a.Age = 0, a.V4 = 0, 
tau.b1 = 1, tau.b = 1, b1=rep(0,N), b=matrix(0,N,T)),
list(a0 = 0, a.Base = 1, a.Trt = 1, a.BT = 1, a.Age = 1, a.V4 = 1, 
tau.b1 =10, tau.b =10, b1=rep(1,N), b=matrix(1,N,T)),
list(a0 =-1, a.Base = 1, a.Trt =-1, a.BT = 1, a.Age =-1, a.V4 = 1, 
tau.b1 =10, tau.b = 1, b1=rep(-1,N),b=matrix(1,N,T)))


writeModel(epil.model, file.path(tempdir(), "epilmodel.txt"))
bugsData(epil.data, file.path(tempdir(), "epildata.txt"))
inifiles <- paste(file.path(tempdir(), "epilini"),1:3,".txt", sep="")
bugsInits(epil.ini, numChains = length(epil.ini), fileName=inifiles)

# Par?metros de inter?s
pts=c("alpha0", "a.Base", "a.Trt", "a.BT", "a.Age", "a.V4", "sigma.b1", 
"sigma.b")

# Inicializaciones
nburn = 5000 # etapa de quemado para llegar a convergencia en la cadena 
MCMC
nsim = 10000 # tama?o de la cadena MCMC buena

# Simulaci?n
fit<-BRugsFit("epilmodel.txt",data="epildata.txt",inits=inifiles, 
,numChains = length(epil.ini), parametersToSave=pts,nBurnin = nburn, 
nIter = nsim, working.directory=tempdir())

# Timing
# 5000 updates took 79 s (1'19'')
# 10000 updates took 173 s (2'53'')

save(fit, file="brugs.fit.unif.RData")
save(fit, file="brugs.fit.gamma.RData")
load(file="brugs.fit.unif.RData")
load(file="brugs.fit.gamma.RData")

# Review
fit
s.h <- samplesHistory(c('*'))
s.d <- samplesDensity("*")




# INLA
detach(Epil)
attach(Epil.inla)

formula <- y ~ log(Base/4) + Trt + I(Trt*log(Base/4)) + log(Age) + V4 + 
f(Ind, model = "iid") + f(rand, model = "iid")
model=inla(formula,family="poisson")
# 
model=inla(formula,family="poisson",keep.data.files=TRUE,control.fixed=list(param=c(0.8,0.02)))
# hyper<-hyperpar.inla(model)
# con todas las opciones:
# model=inla(formula,family="poisson", control.compute=list(dic=T, 
mlik=T), control.predictor=list(return.marginals=T))

# Timing
# Prepare inla file.....nr=2
# ..done
# Run inla...
# Wall-clock time used on [Model.ini] using max_threads=[2]
# Preparations : 0.125 seconds
# Approx inference: 1.688 seconds
# Output : 0.406 seconds
# ---------------------------------
# Total : 2.219 seconds


# Comparaci?n inferencia
par(mfrow=c(4,2))
plotDensity("alpha0", ask=F)
lines(model$marginals.fixed$intercept)
plotDensity("a.Base", ask=F)
lines(model$marginals.fixed$"log(Base/4)")
plotDensity("a.Trt", ask=F)
lines(model$marginals.fixed$Trt)
plotDensity("a.BT", ask=F)
lines(model$marginals.fixed$"I(Trt * log(Base/4))")
plotDensity("a.Age", ask=F)
lines(model$marginals.fixed$"log(Age)")
plotDensity("a.V4", ask=F)
lines(model$marginals.fixed$V4)
# como prec=1/sigmasq, -> fsigma(1/sqrt(y)) = 2*y^(1.5)*fprec(y)
plotDensity("sigma.b1", ask=F)
lines(cbind(1/sqrt(model$marginals.hyperpar$"Precision for ind"[,1]),
2*model$marginals.hyperpar$"Precision for 
ind"[,1]^(3/2)*model$marginals.hyperpar$"Precision for ind"[,2]))
plotDensity("sigma.b", ask=F)
lines(cbind(1/sqrt(model$marginals.hyperpar$"Precision for rand"[,1]),
2*model$marginals.hyperpar$"Precision for 
rand"[,1]^(3/2)*model$marginals.hyperpar$"Precision for rand"[,2]))

## more acurate hyperparameters?
#samplesDensity("sigma.b1",mfrow=c(1,1))
#lines(cbind(1/sqrt(hyper$marginals$"Precision for ind"[,1]),
# 2*hyper$marginals$"Precision for 
ind"[,1]^(3/2)*hyper$marginals$"Precision for ind"[,2]))
#
#samplesDensity("sigma.b",mfrow=c(1,1))
#lines(cbind(1/sqrt(hyper$marginals$"Precision for rand"[,1]),
# 2*hyper$marginals$"Precision for 
rand"[,1]^(3/2)*hyper$marginals$"Precision for rand"[,2]))


# Comparaci?n predicciones inla

esp <- model$summary.fitted.values[,"mean"] # valor esperado
esp <- cbind(esp, qpois(.05, esp), qpois(.95, esp)) # IC90% centrado
out <- which(y>esp[,3] | y<esp[,2]) # 40 62 63 221
n = Epil$N*Epil$T

plot(sqrt(y), pch=19, cex=.5, col='navyblue') # sqrt(observaciones) y 
valores esperados
points(sqrt(esp[,1]), lwd=1);
segments(1:n, sqrt(esp[,2]), 1:n, sqrt(esp[,3]), col='gray')
points(out,sqrt(y[out]), pch=19, cex=.5, col='red') # outliers


#res.inla <- (y-esp[,1])/sqrt(esp[,1]) # residuos de Pearson
#plot(res.inla,pch=19, cex=.5, col='red')
#qqnorm(res.inla); qqline(res.inla);
#shapiro.test(res.inla)

# Bondad de ajuste de modelos (mismo modelo, distintos m?todos)

fit$DIC # BRugs
# Dbar Dhat DIC pD
#y 1037 916.7 1157 120.2
model$dic # inla
#mean of the deviance: 1039.8321
#deviance of the mean: 921.4959
#effective number of parameters: 118.3363
#dic: 1158.1684


On 15/07/10 07:45, Sathyanarayan Anand wrote:
> Hi,  Can someone please point me towards running OpenBUGS on linux? I have copied the files as instructed on the OpenBUGS website but I can find any examples on how to write a script file to execute my model. I have the model, data and inits as text files. If possible, I'd prefer to run this through R on linux using the BRugs package, but I'm not sure if the package is supported on Linux. Thanks,Sathya.		 		 	   		
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From gavin.simpson at ucl.ac.uk  Thu Jul 15 13:28:14 2010
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Thu, 15 Jul 2010 12:28:14 +0100
Subject: [R-sig-Geo] Convert SpatialGridDataFrame to polygons...?
Message-ID: <1279193294.26456.16.camel@localhost>

Dear list,

I have been given a set of ASCII grids which I read into R using
readAsciiGrid(). The grids represent an interpolated water depth data
set for a set of lakes; each grid represents a separate lake. For some
reason I have been asked to convert this gridded data into a set of
polygons. For example; given the gridded data, I want to generate a
polygon that covers the area of the lake (from the grid) that is 1-2m
deep say. I would then need to write out this polygon as an ESRI shape
file.

Are there tools in R to do this sort of conversion?

It is a bit more complex that the simple example, as lakes can have
multiple basins (areas of deeper water). Say a lake has two deep areas
so a cross section through the lakes might look like a W, for such a
lake I would require an object that contained two polygons representing
the area of the lake between 4 and 5 meters say in *each* of the basins.
These would then be read out into a shape file. My GIS colleague
indicates that ArcGIS/ArcMAP has a function to polygonise a raster grid
in such a way. Is there something similar in the R spatial software
stack?

An alternative approach would be to contour (at appropriate depth
intervals) the interpolated grid and convert the set of contours into
polygons for individual lakes. Is there a function to do this?

As you can see, this is very much a look-see at the moment. We are
evaluating whether it would be quicker to work out how to do this in R
as opposed to doing it by hand in ArcGIS.

Any suggestions would be most gratefully received indeed!

All the best,

Gavin
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From a.crowe at lancaster.ac.uk  Thu Jul 15 17:08:34 2010
From: a.crowe at lancaster.ac.uk (Crowe, Andrew)
Date: Thu, 15 Jul 2010 16:08:34 +0100
Subject: [R-sig-Geo] Convert SpatialGridDataFrame to polygons...?
References: <1279193294.26456.16.camel@localhost>
Message-ID: <2C1F0E483039ED4CBE03BCC5740635923F8506@exchange-be3.lancs.local>

Gavin
 
Gavin
 
You can convert the raster grid to a polygon grid by coercing the SpatialGridDataFrame to a SpatialPixelsDataFrame then from that to a SpatialPolygonsDataFrame.
 
You should then be able to recode the polygon data for each particular depth class and union them using unionSpatialPolygons.  This then needs joining with a data frame created from the depth classes to create a SpatialPolygonsDataFrame for output to a shapefile using writePolyShape
 
Hope that helps
 
Andrew
 
Dr Andrew Crowe
 
Lancaster Environment Centre
Lancaster University
Lancaster    LA1 4YQ
UK
 
Tel: +44 (0)1524 595879

________________________________

From: r-sig-geo-bounces at stat.math.ethz.ch on behalf of Gavin Simpson
Sent: Thu 15/07/2010 12:28 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] Convert SpatialGridDataFrame to polygons...?



Dear list,

I have been given a set of ASCII grids which I read into R using
readAsciiGrid(). The grids represent an interpolated water depth data
set for a set of lakes; each grid represents a separate lake. For some
reason I have been asked to convert this gridded data into a set of
polygons. For example; given the gridded data, I want to generate a
polygon that covers the area of the lake (from the grid) that is 1-2m
deep say. I would then need to write out this polygon as an ESRI shape
file.

Are there tools in R to do this sort of conversion?

It is a bit more complex that the simple example, as lakes can have
multiple basins (areas of deeper water). Say a lake has two deep areas
so a cross section through the lakes might look like a W, for such a
lake I would require an object that contained two polygons representing
the area of the lake between 4 and 5 meters say in *each* of the basins.
These would then be read out into a shape file. My GIS colleague
indicates that ArcGIS/ArcMAP has a function to polygonise a raster grid
in such a way. Is there something similar in the R spatial software
stack?

An alternative approach would be to contour (at appropriate depth
intervals) the interpolated grid and convert the set of contours into
polygons for individual lakes. Is there a function to do this?

As you can see, this is very much a look-see at the moment. We are
evaluating whether it would be quicker to work out how to do this in R
as opposed to doing it by hand in ArcGIS.

Any suggestions would be most gratefully received indeed!

All the best,

Gavin
--
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk <http://www.freshwaters.org.uk/> 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From ssefick at gmail.com  Thu Jul 15 17:39:36 2010
From: ssefick at gmail.com (stephen sefick)
Date: Thu, 15 Jul 2010 10:39:36 -0500
Subject: [R-sig-Geo] Large Lidar Data Set fill 1m gap
Message-ID: <AANLkTilHauzGEgaEu777gpqRGPVFS69JZvfB7EJ9G9K9@mail.gmail.com>

I used GRASS with the inverse distance weighted algorithm to make DEMs
@ 1m resolution (I have a 5GB xyz text file also).  There ~40
individual DEMs with a 1m gap in between them.  I would like to fill
this 1m gap and then patch all of the DEMs together.  r.fill.nulls in
GRASS will throws an error that I believe is due to memory limitation.
 Any hints or leads would be greatly appreciated.

System Inoformation:
Linux Ubuntu 10.04
R 2.11.1
GRASS 6.4svn (a couple of days ago)

kindest regards,

-- 
Stephen Sefick
____________________________________
| Auburn University? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| Department of Biological Sciences? ? ? ? ?? |
| 331 Funchess Hall? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
| Auburn, Alabama? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| 36849? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
|___________________________________|
| sas0025 at auburn.edu? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| http://www.auburn.edu/~sas0025? ? ? ? ? ?? |
|___________________________________|

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.? We are mammals, and have not exhausted the
annoying little problems of being mammals.

? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? -K. Mullis


From finleya at msu.edu  Thu Jul 15 19:25:03 2010
From: finleya at msu.edu (Andrew Finley)
Date: Thu, 15 Jul 2010 13:25:03 -0400
Subject: [R-sig-Geo] Large Lidar Data Set fill 1m gap
In-Reply-To: <AANLkTilHauzGEgaEu777gpqRGPVFS69JZvfB7EJ9G9K9@mail.gmail.com>
References: <AANLkTilHauzGEgaEu777gpqRGPVFS69JZvfB7EJ9G9K9@mail.gmail.com>
Message-ID: <1279214703.1702.2.camel@darkstar>

Hi Shephen,
You might check out the MBA package. This resulting surface is
compatible with the sp package tools.
Kind regards-
Andy

On Thu, 2010-07-15 at 10:39 -0500, stephen sefick wrote:
> I used GRASS with the inverse distance weighted algorithm to make DEMs
> @ 1m resolution (I have a 5GB xyz text file also).  There ~40
> individual DEMs with a 1m gap in between them.  I would like to fill
> this 1m gap and then patch all of the DEMs together.  r.fill.nulls in
> GRASS will throws an error that I believe is due to memory limitation.
>  Any hints or leads would be greatly appreciated.
> 
> System Inoformation:
> Linux Ubuntu 10.04
> R 2.11.1
> GRASS 6.4svn (a couple of days ago)
> 
> kindest regards,
>


From Roger.Bivand at nhh.no  Thu Jul 15 21:06:20 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 15 Jul 2010 21:06:20 +0200 (CEST)
Subject: [R-sig-Geo] Convert SpatialGridDataFrame to polygons...?
In-Reply-To: <2C1F0E483039ED4CBE03BCC5740635923F8506@exchange-be3.lancs.local>
References: <1279193294.26456.16.camel@localhost>
	<2C1F0E483039ED4CBE03BCC5740635923F8506@exchange-be3.lancs.local>
Message-ID: <alpine.LRH.2.00.1007152055370.12918@reclus.nhh.no>

On Thu, 15 Jul 2010, Crowe, Andrew wrote:

> Gavin
>
> Gavin
>
> You can convert the raster grid to a polygon grid by coercing the 
> SpatialGridDataFrame to a SpatialPixelsDataFrame then from that to a 
> SpatialPolygonsDataFrame.
>
> You should then be able to recode the polygon data for each particular 
> depth class and union them using unionSpatialPolygons.  This then needs 
> joining with a data frame created from the depth classes to create a 
> SpatialPolygonsDataFrame for output to a shapefile using writePolyShape

In addition, you can massage the output of contourLines() to make a less 
jagged version:

library(maptools)
data(volcano)
x2 <- ContourLines2SLDF(contourLines(volcano))
# volcano is a regular "image" style object, SpatialGridDataFrame
# objects can be coerced with as.image.SpatialGridDataFrame()
# we don't (yet) have contourLines() for sp objects
x3 <- x2[(as.character(x2$level) > "140" & as.character(x2$level) <
  "170"),]
cx3 <- coordinates(x3)
str(cx3)
crds <- rbind(cx3[[1]][[1]], c(NA, NA), cx3[[2]][[1]], c(NA, NA),
   cx3[[2]][[2]], c(NA, NA), cx3[[1]][[2]])
# this could be automated in a loop
colnames(crds) <- c("x", "y")
pols <- map2SpatialPolygons(as.data.frame(crds), IDs=rep("1", 4))
# number of IDs like input polygons
pls <- slot(pols, "polygons")
gpclibPermit()
pls1 <- lapply(pls, checkPolygonsHoles)
slot(pols, "polygons") <- pls1
plot(pols, col="grey", pbg="yellow")

Both the use of checkPolygonsHoles() and unionSpatialPolygons require the 
use of gpclib with its bad licence. We're at mid-term with the GSoC rgeos 
project now, which provides similar facilities.

Using the contour lines may give a visually more pleasing, and maybe more 
helpful rendering than the blocky polygonised raster cells (which anyway 
will have been interpolated).

Please let us know how you get on,

Roger


>
> Hope that helps
>
> Andrew
>
> Dr Andrew Crowe
>
> Lancaster Environment Centre
> Lancaster University
> Lancaster    LA1 4YQ
> UK
>
> Tel: +44 (0)1524 595879
>
> ________________________________
>
> From: r-sig-geo-bounces at stat.math.ethz.ch on behalf of Gavin Simpson
> Sent: Thu 15/07/2010 12:28 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Convert SpatialGridDataFrame to polygons...?
>
>
>
> Dear list,
>
> I have been given a set of ASCII grids which I read into R using
> readAsciiGrid(). The grids represent an interpolated water depth data
> set for a set of lakes; each grid represents a separate lake. For some
> reason I have been asked to convert this gridded data into a set of
> polygons. For example; given the gridded data, I want to generate a
> polygon that covers the area of the lake (from the grid) that is 1-2m
> deep say. I would then need to write out this polygon as an ESRI shape
> file.
>
> Are there tools in R to do this sort of conversion?
>
> It is a bit more complex that the simple example, as lakes can have
> multiple basins (areas of deeper water). Say a lake has two deep areas
> so a cross section through the lakes might look like a W, for such a
> lake I would require an object that contained two polygons representing
> the area of the lake between 4 and 5 meters say in *each* of the basins.
> These would then be read out into a shape file. My GIS colleague
> indicates that ArcGIS/ArcMAP has a function to polygonise a raster grid
> in such a way. Is there something similar in the R spatial software
> stack?
>
> An alternative approach would be to contour (at appropriate depth
> intervals) the interpolated grid and convert the set of contours into
> polygons for individual lakes. Is there a function to do this?
>
> As you can see, this is very much a look-see at the moment. We are
> evaluating whether it would be quicker to work out how to do this in R
> as opposed to doing it by hand in ArcGIS.
>
> Any suggestions would be most gratefully received indeed!
>
> All the best,
>
> Gavin
> --
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk <http://www.freshwaters.org.uk/>
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From elaine.kuo.tw at gmail.com  Fri Jul 16 17:57:00 2010
From: elaine.kuo.tw at gmail.com (elaine kuo)
Date: Fri, 16 Jul 2010 23:57:00 +0800
Subject: [R-sig-Geo] error in errorsarlm
Message-ID: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100716/ae61e75a/attachment.pl>

From yud at mail.montclair.edu  Fri Jul 16 18:20:33 2010
From: yud at mail.montclair.edu (Danlin Yu)
Date: Fri, 16 Jul 2010 12:20:33 -0400
Subject: [R-sig-Geo] error in errorsarlm
In-Reply-To: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
References: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
Message-ID: <4C4086D1.2070604@mail.montclair.edu>

Elaine:

Based on the error message (cannot allocate vector of size 121.8 Mb), it 
is very possibly you have way too many cases in your data set. A 
potential solution would be randomly sample your dataset to get a 
representative sample set and run the spatial regression, or you can 
always try a computer with more physic memory, or try memory.limit() to 
manually allocate more memories. See ?memory.limit for more details.

Hope this helps.

Cheers,
Dr. Danlin Yu

elaine kuo ??:
> Dear List,
>
> I encountered an error message when trying to use Chebyshev as method for
> SAR.
> Please kindly help and thanks.
>
> package spdep was updated on 07162010
> system: windows vista home 32-bit
> R version 2.10.0 (20091026)
>
> Elaine
>
> Code
>   
>> library(ncf)
>> library(spdep)
>>
>> # Define coordinates, neighbours, and spatial weights
>> coords<-cbind(datam$lat,datam$lon)
>> coords<-as.matrix(coords)
>>
>> #Define neighbourhood (here distance 1.5)
>> nb10<-dnearneigh(coords,0,9)
>> nb10.w<-nb2listw(nb10, glist=NULL, style="W", zero.policy=FALSE)
>> sem.nb10.w <-
>>     
> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
> +datam$temp_min+datam$evi_min, listw=nb10.w,
> method="Chebyshev",tol.solve=1.0e-17)
> error: cannot allocate vector of size 121.8 Mb
>
>   
>> sem.nb10.w <-
>>     
> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
> +datam$temp_min+datam$evi_min, listw=nb10.w,
> method="Chebyshev",zero.policy=TRUE,tol.solve=1.0e-17)
> error in switch(Generic, `+` = , `-` = { :
>   Cholmod error 'out of memory' at file:../Core/cholmod_memory.c, line 148
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
___________________________________________
Danlin Yu, Ph.D.
Associate Professor of GIS and Urban Geography
Department of Earth & Environmental Studies
Montclair State University
Montclair, NJ, 07043
Tel: 973-655-4313
Fax: 973-655-4072
email: yud at mail.montclair.edu
webpage: csam.montclair.edu/~yu


From Roger.Bivand at nhh.no  Fri Jul 16 21:52:02 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 16 Jul 2010 21:52:02 +0200 (CEST)
Subject: [R-sig-Geo] error in errorsarlm
In-Reply-To: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
References: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007162144300.19802@reclus.nhh.no>

On Fri, 16 Jul 2010, elaine kuo wrote:

> Dear List,
>
> I encountered an error message when trying to use Chebyshev as method for
> SAR.
> Please kindly help and thanks.

Beyond what Danlin said, I am very unsure where to start. Please provide 
adequate information about your input data, specifically the number of 
observations, and the number of links in the neighbour list

length(nb10)
sum(card(nb10))

In addition, the implicit discription of nb10 looks confusing (is the 
distance threshold 1.5, 9, or 10?). The ordering of lat and lon looks 
wrong. You are not using Great Circle distances (and probably should?). So 
memory issues in errorsarlm are the least of your problems. My guess is 
that with dnearneigh() and a threshold of 9 degrees, you are including 
most of a large data set in the neighbour list, and if n is large, this 
will give a very large almost dense set of spatial weights, which was not 
what you intended.

Get the weights correct first, and the rest will likely follow.

Roger


>
> package spdep was updated on 07162010
> system: windows vista home 32-bit
> R version 2.10.0 (20091026)
>
> Elaine
>
> Code
>> library(ncf)
>> library(spdep)
>>
>> # Define coordinates, neighbours, and spatial weights
>> coords<-cbind(datam$lat,datam$lon)
>> coords<-as.matrix(coords)
>>
>> #Define neighbourhood (here distance 1.5)
>> nb10<-dnearneigh(coords,0,9)
>> nb10.w<-nb2listw(nb10, glist=NULL, style="W", zero.policy=FALSE)
>> sem.nb10.w <-
> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
> +datam$temp_min+datam$evi_min, listw=nb10.w,
> method="Chebyshev",tol.solve=1.0e-17)
> error: cannot allocate vector of size 121.8 Mb
>
>> sem.nb10.w <-
> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
> +datam$temp_min+datam$evi_min, listw=nb10.w,
> method="Chebyshev",zero.policy=TRUE,tol.solve=1.0e-17)
> error in switch(Generic, `+` = , `-` = { :
>  Cholmod error 'out of memory' at file:../Core/cholmod_memory.c, line 148
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From elaine.kuo.tw at gmail.com  Fri Jul 16 23:27:14 2010
From: elaine.kuo.tw at gmail.com (elaine kuo)
Date: Sat, 17 Jul 2010 05:27:14 +0800
Subject: [R-sig-Geo] error in errorsarlm
In-Reply-To: <alpine.LRH.2.00.1007162144300.19802@reclus.nhh.no>
References: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
	<alpine.LRH.2.00.1007162144300.19802@reclus.nhh.no>
Message-ID: <AANLkTik9muDJNtOG4lyJXl2Fk96c3CRDJAZ6dNJDntvq@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100717/db5a1d93/attachment.pl>

From Roger.Bivand at nhh.no  Sat Jul 17 15:41:40 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 17 Jul 2010 15:41:40 +0200 (CEST)
Subject: [R-sig-Geo] error in errorsarlm
In-Reply-To: <AANLkTik9muDJNtOG4lyJXl2Fk96c3CRDJAZ6dNJDntvq@mail.gmail.com>
References: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
	<alpine.LRH.2.00.1007162144300.19802@reclus.nhh.no>
	<AANLkTik9muDJNtOG4lyJXl2Fk96c3CRDJAZ6dNJDntvq@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007171534310.22601@reclus.nhh.no>

On Sat, 17 Jul 2010, elaine kuo wrote:

> Dear,
>
> Thank you for the help.
>
> 1. distance threshold
> It is 9. (Roger, you are right and sorry to confuse you)

But 9 what, metres, degrees? Should your code be: 
cbind(datam$lat,datam$lon), as the normal ordering is eastings then 
northings, not the opposite?

>
> 9 is the cutting point for avoiding empty neighbour sets.
> (If the distance threshold is 8, there will be empty ones.)

This is not a good reason, as graph neighbours can be sparse and link over 
longer distances.

>
> 2. dataset
> length(nb10)=4873.
> sum(card(nb10)=885478)
>

This gives an average of 181.7 neighbours per observation, and is the root 
of the problem. The Chebyshev method uses a set of low powers of the 
weights, which fill in quickly for large average numbers of neighbours. 
Did you try the Matrix method (your error message suggests that you may 
have done, but the code does not)?

> 3. memory size
> the memory limit is 1535 Mb, which is much larger than 121.8 Mb.
>

Windows (your OS?) memory handling is very poor for larger objects, and 
the 121Mb is extra memory needed. However, the main problem is your design 
of weights, which are far too dense to make sense. Choose an alternative 
weights definition and try again.

Roger

>
> Elaine
>
>
> Code
>
>> library(ncf)
>> library(spdep)
>>
>> # Define coordinates, neighbours, and spatial weights
>> coords<-cbind(datam$lat,datam$lon)
>> coords<-as.matrix(coords)
>>
>> #Define neighbourhood (here distance 1.5)
>> nb10<-dnearneigh(coords,0,9)
>> nb10.w<-nb2listw(nb10, glist=NULL, style="W", zero.policy=FALSE)
>> sem.nb10.w <-
>>
> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
> +datam$temp_min+datam$evi_min, listw=nb10.w,
> method="Chebyshev",tol.solve=1.0e-17)
> error: cannot allocate vector of size 121.8 Mb
>
> sem.nb10.w <-
>>
> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
> +datam$temp_min+datam$evi_min, listw=nb10.w,
> method="Chebyshev",zero.policy=TRUE,tol.solve=1.0e-17)
> error in switch(Generic, `+` = , `-` = { :
> Cholmod error 'out of memory' at file:../Core/cholmod_memory.c, line 148
>
>
> On Sat, Jul 17, 2010 at 3:52 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Fri, 16 Jul 2010, elaine kuo wrote:
>>
>>  Dear List,
>>>
>>> I encountered an error message when trying to use Chebyshev as method for
>>> SAR.
>>> Please kindly help and thanks.
>>>
>>
>> Beyond what Danlin said, I am very unsure where to start. Please provide
>> adequate information about your input data, specifically the number of
>> observations, and the number of links in the neighbour list
>>
>> length(nb10)
>> sum(card(nb10))
>>
>> In addition, the implicit discription of nb10 looks confusing (is the
>> distance threshold 1.5, 9, or 10?). The ordering of lat and lon looks wrong.
>> You are not using Great Circle distances (and probably should?). So memory
>> issues in errorsarlm are the least of your problems. My guess is that with
>> dnearneigh() and a threshold of 9 degrees, you are including most of a large
>> data set in the neighbour list, and if n is large, this will give a very
>> large almost dense set of spatial weights, which was not what you intended.
>>
>> Get the weights correct first, and the rest will likely follow.
>>
>> Roger
>>
>>
>>
>>> package spdep was updated on 07162010
>>> system: windows vista home 32-bit
>>> R version 2.10.0 (20091026)
>>>
>>> Elaine
>>>
>>> Code
>>>
>>>> library(ncf)
>>>> library(spdep)
>>>>
>>>> # Define coordinates, neighbours, and spatial weights
>>>> coords<-cbind(datam$lat,datam$lon)
>>>> coords<-as.matrix(coords)
>>>>
>>>> #Define neighbourhood (here distance 1.5)
>>>> nb10<-dnearneigh(coords,0,9)
>>>> nb10.w<-nb2listw(nb10, glist=NULL, style="W", zero.policy=FALSE)
>>>> sem.nb10.w <-
>>>>
>>> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
>>> +datam$temp_min+datam$evi_min, listw=nb10.w,
>>> method="Chebyshev",tol.solve=1.0e-17)
>>> error: cannot allocate vector of size 121.8 Mb
>>>
>>>  sem.nb10.w <-
>>>>
>>> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
>>> +datam$temp_min+datam$evi_min, listw=nb10.w,
>>> method="Chebyshev",zero.policy=TRUE,tol.solve=1.0e-17)
>>> error in switch(Generic, `+` = , `-` = { :
>>>  Cholmod error 'out of memory' at file:../Core/cholmod_memory.c, line 148
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From sturgeon09 at gmail.com  Sat Jul 17 18:19:55 2010
From: sturgeon09 at gmail.com (Samuel Turgeon)
Date: Sat, 17 Jul 2010 12:19:55 -0400
Subject: [R-sig-Geo] scale semivariance befor fit.variogram
Message-ID: <AANLkTikRTKg4vG3eR_NcOyGYv6HhCTLT3dTDdE08YAZY@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100717/a395bb31/attachment.pl>

From Giovanna.Jonalasinio at uniroma1.it  Sun Jul 18 16:02:04 2010
From: Giovanna.Jonalasinio at uniroma1.it (Giovanna.Jonalasinio at uniroma1.it)
Date: Sun, 18 Jul 2010 16:02:04 +0200
Subject: [R-sig-Geo] =?iso-8859-1?q?Giovanna_Jonalasinio_=E8_fuori_ufficio?=
	=?iso-8859-1?q?=2C_Out_of_Office?=
Message-ID: <OFF52354D6.1FB19FF7-ONC1257764.004D17F2-C1257764.004D17F2@Uniroma1.it>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100718/d19242c5/attachment.pl>

From pierre.roudier at gmail.com  Mon Jul 19 08:39:55 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 19 Jul 2010 18:39:55 +1200
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
	source)
Message-ID: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com>

Dear all,

I'm using the (excellent) rgdal package for a while now, but following
the build from source of the last GDAL stable release, I can not
reinstall it.

When I'm asking for install.packages("rgdal"), I got the following error:

Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared library '/usr/lib64/R/library/rgdal/libs/rgdal.so':
  libgdal.so.1: cannot open shared object file: No such file or directory

>From some internet search, I understand that it is possibly due to a
change in where GDAL has been installed, but I've been unsuccessful to
fix that so far.

Thanks for any hints.

Here is my config:

uname -a
Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
x86_64 x86_64 x86_64 GNU/Linux

Distro : Fedora 13 x86_64 (running KDE)

gdalinfo --version
GDAL 1.7.2, released 2010/04/23

The infamous libgdal.so file is located in /usr/local/lib/

sessionInfo()
R version 2.11.1 (2010-05-31)
x86_64-redhat-linux-gnu

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tcltk_2.11.1 tools_2.11.1

Cheers,

Pierre


From Roger.Bivand at nhh.no  Mon Jul 19 10:12:41 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jul 2010 10:12:41 +0200 (CEST)
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
 source)
In-Reply-To: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>

On Mon, 19 Jul 2010, Pierre Roudier wrote:

> Dear all,
>
> I'm using the (excellent) rgdal package for a while now, but following
> the build from source of the last GDAL stable release, I can not
> reinstall it.
>
> When I'm asking for install.packages("rgdal"), I got the following error:
>
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>  unable to load shared library '/usr/lib64/R/library/rgdal/libs/rgdal.so':
>  libgdal.so.1: cannot open shared object file: No such file or directory
>
>> From some internet search, I understand that it is possibly due to a
> change in where GDAL has been installed, but I've been unsuccessful to
> fix that so far.

Does gdalinfo --version run? Did you run ldconfig -v as su after 
installing GDAL? Check that GDAL itself can find its own shared objects, 
if it can, then so should rgdal.

Hope this helps,

Roger

>
> Thanks for any hints.
>
> Here is my config:
>
> uname -a
> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
> x86_64 x86_64 x86_64 GNU/Linux
>
> Distro : Fedora 13 x86_64 (running KDE)
>
> gdalinfo --version
> GDAL 1.7.2, released 2010/04/23
>
> The infamous libgdal.so file is located in /usr/local/lib/
>
> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-redhat-linux-gnu
>
> locale:
> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
> [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
> [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] tcltk_2.11.1 tools_2.11.1
>
> Cheers,
>
> Pierre
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pierre.roudier at gmail.com  Mon Jul 19 10:51:52 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 19 Jul 2010 20:51:52 +1200
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
	source)
In-Reply-To: <alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com>
	<alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
Message-ID: <AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com>

Thanks for the reply Roger,

> Does gdalinfo --version run? Did you run ldconfig -v as su after
> installing GDAL?

Yes, I ran su -c 'ldconfig -v' after the make install, and at the
moment gdalinfo --version gives me the good output (GDAL 1.7.2,
released 2010/04/23).

> Check that GDAL itself can find its own shared objects,
> if it can, then so should rgdal.

How could I do that? I had the same idea that if GDAL is running,
rgdal should be running as well, but I only checked using gdalinfo.

Moreover, if it could be of any help, here is the interesting bit
during the compilation of rgdal:

...
checking for pj_init_plus in -lproj... yes
./proj_conf_test: error while loading shared libraries: libgdal.so.1:
cannot open shared object file: No such file or directory
./proj_conf_test: error while loading shared libraries: libgdal.so.1:
cannot open shared object file: No such file or directory
Package CPP flags: -I/usr/local/include
Package LIBS: -L/usr/local/lib -lgdal
...

Thanks for the help,

Pierre

>
> Hope this helps,
>
> Roger
>
>>
>> Thanks for any hints.
>>
>> Here is my config:
>>
>> uname -a
>> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
>> x86_64 x86_64 x86_64 GNU/Linux
>>
>> Distro : Fedora 13 x86_64 (running KDE)
>>
>> gdalinfo --version
>> GDAL 1.7.2, released 2010/04/23
>>
>> The infamous libgdal.so file is located in /usr/local/lib/
>>
>> sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> x86_64-redhat-linux-gnu
>>
>> locale:
>> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>> [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>> [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>> [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>> [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> loaded via a namespace (and not attached):
>> [1] tcltk_2.11.1 tools_2.11.1
>>
>> Cheers,
>>
>> Pierre
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From Roger.Bivand at nhh.no  Mon Jul 19 11:03:02 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jul 2010 11:03:02 +0200 (CEST)
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
 source)
In-Reply-To: <AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com>
	<alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
	<AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007191100420.3716@reclus.nhh.no>

On Mon, 19 Jul 2010, Pierre Roudier wrote:

> Thanks for the reply Roger,
>
>> Does gdalinfo --version run? Did you run ldconfig -v as su after
>> installing GDAL?
>
> Yes, I ran su -c 'ldconfig -v' after the make install, and at the
> moment gdalinfo --version gives me the good output (GDAL 1.7.2,
> released 2010/04/23).
>
>> Check that GDAL itself can find its own shared objects,
>> if it can, then so should rgdal.
>
> How could I do that? I had the same idea that if GDAL is running,
> rgdal should be running as well, but I only checked using gdalinfo.
>
> Moreover, if it could be of any help, here is the interesting bit
> during the compilation of rgdal:
>
> ...
> checking for pj_init_plus in -lproj... yes
> ./proj_conf_test: error while loading shared libraries: libgdal.so.1:
> cannot open shared object file: No such file or directory
> ./proj_conf_test: error while loading shared libraries: libgdal.so.1:
> cannot open shared object file: No such file or directory
> Package CPP flags: -I/usr/local/include
> Package LIBS: -L/usr/local/lib -lgdal
> ...

Is PROJ.4 installed correctly? There is no reason for it to depend on GDAL 
- my RHEL5 says:

$ ldd `which proj`
         libproj.so.0 => /usr/local/lib/libproj.so.0 (0x00002adcf57b0000)
         libm.so.6 => /lib64/libm.so.6 (0x000000308bc00000)
         libc.so.6 => /lib64/libc.so.6 (0x000000308b800000)
         /lib64/ld-linux-x86-64.so.2 (0x000000308b400000)

and

$ proj
Rel. 4.7.1, 23 September 2009
usage: proj [ -beEfiIlormsStTvVwW [args] ] [ +opts[=arg] ] [ files ]

with no dependency on GDAL. Do you maybe have a stale GRASS GDAL plugin 
hanging around?

Roger

>
> Thanks for the help,
>
> Pierre
>
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> Thanks for any hints.
>>>
>>> Here is my config:
>>>
>>> uname -a
>>> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
>>> x86_64 x86_64 x86_64 GNU/Linux
>>>
>>> Distro : Fedora 13 x86_64 (running KDE)
>>>
>>> gdalinfo --version
>>> GDAL 1.7.2, released 2010/04/23
>>>
>>> The infamous libgdal.so file is located in /usr/local/lib/
>>>
>>> sessionInfo()
>>> R version 2.11.1 (2010-05-31)
>>> x86_64-redhat-linux-gnu
>>>
>>> locale:
>>> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>> [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>> [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>>> [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>> [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> loaded via a namespace (and not attached):
>>> [1] tcltk_2.11.1 tools_2.11.1
>>>
>>> Cheers,
>>>
>>> Pierre
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pierre.roudier at gmail.com  Mon Jul 19 11:09:36 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 19 Jul 2010 21:09:36 +1200
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
	source)
In-Reply-To: <alpine.LRH.2.00.1007191100420.3716@reclus.nhh.no>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com>
	<alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
	<AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com>
	<alpine.LRH.2.00.1007191100420.3716@reclus.nhh.no>
Message-ID: <AANLkTin40gijgTa6h-NfKlkT7mfFVwToBJwe7MZzV9Lz@mail.gmail.com>

Hi again,

> Is PROJ.4 installed correctly? There is no reason for it to depend on GDAL
> - my RHEL5 says:
>
> $ ldd `which proj`
>          libproj.so.0 => /usr/local/lib/libproj.so.0 (0x00002adcf57b0000)
>          libm.so.6 => /lib64/libm.so.6 (0x000000308bc00000)
>          libc.so.6 => /lib64/libc.so.6 (0x000000308b800000)
>          /lib64/ld-linux-x86-64.so.2 (0x000000308b400000)
>
> and
>
> $ proj
> Rel. 4.7.1, 23 September 2009
> usage: proj [ -beEfiIlormsStTvVwW [args] ] [ +opts[=arg] ] [ files ]
>

It seems to be correctly installed:

xx$ ldd `which proj`
        linux-vdso.so.1 =>  (0x00007fff6ef08000)
        libproj.so.0 => /usr/lib64/libproj.so.0 (0x0000003e29000000)
        libm.so.6 => /lib64/libm.so.6 (0x0000003e26800000)
        libc.so.6 => /lib64/libc.so.6 (0x0000003e26400000)
        /lib64/ld-linux-x86-64.so.2 (0x0000003e26000000)

xx$ proj
Rel. 4.7.1, 23 September 2009
usage: proj [ -beEfiIlormsStTvVwW [args] ] [ +opts[=arg] ] [ files ]

> with no dependency on GDAL. Do you maybe have a stale GRASS GDAL plugin
> hanging around?

That is most likely indeed, as I tried (and failed) to build the GRASS
GDAL plugin from source!

What is the exact library that may mess this all up?

Thanks again,

Pierre


>
> Roger
>
>>
>> Thanks for the help,
>>
>> Pierre
>>
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>>
>>>> Thanks for any hints.
>>>>
>>>> Here is my config:
>>>>
>>>> uname -a
>>>> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
>>>> x86_64 x86_64 x86_64 GNU/Linux
>>>>
>>>> Distro : Fedora 13 x86_64 (running KDE)
>>>>
>>>> gdalinfo --version
>>>> GDAL 1.7.2, released 2010/04/23
>>>>
>>>> The infamous libgdal.so file is located in /usr/local/lib/
>>>>
>>>> sessionInfo()
>>>> R version 2.11.1 (2010-05-31)
>>>> x86_64-redhat-linux-gnu
>>>>
>>>> locale:
>>>> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>> [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>> [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>>>> [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>>> [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>
>>>> loaded via a namespace (and not attached):
>>>> [1] tcltk_2.11.1 tools_2.11.1
>>>>
>>>> Cheers,
>>>>
>>>> Pierre
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From p.hiemstra at geo.uu.nl  Mon Jul 19 11:20:23 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 19 Jul 2010 11:20:23 +0200
Subject: [R-sig-Geo] scale semivariance befor fit.variogram
In-Reply-To: <AANLkTikRTKg4vG3eR_NcOyGYv6HhCTLT3dTDdE08YAZY@mail.gmail.com>
References: <AANLkTikRTKg4vG3eR_NcOyGYv6HhCTLT3dTDdE08YAZY@mail.gmail.com>
Message-ID: <4C4418D7.8010104@geo.uu.nl>

On 07/17/2010 06:19 PM, Samuel Turgeon wrote:
> Hi,
>
> I'm a new user of gstat, so my question is maybe very simple.
>
> I'm trying to fit a variogram with the function fit.variogram and I get this
> error message:
>
> Warning: singular model in variogram fit
> [1] "a possible solution MIGHT be to scale semivariances and/or distances"
>
> My data have values between 2.54e-10  et 2.56e-06. If I multiply my data by
> a constant in the semivariogram:
>
> vario=variogram(NASC*10000000~1,data,cutoff=1000)
>
> When I do this multiplication I'm able to fit a variogram.
>
> So my question is, Is it possible to this? Can I back transform (by a
> division) my predited values when the ordinary kriging will be done?
>    

Hi Sam,

It is possible, probably the covariance matrix has a lot of zeros 
because of rounding of your small values. Could this be linked to using 
single precision floats in gstat (edzer?)? I think there is no problem 
in 'backtransforming' your values, i.e. you only change the unit of the 
variable you are using (e.g. from milligram to microgram). Take care 
though that when predicting whilst using the fitted variogram model, 
your observations also need to be multiplied by this constant. My 
suggestion would be to multiply the data at the very beginning of the 
script, do all you analysis and at the very end do the division. You 
could also skip the division and present your results in the new unit.

regards,
Paul

> Thanks!
>
> Sam
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>    


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 253 5773
http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770


From Roger.Bivand at nhh.no  Mon Jul 19 11:34:59 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jul 2010 11:34:59 +0200 (CEST)
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
 source)
In-Reply-To: <AANLkTin40gijgTa6h-NfKlkT7mfFVwToBJwe7MZzV9Lz@mail.gmail.com>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com>
	<alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
	<AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com>
	<alpine.LRH.2.00.1007191100420.3716@reclus.nhh.no>
	<AANLkTin40gijgTa6h-NfKlkT7mfFVwToBJwe7MZzV9Lz@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007191117440.3716@reclus.nhh.no>

On Mon, 19 Jul 2010, Pierre Roudier wrote:

> Hi again,
>
>> Is PROJ.4 installed correctly? There is no reason for it to depend on GDAL
>> - my RHEL5 says:
>>
>> $ ldd `which proj`
>>          libproj.so.0 => /usr/local/lib/libproj.so.0 (0x00002adcf57b0000)
>>          libm.so.6 => /lib64/libm.so.6 (0x000000308bc00000)
>>          libc.so.6 => /lib64/libc.so.6 (0x000000308b800000)
>>          /lib64/ld-linux-x86-64.so.2 (0x000000308b400000)
>>
>> and
>>
>> $ proj
>> Rel. 4.7.1, 23 September 2009
>> usage: proj [ -beEfiIlormsStTvVwW [args] ] [ +opts[=arg] ] [ files ]
>>
>
> It seems to be correctly installed:
>
> xx$ ldd `which proj`
>        linux-vdso.so.1 =>  (0x00007fff6ef08000)
>        libproj.so.0 => /usr/lib64/libproj.so.0 (0x0000003e29000000)
>        libm.so.6 => /lib64/libm.so.6 (0x0000003e26800000)
>        libc.so.6 => /lib64/libc.so.6 (0x0000003e26400000)
>        /lib64/ld-linux-x86-64.so.2 (0x0000003e26000000)
>
> xx$ proj
> Rel. 4.7.1, 23 September 2009
> usage: proj [ -beEfiIlormsStTvVwW [args] ] [ +opts[=arg] ] [ files ]
>
>> with no dependency on GDAL. Do you maybe have a stale GRASS GDAL plugin
>> hanging around?
>
> That is most likely indeed, as I tried (and failed) to build the GRASS
> GDAL plugin from source!
>
> What is the exact library that may mess this all up?

I think that there is a GDAL plugins directory somewhere in /usr/local - 
if it is there, it contains a reference to your previous GDAL install, 
probably called gdalplugins. Try removing it, or changing its name.

Roger

>
> Thanks again,
>
> Pierre
>
>
>>
>> Roger
>>
>>>
>>> Thanks for the help,
>>>
>>> Pierre
>>>
>>>>
>>>> Hope this helps,
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Thanks for any hints.
>>>>>
>>>>> Here is my config:
>>>>>
>>>>> uname -a
>>>>> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
>>>>> x86_64 x86_64 x86_64 GNU/Linux
>>>>>
>>>>> Distro : Fedora 13 x86_64 (running KDE)
>>>>>
>>>>> gdalinfo --version
>>>>> GDAL 1.7.2, released 2010/04/23
>>>>>
>>>>> The infamous libgdal.so file is located in /usr/local/lib/
>>>>>
>>>>> sessionInfo()
>>>>> R version 2.11.1 (2010-05-31)
>>>>> x86_64-redhat-linux-gnu
>>>>>
>>>>> locale:
>>>>> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>>> [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>>> [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>>>>> [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>>>> [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>>
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>
>>>>> loaded via a namespace (and not attached):
>>>>> [1] tcltk_2.11.1 tools_2.11.1
>>>>>
>>>>> Cheers,
>>>>>
>>>>> Pierre
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pierre.roudier at gmail.com  Mon Jul 19 11:44:24 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 19 Jul 2010 21:44:24 +1200
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
	source)
In-Reply-To: <alpine.LRH.2.00.1007191117440.3716@reclus.nhh.no>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com> 
	<alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
	<AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com> 
	<alpine.LRH.2.00.1007191100420.3716@reclus.nhh.no>
	<AANLkTin40gijgTa6h-NfKlkT7mfFVwToBJwe7MZzV9Lz@mail.gmail.com> 
	<alpine.LRH.2.00.1007191117440.3716@reclus.nhh.no>
Message-ID: <AANLkTim6OdLfAMFaQDoSWDVaBt_x0D8_jM_1cTzRD3K5@mail.gmail.com>

> I think that there is a GDAL plugins directory somewhere in /usr/local - if
> it is there, it contains a reference to your previous GDAL install, probably
> called gdalplugins. Try removing it, or changing its name.

Yes, there was a gdalplugins folder in /usr/lib/, containing
ogr_GRASS.so. I removed the whole folder, but unfortunatley, the same
error is appearing on compilation of rgdal.

Thanks anyway,

Pierre

>
> Roger
>
>>
>> Thanks again,
>>
>> Pierre
>>
>>
>>>
>>> Roger
>>>
>>>>
>>>> Thanks for the help,
>>>>
>>>> Pierre
>>>>
>>>>>
>>>>> Hope this helps,
>>>>>
>>>>> Roger
>>>>>
>>>>>>
>>>>>> Thanks for any hints.
>>>>>>
>>>>>> Here is my config:
>>>>>>
>>>>>> uname -a
>>>>>> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
>>>>>> x86_64 x86_64 x86_64 GNU/Linux
>>>>>>
>>>>>> Distro : Fedora 13 x86_64 (running KDE)
>>>>>>
>>>>>> gdalinfo --version
>>>>>> GDAL 1.7.2, released 2010/04/23
>>>>>>
>>>>>> The infamous libgdal.so file is located in /usr/local/lib/
>>>>>>
>>>>>> sessionInfo()
>>>>>> R version 2.11.1 (2010-05-31)
>>>>>> x86_64-redhat-linux-gnu
>>>>>>
>>>>>> locale:
>>>>>> [1] LC_CTYPE=en_US.UTF-8 ? ? ? LC_NUMERIC=C
>>>>>> [3] LC_TIME=en_US.UTF-8 ? ? ? ?LC_COLLATE=en_US.UTF-8
>>>>>> [5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_US.UTF-8
>>>>>> [7] LC_PAPER=en_US.UTF-8 ? ? ? LC_NAME=C
>>>>>> [9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
>>>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>>>
>>>>>> attached base packages:
>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>>>
>>>>>> loaded via a namespace (and not attached):
>>>>>> [1] tcltk_2.11.1 tools_2.11.1
>>>>>>
>>>>>> Cheers,
>>>>>>
>>>>>> Pierre
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>> --
>>>>> Roger Bivand
>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>> of
>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>>
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From Roger.Bivand at nhh.no  Mon Jul 19 11:58:02 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jul 2010 11:58:02 +0200 (CEST)
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
 source)
In-Reply-To: <AANLkTim6OdLfAMFaQDoSWDVaBt_x0D8_jM_1cTzRD3K5@mail.gmail.com>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com>
	<alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
	<AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com>
	<alpine.LRH.2.00.1007191100420.3716@reclus.nhh.no>
	<AANLkTin40gijgTa6h-NfKlkT7mfFVwToBJwe7MZzV9Lz@mail.gmail.com>
	<alpine.LRH.2.00.1007191117440.3716@reclus.nhh.no>
	<AANLkTim6OdLfAMFaQDoSWDVaBt_x0D8_jM_1cTzRD3K5@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007191155310.3716@reclus.nhh.no>

On Mon, 19 Jul 2010, Pierre Roudier wrote:

>> I think that there is a GDAL plugins directory somewhere in /usr/local - if
>> it is there, it contains a reference to your previous GDAL install, probably
>> called gdalplugins. Try removing it, or changing its name.
>
> Yes, there was a gdalplugins folder in /usr/lib/, containing
> ogr_GRASS.so. I removed the whole folder, but unfortunatley, the same
> error is appearing on compilation of rgdal.

There must still be messes left around in various places. Does using 
locate, for example locate libgdal and locate gdalplugins help? Otherwise 
remove and reinstall PROJ.4 and GDAL. Most likely debris after experiments 
with the GRASS plugin (and maybe QGIS) are still around.

Roger

>
> Thanks anyway,
>
> Pierre
>
>>
>> Roger
>>
>>>
>>> Thanks again,
>>>
>>> Pierre
>>>
>>>
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Thanks for the help,
>>>>>
>>>>> Pierre
>>>>>
>>>>>>
>>>>>> Hope this helps,
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>>
>>>>>>> Thanks for any hints.
>>>>>>>
>>>>>>> Here is my config:
>>>>>>>
>>>>>>> uname -a
>>>>>>> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
>>>>>>> x86_64 x86_64 x86_64 GNU/Linux
>>>>>>>
>>>>>>> Distro : Fedora 13 x86_64 (running KDE)
>>>>>>>
>>>>>>> gdalinfo --version
>>>>>>> GDAL 1.7.2, released 2010/04/23
>>>>>>>
>>>>>>> The infamous libgdal.so file is located in /usr/local/lib/
>>>>>>>
>>>>>>> sessionInfo()
>>>>>>> R version 2.11.1 (2010-05-31)
>>>>>>> x86_64-redhat-linux-gnu
>>>>>>>
>>>>>>> locale:
>>>>>>> [1] LC_CTYPE=en_US.UTF-8 ? ? ? LC_NUMERIC=C
>>>>>>> [3] LC_TIME=en_US.UTF-8 ? ? ? ?LC_COLLATE=en_US.UTF-8
>>>>>>> [5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_US.UTF-8
>>>>>>> [7] LC_PAPER=en_US.UTF-8 ? ? ? LC_NAME=C
>>>>>>> [9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
>>>>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>>>>
>>>>>>> attached base packages:
>>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>>>>
>>>>>>> loaded via a namespace (and not attached):
>>>>>>> [1] tcltk_2.11.1 tools_2.11.1
>>>>>>>
>>>>>>> Cheers,
>>>>>>>
>>>>>>> Pierre
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>> of
>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From johan.vandewauw at gmail.com  Mon Jul 19 13:23:19 2010
From: johan.vandewauw at gmail.com (Johan Van de Wauw)
Date: Mon, 19 Jul 2010 13:23:19 +0200
Subject: [R-sig-Geo] rgdal package installation error
In-Reply-To: <4C36B9E1.3040502@gmail.com>
References: <557948.78308.qm@web54305.mail.re2.yahoo.com>
	<4C36B9E1.3040502@gmail.com>
Message-ID: <AANLkTinqrYsjHilIMyh-ZQsTm38_gHX8MigUEcklTDZC@mail.gmail.com>

A late reply but I still give it since it might be of interest to
people searching the archive:
you should install not only libgdal, but also the package libgdal1-dev
(this holds true whenever you need to compile against a library in
debian/ubuntu: also install the associated -dev package).
so: sudo apt-get install libgdal1-dev
That package contains the headers for building gdal and contains the
unversioned (or partly unversioned) libgdal.so.1 which you need to
build rgdal.

In fact, if I understand it correctly, you might now have actually
built gdal using the headers of the 1.7.2 version and linked against
the 1.4.0 version - which may lead to errors at one or another point.

Johan
PS: In case you are looking for a more recent version of gdal, you
could add the stable or unstable ppa repositories of ubuntugis:
https://launchpad.net/~ubuntugis

On Fri, Jul 9, 2010 at 7:55 AM, Siva Sundaresan <nepsiva at gmail.com> wrote:
> Dear Thiago,
>
> Thanks! That did the trick.
>
> I poked around the /usr/local/lib directory and I suspect the problem had
> something to do with libgdal.so.1, which I believe is a link to the gdal
> libraries(?). Once that link was created correctly (because of the
> installation of the GDAL libraries) it works ok.
>
> Thanks for your help.
>
> best,
> Siva
>
> Thiago Veloso wrote:
>>
>> ?Dear Siva,
>> ?Installing GDAL libraries should do the trick. Search in Synaptic or
>> download from this URL: http://packages.ubuntu.com/ro/hardy/libgdal1-1.4.0
>> ?Best regards,
>> ?Thiago.
>>
>> --- On Thu, 8/7/10, Siva Sundaresan <nepsiva at gmail.com> wrote:
>>
>> From: Siva Sundaresan <nepsiva at gmail.com>
>> Subject: [R-sig-Geo] rgdal package installation error
>> To: r-sig-geo at stat.math.ethz.ch
>> Date: Thursday, 8 July, 2010, 9:32
>>
>> I am trying to install the rgdal package under Ubuntu 8.10 with have gdal
>> 1.7.2 installed. I get the following error:
>>
>> On typing:
>>
>>> install.packages("rgdal")
>>
>> Warning in install.packages("rgdal") :
>> ?argument 'lib' is missing: using '/usr/local/lib/R/site-library'
>>
>> <snip stuff that seems irrelevant>
>>
>> checking for pj_init_plus in -lproj... yes
>> ./proj_conf_test: error while loading shared libraries: libgdal.so.1:
>> cannot open shared object file: No such file or directory
>> ./proj_conf_test: error while loading shared libraries: libgdal.so.1:
>> cannot open shared object file: No such file or directory
>> Package CPP flags: -I/usr/local/include
>> Package LIBS: -L/usr/local/lib -lgdal
>> configure: creating ./config.status
>> config.status: creating src/Makevars
>> ** libs
>>
>> <snip other g++ stuff>
>>
>> installing to /usr/local/lib/R/site-library/rgdal/libs
>> ** R
>> ** inst
>> ** preparing package for lazy loading
>> ** help
>> *** installing help indices
>> ** building package indices ...
>> ** testing if installed package can be loaded
>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>> ?unable to load shared library
>> '/usr/local/lib/R/site-library/rgdal/libs/rgdal.so':
>> ?libgdal.so.1: cannot open shared object file: No such file or directory
>> ERROR: loading failed
>> * removing ?/usr/local/lib/R/site-library/rgdal?
>>
>> The downloaded packages are in
>> ? ??/tmp/RtmpQVVEl1/downloaded_packages?
>> Warning message:
>> In install.packages("rgdal") :
>> ?installation of package 'rgdal' had non-zero exit status
>>
>>
>> I have tried uninstalling and reinstalling gdal (using sudo apt-get
>> install). I have also tried downloading the rgdal tar.gz file and installing
>> using R CMD INSTALL at the shell prompt. I still get the same error message
>> as above.
>>
>> If anyone can help me, I would be very grateful.
>>
>> Thank you,
>> Siva
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>>
>
> --
> Siva Sundaresan
>
> Conservation Biology
> Denver Zoological Foundation
> Denver CO 80205 USA
>
> Ecology & Evolutionary Biology
> Princeton University
> Princeton NJ 08544 USA
>
> http://www.princeton.edu/~equids
> http://savingstripes.wildlifedirect.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Tim.Haering at lwf.bayern.de  Mon Jul 19 13:39:59 2010
From: Tim.Haering at lwf.bayern.de (Tim.Haering at lwf.bayern.de)
Date: Mon, 19 Jul 2010 13:39:59 +0200
Subject: [R-sig-Geo] decimal places of coordinates get lost - readGDAL
Message-ID: <70FC67C4A585D1489E66225A4E0238BA9AEAAE@RZS-EXC-CL06.rz-sued.bayern.de>

Hello !

I want to import a raster into R using the readGDAL() function. Unfortunately the coordinates of my raster have decimal places. After importing the file the decimal places get lost. It seems the GDAL rounds the coordinates. Is it possible to read the decimal places?
Here a little example:
The header of my ASCII file:
NCOLS 202
NROWS 201
XLLCENTER 4344198.9375000019
YLLCENTER 5537700.3750000028
CELLSIZE 20.000000
NODATA_VALUE -99999

myraster <- readGDAL("raster.asc")
myraster at coords
           x       y
[1,] 4344199 5537700
[2,] 4348219 5541700

Thank you.

TIM


----------------- 
Tim H?ring
Bavarian State Institute of Forestry 
Department of Forest Ecology
Hans-Carl-von-Carlowitz-Platz 1
D-85354 Freising

E-Mail: tim.haering at lwf.bayern.de
http://www.lwf.bayern.de


From Roger.Bivand at nhh.no  Mon Jul 19 13:55:07 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jul 2010 13:55:07 +0200 (CEST)
Subject: [R-sig-Geo] decimal places of coordinates get lost - readGDAL
In-Reply-To: <70FC67C4A585D1489E66225A4E0238BA9AEAAE@RZS-EXC-CL06.rz-sued.bayern.de>
References: <70FC67C4A585D1489E66225A4E0238BA9AEAAE@RZS-EXC-CL06.rz-sued.bayern.de>
Message-ID: <alpine.LRH.2.00.1007191342560.11910@reclus.nhh.no>

On Mon, 19 Jul 2010, Tim.Haering at lwf.bayern.de wrote:

> Hello !
>
> I want to import a raster into R using the readGDAL() function. 
> Unfortunately the coordinates of my raster have decimal places. After 
> importing the file the decimal places get lost. It seems the GDAL rounds 
> the coordinates. Is it possible to read the decimal places?

Try setting a different value for options("digits") to be used by the 
print() method you are calling invisibly. Showing a floating point number 
must involve arbitrary rounding, and if you haven't specified a different 
number of digits, you get the default:

x <- 4344198.9375000019
print(x)
print(x, digits=16)
print(x, digits=20)

Notice that your example number cannot be represented in double precision, 
as after 4344198.93750001 there is no precision left, and any operations 
(such as multiplication) will erode it anyway. In any case, you are 
probably dealing with a missing part of the size of 0.0000019 mm, which 
might just be more precise than the measurements were.

Hope this clarifies,

Roger

> Here a little example:
> The header of my ASCII file:
> NCOLS 202
> NROWS 201
> XLLCENTER 4344198.9375000019
> YLLCENTER 5537700.3750000028
> CELLSIZE 20.000000
> NODATA_VALUE -99999
>
> myraster <- readGDAL("raster.asc")
> myraster at coords
>           x       y
> [1,] 4344199 5537700
> [2,] 4348219 5541700
>
> Thank you.
>
> TIM
>
>
> -----------------
> Tim H?ring
> Bavarian State Institute of Forestry
> Department of Forest Ecology
> Hans-Carl-von-Carlowitz-Platz 1
> D-85354 Freising
>
> E-Mail: tim.haering at lwf.bayern.de
> http://www.lwf.bayern.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From benjamin.mazzotta at tufts.edu  Mon Jul 19 16:21:00 2010
From: benjamin.mazzotta at tufts.edu (Ben Mazzotta)
Date: Mon, 19 Jul 2010 10:21:00 -0400
Subject: [R-sig-Geo] How to replace coordinates of Polygons
Message-ID: <4C445F4C.1060800@tufts.edu>

Dear R geographers:

I'm able to replace the coordinates of any given polygon, but not 
construct apply() family commands or for() loops to accomplish the same 
task. How can I construct a simple loop or apply() command that will 
sequentially replace all of the coordinates in a SpatialPolygons object?

As far as I understand, the coordinates of a polygon are kept in a slot 
referred as follows:
map at polygons[[x]]@Polygons[[y]]@coords

Using which, I can create mapply(foo, indexp, indexP) commands to 
extract the original coordinates and transform them.

# Define a pair of vectors indexp, indexP that together index every 
Polyon in the SpatialPolygons object map.
# Then extract coordinates as follows:
coords <- function(x,y) {map at polygons[[indexp]]@Polygons[[indexP]]@coords}
# Or operate a function foo on the old coordinates
coords.alt <- mapply(foo, 
map at polygons[[indexp]]@Polygons[[indexP]]@coords[,1], 
map at polygons[[indexp]]@Polygons[[indexP]]@coords[,2])

So I can create lists and matrices of coordinates, and transform the 
coordinates.

It is possible to write a command that replaces coordinates using 
integers; but these commands fail when I attempt to use mapply() to 
replace existing coordinates. For example,

p at polygons[[1]]@Polygons[[1]]@coords <- foo(1,1)

will work fine, but the following will not.

newcoords <- function(indp, indP) {
     p at polygons[[indp]]@Polygons[[indP]]@coords <- foo(indp, indP)
     }
mapply(newcoords, indexp, indexP)


Have I missed something in the manual on coordinates that would enable 
me to transform the coordinates of all the Polygons in a 
SpatialPolygonsDataFrame according to some regular function of the old 
coordinates (x,y)? Is the only alternative to build a new 
SpatialPolygons data frame from scratch, beginning with the new coordinates?

If it would be useful, I can provide sample code that works on wrld_simpl.

Please advise. Thank you!


-- 
Ben Mazzotta, PhD Candidate
The Fletcher School, Tufts University
benjamin.mazzotta at tufts.edu


From david.depew at queensu.ca  Mon Jul 19 16:51:15 2010
From: david.depew at queensu.ca (david.depew at queensu.ca)
Date: Mon, 19 Jul 2010 10:51:15 -0400
Subject: [R-sig-Geo] RSAGA - rsaga.geoprocessor crash
Message-ID: <fc839ad9791b.4c442e23@queensu.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100719/2414b63b/attachment.pl>

From Tim.Haering at lwf.bayern.de  Mon Jul 19 17:15:44 2010
From: Tim.Haering at lwf.bayern.de (Tim.Haering at lwf.bayern.de)
Date: Mon, 19 Jul 2010 17:15:44 +0200
Subject: [R-sig-Geo] RSAGA - rsaga.geoprocessor crash
In-Reply-To: <21065_1279551120_o6JEpwSE026552_fc839ad9791b.4c442e23@queensu.ca>
References: <21065_1279551120_o6JEpwSE026552_fc839ad9791b.4c442e23@queensu.ca>
Message-ID: <70FC67C4A585D1489E66225A4E0238BA9AEBE8@RZS-EXC-CL06.rz-sued.bayern.de>

Hi David,

> I am using SAGA v2.0.2 and RSAGA interface with R 2.9.2.

Maybe it is a problem with your SAGA version. I could reproduce your example without any problem. I`m using SAGA 2.0.4, R 2.11.0 and RSAGA 0.9-6 on Windows XP.

Or it is a problem of your GRIDS argument. How is it organized?
> qp <- list.files(getwd(), pattern=".sgrd")
> filelist <- list.files(getwd(), pattern=".sgrd")
> filelist
[1] "g1.sgrd" "g2.sgrd" "g3.sgrd"
> paste(set.file.extension(filelist,".sgrd"),collapse=";")
[1] "g1.sgrd;g2.sgrd;g3.sgrd" 

HTH,
TIM


----------------- 
Tim H?ring
Bavarian State Institute of Forestry 
Department of Forest Ecology
Hans-Carl-von-Carlowitz-Platz 1
D-85354 Freising

E-Mail: tim.haering at lwf.bayern.de
http://www.lwf.bayern.de


From david.depew at queensu.ca  Mon Jul 19 17:31:45 2010
From: david.depew at queensu.ca (david.depew at queensu.ca)
Date: Mon, 19 Jul 2010 11:31:45 -0400
Subject: [R-sig-Geo] RSAGA - rsaga.geoprocessor crash
In-Reply-To: <70FC67C4A585D1489E66225A4E0238BA9AEBE8@RZS-EXC-CL06.rz-sued.bayern.de>
References: <21065_1279551120_o6JEpwSE026552_fc839ad9791b.4c442e23@queensu.ca>
	<70FC67C4A585D1489E66225A4E0238BA9AEBE8@RZS-EXC-CL06.rz-sued.bayern.de>
Message-ID: <f6cda3b475a7.4c4437a1@queensu.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100719/1adcaf10/attachment.pl>

From Tim.Haering at lwf.bayern.de  Mon Jul 19 17:41:07 2010
From: Tim.Haering at lwf.bayern.de (Tim.Haering at lwf.bayern.de)
Date: Mon, 19 Jul 2010 17:41:07 +0200
Subject: [R-sig-Geo] RSAGA - rsaga.geoprocessor crash
In-Reply-To: <f6cda3b475a7.4c4437a1@queensu.ca>
References: <21065_1279551120_o6JEpwSE026552_fc839ad9791b.4c442e23@queensu.ca>
	<70FC67C4A585D1489E66225A4E0238BA9AEBE8@RZS-EXC-CL06.rz-sued.bayern.de>
	<f6cda3b475a7.4c4437a1@queensu.ca>
Message-ID: <70FC67C4A585D1489E66225A4E0238BA9AEC02@RZS-EXC-CL06.rz-sued.bayern.de>


> My impression was that the .sgrd?inputs in the "GRIDS" parameter had to separated by ";", and my code does provde?a character vector with the format > "grid1.sgrd;grid2.sgrd;grid3.sgrd..."
> Maybe it is time to update!

Hmm... Your string for the GRIDS argument is right - just like in my little example. It has to be "grid1.sgrd;grid2.sgrd;grid3.sgrd" - at least for SAGA 2.0.4.

>> Maybe it is a problem with your SAGA version. I could reproduce 
>> your example without any problem. I`m using SAGA 2.0.4, R 2.11.0 
>> and RSAGA?0.9-6 on Windows XP.
>> 
>> Or it is a problem of your GRIDS argument. How is it organized?
>> > qp?<- list.files(getwd(), pattern=".sgrd")
>> > filelist?<- list.files(getwd(), pattern=".sgrd")
>> > filelist
>> [1] "g1.sgrd" "g2.sgrd" "g3.sgrd"
>> > paste(set.file.extension(filelist,".sgrd"),collapse=";")
>> [1] "g1.sgrd;g2.sgrd;g3.sgrd" 

If your function call still fails try an update of SAGA, R and RSAGA.

HTH,
TIM


From sturgeon09 at gmail.com  Mon Jul 19 17:44:31 2010
From: sturgeon09 at gmail.com (Samuel Turgeon)
Date: Mon, 19 Jul 2010 11:44:31 -0400
Subject: [R-sig-Geo] scale semivariance befor fit.variogram
In-Reply-To: <4C4418D7.8010104@geo.uu.nl>
References: <AANLkTikRTKg4vG3eR_NcOyGYv6HhCTLT3dTDdE08YAZY@mail.gmail.com>
	<4C4418D7.8010104@geo.uu.nl>
Message-ID: <AANLkTilUCE_Fx6UgiOo4gG9j0wyPskWM3qbB3EW17mhj@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100719/87134f7c/attachment.pl>

From david.depew at queensu.ca  Mon Jul 19 18:04:49 2010
From: david.depew at queensu.ca (david.depew at queensu.ca)
Date: Mon, 19 Jul 2010 12:04:49 -0400
Subject: [R-sig-Geo] RSAGA - rsaga.geoprocessor crash
In-Reply-To: <70FC67C4A585D1489E66225A4E0238BA9AEC02@RZS-EXC-CL06.rz-sued.bayern.de>
References: <21065_1279551120_o6JEpwSE026552_fc839ad9791b.4c442e23@queensu.ca>
	<70FC67C4A585D1489E66225A4E0238BA9AEBE8@RZS-EXC-CL06.rz-sued.bayern.de>
	<f6cda3b475a7.4c4437a1@queensu.ca>
	<70FC67C4A585D1489E66225A4E0238BA9AEC02@RZS-EXC-CL06.rz-sued.bayern.de>
Message-ID: <f882a9414ad.4c443f61@queensu.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100719/8bd344fa/attachment.pl>

From Roger.Bivand at nhh.no  Mon Jul 19 18:09:53 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jul 2010 18:09:53 +0200 (CEST)
Subject: [R-sig-Geo] How to replace coordinates of Polygons
In-Reply-To: <4C445F4C.1060800@tufts.edu>
References: <4C445F4C.1060800@tufts.edu>
Message-ID: <alpine.LRH.2.00.1007191806300.12202@reclus.nhh.no>

On Mon, 19 Jul 2010, Ben Mazzotta wrote:

> Dear R geographers:
>
> I'm able to replace the coordinates of any given polygon, but not construct 
> apply() family commands or for() loops to accomplish the same task. How can I 
> construct a simple loop or apply() command that will sequentially replace all 
> of the coordinates in a SpatialPolygons object?

Just build lists of new Polygon then Polygons objects, and build a new 
SpatialPolygons at the end. I don't think that you'll see big memory 
problems, and the approach you propose will probably have poor timings, 
because the containing objects will probably be rebuilt for each update.

Are you looking for the elide() method for SpatialPolygons in maptools? Do 
you need an extra operation added to it?

Roger


>
> As far as I understand, the coordinates of a polygon are kept in a slot 
> referred as follows:
> map at polygons[[x]]@Polygons[[y]]@coords
>
> Using which, I can create mapply(foo, indexp, indexP) commands to extract the 
> original coordinates and transform them.
>
> # Define a pair of vectors indexp, indexP that together index every Polyon in 
> the SpatialPolygons object map.
> # Then extract coordinates as follows:
> coords <- function(x,y) {map at polygons[[indexp]]@Polygons[[indexP]]@coords}
> # Or operate a function foo on the old coordinates
> coords.alt <- mapply(foo, 
> map at polygons[[indexp]]@Polygons[[indexP]]@coords[,1], 
> map at polygons[[indexp]]@Polygons[[indexP]]@coords[,2])
>
> So I can create lists and matrices of coordinates, and transform the 
> coordinates.
>
> It is possible to write a command that replaces coordinates using integers; 
> but these commands fail when I attempt to use mapply() to replace existing 
> coordinates. For example,
>
> p at polygons[[1]]@Polygons[[1]]@coords <- foo(1,1)
>
> will work fine, but the following will not.
>
> newcoords <- function(indp, indP) {
>    p at polygons[[indp]]@Polygons[[indP]]@coords <- foo(indp, indP)
>    }
> mapply(newcoords, indexp, indexP)
>
>
> Have I missed something in the manual on coordinates that would enable me to 
> transform the coordinates of all the Polygons in a SpatialPolygonsDataFrame 
> according to some regular function of the old coordinates (x,y)? Is the only 
> alternative to build a new SpatialPolygons data frame from scratch, beginning 
> with the new coordinates?
>
> If it would be useful, I can provide sample code that works on wrld_simpl.
>
> Please advise. Thank you!
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From benjamin.mazzotta at tufts.edu  Mon Jul 19 18:26:04 2010
From: benjamin.mazzotta at tufts.edu (Ben Mazzotta)
Date: Mon, 19 Jul 2010 12:26:04 -0400
Subject: [R-sig-Geo] How to replace coordinates of Polygons
In-Reply-To: <alpine.LRH.2.00.1007191806300.12202@reclus.nhh.no>
References: <4C445F4C.1060800@tufts.edu>
	<alpine.LRH.2.00.1007191806300.12202@reclus.nhh.no>
Message-ID: <4C447C9C.1050608@tufts.edu>

Thank you very much, Roger.

I was afraid that might be the answer. Once I have the new Polygon and 
Polygons objects, how can I merge all the slots from the old Polygon and 
Polygons to the new Polygon and Polygons objects? Ultimately I'd like to 
bring the other fields from the old object into the new one.


The context is this: I am transforming the coordinates using the 
cartogram() function from {Rcartogram}. The argument to cartogram() is a 
rectangular matrix, which contains sample densities of a statistic at 
regular intervals over the map. Cartogram() returns a lookup table in 
the form of two matrices, which specify x_new as a function of (x_old, 
y_old) and y_new, again as a function of (x_old, y_old). After cleaning 
up missing observations, I can interpolate new coordinates for every 
pair of old coordinates.

Therefore, I'd like to create a new version of the world map by 
transforming every pair of coordinates in the original polygon.






On 07/19/2010 12:09 PM, Roger Bivand wrote:
> On Mon, 19 Jul 2010, Ben Mazzotta wrote:
>
>> Dear R geographers:
>>
>> I'm able to replace the coordinates of any given polygon, but not 
>> construct apply() family commands or for() loops to accomplish the 
>> same task. How can I construct a simple loop or apply() command that 
>> will sequentially replace all of the coordinates in a SpatialPolygons 
>> object?
>
> Just build lists of new Polygon then Polygons objects, and build a new 
> SpatialPolygons at the end. I don't think that you'll see big memory 
> problems, and the approach you propose will probably have poor 
> timings, because the containing objects will probably be rebuilt for 
> each update.
>
> Are you looking for the elide() method for SpatialPolygons in 
> maptools? Do you need an extra operation added to it?
>
> Roger
>
>
>>
>> As far as I understand, the coordinates of a polygon are kept in a 
>> slot referred as follows:
>> map at polygons[[x]]@Polygons[[y]]@coords
>>
>> Using which, I can create mapply(foo, indexp, indexP) commands to 
>> extract the original coordinates and transform them.
>>
>> # Define a pair of vectors indexp, indexP that together index every 
>> Polyon in the SpatialPolygons object map.
>> # Then extract coordinates as follows:
>> coords <- function(x,y) 
>> {map at polygons[[indexp]]@Polygons[[indexP]]@coords}
>> # Or operate a function foo on the old coordinates
>> coords.alt <- mapply(foo, 
>> map at polygons[[indexp]]@Polygons[[indexP]]@coords[,1], 
>> map at polygons[[indexp]]@Polygons[[indexP]]@coords[,2])
>>
>> So I can create lists and matrices of coordinates, and transform the 
>> coordinates.
>>
>> It is possible to write a command that replaces coordinates using 
>> integers; but these commands fail when I attempt to use mapply() to 
>> replace existing coordinates. For example,
>>
>> p at polygons[[1]]@Polygons[[1]]@coords <- foo(1,1)
>>
>> will work fine, but the following will not.
>>
>> newcoords <- function(indp, indP) {
>>    p at polygons[[indp]]@Polygons[[indP]]@coords <- foo(indp, indP)
>>    }
>> mapply(newcoords, indexp, indexP)
>>
>>
>> Have I missed something in the manual on coordinates that would 
>> enable me to transform the coordinates of all the Polygons in a 
>> SpatialPolygonsDataFrame according to some regular function of the 
>> old coordinates (x,y)? Is the only alternative to build a new 
>> SpatialPolygons data frame from scratch, beginning with the new 
>> coordinates?
>>
>> If it would be useful, I can provide sample code that works on 
>> wrld_simpl.
>>
>> Please advise. Thank you!
>>
>>
>>
>

-- 
Ben Mazzotta, PhD Candidate
The Fletcher School, Tufts University
benjamin.mazzotta at tufts.edu


From Roger.Bivand at nhh.no  Mon Jul 19 19:30:19 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 19 Jul 2010 19:30:19 +0200 (CEST)
Subject: [R-sig-Geo] How to replace coordinates of Polygons
In-Reply-To: <4C447C9C.1050608@tufts.edu>
References: <4C445F4C.1060800@tufts.edu>
	<alpine.LRH.2.00.1007191806300.12202@reclus.nhh.no>
	<4C447C9C.1050608@tufts.edu>
Message-ID: <alpine.LRH.2.00.1007191913140.12202@reclus.nhh.no>

On Mon, 19 Jul 2010, Ben Mazzotta wrote:

> Thank you very much, Roger.
>
> I was afraid that might be the answer. Once I have the new Polygon and 
> Polygons objects, how can I merge all the slots from the old Polygon and 
> Polygons to the new Polygon and Polygons objects? Ultimately I'd like to 
> bring the other fields from the old object into the new one.

If they have the same IDs, no problem, just make a 
SpatialPolygonsDataFrame with data=as(old, "data.frame").

>
>
> The context is this: I am transforming the coordinates using the cartogram() 
> function from {Rcartogram}. The argument to cartogram() is a rectangular 
> matrix, which contains sample densities of a statistic at regular intervals 
> over the map. Cartogram() returns a lookup table in the form of two matrices, 
> which specify x_new as a function of (x_old, y_old) and y_new, again as a 
> function of (x_old, y_old). After cleaning up missing observations, I can 
> interpolate new coordinates for every pair of old coordinates.
>
> Therefore, I'd like to create a new version of the world map by transforming 
> every pair of coordinates in the original polygon.

Firstly, the input is a planar grid of values of a variable, so the 
queries on the two output grids need to accommodate the loss of resolution 
implied there. Try on something simple first. If you can get a wrapper 
around cartogram() to take a SpatialPolygonsDataFrame, make a grid from it 
for the chosen variable (including NA handling), then do cartogram, 
followed by interpolation for Polygons object by Polygons object (remember 
objects may be multiple Polygon objects, and may have holes), you may be 
able to get there. Constructing the output objects from computed 
coordinates looks like the least of your challenges.

Good luck!

Roger



>
>
>
>
>
>
> On 07/19/2010 12:09 PM, Roger Bivand wrote:
>> On Mon, 19 Jul 2010, Ben Mazzotta wrote:
>> 
>>> Dear R geographers:
>>> 
>>> I'm able to replace the coordinates of any given polygon, but not 
>>> construct apply() family commands or for() loops to accomplish the same 
>>> task. How can I construct a simple loop or apply() command that will 
>>> sequentially replace all of the coordinates in a SpatialPolygons object?
>> 
>> Just build lists of new Polygon then Polygons objects, and build a new 
>> SpatialPolygons at the end. I don't think that you'll see big memory 
>> problems, and the approach you propose will probably have poor timings, 
>> because the containing objects will probably be rebuilt for each update.
>> 
>> Are you looking for the elide() method for SpatialPolygons in maptools? Do 
>> you need an extra operation added to it?
>> 
>> Roger
>> 
>> 
>>> 
>>> As far as I understand, the coordinates of a polygon are kept in a slot 
>>> referred as follows:
>>> map at polygons[[x]]@Polygons[[y]]@coords
>>> 
>>> Using which, I can create mapply(foo, indexp, indexP) commands to extract 
>>> the original coordinates and transform them.
>>> 
>>> # Define a pair of vectors indexp, indexP that together index every Polyon 
>>> in the SpatialPolygons object map.
>>> # Then extract coordinates as follows:
>>> coords <- function(x,y) {map at polygons[[indexp]]@Polygons[[indexP]]@coords}
>>> # Or operate a function foo on the old coordinates
>>> coords.alt <- mapply(foo, 
>>> map at polygons[[indexp]]@Polygons[[indexP]]@coords[,1], 
>>> map at polygons[[indexp]]@Polygons[[indexP]]@coords[,2])
>>> 
>>> So I can create lists and matrices of coordinates, and transform the 
>>> coordinates.
>>> 
>>> It is possible to write a command that replaces coordinates using 
>>> integers; but these commands fail when I attempt to use mapply() to 
>>> replace existing coordinates. For example,
>>> 
>>> p at polygons[[1]]@Polygons[[1]]@coords <- foo(1,1)
>>> 
>>> will work fine, but the following will not.
>>> 
>>> newcoords <- function(indp, indP) {
>>>    p at polygons[[indp]]@Polygons[[indP]]@coords <- foo(indp, indP)
>>>    }
>>> mapply(newcoords, indexp, indexP)
>>> 
>>> 
>>> Have I missed something in the manual on coordinates that would enable me 
>>> to transform the coordinates of all the Polygons in a 
>>> SpatialPolygonsDataFrame according to some regular function of the old 
>>> coordinates (x,y)? Is the only alternative to build a new SpatialPolygons 
>>> data frame from scratch, beginning with the new coordinates?
>>> 
>>> If it would be useful, I can provide sample code that works on wrld_simpl.
>>> 
>>> Please advise. Thank you!
>>> 
>>> 
>>> 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From benjamin.mazzotta at tufts.edu  Mon Jul 19 19:40:34 2010
From: benjamin.mazzotta at tufts.edu (Ben Mazzotta)
Date: Mon, 19 Jul 2010 13:40:34 -0400
Subject: [R-sig-Geo] How to replace coordinates of Polygons
In-Reply-To: <alpine.LRH.2.00.1007191913140.12202@reclus.nhh.no>
References: <4C445F4C.1060800@tufts.edu>
	<alpine.LRH.2.00.1007191806300.12202@reclus.nhh.no>
	<4C447C9C.1050608@tufts.edu>
	<alpine.LRH.2.00.1007191913140.12202@reclus.nhh.no>
Message-ID: <4C448E12.9030203@tufts.edu>

Extremly helpful. Thanks again.

On 07/19/2010 01:30 PM, Roger Bivand wrote:
> On Mon, 19 Jul 2010, Ben Mazzotta wrote:
>
>> Thank you very much, Roger.
>>
>> I was afraid that might be the answer. Once I have the new Polygon 
>> and Polygons objects, how can I merge all the slots from the old 
>> Polygon and Polygons to the new Polygon and Polygons objects? 
>> Ultimately I'd like to bring the other fields from the old object 
>> into the new one.
>
> If they have the same IDs, no problem, just make a 
> SpatialPolygonsDataFrame with data=as(old, "data.frame").
>
>>
>>
>> The context is this: I am transforming the coordinates using the 
>> cartogram() function from {Rcartogram}. The argument to cartogram() 
>> is a rectangular matrix, which contains sample densities of a 
>> statistic at regular intervals over the map. Cartogram() returns a 
>> lookup table in the form of two matrices, which specify x_new as a 
>> function of (x_old, y_old) and y_new, again as a function of (x_old, 
>> y_old). After cleaning up missing observations, I can interpolate new 
>> coordinates for every pair of old coordinates.
>>
>> Therefore, I'd like to create a new version of the world map by 
>> transforming every pair of coordinates in the original polygon.
>
> Firstly, the input is a planar grid of values of a variable, so the 
> queries on the two output grids need to accommodate the loss of 
> resolution implied there. Try on something simple first. If you can 
> get a wrapper around cartogram() to take a SpatialPolygonsDataFrame, 
> make a grid from it for the chosen variable (including NA handling), 
> then do cartogram, followed by interpolation for Polygons object by 
> Polygons object (remember objects may be multiple Polygon objects, and 
> may have holes), you may be able to get there. Constructing the output 
> objects from computed coordinates looks like the least of your 
> challenges.
>
> Good luck!
>
> Roger
>
>
>
>>
>>
>>
>>
>>
>>
>> On 07/19/2010 12:09 PM, Roger Bivand wrote:
>>> On Mon, 19 Jul 2010, Ben Mazzotta wrote:
>>>
>>>> Dear R geographers:
>>>>
>>>> I'm able to replace the coordinates of any given polygon, but not 
>>>> construct apply() family commands or for() loops to accomplish the 
>>>> same task. How can I construct a simple loop or apply() command 
>>>> that will sequentially replace all of the coordinates in a 
>>>> SpatialPolygons object?
>>>
>>> Just build lists of new Polygon then Polygons objects, and build a 
>>> new SpatialPolygons at the end. I don't think that you'll see big 
>>> memory problems, and the approach you propose will probably have 
>>> poor timings, because the containing objects will probably be 
>>> rebuilt for each update.
>>>
>>> Are you looking for the elide() method for SpatialPolygons in 
>>> maptools? Do you need an extra operation added to it?
>>>
>>> Roger
>>>
>>>
>>>>
>>>> As far as I understand, the coordinates of a polygon are kept in a 
>>>> slot referred as follows:
>>>> map at polygons[[x]]@Polygons[[y]]@coords
>>>>
>>>> Using which, I can create mapply(foo, indexp, indexP) commands to 
>>>> extract the original coordinates and transform them.
>>>>
>>>> # Define a pair of vectors indexp, indexP that together index every 
>>>> Polyon in the SpatialPolygons object map.
>>>> # Then extract coordinates as follows:
>>>> coords <- function(x,y) 
>>>> {map at polygons[[indexp]]@Polygons[[indexP]]@coords}
>>>> # Or operate a function foo on the old coordinates
>>>> coords.alt <- mapply(foo, 
>>>> map at polygons[[indexp]]@Polygons[[indexP]]@coords[,1], 
>>>> map at polygons[[indexp]]@Polygons[[indexP]]@coords[,2])
>>>>
>>>> So I can create lists and matrices of coordinates, and transform 
>>>> the coordinates.
>>>>
>>>> It is possible to write a command that replaces coordinates using 
>>>> integers; but these commands fail when I attempt to use mapply() to 
>>>> replace existing coordinates. For example,
>>>>
>>>> p at polygons[[1]]@Polygons[[1]]@coords <- foo(1,1)
>>>>
>>>> will work fine, but the following will not.
>>>>
>>>> newcoords <- function(indp, indP) {
>>>>    p at polygons[[indp]]@Polygons[[indP]]@coords <- foo(indp, indP)
>>>>    }
>>>> mapply(newcoords, indexp, indexP)
>>>>
>>>>
>>>> Have I missed something in the manual on coordinates that would 
>>>> enable me to transform the coordinates of all the Polygons in a 
>>>> SpatialPolygonsDataFrame according to some regular function of the 
>>>> old coordinates (x,y)? Is the only alternative to build a new 
>>>> SpatialPolygons data frame from scratch, beginning with the new 
>>>> coordinates?
>>>>
>>>> If it would be useful, I can provide sample code that works on 
>>>> wrld_simpl.
>>>>
>>>> Please advise. Thank you!
>>>>
>>>>
>>>>
>>>
>>
>>
>

-- 
Ben Mazzotta, PhD Candidate
The Fletcher School, Tufts University
benjamin.mazzotta at tufts.edu


From edzer.pebesma at uni-muenster.de  Mon Jul 19 23:59:30 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 19 Jul 2010 23:59:30 +0200
Subject: [R-sig-Geo] scale semivariance befor fit.variogram
In-Reply-To: <AANLkTilUCE_Fx6UgiOo4gG9j0wyPskWM3qbB3EW17mhj@mail.gmail.com>
References: <AANLkTikRTKg4vG3eR_NcOyGYv6HhCTLT3dTDdE08YAZY@mail.gmail.com>	<4C4418D7.8010104@geo.uu.nl>
	<AANLkTilUCE_Fx6UgiOo4gG9j0wyPskWM3qbB3EW17mhj@mail.gmail.com>
Message-ID: <4C44CAC2.7040900@uni-muenster.de>

The problem is not gstat using floats (it doesn't), it's roughly using
the normal equations to solve a regression problem -- this calls for a
sum of squared values matrix X'X, if the values then are too far apart,
as it seems in your case, even double arithmetic runs into an explosion
of numeric errors.

On 07/19/2010 05:44 PM, Samuel Turgeon wrote:
> Thanks Paul,
> 
> I understand that I can multiplied my data without problem but I'm still
> wondering why I have to this operation. Maybe it's about the precision
> floats in gstat like you said.
> 
> regards,
> Sam
> 
> 2010/7/19 Paul Hiemstra <p.hiemstra at geo.uu.nl>
> 
>> On 07/17/2010 06:19 PM, Samuel Turgeon wrote:
>>
>>> Hi,
>>>
>>> I'm a new user of gstat, so my question is maybe very simple.
>>>
>>> I'm trying to fit a variogram with the function fit.variogram and I get
>>> this
>>> error message:
>>>
>>> Warning: singular model in variogram fit
>>> [1] "a possible solution MIGHT be to scale semivariances and/or distances"
>>>
>>> My data have values between 2.54e-10  et 2.56e-06. If I multiply my data
>>> by
>>> a constant in the semivariogram:
>>>
>>> vario=variogram(NASC*10000000~1,data,cutoff=1000)
>>>
>>> When I do this multiplication I'm able to fit a variogram.
>>>
>>> So my question is, Is it possible to this? Can I back transform (by a
>>> division) my predited values when the ordinary kriging will be done?
>>>
>>>
>>
>> Hi Sam,
>>
>> It is possible, probably the covariance matrix has a lot of zeros because
>> of rounding of your small values. Could this be linked to using single
>> precision floats in gstat (edzer?)? I think there is no problem in
>> 'backtransforming' your values, i.e. you only change the unit of the
>> variable you are using (e.g. from milligram to microgram). Take care though
>> that when predicting whilst using the fitted variogram model, your
>> observations also need to be multiplied by this constant. My suggestion
>> would be to multiply the data at the very beginning of the script, do all
>> you analysis and at the very end do the division. You could also skip the
>> division and present your results in the new unit.
>>
>> regards,
>> Paul
>>
>>  Thanks!
>>>
>>> Sam
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>>
>> --
>> Drs. Paul Hiemstra
>> Department of Physical Geography
>> Faculty of Geosciences
>> University of Utrecht
>> Heidelberglaan 2
>> P.O. Box 80.115
>> 3508 TC Utrecht
>> Phone:  +3130 253 5773
>> http://intamap.geo.uu.nl/~paul <http://intamap.geo.uu.nl/%7Epaul>
>> http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From pierre.roudier at gmail.com  Tue Jul 20 00:16:43 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Tue, 20 Jul 2010 10:16:43 +1200
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
	source)
In-Reply-To: <alpine.LRH.2.00.1007191155310.3716@reclus.nhh.no>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com> 
	<alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
	<AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com> 
	<alpine.LRH.2.00.1007191100420.3716@reclus.nhh.no>
	<AANLkTin40gijgTa6h-NfKlkT7mfFVwToBJwe7MZzV9Lz@mail.gmail.com> 
	<alpine.LRH.2.00.1007191117440.3716@reclus.nhh.no>
	<AANLkTim6OdLfAMFaQDoSWDVaBt_x0D8_jM_1cTzRD3K5@mail.gmail.com> 
	<alpine.LRH.2.00.1007191155310.3716@reclus.nhh.no>
Message-ID: <AANLkTikXfjCx-6r8qRpLLhnQQKwtig3zHSrdFwg7iHYU@mail.gmail.com>

> There must still be messes left around in various places. Does using locate,
> for example locate libgdal and locate gdalplugins help? Otherwise remove and
> reinstall PROJ.4 and GDAL. Most likely debris after experiments with the
> GRASS plugin (and maybe QGIS) are still around.

Here are the outputs of  locate libgdal and locate gdalplugins (as su):

# locate gdalplugins
(no files found, as I deleted the whole folder)

# locate libgdal
...some files in my home from the src package...
/usr/lib64/ogdi/libgdal.so
/usr/local/lib/libgdal.a
/usr/local/lib/libgdal.la
/usr/local/lib/libgdal.so
/usr/local/lib/libgdal.so.1
/usr/local/lib/libgdal.so.1.14.2

# ls -l /usr/local/lib/libgdal*
-rw-r--r--. 1 root root 65383080 Jul 19 17:42 /usr/local/lib/libgdal.a
-rwxr-xr-x. 1 root root     1038 Jul 19 17:42 /usr/local/lib/libgdal.la
lrwxrwxrwx. 1 root root       17 Jul 19 17:42
/usr/local/lib/libgdal.so -> libgdal.so.1.14.2
lrwxrwxrwx. 1 root root       17 Jul 19 17:42
/usr/local/lib/libgdal.so.1 -> libgdal.so.1.14.2
-rwxr-xr-x. 1 root root 29847891 Jul 19 17:42 /usr/local/lib/libgdal.so.1.14.2

The latter command is probably interesting - actually the libgdal.so.1
on my system is a symlink to /usr/local/lib/libgdal.so.1.14.2.
Unfortunately, I don't really understand the meaning of those
different libgdal*

I appreciate your valuable help Roger, and any hint on that is most
welcome. As the problem seems to relate more on GDAL than R, I'll
probably drop a line to the GDAL-dev mailing list.

Cheers,

Pierre

>
> Roger
>
>>
>> Thanks anyway,
>>
>> Pierre
>>
>>>
>>> Roger
>>>
>>>>
>>>> Thanks again,
>>>>
>>>> Pierre
>>>>
>>>>
>>>>>
>>>>> Roger
>>>>>
>>>>>>
>>>>>> Thanks for the help,
>>>>>>
>>>>>> Pierre
>>>>>>
>>>>>>>
>>>>>>> Hope this helps,
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>>
>>>>>>>> Thanks for any hints.
>>>>>>>>
>>>>>>>> Here is my config:
>>>>>>>>
>>>>>>>> uname -a
>>>>>>>> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
>>>>>>>> x86_64 x86_64 x86_64 GNU/Linux
>>>>>>>>
>>>>>>>> Distro : Fedora 13 x86_64 (running KDE)
>>>>>>>>
>>>>>>>> gdalinfo --version
>>>>>>>> GDAL 1.7.2, released 2010/04/23
>>>>>>>>
>>>>>>>> The infamous libgdal.so file is located in /usr/local/lib/
>>>>>>>>
>>>>>>>> sessionInfo()
>>>>>>>> R version 2.11.1 (2010-05-31)
>>>>>>>> x86_64-redhat-linux-gnu
>>>>>>>>
>>>>>>>> locale:
>>>>>>>> [1] LC_CTYPE=en_US.UTF-8 ? ? ? LC_NUMERIC=C
>>>>>>>> [3] LC_TIME=en_US.UTF-8 ? ? ? ?LC_COLLATE=en_US.UTF-8
>>>>>>>> [5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_US.UTF-8
>>>>>>>> [7] LC_PAPER=en_US.UTF-8 ? ? ? LC_NAME=C
>>>>>>>> [9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
>>>>>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>>>>>
>>>>>>>> attached base packages:
>>>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>>>>>
>>>>>>>> loaded via a namespace (and not attached):
>>>>>>>> [1] tcltk_2.11.1 tools_2.11.1
>>>>>>>>
>>>>>>>> Cheers,
>>>>>>>>
>>>>>>>> Pierre
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> Roger Bivand
>>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>>> of
>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> Roger Bivand
>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>> of
>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>>
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From Jin.Li at ga.gov.au  Tue Jul 20 01:53:20 2010
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Tue, 20 Jul 2010 09:53:20 +1000
Subject: [R-sig-Geo] Parallel or 64-bit PC with a big RAM? [SEC=UNCLASSIFIED]
Message-ID: <8D2A822B1C6C2A44ABEB777AA83FA0E33320CF9F7B@EXCCR01.agso.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100720/adf9d207/attachment.pl>

From pierre.roudier at gmail.com  Tue Jul 20 05:55:58 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Tue, 20 Jul 2010 15:55:58 +1200
Subject: [R-sig-Geo] rgdal install fails (following GDAL building from
	source)
In-Reply-To: <alpine.LRH.2.00.1007191155310.3716@reclus.nhh.no>
References: <AANLkTimowRUx4w8XangB-9FUHjGfafv7awr_uocIB9UA@mail.gmail.com> 
	<alpine.LRH.2.00.1007191009010.3716@reclus.nhh.no>
	<AANLkTikJrI9IFebTGgBdMgpUSzyhbBlRFa3jdbQcGhcD@mail.gmail.com> 
	<alpine.LRH.2.00.1007191100420.3716@reclus.nhh.no>
	<AANLkTin40gijgTa6h-NfKlkT7mfFVwToBJwe7MZzV9Lz@mail.gmail.com> 
	<alpine.LRH.2.00.1007191117440.3716@reclus.nhh.no>
	<AANLkTim6OdLfAMFaQDoSWDVaBt_x0D8_jM_1cTzRD3K5@mail.gmail.com> 
	<alpine.LRH.2.00.1007191155310.3716@reclus.nhh.no>
Message-ID: <AANLkTimGQm9XdP1ypsRP4FGlyxxA81ucRhWYOSeCbbJe@mail.gmail.com>

I finally got the problem: there was a mistake within my
/etc/ld.so.conf.d file that linked the libgdal library into the
system.

For the record, my mistake was to put the full path to the file plus
the filename:

$ cat /etc/ld.so.conf.d/gdal.conf
/usr/local/lib/libgdal.so.1

I resolved the problem simply by modifying /etc/ld.so.conf.d/gdal.conf
to /usr/local/lib, and ldconfig as su.

Pierre

2010/7/19 Roger Bivand <Roger.Bivand at nhh.no>:
> On Mon, 19 Jul 2010, Pierre Roudier wrote:
>
>>> I think that there is a GDAL plugins directory somewhere in /usr/local -
>>> if
>>> it is there, it contains a reference to your previous GDAL install,
>>> probably
>>> called gdalplugins. Try removing it, or changing its name.
>>
>> Yes, there was a gdalplugins folder in /usr/lib/, containing
>> ogr_GRASS.so. I removed the whole folder, but unfortunatley, the same
>> error is appearing on compilation of rgdal.
>
> There must still be messes left around in various places. Does using locate,
> for example locate libgdal and locate gdalplugins help? Otherwise remove and
> reinstall PROJ.4 and GDAL. Most likely debris after experiments with the
> GRASS plugin (and maybe QGIS) are still around.
>
> Roger
>
>>
>> Thanks anyway,
>>
>> Pierre
>>
>>>
>>> Roger
>>>
>>>>
>>>> Thanks again,
>>>>
>>>> Pierre
>>>>
>>>>
>>>>>
>>>>> Roger
>>>>>
>>>>>>
>>>>>> Thanks for the help,
>>>>>>
>>>>>> Pierre
>>>>>>
>>>>>>>
>>>>>>> Hope this helps,
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>>
>>>>>>>> Thanks for any hints.
>>>>>>>>
>>>>>>>> Here is my config:
>>>>>>>>
>>>>>>>> uname -a
>>>>>>>> Linux 2.6.33.6-147.fc13.x86_64 #1 SMP Tue Jul 6 22:32:17 UTC 2010
>>>>>>>> x86_64 x86_64 x86_64 GNU/Linux
>>>>>>>>
>>>>>>>> Distro : Fedora 13 x86_64 (running KDE)
>>>>>>>>
>>>>>>>> gdalinfo --version
>>>>>>>> GDAL 1.7.2, released 2010/04/23
>>>>>>>>
>>>>>>>> The infamous libgdal.so file is located in /usr/local/lib/
>>>>>>>>
>>>>>>>> sessionInfo()
>>>>>>>> R version 2.11.1 (2010-05-31)
>>>>>>>> x86_64-redhat-linux-gnu
>>>>>>>>
>>>>>>>> locale:
>>>>>>>> [1] LC_CTYPE=en_US.UTF-8 ? ? ? LC_NUMERIC=C
>>>>>>>> [3] LC_TIME=en_US.UTF-8 ? ? ? ?LC_COLLATE=en_US.UTF-8
>>>>>>>> [5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_US.UTF-8
>>>>>>>> [7] LC_PAPER=en_US.UTF-8 ? ? ? LC_NAME=C
>>>>>>>> [9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
>>>>>>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>>>>>>
>>>>>>>> attached base packages:
>>>>>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>>>>>
>>>>>>>> loaded via a namespace (and not attached):
>>>>>>>> [1] tcltk_2.11.1 tools_2.11.1
>>>>>>>>
>>>>>>>> Cheers,
>>>>>>>>
>>>>>>>> Pierre
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>
>>>>>>> --
>>>>>>> Roger Bivand
>>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>>> of
>>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> Roger Bivand
>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>> of
>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>>
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From r.hijmans at gmail.com  Tue Jul 20 07:59:53 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 19 Jul 2010 22:59:53 -0700
Subject: [R-sig-Geo] Parallel or 64-bit PC with a big RAM?
	[SEC=UNCLASSIFIED]
In-Reply-To: <8D2A822B1C6C2A44ABEB777AA83FA0E33320CF9F7B@EXCCR01.agso.gov.au>
References: <8D2A822B1C6C2A44ABEB777AA83FA0E33320CF9F7B@EXCCR01.agso.gov.au>
Message-ID: <AANLkTin6zCsSsm4KvocSauyM5tHmjaq_kn6ssSvwZVPR@mail.gmail.com>

Hi Jin,

The model fitting problem would seem small enough for most computers
and methods. You could do the model prediction with the 'raster'
package that was designed to be able to handle very large datasets.
See ?raster::predict and raster::interpolate. Perhaps also consult the
'sdm' vignette for the 'dismo' package on R-Forge; it has examples (in
a species distribution modeling context) for the same methods you
mention.

Best, Robert

On Mon, Jul 19, 2010 at 4:53 PM,  <Jin.Li at ga.gov.au> wrote:
> Dear All,
> A group of us here need to make spatial predictions of environmental variables using methods in gstat, SVM in e1071, randomForest in randomForest in R. The dataset for model development may contain up to 80 variables with up to 15,000 rows and the dataset for prediction may contain up to 80 variables with up to 1 billion rows. The figures given here are extremes we are expecting, and of course we can reduce the variables for some methods but for some we need to use all variables. It seems we have two solutions at the moment: 1) run the modelling work on a cluster of computers and 2) run 64-bit R on a 64-bit computer for Windows with a big RAM. The questions are: can we do parallel computing using the packages listed if we choose option one? Or how big RAM do we need if we go option two? Any suggestions and comments are appreciated. Thanks in advance.
> Cheers,
> Jin
> ____________________________________
> Jin Li, PhD
> Spatial Modeller/Computational Statistician
> Marine & Coastal Environment
> Geoscience Australia
> GPO Box 378, Canberra, ACT 2601, Australia
> Ph: 61 (02) 6249 9899; email: jin.li at ga.gov.au<mailto:jin.li at ga.gov.au>
> _______________________________________
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Tue Jul 20 08:46:16 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 19 Jul 2010 23:46:16 -0700 (PDT)
Subject: [R-sig-Geo] Bug in rasterToPoints() ?
In-Reply-To: <625212.38870.qm@web23707.mail.ird.yahoo.com>
References: <AANLkTikVfLb8Wc52Ds7YBI2tgkNRUf1X4WvAWspfq_f2@mail.gmail.com>
	<625212.38870.qm@web23707.mail.ird.yahoo.com>
Message-ID: <1279608376915-5315475.post@n2.nabble.com>


While 
test <-rasterToPoints(Br025,fun=function(x){x>0},asSpatialPoints=T)
does not work, the following works:
> test <-rasterToPoints(Br025,fun=function(x){x>0},asSpatialPoints=F)
> test <- as.data.frame(test)
> coordinates(test) <- c("x","y")
> class(test)
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"
> test at proj4string <- CRS(projection(Br025))
> projection(test)
[1] "+proj=longlat +ellps=WGS84"

> summary(test)
Object of class SpatialPointsDataFrame
Coordinates:
    min   max
x -8.75 28.00
y 41.50 59.75
Is projected: FALSE 
proj4string : [+proj=longlat +ellps=WGS84]
Number of points: 2576
Data attributes:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.50    7.00   33.75  178.00  152.10 3638.00 

although the value of slot "Is projected:" indicates some problem.

Agus
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Bug-in-rasterToPoints-tp5294219p5315475.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mdsumner at gmail.com  Tue Jul 20 10:59:24 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 20 Jul 2010 18:59:24 +1000
Subject: [R-sig-Geo] rasterImage support in R > 2.11.0 (problem for Windows
	in SDI mode)
Message-ID: <AANLkTilaUS4CaihYAJKbJcOeQVkWdJ6p_zLBeK9Ul50C@mail.gmail.com>

Hello, this is just a note for new raster plotting support - and only
affects users of R for Windows in SDI mode (window application mode-
which is not the default install option).  It affects both 32- and
64-bit R on Windows.

The behaviour is a bit weird and subtle, so this should only be of
interest to Windows users in SDI, and only for the interactive default
windows() device as far as I can tell.

image.SpatialGridDataFrame now uses the base graphics function
rasterImage() by default - this change was added for sp_0.9-64, and
this allows for quite large (up to available memory capacity)
SpatialGrids to be plotted efficiently with image(x).

However, in SDI mode a fresh R session seems only to support five uses
of rasterImage() that are drawn to a new device - the sixth and
subsequent draws make no visible difference - until the device is
manually resized. The problem cannot be reproduced in a single
windows() session.

To reproduce, in a fresh R session (Windows > 2.11.0 in SDI mode):

## create a dummy dataset
m<- matrix(c(0.2, 0.4, 0.6, 0.8), 2, 2)

## simple helper function to open the windows() device and plot the matrix
draw.f<- function(x) {
   plot(0, xlim = c(0, 1), ylim = c(0, 1))
   rasterImage(x, 0, 0, 1, 1, interpolate = FALSE)
}

draw.f(m)

## repeat the following 2 lines five times:

dev.off()
draw.f(m)

On the fifth attempt, only the background plot appears - but the
raster is visible on resize of the windows() device.

I sent this to Paul Murrell, and with Duncan Murdoch he isolated it to
the SDI mode of Windows.

I don't know that there is any prospect of a fix - presumably it is
rather deep down in the graphics code for Windows, but this note might
save some frustation. If anyone can offer more information to track
down where the problem is coming from that would be good.


Cheers, Mike.

R version 2.11.1 (2010-05-31)
x86_64-pc-mingw32

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets  methods
[8] base



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From elaine.kuo.tw at gmail.com  Tue Jul 20 11:50:27 2010
From: elaine.kuo.tw at gmail.com (elaine kuo)
Date: Tue, 20 Jul 2010 17:50:27 +0800
Subject: [R-sig-Geo] error in errorsarlm
In-Reply-To: <alpine.LRH.2.00.1007171534310.22601@reclus.nhh.no>
References: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
	<alpine.LRH.2.00.1007162144300.19802@reclus.nhh.no>
	<AANLkTik9muDJNtOG4lyJXl2Fk96c3CRDJAZ6dNJDntvq@mail.gmail.com>
	<alpine.LRH.2.00.1007171534310.22601@reclus.nhh.no>
Message-ID: <AANLkTinWLIBpZQBFjANAgXkfXudfoUmGg8YGek3zD4R4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100720/280ce175/attachment.pl>

From aslantas at metu.edu.tr  Tue Jul 20 14:33:26 2010
From: aslantas at metu.edu.tr (Pinar Aslantas Bostan)
Date: Tue, 20 Jul 2010 15:33:26 +0300
Subject: [R-sig-Geo] categoric and dummy variables
Message-ID: <20100720153326.560841nc3rl7mzdi@horde.metu.edu.tr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100720/d8c02953/attachment.pl>

From Roger.Bivand at nhh.no  Tue Jul 20 15:25:51 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 20 Jul 2010 15:25:51 +0200 (CEST)
Subject: [R-sig-Geo] categoric and dummy variables
In-Reply-To: <20100720153326.560841nc3rl7mzdi@horde.metu.edu.tr>
References: <20100720153326.560841nc3rl7mzdi@horde.metu.edu.tr>
Message-ID: <alpine.LRH.2.00.1007201517120.18432@reclus.nhh.no>

On Tue, 20 Jul 2010, Pinar Aslantas Bostan wrote:

>
>
> Dear all,
>
> I am working with gwr function to predict precipitation distribution. I 
> have two datasets; first one is consisted of observation points (225 
> meteorological stations), and the second one is DEM points used to 
> obtain precipitation predictions over it. I am using these functions:

As I wrote when you asked five weeks ago, you need much more clarity in 
what you are doing and why. First try to use lm() to fit the model, and 
predict() from the lm fit and your newdata (dem).

Do look carefully at:

str(station)
summary(station)
str(dem)
summary(dem)

and check that the RHS variables match exactly (same name, same type - 
numerical or factor).

With regard to categorical variables, read up on factors. If you have 
factors, them lm() and gwr() - which uses lm() - will handle them 
correctly, as will the prediction, because dummies are generated 
internally. Read up on how the formula works.

Once this works for lm() and predict(), there is no good reason why it 
shouldn't work for gwr() - although the idea of using GWR for prediction 
does seem unjustified, because you can use local kriging with 
covariates for the same purpose.

Hope this helps,

Roger

>
> bw1=gwr.sel(log10(PREC)~V1+V2+V3+V4+V5+V6,data=station,adapt=T)

> gwr1<-gwr(log10(PREC)~V1+V2+V3+V4+V5+V6,data=station,adapt=bw1,
+ se.fit=T,hatmatrix=TRUE)

> gwr <-gwr(log10(PREC)~V1+V2+V3+V4+V5+V6, data=station, adapt=bw1, 
> fit.points = dem, predict=T, se.fit=T, fittedGWRobject=gwr1)
>
> From the independent variables, V1, V2 and V3 are continuous and V4, V5 
> and V6 are categorical variables. Categorical variables has 4, 6 and 8 
> classes respectively. Stations and DEM points has coded values for these 
> categorical variables. For example V5 has 6 land use classes.
>
> My first question is: Can R program understand and analyses that 
> categorical values as codes instead of for ex. magnitude while making 
> gwr analysis?
>
> My second question is about dummy variables. I converted my categorical 
> variables to dummy variables and then I tried to make gwr. But while 
> using 'fit.points=dem' gwr() gives error. I searched the internet, from 
> some of sources I read that dummy variables are not suitable for gwr 
> analysis. Are there anyone who has idea about using dummy variables in 
> gwr?
>
> Best regards,
> Pinar
>
> ----------------------------------------------------------------
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From renaud.lancelot at gmail.com  Tue Jul 20 15:26:04 2010
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Tue, 20 Jul 2010 15:26:04 +0200
Subject: [R-sig-Geo] rasterImage support in R > 2.11.0 (problem for
	Windows in SDI mode)
In-Reply-To: <AANLkTilaUS4CaihYAJKbJcOeQVkWdJ6p_zLBeK9Ul50C@mail.gmail.com>
References: <AANLkTilaUS4CaihYAJKbJcOeQVkWdJ6p_zLBeK9Ul50C@mail.gmail.com>
Message-ID: <AANLkTimEDJRsJiw1btYzgzxppGvnxA-P-xXahFVjQhPH@mail.gmail.com>

Thank you for this information. I was able to reproduce the problem
even after the first dev.off().

> sessionInfo()
R version 2.11.1 Patched (2010-06-08 r52227)
i386-pc-mingw32

locale:
[1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
LC_MONETARY=French_France.1252 LC_NUMERIC=C
[5] LC_TIME=French_France.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] fortunes_1.3-7

Cheers,

Renaud

2010/7/20 Michael Sumner <mdsumner at gmail.com>:
> Hello, this is just a note for new raster plotting support - and only
> affects users of R for Windows in SDI mode (window application mode-
> which is not the default install option). ?It affects both 32- and
> 64-bit R on Windows.
>
> The behaviour is a bit weird and subtle, so this should only be of
> interest to Windows users in SDI, and only for the interactive default
> windows() device as far as I can tell.
>
> image.SpatialGridDataFrame now uses the base graphics function
> rasterImage() by default - this change was added for sp_0.9-64, and
> this allows for quite large (up to available memory capacity)
> SpatialGrids to be plotted efficiently with image(x).
>
> However, in SDI mode a fresh R session seems only to support five uses
> of rasterImage() that are drawn to a new device - the sixth and
> subsequent draws make no visible difference - until the device is
> manually resized. The problem cannot be reproduced in a single
> windows() session.
>
> To reproduce, in a fresh R session (Windows > 2.11.0 in SDI mode):
>
> ## create a dummy dataset
> m<- matrix(c(0.2, 0.4, 0.6, 0.8), 2, 2)
>
> ## simple helper function to open the windows() device and plot the matrix
> draw.f<- function(x) {
> ? plot(0, xlim = c(0, 1), ylim = c(0, 1))
> ? rasterImage(x, 0, 0, 1, 1, interpolate = FALSE)
> }
>
> draw.f(m)
>
> ## repeat the following 2 lines five times:
>
> dev.off()
> draw.f(m)
>
> On the fifth attempt, only the background plot appears - but the
> raster is visible on resize of the windows() device.
>
> I sent this to Paul Murrell, and with Duncan Murdoch he isolated it to
> the SDI mode of Windows.
>
> I don't know that there is any prospect of a fix - presumably it is
> rather deep down in the graphics code for Windows, but this note might
> save some frustation. If anyone can offer more information to track
> down where the problem is coming from that would be good.
>
>
> Cheers, Mike.
>
> R version 2.11.1 (2010-05-31)
> x86_64-pc-mingw32
>
> locale:
> [1] LC_COLLATE=English_Australia.1252 ?LC_CTYPE=English_Australia.1252
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] tools ? ? stats ? ? graphics ?grDevices utils ? ? datasets ?methods
> [8] base
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/
<< EDEN International Conference, Montpellier,? 10-12 May 2010 >>
<<?? http://international-conference2010.eden-fp6project.net/? >>

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://umr-cmaee.cirad.fr/

Tel.? +33 4 67 59 37 17? -? Fax? +33 4 67 59 37 95
Secr. +33 4 67 59 37 37? - Cell. +33 6 77 52 08 69


From carstennh at aol.com  Tue Jul 20 15:27:45 2010
From: carstennh at aol.com (carstennh at aol.com)
Date: Tue, 20 Jul 2010 09:27:45 -0400
Subject: [R-sig-Geo] NA color composite
Message-ID: <8CCF6267908E08C-144C-A4E4@webmail-m030.sysops.aol.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100720/9353f6a7/attachment.pl>

From Roger.Bivand at nhh.no  Tue Jul 20 16:24:51 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 20 Jul 2010 16:24:51 +0200 (CEST)
Subject: [R-sig-Geo] error in errorsarlm
In-Reply-To: <AANLkTinWLIBpZQBFjANAgXkfXudfoUmGg8YGek3zD4R4@mail.gmail.com>
References: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
	<alpine.LRH.2.00.1007162144300.19802@reclus.nhh.no>
	<AANLkTik9muDJNtOG4lyJXl2Fk96c3CRDJAZ6dNJDntvq@mail.gmail.com>
	<alpine.LRH.2.00.1007171534310.22601@reclus.nhh.no>
	<AANLkTinWLIBpZQBFjANAgXkfXudfoUmGg8YGek3zD4R4@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007201614260.18432@reclus.nhh.no>

On Tue, 20 Jul 2010, elaine kuo wrote:

> Hello,
>
> Thanks for the always concerns.
> answering the previous questions first.
>
>
>>> 1. distance threshold
>>>
>>
>> But 9 what, metres, degrees? Should your code be:
>> cbind(datam$lat,datam$lon), as the normal ordering is eastings then
>> northings, not the opposite?
>
>
> =>   unit is degree, and the lat/lon is revised (thanks)
>
>>
>>
>>
>>>
>>> 9 is the cutting point for avoiding empty neighbour sets
>>>
>>
>> This is not a good reason, as graph neighbours can be sparse and link over
>> longer distances.
>>
>>
> =>   according to previous message with similar questions,
>        it is mentioned that including empty neighbor sets could be
> meaningless...
>        so, if empty neighbor sets are accepted here,
>        could there be anything needed to be cautious upon ?

Just do not use distance as a criterion when the observations are very 
irregularly spaced! Use perhaps a symmetricised k-nearest neighbour 
definition. And make sure that you do use Great Circle distances - you are 
not doing so now. With 200 neighbours, you have no viable spatial process, 
really.

You can accept no-neighbour observations when there is no good reason to 
suppose that they could interact, but then have to attend to your 
zero.policy settings. It all depends on what processes are thought to be 
causing the observations to influence each other.

>
>>
>>
>>> 2. dataset
>>> length(nb10)=4873.
>>> sum(card(nb10)=885478)
>>>
>>>
>> This gives an average of 181.7 neighbours per observation, and is the root
>> of the problem. The Chebyshev method uses a set of low powers of the
>> weights, which fill in quickly for large average numbers of neighbours. Did
>> you try the Matrix method (your error message suggests that you may have
>> done, but the code does not)?
>>
>> =>  "Matrix" tried but failed. The warning and code as below..
>
>
> 1. change method to Matrix
>
> Error in solve.default(-(mat), tol.solve = tol.solve) :
>
>  System calculation is specific, the condition is =5.14146e-17 (translated
> from Chinese)
>
> Warning messages:

Warning not a problem, but the error suggests scaling problems in the 
covariance matrix of the coefficients. The X variables are most likely 
measured in inappropriate metrics (some coefficients of size 1000, others 
of size 0.0001, for example).

Please find local help to resolve the underlying problems, related to why 
you want these weights, and why you are trying to fit this kind of model 
(that is: is your research question sensible and what authority 
(literature) do you have for your choices?). Solve all of the problems 
first on a small subset of your data, and scale up afterwards.

Roger

>
> 1: In determinant(x, TRUE) : This version of the Matrix package returns
>
> |determinant(L)| instead of determinant(A), i.e., a
>
> *DIFFERENT* value.
>
> If still necessary, do change your code, following
> http://matrix.r-forge.r-project.org
>
>
>
> 2: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,  :
>
>  not converged within order iterations
>
> 3: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,  :
>
>  not converged within order iterations
>
>
>
>
>
> code
>
>
>
> rm(list=ls())
>
> datam <-read.csv("c:/migration/M_R_2090707_winterM.csv",header=T,
> row.names=1)
>
> dim(datam)
>
> datam[1,]
>
>
>
> library(ncf)
>
> library(spdep)
>
>
>
> # Define coordinates, neighbours, and spatial weights
>
> coords<-cbind(datam$lon,datam$lat)
>
> coords<-as.matrix(coords)
>
>
>
> #Define neighbourhood (here distance 9)
>
> nb9<-dnearneigh(coords,0,9)
>
>
>
> length(nb9)
>
> sum(card(nb9))
>
>
>
> #Spatial weights, illustrated with coding style "W" (row standardized)
>
> nb9.w<-nb2listw(nb9, glist=NULL, style="W", zero.policy=FALSE)
>
>
>
> # Spatial SAR error model
>
> sem.nb9.w <-
> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
> +datam$temp_min+datam$evi_min, data=datam, listw=nb9.w, na.action=na.omit,
> method="Matrix", zero.policy=TRUE,,tol.solve=1.0e-17)
>
>
>
>>
>>  3. memory size
>>> the memory limit is 1535 Mb, which is much larger than 121.8 Mb.
>>>
>>>
>> Windows (your OS?) memory handling is very poor for larger objects, and the
>> 121Mb is extra memory needed.
>
>
>
> =>  OS : Vista HOME
>
>
>
>> However, the main problem is your design of weights, which are far too
>> dense to make sense. Choose an alternative weights definition and try again.
>>
>
> => 2.  decrease the neighbor distance from 9 to 5
>
> Warning messages:
>
> 1: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,  :
>
>  not converged within order iterations
>
> 2: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,  :
>
>  not converged within order iterations
>
>
>
>
>
>
>
> code
>
> rm(list=ls())
>
> datam <-read.csv("c:/migration/M_R_20100707_winterM.csv",header=T,
> row.names=1)
>
> dim(datam)
>
> datam[1,]
>
>
>
> library(ncf)
>
> library(spdep)
>
>
>
> # Define coordinates, neighbours, and spatial weights
>
> coords<-cbind(datam$lon,datam$lat)
>
> coords<-as.matrix(coords)
>
>
>
> #Define neighbourhood (here distance 5)
>
> nb5<-dnearneigh(coords,0,5)
>
>
>
> #Spatial weights, illustrated with coding style "W" (row standardized)
>
> nb5.w<-nb2listw(nb5, glist=NULL, style="W", zero.policy=TRUE)
>
>
>
>
>
> # Spatial SAR error model
> sem.nb5.w <-
> errorsarlm(datam$WinterM_ratio~datam$topo_mean+datam$coast+datam$prec_max
> +datam$temp_min+datam$evi_min, data=datam, listw=nb5.w, na.action=na.omit,
> method="Chebyshev", zero.policy=TRUE,,tol.solve=1.0e-17)
>
> Elaine
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Tue Jul 20 18:34:01 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 20 Jul 2010 09:34:01 -0700
Subject: [R-sig-Geo] Bug in rasterToPoints() ?
In-Reply-To: <1279608376915-5315475.post@n2.nabble.com>
References: <AANLkTikVfLb8Wc52Ds7YBI2tgkNRUf1X4WvAWspfq_f2@mail.gmail.com>
	<625212.38870.qm@web23707.mail.ird.yahoo.com>
	<1279608376915-5315475.post@n2.nabble.com>
Message-ID: <AANLkTimnfQJZPmzPLQLF0_UNVkvlvD-1HKqXd1ENbETY@mail.gmail.com>

Thanks Agus, I fixed this in raster version 1.3-0. Robert

On Mon, Jul 19, 2010 at 11:46 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>
> While
> test <-rasterToPoints(Br025,fun=function(x){x>0},asSpatialPoints=T)
> does not work, the following works:
>> test <-rasterToPoints(Br025,fun=function(x){x>0},asSpatialPoints=F)
>> test <- as.data.frame(test)
>> coordinates(test) <- c("x","y")
>> class(test)
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
>> test at proj4string <- CRS(projection(Br025))
>> projection(test)
> [1] "+proj=longlat +ellps=WGS84"
>
>> summary(test)
> Object of class SpatialPointsDataFrame
> Coordinates:
> ? ?min ? max
> x -8.75 28.00
> y 41.50 59.75
> Is projected: FALSE
> proj4string : [+proj=longlat +ellps=WGS84]
> Number of points: 2576
> Data attributes:
> ? Min. 1st Qu. ?Median ? ?Mean 3rd Qu. ? ?Max.
> ? 0.50 ? ?7.00 ? 33.75 ?178.00 ?152.10 3638.00
>
> although the value of slot "Is projected:" indicates some problem.
>
> Agus
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Bug-in-rasterToPoints-tp5294219p5315475.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Tue Jul 20 20:20:12 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 20 Jul 2010 11:20:12 -0700
Subject: [R-sig-Geo] NA color composite
In-Reply-To: <8CCF6267908E08C-144C-A4E4@webmail-m030.sysops.aol.com>
References: <8CCF6267908E08C-144C-A4E4@webmail-m030.sysops.aol.com>
Message-ID: <AANLkTinJE0s-73Xk7ly8wfownV1Lsd4FKqE5Uc0IUI6q@mail.gmail.com>

Carsten,

Thanks for reporting this. I fixed the NA handling in plotRGB in
raster 1.3-1, which should be available from R-Forge later today, and
from CRAN later this week.

In stead of first reading the data with rgdal, a more direct way to
get at what you want with 'raster' is:

d1 <- stack('Hasenheide')
# or d1 <- brick('Hasenheide')
plotRGB(d1, r=14, g=7, b=1, scale=1)


With the current version, you could perhaps use a work-around like:

d1<-readGDAL('Hasenheide')
d1 at data[is.na(d1 at data)] <- 0
fn<-stack(raster(d1,14),raster(d1,7),raster(d1,1))
plotRGB(fn,1,2,3, scale=1)


Robert


On Tue, Jul 20, 2010 at 6:27 AM,  <carstennh at aol.com> wrote:
> Dear list members,
>
> I'm having trouble creating a rgb color composite based one a multiple grid object. Both the SGDF2PCT function from rgdal package and the ?plotRGB function from raster package can not handle NA's. For my ?work it is necessary to include No Data values for masking the study area.
>
>
> Is there any way to combine rgdal or raster objects in a rgb color mixture ?with No Data values??? My two approaches are given below.
>
> Very Great Thanks for any help!!!
>
> Carsten
>
> 1. Approach
>
> library(rgdal)
>
> vismaps = readGDAL("Hasenheide")
> vismaps$red = vismaps$band14
> vismaps$green = vismaps$band7
> vismaps$blue = vismaps$band1
>
> ###Display as a RGB image###
> RGBimg = SGDF2PCT(vismaps[c("red", "green", "blue")], ncolors=256,
> adjust.bands=TRUE)
>
> ##########Error in if (bmax == bmin) bmax <- bmin + ncolors :
> ?missing value where TRUE/FALSE needed################
>
> col<-rgb(d1 at data[[4]],d1 at data[[7]],d1 at data[[1]])
>
> vismaps$idx <- RGBimg$idx
> image(vismaps, "idx", col=RGBimg$ct)
>
>
>
>
> 2. Approach
>
> library(raster)
>
> d1<-readGDAL('Hasenheide')
> fn<-stack(raster(d1,14),raster(d1,7),raster(d1,1))
>
> ###Display as a RGB image###
> plotRGB(fn,scale=1,1,2,3)
>
> ################Error in rgb(getValues(r), getValues(g), getValues(b), max = scale) :
> ?color intensity nan, not in [0,1]#############################################
>
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Tue Jul 20 23:30:08 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 20 Jul 2010 14:30:08 -0700
Subject: [R-sig-Geo] display projected NetCDF files
In-Reply-To: <CF2DCCF10E8EE04BBF67CC4F47CCF4B1029C205C@lobstah.neptune.org>
References: <Acsje/sOaXrZgh+HQjigN/WJhK1ZIw==>
	<CF2DCCF10E8EE04BBF67CC4F47CCF4B1029C205C@lobstah.neptune.org>
Message-ID: <AANLkTimuI04Xl5d-LW9hbpTiSiW5ATL6dteNPu-6mZN1@mail.gmail.com>

Walt,

You should be able to read and plot this file like this:

library(raster)

b = brick("air.mon.mean.nc", varname= 'air')
plot(b, 1)

#or
r = raster("air.mon.mean.nc", varname= 'air', band=1)
plot(r)

#or
sp = as(b, 'SpatialGridDataFrame')
#etc

The projection info is stored in  r at prj  (for the time being, util I
transform these to proj4 syntax, for at the least the common cases)

Robert


On Wed, Jul 14, 2010 at 10:42 AM, Walt Golet <wgolet at gmri.org> wrote:
> Hello,
> A new list member here with a question regarding the display of projected NetCDF files in R. ?The initial grids (dimension 349 x 277) cover all of North America with the following borders:
> 12.2N;133.5W, 54.5N; 152.9W, 57.3N; 49.4W ,14.3N;65.1W in the Lambert Conformal Conic Grid. ?I extracted a smaller grid (our area of interest) which becomes a 64 x 51 matrix for air temperature, longitude and latitude with new borders (40.614, -84.052) ?(54.263, -76.513) (44.268,-52.644) (32.869,-63.768).
>
> #####Reading, extracting and sub setting the grid
> library(ncdf)
> ?AIR1=open.ncdf("air.mon.mean.nc",write=FALSE,readunlim=TRUE)
> ? ? ?print(AIR1)
> ? ? ? ?AIR2=AIR1$var[[2]]
> ? ? ? ? ? ?AIR=get.var.ncdf(AIR1,AIR2,start=c(1,1,13,1),count=c(349,277,1,372))
> ? ? ? ? ? ? ? ? ? AIR_JAN_1979=AIR[234:297,120:170,1]
> ? ? ? ? ? ? ? ? ? ? ?AIR2LAT=AIR1$var[[3]]
> ? ? ? ? ? ? ? ? ? ? ? ?AIR_LAT_19791=get.var.ncdf(AIR1,AIR2LAT,start=c(1,1),count=c(349,277))
> ? ? ? ? ? ? ? ? ? ? ? ? ?AIR_LAT_1979=AIR_LAT_19791[234:297,120:170]
> ? ? ? ? ? ? ? ? ? ? ?AIR2LONG=AIR1$var[[4]]
> ? ? ? ? ? ? ? ? AIR_LONG_19791=get.var.ncdf(AIR1,AIR2LONG,start=c(1,1),count=c(349,277))
> ? ? ? ? ? ?AIR_LONG_1979=AIR_LONG_19791[234:297,120:170]
>
> #######file information on projection and orientation of grid
> int Lambert_Conformal[] "
> ? ? ? ? ? grid_mapping_name: lambert_conformal_conic"
> ? ? ? ? ?standard_parallel: 50" " ? ? ? ? ? ?standard_parallel: 50"
> ? ? ? ? ? longitude_of_central_meridian: -107"
> ? ? ? ? ? latitude_of_projection_origin: 50"
> ? ? ? ? ? false_easting: 5632642.22547"
> ? ? ? ? ? false_northing: 4612545.65137"
> ?y ?Size:277" #### Original size of grid, extracted one is only 64 x 51
> ? ? ? ? ?long_name: northward distance from southwest corner of domain in projection coordinates"
> ? ? ? ? ? ?units: m"
> ? ? ? ? ? ?standard_name: projection_y_coordinate"
> ? ? ? x ?Size:349"
> ? ? ? ? ? ?long_name: eastward distance from southwest corner of domain in projection coordinates"
> ? ? ? ? ? units: m"
> ? ? ? ? ? ?standard_name: projection_x_coordinate"
> ? ? ? ?nbnds ?Size:2"
>
>
> simple plots such as filled.contour will plot the results, but are not projected properly.
> I imagine there is a method within rgdal{spTransform} to correctly display this data in its projected format or perhaps transform these positions, but it eludes me at this time. ?Somewhat similar questions have appeared online, but the answers I have found do not give correct projections. ?Any help with this would be appreciated. ?Thanks in advance for what may be a simple transformation,
>
> Walt
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From pierre.roudier at gmail.com  Wed Jul 21 05:27:48 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Wed, 21 Jul 2010 15:27:48 +1200
Subject: [R-sig-Geo] Using multicore processors with gstat
Message-ID: <AANLkTimU2oPkaWCz5FCxs3tiY-rIHlpmOsk-kOubJ20o@mail.gmail.com>

Dear geostatisticans,

I'm going to deal with pretty big datasets in one of my projects (1G
pixels +), and I'd like to keep using gstat for the geostatistics.

Do someone know if the gstat package supports parralelisation of
functions like cariogram() and fit.variogram() on multicore
processors?

Cheers,

Pierre


From edzer.pebesma at uni-muenster.de  Wed Jul 21 08:23:05 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 21 Jul 2010 08:23:05 +0200
Subject: [R-sig-Geo] Using multicore processors with gstat
In-Reply-To: <AANLkTimU2oPkaWCz5FCxs3tiY-rIHlpmOsk-kOubJ20o@mail.gmail.com>
References: <AANLkTimU2oPkaWCz5FCxs3tiY-rIHlpmOsk-kOubJ20o@mail.gmail.com>
Message-ID: <4C469249.2050408@uni-muenster.de>



On 07/21/2010 05:27 AM, Pierre Roudier wrote:
> Dear geostatisticans,
> 
> I'm going to deal with pretty big datasets in one of my projects (1G
> pixels +), and I'd like to keep using gstat for the geostatistics.
> 
> Do someone know if the gstat package supports parralelisation of
> functions like cariogram() and fit.variogram() on multicore
> processors?

there is none provided by the package itself. there is some optimization
behind variogram() for gridded data, as opposed to irregular points. For
data sizes this large, I'd start thinking about how to work with samples
of the data, rather than the full data, for computing variograms.

I can't see why fit.variogram would make sense to parrallelize.

> Cheers,
> 
> Pierre
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From alobolistas at gmail.com  Wed Jul 21 12:38:37 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 21 Jul 2010 03:38:37 -0700 (PDT)
Subject: [R-sig-Geo] Bug in rasterToPoints() ?
In-Reply-To: <AANLkTimnfQJZPmzPLQLF0_UNVkvlvD-1HKqXd1ENbETY@mail.gmail.com>
References: <AANLkTikVfLb8Wc52Ds7YBI2tgkNRUf1X4WvAWspfq_f2@mail.gmail.com>
	<625212.38870.qm@web23707.mail.ird.yahoo.com>
	<1279608376915-5315475.post@n2.nabble.com>
	<AANLkTimnfQJZPmzPLQLF0_UNVkvlvD-1HKqXd1ENbETY@mail.gmail.com>
Message-ID: <AANLkTilHtDmf0UZFOphJgduj3wt_Fd1850w0c2bFKTJt@mail.gmail.com>


Thanks!
Agus

2010/7/20 Robert J. Hijmans [via R-sig-geo]
<ml-node+5317401-2030277865-197315 at n2.nabble.com>:
> Thanks Agus, I fixed this in raster version 1.3-0. Robert
>
> On Mon, Jul 19, 2010 at 11:46 PM, Agustin Lobo <[hidden email]> wrote:
>>
>> While
>> test <-rasterToPoints(Br025,fun=function(x){x>0},asSpatialPoints=T)
>> does not work, the following works:
>>> test <-rasterToPoints(Br025,fun=function(x){x>0},asSpatialPoints=F)
>>> test <- as.data.frame(test)
>>> coordinates(test) <- c("x","y")
>>> class(test)
>> [1] "SpatialPointsDataFrame"
>> attr(,"package")
>> [1] "sp"
>>> test at proj4string <- CRS(projection(Br025))
>>> projection(test)
>> [1] "+proj=longlat +ellps=WGS84"
>>
>>> summary(test)
>> Object of class SpatialPointsDataFrame
>> Coordinates:
>> ? ?min ? max
>> x -8.75 28.00
>> y 41.50 59.75
>> Is projected: FALSE
>> proj4string : [+proj=longlat +ellps=WGS84]
>> Number of points: 2576
>> Data attributes:
>> ? Min. 1st Qu. ?Median ? ?Mean 3rd Qu. ? ?Max.
>> ? 0.50 ? ?7.00 ? 33.75 ?178.00 ?152.10 3638.00
>>
>> although the value of slot "Is projected:" indicates some problem.
>>
>> Agus
>> --
>> View this message in context:
>> http://r-sig-geo.2731867.n2.nabble.com/Bug-in-rasterToPoints-tp5294219p5315475.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> [hidden email]
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> _______________________________________________
> R-sig-Geo mailing list
> [hidden email]
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> ________________________________
> View message @
> http://r-sig-geo.2731867.n2.nabble.com/Bug-in-rasterToPoints-tp5294219p5317401.html
> To unsubscribe from Re: Bug in rasterToPoints() ?, click here.
>

-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Bug-in-rasterToPoints-tp5294219p5320543.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Henk.Sierdsema at sovon.nl  Wed Jul 21 13:17:48 2010
From: Henk.Sierdsema at sovon.nl (Henk Sierdsema)
Date: Wed, 21 Jul 2010 13:17:48 +0200
Subject: [R-sig-Geo] writeOGR error: problem with GDAL (libgdal1- 1.7.0)
In-Reply-To: <1274420310057-5082811.post@n2.nabble.com>
Message-ID: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDBBE9@SOVON1.SOVON.local>

Hi Augustin,

I've encountered the same problem after an update of the rgdal-package. I have resolved the problem by removing the rgal-folder in the library and replacing it by an older version of November 2009. You can download that version of www.sovon.nl/temp/rgdal_nov_2009.zip

Success!

Henk



-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch]Namens Agustin Lobo
Verzonden: vrijdag 21 mei 2010 7:39
Aan: r-sig-geo at stat.math.ethz.ch
Onderwerp: [R-sig-Geo] writeOGR error: problem with GDAL (libgdal1-
1.7.0)



I'm getting this error using a command and an object that
used to work few months ago

> writeOGR(Montseny20090409shtotspols, dsn="Montseny20090409tots2",
> layer="Montseny20090409shtots2",driver="ESRI Shapefile")
Error in writeOGR(Montseny20090409shtotspols, dsn = "Montseny20090409tots2", 
: 
  
	GDAL Error 1: Invalid index : -1
Calls: writeOGR -> .Call
In addition: Warning messages:
1: In writeOGR(Montseny20090409shtotspols, dsn = "Montseny20090409tots2",  :
  
	Non-fatal GDAL Error 6: Normalized/laundered field name: 'coords.x1.1' to
'coords.x1.'
2: In writeOGR(Montseny20090409shtotspols, dsn = "Montseny20090409tots2",  :
  
	Non-fatal GDAL Error 6: Normalized/laundered field name: 'coords.x2.1' to
'coords.x2.'

Both the Error and Warnings are new, and are actually related: if I do:
> names(Montseny20090409shtotspols at data)[31]<-"UTMX"
> names(Montseny20090409shtotspols at data)[32]<-"UTMY"

writeOGR() works fine.

Could a more explicit error message, linking the error to the problem with
the names, be issued by writeOGR() ? Initially I even thought I could have a
disk problem!

I recently upgraded from ubuntu 9.04 to 9.10 and to libgdal1-1.7.0.
R version 2.11.0 (2010-04-22)
 Package: rgdal
Version: 0.6-27
Date: 2010-05-11

Thanks

Agus
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeOGR-error-problem-with-GDAL-libgdal1-1-7-0-tp5082811p5082811.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Wed Jul 21 23:17:34 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 21 Jul 2010 23:17:34 +0200
Subject: [R-sig-Geo] writeOGR error: problem with GDAL (libgdal1- 1.7.0)
References: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDBBE9@SOVON1.SOVON.local>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C4051326@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100721/69360256/attachment.pl>

From pierre.roudier at gmail.com  Thu Jul 22 07:35:01 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Thu, 22 Jul 2010 17:35:01 +1200
Subject: [R-sig-Geo] Pruning a delaunay triangulation with a shape
Message-ID: <AANLkTinTtsUjSRkh5No-wFDX4x7n-iEyh-PwB0mxmVKU@mail.gmail.com>

Dear researchers,

I'm scratching my head on a problem involving neighbourhood
definition: I am using the Delaunay triangulation to generate a
neighbourhood relationship object on a set of georeferenced points.

I am using the tripack package for that (tri.mesh() for the
triangulation and neighbours() to create the neighbourhood).

However, I would like to prune this neighbourhood using a polygon, so
that some neighbourhood relationships won't be taken into account.
Here's an illustrating example:

dat <- data.frame(
x=c(0.34433527, 0.08592805, 0.55564179, 0.03938242, 0.98044051,
0.19835405, 0.94186612, 0.56208017, 0.31093811, 0.54341230,
0.93508703, 0.38160473, 0.89435383, 0.55457428, 0.22406338),
y=c(0.997803213, 0.094993232, 0.509774611, 0.615526709, 0.004314438,
0.676662461, 0.026060349, 0.165807011, 0.596449068, 0.469553704,
0.888788079, 0.163129754, 0.340335312, 0.621845245, 0.019412254)
)

dat.tr <- tri.mesh(dat)

bound <- data.frame(
x=c(0.34063939, 0.56754974, 0.95361248, 0.96464284, 0.60694389,
0.58173163, 0.58330740, 0.91421832, 1.00403700, 0.96464284,
0.50294332, 0.39263968, 0.22560845, 0.02548613, 0.25397225,
-0.01233226),
y=c(1.02171515, 0.70486571, 0.92207697, 0.84834471, 0.62116963,
0.53747356, 0.47569788, 0.35812482, 0.02134774, -0.07231216,
0.15287015, 0.14489909, -0.03444965, 0.09707276, 0.56138672,
0.58729265)
)

plot(dat)
polygon(bound, col='red')
plot(dat.tr, add=TRUE, col='blue')

In that example, I would like to eliminate all the (blue)
neighbourhood relationships that are not in the red polygon.

Would anybody has a simple way to do this?

Thanks,

Pierre


From oldeland at gmx.de  Thu Jul 22 13:07:07 2010
From: oldeland at gmx.de (Jens Oldeland)
Date: Thu, 22 Jul 2010 13:07:07 +0200
Subject: [R-sig-Geo] Pruning a delaunay triangulation with a shape
Message-ID: <4C48265B.5030500@gmx.de>

Hi Pierre,

I think intersect.nb in the spdep package is what you are looking for?
Have a look at the example there, looks quite similar to your problem.

HTH,
Jens


-- 
+++++++++++++++++++++++++++++++++++++++++
Dipl.Biol. Jens Oldeland
Biodiversity of Plants
Biocentre Klein Flottbek and Botanical Garden
University of Hamburg
Ohnhorststr. 18
22609 Hamburg,
Germany

Tel:    0049-(0)40-42816-407
Fax:    0049-(0)40-42816-543
Mail: 	Oldeland at botanik.uni-hamburg.de
        Oldeland at gmx.de (for attachments > 2mb!!)
Skype:	jens.oldeland
http://www.biologie.uni-hamburg.de/bzf/fbda005/fbda005.htm
http://jensoldeland.wordpress.com
+++++++++++++++++++++++++++++++++++++++++


From r.aluizio at gmail.com  Thu Jul 22 17:14:09 2010
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Thu, 22 Jul 2010 12:14:09 -0300
Subject: [R-sig-Geo] Import Part of a GeoTiff using readGDAL{rgdal}
Message-ID: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100722/8ae7e4bf/attachment.pl>

From mdsumner at gmail.com  Thu Jul 22 17:49:33 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 23 Jul 2010 01:49:33 +1000
Subject: [R-sig-Geo] Import Part of a GeoTiff using readGDAL{rgdal}
In-Reply-To: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
References: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
Message-ID: <AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>

With readGDAL you must figure out the impled coordinates, referenced
from the top left - it's confusing, but with some experimenting you
will get it.

But, far easier is to use the raster package, which will let you deal
with the entire Etopo1 if you want by accessing the file as needed,
and there are simpler methods to crop the big raster - and coerce to
SpatialGridDataFrame if need be.

E.g.
## all this works pretty fast as raster takes care of the memory
library(raster)
etopo1 <- raster("Etopo1.tif")
 e <- extent(-90, -32, -60, 15)
r <- crop(etopo1, e)
plot(r)

## if we want to enforce the full memory use as an sp object
x <- as(r, "SpatialGridDataFrame")
image(x)
summary(x)
Object of class SpatialGridDataFrame
Coordinates:
   min max
s1 -90 -32
s2 -60  15
Is projected: FALSE
proj4string :
[+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0]
Number of points: 2
Grid attributes:
   cellcentre.offset   cellsize cells.dim
s1         -89.99167 0.01666667      3480
s2         -59.99167 0.01666667      4500
Data attributes:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  -8086   -4188   -2583   -2025     148    6494



sessionInfo()
R version 2.11.1 (2010-05-31)
x86_64-pc-mingw32

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-27 raster_1.2-6 sp_0.9-65

loaded via a namespace (and not attached):
[1] grid_2.11.1    lattice_0.18-8 tools_2.11.1

On Fri, Jul 23, 2010 at 1:14 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
> Hi List.
>
> I?m trying to import only a part of interest from a raster image map (let
> say, ETOPO 1 Global Relief GeoTiff). I realize that, PROBABLY, the readGDAL
> function can deal with my issue through the arguments:
>
>
>
> offset - Number of rows and columns from the origin (usually the upper left
> corner) to begin reading from; presently ordered (y,x) - this may change
>
> region.dim - The number of rows and columns to read from the dataset;
> presently ordered (y,x) - this may change
>
>
>
> But, I don?t know exactly how to specify that I want the rows (and columns?)
> which show only South America, I do know the SA coordinate limits, but not
> the corresponding rows.
>
> The real problem is that I don?t know how to use the function resources
> properly. I?m trying to limit the region during import to avoid memory limit
> issues, once importing the ETOPO 1 Geotiff tries to generate a huge vector.
>
> Really Sorry About It, Thanks for Your Patience and Attention.
>
>
>
> -------------------------------------------------------------
>
> MSc. ?<mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>
> Centro de Estudos do Mar/UFPR
> Laborat?rio de Micropaleontologia
> Avenida Beira Mar s/n - CEP 83255-000
> Pontal do Paran? - PR - Brasil
>
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From sglish at hotmail.com  Thu Jul 22 19:03:11 2010
From: sglish at hotmail.com (Chris English)
Date: Thu, 22 Jul 2010 13:03:11 -0400
Subject: [R-sig-Geo] GridTopology,
 Gluing SpatialGridDataFrames together from adjacent Rasters
Message-ID: <SNT117-W282F159B5D34E958735F51C5A20@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100722/84ad6c38/attachment.pl>

From ssefick at gmail.com  Thu Jul 22 20:55:00 2010
From: ssefick at gmail.com (stephen sefick)
Date: Thu, 22 Jul 2010 13:55:00 -0500
Subject: [R-sig-Geo] spTransform problem
Message-ID: <AANLkTimTxr_91opzrz4M00UItYsxUIjEvFDjPn2KfiJM@mail.gmail.com>

I am having problems with spTransform in packages rgdal.  If this is
not enought information please let me know and I will send whatever
you need.  It doesn't seem like it is avaliable.

library(rgdal)
w <- (new("SpatialPoints"
    , coords = structure(c(33.31665, 33.31834, 33.3239, 33.37435, 33.36018,
33.23301, 33.23423, 33.17796, 33.18121, 33.1949, 33.31868, 33.30408,
33.29747, 33.17787, 33.29818, 33.29995, 33.22684, 35.1132, 35.17292,
35.17181, 35.06247, 35.11168, 35.13462, 33.29927, 33.29815, 33.29678,
33.22417, 35.18823, 35.18498, 35.11643, 35.01896, 32.50986, 32.49736,
33.31731, 33.3194, 33.3244, 33.37333, 33.36077, 33.2325, 33.23349,
33.1781, 33.18051, 33.19357, 33.31922, 33.30454, 33.29836, 33.17613,
33.2981, 33.36369, 33.30074, 33.22576, 35.1132, 35.17424, 35.17208,
35.06282, 35.11102, 35.13354, 33.30036, 33.29896, 33.29789, 33.22353,
35.18748, 35.1838, 35.11509, 35.01986, 32.51054, 32.49748, -81.59802,
-81.59618, -81.60159, -81.55044, -81.55657, -81.6235, -81.63911,
-81.56433, -81.56165, -81.57855, -81.57896, -81.62487, -81.63039,
-81.58159, -81.62553, -81.58714, -81.63564, -79.33718, -79.1805,
-79.22391, -79.30669, -79.35294, -79.34676, -81.66629, -81.67698,
-81.68295, -81.5105, -79.0738, -79.09837, -79.32681, -79.51664,
-84.64703, -84.70618, -81.59759, -81.59619, -81.60101, -81.54981,
-81.55763, -81.62424, -81.63809, -81.5657, -81.56335, -81.5788,
-81.58011, -81.6263, -81.62959, -81.58174, -81.62629, -81.55806,
-81.5868, -81.6357, -79.33718, -79.18026, -79.23305, -79.30483,
-79.35168, -79.34534, -81.66618, -81.6779, -81.68343, -81.50894,
-79.07469, -79.09892, -79.32548, -79.51553, -84.64841, -84.70769
), .Dim = c(67L, 2L), .Dimnames = list(NULL, c("lat", "long")))
    , bbox = structure(c(32.49736, -84.70769, 35.18823, -79.0738), .Dim = c(2L,
2L), .Dimnames = list(c("lat", "long"), c("min", "max")))
    , proj4string = new("CRS"
    , projargs = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
)
))


str(w)
Formal class 'SpatialPoints' [package "sp"] with 3 slots
  ..@ coords     : num [1:67, 1:2] 33.3 33.3 33.3 33.4 33.4 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "lat" "long"
  ..@ bbox       : num [1:2, 1:2] 32.5 -84.7 35.2 -79.1
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "lat" "long"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"


w.utm <- spTransform(y, CRS=CRS("+proj=utm +zone=17 +ellps=GRS80
+datum=NAD83 +units=m +no_defs"))
Error: could not find function "spTransform"

sessionInfo()
R version 2.11.1 (2010-05-31)
x86_64-unknown-linux-gnu

locale:
 [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C
 [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8
 [5] LC_MONETARY=C             LC_MESSAGES=en_US.utf8
 [7] LC_PAPER=en_US.utf8       LC_NAME=C
 [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] graphics  grDevices utils     datasets  stats     grid      methods
[8] base

other attached packages:
 [1] gpclib_1.5-1            RPostgreSQL_0.1-6       DBI_0.2-5
 [4] StreamMetabolism_0.03-3 maptools_0.7-34         lattice_0.18-8
 [7] sp_0.9-65               foreign_0.8-40          chron_2.3-35
[10] zoo_1.6-4               vegan_1.17-3            ggplot2_0.8.8
[13] proto_0.3-8             reshape_0.8.3           plyr_1.0.3

loaded via a namespace (and not attached):
[1] tools_2.11.1


-- 
Stephen Sefick
____________________________________
| Auburn University? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| Department of Biological Sciences? ? ? ? ?? |
| 331 Funchess Hall? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
| Auburn, Alabama? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| 36849? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
|___________________________________|
| sas0025 at auburn.edu? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| http://www.auburn.edu/~sas0025? ? ? ? ? ?? |
|___________________________________|

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.? We are mammals, and have not exhausted the
annoying little problems of being mammals.

? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? -K. Mullis


From basille at ase-research.org  Thu Jul 22 21:04:12 2010
From: basille at ase-research.org (Mathieu Basille)
Date: Thu, 22 Jul 2010 15:04:12 -0400
Subject: [R-sig-Geo] spTransform problem
In-Reply-To: <AANLkTimTxr_91opzrz4M00UItYsxUIjEvFDjPn2KfiJM@mail.gmail.com>
References: <AANLkTimTxr_91opzrz4M00UItYsxUIjEvFDjPn2KfiJM@mail.gmail.com>
Message-ID: <4C48962C.8040302@ase-research.org>

Hi Stephen,

Did you *actually* try to load rgdal in that R session? It doesn't seem
to appear in the list of attached packages...

HTH,
Mathieu.



Le 2010-07-22 14:55, stephen sefick a ?crit :
> I am having problems with spTransform in packages rgdal.  If this is
> not enought information please let me know and I will send whatever
> you need.  It doesn't seem like it is avaliable.
> 
> library(rgdal)
> w <- (new("SpatialPoints"
>     , coords = structure(c(33.31665, 33.31834, 33.3239, 33.37435, 33.36018,
> 33.23301, 33.23423, 33.17796, 33.18121, 33.1949, 33.31868, 33.30408,
> 33.29747, 33.17787, 33.29818, 33.29995, 33.22684, 35.1132, 35.17292,
> 35.17181, 35.06247, 35.11168, 35.13462, 33.29927, 33.29815, 33.29678,
> 33.22417, 35.18823, 35.18498, 35.11643, 35.01896, 32.50986, 32.49736,
> 33.31731, 33.3194, 33.3244, 33.37333, 33.36077, 33.2325, 33.23349,
> 33.1781, 33.18051, 33.19357, 33.31922, 33.30454, 33.29836, 33.17613,
> 33.2981, 33.36369, 33.30074, 33.22576, 35.1132, 35.17424, 35.17208,
> 35.06282, 35.11102, 35.13354, 33.30036, 33.29896, 33.29789, 33.22353,
> 35.18748, 35.1838, 35.11509, 35.01986, 32.51054, 32.49748, -81.59802,
> -81.59618, -81.60159, -81.55044, -81.55657, -81.6235, -81.63911,
> -81.56433, -81.56165, -81.57855, -81.57896, -81.62487, -81.63039,
> -81.58159, -81.62553, -81.58714, -81.63564, -79.33718, -79.1805,
> -79.22391, -79.30669, -79.35294, -79.34676, -81.66629, -81.67698,
> -81.68295, -81.5105, -79.0738, -79.09837, -79.32681, -79.51664,
> -84.64703, -84.70618, -81.59759, -81.59619, -81.60101, -81.54981,
> -81.55763, -81.62424, -81.63809, -81.5657, -81.56335, -81.5788,
> -81.58011, -81.6263, -81.62959, -81.58174, -81.62629, -81.55806,
> -81.5868, -81.6357, -79.33718, -79.18026, -79.23305, -79.30483,
> -79.35168, -79.34534, -81.66618, -81.6779, -81.68343, -81.50894,
> -79.07469, -79.09892, -79.32548, -79.51553, -84.64841, -84.70769
> ), .Dim = c(67L, 2L), .Dimnames = list(NULL, c("lat", "long")))
>     , bbox = structure(c(32.49736, -84.70769, 35.18823, -79.0738), .Dim = c(2L,
> 2L), .Dimnames = list(c("lat", "long"), c("min", "max")))
>     , proj4string = new("CRS"
>     , projargs = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
> )
> ))
> 
> 
> str(w)
> Formal class 'SpatialPoints' [package "sp"] with 3 slots
>   ..@ coords     : num [1:67, 1:2] 33.3 33.3 33.3 33.4 33.4 ...
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : NULL
>   .. .. ..$ : chr [1:2] "lat" "long"
>   ..@ bbox       : num [1:2, 1:2] 32.5 -84.7 35.2 -79.1
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "lat" "long"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
> 
> 
> w.utm <- spTransform(y, CRS=CRS("+proj=utm +zone=17 +ellps=GRS80
> +datum=NAD83 +units=m +no_defs"))
> Error: could not find function "spTransform"
> 
> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-unknown-linux-gnu
> 
> locale:
>  [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8
>  [5] LC_MONETARY=C             LC_MESSAGES=en_US.utf8
>  [7] LC_PAPER=en_US.utf8       LC_NAME=C
>  [9] LC_ADDRESS=C              LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] graphics  grDevices utils     datasets  stats     grid      methods
> [8] base
> 
> other attached packages:
>  [1] gpclib_1.5-1            RPostgreSQL_0.1-6       DBI_0.2-5
>  [4] StreamMetabolism_0.03-3 maptools_0.7-34         lattice_0.18-8
>  [7] sp_0.9-65               foreign_0.8-40          chron_2.3-35
> [10] zoo_1.6-4               vegan_1.17-3            ggplot2_0.8.8
> [13] proto_0.3-8             reshape_0.8.3           plyr_1.0.3
> 
> loaded via a namespace (and not attached):
> [1] tools_2.11.1
> 
> 

-- 

~$ whoami
Mathieu Basille, Post-Doc

~$ locate
Laboratoire d'?cologie Comportementale et de Conservation de la Faune
+ Centre d'?tude de la For?t
D?partement de Biologie
Universit? Laval, Qu?bec

~$ info
http://ase-research.org/basille

~$ fortune
``If you can't win by reason, go for volume.''
Calvin, by Bill Watterson.


From ssefick at gmail.com  Thu Jul 22 21:08:19 2010
From: ssefick at gmail.com (stephen sefick)
Date: Thu, 22 Jul 2010 14:08:19 -0500
Subject: [R-sig-Geo] spTransform problem
In-Reply-To: <4C48962C.8040302@ase-research.org>
References: <AANLkTimTxr_91opzrz4M00UItYsxUIjEvFDjPn2KfiJM@mail.gmail.com>
	<4C48962C.8040302@ase-research.org>
Message-ID: <AANLkTil730cBf0zGfi_LWQlClDEayqpFR7bn4IlNIs4Y@mail.gmail.com>

All: Sorry for clogging everyones mailbox.  Mathieu is absolutely right.

library(rgdal)

fixed everything

On Thu, Jul 22, 2010 at 2:04 PM, Mathieu Basille
<basille at ase-research.org> wrote:
> Hi Stephen,
>
> Did you *actually* try to load rgdal in that R session? It doesn't seem
> to appear in the list of attached packages...
>
> HTH,
> Mathieu.
>
>
>
> Le 2010-07-22 14:55, stephen sefick a ?crit :
>> I am having problems with spTransform in packages rgdal. ?If this is
>> not enought information please let me know and I will send whatever
>> you need. ?It doesn't seem like it is avaliable.
>>
>> library(rgdal)
>> w <- (new("SpatialPoints"
>> ? ? , coords = structure(c(33.31665, 33.31834, 33.3239, 33.37435, 33.36018,
>> 33.23301, 33.23423, 33.17796, 33.18121, 33.1949, 33.31868, 33.30408,
>> 33.29747, 33.17787, 33.29818, 33.29995, 33.22684, 35.1132, 35.17292,
>> 35.17181, 35.06247, 35.11168, 35.13462, 33.29927, 33.29815, 33.29678,
>> 33.22417, 35.18823, 35.18498, 35.11643, 35.01896, 32.50986, 32.49736,
>> 33.31731, 33.3194, 33.3244, 33.37333, 33.36077, 33.2325, 33.23349,
>> 33.1781, 33.18051, 33.19357, 33.31922, 33.30454, 33.29836, 33.17613,
>> 33.2981, 33.36369, 33.30074, 33.22576, 35.1132, 35.17424, 35.17208,
>> 35.06282, 35.11102, 35.13354, 33.30036, 33.29896, 33.29789, 33.22353,
>> 35.18748, 35.1838, 35.11509, 35.01986, 32.51054, 32.49748, -81.59802,
>> -81.59618, -81.60159, -81.55044, -81.55657, -81.6235, -81.63911,
>> -81.56433, -81.56165, -81.57855, -81.57896, -81.62487, -81.63039,
>> -81.58159, -81.62553, -81.58714, -81.63564, -79.33718, -79.1805,
>> -79.22391, -79.30669, -79.35294, -79.34676, -81.66629, -81.67698,
>> -81.68295, -81.5105, -79.0738, -79.09837, -79.32681, -79.51664,
>> -84.64703, -84.70618, -81.59759, -81.59619, -81.60101, -81.54981,
>> -81.55763, -81.62424, -81.63809, -81.5657, -81.56335, -81.5788,
>> -81.58011, -81.6263, -81.62959, -81.58174, -81.62629, -81.55806,
>> -81.5868, -81.6357, -79.33718, -79.18026, -79.23305, -79.30483,
>> -79.35168, -79.34534, -81.66618, -81.6779, -81.68343, -81.50894,
>> -79.07469, -79.09892, -79.32548, -79.51553, -84.64841, -84.70769
>> ), .Dim = c(67L, 2L), .Dimnames = list(NULL, c("lat", "long")))
>> ? ? , bbox = structure(c(32.49736, -84.70769, 35.18823, -79.0738), .Dim = c(2L,
>> 2L), .Dimnames = list(c("lat", "long"), c("min", "max")))
>> ? ? , proj4string = new("CRS"
>> ? ? , projargs = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
>> )
>> ))
>>
>>
>> str(w)
>> Formal class 'SpatialPoints' [package "sp"] with 3 slots
>> ? ..@ coords ? ? : num [1:67, 1:2] 33.3 33.3 33.3 33.4 33.4 ...
>> ? .. ..- attr(*, "dimnames")=List of 2
>> ? .. .. ..$ : NULL
>> ? .. .. ..$ : chr [1:2] "lat" "long"
>> ? ..@ bbox ? ? ? : num [1:2, 1:2] 32.5 -84.7 35.2 -79.1
>> ? .. ..- attr(*, "dimnames")=List of 2
>> ? .. .. ..$ : chr [1:2] "lat" "long"
>> ? .. .. ..$ : chr [1:2] "min" "max"
>> ? ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>> ? .. .. ..@ projargs: chr "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
>>
>>
>> w.utm <- spTransform(y, CRS=CRS("+proj=utm +zone=17 +ellps=GRS80
>> +datum=NAD83 +units=m +no_defs"))
>> Error: could not find function "spTransform"
>>
>> sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> x86_64-unknown-linux-gnu
>>
>> locale:
>> ?[1] LC_CTYPE=en_US.utf8 ? ? ? LC_NUMERIC=C
>> ?[3] LC_TIME=en_US.utf8 ? ? ? ?LC_COLLATE=en_US.utf8
>> ?[5] LC_MONETARY=C ? ? ? ? ? ? LC_MESSAGES=en_US.utf8
>> ?[7] LC_PAPER=en_US.utf8 ? ? ? LC_NAME=C
>> ?[9] LC_ADDRESS=C ? ? ? ? ? ? ?LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] graphics ?grDevices utils ? ? datasets ?stats ? ? grid ? ? ?methods
>> [8] base
>>
>> other attached packages:
>> ?[1] gpclib_1.5-1 ? ? ? ? ? ?RPostgreSQL_0.1-6 ? ? ? DBI_0.2-5
>> ?[4] StreamMetabolism_0.03-3 maptools_0.7-34 ? ? ? ? lattice_0.18-8
>> ?[7] sp_0.9-65 ? ? ? ? ? ? ? foreign_0.8-40 ? ? ? ? ?chron_2.3-35
>> [10] zoo_1.6-4 ? ? ? ? ? ? ? vegan_1.17-3 ? ? ? ? ? ?ggplot2_0.8.8
>> [13] proto_0.3-8 ? ? ? ? ? ? reshape_0.8.3 ? ? ? ? ? plyr_1.0.3
>>
>> loaded via a namespace (and not attached):
>> [1] tools_2.11.1
>>
>>
>
> --
>
> ~$ whoami
> Mathieu Basille, Post-Doc
>
> ~$ locate
> Laboratoire d'?cologie Comportementale et de Conservation de la Faune
> + Centre d'?tude de la For?t
> D?partement de Biologie
> Universit? Laval, Qu?bec
>
> ~$ info
> http://ase-research.org/basille
>
> ~$ fortune
> ``If you can't win by reason, go for volume.''
> Calvin, by Bill Watterson.
>



-- 
Stephen Sefick
____________________________________
| Auburn University? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| Department of Biological Sciences? ? ? ? ?? |
| 331 Funchess Hall? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
| Auburn, Alabama? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| 36849? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
|___________________________________|
| sas0025 at auburn.edu? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| http://www.auburn.edu/~sas0025? ? ? ? ? ?? |
|___________________________________|

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.? We are mammals, and have not exhausted the
annoying little problems of being mammals.

? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? -K. Mullis


From ssefick at gmail.com  Thu Jul 22 21:45:37 2010
From: ssefick at gmail.com (stephen sefick)
Date: Thu, 22 Jul 2010 14:45:37 -0500
Subject: [R-sig-Geo] spTransform problem
In-Reply-To: <AANLkTil730cBf0zGfi_LWQlClDEayqpFR7bn4IlNIs4Y@mail.gmail.com>
References: <AANLkTimTxr_91opzrz4M00UItYsxUIjEvFDjPn2KfiJM@mail.gmail.com>
	<4C48962C.8040302@ase-research.org>
	<AANLkTil730cBf0zGfi_LWQlClDEayqpFR7bn4IlNIs4Y@mail.gmail.com>
Message-ID: <AANLkTin4A0EcKaF9eVYvOuYCW4gg4VE6emO-64H4afl5@mail.gmail.com>

I loaded rgdal and now the spTransform is throwing an error.  Any help
would be greatly appreciated.
thanks,

Stephen

On Thu, Jul 22, 2010 at 2:08 PM, stephen sefick <ssefick at gmail.com> wrote:
> All: Sorry for clogging everyones mailbox. ?Mathieu is absolutely right.
>
> library(rgdal)
>
> fixed everything
>
> On Thu, Jul 22, 2010 at 2:04 PM, Mathieu Basille
> <basille at ase-research.org> wrote:
>> Hi Stephen,
>>
>> Did you *actually* try to load rgdal in that R session? It doesn't seem
>> to appear in the list of attached packages...
>>
>> HTH,
>> Mathieu.
>>
>>
>>
>> Le 2010-07-22 14:55, stephen sefick a ?crit :
>>> I am having problems with spTransform in packages rgdal. ?If this is
>>> not enought information please let me know and I will send whatever
>>> you need. ?It doesn't seem like it is avaliable.
>>>
>>> library(rgdal)
>>> w <- (new("SpatialPoints"
>>> ? ? , coords = structure(c(33.31665, 33.31834, 33.3239, 33.37435, 33.36018,
>>> 33.23301, 33.23423, 33.17796, 33.18121, 33.1949, 33.31868, 33.30408,
>>> 33.29747, 33.17787, 33.29818, 33.29995, 33.22684, 35.1132, 35.17292,
>>> 35.17181, 35.06247, 35.11168, 35.13462, 33.29927, 33.29815, 33.29678,
>>> 33.22417, 35.18823, 35.18498, 35.11643, 35.01896, 32.50986, 32.49736,
>>> 33.31731, 33.3194, 33.3244, 33.37333, 33.36077, 33.2325, 33.23349,
>>> 33.1781, 33.18051, 33.19357, 33.31922, 33.30454, 33.29836, 33.17613,
>>> 33.2981, 33.36369, 33.30074, 33.22576, 35.1132, 35.17424, 35.17208,
>>> 35.06282, 35.11102, 35.13354, 33.30036, 33.29896, 33.29789, 33.22353,
>>> 35.18748, 35.1838, 35.11509, 35.01986, 32.51054, 32.49748, -81.59802,
>>> -81.59618, -81.60159, -81.55044, -81.55657, -81.6235, -81.63911,
>>> -81.56433, -81.56165, -81.57855, -81.57896, -81.62487, -81.63039,
>>> -81.58159, -81.62553, -81.58714, -81.63564, -79.33718, -79.1805,
>>> -79.22391, -79.30669, -79.35294, -79.34676, -81.66629, -81.67698,
>>> -81.68295, -81.5105, -79.0738, -79.09837, -79.32681, -79.51664,
>>> -84.64703, -84.70618, -81.59759, -81.59619, -81.60101, -81.54981,
>>> -81.55763, -81.62424, -81.63809, -81.5657, -81.56335, -81.5788,
>>> -81.58011, -81.6263, -81.62959, -81.58174, -81.62629, -81.55806,
>>> -81.5868, -81.6357, -79.33718, -79.18026, -79.23305, -79.30483,
>>> -79.35168, -79.34534, -81.66618, -81.6779, -81.68343, -81.50894,
>>> -79.07469, -79.09892, -79.32548, -79.51553, -84.64841, -84.70769
>>> ), .Dim = c(67L, 2L), .Dimnames = list(NULL, c("lat", "long")))
>>> ? ? , bbox = structure(c(32.49736, -84.70769, 35.18823, -79.0738), .Dim = c(2L,
>>> 2L), .Dimnames = list(c("lat", "long"), c("min", "max")))
>>> ? ? , proj4string = new("CRS"
>>> ? ? , projargs = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
>>> )
>>> ))
>>>
>>>
>>> str(w)
>>> Formal class 'SpatialPoints' [package "sp"] with 3 slots
>>> ? ..@ coords ? ? : num [1:67, 1:2] 33.3 33.3 33.3 33.4 33.4 ...
>>> ? .. ..- attr(*, "dimnames")=List of 2
>>> ? .. .. ..$ : NULL
>>> ? .. .. ..$ : chr [1:2] "lat" "long"
>>> ? ..@ bbox ? ? ? : num [1:2, 1:2] 32.5 -84.7 35.2 -79.1
>>> ? .. ..- attr(*, "dimnames")=List of 2
>>> ? .. .. ..$ : chr [1:2] "lat" "long"
>>> ? .. .. ..$ : chr [1:2] "min" "max"
>>> ? ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>> ? .. .. ..@ projargs: chr "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
>>>
>>>
>>> w.utm <- spTransform(y, CRS=CRS("+proj=utm +zone=17 +ellps=GRS80
>>> +datum=NAD83 +units=m +no_defs"))
>>> Error: could not find function "spTransform"
>>>
>>> sessionInfo()
>>> R version 2.11.1 (2010-05-31)
>>> x86_64-unknown-linux-gnu
>>>
>>> locale:
>>> ?[1] LC_CTYPE=en_US.utf8 ? ? ? LC_NUMERIC=C
>>> ?[3] LC_TIME=en_US.utf8 ? ? ? ?LC_COLLATE=en_US.utf8
>>> ?[5] LC_MONETARY=C ? ? ? ? ? ? LC_MESSAGES=en_US.utf8
>>> ?[7] LC_PAPER=en_US.utf8 ? ? ? LC_NAME=C
>>> ?[9] LC_ADDRESS=C ? ? ? ? ? ? ?LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] graphics ?grDevices utils ? ? datasets ?stats ? ? grid ? ? ?methods
>>> [8] base
>>>
>>> other attached packages:
>>> ?[1] gpclib_1.5-1 ? ? ? ? ? ?RPostgreSQL_0.1-6 ? ? ? DBI_0.2-5
>>> ?[4] StreamMetabolism_0.03-3 maptools_0.7-34 ? ? ? ? lattice_0.18-8
>>> ?[7] sp_0.9-65 ? ? ? ? ? ? ? foreign_0.8-40 ? ? ? ? ?chron_2.3-35
>>> [10] zoo_1.6-4 ? ? ? ? ? ? ? vegan_1.17-3 ? ? ? ? ? ?ggplot2_0.8.8
>>> [13] proto_0.3-8 ? ? ? ? ? ? reshape_0.8.3 ? ? ? ? ? plyr_1.0.3
>>>
>>> loaded via a namespace (and not attached):
>>> [1] tools_2.11.1
>>>
>>>
>>
>> --
>>
>> ~$ whoami
>> Mathieu Basille, Post-Doc
>>
>> ~$ locate
>> Laboratoire d'?cologie Comportementale et de Conservation de la Faune
>> + Centre d'?tude de la For?t
>> D?partement de Biologie
>> Universit? Laval, Qu?bec
>>
>> ~$ info
>> http://ase-research.org/basille
>>
>> ~$ fortune
>> ``If you can't win by reason, go for volume.''
>> Calvin, by Bill Watterson.
>>
>
>
>
> --
> Stephen Sefick
> ____________________________________
> | Auburn University? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
> | Department of Biological Sciences? ? ? ? ?? |
> | 331 Funchess Hall? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
> | Auburn, Alabama? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
> | 36849? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
> |___________________________________|
> | sas0025 at auburn.edu? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
> | http://www.auburn.edu/~sas0025? ? ? ? ? ?? |
> |___________________________________|
>
> Let's not spend our time and resources thinking about things that are
> so little or so large that all they really do for us is puff us up and
> make us feel like gods.? We are mammals, and have not exhausted the
> annoying little problems of being mammals.
>
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? -K. Mullis
>



-- 
Stephen Sefick
____________________________________
| Auburn University? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| Department of Biological Sciences? ? ? ? ?? |
| 331 Funchess Hall? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
| Auburn, Alabama? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| 36849? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? |
|___________________________________|
| sas0025 at auburn.edu? ? ? ? ? ? ? ? ? ? ? ? ? ?? |
| http://www.auburn.edu/~sas0025? ? ? ? ? ?? |
|___________________________________|

Let's not spend our time and resources thinking about things that are
so little or so large that all they really do for us is puff us up and
make us feel like gods.? We are mammals, and have not exhausted the
annoying little problems of being mammals.

? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? -K. Mullis


From rundel at gmail.com  Thu Jul 22 23:24:25 2010
From: rundel at gmail.com (rundel)
Date: Thu, 22 Jul 2010 14:24:25 -0700 (PDT)
Subject: [R-sig-Geo] Pruning a delaunay triangulation with a shape
In-Reply-To: <AANLkTinTtsUjSRkh5No-wFDX4x7n-iEyh-PwB0mxmVKU@mail.gmail.com>
References: <AANLkTinTtsUjSRkh5No-wFDX4x7n-iEyh-PwB0mxmVKU@mail.gmail.com>
Message-ID: <1279833865261-5327334.post@n2.nabble.com>


Depending on what you want to do downstream this may or may not be the best
solution for this problem (say if you need to use the tri class at some
later point) but if you just want the neighbors then you could use something
like the following which makes use of rgeos to find which relationships
(lines) are within the polygon. I written a quick function to translate a
tri object into a set of spatial lines, the IDs of each Lines object has the
index of the two points that it connects.

tri.asSpLines = function(x) {

    if (!inherits(x, "tri")) 
        stop("x must be of class \"tri\"")
    tnabor <- integer(x$tlnew)
    nnabs <- integer(x$n)
    nptr <- integer(x$n)
    nptr1 <- integer(x$n)
    nbnos <- integer(x$n)
    ans <- .Fortran("troutq", as.integer(x$nc), as.integer(x$lc), 
        as.integer(x$n), as.double(x$x), as.double(x$y),
as.integer(x$tlist), 
        as.integer(x$tlptr), as.integer(x$tlend), as.integer(6), 
        nnabs = as.integer(nnabs), nptr = as.integer(nptr), nptr1 =
as.integer(nptr1), 
        tnabor = as.integer(tnabor), nbnos = as.integer(nbnos), 
        na = as.integer(0), nb = as.integer(0), nt = as.integer(0), 
        PACKAGE = "tripack")

	LinesList = list()
	k=0
    for (i in 1:x$n) {
        inb <- ans$tnabor[ans$nptr[i]:ans$nptr1[i]]
        for (j in inb) {
        	LinesList[k] = Lines(list(Line(cbind(x=c(x$x[i], x$x[j]),
y=c(x$y[i], x$y[j])))), ID=paste(i,j) )
        	k=k+1
        }
    }
	
	return(SpatialLines(LinesList))
}

dat <- data.frame( 
x=c(0.34433527, 0.08592805, 0.55564179, 0.03938242, 0.98044051, 
0.19835405, 0.94186612, 0.56208017, 0.31093811, 0.54341230, 
0.93508703, 0.38160473, 0.89435383, 0.55457428, 0.22406338), 
y=c(0.997803213, 0.094993232, 0.509774611, 0.615526709, 0.004314438, 
0.676662461, 0.026060349, 0.165807011, 0.596449068, 0.469553704, 
0.888788079, 0.163129754, 0.340335312, 0.621845245, 0.019412254) 
) 

dat.tr <- tri.mesh(dat) 
dat.sl <- tri.asSpLines(dat.tr)

#only change to bound is to add the first point to the end as sp expects
polygons to be closed
bound <- SpatialPolygons(list(Polygons(list(Polygon(cbind( 
x=c(0.34063939, 0.56754974, 0.95361248, 0.96464284, 0.60694389, 
0.58173163, 0.58330740, 0.91421832, 1.00403700, 0.96464284, 
0.50294332, 0.39263968, 0.22560845, 0.02548613, 0.25397225, 
-0.01233226, 0.34063939), 
y=c(1.02171515, 0.70486571, 0.92207697, 0.84834471, 0.62116963, 
0.53747356, 0.47569788, 0.35812482, 0.02134774, -0.07231216, 
0.15287015, 0.14489909, -0.03444965, 0.09707276, 0.56138672, 
0.58729265, 1.02171515) ) )),ID="bound")))

#this is the only rgeos function, it returns true for any geometry that
crosses the bound polygon.
#byid parameter treats each Lines object as a separate geometry instead of a
single multiline geometry
(out=gCrosses(dat.sl,bound,byid=TRUE))

plot(bound,col='red')
plot(dat.sl[!out,],col='blue',add=T)
row.names(dat.sl[!out,]

Hope this helps,
-Colin
 
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Pruning-a-delaunay-triangulation-with-a-shape-tp5324088p5327334.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Fri Jul 23 02:48:13 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 22 Jul 2010 17:48:13 -0700
Subject: [R-sig-Geo] GridTopology,
	Gluing SpatialGridDataFrames together 	from adjacent Rasters
In-Reply-To: <SNT117-W282F159B5D34E958735F51C5A20@phx.gbl>
References: <SNT117-W282F159B5D34E958735F51C5A20@phx.gbl>
Message-ID: <AANLkTilfaLHCMc_REGqgbXItboozAd4tMvTJKRoFHLJA@mail.gmail.com>

Chris,

Something along these lines might work:

library(raster)
drg85<- raster("~path/drg85.tif")
drg97<- raster("~path/drg97.tif")
drg85_p<- crop(drg85, extent(xmin, xmax, ymin, ymax))
drg97_p<- crop(drg97, extent(xmin2, xmax2, ymin2, ymax2))

ext <- unionExtent(drg85_p, drg97_p)
r1 <- expand(drg85_p, ext)
x <- crop(r1, drg97_p)
x <- resample(drg97_p, x, method='bilinear')

r <- merge(r1, y, filename='test.tif')


Robert




On Thu, Jul 22, 2010 at 10:03 AM, Chris English <sglish at hotmail.com> wrote:
>
> Hi List,
>
> I am new to R spatial. ?I have group of islands in a lake that I kayak around and observe birds, animals, and vegetation. ?I wanted to create a map of my trips and points of observation.
>
> My study area is essentially at the edges of two 7.5 quads, south edge of top and north edge of bottom. ?My goal has been to join parts of these two quad maps and derive a map showing my study area.
>
> To Start:
>
> drg85<- raster("~path/drg85.tif")
> drg87<- raster("~path/drg97.tif")
>
> drg85_p<- crop(drg85, extent(xmin, xmax, ymin, ymax))
> if(require(rgdal)){drg85_pw<- writeRaster(drg85_p, filename="drg85_p",
> format="GTiff", overwrite=TRUE)}
>
> (do the same crop and write for drg97_p)
> the cropping also allowed for plotting in a small RAM laptop
> drg85_p<- readGDAL("~path/drg85_p.tif")#returns SpatialGridDataFrame
> drg97_p<- readGDAL("~path/drg97_p.tif")#returns SpatialGridDataFrame
>

a more direct approach

drg85<- raster("~path/drg85.tif")
drg97<- raster("~path/drg97.tif")

drg85_p<- crop(drg85, extent(xmin, xmax, ymin, ymax) , filename =
"drg85_p.tif") # filename can be omitted
drg97_p<- crop(drg97, extent(xmin, xmax, ymin, ymax) , filename = "drg85_p.tif")

drg85_p<- as(drg85, 'SpatialGridDataFrame')
drg97_p<- as(drg97, 'SpatialGridDataFrame')



> So I tried to cbind:
> ?drg8597_ps<- cbind(drg85_p, drg97_p)
> Error in stop.ifnot.equal(x, grds[[1]]) : topology is not equal
>
>> getGridTopology(drg85_p)
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? x ? ? ? ? ? ? ? ? ? ?y
> cellcentre.offset 1.011904e+06 ? 4.556105e+05
> cellsize ? ? ? ? ? ? ?8.252375e+00 ? 8.252375e+00
> cells.dim ? ? ? ? ? ?2.001000e+03 ? 8.960000e+02
>> getGridTopology(drg97_p)
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? x ? ? ? ? ? ? ? ? ?y
> cellcentre.offset 1.011901e+06 ? 4.54005e+05
> cellsize ? ? ? ? ? ? ?8.251850e+00 ?8.25185e+00
> cells.dim ? ? ? ? ? ?2.013000e+03 ? 2.00000e+02
>
> And indeed they're different, most especially between y cells.dim.
> Checked to see if the grids held data:
>> fullgrid(drg85_p)
> [1] TRUE
>> fullgrid(drg97_p)
> [1] TRUE
> So I thought, well most of the area is in drg85_p, why not make the topology of drg97_p the same as drg85_p and tried:
>
>> drg97_p<- GridTopology(cellcentre.offset(x=1.011904e+06,y=4.556105e+05),cellsize(x=8.252375e+00, y=8.253275e+00), cells.dim(x=2.001000e+03 y=8.960000e+02))
> Error in initialize(value, ...) :
> ?could not find function "cellcentre.offset"
>
> OK- get the form right:
>> drg97_p<- GridTopology(c(1.011904e+06, 4.556105e+05),c(8.252375e+00, 9.252375e+00),c(2.0010000e+03,8.960000e+02))
>> fullgrid(drg97_p)
> [1] FALSE
>
> Oops, the data. ?Well, I've made a grid. Go readGDAL to drg97_pd again.
>
> And now I can't figure out how to read out the data and write to my equal topology.
> Any help would be appreciated.
>
> Chris
>
>
>
>
>
>
>
> _________________________________________________________________
> The New Busy is not the old busy. Search, chat and e-mail from your inbox.
>
> N:WL:en-US:WM_HMP:042010_3
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From sglish at hotmail.com  Fri Jul 23 07:36:27 2010
From: sglish at hotmail.com (Chris English)
Date: Fri, 23 Jul 2010 01:36:27 -0400
Subject: [R-sig-Geo] GridTopology,
 Gluing SpatialGridDataFrames together 	from adjacent Rasters
In-Reply-To: <AANLkTilfaLHCMc_REGqgbXItboozAd4tMvTJKRoFHLJA@mail.gmail.com>
References: <SNT117-W282F159B5D34E958735F51C5A20@phx.gbl>,
	<AANLkTilfaLHCMc_REGqgbXItboozAd4tMvTJKRoFHLJA@mail.gmail.com>
Message-ID: <SNT117-W545859EA1DCCD1A1E641AEC5A30@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100723/b646f55b/attachment.pl>

From pierre.roudier at gmail.com  Fri Jul 23 07:38:03 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Fri, 23 Jul 2010 17:38:03 +1200
Subject: [R-sig-Geo] Pruning a delaunay triangulation with a shape
In-Reply-To: <1279833865261-5327334.post@n2.nabble.com>
References: <AANLkTinTtsUjSRkh5No-wFDX4x7n-iEyh-PwB0mxmVKU@mail.gmail.com> 
	<1279833865261-5327334.post@n2.nabble.com>
Message-ID: <AANLkTimBHhoJcmneK5nn6SA_DeG9oMvlQgk9mrdL02gv@mail.gmail.com>

Thanks Colin,

Yes, the code is great, that is exactly what I want to do. rgeos will
really be a great tool for us!

However, in the best of the worlds, I would indeed need to get back to
a tri object (or a nb object). Do you know any straightforward way to
do this?

Cheers,

Pierre

2010/7/23 rundel <rundel at gmail.com>:
>
> Depending on what you want to do downstream this may or may not be the best
> solution for this problem (say if you need to use the tri class at some
> later point) but if you just want the neighbors then you could use something
> like the following which makes use of rgeos to find which relationships
> (lines) are within the polygon. I written a quick function to translate a
> tri object into a set of spatial lines, the IDs of each Lines object has the
> index of the two points that it connects.
>
> tri.asSpLines = function(x) {
>
> ? ?if (!inherits(x, "tri"))
> ? ? ? ?stop("x must be of class \"tri\"")
> ? ?tnabor <- integer(x$tlnew)
> ? ?nnabs <- integer(x$n)
> ? ?nptr <- integer(x$n)
> ? ?nptr1 <- integer(x$n)
> ? ?nbnos <- integer(x$n)
> ? ?ans <- .Fortran("troutq", as.integer(x$nc), as.integer(x$lc),
> ? ? ? ?as.integer(x$n), as.double(x$x), as.double(x$y),
> as.integer(x$tlist),
> ? ? ? ?as.integer(x$tlptr), as.integer(x$tlend), as.integer(6),
> ? ? ? ?nnabs = as.integer(nnabs), nptr = as.integer(nptr), nptr1 =
> as.integer(nptr1),
> ? ? ? ?tnabor = as.integer(tnabor), nbnos = as.integer(nbnos),
> ? ? ? ?na = as.integer(0), nb = as.integer(0), nt = as.integer(0),
> ? ? ? ?PACKAGE = "tripack")
>
> ? ? ? ?LinesList = list()
> ? ? ? ?k=0
> ? ?for (i in 1:x$n) {
> ? ? ? ?inb <- ans$tnabor[ans$nptr[i]:ans$nptr1[i]]
> ? ? ? ?for (j in inb) {
> ? ? ? ? ? ? ? ?LinesList[k] = Lines(list(Line(cbind(x=c(x$x[i], x$x[j]),
> y=c(x$y[i], x$y[j])))), ID=paste(i,j) )
> ? ? ? ? ? ? ? ?k=k+1
> ? ? ? ?}
> ? ?}
>
> ? ? ? ?return(SpatialLines(LinesList))
> }
>
> dat <- data.frame(
> x=c(0.34433527, 0.08592805, 0.55564179, 0.03938242, 0.98044051,
> 0.19835405, 0.94186612, 0.56208017, 0.31093811, 0.54341230,
> 0.93508703, 0.38160473, 0.89435383, 0.55457428, 0.22406338),
> y=c(0.997803213, 0.094993232, 0.509774611, 0.615526709, 0.004314438,
> 0.676662461, 0.026060349, 0.165807011, 0.596449068, 0.469553704,
> 0.888788079, 0.163129754, 0.340335312, 0.621845245, 0.019412254)
> )
>
> dat.tr <- tri.mesh(dat)
> dat.sl <- tri.asSpLines(dat.tr)
>
> #only change to bound is to add the first point to the end as sp expects
> polygons to be closed
> bound <- SpatialPolygons(list(Polygons(list(Polygon(cbind(
> x=c(0.34063939, 0.56754974, 0.95361248, 0.96464284, 0.60694389,
> 0.58173163, 0.58330740, 0.91421832, 1.00403700, 0.96464284,
> 0.50294332, 0.39263968, 0.22560845, 0.02548613, 0.25397225,
> -0.01233226, 0.34063939),
> y=c(1.02171515, 0.70486571, 0.92207697, 0.84834471, 0.62116963,
> 0.53747356, 0.47569788, 0.35812482, 0.02134774, -0.07231216,
> 0.15287015, 0.14489909, -0.03444965, 0.09707276, 0.56138672,
> 0.58729265, 1.02171515) ) )),ID="bound")))
>
> #this is the only rgeos function, it returns true for any geometry that
> crosses the bound polygon.
> #byid parameter treats each Lines object as a separate geometry instead of a
> single multiline geometry
> (out=gCrosses(dat.sl,bound,byid=TRUE))
>
> plot(bound,col='red')
> plot(dat.sl[!out,],col='blue',add=T)
> row.names(dat.sl[!out,]
>
> Hope this helps,
> -Colin
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Pruning-a-delaunay-triangulation-with-a-shape-tp5324088p5327334.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From blanc.laetitia.esr34 at gmail.com  Fri Jul 23 12:28:10 2010
From: blanc.laetitia.esr34 at gmail.com (Laetitia Blanc)
Date: Fri, 23 Jul 2010 03:28:10 -0700 (PDT)
Subject: [R-sig-Geo] grid and spatial selection
Message-ID: <1279880890707-5329029.post@n2.nabble.com>


Hi,

I have imported 2 Shapefiles : the first one is a map (france) and the
second one is a grid (cross-ruling) (maillesfrance) with cells' size =3x3km.
Then i've imported points with specific coordinates (csv) that i transformed
(spcsv2) into the same coordinate system as the map and the grid.

Code:
#import the map :
france <- readShapePoly("E:/docs stage/GIS/Fonds de
carte/test/FranceDpt.shp", proj4string=CRS("+init=epsg:27572"))

#import the grid
maillesfrance <- readShapePoly ( "E:/docs stage/R/mailles3x3_Intersect.shp",
proj4string=CRS ("+init=epsg:27572") )

#points :
csv <- read.csv ("indicesdommages2009.csv", header=TRUE, sep=";")
csv2 <- data.frame (csv)
spcsv2 <- csv2

#transform into SpatialPointDataFrame
coordinates ( spcsv2 ) <- ~ X500 + Y500
proj4string ( spcsv2 ) <- CRS("+init=epsg:27572")


#plot 
plot(france)
plot(maillesfrance,col="green",add=TRUE)
plot(spcsv2,col="red",pch=16,add=TRUE)



I would like to realise a spatial selection of the cells of 3x3km that
contain one (or more) points from the object spcsv2 and then to highlight
those cells. I have done it with ArcGIS but is it possible with R ? If it's
not possible from a shapefile, how can i use the function grid() specifying
the cellsize to create a new grid ?

Any help would be great...
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/grid-and-spatial-selection-tp5329029p5329029.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.aluizio at gmail.com  Fri Jul 23 12:43:19 2010
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Fri, 23 Jul 2010 07:43:19 -0300
Subject: [R-sig-Geo] RES:  Import Part of a GeoTiff using readGDAL{rgdal}
In-Reply-To: <AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>
References: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
	<AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>
Message-ID: <000001cb2a53$df97a2a0$9ec6e7e0$@gmail.com>

Excellent suggestion, but I'm facing another little problem. When importing through raster{raster}, I lost the band data structure (but the data seems to still be there) which turns impossible to reproduce the original colors. Is there a way to bypass this?

Thanks.

Rodrigo.

-----Mensagem original-----
De: Michael Sumner [mailto:mdsumner at gmail.com] 
Enviada em: quinta-feira, 22 de julho de 2010 12:50
Para: Rodrigo Aluizio
Cc: R Help
Assunto: Re: [R-sig-Geo] Import Part of a GeoTiff using readGDAL{rgdal}

With readGDAL you must figure out the impled coordinates, referenced from the top left - it's confusing, but with some experimenting you will get it.

But, far easier is to use the raster package, which will let you deal with the entire Etopo1 if you want by accessing the file as needed, and there are simpler methods to crop the big raster - and coerce to SpatialGridDataFrame if need be.

E.g.
## all this works pretty fast as raster takes care of the memory
library(raster)
etopo1 <- raster("Etopo1.tif")
 e <- extent(-90, -32, -60, 15)
r <- crop(etopo1, e)
plot(r)

## if we want to enforce the full memory use as an sp object x <- as(r, "SpatialGridDataFrame")
image(x)
summary(x)
Object of class SpatialGridDataFrame
Coordinates:
   min max
s1 -90 -32
s2 -60  15
Is projected: FALSE
proj4string :
[+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0] Number of points: 2 Grid attributes:
   cellcentre.offset   cellsize cells.dim
s1         -89.99167 0.01666667      3480
s2         -59.99167 0.01666667      4500
Data attributes:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  -8086   -4188   -2583   -2025     148    6494



sessionInfo()
R version 2.11.1 (2010-05-31)
x86_64-pc-mingw32

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252 [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C [5] LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-27 raster_1.2-6 sp_0.9-65

loaded via a namespace (and not attached):
[1] grid_2.11.1    lattice_0.18-8 tools_2.11.1

On Fri, Jul 23, 2010 at 1:14 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
> Hi List.
>
> I?m trying to import only a part of interest from a raster image map 
> (let say, ETOPO 1 Global Relief GeoTiff). I realize that, PROBABLY, 
> the readGDAL function can deal with my issue through the arguments:
>
>
>
> offset - Number of rows and columns from the origin (usually the upper 
> left
> corner) to begin reading from; presently ordered (y,x) - this may 
> change
>
> region.dim - The number of rows and columns to read from the dataset; 
> presently ordered (y,x) - this may change
>
>
>
> But, I don?t know exactly how to specify that I want the rows (and 
> columns?) which show only South America, I do know the SA coordinate 
> limits, but not the corresponding rows.
>
> The real problem is that I don?t know how to use the function 
> resources properly. I?m trying to limit the region during import to 
> avoid memory limit issues, once importing the ETOPO 1 Geotiff tries to generate a huge vector.
>
> Really Sorry About It, Thanks for Your Patience and Attention.
>
>
>
> -------------------------------------------------------------
>
> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>
> Centro de Estudos do Mar/UFPR
> Laborat?rio de Micropaleontologia
> Avenida Beira Mar s/n - CEP 83255-000
> Pontal do Paran? - PR - Brasil
>
>
>
>
>        [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



--
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania Hobart, Australia
e-mail: mdsumner at gmail.com


From Henk.Sierdsema at sovon.nl  Fri Jul 23 13:28:31 2010
From: Henk.Sierdsema at sovon.nl (Henk Sierdsema)
Date: Fri, 23 Jul 2010 13:28:31 +0200
Subject: [R-sig-Geo] writeOGR error: problem with GDAL (libgdal1- 1.7.0)
References: <F7A3EE6B27F4D54B9CCAAB767F1B5AA3FDBBE9@SOVON1.SOVON.local>
	<AD51AB79BC327C40AB2C7EB75D57A3C4051326@TOLAR.valuta.nhh.no>
Message-ID: <F7A3EE6B27F4D54B9CCAAB767F1B5AA301952928@SOVON1.SOVON.local>

Hi Roger,
 
You're right of course: replacing the library with an older version works, but it's definitely not chique. So I looked into the problem a little bit deeper, following up on the remarks of Agus. It turns out, that the latest version of rgdal works fine with variable-names up to 10 characters, but crashes on longer variable-names. The problem appears apparently both on a Linux- (Ubuntu 9) and Windows-platforms (XP, Win7).
 
Henk
 

________________________________

Van: Roger Bivand [mailto:Roger.Bivand at nhh.no]
Verzonden: wo 21-7-2010 23:17
Aan: Henk Sierdsema; Agustin Lobo; r-sig-geo at stat.math.ethz.ch
Onderwerp: SV: [R-sig-Geo] writeOGR error: problem with GDAL (libgdal1- 1.7.0)


Success is of course in the eye of the beholder. You are free to change your own installation in arguably bad ways, but please do not advise others to do so on the list. Lots of peoiple may be misled by your suggestion. It would be possible to rebuild (guessing that you are using Windows) to rebuild an older source rgdal for newer R in order to retain previous behaviour, but messing with an installed library of R packages is always a questionable idea.

Roger

PS. Since the original posting was made (two months ago), rgdal has been revised, including IIRC changed messages in this case.

--- Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no

________________________________

Fra: r-sig-geo-bounces at stat.math.ethz.ch p? vegne av Henk Sierdsema
Sendt: on 2010-07-21 13:17
Til: Agustin Lobo; r-sig-geo at stat.math.ethz.ch
Emne: Re: [R-sig-Geo] writeOGR error: problem with GDAL (libgdal1- 1.7.0)



Hi Augustin,

I've encountered the same problem after an update of the rgdal-package. I have resolved the problem by removing the rgal-folder in the library and replacing it by an older version of November 2009. You can download that version of www.sovon.nl/temp/rgdal_nov_2009.zip

Success!

Henk



-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch]Namens Agustin Lobo
Verzonden: vrijdag 21 mei 2010 7:39
Aan: r-sig-geo at stat.math.ethz.ch
Onderwerp: [R-sig-Geo] writeOGR error: problem with GDAL (libgdal1-
1.7.0)



I'm getting this error using a command and an object that
used to work few months ago

> writeOGR(Montseny20090409shtotspols, dsn="Montseny20090409tots2",
> layer="Montseny20090409shtots2",driver="ESRI Shapefile")
Error in writeOGR(Montseny20090409shtotspols, dsn = "Montseny20090409tots2",
:

        GDAL Error 1: Invalid index : -1
Calls: writeOGR -> .Call
In addition: Warning messages:
1: In writeOGR(Montseny20090409shtotspols, dsn = "Montseny20090409tots2",  :

        Non-fatal GDAL Error 6: Normalized/laundered field name: 'coords.x1.1' to
'coords.x1.'
2: In writeOGR(Montseny20090409shtotspols, dsn = "Montseny20090409tots2",  :

        Non-fatal GDAL Error 6: Normalized/laundered field name: 'coords.x2.1' to
'coords.x2.'

Both the Error and Warnings are new, and are actually related: if I do:
> names(Montseny20090409shtotspols at data)[31]<-"UTMX"
> names(Montseny20090409shtotspols at data)[32]<-"UTMY"

writeOGR() works fine.

Could a more explicit error message, linking the error to the problem with
the names, be issued by writeOGR() ? Initially I even thought I could have a
disk problem!

I recently upgraded from ubuntu 9.04 to 9.10 and to libgdal1-1.7.0.
R version 2.11.0 (2010-04-22)
 Package: rgdal
Version: 0.6-27
Date: 2010-05-11

Thanks

Agus
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/writeOGR-error-problem-with-GDAL-libgdal1-1-7-0-tp5082811p5082811.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From elaine.kuo.tw at gmail.com  Fri Jul 23 14:16:02 2010
From: elaine.kuo.tw at gmail.com (elaine kuo)
Date: Fri, 23 Jul 2010 20:16:02 +0800
Subject: [R-sig-Geo] error in errorsarlm
In-Reply-To: <alpine.LRH.2.00.1007201614260.18432@reclus.nhh.no>
References: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
	<alpine.LRH.2.00.1007162144300.19802@reclus.nhh.no>
	<AANLkTik9muDJNtOG4lyJXl2Fk96c3CRDJAZ6dNJDntvq@mail.gmail.com>
	<alpine.LRH.2.00.1007171534310.22601@reclus.nhh.no>
	<AANLkTinWLIBpZQBFjANAgXkfXudfoUmGg8YGek3zD4R4@mail.gmail.com>
	<alpine.LRH.2.00.1007201614260.18432@reclus.nhh.no>
Message-ID: <AANLkTik_BYkRFUMMC-Vr-UY0UfhOyJZ6HJfg98BDpndt@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100723/2dd83acc/attachment.pl>

From mdsumner at gmail.com  Fri Jul 23 15:52:52 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 23 Jul 2010 23:52:52 +1000
Subject: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}
In-Reply-To: <000001cb2a53$df97a2a0$9ec6e7e0$@gmail.com>
References: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
	<AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>
	<000001cb2a53$df97a2a0$9ec6e7e0$@gmail.com>
Message-ID: <AANLkTim-=LvjumSeyi4N_puJ3cTYyCBJ1m9PU6iGSBJh@mail.gmail.com>

I don't know what you mean by "band data structure" and "original
colors". I just have the generic (ice/cell registered) Etopo1 which is
elevation values as 16-bit integers. Perhaps you could describe the
actual file you have more, where you got it, and how you have used it
before.

Cheers, Mike.

On Fri, Jul 23, 2010 at 8:43 PM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
> Excellent suggestion, but I'm facing another little problem. When importing through raster{raster}, I lost the band data structure (but the data seems to still be there) which turns impossible to reproduce the original colors. Is there a way to bypass this?
>
> Thanks.
>
> Rodrigo.
>
> -----Mensagem original-----
> De: Michael Sumner [mailto:mdsumner at gmail.com]
> Enviada em: quinta-feira, 22 de julho de 2010 12:50
> Para: Rodrigo Aluizio
> Cc: R Help
> Assunto: Re: [R-sig-Geo] Import Part of a GeoTiff using readGDAL{rgdal}
>
> With readGDAL you must figure out the impled coordinates, referenced from the top left - it's confusing, but with some experimenting you will get it.
>
> But, far easier is to use the raster package, which will let you deal with the entire Etopo1 if you want by accessing the file as needed, and there are simpler methods to crop the big raster - and coerce to SpatialGridDataFrame if need be.
>
> E.g.
> ## all this works pretty fast as raster takes care of the memory
> library(raster)
> etopo1 <- raster("Etopo1.tif")
> ?e <- extent(-90, -32, -60, 15)
> r <- crop(etopo1, e)
> plot(r)
>
> ## if we want to enforce the full memory use as an sp object x <- as(r, "SpatialGridDataFrame")
> image(x)
> summary(x)
> Object of class SpatialGridDataFrame
> Coordinates:
> ? min max
> s1 -90 -32
> s2 -60 ?15
> Is projected: FALSE
> proj4string :
> [+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0] Number of points: 2 Grid attributes:
> ? cellcentre.offset ? cellsize cells.dim
> s1 ? ? ? ? -89.99167 0.01666667 ? ? ?3480
> s2 ? ? ? ? -59.99167 0.01666667 ? ? ?4500
> Data attributes:
> ? Min. 1st Qu. ?Median ? ?Mean 3rd Qu. ? ?Max.
> ?-8086 ? -4188 ? -2583 ? -2025 ? ? 148 ? ?6494
>
>
>
> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-pc-mingw32
>
> locale:
> [1] LC_COLLATE=English_Australia.1252 ?LC_CTYPE=English_Australia.1252 [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> [1] rgdal_0.6-27 raster_1.2-6 sp_0.9-65
>
> loaded via a namespace (and not attached):
> [1] grid_2.11.1 ? ?lattice_0.18-8 tools_2.11.1
>
> On Fri, Jul 23, 2010 at 1:14 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>> Hi List.
>>
>> I?m trying to import only a part of interest from a raster image map
>> (let say, ETOPO 1 Global Relief GeoTiff). I realize that, PROBABLY,
>> the readGDAL function can deal with my issue through the arguments:
>>
>>
>>
>> offset - Number of rows and columns from the origin (usually the upper
>> left
>> corner) to begin reading from; presently ordered (y,x) - this may
>> change
>>
>> region.dim - The number of rows and columns to read from the dataset;
>> presently ordered (y,x) - this may change
>>
>>
>>
>> But, I don?t know exactly how to specify that I want the rows (and
>> columns?) which show only South America, I do know the SA coordinate
>> limits, but not the corresponding rows.
>>
>> The real problem is that I don?t know how to use the function
>> resources properly. I?m trying to limit the region during import to
>> avoid memory limit issues, once importing the ETOPO 1 Geotiff tries to generate a huge vector.
>>
>> Really Sorry About It, Thanks for Your Patience and Attention.
>>
>>
>>
>> -------------------------------------------------------------
>>
>> MSc. ?<mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>
>> Centro de Estudos do Mar/UFPR
>> Laborat?rio de Micropaleontologia
>> Avenida Beira Mar s/n - CEP 83255-000
>> Pontal do Paran? - PR - Brasil
>>
>>
>>
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.aluizio at gmail.com  Fri Jul 23 16:09:04 2010
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Fri, 23 Jul 2010 11:09:04 -0300
Subject: [R-sig-Geo] RES: RES: Import Part of a GeoTiff using readGDAL{rgdal}
In-Reply-To: <AANLkTim-=LvjumSeyi4N_puJ3cTYyCBJ1m9PU6iGSBJh@mail.gmail.com>
References: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
	<AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>
	<000001cb2a53$df97a2a0$9ec6e7e0$@gmail.com>
	<AANLkTim-=LvjumSeyi4N_puJ3cTYyCBJ1m9PU6iGSBJh@mail.gmail.com>
Message-ID: <000f01cb2a70$9d100e50$d7302af0$@gmail.com>

Well Etopo1 have the colored image as well (ftp://ftp.ngdc.noaa.gov/mgg/global/relief/ETOPO1/image/color_etopo1_ice_full.tif.gz). I'm not able to import it using readGDAL (because of the vector size), but normally when I do so with georeferenced images, the object created have, in the data slot, the three band (RGB) color codes as columns. Using raster{raster} and then as(x,'SpatialGridDataFrame') these data seems to get truncated and unrecognizable to image{sp}.

Regards.

Rodrigo

-----Mensagem original-----
De: Michael Sumner [mailto:mdsumner at gmail.com] 
Enviada em: sexta-feira, 23 de julho de 2010 10:53
Para: Rodrigo Aluizio
Cc: R Help
Assunto: Re: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}

I don't know what you mean by "band data structure" and "original colors". I just have the generic (ice/cell registered) Etopo1 which is elevation values as 16-bit integers. Perhaps you could describe the actual file you have more, where you got it, and how you have used it before.

Cheers, Mike.

On Fri, Jul 23, 2010 at 8:43 PM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
> Excellent suggestion, but I'm facing another little problem. When importing through raster{raster}, I lost the band data structure (but the data seems to still be there) which turns impossible to reproduce the original colors. Is there a way to bypass this?
>
> Thanks.
>
> Rodrigo.
>
> -----Mensagem original-----
> De: Michael Sumner [mailto:mdsumner at gmail.com] Enviada em: 
> quinta-feira, 22 de julho de 2010 12:50
> Para: Rodrigo Aluizio
> Cc: R Help
> Assunto: Re: [R-sig-Geo] Import Part of a GeoTiff using 
> readGDAL{rgdal}
>
> With readGDAL you must figure out the impled coordinates, referenced from the top left - it's confusing, but with some experimenting you will get it.
>
> But, far easier is to use the raster package, which will let you deal with the entire Etopo1 if you want by accessing the file as needed, and there are simpler methods to crop the big raster - and coerce to SpatialGridDataFrame if need be.
>
> E.g.
> ## all this works pretty fast as raster takes care of the memory
> library(raster)
> etopo1 <- raster("Etopo1.tif")
>  e <- extent(-90, -32, -60, 15)
> r <- crop(etopo1, e)
> plot(r)
>
> ## if we want to enforce the full memory use as an sp object x <- 
> as(r, "SpatialGridDataFrame")
> image(x)
> summary(x)
> Object of class SpatialGridDataFrame
> Coordinates:
>   min max
> s1 -90 -32
> s2 -60  15
> Is projected: FALSE
> proj4string :
> [+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0] Number of points: 2 Grid attributes:
>   cellcentre.offset   cellsize cells.dim
> s1         -89.99167 0.01666667      3480
> s2         -59.99167 0.01666667      4500 Data attributes:
>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>  -8086   -4188   -2583   -2025     148    6494
>
>
>
> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-pc-mingw32
>
> locale:
> [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252 
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C [5] 
> LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.6-27 raster_1.2-6 sp_0.9-65
>
> loaded via a namespace (and not attached):
> [1] grid_2.11.1    lattice_0.18-8 tools_2.11.1
>
> On Fri, Jul 23, 2010 at 1:14 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>> Hi List.
>>
>> I?m trying to import only a part of interest from a raster image map 
>> (let say, ETOPO 1 Global Relief GeoTiff). I realize that, PROBABLY, 
>> the readGDAL function can deal with my issue through the arguments:
>>
>>
>>
>> offset - Number of rows and columns from the origin (usually the 
>> upper left
>> corner) to begin reading from; presently ordered (y,x) - this may 
>> change
>>
>> region.dim - The number of rows and columns to read from the dataset; 
>> presently ordered (y,x) - this may change
>>
>>
>>
>> But, I don?t know exactly how to specify that I want the rows (and
>> columns?) which show only South America, I do know the SA coordinate 
>> limits, but not the corresponding rows.
>>
>> The real problem is that I don?t know how to use the function 
>> resources properly. I?m trying to limit the region during import to 
>> avoid memory limit issues, once importing the ETOPO 1 Geotiff tries to generate a huge vector.
>>
>> Really Sorry About It, Thanks for Your Patience and Attention.
>>
>>
>>
>> -------------------------------------------------------------
>>
>> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>
>> Centro de Estudos do Mar/UFPR
>> Laborat?rio de Micropaleontologia
>> Avenida Beira Mar s/n - CEP 83255-000 Pontal do Paran? - PR - Brasil
>>
>>
>>
>>
>>        [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From mdsumner at gmail.com  Fri Jul 23 16:54:39 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 24 Jul 2010 00:54:39 +1000
Subject: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}
In-Reply-To: <000f01cb2a70$9d100e50$d7302af0$@gmail.com>
References: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
	<AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>
	<000001cb2a53$df97a2a0$9ec6e7e0$@gmail.com>
	<AANLkTim-=LvjumSeyi4N_puJ3cTYyCBJ1m9PU6iGSBJh@mail.gmail.com>
	<000f01cb2a70$9d100e50$d7302af0$@gmail.com>
Message-ID: <AANLkTi=uSctF=8HXo29Oxa_-TxCPYagVZayO=9aXTzei@mail.gmail.com>

I know this is rather simplistic, and has bugs that I just don't have
the impetus to track down at the moment, but it should work for your
problem. I didn't realize that raster doesn't support (AFAICS)
multiband rasters, such as 3-band images.

Please use with caution - there are bugs! and very bad practices . . .

readpartGDAL <- function(x, xlim = NULL, ylim = NULL, ...) {
	require(rgdal)
	info <- GDALinfo(x)
	offs <- info[c("ll.x", "ll.y")]
	scl <- info[c("res.x", "res.y")]
	dimn <- info[c("columns", "rows")]
	## brain dead, but easy
	xs <- seq(offs[1], by = scl[1], length = dimn[1]) + scl[1]/2
	ys <- seq(offs[2], by = scl[2], length = dimn[2]) + scl[2]/2

	if (!is.null(xlim)) {
		if (!is.numeric(xlim)) stop("xlim must be numeric")
		if (!length(xlim) == 2) stop("xlim must be of length 2")
		if (!diff(xlim) > 0) stop("xlim[1] must be less than xlim[2]")
		xind <- which(xs >= xlim[1] & xs <= xlim[2])
	}

	if (!is.null(ylim)) {
		if (!is.numeric(ylim)) stop("ylim must be numeric")
		if (!length(ylim) == 2) stop("ylim must be of length 2")
		if (!diff(ylim) > 0) stop("ylim[1] must be less than ylim[2]")
		yind <- which(ys >= ylim[1] & ys <= ylim[2])
	}
	## probably need a sign check for info["ysign"]
	## reverse for y/x order in readGDAL
	rgdal.offset <- rev(c(min(xind), dimn[2] - max(yind)))
	rgdal.dim <- rev(c(length(xind), length(yind)))
	readGDAL(x, offset = rgdal.offset, region.dim = rgdal.dim, ...)
}

f <- "Etopo1.tif"

d <- readpartGDAL(f, xlim = c(-90, -32), ylim = c(-60, 15))

## assuming you have 3-bands describing RGB
## (see ?SGDF2PCT
cols <- SGDF2PCT(d)
d$idx <- cols$idx
image(d, "idx", col = cols$ct)



On Sat, Jul 24, 2010 at 12:09 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
> Well Etopo1 have the colored image as well (ftp://ftp.ngdc.noaa.gov/mgg/global/relief/ETOPO1/image/color_etopo1_ice_full.tif.gz). I'm not able to import it using readGDAL (because of the vector size), but normally when I do so with georeferenced images, the object created have, in the data slot, the three band (RGB) color codes as columns. Using raster{raster} and then as(x,'SpatialGridDataFrame') these data seems to get truncated and unrecognizable to image{sp}.
>
> Regards.
>
> Rodrigo
>
> -----Mensagem original-----
> De: Michael Sumner [mailto:mdsumner at gmail.com]
> Enviada em: sexta-feira, 23 de julho de 2010 10:53
> Para: Rodrigo Aluizio
> Cc: R Help
> Assunto: Re: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}
>
> I don't know what you mean by "band data structure" and "original colors". I just have the generic (ice/cell registered) Etopo1 which is elevation values as 16-bit integers. Perhaps you could describe the actual file you have more, where you got it, and how you have used it before.
>
> Cheers, Mike.
>
> On Fri, Jul 23, 2010 at 8:43 PM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>> Excellent suggestion, but I'm facing another little problem. When importing through raster{raster}, I lost the band data structure (but the data seems to still be there) which turns impossible to reproduce the original colors. Is there a way to bypass this?
>>
>> Thanks.
>>
>> Rodrigo.
>>
>> -----Mensagem original-----
>> De: Michael Sumner [mailto:mdsumner at gmail.com] Enviada em:
>> quinta-feira, 22 de julho de 2010 12:50
>> Para: Rodrigo Aluizio
>> Cc: R Help
>> Assunto: Re: [R-sig-Geo] Import Part of a GeoTiff using
>> readGDAL{rgdal}
>>
>> With readGDAL you must figure out the impled coordinates, referenced from the top left - it's confusing, but with some experimenting you will get it.
>>
>> But, far easier is to use the raster package, which will let you deal with the entire Etopo1 if you want by accessing the file as needed, and there are simpler methods to crop the big raster - and coerce to SpatialGridDataFrame if need be.
>>
>> E.g.
>> ## all this works pretty fast as raster takes care of the memory
>> library(raster)
>> etopo1 <- raster("Etopo1.tif")
>> ?e <- extent(-90, -32, -60, 15)
>> r <- crop(etopo1, e)
>> plot(r)
>>
>> ## if we want to enforce the full memory use as an sp object x <-
>> as(r, "SpatialGridDataFrame")
>> image(x)
>> summary(x)
>> Object of class SpatialGridDataFrame
>> Coordinates:
>> ? min max
>> s1 -90 -32
>> s2 -60 ?15
>> Is projected: FALSE
>> proj4string :
>> [+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0] Number of points: 2 Grid attributes:
>> ? cellcentre.offset ? cellsize cells.dim
>> s1 ? ? ? ? -89.99167 0.01666667 ? ? ?3480
>> s2 ? ? ? ? -59.99167 0.01666667 ? ? ?4500 Data attributes:
>> ? Min. 1st Qu. ?Median ? ?Mean 3rd Qu. ? ?Max.
>> ?-8086 ? -4188 ? -2583 ? -2025 ? ? 148 ? ?6494
>>
>>
>>
>> sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> x86_64-pc-mingw32
>>
>> locale:
>> [1] LC_COLLATE=English_Australia.1252 ?LC_CTYPE=English_Australia.1252
>> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C [5]
>> LC_TIME=English_Australia.1252
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] rgdal_0.6-27 raster_1.2-6 sp_0.9-65
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.11.1 ? ?lattice_0.18-8 tools_2.11.1
>>
>> On Fri, Jul 23, 2010 at 1:14 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>>> Hi List.
>>>
>>> I?m trying to import only a part of interest from a raster image map
>>> (let say, ETOPO 1 Global Relief GeoTiff). I realize that, PROBABLY,
>>> the readGDAL function can deal with my issue through the arguments:
>>>
>>>
>>>
>>> offset - Number of rows and columns from the origin (usually the
>>> upper left
>>> corner) to begin reading from; presently ordered (y,x) - this may
>>> change
>>>
>>> region.dim - The number of rows and columns to read from the dataset;
>>> presently ordered (y,x) - this may change
>>>
>>>
>>>
>>> But, I don?t know exactly how to specify that I want the rows (and
>>> columns?) which show only South America, I do know the SA coordinate
>>> limits, but not the corresponding rows.
>>>
>>> The real problem is that I don?t know how to use the function
>>> resources properly. I?m trying to limit the region during import to
>>> avoid memory limit issues, once importing the ETOPO 1 Geotiff tries to generate a huge vector.
>>>
>>> Really Sorry About It, Thanks for Your Patience and Attention.
>>>
>>>
>>>
>>> -------------------------------------------------------------
>>>
>>> MSc. ?<mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>>
>>> Centro de Estudos do Mar/UFPR
>>> Laborat?rio de Micropaleontologia
>>> Avenida Beira Mar s/n - CEP 83255-000 Pontal do Paran? - PR - Brasil
>>>
>>>
>>>
>>>
>>> ? ? ? ?[[alternative HTML version deleted]]
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>>
>>
>> --
>> Michael Sumner
>> Institute for Marine and Antarctic Studies, University of Tasmania Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.hijmans at gmail.com  Fri Jul 23 18:53:04 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 23 Jul 2010 09:53:04 -0700
Subject: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}
In-Reply-To: <AANLkTi=uSctF=8HXo29Oxa_-TxCPYagVZayO=9aXTzei@mail.gmail.com>
References: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
	<AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>
	<000001cb2a53$df97a2a0$9ec6e7e0$@gmail.com>
	<AANLkTim-=LvjumSeyi4N_puJ3cTYyCBJ1m9PU6iGSBJh@mail.gmail.com>
	<000f01cb2a70$9d100e50$d7302af0$@gmail.com>
	<AANLkTi=uSctF=8HXo29Oxa_-TxCPYagVZayO=9aXTzei@mail.gmail.com>
Message-ID: <AANLkTik99sOqO5aoq05pwNkAyENHR==4Ks4yB7Nptav-@mail.gmail.com>

If you want a multi-layer object you can create a RasterBrick in stead
of a RasterLayer. I.e. 'brick()' in stead of  'raster()'

library(raster)
etopo1 <- brick("Etopo1.tif") # change here
e <- extent(-90, -32, -60, 15)
r <- crop(etopo1, e)


Alternatively, you could create three RasterLayer objects
etopo1 <- brick("Etopo1.tif", band=1)
etopo2 <- brick("Etopo1.tif", band=2)
etopo3 <- brick("Etopo1.tif", band=3)


Robert

On Fri, Jul 23, 2010 at 7:54 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> I know this is rather simplistic, and has bugs that I just don't have
> the impetus to track down at the moment, but it should work for your
> problem. I didn't realize that raster doesn't support (AFAICS)
> multiband rasters, such as 3-band images.
>
> Please use with caution - there are bugs! and very bad practices . . .
>
> readpartGDAL <- function(x, xlim = NULL, ylim = NULL, ...) {
> ? ? ? ?require(rgdal)
> ? ? ? ?info <- GDALinfo(x)
> ? ? ? ?offs <- info[c("ll.x", "ll.y")]
> ? ? ? ?scl <- info[c("res.x", "res.y")]
> ? ? ? ?dimn <- info[c("columns", "rows")]
> ? ? ? ?## brain dead, but easy
> ? ? ? ?xs <- seq(offs[1], by = scl[1], length = dimn[1]) + scl[1]/2
> ? ? ? ?ys <- seq(offs[2], by = scl[2], length = dimn[2]) + scl[2]/2
>
> ? ? ? ?if (!is.null(xlim)) {
> ? ? ? ? ? ? ? ?if (!is.numeric(xlim)) stop("xlim must be numeric")
> ? ? ? ? ? ? ? ?if (!length(xlim) == 2) stop("xlim must be of length 2")
> ? ? ? ? ? ? ? ?if (!diff(xlim) > 0) stop("xlim[1] must be less than xlim[2]")
> ? ? ? ? ? ? ? ?xind <- which(xs >= xlim[1] & xs <= xlim[2])
> ? ? ? ?}
>
> ? ? ? ?if (!is.null(ylim)) {
> ? ? ? ? ? ? ? ?if (!is.numeric(ylim)) stop("ylim must be numeric")
> ? ? ? ? ? ? ? ?if (!length(ylim) == 2) stop("ylim must be of length 2")
> ? ? ? ? ? ? ? ?if (!diff(ylim) > 0) stop("ylim[1] must be less than ylim[2]")
> ? ? ? ? ? ? ? ?yind <- which(ys >= ylim[1] & ys <= ylim[2])
> ? ? ? ?}
> ? ? ? ?## probably need a sign check for info["ysign"]
> ? ? ? ?## reverse for y/x order in readGDAL
> ? ? ? ?rgdal.offset <- rev(c(min(xind), dimn[2] - max(yind)))
> ? ? ? ?rgdal.dim <- rev(c(length(xind), length(yind)))
> ? ? ? ?readGDAL(x, offset = rgdal.offset, region.dim = rgdal.dim, ...)
> }
>
> f <- "Etopo1.tif"
>
> d <- readpartGDAL(f, xlim = c(-90, -32), ylim = c(-60, 15))
>
> ## assuming you have 3-bands describing RGB
> ## (see ?SGDF2PCT
> cols <- SGDF2PCT(d)
> d$idx <- cols$idx
> image(d, "idx", col = cols$ct)
>
>
>
> On Sat, Jul 24, 2010 at 12:09 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>> Well Etopo1 have the colored image as well (ftp://ftp.ngdc.noaa.gov/mgg/global/relief/ETOPO1/image/color_etopo1_ice_full.tif.gz). I'm not able to import it using readGDAL (because of the vector size), but normally when I do so with georeferenced images, the object created have, in the data slot, the three band (RGB) color codes as columns. Using raster{raster} and then as(x,'SpatialGridDataFrame') these data seems to get truncated and unrecognizable to image{sp}.
>>
>> Regards.
>>
>> Rodrigo
>>
>> -----Mensagem original-----
>> De: Michael Sumner [mailto:mdsumner at gmail.com]
>> Enviada em: sexta-feira, 23 de julho de 2010 10:53
>> Para: Rodrigo Aluizio
>> Cc: R Help
>> Assunto: Re: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}
>>
>> I don't know what you mean by "band data structure" and "original colors". I just have the generic (ice/cell registered) Etopo1 which is elevation values as 16-bit integers. Perhaps you could describe the actual file you have more, where you got it, and how you have used it before.
>>
>> Cheers, Mike.
>>
>> On Fri, Jul 23, 2010 at 8:43 PM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>>> Excellent suggestion, but I'm facing another little problem. When importing through raster{raster}, I lost the band data structure (but the data seems to still be there) which turns impossible to reproduce the original colors. Is there a way to bypass this?
>>>
>>> Thanks.
>>>
>>> Rodrigo.
>>>
>>> -----Mensagem original-----
>>> De: Michael Sumner [mailto:mdsumner at gmail.com] Enviada em:
>>> quinta-feira, 22 de julho de 2010 12:50
>>> Para: Rodrigo Aluizio
>>> Cc: R Help
>>> Assunto: Re: [R-sig-Geo] Import Part of a GeoTiff using
>>> readGDAL{rgdal}
>>>
>>> With readGDAL you must figure out the impled coordinates, referenced from the top left - it's confusing, but with some experimenting you will get it.
>>>
>>> But, far easier is to use the raster package, which will let you deal with the entire Etopo1 if you want by accessing the file as needed, and there are simpler methods to crop the big raster - and coerce to SpatialGridDataFrame if need be.
>>>
>>> E.g.
>>> ## all this works pretty fast as raster takes care of the memory
>>> library(raster)
>>> etopo1 <- raster("Etopo1.tif")
>>> ?e <- extent(-90, -32, -60, 15)
>>> r <- crop(etopo1, e)
>>> plot(r)
>>>
>>> ## if we want to enforce the full memory use as an sp object x <-
>>> as(r, "SpatialGridDataFrame")
>>> image(x)
>>> summary(x)
>>> Object of class SpatialGridDataFrame
>>> Coordinates:
>>> ? min max
>>> s1 -90 -32
>>> s2 -60 ?15
>>> Is projected: FALSE
>>> proj4string :
>>> [+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0] Number of points: 2 Grid attributes:
>>> ? cellcentre.offset ? cellsize cells.dim
>>> s1 ? ? ? ? -89.99167 0.01666667 ? ? ?3480
>>> s2 ? ? ? ? -59.99167 0.01666667 ? ? ?4500 Data attributes:
>>> ? Min. 1st Qu. ?Median ? ?Mean 3rd Qu. ? ?Max.
>>> ?-8086 ? -4188 ? -2583 ? -2025 ? ? 148 ? ?6494
>>>
>>>
>>>
>>> sessionInfo()
>>> R version 2.11.1 (2010-05-31)
>>> x86_64-pc-mingw32
>>>
>>> locale:
>>> [1] LC_COLLATE=English_Australia.1252 ?LC_CTYPE=English_Australia.1252
>>> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C [5]
>>> LC_TIME=English_Australia.1252
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] rgdal_0.6-27 raster_1.2-6 sp_0.9-65
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.11.1 ? ?lattice_0.18-8 tools_2.11.1
>>>
>>> On Fri, Jul 23, 2010 at 1:14 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>>>> Hi List.
>>>>
>>>> I?m trying to import only a part of interest from a raster image map
>>>> (let say, ETOPO 1 Global Relief GeoTiff). I realize that, PROBABLY,
>>>> the readGDAL function can deal with my issue through the arguments:
>>>>
>>>>
>>>>
>>>> offset - Number of rows and columns from the origin (usually the
>>>> upper left
>>>> corner) to begin reading from; presently ordered (y,x) - this may
>>>> change
>>>>
>>>> region.dim - The number of rows and columns to read from the dataset;
>>>> presently ordered (y,x) - this may change
>>>>
>>>>
>>>>
>>>> But, I don?t know exactly how to specify that I want the rows (and
>>>> columns?) which show only South America, I do know the SA coordinate
>>>> limits, but not the corresponding rows.
>>>>
>>>> The real problem is that I don?t know how to use the function
>>>> resources properly. I?m trying to limit the region during import to
>>>> avoid memory limit issues, once importing the ETOPO 1 Geotiff tries to generate a huge vector.
>>>>
>>>> Really Sorry About It, Thanks for Your Patience and Attention.
>>>>
>>>>
>>>>
>>>> -------------------------------------------------------------
>>>>
>>>> MSc. ?<mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>>>
>>>> Centro de Estudos do Mar/UFPR
>>>> Laborat?rio de Micropaleontologia
>>>> Avenida Beira Mar s/n - CEP 83255-000 Pontal do Paran? - PR - Brasil
>>>>
>>>>
>>>>
>>>>
>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>
>>>
>>>
>>> --
>>> Michael Sumner
>>> Institute for Marine and Antarctic Studies, University of Tasmania Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>> --
>> Michael Sumner
>> Institute for Marine and Antarctic Studies, University of Tasmania
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Fri Jul 23 18:59:01 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 23 Jul 2010 09:59:01 -0700
Subject: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}
In-Reply-To: <AANLkTik99sOqO5aoq05pwNkAyENHR==4Ks4yB7Nptav-@mail.gmail.com>
References: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
	<AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>
	<000001cb2a53$df97a2a0$9ec6e7e0$@gmail.com>
	<AANLkTim-=LvjumSeyi4N_puJ3cTYyCBJ1m9PU6iGSBJh@mail.gmail.com>
	<000f01cb2a70$9d100e50$d7302af0$@gmail.com>
	<AANLkTi=uSctF=8HXo29Oxa_-TxCPYagVZayO=9aXTzei@mail.gmail.com>
	<AANLkTik99sOqO5aoq05pwNkAyENHR==4Ks4yB7Nptav-@mail.gmail.com>
Message-ID: <AANLkTimV7PSHD4R53d+BWAHF+s8siw_K3nbzn0DpWwC3@mail.gmail.com>

Sorry, this should have been:

Alternatively, you could create three RasterLayer objects
etopo1 <- raster("Etopo1.tif", band=1)
etopo2 <- raster("Etopo1.tif", band=2)
etopo3 <- raster("Etopo1.tif", band=3)


On Fri, Jul 23, 2010 at 9:53 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> If you want a multi-layer object you can create a RasterBrick in stead
> of a RasterLayer. I.e. 'brick()' in stead of ?'raster()'
>
> library(raster)
> etopo1 <- brick("Etopo1.tif") # change here
> e <- extent(-90, -32, -60, 15)
> r <- crop(etopo1, e)
>
>
> Alternatively, you could create three RasterLayer objects
> etopo1 <- brick("Etopo1.tif", band=1)
> etopo2 <- brick("Etopo1.tif", band=2)
> etopo3 <- brick("Etopo1.tif", band=3)
>
>
> Robert
>
> On Fri, Jul 23, 2010 at 7:54 AM, Michael Sumner <mdsumner at gmail.com> wrote:
>> I know this is rather simplistic, and has bugs that I just don't have
>> the impetus to track down at the moment, but it should work for your
>> problem. I didn't realize that raster doesn't support (AFAICS)
>> multiband rasters, such as 3-band images.
>>
>> Please use with caution - there are bugs! and very bad practices . . .
>>
>> readpartGDAL <- function(x, xlim = NULL, ylim = NULL, ...) {
>> ? ? ? ?require(rgdal)
>> ? ? ? ?info <- GDALinfo(x)
>> ? ? ? ?offs <- info[c("ll.x", "ll.y")]
>> ? ? ? ?scl <- info[c("res.x", "res.y")]
>> ? ? ? ?dimn <- info[c("columns", "rows")]
>> ? ? ? ?## brain dead, but easy
>> ? ? ? ?xs <- seq(offs[1], by = scl[1], length = dimn[1]) + scl[1]/2
>> ? ? ? ?ys <- seq(offs[2], by = scl[2], length = dimn[2]) + scl[2]/2
>>
>> ? ? ? ?if (!is.null(xlim)) {
>> ? ? ? ? ? ? ? ?if (!is.numeric(xlim)) stop("xlim must be numeric")
>> ? ? ? ? ? ? ? ?if (!length(xlim) == 2) stop("xlim must be of length 2")
>> ? ? ? ? ? ? ? ?if (!diff(xlim) > 0) stop("xlim[1] must be less than xlim[2]")
>> ? ? ? ? ? ? ? ?xind <- which(xs >= xlim[1] & xs <= xlim[2])
>> ? ? ? ?}
>>
>> ? ? ? ?if (!is.null(ylim)) {
>> ? ? ? ? ? ? ? ?if (!is.numeric(ylim)) stop("ylim must be numeric")
>> ? ? ? ? ? ? ? ?if (!length(ylim) == 2) stop("ylim must be of length 2")
>> ? ? ? ? ? ? ? ?if (!diff(ylim) > 0) stop("ylim[1] must be less than ylim[2]")
>> ? ? ? ? ? ? ? ?yind <- which(ys >= ylim[1] & ys <= ylim[2])
>> ? ? ? ?}
>> ? ? ? ?## probably need a sign check for info["ysign"]
>> ? ? ? ?## reverse for y/x order in readGDAL
>> ? ? ? ?rgdal.offset <- rev(c(min(xind), dimn[2] - max(yind)))
>> ? ? ? ?rgdal.dim <- rev(c(length(xind), length(yind)))
>> ? ? ? ?readGDAL(x, offset = rgdal.offset, region.dim = rgdal.dim, ...)
>> }
>>
>> f <- "Etopo1.tif"
>>
>> d <- readpartGDAL(f, xlim = c(-90, -32), ylim = c(-60, 15))
>>
>> ## assuming you have 3-bands describing RGB
>> ## (see ?SGDF2PCT
>> cols <- SGDF2PCT(d)
>> d$idx <- cols$idx
>> image(d, "idx", col = cols$ct)
>>
>>
>>
>> On Sat, Jul 24, 2010 at 12:09 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>>> Well Etopo1 have the colored image as well (ftp://ftp.ngdc.noaa.gov/mgg/global/relief/ETOPO1/image/color_etopo1_ice_full.tif.gz). I'm not able to import it using readGDAL (because of the vector size), but normally when I do so with georeferenced images, the object created have, in the data slot, the three band (RGB) color codes as columns. Using raster{raster} and then as(x,'SpatialGridDataFrame') these data seems to get truncated and unrecognizable to image{sp}.
>>>
>>> Regards.
>>>
>>> Rodrigo
>>>
>>> -----Mensagem original-----
>>> De: Michael Sumner [mailto:mdsumner at gmail.com]
>>> Enviada em: sexta-feira, 23 de julho de 2010 10:53
>>> Para: Rodrigo Aluizio
>>> Cc: R Help
>>> Assunto: Re: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}
>>>
>>> I don't know what you mean by "band data structure" and "original colors". I just have the generic (ice/cell registered) Etopo1 which is elevation values as 16-bit integers. Perhaps you could describe the actual file you have more, where you got it, and how you have used it before.
>>>
>>> Cheers, Mike.
>>>
>>> On Fri, Jul 23, 2010 at 8:43 PM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>>>> Excellent suggestion, but I'm facing another little problem. When importing through raster{raster}, I lost the band data structure (but the data seems to still be there) which turns impossible to reproduce the original colors. Is there a way to bypass this?
>>>>
>>>> Thanks.
>>>>
>>>> Rodrigo.
>>>>
>>>> -----Mensagem original-----
>>>> De: Michael Sumner [mailto:mdsumner at gmail.com] Enviada em:
>>>> quinta-feira, 22 de julho de 2010 12:50
>>>> Para: Rodrigo Aluizio
>>>> Cc: R Help
>>>> Assunto: Re: [R-sig-Geo] Import Part of a GeoTiff using
>>>> readGDAL{rgdal}
>>>>
>>>> With readGDAL you must figure out the impled coordinates, referenced from the top left - it's confusing, but with some experimenting you will get it.
>>>>
>>>> But, far easier is to use the raster package, which will let you deal with the entire Etopo1 if you want by accessing the file as needed, and there are simpler methods to crop the big raster - and coerce to SpatialGridDataFrame if need be.
>>>>
>>>> E.g.
>>>> ## all this works pretty fast as raster takes care of the memory
>>>> library(raster)
>>>> etopo1 <- raster("Etopo1.tif")
>>>> ?e <- extent(-90, -32, -60, 15)
>>>> r <- crop(etopo1, e)
>>>> plot(r)
>>>>
>>>> ## if we want to enforce the full memory use as an sp object x <-
>>>> as(r, "SpatialGridDataFrame")
>>>> image(x)
>>>> summary(x)
>>>> Object of class SpatialGridDataFrame
>>>> Coordinates:
>>>> ? min max
>>>> s1 -90 -32
>>>> s2 -60 ?15
>>>> Is projected: FALSE
>>>> proj4string :
>>>> [+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0] Number of points: 2 Grid attributes:
>>>> ? cellcentre.offset ? cellsize cells.dim
>>>> s1 ? ? ? ? -89.99167 0.01666667 ? ? ?3480
>>>> s2 ? ? ? ? -59.99167 0.01666667 ? ? ?4500 Data attributes:
>>>> ? Min. 1st Qu. ?Median ? ?Mean 3rd Qu. ? ?Max.
>>>> ?-8086 ? -4188 ? -2583 ? -2025 ? ? 148 ? ?6494
>>>>
>>>>
>>>>
>>>> sessionInfo()
>>>> R version 2.11.1 (2010-05-31)
>>>> x86_64-pc-mingw32
>>>>
>>>> locale:
>>>> [1] LC_COLLATE=English_Australia.1252 ?LC_CTYPE=English_Australia.1252
>>>> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C [5]
>>>> LC_TIME=English_Australia.1252
>>>>
>>>> attached base packages:
>>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>>
>>>> other attached packages:
>>>> [1] rgdal_0.6-27 raster_1.2-6 sp_0.9-65
>>>>
>>>> loaded via a namespace (and not attached):
>>>> [1] grid_2.11.1 ? ?lattice_0.18-8 tools_2.11.1
>>>>
>>>> On Fri, Jul 23, 2010 at 1:14 AM, Rodrigo Aluizio <r.aluizio at gmail.com> wrote:
>>>>> Hi List.
>>>>>
>>>>> I?m trying to import only a part of interest from a raster image map
>>>>> (let say, ETOPO 1 Global Relief GeoTiff). I realize that, PROBABLY,
>>>>> the readGDAL function can deal with my issue through the arguments:
>>>>>
>>>>>
>>>>>
>>>>> offset - Number of rows and columns from the origin (usually the
>>>>> upper left
>>>>> corner) to begin reading from; presently ordered (y,x) - this may
>>>>> change
>>>>>
>>>>> region.dim - The number of rows and columns to read from the dataset;
>>>>> presently ordered (y,x) - this may change
>>>>>
>>>>>
>>>>>
>>>>> But, I don?t know exactly how to specify that I want the rows (and
>>>>> columns?) which show only South America, I do know the SA coordinate
>>>>> limits, but not the corresponding rows.
>>>>>
>>>>> The real problem is that I don?t know how to use the function
>>>>> resources properly. I?m trying to limit the region during import to
>>>>> avoid memory limit issues, once importing the ETOPO 1 Geotiff tries to generate a huge vector.
>>>>>
>>>>> Really Sorry About It, Thanks for Your Patience and Attention.
>>>>>
>>>>>
>>>>>
>>>>> -------------------------------------------------------------
>>>>>
>>>>> MSc. ?<mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>>>>
>>>>> Centro de Estudos do Mar/UFPR
>>>>> Laborat?rio de Micropaleontologia
>>>>> Avenida Beira Mar s/n - CEP 83255-000 Pontal do Paran? - PR - Brasil
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Michael Sumner
>>>> Institute for Marine and Antarctic Studies, University of Tasmania Hobart, Australia
>>>> e-mail: mdsumner at gmail.com
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>>
>>> --
>>> Michael Sumner
>>> Institute for Marine and Antarctic Studies, University of Tasmania
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>>
>>
>>
>>
>> --
>> Michael Sumner
>> Institute for Marine and Antarctic Studies, University of Tasmania
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From Andy.Bunn at wwu.edu  Fri Jul 23 21:17:55 2010
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Fri, 23 Jul 2010 12:17:55 -0700
Subject: [R-sig-Geo] SpatialGridDataFrame to netCDF via ncdf on Windows
Message-ID: <7E6EA3F4372E474F8F3F850DD262FDA9035321D544@ExchMailbox3.univ.dir.wwu.edu>

Hello, I have a series of a few dozen SpatialGridDataFrame objects that I would like to write as a single netCDF object - i.e., a 2D field (x,y) as a function of time (t) containing one time-varying variable (z). Given the example below I'd like to create one netCDF object containing t1 and t2. I do not have a netCDF driver in my gdalDrivers() list. Can this be done via ncdf?

Thanks, Andy



# example
require(sp);require(rgdal);require(ncdf)

nlong <- 20
long.size <- 1
long.min <- 0
long <- seq(long.min+long.size/2,long.min+long.size*nlong,by=long.size)

nlat <- 20
lat.size <- 1
lat.min <- 45
lat <- seq(lat.min+lat.size/2,lat.min+lat.size*nlat,by=lat.size)
prj.str <- 'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'

t1 <- rnorm(nlong*nlat)
t1.sp = data.frame(z = t1,
    xc = rep(long,times=nlat),
    yc = rep(lat,each=nlong))
coordinates(t1.sp) = ~xc+yc
proj4string(t1.sp)<- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0")
gridded(t1.sp) = TRUE
t1.sp = as(t1.sp, "SpatialGridDataFrame")

t2 <- rnorm(nlong*nlat)
t2.sp = data.frame(z = t2,
    xc = rep(long,times=nlat),
    yc = rep(lat,each=nlong))
coordinates(t2.sp) = ~xc+yc
proj4string(t2.sp)<- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0")
gridded(t2.sp) = TRUE
t2.sp = as(t2.sp, "SpatialGridDataFrame")

# write netCDF: 2D field (x,y) as a function of time (t) containing one time-varying variable (z)
# ??


From r.hijmans at gmail.com  Fri Jul 23 21:31:26 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 23 Jul 2010 12:31:26 -0700
Subject: [R-sig-Geo] SpatialGridDataFrame to netCDF via ncdf on Windows
In-Reply-To: <7E6EA3F4372E474F8F3F850DD262FDA9035321D544@ExchMailbox3.univ.dir.wwu.edu>
References: <7E6EA3F4372E474F8F3F850DD262FDA9035321D544@ExchMailbox3.univ.dir.wwu.edu>
Message-ID: <AANLkTikQ=wmm+ji4XQYoamL=+jrZNxHMRjQ=k6_=WDd4@mail.gmail.com>

Andy, this should work (it requires RNetCDF) :


sp = cbind(t1.sp, t2.sp)

library(raster)

b <- brick(sp)
nc = writeRaster(b, file='test.nc')



Robert


On Fri, Jul 23, 2010 at 12:17 PM, Andy Bunn <Andy.Bunn at wwu.edu> wrote:
> Hello, I have a series of a few dozen SpatialGridDataFrame objects that I would like to write as a single netCDF object - i.e., a 2D field (x,y) as a function of time (t) containing one time-varying variable (z). Given the example below I'd like to create one netCDF object containing t1 and t2. I do not have a netCDF driver in my gdalDrivers() list. Can this be done via ncdf?
>
> Thanks, Andy
>
>
>
> # example
> require(sp);require(rgdal);require(ncdf)
>
> nlong <- 20
> long.size <- 1
> long.min <- 0
> long <- seq(long.min+long.size/2,long.min+long.size*nlong,by=long.size)
>
> nlat <- 20
> lat.size <- 1
> lat.min <- 45
> lat <- seq(lat.min+lat.size/2,lat.min+lat.size*nlat,by=lat.size)
> prj.str <- 'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'
>
> t1 <- rnorm(nlong*nlat)
> t1.sp = data.frame(z = t1,
> ? ?xc = rep(long,times=nlat),
> ? ?yc = rep(lat,each=nlong))
> coordinates(t1.sp) = ~xc+yc
> proj4string(t1.sp)<- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0")
> gridded(t1.sp) = TRUE
> t1.sp = as(t1.sp, "SpatialGridDataFrame")
>
> t2 <- rnorm(nlong*nlat)
> t2.sp = data.frame(z = t2,
> ? ?xc = rep(long,times=nlat),
> ? ?yc = rep(lat,each=nlong))
> coordinates(t2.sp) = ~xc+yc
> proj4string(t2.sp)<- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0")
> gridded(t2.sp) = TRUE
> t2.sp = as(t2.sp, "SpatialGridDataFrame")
>
> # write netCDF: 2D field (x,y) as a function of time (t) containing one time-varying variable (z)
> # ??
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From rundel at gmail.com  Sat Jul 24 02:43:11 2010
From: rundel at gmail.com (rundel)
Date: Fri, 23 Jul 2010 17:43:11 -0700 (PDT)
Subject: [R-sig-Geo] Pruning a delaunay triangulation with a shape
In-Reply-To: <AANLkTimBHhoJcmneK5nn6SA_DeG9oMvlQgk9mrdL02gv@mail.gmail.com>
References: <AANLkTinTtsUjSRkh5No-wFDX4x7n-iEyh-PwB0mxmVKU@mail.gmail.com>
	<1279833865261-5327334.post@n2.nabble.com>
	<AANLkTimBHhoJcmneK5nn6SA_DeG9oMvlQgk9mrdL02gv@mail.gmail.com>
Message-ID: <1279932191747-5331731.post@n2.nabble.com>


I'm not very familiar with either the tri or nb classes so I'm not entirely
sure what is possible. From a cursory look it seems like this is not
possible with tri as it seems to only internally store the point locations
and recalculates the triangulation whenever the object is printed or
plotted. I have a function below that I think works with nb classes, but I
haven't tested it.



bound <- SpatialPolygons(list(Polygons(list(Polygon(cbind( 
x=c(0.34063939, 0.56754974, 0.95361248, 0.96464284, 0.60694389, 
0.58173163, 0.58330740, 0.91421832, 1.00403700, 0.96464284, 
0.50294332, 0.39263968, 0.22560845, 0.02548613, 0.25397225, 
-0.01233226, 0.34063939), 
y=c(1.02171515, 0.70486571, 0.92207697, 0.84834471, 0.62116963, 
0.53747356, 0.47569788, 0.35812482, 0.02134774, -0.07231216, 
0.15287015, 0.14489909, -0.03444965, 0.09707276, 0.56138672, 
0.58729265, 1.02171515) ) )),ID="bound")))


dat <- data.frame( 
x=c(0.34433527, 0.08592805, 0.55564179, 0.03938242, 0.98044051, 
0.19835405, 0.94186612, 0.56208017, 0.31093811, 0.54341230, 
0.93508703, 0.38160473, 0.89435383, 0.55457428, 0.22406338), 
y=c(0.997803213, 0.094993232, 0.509774611, 0.615526709, 0.004314438, 
0.676662461, 0.026060349, 0.165807011, 0.596449068, 0.469553704, 
0.888788079, 0.163129754, 0.340335312, 0.621845245, 0.019412254) 
) 

dat.tr <- tri.mesh(dat) 
dat.sl <- tri.asSpLines(dat.tr)

dat.nb = tri2nb(dat)


filternb = function(nb, coords, bound) {
	sl = nb2lines(nb,as.list(rep(NA,length(nb))), coords)
	
	out=!gCrosses(sl,bound,byid=TRUE)
	
	k=1
	for(i in 1:length(nb)) {
		l = length(nb[[i]])
		nb[[i]] = nb[[i]][ out[k:(k+l-1)] ]
		k=k+l
	}
	
	return(nb)
}

dat.nb.new = filternb(dat.nb, dat, bound)

plot(bound,col='red')
plot(dat.nb.new,dat,add=T)

-Colin
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Pruning-a-delaunay-triangulation-with-a-shape-tp5324088p5331731.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From rundel at gmail.com  Sat Jul 24 05:22:34 2010
From: rundel at gmail.com (rundel)
Date: Fri, 23 Jul 2010 20:22:34 -0700 (PDT)
Subject: [R-sig-Geo] grid and spatial selection
In-Reply-To: <1279880890707-5329029.post@n2.nabble.com>
References: <1279880890707-5329029.post@n2.nabble.com>
Message-ID: <1279941754863-5331970.post@n2.nabble.com>


This should be possible with rgeos, with the caveat that it may be fairly
slow, for the time being, if the number of points and or polygons is large.
The package is still in development so the documentation is still a work in
progress and there are not binaries available. If you get stuck I'd be happy
to help troubleshoot the installation.

You will want to use the gContains function, I have included a toy example
below to hopefully get you started:



library(rgeos)
gt <- GridTopology(c(0.05,0.05), c(.1,.1), c(10,10))
grd <- SpatialGrid(gt)
spi <- as(grd, "SpatialPixels")
spol <- as(spi, "SpatialPolygons")

set.seed(1)
x=runif(25)
y=runif(25)

pts = SpatialPoints(cbind(x,y))

ct = gContains( spol,pts,byid=c(TRUE,TRUE) )
colsub = apply(ct, 2,any)

plot(spol)
plot(spol[colsub,],add=T,col='green')
plot(pts,add=T)


If you have any questions or run into any bugs let me know.
-Colin
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/grid-and-spatial-selection-tp5329029p5331970.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Sat Jul 24 05:46:08 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 23 Jul 2010 20:46:08 -0700
Subject: [R-sig-Geo] grid and spatial selection
In-Reply-To: <1279941754863-5331970.post@n2.nabble.com>
References: <1279880890707-5329029.post@n2.nabble.com>
	<1279941754863-5331970.post@n2.nabble.com>
Message-ID: <AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>

rgeos is looking very good! This can also be done with 'sp' :

o = overlay(maillesfrance, spcsv2)
i = na.omit(unique(o))
select = maillesfrance[i, ]

plot(select)


On Fri, Jul 23, 2010 at 8:22 PM, rundel <rundel at gmail.com> wrote:
>
> This should be possible with rgeos, with the caveat that it may be fairly
> slow, for the time being, if the number of points and or polygons is large.
> The package is still in development so the documentation is still a work in
> progress and there are not binaries available. If you get stuck I'd be happy
> to help troubleshoot the installation.
>
> You will want to use the gContains function, I have included a toy example
> below to hopefully get you started:
>
>
>
> library(rgeos)
> gt <- GridTopology(c(0.05,0.05), c(.1,.1), c(10,10))
> grd <- SpatialGrid(gt)
> spi <- as(grd, "SpatialPixels")
> spol <- as(spi, "SpatialPolygons")
>
> set.seed(1)
> x=runif(25)
> y=runif(25)
>
> pts = SpatialPoints(cbind(x,y))
>
> ct = gContains( spol,pts,byid=c(TRUE,TRUE) )
> colsub = apply(ct, 2,any)
>
> plot(spol)
> plot(spol[colsub,],add=T,col='green')
> plot(pts,add=T)
>
>
> If you have any questions or run into any bugs let me know.
> -Colin
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/grid-and-spatial-selection-tp5329029p5331970.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From pslarson2 at gmail.com  Sun Jul 25 01:21:53 2010
From: pslarson2 at gmail.com (Peter Larson)
Date: Sat, 24 Jul 2010 19:21:53 -0400
Subject: [R-sig-Geo] dates
In-Reply-To: <AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>
References: <1279880890707-5329029.post@n2.nabble.com>	<1279941754863-5331970.post@n2.nabble.com>
	<AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>
Message-ID: <4C4B7591.3010505@gmail.com>

Hi,

This is completely unrelated to spatial anything (well, ostensibly) but 
I am trying the following to convert a string to a date and am getting 
nothing"

dates <- c("27-Feb-92")
as.Date(dates,format= '%d-%b-%y')
[1] NA

Any ideas?

Thanks and sorry for the off topic issue.

Pete


From b.rowlingson at lancaster.ac.uk  Sun Jul 25 01:29:03 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 25 Jul 2010 00:29:03 +0100
Subject: [R-sig-Geo] dates
In-Reply-To: <4C4B7591.3010505@gmail.com>
References: <1279880890707-5329029.post@n2.nabble.com>
	<1279941754863-5331970.post@n2.nabble.com>
	<AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>
	<4C4B7591.3010505@gmail.com>
Message-ID: <AANLkTimpJsjucdX4nGRHr4yiSS1yYyRmbb=qOvZXiRyN@mail.gmail.com>

On Sun, Jul 25, 2010 at 12:21 AM, Peter Larson <pslarson2 at gmail.com> wrote:
> Hi,
>
> This is completely unrelated to spatial anything (well, ostensibly) but I am
> trying the following to convert a string to a date and am getting nothing"
>
> dates <- c("27-Feb-92")
> as.Date(dates,format= '%d-%b-%y')
> [1] NA
>
> Any ideas?

 Works for me. What version of everything are you on? Does as.Date
work for anything?

Barry


From ggrothendieck at gmail.com  Sun Jul 25 01:34:59 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 24 Jul 2010 19:34:59 -0400
Subject: [R-sig-Geo] dates
In-Reply-To: <4C4B7591.3010505@gmail.com>
References: <1279880890707-5329029.post@n2.nabble.com>
	<1279941754863-5331970.post@n2.nabble.com> 
	<AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com> 
	<4C4B7591.3010505@gmail.com>
Message-ID: <AANLkTi=h+BVZeeMdFimVoZO9QoaE-VrzVSyecn1zMP5Q@mail.gmail.com>

On Sat, Jul 24, 2010 at 7:21 PM, Peter Larson <pslarson2 at gmail.com> wrote:
> Hi,
>
> This is completely unrelated to spatial anything (well, ostensibly) but I am
> trying the following to convert a string to a date and am getting nothing"
>
> dates <- c("27-Feb-92")
> as.Date(dates,format= '%d-%b-%y')
> [1] NA
>
> Any ideas?
>
> Thanks and sorry for the off topic issue.
>

google for r-help to find the list for general questions.

At any rate this is just a guess, but it may be that you are working
in a non-English locale so that Feb is not the short form for
February.

Try this to find out what it thinks is Feb should be written as:

   format(as.Date("1992-02-27"), "%d-%b-%Y")

If this is the problem see help(Sys.setlocale)


From jason.lessels at sydney.edu.au  Sun Jul 25 02:31:36 2010
From: jason.lessels at sydney.edu.au (Jason Lessels)
Date: Sun, 25 Jul 2010 10:31:36 +1000
Subject: [R-sig-Geo] dates
References: <1279880890707-5329029.post@n2.nabble.com><1279941754863-5331970.post@n2.nabble.com>
	<AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>
	<4C4B7591.3010505@gmail.com>
	<AANLkTi=h+BVZeeMdFimVoZO9QoaE-VrzVSyecn1zMP5Q@mail.gmail.com>
Message-ID: <10CB6CF943A22F4FAE5D05F7A115FFA40B9BA3@EXPRSV06.mcs.usyd.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100725/11bfd0d5/attachment.pl>

From pslarson2 at gmail.com  Mon Jul 26 03:42:00 2010
From: pslarson2 at gmail.com (Peter Larson)
Date: Sun, 25 Jul 2010 21:42:00 -0400
Subject: [R-sig-Geo] spautolm variable selection
Message-ID: <AANLkTi=xNUTSPypOkYund9Rjf5a2a6U-_JLse8AGojX0@mail.gmail.com>

Hello,

Is there any way to iterate spautolm to run through all possible
models using a set of covariates and choose the one with the lowest
AIC?

Thanks,

pete


From Toby.Patterson at csiro.au  Mon Jul 26 07:16:38 2010
From: Toby.Patterson at csiro.au (Toby.Patterson at csiro.au)
Date: Mon, 26 Jul 2010 15:16:38 +1000
Subject: [R-sig-Geo] shared boundary lengths ?
Message-ID: <1C19E50585A98643871CAFD72AE1976C150DE96C88@exvic-mbx03.nexus.csiro.au>

Hi, 
Apologies up front if this has been covered somewhere already -- 
I have seen some discussion of a similar problem on the list, but it doesn't quite seem to cover what I'm after. 

Also I'm new to the spatial side of R, so I might not quite use the correct lingo! 

My problem is this: 

For a set of polygons (a SpatialPolygonsDataFrame) with shared boundaries 
(i.e. with no overlapping regions or gaps between them), I need to know the length of shared adjacent boundaries. Note, in this case all polygons will have a boundary shared with at least one other polygon. 

So I'm after a square symmetric matrix with diagonals zero. The i,j th entry would then be the length (in some appropriate coordinate system) of the boundary between polygon i and j. 

Also - I'm not sure if sufficient information is stored in the SpatialPolygonsDataFrame class actually allow these shared lengths to be calculated. I'm sure someone can quickly clear that up for me. Possibly this can only be done in GIS systems? 

Any help would be much appreciated as this it seems quite a fiddly one to write myself. 

Thanks, 
Toby   


From blanc.laetitia.esr34 at gmail.com  Mon Jul 26 11:09:41 2010
From: blanc.laetitia.esr34 at gmail.com (Laetitia Blanc)
Date: Mon, 26 Jul 2010 02:09:41 -0700 (PDT)
Subject: [R-sig-Geo] grid and spatial selection
In-Reply-To: <AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>
References: <1279880890707-5329029.post@n2.nabble.com>
	<1279941754863-5331970.post@n2.nabble.com>
	<AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>
Message-ID: <1280135381862-5337149.post@n2.nabble.com>



Robert J. Hijmans wrote:
> 
> rgeos is looking very good! This can also be done with 'sp' :
> 
> o = overlay(maillesfrance, spcsv2)
> i = na.omit(unique(o))
> select = maillesfrance[i, ]
> 
> plot(select)
> 

It seemed to be easier with sp but actually, it didn't worked. When i asked
to R "select=maillesfrance[i,]", a warning message appeared : "Erreur dans
xj[i] : type 'list' d'indice incorrect" meaning that this kind of list was
incorrect.

And i don't know why, i can't load rgeos... I work on Windows with the R
version 2.11.1.

Any help ?

-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/grid-and-spatial-selection-tp5329029p5337149.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Maxime.Pauwels at univ-lille1.fr  Mon Jul 26 12:00:44 2010
From: Maxime.Pauwels at univ-lille1.fr (Maxime Pauwels)
Date: Mon, 26 Jul 2010 12:00:44 +0200
Subject: [R-sig-Geo] plotting populations on a 3D map of elevation data
Message-ID: <4C4D5CCC.6030502@univ-lille1.fr>

Dear,

I'm using spplot to plot populations on a geographic map including GIS 
elevation data (see the script below). The map is currently in two 
dimensions, using sp.layout to plot populations. I'd like to do it in 3D 
to represent differences in elevation among populations.
Does anyone know a way to do it that allow plotting additional points on 
the 3D map?

Thank a lot

Maxime

library(sp)
library(maptools)
library(maps)
srtm=read.asciigrid("srtm_38_39_isareduced.asc")
proj4string(srtm)<-CRS("+proj=longlat")
isapop<-read.table(file="coordpopisa.txt", header=TRUE)
coordinates(isapop)<-~long+lat
proj4string(isapop)<-CRS("+proj=longlat")
isapoppts<-list("sp.points", coordinates(isapop),pch=21, col="black", 
fill="black", cex=0.5)
Europe <- readShapePoly("europe")
#dispaly results
spplot(srtm, scales=list(draw=T), xlim=c(9.5, 10.5), ylim=c(45.5, 46.5), 
cuts=50, col.regions=gray(200:0/200), sp.layout=list(isapoppts, Europe))

-- 
Maxime Pauwels
Researcher ID: http://www.researcherid.com/rid/A-1745-2009

Laboratoire de G?n?tique et Evolution des Populations V?g?tales
FRE CNRS 3268
Universit? de Lille, USTL-Lille1
http://gepv.univ-lille1.fr 
Tel  : +33 3 20 33 62 38
Fax  : +33 3 20 43 69 79
			
?Impose ta chance, serre ton bonheur et va vers ton risque. A te regarder, ils s?habitueront.?
Ren? Char


From blanc.laetitia.esr34 at gmail.com  Mon Jul 26 12:04:37 2010
From: blanc.laetitia.esr34 at gmail.com (Laetitia Blanc)
Date: Mon, 26 Jul 2010 03:04:37 -0700 (PDT)
Subject: [R-sig-Geo] grid and spatial selection
In-Reply-To: <AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>
References: <1279880890707-5329029.post@n2.nabble.com>
	<1279941754863-5331970.post@n2.nabble.com>
	<AANLkTik97VrQndVqJRbErqW_oMSUh8iEfDX5HKLHWzQo@mail.gmail.com>
Message-ID: <1280138677354-5337316.post@n2.nabble.com>


Thank you !!!! It works !

I just had to reverse : 
o = overlay (spcsv2, maillesfrance)
i = na.omit (unique(o))
select = maillesfrance[i, ]

Now i have to plot the map of france and the cells that are selected on the
same plot and that's it.
:-)
-- 
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/grid-and-spatial-selection-tp5329029p5337316.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From tylerdeanrudolph at gmail.com  Mon Jul 26 19:04:53 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Mon, 26 Jul 2010 13:04:53 -0400
Subject: [R-sig-Geo] spatial range parameter in ruf.fit (package ruf)
Message-ID: <AANLkTikkStrKnTGApm_-EtUn6Rf1ukRE8=eVgwQVkdMk@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100726/4e44f79a/attachment.pl>

From abcessus at gmail.com  Mon Jul 26 20:15:42 2010
From: abcessus at gmail.com (Etienne DELAY)
Date: Mon, 26 Jul 2010 20:15:42 +0200
Subject: [R-sig-Geo] Cluster of area whit clustTool?
In-Reply-To: <AANLkTikkStrKnTGApm_-EtUn6Rf1ukRE8=eVgwQVkdMk@mail.gmail.com>
References: <AANLkTikkStrKnTGApm_-EtUn6Rf1ukRE8=eVgwQVkdMk@mail.gmail.com>
Message-ID: <4C4DD0CE.9020202@gmail.com>

Hello everyone
I work with GRASS GIS, and arrives on time where I need to do a bit of
statistics (aggregated plots clustered) so I turn to R. but I'm a noob.
Does someone can give me a hand for me to run?
I installed R ... I find a module that area to do what I want clustTool
(I hope), but now I do not know where to start ...
thank you :-)


-- 
Cordialement

Etienne DELAY
Deust "Webmaster et gest. d'intranet" (IDSkype : etienne.delay.tic)
Master IUP "valorisation du patrimoine et am?nagement du territoire"


From tylerdeanrudolph at gmail.com  Mon Jul 26 20:58:47 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Mon, 26 Jul 2010 14:58:47 -0400
Subject: [R-sig-Geo] spatial range parameter in ruf.fit (package ruf)
In-Reply-To: <E6DF22ED200E4FE1B0606DE985BA94C0@cfr.washington.edu>
References: <AANLkTikkStrKnTGApm_-EtUn6Rf1ukRE8=eVgwQVkdMk@mail.gmail.com> 
	<E6DF22ED200E4FE1B0606DE985BA94C0@cfr.washington.edu>
Message-ID: <AANLkTimJpQui5ZQtOqeDf16Oo9fxDt2LCz=a9DZhW12Z@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100726/35414e24/attachment.pl>

From abcessus at gmail.com  Mon Jul 26 21:12:14 2010
From: abcessus at gmail.com (Etienne DELAY)
Date: Mon, 26 Jul 2010 21:12:14 +0200
Subject: [R-sig-Geo] Cluster of area whit clustTool?
In-Reply-To: <AANLkTikRgURNv=JCCSsq8DTB0tDM+MZMoD2qq=ubSPYs@mail.gmail.com>
References: <AANLkTikkStrKnTGApm_-EtUn6Rf1ukRE8=eVgwQVkdMk@mail.gmail.com>
	<4C4DD0CE.9020202@gmail.com>
	<AANLkTikRgURNv=JCCSsq8DTB0tDM+MZMoD2qq=ubSPYs@mail.gmail.com>
Message-ID: <4C4DDE0E.9040801@gmail.com>

Le 26/07/10 20:41, romunov a ?crit :
> If you have university (or other) access to SpringerLink, I would suggest
> getting A beginner's guide to
> R<http://www.springer.com/statistics/computanional+statistics/book/978-0-387-93836-3>by
> Zuur et al (2009). Good resource site are
> http://www.rseek.org/, http://www.r-bloggers.com/,
> http://r.789695.n4.nabble.com/R-help-f789696.html and this list. I also like
> http://stats.stackexchange.com/ (will be open for public soon) and
> http://stackoverflow.com/questions/tagged/r.Unfortunately, I can be of
> little assistance regarding your problem.
> 
> 
> Cheers,
> 
Hi Romunov
Thank you for all this links, but I do not know about what other mailing
lists sign up. I look anyway.
Unfortunately I haven't access Springerlink with the university, but I
can buy it, if it is good.
If I can clarify my needs, I have a vector layer into GRASS-GIS, which
contains parcel of vineyards across Europe. I would group them  in order
to propose a methodology for an inventory per cluster.
I hope this is clearer
thank you

-- 
Cordialement

Etienne DELAY
Deust "Webmaster et gest. d'intranet" (IDSkype : etienne.delay.tic)
Master IUP "valorisation du patrimoine et am?nagement du territoire"


From Andy.Bunn at wwu.edu  Mon Jul 26 22:29:53 2010
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Mon, 26 Jul 2010 13:29:53 -0700
Subject: [R-sig-Geo] SpatialGridDataFrame to netCDF via ncdf on Windows
In-Reply-To: <AANLkTikQ=wmm+ji4XQYoamL=+jrZNxHMRjQ=k6_=WDd4@mail.gmail.com>
References: <7E6EA3F4372E474F8F3F850DD262FDA9035321D544@ExchMailbox3.univ.dir.wwu.edu>
	<AANLkTikQ=wmm+ji4XQYoamL=+jrZNxHMRjQ=k6_=WDd4@mail.gmail.com>
Message-ID: <7E6EA3F4372E474F8F3F850DD262FDA9035321D5AF@ExchMailbox3.univ.dir.wwu.edu>

> -----Original Message-----
> From: Robert J. Hijmans [mailto:r.hijmans at gmail.com]
> Sent: Friday, July 23, 2010 12:31 PM
> To: Andy Bunn
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] SpatialGridDataFrame to netCDF via ncdf on
> Windows
> 
> Andy, this should work (it requires RNetCDF) :
> 
> 
> sp = cbind(t1.sp, t2.sp)
> 
> library(raster)
> 
> b <- brick(sp)
> nc = writeRaster(b, file='test.nc')

Works great. Thanks.


From greenberg at ucdavis.edu  Tue Jul 27 00:29:21 2010
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Mon, 26 Jul 2010 15:29:21 -0700
Subject: [R-sig-Geo] GDALinfo with unrecognized format...
Message-ID: <AANLkTikOsj28+aHq5o7JxL3FKMxokjJN-_zPONtp2k78@mail.gmail.com>

r-sig-geo'ers:

Quick question: is there an easy way to have a flag to tell if a
dataset is NOT supported, e.g. when GDALinfo(fname) is in error?  I'd
like something like "GDALinfo(fname)" to return "FALSE" if its an
unsupported dataset type.  Thanks!

--j


From mdsumner at gmail.com  Tue Jul 27 01:54:54 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 27 Jul 2010 09:54:54 +1000
Subject: [R-sig-Geo] GDALinfo with unrecognized format...
In-Reply-To: <AANLkTikOsj28+aHq5o7JxL3FKMxokjJN-_zPONtp2k78@mail.gmail.com>
References: <AANLkTikOsj28+aHq5o7JxL3FKMxokjJN-_zPONtp2k78@mail.gmail.com>
Message-ID: <AANLkTin1O+0Lspg6WrJ=ypX+YkTGEXLUMocN3iiDA3BY@mail.gmail.com>

You can wrap it in a ?try:

f <- "file"
#f <- "utm55.tif"

info <- try(GDALinfo(f), silent = TRUE)

if (inherits(info, "try-error")) {
	## do something else
	stop("no good, file not found: ", f)
	
} else {
	## proceed
	d <- readGDAL(f)
}



On Tue, Jul 27, 2010 at 8:29 AM, Jonathan Greenberg
<greenberg at ucdavis.edu> wrote:
> r-sig-geo'ers:
>
> Quick question: is there an easy way to have a flag to tell if a
> dataset is NOT supported, e.g. when GDALinfo(fname) is in error? ?I'd
> like something like "GDALinfo(fname)" to return "FALSE" if its an
> unsupported dataset type. ?Thanks!
>
> --j
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From pslarson2 at gmail.com  Tue Jul 27 04:14:11 2010
From: pslarson2 at gmail.com (Peter Larson)
Date: Mon, 26 Jul 2010 22:14:11 -0400
Subject: [R-sig-Geo] GDALinfo with unrecognized format...
In-Reply-To: <AANLkTin1O+0Lspg6WrJ=ypX+YkTGEXLUMocN3iiDA3BY@mail.gmail.com>
References: <AANLkTikOsj28+aHq5o7JxL3FKMxokjJN-_zPONtp2k78@mail.gmail.com>
	<AANLkTin1O+0Lspg6WrJ=ypX+YkTGEXLUMocN3iiDA3BY@mail.gmail.com>
Message-ID: <4C4E40F3.80300@gmail.com>

A ridiculous question, but I am having trouble finding a mirror which 
has the gstat package. Any clues?

Thanks,

Pete


From pslarson2 at gmail.com  Tue Jul 27 04:20:36 2010
From: pslarson2 at gmail.com (Peter Larson)
Date: Mon, 26 Jul 2010 22:20:36 -0400
Subject: [R-sig-Geo] gstat mirror
In-Reply-To: <AANLkTikOsj28+aHq5o7JxL3FKMxokjJN-_zPONtp2k78@mail.gmail.com>
References: <AANLkTikOsj28+aHq5o7JxL3FKMxokjJN-_zPONtp2k78@mail.gmail.com>
Message-ID: <4C4E4274.8000000@gmail.com>

Forget it, I got it.

Pete

On 2010/07/26 18:29, Jonathan Greenberg wrote:
> r-sig-geo'ers:
>
> Quick question: is there an easy way to have a flag to tell if a
> dataset is NOT supported, e.g. when GDALinfo(fname) is in error?  I'd
> like something like "GDALinfo(fname)" to return "FALSE" if its an
> unsupported dataset type.  Thanks!
>
> --j
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mdsumner at gmail.com  Tue Jul 27 06:27:59 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 27 Jul 2010 14:27:59 +1000
Subject: [R-sig-Geo] problems with finding CRAN mirror for gstat [was
	GDALinfo with unrecognized format...]
Message-ID: <AANLkTinhgbUCQJtw5yzECdC-KTUA74uH_3SHvhxSRN=q@mail.gmail.com>

On Tue, Jul 27, 2010 at 12:14 PM, Peter Larson <pslarson2 at gmail.com> wrote:
> A ridiculous question, but I am having trouble finding a mirror which has
> the gstat package. Any clues?

Please don't post off topic - this is not related to the original thread.

Here's one:
http://cran.ms.unimelb.edu.au/web/packages/gstat/index.html

What have you tried? Please tell us what you did when you tried to
find gstat - does this not work? What is the error?

install.packages("gstat")

Please include your R version and OS, use sessionInfo() for example.

Cheers, Mike.
> Thanks,
>
> Pete
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From friendly at yorku.ca  Tue Jul 27 16:22:14 2010
From: friendly at yorku.ca (Michael Friendly)
Date: Tue, 27 Jul 2010 10:22:14 -0400
Subject: [R-sig-Geo] change in sp::Lines() breaks example in my package
Message-ID: <4C4EEB96.7040600@yorku.ca>

[Running R.2.11.1, Win XP]

I just updated sp from sp_0.9-65 to sp_0.9-66 after receiving a report 
from the CRAN team that my HistData
package now generates errors in at least one documentation example.  It 
occurs in example(Snow), which
worked successfully under the previous versions of sp.  I don't 
understand the nature of the error, or how to
correct it.  Can someone point me in a useful direction?

Here is the complete portion of the example (to draw Snow's cholera map 
of London), suitable for cut/paste to R:

#install.packages("HistData")    # if necessary
library(HistData)
library(sp)

# streets
slist <- split(Snow.streets[,c("x","y")],as.factor(Snow.streets[,"street"]))
Ll1 <- lapply(slist,Line)
Lsl1 <- Lines(Ll1,paste("Street",1:length(Ll1)))
Snow.streets.sp <- SpatialLines(list(Lsl1))
plot(Snow.streets.sp, col="gray")
title(main="Snow's Cholera Map of London")

# deaths
Snow.deaths.sp = SpatialPoints(Snow.deaths[,c("x","y")])
plot(Snow.deaths.sp, add=TRUE, col ='red', pch=15, cex=0.6)

# pumps
spp <- SpatialPoints(Snow.pumps[,c("x","y")])
Snow.pumps.sp <- SpatialPointsDataFrame(spp,Snow.pumps[,c("x","y")])
plot(Snow.pumps.sp, add=TRUE, col='blue', pch=17, cex=1.5)
text(Snow.pumps[,c("x","y")], labels=Snow.pumps$label, pos=1, cex=0.8)

Here is the transcript showing the error with Lines:

 > # streets
 > slist <- 
split(Snow.streets[,c("x","y")],as.factor(Snow.streets[,"street"]))
 > Ll1 <- lapply(slist,Line)
 > Lsl1 <- Lines(Ll1,paste("Street",1:length(Ll1)))
Error in Lines(Ll1, paste("Street", 1:length(Ll1))) : Single ID required
 > Snow.streets.sp <- SpatialLines(list(Lsl1))
Error in is.vector(X) : object 'Lsl1' not found

Some tests:
 > length(Ll1)
[1] 528
 > length(unique(paste("Street",1:length(Ll1))))
[1] 528
 >


Below is my sessionInfo():

 > sessionInfo()
R version 2.11.1 (2010-05-31)
i386-pc-mingw32

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252  
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                         
[5] LC_TIME=English_United States.1252   

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

other attached packages:
[1] sp_0.9-66         KernSmooth_2.23-3 HistData_0.6-8  

loaded via a namespace (and not attached):
[1] grid_2.11.1    lattice_0.18-8 tools_2.11.1 
 >

-- 
Michael Friendly     Email: friendly AT yorku DOT ca 
Professor, Psychology Dept.
York University      Voice: 416 736-5115 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From tylerdeanrudolph at gmail.com  Tue Jul 27 19:08:27 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Tue, 27 Jul 2010 13:08:27 -0400
Subject: [R-sig-Geo] spatial range parameter in ruf.fit (package ruf)
In-Reply-To: <AANLkTimJpQui5ZQtOqeDf16Oo9fxDt2LCz=a9DZhW12Z@mail.gmail.com>
References: <AANLkTikkStrKnTGApm_-EtUn6Rf1ukRE8=eVgwQVkdMk@mail.gmail.com> 
	<E6DF22ED200E4FE1B0606DE985BA94C0@cfr.washington.edu>
	<AANLkTimJpQui5ZQtOqeDf16Oo9fxDt2LCz=a9DZhW12Z@mail.gmail.com>
Message-ID: <AANLkTik+kJGc4=B=h7Btpkz-s60H3VGQ5MrY7KEo81kO@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100727/be62faa3/attachment.pl>

From paulo.mailing.list at gmail.com  Wed Jul 28 10:28:47 2010
From: paulo.mailing.list at gmail.com (Paulo Eduardo Cardoso)
Date: Wed, 28 Jul 2010 09:28:47 +0100
Subject: [R-sig-Geo] add legend to plot(spatialpolygonsdataframe)
Message-ID: <AANLkTi=ROi4mu5trMuGH2mYBthb8hMMbaHewWSEAYFPW@mail.gmail.com>

How can one compose a plot, adding legend, title, and axis titles to a
plot of spatial object like a spatialpolygonsdataframe?
Any comment will be appreciated
Paulo


From roman.lustrik at gmail.com  Wed Jul 28 10:37:52 2010
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Wed, 28 Jul 2010 10:37:52 +0200
Subject: [R-sig-Geo] add legend to plot(spatialpolygonsdataframe)
In-Reply-To: <AANLkTi=ROi4mu5trMuGH2mYBthb8hMMbaHewWSEAYFPW@mail.gmail.com>
References: <AANLkTi=ROi4mu5trMuGH2mYBthb8hMMbaHewWSEAYFPW@mail.gmail.com>
Message-ID: <AANLkTi=c9dUJ+aMuT-3g0edrvvQRiheHYTxw9S0Xc-HT@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100728/973e877e/attachment.pl>

From paulo.mailing.list at gmail.com  Wed Jul 28 11:02:17 2010
From: paulo.mailing.list at gmail.com (Paulo Eduardo Cardoso)
Date: Wed, 28 Jul 2010 10:02:17 +0100
Subject: [R-sig-Geo] add legend to plot(spatialpolygonsdataframe)
In-Reply-To: <AANLkTi=c9dUJ+aMuT-3g0edrvvQRiheHYTxw9S0Xc-HT@mail.gmail.com>
References: <AANLkTi=ROi4mu5trMuGH2mYBthb8hMMbaHewWSEAYFPW@mail.gmail.com>
	<AANLkTi=c9dUJ+aMuT-3g0edrvvQRiheHYTxw9S0Xc-HT@mail.gmail.com>
Message-ID: <AANLkTimU4ZfgMrm1TkpMJoypuEPJMeJifgcGipLjB0QW@mail.gmail.com>

Thanks Roman,

I'm plotting polygons, filled with a custom colour pallete.
How can this be reproduced in the legend?

Paulo

2010/7/28 Roman Lu?trik <roman.lustrik at gmail.com>:
> If I'm not mistaking, ?legend and ?plot (arguments main, xlab, ylab) should
> work.
>
> plot(data, main = "Chart title", xlab = "Title for the x axis", ylab =
> "Title for the y axis")
> legend(...)
>
> HTH,
> Roman
>
>
>
> On Wed, Jul 28, 2010 at 10:28 AM, Paulo Eduardo Cardoso
> <paulo.mailing.list at gmail.com> wrote:
>>
>> How can one compose a plot, adding legend, title, and axis titles to a
>> plot of spatial object like a spatialpolygonsdataframe?
>> Any comment will be appreciated
>> Paulo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> In God we trust, all others bring data.
>


From paulo.mailing.list at gmail.com  Wed Jul 28 12:31:16 2010
From: paulo.mailing.list at gmail.com (Paulo Eduardo Cardoso)
Date: Wed, 28 Jul 2010 11:31:16 +0100
Subject: [R-sig-Geo] spplot how to control variable scale with colorkey()
Message-ID: <AANLkTikg-wK5PXqiM-yVtCvJkhGQY0VUk+5fCJGS038o@mail.gmail.com>

While plotting with spplot, the legend space is reflecting the scale
of the variable.

eg, by dping something like this:
spplot(...,
colorkey = list(at = c(0, 5, 10, 20, 50,100), labels = c("0", "< 5",
"[5, 10)", "[10, 20)",
 "[20, 50)", ">= 50"), space="bottom"))

spaces between each colour interval will be proportional to the scale
of this particular variable.

Can one control this, forcing a equal interval space to the legend at colorkey?

Paulo


From zua3 at cornell.edu  Wed Jul 28 16:43:15 2010
From: zua3 at cornell.edu (Zia Ahmed)
Date: Wed, 28 Jul 2010 10:43:15 -0400
Subject: [R-sig-Geo] Help: Merging several geotiff files
Message-ID: <4C504203.4050604@cornell.edu>

Hi,
I have several DEM sheets as geotiff format. I like to merge/mosaic them 
to create a  grid file  using a R-function. Help will be appreciated.
Zia

-------------- next part --------------
A non-text attachment was scrubbed...
Name: zua3.vcf
Type: text/x-vcard
Size: 281 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100728/3f385d07/attachment.vcf>

From krzysztof.nienartowicz at gmail.com  Wed Jul 28 17:02:47 2010
From: krzysztof.nienartowicz at gmail.com (Krzysztof Nienartowicz)
Date: Wed, 28 Jul 2010 17:02:47 +0200
Subject: [R-sig-Geo] Aitoff projection for histograms
Message-ID: <8E7E5E23-4E3E-4381-A0DF-D373B338E932@gmail.com>

Hello,
I am a complete newbie and would be grateful for any hints if it is possible to create Aitoff projections over some Z parameter in the dataframe using some geo package? 
It would be used for astronomy data mining. I use r-postgres to fetch data so postgres gis extensions could be of use as well.
Best regards,
Krzysztof

From nikhil.list at gmail.com  Wed Jul 28 17:05:34 2010
From: nikhil.list at gmail.com (Nikhil Kaza)
Date: Wed, 28 Jul 2010 11:05:34 -0400
Subject: [R-sig-Geo] Help: Merging several geotiff files
In-Reply-To: <4C504203.4050604@cornell.edu>
References: <4C504203.4050604@cornell.edu>
Message-ID: <1D036F97-2439-45EF-9B6B-80347991E53B@gmail.com>

library(raster)
?mosaic

Nikhil Kaza
Asst. Professor,
City and Regional Planning
University of North Carolina

nikhil.list at gmail.com

On Jul 28, 2010, at 10:43 AM, Zia Ahmed wrote:

> Hi,
> I have several DEM sheets as geotiff format. I like to merge/mosaic  
> them to create a  grid file  using a R-function. Help will be  
> appreciated.
> Zia
>
> <zua3.vcf>_______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Scott.Waichler at pnl.gov  Wed Jul 28 20:05:13 2010
From: Scott.Waichler at pnl.gov (Waichler, Scott R)
Date: Wed, 28 Jul 2010 11:05:13 -0700
Subject: [R-sig-Geo] Methods for working with LIDAR data
Message-ID: <A632B3F93D861843A3C966F3962C3F840107D9E3001B@EMAIL05.pnl.gov>

I have a text file with x, y, z data from a LIDAR survey.  Can someone suggest a method to use to derive a Spatial Pixels or Spatial Grid object from these?  The spacing is not exactly regular of course.  The data are dense over all of the domain except for some blank areas, which I would like to designate as NA.  

I am open to using most packages and functions, but don't want to use GRASS.

Scott

Scott Waichler
Pacific Northwest National Laboratory
scott.waichler at pnl.gov


From debeaudette at ucdavis.edu  Wed Jul 28 20:14:13 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Wed, 28 Jul 2010 11:14:13 -0700
Subject: [R-sig-Geo] Methods for working with LIDAR data
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840107D9E3001B@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840107D9E3001B@EMAIL05.pnl.gov>
Message-ID: <201007281114.13090.dylan.beaudette@gmail.com>

On Wednesday 28 July 2010, Waichler, Scott R wrote:
> I have a text file with x, y, z data from a LIDAR survey.  Can someone
> suggest a method to use to derive a Spatial Pixels or Spatial Grid object
> from these?  The spacing is not exactly regular of course.  The data are
> dense over all of the domain except for some blank areas, which I would
> like to designate as NA.
>
> I am open to using most packages and functions, but don't want to use
> GRASS.
>
> Scott
>

Any particular reason not to use GRASS? In most cases it will scale to very 
large point datasets very nicely. Specifically, see the module r.in.xyz 

http://grass.itc.it/grass65/manuals/html65_user/r.in.xyz.html

From the manual page:
"r.in.xyz is designed for processing massive point cloud datasets, for example 
raw LIDAR or sidescan sonar swath data. It has been tested with datasets as 
large as 14.5 billion points (379GB)."

Some more information from the GRASS Wiki:
http://grass.osgeo.org/wiki/LIDAR

Cheers,
Dylan

-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From Scott.Waichler at pnl.gov  Wed Jul 28 20:23:24 2010
From: Scott.Waichler at pnl.gov (Waichler, Scott R)
Date: Wed, 28 Jul 2010 11:23:24 -0700
Subject: [R-sig-Geo] Methods for working with LIDAR data
In-Reply-To: <201007281114.13090.dylan.beaudette@gmail.com>
References: <A632B3F93D861843A3C966F3962C3F840107D9E3001B@EMAIL05.pnl.gov>
	<201007281114.13090.dylan.beaudette@gmail.com>
Message-ID: <A632B3F93D861843A3C966F3962C3F840107D9E30026@EMAIL05.pnl.gov>

> > I have a text file with x, y, z data from a LIDAR survey.  Can someone
> > suggest a method to use to derive a Spatial Pixels or Spatial Grid
> object
> > from these?  The spacing is not exactly regular of course.  The data are
> > dense over all of the domain except for some blank areas, which I would
> > like to designate as NA.
> >
> > I am open to using most packages and functions, but don't want to use
> > GRASS.
> >
> > Scott
> >
> 
> Any particular reason not to use GRASS? In most cases it will scale to
> very
> large point datasets very nicely. Specifically, see the module r.in.xyz

I don't have GRASS installed and my system admin indicated it may be involved to do so.  Plus, I don't know anything about it.  I was hoping to use a native R solution.  I do have GDAL and rgdal installed.

Scott


From debeaudette at ucdavis.edu  Wed Jul 28 20:31:19 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Wed, 28 Jul 2010 11:31:19 -0700
Subject: [R-sig-Geo] Methods for working with LIDAR data
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840107D9E30026@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840107D9E3001B@EMAIL05.pnl.gov>
	<201007281114.13090.dylan.beaudette@gmail.com>
	<A632B3F93D861843A3C966F3962C3F840107D9E30026@EMAIL05.pnl.gov>
Message-ID: <201007281131.19942.dylan.beaudette@gmail.com>

On Wednesday 28 July 2010, Waichler, Scott R wrote:
> > > I have a text file with x, y, z data from a LIDAR survey.  Can someone
> > > suggest a method to use to derive a Spatial Pixels or Spatial Grid
> >
> > object
> >
> > > from these?  The spacing is not exactly regular of course.  The data
> > > are dense over all of the domain except for some blank areas, which I
> > > would like to designate as NA.
> > >
> > > I am open to using most packages and functions, but don't want to use
> > > GRASS.
> > >
> > > Scott
> >
> > Any particular reason not to use GRASS? In most cases it will scale to
> > very
> > large point datasets very nicely. Specifically, see the module r.in.xyz
>
> I don't have GRASS installed and my system admin indicated it may be
> involved to do so.  Plus, I don't know anything about it.  I was hoping to
> use a native R solution.  I do have GDAL and rgdal installed.
>
> Scott

Understandable. There is a fairly simple Windows installer available. But if 
it is an R-based solution you are looking for, perhaps there are others on 
the list with more ideas.

-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From edzer.pebesma at uni-muenster.de  Wed Jul 28 20:50:06 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 28 Jul 2010 20:50:06 +0200
Subject: [R-sig-Geo] spplot how to control variable scale with colorkey()
In-Reply-To: <AANLkTikg-wK5PXqiM-yVtCvJkhGQY0VUk+5fCJGS038o@mail.gmail.com>
References: <AANLkTikg-wK5PXqiM-yVtCvJkhGQY0VUk+5fCJGS038o@mail.gmail.com>
Message-ID: <4C507BDE.1050706@uni-muenster.de>

On 07/28/2010 12:31 PM, Paulo Eduardo Cardoso wrote:
> While plotting with spplot, the legend space is reflecting the scale
> of the variable.
> 
> eg, by dping something like this:
> spplot(...,
> colorkey = list(at = c(0, 5, 10, 20, 50,100), labels = c("0", "< 5",
> "[5, 10)", "[10, 20)",
>  "[20, 50)", ">= 50"), space="bottom"))
> 
> spaces between each colour interval will be proportional to the scale
> of this particular variable.
> 
> Can one control this, forcing a equal interval space to the legend at colorkey?

afaik, not without changing the values of the underlying map plotted.
You can of course first transform the map to a factor, using your legend
boundaries (and labels):

library(sp)
data(meuse.grid)
gridded(meuse.grid) = ~x+y
meuse.grid$distf = factor(findInterval
(meuse.grid$dist,c(0,0.1,0.25,1)),labels=c("0-0.1", "0.1-0.25", "0.25-1"))
spplot(meuse.grid["distf"],col.regions=bpy.colors(3))


> 
> Paulo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Wed Jul 28 21:31:21 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 28 Jul 2010 21:31:21 +0200
Subject: [R-sig-Geo] change in sp::Lines() breaks example in my package
In-Reply-To: <4C4EEB96.7040600@yorku.ca>
References: <4C4EEB96.7040600@yorku.ca>
Message-ID: <4C508589.9050500@uni-muenster.de>

Michael, indeed a check was added recently to make sure that each Lines
colllection only has a single ID; I don't believe the array of IDs you
passed it had the effect you desired.

The short way out would be to have a simple

Lsl1 <- Lines(Ll1,"Streets")

but the nicer way assigns street IDs to individual streets:

i = 0
Lsl1 <- lapply(slist, function(x) {
	i <<- i+1
	Lines(Line(x), as.character(i))
})
rm(i)
Snow.streets.sp <- SpatialLines(Lsl1)

which now lets you index Snow.streets.sp, as in

Snow.streets.sp[100] # or
Snow.streets.sp["100"]

BTW it's the first time I advice someone to use <<- and I'd be happy for
a  suggestion to get rid of it!

On 07/27/2010 04:22 PM, Michael Friendly wrote:
> [Running R.2.11.1, Win XP]
> 
> I just updated sp from sp_0.9-65 to sp_0.9-66 after receiving a report
> from the CRAN team that my HistData
> package now generates errors in at least one documentation example.  It
> occurs in example(Snow), which
> worked successfully under the previous versions of sp.  I don't
> understand the nature of the error, or how to
> correct it.  Can someone point me in a useful direction?
> 
> Here is the complete portion of the example (to draw Snow's cholera map
> of London), suitable for cut/paste to R:
> 
> #install.packages("HistData")    # if necessary
> library(HistData)
> library(sp)
> 
> # streets
> slist <-
> split(Snow.streets[,c("x","y")],as.factor(Snow.streets[,"street"]))
> Ll1 <- lapply(slist,Line)
> Lsl1 <- Lines(Ll1,paste("Street",1:length(Ll1)))
> Snow.streets.sp <- SpatialLines(list(Lsl1))
> plot(Snow.streets.sp, col="gray")
> title(main="Snow's Cholera Map of London")
> 
> # deaths
> Snow.deaths.sp = SpatialPoints(Snow.deaths[,c("x","y")])
> plot(Snow.deaths.sp, add=TRUE, col ='red', pch=15, cex=0.6)
> 
> # pumps
> spp <- SpatialPoints(Snow.pumps[,c("x","y")])
> Snow.pumps.sp <- SpatialPointsDataFrame(spp,Snow.pumps[,c("x","y")])
> plot(Snow.pumps.sp, add=TRUE, col='blue', pch=17, cex=1.5)
> text(Snow.pumps[,c("x","y")], labels=Snow.pumps$label, pos=1, cex=0.8)
> 
> Here is the transcript showing the error with Lines:
> 
>> # streets
>> slist <-
> split(Snow.streets[,c("x","y")],as.factor(Snow.streets[,"street"]))
>> Ll1 <- lapply(slist,Line)
>> Lsl1 <- Lines(Ll1,paste("Street",1:length(Ll1)))
> Error in Lines(Ll1, paste("Street", 1:length(Ll1))) : Single ID required
>> Snow.streets.sp <- SpatialLines(list(Lsl1))
> Error in is.vector(X) : object 'Lsl1' not found
> 
> Some tests:
>> length(Ll1)
> [1] 528
>> length(unique(paste("Street",1:length(Ll1))))
> [1] 528
>>
> 
> 
> Below is my sessionInfo():
> 
>> sessionInfo()
> R version 2.11.1 (2010-05-31)
> i386-pc-mingw32
> 
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252  [3] LC_MONETARY=English_United
> States.1252
> [4] LC_NUMERIC=C                         [5] LC_TIME=English_United
> States.1252  
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base   
> other attached packages:
> [1] sp_0.9-66         KernSmooth_2.23-3 HistData_0.6-8 
> loaded via a namespace (and not attached):
> [1] grid_2.11.1    lattice_0.18-8 tools_2.11.1 >
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From friendly at yorku.ca  Wed Jul 28 23:22:16 2010
From: friendly at yorku.ca (Michael Friendly)
Date: Wed, 28 Jul 2010 17:22:16 -0400
Subject: [R-sig-Geo] change in sp::Lines() breaks example in my package
In-Reply-To: <4C508589.9050500@uni-muenster.de>
References: <4C4EEB96.7040600@yorku.ca> <4C508589.9050500@uni-muenster.de>
Message-ID: <4C509F88.3020409@yorku.ca>

Thanks, Edzer

What was not clear from either the documentation or the error message 
was what you just
said:  "each Lines *colllection* only has a single ID" . The .Rd just says

|ID| a unique character identifier

but 'unique' in what context?  help(Lines) gives no examples, so there 
was no way for me to figure this out.
It might help to revise the documentation, and you are welcome to use 
any part of this example if
it helps.  At a minimum, if I understand correctly, I suggest something like

|ID| a single character identifier, unique among other SpatialLines objects,
     applying to the collection of lines in \code{slinelist}

Your 'short way out' works for me, and I have no need to index 
particular streets.

best,
-Michael

Edzer Pebesma wrote:
> Michael, indeed a check was added recently to make sure that each Lines
> colllection only has a single ID; I don't believe the array of IDs you
> passed it had the effect you desired.
>
> The short way out would be to have a simple
>
> Lsl1 <- Lines(Ll1,"Streets")
>
> but the nicer way assigns street IDs to individual streets:
>
> i = 0
> Lsl1 <- lapply(slist, function(x) {
> 	i <<- i+1
> 	Lines(Line(x), as.character(i))
> })
> rm(i)
> Snow.streets.sp <- SpatialLines(Lsl1)
>
> which now lets you index Snow.streets.sp, as in
>
> Snow.streets.sp[100] # or
> Snow.streets.sp["100"]
>
> BTW it's the first time I advice someone to use <<- and I'd be happy for
> a  suggestion to get rid of it!
>
> On 07/27/2010 04:22 PM, Michael Friendly wrote:
>   
>> [Running R.2.11.1, Win XP]
>>
>> I just updated sp from sp_0.9-65 to sp_0.9-66 after receiving a report
>> from the CRAN team that my HistData
>> package now generates errors in at least one documentation example.  It
>> occurs in example(Snow), which
>> worked successfully under the previous versions of sp.  I don't
>> understand the nature of the error, or how to
>> correct it.  Can someone point me in a useful direction?
>>
>> Here is the complete portion of the example (to draw Snow's cholera map
>> of London), suitable for cut/paste to R:
>>
>> #install.packages("HistData")    # if necessary
>> library(HistData)
>> library(sp)
>>
>> # streets
>> slist <-
>> split(Snow.streets[,c("x","y")],as.factor(Snow.streets[,"street"]))
>> Ll1 <- lapply(slist,Line)
>> Lsl1 <- Lines(Ll1,paste("Street",1:length(Ll1)))
>> Snow.streets.sp <- SpatialLines(list(Lsl1))
>> plot(Snow.streets.sp, col="gray")
>> title(main="Snow's Cholera Map of London")
>>
>> # deaths
>> Snow.deaths.sp = SpatialPoints(Snow.deaths[,c("x","y")])
>> plot(Snow.deaths.sp, add=TRUE, col ='red', pch=15, cex=0.6)
>>
>> # pumps
>> spp <- SpatialPoints(Snow.pumps[,c("x","y")])
>> Snow.pumps.sp <- SpatialPointsDataFrame(spp,Snow.pumps[,c("x","y")])
>> plot(Snow.pumps.sp, add=TRUE, col='blue', pch=17, cex=1.5)
>> text(Snow.pumps[,c("x","y")], labels=Snow.pumps$label, pos=1, cex=0.8)
>>
>> Here is the transcript showing the error with Lines:
>>
>>     
>>> # streets
>>> slist <-
>>>       
>> split(Snow.streets[,c("x","y")],as.factor(Snow.streets[,"street"]))
>>     
>>> Ll1 <- lapply(slist,Line)
>>> Lsl1 <- Lines(Ll1,paste("Street",1:length(Ll1)))
>>>       
>> Error in Lines(Ll1, paste("Street", 1:length(Ll1))) : Single ID required
>>     
>>> Snow.streets.sp <- SpatialLines(list(Lsl1))
>>>       
>> Error in is.vector(X) : object 'Lsl1' not found
>>
>> Some tests:
>>     
>>> length(Ll1)
>>>       
>> [1] 528
>>     
>>> length(unique(paste("Street",1:length(Ll1))))
>>>       
>> [1] 528
>>     
>> Below is my sessionInfo():
>>
>>     
>>> sessionInfo()
>>>       
>> R version 2.11.1 (2010-05-31)
>> i386-pc-mingw32
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252
>> [2] LC_CTYPE=English_United States.1252  [3] LC_MONETARY=English_United
>> States.1252
>> [4] LC_NUMERIC=C                         [5] LC_TIME=English_United
>> States.1252  
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base   
>> other attached packages:
>> [1] sp_0.9-66         KernSmooth_2.23-3 HistData_0.6-8 
>> loaded via a namespace (and not attached):
>> [1] grid_2.11.1    lattice_0.18-8 tools_2.11.1 >
>>
>>     
>
>   


-- 
Michael Friendly     Email: friendly AT yorku DOT ca 
Professor, Psychology Dept.
York University      Voice: 416 736-5115 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From edzer.pebesma at uni-muenster.de  Thu Jul 29 00:22:02 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 29 Jul 2010 00:22:02 +0200
Subject: [R-sig-Geo] change in sp::Lines() breaks example in my package
In-Reply-To: <4C509F88.3020409@yorku.ca>
References: <4C4EEB96.7040600@yorku.ca> <4C508589.9050500@uni-muenster.de>
	<4C509F88.3020409@yorku.ca>
Message-ID: <4C50AD8A.8080402@uni-muenster.de>

Thanks for the suggestion.

There was an example in the sp vignette. The documentation didn't
mention that ID should be a character vector of length one. I think
we've implicitly assumed users would understand this, as even the sp
code before 0.9-66 allowed longer vectors:

> l1 = cbind(c(1, 2, 3), c(3, 2, 2))
> Sl1 = Line(l1)
> S1 = Lines(list(Sl1), ID = c("a","b"))
> S1
An object of class "Lines"
Slot "Lines":
[[1]]
An object of class "Line"
Slot "coords":
     [,1] [,2]
[1,]    1    3
[2,]    2    2
[3,]    3    2

Slot "ID":
[1] "a" "b"

The idea of having IDs however is that when Lines get attributes, as in
SpatialLinesDataFrames, a match of lines and attribute table row.names
is done based on IDs. This rules out the possibility of IDs having
length larger than one.

On 07/28/2010 11:22 PM, Michael Friendly wrote:
> Thanks, Edzer
> 
> What was not clear from either the documentation or the error message
> was what you just
> said:  "each Lines *colllection* only has a single ID" . The .Rd just says
> 
> |ID| a unique character identifier
> 
> but 'unique' in what context?  help(Lines) gives no examples, so there
> was no way for me to figure this out.
> It might help to revise the documentation, and you are welcome to use
> any part of this example if
> it helps.  At a minimum, if I understand correctly, I suggest something
> like
> 
> |ID| a single character identifier, unique among other SpatialLines
> objects,
>     applying to the collection of lines in \code{slinelist}
> 
> Your 'short way out' works for me, and I have no need to index
> particular streets.
> 
> best,
> -Michael
> 
> Edzer Pebesma wrote:
>> Michael, indeed a check was added recently to make sure that each Lines
>> colllection only has a single ID; I don't believe the array of IDs you
>> passed it had the effect you desired.
>>
>> The short way out would be to have a simple
>>
>> Lsl1 <- Lines(Ll1,"Streets")
>>
>> but the nicer way assigns street IDs to individual streets:
>>
>> i = 0
>> Lsl1 <- lapply(slist, function(x) {
>>     i <<- i+1
>>     Lines(Line(x), as.character(i))
>> })
>> rm(i)
>> Snow.streets.sp <- SpatialLines(Lsl1)
>>
>> which now lets you index Snow.streets.sp, as in
>>
>> Snow.streets.sp[100] # or
>> Snow.streets.sp["100"]
>>
>> BTW it's the first time I advice someone to use <<- and I'd be happy for
>> a  suggestion to get rid of it!
>>
>> On 07/27/2010 04:22 PM, Michael Friendly wrote:
>>  
>>> [Running R.2.11.1, Win XP]
>>>
>>> I just updated sp from sp_0.9-65 to sp_0.9-66 after receiving a report
>>> from the CRAN team that my HistData
>>> package now generates errors in at least one documentation example.  It
>>> occurs in example(Snow), which
>>> worked successfully under the previous versions of sp.  I don't
>>> understand the nature of the error, or how to
>>> correct it.  Can someone point me in a useful direction?
>>>
>>> Here is the complete portion of the example (to draw Snow's cholera map
>>> of London), suitable for cut/paste to R:
>>>
>>> #install.packages("HistData")    # if necessary
>>> library(HistData)
>>> library(sp)
>>>
>>> # streets
>>> slist <-
>>> split(Snow.streets[,c("x","y")],as.factor(Snow.streets[,"street"]))
>>> Ll1 <- lapply(slist,Line)
>>> Lsl1 <- Lines(Ll1,paste("Street",1:length(Ll1)))
>>> Snow.streets.sp <- SpatialLines(list(Lsl1))
>>> plot(Snow.streets.sp, col="gray")
>>> title(main="Snow's Cholera Map of London")
>>>
>>> # deaths
>>> Snow.deaths.sp = SpatialPoints(Snow.deaths[,c("x","y")])
>>> plot(Snow.deaths.sp, add=TRUE, col ='red', pch=15, cex=0.6)
>>>
>>> # pumps
>>> spp <- SpatialPoints(Snow.pumps[,c("x","y")])
>>> Snow.pumps.sp <- SpatialPointsDataFrame(spp,Snow.pumps[,c("x","y")])
>>> plot(Snow.pumps.sp, add=TRUE, col='blue', pch=17, cex=1.5)
>>> text(Snow.pumps[,c("x","y")], labels=Snow.pumps$label, pos=1, cex=0.8)
>>>
>>> Here is the transcript showing the error with Lines:
>>>
>>>    
>>>> # streets
>>>> slist <-
>>>>       
>>> split(Snow.streets[,c("x","y")],as.factor(Snow.streets[,"street"]))
>>>    
>>>> Ll1 <- lapply(slist,Line)
>>>> Lsl1 <- Lines(Ll1,paste("Street",1:length(Ll1)))
>>>>       
>>> Error in Lines(Ll1, paste("Street", 1:length(Ll1))) : Single ID required
>>>    
>>>> Snow.streets.sp <- SpatialLines(list(Lsl1))
>>>>       
>>> Error in is.vector(X) : object 'Lsl1' not found
>>>
>>> Some tests:
>>>    
>>>> length(Ll1)
>>>>       
>>> [1] 528
>>>    
>>>> length(unique(paste("Street",1:length(Ll1))))
>>>>       
>>> [1] 528
>>>     Below is my sessionInfo():
>>>
>>>    
>>>> sessionInfo()
>>>>       
>>> R version 2.11.1 (2010-05-31)
>>> i386-pc-mingw32
>>>
>>> locale:
>>> [1] LC_COLLATE=English_United States.1252
>>> [2] LC_CTYPE=English_United States.1252  [3] LC_MONETARY=English_United
>>> States.1252
>>> [4] LC_NUMERIC=C                         [5] LC_TIME=English_United
>>> States.1252  attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods  
>>> base   other attached packages:
>>> [1] sp_0.9-66         KernSmooth_2.23-3 HistData_0.6-8 loaded via a
>>> namespace (and not attached):
>>> [1] grid_2.11.1    lattice_0.18-8 tools_2.11.1 >
>>>
>>>     
>>
>>   
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From pierre.roudier at gmail.com  Thu Jul 29 07:09:54 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Thu, 29 Jul 2010 17:09:54 +1200
Subject: [R-sig-Geo] spplot how to control variable scale with colorkey()
In-Reply-To: <AANLkTikg-wK5PXqiM-yVtCvJkhGQY0VUk+5fCJGS038o@mail.gmail.com>
References: <AANLkTikg-wK5PXqiM-yVtCvJkhGQY0VUk+5fCJGS038o@mail.gmail.com>
Message-ID: <AANLkTinL9yqStLyW3XjRT=V1iCboH65BZsGTS3QxPkOR@mail.gmail.com>

I'm not completely sure to understand your question properly, but I
think ggplot2 can be a solution to your problem, I find it great to
plot spatial data:

library(sp)
library(ggplot2)

# For gridded data
data(meuse.grid)
gridded(meuse.grid) <- ~x+y
ggplot(data=as.data.frame(meuse.grid), aes(x=x, y=y)) +
geom_tile(aes(fill=dist)) + scale_fill_gradientn("My variable",
colours=terrain.colors(255)) + coord_equal()

# For ungridded data
data(meuse)
coordinates(meuse) <- ~x+y
ggplot(data=as.data.frame(meuse), aes(x=x, y=y)) +
geom_point(aes(colour=lead)) + scale_colour_gradientn("My variable",
colours=rainbow(255)) + coord_equal()

For more tweaking see ?scale_colour_gradientn ?scale_fill_gradientn
and other ggplot2 ressources.

Hope this helps,

Pierre

2010/7/28 Paulo Eduardo Cardoso <paulo.mailing.list at gmail.com>:
> While plotting with spplot, the legend space is reflecting the scale
> of the variable.
>
> eg, by dping something like this:
> spplot(...,
> colorkey = list(at = c(0, 5, 10, 20, 50,100), labels = c("0", "< 5",
> "[5, 10)", "[10, 20)",
> ?"[20, 50)", ">= 50"), space="bottom"))
>
> spaces between each colour interval will be proportional to the scale
> of this particular variable.
>
> Can one control this, forcing a equal interval space to the legend at colorkey?
>
> Paulo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hengl at spatial-analyst.net  Thu Jul 29 08:14:18 2010
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Thu, 29 Jul 2010 08:14:18 +0200
Subject: [R-sig-Geo] Help: Merging several geotiff files
In-Reply-To: <4C504203.4050604@cornell.edu>
References: <4C504203.4050604@cornell.edu>
Message-ID: <4C511C3A.3060705@spatial-analyst.net>


My favorite (fastest, easiest to program, most reliable) software to 
mosaic large number of geotifs are:

1. FWTools
[http://www.gdal.org/gdal_merge.html]

2. SAGA GIS
[http://www.saga-gis.org/saga_modules_doc/grid_tools/grid_tools_03.html]

Here are some examples of how to reproject, then merge large amount of 
files into a single map using the above listed tools (this script 
requires 4GB RAM to run):

[http://spatial-analyst.net/scripts/getGLCF.R]

Why don't you compare each of the tree options (raster, FWTools, SAGA) 
and then report to this community which one you prefer (following some 
objective indicators of course)?

T. Hengl
http://home.medewerker.uva.nl/t.hengl/


Zia Ahmed wrote:
> Hi,
> I have several DEM sheets as geotiff format. I like to merge/mosaic them 
> to create a  grid file  using a R-function. Help will be appreciated.
> Zia
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From kerryr at sccwrp.org  Thu Jul 29 22:15:14 2010
From: kerryr at sccwrp.org (Kerry Ritter)
Date: Thu, 29 Jul 2010 13:15:14 -0700
Subject: [R-sig-Geo] Back transforming kriging predictions and prediction
 errors (family box-cox)
Message-ID: <4C51E152.6020903@sccwrp.org>

Hi All. I am applying both a log10 transformation as
well as arcsine(sqrt) to my data to make the data more consistent with
normality. I believe these are both members of the box-cox family.  I would like to make countour maps of both kriging predictions and kriging prediction errors on the original scale. How do I back transform to get values on the original scale to make the maps?  If there an R function that does the back transforming for me all the better.
Thanks,
Kerry

-- 
**********************
Kerry Ritter, Ph.D.
statistician
Southern California Coastal Water Research Project
3535 Harbor Blvd., Suite 110

work: 714-755-3210
cell: 714-420-3346
fax:  714-755-3299

email: kerryr at sccwrp.org


From r.m.krug at gmail.com  Fri Jul 30 09:33:42 2010
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Fri, 30 Jul 2010 09:33:42 +0200
Subject: [R-sig-Geo] Determine angle between polyline segments
Message-ID: <4C528056.3010406@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi

a friend of mine wants (needs?) to determine the angle between segments
in an ESRI polyline (line vector feature). As there does not seem to be
an easy way in ArcGIS 9.2, I thought about askeng here:

Is there way of calculating these angles between the different line
segments in R (after importing the line feature into R)?

Thanks,

Rainer

- -- 
Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
Biology, UCT), Dipl. Phys. (Germany)

Centre of Excellence for Invasion Biology
Natural Sciences Building
Office Suite 2039
Stellenbosch University
Main Campus, Merriman Avenue
Stellenbosch
South Africa

Tel:        +33 - (0)9 53 10 27 44
Cell:       +27 - (0)8 39 47 90 42
Fax (SA):   +27 - (0)8 65 16 27 82
Fax (D) :   +49 - (0)3 21 21 25 22 44
Fax (FR):   +33 - (0)9 58 10 27 44
email:      Rainer at krugs.de

Skype:      RMkrug
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkxSgFYACgkQoYgNqgF2egp34ACeMiVR1XG9xb/YH7KpFJ+3jTln
5WUAn3Cxbl1BCr9iSidDFYcmwdiiYhFh
=P2Jq
-----END PGP SIGNATURE-----


From nikhil.list at gmail.com  Fri Jul 30 16:53:00 2010
From: nikhil.list at gmail.com (Nikhil Kaza)
Date: Fri, 30 Jul 2010 10:53:00 -0400
Subject: [R-sig-Geo] Determine angle between polyline segments
In-Reply-To: <4C528056.3010406@gmail.com>
References: <4C528056.3010406@gmail.com>
Message-ID: <93A1DC1D-F120-46A7-8EC6-CEB01A717F60@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100730/60ec970a/attachment.pl>

From basille at ase-research.org  Fri Jul 30 17:22:47 2010
From: basille at ase-research.org (Mathieu Basille)
Date: Fri, 30 Jul 2010 11:22:47 -0400
Subject: [R-sig-Geo] Determine angle between polyline segments
In-Reply-To: <4C528056.3010406@gmail.com>
References: <4C528056.3010406@gmail.com>
Message-ID: <4C52EE47.8030708@ase-research.org>

Hello,

Have you considered using the 'adehabitat' package? It presents classes 
and tools for the analysis of trajectories, and automagically computes 
absolute and relative angles. I'm not that familiar with polylines (in 
ArcGIS or sp) so that I don't have a working example at hand, but you'd 
have to extract coordinates of the polylines to build a ltraj object 
(using as.ltraj), keeping the ID of the line as the ID of the ltraj, and 
with 'typeII = FALSE' which means that you don't have the exact date.

In the end, an object of class ltraj is a list with a data frame for 
each element of the list (for you a line), which gives you both kind of 
angles among other variables (dx, dy, dist, etc.).

Hope this helps,
Mathieu.


Le 30/07/2010 03:33, Rainer M Krug a ?crit :
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi
>
> a friend of mine wants (needs?) to determine the angle between segments
> in an ESRI polyline (line vector feature). As there does not seem to be
> an easy way in ArcGIS 9.2, I thought about askeng here:
>
> Is there way of calculating these angles between the different line
> segments in R (after importing the line feature into R)?
>
> Thanks,
>
> Rainer
>
> - --
> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
> Biology, UCT), Dipl. Phys. (Germany)
>
> Centre of Excellence for Invasion Biology
> Natural Sciences Building
> Office Suite 2039
> Stellenbosch University
> Main Campus, Merriman Avenue
> Stellenbosch
> South Africa
>
> Tel:        +33 - (0)9 53 10 27 44
> Cell:       +27 - (0)8 39 47 90 42
> Fax (SA):   +27 - (0)8 65 16 27 82
> Fax (D) :   +49 - (0)3 21 21 25 22 44
> Fax (FR):   +33 - (0)9 58 10 27 44
> email:      Rainer at krugs.de
>
> Skype:      RMkrug
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
> iEYEARECAAYFAkxSgFYACgkQoYgNqgF2egp34ACeMiVR1XG9xb/YH7KpFJ+3jTln
> 5WUAn3Cxbl1BCr9iSidDFYcmwdiiYhFh
> =P2Jq
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 

~$ whoami
Mathieu Basille, Post-Doc

~$ locate
Laboratoire d'?cologie Comportementale et de Conservation de la Faune
+ Centre d'?tude de la For?t
D?partement de Biologie
Universit? Laval, Qu?bec

~$ info
http://ase-research.org/basille

~$ fortune
``If you can't win by reason, go for volume.''
Calvin, by Bill Watterson.


From Roger.Bivand at nhh.no  Fri Jul 30 20:58:25 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 30 Jul 2010 20:58:25 +0200 (CEST)
Subject: [R-sig-Geo] error in errorsarlm
In-Reply-To: <AANLkTik_BYkRFUMMC-Vr-UY0UfhOyJZ6HJfg98BDpndt@mail.gmail.com>
References: <AANLkTintGvKs7Y9AXUOLUeYPZwWtj2fH5ugltwhK-jm1@mail.gmail.com>
	<alpine.LRH.2.00.1007162144300.19802@reclus.nhh.no>
	<AANLkTik9muDJNtOG4lyJXl2Fk96c3CRDJAZ6dNJDntvq@mail.gmail.com>
	<alpine.LRH.2.00.1007171534310.22601@reclus.nhh.no>
	<AANLkTinWLIBpZQBFjANAgXkfXudfoUmGg8YGek3zD4R4@mail.gmail.com>
	<alpine.LRH.2.00.1007201614260.18432@reclus.nhh.no>
	<AANLkTik_BYkRFUMMC-Vr-UY0UfhOyJZ6HJfg98BDpndt@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1007302053580.22750@reclus.nhh.no>

On Fri, 23 Jul 2010, elaine kuo wrote:

>>
>>
>>>>> 1. change method to Matrix
>>>
>>>
>>>  System calculation is specific, the condition is =5.14146e-17 (translated
>>> from Chinese)
>>>
>>> Warning messages:
>>>
>>
>> Warning not a problem, but the error suggests scaling problems in the
>> covariance matrix of the coefficients. The X variables are most likely
>> measured in inappropriate metrics (some coefficients of size 1000, others of
>> size 0.0001, for example).
>>
>> ==>  using standardized regression, the warning disappeared as you advised.
>>
>
>  However, another set of warning appears:
>
>  Warning messages:
> 1: In determinant(x, TRUE) : This version of the Matrix package returns
> |determinant(L)| instead of determinant(A), i.e., a
> *DIFFERENT* value.
> If still necessary, do change your code, following
> http://matrix.r-forge.r-project.org
>
> 2: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,  :
>  not converged within order iterations
> 3: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,  :
>  not converged within order iterations
>
> Please kindly advise how to modify the code below from determinant L to
> determinant A and why ?

The warning is irrelevant. The error is caused by your weights.

>
>
> 2. great distance circle
>
> And make sure that you do use Great Circle distances - you are not doing so
> now.
> With 200 neighbours, you have no viable spatial process, really.
>
> => longlat = TRUE returns no valid observation ...
>     similar error messages have been researched in the archived mail
>     but no identical case found...
>    Please kindly suggest when longlat=TRUE,
>    whether the unit of both longitude and latitude is degree.decimal..
>    (confused with the manual explanation "measured in kilometer")

The threshold is in km when longlat=TRUE, but the coordinates are in 
decimal degrees. Please state the representation of your coordinates - are 
they in decimal degrees or not?

>
>    Also, does "no viable spatial process" mean
>   no spatial interaction within the range should be taken into
> consideration ?

No, simply that you are including too many neighbours leading to too much 
smoothing for many observations.

Please try everything on small examples until you understand what you are 
doing. Best, use publically available small examples, and include complete 
verbatim code (or post code on a website), max. 10 lines.


>
>   Thank you
>
>   Elaine
>
>
> code
> datam <-read.csv("c:/migration/M_R_SummerM20100722.csv",header=T,
> row.names=1)
>
> # std method   scale
>  datam.sd<-scale(datam)
>  datam.std<-as.data.frame(datam.sd)
>  summary (datam.std)
>  mean(datam.std)
>
>  # obtain standard deviation
>  sd(datam.std)
>
>  mig.std
> <-lm(datam.std$SummerM_ratio~datam.std$coast+datam.std$topo_mean+datam.std$prec_mean+datam.std$temp_ran+datam.std$evi_ran,data=datam.std)
>  summary(mig.std)
>
>  #SAR
>
>  library(ncf)
>  library(spdep)
>
>  # Define coordinates, neighbours, and spatial weights
>  coords<-cbind(datam$lon,datam$lat)
>  coords<-as.matrix(coords)
>
>  #Define neighbourhood (here distance 5)
>  nb5<-dnearneigh(coords,0,5,longlat=TRUE)
>
>
>  #Spatial weights, illustrated with coding style "W" (row standardized)
>  nb5.w<-nb2listw(nb5, glist=NULL, style="W", zero.policy=TRUE)
>
>
>   +++error in nb2listw(nb5, glist = NULL, style = "W", zero.policy = TRUE)
> :
>  No valid observations  +++
>  (then modified as  nb5<-dnearneigh(coords,0,5) and Matrix went on
> smoothly )
>
>  # Spatial SAR error model
>  sem.nb5.w <-
> errorsarlm(datam.std$SummerM_ratio~datam.std$coast+datam.std$topo_mean+datam.std$prec_mean+datam.std$temp_ran+datam.std$evi_ran,data=datam.std,
> listw=nb5.w, na.action=na.omit, method="Matrix", zero.policy=TRUE)
>
>
>
>>
>>
>> +++warning
>>
>>
>>> 1: In determinant(x, TRUE) : This version of the Matrix package returns
>>>
>>> |determinant(L)| instead of determinant(A), i.e., a
>>>
>>> *DIFFERENT* value.
>>>
>>> If still necessary, do change your code, following
>>> http://matrix.r-forge.r-project.org
>>>
>>>
>>>
>>> 2: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,  :
>>>
>>>  not converged within order iterations
>>>
>>> 3: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,  :
>>>
>>>  not converged within order iterations  ++++
>>>
>>>
>>>
>>>
>>>
>>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Fri Jul 30 21:19:49 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 30 Jul 2010 21:19:49 +0200 (CEST)
Subject: [R-sig-Geo] Aitoff projection for histograms
In-Reply-To: <8E7E5E23-4E3E-4381-A0DF-D373B338E932@gmail.com>
References: <8E7E5E23-4E3E-4381-A0DF-D373B338E932@gmail.com>
Message-ID: <alpine.LRH.2.00.1007302116020.22750@reclus.nhh.no>

On Wed, 28 Jul 2010, Krzysztof Nienartowicz wrote:

> Hello,
> I am a complete newbie and would be grateful for any hints if it is possible to create Aitoff projections over some Z parameter in the dataframe using some geo package?
> It would be used for astronomy data mining. I use r-postgres to fetch data so postgres gis extensions could be of use as well.

Using the PROJ.4 library through rgdal, you may find +proj=aitoff relevant 
in your CRS (coordinate reference system) definition. I suggest testing 
with caution on known pairs of coordinates to work out the syntax, until 
you are sure that it is giving you what you need.

Roger

> Best regards,
> Krzysztof
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From cribeiro at ualg.pt  Sat Jul 31 14:54:54 2010
From: cribeiro at ualg.pt (cribeiro at ualg.pt)
Date: Sat, 31 Jul 2010 14:54:54 +0200
Subject: [R-sig-Geo] add legend to plot(spatialpolygonsdataframe)
Message-ID: <20100731145454.21283ee0ndp8asys@wmail.ualg.pt>

class="incorrect"&amp;gt;class="incorrect"&gt;Helo, Paulo

class="incorrect"&amp;gt;class="incorrect"&gt;My  
class="incorrect"&amp;gt;class="incorrect"&gt;suggestion is

class="incorrect"&amp;gt;class="incorrect"&gt;class="incorrect"&amp;amp;gt;class="incorrect"&amp;gt;class="incorrect"&amp;amp;amp;gt;class="incorrect"&amp;amp;gt;class="incorrect"&amp;amp;amp;amp;gt;class="incorrect"&amp;amp;amp;gt;library(class="incorrect"&amp;gt;class="incorrect"&gt;maptools)     # class="incorrect"&amp;gt;class="incorrect"&gt;loads class="incorrect"&amp;gt;class="incorrect"&gt;sp class="incorrect"&amp;gt;class="incorrect"&gt;class="incorrect"&amp;amp;gt;class="incorrect"&amp;gt;class="incorrect"&amp;amp;amp;gt;class="incorrect"&amp;amp;gt;class="incorrect"&amp;amp;amp;amp;gt;class="incorrect"&amp;amp;amp;gt;library  
too
class="incorrect"&amp;gt;class="incorrect"&gt;class="incorrect"&amp;amp;gt;class="incorrect"&amp;gt;class="incorrect"&amp;amp;amp;gt;class="incorrect"&amp;amp;gt;class="incorrect"&amp;amp;amp;amp;gt;class="incorrect"&amp;amp;amp;gt;library(class="incorrect"&amp;gt;class="incorrect"&gt;RColorBrewer) # class="incorrect"&amp;gt;class="incorrect"&gt;creates class="incorrect"&amp;gt;class="incorrect"&gt;nice class="incorrect"&amp;gt;class="incorrect"&gt;color  
class="incorrect"&amp;gt;class="incorrect"&gt;schemes
class="incorrect"&amp;gt;class="incorrect"&gt;class="incorrect"&amp;amp;gt;class="incorrect"&amp;gt;class="incorrect"&amp;amp;amp;gt;class="incorrect"&amp;amp;gt;class="incorrect"&amp;amp;amp;amp;gt;class="incorrect"&amp;amp;amp;gt;library(class="incorrect"&amp;gt;class="incorrect"&gt;classInt)     # class="incorrect"&amp;gt;class="incorrect"&gt;finds class="incorrect"&gt;class class="incorrect"&gt;intervals for class="incorrect"&gt;continuous  
class="incorrect"&gt;variables

file.class="incorrect"&gt;class="incorrect"&amp;gt;shp <-  
class="incorrect"&gt;readShapePoly("class="incorrect"&gt;yourfile.class="incorrect"&gt;class="incorrect"&amp;gt;shp")

class="incorrect"&gt;class="incorrect"&amp;gt;plotvar <-  
file.class="incorrect"&gt;class="incorrect"&amp;gt;shp at data$your_var_to_be_plot
class="incorrect"&gt;class="incorrect"&amp;gt;class="incorrect"&amp;amp;gt;nclr <-  
8
class="incorrect"&gt;plotclr <-  
class="incorrect"&gt;brewer.class="incorrect"&gt;pal(class="incorrect"&gt;class="incorrect"&amp;gt;class="incorrect"&amp;amp;gt;nclr,"class="incorrect"&gt;BuPu")
class="incorrect"&gt;class <-  
class="incorrect"&gt;classIntervals(class="incorrect"&gt;class="incorrect"&amp;gt;plotvar, class="incorrect"&gt;class="incorrect"&amp;gt;class="incorrect"&amp;amp;gt;nclr,  
class="incorrect"&gt;style="class="incorrect"&gt;quantile",class="incorrect"&gt;dataPrecision=0)
class="incorrect"&gt;colcode <-  
class="incorrect"&gt;findColours(class="incorrect"&gt;class,  
class="incorrect"&gt;plotclr)

plot(file.class="incorrect"&gt;class="incorrect"&amp;gt;shp)
plot(file.class="incorrect"&gt;class="incorrect"&amp;gt;shp,  
col=class="incorrect"&gt;colcode, add=T)
title(main="Your title")
sub="Quantile (Equal-Frequency) Class Intervals")
legend(locator(1), legend=names(attr(class="incorrect"&gt;colcode, "table")),
fill=attr(class="incorrect"&gt;colcode, "palette"), cex=0.6, bty="n")

Concei??o Ribeiro


From cribeiro at ualg.pt  Sat Jul 31 15:12:46 2010
From: cribeiro at ualg.pt (cribeiro at ualg.pt)
Date: Sat, 31 Jul 2010 15:12:46 +0200
Subject: [R-sig-Geo] add legend to plot(spatialpolygonsdataframe)
Message-ID: <20100731151246.128767p4ug0lvukg@wmail.ualg.pt>

Hello, Paulo

My suggestion is

library(maptools) # loads sp library too
library(RColorBrewer) # creates nice color schemes
library(classInt) # finds class intervals for continuous variables
file.shp <- readShapePoly("yourfile.shp")
plotvar <- file.shp at data$your_var_to_be_plot
nclr <- 8
plotclr <- brewer.pal(nclr,"BuPu")
class <- classIntervals(plotvar, nclr, style="quantile",dataPrecision=0)
colcode <- findColours(class, plotclr)
plot(file.shp)
plot(file.shp, col=colcode, add=T)
title(main="your title")
sub="Quantile (Equal-Frequency) Class Intervals")
legend(locator(1), legend=names(attr(colcode, "table")),
fill=attr(colcode, "palette"), cex=0.6, bty="n")

Concei??o Ribeiro

----------------------------------------------------------------

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Re_ [R-sig-Geo] add legend to plot(spatialpolygonsdataframe).pdf
Type: application/pdf
Size: 5193 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100731/6a40cbc4/attachment.pdf>

From cribeiro at ualg.pt  Sat Jul 31 15:27:24 2010
From: cribeiro at ualg.pt (cribeiro at ualg.pt)
Date: Sat, 31 Jul 2010 15:27:24 +0200
Subject: [R-sig-Geo] edit.nb
Message-ID: <20100731152724.10828zx249xr1m1w@wmail.ualg.pt>

Hello,

When I use edit.nb() in R version 2.9.2 (2009-08-24), it works fine.  
But when Iuse it in R version 2.11.1 (2010-05-31), it dosen't. Can you  
help me with this, please?

Thank's.

Concei??o Ribeiro


----------------------------------------------------------------

-------------- next part --------------
A non-text attachment was scrubbed...
Name: edit.nb.pdf
Type: application/pdf
Size: 3829 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100731/5a07fb5d/attachment.pdf>

From Roger.Bivand at nhh.no  Sat Jul 31 16:28:47 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 31 Jul 2010 16:28:47 +0200 (CEST)
Subject: [R-sig-Geo] edit.nb
In-Reply-To: <20100731152724.10828zx249xr1m1w@wmail.ualg.pt>
References: <20100731152724.10828zx249xr1m1w@wmail.ualg.pt>
Message-ID: <alpine.LRH.2.00.1007311624160.32208@reclus.nhh.no>

On Sat, 31 Jul 2010, cribeiro at ualg.pt wrote:

> Hello,
>
> When I use edit.nb() in R version 2.9.2 (2009-08-24), it works fine. But when 
> Iuse it in R version 2.11.1 (2010-05-31), it dosen't. Can you help me with 
> this, please?

The issue is that maptools has been updated to try to stop the use of the 
very outdated polylist representation of polygons, given as the polys= 
argument. The edit.nb function does work when polys= is given an object 
inheriting from SpatialPolygons. I've submitted a revision of spdep to 
CRAN to permit the backwards-compatible use of polylist objects, but a 
warning is issued asking that the newer representation be used.

Roger


>
> Thank's.
>
> Concei??o Ribeiro
>
>
> ----------------------------------------------------------------
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

