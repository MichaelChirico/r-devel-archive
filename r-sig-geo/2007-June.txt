From renaud.lancelot at gmail.com  Fri Jun  1 00:15:46 2007
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Fri, 1 Jun 2007 00:15:46 +0200
Subject: [R-sig-Geo] [R] Follow up: surfaces and digital terrain model
In-Reply-To: <Pine.LNX.4.64.0705312229090.8722@gannet.stats.ox.ac.uk>
References: <BAY102-DAV170E36744719728702285BBC2E0@phx.gbl>
	<465DCC44.2070502@alumni.uwaterloo.ca>
	<Pine.LNX.4.44.0705302252410.22911-100000@reclus.nhh.no>
	<000001c7a3c5$db20c070$0601a8c0@D3K86YB1>
	<Pine.LNX.4.64.0705312229090.8722@gannet.stats.ox.ac.uk>
Message-ID: <c2ee56800705311515i1c10253fu1c580636a69541c9@mail.gmail.com>

2007/5/31, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> I believe you are looking for the function contourLines() in package
> graphics.
>
> At some point in the intervening years there was a clines package on CRAN,
> and if you know that you can find it at
> http://cran.r-project.org/src/contrib/Archive/C/clines_2.0-2.tar.gz
> That confirms it has been superseded by contourLines.
>
> BTW, it is Paul Murrell (two l's) we have to thank for this.

Yes, indeed :-)

Renaud


>
>
> On Thu, 31 May 2007, Andrew Niccolai wrote:
>
> > I realize that as of yesterday, this message thread is 4 years old but can
> > someone possibly post the clines function that Renaud mentions in the
> > posting below?  That would be wonderful and most appreciated.
> >
> > Thanks,
> > Andrew
> >
> >
> > Andrew Niccolai
> > Doctoral Candidate
> > Yale School of Forestry
> >
> >
> >
> > From: Renaud Lancelot <lancelot>
> > Date: Fri May 30 22:37:02 2003
> >
> > Yesterday, I posted the following:
> >
> >>> I have computed a digital terrain model from a set of points (x, y, z)
> >>> using the function interp() in package akima. I want to predict flooded
> >>> surfaces given target values of z. I can display the flooded surfaces
> >>> with contour() or image(), but I don't know how to get the polygons
> >>> delimiting the surfaces. Did anyone write a function for this purpose ?
> >
> > Many thanks to Roger Bivand, Paul Murrel, Deepayan Sarkar, Barry
> > Rowlingson and Thomas W Blackwell for their replies and their help. Paul
> > Murrel provided me with a function "clines", kindly ported to Windows by
> > Duncan Murdoch. This function does exactly what I need, i.e. it returns
> > a list of polygons corresponding to target value(s) of z.
> >
> > I wrote a function to compute (hopefully !) what I want, i.e. predicted
> > flooded surfaces given target values of z (managing the cases of several
> > independent watered surfaces, possibly with islands). Provided that Paul
> > Murrel agrees to share his function, I will be happy to send it to
> > anyone wishing to use and improve it (and debug it ;-) ).
> >
> > Best regards and thanks again,
> >
> > Renaud
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Renaud LANCELOT
D?partement Syst?mes Biologiques du CIRAD
CIRAD, Biological Systems Department

Campus International de Baillarguet
TA 30 / B
F34398 Montpellier
Tel   +33 (0)4 67 59 37 17
Secr. +33 (0)4 67 59 37 37
Fax   +33 (0)4 67 59 37 95



From yud at mail.montclair.edu  Fri Jun  1 05:45:34 2007
From: yud at mail.montclair.edu (Danlin Yu)
Date: Thu, 31 May 2007 23:45:34 -0400
Subject: [R-sig-Geo] All zero link when reading a modified shapefile
 into R
In-Reply-To: <Pine.LNX.4.44.0705312226490.23714-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0705312226490.23714-100000@reclus.nhh.no>
Message-ID: <465F965E.3070500@mail.montclair.edu>

Dear Roger:

Thanks very much for your response. By increasing the snap value, the 
neighbor list was successfully created, which leads me to believe ArcGIS 
must have done something really wierd for when some polygons were 
deleted. However, after I loaded the original file and started to try 
your suggestions, I found that I was totally wrong - previously I 
thought I used the orginal shapefile to create the neighbor list, but I 
actually used a built and cleaned one - which was created from the 
orginal file. While in the meantime, I found that the original tract 
shapefile does not contain any topological information in it, that's why 
neither R nor GeoDa can create a useful neighbor list.

Totally my bad. But three lessons learned nonetheless:

1. with increased snap value in poly2nb, a useful link based on 
contiguity can be built from a spaghetti shapefile, but caution needs to 
be taken;
2. never create too many shapefiles at the same time with similar names
3. by converting a non-topology shapefile to a feature class into a 
personal Geodatabase and convert it back to shapefile, you can 
successfully build a shapefile with topology.

Thanks to Roger and apology to the list for my carelessness.

Best,
Danlin

Roger Bivand wrote:

>On Thu, 31 May 2007, Danlin Yu wrote:
>
>  
>
>>Hi all-
>>
>>When I read a shapefile using read.shape into R, and used Map2poly ->
>>poly2nb to create my neighbor list, the summary of the newly created
>>neighbor list indicates that all the regions have zero link.
>>
>>The shapefile is a modified census tract shapefile of New Jersey: a few
>>tracts that have no useful attributal information were deleted from the
>>map (hence left some holes) in ArcGIS &#65288;Start Edit -> select ->
>>delete).
>>
>>The original shapefile (with all the tracts) was read fine and create
>>the correct neighbor list. But when using this modified one, I got all
>>zero link. The same happened when I used GeoDa. Is this because of the
>>holes created in the shapefile by deleting some polygons? If so, how can
>>I make it work? If not, can anyone please direct me to the right
>>solution?
>>    
>>
>
>Could you try with just one deleted polygon first? Is it possible that 
>ArcGIS does some cleaning at the same time, and moves the shapes apart? 
>If that is the case, might increasing the snap= argument in poly2nb() 
>help?
>
>Incidentally, poly2nb() does take an object extending SpatialPolygons too, 
>so you can also do:
>
>x <- readShapePoly("x.shp")
>plot(x)
>x_nb <- poly2nb(x) # maybe increase snap=
>
>avoiding using Map and polylist objects. Then
>
>plot(x, border="grey")
>plot(x_nb, coordinates(x), pch=".")
>
>plots the neighbour graph on the tract boundaries.
>
>In the last resort, do the deletion in R:
>
>x <- readShapePoly("x.shp")
>keep <- x$attribute is useful, logical condition
>table(keep)
>plot(x, col=c("red", "green")[(keep+1)])
>x_subset <- x[keep,]
>writePolyShape(x_subset, fn="x_subset")
>
>or the equivalent readOGR() and writeOGR() functions in rgdal.
>
>Hope this helps,
>
>Roger
>
>  
>
>>Many thanks.
>>
>>Best,
>>Danlin
>>
>>___________________________________________
>>Danlin Yu, Ph.D.
>>Assistant Professor
>>Department of Earth & Environmental Studies
>>Montclair State University
>>Montclair, NJ, 07043
>>Tel: 973-655-4313
>>Fax: 973-655-4072
>>email: yud at mail.montclair.edu
>>
>>_______________________________________________
>>R-sig-Geo mailing list
>>R-sig-Geo at stat.math.ethz.ch
>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>    
>>
>
>  
>



From epistat at gmail.com  Fri Jun  1 07:36:06 2007
From: epistat at gmail.com (zhijie zhang)
Date: Fri, 1 Jun 2007 13:36:06 +0800
Subject: [R-sig-Geo] How should i change the shaplefile of a polygon to be
	used as a window in ppp function of spatstat?
Message-ID: <2fc17e30705312236n6f6258e9re5e052e456807130@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070601/09570a76/attachment.pl>

From Roger.Bivand at nhh.no  Fri Jun  1 09:26:39 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 1 Jun 2007 09:26:39 +0200 (CEST)
Subject: [R-sig-Geo] How should i change the shaplefile of a polygon to
 be used as a window in ppp function of spatstat?
In-Reply-To: <2fc17e30705312236n6f6258e9re5e052e456807130@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0706010920550.24583-100000@reclus.nhh.no>

On Fri, 1 Jun 2007, zhijie zhang wrote:

> Dear friends,
>   I have a polygon, which is the shapefile format. I want to use it as the
> window of points in ppp(x,y,window) of spatstat package, how should i do?
> The following programs can't work,:
> a<-readShapePoly("d:/deleting/a/a.shp")  # read the boundary data
> a2<-Polygon(coordinates(a), hole=as.logical(NA))
> ppp(x,y,a2)

Using the shapefile shipped with maptools:

library(maptools)
library(spatstat)
xx <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1])
xx1 <- xx[1,] # and taking just the first county
plot(xx1)
W <- as(as(xx1, "SpatialPolygons"), "owin")
plot(W)
points(rpoispp(1000, win=W))

(This for:

other attached packages:
spatstat     mgcv maptools  foreign       sp 
"1.11-5" "1.3-24" "0.6-12" "0.8-20" "0.9-13") 

Hope this helps,

Roger


>  THANKS.
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Jan.Verbesselt at csiro.au  Fri Jun  1 10:02:34 2007
From: Jan.Verbesselt at csiro.au (Jan.Verbesselt at csiro.au)
Date: Fri, 1 Jun 2007 18:02:34 +1000
Subject: [R-sig-Geo] Optimize image plot of a grid with legend - colors -
	and extras ?
References: <Pine.LNX.4.44.0705312119230.23714-100000@reclus.nhh.no>
Message-ID: <0393960FC6AFA142B0234E5CC8DA3B0C3FE29C@exnswn2-syd.nexus.csiro.au>

Thanks Roger,

It's all working now ; I plotted a shape file on top of a spatial grid
image via the following script. Only, when you change the colors of the
image() the axis colors also change. I couldn't solve this and tried
several options (par, axis(), etc), but nothing worked.

I also used image.plot() of the fields library to add a legend to the
image.

Does somebody has some advise how to optimize these type of spatial
image -grid plots with a legend, colors, and other extra's? 

All examples are welcome,
Cheers and thanks,
Jan


# combining the  usual image function and adding a legend
# first change margin for some more room
nr <- 100
ramp <- colorRamp(c("blue", "green"))
kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
par( mar=c(5,5,5,8), col.axis =1)
image(GRID, col=kleur, axes=T)
plot(shape,add =TRUE , border = "red", axes=F, las=1)
image.plot( zlim=c(min(data["ndvi"]),max(data["ndvi"])),
nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
box()



From Roger.Bivand at nhh.no  Fri Jun  1 11:00:58 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 1 Jun 2007 11:00:58 +0200 (CEST)
Subject: [R-sig-Geo] Optimize image plot of a grid with legend - colors
 - and extras ?
In-Reply-To: <0393960FC6AFA142B0234E5CC8DA3B0C3FE29C@exnswn2-syd.nexus.csiro.au>
Message-ID: <Pine.LNX.4.44.0706011058220.24583-100000@reclus.nhh.no>

On Fri, 1 Jun 2007 Jan.Verbesselt at csiro.au wrote:

> Thanks Roger,
> 
> It's all working now ; I plotted a shape file on top of a spatial grid
> image via the following script. Only, when you change the colors of the
> image() the axis colors also change. I couldn't solve this and tried
> several options (par, axis(), etc), but nothing worked.

In order to find this out, please provide an example with the meuse.grid 
dataset shipped with sp, and for the shape, the meuse.riv river contour. 
It may be that the col= argument is being passed through by accident to 
plot.Spatial(), but without a reproducible example, it is difficult to 
say.

Roger

> 
> I also used image.plot() of the fields library to add a legend to the
> image.
> 
> Does somebody has some advise how to optimize these type of spatial
> image -grid plots with a legend, colors, and other extra's? 
> 
> All examples are welcome,
> Cheers and thanks,
> Jan
> 
> 
> # combining the  usual image function and adding a legend
> # first change margin for some more room
> nr <- 100
> ramp <- colorRamp(c("blue", "green"))
> kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
> par( mar=c(5,5,5,8), col.axis =1)
> image(GRID, col=kleur, axes=T)
> plot(shape,add =TRUE , border = "red", axes=F, las=1)
> image.plot( zlim=c(min(data["ndvi"]),max(data["ndvi"])),
> nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
> box()
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From epistat at gmail.com  Fri Jun  1 13:56:09 2007
From: epistat at gmail.com (zhijie zhang)
Date: Fri, 1 Jun 2007 19:56:09 +0800
Subject: [R-sig-Geo] How should i change the shaplefile of a polygon to
	be used as a window in ppp function of spatstat?--still wrong?
Message-ID: <2fc17e30706010456h81daa05mb8e737f4a3f13bac@mail.gmail.com>

Dear Prof .Roger,
  There is still a little problem with your method, the following are the
programs:

a<-readShapePoly("d:/deleting/a/guichi2.shp")
W <-as(as(a, "SpatialPolygons"), "owin")  # polygons window
plot(W)

cases<-coordinates(readShapePoints('d:/deleting/a/cases.shp'))  #points
cases<-data.frame(cases)
names(cases)<-c("x","y")
cases[1:2,]

plot(W)
points(cases$x,cases$y)  #no errors,83 points were inside the window

W<-as.owin(W)
points<-ppp(cases$x,cases$y,win=W)  *#????????????
**#error*:83 points were rejected as lying outside the specified window in:
ppp(cases$x, cases$y, win = W)
*In fact,* 83 points were inside the specified window,what's wrong?
(This packages:
spatstat     mgcv maptools  foreign       sp
"1.11-6" "1.3-24" "0.6-12" "0.8-20" "0.9-13")
 BTW, i put the data in the attachment so that you can check it.
Thanks.

On 6/1/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
> On Fri, 1 Jun 2007, zhijie zhang wrote:
>
> > Dear friends,
> >   I have a polygon, which is the shapefile format. I want to use it as
> the
> > window of points in ppp(x,y,window) of spatstat package, how should i
> do?
> > The following programs can't work,:
> > a<-readShapePoly("d:/deleting/a/a.shp")  # read the boundary data
> > a2<-Polygon(coordinates(a), hole=as.logical(NA))
> > ppp(x,y,a2)
>
> Using the shapefile shipped with maptools:
>
> library(maptools)
> library(spatstat)
> xx <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1])
> xx1 <- xx[1,] # and taking just the first county
> plot(xx1)
> W <- as(as(xx1, "SpatialPolygons"), "owin")
> plot(W)
> points(rpoispp(1000, win=W))
>
> (This for:
>
> other attached packages:
> spatstat     mgcv maptools  foreign       sp
> "1.11-5" "1.3-24" "0.6-12" "0.8-20" "0.9-13")
>
> Hope this helps,
>
> Roger
>
>
> >  THANKS.
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


-- 
With Kind Regards,

oooO:::::::::
(..):::::::::
:\.(:::Oooo::
::\_)::(..)::
:::::::)./:::
::::::(_/::::
:::::::::::::
[***********************************************************************]
Zhi Jie,Zhang ,PHD
Tel:86-21-54237149
Dept. of Epidemiology,School of Public Health,Fudan University
Address:No. 138 Yi Xue Yuan Road,Shanghai,China
Postcode:200032
Email:epistat at gmail.com
Website: www.statABC.com
[***********************************************************************]
oooO:::::::::
(..):::::::::
:\.(:::Oooo::
::\_)::(..)::
:::::::)./:::
::::::(_/::::
:::::::::::::
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070601/b64f58b6/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: data.rar
Type: application/octet-stream
Size: 13328 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070601/b64f58b6/attachment.obj>

From Roger.Bivand at nhh.no  Fri Jun  1 15:23:48 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 1 Jun 2007 15:23:48 +0200 (CEST)
Subject: [R-sig-Geo] How should i change the shaplefile of a polygon to
 be used as a window in ppp function of spatstat?--still wrong?
In-Reply-To: <2fc17e30706010456h81daa05mb8e737f4a3f13bac@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0706011520030.24583-100000@reclus.nhh.no>

On Fri, 1 Jun 2007, zhijie zhang wrote:

> Dear Prof .Roger,
>   There is still a little problem with your method, the following are the
> programs:

Thanks for attaching a small data file, makes it easier to give advice.

> 
> a<-readShapePoly("d:/deleting/a/guichi2.shp")
> W <-as(as(a, "SpatialPolygons"), "owin")  # polygons window
> plot(W)
> 
> cases<-coordinates(readShapePoints('d:/deleting/a/cases.shp'))  #points
> cases<-data.frame(cases)
> names(cases)<-c("x","y")
> cases[1:2,]
> 
> plot(W)
> points(cases$x,cases$y)  #no errors,83 points were inside the window
> 
> W<-as.owin(W)
> points<-ppp(cases$x,cases$y,win=W)  *#????????????
> **#error*:83 points were rejected as lying outside the specified window in:
> ppp(cases$x, cases$y, win = W)

In this case, the argument in the call to ppp() must be given by its full 
name:

library(maptools)
library(spstat)
library(spatstat)
a <- readShapePoly("guichi2.shp")
W <- as(as(a, "SpatialPolygons"), "owin")
cases <- coordinates(readShapePoints("cases.shp"))
cases
colnames(cases)<-c("x","y")
p2 <- ppp(cases[,1], cases[,2], window=W)
plot(p2)
points(cases, pch=3)

works, as does:

p1 <- as.ppp(cases, W=W)
plot(p1)
points(cases, pch=3)

Naming the argument "win" after the "..." was not being seen as a partial 
match of window, but being passed out in the "..." list.

Roger



> *In fact,* 83 points were inside the specified window,what's wrong?
> (This packages:
> spatstat     mgcv maptools  foreign       sp
> "1.11-6" "1.3-24" "0.6-12" "0.8-20" "0.9-13")
>  BTW, i put the data in the attachment so that you can check it.
> Thanks.
> 
> On 6/1/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> > On Fri, 1 Jun 2007, zhijie zhang wrote:
> >
> > > Dear friends,
> > >   I have a polygon, which is the shapefile format. I want to use it as
> > the
> > > window of points in ppp(x,y,window) of spatstat package, how should i
> > do?
> > > The following programs can't work,:
> > > a<-readShapePoly("d:/deleting/a/a.shp")  # read the boundary data
> > > a2<-Polygon(coordinates(a), hole=as.logical(NA))
> > > ppp(x,y,a2)
> >
> > Using the shapefile shipped with maptools:
> >
> > library(maptools)
> > library(spatstat)
> > xx <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1])
> > xx1 <- xx[1,] # and taking just the first county
> > plot(xx1)
> > W <- as(as(xx1, "SpatialPolygons"), "owin")
> > plot(W)
> > points(rpoispp(1000, win=W))
> >
> > (This for:
> >
> > other attached packages:
> > spatstat     mgcv maptools  foreign       sp
> > "1.11-5" "1.3-24" "0.6-12" "0.8-20" "0.9-13")
> >
> > Hope this helps,
> >
> > Roger
> >
> >
> > >  THANKS.
> > >
> >
> > --
> > Roger Bivand
> > Economic Geography Section, Department of Economics, Norwegian School of
> > Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> > Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> > e-mail: Roger.Bivand at nhh.no
> >
> >
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From albrecht.gebhardt at uni-klu.ac.at  Fri Jun  1 16:31:40 2007
From: albrecht.gebhardt at uni-klu.ac.at (Albrecht Gebhardt)
Date: Fri, 01 Jun 2007 16:31:40 +0200
Subject: [R-sig-Geo] statGIS 2007
Message-ID: <46602DCC.9090600@uni-klu.ac.at>

This is to announce the statGIS 2007 conference which will be held at

  University of Klagenfurt, Austria
  September 24-26, 2007.


It is the 3rd conference in the statGIS series on the topic

  Interfacing Spatial Statistics and GIS

Sections:

  * Theory and Methods

  * Spatial Statistics Software

  * Interfacing Spatial Statistics and GIS

  * Applications including
     + Environment and Ecology
     + Epidemiology and Public Health
     + Econometrics
     + Others (Telecommunications, Imaging, Brain Imaging, ...)

Abstracts on the above topics are welcome. Papers will be published in
special conference proceedings.

Important dates:

Deadline for Abstract Submission:      01-08-2007
Notification of Acceptance:            15-08-2007
Start of statGIS Conference 2007:      24-09-2007
End of statGIS Conference 2007:        26-09-2007


Contact: statgis07 at uni-klu.ac.at
Details: http://www.uni-klu.ac.at/statgis2007

On behalf of the organizing committee,

Juergen Pilz,
Albrecht Gebhardt,
Gunter Spoeck



From syasar at hurriyet.com.tr  Fri Jun  1 16:49:54 2007
From: syasar at hurriyet.com.tr (Youtube)
Date: Fri, 1 Jun 2007 17:49:54 +0300
Subject: [R-sig-Geo] The best you tube video
Message-ID: <90284862912ef09e47cf971f2c1f897f@hurriyet.com.tr>

http://yenibiris.sendeyolla.com/medyadetay.aspx?&tid=3&cid=57&id=61365



From loecher at eden.rutgers.edu  Fri Jun  1 20:56:27 2007
From: loecher at eden.rutgers.edu (Markus Loecher)
Date: Fri, 1 Jun 2007 14:56:27 -0400 (EDT)
Subject: [R-sig-Geo] flow visualization in lat/lon space
Message-ID: <31951563.184171180724178671.JavaMail.tomcat@rainier>

Dear list users,
has anyone experience in visualizing "flow" (e.g. with arrows or curvy lines) on maps ? For example, I would like to draw/visualize the major traffic flow patterns between counties in California.
There is a lot of flow visualziation software out there but none of them seem to create the "pictures" on true geographic maps.
(It would be really, really cool to modify kmloverlay to do this)

Thanks a lot,

Markus



From hardisty at psu.edu  Fri Jun  1 21:11:53 2007
From: hardisty at psu.edu (Frank Hardisty)
Date: Fri, 1 Jun 2007 15:11:53 -0400
Subject: [R-sig-Geo] flow visualization in lat/lon space
In-Reply-To: <s6603473.015@SUNNY.CSD.SC.EDU>
References: <s6603473.015@SUNNY.CSD.SC.EDU>
Message-ID: <f1498be70706011211n7394c7gb08186306bf8f811@mail.gmail.com>

Dear Markus and List,

The most interesting project I have seen along these lines is Doantam
Phan's flow map layout. It's in Java, however....

Link:
http://graphics.stanford.edu/~dphan/code/flowmap/

regards,
-Frank

On 6/1/07, Frank Hardisty <HardistF at gwm.sc.edu> wrote:
>
>
> ---------- Forwarded message ----------
> From: Markus Loecher <loecher at eden.rutgers.edu>
> To: r-sig-geo at stat.math.ethz.ch
> Date: Fri, 1 Jun 2007 14:56:27 -0400 (EDT)
> Subject: [R-sig-Geo] flow visualization in lat/lon space
> Dear list users,
> has anyone experience in visualizing "flow" (e.g. with arrows or curvy lines) on maps ? For example, I would like to draw/visualize the major traffic flow patterns between counties in California.
> There is a lot of flow visualziation software out there but none of them seem to create the "pictures" on true geographic maps.
> (It would be really, really cool to modify kmloverlay to do this)
>
> Thanks a lot,
>
> Markus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Frank Hardisty
hardisty at psu.edu

GeoVISTA Center
210 Walker Building

Dutton e-Education Institute
415 Earth and Engineering Sciences Building

814-867-1471
http://www.geovista.psu.edu/index.jsp



From Thomas.Adams at noaa.gov  Fri Jun  1 21:30:58 2007
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Fri, 01 Jun 2007 15:30:58 -0400
Subject: [R-sig-Geo] flow visualization in lat/lon space
In-Reply-To: <f1498be70706011211n7394c7gb08186306bf8f811@mail.gmail.com>
References: <s6603473.015@SUNNY.CSD.SC.EDU>
	<f1498be70706011211n7394c7gb08186306bf8f811@mail.gmail.com>
Message-ID: <466073F2.1060803@noaa.gov>

Markus,

It's *possible* something like the Grid Analysis and Display System 
(GrADS) (http://www.iges.org/grads/) could do the trick if you tweaked 
the data right ? but that may be too much of a chore. Look at the image 
here http://www.iges.org/grads/gadoc/tutorial.html down the page a bit.

Regards,
Tom

> Dear Markus and List,
>
> The most interesting project I have seen along these lines is Doantam
> Phan's flow map layout. It's in Java, however....
>
> Link:
> http://graphics.stanford.edu/~dphan/code/flowmap/
>
> regards,
> -Frank
>
> On 6/1/07, Frank Hardisty <HardistF at gwm.sc.edu> wrote:
>   
>> ---------- Forwarded message ----------
>> From: Markus Loecher <loecher at eden.rutgers.edu>
>> To: r-sig-geo at stat.math.ethz.ch
>> Date: Fri, 1 Jun 2007 14:56:27 -0400 (EDT)
>> Subject: [R-sig-Geo] flow visualization in lat/lon space
>> Dear list users,
>> has anyone experience in visualizing "flow" (e.g. with arrows or curvy lines) on maps ? For example, I would like to draw/visualize the major traffic flow patterns between counties in California.
>> There is a lot of flow visualziation software out there but none of them seem to create the "pictures" on true geographic maps.
>> (It would be really, really cool to modify kmloverlay to do this)
>>
>> Thanks a lot,
>>
>> Markus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>     
>
>
>   


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033



From neteler at itc.it  Fri Jun  1 22:31:43 2007
From: neteler at itc.it (Markus Neteler)
Date: Fri, 1 Jun 2007 22:31:43 +0200
Subject: [R-sig-Geo] flow visualization in lat/lon space
In-Reply-To: <466073F2.1060803@noaa.gov>
References: <s6603473.015@SUNNY.CSD.SC.EDU>
	<f1498be70706011211n7394c7gb08186306bf8f811@mail.gmail.com>
	<466073F2.1060803@noaa.gov>
Message-ID: <20070601203142.GB6252@bartok.itc.it>

Hi,

I got cc'ed on this and can suggest to use GRASS 6 for this:
It's a GIS and supports vector network analysis, linear
reference system and more. I have put online a slide
of our MITRIS traffic project, done in GRASS:

http://mpa.itc.it/markus/grass63/traffic/trafficmap_grass6.png
(note that forward and backward travel direction are
 treated separately!)

Vector maps you can export as SHAPE or KML.

Regards,
Markus

PS: For flows on raster maps, see for an example
    http://grass.itc.it/grass63/screenshots/raster.php

On Fri, Jun 01, 2007 at 03:30:58PM -0400, Thomas Adams wrote:
>  Markus,
> 
>  It's *possible* something like the Grid Analysis and Display System (GrADS) 
>  (http://www.iges.org/grads/) could do the trick if you tweaked the data 
>  right ? but that may be too much of a chore. Look at the image here 
>  http://www.iges.org/grads/gadoc/tutorial.html down the page a bit.
> 
>  Regards,
>  Tom
> 
> > Dear Markus and List,
> >
> > The most interesting project I have seen along these lines is Doantam
> > Phan's flow map layout. It's in Java, however....
> >
> > Link:
> > http://graphics.stanford.edu/~dphan/code/flowmap/
> >
> > regards,
> > -Frank
> >
> > On 6/1/07, Frank Hardisty <HardistF at gwm.sc.edu> wrote:
> >   
> >> ---------- Forwarded message ----------
> >> From: Markus Loecher <loecher at eden.rutgers.edu>
> >> To: r-sig-geo at stat.math.ethz.ch
> >> Date: Fri, 1 Jun 2007 14:56:27 -0400 (EDT)
> >> Subject: [R-sig-Geo] flow visualization in lat/lon space
> >> Dear list users,
> >> has anyone experience in visualizing "flow" (e.g. with arrows or curvy 
> >> lines) on maps ? For example, I would like to draw/visualize the major 
> >> traffic flow patterns between counties in California.
> >> There is a lot of flow visualziation software out there but none of them 
> >> seem to create the "pictures" on true geographic maps.
> >> (It would be really, really cool to modify kmloverlay to do this)
> >>
> >> Thanks a lot,
> >>
> >> Markus
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
>  -- 
>  Thomas E Adams
>  National Weather Service
>  Ohio River Forecast Center
>  1901 South State Route 134
>  Wilmington, OH 45177
> 
>  EMAIL:	thomas.adams at noaa.gov
> 
>  VOICE:	937-383-0528
>  FAX:	937-383-0033
> 

------------------
ITC -> dall'1 marzo 2007 Fondazione Bruno Kessler
ITC -> since 1 March 2007 Fondazione Bruno Kessler



From andrew.niccolai at yale.edu  Fri Jun  1 23:07:21 2007
From: andrew.niccolai at yale.edu (Andrew Niccolai)
Date: Fri, 1 Jun 2007 17:07:21 -0400
Subject: [R-sig-Geo] Clipping a large image without reading in the entire
	image
In-Reply-To: <Pine.LNX.4.44.0706011520030.24583-100000@reclus.nhh.no>
References: <2fc17e30706010456h81daa05mb8e737f4a3f13bac@mail.gmail.com>
	<Pine.LNX.4.44.0706011520030.24583-100000@reclus.nhh.no>
Message-ID: <000001c7a490$d8bab8b0$0302a8c0@D3K86YB1>

Greetings Spatial R users/developers,

I was curious as to whether or not it would be possible to describe a
bounding box for a large image so that what is read into R would be just the
contents of the image inside the bounding box.  Conceptually, it would be
akin to "clipping" the image but without the image read into the program.
My issue is that I have a very large 3-band orthophoto of several hundreds
of hectares of forest (roughly 8MB image).  I am running an analysis of
LIDAR data that requires the user to select a smaller area of a highly
degraded lidar image.  I would like the bounding box of this LIDAR area to
be used to "clip" a georegistered orthophoto that complements the LIDAR
data.  However, the complete ortho image seems to crash my WindowsXP, R
v2.4.1 setup. When I take the bounding box coordinates into ERDAS Imagine
and subset the orthophoto the following code works fine to bring it into R:

## Read in Tif file
setwd(anypathway)
tif.image <- "Pre_Subset_Image.tif"
LIDAR.tif <- GDAL.open(tif.image)
dim(LIDAR.tif)
image(LIDAR.tif[,,1])

## This converts the rgdal class to an SpatialGridDataFrame class
LIDAR.tif.1 <- LIDAR.tif[,]
bbox(LIDAR.tif.1)
image(LIDAR.tif.1,main="")
mtext("Orthophoto of Preloaded Fusion Example", side=3, line = 3, font=3,
cex=1.25)


However, this would be impractical with the code that I am building to jump
out of R and subset images in Imagine (plus very expensive for the end
user).  Therefore, does anyone have any solutions for reading in an image
that would work in theory like the following:

setwd(anypathway)
tif.image <- "VERY_LARGE_IMAGE.tif"
Bounded.tif <- GDAL.open(tif.image, bbox=c(UpL.X, LwR.X, UpL.Y, LwR.Y))

By the way, I am not set on GDAL.open as the solution but it seems to work
well reading in Tifs & Jpegs.

Again, thanks in advance


Andrew Niccolai
Doctoral Candidate
Yale School of Forestry



From tkeitt at gmail.com  Sat Jun  2 00:02:43 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Fri, 1 Jun 2007 17:02:43 -0500
Subject: [R-sig-Geo] Clipping a large image without reading in the
	entire image
In-Reply-To: <000001c7a490$d8bab8b0$0302a8c0@D3K86YB1>
References: <2fc17e30706010456h81daa05mb8e737f4a3f13bac@mail.gmail.com>
	<Pine.LNX.4.44.0706011520030.24583-100000@reclus.nhh.no>
	<000001c7a490$d8bab8b0$0302a8c0@D3K86YB1>
Message-ID: <6262c54c0706011502p7562c506w19c5473fdd649087@mail.gmail.com>

The getRasterData command in rgdal will return a subset of the image
given an rgdal object handle. I believe you can now also use simple
array [] operations as well.

THK

On 6/1/07, Andrew Niccolai <andrew.niccolai at yale.edu> wrote:
> Greetings Spatial R users/developers,
>
> I was curious as to whether or not it would be possible to describe a
> bounding box for a large image so that what is read into R would be just the
> contents of the image inside the bounding box.  Conceptually, it would be
> akin to "clipping" the image but without the image read into the program.
> My issue is that I have a very large 3-band orthophoto of several hundreds
> of hectares of forest (roughly 8MB image).  I am running an analysis of
> LIDAR data that requires the user to select a smaller area of a highly
> degraded lidar image.  I would like the bounding box of this LIDAR area to
> be used to "clip" a georegistered orthophoto that complements the LIDAR
> data.  However, the complete ortho image seems to crash my WindowsXP, R
> v2.4.1 setup. When I take the bounding box coordinates into ERDAS Imagine
> and subset the orthophoto the following code works fine to bring it into R:
>
> ## Read in Tif file
> setwd(anypathway)
> tif.image <- "Pre_Subset_Image.tif"
> LIDAR.tif <- GDAL.open(tif.image)
> dim(LIDAR.tif)
> image(LIDAR.tif[,,1])
>
> ## This converts the rgdal class to an SpatialGridDataFrame class
> LIDAR.tif.1 <- LIDAR.tif[,]
> bbox(LIDAR.tif.1)
> image(LIDAR.tif.1,main="")
> mtext("Orthophoto of Preloaded Fusion Example", side=3, line = 3, font=3,
> cex=1.25)
>
>
> However, this would be impractical with the code that I am building to jump
> out of R and subset images in Imagine (plus very expensive for the end
> user).  Therefore, does anyone have any solutions for reading in an image
> that would work in theory like the following:
>
> setwd(anypathway)
> tif.image <- "VERY_LARGE_IMAGE.tif"
> Bounded.tif <- GDAL.open(tif.image, bbox=c(UpL.X, LwR.X, UpL.Y, LwR.Y))
>
> By the way, I am not set on GDAL.open as the solution but it seems to work
> well reading in Tifs & Jpegs.
>
> Again, thanks in advance
>
>
> Andrew Niccolai
> Doctoral Candidate
> Yale School of Forestry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From Roger.Bivand at nhh.no  Sat Jun  2 13:40:44 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 2 Jun 2007 13:40:44 +0200 (CEST)
Subject: [R-sig-Geo] Clipping a large image without reading in the
	entire image
In-Reply-To: <000001c7a490$d8bab8b0$0302a8c0@D3K86YB1>
Message-ID: <Pine.LNX.4.44.0706021322530.25450-100000@reclus.nhh.no>

On Fri, 1 Jun 2007, Andrew Niccolai wrote:

> Greetings Spatial R users/developers,
> 
> I was curious as to whether or not it would be possible to describe a
> bounding box for a large image so that what is read into R would be just the
> contents of the image inside the bounding box.  Conceptually, it would be
> akin to "clipping" the image but without the image read into the program.
> My issue is that I have a very large 3-band orthophoto of several hundreds
> of hectares of forest (roughly 8MB image).  I am running an analysis of
> LIDAR data that requires the user to select a smaller area of a highly
> degraded lidar image.  I would like the bounding box of this LIDAR area to
> be used to "clip" a georegistered orthophoto that complements the LIDAR
> data.  However, the complete ortho image seems to crash my WindowsXP, R
> v2.4.1 setup. When I take the bounding box coordinates into ERDAS Imagine
> and subset the orthophoto the following code works fine to bring it into R:
> 
> ## Read in Tif file
> setwd(anypathway)
> tif.image <- "Pre_Subset_Image.tif"
> LIDAR.tif <- GDAL.open(tif.image)
> dim(LIDAR.tif)
> image(LIDAR.tif[,,1])

Have you looked at all of the arguments to the various rgdal functions? 
Here you are using the "[" method for GDALReadOnlyDataset objects, but

?"[,GDALReadOnlyDataset-method"

says

?getRasterData

which gives as mich detail in subsetting as is available in GDAL itself,
including: band = NULL, offset = c(0, 0), region.dim = dim(dataset),
output.dim = region.dim, interleave = c(0, 0). In your case offset= and 
region.dim= should do the trick. My reading of the code of the "[" method 
is that it will take these arguments and pass them through, so:

LIDAR.tif[,,1, offset=c(0,0), region.dim=c(50,50)]

should pick a 50x50 tile starting at (0,0), typically NW corner. This is 
how I understand Tim Keitt's reply.

Roger

> 
> ## This converts the rgdal class to an SpatialGridDataFrame class
> LIDAR.tif.1 <- LIDAR.tif[,]
> bbox(LIDAR.tif.1)
> image(LIDAR.tif.1,main="")
> mtext("Orthophoto of Preloaded Fusion Example", side=3, line = 3, font=3,
> cex=1.25)
> 
> 
> However, this would be impractical with the code that I am building to jump
> out of R and subset images in Imagine (plus very expensive for the end
> user).  Therefore, does anyone have any solutions for reading in an image
> that would work in theory like the following:
> 
> setwd(anypathway)
> tif.image <- "VERY_LARGE_IMAGE.tif"
> Bounded.tif <- GDAL.open(tif.image, bbox=c(UpL.X, LwR.X, UpL.Y, LwR.Y))
> 
> By the way, I am not set on GDAL.open as the solution but it seems to work
> well reading in Tifs & Jpegs.
> 
> Again, thanks in advance
> 
> 
> Andrew Niccolai
> Doctoral Candidate
> Yale School of Forestry
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Sat Jun  2 14:30:11 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Sat, 02 Jun 2007 14:30:11 +0200
Subject: [R-sig-Geo] Clipping a large image without reading in the
 entire image
In-Reply-To: <000001c7a490$d8bab8b0$0302a8c0@D3K86YB1>
References: <2fc17e30706010456h81daa05mb8e737f4a3f13bac@mail.gmail.com>	<Pine.LNX.4.44.0706011520030.24583-100000@reclus.nhh.no>
	<000001c7a490$d8bab8b0$0302a8c0@D3K86YB1>
Message-ID: <466162D3.1080904@geo.uu.nl>

Andrew Niccolai wrote:

>  Therefore, does anyone have any solutions for reading in an image
>that would work in theory like the following:
>
>setwd(anypathway)
>tif.image <- "VERY_LARGE_IMAGE.tif"
>Bounded.tif <- GDAL.open(tif.image, bbox=c(UpL.X, LwR.X, UpL.Y, LwR.Y))
>
>By the way, I am not set on GDAL.open as the solution but it seems to work
>well reading in Tifs & Jpegs.
>  
>
Well, it does seem to do what you want: opening the data set without 
completely reading it.

You may also want to have a look at the arguments of ?readGDAL, which 
opens/reads/closes in one step, optionally only part (section or lower 
resolution version) of the image.
--
Edzer



From e.pebesma at geo.uu.nl  Sat Jun  2 16:28:20 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Sat, 02 Jun 2007 16:28:20 +0200
Subject: [R-sig-Geo] [R] Connecting to PostgreSQL/PostGIS from R (rgdal?)
In-Reply-To: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no>
Message-ID: <46617E84.6050904@geo.uu.nl>

Mike, my experience with linking R with PostGIS are documented here:

http://wiki.intamap.org/index.php/PostGIS

which I may have mentioned before on r-sig-geo.

Indeed, as Tim confirms, besides the (r)gdal link, (R)ODBC is another 
working link for transferring table information. I doubt whether it will 
be easy to transport e.g. line or polygon topology through this link.
--
Edzer


>
>  
>
>>I apologize if I come accross as somewhat naive in this - I certainly am
>>still a novice when it come to the use of R.  Also, I apologize for the
>>longish email that follows, but if you're interested in what I'm trying
>>to do, this is the clearest explanation I have off the top of my head:
>>
>>My needs are that I'm working on a .Net gui which displays map data
>>using the C# MapScript library for MapServer, and manipulates/analyzes
>>spatial data (generally just points for now, but this might change in
>>the future) stored in a PostgreSQL/PostGIS database.  Roger, I think
>>you'll recall asking me about this tool, for which I had a poster up at
>>the OSGeo conference in Lausanne last year.  Lately, I've been trying to
>>port it to Gtk# so that it will work on both Linux and Windows, and so
>>far it seems to be working.  However, if I add any real functionality to
>>it in the future, I'd like to find a better way to link PostgreSQL with
>>the functionality of R.
>>
>>In this tool, I had started to use R as I feel it's better suited to do
>>some of the more complicated processing - though so far this is limited
>>to creating voronoi polygons, for which the deldir library in R worked
>>very well.  To make this happen, I used system process objects in
>>Mono/.Net to control the R commandline.  The issue I faced here is that
>>the only way I could get the data into R from PostgreSQL (without
>>requiring 'a priori' setup on the client machine of something like an
>>ODBC driver with the RODBC librar) was to dump the data to a temporary
>>text file, import it into R, process it in R, dump it back into text
>>formatted for SQL, then execute the SQL to input the data into PostgreSQL.
>>
>>This overall process would be much more efficient if I could find a more
>>integrated way of transferring data between R/PostgreSQL - right now my
>>.Net application primarily processes data within PostgreSQL itself, but
>>integration with R would make a great deal of sense for me, as its
>>primary purpose is to calculate spatial statistics.
>>
>>However, my ideal solution would be to have a package of binaries that
>>are self sufficient, so I can give someone the compiled binaries on a CD
>>for example, and that person could use it on a Windows machine with no
>>initial setup, or he/she could use it on a Linux machine where
>>installation of the necessary prequisites is either already done, or
>>fairly easy (at least from my experience with Fedora so far, using the
>>standard repositories).  At the moment, the only missing piece here is
>>the link between R and PostgreSQL.
>>
>>Maybe there is a way I can accomplish this with RODBC that I'm unaware
>>of...but as as I understand it, this requires a Windows user to install
>>the PostgreSQL ODBC driver first, then create a DSN to each database
>>that is used in PostgreSQL.  If I'm wrong about any of this, I
>>apologize, and I'd be happy to be corrected.  Every once in a while I
>>take a look around online to see if anything new has been released
>>(e.g., a win32 port of pl/r, or some easy-to-use solution for connecting
>>to PgSQL from within R).  It seems like rgdal might be a sort-of
>>solution, at least for spatail data - except that I'm somewhat inept at
>>compiling it cleanly (I did get it working, and it seems okay, but it's
>>not packaged properly - I'm sure of that).  Even so, it doesn't seem to
>>have an option for linking to non-spatial data (at least, from what I've
>>been able to figure out from experimentation and documentation), which
>>would be pretty useful as well.
>>
>>If either of you have any additional suggestions, I'd be glad to hear them.
>>
>>Sorry again for such a long email.
>>
>>Regards,
>>Mike
>>
>>Roger Bivand wrote:
>>    
>>
>>>On Thu, 31 May 2007, Prof Brian Ripley wrote:
>>>
>>>      
>>>
>>>>Roger,
>>>>
>>>>I see that on Linux I have an ODBC driver.  That should not introduce 
>>>>further dependencies on Windows, and might be useful.
>>>>
>>>>OTOH, I do think RODBC is the answer to the underlying question.  It works 
>>>>well with PostgreSQL on Windows, and abstracts out the pesky differences 
>>>>between PostgreSQL clients in different versions (as the ODBC driver is 
>>>>part of PostgreSQL).
>>>>        
>>>>
>>>Brian,
>>>
>>>Thanks, of course there are better routes than rgdal/PostGIS when the data 
>>>are not geometries. But because PostGIS stores its representations in 
>>>specific ways, both the PostgreSQL and GDAL/OGR sides need access to the 
>>>PostGIS library to unpick the parts of the lines and polygons involved. 
>>>Edzer has had some success with this on Linux, as far as I understand to 
>>>insert results from R into a PostGIS/PostgreSQL database, I think being 
>>>read by MapServer for HTTP delivery. 
>>>
>>>I'm not sure what Mike's specific needs are - if aspatial or simple point
>>>coordinates, it ought to be possible to avoid the intermediate data layer,
>>>unless something "on the other side" needs it. With line or polygon 
>>>geometries, some intermediate layer is needed, and that's where the 
>>>dependencies come from. 
>>>
>>>The FWTools Windows binaries for rgdal built against HDF4 seem to work,
>>>against its NetCDF which crashes R (I think this is one of Frank
>>>Warmerdam's DLLs doing stdcall, and another not doing it). The user
>>>workaround in that case was to use your ncdf binary, which was feasible
>>>for raster data. 
>>>
>>>FWTools is advertised as aiming: "to track the latested development
>>>versions of the packages included as opposed to official releases. While
>>>this may mean the packages are less stable, it is intended to give folks a
>>>chance to use the latest and greatest". Having talked to the OSGeo
>>>developers, it seems that their "user" is a system integrator of some
>>>kind, setting up a production system for a larger organisation in-house or
>>>more broadly. This doesn't match too well with the R "user" profile, 
>>>particularly in a one-off research setting.
>>>
>>>Roger
>>>
>>>      
>>>
>>>>Brian
>>>>
>>>>
>>>>On Wed, 30 May 2007, Roger Bivand wrote:
>>>>
>>>>        
>>>>
>>>>>On Wed, 30 May 2007, Mike Leahy wrote:
>>>>>
>>>>>          
>>>>>
>>>>>>Hello,
>>>>>>
>>>>>>I've been trying every now and then to find a cross operating system
>>>>>>solution that would let me access PostgreSQL (and PostGIS) from R, or to
>>>>>>access R from PostgreSQL.  I know of pl/r, which accomplishes the
>>>>>>latter, but has yet to be successfully ported to Windows.  Similarly,
>>>>>>I've tried to use Rdbi and DBI, but I haven't had luck with those on
>>>>>>Windows either for connecting to PostgreSQL from R.  Can anyone suggest
>>>>>>a solution for this?
>>>>>>
>>>>>>It would seem that rgdal could also help me in this case. Unfortunately,
>>>>>>the version of the GDAL library that is included in the rdgal binary
>>>>>>available on CRAN (for windows) doesn't include the PostgreSQL driver
>>>>>>for OGR (i.e., it's not listed by the ogrDrivers() function).
>>>>>>
>>>>>>I compiled rgdal on Windows myself using the GDAL library from
>>>>>>FWTools-1.3.1, but I was unsuccessful at creating a proper binary
>>>>>>package for R.  I was only able to get it to work by substituting the
>>>>>>rgdal.dll that was installed by CRAN with the one that I compiled that
>>>>>>links against the GDAL library from FWTools.  Even though it works (at
>>>>>>first glance with ogrInfo(), and readOGR()), I still get a warning
>>>>>>message when I load the libary: "DLL attempted to change FPU control
>>>>>>word from 8001f to 9001f".
>>>>>>
>>>>>>So my question with respect to rgdal is a) is it likely that an rgdal
>>>>>>package is going to be released in the future with the PostgreSQL driver
>>>>>>included in GDAL/OGR, or b) are there any suggestions/instructions that
>>>>>>might get me through the compilation and packaging process for rgdal
>>>>>>with better success?
>>>>>>            
>>>>>>
>>>>>The warning is harmless - R is just reporting that it has stopped the
>>>>>dynamically linked libraries resetting a flag that they should not change
>>>>>while R is running. If you followed the notes in README.windows in rgdal,
>>>>>you ought to be OK. There are no plans to provide more Windows binary
>>>>>drivers than those present now, because the others involve further
>>>>>external dependencies, which most users would not welcome.
>>>>>
>>>>>So please try to do an ogrinfo at the command line in Windows using
>>>>>FWTools to your PostGIS data, and then the equivalent within R with your
>>>>>locally built rgdal, and see how it goes. Even on Linux, getting all the
>>>>>components lined up isn't easy, according to people who have tried, but
>>>>>can be done if you need to do it.
>>>>>
>>>>>Hope this helps,
>>>>>
>>>>>Roger
>>>>>
>>>>>          
>>>>>
>>>>>>Thanks in advance for any help,
>>>>>>Mike
>>>>>>
>>>>>>_______________________________________________
>>>>>>R-sig-Geo mailing list
>>>>>>R-sig-Geo at stat.math.ethz.ch
>>>>>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>>            
>>>>>>
>>    
>>
>
>  
>



From tkeitt at gmail.com  Sat Jun  2 19:47:21 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 2 Jun 2007 12:47:21 -0500
Subject: [R-sig-Geo] [R] Connecting to PostgreSQL/PostGIS from R (rgdal?)
In-Reply-To: <46617E84.6050904@geo.uu.nl>
References: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no>
	<46617E84.6050904@geo.uu.nl>
Message-ID: <6262c54c0706021047v17fb6ec8v384a836b604f90dd@mail.gmail.com>

My Rdbi (+Rdbi.PgSQL) package was written to be much simpler and
easier to use than either DBI or RODBC. Unfortunately, I do not have
time to maintain it, so I'm not sure what state it is in. Either DBI
or RODBC should work fine for pushing tables back and forth. RODBC is
probably the most up-to-date and might be the best long term solution.
(DBI is the most complete I think in terms of a full blown db API.)

For pushing geometries into PostGIS, I invariably use the shp2pgsql
utility as it seems to give the best results. You could easily dump
our Spatial*DataFrame to a file and shell out to run shp2pgsql. Not
elegant but would work. (Wish I had time to finish low-level OGR
coverage in rgdal...)

Edzer's approach is one I've suggested on many occasions -- that we
subclass the sp classes to act as a proxy to a PostGIS table. I first
developed that approach in rpgsql -- you could create proxy data
frames that simply forwarded access requests to PostgreSQL (I think
the idea has now been applied to SQLite tables). The problem of course
is that R does not support polymorphism "below the surface" in the C
level implementation, so once a proxy object is passed to R's
internals, it is nothing more than a pointer with no call interface.

THK

On 6/2/07, Edzer J. Pebesma <e.pebesma at geo.uu.nl> wrote:
> Mike, my experience with linking R with PostGIS are documented here:
>
> http://wiki.intamap.org/index.php/PostGIS
>
> which I may have mentioned before on r-sig-geo.
>
> Indeed, as Tim confirms, besides the (r)gdal link, (R)ODBC is another
> working link for transferring table information. I doubt whether it will
> be easy to transport e.g. line or polygon topology through this link.
> --
> Edzer
>
>
> >
> >
> >
> >>I apologize if I come accross as somewhat naive in this - I certainly am
> >>still a novice when it come to the use of R.  Also, I apologize for the
> >>longish email that follows, but if you're interested in what I'm trying
> >>to do, this is the clearest explanation I have off the top of my head:
> >>
> >>My needs are that I'm working on a .Net gui which displays map data
> >>using the C# MapScript library for MapServer, and manipulates/analyzes
> >>spatial data (generally just points for now, but this might change in
> >>the future) stored in a PostgreSQL/PostGIS database.  Roger, I think
> >>you'll recall asking me about this tool, for which I had a poster up at
> >>the OSGeo conference in Lausanne last year.  Lately, I've been trying to
> >>port it to Gtk# so that it will work on both Linux and Windows, and so
> >>far it seems to be working.  However, if I add any real functionality to
> >>it in the future, I'd like to find a better way to link PostgreSQL with
> >>the functionality of R.
> >>
> >>In this tool, I had started to use R as I feel it's better suited to do
> >>some of the more complicated processing - though so far this is limited
> >>to creating voronoi polygons, for which the deldir library in R worked
> >>very well.  To make this happen, I used system process objects in
> >>Mono/.Net to control the R commandline.  The issue I faced here is that
> >>the only way I could get the data into R from PostgreSQL (without
> >>requiring 'a priori' setup on the client machine of something like an
> >>ODBC driver with the RODBC librar) was to dump the data to a temporary
> >>text file, import it into R, process it in R, dump it back into text
> >>formatted for SQL, then execute the SQL to input the data into PostgreSQL.
> >>
> >>This overall process would be much more efficient if I could find a more
> >>integrated way of transferring data between R/PostgreSQL - right now my
> >>.Net application primarily processes data within PostgreSQL itself, but
> >>integration with R would make a great deal of sense for me, as its
> >>primary purpose is to calculate spatial statistics.
> >>
> >>However, my ideal solution would be to have a package of binaries that
> >>are self sufficient, so I can give someone the compiled binaries on a CD
> >>for example, and that person could use it on a Windows machine with no
> >>initial setup, or he/she could use it on a Linux machine where
> >>installation of the necessary prequisites is either already done, or
> >>fairly easy (at least from my experience with Fedora so far, using the
> >>standard repositories).  At the moment, the only missing piece here is
> >>the link between R and PostgreSQL.
> >>
> >>Maybe there is a way I can accomplish this with RODBC that I'm unaware
> >>of...but as as I understand it, this requires a Windows user to install
> >>the PostgreSQL ODBC driver first, then create a DSN to each database
> >>that is used in PostgreSQL.  If I'm wrong about any of this, I
> >>apologize, and I'd be happy to be corrected.  Every once in a while I
> >>take a look around online to see if anything new has been released
> >>(e.g., a win32 port of pl/r, or some easy-to-use solution for connecting
> >>to PgSQL from within R).  It seems like rgdal might be a sort-of
> >>solution, at least for spatail data - except that I'm somewhat inept at
> >>compiling it cleanly (I did get it working, and it seems okay, but it's
> >>not packaged properly - I'm sure of that).  Even so, it doesn't seem to
> >>have an option for linking to non-spatial data (at least, from what I've
> >>been able to figure out from experimentation and documentation), which
> >>would be pretty useful as well.
> >>
> >>If either of you have any additional suggestions, I'd be glad to hear them.
> >>
> >>Sorry again for such a long email.
> >>
> >>Regards,
> >>Mike
> >>
> >>Roger Bivand wrote:
> >>
> >>
> >>>On Thu, 31 May 2007, Prof Brian Ripley wrote:
> >>>
> >>>
> >>>
> >>>>Roger,
> >>>>
> >>>>I see that on Linux I have an ODBC driver.  That should not introduce
> >>>>further dependencies on Windows, and might be useful.
> >>>>
> >>>>OTOH, I do think RODBC is the answer to the underlying question.  It works
> >>>>well with PostgreSQL on Windows, and abstracts out the pesky differences
> >>>>between PostgreSQL clients in different versions (as the ODBC driver is
> >>>>part of PostgreSQL).
> >>>>
> >>>>
> >>>Brian,
> >>>
> >>>Thanks, of course there are better routes than rgdal/PostGIS when the data
> >>>are not geometries. But because PostGIS stores its representations in
> >>>specific ways, both the PostgreSQL and GDAL/OGR sides need access to the
> >>>PostGIS library to unpick the parts of the lines and polygons involved.
> >>>Edzer has had some success with this on Linux, as far as I understand to
> >>>insert results from R into a PostGIS/PostgreSQL database, I think being
> >>>read by MapServer for HTTP delivery.
> >>>
> >>>I'm not sure what Mike's specific needs are - if aspatial or simple point
> >>>coordinates, it ought to be possible to avoid the intermediate data layer,
> >>>unless something "on the other side" needs it. With line or polygon
> >>>geometries, some intermediate layer is needed, and that's where the
> >>>dependencies come from.
> >>>
> >>>The FWTools Windows binaries for rgdal built against HDF4 seem to work,
> >>>against its NetCDF which crashes R (I think this is one of Frank
> >>>Warmerdam's DLLs doing stdcall, and another not doing it). The user
> >>>workaround in that case was to use your ncdf binary, which was feasible
> >>>for raster data.
> >>>
> >>>FWTools is advertised as aiming: "to track the latested development
> >>>versions of the packages included as opposed to official releases. While
> >>>this may mean the packages are less stable, it is intended to give folks a
> >>>chance to use the latest and greatest". Having talked to the OSGeo
> >>>developers, it seems that their "user" is a system integrator of some
> >>>kind, setting up a production system for a larger organisation in-house or
> >>>more broadly. This doesn't match too well with the R "user" profile,
> >>>particularly in a one-off research setting.
> >>>
> >>>Roger
> >>>
> >>>
> >>>
> >>>>Brian
> >>>>
> >>>>
> >>>>On Wed, 30 May 2007, Roger Bivand wrote:
> >>>>
> >>>>
> >>>>
> >>>>>On Wed, 30 May 2007, Mike Leahy wrote:
> >>>>>
> >>>>>
> >>>>>
> >>>>>>Hello,
> >>>>>>
> >>>>>>I've been trying every now and then to find a cross operating system
> >>>>>>solution that would let me access PostgreSQL (and PostGIS) from R, or to
> >>>>>>access R from PostgreSQL.  I know of pl/r, which accomplishes the
> >>>>>>latter, but has yet to be successfully ported to Windows.  Similarly,
> >>>>>>I've tried to use Rdbi and DBI, but I haven't had luck with those on
> >>>>>>Windows either for connecting to PostgreSQL from R.  Can anyone suggest
> >>>>>>a solution for this?
> >>>>>>
> >>>>>>It would seem that rgdal could also help me in this case. Unfortunately,
> >>>>>>the version of the GDAL library that is included in the rdgal binary
> >>>>>>available on CRAN (for windows) doesn't include the PostgreSQL driver
> >>>>>>for OGR (i.e., it's not listed by the ogrDrivers() function).
> >>>>>>
> >>>>>>I compiled rgdal on Windows myself using the GDAL library from
> >>>>>>FWTools-1.3.1, but I was unsuccessful at creating a proper binary
> >>>>>>package for R.  I was only able to get it to work by substituting the
> >>>>>>rgdal.dll that was installed by CRAN with the one that I compiled that
> >>>>>>links against the GDAL library from FWTools.  Even though it works (at
> >>>>>>first glance with ogrInfo(), and readOGR()), I still get a warning
> >>>>>>message when I load the libary: "DLL attempted to change FPU control
> >>>>>>word from 8001f to 9001f".
> >>>>>>
> >>>>>>So my question with respect to rgdal is a) is it likely that an rgdal
> >>>>>>package is going to be released in the future with the PostgreSQL driver
> >>>>>>included in GDAL/OGR, or b) are there any suggestions/instructions that
> >>>>>>might get me through the compilation and packaging process for rgdal
> >>>>>>with better success?
> >>>>>>
> >>>>>>
> >>>>>The warning is harmless - R is just reporting that it has stopped the
> >>>>>dynamically linked libraries resetting a flag that they should not change
> >>>>>while R is running. If you followed the notes in README.windows in rgdal,
> >>>>>you ought to be OK. There are no plans to provide more Windows binary
> >>>>>drivers than those present now, because the others involve further
> >>>>>external dependencies, which most users would not welcome.
> >>>>>
> >>>>>So please try to do an ogrinfo at the command line in Windows using
> >>>>>FWTools to your PostGIS data, and then the equivalent within R with your
> >>>>>locally built rgdal, and see how it goes. Even on Linux, getting all the
> >>>>>components lined up isn't easy, according to people who have tried, but
> >>>>>can be done if you need to do it.
> >>>>>
> >>>>>Hope this helps,
> >>>>>
> >>>>>Roger
> >>>>>
> >>>>>
> >>>>>
> >>>>>>Thanks in advance for any help,
> >>>>>>Mike
> >>>>>>
> >>>>>>_______________________________________________
> >>>>>>R-sig-Geo mailing list
> >>>>>>R-sig-Geo at stat.math.ethz.ch
> >>>>>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>>>
> >>>>>>
> >>>>>>
> >>
> >>
> >
> >
> >
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From ripley at stats.ox.ac.uk  Sat Jun  2 20:08:59 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 2 Jun 2007 19:08:59 +0100 (BST)
Subject: [R-sig-Geo] [R-sig-DB] [R] Connecting to PostgreSQL/PostGIS
 from R (rgdal?)
In-Reply-To: <6262c54c0706021047v17fb6ec8v384a836b604f90dd@mail.gmail.com>
References: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no>
	<46617E84.6050904@geo.uu.nl>
	<6262c54c0706021047v17fb6ec8v384a836b604f90dd@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706021901480.8291@gannet.stats.ox.ac.uk>

On Sat, 2 Jun 2007, Tim Keitt wrote:

> My Rdbi (+Rdbi.PgSQL) package was written to be much simpler and
> easier to use than either DBI or RODBC. Unfortunately, I do not have
> time to maintain it, so I'm not sure what state it is in. Either DBI
> or RODBC should work fine for pushing tables back and forth. RODBC is
> probably the most up-to-date and might be the best long term solution.
> (DBI is the most complete I think in terms of a full blown db API.)

There are quite a few 'db API' features in RODBC that are not in DBI.

> For pushing geometries into PostGIS, I invariably use the shp2pgsql
> utility as it seems to give the best results. You could easily dump
> our Spatial*DataFrame to a file and shell out to run shp2pgsql. Not
> elegant but would work. (Wish I had time to finish low-level OGR
> coverage in rgdal...)
>
> Edzer's approach is one I've suggested on many occasions -- that we
> subclass the sp classes to act as a proxy to a PostGIS table. I first
> developed that approach in rpgsql -- you could create proxy data
> frames that simply forwarded access requests to PostgreSQL (I think
> the idea has now been applied to SQLite tables). The problem of course
> is that R does not support polymorphism "below the surface" in the C
> level implementation, so once a proxy object is passed to R's
> internals, it is nothing more than a pointer with no call interface.

I really don't think that is true, and indeed polymorphism is almost 
entirely implemented at C level.  A visible R object and a SEXP are one 
and the same thing.

>
> THK
>
> On 6/2/07, Edzer J. Pebesma <e.pebesma at geo.uu.nl> wrote:
>> Mike, my experience with linking R with PostGIS are documented here:
>>
>> http://wiki.intamap.org/index.php/PostGIS
>>
>> which I may have mentioned before on r-sig-geo.
>>
>> Indeed, as Tim confirms, besides the (r)gdal link, (R)ODBC is another
>> working link for transferring table information. I doubt whether it will
>> be easy to transport e.g. line or polygon topology through this link.
>> --
>> Edzer
>>
>>
>>>
>>>
>>>
>>>> I apologize if I come accross as somewhat naive in this - I certainly am
>>>> still a novice when it come to the use of R.  Also, I apologize for the
>>>> longish email that follows, but if you're interested in what I'm trying
>>>> to do, this is the clearest explanation I have off the top of my head:
>>>>
>>>> My needs are that I'm working on a .Net gui which displays map data
>>>> using the C# MapScript library for MapServer, and manipulates/analyzes
>>>> spatial data (generally just points for now, but this might change in
>>>> the future) stored in a PostgreSQL/PostGIS database.  Roger, I think
>>>> you'll recall asking me about this tool, for which I had a poster up at
>>>> the OSGeo conference in Lausanne last year.  Lately, I've been trying to
>>>> port it to Gtk# so that it will work on both Linux and Windows, and so
>>>> far it seems to be working.  However, if I add any real functionality to
>>>> it in the future, I'd like to find a better way to link PostgreSQL with
>>>> the functionality of R.
>>>>
>>>> In this tool, I had started to use R as I feel it's better suited to do
>>>> some of the more complicated processing - though so far this is limited
>>>> to creating voronoi polygons, for which the deldir library in R worked
>>>> very well.  To make this happen, I used system process objects in
>>>> Mono/.Net to control the R commandline.  The issue I faced here is that
>>>> the only way I could get the data into R from PostgreSQL (without
>>>> requiring 'a priori' setup on the client machine of something like an
>>>> ODBC driver with the RODBC librar) was to dump the data to a temporary
>>>> text file, import it into R, process it in R, dump it back into text
>>>> formatted for SQL, then execute the SQL to input the data into PostgreSQL.
>>>>
>>>> This overall process would be much more efficient if I could find a more
>>>> integrated way of transferring data between R/PostgreSQL - right now my
>>>> .Net application primarily processes data within PostgreSQL itself, but
>>>> integration with R would make a great deal of sense for me, as its
>>>> primary purpose is to calculate spatial statistics.
>>>>
>>>> However, my ideal solution would be to have a package of binaries that
>>>> are self sufficient, so I can give someone the compiled binaries on a CD
>>>> for example, and that person could use it on a Windows machine with no
>>>> initial setup, or he/she could use it on a Linux machine where
>>>> installation of the necessary prequisites is either already done, or
>>>> fairly easy (at least from my experience with Fedora so far, using the
>>>> standard repositories).  At the moment, the only missing piece here is
>>>> the link between R and PostgreSQL.
>>>>
>>>> Maybe there is a way I can accomplish this with RODBC that I'm unaware
>>>> of...but as as I understand it, this requires a Windows user to install
>>>> the PostgreSQL ODBC driver first, then create a DSN to each database
>>>> that is used in PostgreSQL.  If I'm wrong about any of this, I
>>>> apologize, and I'd be happy to be corrected.  Every once in a while I
>>>> take a look around online to see if anything new has been released
>>>> (e.g., a win32 port of pl/r, or some easy-to-use solution for connecting
>>>> to PgSQL from within R).  It seems like rgdal might be a sort-of
>>>> solution, at least for spatail data - except that I'm somewhat inept at
>>>> compiling it cleanly (I did get it working, and it seems okay, but it's
>>>> not packaged properly - I'm sure of that).  Even so, it doesn't seem to
>>>> have an option for linking to non-spatial data (at least, from what I've
>>>> been able to figure out from experimentation and documentation), which
>>>> would be pretty useful as well.
>>>>
>>>> If either of you have any additional suggestions, I'd be glad to hear them.
>>>>
>>>> Sorry again for such a long email.
>>>>
>>>> Regards,
>>>> Mike
>>>>
>>>> Roger Bivand wrote:
>>>>
>>>>
>>>>> On Thu, 31 May 2007, Prof Brian Ripley wrote:
>>>>>
>>>>>
>>>>>
>>>>>> Roger,
>>>>>>
>>>>>> I see that on Linux I have an ODBC driver.  That should not introduce
>>>>>> further dependencies on Windows, and might be useful.
>>>>>>
>>>>>> OTOH, I do think RODBC is the answer to the underlying question.  It works
>>>>>> well with PostgreSQL on Windows, and abstracts out the pesky differences
>>>>>> between PostgreSQL clients in different versions (as the ODBC driver is
>>>>>> part of PostgreSQL).
>>>>>>
>>>>>>
>>>>> Brian,
>>>>>
>>>>> Thanks, of course there are better routes than rgdal/PostGIS when the data
>>>>> are not geometries. But because PostGIS stores its representations in
>>>>> specific ways, both the PostgreSQL and GDAL/OGR sides need access to the
>>>>> PostGIS library to unpick the parts of the lines and polygons involved.
>>>>> Edzer has had some success with this on Linux, as far as I understand to
>>>>> insert results from R into a PostGIS/PostgreSQL database, I think being
>>>>> read by MapServer for HTTP delivery.
>>>>>
>>>>> I'm not sure what Mike's specific needs are - if aspatial or simple point
>>>>> coordinates, it ought to be possible to avoid the intermediate data layer,
>>>>> unless something "on the other side" needs it. With line or polygon
>>>>> geometries, some intermediate layer is needed, and that's where the
>>>>> dependencies come from.
>>>>>
>>>>> The FWTools Windows binaries for rgdal built against HDF4 seem to work,
>>>>> against its NetCDF which crashes R (I think this is one of Frank
>>>>> Warmerdam's DLLs doing stdcall, and another not doing it). The user
>>>>> workaround in that case was to use your ncdf binary, which was feasible
>>>>> for raster data.
>>>>>
>>>>> FWTools is advertised as aiming: "to track the latested development
>>>>> versions of the packages included as opposed to official releases. While
>>>>> this may mean the packages are less stable, it is intended to give folks a
>>>>> chance to use the latest and greatest". Having talked to the OSGeo
>>>>> developers, it seems that their "user" is a system integrator of some
>>>>> kind, setting up a production system for a larger organisation in-house or
>>>>> more broadly. This doesn't match too well with the R "user" profile,
>>>>> particularly in a one-off research setting.
>>>>>
>>>>> Roger
>>>>>
>>>>>
>>>>>
>>>>>> Brian
>>>>>>
>>>>>>
>>>>>> On Wed, 30 May 2007, Roger Bivand wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>> On Wed, 30 May 2007, Mike Leahy wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>> Hello,
>>>>>>>>
>>>>>>>> I've been trying every now and then to find a cross operating system
>>>>>>>> solution that would let me access PostgreSQL (and PostGIS) from R, or to
>>>>>>>> access R from PostgreSQL.  I know of pl/r, which accomplishes the
>>>>>>>> latter, but has yet to be successfully ported to Windows.  Similarly,
>>>>>>>> I've tried to use Rdbi and DBI, but I haven't had luck with those on
>>>>>>>> Windows either for connecting to PostgreSQL from R.  Can anyone suggest
>>>>>>>> a solution for this?
>>>>>>>>
>>>>>>>> It would seem that rgdal could also help me in this case. Unfortunately,
>>>>>>>> the version of the GDAL library that is included in the rdgal binary
>>>>>>>> available on CRAN (for windows) doesn't include the PostgreSQL driver
>>>>>>>> for OGR (i.e., it's not listed by the ogrDrivers() function).
>>>>>>>>
>>>>>>>> I compiled rgdal on Windows myself using the GDAL library from
>>>>>>>> FWTools-1.3.1, but I was unsuccessful at creating a proper binary
>>>>>>>> package for R.  I was only able to get it to work by substituting the
>>>>>>>> rgdal.dll that was installed by CRAN with the one that I compiled that
>>>>>>>> links against the GDAL library from FWTools.  Even though it works (at
>>>>>>>> first glance with ogrInfo(), and readOGR()), I still get a warning
>>>>>>>> message when I load the libary: "DLL attempted to change FPU control
>>>>>>>> word from 8001f to 9001f".
>>>>>>>>
>>>>>>>> So my question with respect to rgdal is a) is it likely that an rgdal
>>>>>>>> package is going to be released in the future with the PostgreSQL driver
>>>>>>>> included in GDAL/OGR, or b) are there any suggestions/instructions that
>>>>>>>> might get me through the compilation and packaging process for rgdal
>>>>>>>> with better success?
>>>>>>>>
>>>>>>>>
>>>>>>> The warning is harmless - R is just reporting that it has stopped the
>>>>>>> dynamically linked libraries resetting a flag that they should not change
>>>>>>> while R is running. If you followed the notes in README.windows in rgdal,
>>>>>>> you ought to be OK. There are no plans to provide more Windows binary
>>>>>>> drivers than those present now, because the others involve further
>>>>>>> external dependencies, which most users would not welcome.
>>>>>>>
>>>>>>> So please try to do an ogrinfo at the command line in Windows using
>>>>>>> FWTools to your PostGIS data, and then the equivalent within R with your
>>>>>>> locally built rgdal, and see how it goes. Even on Linux, getting all the
>>>>>>> components lined up isn't easy, according to people who have tried, but
>>>>>>> can be done if you need to do it.
>>>>>>>
>>>>>>> Hope this helps,
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>> Thanks in advance for any help,
>>>>>>>> Mike
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>
>>>>
>>>
>>>
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From tkeitt at gmail.com  Sat Jun  2 20:30:21 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 2 Jun 2007 13:30:21 -0500
Subject: [R-sig-Geo] [R-sig-DB] [R] Connecting to PostgreSQL/PostGIS
	from R (rgdal?)
In-Reply-To: <Pine.LNX.4.64.0706021901480.8291@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no>
	<46617E84.6050904@geo.uu.nl>
	<6262c54c0706021047v17fb6ec8v384a836b604f90dd@mail.gmail.com>
	<Pine.LNX.4.64.0706021901480.8291@gannet.stats.ox.ac.uk>
Message-ID: <6262c54c0706021130k19b1360uc86ab616b5ef35@mail.gmail.com>

On 6/2/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Sat, 2 Jun 2007, Tim Keitt wrote:
>
> > My Rdbi (+Rdbi.PgSQL) package was written to be much simpler and
> > easier to use than either DBI or RODBC. Unfortunately, I do not have
> > time to maintain it, so I'm not sure what state it is in. Either DBI
> > or RODBC should work fine for pushing tables back and forth. RODBC is
> > probably the most up-to-date and might be the best long term solution.
> > (DBI is the most complete I think in terms of a full blown db API.)
>
> There are quite a few 'db API' features in RODBC that are not in DBI.

It does look good. I've started experimenting with it and I may switch
entirely to RODBC. (I'm once again needing to do some work with very
large datasets.)

>
> > For pushing geometries into PostGIS, I invariably use the shp2pgsql
> > utility as it seems to give the best results. You could easily dump
> > our Spatial*DataFrame to a file and shell out to run shp2pgsql. Not
> > elegant but would work. (Wish I had time to finish low-level OGR
> > coverage in rgdal...)
> >
> > Edzer's approach is one I've suggested on many occasions -- that we
> > subclass the sp classes to act as a proxy to a PostGIS table. I first
> > developed that approach in rpgsql -- you could create proxy data
> > frames that simply forwarded access requests to PostgreSQL (I think
> > the idea has now been applied to SQLite tables). The problem of course
> > is that R does not support polymorphism "below the surface" in the C
> > level implementation, so once a proxy object is passed to R's
> > internals, it is nothing more than a pointer with no call interface.
>
> I really don't think that is true, and indeed polymorphism is almost
> entirely implemented at C level.  A visible R object and a SEXP are one
> and the same thing.

I guess what I mean is that -- unless I'm mistaken -- I cannot
override the data access routines. Lets say I have a C function that
takes an SEXP as an argument and the function expects that SEXP to
point to a data frame. I cannot call the same C function on an SEXP
that points to a PostgreSQL proxy object because the C code will try
to dereference memory offset from the base of the data portion of the
SEXP. In the case of the db handle, there is no data in memory! Or is
there now a full C-level function call interface for manipulating data
frames (that can handle type dependent dispatch)? Cool if so -- its
been awhile since I looked.

(Just as an example think about what happens when the data in a matrix
is passed to BLAS routines and what would happen if you tried to pass
the db handle to BLAS.)

THK

>
> >
> > THK
> >
> > On 6/2/07, Edzer J. Pebesma <e.pebesma at geo.uu.nl> wrote:
> >> Mike, my experience with linking R with PostGIS are documented here:
> >>
> >> http://wiki.intamap.org/index.php/PostGIS
> >>
> >> which I may have mentioned before on r-sig-geo.
> >>
> >> Indeed, as Tim confirms, besides the (r)gdal link, (R)ODBC is another
> >> working link for transferring table information. I doubt whether it will
> >> be easy to transport e.g. line or polygon topology through this link.
> >> --
> >> Edzer
> >>
> >>
> >>>
> >>>
> >>>
> >>>> I apologize if I come accross as somewhat naive in this - I certainly am
> >>>> still a novice when it come to the use of R.  Also, I apologize for the
> >>>> longish email that follows, but if you're interested in what I'm trying
> >>>> to do, this is the clearest explanation I have off the top of my head:
> >>>>
> >>>> My needs are that I'm working on a .Net gui which displays map data
> >>>> using the C# MapScript library for MapServer, and manipulates/analyzes
> >>>> spatial data (generally just points for now, but this might change in
> >>>> the future) stored in a PostgreSQL/PostGIS database.  Roger, I think
> >>>> you'll recall asking me about this tool, for which I had a poster up at
> >>>> the OSGeo conference in Lausanne last year.  Lately, I've been trying to
> >>>> port it to Gtk# so that it will work on both Linux and Windows, and so
> >>>> far it seems to be working.  However, if I add any real functionality to
> >>>> it in the future, I'd like to find a better way to link PostgreSQL with
> >>>> the functionality of R.
> >>>>
> >>>> In this tool, I had started to use R as I feel it's better suited to do
> >>>> some of the more complicated processing - though so far this is limited
> >>>> to creating voronoi polygons, for which the deldir library in R worked
> >>>> very well.  To make this happen, I used system process objects in
> >>>> Mono/.Net to control the R commandline.  The issue I faced here is that
> >>>> the only way I could get the data into R from PostgreSQL (without
> >>>> requiring 'a priori' setup on the client machine of something like an
> >>>> ODBC driver with the RODBC librar) was to dump the data to a temporary
> >>>> text file, import it into R, process it in R, dump it back into text
> >>>> formatted for SQL, then execute the SQL to input the data into PostgreSQL.
> >>>>
> >>>> This overall process would be much more efficient if I could find a more
> >>>> integrated way of transferring data between R/PostgreSQL - right now my
> >>>> .Net application primarily processes data within PostgreSQL itself, but
> >>>> integration with R would make a great deal of sense for me, as its
> >>>> primary purpose is to calculate spatial statistics.
> >>>>
> >>>> However, my ideal solution would be to have a package of binaries that
> >>>> are self sufficient, so I can give someone the compiled binaries on a CD
> >>>> for example, and that person could use it on a Windows machine with no
> >>>> initial setup, or he/she could use it on a Linux machine where
> >>>> installation of the necessary prequisites is either already done, or
> >>>> fairly easy (at least from my experience with Fedora so far, using the
> >>>> standard repositories).  At the moment, the only missing piece here is
> >>>> the link between R and PostgreSQL.
> >>>>
> >>>> Maybe there is a way I can accomplish this with RODBC that I'm unaware
> >>>> of...but as as I understand it, this requires a Windows user to install
> >>>> the PostgreSQL ODBC driver first, then create a DSN to each database
> >>>> that is used in PostgreSQL.  If I'm wrong about any of this, I
> >>>> apologize, and I'd be happy to be corrected.  Every once in a while I
> >>>> take a look around online to see if anything new has been released
> >>>> (e.g., a win32 port of pl/r, or some easy-to-use solution for connecting
> >>>> to PgSQL from within R).  It seems like rgdal might be a sort-of
> >>>> solution, at least for spatail data - except that I'm somewhat inept at
> >>>> compiling it cleanly (I did get it working, and it seems okay, but it's
> >>>> not packaged properly - I'm sure of that).  Even so, it doesn't seem to
> >>>> have an option for linking to non-spatial data (at least, from what I've
> >>>> been able to figure out from experimentation and documentation), which
> >>>> would be pretty useful as well.
> >>>>
> >>>> If either of you have any additional suggestions, I'd be glad to hear them.
> >>>>
> >>>> Sorry again for such a long email.
> >>>>
> >>>> Regards,
> >>>> Mike
> >>>>
> >>>> Roger Bivand wrote:
> >>>>
> >>>>
> >>>>> On Thu, 31 May 2007, Prof Brian Ripley wrote:
> >>>>>
> >>>>>
> >>>>>
> >>>>>> Roger,
> >>>>>>
> >>>>>> I see that on Linux I have an ODBC driver.  That should not introduce
> >>>>>> further dependencies on Windows, and might be useful.
> >>>>>>
> >>>>>> OTOH, I do think RODBC is the answer to the underlying question.  It works
> >>>>>> well with PostgreSQL on Windows, and abstracts out the pesky differences
> >>>>>> between PostgreSQL clients in different versions (as the ODBC driver is
> >>>>>> part of PostgreSQL).
> >>>>>>
> >>>>>>
> >>>>> Brian,
> >>>>>
> >>>>> Thanks, of course there are better routes than rgdal/PostGIS when the data
> >>>>> are not geometries. But because PostGIS stores its representations in
> >>>>> specific ways, both the PostgreSQL and GDAL/OGR sides need access to the
> >>>>> PostGIS library to unpick the parts of the lines and polygons involved.
> >>>>> Edzer has had some success with this on Linux, as far as I understand to
> >>>>> insert results from R into a PostGIS/PostgreSQL database, I think being
> >>>>> read by MapServer for HTTP delivery.
> >>>>>
> >>>>> I'm not sure what Mike's specific needs are - if aspatial or simple point
> >>>>> coordinates, it ought to be possible to avoid the intermediate data layer,
> >>>>> unless something "on the other side" needs it. With line or polygon
> >>>>> geometries, some intermediate layer is needed, and that's where the
> >>>>> dependencies come from.
> >>>>>
> >>>>> The FWTools Windows binaries for rgdal built against HDF4 seem to work,
> >>>>> against its NetCDF which crashes R (I think this is one of Frank
> >>>>> Warmerdam's DLLs doing stdcall, and another not doing it). The user
> >>>>> workaround in that case was to use your ncdf binary, which was feasible
> >>>>> for raster data.
> >>>>>
> >>>>> FWTools is advertised as aiming: "to track the latested development
> >>>>> versions of the packages included as opposed to official releases. While
> >>>>> this may mean the packages are less stable, it is intended to give folks a
> >>>>> chance to use the latest and greatest". Having talked to the OSGeo
> >>>>> developers, it seems that their "user" is a system integrator of some
> >>>>> kind, setting up a production system for a larger organisation in-house or
> >>>>> more broadly. This doesn't match too well with the R "user" profile,
> >>>>> particularly in a one-off research setting.
> >>>>>
> >>>>> Roger
> >>>>>
> >>>>>
> >>>>>
> >>>>>> Brian
> >>>>>>
> >>>>>>
> >>>>>> On Wed, 30 May 2007, Roger Bivand wrote:
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>> On Wed, 30 May 2007, Mike Leahy wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>> Hello,
> >>>>>>>>
> >>>>>>>> I've been trying every now and then to find a cross operating system
> >>>>>>>> solution that would let me access PostgreSQL (and PostGIS) from R, or to
> >>>>>>>> access R from PostgreSQL.  I know of pl/r, which accomplishes the
> >>>>>>>> latter, but has yet to be successfully ported to Windows.  Similarly,
> >>>>>>>> I've tried to use Rdbi and DBI, but I haven't had luck with those on
> >>>>>>>> Windows either for connecting to PostgreSQL from R.  Can anyone suggest
> >>>>>>>> a solution for this?
> >>>>>>>>
> >>>>>>>> It would seem that rgdal could also help me in this case. Unfortunately,
> >>>>>>>> the version of the GDAL library that is included in the rdgal binary
> >>>>>>>> available on CRAN (for windows) doesn't include the PostgreSQL driver
> >>>>>>>> for OGR (i.e., it's not listed by the ogrDrivers() function).
> >>>>>>>>
> >>>>>>>> I compiled rgdal on Windows myself using the GDAL library from
> >>>>>>>> FWTools-1.3.1, but I was unsuccessful at creating a proper binary
> >>>>>>>> package for R.  I was only able to get it to work by substituting the
> >>>>>>>> rgdal.dll that was installed by CRAN with the one that I compiled that
> >>>>>>>> links against the GDAL library from FWTools.  Even though it works (at
> >>>>>>>> first glance with ogrInfo(), and readOGR()), I still get a warning
> >>>>>>>> message when I load the libary: "DLL attempted to change FPU control
> >>>>>>>> word from 8001f to 9001f".
> >>>>>>>>
> >>>>>>>> So my question with respect to rgdal is a) is it likely that an rgdal
> >>>>>>>> package is going to be released in the future with the PostgreSQL driver
> >>>>>>>> included in GDAL/OGR, or b) are there any suggestions/instructions that
> >>>>>>>> might get me through the compilation and packaging process for rgdal
> >>>>>>>> with better success?
> >>>>>>>>
> >>>>>>>>
> >>>>>>> The warning is harmless - R is just reporting that it has stopped the
> >>>>>>> dynamically linked libraries resetting a flag that they should not change
> >>>>>>> while R is running. If you followed the notes in README.windows in rgdal,
> >>>>>>> you ought to be OK. There are no plans to provide more Windows binary
> >>>>>>> drivers than those present now, because the others involve further
> >>>>>>> external dependencies, which most users would not welcome.
> >>>>>>>
> >>>>>>> So please try to do an ogrinfo at the command line in Windows using
> >>>>>>> FWTools to your PostGIS data, and then the equivalent within R with your
> >>>>>>> locally built rgdal, and see how it goes. Even on Linux, getting all the
> >>>>>>> components lined up isn't easy, according to people who have tried, but
> >>>>>>> can be done if you need to do it.
> >>>>>>>
> >>>>>>> Hope this helps,
> >>>>>>>
> >>>>>>> Roger
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>> Thanks in advance for any help,
> >>>>>>>> Mike
> >>>>>>>>
> >>>>>>>> _______________________________________________
> >>>>>>>> R-sig-Geo mailing list
> >>>>>>>> R-sig-Geo at stat.math.ethz.ch
> >>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>
> >>>>
> >>>
> >>>
> >>>
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From edd at debian.org  Sat Jun  2 20:32:38 2007
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 2 Jun 2007 13:32:38 -0500
Subject: [R-sig-Geo] [R-sig-DB] [R] Connecting to PostgreSQL/PostGIS
 from R (rgdal?)
In-Reply-To: <Pine.LNX.4.64.0706021901480.8291@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no>
	<46617E84.6050904@geo.uu.nl>
	<6262c54c0706021047v17fb6ec8v384a836b604f90dd@mail.gmail.com>
	<Pine.LNX.4.64.0706021901480.8291@gannet.stats.ox.ac.uk>
Message-ID: <18017.47046.487119.452733@basebud.nulle.part>


Brian,

On 2 June 2007 at 19:08, Prof Brian Ripley wrote:
| There are quite a few 'db API' features in RODBC that are not in DBI.

Random idea of the day: Would it be wortwhile to re-think what the DBI API
should cover?  

These days, it may matter less to be R and S-Plus compatible [1] but e.g. to
me it matters whether I get niceties like POSIXct times in and out of
databases intact, and that doesn't seem be a concern per se for DBI.

A unified DBI interface is still the right idea, but I'd like to push the
feature set further. But then I know little about the gory details so feel
free to correct me.

Regards, Dirk

[1] (or, given who accrues benefits from this, we could make it Insightful's
concern to catch up)

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison



From ripley at stats.ox.ac.uk  Sat Jun  2 20:40:55 2007
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 2 Jun 2007 19:40:55 +0100 (BST)
Subject: [R-sig-Geo] [R-sig-DB] [R] Connecting to PostgreSQL/PostGIS
 from R (rgdal?)
In-Reply-To: <6262c54c0706021130k19b1360uc86ab616b5ef35@mail.gmail.com>
References: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no> 
	<46617E84.6050904@geo.uu.nl>
	<6262c54c0706021047v17fb6ec8v384a836b604f90dd@mail.gmail.com>
	<Pine.LNX.4.64.0706021901480.8291@gannet.stats.ox.ac.uk>
	<6262c54c0706021130k19b1360uc86ab616b5ef35@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706021931540.8291@gannet.stats.ox.ac.uk>

On Sat, 2 Jun 2007, Tim Keitt wrote:

> On 6/2/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On Sat, 2 Jun 2007, Tim Keitt wrote:

[...]

>> > Edzer's approach is one I've suggested on many occasions -- that we
>> > subclass the sp classes to act as a proxy to a PostGIS table. I first
>> > developed that approach in rpgsql -- you could create proxy data
>> > frames that simply forwarded access requests to PostgreSQL (I think
>> > the idea has now been applied to SQLite tables). The problem of course
>> > is that R does not support polymorphism "below the surface" in the C
>> > level implementation, so once a proxy object is passed to R's
>> > internals, it is nothing more than a pointer with no call interface.
>> 
>> I really don't think that is true, and indeed polymorphism is almost
>> entirely implemented at C level.  A visible R object and a SEXP are one
>> and the same thing.
>
> I guess what I mean is that -- unless I'm mistaken -- I cannot
> override the data access routines. Lets say I have a C function that
> takes an SEXP as an argument and the function expects that SEXP to
> point to a data frame. I cannot call the same C function on an SEXP
> that points to a PostgreSQL proxy object because the C code will try
> to dereference memory offset from the base of the data portion of the
> SEXP. In the case of the db handle, there is no data in memory! Or is
> there now a full C-level function call interface for manipulating data
> frames (that can handle type dependent dispatch)? Cool if so -- its
> been awhile since I looked.
>
> (Just as an example think about what happens when the data in a matrix
> is passed to BLAS routines and what would happen if you tried to pass
> the db handle to BLAS.)

But that is several layers deeper. In general one should check that your 
code points to the type of object you want, and dispatch if you want to be 
polymorphic.  Remember that in S/R it is functions (including operators) 
that are polymorphic, and for example the C-level versions of [, $, $<- 
... all are (and long have been).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595



From tkeitt at gmail.com  Sat Jun  2 21:02:10 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 2 Jun 2007 14:02:10 -0500
Subject: [R-sig-Geo] [R-sig-DB] [R] Connecting to PostgreSQL/PostGIS
	from R (rgdal?)
In-Reply-To: <Pine.LNX.4.64.0706021931540.8291@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no>
	<46617E84.6050904@geo.uu.nl>
	<6262c54c0706021047v17fb6ec8v384a836b604f90dd@mail.gmail.com>
	<Pine.LNX.4.64.0706021901480.8291@gannet.stats.ox.ac.uk>
	<6262c54c0706021130k19b1360uc86ab616b5ef35@mail.gmail.com>
	<Pine.LNX.4.64.0706021931540.8291@gannet.stats.ox.ac.uk>
Message-ID: <6262c54c0706021202p2927fa57mbdc39422664485f7@mail.gmail.com>

On 6/2/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Sat, 2 Jun 2007, Tim Keitt wrote:
>
> > On 6/2/07, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> >> On Sat, 2 Jun 2007, Tim Keitt wrote:
>
> [...]
>
> >> > Edzer's approach is one I've suggested on many occasions -- that we
> >> > subclass the sp classes to act as a proxy to a PostGIS table. I first
> >> > developed that approach in rpgsql -- you could create proxy data
> >> > frames that simply forwarded access requests to PostgreSQL (I think
> >> > the idea has now been applied to SQLite tables). The problem of course
> >> > is that R does not support polymorphism "below the surface" in the C
> >> > level implementation, so once a proxy object is passed to R's
> >> > internals, it is nothing more than a pointer with no call interface.
> >>
> >> I really don't think that is true, and indeed polymorphism is almost
> >> entirely implemented at C level.  A visible R object and a SEXP are one
> >> and the same thing.
> >
> > I guess what I mean is that -- unless I'm mistaken -- I cannot
> > override the data access routines. Lets say I have a C function that
> > takes an SEXP as an argument and the function expects that SEXP to
> > point to a data frame. I cannot call the same C function on an SEXP
> > that points to a PostgreSQL proxy object because the C code will try
> > to dereference memory offset from the base of the data portion of the
> > SEXP. In the case of the db handle, there is no data in memory! Or is
> > there now a full C-level function call interface for manipulating data
> > frames (that can handle type dependent dispatch)? Cool if so -- its
> > been awhile since I looked.
> >
> > (Just as an example think about what happens when the data in a matrix
> > is passed to BLAS routines and what would happen if you tried to pass
> > the db handle to BLAS.)
>
> But that is several layers deeper. In general one should check that your
> code points to the type of object you want, and dispatch if you want to be
> polymorphic.  Remember that in S/R it is functions (including operators)
> that are polymorphic, and for example the C-level versions of [, $, $<-
> ... all are (and long have been).

Right. Point well taken. However, in general R functions like "lm" (or
more precisely, the low level R functions called by "lm") do not use
those C-level functions but instead pass the SEXP through and assume
that the SEXP points to a block of allocated memory, not eg a database
handle. I had hoped at one point to make proxy data frames fully
substitutable for real data frames so they could be passed directly to
functions like "lm". It is possible as you point out, but would
require extensive rewriting of R's low level code to always call the
correct getter/setter functions for each object type.

THK

>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From lee.kitty at yahoo.com  Sat Jun  2 21:36:20 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Sat, 2 Jun 2007 12:36:20 -0700 (PDT)
Subject: [R-sig-Geo] Spatial simulation
Message-ID: <272543.83132.qm@web36306.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070602/a7058d44/attachment.pl>

From tgriffin at uaex.edu  Sat Jun  2 22:23:27 2007
From: tgriffin at uaex.edu (Terry Griffin)
Date: Sat, 02 Jun 2007 15:23:27 -0500
Subject: [R-sig-Geo] Spatial simulation
In-Reply-To: <272543.83132.qm@web36306.mail.mud.yahoo.com>
References: <272543.83132.qm@web36306.mail.mud.yahoo.com>
Message-ID: <46618AEB.CF06.00FB.0@uaex.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070602/f04c8030/attachment.pl>

From v.gomezrubio at imperial.ac.uk  Sun Jun  3 00:02:51 2007
From: v.gomezrubio at imperial.ac.uk (Virgilio Gomez-Rubio)
Date: Sat, 02 Jun 2007 23:02:51 +0100
Subject: [R-sig-Geo] Spatial simulation
In-Reply-To: <272543.83132.qm@web36306.mail.mud.yahoo.com>
References: <272543.83132.qm@web36306.mail.mud.yahoo.com>
Message-ID: <1180821771.14974.13.camel@fh-vrubio>

Dear Kitty,

What I usually do when I want to generate a spatially varying variable
is to generate some points at random in the study area and then do a
kernel smoothing on those points. The values of my variable at (x,y) are
the values of the kernel smoothing at that point.

Hope this helps.

Virgilio



From daj025 at gmail.com  Sun Jun  3 05:10:33 2007
From: daj025 at gmail.com (David James)
Date: Sat, 2 Jun 2007 23:10:33 -0400
Subject: [R-sig-Geo] [R-sig-DB] [R] Connecting to PostgreSQL/PostGIS
	from R (rgdal?)
In-Reply-To: <18017.47046.487119.452733@basebud.nulle.part>
References: <Pine.LNX.4.44.0705312217550.23714-100000@reclus.nhh.no>
	<46617E84.6050904@geo.uu.nl>
	<6262c54c0706021047v17fb6ec8v384a836b604f90dd@mail.gmail.com>
	<Pine.LNX.4.64.0706021901480.8291@gannet.stats.ox.ac.uk>
	<18017.47046.487119.452733@basebud.nulle.part>
Message-ID: <74c69e370706022010x112620edy2a132cbec02529f2@mail.gmail.com>

Dirk,

I agree that it would be worthwhile to re-visit what the DBI should
provide, and I
fully agree that R/S-Plus compatibility should not be a goal.   Let me
remind you
that the DBI at the time it was defined more than 5 years ago was not meant
to be a complete specification --  it  identified many features that
were yet to be formalized into the API (prepared statements, stored
procedures, asynchronous communications, transcations, etc.).   Some
of these features were later
added as extensions to packages (e.g., prepared statements in RSQLite by
Seth Falcon  and in ROracle by me) but it would be better to ensure a
common interface for these and other new features.

In terms of data mappings, date/time types are valid concerns, but so are
unsigned ints and longs, BLOBS, fixed decimals, money, points, etc.

Extending the feature set at this point seems to me like a good idea.

Regards,

--
David

On 6/2/07, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> Brian,
>
> On 2 June 2007 at 19:08, Prof Brian Ripley wrote:
> | There are quite a few 'db API' features in RODBC that are not in DBI.
>
> Random idea of the day: Would it be wortwhile to re-think what the DBI API
> should cover?
>
> These days, it may matter less to be R and S-Plus compatible [1] but e.g. to
> me it matters whether I get niceties like POSIXct times in and out of
> databases intact, and that doesn't seem be a concern per se for DBI.
>
> A unified DBI interface is still the right idea, but I'd like to push the
> feature set further. But then I know little about the gory details so feel
> free to correct me.
>
> Regards, Dirk
>
> [1] (or, given who accrues benefits from this, we could make it Insightful's
> concern to catch up)
>
> --
> Hell, there are no rules here - we're trying to accomplish something.
>                                                   -- Thomas A. Edison
>
> _______________________________________________
> R-sig-DB mailing list -- R Special Interest Group
> R-sig-DB at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-db
>



From Jan.Verbesselt at csiro.au  Mon Jun  4 06:30:00 2007
From: Jan.Verbesselt at csiro.au (Jan.Verbesselt at csiro.au)
Date: Mon, 4 Jun 2007 14:30:00 +1000
Subject: [R-sig-Geo] Optimize image plot of a grid with legend - colors
	- and extras ?
References: <Pine.LNX.4.44.0706011058220.24583-100000@reclus.nhh.no>
Message-ID: <0393960FC6AFA142B0234E5CC8DA3B0C3FE2A4@exnswn2-syd.nexus.csiro.au>

Hi Roger,

I made a reproducible example: When you change the colors of the spatial
image the colors of the axes also change. How could this be solved?

(How can a legend and scale be added to this plot?)

All other tips and tricks are mostly welcome,

Thanks a lot,
Jan

Ps. Great that this sp() package make spatial analysis and visualization
possible in R! - Does maptools package offer better or alternative
mapping functions? 

/***script***

library(fields)
library(sp)

data(meuse.grid)
coordinates(meuse.grid) = ~x+y
gridded(meuse.grid) = TRUE
data(meuse)
coordinates(meuse) = ~x+y
data(meuse.riv)
plot(meuse.riv)
meuse.sl = SpatialLines(list(Lines(list(Line(meuse.riv)))))

## image plot with points and lines
nr <- 200
ramp <- colorRamp(c("blue", "green"))
kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
par( mar=c(5,5,5,8))
input <- meuse.grid["dist"]
image(input, col=kleur, axes=T,main = "meuse river data set; colour
indicates distance to river", col.axis=1)
points(meuse, pch = 3)
plot(meuse.sl, add=T)
image.plot( zlim=c(min(input$dist),max(input$dist)),
nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)




-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Friday, 1 June 2007 7:01 PM
To: Verbesselt, Jan (Ensis, Clayton)
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: Optimize image plot of a grid with legend - colors - and
extras ?

On Fri, 1 Jun 2007 Jan.Verbesselt at csiro.au wrote:

> Thanks Roger,
> 
> It's all working now ; I plotted a shape file on top of a spatial grid
> image via the following script. Only, when you change the colors of
the
> image() the axis colors also change. I couldn't solve this and tried
> several options (par, axis(), etc), but nothing worked.

In order to find this out, please provide an example with the meuse.grid

dataset shipped with sp, and for the shape, the meuse.riv river contour.

It may be that the col= argument is being passed through by accident to 
plot.Spatial(), but without a reproducible example, it is difficult to 
say.

Roger

> 
> I also used image.plot() of the fields library to add a legend to the
> image.
> 
> Does somebody has some advise how to optimize these type of spatial
> image -grid plots with a legend, colors, and other extra's? 
> 
> All examples are welcome,
> Cheers and thanks,
> Jan
> 
> 
> # combining the  usual image function and adding a legend
> # first change margin for some more room
> nr <- 100
> ramp <- colorRamp(c("blue", "green"))
> kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
> par( mar=c(5,5,5,8), col.axis =1)
> image(GRID, col=kleur, axes=T)
> plot(shape,add =TRUE , border = "red", axes=F, las=1)
> image.plot( zlim=c(min(data["ndvi"]),max(data["ndvi"])),
> nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
> box()
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon Jun  4 09:05:10 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 4 Jun 2007 09:05:10 +0200 (CEST)
Subject: [R-sig-Geo] Optimize image plot of a grid with legend - colors
 - and extras ?
In-Reply-To: <0393960FC6AFA142B0234E5CC8DA3B0C3FE2A4@exnswn2-syd.nexus.csiro.au>
Message-ID: <Pine.LNX.4.44.0706040835070.31307-100000@reclus.nhh.no>

On Mon, 4 Jun 2007 Jan.Verbesselt at csiro.au wrote:

> Hi Roger,
> 
> I made a reproducible example: When you change the colors of the spatial
> image the colors of the axes also change. How could this be solved?

Because the col= argument is passed using the "..." mechanism, it is seen 
twice in the image() method (once to draw the axes, next to draw the 
image) unless add=TRUE. So:

plot(as(input, "Spatial"), axes=TRUE)
image(input, col=kleur, main = paste("meuse river data set;",
"colour indicates distance to river"), add=TRUE)

works. col.axis in par() only sets the colour of the axis annotation, and 
is not used here.

> 
> (How can a legend and scale be added to this plot?)
> 

In principle, the axes give the cardinal directions and the scale.  
Although this is cartographic heresy, I have not seen anyone with a ruler
using a scale on a computer display to read off distances, so that
inserting a scale is probably overkill, the same with the north arrow. It
can be done for presentation purposes, or if a reader demands it, but it
is redundant is axes=TRUE. If axes=FALSE, then hand construction with
lines() and text() (arrows() for N arrow) isn't hard.

The legend can be added as you suggest, or using a similar function in 
geoR. Both involve placing manually - which could be improved by using the 
placing names from legend(), but still give no guarantee that content will 
not be overpainted. Perhaps the function from geoR could be migrated to 
sp, since geoR now depends on sp.

> All other tips and tricks are mostly welcome,
> 
> Thanks a lot,
> Jan
> 
> Ps. Great that this sp() package make spatial analysis and visualization
> possible in R! - Does maptools package offer better or alternative
> mapping functions? 

The sp package provides classes and methods for Spatial*, maptools 
provides tools for simple import/export and interfaces to other R 
packages, rgdal more advanced import/export. None are designed to provide 
presentation cartographic output - they provide analytic graphics, and the 
functions to export the data if you need something more fancy. 

I find that users put far too much time into presentation, losing touch
with what the data are telling them. My understanding of data
visualisation is that communication depends on getting the important
things across, which are the data, and an unobtrusive support for position
(the real "map" is its representation inside the computer, not the
hardcopy output).

For example, informative setting of the class intervals is important - 
using the defaults in image() can be very deceptive.

Hope this helps,

Roger

> 
> /***script***
> 
> library(fields)
> library(sp)
> 
> data(meuse.grid)
> coordinates(meuse.grid) = ~x+y
> gridded(meuse.grid) = TRUE
> data(meuse)
> coordinates(meuse) = ~x+y
> data(meuse.riv)
> plot(meuse.riv)
> meuse.sl = SpatialLines(list(Lines(list(Line(meuse.riv)))))
> 
> ## image plot with points and lines
> nr <- 200
> ramp <- colorRamp(c("blue", "green"))
> kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
> par( mar=c(5,5,5,8))
> input <- meuse.grid["dist"]
> image(input, col=kleur, axes=T,main = "meuse river data set; colour
> indicates distance to river", col.axis=1)
> points(meuse, pch = 3)
> plot(meuse.sl, add=T)
> image.plot( zlim=c(min(input$dist),max(input$dist)),
> nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
> 
> 
> 
> 
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Friday, 1 June 2007 7:01 PM
> To: Verbesselt, Jan (Ensis, Clayton)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: Optimize image plot of a grid with legend - colors - and
> extras ?
> 
> On Fri, 1 Jun 2007 Jan.Verbesselt at csiro.au wrote:
> 
> > Thanks Roger,
> > 
> > It's all working now ; I plotted a shape file on top of a spatial grid
> > image via the following script. Only, when you change the colors of
> the
> > image() the axis colors also change. I couldn't solve this and tried
> > several options (par, axis(), etc), but nothing worked.
> 
> In order to find this out, please provide an example with the meuse.grid
> 
> dataset shipped with sp, and for the shape, the meuse.riv river contour.
> 
> It may be that the col= argument is being passed through by accident to 
> plot.Spatial(), but without a reproducible example, it is difficult to 
> say.
> 
> Roger
> 
> > 
> > I also used image.plot() of the fields library to add a legend to the
> > image.
> > 
> > Does somebody has some advise how to optimize these type of spatial
> > image -grid plots with a legend, colors, and other extra's? 
> > 
> > All examples are welcome,
> > Cheers and thanks,
> > Jan
> > 
> > 
> > # combining the  usual image function and adding a legend
> > # first change margin for some more room
> > nr <- 100
> > ramp <- colorRamp(c("blue", "green"))
> > kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
> > par( mar=c(5,5,5,8), col.axis =1)
> > image(GRID, col=kleur, axes=T)
> > plot(shape,add =TRUE , border = "red", axes=F, las=1)
> > image.plot( zlim=c(min(data["ndvi"]),max(data["ndvi"])),
> > nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
> > box()
> > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Mon Jun  4 09:38:21 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 4 Jun 2007 09:38:21 +0200 (CEST)
Subject: [R-sig-Geo] Optimize image plot of a grid with legend - colors
 - and extras ?
In-Reply-To: <Pine.LNX.4.44.0706040835070.31307-100000@reclus.nhh.no>
Message-ID: <Pine.LNX.4.44.0706040922500.31307-100000@reclus.nhh.no>

On Mon, 4 Jun 2007, Roger Bivand wrote:

A couple of improvements - main= is not being passed through, so use 
title(). The function in geoR is legend.krige:

plot(as(input, "Spatial"), axes=TRUE)
image(input, col=kleur, add=TRUE)
title(main="meuse river data set\ncolour indicates distance to river")
legend.krige(x.leg=c(178200, 178400), y.leg=c(331800, 333800),
  input$dist, col=kleur, vertical=TRUE)

and a simple 1000m scale:

lines(c(180500, 181500), c(329570, 329570))
lines(c(180500, 180500), c(329570, 329620))
lines(c(181000, 181000), c(329570, 329620))
lines(c(181500, 181500), c(329570, 329620))
text(c(180500, 181000, 181500), c(329670, 329670, 329670), 
  labels=c("0", "500", "1000m"), cex=0.6)

Roger

> On Mon, 4 Jun 2007 Jan.Verbesselt at csiro.au wrote:
> 
> > Hi Roger,
> > 
> > I made a reproducible example: When you change the colors of the spatial
> > image the colors of the axes also change. How could this be solved?
> 
> Because the col= argument is passed using the "..." mechanism, it is seen 
> twice in the image() method (once to draw the axes, next to draw the 
> image) unless add=TRUE. So:
> 
> plot(as(input, "Spatial"), axes=TRUE)
> image(input, col=kleur, main = paste("meuse river data set;",
> "colour indicates distance to river"), add=TRUE)
> 
> works. col.axis in par() only sets the colour of the axis annotation, and 
> is not used here.
> 
> > 
> > (How can a legend and scale be added to this plot?)
> > 
> 
> In principle, the axes give the cardinal directions and the scale.  
> Although this is cartographic heresy, I have not seen anyone with a ruler
> using a scale on a computer display to read off distances, so that
> inserting a scale is probably overkill, the same with the north arrow. It
> can be done for presentation purposes, or if a reader demands it, but it
> is redundant is axes=TRUE. If axes=FALSE, then hand construction with
> lines() and text() (arrows() for N arrow) isn't hard.
> 
> The legend can be added as you suggest, or using a similar function in 
> geoR. Both involve placing manually - which could be improved by using the 
> placing names from legend(), but still give no guarantee that content will 
> not be overpainted. Perhaps the function from geoR could be migrated to 
> sp, since geoR now depends on sp.
> 
> > All other tips and tricks are mostly welcome,
> > 
> > Thanks a lot,
> > Jan
> > 
> > Ps. Great that this sp() package make spatial analysis and visualization
> > possible in R! - Does maptools package offer better or alternative
> > mapping functions? 
> 
> The sp package provides classes and methods for Spatial*, maptools 
> provides tools for simple import/export and interfaces to other R 
> packages, rgdal more advanced import/export. None are designed to provide 
> presentation cartographic output - they provide analytic graphics, and the 
> functions to export the data if you need something more fancy. 
> 
> I find that users put far too much time into presentation, losing touch
> with what the data are telling them. My understanding of data
> visualisation is that communication depends on getting the important
> things across, which are the data, and an unobtrusive support for position
> (the real "map" is its representation inside the computer, not the
> hardcopy output).
> 
> For example, informative setting of the class intervals is important - 
> using the defaults in image() can be very deceptive.
> 
> Hope this helps,
> 
> Roger
> 
> > 
> > /***script***
> > 
> > library(fields)
> > library(sp)
> > 
> > data(meuse.grid)
> > coordinates(meuse.grid) = ~x+y
> > gridded(meuse.grid) = TRUE
> > data(meuse)
> > coordinates(meuse) = ~x+y
> > data(meuse.riv)
> > plot(meuse.riv)
> > meuse.sl = SpatialLines(list(Lines(list(Line(meuse.riv)))))
> > 
> > ## image plot with points and lines
> > nr <- 200
> > ramp <- colorRamp(c("blue", "green"))
> > kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
> > par( mar=c(5,5,5,8))
> > input <- meuse.grid["dist"]
> > image(input, col=kleur, axes=T,main = "meuse river data set; colour
> > indicates distance to river", col.axis=1)
> > points(meuse, pch = 3)
> > plot(meuse.sl, add=T)
> > image.plot( zlim=c(min(input$dist),max(input$dist)),
> > nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
> > 
> > 
> > 
> > 
> > -----Original Message-----
> > From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> > Sent: Friday, 1 June 2007 7:01 PM
> > To: Verbesselt, Jan (Ensis, Clayton)
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Subject: Re: Optimize image plot of a grid with legend - colors - and
> > extras ?
> > 
> > On Fri, 1 Jun 2007 Jan.Verbesselt at csiro.au wrote:
> > 
> > > Thanks Roger,
> > > 
> > > It's all working now ; I plotted a shape file on top of a spatial grid
> > > image via the following script. Only, when you change the colors of
> > the
> > > image() the axis colors also change. I couldn't solve this and tried
> > > several options (par, axis(), etc), but nothing worked.
> > 
> > In order to find this out, please provide an example with the meuse.grid
> > 
> > dataset shipped with sp, and for the shape, the meuse.riv river contour.
> > 
> > It may be that the col= argument is being passed through by accident to 
> > plot.Spatial(), but without a reproducible example, it is difficult to 
> > say.
> > 
> > Roger
> > 
> > > 
> > > I also used image.plot() of the fields library to add a legend to the
> > > image.
> > > 
> > > Does somebody has some advise how to optimize these type of spatial
> > > image -grid plots with a legend, colors, and other extra's? 
> > > 
> > > All examples are welcome,
> > > Cheers and thanks,
> > > Jan
> > > 
> > > 
> > > # combining the  usual image function and adding a legend
> > > # first change margin for some more room
> > > nr <- 100
> > > ramp <- colorRamp(c("blue", "green"))
> > > kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
> > > par( mar=c(5,5,5,8), col.axis =1)
> > > image(GRID, col=kleur, axes=T)
> > > plot(shape,add =TRUE , border = "red", axes=F, las=1)
> > > image.plot( zlim=c(min(data["ndvi"]),max(data["ndvi"])),
> > > nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
> > > box()
> > > 
> > > 
> > > 
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Mon Jun  4 09:56:14 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 04 Jun 2007 09:56:14 +0200
Subject: [R-sig-Geo] Optimize image plot of a grid with legend - colors
 - and extras ?
In-Reply-To: <0393960FC6AFA142B0234E5CC8DA3B0C3FE2A4@exnswn2-syd.nexus.csiro.au>
References: <Pine.LNX.4.44.0706011058220.24583-100000@reclus.nhh.no>
	<0393960FC6AFA142B0234E5CC8DA3B0C3FE2A4@exnswn2-syd.nexus.csiro.au>
Message-ID: <4663C59E.1070604@geo.uu.nl>

Jan, I have a clue why this happened. Indeed,

 > image(input, col=rev(bpy.colors(10)), axes=T)

reproduces the example, but

 > image(input, col=rev(bpy.colors(10)))
 > axis(1)
 > axis(2)
 > box()

doesn't. It seems like the col argument is passed to axis, try

 > axis(1, col = rev(bpy.colors(10))

so indeed a specific color argument for the axes (as you suggest: 
col.axes) is needed here to override the plotting colors. Will work on 
it. Hope the solution above works for the moment.
--
Edzer

Jan.Verbesselt at csiro.au wrote:
> Hi Roger,
>
> I made a reproducible example: When you change the colors of the spatial
> image the colors of the axes also change. How could this be solved?
>
> (How can a legend and scale be added to this plot?)
>
> All other tips and tricks are mostly welcome,
>
> Thanks a lot,
> Jan
>
> Ps. Great that this sp() package make spatial analysis and visualization
> possible in R! - Does maptools package offer better or alternative
> mapping functions? 
>
> /***script***
>
> library(fields)
> library(sp)
>
> data(meuse.grid)
> coordinates(meuse.grid) = ~x+y
> gridded(meuse.grid) = TRUE
> data(meuse)
> coordinates(meuse) = ~x+y
> data(meuse.riv)
> plot(meuse.riv)
> meuse.sl = SpatialLines(list(Lines(list(Line(meuse.riv)))))
>
> ## image plot with points and lines
> nr <- 200
> ramp <- colorRamp(c("blue", "green"))
> kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
> par( mar=c(5,5,5,8))
> input <- meuse.grid["dist"]
> image(input, col=kleur, axes=T,main = "meuse river data set; colour
> indicates distance to river", col.axis=1)
> points(meuse, pch = 3)
> plot(meuse.sl, add=T)
> image.plot( zlim=c(min(input$dist),max(input$dist)),
> nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
>
>
>
>
> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
> Sent: Friday, 1 June 2007 7:01 PM
> To: Verbesselt, Jan (Ensis, Clayton)
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: Optimize image plot of a grid with legend - colors - and
> extras ?
>
> On Fri, 1 Jun 2007 Jan.Verbesselt at csiro.au wrote:
>
>   
>> Thanks Roger,
>>
>> It's all working now ; I plotted a shape file on top of a spatial grid
>> image via the following script. Only, when you change the colors of
>>     
> the
>   
>> image() the axis colors also change. I couldn't solve this and tried
>> several options (par, axis(), etc), but nothing worked.
>>     
>
> In order to find this out, please provide an example with the meuse.grid
>
> dataset shipped with sp, and for the shape, the meuse.riv river contour.
>
> It may be that the col= argument is being passed through by accident to 
> plot.Spatial(), but without a reproducible example, it is difficult to 
> say.
>
> Roger
>
>   
>> I also used image.plot() of the fields library to add a legend to the
>> image.
>>
>> Does somebody has some advise how to optimize these type of spatial
>> image -grid plots with a legend, colors, and other extra's? 
>>
>> All examples are welcome,
>> Cheers and thanks,
>> Jan
>>
>>
>> # combining the  usual image function and adding a legend
>> # first change margin for some more room
>> nr <- 100
>> ramp <- colorRamp(c("blue", "green"))
>> kleur <- rgb( ramp(seq(0, 1, length = nr)), max = 255)
>> par( mar=c(5,5,5,8), col.axis =1)
>> image(GRID, col=kleur, axes=T)
>> plot(shape,add =TRUE , border = "red", axes=F, las=1)
>> image.plot( zlim=c(min(data["ndvi"]),max(data["ndvi"])),
>> nlevel=nr,legend.only=TRUE, horizontal=F, col=kleur)
>> box()
>>
>>
>>
>>     
>
>



From tskam at smu.edu.sg  Mon Jun  4 10:27:27 2007
From: tskam at smu.edu.sg (KAM Tin Seong)
Date: Mon, 4 Jun 2007 16:27:27 +0800
Subject: [R-sig-Geo] adaptive kernel density
Message-ID: <FA3090E732DC6A4EB8E2D875EEB486A562CC09@EX01.staff.smu.edu.sg>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070604/bf2d110f/attachment.pl>

From mdsumner at utas.edu.au  Tue Jun  5 09:15:47 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Tue, 05 Jun 2007 17:15:47 +1000
Subject: [R-sig-Geo] SpatialPixels - other implementations?
In-Reply-To: <FA3090E732DC6A4EB8E2D875EEB486A562CC09@EX01.staff.smu.edu.sg>
References: <FA3090E732DC6A4EB8E2D875EEB486A562CC09@EX01.staff.smu.edu.sg>
Message-ID: <46650DA3.9040009@utas.edu.au>

Hello,

I'm interested in the origin of the idea behind sp's SpatialPixels.
What other software/s implement this concept, of storing a sparse grid 
of pixels?

I'm aware of the SparseMatrix in R, and I haven't explored that thread - 
are there specifically GIS implementations of this idea?

Cheers, Mike.



From t.szegvary at unibas.ch  Tue Jun  5 09:21:47 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Tue, 5 Jun 2007 09:21:47 +0200
Subject: [R-sig-Geo] gridding
Message-ID: <000401c7a742$2dceb4b0$44349883@D59QMB1J>

Hi there

I have problems using krige(). I want to do ordinary kriging, but always
have the problem of "dimensions do not match: locations 1956 and data 141".
Dim(mygrid) returns NULL. Is that supposed to be? I guess not, therefore I
must have made mistakes making my grid -> I want to use an ESRI shapefile,
which I sampled using spsample(shp, type = "regular", cellsize = 1000) and
then gridded using makegrid(), SpatialPoints() and gridded()=TRUE
Hmm. May someone help to find the problem?

Thanks,Thomas

__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.unibas.ch/environment



From Roger.Bivand at nhh.no  Tue Jun  5 09:46:29 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 5 Jun 2007 09:46:29 +0200 (CEST)
Subject: [R-sig-Geo] SpatialPixels - other implementations?
In-Reply-To: <46650DA3.9040009@utas.edu.au>
Message-ID: <Pine.LNX.4.44.0706050943220.32158-100000@reclus.nhh.no>

On Tue, 5 Jun 2007, Michael Sumner wrote:

> Hello,
> 
> I'm interested in the origin of the idea behind sp's SpatialPixels.
> What other software/s implement this concept, of storing a sparse grid 
> of pixels?

Directly from the Cells object in Terralib:

http://www.terralib.org/docs/v313/datamodel/SpatialModel.pdf

(they had lots of images with clouds, that is NA, and found the direct 
database record a better representation than repeated lookups on raster 
cells with content).

Roger

> 
> I'm aware of the SparseMatrix in R, and I haven't explored that thread - 
> are there specifically GIS implementations of this idea?
> 
> Cheers, Mike.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From e.pebesma at geo.uu.nl  Tue Jun  5 10:28:12 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 05 Jun 2007 10:28:12 +0200
Subject: [R-sig-Geo] gridding
In-Reply-To: <000401c7a742$2dceb4b0$44349883@D59QMB1J>
References: <000401c7a742$2dceb4b0$44349883@D59QMB1J>
Message-ID: <46651E9C.2070302@geo.uu.nl>

Thomas,

I have seen this error from package gstat before but find it hard to 
guess what caused it without looking over your shoulder. Please send the 
script that led to the error.
--
Edzer

Thomas Szegvary wrote:
> Hi there
>
> I have problems using krige(). I want to do ordinary kriging, but always
> have the problem of "dimensions do not match: locations 1956 and data 141".
> Dim(mygrid) returns NULL. Is that supposed to be? I guess not, therefore I
> must have made mistakes making my grid -> I want to use an ESRI shapefile,
> which I sampled using spsample(shp, type = "regular", cellsize = 1000) and
> then gridded using makegrid(), SpatialPoints() and gridded()=TRUE
> Hmm. May someone help to find the problem?
>
> Thanks,Thomas
>
> __
>
> Thomas Szegvary
> Institute of Environmental Geosciences
> Department of Geosciences
> University of Basel
> Bernoullistrasse 30
> CH - 4056 Basel
>
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.unibas.ch/environment
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From tkeitt at gmail.com  Tue Jun  5 17:10:47 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Tue, 5 Jun 2007 10:10:47 -0500
Subject: [R-sig-Geo] Linear interp irregular samples to irregular points
Message-ID: <6262c54c0706050810k6b6d9378s7aa89d417d6478e5@mail.gmail.com>

Anyone know of code that will do bilinear interpolation from irregular
samples to another set of irregular locations (including points
possibly outside the convex hull of the original points)? Akima
interpolates to a regular grid AFAICT. I did find one package on CRAN
that does this will splines, but I want something simpler. (The
particular application requires many repeated calls.)

THK

-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From Roger.Bivand at nhh.no  Tue Jun  5 18:28:14 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 5 Jun 2007 18:28:14 +0200 (CEST)
Subject: [R-sig-Geo] Linear interp irregular samples to irregular points
In-Reply-To: <6262c54c0706050810k6b6d9378s7aa89d417d6478e5@mail.gmail.com>
Message-ID: <Pine.LNX.4.44.0706051825440.15260-100000@reclus.nhh.no>

On Tue, 5 Jun 2007, Tim Keitt wrote:

> Anyone know of code that will do bilinear interpolation from irregular
> samples to another set of irregular locations (including points
> possibly outside the convex hull of the original points)? Akima
> interpolates to a regular grid AFAICT. I did find one package on CRAN
> that does this will splines, but I want something simpler. (The
> particular application requires many repeated calls.)

Would Tps() and predict() for Tps objects in fields meet your needs? I've 
used it for "faking" LOO CV to match spline interpolation to gstat.cv() in 
gstat, and it doesn't complain on many calls.

Roger

> 
> THK
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mihastaut at yahoo.co.uk  Tue Jun  5 18:36:56 2007
From: mihastaut at yahoo.co.uk (Miha Staut)
Date: Tue, 5 Jun 2007 17:36:56 +0100 (BST)
Subject: [R-sig-Geo] Linear interp irregular samples to irregular points
In-Reply-To: <6262c54c0706050810k6b6d9378s7aa89d417d6478e5@mail.gmail.com>
Message-ID: <578207.61161.qm@web25405.mail.ukl.yahoo.com>

What about interpp in akima package that does pointwise bivariate interpolation
for irregular data? Was that what you wanted?

All best
Miha


--- Tim Keitt <tkeitt at gmail.com> wrote:

> Anyone know of code that will do bilinear interpolation from irregular
> samples to another set of irregular locations (including points
> possibly outside the convex hull of the original points)? Akima
> interpolates to a regular grid AFAICT. I did find one package on CRAN
> that does this will splines, but I want something simpler. (The
> particular application requires many repeated calls.)
> 
> THK
> 
> -- 
> Timothy H. Keitt, University of Texas at Austin
> Contact info and schedule at http://www.keittlab.org/tkeitt/
> Reprints at http://www.keittlab.org/tkeitt/papers/
> ODF attachment? See http://www.openoffice.org/
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From tkeitt at gmail.com  Tue Jun  5 19:16:12 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Tue, 5 Jun 2007 12:16:12 -0500
Subject: [R-sig-Geo] Linear interp irregular samples to irregular points
In-Reply-To: <578207.61161.qm@web25405.mail.ukl.yahoo.com>
References: <6262c54c0706050810k6b6d9378s7aa89d417d6478e5@mail.gmail.com>
	<578207.61161.qm@web25405.mail.ukl.yahoo.com>
Message-ID: <6262c54c0706051016l9af66bcmd32324ac3a47b69c@mail.gmail.com>

Ah, you are right. I misread the interpp help and thought it only
output a regular grid. That will do the trick. Thanks.

THK

On 6/5/07, Miha Staut <mihastaut at yahoo.co.uk> wrote:
> What about interpp in akima package that does pointwise bivariate interpolation
> for irregular data? Was that what you wanted?
>
> All best
> Miha
>
>
> --- Tim Keitt <tkeitt at gmail.com> wrote:
>
> > Anyone know of code that will do bilinear interpolation from irregular
> > samples to another set of irregular locations (including points
> > possibly outside the convex hull of the original points)? Akima
> > interpolates to a regular grid AFAICT. I did find one package on CRAN
> > that does this will splines, but I want something simpler. (The
> > particular application requires many repeated calls.)
> >
> > THK
> >
> > --
> > Timothy H. Keitt, University of Texas at Austin
> > Contact info and schedule at http://www.keittlab.org/tkeitt/
> > Reprints at http://www.keittlab.org/tkeitt/papers/
> > ODF attachment? See http://www.openoffice.org/
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>
>
>
> ___________________________________________________________
> Now you can scan emails quickly with a reading pane. Get the new Yahoo! Mail. http://uk.docs.yahoo.com/nowyoucan.html
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From tkeitt at gmail.com  Tue Jun  5 19:17:34 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Tue, 5 Jun 2007 12:17:34 -0500
Subject: [R-sig-Geo] Linear interp irregular samples to irregular points
In-Reply-To: <Pine.LNX.4.44.0706051825440.15260-100000@reclus.nhh.no>
References: <6262c54c0706050810k6b6d9378s7aa89d417d6478e5@mail.gmail.com>
	<Pine.LNX.4.44.0706051825440.15260-100000@reclus.nhh.no>
Message-ID: <6262c54c0706051017p37258af4g5b164d893722eb8f@mail.gmail.com>

Tps() is great -- I've been using it. I suppose I could use it for
this problem too by setting the curvature penalty to zero (forcing it
to interpolate). The interpp a la Miha suggestion I think will be
better for what I want.

THK

On 6/5/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Tue, 5 Jun 2007, Tim Keitt wrote:
>
> > Anyone know of code that will do bilinear interpolation from irregular
> > samples to another set of irregular locations (including points
> > possibly outside the convex hull of the original points)? Akima
> > interpolates to a regular grid AFAICT. I did find one package on CRAN
> > that does this will splines, but I want something simpler. (The
> > particular application requires many repeated calls.)
>
> Would Tps() and predict() for Tps objects in fields meet your needs? I've
> used it for "faking" LOO CV to match spline interpolation to gstat.cv() in
> gstat, and it doesn't complain on many calls.
>
> Roger
>
> >
> > THK
> >
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From vanessa.stelzenmuller at cefas.co.uk  Wed Jun  6 11:03:43 2007
From: vanessa.stelzenmuller at cefas.co.uk (Vanessa Stelzenmuller (Cefas))
Date: Wed, 6 Jun 2007 10:03:43 +0100
Subject: [R-sig-Geo] Internal limits of processing in geoR ?
Message-ID: <084CA9EA6E6BA1498F0C5B04448A89FB01548383@LOWEXPRESS.corp.cefas.co.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070606/75ad1340/attachment.pl>

From Roger.Bivand at nhh.no  Wed Jun  6 11:36:15 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 6 Jun 2007 11:36:15 +0200 (CEST)
Subject: [R-sig-Geo] Internal limits of processing in geoR ?
In-Reply-To: <084CA9EA6E6BA1498F0C5B04448A89FB01548383@LOWEXPRESS.corp.cefas.co.uk>
Message-ID: <Pine.LNX.4.44.0706061128310.16522-100000@reclus.nhh.no>

On Wed, 6 Jun 2007, Vanessa Stelzenmuller (Cefas) wrote:

> Hello everyone,
> 
> I'm new to this list and I wonder if someone could help with the following:
> 
> 
> - I have to process a huge amount of data(> 20 000) - I calculated some
> GAMs, correlations etc. no problem
> 
> - Now using the library (geoR) I came across the following error message
> for the first time: "cannot allocate vector of size 567 MB"
> 
> - It is not a problem of computer power - so I guess these are internal
> limits for processing with geoR?
> 
> What do you think ?
> 

RSiteSearch("geoR memory")

gives some helpful links. The functions in geoR do work on the dense n by 
n matrix, so may not be what you need - depending on the particular 
geostatistical approach you are taking. If you are free to use 
alternatives. please look at gstat (and I believe fields) which do not try 
to store the n by n matrix. 

geoR is, I believe, best in situations where there is little data and the
researcher is trying to squeeze the maximum out of them in terms of
inference and prediction - see the geoR book "Model-based geostatistics"  
by Peter Diggle and Paulo Ribeiro Jr, recently published by Springer.

Roger

> 
>  
> 
> <?)))))>< <?))))>< <?)))>< <?))><
> 
> 
>    Dr. Vanessa Stelzenm?ller
>    CEFAS, Pakefield Road
>    Lowstoft, NR33 OHT, UK
> 
>    phone: + 44 (0)1502 527779
>    fax:     + 44 (0)1502 513865
> 
> <?))>< <?)))>< <?))))>< <?)))))>< 
> 
> 
> ***********************************************************************************
> This email and any attachments are intended for the named re...{{dropped}}
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From paulojus at c3sl.ufpr.br  Wed Jun  6 15:05:44 2007
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 6 Jun 2007 10:05:44 -0300 (BRT)
Subject: [R-sig-Geo] Internal limits of processing in geoR ?
In-Reply-To: <084CA9EA6E6BA1498F0C5B04448A89FB01548383@LOWEXPRESS.corp.cefas.co.uk>
References: <084CA9EA6E6BA1498F0C5B04448A89FB01548383@LOWEXPRESS.corp.cefas.co.uk>
Message-ID: <Pine.LNX.4.58.0706061004330.964@cohiba.c3sl.ufpr.br>

Vanessa

geoR works with full correlation matrices and therefore is not suitable to
handle data-sets of such size.
Have a look at other geostats packages in R.

best
P.J.


Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Wed, 6 Jun 2007, Vanessa Stelzenmuller (Cefas) wrote:

> Hello everyone,
>
>
>
> I'm new to this list and I wonder if someone could help with the following:
>
>
>
> -          I have to process a huge amount of data(> 20 000) - I calculated some GAMs, correlations etc. no problem
>
> -          Now using the library (geoR) I came across the following error message for the first time: "cannot allocate vector of size 567 MB"
>
> -          It is not a problem of computer power - so I guess these are internal limits for processing with geoR?
>
>
>
> What do you think ?
>
>
>
>
>
>
>
>
>
>
>
> <?)))))>< <?))))>< <?)))>< <?))><
>
>
>    Dr. Vanessa Stelzenm?ller
>
>
>    CEFAS, Pakefield Road
>
>    Lowstoft, NR33 OHT, UK
>
>
>    phone: + 44 (0)1502 527779
>
>    fax:     + 44 (0)1502 513865
>
>
>
> <?))>< <?)))>< <?))))>< <?)))))><
>
>
>
>
>
> ***********************************************************************************
> This email and any attachments are intended for the named re...{{dropped}}
>
>



From Laurence.Amilhat at toulouse.inra.fr  Wed Jun  6 16:27:10 2007
From: Laurence.Amilhat at toulouse.inra.fr (Laurence Amilhat)
Date: Wed, 06 Jun 2007 16:27:10 +0200
Subject: [R-sig-Geo] spread labels, plotrix package
Message-ID: <4666C43E.4060605@toulouse.inra.fr>

Hello,


I am using the plotrix package to add labels on my plot (a map exactly).
But when I have a lot of points, the labels are overlapping,
Do you know how can I avoid the labels overlap?

I am using the spread.labels, I tried thigmophobe.labels and 
boxed.labels with no better results.

Any idea are welcome,

Thank you,

laurence


-- 
====================================================================
= Laurence Amilhat    INRA Toulouse 31326 Castanet-Tolosan     	   = 
= Tel: 33 5 61 28 53 34   Email: laurence.amilhat at toulouse.inra.fr =



From TShort at epri.com  Wed Jun  6 17:13:51 2007
From: TShort at epri.com (Short, Tom)
Date: Wed, 6 Jun 2007 11:13:51 -0400
Subject: [R-sig-Geo] spread labels, plotrix package
In-Reply-To: <4666C43E.4060605@toulouse.inra.fr>
References: <4666C43E.4060605@toulouse.inra.fr>
Message-ID: <1F724548E253BD49BA9BB000E9525F79453598@usknxex01.epri.com>

Laurence, it's a tough problem. See the following links:

http://en.wikipedia.org/wiki/Automatic_label_placement
http://www.szoraster.com/Cartography/PracticalExperience.htm
http://www.eecs.harvard.edu/~shieber/Projects/Carto/carto.html
http://i11www.iti.uni-karlsruhe.de/map-labeling/bibliography/

I've got some R code enclosed that uses simulated annealing or genetic
algorithms to find suitable locations. The code is granted to the public
domain. The genetic algorithm portion is adapted from the python code
here:

http://meta.wikimedia.org/wiki/Map_generator

I thought I had posted this to r-sig-geo before, but I couldn't find it.
Anyway, I've only lightly tested it, and it could probably be tweaked
more.

- Tom 

Tom Short
Electric Power Research Institute (EPRI)
 
-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Laurence
Amilhat
Sent: Wednesday, June 06, 2007 10:27 AM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] spread labels, plotrix package

Hello,


I am using the plotrix package to add labels on my plot (a map exactly).
But when I have a lot of points, the labels are overlapping, Do you know
how can I avoid the labels overlap?

I am using the spread.labels, I tried thigmophobe.labels and
boxed.labels with no better results.

Any idea are welcome,

Thank you,

laurence


--
====================================================================
= Laurence Amilhat    INRA Toulouse 31326 Castanet-Tolosan     	   = 
= Tel: 33 5 61 28 53 34   Email: laurence.amilhat at toulouse.inra.fr =

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PointLabelSANNandGA.R
Type: application/octet-stream
Size: 7986 bytes
Desc: PointLabelSANNandGA.R
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070606/e41d2e7a/attachment.obj>

From lee.kitty at yahoo.com  Thu Jun  7 09:32:26 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Thu, 7 Jun 2007 00:32:26 -0700 (PDT)
Subject: [R-sig-Geo] Dissolve grids
Message-ID: <702863.94969.qm@web36312.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070607/99b51bcf/attachment.pl>

From e.pebesma at geo.uu.nl  Thu Jun  7 09:51:55 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Thu, 07 Jun 2007 09:51:55 +0200
Subject: [R-sig-Geo] Dissolve grids
In-Reply-To: <702863.94969.qm@web36312.mail.mud.yahoo.com>
References: <702863.94969.qm@web36312.mail.mud.yahoo.com>
Message-ID: <4667B91B.30702@geo.uu.nl>

If they're SpatialPoints* or SpatialPixels*, use rbind on them. If 
they're in a SpatialGridDataFrame, first convert to pixels by

fullgrid(x) = FALSE

then rbind, then back with fullgrid(x) = TRUE

hth,
--
Edzer

Kitty Lee wrote:
> Thanks to Terry and Virgilio, I used both suggestions in creating the spatial simulation. Now I have another question....
>
> I have simulate, say, 16 grids separately. Each has its distinct process. How can I combine (or dissolve) the 16 grids together to form one big study area?
>
> Thanks in advance!! ^_^
>
> K.
>
>        
> ---------------------------------
> Looking for a deal? Find great prices on flights and hotels with Yahoo! FareChase.
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From macq at llnl.gov  Thu Jun  7 18:27:36 2007
From: macq at llnl.gov (Don MacQueen)
Date: Thu, 7 Jun 2007 09:27:36 -0700
Subject: [R-sig-Geo] spsample()  ok with type= 'stratified',
 but gives error with 'random'
Message-ID: <p06230909c28dd577d691@[128.115.153.6]>

I don't know enough to assess whether I have a misunderstanding or a mistake.

spsample() with type='random' is giving an error, but succeeding with 
type='stratified'.

Maybe random sampling requires projection information and stratified doesn't?
I may have constructed my SpatialPolygonsDataFrame incorrectly?

Thanks
-Don

Details:

spgd consists of two rectangles, one inside the other, and the inside 
one is a hole.
The outer one has vertices in counter-clockwise order; the inner one 
in clockwise order.

>  class(tst)
[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"

>  summary(tst)
Object of class SpatialPolygonsDataFrame
Coordinates:
         min      max
r1 990396.8 990762.3
r2 213369.4 213702.6
Is projected: NA
proj4string : [NA]
Data attributes:
     ID
  zone:1


>  stst <- spsample(tst,type='stratified',n=50)
>  plot(tst)
>  points(stst)
>  stst <- spsample(tst,type='random',n=50)
Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
         proj4string only works for class(es extending) Spatial


##########
>  sessionInfo()
R version 2.5.0 (2007-04-23)
powerpc-apple-darwin8.9.1

locale:
C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets" 
"methods"   "base"

other attached packages:
maptools       sp  foreign    rmacq
"0.6-12" "0.9-14" "0.8-20"    "1.0"

##########
## since tst is fairly small, here it is:
##########
>  tst
An object of class "SpatialPolygonsDataFrame"
Slot "data":
        ID
zone zone

Slot "polygons":
[[1]]
An object of class "Polygons"
Slot "Polygons":
$zn
An object of class "Polygon"
Slot "labpt":
[1] 990579.4 213536.2

Slot "area":
[1] 64601.13

Slot "hole":
[1] FALSE

Slot "ringDir":
[1] 1

Slot "coords":
             x        y
[1,] 990499.3 213702.6
[2,] 990762.3 213559.8
[3,] 990658.2 213369.4
[4,] 990396.8 213513.2
[5,] 990499.3 213702.6


$zn2
An object of class "Polygon"
Slot "labpt":
[1] 990584.4 213537.3

Slot "area":
[1] 30367.20

Slot "hole":
[1] TRUE

Slot "ringDir":
[1] -1

Slot "coords":
             x        y
[1,] 990492.6 213650.8
[2,] 990441.8 213549.4
[3,] 990673.3 213423.7
[4,] 990728.1 213525.6
[5,] 990492.6 213650.8



Slot "plotOrder":
[1] 1 2

Slot "labpt":
[1] 990579.4 213536.2

Slot "ID":
[1] "zone"

Slot "area":
[1] 94968.33



Slot "plotOrder":
[1] 1

Slot "bbox":
         min      max
r1 990396.8 990762.3
r2 213369.4 213702.6

Slot "proj4string":
CRS arguments: NA

-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA



From Olsen.Tony at epamail.epa.gov  Thu Jun  7 18:44:54 2007
From: Olsen.Tony at epamail.epa.gov (Olsen.Tony at epamail.epa.gov)
Date: Thu, 7 Jun 2007 09:44:54 -0700
Subject: [R-sig-Geo] spsample()  ok with type= 'stratified',
 but gives error with 'random'
In-Reply-To: <p06230909c28dd577d691@[128.115.153.6]>
Message-ID: <OF1975BA52.F0705A3F-ON882572F3.005BBB15-882572F3.005C0070@epamail.epa.gov>

You can also use the library spsurvey to do a random sample using a sp
object or ESRI  shapefile.  It handles polygons, lines, and point
spatial objects.  Does stratified, unequal probability, and spatial
balance.

Anthony (Tony) R. Olsen
AMB Branch Chief
USEPA NHEERL
Western Ecology Division
200 S.W. 35th Street
Corvallis, OR 97333
Voice: (541) 754-4790
Fax: (541) 754-4716
email: Olsen.Tony at epa.gov
ARM Web Page: http://www.epa.gov/nheerl/arm


                                                                        
             Don MacQueen                                               
             <macq at llnl.gov>                                            
             Sent by:                                                To 
             r-sig-geo-bounce         r-sig-geo at stat.math.ethz.ch       
             s at stat.math.ethz                                        cc 
             .ch                                                        
                                                                Subject 
                                      [R-sig-Geo] spsample()  ok with   
             06/07/2007 09:27         type= 'stratified', but gives     
             AM                       error with 'random'               
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        




I don't know enough to assess whether I have a misunderstanding or a
mistake.

spsample() with type='random' is giving an error, but succeeding with
type='stratified'.

Maybe random sampling requires projection information and stratified
doesn't?
I may have constructed my SpatialPolygonsDataFrame incorrectly?

Thanks
-Don

Details:

spgd consists of two rectangles, one inside the other, and the inside
one is a hole.
The outer one has vertices in counter-clockwise order; the inner one
in clockwise order.

>  class(tst)
[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"

>  summary(tst)
Object of class SpatialPolygonsDataFrame
Coordinates:
         min      max
r1 990396.8 990762.3
r2 213369.4 213702.6
Is projected: NA
proj4string : [NA]
Data attributes:
     ID
  zone:1


>  stst <- spsample(tst,type='stratified',n=50)
>  plot(tst)
>  points(stst)
>  stst <- spsample(tst,type='random',n=50)
Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
         proj4string only works for class(es extending) Spatial


##########
>  sessionInfo()
R version 2.5.0 (2007-04-23)
powerpc-apple-darwin8.9.1

locale:
C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"
"methods"   "base"

other attached packages:
maptools       sp  foreign    rmacq
"0.6-12" "0.9-14" "0.8-20"    "1.0"

##########
## since tst is fairly small, here it is:
##########
>  tst
An object of class "SpatialPolygonsDataFrame"
Slot "data":
        ID
zone zone

Slot "polygons":
[[1]]
An object of class "Polygons"
Slot "Polygons":
$zn
An object of class "Polygon"
Slot "labpt":
[1] 990579.4 213536.2

Slot "area":
[1] 64601.13

Slot "hole":
[1] FALSE

Slot "ringDir":
[1] 1

Slot "coords":
             x        y
[1,] 990499.3 213702.6
[2,] 990762.3 213559.8
[3,] 990658.2 213369.4
[4,] 990396.8 213513.2
[5,] 990499.3 213702.6


$zn2
An object of class "Polygon"
Slot "labpt":
[1] 990584.4 213537.3

Slot "area":
[1] 30367.20

Slot "hole":
[1] TRUE

Slot "ringDir":
[1] -1

Slot "coords":
             x        y
[1,] 990492.6 213650.8
[2,] 990441.8 213549.4
[3,] 990673.3 213423.7
[4,] 990728.1 213525.6
[5,] 990492.6 213650.8



Slot "plotOrder":
[1] 1 2

Slot "labpt":
[1] 990579.4 213536.2

Slot "ID":
[1] "zone"

Slot "area":
[1] 94968.33



Slot "plotOrder":
[1] 1

Slot "bbox":
         min      max
r1 990396.8 990762.3
r2 213369.4 213702.6

Slot "proj4string":
CRS arguments: NA

--
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From Roger.Bivand at nhh.no  Thu Jun  7 21:53:27 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 7 Jun 2007 21:53:27 +0200 (CEST)
Subject: [R-sig-Geo] spsample()  ok with type= 'stratified',
 but gives error with 'random'
In-Reply-To: <p06230909c28dd577d691@[128.115.153.6]>
Message-ID: <Pine.LNX.4.44.0706072134400.21416-100000@reclus.nhh.no>

On Thu, 7 Jun 2007, Don MacQueen wrote:

> I don't know enough to assess whether I have a misunderstanding or a mistake.
> 
> spsample() with type='random' is giving an error, but succeeding with 
> type='stratified'.
> 
> Maybe random sampling requires projection information and stratified doesn't?
> I may have constructed my SpatialPolygonsDataFrame incorrectly?

The problem is that the hole well-nigh fills the polygon, and after iter=4
tries, it tries to finish, and fails, because the output object is NULL
rather than some points. Increasing iter= doesn't help. It shouldn't do
this, but it does - I'll try to fix it but not soon.

A work-around is:

plot(SP)
r1 <- spsample(as(SP, "Spatial"), type="random", n=300)
points(r1)
r2 <- overlay(SP, r1)
points(r1[!is.na(r2)], col="red")
length(which(!is.na(r2))) >= 50
r3 <- sample(which(!is.na(r2)), 50)
length(r3)
points(r1[r3], pch=19, col="red")

Most likely spsurvey and/or making an appropriate window in spatstat will 
do this better.

Thanks for a clear report that was easy to reproduce.

Roger



> 
> Thanks
> -Don
> 
> Details:
> 
> spgd consists of two rectangles, one inside the other, and the inside 
> one is a hole.
> The outer one has vertices in counter-clockwise order; the inner one 
> in clockwise order.
> 
> >  class(tst)
> [1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
> 
> >  summary(tst)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>          min      max
> r1 990396.8 990762.3
> r2 213369.4 213702.6
> Is projected: NA
> proj4string : [NA]
> Data attributes:
>      ID
>   zone:1
> 
> 
> >  stst <- spsample(tst,type='stratified',n=50)
> >  plot(tst)
> >  points(stst)
> >  stst <- spsample(tst,type='random',n=50)
> Error in `proj4string<-`(`*tmp*`, value = <S4 object of class "CRS">) :
>          proj4string only works for class(es extending) Spatial
> 
> 
> ##########
> >  sessionInfo()
> R version 2.5.0 (2007-04-23)
> powerpc-apple-darwin8.9.1
> 
> locale:
> C
> 
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets" 
> "methods"   "base"
> 
> other attached packages:
> maptools       sp  foreign    rmacq
> "0.6-12" "0.9-14" "0.8-20"    "1.0"
> 
> ##########
> ## since tst is fairly small, here it is:
> ##########
> >  tst
> An object of class "SpatialPolygonsDataFrame"
> Slot "data":
>         ID
> zone zone
> 
> Slot "polygons":
> [[1]]
> An object of class "Polygons"
> Slot "Polygons":
> $zn
> An object of class "Polygon"
> Slot "labpt":
> [1] 990579.4 213536.2
> 
> Slot "area":
> [1] 64601.13
> 
> Slot "hole":
> [1] FALSE
> 
> Slot "ringDir":
> [1] 1
> 
> Slot "coords":
>              x        y
> [1,] 990499.3 213702.6
> [2,] 990762.3 213559.8
> [3,] 990658.2 213369.4
> [4,] 990396.8 213513.2
> [5,] 990499.3 213702.6
> 
> 
> $zn2
> An object of class "Polygon"
> Slot "labpt":
> [1] 990584.4 213537.3
> 
> Slot "area":
> [1] 30367.20
> 
> Slot "hole":
> [1] TRUE
> 
> Slot "ringDir":
> [1] -1
> 
> Slot "coords":
>              x        y
> [1,] 990492.6 213650.8
> [2,] 990441.8 213549.4
> [3,] 990673.3 213423.7
> [4,] 990728.1 213525.6
> [5,] 990492.6 213650.8
> 
> 
> 
> Slot "plotOrder":
> [1] 1 2
> 
> Slot "labpt":
> [1] 990579.4 213536.2
> 
> Slot "ID":
> [1] "zone"
> 
> Slot "area":
> [1] 94968.33
> 
> 
> 
> Slot "plotOrder":
> [1] 1
> 
> Slot "bbox":
>          min      max
> r1 990396.8 990762.3
> r2 213369.4 213702.6
> 
> Slot "proj4string":
> CRS arguments: NA
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mdsumner at utas.edu.au  Fri Jun  8 00:56:54 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Fri, 08 Jun 2007 08:56:54 +1000
Subject: [R-sig-Geo] SpatialPixels - other implementations?
In-Reply-To: <Pine.LNX.4.44.0706050943220.32158-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0706050943220.32158-100000@reclus.nhh.no>
Message-ID: <46688D36.5090804@utas.edu.au>

Thanks Roger.

Roger Bivand wrote:
> On Tue, 5 Jun 2007, Michael Sumner wrote:
>
>   
>> Hello,
>>
>> I'm interested in the origin of the idea behind sp's SpatialPixels.
>> What other software/s implement this concept, of storing a sparse grid 
>> of pixels?
>>     
>
> Directly from the Cells object in Terralib:
>
> http://www.terralib.org/docs/v313/datamodel/SpatialModel.pdf
>
> (they had lots of images with clouds, that is NA, and found the direct 
> database record a better representation than repeated lookups on raster 
> cells with content).
>
> Roger
>



From Marciaexpiatetrachea at nextstudent.com  Tue Jun 12 21:54:47 2007
From: Marciaexpiatetrachea at nextstudent.com (Allison Byrne)
Date: Tue, 12 Jun 2007 21:54:47 +0200
Subject: [R-sig-Geo] Enjoy the freedom from financial burdens
Message-ID: <200706121954.l5CJsl8S025492@hypatia.math.ethz.ch>

As a business you have been preapproved to receive 33978 USD TODAY!

No hassle at all, completely unsecured.
There are no hidden costs or fees.
Worried that your credit is less than perfect? Not an issue.

Give us a ring, now..

18774824956

Turn your dream, into a reality, is that not worth two minutes of your time?

18774824956

It had been damp; Scotch tape did not like the damp; in many cases her Ludlumesque little traps had undoubtedly just peeled off and floated away on some random draft. He put the towel aside, flexed the hand for awhile (the first few times made him grimace with pain, but then the hand began to limber up), and started to write again.

Nellie Chappell



From reeves at nceas.ucsb.edu  Tue Jun 12 22:49:42 2007
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Tue, 12 Jun 2007 13:49:42 -0700
Subject: [R-sig-Geo] Issue reading ESRI polygon shapefiles with PBSMapping
	'importShapefile'
Message-ID: <466F06E6.8020508@nceas.ucsb.edu>


Hello,

Using R 2.5.0 with  PBSmapping package version 2.09:

When I try to read in a polygon shapefile (eight polygons, the file was 
written by the
Feature Class to Shapefile command in ArcMap GIS 9.2) using the command:

importShapefile("TriCountyPolyDD")

The following error occurs:

Error in x[[jj]][iseq] <- vjj : incompatible types (from NULL to 
integer) in subassignment type fix

Using read.shape on the same file yields

 > TriCounty <-read.shape("TriCountyPolyDD.shp")   
Shapefile type: Polygon, (5), # of Shapes: 8
 >
Yet I wish to work with this shapefile using the PBSmapping tools.

Has anyone else encountered and/or repaired this?
Plan B would be to convert the Map object TriCounty into
a PolySet or PolyData used by PBSmapping package, but
so far I have not worked this out. Any suggestions?

Thanks, Rick Reeves
NCEAS / UC Santa Barbara

-- 
Rick Reeves	
Scientific Programmer / Analyst	
National Center for Ecological Analysis and Synthesis
UC Santa Barbara
reeves at nceas.ucsb.edu
www.nceas.ucsb.edu
805 892 2533

-------------- next part --------------
A non-text attachment was scrubbed...
Name: reeves.vcf
Type: text/x-vcard
Size: 339 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070612/1842c9f9/attachment.vcf>

From Roger.Bivand at nhh.no  Wed Jun 13 10:28:11 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 13 Jun 2007 10:28:11 +0200 (CEST)
Subject: [R-sig-Geo] Issue reading ESRI polygon shapefiles with
 PBSMapping 'importShapefile'
In-Reply-To: <466F06E6.8020508@nceas.ucsb.edu>
References: <466F06E6.8020508@nceas.ucsb.edu>
Message-ID: <Pine.LNX.4.64.0706130956590.27010@reclus.nhh.no>

On Tue, 12 Jun 2007, Rick Reeves wrote:

>
> Hello,
>
> Using R 2.5.0 with  PBSmapping package version 2.09:
>
> When I try to read in a polygon shapefile (eight polygons, the file was 
> written by the
> Feature Class to Shapefile command in ArcMap GIS 9.2) using the command:
>
> importShapefile("TriCountyPolyDD")
>
> The following error occurs:
>
> Error in x[[jj]][iseq] <- vjj : incompatible types (from NULL to integer) in 
> subassignment type fix


Please always (by reflex, don't even think why!) say traceback() after 
every error. The output of traceback() may not help you, but it certainly 
helps those who read the error report. Probably vjj is NULL, but vjj does 
not appear in importShapefile, so only traceback() would show where the 
error occurred.

>
> Using read.shape on the same file yields
>
>>  TriCounty <-read.shape("TriCountyPolyDD.shp") 
> Shapefile type: Polygon, (5), # of Shapes: 8
>> 
> Yet I wish to work with this shapefile using the PBSmapping tools.
>
> Has anyone else encountered and/or repaired this?
> Plan B would be to convert the Map object TriCounty into
> a PolySet or PolyData used by PBSmapping package, but
> so far I have not worked this out. Any suggestions?
>

To get to PolySet:

library(maptools)
library(PBSmapping)

# NC example shapefile included with maptools

xx <- readShapePoly(system.file("shapes/sids.shp", package="maptools")[1],
   IDvar="FIPSNO", proj4string=CRS("+proj=longlat +ellps=clrk66"))
xx_PS <- SpatialPolygons2PolySet(xx)
class(xx_PS)

For PolyData, cast xx to data.frame:

xx_df <- as(xx, "data.frame")
xx_df1 <- cbind(PID=1:nrow(xx_df), xx_df)
xx_df1$col <- paste("grey", 100-(2*(xx_df1$SID74+1)), sep="")
xx_PD <- as.PolyData(xx_df1, projection=attr(xx_PS, "projection"))
plotMap(xx_PS, polyProps=xx_PD)

which corresponds to:

spplot(xx, "SID74", col.regions=grey(99:1/100))

Now this assumes that Arc hasn't done something odd to your shapefile, of 
course.

Hope this helps,

Roger

> Thanks, Rick Reeves
> NCEAS / UC Santa Barbara
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From t.szegvary at unibas.ch  Wed Jun 13 11:37:32 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Wed, 13 Jun 2007 11:37:32 +0200
Subject: [R-sig-Geo] Points2grid() from spatial points
Message-ID: <001001c7ad9e$7794d8b0$44349883@D59QMB1J>

Hello, I'm new to R and try to use the geostatistical packages. 
I have a problem making grid from ESRI shapefiles. I imported the shapefile
(polygon) and projected the coordinates. Then I used spsample() to produce a
spatial points for the given regions resp. polygons. With points2grid I
wanted to produce the grid, which should be used for krige(), but a always
have an error message (see below). 

Script:
>#prepare grid
>europe <- readShapePoly("R course/country/europePoly.shp")
>proj4string(europe) = CRS("+init=epsg:4326") europe.tr <-
spTransform(europe,CRS("+init=epsg:3035"))
>europe.points <- spsample(europe.tr,type="regular",cellsize=100000)
>points2grid(europe.points) 
                       x1      x2
cellcentre.offset 2735004 1478310
cellsize           100000  100000
cells.dim              37      48
Warning message:
grid has empty column/rows in dimension 2 in: points2grid(europe.points)


Thanks a lot
Thomas



__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment



From Roger.Bivand at nhh.no  Wed Jun 13 15:29:16 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 13 Jun 2007 15:29:16 +0200 (CEST)
Subject: [R-sig-Geo] Points2grid() from spatial points
In-Reply-To: <001001c7ad9e$7794d8b0$44349883@D59QMB1J>
References: <001001c7ad9e$7794d8b0$44349883@D59QMB1J>
Message-ID: <Pine.LNX.4.64.0706131525290.2761@reclus.nhh.no>

On Wed, 13 Jun 2007, Thomas Szegvary wrote:

> Hello, I'm new to R and try to use the geostatistical packages.
> I have a problem making grid from ESRI shapefiles. I imported the shapefile
> (polygon) and projected the coordinates. Then I used spsample() to produce a
> spatial points for the given regions resp. polygons. With points2grid I
> wanted to produce the grid, which should be used for krige(), but a always
> have an error message (see below).
>
> Script:
>> #prepare grid
>> europe <- readShapePoly("R course/country/europePoly.shp")
>> proj4string(europe) = CRS("+init=epsg:4326") europe.tr <-
> spTransform(europe,CRS("+init=epsg:3035"))
>> europe.points <- spsample(europe.tr,type="regular",cellsize=100000)
>> points2grid(europe.points)
>                       x1      x2
> cellcentre.offset 2735004 1478310
> cellsize           100000  100000
> cells.dim              37      48
> Warning message:
> grid has empty column/rows in dimension 2 in: points2grid(europe.points)
>

This is a warning, not an error, and only means that at least one 
column/row in one dimension (so row most likely) has no points after 
removing the points not inside the polygons. Try:

plot(europe.tr)
points(europe.points, cex=0.5)

to see where that might be.

Hope this helps,

Roger

>
> Thanks a lot
> Thomas
>
>
>
> __
>
> Thomas Szegvary
> Institute of Environmental Geosciences
> Department of Geosciences
> University of Basel
> Bernoullistrasse 30
> CH - 4056 Basel
>
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From loecher at eden.rutgers.edu  Wed Jun 13 16:31:22 2007
From: loecher at eden.rutgers.edu (Markus Loecher)
Date: Wed, 13 Jun 2007 10:31:22 -0400
Subject: [R-sig-Geo] pairwise geodesic distances
Message-ID: <20070613143204.3CB4532407D@annwn13.rutgers.edu>

Dear list members,
I find the dist() function in R very useful to quickly compute 
pairwise distances between vectors of points.
Is there an equivalent function which uses the geodesic distance 
between lat/lon vectors instead of the ones offered by dist() ?

Thanks !

Markus Loecher



From loecher at eden.rutgers.edu  Wed Jun 13 17:33:22 2007
From: loecher at eden.rutgers.edu (Markus Loecher)
Date: Wed, 13 Jun 2007 11:33:22 -0400
Subject: [R-sig-Geo] Network K function
Message-ID: <20070613153403.CF97E96C@annwn14.rutgers.edu>

Dear list members,
does anyone know of an R package that computes 
the network K function instead of the "normal" planar K function ?

This concept is described in the nice article
"Comparison of planar and network K-functions in traffic
accident analysis", by Yamada and Thill (Journal 
of Transport Geography 12 (2004) 149?158)

Thanks !

Markus Loecher



From Roger.Bivand at nhh.no  Wed Jun 13 18:14:36 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 13 Jun 2007 18:14:36 +0200 (CEST)
Subject: [R-sig-Geo] pairwise geodesic distances
In-Reply-To: <20070613143204.3CB4532407D@annwn13.rutgers.edu>
References: <20070613143204.3CB4532407D@annwn13.rutgers.edu>
Message-ID: <Pine.LNX.4.64.0706131812570.3554@reclus.nhh.no>

On Wed, 13 Jun 2007, Markus Loecher wrote:

> Dear list members,
> I find the dist() function in R very useful to quickly compute
> pairwise distances between vectors of points.
> Is there an equivalent function which uses the geodesic distance
> between lat/lon vectors instead of the ones offered by dist() ?

spDistsN1(..., longlat=TRUE) in sp does a vector to a point, so iterating 
over the second vector, you'd get there.


>
> Thanks !
>
> Markus Loecher
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From robert_sutherland at fishgame.state.ak.us  Wed Jun 13 20:54:43 2007
From: robert_sutherland at fishgame.state.ak.us (Bob Sutherland)
Date: Wed, 13 Jun 2007 10:54:43 -0800
Subject: [R-sig-Geo] writeOGR KML question
Message-ID: <008e01c7adec$4e4636e0$6b9f3f92@ANCSutherland>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070613/44da0acf/attachment.pl>

From t.szegvary at unibas.ch  Thu Jun 14 08:24:09 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Thu, 14 Jun 2007 08:24:09 +0200
Subject: [R-sig-Geo] Plots from netcdf file
Message-ID: <000301c7ae4c$9e50c730$44349883@D59QMB1J>

I am using the RNetCDF package to extract data from netcdf files. I've got a
nc file (from an atmospheric model) with coordinates as the following:
>dim(lon)
[1] 67 46
> dim(lat)
[1] 67 46

I suppose the lon and lat values are given to grid points. If I get the
variables and plot(lon,lat) it shows me the grid points. But I am not able
to use filled.contour(lon,lat,z) for a variable z. z containts also the
coordinate array, 8 is an altitude layer and 121 represents the time
(hours). 

> dim(z)
[1]  67  46   8 121

I tried to extract a specific hour and layer, e.g. z100 <- z[,,5,100] and
tried to produce a contour plot. But I always have the following error
message:

> filled.contour(lon,lat,z100)
Error in filled.contour(lon, lat, CO2.100) : 
        increasing 'x' and 'y' values expected

What can I do?

Thanks a lot
Thomas



__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment



From Roger.Bivand at nhh.no  Thu Jun 14 08:51:57 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 14 Jun 2007 08:51:57 +0200 (CEST)
Subject: [R-sig-Geo] writeOGR KML question
In-Reply-To: <008e01c7adec$4e4636e0$6b9f3f92@ANCSutherland>
References: <008e01c7adec$4e4636e0$6b9f3f92@ANCSutherland>
Message-ID: <Pine.LNX.4.64.0706140844510.5543@reclus.nhh.no>

On Wed, 13 Jun 2007, Bob Sutherland wrote:

> Hi,
>
> I read in polygon shape file and write the KML for GE using the writeOGR
> function
>
> tmpshpPoly<-readShapePoly("tmpshp",IDvar="AKUCU83_",
> proj4string=CRS("+proj=longlat"))
>
> writeOGR(tmpshpPoly, "test2.kml", "Location","KML")
>
> In the test2.kml file I'd also like to include a name for each polygon and
> some polygon shading.  I can edit the shape file and place or edit the tags
> but for this to work as we desire, I'd want to write the <name> tag with the
> tmpshpPoly$loc field.  I'd also like to color the polygon with a
> categorization of the tmpshpPoly$nAnimals field.  The categorization is
> easy.
>
> I am unable to write the <name> tag within the Placemark tag for each
> polygon.  I am also unable to alter the
> <PolyStyle><fill>0</fill></PolyStyle> fill color to an appropriate color.
> If you have suggestions I would be most appreciative.
>

The underlying driver is an OGR driver, and can only do as much or as 
little as OGR permits. If you are on Windows (please _always_ state 
platform, R and package versions from for example sessionInfo()), and have 
the latest rgdal, you have GDAL 1.4.1 code, that is the most recent 
release.

http://www.gdal.org/ogr/drv_kml.html

says:

"OGR has limited support for KML writing"

and there is no way to add the information you are interested in.

Could I suggest an alternative route, using the maptools functions: 
GE_SpatialGrid and kmlOverlay, which use the png() graphics device to 
write an image overlay of whatever you plot - so adding polygon fills, or 
labels, becomes as simple as plotting? Please see the GE_SpatialGrid help 
page.

Roger

> Thank you,
>
>
>
> Bob Sutherland
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From mdsumner at utas.edu.au  Fri Jun 15 01:34:03 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Fri, 15 Jun 2007 9:34:03 +1000
Subject: [R-sig-Geo] Plots from netcdf file
Message-ID: <200706142334.l5ENY3ag003727@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070615/94637ab4/attachment.pl>

From t.szegvary at unibas.ch  Fri Jun 15 14:34:13 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Fri, 15 Jun 2007 14:34:13 +0200
Subject: [R-sig-Geo] Adding map to filled.contour
Message-ID: <002501c7af49$7b37db00$44349883@D59QMB1J>

Hi there

I have a filled.contour and want to add a the contours of a shapefile (i.e.
European boarders). I tried to do this with the map library, but didn't
succed using par(new=TRUE) to add the boundaries, the filled.contour is not
a plot says R.
What else can I do?
Thanks,Thomas



__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment



From drf5n at maplepark.com  Fri Jun 15 16:11:22 2007
From: drf5n at maplepark.com (David Forrest)
Date: Fri, 15 Jun 2007 09:11:22 -0500 (CDT)
Subject: [R-sig-Geo] Plots from netcdf file
In-Reply-To: <000301c7ae4c$9e50c730$44349883@D59QMB1J>
References: <000301c7ae4c$9e50c730$44349883@D59QMB1J>
Message-ID: <alpine.LFD.0.99.0706150842430.14422@maplepark.com>

On Thu, 14 Jun 2007, Thomas Szegvary wrote:

> I am using the RNetCDF package to extract data from netcdf files. I've got a
> nc file (from an atmospheric model) with coordinates as the following:
>> dim(lon)
> [1] 67 46
>> dim(lat)
> [1] 67 46
>
> I suppose the lon and lat values are given to grid points. If I get the
> variables and plot(lon,lat) it shows me the grid points. But I am not able
> to use filled.contour(lon,lat,z) for a variable z. z containts also the
> coordinate array, 8 is an altitude layer and 121 represents the time
> (hours).
>
>> dim(z)
> [1]  67  46   8 121
>
> I tried to extract a specific hour and layer, e.g. z100 <- z[,,5,100] and
> tried to produce a contour plot. But I always have the following error
> message:
>
>> filled.contour(lon,lat,z100)
> Error in filled.contour(lon, lat, CO2.100) :
>        increasing 'x' and 'y' values expected
>
> What can I do?

A problem is that the grid is not regular, and several of the plotting 
tools for contour or surface data expect just two vectors of x and y 
coordinates.  If you just want a quick, distorted view, you could just 
grab a single row of lon and a column of lat.  Otherwise, 3d scatter plot 
methods like cloud or scatter3d might work.  For a nice surface, I think 
you'll need to resample/reproject/interpolate the points to a regular grid 
for plotting, as per MASS, 'local trend surfaces', with the 
predict(loess(z ~x+y,...),expand.grid(...)...) functions.

Another thing you might watch out for is that atmospheric model data often 
has staggered grids, with some features defined at the grid points, and 
others at the element centers.

Dave
-- 
  Dr. David Forrest
  drf at vims.edu                                    (804)684-7900w
  drf5n at maplepark.com                             (804)642-0662h
                                    http://maplepark.com/~drf5n/



From Greg.Snow at intermountainmail.org  Fri Jun 15 18:12:17 2007
From: Greg.Snow at intermountainmail.org (Greg Snow)
Date: Fri, 15 Jun 2007 10:12:17 -0600
Subject: [R-sig-Geo] Adding map to filled.contour
In-Reply-To: <002501c7af49$7b37db00$44349883@D59QMB1J>
Message-ID: <07E228A5BE53C24CAD490193A7381BBBA21F6D@LP-EXCHVS07.CO.IHC.COM>

When filled.countour returns, the coordinate system does not match the
plot (part of drawing the scale).  One of the easiest ways to add to the
plot is using the plot.axes argument.  For example:

> library(maps)
> data(ozone)
> 
> fit <- loess(median ~ x+y, data=ozone)
> 
> tmp.x <- seq( min(ozone$x), max(ozone$x), length=25 )
> tmp.y <- seq( min(ozone$y), max(ozone$y), length=25 )
> 
> z <- predict(fit, expand.grid(x=tmp.x, y=tmp.y))
> z <- matrix(z, ncol=25)
> 
> filled.contour(tmp.x, tmp.y, z,
+   plot.axes=map('state',add=T)
+   )
> 

Hope this helps,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at intermountainmail.org
(801) 408-8111
 
 

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of 
> Thomas Szegvary
> Sent: Friday, June 15, 2007 6:34 AM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] Adding map to filled.contour
> 
> Hi there
> 
> I have a filled.contour and want to add a the contours of a 
> shapefile (i.e.
> European boarders). I tried to do this with the map library, 
> but didn't succed using par(new=TRUE) to add the boundaries, 
> the filled.contour is not a plot says R.
> What else can I do?
> Thanks,Thomas
> 
> 
> 
> __
> 
> Thomas Szegvary
> Institute of Environmental Geosciences
> Department of Geosciences
> University of Basel
> Bernoullistrasse 30
> CH - 4056 Basel
> 
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Agustin.Lobo at ija.csic.es  Fri Jun 15 18:38:01 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Fri, 15 Jun 2007 18:38:01 +0200
Subject: [R-sig-Geo] Subscripting by coordinates
Message-ID: <4672C069.8070700@ija.csic.es>

Hi r-sig-geos,

I'm starting to use package sp
and can't figure how to subscript an sp grid
object by coordinates. This is what I do:

First, I read the raster image of the example:

x <- GDAL.open(system.file("pictures/erdas_spnad83.tif", package = 
"rgdal")[1])
erdas_spnad83 <- asSGDF_GROD(x, output.dim=c(100,100))
GDAL.close(x)

Then I simplify to only 4 levels
test <- erdas_spnad83
test2 <- erdas_spnad83 at data
test2[test2<50]<- 1
test2[test2>1 & test2 <100]<- 2
test2[test2>2 & test2 <150]<- 3
test2[test2>=150]<- 4
test at data <- test2

and make an small example
test3 <- test[1:10,11:20]

and then perform an stratified sampling:
test3.stsamp <- spsample(test3, n = 10, "stratified")

Now, I would like to get the values of test3 at positions 
test3.stsamp at coords,
but
test3[test3.stsamp at coords]

does not work. How should I do it?

Thanks

Agus




-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Roger.Bivand at nhh.no  Fri Jun 15 22:57:08 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 15 Jun 2007 22:57:08 +0200 (CEST)
Subject: [R-sig-Geo] Subscripting by coordinates
In-Reply-To: <4672C069.8070700@ija.csic.es>
References: <4672C069.8070700@ija.csic.es>
Message-ID: <Pine.LNX.4.64.0706152248101.12433@reclus.nhh.no>

On Fri, 15 Jun 2007, Agustin Lobo wrote:

> Hi r-sig-geos,
>
> I'm starting to use package sp
> and can't figure how to subscript an sp grid
> object by coordinates. This is what I do:
>
> First, I read the raster image of the example:
>
> x <- GDAL.open(system.file("pictures/erdas_spnad83.tif", package =
> "rgdal")[1])
> erdas_spnad83 <- asSGDF_GROD(x, output.dim=c(100,100))
> GDAL.close(x)
>
> Then I simplify to only 4 levels
> test <- erdas_spnad83
> test2 <- erdas_spnad83 at data
> test2[test2<50]<- 1
> test2[test2>1 & test2 <100]<- 2
> test2[test2>2 & test2 <150]<- 3
> test2[test2>=150]<- 4
> test at data <- test2
>
> and make an small example
> test3 <- test[1:10,11:20]
>
> and then perform an stratified sampling:
> test3.stsamp <- spsample(test3, n = 10, "stratified")
>
> Now, I would like to get the values of test3 at positions
> test3.stsamp at coords,
> but
> test3[test3.stsamp at coords]
>
> does not work. How should I do it?

o <- overlay(test3, test3.stsamp)

works for me, returning a SpatialPointsDataFrame. Note that test2 is a 
data frame with column band1, so some of your code is potentially 
misleading:

test <- erdas_spnad83
names(test)
test$cut <- as.ordered(cut(test$band1, c(0,50,100,150,255),
   include.lowest=TRUE))
test3 <- test[1:10,11:20]
test3.stsamp <- spsample(test3, n = 10, "stratified")
o <- overlay(test3, test3.stsamp)
summary(o)

feels safer - the test2 assignments are only working because the data 
frame has one column.

Hope this helps,

Roger

>
> Thanks
>
> Agus
>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From macq at llnl.gov  Sat Jun 16 02:51:57 2007
From: macq at llnl.gov (Don MacQueen)
Date: Fri, 15 Jun 2007 17:51:57 -0700
Subject: [R-sig-Geo] Eliminate duplicate vertices in a
	SpatialPolygonsDataFrame object
Message-ID: <p0623090ac298e155a812@[128.115.153.6]>

I have managed to create several SpatialPoygonsDataFrame objects in 
which the polygons have duplicate vertices. That is, there are 
duplicate rows in the matrix in "coords" slot of the object.

In most cases, the object has just one polygon, but in at least one 
case it has an outer polygon and a hole.

I would really appreciate some suggestions about an efficient way to 
remove duplicate rows from the matrix containing the polygon vertices.

I have a solution using an application called Quantum GIS (the same 
app I used to create the duplicate rows without realizing it!), but 
it's rather awkward and tedious. Surely I can do better in R, but I 
haven't managed to learn yet how to extract, edit, update the 
contents of the coords slots (especially if there's more than one, as 
in a hole).

Any ideas would be very welcome.

Thanks
-Don
-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA



From d-hugh-jones at northwestern.edu  Sat Jun 16 03:26:49 2007
From: d-hugh-jones at northwestern.edu (David Hugh-Jones)
Date: Fri, 15 Jun 2007 18:26:49 -0700
Subject: [R-sig-Geo] newbie sp question
Message-ID: <f5d848060706151826y36a72d2fi1c3d88e33bb4bf48@mail.gmail.com>

Hi R-spatialists,

I'm working with a big list of polygons (imported into R with package
sp as a SpatialPolygonDataFrame, and I am trying to calculate minimum
distances between each pair of polygons. For this, I need to get the
lines for each polygons. At the moment I can't seem to find a way to
do this except to delve right in with

for (p in spdfc at polygons) {
	    for (q in p at Polygons)
			linesc <- rbind(linesc, coordinates(q))
 	}

and then to add the endpoints of linesc as columns 3 and 4 of the
matrix. Is there a simpler  way to extract lines from polygons?

Cheers
David



From Roger.Bivand at nhh.no  Sat Jun 16 22:06:29 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 16 Jun 2007 22:06:29 +0200 (CEST)
Subject: [R-sig-Geo] Eliminate duplicate vertices in a
 SpatialPolygonsDataFrame object
In-Reply-To: <p0623090ac298e155a812@[128.115.153.6]>
References: <p0623090ac298e155a812@[128.115.153.6]>
Message-ID: <Pine.LNX.4.64.0706162203350.15918@reclus.nhh.no>

On Fri, 15 Jun 2007, Don MacQueen wrote:

> I have managed to create several SpatialPoygonsDataFrame objects in
> which the polygons have duplicate vertices. That is, there are
> duplicate rows in the matrix in "coords" slot of the object.
>
> In most cases, the object has just one polygon, but in at least one
> case it has an outer polygon and a hole.
>
> I would really appreciate some suggestions about an efficient way to
> remove duplicate rows from the matrix containing the polygon vertices.

Do you know that the duplicate rows are next to each other, and that the 
distance between them is effectively equal to zero? If so, then perhaps 
you could provide a (subset) example, perhaps as an attached *.rda file 
frome save()?

Roger

>
> I have a solution using an application called Quantum GIS (the same
> app I used to create the duplicate rows without realizing it!), but
> it's rather awkward and tedious. Surely I can do better in R, but I
> haven't managed to learn yet how to extract, edit, update the
> contents of the coords slots (especially if there's more than one, as
> in a hole).
>
> Any ideas would be very welcome.
>
> Thanks
> -Don
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sat Jun 16 22:30:05 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 16 Jun 2007 22:30:05 +0200 (CEST)
Subject: [R-sig-Geo] newbie sp question
In-Reply-To: <f5d848060706151826y36a72d2fi1c3d88e33bb4bf48@mail.gmail.com>
References: <f5d848060706151826y36a72d2fi1c3d88e33bb4bf48@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706162206380.15918@reclus.nhh.no>

On Fri, 15 Jun 2007, David Hugh-Jones wrote:

> Hi R-spatialists,
>
> I'm working with a big list of polygons (imported into R with package
> sp as a SpatialPolygonDataFrame, and I am trying to calculate minimum
> distances between each pair of polygons. For this, I need to get the
> lines for each polygons. At the moment I can't seem to find a way to
> do this except to delve right in with
>
> for (p in spdfc at polygons) {
> 	    for (q in p at Polygons)
> 			linesc <- rbind(linesc, coordinates(q))
> 	}
>
> and then to add the endpoints of linesc as columns 3 and 4 of the
> matrix. Is there a simpler  way to extract lines from polygons?

No, this looks OK, though I would have said slot(spdfc, "polygons"), but 
there is no difference in practice. I would have kept the coordinates in a 
list of matrices rather than one matrix, in the first loop, because here 
you lose the polygon IDs.

You could go the way you are going now, then use the psp() and crossdist() 
functions in the spatstat package - they take single line segment 
patterns, so you'd need to break out the coordinates further to make psp 
objects, probably all in one shot.

I'd get the full matrix of distances, and retrieve the proper triangle by 
comparing pairs, which are not guaranteed to be equal - see the crossdist 
help page.

If you have geographical coordinates and world scale data, meaning you 
have to use Great Circle distances, the route via spapstat probably isn't 
viable. If you can project, you'd do that first, of course.

This is an interesting question, and I'm sure others would value hearing 
about your solution.

Best wishes,

Roger

>
> Cheers
> David
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From macq at llnl.gov  Sun Jun 17 00:34:07 2007
From: macq at llnl.gov (Don MacQueen)
Date: Sat, 16 Jun 2007 15:34:07 -0700
Subject: [R-sig-Geo] Eliminate duplicate vertices in a
 SpatialPolygonsDataFrame object
In-Reply-To: <p0623090ac298e155a812@[128.115.153.6]>
References: <p0623090ac298e155a812@[128.115.153.6]>
Message-ID: <p06240801c29a12c91d6f@[192.168.11.7]>

Another post to R-sig-geo gave me a hint! I now have a way to remove 
duplicate adjacent vertices.

Here's an outline for a simple single polygon case.
If the SpatialPollygonsDataFrame includes more than one polygon then 
some looping will be needed.


## tmpn is a SpatialPolygonsDataFrame with only one polygon
## and it has duplicate adjacent vertices
tmpfix <- tmpn

ickm <- tmpfix at polygons[[1]]@Polygons[[1]]@coords
ickmg <- rbind(ickm[!duplicated(ickm),], ickm[nrow(ickm),] )

tmpfix at polygons[[1]]@Polygons[[1]]@coords <- ickmg


## one way to test for success:
try( as.owin.SpatialPolygons(polygons(tmpfix)) )

Thanks
-Don


At 5:51 PM -0700 6/15/07, Don MacQueen wrote:
>I have managed to create several SpatialPoygonsDataFrame objects in
>which the polygons have duplicate vertices. That is, there are
>duplicate rows in the matrix in "coords" slot of the object.
>
>In most cases, the object has just one polygon, but in at least one
>case it has an outer polygon and a hole.
>
>I would really appreciate some suggestions about an efficient way to
>remove duplicate rows from the matrix containing the polygon vertices.
>
>I have a solution using an application called Quantum GIS (the same
>app I used to create the duplicate rows without realizing it!), but
>it's rather awkward and tedious. Surely I can do better in R, but I
>haven't managed to learn yet how to extract, edit, update the
>contents of the coords slots (especially if there's more than one, as
>in a hole).
>
>Any ideas would be very welcome.
>
>Thanks
>-Don
>--
>--------------------------------------
>Don MacQueen
>Environmental Protection Department
>Lawrence Livermore National Laboratory
>Livermore, CA, USA
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
---------------------------------
Don MacQueen
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062
macq at llnl.gov



From d-hugh-jones at northwestern.edu  Sun Jun 17 00:51:04 2007
From: d-hugh-jones at northwestern.edu (David Hugh-Jones)
Date: Sat, 16 Jun 2007 15:51:04 -0700
Subject: [R-sig-Geo] newbie sp question
In-Reply-To: <Pine.LNX.4.64.0706162206380.15918@reclus.nhh.no>
References: <f5d848060706151826y36a72d2fi1c3d88e33bb4bf48@mail.gmail.com>
	<Pine.LNX.4.64.0706162206380.15918@reclus.nhh.no>
Message-ID: <f5d848060706161551l6e7a9765gfe25ea67b00b146b@mail.gmail.com>

Thank you for this help. I realised after writing this that indeed,
spatstat won't work because I have world-scale data in unprojected
latitude/longitude form... so my distance measure is no use. This
leads to more questions

- is there a canonical way to convert projections from within "sp"? My
current thought is to get the raw data out and use "mapproj".
- when that's done, is there a function to measure great circle distance?
- would the algorithm "measure distance between all points of A and
all lines of B, then the same with A and B reversed, and take the
minimum", still work? I can't see why not but my intuition is not
clear.

Cheers
David


On 16/06/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 15 Jun 2007, David Hugh-Jones wrote:
>
> > Hi R-spatialists,
> >
> > I'm working with a big list of polygons (imported into R with package
> > sp as a SpatialPolygonDataFrame, and I am trying to calculate minimum
> > distances between each pair of polygons. For this, I need to get the
> > lines for each polygons. At the moment I can't seem to find a way to
> > do this except to delve right in with
> >
> > for (p in spdfc at polygons) {
> >           for (q in p at Polygons)
> >                       linesc <- rbind(linesc, coordinates(q))
> >       }
> >
> > and then to add the endpoints of linesc as columns 3 and 4 of the
> > matrix. Is there a simpler  way to extract lines from polygons?
>
> No, this looks OK, though I would have said slot(spdfc, "polygons"), but
> there is no difference in practice. I would have kept the coordinates in a
> list of matrices rather than one matrix, in the first loop, because here
> you lose the polygon IDs.
>
> You could go the way you are going now, then use the psp() and crossdist()
> functions in the spatstat package - they take single line segment
> patterns, so you'd need to break out the coordinates further to make psp
> objects, probably all in one shot.
>
> I'd get the full matrix of distances, and retrieve the proper triangle by
> comparing pairs, which are not guaranteed to be equal - see the crossdist
> help page.
>
> If you have geographical coordinates and world scale data, meaning you
> have to use Great Circle distances, the route via spapstat probably isn't
> viable. If you can project, you'd do that first, of course.
>
> This is an interesting question, and I'm sure others would value hearing
> about your solution.
>
> Best wishes,
>
> Roger
>
> >
> > Cheers
> > David
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



From irene.huse at imr.no  Sun Jun 17 03:25:14 2007
From: irene.huse at imr.no (Huse, Irene)
Date: Sun, 17 Jun 2007 03:25:14 +0200
Subject: [R-sig-Geo] Resoultion in LAT/LON when using WorldHires
Message-ID: <CCD1018747D71F44A0F7B4A347EBE00C4B5D2D@post3.imr.no>

Hi R-geo users,
I do hope this is a simple task for you, for me, a beginner, it's very difficult. When I plot my positions (of recaptured fish) in a map, the resolution is completely wrong, and the points "clings up in lines" (horizontal and vertical), and looks very funny. The positions I try to plot are not at all at lines.
 
library(maps)
library(mapdata)
par(bg="white",mar=c(3,1,1,1)) 
map('worldHires',xlim=c(30.40,30.65),ylim=c(70.60,70.70),type="n") 
rist1 <-read.table("C:\\rist1.txt")
colnames(rist1)<-c("lon","lat")
points(rist1$lon,rist1$lat,col="black")
map('worldHires',xlim=c(30.45,30.33),ylim=c(70.60,70.70),col="peach puff",fill=T,add=T) axis(1,c(30.40,30.45,30.50,30.55,30.60),c("30?24'E","30?27'E","30?30'E","30?33'E","30?36'E"))
axis(2,c(70.60,70.65,70.70),c("70?36'N","70?39'N","70?42'N"),las=1)

The rist1 looks like this:

30.500172222 70.666672222
30.500186111 70.666727778
30.450075 70.650263889
30.466930556 70.650161111
30.466930556 70.650161111
30.483411111 70.650144444
30.483505556 70.650125
30.4836 70.650105556
30.500266667 70.650052778
30.516844444 70.650016667
30.566852778 70.633472222
30.583436111 70.633441667
Etc etc

Is there a setting I have misused?

I would be very grateful for som help!

Yours sincerely,
Irene Huse

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Dr. Irene Huse                           <><
Forsker / Scientist
Havforskningsinstituttet / Institute of Marine Research
Postboks 1870 Nordnes, N-5817 Bergen, Norway
Office: Nordnesgt. 33
Tlf: +47 55 23 68 22                                                                      ><>
Faks/Fax +47 55 23 68 30
Mobil/Cell +47 4125 1661                           ><>
Internett: www.imr.no
irene.huse at imr.no                                                             <><



From irene.huse at imr.no  Sun Jun 17 03:43:48 2007
From: irene.huse at imr.no (Huse, Irene)
Date: Sun, 17 Jun 2007 03:43:48 +0200
Subject: [R-sig-Geo] Resoultion in LAT/LON when using WorldHires
Message-ID: <CCD1018747D71F44A0F7B4A347EBE00C4B5D2E@post3.imr.no>

Dear Geo-Users,
This is embarrassing. Please forgive me, there is something wrong in the
conversion of the positions, not the map resolution.
Please look away from the previous message!
Br
Irene

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Dr. Irene Huse                           <><
Forsker / Scientist
Havforskningsinstituttet / Institute of Marine Research
Postboks 1870 Nordnes, N-5817 Bergen, Norway
Office: Nordnesgt. 33
Tlf: +47 55 23 68 22
><>
Faks/Fax +47 55 23 68 30
Mobil/Cell +47 4125 1661                           ><>
Internett: www.imr.no
irene.huse at imr.no
<><



From Roger.Bivand at nhh.no  Sun Jun 17 18:25:42 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 17 Jun 2007 18:25:42 +0200 (CEST)
Subject: [R-sig-Geo] newbie sp question
In-Reply-To: <f5d848060706161551l6e7a9765gfe25ea67b00b146b@mail.gmail.com>
References: <f5d848060706151826y36a72d2fi1c3d88e33bb4bf48@mail.gmail.com>
	<Pine.LNX.4.64.0706162206380.15918@reclus.nhh.no>
	<f5d848060706161551l6e7a9765gfe25ea67b00b146b@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706171812310.14432@reclus.nhh.no>

On Sat, 16 Jun 2007, David Hugh-Jones wrote:

> Thank you for this help. I realised after writing this that indeed,
> spatstat won't work because I have world-scale data in unprojected
> latitude/longitude form... so my distance measure is no use. This
> leads to more questions
>
> - is there a canonical way to convert projections from within "sp"? My
> current thought is to get the raw data out and use "mapproj".

The spTransform() methods in rgdal.

> - when that's done, is there a function to measure great circle distance?

Well, if your data are world data, you probably want to work in great 
circle distances directly, which you can get from spDistsN1 from a matrix 
of points to a single point.

> - would the algorithm "measure distance between all points of A and
> all lines of B, then the same with A and B reversed, and take the
> minimum", still work? I can't see why not but my intuition is not
> clear.

With GC distances, point to line is much harder. You may be obliged to use 
point to point, which will be symmetric, but is an approximation of line 
to line. If the differences may matter badly, you'll need to interpolate 
points and add them to long straight segments.

It may also be worth asking on the PostGIS list whether you could upload 
your geometries to PostGIS and have GEOS do the measurement - if you have 
access to the software and experience with it. It may be that it can 
handle geographical coordinates.

Best wishes,

Roger

>
> Cheers
> David
>
>
> On 16/06/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Fri, 15 Jun 2007, David Hugh-Jones wrote:
>>
>>> Hi R-spatialists,
>>>
>>> I'm working with a big list of polygons (imported into R with package
>>> sp as a SpatialPolygonDataFrame, and I am trying to calculate minimum
>>> distances between each pair of polygons. For this, I need to get the
>>> lines for each polygons. At the moment I can't seem to find a way to
>>> do this except to delve right in with
>>>
>>> for (p in spdfc at polygons) {
>>>           for (q in p at Polygons)
>>>                       linesc <- rbind(linesc, coordinates(q))
>>>       }
>>>
>>> and then to add the endpoints of linesc as columns 3 and 4 of the
>>> matrix. Is there a simpler  way to extract lines from polygons?
>>
>> No, this looks OK, though I would have said slot(spdfc, "polygons"), but
>> there is no difference in practice. I would have kept the coordinates in a
>> list of matrices rather than one matrix, in the first loop, because here
>> you lose the polygon IDs.
>>
>> You could go the way you are going now, then use the psp() and crossdist()
>> functions in the spatstat package - they take single line segment
>> patterns, so you'd need to break out the coordinates further to make psp
>> objects, probably all in one shot.
>>
>> I'd get the full matrix of distances, and retrieve the proper triangle by
>> comparing pairs, which are not guaranteed to be equal - see the crossdist
>> help page.
>>
>> If you have geographical coordinates and world scale data, meaning you
>> have to use Great Circle distances, the route via spapstat probably isn't
>> viable. If you can project, you'd do that first, of course.
>>
>> This is an interesting question, and I'm sure others would value hearing
>> about your solution.
>>
>> Best wishes,
>>
>> Roger
>>
>>>
>>> Cheers
>>> David
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From t.szegvary at unibas.ch  Mon Jun 18 16:33:47 2007
From: t.szegvary at unibas.ch (Thomas Szegvary)
Date: Mon, 18 Jun 2007 16:33:47 +0200
Subject: [R-sig-Geo] Geographical coordinates
Message-ID: <003b01c7b1b5$ae748fe0$44349883@D59QMB1J>

Hi there

I have an ordinary kriging result (gstat), which is in a projected
coordinate system of course (I used
proj4string(data)=CRS("+init=epsg:4326"). But I will need the map in
geographical coordinates (lon, lat...) for visualisation. How can I
back-project the map?
Thanks 
Thomas


__

Thomas Szegvary
Institute of Environmental Geosciences
Department of Geosciences
University of Basel
Bernoullistrasse 30
CH - 4056 Basel

Tel.  41-61-267 04 82
Fax. 41-61-267 04 79
Email: t.szegvary at unibas.ch
www.radon.unibas.ch
www.unibas.ch/environment



From T.Szegvary at unibas.ch  Mon Jun 18 21:29:35 2007
From: T.Szegvary at unibas.ch (Thomas Szegvary)
Date: Mon, 18 Jun 2007 21:29:35 +0200
Subject: [R-sig-Geo] ascii grid from arcgis
Message-ID: <1182194975.4676dd1f75d74@webmail.unibas.ch>

sorry for spamming all of you with my problems...but here's another one:

I have ascii grids from ESRI ArcGIS in the following format:
ncols         42
nrows         36
xllcorner     -10.311630235357
yllcorner     35.110501339805
cellsize      1
NODATA_value  -9999

Is there an already existing comand to plot that type of grid? or do I have to
(re)define the grid?

Thanks a lot for any help
Thomas

--
Thomas Szegvary
Environmental Geosciences
University of Basel
Bernoullistrasse 30
CH-4056 Basel
Switzerland

Tel. ++41-61-267 04
Fax. ++41-61-267 04 79



From lee.kitty at yahoo.com  Tue Jun 19 01:49:19 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Mon, 18 Jun 2007 16:49:19 -0700 (PDT)
Subject: [R-sig-Geo] Fall into which voronoi?
Message-ID: <900230.26568.qm@web36307.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070618/ec1078ed/attachment.pl>

From lee.kitty at yahoo.com  Tue Jun 19 02:59:27 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Mon, 18 Jun 2007 17:59:27 -0700 (PDT)
Subject: [R-sig-Geo] Fall into which voronoi? (Follow Up)
Message-ID: <463305.29840.qm@web36312.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070618/6d1a1fa5/attachment.pl>

From mdsumner at utas.edu.au  Tue Jun 19 04:15:04 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Tue, 19 Jun 2007 12:15:04 +1000
Subject: [R-sig-Geo] ascii grid from arcgis
Message-ID: <200706190215.l5J2F5MO026821@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070619/ee21f3ac/attachment.pl>

From mdsumner at utas.edu.au  Tue Jun 19 04:19:28 2007
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Tue, 19 Jun 2007 12:19:28 +1000
Subject: [R-sig-Geo] Geographical coordinates
Message-ID: <200706190219.l5J2JUSB029162@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070619/dbaf813b/attachment.pl>

From tskam at smu.edu.sg  Tue Jun 19 04:48:33 2007
From: tskam at smu.edu.sg (KAM Tin Seong)
Date: Tue, 19 Jun 2007 10:48:33 +0800
Subject: [R-sig-Geo] ESRI ASCII Grid file shifted
Message-ID: <FA3090E732DC6A4EB8E2D875EEB486A562CC26@EX01.staff.smu.edu.sg>

Hi all,

I am new to R and would like to get some advice.  I performed kernel
density estimation using spatstat.  The point data (i.e. drawing) is in
ESRI shapefile format.  It was read in using "readShapePoints" of
maptools.  After the analysis, the result was exported using
"writeAsciiGrid" of maptools.  The entire codes are as follows:

library(spatstat)
library(maptools)
d=readShapePoints("C:/TEMP/shp/drawing")
w = owin(c(-15000,16500),c(-15000,15000))
dppp=as(d["DHL_Sales"], "ppp")
cpt = ppp(x=dppp$x, y=dppp$y, marks=dppp$marks, window=w)
plot(dppp)
z = density.ppp(cpt, 500)
image(z)
gridded_z = as.SpatialGridDataFrame.im(z)
writeAsciiGrid(gridded_z, "C:/TEMP/grid/KDE_Store1.asc")

When I compared the exported grid file (i.e. KDE_Store1) with the input
shapefile (i.e. drawing), I notice that there is a shift in the grid
file.  Refer to the enclosed screenshoot.  I wonder if anyone can advice
me whats went wrong.

Thanks in advance.   

 <<KDE1.jpg>>  <<drawing.zip>> 

Dr Kam Tin Seong 
Practice Associate Professor 
School of Information Systems 

Singapore Management University 
80 Stamford Road 
Singapore 178902 
e-mail: tskam at smu.edu.sg 
DID: + 65 6828 0932


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070619/fded3892/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: KDE1.jpg
Type: image/jpeg
Size: 37650 bytes
Desc: KDE1.jpg
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070619/fded3892/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: drawing.zip
Type: application/x-zip-compressed
Size: 65774 bytes
Desc: drawing.zip
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070619/fded3892/attachment.bin>

From tskam at smu.edu.sg  Tue Jun 19 05:21:23 2007
From: tskam at smu.edu.sg (KAM Tin Seong)
Date: Tue, 19 Jun 2007 11:21:23 +0800
Subject: [R-sig-Geo] ESRI ASCII Grid file shifted
References: <FA3090E732DC6A4EB8E2D875EEB486A562CC26@EX01.staff.smu.edu.sg>
Message-ID: <FA3090E732DC6A4EB8E2D875EEB486A562CC27@EX01.staff.smu.edu.sg>


> Hi all,
> 
> I am new to R and would like to get some advice.  I performed kernel
> density estimation using spatstat.  The point data (i.e. drawing) is
> in ESRI shapefile format.  It was read in using "readShapePoints" of
> maptools.  After the analysis, the result was exported using
> "writeAsciiGrid" of maptools.  The entire codes are as follows:
> 
> library(spatstat)
> library(maptools)
> d=readShapePoints("C:/TEMP/shp/drawing")
> w = owin(c(-15000,16500),c(-15000,15000))
> dppp=as(d["DHL_Sales"], "ppp")
> cpt = ppp(x=dppp$x, y=dppp$y, marks=dppp$marks, window=w)
> plot(dppp)
> z = density.ppp(cpt, 500)
> image(z)
> gridded_z = as.SpatialGridDataFrame.im(z)
> writeAsciiGrid(gridded_z, "C:/TEMP/grid/KDE_Store1.asc")
> 
> When I compared the exported grid file (i.e. KDE_Store1) with the
> input shapefile (i.e. drawing), I notice that there is a shift in the
> grid file.  Refer to the enclosed screenshoot.  I wonder if anyone can
> advice me whats went wrong.
> 
> Thanks in advance.   
> 
>  <<KDE1.jpg>> 
> Dr Kam Tin Seong 
> Practice Associate Professor 
> School of Information Systems 
> 
> Singapore Management University 
> 80 Stamford Road 
> Singapore 178902 
> e-mail: tskam at smu.edu.sg 
> DID: + 65 6828 0932
> 
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070619/0302d480/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: KDE1.jpg
Type: image/jpeg
Size: 37650 bytes
Desc: KDE1.jpg
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070619/0302d480/attachment.jpg>

From tskam at smu.edu.sg  Tue Jun 19 17:24:26 2007
From: tskam at smu.edu.sg (KAM Tin Seong)
Date: Tue, 19 Jun 2007 23:24:26 +0800
Subject: [R-sig-Geo] convert sp's Spatial Point Data Frame into Splancs
	data object
References: <FA3090E732DC6A4EB8E2D875EEB486A562CC26@EX01.staff.smu.edu.sg>
Message-ID: <FA3090E732DC6A4EB8E2D875EEB486A55363E4@EX01.staff.smu.edu.sg>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070619/7dfd2fee/attachment.pl>

From Roger.Bivand at nhh.no  Wed Jun 20 08:50:13 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 20 Jun 2007 08:50:13 +0200 (CEST)
Subject: [R-sig-Geo] ascii grid from arcgis
In-Reply-To: <200706190215.l5J2F5MO026821@corinna.its.utas.edu.au>
References: <200706190215.l5J2F5MO026821@corinna.its.utas.edu.au>
Message-ID: <Pine.LNX.4.64.0706200849160.29538@reclus.nhh.no>

On Tue, 19 Jun 2007, Michael Sumner wrote:

> You ought to be able to read that using readGDAL (rgdal) which will
> return you a SpatialGridDataFrame.  You then have methods for image and
> spplot that will work:

Or for OSX users without rgdal, there is a simple readAsciiGrid() function 
in maptools to do the same.

Roger

>
>
> ## NOT TESTED:
> library(rgdal)
> asc <- "file.asc"  ## or whatever it is
> g <- readGDAL(asc)
>
> summary(g)
>
> image(g)
>
> ## OR
> spplot(g)
>
>
> ==============Original message text===============
> On Tue, 19 Jun 2007 5:29:35 +1000 Thomas Szegvary wrote:
>
> sorry for spamming all of you with my problems...but here's another one:
>
> I have ascii grids from ESRI ArcGIS in the following format:
> ncols         42
> nrows         36
> xllcorner     -10.311630235357
> yllcorner     35.110501339805
> cellsize      1
> NODATA_value  -9999
>
> Is there an already existing comand to plot that type of grid? or do I have to
> (re)define the grid?
>
> Thanks a lot for any help
> Thomas
>
> --
> Thomas Szegvary
> Environmental Geosciences
> University of Basel
> Bernoullistrasse 30
> CH-4056 Basel
> Switzerland
>
> Tel. ++41-61-267 04
> Fax. ++41-61-267 04 79
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> ===========End of original message text===========
>
>
>
> If it wasn't backed-up, then it wasn't important. ~ Anon sysadmin
>
> Mike Sumner (Phd. Candidate)
> http://www.antcrc.utas.edu.au/~mdsumner/ http://www.zoo.utas.edu.au/awru/  IASOS/AWRU
> University of Tasmania
> Private Bag 80
> Hobart Tasmania 7001
> AUSTRALIA
> Email: mdsumner at utas.edu.au
> Phone: 03 6226 1752 (W)
>       0408599921   (M)
> Fax:   03 6226 2745
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Wed Jun 20 08:55:18 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 20 Jun 2007 08:55:18 +0200 (CEST)
Subject: [R-sig-Geo] Geographical coordinates
In-Reply-To: <200706190219.l5J2JUSB029162@corinna.its.utas.edu.au>
References: <200706190219.l5J2JUSB029162@corinna.its.utas.edu.au>
Message-ID: <Pine.LNX.4.64.0706200851280.29538@reclus.nhh.no>

On Tue, 19 Jun 2007, Michael Sumner wrote:

> AFAIK, 4326 is the PROJ.4 code for "+proj=longlat". You should find that
>
> proj4string(data)
>
> shows you something like that string above, and
>
> summary(data)
>
> will report that it is not projected.

This is provided that rgdal is loaded, so that the system knows how to 
look up the EPSG code.

>
> In general, please provide at least the results of summary on your data
> object/s.
>

Very good advice. Otherwise, it is hard to see what you are doing. Please 
also note that a grid in projected coordinates will not be a grid in 
geographical coordinates, and vice-versa.

> BTW, just because you used kriging does not at all mean that the data are
> "projected" - at the visualization and (some) analytical levels longlat
> is treated just like any other rectangular coordinate system.
>
> HTH
>
> Cheers, Mike.
>
> ==============Original message text===============
> On Tue, 19 Jun 2007 0:33:47 +1000 "Thomas Szegvary" wrote:
>
> Hi there
>
> I have an ordinary kriging result (gstat), which is in a projected
> coordinate system of course (I used
> proj4string(data)=CRS("+init=epsg:4326"). But I will need the map in
> geographical coordinates (lon, lat...) for visualisation. How can I
> back-project the map?
> Thanks
> Thomas
>
>
> __
>
> Thomas Szegvary
> Institute of Environmental Geosciences
> Department of Geosciences
> University of Basel
> Bernoullistrasse 30
> CH - 4056 Basel
>
> Tel.  41-61-267 04 82
> Fax. 41-61-267 04 79
> Email: t.szegvary at unibas.ch
> www.radon.unibas.ch
> www.unibas.ch/environment
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> ===========End of original message text===========
>
>
>
> If it wasn't backed-up, then it wasn't important. ~ Anon sysadmin
>
> Mike Sumner (Phd. Candidate)
> http://www.antcrc.utas.edu.au/~mdsumner/ http://www.zoo.utas.edu.au/awru/  IASOS/AWRU
> University of Tasmania
> Private Bag 80
> Hobart Tasmania 7001
> AUSTRALIA
> Email: mdsumner at utas.edu.au
> Phone: 03 6226 1752 (W)
>       0408599921   (M)
> Fax:   03 6226 2745
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Wed Jun 20 09:37:09 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 20 Jun 2007 09:37:09 +0200 (CEST)
Subject: [R-sig-Geo] convert sp's Spatial Point Data Frame into Splancs
 data object
In-Reply-To: <FA3090E732DC6A4EB8E2D875EEB486A55363E4@EX01.staff.smu.edu.sg>
References: <FA3090E732DC6A4EB8E2D875EEB486A562CC26@EX01.staff.smu.edu.sg>
	<FA3090E732DC6A4EB8E2D875EEB486A55363E4@EX01.staff.smu.edu.sg>
Message-ID: <Pine.LNX.4.64.0706200905250.29538@reclus.nhh.no>

On Tue, 19 Jun 2007, KAM Tin Seong wrote:

> Hi all,
>
> I have a set of point data in sp's Spatial Point Data Frame format and 
> would like to analyse this data using Splancs, can someone advice me how 
> should I go about doing it.  By the way how to define a Splancs poly 
> object.

You asked a related (but incomplete) question a short time ago. It seems 
that you want to make a gridded kernel density object from a possibly 
marked point pattern. Without a redpoducible example (ie. a canned or 
random point pattern with a fixed seed), it is difficult to reply to your 
claim that the output grid is shifted. It would be useful to find out 
whether you are right or not, so before trying splance, please complete 
your work on spatstat. Please attach or make available on a website data 
that demonstrates your problem, and then we can see if it is a grid shift 
or not. The data do not have to be the complete original data, but should 
demonstrate the problem given your code.

If it then turns out that there is a grid shift, it can be attended to. I 
am not online, and cannot view your image attachments.

Roger

>
>
> Dr Kam Tin Seong
> Practice Associate Professor
> School of Information Systems
>
> Singapore Management University
> 80 Stamford Road
> Singapore 178902
> e-mail: tskam at smu.edu.sg <mailto:tskam at smu.edu.sg>
> DID: + 65 6828 0932
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Wed Jun 20 09:42:37 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 20 Jun 2007 09:42:37 +0200 (CEST)
Subject: [R-sig-Geo] Fall into which voronoi? (Follow Up)
In-Reply-To: <463305.29840.qm@web36312.mail.mud.yahoo.com>
References: <463305.29840.qm@web36312.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.64.0706200938400.29723@reclus.nhh.no>

On Mon, 18 Jun 2007, Kitty Lee wrote:

> Just want to follow up from my earlier post....

This is overlay() in the sp package for SpatialPolygons and SpatialPoints, 
and you will need to use the deldir package to provide polygons of bounded 
rather than infinite area - see the thread refered to here:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/96588.html

Roger

>
> Since the voronoi polygon layer and the point layer share the same study 
> area, is there a way to do a 'spatial joint' such that I can find out 
> the points fall into which polygon?
>
> And to have a dataset like the following:
>
> Caseid xc yc voronoi.polygon
> 1    -114.18   34.23        1
> 2  -114.25   34.25        1
> 3 -114.33   34.55        2
> 4 -114.49   34.56        3
>
> Thanks again!!!
>
> K.
>
>
> ---------------------------------
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Agustin.Lobo at ija.csic.es  Wed Jun 20 10:11:36 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Wed, 20 Jun 2007 10:11:36 +0200
Subject: [R-sig-Geo] spsample and NA
Message-ID: <4678E138.8030901@ija.csic.es>

It is often the case, at least with raster (grid) objects,
that you are not interested on a part of the raster.
For example because it's outside a non.rectangular region of study
and/or because some types of terrain (some classes) are outside
the scope of the study. In any case, those parts can be
represented by NA.

Unfortunately, while some functions like table() would not
include the NA in the statistics, spsample includes
the NA as just another class, which implies that a fraction
of the resulting coordinates will lay on the NA
part of the raster. This makes it difficult, to get N valid (i.e., not 
on NA parts) points using spsample. Is there any way around this?
For example, if I want 10 points on non-NA cells of
raster X, I would like

spsample(X, 10, "stratified")

to provide 10 positions on non-NA cells.

At the moment, I get:

x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(100,100))
GDAL.close(x)

ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA

X <- ESTRAT3OBAC
X$cut <- as.ordered(cut(X$band1, c(0,10,100),include.lowest=TRUE))
table(X$cut)

   [0,10] (10,100]
       83     1961

summary(X$cut)
   [0,10] (10,100]     NA's
       83     1961     7956
table(X$cut)

   [0,10] (10,100]
       83     1961

Xspsample <- spsample(X,10,"stratified")
Xo <- overlay(X,Xspsample)
summary(Xo)
Object of class SpatialPointsDataFrame
Coordinates:
          min       max
x1  410995.6  414954.4
x2 4608002.1 4610566.0
Is projected: TRUE
proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
Number of points: 9
Data attributes:
      band1             cut
  Min.   :   67   [0,10]  :0
  1st Qu.:   97   (10,100]:3
  Median :  159   NA's    :6
  Mean   :24745
  3rd Qu.:55537
  Max.   :55537

That is, I get 6 positions on NA values of X

Thanks!

Agus

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From qobek at aemail4u.com  Wed Jun 20 15:41:58 2007
From: qobek at aemail4u.com (Frederic)
Date: Wed, 20 Jun 2007 15:41:58 +0200
Subject: [R-sig-Geo] From that,
	you can add in the necessary padding and attach it to the edge of
	the other component, as shown here.
Message-ID: <000f01c7b340$c6317f80$a6e2b445@egbn.qwbr>

It also reports diagnostic messages with the help  of a
DiagnosticListener instance.
http://zzwrong.hk/



From milton_ruser at yahoo.com.br  Wed Jun 20 16:28:36 2007
From: milton_ruser at yahoo.com.br (Milton Cezar Ribeiro)
Date: Wed, 20 Jun 2007 07:28:36 -0700 (PDT)
Subject: [R-sig-Geo] Generating vetor (shapefiles) in R
Message-ID: <500996.9292.qm@web56615.mail.re3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070620/1023a621/attachment.pl>

From Roger.Bivand at nhh.no  Wed Jun 20 22:26:06 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 20 Jun 2007 22:26:06 +0200
Subject: [R-sig-Geo] ODP:  spsample and NA
References: <4678E138.8030901@ija.csic.es>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C40512BD@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070620/d34d8ca1/attachment.pl>

From Roger.Bivand at nhh.no  Wed Jun 20 22:29:16 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 20 Jun 2007 22:29:16 +0200
Subject: [R-sig-Geo] ODP:  Generating vetor (shapefiles) in R
References: <500996.9292.qm@web56615.mail.re3.yahoo.com>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C40512BE@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070620/556cf81b/attachment.pl>

From adrian at maths.uwa.edu.au  Thu Jun 21 09:15:26 2007
From: adrian at maths.uwa.edu.au (adrian at maths.uwa.edu.au)
Date: Thu, 21 Jun 2007 15:15:26 +0800 (WST)
Subject: [R-sig-Geo] spatstat version 2
Message-ID: <35219.130.95.98.17.1182410126.squirrel@130.95.98.17>

              SPATSTAT version 2

Spatstat is an R package for the statistical analysis of spatial data.

A preliminary announcement about the forthcoming Version 2 of spatstat
is available here:
    <www.spatstat.org/spatstat/spatstat2.html>



From Agustin.Lobo at ija.csic.es  Thu Jun 21 09:41:24 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Thu, 21 Jun 2007 09:41:24 +0200
Subject: [R-sig-Geo] ODP:  spsample and NA
In-Reply-To: <AD51AB79BC327C40AB2C7EB75D57A3C40512BD@TOLAR.valuta.nhh.no>
References: <4678E138.8030901@ija.csic.es>
	<AD51AB79BC327C40AB2C7EB75D57A3C40512BD@TOLAR.valuta.nhh.no>
Message-ID: <467A2BA4.2020200@ija.csic.es>

The test with meuse.grid works:

#copied from file:SpatialGridDataFrame-class.html
coordinates(meuse.grid) = c("x", "y") # promote toSpatialPointsDataFrame
gridded(meuse.grid) <- TRUE # promote to SpatialPixelsDataFrame
x = as(meuse.grid, "SpatialGridDataFrame") # creates the full grid
#Now me:
 > unique(x at data$soil)
[1] NA  1  2  3

 > table(x at data$soil)
    1    2    3
1665 1084  354

test.stsamp <- spsample(x, n = 10, "stratified")
o <- overlay(x, test.stsamp)
 > o
           coordinates part.a part.b      dist soil ffreq
5556 (179156, 330917)      0      1 0.1030270    1     1
6670 (180039, 330336)      0      1 0.0703333    1     2
2240 (180677, 332606)      1      0 0.0975136    1     1


But don't know how to make that my raster behave in the same way. What
does it mean "cast to SpatialPixels first"? I thought that as
X comes from an imported raster it was an sp object already.

Also, there are several components in the x coming from meuse.grid:
str(x)
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
   ..@ data       :'data.frame': 8112 obs. of  5 variables:
   .. ..$ part.a: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
   .. ..$ part.b: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
   .. ..$ dist  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
   .. ..$ soil  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
   .. ..$ ffreq : Factor w/ 3 levels "1","2","3": NA NA NA NA NA NA NA 
NA NA NA ...

how does spsample know which layer has to be used for the stratification?

Thanks!

Agus

Roger Bivand escribi?:
> I think that if you cast to SpatialPixels first, the problem will go away, because the all-NA cases are dropped with their coordinates. Could you try the same example with meuse.grid and see how it goes?
>  
> Roger
>  
> ---
> Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no
> 
> ________________________________
> 
> Od: r-sig-geo-bounces at stat.math.ethz.ch w imieniu Agustin Lobo
> Wys?ano: ?r 20.06.2007 10:11
> Do: R-sig-Geo at stat.math.ethz.ch
> Temat: [R-sig-Geo] spsample and NA
> 
> 
> 
> It is often the case, at least with raster (grid) objects,
> that you are not interested on a part of the raster.
> For example because it's outside a non.rectangular region of study
> and/or because some types of terrain (some classes) are outside
> the scope of the study. In any case, those parts can be
> represented by NA.
> 
> Unfortunately, while some functions like table() would not
> include the NA in the statistics, spsample includes
> the NA as just another class, which implies that a fraction
> of the resulting coordinates will lay on the NA
> part of the raster. This makes it difficult, to get N valid (i.e., not
> on NA parts) points using spsample. Is there any way around this?
> For example, if I want 10 points on non-NA cells of
> raster X, I would like
> 
> spsample(X, 10, "stratified")
> 
> to provide 10 positions on non-NA cells.
> 
> At the moment, I get:
> 
> x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
> ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(100,100))
> GDAL.close(x)
> 
> ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
> 
> X <- ESTRAT3OBAC
> X$cut <- as.ordered(cut(X$band1, c(0,10,100),include.lowest=TRUE))
> table(X$cut)
> 
>    [0,10] (10,100]
>        83     1961
> 
> summary(X$cut)
>    [0,10] (10,100]     NA's
>        83     1961     7956
> table(X$cut)
> 
>    [0,10] (10,100]
>        83     1961
> 
> Xspsample <- spsample(X,10,"stratified")
> Xo <- overlay(X,Xspsample)
> summary(Xo)
> Object of class SpatialPointsDataFrame
> Coordinates:
>           min       max
> x1  410995.6  414954.4
> x2 4608002.1 4610566.0
> Is projected: TRUE
> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
> Number of points: 9
> Data attributes:
>       band1             cut
>   Min.   :   67   [0,10]  :0
>   1st Qu.:   97   (10,100]:3
>   Median :  159   NA's    :6
>   Mean   :24745
>   3rd Qu.:55537
>   Max.   :55537
> 
> That is, I get 6 positions on NA values of X
> 
> Thanks!
> 
> Agus
> 
> --
> Dr. Agustin Lobo
> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
> LLuis Sole Sabaris s/n
> 08028 Barcelona
> Spain
> Tel. 34 934095410
> Fax. 34 934110012
> email: Agustin.Lobo at ija.csic.es
> http://www.ija.csic.es/gt/obster
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Roger.Bivand at nhh.no  Thu Jun 21 12:32:10 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 21 Jun 2007 12:32:10 +0200
Subject: [R-sig-Geo] ODP: ODP:  spsample and NA
References: <4678E138.8030901@ija.csic.es>
	<AD51AB79BC327C40AB2C7EB75D57A3C40512BD@TOLAR.valuta.nhh.no>
	<467A2BA4.2020200@ija.csic.es>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C40512C0@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070621/84849dc1/attachment.pl>

From giojona at gmail.com  Thu Jun 21 16:25:57 2007
From: giojona at gmail.com (giovanna jona lasinio)
Date: Thu, 21 Jun 2007 16:25:57 +0200
Subject: [R-sig-Geo] krige.bayes output
In-Reply-To: <mailman.19.1182420008.7578.r-sig-geo@stat.math.ethz.ch>
References: <mailman.19.1182420008.7578.r-sig-geo@stat.math.ethz.ch>
Message-ID: <467A8A75.1070703@uniroma1.it>

Dear all,
I'm running a bayesian kriging using krige.bayes in the geoR library. 
I'm using a linux machine with R 2.4. I'm running a chain of annual 
surfaces estimation and I'm using every year's output to build the prior 
for the next one through the function post2prior (always, geoR library). 
My predictive distribution is back-transformed (Box-Cox) from Gaussian 
(log transformation).

My problem concerns the krige.bayes output, in the predictive list I 
find an element named uncertainty of the same length as my surface. I 
was not able to find any explanation of what is in it searching the help 
and the mailing list archive.
Does anyone know what  is it?

Best
Giovanna Jona Lasinio



From milton_ruser at yahoo.com.br  Thu Jun 21 16:54:00 2007
From: milton_ruser at yahoo.com.br (Milton Cezar Ribeiro)
Date: Thu, 21 Jun 2007 07:54:00 -0700 (PDT)
Subject: [R-sig-Geo] Res: ODP:  Generating vetor (shapefiles) in R
Message-ID: <837103.20861.qm@web56609.mail.re3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070621/bbd76847/attachment.pl>

From paulojus at c3sl.ufpr.br  Thu Jun 21 19:24:12 2007
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Thu, 21 Jun 2007 14:24:12 -0300 (BRT)
Subject: [R-sig-Geo] krige.bayes output
In-Reply-To: <467A8A75.1070703@uniroma1.it>
References: <mailman.19.1182420008.7578.r-sig-geo@stat.math.ethz.ch>
	<467A8A75.1070703@uniroma1.it>
Message-ID: <Pine.LNX.4.58.0706211407511.17611@macalan.c3sl.ufpr.br>

Dear Giovanna

For certain values of the Box-Cox transformation it is not possible to
compute kriging variances.
Therefore a measure of the uncertainty of the predictions is computed by
(Q3-Q1)/4
where Q3 and Q1 are the 3rd and 1st quartiles

best
P.J.


Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

On Thu, 21 Jun 2007, giovanna jona lasinio wrote:

> Dear all,
> I'm running a bayesian kriging using krige.bayes in the geoR library.
> I'm using a linux machine with R 2.4. I'm running a chain of annual
> surfaces estimation and I'm using every year's output to build the prior
> for the next one through the function post2prior (always, geoR library).
> My predictive distribution is back-transformed (Box-Cox) from Gaussian
> (log transformation).
>
> My problem concerns the krige.bayes output, in the predictive list I
> find an element named uncertainty of the same length as my surface. I
> was not able to find any explanation of what is in it searching the help
> and the mailing list archive.
> Does anyone know what  is it?
>
> Best
> Giovanna Jona Lasinio
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From rmk at krugs.de  Fri Jun 22 09:36:46 2007
From: rmk at krugs.de (Rainer M. Krug)
Date: Fri, 22 Jun 2007 09:36:46 +0200
Subject: [R-sig-Geo] Res: ODP:  Generating vetor (shapefiles) in R
In-Reply-To: <837103.20861.qm@web56609.mail.re3.yahoo.com>
References: <837103.20861.qm@web56609.mail.re3.yahoo.com>
Message-ID: <467B7C0E.2030308@krugs.de>

What about using grass 6 and the command r.to.vect - you can do this 
from R with the package spgrass6

Rainer


Milton Cezar Ribeiro wrote:
> Dear Roger,
> 
> I am simulating some analyzes on R, and the output are a lot of AscGrid (raster) maps. After generate these maps (about 1,000 of them), I need convert these maps to vector (shapefiles) format, because I need join some attributes to each feature (polygon). I can do it on ArcGis, and use the spatial analyst extentention, and convert one by one, but unfortunately as I have 1,000 maps, it is so time consuming.
> 
> I thougth that there are some package/function on R that vectorize a raster (ascGrid) format.
> 
> Any ideas?
> 
> miltinho
> 
> 
> ----- Mensagem original ----
> De: Roger Bivand <Roger.Bivand at nhh.no>
> Para: Milton Cezar Ribeiro <milton_ruser at yahoo.com.br>; r-sig-geo at stat.math..ethz.ch
> Enviadas: Quarta-feira, 20 de Junho de 2007 17:29:16
> Assunto: ODP: [R-sig-Geo] Generating vetor (shapefiles) in R
> 
> 
> Grids are not vector format - you could coerce the SpatialGridDataFrame to a SpatialPointsDataFrame, but is this the kind of output you need? SpatialPixels can also be coerced to SpatialPolygons rectangles, but what you do will depend on your needs.
>  
> Roger
>  
> --- Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no
> 
> 
> 
> 
> Od: r-sig-geo-bounces at stat.math.ethz.ch w imieniu Milton Cezar Ribeiro
> Wys???ano: ???r 20.06.2007 16:28
> Do: r-sig-geo at stat.math.ethz.ch
> Temat: [R-sig-Geo] Generating vetor (shapefiles) in R
> 
> 
> Hi there,
> 
> I need to convert a raster (ascGrid) format to Shape files.
> Is there a way of to do that on R?
> 
> Kind regards
> 
> miltinho
> 
> 
>       
> ____________________________________________________________________________________
> 
> http://yahoo.com.br/oqueeuganhocomisso
>         [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
>        
> ____________________________________________________________________________________
> 
> http://yahoo.com.br/oqueeuganhocomisso 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From Roger.Bivand at nhh.no  Fri Jun 22 14:12:31 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 22 Jun 2007 14:12:31 +0200
Subject: [R-sig-Geo] ESRI ASCII Grid file shifted
References: <FA3090E732DC6A4EB8E2D875EEB486A562CC26@EX01.staff.smu.edu.sg>
	<FA3090E732DC6A4EB8E2D875EEB486A562CC27@EX01.staff.smu.edu.sg>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C40512C6@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070622/53a1bb92/attachment.pl>

From Agustin.Lobo at ija.csic.es  Fri Jun 22 15:09:30 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Fri, 22 Jun 2007 15:09:30 +0200
Subject: [R-sig-Geo] distmap
Message-ID: <467BCA0A.6020401@ija.csic.es>

Dear sig-geos,

I have to calculate a distmap (that is, a map
in which the value of each cell is the distance
from the cell to a given object) for a set of polygons.
It seems to me that distmap.owin in spatstat would do it
fine, but distmap.owin does not accept objects
imported from shp vectors via readOGR. distmap.owin requires
type "polygonal" and readOGR yields class 'SpatialPolygonsDataFrame'
Is there any way to cast or convert from 'SpatialPolygonsDataFrame'
to "polygonal" or an alternative function to calculate the distances
to the boundaries of the polygons?

Thanks

Agus

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From haenlein at gmail.com  Sat Jun 23 13:41:53 2007
From: haenlein at gmail.com (Michael Haenlein)
Date: Sat, 23 Jun 2007 13:41:53 +0200
Subject: [R-sig-Geo] Importing data into spdep package
Message-ID: <45101cb10706230441j16ae8f3fw805985eeb2880640@mail.gmail.com>

Dear all,

I'm quite new to spatial statistics, so I hope the question I'm asking
is not to stupid. But I'm struggling with the issue for days now ...

I want to estimate a spatial simultaneous autoregressive lag model
using the spdep package in R. My data is currently stored in an Access
database. There I have two tables. The first one contains information
about each location. Assume one of these variables is y. Each location
is identified by a unique ID. Hence, the first table is structured in
the form "ID - y". The second table contains the distance between
pairs of location and is structured in the form "ID1 - ID2 - Distance
between ID1 and ID2".

My question is: How can I import my two tables in R and convert the
second one (giving distances between two locations) in a spatial
weights matrix? I want to estimate a model of form: y = a + bWy, where
W is a spatial weights matrix and y is a location characteristic as
defined above. I am familiar with importing data into R in general
(using the read.csv function) as well as with exporting data from
Access into csv format.

Thanks very much for your help in advance,

Michael



From lee.kitty at yahoo.com  Sun Jun 24 10:32:32 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Sun, 24 Jun 2007 01:32:32 -0700 (PDT)
Subject: [R-sig-Geo] Simple and Efficient way to Divide Study Area?
Message-ID: <503861.98819.qm@web36301.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070624/5f42fc87/attachment.pl>

From epistat at gmail.com  Sun Jun 24 16:57:15 2007
From: epistat at gmail.com (zhijie zhang)
Date: Sun, 24 Jun 2007 22:57:15 +0800
Subject: [R-sig-Geo] functions on kernel density estimation in point pattern
	analysis
Message-ID: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070624/2704bd5a/attachment.pl>

From Roger.Bivand at nhh.no  Sun Jun 24 17:55:57 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 24 Jun 2007 17:55:57 +0200 (CEST)
Subject: [R-sig-Geo] distmap
In-Reply-To: <467BCA0A.6020401@ija.csic.es>
References: <467BCA0A.6020401@ija.csic.es>
Message-ID: <Pine.LNX.4.64.0706241755170.371@reclus.nhh.no>

On Fri, 22 Jun 2007, Agustin Lobo wrote:

> Dear sig-geos,
>
> I have to calculate a distmap (that is, a map
> in which the value of each cell is the distance
> from the cell to a given object) for a set of polygons.
> It seems to me that distmap.owin in spatstat would do it
> fine, but distmap.owin does not accept objects
> imported from shp vectors via readOGR. distmap.owin requires
> type "polygonal" and readOGR yields class 'SpatialPolygonsDataFrame'
> Is there any way to cast or convert from 'SpatialPolygonsDataFrame'
> to "polygonal" or an alternative function to calculate the distances
> to the boundaries of the polygons?

Have you tried coercing with as(x, "owin") in maptools?

Roger

>
> Thanks
>
> Agus
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sun Jun 24 18:13:03 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 24 Jun 2007 18:13:03 +0200 (CEST)
Subject: [R-sig-Geo] Importing data into spdep package
In-Reply-To: <45101cb10706230441j16ae8f3fw805985eeb2880640@mail.gmail.com>
References: <45101cb10706230441j16ae8f3fw805985eeb2880640@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706241756520.371@reclus.nhh.no>

On Sat, 23 Jun 2007, Michael Haenlein wrote:

> Dear all,
>
> I'm quite new to spatial statistics, so I hope the question I'm asking
> is not to stupid. But I'm struggling with the issue for days now ...
>
> I want to estimate a spatial simultaneous autoregressive lag model
> using the spdep package in R. My data is currently stored in an Access
> database. There I have two tables. The first one contains information
> about each location. Assume one of these variables is y. Each location
> is identified by a unique ID. Hence, the first table is structured in
> the form "ID - y". The second table contains the distance between
> pairs of location and is structured in the form "ID1 - ID2 - Distance
> between ID1 and ID2".
>
> My question is: How can I import my two tables in R and convert the
> second one (giving distances between two locations) in a spatial
> weights matrix? I want to estimate a model of form: y = a + bWy, where
> W is a spatial weights matrix and y is a location characteristic as
> defined above. I am familiar with importing data into R in general
> (using the read.csv function) as well as with exporting data from
> Access into csv format.

Most likely you should export y and the IDs in a rectangular CSV file, and 
the distance matrix in a square CSV file. Once you have read the squre 
matrix into R, try the mat2listw() function to get hold of the distances 
in list form (although it may be sensible to take inverse distances from 
the matrix, and set very small values to zero to reduce density first). 
The output listw object may need re-building with nb2listw() on the 
neighbours and weights components if you want for example to use row 
standardisation. From there on lagsarlm() ought to work.

Hope this helps,

Roger

>
> Thanks very much for your help in advance,
>
> Michael
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sun Jun 24 18:26:54 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 24 Jun 2007 18:26:54 +0200 (CEST)
Subject: [R-sig-Geo] Simple and Efficient way to Divide Study Area?
In-Reply-To: <503861.98819.qm@web36301.mail.mud.yahoo.com>
References: <503861.98819.qm@web36301.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.64.0706241824450.371@reclus.nhh.no>

On Sun, 24 Jun 2007, Kitty Lee wrote:

> Dear R-users,
>
> I have a study area (with points as observations) and I want to divide the space randomly into sub-regions for further analyses.
>
> I first generated some random points and then used voronoi to divide the space.
>
> ngrp<-20
> genx<-runif(ngrp,0,1)
> geny<-runif(ngrp,0,1)
> genxy<-cbind(genx, geny)
> vonout<-voronoi.mosaic(genxy[,1], genxy[,2],
> duplicate="remove")
> plot(vonout)
> vonpoly<-voronoi.polygons(vonout)
> plot(vonpoly)
>
> But there is one major problem with this method--- I wanted to get 20 sub-regions but (in one random run),  only 12 enclosed polygons are returned
>
> My questions are:
>
> 1) how can I make the unenclosed areas into enclosed polygons? (so that the whole study area is divided into mutually exclusive and exhaustive sub-regions)
>
> 2) is this a good/efficient method?

Please do note what I wrote in my earlier reply, of 20 June, use deldir 
not tripack. Then read the thread referenced from:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/96588.html

for the reamaining questions.

Roger

>
> After getting all enclosed polygons, I have to
> a) turn this into SPatial PolygonDataFrame;
> b) overlay with the existing points;
> c) find out which polygons these point fall into
> d) conduct sub-region analyses
>
> Is there a more efficient method? How can I efficiently
> a) divide the study area into specified no. of subgroups? (and they don't have to include equal no. of points)
> b) divide the study area into specified no. of subgroups? (each subgroup has the same no. of points)
>
>
> Thanks!!
>
> K.
>
>
>
>
> ---------------------------------
> Park yourself in front of a world of choices in alternative vehicles.
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sun Jun 24 18:41:41 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 24 Jun 2007 18:41:41 +0200 (CEST)
Subject: [R-sig-Geo] functions on kernel density estimation in point
 pattern analysis
In-Reply-To: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
References: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706241839310.371@reclus.nhh.no>

On Sun, 24 Jun 2007, zhijie zhang wrote:

> Dear Friends,
> Except kernel2d(splancs) function, are there any other functions on kernel
> density estimation in point pattern analysis? I use the kernel2d(splancs)
> function to anayze my dataset, and the result seems not to be very good.
>  Any suggestions or help in kernel density estimation of univariate or
> multivariate point process are greatly appreciated.
>  BTW, i mainly want ot do the kernel density estimation in both
> univariate and multivariate point process.

You might consider possibilities in spatstat, and it would be easier to 
answer if your needs were clearer - it is possible that the splancs 
functions could work better with different argument values, but without 
knowing what you used, it is difficult to tell.

Roger

>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tkeitt at gmail.com  Mon Jun 25 02:28:42 2007
From: tkeitt at gmail.com (Tim Keitt)
Date: Sun, 24 Jun 2007 19:28:42 -0500
Subject: [R-sig-Geo] functions on kernel density estimation in point
	pattern analysis
In-Reply-To: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
References: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
Message-ID: <6262c54c0706241728y57aecb01s70a9b3ba5a1bab22@mail.gmail.com>

I rather like locfit.

THK

On 6/24/07, zhijie zhang <epistat at gmail.com> wrote:
> Dear Friends,
>  Except kernel2d(splancs) function, are there any other functions on kernel
> density estimation in point pattern analysis? I use the kernel2d(splancs)
> function to anayze my dataset, and the result seems not to be very good.
>   Any suggestions or help in kernel density estimation of univariate or
> multivariate point process are greatly appreciated.
>   BTW, i mainly want ot do the kernel density estimation in both
> univariate and multivariate point process.
> --
> With Kind Regards,
>
> oooO:::::::::
> (..):::::::::
> :\.(:::Oooo::
> ::\_)::(..)::
> :::::::)./:::
> ::::::(_/::::
> :::::::::::::
> [***********************************************************************]
> Zhi Jie,Zhang ,PHD
> Tel:86-21-54237149
> Dept. of Epidemiology,School of Public Health,Fudan University
> Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> Postcode:200032
> Email:epistat at gmail.com
> Website: www.statABC.com
> [***********************************************************************]
> oooO:::::::::
> (..):::::::::
> :\.(:::Oooo::
> ::\_)::(..)::
> :::::::)./:::
> ::::::(_/::::
> :::::::::::::
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Timothy H. Keitt, University of Texas at Austin
Contact info and schedule at http://www.keittlab.org/tkeitt/
Reprints at http://www.keittlab.org/tkeitt/papers/
ODF attachment? See http://www.openoffice.org/



From putler at sauder.ubc.ca  Mon Jun 25 05:54:13 2007
From: putler at sauder.ubc.ca (Dan Putler)
Date: Sun, 24 Jun 2007 20:54:13 -0700
Subject: [R-sig-Geo] functions on kernel density estimation in
	pointpattern analysis
In-Reply-To: <6262c54c0706241728y57aecb01s70a9b3ba5a1bab22@mail.gmail.com>
References: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
	<6262c54c0706241728y57aecb01s70a9b3ba5a1bab22@mail.gmail.com>
Message-ID: <706467E0-DF14-483F-AE7A-5629BD1E7A59@sauder.ubc.ca>

Hi All,

To add some detail to Roger's earlier, post density.ppp in the  
spatstat seems to be a very good answer to the original post since it  
is specifically designed to estimate a kernel density for a point  
process pattern. This function use a bivariate Gaussian smoother that  
lends itself to user configuration.

Dan

On 24-Jun-07, at 5:28 PM, Tim Keitt wrote:

> I rather like locfit.
>
> THK
>
> On 6/24/07, zhijie zhang <epistat at gmail.com> wrote:
>> Dear Friends,
>>  Except kernel2d(splancs) function, are there any other functions  
>> on kernel
>> density estimation in point pattern analysis? I use the kernel2d 
>> (splancs)
>> function to anayze my dataset, and the result seems not to be very  
>> good.
>>   Any suggestions or help in kernel density estimation of  
>> univariate or
>> multivariate point process are greatly appreciated.
>>   BTW, i mainly want ot do the kernel density estimation in both
>> univariate and multivariate point process.
>> --
>> With Kind Regards,
>>
>> oooO:::::::::
>> (..):::::::::
>> :\.(:::Oooo::
>> ::\_)::(..)::
>> :::::::)./:::
>> ::::::(_/::::
>> :::::::::::::
>> [******************************************************************** 
>> ***]
>> Zhi Jie,Zhang ,PHD
>> Tel:86-21-54237149
>> Dept. of Epidemiology,School of Public Health,Fudan University
>> Address:No. 138 Yi Xue Yuan Road,Shanghai,China
>> Postcode:200032
>> Email:epistat at gmail.com
>> Website: www.statABC.com
>> [******************************************************************** 
>> ***]
>> oooO:::::::::
>> (..):::::::::
>> :\.(:::Oooo::
>> ::\_)::(..)::
>> :::::::)./:::
>> ::::::(_/::::
>> :::::::::::::
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> -- 
> Timothy H. Keitt, University of Texas at Austin
> Contact info and schedule at http://www.keittlab.org/tkeitt/
> Reprints at http://www.keittlab.org/tkeitt/papers/
> ODF attachment? See http://www.openoffice.org/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From e.pebesma at geo.uu.nl  Mon Jun 25 10:44:14 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 25 Jun 2007 10:44:14 +0200
Subject: [R-sig-Geo] krige.bayes output
In-Reply-To: <Pine.LNX.4.58.0706211407511.17611@macalan.c3sl.ufpr.br>
References: <mailman.19.1182420008.7578.r-sig-geo@stat.math.ethz.ch>	<467A8A75.1070703@uniroma1.it>
	<Pine.LNX.4.58.0706211407511.17611@macalan.c3sl.ufpr.br>
Message-ID: <467F805E.9060609@geo.uu.nl>

Is it possible to compute them experimentally, by computing the variance 
of the back-transformed simulations for each prediction location?
--
Edzer

Paulo Justiniano Ribeiro Jr wrote:
> Dear Giovanna
>
> For certain values of the Box-Cox transformation it is not possible to
> compute kriging variances.
> Therefore a measure of the uncertainty of the predictions is computed by
> (Q3-Q1)/4
> where Q3 and Q1 are the 3rd and 1st quartiles
>
> best
> P.J.
>
>
> Paulo Justiniano Ribeiro Jr
> LEG (Laborat?rio de Estat?stica e Geoinforma??o)
> Universidade Federal do Paran?
> Caixa Postal 19.081
> CEP 81.531-990
> Curitiba, PR  -  Brasil
> Tel: (+55) 41 3361 3573
> Fax: (+55) 41 3361 3141
> e-mail: paulojus AT  ufpr  br
> http://www.leg.ufpr.br/~paulojus
>
> On Thu, 21 Jun 2007, giovanna jona lasinio wrote:
>
>   
>> Dear all,
>> I'm running a bayesian kriging using krige.bayes in the geoR library.
>> I'm using a linux machine with R 2.4. I'm running a chain of annual
>> surfaces estimation and I'm using every year's output to build the prior
>> for the next one through the function post2prior (always, geoR library).
>> My predictive distribution is back-transformed (Box-Cox) from Gaussian
>> (log transformation).
>>
>> My problem concerns the krige.bayes output, in the predictive list I
>> find an element named uncertainty of the same length as my surface. I
>> was not able to find any explanation of what is in it searching the help
>> and the mailing list archive.
>> Does anyone know what  is it?
>>
>> Best
>> Giovanna Jona Lasinio
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From rob.robinson at bto.org  Mon Jun 25 11:03:01 2007
From: rob.robinson at bto.org (Rob Robinson)
Date: Mon, 25 Jun 2007 10:03:01 +0100
Subject: [R-sig-Geo] functions on kernel density estimation in point
	patternanalysis
In-Reply-To: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
Message-ID: <003001c7b707$a252add0$5285c3c1@btodomain.bto.org>


Have you had a look at package ks? It seems to do rather nice bivariate
kernels, and (I think) generalises to other dimensions.
Cheers
Rob

*** Want to know about Britain's birds? Try  www.bto.org/birdfacts ***

Dr Rob Robinson, Senior Population Biologist
British Trust for Ornithology, The Nunnery, Thetford, Norfolk, IP24 2PU
Ph: +44 (0)1842 750050         E: rob.robinson at bto.org
Fx: +44 (0)1842 750030         W: http://www.bto.org
eSafe scanned this email for viruses, vandals and malicious content (!)

==== "How can anyone be enlightened, when truth is so poorly lit" =====
  

> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of zhijie zhang
> Sent: 24 June 2007 15:57
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] functions on kernel density estimation 
> in point patternanalysis
> 
> Dear Friends,
>  Except kernel2d(splancs) function, are there any other 
> functions on kernel density estimation in point pattern 
> analysis? I use the kernel2d(splancs) function to anayze my 
> dataset, and the result seems not to be very good.
>   Any suggestions or help in kernel density estimation of 
> univariate or multivariate point process are greatly appreciated.
>   BTW, i mainly want ot do the kernel density estimation in 
> both univariate and multivariate point process.
> --
> With Kind Regards,
> 
> oooO:::::::::
> (..):::::::::
> :\.(:::Oooo::
> ::\_)::(..)::
> :::::::)./:::
> ::::::(_/::::
> :::::::::::::
> [*************************************************************
> **********]
> Zhi Jie,Zhang ,PHD
> Tel:86-21-54237149
> Dept. of Epidemiology,School of Public Health,Fudan 
> University Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> Postcode:200032
> Email:epistat at gmail.com
> Website: www.statABC.com
> [*************************************************************
> **********]
> oooO:::::::::
> (..):::::::::
> :\.(:::Oooo::
> ::\_)::(..)::
> :::::::)./:::
> ::::::(_/::::
> :::::::::::::
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From e.pebesma at geo.uu.nl  Mon Jun 25 11:45:36 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 25 Jun 2007 11:45:36 +0200
Subject: [R-sig-Geo] ODP: ODP:  spsample and NA
In-Reply-To: <AD51AB79BC327C40AB2C7EB75D57A3C40512C0@TOLAR.valuta.nhh.no>
References: <4678E138.8030901@ija.csic.es>	<AD51AB79BC327C40AB2C7EB75D57A3C40512BD@TOLAR.valuta.nhh.no>	<467A2BA4.2020200@ija.csic.es>
	<AD51AB79BC327C40AB2C7EB75D57A3C40512C0@TOLAR.valuta.nhh.no>
Message-ID: <467F8EC0.606@geo.uu.nl>

Not only to avoid NAs, but also to get approximately right sample size.

Stratified sampling does not take place based on strata defined by 
attributes (map layers), but rather by dividing the area into square 
blocks (strata) and randomly sample (n=1) from each block. That is why 
the resulting sample doesn't have exactly the prescribed/requested size 
(although one could iterate). See also Ripley 1981 Spatial Statistics 
for explanation.

Best wishes,
--
Edzer

Roger Bivand wrote:
> There are two forms of sp objects for grids, SpatialPixelsDataFrame and SpatialGridDataFrame, and you need the former to avoid NAs. I am not sure how to proceed without access to a copz of zour data to see whz spsample is including the NA cells.
>  
> Roger
>  
> --- Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no
>
> ________________________________
>
> Od: Agustin Lobo w imieniu Agustin Lobo
> Wys?ano: Cz 21.06.2007 09:41
> Do: Roger Bivand
> DW: R-sig-Geo at stat.math.ethz.ch
> Temat: Re: ODP: [R-sig-Geo] spsample and NA
>
>
>
> The test with meuse.grid works:
>
> #copied from file:SpatialGridDataFrame-class.html
> coordinates(meuse.grid) = c("x", "y") # promote toSpatialPointsDataFrame
> gridded(meuse.grid) <- TRUE # promote to SpatialPixelsDataFrame
> x = as(meuse.grid, "SpatialGridDataFrame") # creates the full grid
> #Now me:
>  > unique(x at data$soil)
> [1] NA  1  2  3
>
>  > table(x at data$soil)
>     1    2    3
> 1665 1084  354
>
> test.stsamp <- spsample(x, n = 10, "stratified")
> o <- overlay(x, test.stsamp)
>  > o
>            coordinates part.a part.b      dist soil ffreq
> 5556 (179156, 330917)      0      1 0.1030270    1     1
> 6670 (180039, 330336)      0      1 0.0703333    1     2
> 2240 (180677, 332606)      1      0 0.0975136    1     1
>
>
> But don't know how to make that my raster behave in the same way. What
> does it mean "cast to SpatialPixels first"? I thought that as
> X comes from an imported raster it was an sp object already.
>
> Also, there are several components in the x coming from meuse.grid:
> str(x)
> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>    ..@ data       :'data.frame': 8112 obs. of  5 variables:
>    .. ..$ part.a: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>    .. ..$ part.b: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>    .. ..$ dist  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>    .. ..$ soil  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>    .. ..$ ffreq : Factor w/ 3 levels "1","2","3": NA NA NA NA NA NA NA
> NA NA NA ...
>
> how does spsample know which layer has to be used for the stratification?
>
> Thanks!
>
> Agus
>
> Roger Bivand escribi?:
>   
>> I think that if you cast to SpatialPixels first, the problem will go away, because the all-NA cases are dropped with their coordinates. Could you try the same example with meuse.grid and see how it goes?
>>
>> Roger
>>
>> ---
>> Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no
>>
>> ________________________________
>>
>> Od: r-sig-geo-bounces at stat.math.ethz.ch w imieniu Agustin Lobo
>> Wys?ano: ?r 20.06.2007 10:11
>> Do: R-sig-Geo at stat.math.ethz.ch
>> Temat: [R-sig-Geo] spsample and NA
>>
>>
>>
>> It is often the case, at least with raster (grid) objects,
>> that you are not interested on a part of the raster.
>> For example because it's outside a non.rectangular region of study
>> and/or because some types of terrain (some classes) are outside
>> the scope of the study. In any case, those parts can be
>> represented by NA.
>>
>> Unfortunately, while some functions like table() would not
>> include the NA in the statistics, spsample includes
>> the NA as just another class, which implies that a fraction
>> of the resulting coordinates will lay on the NA
>> part of the raster. This makes it difficult, to get N valid (i.e., not
>> on NA parts) points using spsample. Is there any way around this?
>> For example, if I want 10 points on non-NA cells of
>> raster X, I would like
>>
>> spsample(X, 10, "stratified")
>>
>> to provide 10 positions on non-NA cells.
>>
>> At the moment, I get:
>>
>> x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
>> ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(100,100))
>> GDAL.close(x)
>>
>> ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
>>
>> X <- ESTRAT3OBAC
>> X$cut <- as.ordered(cut(X$band1, c(0,10,100),include.lowest=TRUE))
>> table(X$cut)
>>
>>    [0,10] (10,100]
>>        83     1961
>>
>> summary(X$cut)
>>    [0,10] (10,100]     NA's
>>        83     1961     7956
>> table(X$cut)
>>
>>    [0,10] (10,100]
>>        83     1961
>>
>> Xspsample <- spsample(X,10,"stratified")
>> Xo <- overlay(X,Xspsample)
>> summary(Xo)
>> Object of class SpatialPointsDataFrame
>> Coordinates:
>>           min       max
>> x1  410995.6  414954.4
>> x2 4608002.1 4610566.0
>> Is projected: TRUE
>> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
>> Number of points: 9
>> Data attributes:
>>       band1             cut
>>   Min.   :   67   [0,10]  :0
>>   1st Qu.:   97   (10,100]:3
>>   Median :  159   NA's    :6
>>   Mean   :24745
>>   3rd Qu.:55537
>>   Max.   :55537
>>
>> That is, I get 6 positions on NA values of X
>>
>> Thanks!
>>
>> Agus
>>
>> --
>> Dr. Agustin Lobo
>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>> LLuis Sole Sabaris s/n
>> 08028 Barcelona
>> Spain
>> Tel. 34 934095410
>> Fax. 34 934110012
>> email: Agustin.Lobo at ija.csic.es
>> http://www.ija.csic.es/gt/obster
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>>     
>
> --
> Dr. Agustin Lobo
> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
> LLuis Sole Sabaris s/n
> 08028 Barcelona
> Spain
> Tel. 34 934095410
> Fax. 34 934110012
> email: Agustin.Lobo at ija.csic.es
> http://www.ija.csic.es/gt/obster
>
>
>
> 	[[alternative HTML version deleted]]
>
>   
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From e.pebesma at geo.uu.nl  Mon Jun 25 11:51:54 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 25 Jun 2007 11:51:54 +0200
Subject: [R-sig-Geo] newbie sp question
In-Reply-To: <Pine.LNX.4.64.0706171812310.14432@reclus.nhh.no>
References: <f5d848060706151826y36a72d2fi1c3d88e33bb4bf48@mail.gmail.com>	<Pine.LNX.4.64.0706162206380.15918@reclus.nhh.no>	<f5d848060706161551l6e7a9765gfe25ea67b00b146b@mail.gmail.com>
	<Pine.LNX.4.64.0706171812310.14432@reclus.nhh.no>
Message-ID: <467F903A.3040709@geo.uu.nl>

Roger Bivand wrote:
> It may also be worth asking on the PostGIS list whether you could upload 
> your geometries to PostGIS and have GEOS do the measurement - if you have 
> access to the software and experience with it. It may be that it can 
> handle geographical coordinates.
>   

I have to be careful here, but I do believe that it cannot do this right 
now--it assumes projected data for topological relations/functions. See 
also the wishlist for PostGIS 2.0 referenced from the refractions site 
or its wiki if you want to find out.
--
Edzer



From Agustin.Lobo at ija.csic.es  Mon Jun 25 12:38:25 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Mon, 25 Jun 2007 12:38:25 +0200
Subject: [R-sig-Geo] distmap
In-Reply-To: <Pine.LNX.4.64.0706241755170.371@reclus.nhh.no>
References: <467BCA0A.6020401@ija.csic.es>
	<Pine.LNX.4.64.0706241755170.371@reclus.nhh.no>
Message-ID: <467F9B21.3090008@ija.csic.es>

I've tried (among other things):
 > limit1 <- read.shape("limit_PNSN2000.shp")
Shapefile type: Polygon, (5), # of Shapes: 2
 > limit1poly <- Map2poly(limit1)
 > limit1owin <- as(limit1poly,"owin")
Error in .classEnv(thisClass) : unable to find an environment containing 
class "polylist"

 > limit2 <- readOGR("limit_PNSN2000.shp",layer="limit_PNSN2000")
OGR data source with driver: ESRI Shapefile
Source: "limit_PNSN2000.shp", layer: "limit_PNSN2000"
with  2  rows and  1  columns
 > limit2poly <- Map2poly(limit1)
 > limit1owin <- as(limit2poly,"owin")
Error in .classEnv(thisClass) : unable to find an environment containing 
class "polylist"
 > limit1owin <- as(limit2,"owin")
Error in as.owin.SpatialPolygons(from) : W must be a SpatialPolygons object

I guess all I need is to convert my shapefile (read into R via 
read.shape or readOGR?) into an object like letterR:

 > data(letterR)
 > str(letterR)
List of 4
  $ type  : chr "polygonal"
  $ xrange: num [1:2] 2.02 3.93
  $ yrange: num [1:2] 0.645 3.278
  $ bdry  :List of 2
   ..$ :List of 2
   .. ..$ x: num [1:24] 2.03 2.02 2.02 2.66 2.66 ...
   .. ..$ y: num [1:24] 3.278 3.248 0.653 0.653 1.695 ...
   ..$ :List of 2
   .. ..$ x: num [1:10] 2.65 2.64 3.04 3.12 3.16 ...
   .. ..$ y: num [1:10] 2.23 2.70 2.71 2.63 2.50 ...
  - attr(*, "class")= chr "owin"

but how can I do it?

Also, I'm so confused with so many spatial objects, is there a guide?

Agus

Roger Bivand escribi?:
> On Fri, 22 Jun 2007, Agustin Lobo wrote:
> 
>> Dear sig-geos,
>>
>> I have to calculate a distmap (that is, a map
>> in which the value of each cell is the distance
>> from the cell to a given object) for a set of polygons.
>> It seems to me that distmap.owin in spatstat would do it
>> fine, but distmap.owin does not accept objects
>> imported from shp vectors via readOGR. distmap.owin requires
>> type "polygonal" and readOGR yields class 'SpatialPolygonsDataFrame'
>> Is there any way to cast or convert from 'SpatialPolygonsDataFrame'
>> to "polygonal" or an alternative function to calculate the distances
>> to the boundaries of the polygons?
> 
> Have you tried coercing with as(x, "owin") in maptools?
> 
> Roger
> 
>>
>> Thanks
>>
>> Agus
>>
>>
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Agustin.Lobo at ija.csic.es  Mon Jun 25 13:02:15 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Mon, 25 Jun 2007 13:02:15 +0200
Subject: [R-sig-Geo] ODP: ODP:  spsample and NA
In-Reply-To: <467F8EC0.606@geo.uu.nl>
References: <4678E138.8030901@ija.csic.es>	<AD51AB79BC327C40AB2C7EB75D57A3C40512BD@TOLAR.valuta.nhh.no>	<467A2BA4.2020200@ija.csic.es>
	<AD51AB79BC327C40AB2C7EB75D57A3C40512C0@TOLAR.valuta.nhh.no>
	<467F8EC0.606@geo.uu.nl>
Message-ID: <467FA0B7.5070806@ija.csic.es>

I understand, but how do I convert between one type and the other?
I've tried:

x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(118,189))
GDAL.close(x)
ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
X <- ESTRAT3OBAC[seq(1,118,by=10),seq(1,189,by=10)] #small example
 > summary(X)
Object of class SpatialGridDataFrame
Coordinates:
         min       max
x  410649.7  415399.7
y 4607910.5 4610910.5
Is projected: TRUE
proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
Number of points: 2
Grid attributes:
   cellcentre.offset cellsize cells.dim
x          410774.7      250        19
y         4608035.5      250        12
Data attributes:
      band1
  Min.   :  4.0
  1st Qu.: 67.0
  Median :156.0
  Mean   :125.8
  3rd Qu.:163.0
  Max.   :237.0
  NA's   :119.0

 > Y <- SpatialPixels(X)
 > summary(Y)
Object of class SpatialPixels
Coordinates:
         min       max
x  410649.7  415399.7
y 4607910.5 4610910.5
Is projected: TRUE
proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
Number of points: 2

So X and Y are not the same at all.

Thanks for your help.

Agus


Edzer J. Pebesma escribi?:
> Not only to avoid NAs, but also to get approximately right sample size.
> 
> Stratified sampling does not take place based on strata defined by 
> attributes (map layers), but rather by dividing the area into square 
> blocks (strata) and randomly sample (n=1) from each block. That is why 
> the resulting sample doesn't have exactly the prescribed/requested size 
> (although one could iterate). See also Ripley 1981 Spatial Statistics 
> for explanation.
> 
> Best wishes,
> -- 
> Edzer
> 
> Roger Bivand wrote:
>> There are two forms of sp objects for grids, SpatialPixelsDataFrame 
>> and SpatialGridDataFrame, and you need the former to avoid NAs. I am 
>> not sure how to proceed without access to a copz of zour data to see 
>> whz spsample is including the NA cells.
>>  
>> Roger
>>  
>> --- Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no
>>
>> ________________________________
>>
>> Od: Agustin Lobo w imieniu Agustin Lobo
>> Wys?ano: Cz 21.06.2007 09:41
>> Do: Roger Bivand
>> DW: R-sig-Geo at stat.math.ethz.ch
>> Temat: Re: ODP: [R-sig-Geo] spsample and NA
>>
>>
>>
>> The test with meuse.grid works:
>>
>> #copied from file:SpatialGridDataFrame-class.html
>> coordinates(meuse.grid) = c("x", "y") # promote toSpatialPointsDataFrame
>> gridded(meuse.grid) <- TRUE # promote to SpatialPixelsDataFrame
>> x = as(meuse.grid, "SpatialGridDataFrame") # creates the full grid
>> #Now me:
>>  > unique(x at data$soil)
>> [1] NA  1  2  3
>>
>>  > table(x at data$soil)
>>     1    2    3
>> 1665 1084  354
>>
>> test.stsamp <- spsample(x, n = 10, "stratified")
>> o <- overlay(x, test.stsamp)
>>  > o
>>            coordinates part.a part.b      dist soil ffreq
>> 5556 (179156, 330917)      0      1 0.1030270    1     1
>> 6670 (180039, 330336)      0      1 0.0703333    1     2
>> 2240 (180677, 332606)      1      0 0.0975136    1     1
>>
>>
>> But don't know how to make that my raster behave in the same way. What
>> does it mean "cast to SpatialPixels first"? I thought that as
>> X comes from an imported raster it was an sp object already.
>>
>> Also, there are several components in the x coming from meuse.grid:
>> str(x)
>> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>>    ..@ data       :'data.frame': 8112 obs. of  5 variables:
>>    .. ..$ part.a: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>    .. ..$ part.b: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>    .. ..$ dist  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>    .. ..$ soil  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>    .. ..$ ffreq : Factor w/ 3 levels "1","2","3": NA NA NA NA NA NA NA
>> NA NA NA ...
>>
>> how does spsample know which layer has to be used for the stratification?
>>
>> Thanks!
>>
>> Agus
>>
>> Roger Bivand escribi?:
>>  
>>> I think that if you cast to SpatialPixels first, the problem will go 
>>> away, because the all-NA cases are dropped with their coordinates. 
>>> Could you try the same example with meuse.grid and see how it goes?
>>>
>>> Roger
>>>
>>> ---
>>> Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no
>>>
>>> ________________________________
>>>
>>> Od: r-sig-geo-bounces at stat.math.ethz.ch w imieniu Agustin Lobo
>>> Wys?ano: ?r 20.06.2007 10:11
>>> Do: R-sig-Geo at stat.math.ethz.ch
>>> Temat: [R-sig-Geo] spsample and NA
>>>
>>>
>>>
>>> It is often the case, at least with raster (grid) objects,
>>> that you are not interested on a part of the raster.
>>> For example because it's outside a non.rectangular region of study
>>> and/or because some types of terrain (some classes) are outside
>>> the scope of the study. In any case, those parts can be
>>> represented by NA.
>>>
>>> Unfortunately, while some functions like table() would not
>>> include the NA in the statistics, spsample includes
>>> the NA as just another class, which implies that a fraction
>>> of the resulting coordinates will lay on the NA
>>> part of the raster. This makes it difficult, to get N valid (i.e., not
>>> on NA parts) points using spsample. Is there any way around this?
>>> For example, if I want 10 points on non-NA cells of
>>> raster X, I would like
>>>
>>> spsample(X, 10, "stratified")
>>>
>>> to provide 10 positions on non-NA cells.
>>>
>>> At the moment, I get:
>>>
>>> x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
>>> ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(100,100))
>>> GDAL.close(x)
>>>
>>> ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
>>>
>>> X <- ESTRAT3OBAC
>>> X$cut <- as.ordered(cut(X$band1, c(0,10,100),include.lowest=TRUE))
>>> table(X$cut)
>>>
>>>    [0,10] (10,100]
>>>        83     1961
>>>
>>> summary(X$cut)
>>>    [0,10] (10,100]     NA's
>>>        83     1961     7956
>>> table(X$cut)
>>>
>>>    [0,10] (10,100]
>>>        83     1961
>>>
>>> Xspsample <- spsample(X,10,"stratified")
>>> Xo <- overlay(X,Xspsample)
>>> summary(Xo)
>>> Object of class SpatialPointsDataFrame
>>> Coordinates:
>>>           min       max
>>> x1  410995.6  414954.4
>>> x2 4608002.1 4610566.0
>>> Is projected: TRUE
>>> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
>>> Number of points: 9
>>> Data attributes:
>>>       band1             cut
>>>   Min.   :   67   [0,10]  :0
>>>   1st Qu.:   97   (10,100]:3
>>>   Median :  159   NA's    :6
>>>   Mean   :24745
>>>   3rd Qu.:55537
>>>   Max.   :55537
>>>
>>> That is, I get 6 positions on NA values of X
>>>
>>> Thanks!
>>>
>>> Agus
>>>
>>> -- 
>>> Dr. Agustin Lobo
>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>> LLuis Sole Sabaris s/n
>>> 08028 Barcelona
>>> Spain
>>> Tel. 34 934095410
>>> Fax. 34 934110012
>>> email: Agustin.Lobo at ija.csic.es
>>> http://www.ija.csic.es/gt/obster
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>>
>>>     
>>
>> -- 
>> Dr. Agustin Lobo
>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>> LLuis Sole Sabaris s/n
>> 08028 Barcelona
>> Spain
>> Tel. 34 934095410
>> Fax. 34 934110012
>> email: Agustin.Lobo at ija.csic.es
>> http://www.ija.csic.es/gt/obster
>>
>>
>>
>>     [[alternative HTML version deleted]]
>>
>>   
>> ------------------------------------------------------------------------
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>   
> 
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From e.pebesma at geo.uu.nl  Mon Jun 25 14:14:14 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 25 Jun 2007 14:14:14 +0200
Subject: [R-sig-Geo] ODP: ODP:  spsample and NA
In-Reply-To: <467FA0B7.5070806@ija.csic.es>
References: <4678E138.8030901@ija.csic.es>	<AD51AB79BC327C40AB2C7EB75D57A3C40512BD@TOLAR.valuta.nhh.no>	<467A2BA4.2020200@ija.csic.es>
	<AD51AB79BC327C40AB2C7EB75D57A3C40512C0@TOLAR.valuta.nhh.no>
	<467F8EC0.606@geo.uu.nl> <467FA0B7.5070806@ija.csic.es>
Message-ID: <467FB196.4090106@geo.uu.nl>

additional to the

X = as(X, "SpatialPixelsDataFrame")

etc. there's a helper function that toggles between them; try:

fullgrid(X) = TRUE
class(X)
fullgrid(X) = FALSE
class(X)
--
Edzer

Agustin Lobo wrote:
> I understand, but how do I convert between one type and the other?
> I've tried:
>
> x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
> ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(118,189))
> GDAL.close(x)
> ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
> X <- ESTRAT3OBAC[seq(1,118,by=10),seq(1,189,by=10)] #small example
> > summary(X)
> Object of class SpatialGridDataFrame
> Coordinates:
>         min       max
> x  410649.7  415399.7
> y 4607910.5 4610910.5
> Is projected: TRUE
> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
> Number of points: 2
> Grid attributes:
>   cellcentre.offset cellsize cells.dim
> x          410774.7      250        19
> y         4608035.5      250        12
> Data attributes:
>      band1
>  Min.   :  4.0
>  1st Qu.: 67.0
>  Median :156.0
>  Mean   :125.8
>  3rd Qu.:163.0
>  Max.   :237.0
>  NA's   :119.0
>
> > Y <- SpatialPixels(X)
> > summary(Y)
> Object of class SpatialPixels
> Coordinates:
>         min       max
> x  410649.7  415399.7
> y 4607910.5 4610910.5
> Is projected: TRUE
> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
> Number of points: 2
>
> So X and Y are not the same at all.
>
> Thanks for your help.
>
> Agus
>
>
> Edzer J. Pebesma escribi?:
>> Not only to avoid NAs, but also to get approximately right sample size.
>>
>> Stratified sampling does not take place based on strata defined by 
>> attributes (map layers), but rather by dividing the area into square 
>> blocks (strata) and randomly sample (n=1) from each block. That is 
>> why the resulting sample doesn't have exactly the 
>> prescribed/requested size (although one could iterate). See also 
>> Ripley 1981 Spatial Statistics for explanation.
>>
>> Best wishes,
>> -- 
>> Edzer
>>
>> Roger Bivand wrote:
>>> There are two forms of sp objects for grids, SpatialPixelsDataFrame 
>>> and SpatialGridDataFrame, and you need the former to avoid NAs. I am 
>>> not sure how to proceed without access to a copz of zour data to see 
>>> whz spsample is including the NA cells.
>>>  
>>> Roger
>>>  
>>> --- Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, 
>>> Roger.Bivand at nhh.no
>>>
>>> ________________________________
>>>
>>> Od: Agustin Lobo w imieniu Agustin Lobo
>>> Wys?ano: Cz 21.06.2007 09:41
>>> Do: Roger Bivand
>>> DW: R-sig-Geo at stat.math.ethz.ch
>>> Temat: Re: ODP: [R-sig-Geo] spsample and NA
>>>
>>>
>>>
>>> The test with meuse.grid works:
>>>
>>> #copied from file:SpatialGridDataFrame-class.html
>>> coordinates(meuse.grid) = c("x", "y") # promote 
>>> toSpatialPointsDataFrame
>>> gridded(meuse.grid) <- TRUE # promote to SpatialPixelsDataFrame
>>> x = as(meuse.grid, "SpatialGridDataFrame") # creates the full grid
>>> #Now me:
>>>  > unique(x at data$soil)
>>> [1] NA  1  2  3
>>>
>>>  > table(x at data$soil)
>>>     1    2    3
>>> 1665 1084  354
>>>
>>> test.stsamp <- spsample(x, n = 10, "stratified")
>>> o <- overlay(x, test.stsamp)
>>>  > o
>>>            coordinates part.a part.b      dist soil ffreq
>>> 5556 (179156, 330917)      0      1 0.1030270    1     1
>>> 6670 (180039, 330336)      0      1 0.0703333    1     2
>>> 2240 (180677, 332606)      1      0 0.0975136    1     1
>>>
>>>
>>> But don't know how to make that my raster behave in the same way. What
>>> does it mean "cast to SpatialPixels first"? I thought that as
>>> X comes from an imported raster it was an sp object already.
>>>
>>> Also, there are several components in the x coming from meuse.grid:
>>> str(x)
>>> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>>>    ..@ data       :'data.frame': 8112 obs. of  5 variables:
>>>    .. ..$ part.a: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>>    .. ..$ part.b: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>>    .. ..$ dist  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>>    .. ..$ soil  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>>    .. ..$ ffreq : Factor w/ 3 levels "1","2","3": NA NA NA NA NA NA NA
>>> NA NA NA ...
>>>
>>> how does spsample know which layer has to be used for the 
>>> stratification?
>>>
>>> Thanks!
>>>
>>> Agus
>>>
>>> Roger Bivand escribi?:
>>>  
>>>> I think that if you cast to SpatialPixels first, the problem will 
>>>> go away, because the all-NA cases are dropped with their 
>>>> coordinates. Could you try the same example with meuse.grid and see 
>>>> how it goes?
>>>>
>>>> Roger
>>>>
>>>> ---
>>>> Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no
>>>>
>>>> ________________________________
>>>>
>>>> Od: r-sig-geo-bounces at stat.math.ethz.ch w imieniu Agustin Lobo
>>>> Wys?ano: ?r 20.06.2007 10:11
>>>> Do: R-sig-Geo at stat.math.ethz.ch
>>>> Temat: [R-sig-Geo] spsample and NA
>>>>
>>>>
>>>>
>>>> It is often the case, at least with raster (grid) objects,
>>>> that you are not interested on a part of the raster.
>>>> For example because it's outside a non.rectangular region of study
>>>> and/or because some types of terrain (some classes) are outside
>>>> the scope of the study. In any case, those parts can be
>>>> represented by NA.
>>>>
>>>> Unfortunately, while some functions like table() would not
>>>> include the NA in the statistics, spsample includes
>>>> the NA as just another class, which implies that a fraction
>>>> of the resulting coordinates will lay on the NA
>>>> part of the raster. This makes it difficult, to get N valid (i.e., not
>>>> on NA parts) points using spsample. Is there any way around this?
>>>> For example, if I want 10 points on non-NA cells of
>>>> raster X, I would like
>>>>
>>>> spsample(X, 10, "stratified")
>>>>
>>>> to provide 10 positions on non-NA cells.
>>>>
>>>> At the moment, I get:
>>>>
>>>> x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
>>>> ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(100,100))
>>>> GDAL.close(x)
>>>>
>>>> ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
>>>>
>>>> X <- ESTRAT3OBAC
>>>> X$cut <- as.ordered(cut(X$band1, c(0,10,100),include.lowest=TRUE))
>>>> table(X$cut)
>>>>
>>>>    [0,10] (10,100]
>>>>        83     1961
>>>>
>>>> summary(X$cut)
>>>>    [0,10] (10,100]     NA's
>>>>        83     1961     7956
>>>> table(X$cut)
>>>>
>>>>    [0,10] (10,100]
>>>>        83     1961
>>>>
>>>> Xspsample <- spsample(X,10,"stratified")
>>>> Xo <- overlay(X,Xspsample)
>>>> summary(Xo)
>>>> Object of class SpatialPointsDataFrame
>>>> Coordinates:
>>>>           min       max
>>>> x1  410995.6  414954.4
>>>> x2 4608002.1 4610566.0
>>>> Is projected: TRUE
>>>> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
>>>> Number of points: 9
>>>> Data attributes:
>>>>       band1             cut
>>>>   Min.   :   67   [0,10]  :0
>>>>   1st Qu.:   97   (10,100]:3
>>>>   Median :  159   NA's    :6
>>>>   Mean   :24745
>>>>   3rd Qu.:55537
>>>>   Max.   :55537
>>>>
>>>> That is, I get 6 positions on NA values of X
>>>>
>>>> Thanks!
>>>>
>>>> Agus
>>>>
>>>> -- 
>>>> Dr. Agustin Lobo
>>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>> LLuis Sole Sabaris s/n
>>>> 08028 Barcelona
>>>> Spain
>>>> Tel. 34 934095410
>>>> Fax. 34 934110012
>>>> email: Agustin.Lobo at ija.csic.es
>>>> http://www.ija.csic.es/gt/obster
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>>
>>>>     
>>>
>>> -- 
>>> Dr. Agustin Lobo
>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>> LLuis Sole Sabaris s/n
>>> 08028 Barcelona
>>> Spain
>>> Tel. 34 934095410
>>> Fax. 34 934110012
>>> email: Agustin.Lobo at ija.csic.es
>>> http://www.ija.csic.es/gt/obster
>>>
>>>
>>>
>>>     [[alternative HTML version deleted]]
>>>
>>>   
>>> ------------------------------------------------------------------------ 
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>   
>>
>>
>



From putler at sauder.ubc.ca  Mon Jun 25 18:35:49 2007
From: putler at sauder.ubc.ca (Dan Putler)
Date: Mon, 25 Jun 2007 09:35:49 -0700
Subject: [R-sig-Geo] functions on kernel density estimation in
	pointpattern analysis
In-Reply-To: <2fc17e30706250749sac96c39u53345cc0e66667a0@mail.gmail.com>
References: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
	<6262c54c0706241728y57aecb01s70a9b3ba5a1bab22@mail.gmail.com>
	<706467E0-DF14-483F-AE7A-5629BD1E7A59@sauder.ubc.ca>
	<2fc17e30706250749sac96c39u53345cc0e66667a0@mail.gmail.com>
Message-ID: <CD6B268C-DD44-4109-AB13-2CE746B19D07@sauder.ubc.ca>

Hi Zhi Jie,

Below are some changes to your code which should make you much  
happier. It does involve the use of the RColorBrewer package to  
create a color palette that makes the plot a bit easier to see. As  
you can guess, the size of the standard deviation given to  
density.ppp was the problem. Your data is in the Xian 1980/3-degree  
Gauss-Kruger CM 117E projection (which is EPSG code 2384). Based on  
looking at things, the units of this projection are meters. Using the  
defaults of density.ppp, the standard deviation of the bandwidth of  
the smoother is 0.05 meters, far smaller than you wanted. The  
implicit assumption in density.ppp appears to be that the window of  
the study area is a unit square. The width of your study area is  
about 60Km, so to get a comparable bandwidth for your study area  
relative to the unit square, I upped the standard deviation to 3000  
meters.

Here is my altered version of your code, you will need to change  
things back to the correct paths to the shapefile sets.
________
library(spatstat)
library(maptools)
library(RColorBrewer)

myPal=brewer.pal(12,"Paired") # An easily seen color palette

guichi<-readShapePoly("~/Research/data/guichi2.shp")
W <-as(as(guichi, "SpatialPolygons"), "owin")  #boundary polygons

cases<-coordinates(readShapePoints("~/Research/data/cases.shp"))   
#points
colnames(cases)<-c("x","y")
cases[1:2,]

#plot(W);points(cases)

pointcase <- ppp(cases[,1], cases[,2], window=W)  #generate the ppp  
object

kdensity<-density.ppp(pointcase, 3000)
plot(kdensity, col=myPal)

rm(list=c("guichi","W","cases","pointcase","kdensity","myPal"))
_______

Dan

On 25-Jun-07, at 7:49 AM, zhijie zhang wrote:

> Dear Roger Bivand,Tim Keitt, and Dan Putler,
>   Thanks for your answers. I have tried density.ppp(spatstat) and  
> kernel2d(splancs), but the results are not very satisfied. I think  
> there should be a higher density in the blue part of the map in the  
> attachment.
>   My dataset has been put in the attachment and programs have been  
> pasted in the following, so that u can use and check it.
>    I want to do the work like "non-parametric estimation of a  
> spatially varying intensity" in Diggle's book(2003.P.116-121).
>   BTW, i'm not familiar with locfit,would u please also check it  
> using locfit? Thanks very much.
> ###################################################################### 
> #########
>                            Kernel density estimation--spatstat
> ###################################################################### 
> ##########
> library(sp)
> library(foreign)
> library(maptools)
> library(mgcv)
> library(spatstat)
> guichi<-readShapePoly("d:/deleting/kernel/kernel/guichi2.shp")
> W <-as(as(guichi, "SpatialPolygons"), "owin")  #boundary polygons
>
> cases<-coordinates(readShapePoints("d:/deleting/kernel/kernel/ 
> cases.shp"))  #points
> colnames(cases)<-c("x","y")
> cases[1:2,]
>
> #plot(W);points(cases)
>
> pointcase <- ppp(cases[,1], cases[,2], window=W)  #generate the ppp  
> object
>
> kdensity<-density.ppp(pointcase, 0.05)
> plot(kdensity)
> Q:there are almost the same density in the whole area,but in fact  
> it may have a higher density in the blue part of the attached map?  
> I think the problem may the inappropriate value of sigma, how to  
> determine its value?
>
> ###################################################################### 
> ##########
>                                  Kernel density estimation--splancs
> ###################################################################### 
> ##########
> library(sp)
> library(splancs)
> library(foreign)
> library(maptools)
>
> case<-readShapePoints("d:/deleting/kernel/kernel/cases.shp")
> guichi<-readShapePoly("d:/deleting/kernel/kernel/guichi2.shp")
>
> #Conversion
> case_pts <- coordinates(case)
> case <- as.points(case_pts)
> splancs_poly <- getPolygonCoordsSlot(getPolygonsPolygonsSlot 
> (getSpPpolygonsSlot(guichi)[[1]])[[1]])
>
> #to unpack the coordinates of the points and the single ring boundary
> polymap(splancs_poly,xlab="x(?)",ylab="y(?)")
> pointmap(case_pts, add=TRUE)
>
> m<-mse2d(case,splancs_poly,nsmse=1000,range=5)  #plots the  
> estimated mean square error as a function of h0
> plot(m$h[290:1000],m$mse[290:1000],type="l")
>
> n<-which(m$mse==min(m$mse))
> h0<-m$h[n]
>
>
> #smooth variation
> smooth<-kernel2d(case, splancs_poly, h0=h0, nx=100, ny=100)
> polymap(splancs_poly)  #sets the axes correctly and draws the polygon
> image(smooth,add=T)   #the smoothed image is superimposed
> polymap(splancs_poly,add=T) #redrawn the polymap in order not to be  
> obsured by smooth image
> Q:The result is still not satisfied,there must be something wrong  
> with my programs .
>
>
>
>
>
>
> On 6/25/07, Dan Putler <putler at sauder.ubc.ca> wrote: Hi All,
>
> To add some detail to Roger's earlier, post density.ppp in the
> spatstat seems to be a very good answer to the original post since it
> is specifically designed to estimate a kernel density for a point
> process pattern. This function use a bivariate Gaussian smoother that
> lends itself to user configuration.
>
> Dan
>
> On 24-Jun-07, at 5:28 PM, Tim Keitt wrote:
>
> > I rather like locfit.
> >
> > THK
> >
> > On 6/24/07, zhijie zhang <epistat at gmail.com> wrote:
> >> Dear Friends,
> >>  Except kernel2d(splancs) function, are there any other functions
> >> on kernel
> >> density estimation in point pattern analysis? I use the kernel2d
> >> (splancs)
> >> function to anayze my dataset, and the result seems not to be very
> >> good.
> >>   Any suggestions or help in kernel density estimation of
> >> univariate or
> >> multivariate point process are greatly appreciated.
> >>   BTW, i mainly want ot do the kernel density estimation in both
> >> univariate and multivariate point process.
> >> --
> >> With Kind Regards,
> >>
> >> oooO:::::::::
> >> (..):::::::::
> >> :\.(:::Oooo::
> >> ::\_)::(..)::
> >> :::::::)./:::
> >> ::::::(_/::::
> >> :::::::::::::
> >>  
> [********************************************************************
> >> ***]
> >> Zhi Jie,Zhang ,PHD
> >> Tel:86-21-54237149
> >> Dept. of Epidemiology,School of Public Health,Fudan University
> >> Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> >> Postcode:200032
> >> Email:epistat at gmail.com
> >> Website: www.statABC.com
> >>  
> [********************************************************************
> >> ***]
> >> oooO:::::::::
> >> (..):::::::::
> >> :\.(:::Oooo::
> >> ::\_)::(..)::
> >> :::::::)./:::
> >> ::::::(_/::::
> >> :::::::::::::
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
> > --
> > Timothy H. Keitt, University of Texas at Austin
> > Contact info and schedule at http://www.keittlab.org/tkeitt/
> > Reprints at http://www.keittlab.org/tkeitt/papers/
> > ODF attachment? See http://www.openoffice.org/
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> -- 
> With Kind Regards,
>
> oooO:::::::::
> (..):::::::::
> :\.(:::Oooo::
> ::\_)::(..)::
> :::::::)./:::
> ::::::(_/::::
> :::::::::::::
> [********************************************************************* 
> **]
> Zhi Jie,Zhang ,PHD
> Tel:86-21-54237149
> Dept. of Epidemiology,School of Public Health,Fudan University
> Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> Postcode:200032
> Email:epistat at gmail.com
> Website: www.statABC.com
> [********************************************************************* 
> **]
> oooO:::::::::
> (..):::::::::
> :\.(:::Oooo::
> ::\_)::(..)::
> :::::::)./:::
> ::::::(_/::::
> :::::::::::::
> <data.rar>
> <map.jpg>



From epistat at gmail.com  Mon Jun 25 16:49:59 2007
From: epistat at gmail.com (zhijie zhang)
Date: Mon, 25 Jun 2007 22:49:59 +0800
Subject: [R-sig-Geo] functions on kernel density estimation in
	pointpattern analysis
In-Reply-To: <706467E0-DF14-483F-AE7A-5629BD1E7A59@sauder.ubc.ca>
References: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
	<6262c54c0706241728y57aecb01s70a9b3ba5a1bab22@mail.gmail.com>
	<706467E0-DF14-483F-AE7A-5629BD1E7A59@sauder.ubc.ca>
Message-ID: <2fc17e30706250749sac96c39u53345cc0e66667a0@mail.gmail.com>

Dear Roger Bivand,Tim Keitt, and Dan Putler,
  Thanks for your answers. I have tried density.ppp(spatstat) and
kernel2d(splancs), but the results are not very satisfied. I think there
should be a higher density in the blue part of the map in the attachment.
  My dataset has been put in the attachment and programs have been pasted in
the following, so that u can use and check it.
   I want to do the work like "non-parametric estimation of a spatially
varying intensity" in Diggle's book(2003.P.116-121).
  BTW, i'm not familiar with locfit,would u please also check it using
locfit? Thanks very much.
###############################################################################
                           Kernel density estimation--spatstat
################################################################################
library(sp)
library(foreign)
library(maptools)
library(mgcv)
library(spatstat)

guichi<-readShapePoly("d:/deleting/kernel/kernel/guichi2.shp")
W <-as(as(guichi, "SpatialPolygons"), "owin")  #boundary polygons

cases<-coordinates(readShapePoints("d:/deleting/kernel/kernel/cases.shp"))
#points
colnames(cases)<-c("x","y")
cases[1:2,]

#plot(W);points(cases)

pointcase <- ppp(cases[,1], cases[,2], window=W)  #generate the ppp object

kdensity<-density.ppp(pointcase, 0.05)
plot(kdensity)
*Q:*there are almost the same density in the whole area,but in fact it may
have a higher density in the blue part of the attached map? I think the
problem may the inappropriate value of sigma, how to determine its value?

################################################################################
                                 Kernel density estimation--splancs
################################################################################
library(sp)
library(splancs)
library(foreign)
library(maptools)

case<-readShapePoints("d:/deleting/kernel/kernel/cases.shp")
guichi<-readShapePoly("d:/deleting/kernel/kernel/guichi2.shp")

#Conversion
case_pts <- coordinates(case)
case <- as.points(case_pts)
splancs_poly <-
getPolygonCoordsSlot(getPolygonsPolygonsSlot(getSpPpolygonsSlot(guichi)[[1]])[[1]])


#to unpack the coordinates of the points and the single ring boundary
polymap(splancs_poly,xlab="x(?)",ylab="y(?)")
pointmap(case_pts, add=TRUE)

m<-mse2d(case,splancs_poly,nsmse=1000,range=5)  #plots the estimated mean
square error as a function of h0
plot(m$h[290:1000],m$mse[290:1000],type="l")

n<-which(m$mse==min(m$mse))
h0<-m$h[n]


#smooth variation
smooth<-kernel2d(case, splancs_poly, h0=h0, nx=100, ny=100)
polymap(splancs_poly)  #sets the axes correctly and draws the polygon
image(smooth,add=T)   #the smoothed image is superimposed
polymap(splancs_poly,add=T) #redrawn the polymap in order not to be obsured
by smooth image
*Q*:The result is still not satisfied,there must be something wrong with my
programs.







On 6/25/07, Dan Putler <putler at sauder.ubc.ca> wrote:
>
> Hi All,
>
> To add some detail to Roger's earlier, post density.ppp in the
> spatstat seems to be a very good answer to the original post since it
> is specifically designed to estimate a kernel density for a point
> process pattern. This function use a bivariate Gaussian smoother that
> lends itself to user configuration.
>
> Dan
>
> On 24-Jun-07, at 5:28 PM, Tim Keitt wrote:
>
> > I rather like locfit.
> >
> > THK
> >
> > On 6/24/07, zhijie zhang <epistat at gmail.com> wrote:
> >> Dear Friends,
> >>  Except kernel2d(splancs) function, are there any other functions
> >> on kernel
> >> density estimation in point pattern analysis? I use the kernel2d
> >> (splancs)
> >> function to anayze my dataset, and the result seems not to be very
> >> good.
> >>   Any suggestions or help in kernel density estimation of
> >> univariate or
> >> multivariate point process are greatly appreciated.
> >>   BTW, i mainly want ot do the kernel density estimation in both
> >> univariate and multivariate point process.
> >> --
> >> With Kind Regards,
> >>
> >> oooO:::::::::
> >> (..):::::::::
> >> :\.(:::Oooo::
> >> ::\_)::(..)::
> >> :::::::)./:::
> >> ::::::(_/::::
> >> :::::::::::::
> >> [********************************************************************
> >> ***]
> >> Zhi Jie,Zhang ,PHD
> >> Tel:86-21-54237149
> >> Dept. of Epidemiology,School of Public Health,Fudan University
> >> Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> >> Postcode:200032
> >> Email:epistat at gmail.com
> >> Website: www.statABC.com
> >> [********************************************************************
> >> ***]
> >> oooO:::::::::
> >> (..):::::::::
> >> :\.(:::Oooo::
> >> ::\_)::(..)::
> >> :::::::)./:::
> >> ::::::(_/::::
> >> :::::::::::::
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
> > --
> > Timothy H. Keitt, University of Texas at Austin
> > Contact info and schedule at http://www.keittlab.org/tkeitt/
> > Reprints at http://www.keittlab.org/tkeitt/papers/
> > ODF attachment? See http://www.openoffice.org/
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
With Kind Regards,

oooO:::::::::
(..):::::::::
:\.(:::Oooo::
::\_)::(..)::
:::::::)./:::
::::::(_/::::
:::::::::::::
[***********************************************************************]
Zhi Jie,Zhang ,PHD
Tel:86-21-54237149
Dept. of Epidemiology,School of Public Health,Fudan University
Address:No. 138 Yi Xue Yuan Road,Shanghai,China
Postcode:200032
Email:epistat at gmail.com
Website: www.statABC.com
[***********************************************************************]
oooO:::::::::
(..):::::::::
:\.(:::Oooo::
::\_)::(..)::
:::::::)./:::
::::::(_/::::
:::::::::::::
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070625/0a7b4e57/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: data.rar
Type: application/octet-stream
Size: 8653 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070625/0a7b4e57/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: map.jpg
Type: image/jpeg
Size: 20460 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070625/0a7b4e57/attachment.jpg>

From Roger.Bivand at nhh.no  Mon Jun 25 19:58:56 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 25 Jun 2007 19:58:56 +0200 (CEST)
Subject: [R-sig-Geo] functions on kernel density estimation in
 pointpattern analysis
In-Reply-To: <CD6B268C-DD44-4109-AB13-2CE746B19D07@sauder.ubc.ca>
References: <2fc17e30706240757r1f30be8csf5b33bcd5f5852cf@mail.gmail.com>
	<6262c54c0706241728y57aecb01s70a9b3ba5a1bab22@mail.gmail.com>
	<706467E0-DF14-483F-AE7A-5629BD1E7A59@sauder.ubc.ca>
	<2fc17e30706250749sac96c39u53345cc0e66667a0@mail.gmail.com>
	<CD6B268C-DD44-4109-AB13-2CE746B19D07@sauder.ubc.ca>
Message-ID: <Pine.LNX.4.64.0706251957060.3559@reclus.nhh.no>

On Mon, 25 Jun 2007, Dan Putler wrote:

Thanks, Dan, I agree that the bandwidths are the problem here. Often the 
image breaks settings are also very misleading for 2D density plots, so 
one needs to take care, as you show.

Roger

> Hi Zhi Jie,

Below are some changes to your code which should make you much 
happier. It does involve the use of the RColorBrewer package to 
create a color palette that makes the plot a bit easier to see. As 
you can guess, the size of the standard deviation given to 
density.ppp was the problem. Your data is in the Xian 1980/3-degree 
Gauss-Kruger CM 117E projection (which is EPSG code 2384). Based on 
looking at things, the units of this projection are meters. Using the 
defaults of density.ppp, the standard deviation of the bandwidth of 
the smoother is 0.05 meters, far smaller than you wanted. The 
implicit assumption in density.ppp appears to be that the window of 
the study area is a unit square. The width of your study area is 
about 60Km, so to get a comparable bandwidth for your study area 
relative to the unit square, I upped the standard deviation to 3000 
meters.

Here is my altered version of your code, you will need to change 
things back to the correct paths to the shapefile sets.
________
library(spatstat)
library(maptools)
library(RColorBrewer)

myPal=brewer.pal(12,"Paired") # An easily seen color palette

guichi<-readShapePoly("~/Research/data/guichi2.shp")
W <-as(as(guichi, "SpatialPolygons"), "owin")  #boundary polygons

cases<-coordinates(readShapePoints("~/Research/data/cases.shp")) 
#points
colnames(cases)<-c("x","y")
cases[1:2,]

#plot(W);points(cases)

pointcase <- ppp(cases[,1], cases[,2], window=W)  #generate the ppp 
object

kdensity<-density.ppp(pointcase, 3000)
plot(kdensity, col=myPal)

rm(list=c("guichi","W","cases","pointcase","kdensity","myPal"))
_______

Dan

On 25-Jun-07, at 7:49 AM, zhijie zhang wrote:

> Dear Roger Bivand,Tim Keitt, and Dan Putler,
>   Thanks for your answers. I have tried density.ppp(spatstat) and 
> kernel2d(splancs), but the results are not very satisfied. I think 
> there should be a higher density in the blue part of the map in the 
> attachment.
>   My dataset has been put in the attachment and programs have been 
> pasted in the following, so that u can use and check it.
>    I want to do the work like "non-parametric estimation of a 
> spatially varying intensity" in Diggle's book(2003.P.116-121).
>   BTW, i'm not familiar with locfit,would u please also check it 
> using locfit? Thanks very much.
> ###################################################################### 
> #########
>                            Kernel density estimation--spatstat
> ###################################################################### 
> ##########
> library(sp)
> library(foreign)
> library(maptools)
> library(mgcv)
> library(spatstat)
> guichi<-readShapePoly("d:/deleting/kernel/kernel/guichi2.shp")
> W <-as(as(guichi, "SpatialPolygons"), "owin")  #boundary polygons
>
> cases<-coordinates(readShapePoints("d:/deleting/kernel/kernel/ 
> cases.shp"))  #points
> colnames(cases)<-c("x","y")
> cases[1:2,]
>
> #plot(W);points(cases)
>
> pointcase <- ppp(cases[,1], cases[,2], window=W)  #generate the ppp 
> object
>
> kdensity<-density.ppp(pointcase, 0.05)
> plot(kdensity)
> Q:there are almost the same density in the whole area,but in fact 
> it may have a higher density in the blue part of the attached map? 
> I think the problem may the inappropriate value of sigma, how to 
> determine its value?
>
> ###################################################################### 
> ##########
>                                  Kernel density estimation--splancs
> ###################################################################### 
> ##########
> library(sp)
> library(splancs)
> library(foreign)
> library(maptools)
>
> case<-readShapePoints("d:/deleting/kernel/kernel/cases.shp")
> guichi<-readShapePoly("d:/deleting/kernel/kernel/guichi2.shp")
>
> #Conversion
> case_pts <- coordinates(case)
> case <- as.points(case_pts)
> splancs_poly <- getPolygonCoordsSlot(getPolygonsPolygonsSlot 
> (getSpPpolygonsSlot(guichi)[[1]])[[1]])
>
> #to unpack the coordinates of the points and the single ring boundary
> polymap(splancs_poly,xlab="x(??)",ylab="y(??)")
> pointmap(case_pts, add=TRUE)
>
> m<-mse2d(case,splancs_poly,nsmse=1000,range=5)  #plots the 
> estimated mean square error as a function of h0
> plot(m$h[290:1000],m$mse[290:1000],type="l")
>
> n<-which(m$mse==min(m$mse))
> h0<-m$h[n]
>
>
> #smooth variation
> smooth<-kernel2d(case, splancs_poly, h0=h0, nx=100, ny=100)
> polymap(splancs_poly)  #sets the axes correctly and draws the polygon
> image(smooth,add=T)   #the smoothed image is superimposed
> polymap(splancs_poly,add=T) #redrawn the polymap in order not to be 
> obsured by smooth image
> Q:The result is still not satisfied,there must be something wrong 
> with my programs .
>
>
>
>
>
>
> On 6/25/07, Dan Putler <putler at sauder.ubc.ca> wrote: Hi All,
>
> To add some detail to Roger's earlier, post density.ppp in the
> spatstat seems to be a very good answer to the original post since it
> is specifically designed to estimate a kernel density for a point
> process pattern. This function use a bivariate Gaussian smoother that
> lends itself to user configuration.
>
> Dan
>
> On 24-Jun-07, at 5:28 PM, Tim Keitt wrote:
>
> > I rather like locfit.
> >
> > THK
> >
> > On 6/24/07, zhijie zhang <epistat at gmail.com> wrote:
> >> Dear Friends,
> >>  Except kernel2d(splancs) function, are there any other functions
> >> on kernel
> >> density estimation in point pattern analysis? I use the kernel2d
> >> (splancs)
> >> function to anayze my dataset, and the result seems not to be very
> >> good.
> >>   Any suggestions or help in kernel density estimation of
> >> univariate or
> >> multivariate point process are greatly appreciated.
> >>   BTW, i mainly want ot do the kernel density estimation in both
> >> univariate and multivariate point process.
> >> --
> >> With Kind Regards,
> >>
> >> oooO:::::::::
> >> (..):::::::::
> >> :\.(:::Oooo::
> >> ::\_)::(..)::
> >> :::::::)./:::
> >> ::::::(_/::::
> >> :::::::::::::
> >> 
> [********************************************************************
> >> ***]
> >> Zhi Jie,Zhang ,PHD
> >> Tel:86-21-54237149
> >> Dept. of Epidemiology,School of Public Health,Fudan University
> >> Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> >> Postcode:200032
> >> Email:epistat at gmail.com
> >> Website: www.statABC.com
> >> 
> [********************************************************************
> >> ***]
> >> oooO:::::::::
> >> (..):::::::::
> >> :\.(:::Oooo::
> >> ::\_)::(..)::
> >> :::::::)./:::
> >> ::::::(_/::::
> >> :::::::::::::
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at stat.math.ethz.ch
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >
> > --
> > Timothy H. Keitt, University of Texas at Austin
> > Contact info and schedule at http://www.keittlab.org/tkeitt/
> > Reprints at http://www.keittlab.org/tkeitt/papers/
> > ODF attachment? See http://www.openoffice.org/
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> -- 
> With Kind Regards,
>
> oooO:::::::::
> (..):::::::::
> :\.(:::Oooo::
> ::\_)::(..)::
> :::::::)./:::
> ::::::(_/::::
> :::::::::::::
> [********************************************************************* 
> **]
> Zhi Jie,Zhang ,PHD
> Tel:86-21-54237149
> Dept. of Epidemiology,School of Public Health,Fudan University
> Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> Postcode:200032
> Email:epistat at gmail.com
> Website: www.statABC.com
> [********************************************************************* 
> **]
> oooO:::::::::
> (..):::::::::
> :\.(:::Oooo::
> ::\_)::(..)::
> :::::::)./:::
> ::::::(_/::::
> :::::::::::::
> <data.rar>
> <map.jpg>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Mon Jun 25 19:59:07 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 25 Jun 2007 19:59:07 +0200 (CEST)
Subject: [R-sig-Geo] distmap
In-Reply-To: <467F9B21.3090008@ija.csic.es>
References: <467BCA0A.6020401@ija.csic.es>
	<Pine.LNX.4.64.0706241755170.371@reclus.nhh.no>
	<467F9B21.3090008@ija.csic.es>
Message-ID: <Pine.LNX.4.64.0706251936500.3559@reclus.nhh.no>

On Mon, 25 Jun 2007, Agustin Lobo wrote:

> I've tried (among other things):
>>  limit1 <- read.shape("limit_PNSN2000.shp")
> Shapefile type: Polygon, (5), # of Shapes: 2
>>  limit1poly <- Map2poly(limit1)
>>  limit1owin <- as(limit1poly,"owin")
> Error in .classEnv(thisClass) : unable to find an environment containing 
> class "polylist"
>
>>  limit2 <- readOGR("limit_PNSN2000.shp",layer="limit_PNSN2000")
> OGR data source with driver: ESRI Shapefile
> Source: "limit_PNSN2000.shp", layer: "limit_PNSN2000"
> with  2  rows and  1  columns

Then just:

limit1owin <- as(limit2,"owin")

ought to work with current maptools, or possibly coerce:

limit1owin <- as(as(limit2, "SpatialPolygons"), "owin")



>>  limit2poly <- Map2poly(limit1)
>>  limit1owin <- as(limit2poly,"owin")
> Error in .classEnv(thisClass) : unable to find an environment containing 
> class "polylist"
>>  limit1owin <- as(limit2,"owin")
> Error in as.owin.SpatialPolygons(from) : W must be a SpatialPolygons object
>
> I guess all I need is to convert my shapefile (read into R via read.shape or 
> readOGR?) into an object like letterR:
>
>>  data(letterR)
>>  str(letterR)
> List of 4
>  $ type  : chr "polygonal"
>  $ xrange: num [1:2] 2.02 3.93
>  $ yrange: num [1:2] 0.645 3.278
>  $ bdry  :List of 2
>   ..$ :List of 2
>   .. ..$ x: num [1:24] 2.03 2.02 2.02 2.66 2.66 ...
>   .. ..$ y: num [1:24] 3.278 3.248 0.653 0.653 1.695 ...
>   ..$ :List of 2
>   .. ..$ x: num [1:10] 2.65 2.64 3.04 3.12 3.16 ...
>   .. ..$ y: num [1:10] 2.23 2.70 2.71 2.63 2.50 ...
>  - attr(*, "class")= chr "owin"
>
> but how can I do it?
>
> Also, I'm so confused with so many spatial objects, is there a guide?

Please ignore all the non sp classes, that makes things simpler. The guide 
was in R News in 2005, and is still largely relevant for the Spatial* 
classes.

Roger

>
> Agus
>
> Roger Bivand escribi?:
>>  On Fri, 22 Jun 2007, Agustin Lobo wrote:
>> 
>> >  Dear sig-geos,
>> > 
>> >  I have to calculate a distmap (that is, a map
>> >  in which the value of each cell is the distance
>> >  from the cell to a given object) for a set of polygons.
>> >  It seems to me that distmap.owin in spatstat would do it
>> >  fine, but distmap.owin does not accept objects
>> >  imported from shp vectors via readOGR. distmap.owin requires
>> >  type "polygonal" and readOGR yields class 'SpatialPolygonsDataFrame'
>> >  Is there any way to cast or convert from 'SpatialPolygonsDataFrame'
>> >  to "polygonal" or an alternative function to calculate the distances
>> >  to the boundaries of the polygons?
>>
>>  Have you tried coercing with as(x, "owin") in maptools?
>>
>>  Roger
>> 
>> > 
>> >  Thanks
>> > 
>> >  Agus
>> > 
>> >
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From e.pebesma at geo.uu.nl  Mon Jun 25 22:07:40 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Mon, 25 Jun 2007 22:07:40 +0200
Subject: [R-sig-Geo] distmap
In-Reply-To: <Pine.LNX.4.64.0706251936500.3559@reclus.nhh.no>
References: <467BCA0A.6020401@ija.csic.es>	<Pine.LNX.4.64.0706241755170.371@reclus.nhh.no>	<467F9B21.3090008@ija.csic.es>
	<Pine.LNX.4.64.0706251936500.3559@reclus.nhh.no>
Message-ID: <4680208C.3080706@geo.uu.nl>

Roger Bivand wrote:
> On Mon, 25 Jun 2007, Agustin Lobo wrote:
>
>> I've tried (among other things):
>>>  limit1 <- read.shape("limit_PNSN2000.shp")
>> Shapefile type: Polygon, (5), # of Shapes: 2
>>>  limit1poly <- Map2poly(limit1)
>>>  limit1owin <- as(limit1poly,"owin")
>> Error in .classEnv(thisClass) : unable to find an environment 
>> containing class "polylist"
>>
>>>  limit2 <- readOGR("limit_PNSN2000.shp",layer="limit_PNSN2000")
>> OGR data source with driver: ESRI Shapefile
>> Source: "limit_PNSN2000.shp", layer: "limit_PNSN2000"
>> with  2  rows and  1  columns
>
> Then just:
>
> limit1owin <- as(limit2,"owin")
>
> ought to work with current maptools, or possibly coerce:
>
> limit1owin <- as(as(limit2, "SpatialPolygons"), "owin")
>
the latter form shouldn't be needed thanks to S4 inheritance.
--
Edzer



From david.march at uib.es  Tue Jun 26 11:03:28 2007
From: david.march at uib.es (=?windows-1252?Q?David_March_Morl=E0?=)
Date: Tue, 26 Jun 2007 11:03:28 +0200
Subject: [R-sig-Geo] path distance maps with R?
Message-ID: <4680D660.6010402@uib.es>

Dear all,

I want to create port-based distance maps to analyse spatial 
distribution of fishing effort. I have tried to use ?distmap.ppp? 
function from spatstat, but this computes Euclidean distances and I want 
to take into account obstacles (i.e. islands) in the same way as Caddy 
and Carocci (http://www.faocopemed.org/vldocs/0000028/publi04.pdf). Have 
you got any suggestion to perform these path distance maps with R?

Thanks,

-- 
David March Morl?
Doctorando / PhD student
Instituto Mediterraneo de Estudios Avanzados (UIB-CSIC)
C/Miquel Marqu?s, 21
07190 Esporles
Islas Baleares - Spain
Tel: +34 971 611 722
Fax: +34 971 611 761
Email: david.march at uib.es



From lee.kitty at yahoo.com  Mon Jun 25 22:27:09 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Mon, 25 Jun 2007 13:27:09 -0700 (PDT)
Subject: [R-sig-Geo] Simple and Efficient way to Divide Study Area?
Message-ID: <288693.34654.qm@web36310.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070625/033fd0d0/attachment.pl>

From epistat at gmail.com  Tue Jun 26 10:23:59 2007
From: epistat at gmail.com (zhijie zhang)
Date: Tue, 26 Jun 2007 16:23:59 +0800
Subject: [R-sig-Geo] functions on kernel density estimation in
	pointpattern analysis-another two little problems
Message-ID: <2fc17e30706260123t37b91f33ie5a8984a1b5b8f5@mail.gmail.com>

Dear Roger Bivand and Dan Putler,
  The result is really good, and i'm also clear with the choice of sigma in
density.ppp() function.
  I still have another two little problems:
*Q1*: How to change the background color into other color(e.g. white),or
specify all the colors into the user-defined colors?
myPal=brewer.pal(4,"Paired")   # For example, how to specify the 4 colors
with white,black,red,and blue.
I'm not familiar with RColorBrewer package, but i need it now. I'm now
learning it.

*Q2*: How to overlay the other .shp file with the result of kernel density
estimation?
The other .shp file is Qiupu River and Yangtze River. If i can overlay them
with the result of kernel density estimation,
  it'll be very clear that the cross part of Qiupu River and Yangtze River
has the highest density,which is true in reality and really
  what i want.
 Thanks very much.




On 6/26/07, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
> On Mon, 25 Jun 2007, Dan Putler wrote:
>
> Thanks, Dan, I agree that the bandwidths are the problem here. Often the
> image breaks settings are also very misleading for 2D density plots, so
> one needs to take care, as you show.
>
> Roger
>
> > Hi Zhi Jie,
>
> Below are some changes to your code which should make you much
> happier. It does involve the use of the RColorBrewer package to
> create a color palette that makes the plot a bit easier to see. As
> you can guess, the size of the standard deviation given to
> density.ppp was the problem. Your data is in the Xian 1980/3-degree
> Gauss-Kruger CM 117E projection (which is EPSG code 2384). Based on
> looking at things, the units of this projection are meters. Using the
> defaults of density.ppp, the standard deviation of the bandwidth of
> the smoother is 0.05 meters, far smaller than you wanted. The
> implicit assumption in density.ppp appears to be that the window of
> the study area is a unit square. The width of your study area is
> about 60Km, so to get a comparable bandwidth for your study area
> relative to the unit square, I upped the standard deviation to 3000
> meters.
>
> Here is my altered version of your code, you will need to change
> things back to the correct paths to the shapefile sets.
> ________
> library(spatstat)
> library(maptools)
> library(RColorBrewer)
>
> myPal=brewer.pal(12,"Paired") # An easily seen color palette
>
> guichi<-readShapePoly("~/Research/data/guichi2.shp")
> W <-as(as(guichi, "SpatialPolygons"), "owin")  #boundary polygons
>
> cases<-coordinates(readShapePoints("~/Research/data/cases.shp"))
> #points
> colnames(cases)<-c("x","y")
> cases[1:2,]
>
> #plot(W);points(cases)
>
> pointcase <- ppp(cases[,1], cases[,2], window=W)  #generate the ppp
> object
>
> kdensity<-density.ppp(pointcase, 3000)
> plot(kdensity, col=myPal)
>
> rm(list=c("guichi","W","cases","pointcase","kdensity","myPal"))
> _______
>
> Dan
>
> On 25-Jun-07, at 7:49 AM, zhijie zhang wrote:
>
> > Dear Roger Bivand,Tim Keitt, and Dan Putler,
> >   Thanks for your answers. I have tried density.ppp(spatstat) and
> > kernel2d(splancs), but the results are not very satisfied. I think
> > there should be a higher density in the blue part of the map in the
> > attachment.
> >   My dataset has been put in the attachment and programs have been
> > pasted in the following, so that u can use and check it.
> >    I want to do the work like "non-parametric estimation of a
> > spatially varying intensity" in Diggle's book(2003.P.116-121).
> >   BTW, i'm not familiar with locfit,would u please also check it
> > using locfit? Thanks very much.
> > ######################################################################
> > #########
> >                            Kernel density estimation--spatstat
> > ######################################################################
> > ##########
> > library(sp)
> > library(foreign)
> > library(maptools)
> > library(mgcv)
> > library(spatstat)
> > guichi<-readShapePoly("d:/deleting/kernel/kernel/guichi2.shp")
> > W <-as(as(guichi, "SpatialPolygons"), "owin")  #boundary polygons
> >
> > cases<-coordinates(readShapePoints("d:/deleting/kernel/kernel/
> > cases.shp"))  #points
> > colnames(cases)<-c("x","y")
> > cases[1:2,]
> >
> > #plot(W);points(cases)
> >
> > pointcase <- ppp(cases[,1], cases[,2], window=W)  #generate the ppp
> > object
> >
> > kdensity<-density.ppp(pointcase, 0.05)
> > plot(kdensity)
> > Q:there are almost the same density in the whole area,but in fact
> > it may have a higher density in the blue part of the attached map?
> > I think the problem may the inappropriate value of sigma, how to
> > determine its value?
> >
> > ######################################################################
> > ##########
> >                                  Kernel density estimation--splancs
> > ######################################################################
> > ##########
> > library(sp)
> > library(splancs)
> > library(foreign)
> > library(maptools)
> >
> > case<-readShapePoints("d:/deleting/kernel/kernel/cases.shp")
> > guichi<-readShapePoly("d:/deleting/kernel/kernel/guichi2.shp")
> >
> > #Conversion
> > case_pts <- coordinates(case)
> > case <- as.points(case_pts)
> > splancs_poly <- getPolygonCoordsSlot(getPolygonsPolygonsSlot
> > (getSpPpolygonsSlot(guichi)[[1]])[[1]])
> >
> > #to unpack the coordinates of the points and the single ring boundary
> > polymap(splancs_poly,xlab="x(??)",ylab="y(??)")
> > pointmap(case_pts, add=TRUE)
> >
> > m<-mse2d(case,splancs_poly,nsmse=1000,range=5)  #plots the
> > estimated mean square error as a function of h0
> > plot(m$h[290:1000],m$mse[290:1000],type="l")
> >
> > n<-which(m$mse==min(m$mse))
> > h0<-m$h[n]
> >
> >
> > #smooth variation
> > smooth<-kernel2d(case, splancs_poly, h0=h0, nx=100, ny=100)
> > polymap(splancs_poly)  #sets the axes correctly and draws the polygon
> > image(smooth,add=T)   #the smoothed image is superimposed
> > polymap(splancs_poly,add=T) #redrawn the polymap in order not to be
> > obsured by smooth image
> > Q:The result is still not satisfied,there must be something wrong
> > with my programs .
> >
> >
> >
> >
> >
> >
> > On 6/25/07, Dan Putler <putler at sauder.ubc.ca> wrote: Hi All,
> >
> > To add some detail to Roger's earlier, post density.ppp in the
> > spatstat seems to be a very good answer to the original post since it
> > is specifically designed to estimate a kernel density for a point
> > process pattern. This function use a bivariate Gaussian smoother that
> > lends itself to user configuration.
> >
> > Dan
> >
> > On 24-Jun-07, at 5:28 PM, Tim Keitt wrote:
> >
> > > I rather like locfit.
> > >
> > > THK
> > >
> > > On 6/24/07, zhijie zhang <epistat at gmail.com> wrote:
> > >> Dear Friends,
> > >>  Except kernel2d(splancs) function, are there any other functions
> > >> on kernel
> > >> density estimation in point pattern analysis? I use the kernel2d
> > >> (splancs)
> > >> function to anayze my dataset, and the result seems not to be very
> > >> good.
> > >>   Any suggestions or help in kernel density estimation of
> > >> univariate or
> > >> multivariate point process are greatly appreciated.
> > >>   BTW, i mainly want ot do the kernel density estimation in both
> > >> univariate and multivariate point process.
> > >> --
> > >> With Kind Regards,
> > >>
> > >> oooO:::::::::
> > >> (..):::::::::
> > >> :\.(:::Oooo::
> > >> ::\_)::(..)::
> > >> :::::::)./:::
> > >> ::::::(_/::::
> > >> :::::::::::::
> > >>
> > [********************************************************************
> > >> ***]
> > >> Zhi Jie,Zhang ,PHD
> > >> Tel:86-21-54237149
> > >> Dept. of Epidemiology,School of Public Health,Fudan University
> > >> Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> > >> Postcode:200032
> > >> Email:epistat at gmail.com
> > >> Website: www.statABC.com
> > >>
> > [********************************************************************
> > >> ***]
> > >> oooO:::::::::
> > >> (..):::::::::
> > >> :\.(:::Oooo::
> > >> ::\_)::(..)::
> > >> :::::::)./:::
> > >> ::::::(_/::::
> > >> :::::::::::::
> > >>
> > >>         [[alternative HTML version deleted]]
> > >>
> > >> _______________________________________________
> > >> R-sig-Geo mailing list
> > >> R-sig-Geo at stat.math.ethz.ch
> > >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >>
> > >
> > >
> > > --
> > > Timothy H. Keitt, University of Texas at Austin
> > > Contact info and schedule at http://www.keittlab.org/tkeitt/
> > > Reprints at http://www.keittlab.org/tkeitt/papers/
> > > ODF attachment? See http://www.openoffice.org/
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at stat.math.ethz.ch
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >
> >
> > --
> > With Kind Regards,
> >
> > oooO:::::::::
> > (..):::::::::
> > :\.(:::Oooo::
> > ::\_)::(..)::
> > :::::::)./:::
> > ::::::(_/::::
> > :::::::::::::
> > [*********************************************************************
> > **]
> > Zhi Jie,Zhang ,PHD
> > Tel:86-21-54237149
> > Dept. of Epidemiology,School of Public Health,Fudan University
> > Address:No. 138 Yi Xue Yuan Road,Shanghai,China
> > Postcode:200032
> > Email:epistat at gmail.com
> > Website: www.statABC.com
> > [*********************************************************************
> > **]
> > oooO:::::::::
> > (..):::::::::
> > :\.(:::Oooo::
> > ::\_)::(..)::
> > :::::::)./:::
> > ::::::(_/::::
> > :::::::::::::
> > <data.rar>
> > <map.jpg>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



-- 
With Kind Regards,

oooO:::::::::
(..):::::::::
:\.(:::Oooo::
::\_)::(..)::
:::::::)./:::
::::::(_/::::
:::::::::::::
[***********************************************************************]
Zhi Jie,Zhang ,PHD
Tel:86-21-54237149
Dept. of Epidemiology,School of Public Health,Fudan University
Address:No. 138 Yi Xue Yuan Road,Shanghai,China
Postcode:200032
Email:epistat at gmail.com
Website: www.statABC.com
[***********************************************************************]
oooO:::::::::
(..):::::::::
:\.(:::Oooo::
::\_)::(..)::
:::::::)./:::
::::::(_/::::
:::::::::::::
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070626/d627ecac/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: qiupu.rar
Type: application/octet-stream
Size: 18920 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070626/d627ecac/attachment.obj>

From Roger.Bivand at nhh.no  Tue Jun 26 11:36:24 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 26 Jun 2007 11:36:24 +0200 (CEST)
Subject: [R-sig-Geo] distmap
In-Reply-To: <4680208C.3080706@geo.uu.nl>
References: <467BCA0A.6020401@ija.csic.es>
	<Pine.LNX.4.64.0706241755170.371@reclus.nhh.no>
	<467F9B21.3090008@ija.csic.es>
	<Pine.LNX.4.64.0706251936500.3559@reclus.nhh.no>
	<4680208C.3080706@geo.uu.nl>
Message-ID: <Pine.LNX.4.64.0706261134130.5770@reclus.nhh.no>

On Mon, 25 Jun 2007, Edzer J. Pebesma wrote:

> Roger Bivand wrote:
>>  On Mon, 25 Jun 2007, Agustin Lobo wrote:
>> 
>> >  I've tried (among other things):
>> > >   limit1 <- read.shape("limit_PNSN2000.shp")
>> >  Shapefile type: Polygon, (5), # of Shapes: 2
>> > >   limit1poly <- Map2poly(limit1)
>> > >   limit1owin <- as(limit1poly,"owin")
>> >  Error in .classEnv(thisClass) : unable to find an environment containing 
>> >  class "polylist"
>> > 
>> > >   limit2 <- readOGR("limit_PNSN2000.shp",layer="limit_PNSN2000")
>> >  OGR data source with driver: ESRI Shapefile
>> >  Source: "limit_PNSN2000.shp", layer: "limit_PNSN2000"
>> >  with  2  rows and  1  columns
>>
>>  Then just:
>>
>>  limit1owin <- as(limit2,"owin")
>>
>>  ought to work with current maptools, or possibly coerce:
>>
>>  limit1owin <- as(as(limit2, "SpatialPolygons"), "owin")
>> 
> the latter form shouldn't be needed thanks to S4 inheritance.

In principle yes, especially with fresh sp and maptools, but I'm not sure 
that my code in earlier versions allowed inheritance properly, and we 
don't know which package versions are being used. Hence the general 
request to state sessionInfo() output in all questions to the list.

Roger

> --
> Edzer
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Agustin.Lobo at ija.csic.es  Tue Jun 26 12:59:13 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Tue, 26 Jun 2007 12:59:13 +0200
Subject: [R-sig-Geo] distmap
In-Reply-To: <Pine.LNX.4.64.0706261134130.5770@reclus.nhh.no>
References: <467BCA0A.6020401@ija.csic.es>
	<Pine.LNX.4.64.0706241755170.371@reclus.nhh.no>
	<467F9B21.3090008@ija.csic.es>
	<Pine.LNX.4.64.0706251936500.3559@reclus.nhh.no>
	<4680208C.3080706@geo.uu.nl>
	<Pine.LNX.4.64.0706261134130.5770@reclus.nhh.no>
Message-ID: <4680F181.8030407@ija.csic.es>

Still some problems:

 > sessionInfo()
R version 2.5.0 (2007-04-23)
i386-pc-mingw32

locale:
LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spanish_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets" 
"methods"   "base"

other attached packages:
maptools  foreign spatstat     mgcv       sp
"0.6-13" "0.8-20" "1.11-7" "1.3-25" "0.9-14"

 > limit1 <- read.shape("limit_PNSN2000.shp")
 > limit1owin <- as(limit2,"owin")
Error in inherits(x, "factor") : cannot get a slot ("contains") from an 
object of type "NULL"
 > limit1owin <- as(as(limit2, "SpatialPolygons"), "owin")
Checking 3 polygons...1, 2, [Checking polygon with 2749 edges...]
3.
done.
Checking for cross-intersection between 3 polygons...1, Polygons 1 and 3 
cross over
2.
done.
Error in owin(poly = opls) : Polygon data contain overlaps between polygons
 > plot(limit2)

I can send you limit2.rda, is that ok?

Agus



Roger Bivand escribi?:
> On Mon, 25 Jun 2007, Edzer J. Pebesma wrote:
> 
>> Roger Bivand wrote:
>>>  On Mon, 25 Jun 2007, Agustin Lobo wrote:
>>>
>>> >  I've tried (among other things):
>>> > >   limit1 <- read.shape("limit_PNSN2000.shp")
>>> >  Shapefile type: Polygon, (5), # of Shapes: 2
>>> > >   limit1poly <- Map2poly(limit1)
>>> > >   limit1owin <- as(limit1poly,"owin")
>>> >  Error in .classEnv(thisClass) : unable to find an environment 
>>> containing >  class "polylist"
>>> > > >   limit2 <- readOGR("limit_PNSN2000.shp",layer="limit_PNSN2000")
>>> >  OGR data source with driver: ESRI Shapefile
>>> >  Source: "limit_PNSN2000.shp", layer: "limit_PNSN2000"
>>> >  with  2  rows and  1  columns
>>>
>>>  Then just:
>>>
>>>  limit1owin <- as(limit2,"owin")
>>>
>>>  ought to work with current maptools, or possibly coerce:
>>>
>>>  limit1owin <- as(as(limit2, "SpatialPolygons"), "owin")
>>>
>> the latter form shouldn't be needed thanks to S4 inheritance.
> 
> In principle yes, especially with fresh sp and maptools, but I'm not 
> sure that my code in earlier versions allowed inheritance properly, and 
> we don't know which package versions are being used. Hence the general 
> request to state sessionInfo() output in all questions to the list.
> 
> Roger
> 
>> -- 
>> Edzer
>>
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From e.pebesma at geo.uu.nl  Tue Jun 26 13:18:00 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Tue, 26 Jun 2007 13:18:00 +0200
Subject: [R-sig-Geo] Simple and Efficient way to Divide Study Area?
In-Reply-To: <288693.34654.qm@web36310.mail.mud.yahoo.com>
References: <288693.34654.qm@web36310.mail.mud.yahoo.com>
Message-ID: <4680F5E8.5080106@geo.uu.nl>

Kitty Lee wrote:
> Hi Roger, I forgot to mention I did try tripack and did go through your previous post. 
>
> But I'm doing a simulation and I have to repeat the process >1000 times. 
>
>
> I feel using the voronoi method to divide up the study area may not be the most efficient way. I thought of dividing the area into grids(by generating random x-coor and y-coor). But the tricky part is that the study region is NOT rectangular. If I do 5*4=20 grids, since there're empty areas, I may have fewer than 20 regions at the end.....
>
>
>
> I wonder how people divide their study area into a specific number of groups when the study region is not rectangular?
>
>   
If you're discretizing the are with square grid cells, you may want to 
think about clustering methods on x and y coordinates, especially 
k-means where you control the number of groups. If you set the number of 
iterations to 0 and 1 and use random seeds (taken in the area), you may 
get random partitioning.

I still have trouble imagening why you would want random partitions, and 
what this random process should reflect.
--
Edzer



From Agustin.Lobo at ija.csic.es  Tue Jun 26 13:33:04 2007
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Tue, 26 Jun 2007 13:33:04 +0200
Subject: [R-sig-Geo] ODP: ODP:  spsample and NA
In-Reply-To: <467FB196.4090106@geo.uu.nl>
References: <4678E138.8030901@ija.csic.es>	<AD51AB79BC327C40AB2C7EB75D57A3C40512BD@TOLAR.valuta.nhh.no>	<467A2BA4.2020200@ija.csic.es>
	<AD51AB79BC327C40AB2C7EB75D57A3C40512C0@TOLAR.valuta.nhh.no>
	<467F8EC0.606@geo.uu.nl> <467FA0B7.5070806@ija.csic.es>
	<467FB196.4090106@geo.uu.nl>
Message-ID: <4680F970.10202@ija.csic.es>

Great, it works now, thanks a lot.
This is how I do it:

#Using a raster map to stratify a sample
#Non-interesting classes set as "NA"

 > library(rgdal)
 > library(sp)
 > x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
 > ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(118,189))
 > GDAL.close(x)
Closing GDAL dataset handle 0x0171c668...  destroyed ... done.
 > ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
 > X <- ESTRAT3OBAC[seq(1,118,by=10),seq(1,189,by=10)] #small example
 > class(X)
[1] "SpatialGridDataFrame"
attr(,"package")
[1] "sp"
 > fullgrid(X)=F
 > class(X)
[1] "SpatialPixelsDataFrame"
attr(,"package")
[1] "sp"
 > test.stsamp <- spsample(X, n = 10, "stratified")
 > test.stsamp
SpatialPoints:
             x1      x2
  [1,] 411328.3 4608544
  [2,] 412220.4 4608288
  [3,] 412856.2 4608528
  [4,] 413195.9 4608455
  [5,] 414354.4 4608723
  [6,] 414804.9 4608653
  [7,] 412880.7 4609431
  [8,] 413441.1 4608874
  [9,] 414629.3 4609258
[10,] 414903.8 4609542
[11,] 412511.0 4609699
[12,] 413290.9 4610094
Coordinate Reference System (CRS) arguments: +proj=utm +zone=31
+ellps=intl +units=m +no_defs
 > o <- overlay(X, test.stsamp)
 > o
  [1] 71 89 77 79 67 85 26 64 41 31 18 14


Agus

Edzer J. Pebesma escribi?:
> additional to the
> 
> X = as(X, "SpatialPixelsDataFrame")
> 
> etc. there's a helper function that toggles between them; try:
> 
> fullgrid(X) = TRUE
> class(X)
> fullgrid(X) = FALSE
> class(X)
> -- 
> Edzer
> 
> Agustin Lobo wrote:
>> I understand, but how do I convert between one type and the other?
>> I've tried:
>>
>> x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
>> ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(118,189))
>> GDAL.close(x)
>> ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
>> X <- ESTRAT3OBAC[seq(1,118,by=10),seq(1,189,by=10)] #small example
>> > summary(X)
>> Object of class SpatialGridDataFrame
>> Coordinates:
>>         min       max
>> x  410649.7  415399.7
>> y 4607910.5 4610910.5
>> Is projected: TRUE
>> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
>> Number of points: 2
>> Grid attributes:
>>   cellcentre.offset cellsize cells.dim
>> x          410774.7      250        19
>> y         4608035.5      250        12
>> Data attributes:
>>      band1
>>  Min.   :  4.0
>>  1st Qu.: 67.0
>>  Median :156.0
>>  Mean   :125.8
>>  3rd Qu.:163.0
>>  Max.   :237.0
>>  NA's   :119.0
>>
>> > Y <- SpatialPixels(X)
>> > summary(Y)
>> Object of class SpatialPixels
>> Coordinates:
>>         min       max
>> x  410649.7  415399.7
>> y 4607910.5 4610910.5
>> Is projected: TRUE
>> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
>> Number of points: 2
>>
>> So X and Y are not the same at all.
>>
>> Thanks for your help.
>>
>> Agus
>>
>>
>> Edzer J. Pebesma escribi?:
>>> Not only to avoid NAs, but also to get approximately right sample size.
>>>
>>> Stratified sampling does not take place based on strata defined by 
>>> attributes (map layers), but rather by dividing the area into square 
>>> blocks (strata) and randomly sample (n=1) from each block. That is 
>>> why the resulting sample doesn't have exactly the 
>>> prescribed/requested size (although one could iterate). See also 
>>> Ripley 1981 Spatial Statistics for explanation.
>>>
>>> Best wishes,
>>> -- 
>>> Edzer
>>>
>>> Roger Bivand wrote:
>>>> There are two forms of sp objects for grids, SpatialPixelsDataFrame 
>>>> and SpatialGridDataFrame, and you need the former to avoid NAs. I am 
>>>> not sure how to proceed without access to a copz of zour data to see 
>>>> whz spsample is including the NA cells.
>>>>  
>>>> Roger
>>>>  
>>>> --- Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, 
>>>> Roger.Bivand at nhh.no
>>>>
>>>> ________________________________
>>>>
>>>> Od: Agustin Lobo w imieniu Agustin Lobo
>>>> Wys?ano: Cz 21.06.2007 09:41
>>>> Do: Roger Bivand
>>>> DW: R-sig-Geo at stat.math.ethz.ch
>>>> Temat: Re: ODP: [R-sig-Geo] spsample and NA
>>>>
>>>>
>>>>
>>>> The test with meuse.grid works:
>>>>
>>>> #copied from file:SpatialGridDataFrame-class.html
>>>> coordinates(meuse.grid) = c("x", "y") # promote 
>>>> toSpatialPointsDataFrame
>>>> gridded(meuse.grid) <- TRUE # promote to SpatialPixelsDataFrame
>>>> x = as(meuse.grid, "SpatialGridDataFrame") # creates the full grid
>>>> #Now me:
>>>>  > unique(x at data$soil)
>>>> [1] NA  1  2  3
>>>>
>>>>  > table(x at data$soil)
>>>>     1    2    3
>>>> 1665 1084  354
>>>>
>>>> test.stsamp <- spsample(x, n = 10, "stratified")
>>>> o <- overlay(x, test.stsamp)
>>>>  > o
>>>>            coordinates part.a part.b      dist soil ffreq
>>>> 5556 (179156, 330917)      0      1 0.1030270    1     1
>>>> 6670 (180039, 330336)      0      1 0.0703333    1     2
>>>> 2240 (180677, 332606)      1      0 0.0975136    1     1
>>>>
>>>>
>>>> But don't know how to make that my raster behave in the same way. What
>>>> does it mean "cast to SpatialPixels first"? I thought that as
>>>> X comes from an imported raster it was an sp object already.
>>>>
>>>> Also, there are several components in the x coming from meuse.grid:
>>>> str(x)
>>>> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>>>>    ..@ data       :'data.frame': 8112 obs. of  5 variables:
>>>>    .. ..$ part.a: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>>>    .. ..$ part.b: num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>>>    .. ..$ dist  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>>>    .. ..$ soil  : num [1:8112] NA NA NA NA NA NA NA NA NA NA ...
>>>>    .. ..$ ffreq : Factor w/ 3 levels "1","2","3": NA NA NA NA NA NA NA
>>>> NA NA NA ...
>>>>
>>>> how does spsample know which layer has to be used for the 
>>>> stratification?
>>>>
>>>> Thanks!
>>>>
>>>> Agus
>>>>
>>>> Roger Bivand escribi?:
>>>>  
>>>>> I think that if you cast to SpatialPixels first, the problem will 
>>>>> go away, because the all-NA cases are dropped with their 
>>>>> coordinates. Could you try the same example with meuse.grid and see 
>>>>> how it goes?
>>>>>
>>>>> Roger
>>>>>
>>>>> ---
>>>>> Roger Bivand, NHH, Helleveien 30, N-5045 Bergen, Roger.Bivand at nhh.no
>>>>>
>>>>> ________________________________
>>>>>
>>>>> Od: r-sig-geo-bounces at stat.math.ethz.ch w imieniu Agustin Lobo
>>>>> Wys?ano: ?r 20.06.2007 10:11
>>>>> Do: R-sig-Geo at stat.math.ethz.ch
>>>>> Temat: [R-sig-Geo] spsample and NA
>>>>>
>>>>>
>>>>>
>>>>> It is often the case, at least with raster (grid) objects,
>>>>> that you are not interested on a part of the raster.
>>>>> For example because it's outside a non.rectangular region of study
>>>>> and/or because some types of terrain (some classes) are outside
>>>>> the scope of the study. In any case, those parts can be
>>>>> represented by NA.
>>>>>
>>>>> Unfortunately, while some functions like table() would not
>>>>> include the NA in the statistics, spsample includes
>>>>> the NA as just another class, which implies that a fraction
>>>>> of the resulting coordinates will lay on the NA
>>>>> part of the raster. This makes it difficult, to get N valid (i.e., not
>>>>> on NA parts) points using spsample. Is there any way around this?
>>>>> For example, if I want 10 points on non-NA cells of
>>>>> raster X, I would like
>>>>>
>>>>> spsample(X, 10, "stratified")
>>>>>
>>>>> to provide 10 positions on non-NA cells.
>>>>>
>>>>> At the moment, I get:
>>>>>
>>>>> x <- GDAL.open("C:/ALOBO/dipu2006/STLL_VEG2006/ESTRAT3_OBAC.tif")
>>>>> ESTRAT3OBAC <- asSGDF_GROD(x, output.dim=c(100,100))
>>>>> GDAL.close(x)
>>>>>
>>>>> ESTRAT3OBAC at data[ESTRAT3OBAC at data==55537]<- NA
>>>>>
>>>>> X <- ESTRAT3OBAC
>>>>> X$cut <- as.ordered(cut(X$band1, c(0,10,100),include.lowest=TRUE))
>>>>> table(X$cut)
>>>>>
>>>>>    [0,10] (10,100]
>>>>>        83     1961
>>>>>
>>>>> summary(X$cut)
>>>>>    [0,10] (10,100]     NA's
>>>>>        83     1961     7956
>>>>> table(X$cut)
>>>>>
>>>>>    [0,10] (10,100]
>>>>>        83     1961
>>>>>
>>>>> Xspsample <- spsample(X,10,"stratified")
>>>>> Xo <- overlay(X,Xspsample)
>>>>> summary(Xo)
>>>>> Object of class SpatialPointsDataFrame
>>>>> Coordinates:
>>>>>           min       max
>>>>> x1  410995.6  414954.4
>>>>> x2 4608002.1 4610566.0
>>>>> Is projected: TRUE
>>>>> proj4string : [ +proj=utm +zone=31 +ellps=intl +units=m +no_defs]
>>>>> Number of points: 9
>>>>> Data attributes:
>>>>>       band1             cut
>>>>>   Min.   :   67   [0,10]  :0
>>>>>   1st Qu.:   97   (10,100]:3
>>>>>   Median :  159   NA's    :6
>>>>>   Mean   :24745
>>>>>   3rd Qu.:55537
>>>>>   Max.   :55537
>>>>>
>>>>> That is, I get 6 positions on NA values of X
>>>>>
>>>>> Thanks!
>>>>>
>>>>> Agus
>>>>>
>>>>> -- 
>>>>> Dr. Agustin Lobo
>>>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>>> LLuis Sole Sabaris s/n
>>>>> 08028 Barcelona
>>>>> Spain
>>>>> Tel. 34 934095410
>>>>> Fax. 34 934110012
>>>>> email: Agustin.Lobo at ija.csic.es
>>>>> http://www.ija.csic.es/gt/obster
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>>
>>>>>     
>>>>
>>>> -- 
>>>> Dr. Agustin Lobo
>>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>> LLuis Sole Sabaris s/n
>>>> 08028 Barcelona
>>>> Spain
>>>> Tel. 34 934095410
>>>> Fax. 34 934110012
>>>> email: Agustin.Lobo at ija.csic.es
>>>> http://www.ija.csic.es/gt/obster
>>>>
>>>>
>>>>
>>>>     [[alternative HTML version deleted]]
>>>>
>>>>   
>>>> ------------------------------------------------------------------------ 
>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>   
>>>
>>>
>>
> 
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From lee.kitty at yahoo.com  Wed Jun 27 03:58:20 2007
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Tue, 26 Jun 2007 18:58:20 -0700 (PDT)
Subject: [R-sig-Geo] deldir package
Message-ID: <521640.73690.qm@web36312.mail.mud.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070626/455e0915/attachment.pl>

From J.vandeKoppel at nioo.knaw.nl  Tue Jun 26 14:03:08 2007
From: J.vandeKoppel at nioo.knaw.nl (Koppel, Johan van de)
Date: Tue, 26 Jun 2007 14:03:08 +0200
Subject: [R-sig-Geo]  directional correlograms
Message-ID: <65F6E1EC64DCA6489800C09A2007FC6E01E9C03B@cememail1.nioo.int>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070626/939c776e/attachment.pl>

From Thierry.ONKELINX at inbo.be  Wed Jun 27 12:03:37 2007
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Wed, 27 Jun 2007 12:03:37 +0200
Subject: [R-sig-Geo] directional correlograms
In-Reply-To: <65F6E1EC64DCA6489800C09A2007FC6E01E9C03B@cememail1.nioo.int>
Message-ID: <2E9C414912813E4EB981326983E0A104032D8B96@inboexch.inbo.be>

I don't know about spdep, but you can do it with the gstat package.

Cheers,

Thierry

------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be 

Do not put your faith in what statistics say until you have carefully
considered what they do not say.  ~William W. Watt
A statistical analysis, properly conducted, is a delicate dissection of
uncertainties, a surgery of suppositions. ~M.J.Moroney

 

> -----Oorspronkelijk bericht-----
> Van: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Koppel, 
> Johan van de
> Verzonden: dinsdag 26 juni 2007 14:03
> Aan: r-sig-geo at stat.math.ethz.ch
> Onderwerp: [R-sig-Geo] directional correlograms
> 
> Dear all,
> 
>  
> 
> I have a question regarding the spdep package. I want to 
> produce directional (anisotropic) correlograms. Is there any 
> way to generate these with spdep?
> 
>  
> 
> I am analyzing aerial photographs of patterned ecosystems, in 
> which the patterns are often directional.
> 
>  
> 
> Thanks in advance,
> 
>  
> 
> Johan
> 
>  
> 
> ---------
> Johan van de Koppel
> Spatial Ecology Department
> Netherlands institute of Ecology
> Centre for Estuarine and Marine Ecology P.O. Box 140, 4400AC 
> Yerseke, The Netherlands
> Phone: 31 (0)113 577455 
> 
> Mobile: 06-15402485
> Fax: 31 (0) 113 573616
> Email: J.vandeKoppel at nioo.knaw.nl
> Homepage: http://www.nioo.knaw.nl/homepages/koppel
> <http://www.nioo.knaw.nl/homepages/koppel>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Roger.Bivand at nhh.no  Wed Jun 27 12:13:47 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 27 Jun 2007 12:13:47 +0200 (CEST)
Subject: [R-sig-Geo] deldir package
In-Reply-To: <521640.73690.qm@web36312.mail.mud.yahoo.com>
References: <521640.73690.qm@web36312.mail.mud.yahoo.com>
Message-ID: <Pine.LNX.4.64.0706271207220.8782@reclus.nhh.no>

On Tue, 26 Jun 2007, Kitty Lee wrote:

> I used deldir to generate voronoi but it seems that I can only specify 
> rectangular window for the rw option. Is there a way the system can take 
> in non-rectangular polygon as study area?

No, only rectangular windows are permitted. You could try a large window, 
and then code using templates in maptools to use the gpclib intersect 
function to cookie-cut the external polygons. At least deldir does permit 
polygon closure within the rectangle.

Roger

>
>
> K.
>
> ---------------------------------
> Don't get soaked.  Take a quick peak at the forecast
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Wed Jun 27 12:27:46 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 27 Jun 2007 12:27:46 +0200 (CEST)
Subject: [R-sig-Geo] directional correlograms
In-Reply-To: <65F6E1EC64DCA6489800C09A2007FC6E01E9C03B@cememail1.nioo.int>
References: <65F6E1EC64DCA6489800C09A2007FC6E01E9C03B@cememail1.nioo.int>
Message-ID: <Pine.LNX.4.64.0706271222410.8848@reclus.nhh.no>

On Tue, 26 Jun 2007, Koppel, Johan van de wrote:

> Dear all,
>
>
>
> I have a question regarding the spdep package. I want to produce
> directional (anisotropic) correlograms. Is there any way to generate
> these with spdep?
>
>
>
> I am analyzing aerial photographs of patterned ecosystems, in which the
> patterns are often directional.
>

It is not impossible, but is not easy either. Having generated distance 
based neighbour lists, you will need to use the glist= argument to 
nb2listw() to zero out neighbours in the excluded direction subset, and 
getting the direction is not provided for in functions in spdep. So the 
main task is to generate a 0/1 glist to express direction. Are there 
direction functions that could be called in an lapply() on the neighbours 
list and a coordinate matrix?

Roger

>
>
> Thanks in advance,
>
>
>
> Johan
>
>
>
> ---------
> Johan van de Koppel
> Spatial Ecology Department
> Netherlands institute of Ecology
> Centre for Estuarine and Marine Ecology
> P.O. Box 140, 4400AC Yerseke, The Netherlands
> Phone: 31 (0)113 577455
>
> Mobile: 06-15402485
> Fax: 31 (0) 113 573616
> Email: J.vandeKoppel at nioo.knaw.nl
> Homepage: http://www.nioo.knaw.nl/homepages/koppel
> <http://www.nioo.knaw.nl/homepages/koppel>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Wed Jun 27 12:43:10 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 27 Jun 2007 12:43:10 +0200 (CEST)
Subject: [R-sig-Geo] distmap
In-Reply-To: <4680F181.8030407@ija.csic.es>
References: <467BCA0A.6020401@ija.csic.es>
	<Pine.LNX.4.64.0706241755170.371@reclus.nhh.no>
	<467F9B21.3090008@ija.csic.es>
	<Pine.LNX.4.64.0706251936500.3559@reclus.nhh.no>
	<4680208C.3080706@geo.uu.nl>
	<Pine.LNX.4.64.0706261134130.5770@reclus.nhh.no>
	<4680F181.8030407@ija.csic.es>
Message-ID: <Pine.LNX.4.64.0706271241070.8848@reclus.nhh.no>

On Tue, 26 Jun 2007, Agustin Lobo wrote:

> Still some problems:
>
>>  sessionInfo()
> R version 2.5.0 (2007-04-23)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=Spanish_Spain.1252;LC_CTYPE=Spanish_Spain.1252;LC_MONETARY=Spanish_Spain.1252;LC_NUMERIC=C;LC_TIME=Spanish_Spain.1252
>
> attached base packages:
> [1] "stats"     "graphics"  "grDevices" "utils"     "datasets" "methods" 
> "base"
>
> other attached packages:
> maptools  foreign spatstat     mgcv       sp
> "0.6-13" "0.8-20" "1.11-7" "1.3-25" "0.9-14"
>
>>  limit1 <- read.shape("limit_PNSN2000.shp")
>>  limit1owin <- as(limit2,"owin")
> Error in inherits(x, "factor") : cannot get a slot ("contains") from an 
> object of type "NULL"
>>  limit1owin <- as(as(limit2, "SpatialPolygons"), "owin")
> Checking 3 polygons...1, 2, [Checking polygon with 2749 edges...]
> 3.
> done.
> Checking for cross-intersection between 3 polygons...1, Polygons 1 and 3 
> cross over
> 2.
> done.
> Error in owin(poly = opls) : Polygon data contain overlaps between polygons
>>  plot(limit2)
>
> I can send you limit2.rda, is that ok?

Yes, but as you can see, the problem seems to be that your polygons 
overlap. That probably needs resolving first, or in the limit2 object 
inside R.

Roger

>
> Agus
>
>
>
> Roger Bivand escribi?:
>>  On Mon, 25 Jun 2007, Edzer J. Pebesma wrote:
>> 
>> >  Roger Bivand wrote:
>> > >   On Mon, 25 Jun 2007, Agustin Lobo wrote:
>> > > 
>> > > >   I've tried (among other things):
>> > > > >    limit1 <- read.shape("limit_PNSN2000.shp")
>> > > >   Shapefile type: Polygon, (5), # of Shapes: 2
>> > > > >    limit1poly <- Map2poly(limit1)
>> > > > >    limit1owin <- as(limit1poly,"owin")
>> > > >   Error in .classEnv(thisClass) : unable to find an environment 
>> > > containing >   class "polylist"
>> > > > > >    limit2 <- readOGR("limit_PNSN2000.shp",layer="limit_PNSN2000")
>> > > >   OGR data source with driver: ESRI Shapefile
>> > > >   Source: "limit_PNSN2000.shp", layer: "limit_PNSN2000"
>> > > >   with  2  rows and  1  columns
>> > > 
>> > >   Then just:
>> > > 
>> > >   limit1owin <- as(limit2,"owin")
>> > > 
>> > >   ought to work with current maptools, or possibly coerce:
>> > > 
>> > >   limit1owin <- as(as(limit2, "SpatialPolygons"), "owin")
>> > > 
>> >  the latter form shouldn't be needed thanks to S4 inheritance.
>>
>>  In principle yes, especially with fresh sp and maptools, but I'm not sure
>>  that my code in earlier versions allowed inheritance properly, and we
>>  don't know which package versions are being used. Hence the general
>>  request to state sessionInfo() output in all questions to the list.
>>
>>  Roger
>> 
>> >  -- 
>> >  Edzer
>> >
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Wed Jun 27 12:52:32 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 27 Jun 2007 12:52:32 +0200 (CEST)
Subject: [R-sig-Geo] path distance maps with R?
In-Reply-To: <4680D660.6010402@uib.es>
References: <4680D660.6010402@uib.es>
Message-ID: <Pine.LNX.4.64.0706271248450.8971@reclus.nhh.no>

On Tue, 26 Jun 2007, David March Morl? wrote:

> Dear all,
>
> I want to create port-based distance maps to analyse spatial
> distribution of fishing effort. I have tried to use ?distmap.ppp?
> function from spatstat, but this computes Euclidean distances and I want
> to take into account obstacles (i.e. islands) in the same way as Caddy
> and Carocci (http://www.faocopemed.org/vldocs/0000028/publi04.pdf). Have
> you got any suggestion to perform these path distance maps with R?

If you have access to a GIS, you might find it more appropriate. The 
r.cost module in GRASS can do this very effectively, having first 
converted the vector land mask to raster, spreading from vector points 
over a raster sea within the sea mask. Naturally, this is best for 
projected cordinates.

Roger

>
> Thanks,
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From cesar.martinez at iver.es  Wed Jun 27 12:54:46 2007
From: cesar.martinez at iver.es (Cesar Martinez Izquierdo)
Date: Wed, 27 Jun 2007 12:54:46 +0200
Subject: [R-sig-Geo] Best approach to implement Spatial Interpolations
Message-ID: <468241F6.7060904@iver.es>

Hello list,
we are trying to implement spatial interpolations (IDW and several types 
of  Kriging) in our open source GIS application, which is written in Java.

We plan to use JRI to connect with R from Java, and then use the 
features of "gstat" R-package to calculate the interpolations.

However, we don't want R to draw the results of interpolations, we just 
want to get the raw result which we will draw in our GIS client.

Now, the questions:
- Do you think gstat is the best R package for this task?
I've read that it doesn't allow not-projected data. Is there a package 
which provides similar algorithms and works with not-projected data?

- Do you have some documentation regarding this topics (more exactly: 
documentation about how to get the results of a kriging, etc with JRI)?

Any comments and suggestions are welcome.

Regards,

-- 
C?sar Mart?nez Izquierdo
gvSIG development team
http://www.gvsig.gva.es

IVER T.I.
C/ Salamanca 50
46005 Valencia - Spain
http://www.iver.es



From Thierry.ONKELINX at inbo.be  Wed Jun 27 13:50:17 2007
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Wed, 27 Jun 2007 13:50:17 +0200
Subject: [R-sig-Geo] Best approach to implement Spatial Interpolations
In-Reply-To: <468241F6.7060904@iver.es>
Message-ID: <2E9C414912813E4EB981326983E0A104032D8C03@inboexch.inbo.be>

Dear Cesar,

Krige, idw of predict.gstat all return objects with the prediction. You only get maps when you plot these objects. So you only need to find out how to return these objects with JRI to your GIS.

Edzer Pebesma will be best positioned to answer your question about gstat's capability on working with non-projected data.

Cheers,

Thierry

----------------------------------------------------------------------------
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics, methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be
www.inbo.be 

Do not put your faith in what statistics say until you have carefully considered what they do not say.  ~William W. Watt
A statistical analysis, properly conducted, is a delicate dissection of uncertainties, a surgery of suppositions. ~M.J.Moroney

 

> -----Oorspronkelijk bericht-----
> Van: r-sig-geo-bounces at stat.math.ethz.ch 
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens Cesar 
> Martinez Izquierdo
> Verzonden: woensdag 27 juni 2007 12:55
> Aan: r-sig-geo at stat.math.ethz.ch
> Onderwerp: [R-sig-Geo] Best approach to implement Spatial 
> Interpolations
> 
> Hello list,
> we are trying to implement spatial interpolations (IDW and 
> several types of  Kriging) in our open source GIS 
> application, which is written in Java.
> 
> We plan to use JRI to connect with R from Java, and then use 
> the features of "gstat" R-package to calculate the interpolations.
> 
> However, we don't want R to draw the results of 
> interpolations, we just want to get the raw result which we 
> will draw in our GIS client.
> 
> Now, the questions:
> - Do you think gstat is the best R package for this task?
> I've read that it doesn't allow not-projected data. Is there 
> a package which provides similar algorithms and works with 
> not-projected data?
> 
> - Do you have some documentation regarding this topics (more exactly: 
> documentation about how to get the results of a kriging, etc 
> with JRI)?
> 
> Any comments and suggestions are welcome.
> 
> Regards,
> 
> --
> C?sar Mart?nez Izquierdo
> gvSIG development team
> http://www.gvsig.gva.es
> 
> IVER T.I.
> C/ Salamanca 50
> 46005 Valencia - Spain
> http://www.iver.es
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From e.pebesma at geo.uu.nl  Wed Jun 27 14:00:28 2007
From: e.pebesma at geo.uu.nl (Edzer J. Pebesma)
Date: Wed, 27 Jun 2007 14:00:28 +0200
Subject: [R-sig-Geo] Best approach to implement Spatial Interpolations
In-Reply-To: <468241F6.7060904@iver.es>
References: <468241F6.7060904@iver.es>
Message-ID: <4682515C.40707@geo.uu.nl>

Cesar Martinez Izquierdo wrote:
> Hello list,
> we are trying to implement spatial interpolations (IDW and several types 
> of  Kriging) in our open source GIS application, which is written in Java.
>
> We plan to use JRI to connect with R from Java, and then use the 
> features of "gstat" R-package to calculate the interpolations.
>
> However, we don't want R to draw the results of interpolations, we just 
> want to get the raw result which we will draw in our GIS client.
>
> Now, the questions:
> - Do you think gstat is the best R package for this task?
>   
As the author, I will refrain from commenting on this. It has a large 
user base, a code that has been open source and stable for a long time, 
and it has several options not found in other packages, notably block 
kriging, cokriging, and kriging in a local neighbourhood with an 
efficient search algorithm (quadtrees) for huge/massive data sets.
> I've read that it doesn't allow not-projected data. Is there a package 
> which provides similar algorithms and works with not-projected data?
>   
Recently, this functionality has been added, only the quadtree algorithm 
does not work in this case; I'm still in doubt whether quadtrees are 
useful on a sphere. Consider this code somewhat experimental, but I'm 
willing to help debug it if needed. It does, for example not check 
whether covariance functions provided are positive definite on a sphere, 
and has little (if any) functions specifically dedicated for this 
purpose. It does compute great circle distances though.

Another package that seems to deal with unprojected coordinates that you 
may want to look into is package fields.
> - Do you have some documentation regarding this topics (more exactly: 
> documentation about how to get the results of a kriging, etc with JRI)?
>
>   
Perhaps the JGR user interface is an example?

I'm very interested in your developments and experiences; please keep 
me/us updated on this mailing list.
--
Edzer
> Any comments and suggestions are welcome.
>
> Regards,
>
>



From Thomas.Adams at noaa.gov  Wed Jun 27 15:03:58 2007
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Wed, 27 Jun 2007 09:03:58 -0400
Subject: [R-sig-Geo] Best approach to implement Spatial Interpolations
In-Reply-To: <4682515C.40707@geo.uu.nl>
References: <468241F6.7060904@iver.es> <4682515C.40707@geo.uu.nl>
Message-ID: <4682603E.3070705@noaa.gov>

Edzer,

Not to deflate Cesar's project, but from our past email exchanges you 
are aware that I have been very pleased with the standalone version of 
your gstat program and feel that it interfaces wonderfully with GRASS 
6.x; I would highly recommend this approach to anyone. Also, for those 
who may not be aware, use of the R gstat package is usable with GRASS 
GIS as well. This is not to say that the gstat-GRASS interface employs a 
modern GUI; it does not, but the interface is straightforward and very 
usable.

I also look forward to seeing the results of Cesar's development project.

Regards,
Tom


Edzer J. Pebesma wrote:
> Cesar Martinez Izquierdo wrote:
>   
>> Hello list,
>> we are trying to implement spatial interpolations (IDW and several types 
>> of  Kriging) in our open source GIS application, which is written in Java.
>>
>> We plan to use JRI to connect with R from Java, and then use the 
>> features of "gstat" R-package to calculate the interpolations.
>>
>> However, we don't want R to draw the results of interpolations, we just 
>> want to get the raw result which we will draw in our GIS client.
>>
>> Now, the questions:
>> - Do you think gstat is the best R package for this task?
>>   
>>     
> As the author, I will refrain from commenting on this. It has a large 
> user base, a code that has been open source and stable for a long time, 
> and it has several options not found in other packages, notably block 
> kriging, cokriging, and kriging in a local neighbourhood with an 
> efficient search algorithm (quadtrees) for huge/massive data sets.
>   
>> I've read that it doesn't allow not-projected data. Is there a package 
>> which provides similar algorithms and works with not-projected data?
>>   
>>     
> Recently, this functionality has been added, only the quadtree algorithm 
> does not work in this case; I'm still in doubt whether quadtrees are 
> useful on a sphere. Consider this code somewhat experimental, but I'm 
> willing to help debug it if needed. It does, for example not check 
> whether covariance functions provided are positive definite on a sphere, 
> and has little (if any) functions specifically dedicated for this 
> purpose. It does compute great circle distances though.
>
> Another package that seems to deal with unprojected coordinates that you 
> may want to look into is package fields.
>   
>> - Do you have some documentation regarding this topics (more exactly: 
>> documentation about how to get the results of a kriging, etc with JRI)?
>>
>>   
>>     
> Perhaps the JGR user interface is an example?
>
> I'm very interested in your developments and experiences; please keep 
> me/us updated on this mailing list.
> --
> Edzer
>   
>> Any comments and suggestions are welcome.
>>
>> Regards,
>>
>>
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033



From cesar.martinez at iver.es  Thu Jun 28 08:36:46 2007
From: cesar.martinez at iver.es (Cesar Martinez Izquierdo)
Date: Thu, 28 Jun 2007 08:36:46 +0200
Subject: [R-sig-Geo] Best approach to implement Spatial Interpolations
In-Reply-To: <4682515C.40707@geo.uu.nl>
References: <468241F6.7060904@iver.es> <4682515C.40707@geo.uu.nl>
Message-ID: <468356FE.60407@iver.es>

Edzer J. Pebesma escribi?:
> Cesar Martinez Izquierdo wrote:
>> Hello list,
>> we are trying to implement spatial interpolations (IDW and several 
>> types of  Kriging) in our open source GIS application, which is 
>> written in Java.
>>
>> We plan to use JRI to connect with R from Java, and then use the 
>> features of "gstat" R-package to calculate the interpolations.
>>
>> However, we don't want R to draw the results of interpolations, we 
>> just want to get the raw result which we will draw in our GIS client.
>>
>> Now, the questions:
>> - Do you think gstat is the best R package for this task?
>>   
> As the author, I will refrain from commenting on this. It has a large 
> user base, a code that has been open source and stable for a long time, 
> and it has several options not found in other packages, notably block 
> kriging, cokriging, and kriging in a local neighbourhood with an 
> efficient search algorithm (quadtrees) for huge/massive data sets.
>> I've read that it doesn't allow not-projected data. Is there a package 
>> which provides similar algorithms and works with not-projected data?
>>   
> Recently, this functionality has been added, only the quadtree algorithm 
> does not work in this case; I'm still in doubt whether quadtrees are 
> useful on a sphere. Consider this code somewhat experimental, but I'm 
> willing to help debug it if needed. It does, for example not check 
> whether covariance functions provided are positive definite on a sphere, 
> and has little (if any) functions specifically dedicated for this 
> purpose. It does compute great circle distances though.
> 
> Another package that seems to deal with unprojected coordinates that you 
> may want to look into is package fields.
>> - Do you have some documentation regarding this topics (more exactly: 
>> documentation about how to get the results of a kriging, etc with JRI)?
>>
>>   
> Perhaps the JGR user interface is an example?
> 
> I'm very interested in your developments and experiences; please keep 
> me/us updated on this mailing list.
> -- 
> Edzer
>> Any comments and suggestions are welcome.
>>
>> Regards,
>>
>>   

Thanks to everyone for the information.
Following your advices, we have finally decided to use JRI+R+gstat.
You will have some news when there is something to show.
And maybe we drop some more questions here in the meantime...

Regards,

-- 
C?sar Mart?nez Izquierdo
gvSIG development team
http://www.gvsig.gva.es

IVER T.I.
C/ Salamanca 50
46005 Valencia - Spain
http://www.iver.es



From raffaele.morelli at gmail.com  Thu Jun 28 15:34:34 2007
From: raffaele.morelli at gmail.com (Raffaele Morelli)
Date: Thu, 28 Jun 2007 15:34:34 +0200
Subject: [R-sig-Geo] spplot: exponential notation in legend
Message-ID: <f1357b430706280634t3ad26982y1298d0c823278e6b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070628/75ee48e7/attachment.pl>

From Joao.Fadista at agrsci.dk  Fri Jun 29 08:42:21 2007
From: Joao.Fadista at agrsci.dk (=?iso-8859-1?Q?Jo=E3o_Fadista?=)
Date: Fri, 29 Jun 2007 08:42:21 +0200
Subject: [R-sig-Geo] advice needed on genomic question
Message-ID: <EA09C4B2B0F16E44B8F3311629493C0D02ED4F23@DJFPOST01.djf.agrsci.dk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070629/2948385d/attachment.pl>

From Joao.Fadista at agrsci.dk  Fri Jun 29 10:58:47 2007
From: Joao.Fadista at agrsci.dk (=?iso-8859-1?Q?Jo=E3o_Fadista?=)
Date: Fri, 29 Jun 2007 10:58:47 +0200
Subject: [R-sig-Geo] advice needed on genomic question
In-Reply-To: <EA09C4B2B0F16E44B8F3311629493C0D02ED4F24@DJFPOST01.djf.agrsci.dk>
References: <EA09C4B2B0F16E44B8F3311629493C0D02ED4F24@DJFPOST01.djf.agrsci.dk>
Message-ID: <EA09C4B2B0F16E44B8F3311629493C0D02ED4F26@DJFPOST01.djf.agrsci.dk>

Dear all,
 
I am new member of this mailing list and I would like some advice of what should I do with my data. Maybe it?s a wild guess but I just thought that spatial statistics can help me. Here it goes:
 
I am analysing data from whole genome shotgun (WGS) sequencing of the cow and I am comparing the obtained numerous small sequences to the cow reference genome assembly. The WGS sequences are from a cow breed but the reference genome is from another breed. I mapped the obtained sequences to the reference genome with an algorithm similar to BLAST and now I have an output file with the score (-> like a probability) of the alignment for each of my WGS sequences. 
In attachment there is a picture with the genome reference sequence and my WGS sequences (called "tag" with light blue color) and the correspondent scores. In this picture we just see a small portion of the chromosome 1 of the cow genome.
 
Therefore, I would like to know if it is possible to use some R packages that deal with spatial analysis in order to see if there is any region of the genome that is statistically more dense in these tags than another region. 
 
Thanks for you time.
 


Best regards

Jo?o Fadista
Ph.d. student


 	
 	 UNIVERSITY OF AARHUS	
Faculty of Agricultural Sciences	
Dept. of Genetics and Biotechnology	
Blichers All? 20, P.O. BOX 50	
DK-8830 Tjele	
 	
Phone:	 +45 8999 1900	
Direct:	 +45 8999 1900	
E-mail:	 Joao.Fadista at agrsci.dk <mailto:Joao.Fadista at agrsci.dk> 	
Web:	 www.agrsci.org <http://www.agrsci.org/> 	
________________________________

News and news media <http://www.agrsci.org/navigation/nyheder_og_presse> . 

This email may contain information that is confidential. Any use or publication of this email without written permission from Faculty of Agricultural Sciences is not allowed. If you are not the intended recipient, please notify Faculty of Agricultural Sciences immediately and delete this email.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070629/be58ea76/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mapped_tags.GIF
Type: image/gif
Size: 59956 bytes
Desc: mapped_tags.GIF
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070629/be58ea76/attachment.gif>

From debarchana.ghosh at gmail.com  Fri Jun 29 22:32:46 2007
From: debarchana.ghosh at gmail.com (Debarchana Ghosh)
Date: Fri, 29 Jun 2007 15:32:46 -0500
Subject: [R-sig-Geo] Problem in creating esri grid from SpatialGridDataFrame
Message-ID: <d1b8ff630706291332o365d1109lf497f82cb60a7654@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070629/ca6c614d/attachment.pl>

From jsanchez at upei.ca  Sat Jun 30 12:53:35 2007
From: jsanchez at upei.ca (Javier Sanchez)
Date: Sat, 30 Jun 2007 07:53:35 -0300
Subject: [R-sig-Geo] out of the office (was: R-sig-Geo Digest, Vol 46,
	Issue 26)
Message-ID: <4686362F.4040003@upei.ca>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20070630/8ce1d09d/attachment.html>

From Roger.Bivand at nhh.no  Sat Jun 30 15:35:07 2007
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 30 Jun 2007 15:35:07 +0200 (CEST)
Subject: [R-sig-Geo] Problem in creating esri grid from
	SpatialGridDataFrame
In-Reply-To: <d1b8ff630706291332o365d1109lf497f82cb60a7654@mail.gmail.com>
References: <d1b8ff630706291332o365d1109lf497f82cb60a7654@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0706301527320.19298@reclus.nhh.no>

On Fri, 29 Jun 2007, Debarchana Ghosh wrote:

> Hello,
>
> I'm running R in windows with 2 GB Ram and 120 GB hard drive
>
> I have created a SpatialGridDataFrame object by using the functions
> GridTopology and spkernel2d.
>
> Here is the code:
> bird06.xy<-coordinates(splanc_bird06[1:2])
> grd1<-GridTopology(c(419983.3, 4924198), c(30,30), c(3375,3499))
> k5000<-spkernel2d(bird06.xy, splanc_bird06$poly, h0=5000, grd1)
> df<-data.frame(k5000=k5000)
> kernel5000<-SpatialGridDataFrame(grd1, data=df)
>
> Now I want to write kernel5000 into a ESRI readable grid/raster
> I used the following function:
>
> write.asciigrid(kernel5000, fname="kernelbird06.ag")
> Error: cannot allocate vector of size 92258 Kb
>
> I have three questions:
> 1. what is the solution to work around the memory problem? The computer has
> 2 GB of ram

You might try to call gc() several times to flush unused temporary 
objects, but your ~ 16M cell raster object is quite large. The 
writeAsciiGrid() function in maptools (your version is in sp and not 
maintained as such) converts the raster from 8 byte to about 20 byte 
character representation. I personally would have used writeGDAL() in 
rgdal, writing to a GTiff file - in Arc, you'll need to adjust the 
symbology, because Arc doesn't automatically understand the many small 
density values.

> 2. How can I read/open the .ag file in ESRI ArcMap or ArcCatalog. I tried
> the example in the write.asciigrid manual page but I could not read/open the
> .ag file in ArcMap

I believe it doesn't recognize the extension, try *.txt or *.aai, or open 
All files.

> 3. Is write.asciigrid the correct function to write spatialGridDataFrame
> object in ESRI readable grid format?

The writeGDAL() function in rgdal supports many more drivers, including 
GTiff, which seems robust. From 9.2, ArcGIS is also uding the same 
underlying GDAL library for some raster file exchange operations.

Hope this helps,

Roger

>
> Thanks,
> Debs.
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



