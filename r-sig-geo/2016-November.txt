From Jin.Li at ga.gov.au  Tue Nov  1 05:25:42 2016
From: Jin.Li at ga.gov.au (Li Jin)
Date: Tue, 1 Nov 2016 04:25:42 +0000
Subject: [R-sig-Geo] Error with gstat::predict [SEC=UNCLASSIFIED]
In-Reply-To: <aea4ba06-dd14-2338-7ad6-dcd019a83f2a@uni-muenster.de>
References: <541880c21d784932a43e9ec6903a2b2b@win-exch-prod01.prod.lan>
	<118d1262-4dd0-3340-9aba-fef180f32642@uni-muenster.de>
	<alpine.LFD.2.20.1610310911150.2648@reclus.nhh.no>
	<aea4ba06-dd14-2338-7ad6-dcd019a83f2a@uni-muenster.de>
Message-ID: <07f3311d28504fd89aaf2a249d8fd29f@win-exch-prod01.prod.lan>

Many thanks, Edzer and Roger! Great help!
Kind regards,
Jin

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Monday, 31 October 2016 8:46 PM
To: Roger.Bivand at nhh.no
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Error with gstat::predict [SEC=UNCLASSIFIED]



On 31/10/16 09:12, Roger Bivand wrote:
> On Mon, 31 Oct 2016, Edzer Pebesma wrote:
> 
>>
>>
>> On 31/10/16 05:09, Li Jin wrote:
>>> Hi All,
>>>
>>> I need to use the predict{gstat} function in one of my functions for 
>>> a R package. I use RStudio to make the package. When I specified 
>>> gstat::predict in the function, I received the following error:
>>>
>>> Error: 'predict' is not an exported object from 'namespace:gstat'
>>
>> gstat exports 'predict' as an S3method; if it would export 'predict' 
>> as an object, this would hide the generic in package stats.
>>
>> The solution to your problem is to not put prepend 'predict' with 
>> gstat::, but instead rely on S3 method dispatch.
> 
> Is it possible that the OP is not importing correctly in the NAMESPACE 
> file of the package in question?

Indeed: your package should load (import):

1. predict from package stats, if it wants to use predict 2. package gstat if it wants to use the predict method for gstat objects.
3. use stats::predict rather than gstat::predict if you'd insist on prepending package:: to a generic

> 
> Roger
> 
>>
>> The actual, un-exported function called is gstat:::predict.gstat, but 
>> it is discouraged to call that directly.
>>
>>>
>>> The session information is:
>>>
>>>> sessionInfo()
>>>
>>> R version 3.3.1 (2016-06-21)
>>>
>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>
>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>
>>>
>>>
>>> locale:
>>>
>>> [1] LC_COLLATE=English_Australia.1252  
>>> LC_CTYPE=English_Australia.1252
>>>
>>> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
>>>
>>> [5] LC_TIME=English_Australia.1252
>>>
>>>
>>>
>>> attached base packages:
>>>
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>>
>>>
>>> other attached packages:
>>>
>>> [1] myrpackage_0.0.0.9000 devtools_1.12.0
>>>
>>>
>>>
>>> loaded via a namespace (and not attached):
>>>
>>> [1] tools_3.3.1   withr_1.0.2   memoise_1.0.0 digest_0.6.10
>>>
>>> Is this a bug? Any suggestions? Many thanks in advance!
>>>
>>> Kind regards,
>>> Jin
>>>
>>> Jin Li, PhD
>>> Spatial Modeller/Computational Statistician  |  National Earth and 
>>> Marine Observations Environmental Geoscience Division  |  GEOSCIENCE 
>>> AUSTRALIA 
>>> ____________________________________________________________
>>> Phone:  +61 2 6249 9899    Fax:  +61 2 6249 9999
>>> Email:  Jin.Li at ga.gov.au<mailto:Jin.Li at ga.gov.au>    Web: 
>>> www.ga.gov.au<http://www.ga.gov.au/>
>>> 101 Jerrabomberra Avenue Symonston ACT GPO Box 378 Canberra ACT 2601 
>>> Australia Applying geoscience to Australia?s most important 
>>> challenges
>>>
>>>
>>>
>>> Geoscience Australia Disclaimer: This e-mail (and files transmitted 
>>> with it) is intended only for the person or entity to which it is 
>>> addressed. If you are not the intended recipient, then you have 
>>> received this e-mail by mistake and any use, dissemination, 
>>> forwarding, printing or copying of this e-mail and its file 
>>> attachments is prohibited. The security of emails transmitted cannot 
>>> be guaranteed; by forwarding or replying to this email, you 
>>> acknowledge and accept these risks.
>>> --------------------------------------------------------------------
>>> -----------------------------------------------------
>>>
>>>
>>>
>>>     [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
> 

--
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/


Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
-------------------------------------------------------------------------------------------------------------------------


From janka.vanschoenwinkel at uhasselt.be  Tue Nov  1 10:24:01 2016
From: janka.vanschoenwinkel at uhasselt.be (Janka VANSCHOENWINKEL)
Date: Tue, 1 Nov 2016 10:24:01 +0100
Subject: [R-sig-Geo] Self-intersection error when using intersect with two
	shapefiles
Message-ID: <CAHymutJ3A-PAg4_QjtF0guPNydSp7xb1=T4H-M1VT0vApaWD3Q@mail.gmail.com>

Dear colleagues,

I am trying to "translate" worldwide raster data to European nuts3
polygons. That means I try to overlap two shapefiles to find the
average value on nuts3 level (based on the worldwide raster data).

Unfortunately, when I use the intersect function, I get the following error:

 >>>> new_spdf <- intersect(grid,nuts)
Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
unaryUnion_if_byid_false,  : TopologyException: Input geom 1 is
invalid: Self-intersection at or near point 13.3081265
48.608032999999999 at 13.3081265 48.608032999999999

The full code can be found below. I have used it before with other
shapefiles and it worked. With the new shapefiles that I am using now,
I get the above error. I think it might be a projection problem but I
have not a lot of experience with this.

Your help is appreciated a lot! Thanks in advance!

Janka


**Below you can find the full code + data + session info**

    ### download the files available through this link:
    # https://drive.google.com/open?id=0By9u5m3kxn9yUy1xVDF2NV9TajA

    > library(rgdal)
    > nuts <- readOGR(".", layer = "NUTS_RG_60M_2010")
    OGR data source with driver: ESRI Shapefile
    Source: ".", layer: "NUTS_RG_60M_2010"
    with 1920 features
    It has 4 fields
    > grid <- readOGR(".", layer = "a3_mean_annual_runoff_1950_2000")
    OGR data source with driver: ESRI Shapefile
    Source: ".", layer: "a3_mean_annual_runoff_1950_2000"
    with 41553 features
    It has 2 fields
    > summary(nuts)
    Object of class SpatialPolygonsDataFrame
    Coordinates:
            min      max
    x -61.74369 55.83663
    y -21.37656 71.17308
    Is projected: FALSE
    proj4string : [+proj=longlat +ellps=GRS80 +no_defs]
    Data attributes:
        NUTS_ID       STAT_LEVL_     SHAPE_Leng         SHAPE_Area
     AT     :   1   Min.   :0.00   Min.   :  0.1326   Min.   : 0.00057
     AT1    :   1   1st Qu.:3.00   1st Qu.:  1.6480   1st Qu.: 0.11795
     AT11   :   1   Median :3.00   Median :  2.9772   Median : 0.35707
     AT111  :   1   Mean   :2.66   Mean   :  5.1573   Mean   : 1.56752
     AT112  :   1   3rd Qu.:3.00   3rd Qu.:  5.3525   3rd Qu.: 0.97955
     AT113  :   1   Max.   :3.00   Max.   :132.3810   Max.   :81.09899
     (Other):1914
    > summary(grid)
    Object of class SpatialPolygonsDataFrame
    Coordinates:
       min   max
    x -180 180.0
    y  -55  83.5
    Is projected: FALSE
    proj4string :
    [+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
    Data attributes:
           ID             CODE
     Min.   :    1   Min.   :   0.0
     1st Qu.:10389   1st Qu.: 118.6
     Median :20777   Median : 260.0
     Mean   :20777   Mean   : 432.1
     3rd Qu.:31165   3rd Qu.: 528.8
     Max.   :41553   Max.   :6854.2
    grid <- spTransform(grid, CRSobj = CRS(proj4string(nuts)))
    > new_spdf <- intersect(grid,nuts)
    Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id,
drop_lower_td, unaryUnion_if_byid_false,  :
      TopologyException: Input geom 1 is invalid: Self-intersection at
or near point 13.3081265 48.608032999999999 at 13.3081265
48.608032999999999

grid_nuts <- gIntersects(new_spdf,nuts,byid = TRUE)
#Take all the values in a particular NUTS polygon, multiply by each
the areas of the
#corresponding new grid cells then divide by the total area of the NUTS polygon

#Added the if statement to avoid non-overlapping NUTS polygons

for(i in 1:length(nuts)){
  if(any(grid_nuts[i,])){
    nuts at data$average_spatial_value[i] <-
mean(new_spdf at data$value[grid_nuts[i,]]*

gArea(new_spdf[grid_nuts[i,],])/
                                                 gArea(nuts[i,]))
  } else {
    nuts at data$average_spatial_value[i] <- NA
  }

}



> sessionInfo() # one of the things I tried to solve the above problem is to install the latest R versions

R version 3.3.1 (2016-06-21)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgeos_0.3-21 raster_2.5-8 rgdal_1.1-10 sp_1.2-3

loaded via a namespace (and not attached):
[1] tools_3.3.1     Rcpp_0.12.7     grid_3.3.1      lattice_0.20-33


P.S. I also posted the question on
http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles
with no response yet.


From Remi.DAnnunzio at fao.org  Tue Nov  1 10:54:46 2016
From: Remi.DAnnunzio at fao.org (DAnnunzio, Remi (FOA))
Date: Tue, 1 Nov 2016 09:54:46 +0000
Subject: [R-sig-Geo] Self-intersection error when using intersect with
	two	shapefiles
In-Reply-To: <CAHymutJ3A-PAg4_QjtF0guPNydSp7xb1=T4H-M1VT0vApaWD3Q@mail.gmail.com>
References: <CAHymutJ3A-PAg4_QjtF0guPNydSp7xb1=T4H-M1VT0vApaWD3Q@mail.gmail.com>
Message-ID: <AM4PR05MB1459B3CDB91C2A9EFD9493BF99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>

Dear Janka



1/ I would suggest to make things simpler, i.e use the original raster data directly with the shapefile  you want to get your values from and use the extract() function. See post here http://stackoverflow.com/questions/22333473/how-do-i-extract-raster-values-from-polygon-data-then-join-into-spatial-data-fra


2/ it seems like you do have a geometry issue at the mentioned point in your NUTS3 shapefile. Maybe you should correct it in your favorite GIS environment, or get a better dataset with more detailed boundaries (e.g www.gadm.org<http://www.gadm.org>). You can also access the GADM data directly in R with the getData() function. See here for example http://www.gis-blog.com/r-raster-data-acquisition/.


Hope it helps

R?mi


R?mi d'Annunzio
Remote sensing and GIS - Forestry Department
UN-FAO
Phone:  +44 7 94 64 35 698
Email:    remi.dannunzio at fao.org
Skype:   rdannunzio



________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Janka VANSCHOENWINKEL <janka.vanschoenwinkel at uhasselt.be>
Sent: 01 November 2016 09:24
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Self-intersection error when using intersect with two shapefiles

Dear colleagues,

I am trying to "translate" worldwide raster data to European nuts3
polygons. That means I try to overlap two shapefiles to find the
average value on nuts3 level (based on the worldwide raster data).

Unfortunately, when I use the intersect function, I get the following error:

 >>>> new_spdf <- intersect(grid,nuts)
Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
unaryUnion_if_byid_false,  : TopologyException: Input geom 1 is
invalid: Self-intersection at or near point 13.3081265
48.608032999999999 at 13.3081265 48.608032999999999

The full code can be found below. I have used it before with other
shapefiles and it worked. With the new shapefiles that I am using now,
I get the above error. I think it might be a projection problem but I
have not a lot of experience with this.

Your help is appreciated a lot! Thanks in advance!

Janka


**Below you can find the full code + data + session info**

    ### download the files available through this link:
    # https://drive.google.com/open?id=0By9u5m3kxn9yUy1xVDF2NV9TajA

    > library(rgdal)
    > nuts <- readOGR(".", layer = "NUTS_RG_60M_2010")
    OGR data source with driver: ESRI Shapefile
    Source: ".", layer: "NUTS_RG_60M_2010"
    with 1920 features
    It has 4 fields
    > grid <- readOGR(".", layer = "a3_mean_annual_runoff_1950_2000")
    OGR data source with driver: ESRI Shapefile
    Source: ".", layer: "a3_mean_annual_runoff_1950_2000"
    with 41553 features
    It has 2 fields
    > summary(nuts)
    Object of class SpatialPolygonsDataFrame
    Coordinates:
            min      max
    x -61.74369 55.83663
    y -21.37656 71.17308
    Is projected: FALSE
    proj4string : [+proj=longlat +ellps=GRS80 +no_defs]
    Data attributes:
        NUTS_ID       STAT_LEVL_     SHAPE_Leng         SHAPE_Area
     AT     :   1   Min.   :0.00   Min.   :  0.1326   Min.   : 0.00057
     AT1    :   1   1st Qu.:3.00   1st Qu.:  1.6480   1st Qu.: 0.11795
     AT11   :   1   Median :3.00   Median :  2.9772   Median : 0.35707
     AT111  :   1   Mean   :2.66   Mean   :  5.1573   Mean   : 1.56752
     AT112  :   1   3rd Qu.:3.00   3rd Qu.:  5.3525   3rd Qu.: 0.97955
     AT113  :   1   Max.   :3.00   Max.   :132.3810   Max.   :81.09899
     (Other):1914
    > summary(grid)
    Object of class SpatialPolygonsDataFrame
    Coordinates:
       min   max
    x -180 180.0
    y  -55  83.5
    Is projected: FALSE
    proj4string :
    [+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
    Data attributes:
           ID             CODE
     Min.   :    1   Min.   :   0.0
     1st Qu.:10389   1st Qu.: 118.6
     Median :20777   Median : 260.0
     Mean   :20777   Mean   : 432.1
     3rd Qu.:31165   3rd Qu.: 528.8
     Max.   :41553   Max.   :6854.2
    grid <- spTransform(grid, CRSobj = CRS(proj4string(nuts)))
    > new_spdf <- intersect(grid,nuts)
    Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id,
drop_lower_td, unaryUnion_if_byid_false,  :
      TopologyException: Input geom 1 is invalid: Self-intersection at
or near point 13.3081265 48.608032999999999 at 13.3081265
48.608032999999999

grid_nuts <- gIntersects(new_spdf,nuts,byid = TRUE)
#Take all the values in a particular NUTS polygon, multiply by each
the areas of the
#corresponding new grid cells then divide by the total area of the NUTS polygon

#Added the if statement to avoid non-overlapping NUTS polygons

for(i in 1:length(nuts)){
  if(any(grid_nuts[i,])){
    nuts at data$average_spatial_value[i] <-
mean(new_spdf at data$value[grid_nuts[i,]]*

gArea(new_spdf[grid_nuts[i,],])/
                                                 gArea(nuts[i,]))
  } else {
    nuts at data$average_spatial_value[i] <- NA
  }

}



> sessionInfo() # one of the things I tried to solve the above problem is to install the latest R versions

R version 3.3.1 (2016-06-21)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgeos_0.3-21 raster_2.5-8 rgdal_1.1-10 sp_1.2-3

loaded via a namespace (and not attached):
[1] tools_3.3.1     Rcpp_0.12.7     grid_3.3.1      lattice_0.20-33


P.S. I also posted the question on
http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles
[http://cdn.sstatic.net/Sites/gis/img/apple-touch-icon at 2.png?v=54e3ab1edcf3&a]<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>

R: Self-intersection error when using intersect with two shapefiles<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
gis.stackexchange.com
I am trying to "translate" worldwide raster data to European nuts3 polygons. That means I try to overlap two shapefiles to find the average value on nuts3 level. Unfortunately, when I use the inte...


with no response yet.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo



	[[alternative HTML version deleted]]


From janka.vanschoenwinkel at uhasselt.be  Tue Nov  1 15:07:29 2016
From: janka.vanschoenwinkel at uhasselt.be (Janka VANSCHOENWINKEL)
Date: Tue, 1 Nov 2016 15:07:29 +0100
Subject: [R-sig-Geo] Self-intersection error when using intersect with
	two shapefiles
In-Reply-To: <AM4PR05MB1459B3CDB91C2A9EFD9493BF99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>
References: <CAHymutJ3A-PAg4_QjtF0guPNydSp7xb1=T4H-M1VT0vApaWD3Q@mail.gmail.com>
	<AM4PR05MB1459B3CDB91C2A9EFD9493BF99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>
Message-ID: <CAHymutLTo8J=rE-knqQDyb=TiUy-iZHMw3s0==LMiVkBtRTabA@mail.gmail.com>

Dear Remi,

Thank you very much for your reply.

Unfortunately, the first solution does not do it for me. I have two
shapefiles. One of them contains raster-style data but they are saved as a
shapefile. So I want to overlap two shapefiles. The extract function only
works with a real raster and a shapefile if I understand it correctly. I
tried it, and it didn't work.

For the second solution: I have never heard of this and I will have a
thorough look at it.

Janka

2016-11-01 10:54 GMT+01:00 DAnnunzio, Remi (FOA) <Remi.DAnnunzio at fao.org>:

> Dear Janka
>
>
>
> 1/ I would suggest to make things simpler, i.e use the original raster
> data directly with the shapefile  you want to get your values from and use
> the extract() function. See post here http://stackoverflow.com/
> questions/22333473/how-do-i-extract-raster-values-from-
> polygon-data-then-join-into-spatial-data-fra
>
>
> 2/ it seems like you do have a geometry issue at the mentioned point in
> your NUTS3 shapefile. Maybe you should correct it in your favorite GIS
> environment, or get a better dataset with more detailed boundaries (e.g
> www.gadm.org). You can also access the GADM data directly in R with the
> getData() function. See here for example http://www.gis-blog.
> com/r-raster-data-acquisition/.
>
>
> Hope it helps
>
> R?mi
>
>
> *R?mi d'Annunzio*
> Remote sensing and GIS - Forestry Department
> UN-FAO
> *Phone:*  +44 7 94 64 35 698
> *Email: *   remi.dannunzio at fao.org
> *Skype:*   rdannunzio
>
>
>
> ------------------------------
> *From:* R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Janka
> VANSCHOENWINKEL <janka.vanschoenwinkel at uhasselt.be>
> *Sent:* 01 November 2016 09:24
> *To:* r-sig-geo at r-project.org
> *Subject:* [R-sig-Geo] Self-intersection error when using intersect with
> two shapefiles
>
> Dear colleagues,
>
> I am trying to "translate" worldwide raster data to European nuts3
> polygons. That means I try to overlap two shapefiles to find the
> average value on nuts3 level (based on the worldwide raster data).
>
> Unfortunately, when I use the intersect function, I get the following
> error:
>
>  >>>> new_spdf <- intersect(grid,nuts)
> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
> unaryUnion_if_byid_false,  : TopologyException: Input geom 1 is
> invalid: Self-intersection at or near point 13.3081265
> 48.608032999999999 at 13.3081265 48.608032999999999
>
> The full code can be found below. I have used it before with other
> shapefiles and it worked. With the new shapefiles that I am using now,
> I get the above error. I think it might be a projection problem but I
> have not a lot of experience with this.
>
> Your help is appreciated a lot! Thanks in advance!
>
> Janka
>
>
> **Below you can find the full code + data + session info**
>
>     ### download the files available through this link:
>     # https://drive.google.com/open?id=0By9u5m3kxn9yUy1xVDF2NV9TajA
>
>     > library(rgdal)
>     > nuts <- readOGR(".", layer = "NUTS_RG_60M_2010")
>     OGR data source with driver: ESRI Shapefile
>     Source: ".", layer: "NUTS_RG_60M_2010"
>     with 1920 features
>     It has 4 fields
>     > grid <- readOGR(".", layer = "a3_mean_annual_runoff_1950_2000")
>     OGR data source with driver: ESRI Shapefile
>     Source: ".", layer: "a3_mean_annual_runoff_1950_2000"
>     with 41553 features
>     It has 2 fields
>     > summary(nuts)
>     Object of class SpatialPolygonsDataFrame
>     Coordinates:
>             min      max
>     x -61.74369 55.83663
>     y -21.37656 71.17308
>     Is projected: FALSE
>     proj4string : [+proj=longlat +ellps=GRS80 +no_defs]
>     Data attributes:
>         NUTS_ID       STAT_LEVL_     SHAPE_Leng         SHAPE_Area
>      AT     :   1   Min.   :0.00   Min.   :  0.1326   Min.   : 0.00057
>      AT1    :   1   1st Qu.:3.00   1st Qu.:  1.6480   1st Qu.: 0.11795
>      AT11   :   1   Median :3.00   Median :  2.9772   Median : 0.35707
>      AT111  :   1   Mean   :2.66   Mean   :  5.1573   Mean   : 1.56752
>      AT112  :   1   3rd Qu.:3.00   3rd Qu.:  5.3525   3rd Qu.: 0.97955
>      AT113  :   1   Max.   :3.00   Max.   :132.3810   Max.   :81.09899
>      (Other):1914
>     > summary(grid)
>     Object of class SpatialPolygonsDataFrame
>     Coordinates:
>        min   max
>     x -180 180.0
>     y  -55  83.5
>     Is projected: FALSE
>     proj4string :
>     [+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
>     Data attributes:
>            ID             CODE
>      Min.   :    1   Min.   :   0.0
>      1st Qu.:10389   1st Qu.: 118.6
>      Median :20777   Median : 260.0
>      Mean   :20777   Mean   : 432.1
>      3rd Qu.:31165   3rd Qu.: 528.8
>      Max.   :41553   Max.   :6854.2
>     grid <- spTransform(grid, CRSobj = CRS(proj4string(nuts)))
>     > new_spdf <- intersect(grid,nuts)
>     Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id,
> drop_lower_td, unaryUnion_if_byid_false,  :
>       TopologyException: Input geom 1 is invalid: Self-intersection at
> or near point 13.3081265 48.608032999999999 at 13.3081265
> 48.608032999999999
>
> grid_nuts <- gIntersects(new_spdf,nuts,byid = TRUE)
> #Take all the values in a particular NUTS polygon, multiply by each
> the areas of the
> #corresponding new grid cells then divide by the total area of the NUTS
> polygon
>
> #Added the if statement to avoid non-overlapping NUTS polygons
>
> for(i in 1:length(nuts)){
>   if(any(grid_nuts[i,])){
>     nuts at data$average_spatial_value[i] <-
> mean(new_spdf at data$value[grid_nuts[i,]]*
>
> gArea(new_spdf[grid_nuts[i,],])/
>                                                  gArea(nuts[i,]))
>   } else {
>     nuts at data$average_spatial_value[i] <- NA
>   }
>
> }
>
>
>
> > sessionInfo() # one of the things I tried to solve the above problem is
> to install the latest R versions
>
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgeos_0.3-21 raster_2.5-8 rgdal_1.1-10 sp_1.2-3
>
> loaded via a namespace (and not attached):
> [1] tools_3.3.1     Rcpp_0.12.7     grid_3.3.1      lattice_0.20-33
>
>
> P.S. I also posted the question on
> http://gis.stackexchange.com/questions/216095/r-self-
> intersection-error-when-using-intersect-with-two-shapefiles
>
> <http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
> R: Self-intersection error when using intersect with two shapefiles
> <http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
> gis.stackexchange.com
> I am trying to "translate" worldwide raster data to European nuts3
> polygons. That means I try to overlap two shapefiles to find the average
> value on nuts3 level. Unfortunately, when I use the inte...
>
> with no response yet.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> R-sig-Geo Info Page <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> stat.ethz.ch
> R-sig-Geo -- R Special Interest Group on using Geographical data and
> Mapping About R-sig-Geo
>
>


-- 

[image: Logo UHasselt] Mevrouw Janka Vanschoenwinkel
*Doctoraatsbursaal - PhD *
Milieueconomie - Environmental economics

T +32(0)11 26 86 96 | GSM +32(0)476 28 21 40

www.uhasselt.be/eec

Universiteit Hasselt | Campus Diepenbeek
Agoralaan Gebouw D | B-3590 Diepenbeek
Kantoor F11

Postadres: Universiteit Hasselt | Martelarenlaan 42 | B-3500 Hasselt


[image: Music For Life]  Maak van UHasselt de #warmsteunief |
www.uhasselt.be/musicforlife


P Please consider the environment before printing this e-mail

	[[alternative HTML version deleted]]


From Remi.DAnnunzio at fao.org  Tue Nov  1 15:16:55 2016
From: Remi.DAnnunzio at fao.org (DAnnunzio, Remi (FOA))
Date: Tue, 1 Nov 2016 14:16:55 +0000
Subject: [R-sig-Geo] Self-intersection error when using intersect with
 two shapefiles
In-Reply-To: <CAHymutLTo8J=rE-knqQDyb=TiUy-iZHMw3s0==LMiVkBtRTabA@mail.gmail.com>
References: <CAHymutJ3A-PAg4_QjtF0guPNydSp7xb1=T4H-M1VT0vApaWD3Q@mail.gmail.com>
	<AM4PR05MB1459B3CDB91C2A9EFD9493BF99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>,
	<CAHymutLTo8J=rE-knqQDyb=TiUy-iZHMw3s0==LMiVkBtRTabA@mail.gmail.com>
Message-ID: <AM4PR05MB1459920472CDB2683EA3AC0599A10@AM4PR05MB1459.eurprd05.prod.outlook.com>

Dear Janka,

Then if you have two vector based layers, use the over() function

Run    vignette("over")       for detailed explanations


Best

Remi

PS : for info, the http://biogeo.ucdavis.edu/ that hosts the datasets from getData() is often down these days. expect issues...


R?mi d'Annunzio
Remote sensing and GIS - Forestry Department
UN-FAO
Phone:  +44 7 94 64 35 698
Email:    remi.dannunzio at fao.org
Skype:   rdannunzio



________________________________
From: Janka VANSCHOENWINKEL <janka.vanschoenwinkel at uhasselt.be>
Sent: 01 November 2016 14:07
To: DAnnunzio, Remi (FOA)
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Self-intersection error when using intersect with two shapefiles

Dear Remi,

Thank you very much for your reply.

Unfortunately, the first solution does not do it for me. I have two shapefiles. One of them contains raster-style data but they are saved as a shapefile. So I want to overlap two shapefiles. The extract function only works with a real raster and a shapefile if I understand it correctly. I tried it, and it didn't work.

For the second solution: I have never heard of this and I will have a thorough look at it.

Janka

2016-11-01 10:54 GMT+01:00 DAnnunzio, Remi (FOA) <Remi.DAnnunzio at fao.org<mailto:Remi.DAnnunzio at fao.org>>:

Dear Janka



1/ I would suggest to make things simpler, i.e use the original raster data directly with the shapefile  you want to get your values from and use the extract() function. See post here http://stackoverflow.com/questions/22333473/how-do-i-extract-raster-values-from-polygon-data-then-join-into-spatial-data-fra


2/ it seems like you do have a geometry issue at the mentioned point in your NUTS3 shapefile. Maybe you should correct it in your favorite GIS environment, or get a better dataset with more detailed boundaries (e.g www.gadm.org<http://www.gadm.org>). You can also access the GADM data directly in R with the getData() function. See here for example http://www.gis-blog.com/r-raster-data-acquisition/.


Hope it helps

R?mi


R?mi d'Annunzio
Remote sensing and GIS - Forestry Department
UN-FAO
Phone:  +44 7 94 64 35 698
Email:    remi.dannunzio at fao.org<mailto:remi.dannunzio at fao.org>
Skype:   rdannunzio



________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>> on behalf of Janka VANSCHOENWINKEL <janka.vanschoenwinkel at uhasselt.be<mailto:janka.vanschoenwinkel at uhasselt.be>>
Sent: 01 November 2016 09:24
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: [R-sig-Geo] Self-intersection error when using intersect with two shapefiles

Dear colleagues,

I am trying to "translate" worldwide raster data to European nuts3
polygons. That means I try to overlap two shapefiles to find the
average value on nuts3 level (based on the worldwide raster data).

Unfortunately, when I use the intersect function, I get the following error:

 >>>> new_spdf <- intersect(grid,nuts)
Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
unaryUnion_if_byid_false,  : TopologyException: Input geom 1 is
invalid: Self-intersection at or near point 13.3081265
48.608032999999999 at 13.3081265 48.608032999999999

The full code can be found below. I have used it before with other
shapefiles and it worked. With the new shapefiles that I am using now,
I get the above error. I think it might be a projection problem but I
have not a lot of experience with this.

Your help is appreciated a lot! Thanks in advance!

Janka


**Below you can find the full code + data + session info**

    ### download the files available through this link:
    # https://drive.google.com/open?id=0By9u5m3kxn9yUy1xVDF2NV9TajA

    > library(rgdal)
    > nuts <- readOGR(".", layer = "NUTS_RG_60M_2010")
    OGR data source with driver: ESRI Shapefile
    Source: ".", layer: "NUTS_RG_60M_2010"
    with 1920 features
    It has 4 fields
    > grid <- readOGR(".", layer = "a3_mean_annual_runoff_1950_2000")
    OGR data source with driver: ESRI Shapefile
    Source: ".", layer: "a3_mean_annual_runoff_1950_2000"
    with 41553 features
    It has 2 fields
    > summary(nuts)
    Object of class SpatialPolygonsDataFrame
    Coordinates:
            min      max
    x -61.74369 55.83663
    y -21.37656 71.17308
    Is projected: FALSE
    proj4string : [+proj=longlat +ellps=GRS80 +no_defs]
    Data attributes:
        NUTS_ID       STAT_LEVL_     SHAPE_Leng         SHAPE_Area
     AT     :   1   Min.   :0.00   Min.   :  0.1326   Min.   : 0.00057
     AT1    :   1   1st Qu.:3.00   1st Qu.:  1.6480   1st Qu.: 0.11795
     AT11   :   1   Median :3.00   Median :  2.9772   Median : 0.35707
     AT111  :   1   Mean   :2.66   Mean   :  5.1573   Mean   : 1.56752
     AT112  :   1   3rd Qu.:3.00   3rd Qu.:  5.3525   3rd Qu.: 0.97955
     AT113  :   1   Max.   :3.00   Max.   :132.3810   Max.   :81.09899
     (Other):1914
    > summary(grid)
    Object of class SpatialPolygonsDataFrame
    Coordinates:
       min   max
    x -180 180.0
    y  -55  83.5
    Is projected: FALSE
    proj4string :
    [+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
    Data attributes:
           ID             CODE
     Min.   :    1   Min.   :   0.0
     1st Qu.:10389   1st Qu.: 118.6
     Median :20777   Median : 260.0
     Mean   :20777   Mean   : 432.1
     3rd Qu.:31165   3rd Qu.: 528.8
     Max.   :41553   Max.   :6854.2
    grid <- spTransform(grid, CRSobj = CRS(proj4string(nuts)))
    > new_spdf <- intersect(grid,nuts)
    Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id,
drop_lower_td, unaryUnion_if_byid_false,  :
      TopologyException: Input geom 1 is invalid: Self-intersection at
or near point 13.3081265 48.608032999999999 at 13.3081265
48.608032999999999

grid_nuts <- gIntersects(new_spdf,nuts,byid = TRUE)
#Take all the values in a particular NUTS polygon, multiply by each
the areas of the
#corresponding new grid cells then divide by the total area of the NUTS polygon

#Added the if statement to avoid non-overlapping NUTS polygons

for(i in 1:length(nuts)){
  if(any(grid_nuts[i,])){
    nuts at data$average_spatial_value[i] <-
mean(new_spdf at data$value[grid_nuts[i,]]*

gArea(new_spdf[grid_nuts[i,],])/
                                                 gArea(nuts[i,]))
  } else {
    nuts at data$average_spatial_value[i] <- NA
  }

}



> sessionInfo() # one of the things I tried to solve the above problem is to install the latest R versions

R version 3.3.1 (2016-06-21)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgeos_0.3-21 raster_2.5-8 rgdal_1.1-10 sp_1.2-3

loaded via a namespace (and not attached):
[1] tools_3.3.1     Rcpp_0.12.7     grid_3.3.1      lattice_0.20-33


P.S. I also posted the question on
http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles
[http://cdn.sstatic.net/Sites/gis/img/apple-touch-icon at 2.png?v=54e3ab1edcf3&a]<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>

R: Self-intersection error when using intersect with two shapefiles<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
gis.stackexchange.com<http://gis.stackexchange.com>
I am trying to "translate" worldwide raster data to European nuts3 polygons. That means I try to overlap two shapefiles to find the average value on nuts3 level. Unfortunately, when I use the inte...


with no response yet.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch<http://stat.ethz.ch>
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo





--

[Logo UHasselt] Mevrouw Janka Vanschoenwinkel
Doctoraatsbursaal - PhD
Milieueconomie - Environmental economics

T +32(0)11 26 86 96 | GSM +32(0)476 28 21 40

www.uhasselt.be/eec<http://www.uhasselt.be/eec>

Universiteit Hasselt | Campus Diepenbeek
Agoralaan Gebouw D | B-3590 Diepenbeek
Kantoor F11

Postadres: Universiteit Hasselt | Martelarenlaan 42 | B-3500 Hasselt


[Music For Life]  Maak van UHasselt de #warmsteunief | www.uhasselt.be/musicforlife<http://www.uhasselt.be/musicforlife>



P Please consider the environment before printing this e-mail


	[[alternative HTML version deleted]]


From Remi.DAnnunzio at fao.org  Tue Nov  1 15:47:02 2016
From: Remi.DAnnunzio at fao.org (DAnnunzio, Remi (FOA))
Date: Tue, 1 Nov 2016 14:47:02 +0000
Subject: [R-sig-Geo] Self-intersection error when using intersect with
 two shapefiles
In-Reply-To: <AM4PR05MB1459920472CDB2683EA3AC0599A10@AM4PR05MB1459.eurprd05.prod.outlook.com>
References: <CAHymutJ3A-PAg4_QjtF0guPNydSp7xb1=T4H-M1VT0vApaWD3Q@mail.gmail.com>
	<AM4PR05MB1459B3CDB91C2A9EFD9493BF99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>,
	<CAHymutLTo8J=rE-knqQDyb=TiUy-iZHMw3s0==LMiVkBtRTabA@mail.gmail.com>,
	<AM4PR05MB1459920472CDB2683EA3AC0599A10@AM4PR05MB1459.eurprd05.prod.outlook.com>
Message-ID: <AM4PR05MB14598A40FEE4EE1EC110264C99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>

This below may do what you are looking for, to be adapted

# Select only the elements of grid that intersect nuts
grid_nuts <- grid[nuts,]

# Count the number of elements from grid_nuts that fall within each zone of nuts
nuts at data$count_grid <- unlist(over(x =nuts ,y=grid_nuts[,"ID"],fn="length"))

# Compute the average of the value CODE of elements from grid_nuts that fall within each zone of nuts
nuts at data$mean_grid <-  unlist(over(x =nuts ,y=grid_nuts[,"CODE"],fn="mean"))

# Export
writeOGR(obj=nuts,dsn="nuts_grid.shp",layer="nuts_grid",driver="ESRI Shapefile",overwrite_layer = T)



R?mi d'Annunzio
Remote sensing and GIS - Forestry Department
UN-FAO
Phone:  +44 7 94 64 35 698
Email:    remi.dannunzio at fao.org
Skype:   rdannunzio



________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of DAnnunzio, Remi (FOA) <Remi.DAnnunzio at fao.org>
Sent: 01 November 2016 14:16
To: Janka VANSCHOENWINKEL
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Self-intersection error when using intersect with two shapefiles

Dear Janka,

Then if you have two vector based layers, use the over() function

Run    vignette("over")       for detailed explanations


Best

Remi

PS : for info, the http://biogeo.ucdavis.edu/ that hosts the datasets from getData() is often down these days. expect issues...
Ecology, Geography, and Agriculture - Biogeographic Research<http://biogeo.ucdavis.edu/>
biogeo.ucdavis.edu
Ecology, Geography, and Agriculture? We use quantitative methods to study crop ecology, agricultural biodiversity, and agricultural development and their effects on ...




R?mi d'Annunzio
Remote sensing and GIS - Forestry Department
UN-FAO
Phone:  +44 7 94 64 35 698
Email:    remi.dannunzio at fao.org
Skype:   rdannunzio



________________________________
From: Janka VANSCHOENWINKEL <janka.vanschoenwinkel at uhasselt.be>
Sent: 01 November 2016 14:07
To: DAnnunzio, Remi (FOA)
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Self-intersection error when using intersect with two shapefiles

Dear Remi,

Thank you very much for your reply.

Unfortunately, the first solution does not do it for me. I have two shapefiles. One of them contains raster-style data but they are saved as a shapefile. So I want to overlap two shapefiles. The extract function only works with a real raster and a shapefile if I understand it correctly. I tried it, and it didn't work.

For the second solution: I have never heard of this and I will have a thorough look at it.

Janka

2016-11-01 10:54 GMT+01:00 DAnnunzio, Remi (FOA) <Remi.DAnnunzio at fao.org<mailto:Remi.DAnnunzio at fao.org>>:

Dear Janka



1/ I would suggest to make things simpler, i.e use the original raster data directly with the shapefile  you want to get your values from and use the extract() function. See post here http://stackoverflow.com/questions/22333473/how-do-i-extract-raster-values-from-polygon-data-then-join-into-spatial-data-fra
[http://cdn.sstatic.net/Sites/stackoverflow/img/apple-touch-icon at 2.png?v=73d79a89bded&a]<http://stackoverflow.com/questions/22333473/how-do-i-extract-raster-values-from-polygon-data-then-join-into-spatial-data-fra>

How do I extract raster values from polygon data then join ...<http://stackoverflow.com/questions/22333473/how-do-i-extract-raster-values-from-polygon-data-then-join-into-spatial-data-fra>
stackoverflow.com
I would like to merge polygon data and raster data into one dataframe for purposes of then using randomForests package in R. This involves first extracting the mean ...




2/ it seems like you do have a geometry issue at the mentioned point in your NUTS3 shapefile. Maybe you should correct it in your favorite GIS environment, or get a better dataset with more detailed boundaries (e.g www.gadm.org<http://www.gadm.org>). You can also access the GADM data directly in R with the getData() function. See here for example http://www.gis-blog.com/r-raster-data-acquisition/.
Global Administrative Areas | Boundaries without limits<http://www.gadm.org/>
www.gadm.org
GADM is a spatial database of the location of the world's administrative areas (or adminstrative boundaries) for use in GIS and similar software.

[http://i0.wp.com/www.gis-blog.com/wp-content/uploads/2015/02/srt_austria_tot.jpeg?fit=641%2C656]<http://www.gis-blog.com/r-raster-data-acquisition/>

R raster: getData SRTM, WorldClim, GADM | GIS-Blog.com<http://www.gis-blog.com/r-raster-data-acquisition/>
www.gis-blog.com
Hey! Today I will show how powerful the R {raster} package is on another example. The raster package is not only a great tool for raster processing and calculation ...




Hope it helps

R?mi


R?mi d'Annunzio
Remote sensing and GIS - Forestry Department
UN-FAO
Phone:  +44 7 94 64 35 698
Email:    remi.dannunzio at fao.org<mailto:remi.dannunzio at fao.org>
Skype:   rdannunzio



________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>> on behalf of Janka VANSCHOENWINKEL <janka.vanschoenwinkel at uhasselt.be<mailto:janka.vanschoenwinkel at uhasselt.be>>
Sent: 01 November 2016 09:24
To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
Subject: [R-sig-Geo] Self-intersection error when using intersect with two shapefiles

Dear colleagues,

I am trying to "translate" worldwide raster data to European nuts3
polygons. That means I try to overlap two shapefiles to find the
average value on nuts3 level (based on the worldwide raster data).

Unfortunately, when I use the intersect function, I get the following error:

 >>>> new_spdf <- intersect(grid,nuts)
Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
unaryUnion_if_byid_false,  : TopologyException: Input geom 1 is
invalid: Self-intersection at or near point 13.3081265
48.608032999999999 at 13.3081265 48.608032999999999

The full code can be found below. I have used it before with other
shapefiles and it worked. With the new shapefiles that I am using now,
I get the above error. I think it might be a projection problem but I
have not a lot of experience with this.

Your help is appreciated a lot! Thanks in advance!

Janka


**Below you can find the full code + data + session info**

    ### download the files available through this link:
    # https://drive.google.com/open?id=0By9u5m3kxn9yUy1xVDF2NV9TajA

    > library(rgdal)
    > nuts <- readOGR(".", layer = "NUTS_RG_60M_2010")
    OGR data source with driver: ESRI Shapefile
    Source: ".", layer: "NUTS_RG_60M_2010"
    with 1920 features
    It has 4 fields
    > grid <- readOGR(".", layer = "a3_mean_annual_runoff_1950_2000")
    OGR data source with driver: ESRI Shapefile
    Source: ".", layer: "a3_mean_annual_runoff_1950_2000"
    with 41553 features
    It has 2 fields
    > summary(nuts)
    Object of class SpatialPolygonsDataFrame
    Coordinates:
            min      max
    x -61.74369 55.83663
    y -21.37656 71.17308
    Is projected: FALSE
    proj4string : [+proj=longlat +ellps=GRS80 +no_defs]
    Data attributes:
        NUTS_ID       STAT_LEVL_     SHAPE_Leng         SHAPE_Area
     AT     :   1   Min.   :0.00   Min.   :  0.1326   Min.   : 0.00057
     AT1    :   1   1st Qu.:3.00   1st Qu.:  1.6480   1st Qu.: 0.11795
     AT11   :   1   Median :3.00   Median :  2.9772   Median : 0.35707
     AT111  :   1   Mean   :2.66   Mean   :  5.1573   Mean   : 1.56752
     AT112  :   1   3rd Qu.:3.00   3rd Qu.:  5.3525   3rd Qu.: 0.97955
     AT113  :   1   Max.   :3.00   Max.   :132.3810   Max.   :81.09899
     (Other):1914
    > summary(grid)
    Object of class SpatialPolygonsDataFrame
    Coordinates:
       min   max
    x -180 180.0
    y  -55  83.5
    Is projected: FALSE
    proj4string :
    [+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
    Data attributes:
           ID             CODE
     Min.   :    1   Min.   :   0.0
     1st Qu.:10389   1st Qu.: 118.6
     Median :20777   Median : 260.0
     Mean   :20777   Mean   : 432.1
     3rd Qu.:31165   3rd Qu.: 528.8
     Max.   :41553   Max.   :6854.2
    grid <- spTransform(grid, CRSobj = CRS(proj4string(nuts)))
    > new_spdf <- intersect(grid,nuts)
    Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id,
drop_lower_td, unaryUnion_if_byid_false,  :
      TopologyException: Input geom 1 is invalid: Self-intersection at
or near point 13.3081265 48.608032999999999 at 13.3081265
48.608032999999999

grid_nuts <- gIntersects(new_spdf,nuts,byid = TRUE)
#Take all the values in a particular NUTS polygon, multiply by each
the areas of the
#corresponding new grid cells then divide by the total area of the NUTS polygon

#Added the if statement to avoid non-overlapping NUTS polygons

for(i in 1:length(nuts)){
  if(any(grid_nuts[i,])){
    nuts at data$average_spatial_value[i] <-
mean(new_spdf at data$value[grid_nuts[i,]]*

gArea(new_spdf[grid_nuts[i,],])/
                                                 gArea(nuts[i,]))
  } else {
    nuts at data$average_spatial_value[i] <- NA
  }

}



> sessionInfo() # one of the things I tried to solve the above problem is to install the latest R versions

R version 3.3.1 (2016-06-21)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgeos_0.3-21 raster_2.5-8 rgdal_1.1-10 sp_1.2-3

loaded via a namespace (and not attached):
[1] tools_3.3.1     Rcpp_0.12.7     grid_3.3.1      lattice_0.20-33


P.S. I also posted the question on
http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles
[http://cdn.sstatic.net/Sites/gis/img/apple-touch-icon at 2.png?v=54e3ab1edcf3&a]<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>

R: Self-intersection error when using intersect with two shapefiles<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
gis.stackexchange.com
I am trying to "translate" worldwide raster data to European nuts3 polygons. That means I try to overlap two shapefiles to find the average value on nuts3 level. Unfortunately, when I use the inte...


[http://cdn.sstatic.net/Sites/gis/img/apple-touch-icon at 2.png?v=54e3ab1edcf3&a]<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>

R: Self-intersection error when using intersect with two shapefiles<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
[http://cdn.sstatic.net/Sites/gis/img/apple-touch-icon at 2.png?v=54e3ab1edcf3&a]<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>

R: Self-intersection error when using intersect with two shapefiles<http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
gis.stackexchange.com
I am trying to "translate" worldwide raster data to European nuts3 polygons. That means I try to overlap two shapefiles to find the average value on nuts3 level. Unfortunately, when I use the inte...


gis.stackexchange.com<http://gis.stackexchange.com>
I am trying to "translate" worldwide raster data to European nuts3 polygons. That means I try to overlap two shapefiles to find the average value on nuts3 level. Unfortunately, when I use the inte...


with no response yet.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo


R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo


stat.ethz.ch<http://stat.ethz.ch>
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo





--

[Logo UHasselt] Mevrouw Janka Vanschoenwinkel
Doctoraatsbursaal - PhD
Milieueconomie - Environmental economics

T +32(0)11 26 86 96 | GSM +32(0)476 28 21 40

www.uhasselt.be/eec<http://www.uhasselt.be/eec>

Universiteit Hasselt | Campus Diepenbeek
Agoralaan Gebouw D | B-3590 Diepenbeek
Kantoor F11

Postadres: Universiteit Hasselt | Martelarenlaan 42 | B-3500 Hasselt


[Music For Life]  Maak van UHasselt de #warmsteunief | www.uhasselt.be/musicforlife<http://www.uhasselt.be/musicforlife<http://www.uhasselt.be/musicforlife<http://www.uhasselt.be/musicforlife>>



P Please consider the environment before printing this e-mail


        [[alternative HTML version deleted]]


	[[alternative HTML version deleted]]


From jpolo at mail.usf.edu  Tue Nov  1 17:37:59 2016
From: jpolo at mail.usf.edu (john polo)
Date: Tue, 1 Nov 2016 11:37:59 -0500
Subject: [R-sig-Geo] apply() proj4string to list of rasters
Message-ID: <a4d00c6f-50e2-c8dc-d1ae-2a90a5261434@mail.usf.edu>

R-folks,

I imported >1000 rasters with

rlist <- list.files(pattern=".ht.laz.bil")

for (i in rlist) { assign(unlist(strsplit(i,"[.]"))[1], raster(i)) }


These rasters do not have a coordinate reference system.

 > ras895500_3965500ht
class       : RasterLayer
dimensions  : 34, 15, 510  (nrow, ncol, ncell)
resolution  : 5, 5  (x, y)
extent      : 895500, 895575, 3965830, 3966000  (xmin, xmax, ymin, ymax)
coord. ref. : NA
data source : k:\outLiDAR\normalized\ras895500_3965500ht.laz.bil
names       : ras895500_3965500ht.laz


The rasters don't have the same extent, I can't use stack().

I tried

epsgm <- make_EPSG()
adpro <- epsgm[3587,"prj4"]
lapply(ls(pattern="ht"), function(x) {proj4string(x) <- adpro})

Error in (function (classes, fdef, mtable)  :
   unable to find an inherited method for function ?proj4string<-? for 
signature ?"character", "character"?

I searched and found a possible solution with mapply():

rrlis <- ls(patter="ht")
 > pfix4
function(x) proj4string(x) <- adpro
 > mapply(pfix4, rrlis)
Error in (function (classes, fdef, mtable)  :
   unable to find an inherited method for function ?proj4string<-? for 
signature ?"character", "character"?

My problem apparently is trying to assign to a character. If I make a 
list of the raster objects, the lists are of characters and the 
functions won't work on those. How can I iterate through the raster 
objects in memory to apply a function?


John


-- 
Men occasionally stumble
over the truth, but most of them
pick themselves up and hurry off
as if nothing had happened.
-- Winston Churchill


From b.rowlingson at lancaster.ac.uk  Tue Nov  1 18:59:44 2016
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 1 Nov 2016 17:59:44 +0000
Subject: [R-sig-Geo] apply() proj4string to list of rasters
In-Reply-To: <a4d00c6f-50e2-c8dc-d1ae-2a90a5261434@mail.usf.edu>
References: <a4d00c6f-50e2-c8dc-d1ae-2a90a5261434@mail.usf.edu>
Message-ID: <CANVKczPZEz3qRW-z-aS2x=M5=2QXYzaen3cbRKPv+btmNRr34g@mail.gmail.com>

You can do it by rewriting `projection(r) <- Z` as a function, and
assigning it back to the same name. I think this captures the essence:

Two rasters with default projections (epsg:4326)

 > r1 = raster()
 > r2 = raster()

Loop over names, get, set projection, re-assign:

 > for(rname in c("r1","r2")){
     assign(rname, "projection<-"(get(rname),"+init=epsg:27700"))
   }

See:

 > projection(r1)
[1] "+init=epsg:27700 +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717
+x_0=400000 +y_0=-100000 +datum=OSGB36 +units=m +no_defs +ellps=airy
+towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894"

and the same for r2.

There's usually more than one way to do this but this seems to work....

Of course you should have stored your rasters in a plain old R list,
then it would just be:

for(i in 1:length(rlist)){
 projection(rasters[[i]]) = whatever
}




On Tue, Nov 1, 2016 at 4:37 PM, john polo <jpolo at mail.usf.edu> wrote:
> R-folks,
>
> I imported >1000 rasters with
>
> rlist <- list.files(pattern=".ht.laz.bil")
>
> for (i in rlist) { assign(unlist(strsplit(i,"[.]"))[1], raster(i)) }
>
>
> These rasters do not have a coordinate reference system.
>
>> ras895500_3965500ht
> class       : RasterLayer
> dimensions  : 34, 15, 510  (nrow, ncol, ncell)
> resolution  : 5, 5  (x, y)
> extent      : 895500, 895575, 3965830, 3966000  (xmin, xmax, ymin, ymax)
> coord. ref. : NA
> data source : k:\outLiDAR\normalized\ras895500_3965500ht.laz.bil
> names       : ras895500_3965500ht.laz
>
>
> The rasters don't have the same extent, I can't use stack().
>
> I tried
>
> epsgm <- make_EPSG()
> adpro <- epsgm[3587,"prj4"]
> lapply(ls(pattern="ht"), function(x) {proj4string(x) <- adpro})
>
> Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?proj4string<-? for
> signature ?"character", "character"?
>
> I searched and found a possible solution with mapply():
>
> rrlis <- ls(patter="ht")
>> pfix4
> function(x) proj4string(x) <- adpro
>> mapply(pfix4, rrlis)
> Error in (function (classes, fdef, mtable)  :
>   unable to find an inherited method for function ?proj4string<-? for
> signature ?"character", "character"?
>
> My problem apparently is trying to assign to a character. If I make a list
> of the raster objects, the lists are of characters and the functions won't
> work on those. How can I iterate through the raster objects in memory to
> apply a function?
>
>
> John
>
>
> --
> Men occasionally stumble
> over the truth, but most of them
> pick themselves up and hurry off
> as if nothing had happened.
> -- Winston Churchill
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jpolo at mail.usf.edu  Tue Nov  1 19:22:12 2016
From: jpolo at mail.usf.edu (john polo)
Date: Tue, 1 Nov 2016 13:22:12 -0500
Subject: [R-sig-Geo] apply() proj4string to list of rasters
In-Reply-To: <CANVKczPZEz3qRW-z-aS2x=M5=2QXYzaen3cbRKPv+btmNRr34g@mail.gmail.com>
References: <a4d00c6f-50e2-c8dc-d1ae-2a90a5261434@mail.usf.edu>
	<CANVKczPZEz3qRW-z-aS2x=M5=2QXYzaen3cbRKPv+btmNRr34g@mail.gmail.com>
Message-ID: <13be692a-dd54-19c6-b7c9-8243c23c2bca@mail.usf.edu>

On 11/1/2016 12:59 PM, Barry Rowlingson wrote:
> You can do it by rewriting `projection(r) <- Z` as a function, and
> assigning it back to the same name. I think this captures the essence:...
Thanks, Barry for the help. Got another reply that also was helpful.

John

-- 
Men occasionally stumble
over the truth, but most of them
pick themselves up and hurry off
as if nothing had happened.
-- Winston Churchill


From Roger.Bivand at nhh.no  Tue Nov  1 19:39:23 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 1 Nov 2016 19:39:23 +0100
Subject: [R-sig-Geo] apply() proj4string to list of rasters
In-Reply-To: <13be692a-dd54-19c6-b7c9-8243c23c2bca@mail.usf.edu>
References: <a4d00c6f-50e2-c8dc-d1ae-2a90a5261434@mail.usf.edu>
	<CANVKczPZEz3qRW-z-aS2x=M5=2QXYzaen3cbRKPv+btmNRr34g@mail.gmail.com>
	<13be692a-dd54-19c6-b7c9-8243c23c2bca@mail.usf.edu>
Message-ID: <alpine.LFD.2.20.1611011933030.31503@reclus.nhh.no>

On Tue, 1 Nov 2016, john polo wrote:

> On 11/1/2016 12:59 PM, Barry Rowlingson wrote:
>>  You can do it by rewriting `projection(r) <- Z` as a function, and
>>  assigning it back to the same name. I think this captures the essence:...
> Thanks, Barry for the help. Got another reply that also was helpful.

Please do not privatise received hints, the list is for sharing 
information, not concealing it (the big drone in the server sees it anyway 
...).

My guess is that the underlying problem was the use of lapply() rather 
than a for() loop, and not reading the help page for assigning:

?"proj4string<-"

which does say:

"For ?proj4string? CRS object, containing a valid proj4 string"

so value should have been CRS(adpro), or make adpro a CRS first?

Roger

>
> John
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From jpolo at mail.usf.edu  Tue Nov  1 19:50:51 2016
From: jpolo at mail.usf.edu (john polo)
Date: Tue, 1 Nov 2016 13:50:51 -0500
Subject: [R-sig-Geo] apply() proj4string to list of rasters
In-Reply-To: <alpine.LFD.2.20.1611011933030.31503@reclus.nhh.no>
References: <a4d00c6f-50e2-c8dc-d1ae-2a90a5261434@mail.usf.edu>
	<CANVKczPZEz3qRW-z-aS2x=M5=2QXYzaen3cbRKPv+btmNRr34g@mail.gmail.com>
	<13be692a-dd54-19c6-b7c9-8243c23c2bca@mail.usf.edu>
	<alpine.LFD.2.20.1611011933030.31503@reclus.nhh.no>
Message-ID: <a47eeb77-35eb-c38d-1e81-76fa848f7927@mail.usf.edu>

On 11/1/2016 1:39 PM, Roger Bivand wrote:
>
> My guess is that the underlying problem was the use of lapply() rather 
> than a for() loop, and not reading the help page for assigning:
>
The function that worked for me is:

filenames <- list.files(pattern="ht.laz.bil")   #Extract list of file 
names from working directory
library(raster) #Calls 'raster' library
#Function 'f1' imports data listed in 'filenames' and assigns projection
f1<-function(x,z) {
         y <- raster(x)
         projection(y) <- CRS(z)
         return(y)
}

It uses your suggestion and also deals with my problem of trying to 
refer to the raster objects, not the names of the objects.

John


-- 
Men occasionally stumble
over the truth, but most of them
pick themselves up and hurry off
as if nothing had happened.
-- Winston Churchill


From dw2116 at outlook.com  Tue Nov  1 21:54:24 2016
From: dw2116 at outlook.com (David Wang)
Date: Tue, 1 Nov 2016 20:54:24 +0000
Subject: [R-sig-Geo] Add layers to a lattice plot via a for loop
Message-ID: <DM5PR11MB1593B82DF42BED709B7867A3CBA10@DM5PR11MB1593.namprd11.prod.outlook.com>

Hello,


I need to overlay a set of tracks (SpatialPoints objects) on a map and thought I would add them one by one to a lattice plot of coastline. However, when I did


p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
for (k in seq_along(tracks))
  p <- p + layer(sp.points(tracks[[k]], pch = 20, col = k))
p

(where coast is the coastline as a SpatialLines object, and tracks is a list of SpatialPoints objects), p only shows the coastline and the last track. What's perplexing to me is that when I explicitly added layers without using a for loop, the result trellis object p does contain all four tracks in their specific colors:




p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
p <- p + layer(sp.points(tracks[[1]], pch = 20, col = 1))
p <- p + layer(sp.points(tracks[[2]], pch = 20, col = 2))
p <- p + layer(sp.points(tracks[[3]], pch = 20, col = 3))
p <- p + layer(sp.points(tracks[[4]], pch = 20, col = 4))
p

Does anyone happen to have a clue why the for loop failed to overlay layers?

Thanks,
David

	[[alternative HTML version deleted]]


From janka.vanschoenwinkel at uhasselt.be  Tue Nov  1 22:47:58 2016
From: janka.vanschoenwinkel at uhasselt.be (Janka VANSCHOENWINKEL)
Date: Tue, 1 Nov 2016 22:47:58 +0100
Subject: [R-sig-Geo] Self-intersection error when using intersect with
	two shapefiles
In-Reply-To: <AM4PR05MB14598A40FEE4EE1EC110264C99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>
References: <CAHymutJ3A-PAg4_QjtF0guPNydSp7xb1=T4H-M1VT0vApaWD3Q@mail.gmail.com>
	<AM4PR05MB1459B3CDB91C2A9EFD9493BF99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>
	<CAHymutLTo8J=rE-knqQDyb=TiUy-iZHMw3s0==LMiVkBtRTabA@mail.gmail.com>
	<AM4PR05MB1459920472CDB2683EA3AC0599A10@AM4PR05MB1459.eurprd05.prod.outlook.com>
	<AM4PR05MB14598A40FEE4EE1EC110264C99A10@AM4PR05MB1459.eurprd05.prod.outlook.com>
Message-ID: <CAHymut+2gU1ppbSf4WNYkp9eE+x68BJwbpovs7vB68AHGr=ssA@mail.gmail.com>

Dear Remi,

Awesome!

I first got the following error: "identicalCRS(x,y) is not TRUE"

I therefore added a projection change with the following code: grid <-
spTransform(grid, CRSobj = CRS(proj4string(nuts)))

That did the job!

Thank you very much for the effort to write a small example code. That made
a huge difference!

Janka

2016-11-01 15:47 GMT+01:00 DAnnunzio, Remi (FOA) <Remi.DAnnunzio at fao.org>:

> This below may do what you are looking for, to be adapted
>
> # Select only the elements of grid that intersect nuts
> grid_nuts <- grid[nuts,]
>
> # Count the number of elements from grid_nuts that fall within each zone
> of nuts
> nuts at data$count_grid <- unlist(over(x =nuts ,y=grid_nuts[,"ID"],fn="
> length"))
>
> # Compute the average of the value CODE of elements from grid_nuts that
> fall within each zone of nuts
> nuts at data$mean_grid <-  unlist(over(x =nuts ,y=grid_nuts[,"CODE"],fn="
> mean"))
>
> # Export
> writeOGR(obj=nuts,dsn="nuts_grid.shp",layer="nuts_grid",driver="ESRI
> Shapefile",overwrite_layer = T)
>
>
> *R?mi d'Annunzio*
> Remote sensing and GIS - Forestry Department
> UN-FAO
> *Phone:*  +44 7 94 64 35 698
> *Email: *   remi.dannunzio at fao.org
> *Skype:*   rdannunzio
>
>
>
> ------------------------------
> *From:* R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of
> DAnnunzio, Remi (FOA) <Remi.DAnnunzio at fao.org>
> *Sent:* 01 November 2016 14:16
> *To:* Janka VANSCHOENWINKEL
> *Cc:* r-sig-geo at r-project.org
> *Subject:* Re: [R-sig-Geo] Self-intersection error when using intersect
> with two shapefiles
>
> Dear Janka,
>
> Then if you have two vector based layers, use the over() function
>
> Run    vignette("over")       for detailed explanations
>
>
> Best
>
> Remi
>
> PS : for info, the http://biogeo.ucdavis.edu/ that hosts the datasets
> from getData() is often down these days. expect issues...
> Ecology, Geography, and Agriculture - Biogeographic Research
> <http://biogeo.ucdavis.edu/>
> biogeo.ucdavis.edu
> Ecology, Geography, and Agriculture? We use quantitative methods to study
> crop ecology, agricultural biodiversity, and agricultural development and
> their effects on ...
>
>
>
> R?mi d'Annunzio
> Remote sensing and GIS - Forestry Department
> UN-FAO
> Phone:  +44 7 94 64 35 698
> Email:    remi.dannunzio at fao.org
> Skype:   rdannunzio
>
>
>
> ________________________________
> From: Janka VANSCHOENWINKEL <janka.vanschoenwinkel at uhasselt.be>
> Sent: 01 November 2016 14:07
> To: DAnnunzio, Remi (FOA)
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Self-intersection error when using intersect with
> two shapefiles
>
> Dear Remi,
>
> Thank you very much for your reply.
>
> Unfortunately, the first solution does not do it for me. I have two
> shapefiles. One of them contains raster-style data but they are saved as a
> shapefile. So I want to overlap two shapefiles. The extract function only
> works with a real raster and a shapefile if I understand it correctly. I
> tried it, and it didn't work.
>
> For the second solution: I have never heard of this and I will have a
> thorough look at it.
>
> Janka
>
> 2016-11-01 10:54 GMT+01:00 DAnnunzio, Remi (FOA) <Remi.DAnnunzio at fao.org<
> mailto:Remi.DAnnunzio at fao.org>>:
>
> Dear Janka
>
>
>
> 1/ I would suggest to make things simpler, i.e use the original raster
> data directly with the shapefile  you want to get your values from and use
> the extract() function. See post here http://stackoverflow.com/
> questions/22333473/how-do-i-extract-raster-values-from-
> polygon-data-then-join-into-spatial-data-fra
>
> <http://stackoverflow.com/questions/22333473/how-do-i-extract-raster-values-from-polygon-data-then-join-into-spatial-data-fra>
> How do I extract raster values from polygon data then join ...
> <http://stackoverflow.com/questions/22333473/how-do-i-extract-raster-values-from-polygon-data-then-join-into-spatial-data-fra>
> stackoverflow.com
> I would like to merge polygon data and raster data into one dataframe for
> purposes of then using randomForests package in R. This involves first
> extracting the mean ...
>
>
>
> 2/ it seems like you do have a geometry issue at the mentioned point in
> your NUTS3 shapefile. Maybe you should correct it in your favorite GIS
> environment, or get a better dataset with more detailed boundaries (e.g
> www.gadm.org<http://www.gadm.org>). You can also access the GADM data
> directly in R with the getData() function. See here for example
> http://www.gis-blog.com/r-raster-data-acquisition/.
> Global Administrative Areas | Boundaries without limits
> <http://www.gadm.org/>
> www.gadm.org
> GADM is a spatial database of the location of the world's administrative
> areas (or adminstrative boundaries) for use in GIS and similar software.
> <http://www.gis-blog.com/r-raster-data-acquisition/>
> R raster: getData SRTM, WorldClim, GADM | GIS-Blog.com
> <http://www.gis-blog.com/r-raster-data-acquisition/>
> www.gis-blog.com
> Hey! Today I will show how powerful the R {raster} package is on another
> example. The raster package is not only a great tool for raster processing
> and calculation ...
>
>
>
> Hope it helps
>
> R?mi
>
>
> R?mi d'Annunzio
> Remote sensing and GIS - Forestry Department
> UN-FAO
> Phone:  +44 7 94 64 35 698
> Email:    remi.dannunzio at fao.org<mailto:remi.dannunzio at fao.org>
> Skype:   rdannunzio
>
>
>
> ________________________________
> From: R-sig-Geo <r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces@
> r-project.org>> on behalf of Janka VANSCHOENWINKEL <janka.vanschoenwinkel@
> uhasselt.be<mailto:janka.vanschoenwinkel at uhasselt.be>>
> Sent: 01 November 2016 09:24
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
>
> Subject: [R-sig-Geo] Self-intersection error when using intersect with two
> shapefiles
>
> Dear colleagues,
>
> I am trying to "translate" worldwide raster data to European nuts3
> polygons. That means I try to overlap two shapefiles to find the
> average value on nuts3 level (based on the worldwide raster data).
>
> Unfortunately, when I use the intersect function, I get the following
> error:
>
>  >>>> new_spdf <- intersect(grid,nuts)
> Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id, drop_lower_td,
> unaryUnion_if_byid_false,  : TopologyException: Input geom 1 is
> invalid: Self-intersection at or near point 13.3081265
> 48.608032999999999 at 13.3081265 48.608032999999999
>
> The full code can be found below. I have used it before with other
> shapefiles and it worked. With the new shapefiles that I am using now,
> I get the above error. I think it might be a projection problem but I
> have not a lot of experience with this.
>
> Your help is appreciated a lot! Thanks in advance!
>
> Janka
>
>
> **Below you can find the full code + data + session info**
>
>     ### download the files available through this link:
>     # https://drive.google.com/open?id=0By9u5m3kxn9yUy1xVDF2NV9TajA
>
>     > library(rgdal)
>     > nuts <- readOGR(".", layer = "NUTS_RG_60M_2010")
>     OGR data source with driver: ESRI Shapefile
>     Source: ".", layer: "NUTS_RG_60M_2010"
>     with 1920 features
>     It has 4 fields
>     > grid <- readOGR(".", layer = "a3_mean_annual_runoff_1950_2000")
>     OGR data source with driver: ESRI Shapefile
>     Source: ".", layer: "a3_mean_annual_runoff_1950_2000"
>     with 41553 features
>     It has 2 fields
>     > summary(nuts)
>     Object of class SpatialPolygonsDataFrame
>     Coordinates:
>             min      max
>     x -61.74369 55.83663
>     y -21.37656 71.17308
>     Is projected: FALSE
>     proj4string : [+proj=longlat +ellps=GRS80 +no_defs]
>     Data attributes:
>         NUTS_ID       STAT_LEVL_     SHAPE_Leng         SHAPE_Area
>      AT     :   1   Min.   :0.00   Min.   :  0.1326   Min.   : 0.00057
>      AT1    :   1   1st Qu.:3.00   1st Qu.:  1.6480   1st Qu.: 0.11795
>      AT11   :   1   Median :3.00   Median :  2.9772   Median : 0.35707
>      AT111  :   1   Mean   :2.66   Mean   :  5.1573   Mean   : 1.56752
>      AT112  :   1   3rd Qu.:3.00   3rd Qu.:  5.3525   3rd Qu.: 0.97955
>      AT113  :   1   Max.   :3.00   Max.   :132.3810   Max.   :81.09899
>      (Other):1914
>     > summary(grid)
>     Object of class SpatialPolygonsDataFrame
>     Coordinates:
>        min   max
>     x -180 180.0
>     y  -55  83.5
>     Is projected: FALSE
>     proj4string :
>     [+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
>     Data attributes:
>            ID             CODE
>      Min.   :    1   Min.   :   0.0
>      1st Qu.:10389   1st Qu.: 118.6
>      Median :20777   Median : 260.0
>      Mean   :20777   Mean   : 432.1
>      3rd Qu.:31165   3rd Qu.: 528.8
>      Max.   :41553   Max.   :6854.2
>     grid <- spTransform(grid, CRSobj = CRS(proj4string(nuts)))
>     > new_spdf <- intersect(grid,nuts)
>     Error in RGEOSBinTopoFunc(spgeom1, spgeom2, byid, id,
> drop_lower_td, unaryUnion_if_byid_false,  :
>       TopologyException: Input geom 1 is invalid: Self-intersection at
> or near point 13.3081265 48.608032999999999 at 13.3081265
> 48.608032999999999
>
> grid_nuts <- gIntersects(new_spdf,nuts,byid = TRUE)
> #Take all the values in a particular NUTS polygon, multiply by each
> the areas of the
> #corresponding new grid cells then divide by the total area of the NUTS
> polygon
>
> #Added the if statement to avoid non-overlapping NUTS polygons
>
> for(i in 1:length(nuts)){
>   if(any(grid_nuts[i,])){
>     nuts at data$average_spatial_value[i] <-
> mean(new_spdf at data$value[grid_nuts[i,]]*
>
> gArea(new_spdf[grid_nuts[i,],])/
>                                                  gArea(nuts[i,]))
>   } else {
>     nuts at data$average_spatial_value[i] <- NA
>   }
>
> }
>
>
>
> > sessionInfo() # one of the things I tried to solve the above problem is
> to install the latest R versions
>
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgeos_0.3-21 raster_2.5-8 rgdal_1.1-10 sp_1.2-3
>
> loaded via a namespace (and not attached):
> [1] tools_3.3.1     Rcpp_0.12.7     grid_3.3.1      lattice_0.20-33
>
>
> P.S. I also posted the question on
> http://gis.stackexchange.com/questions/216095/r-self-
> intersection-error-when-using-intersect-with-two-shapefiles
>
> <http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
> R: Self-intersection error when using intersect with two shapefiles
> <http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
> gis.stackexchange.com
> I am trying to "translate" worldwide raster data to European nuts3
> polygons. That means I try to overlap two shapefiles to find the average
> value on nuts3 level. Unfortunately, when I use the inte...
>
> [http://cdn.sstatic.net/Sites/gis/img/apple-touch-icon at 2.
> png?v=54e3ab1edcf3&a]<http://gis.stackexchange.com/
> questions/216095/r-self-intersection-error-when-using-
> intersect-with-two-shapefiles>
>
> R: Self-intersection error when using intersect with two shapefiles<
> http://gis.stackexchange.com/questions/216095/r-self-intersection-
> error-when-using-intersect-with-two-shapefiles>
>
> <http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
> R: Self-intersection error when using intersect with two shapefiles
> <http://gis.stackexchange.com/questions/216095/r-self-intersection-error-when-using-intersect-with-two-shapefiles>
> gis.stackexchange.com
> I am trying to "translate" worldwide raster data to European nuts3
> polygons. That means I try to overlap two shapefiles to find the average
> value on nuts3 level. Unfortunately, when I use the inte...
>
> gis.stackexchange.com<http://gis.stackexchange.com>
> I am trying to "translate" worldwide raster data to European nuts3
> polygons. That means I try to overlap two shapefiles to find the average
> value on nuts3 level. Unfortunately, when I use the inte...
>
>
> with no response yet.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org<mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> R-sig-Geo Info Page <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> stat.ethz.ch
> R-sig-Geo -- R Special Interest Group on using Geographical data and
> Mapping About R-sig-Geo
>
> R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> R-sig-Geo Info Page <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
> stat.ethz.ch
> R-sig-Geo -- R Special Interest Group on using Geographical data and
> Mapping About R-sig-Geo
>
> stat.ethz.ch<http://stat.ethz.ch>
> R-sig-Geo -- R Special Interest Group on using Geographical data and
> Mapping About R-sig-Geo
>
>
>
>
>
> --
>
> [Logo UHasselt] Mevrouw Janka Vanschoenwinkel
> Doctoraatsbursaal - PhD
> Milieueconomie - Environmental economics
>
> T +32(0)11 26 86 96 | GSM +32(0)476 28 21 40
>
> www.uhasselt.be/eec<http://www.uhasselt.be/eec>
>
> Universiteit Hasselt | Campus Diepenbeek
> Agoralaan Gebouw D | B-3590 Diepenbeek
> Kantoor F11
>
> Postadres: Universiteit Hasselt | Martelarenlaan 42 | B-3500 Hasselt
>
>
> [Music For Life]  Maak van UHasselt de #warmsteunief |
> www.uhasselt.be/musicforlife<http://www.uhasselt.be/musicforlife
> <http://www.uhasselt.be/musicforlife%3Chttp://www.uhasselt.be/musicforlife>
> >
>
>
>
> P Please consider the environment before printing this e-mail
>
>
>         [[alternative HTML version deleted]]
>
>


-- 

[image: Logo UHasselt] Mevrouw Janka Vanschoenwinkel
*Doctoraatsbursaal - PhD *
Milieueconomie - Environmental economics

T +32(0)11 26 86 96 | GSM +32(0)476 28 21 40

www.uhasselt.be/eec

Universiteit Hasselt | Campus Diepenbeek
Agoralaan Gebouw D | B-3590 Diepenbeek
Kantoor F11

Postadres: Universiteit Hasselt | Martelarenlaan 42 | B-3500 Hasselt


[image: Music For Life]  Maak van UHasselt de #warmsteunief |
www.uhasselt.be/musicforlife


P Please consider the environment before printing this e-mail

	[[alternative HTML version deleted]]


From bfalevlist at gmail.com  Tue Nov  1 23:02:59 2016
From: bfalevlist at gmail.com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Tue, 1 Nov 2016 23:02:59 +0100
Subject: [R-sig-Geo] Add layers to a lattice plot via a for loop
In-Reply-To: <DM5PR11MB1593B82DF42BED709B7867A3CBA10@DM5PR11MB1593.namprd11.prod.outlook.com>
References: <DM5PR11MB1593B82DF42BED709B7867A3CBA10@DM5PR11MB1593.namprd11.prod.outlook.com>
Message-ID: <babe2e81-62cc-ddfd-2453-a80c618751a7@gmail.com>

Dear David,

since you have not provided us a reproductable script+dataset, I can't 
check whether my suggestion is connected to your problem. Maybe not... 
Anyway, lattice plotter functions - such as spplot() and its relatives 
-  inside for loops, functions, and tryCatch() blocks usually work in a 
different way than their line-by-line versions. Using print(spplot()) 
instead of spplot() can solve the problem.

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2016.11.01. 21:54 keltez?ssel, David Wang ?rta:
> Hello,
>
>
> I need to overlay a set of tracks (SpatialPoints objects) on a map and thought I would add them one by one to a lattice plot of coastline. However, when I did
>
>
> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
> for (k in seq_along(tracks))
>    p <- p + layer(sp.points(tracks[[k]], pch = 20, col = k))
> p
>
> (where coast is the coastline as a SpatialLines object, and tracks is a list of SpatialPoints objects), p only shows the coastline and the last track. What's perplexing to me is that when I explicitly added layers without using a for loop, the result trellis object p does contain all four tracks in their specific colors:
>
>
>
>
> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
> p <- p + layer(sp.points(tracks[[1]], pch = 20, col = 1))
> p <- p + layer(sp.points(tracks[[2]], pch = 20, col = 2))
> p <- p + layer(sp.points(tracks[[3]], pch = 20, col = 3))
> p <- p + layer(sp.points(tracks[[4]], pch = 20, col = 4))
> p
>
> Does anyone happen to have a clue why the for loop failed to overlay layers?
>
> Thanks,
> David
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mozafar.veysipanah at malmo.se  Wed Nov  2 08:30:08 2016
From: mozafar.veysipanah at malmo.se (Mozafar Veysipanah)
Date: Wed, 2 Nov 2016 07:30:08 +0000
Subject: [R-sig-Geo] Finish to be in List
Message-ID: <992be489a6d443e98fb0db771720e5c9@SRVWINXMBXINT02.intra.malmo.se>

Hello Sir or Madam!

I am wondering how can I exit from the list of automatisk e-mail. Coyuld you please let me know how can I cancel getting e-mail?

Best /Mozafar

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Wed Nov  2 08:50:30 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 2 Nov 2016 08:50:30 +0100
Subject: [R-sig-Geo] Finish to be in List
In-Reply-To: <992be489a6d443e98fb0db771720e5c9@SRVWINXMBXINT02.intra.malmo.se>
References: <992be489a6d443e98fb0db771720e5c9@SRVWINXMBXINT02.intra.malmo.se>
Message-ID: <alpine.LFD.2.20.1611020849190.6726@reclus.nhh.no>

On Wed, 2 Nov 2016, Mozafar Veysipanah wrote:

> Hello Sir or Madam!
>
> I am wondering how can I exit from the list of automatisk e-mail. Coyuld 
> you please let me know how can I cancel getting e-mail?

As the footer in all list posts indicates, go to:

https://stat.ethz.ch/mailman/listinfo/r-sig-geo

and unsubscribe there.

>
> Best /Mozafar
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From dw2116 at outlook.com  Wed Nov  2 14:52:39 2016
From: dw2116 at outlook.com (David Wang)
Date: Wed, 2 Nov 2016 13:52:39 +0000
Subject: [R-sig-Geo] Add layers to a lattice plot via a for loop
In-Reply-To: <babe2e81-62cc-ddfd-2453-a80c618751a7@gmail.com>
References: <DM5PR11MB1593B82DF42BED709B7867A3CBA10@DM5PR11MB1593.namprd11.prod.outlook.com>,
	<babe2e81-62cc-ddfd-2453-a80c618751a7@gmail.com>
Message-ID: <MWHPR11MB1599B5BF0CEA243ED12A2696CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>

Hello ?kos,


Thank you for your suggestion. I'm not sure that solves the problem. But here is a reproducible example:


library(maps)
library(maptools)
library(sp)
coast <- map(fill = TRUE, plot = FALSE)
coast <- map2SpatialLines(coast)
tracks <- list(SpatialPoints(cbind(c(90, 90), c(-20, 20))),
               SpatialPoints(cbind(c(-90, -90), c(-20, 20))))

p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
p <- p + layer(sp.points(tracks[[1]], pch = 19, col = 1))
p <- p + layer(sp.points(tracks[[2]], pch = 19, col = 2))
print(p) # this shows both tracks

p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
for (k in seq_along(tracks))
  p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k))
print(p) # this shows the second (red) track only

Thanks,

David

________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Bede-Fazekas ?kos <bfalevlist at gmail.com>
Sent: Tuesday, November 1, 2016 6:02:59 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop

Dear David,

since you have not provided us a reproductable script+dataset, I can't
check whether my suggestion is connected to your problem. Maybe not...
Anyway, lattice plotter functions - such as spplot() and its relatives
-  inside for loops, functions, and tryCatch() blocks usually work in a
different way than their line-by-line versions. Using print(spplot())
instead of spplot() can solve the problem.

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2016.11.01. 21:54 keltez?ssel, David Wang ?rta:
> Hello,
>
>
> I need to overlay a set of tracks (SpatialPoints objects) on a map and thought I would add them one by one to a lattice plot of coastline. However, when I did
>
>
> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
> for (k in seq_along(tracks))
>    p <- p + layer(sp.points(tracks[[k]], pch = 20, col = k))
> p
>
> (where coast is the coastline as a SpatialLines object, and tracks is a list of SpatialPoints objects), p only shows the coastline and the last track. What's perplexing to me is that when I explicitly added layers without using a for loop, the result trellis object p does contain all four tracks in their specific colors:
>
>
>
>
> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
> p <- p + layer(sp.points(tracks[[1]], pch = 20, col = 1))
> p <- p + layer(sp.points(tracks[[2]], pch = 20, col = 2))
> p <- p + layer(sp.points(tracks[[3]], pch = 20, col = 3))
> p <- p + layer(sp.points(tracks[[4]], pch = 20, col = 4))
> p
>
> Does anyone happen to have a clue why the for loop failed to overlay layers?
>
> Thanks,
> David
>
>        [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Wed Nov  2 15:33:31 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 2 Nov 2016 15:33:31 +0100
Subject: [R-sig-Geo] Add layers to a lattice plot via a for loop
In-Reply-To: <MWHPR11MB1599B5BF0CEA243ED12A2696CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>
References: <DM5PR11MB1593B82DF42BED709B7867A3CBA10@DM5PR11MB1593.namprd11.prod.outlook.com>
	<babe2e81-62cc-ddfd-2453-a80c618751a7@gmail.com>
	<MWHPR11MB1599B5BF0CEA243ED12A2696CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>
Message-ID: <9ba4587f-3de4-3b72-045e-3c165ca0693d@uni-muenster.de>



On 02/11/16 14:52, David Wang wrote:
> Hello ?kos,
> 
> 
> Thank you for your suggestion. I'm not sure that solves the problem. But here is a reproducible example:
> 
> 
> library(maps)
> library(maptools)
> library(sp)
> coast <- map(fill = TRUE, plot = FALSE)
> coast <- map2SpatialLines(coast)
> tracks <- list(SpatialPoints(cbind(c(90, 90), c(-20, 20))),
>                SpatialPoints(cbind(c(-90, -90), c(-20, 20))))
> 
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)

Trying to reproduce, here I get:
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
Error in (function (classes, fdef, mtable)  :
  unable to find an inherited method for function ?spplot? for signature
?"SpatialLines"?


> p <- p + layer(sp.points(tracks[[1]], pch = 19, col = 1))
> p <- p + layer(sp.points(tracks[[2]], pch = 19, col = 2))
> print(p) # this shows both tracks
> 
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> for (k in seq_along(tracks))
>   p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k))
> print(p) # this shows the second (red) track only
> 
> Thanks,
> 
> David
> 
> ________________________________
> From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Bede-Fazekas ?kos <bfalevlist at gmail.com>
> Sent: Tuesday, November 1, 2016 6:02:59 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop
> 
> Dear David,
> 
> since you have not provided us a reproductable script+dataset, I can't
> check whether my suggestion is connected to your problem. Maybe not...
> Anyway, lattice plotter functions - such as spplot() and its relatives
> -  inside for loops, functions, and tryCatch() blocks usually work in a
> different way than their line-by-line versions. Using print(spplot())
> instead of spplot() can solve the problem.
> 
> HTH,
> ?kos Bede-Fazekas
> Hungarian Academy of Sciences
> 
> 2016.11.01. 21:54 keltez?ssel, David Wang ?rta:
>> Hello,
>>
>>
>> I need to overlay a set of tracks (SpatialPoints objects) on a map and thought I would add them one by one to a lattice plot of coastline. However, when I did
>>
>>
>> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
>> for (k in seq_along(tracks))
>>    p <- p + layer(sp.points(tracks[[k]], pch = 20, col = k))
>> p
>>
>> (where coast is the coastline as a SpatialLines object, and tracks is a list of SpatialPoints objects), p only shows the coastline and the last track. What's perplexing to me is that when I explicitly added layers without using a for loop, the result trellis object p does contain all four tracks in their specific colors:
>>
>>
>>
>>
>> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
>> p <- p + layer(sp.points(tracks[[1]], pch = 20, col = 1))
>> p <- p + layer(sp.points(tracks[[2]], pch = 20, col = 2))
>> p <- p + layer(sp.points(tracks[[3]], pch = 20, col = 3))
>> p <- p + layer(sp.points(tracks[[4]], pch = 20, col = 4))
>> p
>>
>> Does anyone happen to have a clue why the for loop failed to overlay layers?
>>
>> Thanks,
>> David
>>
>>        [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161102/27f199d5/attachment.bin>

From dw2116 at outlook.com  Wed Nov  2 15:54:40 2016
From: dw2116 at outlook.com (David Wang)
Date: Wed, 2 Nov 2016 14:54:40 +0000
Subject: [R-sig-Geo] Add layers to a lattice plot via a for loop
In-Reply-To: <9ba4587f-3de4-3b72-045e-3c165ca0693d@uni-muenster.de>
References: <DM5PR11MB1593B82DF42BED709B7867A3CBA10@DM5PR11MB1593.namprd11.prod.outlook.com>
	<babe2e81-62cc-ddfd-2453-a80c618751a7@gmail.com>
	<MWHPR11MB1599B5BF0CEA243ED12A2696CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>,
	<9ba4587f-3de4-3b72-045e-3c165ca0693d@uni-muenster.de>
Message-ID: <MWHPR11MB1599D569E3A1283F83A0DDC5CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>

Oops, I didn't run the example in a clean, new session. Here is that an update that should work:


library(maps)
library(maptools)
library(sp)
library(latticeExtra)

coast <- map(fill = TRUE, plot = FALSE)
coast <- map2SpatialLines(coast)
coast <- SpatialLinesDataFrame(coast, data.frame(z = seq_len(length(coast))))
tracks <- list(SpatialPoints(cbind(c(90, 90), c(-20, 20))),
               SpatialPoints(cbind(c(-90, -90), c(-20, 20))))

p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
p <- p + layer(sp.points(tracks[[1]], pch = 19, col = 1))
p <- p + layer(sp.points(tracks[[2]], pch = 19, col = 2))
print(p) # shows both tracks

p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
for (k in seq_along(tracks))
  p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k))
print(p) # shows the second (red) track only

The R environment is:

> sessionInfo()
R version 3.3.1 (2016-06-21)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

Thanks,

D

________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Edzer Pebesma <edzer.pebesma at uni-muenster.de>
Sent: Wednesday, November 2, 2016 10:33:31 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop



On 02/11/16 14:52, David Wang wrote:
> Hello ?kos,
>
>
> Thank you for your suggestion. I'm not sure that solves the problem. But here is a reproducible example:
>
>
> library(maps)
> library(maptools)
> library(sp)
> coast <- map(fill = TRUE, plot = FALSE)
> coast <- map2SpatialLines(coast)
> tracks <- list(SpatialPoints(cbind(c(90, 90), c(-20, 20))),
>                SpatialPoints(cbind(c(-90, -90), c(-20, 20))))
>
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)

Trying to reproduce, here I get:
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
Error in (function (classes, fdef, mtable)  :
  unable to find an inherited method for function ?spplot? for signature
?"SpatialLines"?


> p <- p + layer(sp.points(tracks[[1]], pch = 19, col = 1))
> p <- p + layer(sp.points(tracks[[2]], pch = 19, col = 2))
> print(p) # this shows both tracks
>
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> for (k in seq_along(tracks))
>   p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k))
> print(p) # this shows the second (red) track only
>
> Thanks,
>
> David
>
> ________________________________
> From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Bede-Fazekas ?kos <bfalevlist at gmail.com>
> Sent: Tuesday, November 1, 2016 6:02:59 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop
>
> Dear David,
>
> since you have not provided us a reproductable script+dataset, I can't
> check whether my suggestion is connected to your problem. Maybe not...
> Anyway, lattice plotter functions - such as spplot() and its relatives
> -  inside for loops, functions, and tryCatch() blocks usually work in a
> different way than their line-by-line versions. Using print(spplot())
> instead of spplot() can solve the problem.
>
> HTH,
> ?kos Bede-Fazekas
> Hungarian Academy of Sciences
>
> 2016.11.01. 21:54 keltez?ssel, David Wang ?rta:
>> Hello,
>>
>>
>> I need to overlay a set of tracks (SpatialPoints objects) on a map and thought I would add them one by one to a lattice plot of coastline. However, when I did
>>
>>
>> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
>> for (k in seq_along(tracks))
>>    p <- p + layer(sp.points(tracks[[k]], pch = 20, col = k))
>> p
>>
>> (where coast is the coastline as a SpatialLines object, and tracks is a list of SpatialPoints objects), p only shows the coastline and the last track. What's perplexing to me is that when I explicitly added layers without using a for loop, the result trellis object p does contain all four tracks in their specific colors:
>>
>>
>>
>>
>> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
>> p <- p + layer(sp.points(tracks[[1]], pch = 20, col = 1))
>> p <- p + layer(sp.points(tracks[[2]], pch = 20, col = 2))
>> p <- p + layer(sp.points(tracks[[3]], pch = 20, col = 3))
>> p <- p + layer(sp.points(tracks[[4]], pch = 20, col = 4))
>> p
>>
>> Does anyone happen to have a clue why the for loop failed to overlay layers?
>>
>> Thanks,
>> David
>>
>>        [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>        [[alternative HTML version deleted]]
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/


	[[alternative HTML version deleted]]


From florian.detsch at staff.uni-marburg.de  Wed Nov  2 16:17:44 2016
From: florian.detsch at staff.uni-marburg.de (Florian Detsch)
Date: Wed, 2 Nov 2016 16:17:44 +0100
Subject: [R-sig-Geo] Add layers to a lattice plot via a for loop
In-Reply-To: <MWHPR11MB1599D569E3A1283F83A0DDC5CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>
References: <DM5PR11MB1593B82DF42BED709B7867A3CBA10@DM5PR11MB1593.namprd11.prod.outlook.com>
	<babe2e81-62cc-ddfd-2453-a80c618751a7@gmail.com>
	<MWHPR11MB1599B5BF0CEA243ED12A2696CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>
	<9ba4587f-3de4-3b72-045e-3c165ca0693d@uni-muenster.de>
	<MWHPR11MB1599D569E3A1283F83A0DDC5CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>
Message-ID: <81fef649-9890-c0bc-9e24-d3960d8270c1@staff.uni-marburg.de>

David,

the problem is related to latticeExtra::layer() rather than spplot(). I 
faced this issue a while ago, and back then, Oscar Perpi??n Lamigueiro 
pointed me towards the help pages of ?latticeExtra::layer, which says:

       Note that the evaluation used in ?layer? is non-standard, and can
       be confusing at first: you typically refer to variables as if
       inside the panel function (?x?, ?y?, etc); you can usually refer
       to objects which exist in the global environment (workspace), but
       it is safer to pass them in by name in the ?data? argument to
       ?layer?. (And this should not to be confused with the ?data?
       argument to the original ?xyplot?.)

To cut a long story short, you are simply required to explicitly add a 
'data' argument (including the loop variable) to layer():

p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
for (k in seq_along(tracks))
   p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k),
                  data = list(k = k))
print(p)

Hope that helps,
Florian


On 02.11.2016 15:54, David Wang wrote:
> Oops, I didn't run the example in a clean, new session. Here is that an update that should work:
>
>
> library(maps)
> library(maptools)
> library(sp)
> library(latticeExtra)
>
> coast <- map(fill = TRUE, plot = FALSE)
> coast <- map2SpatialLines(coast)
> coast <- SpatialLinesDataFrame(coast, data.frame(z = seq_len(length(coast))))
> tracks <- list(SpatialPoints(cbind(c(90, 90), c(-20, 20))),
>                 SpatialPoints(cbind(c(-90, -90), c(-20, 20))))
>
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> p <- p + layer(sp.points(tracks[[1]], pch = 19, col = 1))
> p <- p + layer(sp.points(tracks[[2]], pch = 19, col = 2))
> print(p) # shows both tracks
>
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> for (k in seq_along(tracks))
>    p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k))
> print(p) # shows the second (red) track only
>
> The R environment is:
>
>> sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
>
> Thanks,
>
> D
>
> ________________________________
> From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> Sent: Wednesday, November 2, 2016 10:33:31 AM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop
>
>
>
> On 02/11/16 14:52, David Wang wrote:
>> Hello ?kos,
>>
>>
>> Thank you for your suggestion. I'm not sure that solves the problem. But here is a reproducible example:
>>
>>
>> library(maps)
>> library(maptools)
>> library(sp)
>> coast <- map(fill = TRUE, plot = FALSE)
>> coast <- map2SpatialLines(coast)
>> tracks <- list(SpatialPoints(cbind(c(90, 90), c(-20, 20))),
>>                 SpatialPoints(cbind(c(-90, -90), c(-20, 20))))
>>
>> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> Trying to reproduce, here I get:
>> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> Error in (function (classes, fdef, mtable)  :
>    unable to find an inherited method for function ?spplot? for signature
> ?"SpatialLines"?
>
>
>> p <- p + layer(sp.points(tracks[[1]], pch = 19, col = 1))
>> p <- p + layer(sp.points(tracks[[2]], pch = 19, col = 2))
>> print(p) # this shows both tracks
>>
>> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
>> for (k in seq_along(tracks))
>>    p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k))
>> print(p) # this shows the second (red) track only
>>
>> Thanks,
>>
>> David
>>
>> ________________________________
>> From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Bede-Fazekas ?kos <bfalevlist at gmail.com>
>> Sent: Tuesday, November 1, 2016 6:02:59 PM
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop
>>
>> Dear David,
>>
>> since you have not provided us a reproductable script+dataset, I can't
>> check whether my suggestion is connected to your problem. Maybe not...
>> Anyway, lattice plotter functions - such as spplot() and its relatives
>> -  inside for loops, functions, and tryCatch() blocks usually work in a
>> different way than their line-by-line versions. Using print(spplot())
>> instead of spplot() can solve the problem.
>>
>> HTH,
>> ?kos Bede-Fazekas
>> Hungarian Academy of Sciences
>>
>> 2016.11.01. 21:54 keltez?ssel, David Wang ?rta:
>>> Hello,
>>>
>>>
>>> I need to overlay a set of tracks (SpatialPoints objects) on a map and thought I would add them one by one to a lattice plot of coastline. However, when I did
>>>
>>>
>>> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
>>> for (k in seq_along(tracks))
>>>     p <- p + layer(sp.points(tracks[[k]], pch = 20, col = k))
>>> p
>>>
>>> (where coast is the coastline as a SpatialLines object, and tracks is a list of SpatialPoints objects), p only shows the coastline and the last track. What's perplexing to me is that when I explicitly added layers without using a for loop, the result trellis object p does contain all four tracks in their specific colors:
>>>
>>>
>>>
>>>
>>> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
>>> p <- p + layer(sp.points(tracks[[1]], pch = 20, col = 1))
>>> p <- p + layer(sp.points(tracks[[2]], pch = 20, col = 2))
>>> p <- p + layer(sp.points(tracks[[3]], pch = 20, col = 3))
>>> p <- p + layer(sp.points(tracks[[4]], pch = 20, col = 4))
>>> p
>>>
>>> Does anyone happen to have a clue why the for loop failed to overlay layers?
>>>
>>> Thanks,
>>> David
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>         [[alternative HTML version deleted]]
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Florian Detsch (M.Sc. Physical Geography)
Environmental Informatics
Department of Geography
Philipps-Universit?t Marburg
Deutschhausstra?e 12
35032 (parcel post: 35037) Marburg, Germany

Phone: +49 (0) 6421 28-25323
Web: http://umweltinformatik-marburg.de/en/staff/florian-detsch/


	[[alternative HTML version deleted]]


From dw2116 at outlook.com  Wed Nov  2 19:10:23 2016
From: dw2116 at outlook.com (David Wang)
Date: Wed, 2 Nov 2016 18:10:23 +0000
Subject: [R-sig-Geo] Add layers to a lattice plot via a for loop
In-Reply-To: <81fef649-9890-c0bc-9e24-d3960d8270c1@staff.uni-marburg.de>
References: <DM5PR11MB1593B82DF42BED709B7867A3CBA10@DM5PR11MB1593.namprd11.prod.outlook.com>
	<babe2e81-62cc-ddfd-2453-a80c618751a7@gmail.com>
	<MWHPR11MB1599B5BF0CEA243ED12A2696CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>
	<9ba4587f-3de4-3b72-045e-3c165ca0693d@uni-muenster.de>
	<MWHPR11MB1599D569E3A1283F83A0DDC5CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>,
	<81fef649-9890-c0bc-9e24-d3960d8270c1@staff.uni-marburg.de>
Message-ID: <MWHPR11MB1599B1DCC3D17ABED005B981CBA00@MWHPR11MB1599.namprd11.prod.outlook.com>

Hello Florian,


Excellent! That solves the problem.


Thanks,
D

________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Florian Detsch <florian.detsch at staff.uni-marburg.de>
Sent: Wednesday, November 2, 2016 11:17:44 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop

David,

the problem is related to latticeExtra::layer() rather than spplot(). I
faced this issue a while ago, and back then, Oscar Perpi??n Lamigueiro
pointed me towards the help pages of ?latticeExtra::layer, which says:

       Note that the evaluation used in ?layer? is non-standard, and can
       be confusing at first: you typically refer to variables as if
       inside the panel function (?x?, ?y?, etc); you can usually refer
       to objects which exist in the global environment (workspace), but
       it is safer to pass them in by name in the ?data? argument to
       ?layer?. (And this should not to be confused with the ?data?
       argument to the original ?xyplot?.)

To cut a long story short, you are simply required to explicitly add a
'data' argument (including the loop variable) to layer():

p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
for (k in seq_along(tracks))
   p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k),
                  data = list(k = k))
print(p)

Hope that helps,
Florian


On 02.11.2016 15:54, David Wang wrote:
> Oops, I didn't run the example in a clean, new session. Here is that an update that should work:
>
>
> library(maps)
> library(maptools)
> library(sp)
> library(latticeExtra)
>
> coast <- map(fill = TRUE, plot = FALSE)
> coast <- map2SpatialLines(coast)
> coast <- SpatialLinesDataFrame(coast, data.frame(z = seq_len(length(coast))))
> tracks <- list(SpatialPoints(cbind(c(90, 90), c(-20, 20))),
>                 SpatialPoints(cbind(c(-90, -90), c(-20, 20))))
>
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> p <- p + layer(sp.points(tracks[[1]], pch = 19, col = 1))
> p <- p + layer(sp.points(tracks[[2]], pch = 19, col = 2))
> print(p) # shows both tracks
>
> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> for (k in seq_along(tracks))
>    p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k))
> print(p) # shows the second (red) track only
>
> The R environment is:
>
>> sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
>
> Thanks,
>
> D
>
> ________________________________
> From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Edzer Pebesma <edzer.pebesma at uni-muenster.de>
> Sent: Wednesday, November 2, 2016 10:33:31 AM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop
>
>
>
> On 02/11/16 14:52, David Wang wrote:
>> Hello ?kos,
>>
>>
>> Thank you for your suggestion. I'm not sure that solves the problem. But here is a reproducible example:
>>
>>
>> library(maps)
>> library(maptools)
>> library(sp)
>> coast <- map(fill = TRUE, plot = FALSE)
>> coast <- map2SpatialLines(coast)
>> tracks <- list(SpatialPoints(cbind(c(90, 90), c(-20, 20))),
>>                 SpatialPoints(cbind(c(-90, -90), c(-20, 20))))
>>
>> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> Trying to reproduce, here I get:
>> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
> Error in (function (classes, fdef, mtable)  :
>    unable to find an inherited method for function ?spplot? for signature
> ?"SpatialLines"?
>
>
>> p <- p + layer(sp.points(tracks[[1]], pch = 19, col = 1))
>> p <- p + layer(sp.points(tracks[[2]], pch = 19, col = 2))
>> print(p) # this shows both tracks
>>
>> p <- spplot(coast, col.regions = "darkgray", colorkey = FALSE)
>> for (k in seq_along(tracks))
>>    p <- p + layer(sp.points(tracks[[k]], pch = 19, col = k))
>> print(p) # this shows the second (red) track only
>>
>> Thanks,
>>
>> David
>>
>> ________________________________
>> From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Bede-Fazekas ?kos <bfalevlist at gmail.com>
>> Sent: Tuesday, November 1, 2016 6:02:59 PM
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Add layers to a lattice plot via a for loop
>>
>> Dear David,
>>
>> since you have not provided us a reproductable script+dataset, I can't
>> check whether my suggestion is connected to your problem. Maybe not...
>> Anyway, lattice plotter functions - such as spplot() and its relatives
>> -  inside for loops, functions, and tryCatch() blocks usually work in a
>> different way than their line-by-line versions. Using print(spplot())
>> instead of spplot() can solve the problem.
>>
>> HTH,
>> ?kos Bede-Fazekas
>> Hungarian Academy of Sciences
>>
>> 2016.11.01. 21:54 keltez?ssel, David Wang ?rta:
>>> Hello,
>>>
>>>
>>> I need to overlay a set of tracks (SpatialPoints objects) on a map and thought I would add them one by one to a lattice plot of coastline. However, when I did
>>>
>>>
>>> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
>>> for (k in seq_along(tracks))
>>>     p <- p + layer(sp.points(tracks[[k]], pch = 20, col = k))
>>> p
>>>
>>> (where coast is the coastline as a SpatialLines object, and tracks is a list of SpatialPoints objects), p only shows the coastline and the last track. What's perplexing to me is that when I explicitly added layers without using a for loop, the result trellis object p does contain all four tracks in their specific colors:
>>>
>>>
>>>
>>>
>>> p <- spplot(coast, xlim = xlim, ylim = ylim, col.regions = "darkgray", colorkey = FALSE)
>>> p <- p + layer(sp.points(tracks[[1]], pch = 20, col = 1))
>>> p <- p + layer(sp.points(tracks[[2]], pch = 20, col = 2))
>>> p <- p + layer(sp.points(tracks[[3]], pch = 20, col = 3))
>>> p <- p + layer(sp.points(tracks[[4]], pch = 20, col = 4))
>>> p
>>>
>>> Does anyone happen to have a clue why the for loop failed to overlay layers?
>>>
>>> Thanks,
>>> David
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>         [[alternative HTML version deleted]]
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
>
>        [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Florian Detsch (M.Sc. Physical Geography)
Environmental Informatics
Department of Geography
Philipps-Universit?t Marburg
Deutschhausstra?e 12
35032 (parcel post: 35037) Marburg, Germany

Phone: +49 (0) 6421 28-25323
Web: http://umweltinformatik-marburg.de/en/staff/florian-detsch/


        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From sunil.choudary at mapit.gov.in  Fri Nov  4 12:29:42 2016
From: sunil.choudary at mapit.gov.in (SunilChoudhary)
Date: Fri, 04 Nov 2016 16:59:42 +0530
Subject: [R-sig-Geo] Shape file for Madhya Pradesh State in India with
	Districts
In-Reply-To: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
References: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
Message-ID: <b9320a43-022f-1688-d7fc-01662497f6b7@mapit.gov.in>

Hi Folks

Can someone point me to Shape file for Madhya Pradesh State in India 
preferably with districts.


Thanks
Sunil Choudhary



	[[alternative HTML version deleted]]


From sunil.choudary at mapit.gov.in  Fri Nov  4 12:33:08 2016
From: sunil.choudary at mapit.gov.in (SunilChoudhary)
Date: Fri, 04 Nov 2016 17:03:08 +0530
Subject: [R-sig-Geo] NewBie Question: Splitting shape file in two
In-Reply-To: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
References: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
Message-ID: <b9858d53-5b19-fd6b-b318-191068260021@mapit.gov.in>

I found the shape file for India with States in

https://www.arcgis.com/home/item.html?id=cf9b387de48248a687aafdd4cdff1127

Unfortunately this is outdated  (Andra Pradesh is now divided in two 
parts Telangana and Andra Pradesh)

Can someone

1)  point me to a more recent shape file which contains this change
2) point me how to draw a seperation line (Possibly via QGIS) so we have 
two states in place of 1



	[[alternative HTML version deleted]]


From jacek.stefaniak at gmail.com  Fri Nov  4 12:37:00 2016
From: jacek.stefaniak at gmail.com (Jacek Stefaniak)
Date: Fri, 4 Nov 2016 12:37:00 +0100
Subject: [R-sig-Geo] NewBie Question: Splitting shape file in two
In-Reply-To: <b9858d53-5b19-fd6b-b318-191068260021@mapit.gov.in>
References: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
	<b9858d53-5b19-fd6b-b318-191068260021@mapit.gov.in>
Message-ID: <CAMNc56D=1g2HA014-PKRSm5c_xX4L1ZVsM1+xTzNDgKQi9Sf_A@mail.gmail.com>

https://gis.stackexchange.com/questions/143689/latest-shapefiles-of-indian-states

	[[alternative HTML version deleted]]


From jacek.stefaniak at gmail.com  Fri Nov  4 12:37:48 2016
From: jacek.stefaniak at gmail.com (Jacek Stefaniak)
Date: Fri, 4 Nov 2016 12:37:48 +0100
Subject: [R-sig-Geo] NewBie Question: Splitting shape file in two
In-Reply-To: <CAMNc56D=1g2HA014-PKRSm5c_xX4L1ZVsM1+xTzNDgKQi9Sf_A@mail.gmail.com>
References: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
	<b9858d53-5b19-fd6b-b318-191068260021@mapit.gov.in>
	<CAMNc56D=1g2HA014-PKRSm5c_xX4L1ZVsM1+xTzNDgKQi9Sf_A@mail.gmail.com>
Message-ID: <CAMNc56BmygjnyDum_k-Ht+HqN7oqM6nLwU-ZexZ-pWQx8LijAA@mail.gmail.com>

And:
https://gis.stackexchange.com/questions/111595/shapefile-for-india-which-includes-telangana-state

	[[alternative HTML version deleted]]


From bibiko at shh.mpg.de  Fri Nov  4 12:44:02 2016
From: bibiko at shh.mpg.de (=?utf-8?Q?Hans-J=C3=B6rg_Bibiko?=)
Date: Fri, 4 Nov 2016 12:44:02 +0100
Subject: [R-sig-Geo] NewBie Question: Splitting shape file in two
In-Reply-To: <b9858d53-5b19-fd6b-b318-191068260021@mapit.gov.in>
References: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
	<b9858d53-5b19-fd6b-b318-191068260021@mapit.gov.in>
Message-ID: <289B3BC2-9899-4FC8-BE38-65BE524E7F22@shh.mpg.de>


> On 04 Nov 2016, at 12:33, SunilChoudhary <sunil.choudary at mapit.gov.in> wrote:
> 
> I found the shape file for India with States in
> 
> https://www.arcgis.com/home/item.html?id=cf9b387de48248a687aafdd4cdff1127
> 
> Unfortunately this is outdated  (Andra Pradesh is now divided in two 
> parts Telangana and Andra Pradesh)
> 
> Can someone
> 
> 1)  point me to a more recent shape file which contains this change
> 2) point me how to draw a seperation line (Possibly via QGIS) so we have 
> two states in place of 1

did you look at http://gadm.org ?

-Hans

From adamhsparks at gmail.com  Fri Nov  4 13:41:55 2016
From: adamhsparks at gmail.com (Adam H Sparks)
Date: Fri, 4 Nov 2016 08:41:55 -0400
Subject: [R-sig-Geo] NewBie Question: Splitting shape file in two
In-Reply-To: <289B3BC2-9899-4FC8-BE38-65BE524E7F22@shh.mpg.de>
References: <289B3BC2-9899-4FC8-BE38-65BE524E7F22@shh.mpg.de>
Message-ID: <CAJmQPwEWFFcHAqhi9UjjK2LHtFQsq=utnuwjVE+EqeY=ixbFWw@mail.gmail.com>

And getData() in the raster package, which will get GADM data?

-- 
Adam H Sparks

On 4 November 2016 at 22:44:02, Hans-J?rg Bibiko (bibiko at shh.mpg.de) wrote:

>
> On 04 Nov 2016, at 12:33, SunilChoudhary <sunil.choudary at mapit.gov.in>
> wrote:
>
> I found the shape file for India with States in
>
> https://www.arcgis.com/home/item.html?id=cf9b387de48248a687aafdd4cdff1127
>
> Unfortunately this is outdated (Andra Pradesh is now divided in two
> parts Telangana and Andra Pradesh)
>
> Can someone
>
> 1) point me to a more recent shape file which contains this change
> 2) point me how to draw a seperation line (Possibly via QGIS) so we have
> two states in place of 1
>
>
> did you look at http://gadm.org ?
>
> -Hans
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From simon.besnard at wur.nl  Fri Nov  4 13:50:32 2016
From: simon.besnard at wur.nl (Besnard, Simon)
Date: Fri, 4 Nov 2016 12:50:32 +0000
Subject: [R-sig-Geo] Extract raster values from polygon overlaying -
 efficient alternative
In-Reply-To: <CAMNc56BmygjnyDum_k-Ht+HqN7oqM6nLwU-ZexZ-pWQx8LijAA@mail.gmail.com>
References: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
	<b9858d53-5b19-fd6b-b318-191068260021@mapit.gov.in>
	<CAMNc56D=1g2HA014-PKRSm5c_xX4L1ZVsM1+xTzNDgKQi9Sf_A@mail.gmail.com>,
	<CAMNc56BmygjnyDum_k-Ht+HqN7oqM6nLwU-ZexZ-pWQx8LijAA@mail.gmail.com>
Message-ID: <1478263832638.96144@wur.nl>

Hi all, 

I am currently extracting raster values using polygon overlaying. The raster file is a global product with a 30m resolution. 
In order to implement this task in a efficient way, I am looking at different options. I can imagine that the extract function from the raster package is an option but not very efficient. One could also work with spatial database. 
Therefore, I was wondering if any of you have an idea on how different approaches performed compare to each other to perform such task. e.g. raster::extract Vs. postgis using rpostgis Vs. other more lightweight alternative, such as spatialite. 

Thanks for your insights.

Simon. 

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From maaz at iastate.edu  Fri Nov  4 14:12:06 2016
From: maaz at iastate.edu (Maaz Gardezi)
Date: Fri, 4 Nov 2016 08:12:06 -0500
Subject: [R-sig-Geo] Neighborhood matrix from poly2nb (spdep package)
Message-ID: <CALcs7UJA960mp93vh6N0Q2eOF1-p884eOY9uOgjxW02V_B6fpg@mail.gmail.com>

Hi,

I'm trying to extract the 'neighborhood matrix' from the poly2nb function.

I can see the neighbors for each polygon, e.g. 1 has neighbors 2, 3, 5, 6.

I try to convert this matrix into a data frame but get the error "cannot
coerce class ""nb"" to a data.frame". Is there any way of doing this in the
spdep package?

Other possible ways?

Regards,

Maaz

	[[alternative HTML version deleted]]


From vijaylulla at gmail.com  Fri Nov  4 14:33:58 2016
From: vijaylulla at gmail.com (Vijay Lulla)
Date: Fri, 4 Nov 2016 09:33:58 -0400
Subject: [R-sig-Geo] Shape file for Madhya Pradesh State in India with
	Districts
In-Reply-To: <b9320a43-022f-1688-d7fc-01662497f6b7@mapit.gov.in>
References: <mailman.9.1477998003.13927.r-sig-geo@r-project.org>
	<b9320a43-022f-1688-d7fc-01662497f6b7@mapit.gov.in>
Message-ID: <CAKkiGbvwS77UhK-ANrNUjQ_DaGrAMrBWXt2p-Lu+7NJ2L3wh-g@mail.gmail.com>

Have you tried http://www.gadm.org/ ?

On Fri, Nov 4, 2016 at 7:29 AM, SunilChoudhary <sunil.choudary at mapit.gov.in>
wrote:

> Hi Folks
>
> Can someone point me to Shape file for Madhya Pradesh State in India
> preferably with districts.
>
>
> Thanks
> Sunil Choudhary
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Fri Nov  4 14:42:04 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 4 Nov 2016 14:42:04 +0100
Subject: [R-sig-Geo] Neighborhood matrix from poly2nb (spdep package)
In-Reply-To: <CALcs7UJA960mp93vh6N0Q2eOF1-p884eOY9uOgjxW02V_B6fpg@mail.gmail.com>
References: <CALcs7UJA960mp93vh6N0Q2eOF1-p884eOY9uOgjxW02V_B6fpg@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1611041436230.19879@reclus.nhh.no>

On Fri, 4 Nov 2016, Maaz Gardezi wrote:

> Hi,
>
> I'm trying to extract the 'neighborhood matrix' from the poly2nb function.

No, it returns (see ?poly2nb):

A neighbours list with class ?nb?. See ?card? for details of ?nb? objects.

Look at ?nb2mat, but then you'll also be obliged to decide on the style= 
argument, or use ?nb2list first.

Making a "neigbourhood matrix" involves several steps, each of which 
should be taken consciously. Also maybe see vignette("nb") and 
vignette("nb_igraph").

Roger

>
> I can see the neighbors for each polygon, e.g. 1 has neighbors 2, 3, 5, 6.
>
> I try to convert this matrix into a data frame but get the error "cannot
> coerce class ""nb"" to a data.frame". Is there any way of doing this in the
> spdep package?
>
> Other possible ways?
>
> Regards,
>
> Maaz
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From edzer.pebesma at uni-muenster.de  Fri Nov  4 16:03:00 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 4 Nov 2016 16:03:00 +0100
Subject: [R-sig-Geo] Simple features now on CRAN
Message-ID: <f9b8cb1b-1ba8-9bcd-d628-4eccbfa8d885@uni-muenster.de>

Package sf (for "simple features") is now on CRAN:

https://cran.r-project.org/package=sf

The package vignette is found here:

https://edzer.github.io/sfr/articles/sfr.html

A report on CRAN submission adventures is found here:

http://r-spatial.org/r/2016/11/02/sfcran.html


This doesn't mean that the package is finished, but I believe that it is
useful already. Much of the discussion related to functionality takes
place in github issues:

https://github.com/edzer/sfr/issues

and includes discussion of raster support, dplyr compatibility, and so
on. If you're curious, or want to participate in shaping this, please
participate; contributions on this mailing list are also welcome.

Kudos go to Jeroen Ooms for the Windows port, Roger Bivand for migrating
most of the CRAN build farm to GDAL 2.0, and of course the CRAN team itself!
-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161104/b64d78b8/attachment.bin>

From r-sig-geo at forreststevens.com  Fri Nov  4 17:20:19 2016
From: r-sig-geo at forreststevens.com (Forrest Stevens)
Date: Fri, 04 Nov 2016 16:20:19 +0000
Subject: [R-sig-Geo] Simple features now on CRAN
In-Reply-To: <f9b8cb1b-1ba8-9bcd-d628-4eccbfa8d885@uni-muenster.de>
References: <f9b8cb1b-1ba8-9bcd-d628-4eccbfa8d885@uni-muenster.de>
Message-ID: <CAEBQMMmVrOCWzM0sfX8ujygp6OE-9ryGs211JMcFciK4WweW4g@mail.gmail.com>

Super awesome, Edzer, and all who were involved!  This represents a massive
leap forward in compatibility and future-proofing for those of us working
every day with spatial data in R.  I'll jump in on testing and hopefully
can contribute to push along things with raster-related processing as well.

Congratulations,
Forrest Stevens

On Fri, Nov 4, 2016 at 11:04 AM Edzer Pebesma <edzer.pebesma at uni-muenster.de>
wrote:

> Package sf (for "simple features") is now on CRAN:
>
> https://cran.r-project.org/package=sf
>
> The package vignette is found here:
>
> https://edzer.github.io/sfr/articles/sfr.html
>
> A report on CRAN submission adventures is found here:
>
> http://r-spatial.org/r/2016/11/02/sfcran.html
>
>
> This doesn't mean that the package is finished, but I believe that it is
> useful already. Much of the discussion related to functionality takes
> place in github issues:
>
> https://github.com/edzer/sfr/issues
>
> and includes discussion of raster support, dplyr compatibility, and so
> on. If you're curious, or want to participate in shaping this, please
> participate; contributions on this mailing list are also welcome.
>
> Kudos go to Jeroen Ooms for the Windows port, Roger Bivand for migrating
> most of the CRAN build farm to GDAL 2.0, and of course the CRAN team
> itself!
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> <+49%20251%208333081>
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From pedroc at eio.uva.es  Fri Nov  4 18:09:29 2016
From: pedroc at eio.uva.es (Pedro C. Alvarez)
Date: Fri, 04 Nov 2016 18:09:29 +0100
Subject: [R-sig-Geo] look for advice on handling 3D/4D trajectories in R
Message-ID: <3002573.c5pyJKlBQ7@pc-estio5-pedro>

Hi all,

I am interested in handling 3D (lat, long, altitude) or even 4D (3D+time) 
aircraft trajectories in R. I am new to GIS (although not to R), then, I have 
been searching through r-project, R-sig-geo, the web ... and I've found and 
concluded that sp classes and some avalaible packages like trip, trajectories, 
... do not cover the kind of methods and operations that are avalaible for 2D 
trajectories through sp or rgeos (for example, intersections, distance, gArea, 
gBuffer, ...).

My question is: I am right with the above conclusion? 

I have seen too that PostGIS has methods to deal with 3D (XYZ) or 4D (XYZM) 
records. Is it the only (opensource) option?

Any advice to start using the appropiate tools will be welcome!

Thanks in advance,
Pedro.


-- 

--
-----------------------------------------------------
-----------------------------------------------------
        Pedro C?sar Alvarez Esteban
        Dpto. de Estad?stica e Investigaci?n Operativa
        Facultad de Ciencias
        Universidad de Valladolid
        Paseo de Bel?n, 7
        47011 Valladolid (SPAIN)
-----------------------------------------------------
        Tfo: +34 983 423930
        Fax: +34 983 423013
        E-mail: pedroc at eio.uva.es


From vijaylulla at gmail.com  Fri Nov  4 20:24:15 2016
From: vijaylulla at gmail.com (Vijay Lulla)
Date: Fri, 4 Nov 2016 15:24:15 -0400
Subject: [R-sig-Geo] Simple features now on CRAN
In-Reply-To: <f9b8cb1b-1ba8-9bcd-d628-4eccbfa8d885@uni-muenster.de>
References: <f9b8cb1b-1ba8-9bcd-d628-4eccbfa8d885@uni-muenster.de>
Message-ID: <CAKkiGbvfU6gnX4Y-PZVnGPgh82p0v5WF66BNvfTwOtNws8VbAw@mail.gmail.com>

After reading the vignette  I tried it with a few shapefiles and it seems
to be going well so far!  Good work!

Congratulations.

On Fri, Nov 4, 2016 at 11:03 AM, Edzer Pebesma <
edzer.pebesma at uni-muenster.de> wrote:

> Package sf (for "simple features") is now on CRAN:
>
> https://cran.r-project.org/package=sf
>
> The package vignette is found here:
>
> https://edzer.github.io/sfr/articles/sfr.html
>
> A report on CRAN submission adventures is found here:
>
> http://r-spatial.org/r/2016/11/02/sfcran.html
>
>
> This doesn't mean that the package is finished, but I believe that it is
> useful already. Much of the discussion related to functionality takes
> place in github issues:
>
> https://github.com/edzer/sfr/issues
>
> and includes discussion of raster support, dplyr compatibility, and so
> on. If you're curious, or want to participate in shaping this, please
> participate; contributions on this mailing list are also welcome.
>
> Kudos go to Jeroen Ooms for the Windows port, Roger Bivand for migrating
> most of the CRAN build farm to GDAL 2.0, and of course the CRAN team
> itself!
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Fri Nov  4 22:47:47 2016
From: mtreglia at gmail.com (Michael Treglia)
Date: Fri, 4 Nov 2016 17:47:47 -0400
Subject: [R-sig-Geo] look for advice on handling 3D/4D trajectories in R
In-Reply-To: <3002573.c5pyJKlBQ7@pc-estio5-pedro>
References: <3002573.c5pyJKlBQ7@pc-estio5-pedro>
Message-ID: <CAPKp32ttSO3j7eazdQD6hcaM5c0sURfsX0ceSRme-uvGq5mWrA@mail.gmail.com>

Hi Paedro,

Might want to look into the mkde package (
https://cran.rstudio.com/web/packages/mkde/index.html) - it's designed to
use 3d tracking data to estimate movement in 3 dimensions.

Hope that helps,
Mike

On Fri, Nov 4, 2016 at 1:09 PM, Pedro C. Alvarez <pedroc at eio.uva.es> wrote:

> Hi all,
>
> I am interested in handling 3D (lat, long, altitude) or even 4D (3D+time)
> aircraft trajectories in R. I am new to GIS (although not to R), then, I
> have
> been searching through r-project, R-sig-geo, the web ... and I've found and
> concluded that sp classes and some avalaible packages like trip,
> trajectories,
> ... do not cover the kind of methods and operations that are avalaible for
> 2D
> trajectories through sp or rgeos (for example, intersections, distance,
> gArea,
> gBuffer, ...).
>
> My question is: I am right with the above conclusion?
>
> I have seen too that PostGIS has methods to deal with 3D (XYZ) or 4D (XYZM)
> records. Is it the only (opensource) option?
>
> Any advice to start using the appropiate tools will be welcome!
>
> Thanks in advance,
> Pedro.
>
>
> --
>
> --
> -----------------------------------------------------
> -----------------------------------------------------
>         Pedro C?sar Alvarez Esteban
>         Dpto. de Estad?stica e Investigaci?n Operativa
>         Facultad de Ciencias
>         Universidad de Valladolid
>         Paseo de Bel?n, 7
>         47011 Valladolid (SPAIN)
> -----------------------------------------------------
>         Tfo: +34 983 423930
>         Fax: +34 983 423013
>         E-mail: pedroc at eio.uva.es
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From adamhsparks at gmail.com  Sat Nov  5 08:12:42 2016
From: adamhsparks at gmail.com (Adam H Sparks)
Date: Sat, 5 Nov 2016 03:12:42 -0400
Subject: [R-sig-Geo] NewBie Question: Splitting shape file in two
In-Reply-To: <CAJmQPwEWFFcHAqhi9UjjK2LHtFQsq=utnuwjVE+EqeY=ixbFWw@mail.gmail.com>
References: <CAJmQPwEWFFcHAqhi9UjjK2LHtFQsq=utnuwjVE+EqeY=ixbFWw@mail.gmail.com>
Message-ID: <CAJmQPwGzPAT3t88ES9BvfJFWFWMqigRkGHApH-Cmbzwem5Ed3w@mail.gmail.com>

Ack, sorry. Wrong thread.

-- 
Adam H Sparks

On 4 November 2016 at 23:41:55, Adam H Sparks (adamhsparks at gmail.com) wrote:

> And getData() in the raster package, which will get GADM data?
>
> --
> Adam H Sparks
>
> On 4 November 2016 at 22:44:02, Hans-J?rg Bibiko (bibiko at shh.mpg.de)
> wrote:
>
>>
>> On 04 Nov 2016, at 12:33, SunilChoudhary <sunil.choudary at mapit.gov.in>
>> wrote:
>>
>> I found the shape file for India with States in
>>
>> https://www.arcgis.com/home/item.html?id=cf9b387de48248a687aafdd4cdff1127
>>
>> Unfortunately this is outdated (Andra Pradesh is now divided in two
>> parts Telangana and Andra Pradesh)
>>
>> Can someone
>>
>> 1) point me to a more recent shape file which contains this change
>> 2) point me how to draw a seperation line (Possibly via QGIS) so we have
>> two states in place of 1
>>
>>
>> did you look at http://gadm.org ?
>>
>> -Hans
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

	[[alternative HTML version deleted]]


From adamhsparks at gmail.com  Sat Nov  5 08:13:10 2016
From: adamhsparks at gmail.com (Adam H Sparks)
Date: Sat, 5 Nov 2016 03:13:10 -0400
Subject: [R-sig-Geo] Shape file for Madhya Pradesh State in India with
	Districts
In-Reply-To: <CAKkiGbvwS77UhK-ANrNUjQ_DaGrAMrBWXt2p-Lu+7NJ2L3wh-g@mail.gmail.com>
References: <CAKkiGbvwS77UhK-ANrNUjQ_DaGrAMrBWXt2p-Lu+7NJ2L3wh-g@mail.gmail.com>
Message-ID: <CAJmQPwHvxPrhnX31Acu=E3CSHb5GASvuex1O_7P5+qwVZUg5Vw@mail.gmail.com>

And getData() in the raster package, which will get GADM data?

-- 
Adam H Sparks

On 5 November 2016 at 00:33:58, Vijay Lulla (vijaylulla at gmail.com) wrote:

> Have you tried http://www.gadm.org/ ?
>
> On Fri, Nov 4, 2016 at 7:29 AM, SunilChoudhary <
> sunil.choudary at mapit.gov.in>
> wrote:
>
> Hi Folks
>
> Can someone point me to Shape file for Madhya Pradesh State in India
> preferably with districts.
>
>
> Thanks
> Sunil Choudhary
>
>
>
> [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From basille.web at ase-research.org  Sun Nov  6 15:09:50 2016
From: basille.web at ase-research.org (Mathieu Basille)
Date: Sun, 6 Nov 2016 09:09:50 -0500
Subject: [R-sig-Geo] look for advice on handling 3D/4D trajectories in R
In-Reply-To: <CAPKp32ttSO3j7eazdQD6hcaM5c0sURfsX0ceSRme-uvGq5mWrA@mail.gmail.com>
References: <3002573.c5pyJKlBQ7@pc-estio5-pedro>
	<CAPKp32ttSO3j7eazdQD6hcaM5c0sURfsX0ceSRme-uvGq5mWrA@mail.gmail.com>
Message-ID: <44b0bb85-4f76-f125-c685-bf891dbda2d0@ase-research.org>

Also very timely, Edzer Pebesma released his 'sf' package on CRAN just a
couple of hours before your request. sf implements the Simple Features
standard, which is precisely the one PostGIS relies on, and do propose 3D
(XYZ) or 4D (XYZM) geometries in R.

It seems to me that the use of these features is still widely open in the
sense that applications are not common yet... so it may or may not answer
your needs, but should very much match PostGIS capabilities.

You may want to look at Edzer's announcement:

https://stat.ethz.ch/pipermail/r-sig-geo/2016-November/025082.html

(check notably the vignette)

Cheers,
Mathieu.


Le 04/11/2016 ? 17:47, Michael Treglia a ?crit :
> Hi Paedro,
> 
> Might want to look into the mkde package (
> https://cran.rstudio.com/web/packages/mkde/index.html) - it's designed to
> use 3d tracking data to estimate movement in 3 dimensions.
> 
> Hope that helps,
> Mike
> 
> On Fri, Nov 4, 2016 at 1:09 PM, Pedro C. Alvarez <pedroc at eio.uva.es> wrote:
> 
>> Hi all,
>>
>> I am interested in handling 3D (lat, long, altitude) or even 4D (3D+time)
>> aircraft trajectories in R. I am new to GIS (although not to R), then, I
>> have
>> been searching through r-project, R-sig-geo, the web ... and I've found and
>> concluded that sp classes and some avalaible packages like trip,
>> trajectories,
>> ... do not cover the kind of methods and operations that are avalaible for
>> 2D
>> trajectories through sp or rgeos (for example, intersections, distance,
>> gArea,
>> gBuffer, ...).
>>
>> My question is: I am right with the above conclusion?
>>
>> I have seen too that PostGIS has methods to deal with 3D (XYZ) or 4D (XYZM)
>> records. Is it the only (opensource) option?
>>
>> Any advice to start using the appropiate tools will be welcome!
>>
>> Thanks in advance,
>> Pedro.
>>
>>
>> --
>>
>> --
>> -----------------------------------------------------
>> -----------------------------------------------------
>>         Pedro C?sar Alvarez Esteban
>>         Dpto. de Estad?stica e Investigaci?n Operativa
>>         Facultad de Ciencias
>>         Universidad de Valladolid
>>         Paseo de Bel?n, 7
>>         47011 Valladolid (SPAIN)
>> -----------------------------------------------------
>>         Tfo: +34 983 423930
>>         Fax: +34 983 423013
>>         E-mail: pedroc at eio.uva.es
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 

Mathieu Basille

basille at ufl.edu | http://ase-research.org/basille
+1 954-577-6314 | University of Florida FLREC

  ? Le tout est de tout dire, et je manque de mots
  Et je manque de temps, et je manque d'audace. ?
  ? Paul ?luard

This message is signed to guarantee its authenticity.
For a true private correspondence, use my public key
to encrypt your messages:

  http://mathieu.basille.net/pub.asc

Learn more: http://mzl.la/1BsOGiZ

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 819 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161106/d2c2d133/attachment.bin>

From pedroc at eio.uva.es  Mon Nov  7 11:11:52 2016
From: pedroc at eio.uva.es (Pedro C. Alvarez)
Date: Mon, 07 Nov 2016 11:11:52 +0100
Subject: [R-sig-Geo] look for advice on handling 3D/4D trajectories in R
In-Reply-To: <44b0bb85-4f76-f125-c685-bf891dbda2d0@ase-research.org>
References: <3002573.c5pyJKlBQ7@pc-estio5-pedro>
	<CAPKp32ttSO3j7eazdQD6hcaM5c0sURfsX0ceSRme-uvGq5mWrA@mail.gmail.com>
	<44b0bb85-4f76-f125-c685-bf891dbda2d0@ase-research.org>
Message-ID: <6438424.aqXdl74oET@pc-estio5-pedro>


Thanks for the info. I will have a look to 'mkde' and 'sf'. The sf vignette is 
promising!!

Pedro

El Domingo, 6 de noviembre de 2016 09:09:50 Mathieu Basille escribi?:
> Also very timely, Edzer Pebesma released his 'sf' package on CRAN just a
> couple of hours before your request. sf implements the Simple Features
> standard, which is precisely the one PostGIS relies on, and do propose 3D
> (XYZ) or 4D (XYZM) geometries in R.
> 
> It seems to me that the use of these features is still widely open in the
> sense that applications are not common yet... so it may or may not answer
> your needs, but should very much match PostGIS capabilities.
> 
> You may want to look at Edzer's announcement:
> 
> https://stat.ethz.ch/pipermail/r-sig-geo/2016-November/025082.html
> 
> (check notably the vignette)
> 
> Cheers,
> Mathieu.
> 
> Le 04/11/2016 ? 17:47, Michael Treglia a ?crit :
> > Hi Paedro,
> > 
> > Might want to look into the mkde package (
> > https://cran.rstudio.com/web/packages/mkde/index.html) - it's designed to
> > use 3d tracking data to estimate movement in 3 dimensions.
> > 
> > Hope that helps,
> > Mike
> > 
> > On Fri, Nov 4, 2016 at 1:09 PM, Pedro C. Alvarez <pedroc at eio.uva.es> 
wrote:
> >> Hi all,
> >> 
> >> I am interested in handling 3D (lat, long, altitude) or even 4D (3D+time)
> >> aircraft trajectories in R. I am new to GIS (although not to R), then, I
> >> have
> >> been searching through r-project, R-sig-geo, the web ... and I've found
> >> and
> >> concluded that sp classes and some avalaible packages like trip,
> >> trajectories,
> >> ... do not cover the kind of methods and operations that are avalaible
> >> for
> >> 2D
> >> trajectories through sp or rgeos (for example, intersections, distance,
> >> gArea,
> >> gBuffer, ...).
> >> 
> >> My question is: I am right with the above conclusion?
> >> 
> >> I have seen too that PostGIS has methods to deal with 3D (XYZ) or 4D
> >> (XYZM)
> >> records. Is it the only (opensource) option?
> >> 
> >> Any advice to start using the appropiate tools will be welcome!
> >> 
> >> Thanks in advance,
> >> Pedro.
> >> 
> >> 
> >> --
> >> 
> >> --
> >> -----------------------------------------------------
> >> -----------------------------------------------------
> >> 
> >>         Pedro C?sar Alvarez Esteban
> >>         Dpto. de Estad?stica e Investigaci?n Operativa
> >>         Facultad de Ciencias
> >>         Universidad de Valladolid
> >>         Paseo de Bel?n, 7
> >>         47011 Valladolid (SPAIN)
> >> 
> >> -----------------------------------------------------
> >> 
> >>         Tfo: +34 983 423930
> >>         Fax: +34 983 423013
> >>         E-mail: pedroc at eio.uva.es
> >> 
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >> 
> > 	[[alternative HTML version deleted]]
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 

--
-----------------------------------------------------
-----------------------------------------------------
        Pedro C?sar Alvarez Esteban
        Dpto. de Estad?stica e Investigaci?n Operativa
        Facultad de Ciencias
        Universidad de Valladolid
        Paseo de Bel?n, 7
        47011 Valladolid (SPAIN)
-----------------------------------------------------
        Tfo: +34 983 423930
        Fax: +34 983 423013
        E-mail: pedroc at eio.uva.es


From maaz at iastate.edu  Mon Nov  7 13:02:35 2016
From: maaz at iastate.edu (Maaz Gardezi)
Date: Mon, 7 Nov 2016 06:02:35 -0600
Subject: [R-sig-Geo] Neighborhood matrix from poly2nb (spdep package)
In-Reply-To: <alpine.LFD.2.20.1611041436230.19879@reclus.nhh.no>
References: <CALcs7UJA960mp93vh6N0Q2eOF1-p884eOY9uOgjxW02V_B6fpg@mail.gmail.com>
	<alpine.LFD.2.20.1611041436230.19879@reclus.nhh.no>
Message-ID: <CALcs7U+XqDrBt7Ox+7USLcpdvjMFLgALVsSkG69ppYhGfFUPGg@mail.gmail.com>

Thanks, Ill look into alternative ways of finding the neighborhood matrix.
Both the vignette's were helpful.

Maaz

	[[alternative HTML version deleted]]


From anna.szyniszewska at rothamsted.ac.uk  Tue Nov  8 15:50:26 2016
From: anna.szyniszewska at rothamsted.ac.uk (Anna Szyniszewska)
Date: Tue, 8 Nov 2016 14:50:26 +0000
Subject: [R-sig-Geo] Kriging in gstat - "number of rows in data.frame and
 SpatialPoints don't match" error
Message-ID: <AM4PR0101MB2164EE531A401594864A1D00D6A60@AM4PR0101MB2164.eurprd01.prod.exchangelabs.com>

Hi,

I have done kriging using gstat a few times before, but this time I keep getting an error and I am unsure what is that the krige() function doesn't like - my spatial pixels or point data frames.
Error in validObject(.Object) :
  invalid class "SpatialPointsDataFrame" object: number of rows in data.frame and SpatialPoints don't match

I tried to modify my code in several ways, but I was not successful in finding solution. Help of an experienced eye, would be very much appreciated - many thanks in advance.

Below is my fully reconstructible code:

X <- c(32.04, 32.07, 32.11, 32.12, 32.16, 32.17, 32.2, 32.22, 32.24, 32.27,
       32.3, 32.37, 32.42, 32.45, 32.49, 32.49, 32.51, 32.52, 32.56, 32.57,
       32.58, 32.59, 32.59, 32.6, 32.61, 32.63, 32.67, 32.7, 32.7, 32.72, 32.74,
       32.75, 32.78, 32.82, 32.83, 32.88, 32.9, 32.95, 32.96, 32.97, 33.01,
       33.06, 33.07, 33.08, 33.09, 33.1, 33.13, 33.16, 33.17, 33.17, 33.17,
       33.17, 33.21, 33.22, 33.25, 33.27, 33.28, 33.29, 33.3, 33.34, 33.36,
       33.41, 33.41, 33.41, 33.42, 33.43, 33.45, 33.48, 33.49, 33.51, 33.54,
       33.58, 33.64, 33.64, 33.65, 33.71, 33.74, 33.8, 33.84, 33.9)
Y <- c(-3.51, -4.79, -4.59, -3.7, -3.02, -4.63, -4.99, -4.42, -3.67, -3.18,
       -3.27, -3.91, -3.49, -4.82, -4.4, -3.77, -3.73, -4.28, -4.07, -3.81,
       -3.96, -4.92, -4.42, -3.41, -3.27, -3.01, -4.13, -4.98, -4.58, -3.11,
       -3.86, -4.45, -4.91, -4.18, -4.33, -4.22, -3.9, -4.96, -3.1, -3.19,
       -4.21, -3.75, -3.64, -4.06, -3.85, -3.35, -4.24, -4.59, -4.74, -4.44,
       -4.31, -3.22, -4.2, -3.76, -3.17, -3.03, -3.74, -4.74, -4.16, -3.09,
       -3.73, -4.23, -3.69, -3.55, -4.33, -4.38, -4.54, -4.45, -3.41, -4.7,
       -3.65, -4.43, -4.39, -3.11, -4.14, -4.78, -3.61, -3.21, -3.25, -3.36)
Z <- c(0.87, 0.73, 0.83, 0.2, 0.23, 0.93, 0.1, 0.77, 0.8, 0.27, 0.5, 0.13, 0.33,
       0.1, 0.13, 0.03, 0.13, 0.87, 0.07, 0.17, 0, 0.17, 0.1, 0.2, 0.13, 0.1,
       0, 0.07, 0.73, 0.5, 0, 0.17, 0, 0, 0, 0, 0, 0.07, 0.1, 0.07, 0, 0.1,
       0.03, 0.1, 0, 0.13, 0.13, 0.03, 0, 0, 0, 0.1, 0.23, 0, 0.17, 0.17, 0.03,
       0, 0.1, 0.4, 0.07, 0.17, 0.13, 0.1, 0.27, 0, 0, 0, 0.03, 0, 0.03, 0.17,
       0.1, 0, 0.03, 0, 0.03, 0, 0.03, 0)

Data1 <- data.frame(X,Y,Z)
coordinates(Data1) <- cbind(Data1$X,Data1$Y)

# Create spatial grid for kriging
x <- rep(seq(33,35,0.01),each=201)
y <- rep(seq(-5,-3,0.01),times=201)

grid <- data.frame(x,y)

coordinates(grid) <- c("x","y")
gridded(grid)=TRUE

grd <- as(grid, "SpatialPixelsDataFrame")

# Project SpatialPointsDataFrame and SpatialPixelsDataFrame:
proj4string(Data1) <-  CRS("+proj=longlat +datum=WGS84")
proj4string(grd) <-  CRS("+proj=longlat +datum=WGS84")

# Calculate variogram:
vgm1 <- variogram(Z~1,Data1,width = 10,cutoff=130)

plot(vgm1)

# Set initial variogram function values
psill = 0.05
distance = 80
nugget = 0.01 # constant


# Fit and plot variogram model:
null.vgm <- vgm(psill, "Sph", distance, nugget) # variogram function
vgm.fit <- fit.variogram(vgm1, model=null.vgm, fit.ranges=TRUE,
                         fit.method=1) # Raw WLS
# Plot semivariogram function:
plot(vgm1,vgm.fit)
Inc.kriged <- krige(Z~1,Data1,grd,model=vgm.fit)



	[[alternative HTML version deleted]]


From santiago.begueria at csic.es  Tue Nov  8 23:35:54 2016
From: santiago.begueria at csic.es (=?utf-8?Q?Santiago_Beguer=C3=ADa_Portugu=C3=A9s?=)
Date: Tue, 8 Nov 2016 23:35:54 +0100
Subject: [R-sig-Geo] spatiotemporal co-kriging?
In-Reply-To: <F7815991-4967-449B-8173-C26865B49F2A@csic.es>
References: <F7815991-4967-449B-8173-C26865B49F2A@csic.es>
Message-ID: <3996875F-3708-4E40-8CD5-FD46122DD5B6@csic.es>

Dear R-sig-geo list members,

I am working on a spatio-temporal kriging model (using gstat::krigeST) of two closely related variables. I?m getting good results on one of them, and not so good on the other. Since both dependent variables are inter-related, I expect that co-kringing would be a good option (I?ve done this in a spatial-only context with the same two variables and co-kriging proved beneficial).

So, is it possible to perform spatiotemporal CO-kriging, and if so are you aware of any examples? I have not been able to find any myself.

Cheers,

Santiago Beguer?a
CSIC
Spain


From jon.skoien at jrc.ec.europa.eu  Wed Nov  9 16:27:32 2016
From: jon.skoien at jrc.ec.europa.eu (Jon Skoien)
Date: Wed, 09 Nov 2016 16:27:32 +0100
Subject: [R-sig-Geo] Kriging in gstat - "number of rows in data.frame
 and SpatialPoints don't match" error
In-Reply-To: <AM4PR0101MB2164EE531A401594864A1D00D6A60@AM4PR0101MB2164.eurprd01.prod.exchangelabs.com>
References: <AM4PR0101MB2164EE531A401594864A1D00D6A60@AM4PR0101MB2164.eurprd01.prod.exchangelabs.com>
Message-ID: <a67c4302-33a8-3e5e-3ae4-12b7202a6808@jrc.ec.europa.eu>

Hi Anna,

The problem seems to be this line:
 > grd <- as(grid, "SpatialPixelsDataFrame")
as the grid doesn't have any data except for the coordinates.
Try instead with:
 > grd <- as(grid, "SpatialPixels")

Cheers,
Jon


On 11/8/2016 3:50 PM, Anna Szyniszewska wrote:
> Hi,
>
> I have done kriging using gstat a few times before, but this time I keep getting an error and I am unsure what is that the krige() function doesn't like - my spatial pixels or point data frames.
> Error in validObject(.Object) :
>   invalid class "SpatialPointsDataFrame" object: number of rows in data.frame and SpatialPoints don't match
>
> I tried to modify my code in several ways, but I was not successful in finding solution. Help of an experienced eye, would be very much appreciated - many thanks in advance.
>
> Below is my fully reconstructible code:
>
> X <- c(32.04, 32.07, 32.11, 32.12, 32.16, 32.17, 32.2, 32.22, 32.24, 32.27,
>        32.3, 32.37, 32.42, 32.45, 32.49, 32.49, 32.51, 32.52, 32.56, 32.57,
>        32.58, 32.59, 32.59, 32.6, 32.61, 32.63, 32.67, 32.7, 32.7, 32.72, 32.74,
>        32.75, 32.78, 32.82, 32.83, 32.88, 32.9, 32.95, 32.96, 32.97, 33.01,
>        33.06, 33.07, 33.08, 33.09, 33.1, 33.13, 33.16, 33.17, 33.17, 33.17,
>        33.17, 33.21, 33.22, 33.25, 33.27, 33.28, 33.29, 33.3, 33.34, 33.36,
>        33.41, 33.41, 33.41, 33.42, 33.43, 33.45, 33.48, 33.49, 33.51, 33.54,
>        33.58, 33.64, 33.64, 33.65, 33.71, 33.74, 33.8, 33.84, 33.9)
> Y <- c(-3.51, -4.79, -4.59, -3.7, -3.02, -4.63, -4.99, -4.42, -3.67, -3.18,
>        -3.27, -3.91, -3.49, -4.82, -4.4, -3.77, -3.73, -4.28, -4.07, -3.81,
>        -3.96, -4.92, -4.42, -3.41, -3.27, -3.01, -4.13, -4.98, -4.58, -3.11,
>        -3.86, -4.45, -4.91, -4.18, -4.33, -4.22, -3.9, -4.96, -3.1, -3.19,
>        -4.21, -3.75, -3.64, -4.06, -3.85, -3.35, -4.24, -4.59, -4.74, -4.44,
>        -4.31, -3.22, -4.2, -3.76, -3.17, -3.03, -3.74, -4.74, -4.16, -3.09,
>        -3.73, -4.23, -3.69, -3.55, -4.33, -4.38, -4.54, -4.45, -3.41, -4.7,
>        -3.65, -4.43, -4.39, -3.11, -4.14, -4.78, -3.61, -3.21, -3.25, -3.36)
> Z <- c(0.87, 0.73, 0.83, 0.2, 0.23, 0.93, 0.1, 0.77, 0.8, 0.27, 0.5, 0.13, 0.33,
>        0.1, 0.13, 0.03, 0.13, 0.87, 0.07, 0.17, 0, 0.17, 0.1, 0.2, 0.13, 0.1,
>        0, 0.07, 0.73, 0.5, 0, 0.17, 0, 0, 0, 0, 0, 0.07, 0.1, 0.07, 0, 0.1,
>        0.03, 0.1, 0, 0.13, 0.13, 0.03, 0, 0, 0, 0.1, 0.23, 0, 0.17, 0.17, 0.03,
>        0, 0.1, 0.4, 0.07, 0.17, 0.13, 0.1, 0.27, 0, 0, 0, 0.03, 0, 0.03, 0.17,
>        0.1, 0, 0.03, 0, 0.03, 0, 0.03, 0)
>
> Data1 <- data.frame(X,Y,Z)
> coordinates(Data1) <- cbind(Data1$X,Data1$Y)
>
> # Create spatial grid for kriging
> x <- rep(seq(33,35,0.01),each=201)
> y <- rep(seq(-5,-3,0.01),times=201)
>
> grid <- data.frame(x,y)
>
> coordinates(grid) <- c("x","y")
> gridded(grid)=TRUE
>
> grd <- as(grid, "SpatialPixelsDataFrame")
>
> # Project SpatialPointsDataFrame and SpatialPixelsDataFrame:
> proj4string(Data1) <-  CRS("+proj=longlat +datum=WGS84")
> proj4string(grd) <-  CRS("+proj=longlat +datum=WGS84")
>
> # Calculate variogram:
> vgm1 <- variogram(Z~1,Data1,width = 10,cutoff=130)
>
> plot(vgm1)
>
> # Set initial variogram function values
> psill = 0.05
> distance = 80
> nugget = 0.01 # constant
>
>
> # Fit and plot variogram model:
> null.vgm <- vgm(psill, "Sph", distance, nugget) # variogram function
> vgm.fit <- fit.variogram(vgm1, model=null.vgm, fit.ranges=TRUE,
>                          fit.method=1) # Raw WLS
> # Plot semivariogram function:
> plot(vgm1,vgm.fit)
> Inc.kriged <- krige(Z~1,Data1,grd,model=vgm.fit)
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Space, Security & Migration
Disaster Risk Management Unit

Via E. Fermi 2749, TP 122,  I-21027 Ispra (VA), ITALY

jon.skoien at jrc.ec.europa.eu
Tel:  +39 0332 789205

Disclaimer: Views expressed in this email are those of the individual 
and do not necessarily represent official views of the European Commission.


From Andy.Bunn at wwu.edu  Wed Nov  9 23:07:35 2016
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Wed, 9 Nov 2016 22:07:35 +0000
Subject: [R-sig-Geo] GLOBE DEM in R?
Message-ID: <D448DE23.5EA20%andy.bunn@wwu.edu>

Is the GLOBE DEM accessible in R via a package? I usually use raster::getData() when I need elev data but I need to sample a SPDF of a few thousand points with latitudes higher than the SRTM covers. Thoughts appreciated.

-Andy


	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Thu Nov 10 01:02:07 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 10 Nov 2016 00:02:07 +0000
Subject: [R-sig-Geo] GLOBE DEM in R?
In-Reply-To: <D448DE23.5EA20%andy.bunn@wwu.edu>
References: <D448DE23.5EA20%andy.bunn@wwu.edu>
Message-ID: <CAAcGz98h7ftEfchx7knKsqMWVu_BLcCDe-m_JGcbzOHO8sceNQ@mail.gmail.com>

The only available global DEM in an R package that I know is geomapdata
which has Etopo5 (or equivalent) in it.

Otherwise there is marmap with getNOAA.bathy() function, and I would look
at xtractomatic as well for access to online services.

I tend to keep Etopo1, Etopo2, GEBCO14, and a bunch of other non-global
ones in local files since we use them intensively, and happy to help if you
need guidance with any of those.

There is IBCSO in polar form the southern hemisphere, but not sure if
there's an equivalent for the north?

Generally I go for the NetCDF version (either .nc or .grd) now that ncdf4
is fully supported by CRAN, otherwise use GeoTIFF if they provide it.
Sometimes need some augmentation when reading with raster() to make sure
things are interpreted fully/perfectly, but mostly it's pretty good.

If there are other sources I'm keen to hear as well.

Cheers, Mike.



On Thu, 10 Nov 2016 at 09:08 Andy Bunn <Andy.Bunn at wwu.edu> wrote:

> Is the GLOBE DEM accessible in R via a package? I usually use
> raster::getData() when I need elev data but I need to sample a SPDF of a
> few thousand points with latitudes higher than the SRTM covers. Thoughts
> appreciated.
>
> -Andy
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From btupper at bigelow.org  Thu Nov 10 01:22:57 2016
From: btupper at bigelow.org (Ben Tupper)
Date: Wed, 9 Nov 2016 19:22:57 -0500
Subject: [R-sig-Geo] GLOBE DEM in R?
In-Reply-To: <CAAcGz98h7ftEfchx7knKsqMWVu_BLcCDe-m_JGcbzOHO8sceNQ@mail.gmail.com>
References: <D448DE23.5EA20%andy.bunn@wwu.edu>
	<CAAcGz98h7ftEfchx7knKsqMWVu_BLcCDe-m_JGcbzOHO8sceNQ@mail.gmail.com>
Message-ID: <BC19C68C-33B2-4912-B946-E044D531F1DA@bigelow.org>

Hi,

You might give the Natural Earth topography a shake...

https://github.com/BigelowLab/nearth

I don't know how it compares to the ETOPO datasets.

Cheers,
Ben

> On Nov 9, 2016, at 7:02 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> 
> The only available global DEM in an R package that I know is geomapdata
> which has Etopo5 (or equivalent) in it.
> 
> Otherwise there is marmap with getNOAA.bathy() function, and I would look
> at xtractomatic as well for access to online services.
> 
> I tend to keep Etopo1, Etopo2, GEBCO14, and a bunch of other non-global
> ones in local files since we use them intensively, and happy to help if you
> need guidance with any of those.
> 
> There is IBCSO in polar form the southern hemisphere, but not sure if
> there's an equivalent for the north?
> 
> Generally I go for the NetCDF version (either .nc or .grd) now that ncdf4
> is fully supported by CRAN, otherwise use GeoTIFF if they provide it.
> Sometimes need some augmentation when reading with raster() to make sure
> things are interpreted fully/perfectly, but mostly it's pretty good.
> 
> If there are other sources I'm keen to hear as well.
> 
> Cheers, Mike.
> 
> 
> 
> On Thu, 10 Nov 2016 at 09:08 Andy Bunn <Andy.Bunn at wwu.edu> wrote:
> 
>> Is the GLOBE DEM accessible in R via a package? I usually use
>> raster::getData() when I need elev data but I need to sample a SPDF of a
>> few thousand points with latitudes higher than the SRTM covers. Thoughts
>> appreciated.
>> 
>> -Andy
>> 
>> 
>>        [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> -- 
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



Ben Tupper
Bigelow Laboratory for Ocean Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org


From Hollister.Jeff at epa.gov  Thu Nov 10 14:59:48 2016
From: Hollister.Jeff at epa.gov (Hollister, Jeff)
Date: Thu, 10 Nov 2016 13:59:48 +0000
Subject: [R-sig-Geo] GLOBE DEM in R?
Message-ID: <BY2PR09MB0676B5B1E702587335165D3781B80@BY2PR09MB0676.namprd09.prod.outlook.com>

Andy,

I have been working on a package for accessing elevation data, elevatr.  It is not yet on CRAN, but you can get the current version at https://github.com/jhollist/elevatr.  

For points it is currently using the USGS EPQS and Mapzen's Elevation Service.  The Mapzen elevation service does have global coverage and pulls from a variety of sources.  For higher latitudes it is using GMTED.

You'll probably run into service limits.  I'm hoping to add some functionality that will conform to Mapzen's limits, but that hasn't been done yet...

Any questions or comments about the package, let me know.

Cheers,
Jeff

------------------------------

Message: 2
Date: Wed, 9 Nov 2016 22:07:35 +0000
From: Andy Bunn <Andy.Bunn at wwu.edu>
To: R-sig-Geo <r-sig-geo at r-project.org>
Subject: [R-sig-Geo] GLOBE DEM in R?
Message-ID: <D448DE23.5EA20%andy.bunn at wwu.edu>
Content-Type: text/plain; charset="UTF-8"

Is the GLOBE DEM accessible in R via a package? I usually use raster::getData() when I need elev data but I need to sample a SPDF of a few thousand points with latitudes higher than the SRTM covers. Thoughts appreciated.

-Andy


From loic.dutrieux at conabio.gob.mx  Thu Nov 10 15:47:44 2016
From: loic.dutrieux at conabio.gob.mx (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Thu, 10 Nov 2016 15:47:44 +0100
Subject: [R-sig-Geo] Write sf object to spatialite database
Message-ID: <41f556fb-fddd-fd32-41b6-19d1e9f8a9c7@conabio.gob.mx>

Hi,

Is it possible to write sf objects to spatialite databases? I tried to
adapt the postgis example of the st_write_db function but I get the
following error:

Error in sqliteSendQuery(con, statement, bind.data) :
error in statement: no such function: AddGeometryColumn

Cheers,
Lo?c

library(sf)
library(sp)
library(RSQLite)

data(meuse)
sf = st_as_sf(meuse, coords = c("x", "y"), crs = 28992)

# I created the db with QGIS, I don't know how to do otherwise
con <- dbConnect(RSQLite::SQLite(), '~/sandbox/db.sqlite')

st_write_db(con, sf, "meuse_tbl", dropTable = FALSE)


From WillemijnVroege at hotmail.com  Thu Nov 10 16:17:54 2016
From: WillemijnVroege at hotmail.com (Willemijn Vroege)
Date: Thu, 10 Nov 2016 15:17:54 +0000
Subject: [R-sig-Geo] spatial durbin model with large asymmetric data
Message-ID: <AM4PR10MB0099BE987CA527067099D492B8B80@AM4PR10MB0099.EURPRD10.PROD.OUTLOOK.COM>

Hello,

I use the spdep package for spatial durbin modelling in R. I have many observations (>60'000) and use a k-nearest neighbourhood definition leading to asymmetry.
For a subset of my data my script runs fine, however when I include all the observations, the vector to be allocated is too large.
As far I understand, I should create a sparse matrix with LU factorization.

Now I use the command:

nb<-knn2nb(knearneigh(coords, k=10), row.names=IDs)
dsts <- nbdists(kn10, coords)
idw <- lapply(dsts, function(x) 1/(x))
nb1<- nb2listw(kn10, glist = idw, style = "B")
lag<-lagsarlm(x ~ y, data=df, listw =nb1, type = "mixed", method = ??, tr=??)

How do I need to specify the matrix and how can I include it in the lagsarlm command to continue with my large dataset?
Thanks a lot for your help,
Willemijn


	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Thu Nov 10 17:05:58 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 10 Nov 2016 17:05:58 +0100
Subject: [R-sig-Geo] spatiotemporal co-kriging?
In-Reply-To: <3996875F-3708-4E40-8CD5-FD46122DD5B6@csic.es>
References: <F7815991-4967-449B-8173-C26865B49F2A@csic.es>
	<3996875F-3708-4E40-8CD5-FD46122DD5B6@csic.es>
Message-ID: <43efc644-836c-f638-fa07-1cb169cbebb0@uni-muenster.de>

As for gstat: I think you can't with krigeST, but you may succeed with
krige when you take time as the third dimension -- of course this
constrains the variogram models you can choose from to the metric model.

On 08/11/16 23:35, Santiago Beguer?a Portugu?s wrote:
> Dear R-sig-geo list members,
> 
> I am working on a spatio-temporal kriging model (using gstat::krigeST) of two closely related variables. I?m getting good results on one of them, and not so good on the other. Since both dependent variables are inter-related, I expect that co-kringing would be a good option (I?ve done this in a spatial-only context with the same two variables and co-kriging proved beneficial).
> 
> So, is it possible to perform spatiotemporal CO-kriging, and if so are you aware of any examples? I have not been able to find any myself.
> 
> Cheers,
> 
> Santiago Beguer?a
> CSIC
> Spain
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161110/9c0d6426/attachment.bin>

From edzer.pebesma at uni-muenster.de  Thu Nov 10 17:15:00 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 10 Nov 2016 17:15:00 +0100
Subject: [R-sig-Geo] Write sf object to spatialite database
In-Reply-To: <41f556fb-fddd-fd32-41b6-19d1e9f8a9c7@conabio.gob.mx>
References: <41f556fb-fddd-fd32-41b6-19d1e9f8a9c7@conabio.gob.mx>
Message-ID: <78d3d101-9dc0-f037-90cf-ba00b0dace57@uni-muenster.de>

Thanks for trying.

I guess the sqlite session needs to be loaded with the spatialite
libraries before we can use the spatial functions, like
AddGeometryColumn, where it breaks on my machine:

> st_write_db(con, sf, "meuse_tbl", dropTable = FALSE)
Error in sqliteSendQuery(con, statement, bind.data) :
  error in statement: no such function: AddGeometryColumn

For postgis, we of course assume that the database has the PostGIS
extensions loaded, on a "raw" PostgreSQL database you'll get the same
error, I'd expect.

To get back to your first question: does your st_drivers() include
spatialite?

> x = st_drivers()
> x[x$name == "SQLite",]
      name           long_name write  copy is_raster is_vector
151 SQLite SQLite / Spatialite  TRUE FALSE     FALSE      TRUE

In that case, you may want to use st_write instead.

On 10/11/16 15:47, Lo?c Dutrieux wrote:
> Hi,
> 
> Is it possible to write sf objects to spatialite databases? I tried to
> adapt the postgis example of the st_write_db function but I get the
> following error:
> 
> Error in sqliteSendQuery(con, statement, bind.data) :
> error in statement: no such function: AddGeometryColumn
> 
> Cheers,
> Lo?c
> 
> library(sf)
> library(sp)
> library(RSQLite)
> 
> data(meuse)
> sf = st_as_sf(meuse, coords = c("x", "y"), crs = 28992)
> 
> # I created the db with QGIS, I don't know how to do otherwise
> con <- dbConnect(RSQLite::SQLite(), '~/sandbox/db.sqlite')
> 
> st_write_db(con, sf, "meuse_tbl", dropTable = FALSE)
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161110/2ec3af19/attachment.bin>

From loic.dutrieux at conabio.gob.mx  Thu Nov 10 17:58:02 2016
From: loic.dutrieux at conabio.gob.mx (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Thu, 10 Nov 2016 17:58:02 +0100
Subject: [R-sig-Geo] Write sf object to spatialite database
In-Reply-To: <78d3d101-9dc0-f037-90cf-ba00b0dace57@uni-muenster.de>
References: <41f556fb-fddd-fd32-41b6-19d1e9f8a9c7@conabio.gob.mx>
	<78d3d101-9dc0-f037-90cf-ba00b0dace57@uni-muenster.de>
Message-ID: <8b50c28d-5317-31ac-0ceb-86d0bf3ea0bc@conabio.gob.mx>



On 10/11/2016 17:15, Edzer Pebesma wrote:
> Thanks for trying.
> 
> I guess the sqlite session needs to be loaded with the spatialite
> libraries before we can use the spatial functions, like
> AddGeometryColumn, where it breaks on my machine:
> 

I thought I did, but I'm no expert in databases, when I run

dplyr::src_sqlite('~/sandbox/db.sqlite')

rc:  sqlite 3.8.6 [~/sandbox/db.sqlite]
tbls: ElementaryGeometries, geom_cols_ref_sys, geometry_columns,
geometry_columns_auth,
geometry_columns_field_infos, geometry_columns_statistics,
geometry_columns_time, meuse_tbl,
SpatialIndex, spatialite_history, spatial_ref_sys, spatial_ref_sys_all,
spatial_ref_sys_aux,
sqlite_sequence, sql_statements_log, vector_layers, vector_layers_auth,
vector_layers_field_infos, vector_layers_statistics, views_geometry_columns,
views_geometry_columns_auth, views_geometry_columns_field_infos,
views_geometry_columns_statistics, virts_geometry_columns,
virts_geometry_columns_auth,
virts_geometry_columns_field_infos, virts_geometry_columns_statistics

Doesn't it mean that all the spatial extensions of sqlite are loaded?

>> st_write_db(con, sf, "meuse_tbl", dropTable = FALSE)
> Error in sqliteSendQuery(con, statement, bind.data) :
>   error in statement: no such function: AddGeometryColumn
> 
> For postgis, we of course assume that the database has the PostGIS
> extensions loaded, on a "raw" PostgreSQL database you'll get the same
> error, I'd expect.
> 
> To get back to your first question: does your st_drivers() include
> spatialite?

yes it does.
That way I managed to write to the database (created on the fly if it
doesn't exist). I did not manage to add several tables to the same
database though.


st_write(sf, dsn = '/home/loic/sandbox/db2.sqlite', layer = 'meuse1',
driver = 'SQLite')
st_write(sf, dsn = '/home/loic/sandbox/db2.sqlite', layer = 'meuse2',
driver = 'SQLite')
ogrListLayers('/home/loic/sandbox/db2.sqlite')

[1] "meuse2"
attr(,"driver")
[1] "SQLite"
attr(,"nlayers")
[1] 1

I remember a similar issue/limitation with writeOGR
http://r-sig-geo.2731867.n2.nabble.com/Adding-spatial-tables-to-existing-SpatiaLite-DBs-td7589137.html

Cheers,
Lo?c

> 
>> x = st_drivers()
>> x[x$name == "SQLite",]
>       name           long_name write  copy is_raster is_vector
> 151 SQLite SQLite / Spatialite  TRUE FALSE     FALSE      TRUE
> 
> In that case, you may want to use st_write instead.
> 
> On 10/11/16 15:47, Lo?c Dutrieux wrote:
>> Hi,
>>
>> Is it possible to write sf objects to spatialite databases? I tried to
>> adapt the postgis example of the st_write_db function but I get the
>> following error:
>>
>> Error in sqliteSendQuery(con, statement, bind.data) :
>> error in statement: no such function: AddGeometryColumn
>>
>> Cheers,
>> Lo?c
>>
>> library(sf)
>> library(sp)
>> library(RSQLite)
>>
>> data(meuse)
>> sf = st_as_sf(meuse, coords = c("x", "y"), crs = 28992)
>>
>> # I created the db with QGIS, I don't know how to do otherwise
>> con <- dbConnect(RSQLite::SQLite(), '~/sandbox/db.sqlite')
>>
>> st_write_db(con, sf, "meuse_tbl", dropTable = FALSE)
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 819 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161110/b90bbd87/attachment.bin>

From Roger.Bivand at nhh.no  Thu Nov 10 19:18:17 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 10 Nov 2016 19:18:17 +0100
Subject: [R-sig-Geo] rgdal 1.2-3 on CRAN: breaking change in rgdal::readOGR()
Message-ID: <alpine.LFD.2.20.1611101858190.6208@reclus.nhh.no>

Following the question put on this list at:

https://stat.ethz.ch/pipermail/r-sig-geo/2016-October/025038.html

about the default for reading 64-bit integers using rgdal::readOGR(), a 
possibly breaking change has been made. The doodle vote came down very 
strongly in favour of changing the previous "allow.loss" default to 
"no.loss", nobody supported keeping "allow.loss".

Previously, if the int64 fitted into a signed int32, things worked, but 
broke silently if values overflowed for GDAL >= 2 (GDAL < 2 did not have 
64-bit integers). Now the default is to treat all 64-bit integers as 
strings - think of US Census block numbers. Users will see consequences 
from this if the expectation in scripts was an integer value (ASDAR code 
has been updated on the book website). See the function help page and 
examples for more details. When in doubt, use ogrInfo() to check field 
types before reading.

For some, the GDAL1_integer64_policy argument may be helpful; it is set to 
FALSE by default, but if TRUE will do what GDAL < 2 did, and return 
numeric (floating point) values when integers were specified in a field 
too wide for 32-bit integers (typically in Shapefiles where most of the 
misery - as always - occurs). If many users feel it necessary, I can add a 
once-per-session option to set this argument.

In addition, rgdal::readOGR() will no longer throw an error if the layer 
argument is missing, but will ask the data source name (dsn) argument for 
a list of layers. If only one is found, it will be used silently, if more 
than one, the first will be used and a warning given. This should 
correspond to sf::st_read().

Functions opening raster files may pass open options when linked to GDAL 
>= 2; very few drivers accept such options, but as GDAL 2 provides this 
possibility, it is now provided.

Hope this makes sense,

Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From thayse.nery at hotmail.com  Fri Nov 11 16:06:08 2016
From: thayse.nery at hotmail.com (Thayse Nery)
Date: Fri, 11 Nov 2016 15:06:08 +0000
Subject: [R-sig-Geo] Moran's I test for spatial autocorrelation - "spdep"
	package
Message-ID: <BN3PR05MB2449883A699334D73BE59AD2F3BB0@BN3PR05MB2449.namprd05.prod.outlook.com>

Dear all,


I would like to use the Moran's I test for residual spatial autocorrelation. My dataset is in the long format [70000 , 17]  and represents a time series of Land Use and Land Cover Changes. Since I have identical x and y coordinates, I am having trouble in performing the Moran's test using the "spdep" package. I am able to perform the Moran's test if I consider only one year at time, but I need to perform the analyse for the whole dataset. My dataframe is called trainData.


Below are the steps I have done:

xy <- as.matrix(trainData [, c(5:6)])

neighb.k1 <- knn2nb(knearneigh(xy , k=2, longlat=FALSE))
distance <- max(unlist(nbdists(neighb.k1, xy, longlat=FALSE)))
summary(distance)

# Error in  assign neighbors based on a specified distance, all values = 0
#Because of this error I am not able to continue the analysis
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
#    0       0       0       0       0       0

gc.nb <- dnearneigh(xy, 0, distance, longlat=FALSE)

### 2. Assign weights to the areas that are linked by by creating a spatial weights matrix
MyData_neighb_w <- nb2listw(gc.nb, zero.policy=T) #

## 3. Run statistical test to examine spatial autocorrelation (Moran's I on the DV)
DV_SpatialAut <- moran.test(trainData$currentState, listw=MyData_neighb_w)

### 4. Test the Spatial autocorrelation in residuals:
## 4.1. Run the Multinomial Logit Model

FitVglm is the Model

## Calculate the weighted matrix for the residuals from multinomial logit model
MyDataFinal2 <- MyDataFinal
MyDataFinal2$mlmresid <- residuals(FitVgamx)

lm.morantest(FitVgamx, resfun=MyData_neighb_w)

Is it possible to test for residual spatial autocorrelation for a time series data with identical x and y coordinates using the "spdep" package?

Thank you in advance for any help you can provide.



Thayse Nery

PhD. Student
School of Agricultural and Resource Economics (M089)
The University of Western Australia

	[[alternative HTML version deleted]]


From Bastien.Ferland-Raymond at mffp.gouv.qc.ca  Fri Nov 11 17:50:50 2016
From: Bastien.Ferland-Raymond at mffp.gouv.qc.ca (Bastien.Ferland-Raymond at mffp.gouv.qc.ca)
Date: Fri, 11 Nov 2016 11:50:50 -0500
Subject: [R-sig-Geo] bug in raster::stackApply when raster not in memory
Message-ID: <C7B438E60ECB004081D1410F788C62E546F88C2E1E@HUARD.intranet.MRN.GOUV>

Dear list,

I think I've found a bug with the stackApply() function of the raster package.  The bug was already pointed out at : 
http://r-sig-geo.2731867.n2.nabble.com/raster-stackApply-problems-td7589291.html

It says that it was fixed, however I think it wasn't 100% fixed.  I've experienced the same problem with a raster the isn't in memory.

Here an example.  (I'm sorry you have to download files, I've couldn't manage to reproduce the problem with R-made rasters)

################

## download these four rasters:
https://www.dropbox.com/sh/aoxou1qiqxdiskk/AAAMHeDio6FW6eLDqjMshP2Ka?dl=0

library(raster)

sta <- stack("G:\\ layer_1.tif","G:\\ layer_2.tif","G:\\ layer_3.tif","G:\\ layer_4.tif")

indices <- c(1,2,2,3)
stackApply(sta, indices, fun=sum)  

indices <- c(3,2,2,1)
stackApply(sta, indices, fun=sum)

##  If you compare the max-min, you'll see it's not the same between the two calls of stackApply(). 
##  However, the way the function is described in the help, only the names should be different, not the max-min

##  Interestingly, this problem doesn't happen if we crop the file small enough the stack become in memory

e <- extent(-515000,-460000,635420,708890)
sta.crop <- crop(sta,e) 

indices <- c(1,2,2,3)
stackApply(sta.crop, indices, fun=sum)  ### This one works fine!

indices <- c(3,2,2,1)
stackApply(sta.crop, indices, fun=sum)

##  This time is the same (and good) results between the two calls!

##############

BTW, I'm using R 3.3.2 64bits and the latest raster package version from CRAN.

Is it really a bug or I'm doing something wrong?

Thanks for your help,

Bastien Ferland-Raymond
Division des orientations et des projets sp?ciaux
Direction des inventaires forestiers
Minist?re des For?ts, de la Faune et des Parcs


From Roger.Bivand at nhh.no  Sat Nov 12 14:08:20 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 12 Nov 2016 14:08:20 +0100
Subject: [R-sig-Geo] Moran's I test for spatial autocorrelation -
 "spdep" package
In-Reply-To: <BN3PR05MB2449883A699334D73BE59AD2F3BB0@BN3PR05MB2449.namprd05.prod.outlook.com>
References: <BN3PR05MB2449883A699334D73BE59AD2F3BB0@BN3PR05MB2449.namprd05.prod.outlook.com>
Message-ID: <alpine.LFD.2.20.1611121339530.30117@reclus.nhh.no>

On Fri, 11 Nov 2016, Thayse Nery wrote:

> Dear all,
>
>
> I would like to use the Moran's I test for residual spatial 
> autocorrelation. My dataset is in the long format [70000 , 17] and 
> represents a time series of Land Use and Land Cover Changes. Since I 
> have identical x and y coordinates, I am having trouble in performing 
> the Moran's test using the "spdep" package. I am able to perform the 
> Moran's test if I consider only one year at time, but I need to perform 
> the analyse for the whole dataset. My dataframe is called trainData.

Exactly, the duplicate points are the problem, but the point to major 
flaws in your whole workflow. The repeated observations of land use over 
time are not independent of previous time periods, and the modelling 
exercise is inappropriate too.

Read up about balanced spatial panel models, and re-figure your data to 
suit.

Next, obviously you are working with a categorial response, for which 
Moran's I is most likely inappropriate. You certainly should never test 
your categorical current state as if it was continuous. You can use 
join-count statistics, and you may be able to use join-count statistics on 
transitions.

You do not have 70,000 observations, you have NxT=70,000 observations, 
where for us N and T are unknown. Since you are using point support (most 
likely highly inappropriate), we know nothing about your spatial entities, 
which are most likely either raster cells or areal units.

If you think in spatial panel terms, you can generate an NxT by NxT 
sparse weights matrix using a Kronecker product, then join-counts on your 
categories, transitions, or differences in category between training and 
test sets. If N is not too big, you may be able to find something in the 
Spatial Filtering literature. Look at the spatial discrete choice 
literature, but even there, you'll probably not find spatial panel 
discrete choice, see for example from 5 years ago:

http://pages.stern.nyu.edu/~wgreene/SpatialDiscreteChoiceModels.pdf

My reply to a question like yours:

https://stat.ethz.ch/pipermail/r-sig-geo/2013-October/019586.html

stands. Consider contacting the authors of:

http://w3.avignon.inra.fr/sew2012/slides/3_Diallo_Geniaux.pdf

to ask whether anything is published and whether they could join this 
thread.

If your data are raster cells, autocorrelation will be very strong because 
homogeneous land use/cover areas are divided between many neighbouring 
cells; if your data are the land use/cover areas, parts of the areas may 
change category over time. Your approach will have to vary depending on 
your actual support, and point support should be motivated (sampling LUC 
maps across time at points??).

Hope this clarifies,

Roger

PS. reply to yourself in-thread to your R-help posting giving the link to 
this thread:

https://stat.ethz.ch/pipermail/r-sig-geo/2016-November/025105.html

>
>
> Below are the steps I have done:
>
> xy <- as.matrix(trainData [, c(5:6)])
>
> neighb.k1 <- knn2nb(knearneigh(xy , k=2, longlat=FALSE))
> distance <- max(unlist(nbdists(neighb.k1, xy, longlat=FALSE)))
> summary(distance)
>
> # Error in  assign neighbors based on a specified distance, all values = 0
> #Because of this error I am not able to continue the analysis
> # Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
> #    0       0       0       0       0       0
>
> gc.nb <- dnearneigh(xy, 0, distance, longlat=FALSE)
>
> ### 2. Assign weights to the areas that are linked by by creating a spatial weights matrix
> MyData_neighb_w <- nb2listw(gc.nb, zero.policy=T) #
>
> ## 3. Run statistical test to examine spatial autocorrelation (Moran's I on the DV)
> DV_SpatialAut <- moran.test(trainData$currentState, listw=MyData_neighb_w)
>
> ### 4. Test the Spatial autocorrelation in residuals:
> ## 4.1. Run the Multinomial Logit Model
>
> FitVglm is the Model
>
> ## Calculate the weighted matrix for the residuals from multinomial logit model
> MyDataFinal2 <- MyDataFinal
> MyDataFinal2$mlmresid <- residuals(FitVgamx)
>
> lm.morantest(FitVgamx, resfun=MyData_neighb_w)
>
> Is it possible to test for residual spatial autocorrelation for a time 
> series data with identical x and y coordinates using the "spdep" 
> package?
>
> Thank you in advance for any help you can provide.
>
>
>
> Thayse Nery
>
> PhD. Student
> School of Agricultural and Resource Economics (M089)
> The University of Western Australia
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From mel at mbacou.com  Mon Nov 14 04:07:25 2016
From: mel at mbacou.com (Bacou, Melanie)
Date: Sun, 13 Nov 2016 22:07:25 -0500
Subject: [R-sig-Geo] Generate CDL (metadata) for NetCDF files?
Message-ID: <214e6112-7a36-299c-d1ff-c3c89986b139@mbacou.com>

Hi,
I need to generate a large series of NetCDF files (over 800) and I'm 
trying to follow good metadata practices per 
http://www.unidata.ucar.edu/software/netcdf/examples/files.html.

Could some of you suggest an approach to:
1) add projection information to .nc files (using raster::writeRaster or 
another R package, or else another command-line utility), and
2) add variable metadata to .nc files and/or create auxiliary CDL files 
using R?

It's not obvious to me reading rgdal and raster documentation.
Many thanks, --Mel.

-- 
Melanie BACOU
International Food Policy Research Institute
Snr. Program Manager, Spatial Data and Analytics
Work   +1(202)862-5699
E-mail m.bacou at cgiar.org
Visit  www.harvestchoice.org


From tea3rd at gmail.com  Mon Nov 14 04:39:30 2016
From: tea3rd at gmail.com (Thomas Adams)
Date: Sun, 13 Nov 2016 22:39:30 -0500
Subject: [R-sig-Geo] Generate CDL (metadata) for NetCDF files?
In-Reply-To: <214e6112-7a36-299c-d1ff-c3c89986b139@mbacou.com>
References: <214e6112-7a36-299c-d1ff-c3c89986b139@mbacou.com>
Message-ID: <CAGxgkWj+OHu1hoZfgC6tETea7fp8AqPo52hX8kkjxnXXLkNcWw@mail.gmail.com>

Hi Melanie,

Undoubtedly, there is an R only solution, but I find it far easier to use
GRASS GIS with the r.out.gdal command. A simple bash shell script can do
this. I just verified this with an arbitrary region over N America from a
global dataset of the Canadian CMC ensemble numerical weather prediction
modeling system. The original data I had imported into GRASS was grib2
format...

Best,
Tom

On Sun, Nov 13, 2016 at 10:07 PM, Bacou, Melanie <mel at mbacou.com> wrote:

> Hi,
> I need to generate a large series of NetCDF files (over 800) and I'm
> trying to follow good metadata practices per
> http://www.unidata.ucar.edu/software/netcdf/examples/files.html.
>
> Could some of you suggest an approach to:
> 1) add projection information to .nc files (using raster::writeRaster or
> another R package, or else another command-line utility), and
> 2) add variable metadata to .nc files and/or create auxiliary CDL files
> using R?
>
> It's not obvious to me reading rgdal and raster documentation.
> Many thanks, --Mel.
>
> --
> Melanie BACOU
> International Food Policy Research Institute
> Snr. Program Manager, Spatial Data and Analytics
> Work   +1(202)862-5699
> E-mail m.bacou at cgiar.org
> Visit  www.harvestchoice.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Thomas E Adams, III
1724 Sage Lane
Blacksburg, VA 24060
tea3rd at gmail.com (personal)
tea at terrapredictions.org (work)

1 (513) 739-9512 (cell)

	[[alternative HTML version deleted]]


From Andy.Bunn at wwu.edu  Mon Nov 14 22:33:50 2016
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Mon, 14 Nov 2016 21:33:50 +0000
Subject: [R-sig-Geo] GLOBE DEM in R?
In-Reply-To: <BY2PR09MB0676B5B1E702587335165D3781B80@BY2PR09MB0676.namprd09.prod.outlook.com>
References: <BY2PR09MB0676B5B1E702587335165D3781B80@BY2PR09MB0676.namprd09.prod.outlook.com>
Message-ID: <D44F6DA2.5EC83%andy.bunn@wwu.edu>

Cool. Thanks for the suggestions all.

On 11/10/16, 5:59 AM, "R-sig-Geo on behalf of Hollister, Jeff"
<r-sig-geo-bounces at r-project.org on behalf of Hollister.Jeff at epa.gov>
wrote:

>Andy,
>
>I have been working on a package for accessing elevation data, elevatr.
>It is not yet on CRAN, but you can get the current version at
>https://github.com/jhollist/elevatr.
>
>For points it is currently using the USGS EPQS and Mapzen's Elevation
>Service.  The Mapzen elevation service does have global coverage and
>pulls from a variety of sources.  For higher latitudes it is using GMTED.
>
>You'll probably run into service limits.  I'm hoping to add some
>functionality that will conform to Mapzen's limits, but that hasn't been
>done yet...
>
>Any questions or comments about the package, let me know.
>
>Cheers,
>Jeff
>
>------------------------------
>
>Message: 2
>Date: Wed, 9 Nov 2016 22:07:35 +0000
>From: Andy Bunn <Andy.Bunn at wwu.edu>
>To: R-sig-Geo <r-sig-geo at r-project.org>
>Subject: [R-sig-Geo] GLOBE DEM in R?
>Message-ID: <D448DE23.5EA20%andy.bunn at wwu.edu>
>Content-Type: text/plain; charset="UTF-8"
>
>Is the GLOBE DEM accessible in R via a package? I usually use
>raster::getData() when I need elev data but I need to sample a SPDF of a
>few thousand points with latitudes higher than the SRTM covers. Thoughts
>appreciated.
>
>-Andy
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From perep1972 at gmail.com  Sat Nov 19 23:50:41 2016
From: perep1972 at gmail.com (Pedro Perez)
Date: Sat, 19 Nov 2016 18:50:41 -0400
Subject: [R-sig-Geo] Problems with SpatialPixelsDataFrame objects
Message-ID: <CAD2jFn9R3mmd+50F-DAbQoGqjUWwbUa1YA6ZU5uOjhxgciKPsg@mail.gmail.com>

Hi everybody,

The following two scripts will generate a "SpatialPixelDataFrame" object:

# FIRST
library(rgdal)
elev.grid <- readGDAL("whatever.asc")
elev.grid <- as(elev.grid, "SpatialPixelsDataFrame")

# SECOND
library(raster)
library(SDMTools)
library(adehabitat)
elev.grid <- raster("whatever.asc")
elev.grid.asc <- asc.from.raster(elev.grid)
elev.grid.SPDF <- asc2spixdf(elev.grid.asc)


HOWEVER, the first one excedes the capability of my computing
resources when applying it to big (15000 x 16000) grids, and the
second one generates an object which I can't use for some further
analyses. For example, when I use it for krige purposes

x <- krige(V3~var, points, elev.grid)

I get the following:

Error in model.frame.default(terms(formula), as(data, "data.frame"),
na.action = na.fail) :
  invalid type (closure) for variable 'var'

I will be really thankful if somebody is kind enough to tell me how to
fix it, whether providing me a trick to handle the memory/capability
issue of the first case, or fixing the error generated by the second
case.

THANKS A LOT IN ADVANCE!!!

Paolo


From zia207 at gmail.com  Sun Nov 20 14:35:55 2016
From: zia207 at gmail.com (Zia Ahmed)
Date: Sun, 20 Nov 2016 19:35:55 +0600
Subject: [R-sig-Geo] Problems with SpatialPixelsDataFrame objects
In-Reply-To: <CAD2jFn9R3mmd+50F-DAbQoGqjUWwbUa1YA6ZU5uOjhxgciKPsg@mail.gmail.com>
References: <CAD2jFn9R3mmd+50F-DAbQoGqjUWwbUa1YA6ZU5uOjhxgciKPsg@mail.gmail.com>
Message-ID: <CAKqUiG=mvUza8ozWxKu4Ui0ky9uppVR=O9n9LEpyxmj-R=UTbw@mail.gmail.com>

Dear List,
I am trying to calculate

*GLCM textures of all bands of a raster stack using GLCM package.  Using
following code it runs perfectly. The code created  four stacks for each
bands,  each stack contains for 8 raster objects,   but I am facing
difficulty  to get results for further analysis.  I appreciate if some one
help me out how to extract  four raster stacks from the results (glcm.all).*

*Thanks*

*Zia*



> library(glcm)> library(raster)> library(doParallel)> > names(L5TSR_1986)[1] "b1" "b2" "b3" "b4"> > start.time <- Sys.time()> > foreach(rasname = iter(names(L5TSR_1986)), .packages = "raster") %dopar% {+   glcm.all <-  glcm(L5TSR_1986[[rasname]])+   +   }[[1]]
class       : RasterStack
dimensions  : 167, 213, 35571, 8  (nrow, ncol, ncell, nlayers)
resolution  : 30, 30  (x, y)
extent      : 826245, 832635, 1107825, 1112835  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=16 +ellps=WGS84 +units=m +no_defs
names       :   glcm_mean, glcm_variance, glcm_homogeneity,
glcm_contrast, glcm_dissimilarity, glcm_entropy, glcm_second_moment,
glcm_correlation
min values  :  0.05902778,    3.10906455,       0.02218517,
0.00000000,         0.00000000,   0.00000000,         0.11111111,
       -Inf
max values  :   0.6927083,   497.8806062,        1.0000000,
118.5555556,          9.6666667,    2.1972246,          1.0000000,
         Inf


[[2]]
class       : RasterStack
dimensions  : 167, 213, 35571, 8  (nrow, ncol, ncell, nlayers)
resolution  : 30, 30  (x, y)
extent      : 826245, 832635, 1107825, 1112835  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=16 +ellps=WGS84 +units=m +no_defs
names       :   glcm_mean, glcm_variance, glcm_homogeneity,
glcm_contrast, glcm_dissimilarity, glcm_entropy, glcm_second_moment,
glcm_correlation
min values  :  0.04687500,    1.84165521,       0.03395896,
0.00000000,         0.00000000,   0.00000000,         0.11111111,
       -Inf
max values  :   0.7361111,   556.6514305,        1.0000000,
94.7777778,          8.7777778,    2.1972246,          1.0000000,
        Inf


[[3]]
class       : RasterStack
dimensions  : 167, 213, 35571, 8  (nrow, ncol, ncell, nlayers)
resolution  : 30, 30  (x, y)
extent      : 826245, 832635, 1107825, 1112835  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=16 +ellps=WGS84 +units=m +no_defs
names       :   glcm_mean, glcm_variance, glcm_homogeneity,
glcm_contrast, glcm_dissimilarity, glcm_entropy, glcm_second_moment,
glcm_correlation
min values  :  0.03993056,    0.91840278,       0.02775318,
0.00000000,         0.00000000,   0.00000000,         0.11111111,
       -Inf
max values  :   0.7291667,   572.3779206,        1.0000000,
147.5555556,         10.8888889,    2.1972246,          1.0000000,
         Inf


[[4]]
class       : RasterStack
dimensions  : 167, 213, 35571, 8  (nrow, ncol, ncell, nlayers)
resolution  : 30, 30  (x, y)
extent      : 826245, 832635, 1107825, 1112835  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=16 +ellps=WGS84 +units=m +no_defs
names       :   glcm_mean, glcm_variance, glcm_homogeneity,
glcm_contrast, glcm_dissimilarity, glcm_entropy, glcm_second_moment,
glcm_correlation
min values  :  0.07812500,    3.79071422,       0.02196611,
0.00000000,         0.00000000,   0.00000000,         0.11111111,
       -Inf
max values  :   0.8975694,   803.7921278,        1.0000000,
160.1111111,         10.6666667,    2.1972246,          1.0000000,
         Inf

> > end.time <- Sys.time()> time.taken <- end.time - start.time> time.takenTime difference of 7.402473 secs


>


On Sun, Nov 20, 2016 at 4:50 AM, Pedro Perez <perep1972 at gmail.com> wrote:

> Hi everybody,
>
> The following two scripts will generate a "SpatialPixelDataFrame" object:
>
> # FIRST
> library(rgdal)
> elev.grid <- readGDAL("whatever.asc")
> elev.grid <- as(elev.grid, "SpatialPixelsDataFrame")
>
> # SECOND
> library(raster)
> library(SDMTools)
> library(adehabitat)
> elev.grid <- raster("whatever.asc")
> elev.grid.asc <- asc.from.raster(elev.grid)
> elev.grid.SPDF <- asc2spixdf(elev.grid.asc)
>
>
> HOWEVER, the first one excedes the capability of my computing
> resources when applying it to big (15000 x 16000) grids, and the
> second one generates an object which I can't use for some further
> analyses. For example, when I use it for krige purposes
>
> x <- krige(V3~var, points, elev.grid)
>
> I get the following:
>
> Error in model.frame.default(terms(formula), as(data, "data.frame"),
> na.action = na.fail) :
>   invalid type (closure) for variable 'var'
>
> I will be really thankful if somebody is kind enough to tell me how to
> fix it, whether providing me a trick to handle the memory/capability
> issue of the first case, or fixing the error generated by the second
> case.
>
> THANKS A LOT IN ADVANCE!!!
>
> Paolo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Zia Uddin Ahmed, PhD
CIMMYT

	[[alternative HTML version deleted]]


From milujisb at gmail.com  Sun Nov 20 20:14:34 2016
From: milujisb at gmail.com (Miluji Sb)
Date: Sun, 20 Nov 2016 20:14:34 +0100
Subject: [R-sig-Geo] Error in Spatial lag model
Message-ID: <CAMLwc7Pff2JxZ-krXbA_5K4gAr5+3gLGbq8fc-CP1BTMte5DGg@mail.gmail.com>

I have a dataset as below (with NAs). I am trying to run a spatial lagged
model

##
E2_mod_pdssat <- as.data.frame(gcp_t_p[,c(2,3)])
names(E2_mod_pdssat) <- c("Lon", "Lat")
row.names(E2_mod_pdssat) <- NULL

coords_matrix  <- as.matrix(E2_mod_pdssat) # create coordinate matrix
IDs <- row.names(as(E2_mod_pdssat, "data.frame"))

spatial_knn2nb_obj <- knn2nb(knearneigh(coords_matrix, k=2, longlat=TRUE),
row.names=IDs)

# Now convert the nb to listw for use in spatial regression call.
# Spatial weights, illustrated with coding style "W" (row standardized)

spatial_knn2listw_obj <- nb2listw(spatial_knn2nb_obj, glist=NULL,
style="W",  zero.policy=TRUE)

E2_mod_pdssat_org_lon_lat <- E2_mod_pdssat_org[, c(2:3)] # The lon and lat
will be required
E2_mod_pdssat_org <- E2_mod_pdssat_org[, -c(2,3)]  # Remove the Lon, Lat
columns that are not required

E2_mod_pdssat_pdata_frame <- pdata.frame(E2_mod_pdssat_org) # Convert data
frame to pdata.frame

All goes well until here but when I try to convert the explanatory
variables in the pdata.frame to spatial lagged variables

E2_mod_pdssat_X_lagged <-
as.data.frame(cbind(slag(E2_mod_pdssat_pdata_frame$tmean, listw =
spatial_knn2listw_obj),
slag(E2_mod_pdssat_pdata_frame$tmeansq, listw = spatial_knn2listw_obj),
slag(E2_mod_pdssat_pdata_frame$pmean, listw = spatial_knn2listw_obj),
slag(E2_mod_pdssat_pdata_frame$pmeansq, listw = spatial_knn2listw_obj)))

I get the following error "Error in lag.listw(listw, xt) : object lengths
differ". What am I doing wrong? I have also tried removing the NAs with
complete.cases.

Any help will be greatly appreciated. Thank you.

Sincerely,

Milu

## Data

E2_mod_pdssat_org <- dput(head(temp,5))
structure(list(iso3 = structure(c(30L, 30L, 30L, 1L, 30L), .Label = c(".",
".M", "AFG", "AGO", "ALB", "ARE", "ARG", "ARM", "AUS", "AUT",
"AZE", "BDI", "BEL", "BEN", "BFA", "BGD", "BGR", "BHS", "BIH",
"BLR", "BLZ", "BOL", "BRA", "BRN", "BTN", "BWA", "CAF", "CAN",
"CHE", "CHL", "CHN", "CIV", "CMR", "COD", "COG", "COL", "CRI",
"CUB", "CYP", "CZE", "DEU", "DJI", "DNK", "DOM", "DZA", "ECU",
"EGY", "ERI", "ESH", "ESP", "EST", "ETH", "FIN", "FJI", "FLK",
"FRA", "GAB", "GBR", "GEO", "GHA", "GIN", "GNB", "GNQ", "GRC",
"GRL", "GTM", "GUF", "GUY", "HND", "HRV", "HTI", "HUN", "IDN",
"IND", "IRL", "IRN", "IRQ", "ISL", "ISR", "ITA", "JAM", "JOR",
"JPN", "KAZ", "KEN", "KGZ", "KHM", "KIR", "KOR", "KWT", "LAO",
"LBN", "LBR", "LBY", "LCA", "LKA", "LSO", "LTU", "LUX", "LVA",
"MAR", "MDA", "MDG", "MEX", "MKD", "MLI", "MMR", "MNE", "MNG",
"MOZ", "MRT", "MWI", "MYS", "NCL", "NER", "NGA", "NIC", "NLD",
"NOR", "NPL", "NZL", "OMN", "PAK", "PAN", "PER", "PHL", "PNG",
"POL", "PRI", "PRK", "PRT", "PRY", "QAT", "ROU", "RUS", "RWA",
"SAU", "SDN", "SEN", "SJM", "SLB", "SLE", "SLV", "SOM", "SRB",
"SUR", "SVK", "SVN", "SWE", "SWZ", "SYR", "TCD", "TGO", "THA",
"TJK", "TKM", "TLS", "TUN", "TUR", "TWN", "TZA", "UGA", "UKR",
"URY", "USA", "UZB", "VEN", "VNM", "VUT", "YEM", "ZAF", "ZMB",
"ZWE"), class = "factor"), lon = c(-69L, -68L, -72L, -71L, -70L
), lat = c(-55L, -55L, -54L, -54L, -54L), tmean = c(NA, NA,
4.55847677595631,
4.06015710382516, 3.71010245901642), pmean = c(NA, NA, 2.45569896697998,
1.6384220123291, 1.43925595283508), lngdp = c(-0.102380074560642,
-2.3195972442627, 0.0122363297268748, -0.483756244182587, -6.29744625091553
), tmeansq = c(NA, NA, 20.7797107696533, 16.4848766326904, 13.7648601531982
), pmeansq = c(NA, NA, 6.03045749664307, 2.68442678451538, 2.07145762443542
)), .Names = c("iso3", "lon", "lat", "tmean", "pmean", "lngdp",
"tmeansq", "pmeansq"), row.names = c("1", "2", "3", "4", "5"), class =
"data.frame")

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Sun Nov 20 20:29:26 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 20 Nov 2016 20:29:26 +0100
Subject: [R-sig-Geo] Error in Spatial lag model
In-Reply-To: <CAMLwc7Pff2JxZ-krXbA_5K4gAr5+3gLGbq8fc-CP1BTMte5DGg@mail.gmail.com>
References: <CAMLwc7Pff2JxZ-krXbA_5K4gAr5+3gLGbq8fc-CP1BTMte5DGg@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1611202021140.26313@reclus.nhh.no>

On Sun, 20 Nov 2016, Miluji Sb wrote:

> I have a dataset as below (with NAs). I am trying to run a spatial lagged
> model
>
> ##
> E2_mod_pdssat <- as.data.frame(gcp_t_p[,c(2,3)])
> names(E2_mod_pdssat) <- c("Lon", "Lat")
> row.names(E2_mod_pdssat) <- NULL
>
> coords_matrix  <- as.matrix(E2_mod_pdssat) # create coordinate matrix
> IDs <- row.names(as(E2_mod_pdssat, "data.frame"))
>
> spatial_knn2nb_obj <- knn2nb(knearneigh(coords_matrix, k=2, longlat=TRUE),
> row.names=IDs)
>
> # Now convert the nb to listw for use in spatial regression call.
> # Spatial weights, illustrated with coding style "W" (row standardized)
>
> spatial_knn2listw_obj <- nb2listw(spatial_knn2nb_obj, glist=NULL,
> style="W",  zero.policy=TRUE)

Did you examine this object? What did the print method tell you?

>
> E2_mod_pdssat_org_lon_lat <- E2_mod_pdssat_org[, c(2:3)] # The lon and lat
> will be required

This object "_org" does not yet exist ...

> E2_mod_pdssat_org <- E2_mod_pdssat_org[, -c(2,3)]  # Remove the Lon, Lat
> columns that are not required
>
> E2_mod_pdssat_pdata_frame <- pdata.frame(E2_mod_pdssat_org) # Convert data
> frame to pdata.frame
>

So you omitted to say that the data are (unbalanced) panel data ...

> All goes well until here but when I try to convert the explanatory
> variables in the pdata.frame to spatial lagged variables
>
> E2_mod_pdssat_X_lagged <-
> as.data.frame(cbind(slag(E2_mod_pdssat_pdata_frame$tmean, listw =
> spatial_knn2listw_obj),
> slag(E2_mod_pdssat_pdata_frame$tmeansq, listw = spatial_knn2listw_obj),
> slag(E2_mod_pdssat_pdata_frame$pmean, listw = spatial_knn2listw_obj),
> slag(E2_mod_pdssat_pdata_frame$pmeansq, listw = spatial_knn2listw_obj)))
>
> I get the following error "Error in lag.listw(listw, xt) : object lengths
> differ". What am I doing wrong? I have also tried removing the NAs with
> complete.cases.

You have defined weights for one object (possibly a cross section), and 
then try to use them on a different object with a different number of 
rows. If you really want to do this, you need a Kronecker product of the 
spatial weights to take the panel structure of your data into account. 
Further, I doubt strongly that you need to create WX manually, because 
spatial lags of all the required variables are created by model fitting 
functions in the splm package.

Roger

>
> Any help will be greatly appreciated. Thank you.
>
> Sincerely,
>
> Milu
>
> ## Data
>
> E2_mod_pdssat_org <- dput(head(temp,5))
> structure(list(iso3 = structure(c(30L, 30L, 30L, 1L, 30L), .Label = c(".",
> ".M", "AFG", "AGO", "ALB", "ARE", "ARG", "ARM", "AUS", "AUT",
> "AZE", "BDI", "BEL", "BEN", "BFA", "BGD", "BGR", "BHS", "BIH",
> "BLR", "BLZ", "BOL", "BRA", "BRN", "BTN", "BWA", "CAF", "CAN",
> "CHE", "CHL", "CHN", "CIV", "CMR", "COD", "COG", "COL", "CRI",
> "CUB", "CYP", "CZE", "DEU", "DJI", "DNK", "DOM", "DZA", "ECU",
> "EGY", "ERI", "ESH", "ESP", "EST", "ETH", "FIN", "FJI", "FLK",
> "FRA", "GAB", "GBR", "GEO", "GHA", "GIN", "GNB", "GNQ", "GRC",
> "GRL", "GTM", "GUF", "GUY", "HND", "HRV", "HTI", "HUN", "IDN",
> "IND", "IRL", "IRN", "IRQ", "ISL", "ISR", "ITA", "JAM", "JOR",
> "JPN", "KAZ", "KEN", "KGZ", "KHM", "KIR", "KOR", "KWT", "LAO",
> "LBN", "LBR", "LBY", "LCA", "LKA", "LSO", "LTU", "LUX", "LVA",
> "MAR", "MDA", "MDG", "MEX", "MKD", "MLI", "MMR", "MNE", "MNG",
> "MOZ", "MRT", "MWI", "MYS", "NCL", "NER", "NGA", "NIC", "NLD",
> "NOR", "NPL", "NZL", "OMN", "PAK", "PAN", "PER", "PHL", "PNG",
> "POL", "PRI", "PRK", "PRT", "PRY", "QAT", "ROU", "RUS", "RWA",
> "SAU", "SDN", "SEN", "SJM", "SLB", "SLE", "SLV", "SOM", "SRB",
> "SUR", "SVK", "SVN", "SWE", "SWZ", "SYR", "TCD", "TGO", "THA",
> "TJK", "TKM", "TLS", "TUN", "TUR", "TWN", "TZA", "UGA", "UKR",
> "URY", "USA", "UZB", "VEN", "VNM", "VUT", "YEM", "ZAF", "ZMB",
> "ZWE"), class = "factor"), lon = c(-69L, -68L, -72L, -71L, -70L
> ), lat = c(-55L, -55L, -54L, -54L, -54L), tmean = c(NA, NA,
> 4.55847677595631,
> 4.06015710382516, 3.71010245901642), pmean = c(NA, NA, 2.45569896697998,
> 1.6384220123291, 1.43925595283508), lngdp = c(-0.102380074560642,
> -2.3195972442627, 0.0122363297268748, -0.483756244182587, -6.29744625091553
> ), tmeansq = c(NA, NA, 20.7797107696533, 16.4848766326904, 13.7648601531982
> ), pmeansq = c(NA, NA, 6.03045749664307, 2.68442678451538, 2.07145762443542
> )), .Names = c("iso3", "lon", "lat", "tmean", "pmean", "lngdp",
> "tmeansq", "pmeansq"), row.names = c("1", "2", "3", "4", "5"), class =
> "data.frame")
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From milujisb at gmail.com  Sun Nov 20 20:50:39 2016
From: milujisb at gmail.com (Miluji Sb)
Date: Sun, 20 Nov 2016 20:50:39 +0100
Subject: [R-sig-Geo] Error in Spatial lag model
In-Reply-To: <alpine.LFD.2.20.1611202021140.26313@reclus.nhh.no>
References: <CAMLwc7Pff2JxZ-krXbA_5K4gAr5+3gLGbq8fc-CP1BTMte5DGg@mail.gmail.com>
	<alpine.LFD.2.20.1611202021140.26313@reclus.nhh.no>
Message-ID: <CAMLwc7Mbveey=Vt=Jy1GWvsS8C1azrgxkhrn0CpKmypOHD9Svw@mail.gmail.com>

Dear Roger,

Thank you for your quick reply.

#
print(spatial_knn2listw_obj)

Characteristics of weights list object:
Neighbour list object:
Number of regions: 10927
Number of nonzero links: 21854
Percentage nonzero weights: 0.01830329
Average number of links: 2
Non-symmetric neighbours list

Weights style: W
Weights constants summary:
      n        nn    S0      S1    S2
W 10927 119399329 10927 10376.5 44660
#

The data is actually cross-sectional, is my mistake converting it
to pdata.frame? I have not tried the splm package, which is a mistake on my
part. I will try that now. Thanks.

Sincerely,

Milu

On Sun, Nov 20, 2016 at 8:29 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Sun, 20 Nov 2016, Miluji Sb wrote:
>
> I have a dataset as below (with NAs). I am trying to run a spatial lagged
>> model
>>
>> ##
>> E2_mod_pdssat <- as.data.frame(gcp_t_p[,c(2,3)])
>> names(E2_mod_pdssat) <- c("Lon", "Lat")
>> row.names(E2_mod_pdssat) <- NULL
>>
>> coords_matrix  <- as.matrix(E2_mod_pdssat) # create coordinate matrix
>> IDs <- row.names(as(E2_mod_pdssat, "data.frame"))
>>
>> spatial_knn2nb_obj <- knn2nb(knearneigh(coords_matrix, k=2,
>> longlat=TRUE),
>> row.names=IDs)
>>
>> # Now convert the nb to listw for use in spatial regression call.
>> # Spatial weights, illustrated with coding style "W" (row standardized)
>>
>> spatial_knn2listw_obj <- nb2listw(spatial_knn2nb_obj, glist=NULL,
>> style="W",  zero.policy=TRUE)
>>
>
> Did you examine this object? What did the print method tell you?
>
>
>> E2_mod_pdssat_org_lon_lat <- E2_mod_pdssat_org[, c(2:3)] # The lon and lat
>> will be required
>>
>
> This object "_org" does not yet exist ...
>
> E2_mod_pdssat_org <- E2_mod_pdssat_org[, -c(2,3)]  # Remove the Lon, Lat
>> columns that are not required
>>
>> E2_mod_pdssat_pdata_frame <- pdata.frame(E2_mod_pdssat_org) # Convert data
>> frame to pdata.frame
>>
>>
> So you omitted to say that the data are (unbalanced) panel data ...
>
> All goes well until here but when I try to convert the explanatory
>> variables in the pdata.frame to spatial lagged variables
>>
>> E2_mod_pdssat_X_lagged <-
>> as.data.frame(cbind(slag(E2_mod_pdssat_pdata_frame$tmean, listw =
>> spatial_knn2listw_obj),
>> slag(E2_mod_pdssat_pdata_frame$tmeansq, listw = spatial_knn2listw_obj),
>> slag(E2_mod_pdssat_pdata_frame$pmean, listw = spatial_knn2listw_obj),
>> slag(E2_mod_pdssat_pdata_frame$pmeansq, listw = spatial_knn2listw_obj)))
>>
>> I get the following error "Error in lag.listw(listw, xt) : object lengths
>> differ". What am I doing wrong? I have also tried removing the NAs with
>> complete.cases.
>>
>
> You have defined weights for one object (possibly a cross section), and
> then try to use them on a different object with a different number of rows.
> If you really want to do this, you need a Kronecker product of the spatial
> weights to take the panel structure of your data into account. Further, I
> doubt strongly that you need to create WX manually, because spatial lags of
> all the required variables are created by model fitting functions in the
> splm package.
>
> Roger
>
>
>> Any help will be greatly appreciated. Thank you.
>>
>> Sincerely,
>>
>> Milu
>>
>> ## Data
>>
>> E2_mod_pdssat_org <- dput(head(temp,5))
>> structure(list(iso3 = structure(c(30L, 30L, 30L, 1L, 30L), .Label = c(".",
>> ".M", "AFG", "AGO", "ALB", "ARE", "ARG", "ARM", "AUS", "AUT",
>> "AZE", "BDI", "BEL", "BEN", "BFA", "BGD", "BGR", "BHS", "BIH",
>> "BLR", "BLZ", "BOL", "BRA", "BRN", "BTN", "BWA", "CAF", "CAN",
>> "CHE", "CHL", "CHN", "CIV", "CMR", "COD", "COG", "COL", "CRI",
>> "CUB", "CYP", "CZE", "DEU", "DJI", "DNK", "DOM", "DZA", "ECU",
>> "EGY", "ERI", "ESH", "ESP", "EST", "ETH", "FIN", "FJI", "FLK",
>> "FRA", "GAB", "GBR", "GEO", "GHA", "GIN", "GNB", "GNQ", "GRC",
>> "GRL", "GTM", "GUF", "GUY", "HND", "HRV", "HTI", "HUN", "IDN",
>> "IND", "IRL", "IRN", "IRQ", "ISL", "ISR", "ITA", "JAM", "JOR",
>> "JPN", "KAZ", "KEN", "KGZ", "KHM", "KIR", "KOR", "KWT", "LAO",
>> "LBN", "LBR", "LBY", "LCA", "LKA", "LSO", "LTU", "LUX", "LVA",
>> "MAR", "MDA", "MDG", "MEX", "MKD", "MLI", "MMR", "MNE", "MNG",
>> "MOZ", "MRT", "MWI", "MYS", "NCL", "NER", "NGA", "NIC", "NLD",
>> "NOR", "NPL", "NZL", "OMN", "PAK", "PAN", "PER", "PHL", "PNG",
>> "POL", "PRI", "PRK", "PRT", "PRY", "QAT", "ROU", "RUS", "RWA",
>> "SAU", "SDN", "SEN", "SJM", "SLB", "SLE", "SLV", "SOM", "SRB",
>> "SUR", "SVK", "SVN", "SWE", "SWZ", "SYR", "TCD", "TGO", "THA",
>> "TJK", "TKM", "TLS", "TUN", "TUR", "TWN", "TZA", "UGA", "UKR",
>> "URY", "USA", "UZB", "VEN", "VNM", "VUT", "YEM", "ZAF", "ZMB",
>> "ZWE"), class = "factor"), lon = c(-69L, -68L, -72L, -71L, -70L
>> ), lat = c(-55L, -55L, -54L, -54L, -54L), tmean = c(NA, NA,
>> 4.55847677595631,
>> 4.06015710382516, 3.71010245901642), pmean = c(NA, NA, 2.45569896697998,
>> 1.6384220123291, 1.43925595283508), lngdp = c(-0.102380074560642,
>> -2.3195972442627, 0.0122363297268748, -0.483756244182587,
>> -6.29744625091553
>> ), tmeansq = c(NA, NA, 20.7797107696533, 16.4848766326904,
>> 13.7648601531982
>> ), pmeansq = c(NA, NA, 6.03045749664307, 2.68442678451538,
>> 2.07145762443542
>> )), .Names = c("iso3", "lon", "lat", "tmean", "pmean", "lngdp",
>> "tmeansq", "pmeansq"), row.names = c("1", "2", "3", "4", "5"), class =
>> "data.frame")
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
>

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Sun Nov 20 21:05:26 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 20 Nov 2016 21:05:26 +0100
Subject: [R-sig-Geo] Error in Spatial lag model
In-Reply-To: <CAMLwc7Mbveey=Vt=Jy1GWvsS8C1azrgxkhrn0CpKmypOHD9Svw@mail.gmail.com>
References: <CAMLwc7Pff2JxZ-krXbA_5K4gAr5+3gLGbq8fc-CP1BTMte5DGg@mail.gmail.com>
	<alpine.LFD.2.20.1611202021140.26313@reclus.nhh.no>
	<CAMLwc7Mbveey=Vt=Jy1GWvsS8C1azrgxkhrn0CpKmypOHD9Svw@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1611202101210.26313@reclus.nhh.no>

On Sun, 20 Nov 2016, Miluji Sb wrote:

> Dear Roger,
>
> Thank you for your quick reply.
>
> #
> print(spatial_knn2listw_obj)
>
> Characteristics of weights list object:
> Neighbour list object:
> Number of regions: 10927
> Number of nonzero links: 21854
> Percentage nonzero weights: 0.01830329
> Average number of links: 2
> Non-symmetric neighbours list
>
> Weights style: W
> Weights constants summary:
>      n        nn    S0      S1    S2
> W 10927 119399329 10927 10376.5 44660
> #
>
> The data is actually cross-sectional, is my mistake converting it
> to pdata.frame? I have not tried the splm package, which is a mistake on my
> part. I will try that now. Thanks.
>

If the data are not a spatial panel, then do not use splm, it is not 
relevant. If you have NAs in the response, you will need to address that 
once you can fit a model with complete cases. You may not have NAs in the 
covariates. I guess that the mistake was slag() and pdata.frame(), but 
your example is no help at all. Are you copying poor code from the 
internet? Why use k=2 (seems very ill-judged) - knn are intrinsically 
asymmetric, why 2?

Roger

> Sincerely,
>
> Milu
>
> On Sun, Nov 20, 2016 at 8:29 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Sun, 20 Nov 2016, Miluji Sb wrote:
>>
>> I have a dataset as below (with NAs). I am trying to run a spatial lagged
>>> model
>>>
>>> ##
>>> E2_mod_pdssat <- as.data.frame(gcp_t_p[,c(2,3)])
>>> names(E2_mod_pdssat) <- c("Lon", "Lat")
>>> row.names(E2_mod_pdssat) <- NULL
>>>
>>> coords_matrix  <- as.matrix(E2_mod_pdssat) # create coordinate matrix
>>> IDs <- row.names(as(E2_mod_pdssat, "data.frame"))
>>>
>>> spatial_knn2nb_obj <- knn2nb(knearneigh(coords_matrix, k=2,
>>> longlat=TRUE),
>>> row.names=IDs)
>>>
>>> # Now convert the nb to listw for use in spatial regression call.
>>> # Spatial weights, illustrated with coding style "W" (row standardized)
>>>
>>> spatial_knn2listw_obj <- nb2listw(spatial_knn2nb_obj, glist=NULL,
>>> style="W",  zero.policy=TRUE)
>>>
>>
>> Did you examine this object? What did the print method tell you?
>>
>>
>>> E2_mod_pdssat_org_lon_lat <- E2_mod_pdssat_org[, c(2:3)] # The lon and lat
>>> will be required
>>>
>>
>> This object "_org" does not yet exist ...
>>
>> E2_mod_pdssat_org <- E2_mod_pdssat_org[, -c(2,3)]  # Remove the Lon, Lat
>>> columns that are not required
>>>
>>> E2_mod_pdssat_pdata_frame <- pdata.frame(E2_mod_pdssat_org) # Convert data
>>> frame to pdata.frame
>>>
>>>
>> So you omitted to say that the data are (unbalanced) panel data ...
>>
>> All goes well until here but when I try to convert the explanatory
>>> variables in the pdata.frame to spatial lagged variables
>>>
>>> E2_mod_pdssat_X_lagged <-
>>> as.data.frame(cbind(slag(E2_mod_pdssat_pdata_frame$tmean, listw =
>>> spatial_knn2listw_obj),
>>> slag(E2_mod_pdssat_pdata_frame$tmeansq, listw = spatial_knn2listw_obj),
>>> slag(E2_mod_pdssat_pdata_frame$pmean, listw = spatial_knn2listw_obj),
>>> slag(E2_mod_pdssat_pdata_frame$pmeansq, listw = spatial_knn2listw_obj)))
>>>
>>> I get the following error "Error in lag.listw(listw, xt) : object lengths
>>> differ". What am I doing wrong? I have also tried removing the NAs with
>>> complete.cases.
>>>
>>
>> You have defined weights for one object (possibly a cross section), and
>> then try to use them on a different object with a different number of rows.
>> If you really want to do this, you need a Kronecker product of the spatial
>> weights to take the panel structure of your data into account. Further, I
>> doubt strongly that you need to create WX manually, because spatial lags of
>> all the required variables are created by model fitting functions in the
>> splm package.
>>
>> Roger
>>
>>
>>> Any help will be greatly appreciated. Thank you.
>>>
>>> Sincerely,
>>>
>>> Milu
>>>
>>> ## Data
>>>
>>> E2_mod_pdssat_org <- dput(head(temp,5))
>>> structure(list(iso3 = structure(c(30L, 30L, 30L, 1L, 30L), .Label = c(".",
>>> ".M", "AFG", "AGO", "ALB", "ARE", "ARG", "ARM", "AUS", "AUT",
>>> "AZE", "BDI", "BEL", "BEN", "BFA", "BGD", "BGR", "BHS", "BIH",
>>> "BLR", "BLZ", "BOL", "BRA", "BRN", "BTN", "BWA", "CAF", "CAN",
>>> "CHE", "CHL", "CHN", "CIV", "CMR", "COD", "COG", "COL", "CRI",
>>> "CUB", "CYP", "CZE", "DEU", "DJI", "DNK", "DOM", "DZA", "ECU",
>>> "EGY", "ERI", "ESH", "ESP", "EST", "ETH", "FIN", "FJI", "FLK",
>>> "FRA", "GAB", "GBR", "GEO", "GHA", "GIN", "GNB", "GNQ", "GRC",
>>> "GRL", "GTM", "GUF", "GUY", "HND", "HRV", "HTI", "HUN", "IDN",
>>> "IND", "IRL", "IRN", "IRQ", "ISL", "ISR", "ITA", "JAM", "JOR",
>>> "JPN", "KAZ", "KEN", "KGZ", "KHM", "KIR", "KOR", "KWT", "LAO",
>>> "LBN", "LBR", "LBY", "LCA", "LKA", "LSO", "LTU", "LUX", "LVA",
>>> "MAR", "MDA", "MDG", "MEX", "MKD", "MLI", "MMR", "MNE", "MNG",
>>> "MOZ", "MRT", "MWI", "MYS", "NCL", "NER", "NGA", "NIC", "NLD",
>>> "NOR", "NPL", "NZL", "OMN", "PAK", "PAN", "PER", "PHL", "PNG",
>>> "POL", "PRI", "PRK", "PRT", "PRY", "QAT", "ROU", "RUS", "RWA",
>>> "SAU", "SDN", "SEN", "SJM", "SLB", "SLE", "SLV", "SOM", "SRB",
>>> "SUR", "SVK", "SVN", "SWE", "SWZ", "SYR", "TCD", "TGO", "THA",
>>> "TJK", "TKM", "TLS", "TUN", "TUR", "TWN", "TZA", "UGA", "UKR",
>>> "URY", "USA", "UZB", "VEN", "VNM", "VUT", "YEM", "ZAF", "ZMB",
>>> "ZWE"), class = "factor"), lon = c(-69L, -68L, -72L, -71L, -70L
>>> ), lat = c(-55L, -55L, -54L, -54L, -54L), tmean = c(NA, NA,
>>> 4.55847677595631,
>>> 4.06015710382516, 3.71010245901642), pmean = c(NA, NA, 2.45569896697998,
>>> 1.6384220123291, 1.43925595283508), lngdp = c(-0.102380074560642,
>>> -2.3195972442627, 0.0122363297268748, -0.483756244182587,
>>> -6.29744625091553
>>> ), tmeansq = c(NA, NA, 20.7797107696533, 16.4848766326904,
>>> 13.7648601531982
>>> ), pmeansq = c(NA, NA, 6.03045749664307, 2.68442678451538,
>>> 2.07145762443542
>>> )), .Names = c("iso3", "lon", "lat", "tmean", "pmean", "lngdp",
>>> "tmeansq", "pmeansq"), row.names = c("1", "2", "3", "4", "5"), class =
>>> "data.frame")
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>> http://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> http://depsy.org/person/434412
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From milujisb at gmail.com  Sun Nov 20 21:59:46 2016
From: milujisb at gmail.com (Miluji Sb)
Date: Sun, 20 Nov 2016 21:59:46 +0100
Subject: [R-sig-Geo] Error in Spatial lag model
In-Reply-To: <alpine.LFD.2.20.1611202101210.26313@reclus.nhh.no>
References: <CAMLwc7Pff2JxZ-krXbA_5K4gAr5+3gLGbq8fc-CP1BTMte5DGg@mail.gmail.com>
	<alpine.LFD.2.20.1611202021140.26313@reclus.nhh.no>
	<CAMLwc7Mbveey=Vt=Jy1GWvsS8C1azrgxkhrn0CpKmypOHD9Svw@mail.gmail.com>
	<alpine.LFD.2.20.1611202101210.26313@reclus.nhh.no>
Message-ID: <CAMLwc7NVnGvG=Pk-=YddoMWFN9Dy-EitKiy68fDc-hid_ikS4Q@mail.gmail.com>

Thanks again for your reply. k=4, I changed that to check what was throwing
the error.

Sorry, this is my first attempt at this - I am reading up and trying to
execute. I would appreciate any guidance. Thanks again.

Sincerely,

Milu


On Sun, Nov 20, 2016 at 9:05 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Sun, 20 Nov 2016, Miluji Sb wrote:
>
> Dear Roger,
>>
>> Thank you for your quick reply.
>>
>> #
>> print(spatial_knn2listw_obj)
>>
>> Characteristics of weights list object:
>> Neighbour list object:
>> Number of regions: 10927
>> Number of nonzero links: 21854
>> Percentage nonzero weights: 0.01830329
>> Average number of links: 2
>> Non-symmetric neighbours list
>>
>> Weights style: W
>> Weights constants summary:
>>      n        nn    S0      S1    S2
>> W 10927 119399329 10927 10376.5 44660
>> #
>>
>> The data is actually cross-sectional, is my mistake converting it
>> to pdata.frame? I have not tried the splm package, which is a mistake on
>> my
>> part. I will try that now. Thanks.
>>
>>
> If the data are not a spatial panel, then do not use splm, it is not
> relevant. If you have NAs in the response, you will need to address that
> once you can fit a model with complete cases. You may not have NAs in the
> covariates. I guess that the mistake was slag() and pdata.frame(), but your
> example is no help at all. Are you copying poor code from the internet? Why
> use k=2 (seems very ill-judged) - knn are intrinsically asymmetric, why 2?
>
> Roger
>
>
> Sincerely,
>>
>> Milu
>>
>> On Sun, Nov 20, 2016 at 8:29 PM, Roger Bivand <Roger.Bivand at nhh.no>
>> wrote:
>>
>> On Sun, 20 Nov 2016, Miluji Sb wrote:
>>>
>>> I have a dataset as below (with NAs). I am trying to run a spatial lagged
>>>
>>>> model
>>>>
>>>> ##
>>>> E2_mod_pdssat <- as.data.frame(gcp_t_p[,c(2,3)])
>>>> names(E2_mod_pdssat) <- c("Lon", "Lat")
>>>> row.names(E2_mod_pdssat) <- NULL
>>>>
>>>> coords_matrix  <- as.matrix(E2_mod_pdssat) # create coordinate matrix
>>>> IDs <- row.names(as(E2_mod_pdssat, "data.frame"))
>>>>
>>>> spatial_knn2nb_obj <- knn2nb(knearneigh(coords_matrix, k=2,
>>>> longlat=TRUE),
>>>> row.names=IDs)
>>>>
>>>> # Now convert the nb to listw for use in spatial regression call.
>>>> # Spatial weights, illustrated with coding style "W" (row standardized)
>>>>
>>>> spatial_knn2listw_obj <- nb2listw(spatial_knn2nb_obj, glist=NULL,
>>>> style="W",  zero.policy=TRUE)
>>>>
>>>>
>>> Did you examine this object? What did the print method tell you?
>>>
>>>
>>> E2_mod_pdssat_org_lon_lat <- E2_mod_pdssat_org[, c(2:3)] # The lon and
>>>> lat
>>>> will be required
>>>>
>>>>
>>> This object "_org" does not yet exist ...
>>>
>>> E2_mod_pdssat_org <- E2_mod_pdssat_org[, -c(2,3)]  # Remove the Lon, Lat
>>>
>>>> columns that are not required
>>>>
>>>> E2_mod_pdssat_pdata_frame <- pdata.frame(E2_mod_pdssat_org) # Convert
>>>> data
>>>> frame to pdata.frame
>>>>
>>>>
>>>> So you omitted to say that the data are (unbalanced) panel data ...
>>>
>>> All goes well until here but when I try to convert the explanatory
>>>
>>>> variables in the pdata.frame to spatial lagged variables
>>>>
>>>> E2_mod_pdssat_X_lagged <-
>>>> as.data.frame(cbind(slag(E2_mod_pdssat_pdata_frame$tmean, listw =
>>>> spatial_knn2listw_obj),
>>>> slag(E2_mod_pdssat_pdata_frame$tmeansq, listw = spatial_knn2listw_obj),
>>>> slag(E2_mod_pdssat_pdata_frame$pmean, listw = spatial_knn2listw_obj),
>>>> slag(E2_mod_pdssat_pdata_frame$pmeansq, listw =
>>>> spatial_knn2listw_obj)))
>>>>
>>>> I get the following error "Error in lag.listw(listw, xt) : object
>>>> lengths
>>>> differ". What am I doing wrong? I have also tried removing the NAs with
>>>> complete.cases.
>>>>
>>>>
>>> You have defined weights for one object (possibly a cross section), and
>>> then try to use them on a different object with a different number of
>>> rows.
>>> If you really want to do this, you need a Kronecker product of the
>>> spatial
>>> weights to take the panel structure of your data into account. Further, I
>>> doubt strongly that you need to create WX manually, because spatial lags
>>> of
>>> all the required variables are created by model fitting functions in the
>>> splm package.
>>>
>>> Roger
>>>
>>>
>>> Any help will be greatly appreciated. Thank you.
>>>>
>>>> Sincerely,
>>>>
>>>> Milu
>>>>
>>>> ## Data
>>>>
>>>> E2_mod_pdssat_org <- dput(head(temp,5))
>>>> structure(list(iso3 = structure(c(30L, 30L, 30L, 1L, 30L), .Label =
>>>> c(".",
>>>> ".M", "AFG", "AGO", "ALB", "ARE", "ARG", "ARM", "AUS", "AUT",
>>>> "AZE", "BDI", "BEL", "BEN", "BFA", "BGD", "BGR", "BHS", "BIH",
>>>> "BLR", "BLZ", "BOL", "BRA", "BRN", "BTN", "BWA", "CAF", "CAN",
>>>> "CHE", "CHL", "CHN", "CIV", "CMR", "COD", "COG", "COL", "CRI",
>>>> "CUB", "CYP", "CZE", "DEU", "DJI", "DNK", "DOM", "DZA", "ECU",
>>>> "EGY", "ERI", "ESH", "ESP", "EST", "ETH", "FIN", "FJI", "FLK",
>>>> "FRA", "GAB", "GBR", "GEO", "GHA", "GIN", "GNB", "GNQ", "GRC",
>>>> "GRL", "GTM", "GUF", "GUY", "HND", "HRV", "HTI", "HUN", "IDN",
>>>> "IND", "IRL", "IRN", "IRQ", "ISL", "ISR", "ITA", "JAM", "JOR",
>>>> "JPN", "KAZ", "KEN", "KGZ", "KHM", "KIR", "KOR", "KWT", "LAO",
>>>> "LBN", "LBR", "LBY", "LCA", "LKA", "LSO", "LTU", "LUX", "LVA",
>>>> "MAR", "MDA", "MDG", "MEX", "MKD", "MLI", "MMR", "MNE", "MNG",
>>>> "MOZ", "MRT", "MWI", "MYS", "NCL", "NER", "NGA", "NIC", "NLD",
>>>> "NOR", "NPL", "NZL", "OMN", "PAK", "PAN", "PER", "PHL", "PNG",
>>>> "POL", "PRI", "PRK", "PRT", "PRY", "QAT", "ROU", "RUS", "RWA",
>>>> "SAU", "SDN", "SEN", "SJM", "SLB", "SLE", "SLV", "SOM", "SRB",
>>>> "SUR", "SVK", "SVN", "SWE", "SWZ", "SYR", "TCD", "TGO", "THA",
>>>> "TJK", "TKM", "TLS", "TUN", "TUR", "TWN", "TZA", "UGA", "UKR",
>>>> "URY", "USA", "UZB", "VEN", "VNM", "VUT", "YEM", "ZAF", "ZMB",
>>>> "ZWE"), class = "factor"), lon = c(-69L, -68L, -72L, -71L, -70L
>>>> ), lat = c(-55L, -55L, -54L, -54L, -54L), tmean = c(NA, NA,
>>>> 4.55847677595631,
>>>> 4.06015710382516, 3.71010245901642), pmean = c(NA, NA, 2.45569896697998,
>>>> 1.6384220123291, 1.43925595283508), lngdp = c(-0.102380074560642,
>>>> -2.3195972442627, 0.0122363297268748, -0.483756244182587,
>>>> -6.29744625091553
>>>> ), tmeansq = c(NA, NA, 20.7797107696533, 16.4848766326904,
>>>> 13.7648601531982
>>>> ), pmeansq = c(NA, NA, 6.03045749664307, 2.68442678451538,
>>>> 2.07145762443542
>>>> )), .Names = c("iso3", "lon", "lat", "tmean", "pmean", "lngdp",
>>>> "tmeansq", "pmeansq"), row.names = c("1", "2", "3", "4", "5"), class =
>>>> "data.frame")
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>> http://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> http://depsy.org/person/434412
>>>
>>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
>

	[[alternative HTML version deleted]]


From culinovic.domagoj at gmail.com  Mon Nov 21 10:40:26 2016
From: culinovic.domagoj at gmail.com (Domagoj Culinovic)
Date: Mon, 21 Nov 2016 10:40:26 +0100
Subject: [R-sig-Geo] R - QGIS integration
Message-ID: <CACgt3omw7mXC1oPh1pXEO7bmyL-DMhzroYsor7TEeBkwLYxC1Q@mail.gmail.com>

Hi,
I have Polygon and point data in SHP format which i have use in QGIS. also
i have several csv files where i have different statistical data about
points and polygons in SHP files.
This csv data are generated every week.
How to make R script which can make georeferenced charts, diagrams or
something like heathmap i R, and return picture or charts at theit position
on the map?

Regards,
Domagoj

	[[alternative HTML version deleted]]


From macqueen1 at llnl.gov  Mon Nov 21 17:52:19 2016
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Mon, 21 Nov 2016 16:52:19 +0000
Subject: [R-sig-Geo] R - QGIS integration
In-Reply-To: <CACgt3omw7mXC1oPh1pXEO7bmyL-DMhzroYsor7TEeBkwLYxC1Q@mail.gmail.com>
References: <CACgt3omw7mXC1oPh1pXEO7bmyL-DMhzroYsor7TEeBkwLYxC1Q@mail.gmail.com>
Message-ID: <D458647D.18FBF4%macqueen1@llnl.gov>

I won't be able to help you in detail, but here's an outline.

Install and learn the rgdal package to get the SHP files into R.

Presumably your csv files have coordinates, in the same coordinate system
as the shapefiles.

Load the CSV files into R in the usual way, presumably resulting in data
frames.

Desirable, but perhaps not absolutely necessary: convert the data frames
into Spatial class objects; probably each will become a
SpatialPointsDataFrame.

plot( {a polygon shapefile object} )
plot( {a point shapefile object} , add=TRUE)
plot( {a SpatialPointsDataFrame} , add=TRUE)



-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 11/21/16, 1:40 AM, "R-sig-Geo on behalf of Domagoj Culinovic"
<r-sig-geo-bounces at r-project.org on behalf of culinovic.domagoj at gmail.com>
wrote:

>Hi,
>I have Polygon and point data in SHP format which i have use in QGIS. also
>i have several csv files where i have different statistical data about
>points and polygons in SHP files.
>This csv data are generated every week.
>How to make R script which can make georeferenced charts, diagrams or
>something like heathmap i R, and return picture or charts at theit
>position
>on the map?
>
>Regards,
>Domagoj
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From michael.delorme at agriculture.gouv.fr  Tue Nov 22 07:41:10 2016
From: michael.delorme at agriculture.gouv.fr (Michael DELORME)
Date: Tue, 22 Nov 2016 07:41:10 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
Message-ID: <5833E886.7000408@agriculture.gouv.fr>

Dear list,

Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution), I get
the following error :

> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2 double precision")
Error : XML content does not seem to be XML: 'Le chemin d'acc?s sp?cifi? est introuvable.'
In addition: Warning message:
running command 'v.db.addcolumn.bat --interface-description' had status 1 
Error in parseGRASS(cmd, legacyExec = legacyExec) : 
  v.db.addcolumn not parsed


and a similar one for r.mask :

> execGRASS("r.mask", raster = "map")
Error : XML content does not seem to be XML: 'Le chemin d'acc?s sp?cifi? est introuvable.'
In addition: Warning message:
running command 'r.mask.bat --interface-description' had status 1 
Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not parsed


whereas most other execGRASS command I tried work as expected.
Any idea ?
Thanks in advance

Here is my session info :

> sessionInfo()
R version 3.3.1 (2016-06-21)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252    LC_MONETARY=French_France.1252 LC_NUMERIC=C                  
[5] LC_TIME=French_France.1252    

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rgrass7_0.1-9     XML_3.98-1.4      beepr_1.2         raster_2.5-8      sp_1.2-3          RPostgreSQL_0.4-1 DBI_0.5-1        

loaded via a namespace (and not attached):
[1] magrittr_1.5    tools_3.3.1     audio_0.1-5     Rcpp_0.12.7     stringi_1.1.2   grid_3.3.1      stringr_1.1.0   lattice_0.20-34
[9] fortunes_1.5-3 



	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Tue Nov 22 09:34:52 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 22 Nov 2016 09:34:52 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <5833E886.7000408@agriculture.gouv.fr>
References: <5833E886.7000408@agriculture.gouv.fr>
Message-ID: <alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>

On Tue, 22 Nov 2016, Michael DELORME wrote:

> Dear list,
>
> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution), I get
> the following error :

Please always try to provide a reproducible example using a standard data 
set. In addition, the output of traceback() following the error would 
be helpful. Are you running R inside GRASS, or using R to initiate GRASS?

Consider using the grass-stats list:

https://lists.osgeo.org/mailman/listinfo/grass-stats

as it is more likely to yield results, but there also provide an example 
that anyone can reproduce. The example should avoid loading other 
packages, and should be run from the R console (not, say, RStudio).

Roger



>
>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2 double 
>> precision")
> Error : XML content does not seem to be XML: 'Le chemin d'acc?s sp?cifi? 
> est introuvable.' In addition: Warning message: running command 
> 'v.db.addcolumn.bat --interface-description' had status 1 Error in 
> parseGRASS(cmd, legacyExec = legacyExec) :
>  v.db.addcolumn not parsed
>
>
> and a similar one for r.mask :
>
>> execGRASS("r.mask", raster = "map")
> Error : XML content does not seem to be XML: 'Le chemin d'acc?s sp?cifi? est introuvable.'
> In addition: Warning message:
> running command 'r.mask.bat --interface-description' had status 1 
> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not parsed
>
>
> whereas most other execGRASS command I tried work as expected.
> Any idea ?
> Thanks in advance
>
> Here is my session info :
>
>> sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
>
> locale:
> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252    LC_MONETARY=French_France.1252 LC_NUMERIC=C 
> [5] LC_TIME=French_France.1252 
>
> attached base packages:
> [1] parallel  stats     graphics  grDevices utils     datasets  methods   base 
>
> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2 
> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>
> loaded via a namespace (and not attached): [1] magrittr_1.5 tools_3.3.1 
> audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1 stringr_1.1.0 
> lattice_0.20-34 [9] fortunes_1.5-3
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From michael.delorme at agriculture.gouv.fr  Tue Nov 22 13:43:21 2016
From: michael.delorme at agriculture.gouv.fr (Michael DELORME)
Date: Tue, 22 Nov 2016 13:43:21 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
Message-ID: <58343D69.1040900@agriculture.gouv.fr>

Thanks for replying

Here is a reproducible example (change your GRASS directory of course) :

library(rgrass7)
library(sp)
initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
override = TRUE)
data(meuse)
coordinates(meuse) <- ~x+y
writeVECT(meuse, "meuse")
execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
precision")

I get :
Error : XML content does not seem to be XML: 'The specified path was not
found.'
In addition: Warning message:
running command 'v.db.addcolumn.bat --interface-description' had status 1
Error in parseGRASS(cmd, legacyExec = legacyExec) :
  v.db.addcolumn not parsed

Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work fine,
but some other (r.mask) fail with a similar XML error.

All commands work fine when used from the GRASS shell...

What is this XML error ?
Thanks

Le 22/11/2016 09:34, Roger Bivand a ?crit :
> On Tue, 22 Nov 2016, Michael DELORME wrote:
>
>> Dear list,
>>
>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution), I get
>> the following error :
>
> Please always try to provide a reproducible example using a standard
> data set. In addition, the output of traceback() following the error
> would be helpful. Are you running R inside GRASS, or using R to
> initiate GRASS?
>
> Consider using the grass-stats list:
>
> https://lists.osgeo.org/mailman/listinfo/grass-stats
>
> as it is more likely to yield results, but there also provide an
> example that anyone can reproduce. The example should avoid loading
> other packages, and should be run from the R console (not, say, RStudio).
>
> Roger
>
>
>
>>
>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>> double precision")
>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>> sp?cifi? est introuvable.' In addition: Warning message: running
>> command 'v.db.addcolumn.bat --interface-description' had status 1
>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>  v.db.addcolumn not parsed
>>
>>
>> and a similar one for r.mask :
>>
>>> execGRASS("r.mask", raster = "map")
>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>> sp?cifi? est introuvable.'
>> In addition: Warning message:
>> running command 'r.mask.bat --interface-description' had status 1
>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not parsed
>>
>>
>> whereas most other execGRASS command I tried work as expected.
>> Any idea ?
>> Thanks in advance
>>
>> Here is my session info :
>>
>>> sessionInfo()
>> R version 3.3.1 (2016-06-21)
>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>
>> locale:
>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252   
>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>> LC_TIME=French_France.1252
>> attached base packages:
>> [1] parallel  stats     graphics  grDevices utils     datasets 
>> methods   base
>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>
>> loaded via a namespace (and not attached): [1] magrittr_1.5
>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>
>>
>>
>>     [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
*Micha?l DELORME*
Administrateur de donn?es, charg? de projet en g?omatique
Service r?gional de l'information statistique, ?conomique et territoriale
Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
Auvergne-Rh?ne-Alpes
Site de Lyon
165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
04 78 63 34 21

Pour ?crire au service :
DRAAF Auvergne-Rh?ne-Alpes ? SRISET
16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES

http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Tue Nov 22 14:30:09 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 22 Nov 2016 14:30:09 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <58343D69.1040900@agriculture.gouv.fr>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
Message-ID: <alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>

On Tue, 22 Nov 2016, Michael DELORME wrote:

> Thanks for replying
>
> Here is a reproducible example (change your GRASS directory of course) :
>
> library(rgrass7)
> library(sp)
> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
> override = TRUE)
> data(meuse)
> coordinates(meuse) <- ~x+y
> writeVECT(meuse, "meuse")
> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
> precision")

This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows 
stand-alone. Do you need to use OSGeo4W - the internal logic used for 
finding out where the different versions keep their executables and batch 
files varies?

What does traceback() say after the error? The error comes from 
parseGRASS("v.db.addcolumn") - the XML error comes from not being able to 
read the output of v.db.addcolumn<.ext> --interface-description where 
<.ext> may be .exe or .bat I think.

Roger

>
> I get :
> Error : XML content does not seem to be XML: 'The specified path was not
> found.'
> In addition: Warning message:
> running command 'v.db.addcolumn.bat --interface-description' had status 1
> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>  v.db.addcolumn not parsed
>
> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work fine,
> but some other (r.mask) fail with a similar XML error.
>
> All commands work fine when used from the GRASS shell...
>
> What is this XML error ?
> Thanks
>
> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>
>>> Dear list,
>>>
>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution), I get
>>> the following error :
>>
>> Please always try to provide a reproducible example using a standard
>> data set. In addition, the output of traceback() following the error
>> would be helpful. Are you running R inside GRASS, or using R to
>> initiate GRASS?
>>
>> Consider using the grass-stats list:
>>
>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>
>> as it is more likely to yield results, but there also provide an
>> example that anyone can reproduce. The example should avoid loading
>> other packages, and should be run from the R console (not, say, RStudio).
>>
>> Roger
>>
>>
>>
>>>
>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>> double precision")
>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>  v.db.addcolumn not parsed
>>>
>>>
>>> and a similar one for r.mask :
>>>
>>>> execGRASS("r.mask", raster = "map")
>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>> sp?cifi? est introuvable.'
>>> In addition: Warning message:
>>> running command 'r.mask.bat --interface-description' had status 1
>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not parsed
>>>
>>>
>>> whereas most other execGRASS command I tried work as expected.
>>> Any idea ?
>>> Thanks in advance
>>>
>>> Here is my session info :
>>>
>>>> sessionInfo()
>>> R version 3.3.1 (2016-06-21)
>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>
>>> locale:
>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252 
>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>> LC_TIME=French_France.1252
>>> attached base packages:
>>> [1] parallel  stats     graphics  grDevices utils     datasets 
>>> methods   base
>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>
>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>
>>>
>>>
>>>     [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- 
> *Micha?l DELORME*
> Administrateur de donn?es, charg? de projet en g?omatique
> Service r?gional de l'information statistique, ?conomique et territoriale
> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
> Auvergne-Rh?ne-Alpes
> Site de Lyon
> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
> 04 78 63 34 21
>
> Pour ?crire au service :
> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>
> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From michael.delorme at agriculture.gouv.fr  Tue Nov 22 14:50:40 2016
From: michael.delorme at agriculture.gouv.fr (Michael DELORME)
Date: Tue, 22 Nov 2016 14:50:40 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
Message-ID: <58344D30.4090206@agriculture.gouv.fr>

Thanks for investigating.

I'll try a standalone version of GRASS if needed.

Here is the traceback

> traceback()
4: stop(paste(cmd, "not parsed"))
3: parseGRASS(cmd, legacyExec = legacyExec)
2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
echoCmd, legacyExec = legacyExec)
1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
precision")

My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
indeed the *.bat command are those which don't work (r.mask.bat,
v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
v.db.addcolumn.bat is :

@"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*

So I guess something must be wrong in my Python installation... (it
works however from within a GRASS shell)

Cordially


Le 22/11/2016 14:30, Roger Bivand a ?crit :
> On Tue, 22 Nov 2016, Michael DELORME wrote:
>
>> Thanks for replying
>>
>> Here is a reproducible example (change your GRASS directory of course) :
>>
>> library(rgrass7)
>> library(sp)
>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>> override = TRUE)
>> data(meuse)
>> coordinates(meuse) <- ~x+y
>> writeVECT(meuse, "meuse")
>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>> precision")
>
> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
> stand-alone. Do you need to use OSGeo4W - the internal logic used for
> finding out where the different versions keep their executables and
> batch files varies?
>
> What does traceback() say after the error? The error comes from
> parseGRASS("v.db.addcolumn") - the XML error comes from not being able
> to read the output of v.db.addcolumn<.ext> --interface-description
> where <.ext> may be .exe or .bat I think.
>
> Roger
>
>>
>> I get :
>> Error : XML content does not seem to be XML: 'The specified path was not
>> found.'
>> In addition: Warning message:
>> running command 'v.db.addcolumn.bat --interface-description' had
>> status 1
>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>  v.db.addcolumn not parsed
>>
>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work fine,
>> but some other (r.mask) fail with a similar XML error.
>>
>> All commands work fine when used from the GRASS shell...
>>
>> What is this XML error ?
>> Thanks
>>
>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>
>>>> Dear list,
>>>>
>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution), I get
>>>> the following error :
>>>
>>> Please always try to provide a reproducible example using a standard
>>> data set. In addition, the output of traceback() following the error
>>> would be helpful. Are you running R inside GRASS, or using R to
>>> initiate GRASS?
>>>
>>> Consider using the grass-stats list:
>>>
>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>
>>> as it is more likely to yield results, but there also provide an
>>> example that anyone can reproduce. The example should avoid loading
>>> other packages, and should be run from the R console (not, say,
>>> RStudio).
>>>
>>> Roger
>>>
>>>
>>>
>>>>
>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>>> double precision")
>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>  v.db.addcolumn not parsed
>>>>
>>>>
>>>> and a similar one for r.mask :
>>>>
>>>>> execGRASS("r.mask", raster = "map")
>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>> sp?cifi? est introuvable.'
>>>> In addition: Warning message:
>>>> running command 'r.mask.bat --interface-description' had status 1
>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not parsed
>>>>
>>>>
>>>> whereas most other execGRASS command I tried work as expected.
>>>> Any idea ?
>>>> Thanks in advance
>>>>
>>>> Here is my session info :
>>>>
>>>>> sessionInfo()
>>>> R version 3.3.1 (2016-06-21)
>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>
>>>> locale:
>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>> LC_TIME=French_France.1252
>>>> attached base packages:
>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>> methods   base
>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>
>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>
>>>>
>>>>
>>>>     [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> -- 
>> *Micha?l DELORME*
>> Administrateur de donn?es, charg? de projet en g?omatique
>> Service r?gional de l'information statistique, ?conomique et
>> territoriale
>> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
>> Auvergne-Rh?ne-Alpes
>> Site de Lyon
>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>> 04 78 63 34 21
>>
>> Pour ?crire au service :
>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>
>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>
>>     [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From kent3737 at gmail.com  Tue Nov 22 15:05:45 2016
From: kent3737 at gmail.com (Kent Johnson)
Date: Tue, 22 Nov 2016 09:05:45 -0500
Subject: [R-sig-Geo] R - QGIS integration
Message-ID: <CAPP0wyhy1MaPDrOUYSc7bqw8hvBfc-bj+2g021GrGDUSO96STQ@mail.gmail.com>

If I understand correctly your question is not about QGIS but about using R
to make maps with inset charts. There are several examples of charts on
maps here:
http://stackoverflow.com/questions/10368180/plotting-pie-graphs-on-map-in-ggplot

Also ggmap + ggmap::inset looks like it will do what you want, see the
ggplot2::annotation_custom example for a little help.

Kent

On Mon, Nov 21, 2016 at 6:00 AM, <r-sig-geo-request at r-project.org> wrote:


> -----------------------------
>
> Message: 7
> Date: Mon, 21 Nov 2016 10:40:26 +0100
> From: Domagoj Culinovic <culinovic.domagoj at gmail.com>
> To: R-sig-Geo at r-project.org
> Subject: [R-sig-Geo] R - QGIS integration
> Message-ID:
>         <CACgt3omw7mXC1oPh1pXEO7bmyL-DMhzroYsor7TEeBkwLYxC1Q at mail.
> gmail.com>
> Content-Type: text/plain; charset="UTF-8"
>
> Hi,
> I have Polygon and point data in SHP format which i have use in QGIS. also
> i have several csv files where i have different statistical data about
> points and polygons in SHP files.
> This csv data are generated every week.
> How to make R script which can make georeferenced charts, diagrams or
> something like heathmap i R, and return picture or charts at theit position
> on the map?
>
> Regards,
> Domagoj
>
>         [[alternative HTML version deleted]]
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> ------------------------------
>
> End of R-sig-Geo Digest, Vol 159, Issue 15
> ******************************************
>

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Tue Nov 22 15:13:54 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 22 Nov 2016 15:13:54 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <58344D30.4090206@agriculture.gouv.fr>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
	<58344D30.4090206@agriculture.gouv.fr>
Message-ID: <alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>

On Tue, 22 Nov 2016, Michael DELORME wrote:

> Thanks for investigating.
>
> I'll try a standalone version of GRASS if needed.
>
> Here is the traceback
>
>> traceback()
> 4: stop(paste(cmd, "not parsed"))
> 3: parseGRASS(cmd, legacyExec = legacyExec)
> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
> echoCmd, legacyExec = legacyExec)
> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
> precision")
>
> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
> indeed the *.bat command are those which don't work (r.mask.bat,
> v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
> v.db.addcolumn.bat is :
>
> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>
> So I guess something must be wrong in my Python installation... (it
> works however from within a GRASS shell)

No, the logic for Windows and initGRASS has only ever been tested with 
stand-alone GRASS. I would guess that in OSGeo4W the path variables are 
wrong. I cannot even find out how to run initGRASS in R but outside the 
OSGeo4W shell (doesn't find iconv.dll) or inside the OSGeo4W shell (cannot 
create a temporary GRASS location). Unless you or others really need 
OSGeo4W, I suggest asking others to implement that - very bulky and 
fragile.

Roger

>
> Cordially
>
>
> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>
>>> Thanks for replying
>>>
>>> Here is a reproducible example (change your GRASS directory of course) :
>>>
>>> library(rgrass7)
>>> library(sp)
>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>> override = TRUE)
>>> data(meuse)
>>> coordinates(meuse) <- ~x+y
>>> writeVECT(meuse, "meuse")
>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>> precision")
>>
>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>> stand-alone. Do you need to use OSGeo4W - the internal logic used for
>> finding out where the different versions keep their executables and
>> batch files varies?
>>
>> What does traceback() say after the error? The error comes from
>> parseGRASS("v.db.addcolumn") - the XML error comes from not being able
>> to read the output of v.db.addcolumn<.ext> --interface-description
>> where <.ext> may be .exe or .bat I think.
>>
>> Roger
>>
>>>
>>> I get :
>>> Error : XML content does not seem to be XML: 'The specified path was not
>>> found.'
>>> In addition: Warning message:
>>> running command 'v.db.addcolumn.bat --interface-description' had
>>> status 1
>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>  v.db.addcolumn not parsed
>>>
>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work fine,
>>> but some other (r.mask) fail with a similar XML error.
>>>
>>> All commands work fine when used from the GRASS shell...
>>>
>>> What is this XML error ?
>>> Thanks
>>>
>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>
>>>>> Dear list,
>>>>>
>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution), I get
>>>>> the following error :
>>>>
>>>> Please always try to provide a reproducible example using a standard
>>>> data set. In addition, the output of traceback() following the error
>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>> initiate GRASS?
>>>>
>>>> Consider using the grass-stats list:
>>>>
>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>
>>>> as it is more likely to yield results, but there also provide an
>>>> example that anyone can reproduce. The example should avoid loading
>>>> other packages, and should be run from the R console (not, say,
>>>> RStudio).
>>>>
>>>> Roger
>>>>
>>>>
>>>>
>>>>>
>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>>>> double precision")
>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>  v.db.addcolumn not parsed
>>>>>
>>>>>
>>>>> and a similar one for r.mask :
>>>>>
>>>>>> execGRASS("r.mask", raster = "map")
>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>> sp?cifi? est introuvable.'
>>>>> In addition: Warning message:
>>>>> running command 'r.mask.bat --interface-description' had status 1
>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not parsed
>>>>>
>>>>>
>>>>> whereas most other execGRASS command I tried work as expected.
>>>>> Any idea ?
>>>>> Thanks in advance
>>>>>
>>>>> Here is my session info :
>>>>>
>>>>>> sessionInfo()
>>>>> R version 3.3.1 (2016-06-21)
>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>
>>>>> locale:
>>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>> LC_TIME=French_France.1252
>>>>> attached base packages:
>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>> methods   base
>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>
>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>
>>>>>
>>>>>
>>>>>     [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> *Micha?l DELORME*
>>> Administrateur de donn?es, charg? de projet en g?omatique
>>> Service r?gional de l'information statistique, ?conomique et
>>> territoriale
>>> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
>>> Auvergne-Rh?ne-Alpes
>>> Site de Lyon
>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>> 04 78 63 34 21
>>>
>>> Pour ?crire au service :
>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>
>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>
>>>     [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From isaquedanielre at hotmail.com  Tue Nov 22 18:48:06 2016
From: isaquedanielre at hotmail.com (Isaque Daniel)
Date: Tue, 22 Nov 2016 17:48:06 +0000
Subject: [R-sig-Geo] Calculate the area of pixel in square kilometers from a
 raster in lat/long projection
Message-ID: <DM5PR20MB1243FA13887323578215A0FBC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>

Hi,


I'm looking for some advice to convert the area calculated by raster::area() in a raster image as the projection in lat/long.

If anyone has some suggestion, please!!
Best
Isaque


------------------------------------------------------------------------------------------------------------------
Agronomist engineer
Master in Remote Sensing - National  Institute for Space Research (INPE) - Brazil
PHD Student in Transport - Brazilia University (UNB)

	[[alternative HTML version deleted]]


From isaquedanielre at hotmail.com  Wed Nov 23 00:57:55 2016
From: isaquedanielre at hotmail.com (Isaque Daniel)
Date: Tue, 22 Nov 2016 23:57:55 +0000
Subject: [R-sig-Geo] Calculate the area of pixel in square kilometers
 from a raster in lat/long projection
In-Reply-To: <DM5PR20MB1243FA13887323578215A0FBC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>
References: <DM5PR20MB1243FA13887323578215A0FBC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>
Message-ID: <DM5PR20MB12436BE877E0466DCDC9D75BC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>

Hi there,
I found a example in stackoverflow of distance calculation and convertion, so I modificate that to compute the area by pixel in hectares using the raster in degrees.

#####
# Function to compute the area  in hectares

measureAreahec <- function(imageRaster) {
  R <- 6378.137                                # radius of earth in Km
  areaImagetemp <- area(ceiImg)
  xresVal <- xres(areaImagetemp)
  yresVal <- yres(areaImagetemp)
  coords <- data.frame(coordinates(areaImagetemp))
  colnames(coords) <- c("lon","lat")
  lon1 <- coords$lon - (xresVal/2)
  lon2 <- coords$lon + (xresVal/2)
  lat1 <- coords$lat - (yresVal/2)
  lat2 <- coords$lat + (yresVal/2)

  # width
  dLat <- (lat1-lat1)*pi/180
  dLon <- (lon2-lon1)*pi/180
  a <- sin((dLat/2))^2 + cos(lat1*pi/180)*cos(lat1*pi/180)*(sin(dLon/2))^2
  c <- 2 * atan2(sqrt(a), sqrt(1-a))
  dlongitude <- R * c * 1000

  # heigth
  dLat <- (lat1-lat2)*pi/180
  dLon <- (lon1-lon1)*pi/180
  a <- sin((dLat/2))^2 + cos(lat1*pi/180)*cos(lat1*pi/180)*(sin(dLon/2))^2
  c <- 2 * atan2(sqrt(a), sqrt(1-a))
  dlatitude <- R * c * 1000
  return (dlatitude * dlongitude / 10000)                            # distance in meters
}
##########################


It's a very simple one, but ,maybe can help somebody.

Best
Isaque


------------------------------------------------------------------------------------------------------------------
Agronomist engineer
Master in Remote Sensing - National  Institute for Space Research (INPE) - Brazil
PHD Student in Transport - Brazlia University (UNB)


________________________________
De: R-sig-Geo <r-sig-geo-bounces at r-project.org> em nome de Isaque Daniel <isaquedanielre at hotmail.com>
Enviado: ter?a-feira, 22 de novembro de 2016 17:48
Para: r-sig-geo
Assunto: [R-sig-Geo] Calculate the area of pixel in square kilometers from a raster in lat/long projection

Hi,


I'm looking for some advice to convert the area calculated by raster::area() in a raster image as the projection in lat/long.

[[elided Hotmail spam]]
Best
Isaque


------------------------------------------------------------------------------------------------------------------
Agronomist engineer
Master in Remote Sensing - National  Institute for Space Research (INPE) - Brazil
PHD Student in Transport - Brazilia University (UNB)

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo




	[[alternative HTML version deleted]]


From michael.delorme at agriculture.gouv.fr  Wed Nov 23 07:38:43 2016
From: michael.delorme at agriculture.gouv.fr (Michael DELORME)
Date: Wed, 23 Nov 2016 07:38:43 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
	<58344D30.4090206@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>
Message-ID: <58353973.5000406@agriculture.gouv.fr>

Thanks for your insight.
I'll use a stand-alone GRASS install.

Cordially

Le 22/11/2016 15:13, Roger Bivand a ?crit :
> On Tue, 22 Nov 2016, Michael DELORME wrote:
>
>> Thanks for investigating.
>>
>> I'll try a standalone version of GRASS if needed.
>>
>> Here is the traceback
>>
>>> traceback()
>> 4: stop(paste(cmd, "not parsed"))
>> 3: parseGRASS(cmd, legacyExec = legacyExec)
>> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
>> echoCmd, legacyExec = legacyExec)
>> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>> precision")
>>
>> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>> indeed the *.bat command are those which don't work (r.mask.bat,
>> v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
>> v.db.addcolumn.bat is :
>>
>> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>>
>> So I guess something must be wrong in my Python installation... (it
>> works however from within a GRASS shell)
>
> No, the logic for Windows and initGRASS has only ever been tested with
> stand-alone GRASS. I would guess that in OSGeo4W the path variables
> are wrong. I cannot even find out how to run initGRASS in R but
> outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
> OSGeo4W shell (cannot create a temporary GRASS location). Unless you
> or others really need OSGeo4W, I suggest asking others to implement
> that - very bulky and fragile.
>
> Roger
>
>>
>> Cordially
>>
>>
>> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>
>>>> Thanks for replying
>>>>
>>>> Here is a reproducible example (change your GRASS directory of
>>>> course) :
>>>>
>>>> library(rgrass7)
>>>> library(sp)
>>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>>> override = TRUE)
>>>> data(meuse)
>>>> coordinates(meuse) <- ~x+y
>>>> writeVECT(meuse, "meuse")
>>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>>> precision")
>>>
>>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>>> stand-alone. Do you need to use OSGeo4W - the internal logic used for
>>> finding out where the different versions keep their executables and
>>> batch files varies?
>>>
>>> What does traceback() say after the error? The error comes from
>>> parseGRASS("v.db.addcolumn") - the XML error comes from not being able
>>> to read the output of v.db.addcolumn<.ext> --interface-description
>>> where <.ext> may be .exe or .bat I think.
>>>
>>> Roger
>>>
>>>>
>>>> I get :
>>>> Error : XML content does not seem to be XML: 'The specified path
>>>> was not
>>>> found.'
>>>> In addition: Warning message:
>>>> running command 'v.db.addcolumn.bat --interface-description' had
>>>> status 1
>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>  v.db.addcolumn not parsed
>>>>
>>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work fine,
>>>> but some other (r.mask) fail with a similar XML error.
>>>>
>>>> All commands work fine when used from the GRASS shell...
>>>>
>>>> What is this XML error ?
>>>> Thanks
>>>>
>>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>
>>>>>> Dear list,
>>>>>>
>>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution),
>>>>>> I get
>>>>>> the following error :
>>>>>
>>>>> Please always try to provide a reproducible example using a standard
>>>>> data set. In addition, the output of traceback() following the error
>>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>>> initiate GRASS?
>>>>>
>>>>> Consider using the grass-stats list:
>>>>>
>>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>>
>>>>> as it is more likely to yield results, but there also provide an
>>>>> example that anyone can reproduce. The example should avoid loading
>>>>> other packages, and should be run from the R console (not, say,
>>>>> RStudio).
>>>>>
>>>>> Roger
>>>>>
>>>>>
>>>>>
>>>>>>
>>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>>>>> double precision")
>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>  v.db.addcolumn not parsed
>>>>>>
>>>>>>
>>>>>> and a similar one for r.mask :
>>>>>>
>>>>>>> execGRASS("r.mask", raster = "map")
>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>> sp?cifi? est introuvable.'
>>>>>> In addition: Warning message:
>>>>>> running command 'r.mask.bat --interface-description' had status 1
>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>>>>>> parsed
>>>>>>
>>>>>>
>>>>>> whereas most other execGRASS command I tried work as expected.
>>>>>> Any idea ?
>>>>>> Thanks in advance
>>>>>>
>>>>>> Here is my session info :
>>>>>>
>>>>>>> sessionInfo()
>>>>>> R version 3.3.1 (2016-06-21)
>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>
>>>>>> locale:
>>>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>>> LC_TIME=French_France.1252
>>>>>> attached base packages:
>>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>>> methods   base
>>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>>
>>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>>
>>>>>>
>>>>>>
>>>>>>     [[alternative HTML version deleted]]
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>> -- 
>>>> *Micha?l DELORME*
>>>> Administrateur de donn?es, charg? de projet en g?omatique
>>>> Service r?gional de l'information statistique, ?conomique et
>>>> territoriale
>>>> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
>>>> Auvergne-Rh?ne-Alpes
>>>> Site de Lyon
>>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>>> 04 78 63 34 21
>>>>
>>>> Pour ?crire au service :
>>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>>
>>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>>
>>>>     [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>


From reudenbach at uni-marburg.de  Wed Nov 23 09:58:50 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Wed, 23 Nov 2016 09:58:50 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <58353973.5000406@agriculture.gouv.fr>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
	<58344D30.4090206@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>
	<58353973.5000406@agriculture.gouv.fr>
Message-ID: <260ac653-9ab0-86f0-f738-72f9629e0beb@uni-marburg.de>

Michael,


using GRASS from R is a bit cumbersome. GRASS (and this is for sure one 
of it strength ) is extremely rigid with projections etc. Due to this 
you should setup a correct structure. I use a setup that is similar to 
the below snippet.

cheers Chris


library(rgrass7)
library(sp)

# setup a temp workingdir
working.dir<- "~/tmp/"

# get meuse data

data(meuse)
data(meuse.grid)

# georeference the meuse grid data
coordinates(meuse.grid) <- ~x+y
proj4string(meuse.grid) <- CRS("+init=epsg:28992")
gridded(meuse.grid) <- TRUE

# get a first cellsize/pixel resolution for GRASS
resolution <- meuse.grid at grid@cellsize[1]

# georeference the meuse data
coordinates(meuse) <- ~x+y
proj4string(meuse) <- as.character(CRS("+init=epsg:28992"))

# get projection, proj4 string and extent for GRASS
projection<-(strsplit(meuse at proj4string@projargs,split = " "))
proj4<- paste(projection[[1]][2:length(unlist(projection))], collapse = ' ')
xmax<-meuse at bbox[3]
xmin<-meuse at bbox[1]
ymax<-meuse at bbox[4]
ymin<-meuse@@bbox[2]

# create and set working directory
if (!file.exists(file.path(working.dir,"run"))){
   dir.create(file.path(working.dir,"run"),recursive = TRUE)
}
setwd(file.path( working.dir,"run"))


############ set up GRASS RUNTIME environment

# define the GRASS executable path
if(Sys.info()["sysname"] == "Windows"){
   grass.gis.base<-'C:/OSGeo4W64/apps/grass/grass-7.0.5'
}else {
   grass.gis.base<-'/usr/lib/grass72'
}

# set path for optional GRASS addons
Sys.setenv(GRASS_ADDON_PATH="~/.grass7/addons")

# create the TEMPORARY GRASS location
rgrass7::initGRASS(gisBase=grass.gis.base,
                    home=tempdir(),
                    mapset='PERMANENT',
                    override=TRUE
)

# assign GRASS projection according to data set
rgrass7::execGRASS('g.proj',
                    flags=c('c','quiet'),
                    proj4=proj4
)

# assign GRASS extent and resolution
rgrass7::execGRASS('g.region',
                    flags=c('quiet'),
                    n=as.character(ymax),
                    s=as.character(ymin),
                    e=as.character(xmax),
                    w=as.character(xmin),
                    res=as.character(resolution)
)


#############   now do GRASS STUFF

writeVECT(meuse,"meuse")
execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
precision")


On 23.11.2016 07:38, Michael DELORME wrote:
> Thanks for your insight.
> I'll use a stand-alone GRASS install.
>
> Cordially
>
> Le 22/11/2016 15:13, Roger Bivand a ?crit :
>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>
>>> Thanks for investigating.
>>>
>>> I'll try a standalone version of GRASS if needed.
>>>
>>> Here is the traceback
>>>
>>>> traceback()
>>> 4: stop(paste(cmd, "not parsed"))
>>> 3: parseGRASS(cmd, legacyExec = legacyExec)
>>> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
>>> echoCmd, legacyExec = legacyExec)
>>> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>> precision")
>>>
>>> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>>> indeed the *.bat command are those which don't work (r.mask.bat,
>>> v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
>>> v.db.addcolumn.bat is :
>>>
>>> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>>>
>>> So I guess something must be wrong in my Python installation... (it
>>> works however from within a GRASS shell)
>> No, the logic for Windows and initGRASS has only ever been tested with
>> stand-alone GRASS. I would guess that in OSGeo4W the path variables
>> are wrong. I cannot even find out how to run initGRASS in R but
>> outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
>> OSGeo4W shell (cannot create a temporary GRASS location). Unless you
>> or others really need OSGeo4W, I suggest asking others to implement
>> that - very bulky and fragile.
>>
>> Roger
>>
>>> Cordially
>>>
>>>
>>> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>
>>>>> Thanks for replying
>>>>>
>>>>> Here is a reproducible example (change your GRASS directory of
>>>>> course) :
>>>>>
>>>>> library(rgrass7)
>>>>> library(sp)
>>>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>>>> override = TRUE)
>>>>> data(meuse)
>>>>> coordinates(meuse) <- ~x+y
>>>>> writeVECT(meuse, "meuse")
>>>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>>>> precision")
>>>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>>>> stand-alone. Do you need to use OSGeo4W - the internal logic used for
>>>> finding out where the different versions keep their executables and
>>>> batch files varies?
>>>>
>>>> What does traceback() say after the error? The error comes from
>>>> parseGRASS("v.db.addcolumn") - the XML error comes from not being able
>>>> to read the output of v.db.addcolumn<.ext> --interface-description
>>>> where <.ext> may be .exe or .bat I think.
>>>>
>>>> Roger
>>>>
>>>>> I get :
>>>>> Error : XML content does not seem to be XML: 'The specified path
>>>>> was not
>>>>> found.'
>>>>> In addition: Warning message:
>>>>> running command 'v.db.addcolumn.bat --interface-description' had
>>>>> status 1
>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>   v.db.addcolumn not parsed
>>>>>
>>>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work fine,
>>>>> but some other (r.mask) fail with a similar XML error.
>>>>>
>>>>> All commands work fine when used from the GRASS shell...
>>>>>
>>>>> What is this XML error ?
>>>>> Thanks
>>>>>
>>>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>
>>>>>>> Dear list,
>>>>>>>
>>>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution),
>>>>>>> I get
>>>>>>> the following error :
>>>>>> Please always try to provide a reproducible example using a standard
>>>>>> data set. In addition, the output of traceback() following the error
>>>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>>>> initiate GRASS?
>>>>>>
>>>>>> Consider using the grass-stats list:
>>>>>>
>>>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>>>
>>>>>> as it is more likely to yield results, but there also provide an
>>>>>> example that anyone can reproduce. The example should avoid loading
>>>>>> other packages, and should be run from the R console (not, say,
>>>>>> RStudio).
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>>>
>>>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>>>>>> double precision")
>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>   v.db.addcolumn not parsed
>>>>>>>
>>>>>>>
>>>>>>> and a similar one for r.mask :
>>>>>>>
>>>>>>>> execGRASS("r.mask", raster = "map")
>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>> sp?cifi? est introuvable.'
>>>>>>> In addition: Warning message:
>>>>>>> running command 'r.mask.bat --interface-description' had status 1
>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>>>>>>> parsed
>>>>>>>
>>>>>>>
>>>>>>> whereas most other execGRASS command I tried work as expected.
>>>>>>> Any idea ?
>>>>>>> Thanks in advance
>>>>>>>
>>>>>>> Here is my session info :
>>>>>>>
>>>>>>>> sessionInfo()
>>>>>>> R version 3.3.1 (2016-06-21)
>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>
>>>>>>> locale:
>>>>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>>>> LC_TIME=French_France.1252
>>>>>>> attached base packages:
>>>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>>>> methods   base
>>>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>>>
>>>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> -- 
>>>>> *Micha?l DELORME*
>>>>> Administrateur de donn?es, charg? de projet en g?omatique
>>>>> Service r?gional de l'information statistique, ?conomique et
>>>>> territoriale
>>>>> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
>>>>> Auvergne-Rh?ne-Alpes
>>>>> Site de Lyon
>>>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>>>> 04 78 63 34 21
>>>>>
>>>>> Pour ?crire au service :
>>>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>>>
>>>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>>>
>>>>>      [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Wed Nov 23 10:12:09 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 23 Nov 2016 10:12:09 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <260ac653-9ab0-86f0-f738-72f9629e0beb@uni-marburg.de>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
	<58344D30.4090206@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>
	<58353973.5000406@agriculture.gouv.fr>
	<260ac653-9ab0-86f0-f738-72f9629e0beb@uni-marburg.de>
Message-ID: <alpine.LFD.2.20.1611231008530.21367@reclus.nhh.no>

Chris,

Thanks for this. Could you please explain how you use R in the OSGeo4W64 
context? Where are you starting R and how does it find the OSGeo4W 
components that are not on default PATH settings? In order to correct 
rgrass7, I need to know how to start R under OSGeo4W64 outside GRASS.

Roger

On Wed, 23 Nov 2016, Chris Reudenbach wrote:

> Michael,
>
>
> using GRASS from R is a bit cumbersome. GRASS (and this is for sure one of it 
> strength ) is extremely rigid with projections etc. Due to this you should 
> setup a correct structure. I use a setup that is similar to the below 
> snippet.
>
> cheers Chris
>
>
> library(rgrass7)
> library(sp)
>
> # setup a temp workingdir
> working.dir<- "~/tmp/"
>
> # get meuse data
>
> data(meuse)
> data(meuse.grid)
>
> # georeference the meuse grid data
> coordinates(meuse.grid) <- ~x+y
> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
> gridded(meuse.grid) <- TRUE
>
> # get a first cellsize/pixel resolution for GRASS
> resolution <- meuse.grid at grid@cellsize[1]
>
> # georeference the meuse data
> coordinates(meuse) <- ~x+y
> proj4string(meuse) <- as.character(CRS("+init=epsg:28992"))
>
> # get projection, proj4 string and extent for GRASS
> projection<-(strsplit(meuse at proj4string@projargs,split = " "))
> proj4<- paste(projection[[1]][2:length(unlist(projection))], collapse = ' ')
> xmax<-meuse at bbox[3]
> xmin<-meuse at bbox[1]
> ymax<-meuse at bbox[4]
> ymin<-meuse@@bbox[2]
>
> # create and set working directory
> if (!file.exists(file.path(working.dir,"run"))){
>  dir.create(file.path(working.dir,"run"),recursive = TRUE)
> }
> setwd(file.path( working.dir,"run"))
>
>
> ############ set up GRASS RUNTIME environment
>
> # define the GRASS executable path
> if(Sys.info()["sysname"] == "Windows"){
>  grass.gis.base<-'C:/OSGeo4W64/apps/grass/grass-7.0.5'
> }else {
>  grass.gis.base<-'/usr/lib/grass72'
> }
>
> # set path for optional GRASS addons
> Sys.setenv(GRASS_ADDON_PATH="~/.grass7/addons")
>
> # create the TEMPORARY GRASS location
> rgrass7::initGRASS(gisBase=grass.gis.base,
>                    home=tempdir(),
>                    mapset='PERMANENT',
>                    override=TRUE
> )
>
> # assign GRASS projection according to data set
> rgrass7::execGRASS('g.proj',
>                    flags=c('c','quiet'),
>                    proj4=proj4
> )
>
> # assign GRASS extent and resolution
> rgrass7::execGRASS('g.region',
>                    flags=c('quiet'),
>                    n=as.character(ymax),
>                    s=as.character(ymin),
>                    e=as.character(xmax),
>                    w=as.character(xmin),
>                    res=as.character(resolution)
> )
>
>
> #############   now do GRASS STUFF
>
> writeVECT(meuse,"meuse")
> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
> precision")
>
>
> On 23.11.2016 07:38, Michael DELORME wrote:
>>  Thanks for your insight.
>>  I'll use a stand-alone GRASS install.
>>
>>  Cordially
>>
>>  Le 22/11/2016 15:13, Roger Bivand a ?crit :
>> >  On Tue, 22 Nov 2016, Michael DELORME wrote:
>> > 
>> > >  Thanks for investigating.
>> > > 
>> > >  I'll try a standalone version of GRASS if needed.
>> > > 
>> > >  Here is the traceback
>> > > 
>> > > >  traceback()
>> > >  4: stop(paste(cmd, "not parsed"))
>> > >  3: parseGRASS(cmd, legacyExec = legacyExec)
>> > >  2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
>> > >  echoCmd, legacyExec = legacyExec)
>> > >  1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 
>> > >  double
>> > >  precision")
>> > > 
>> > >  My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>> > >  indeed the *.bat command are those which don't work (r.mask.bat,
>> > >  v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
>> > >  v.db.addcolumn.bat is :
>> > > 
>> > >  @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>> > > 
>> > >  So I guess something must be wrong in my Python installation... (it
>> > >  works however from within a GRASS shell)
>> >  No, the logic for Windows and initGRASS has only ever been tested with
>> >  stand-alone GRASS. I would guess that in OSGeo4W the path variables
>> >  are wrong. I cannot even find out how to run initGRASS in R but
>> >  outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
>> >  OSGeo4W shell (cannot create a temporary GRASS location). Unless you
>> >  or others really need OSGeo4W, I suggest asking others to implement
>> >  that - very bulky and fragile.
>> > 
>> >  Roger
>> > 
>> > >  Cordially
>> > > 
>> > > 
>> > >  Le 22/11/2016 14:30, Roger Bivand a ?crit :
>> > > >  On Tue, 22 Nov 2016, Michael DELORME wrote:
>> > > > 
>> > > > >  Thanks for replying
>> > > > > 
>> > > > >  Here is a reproducible example (change your GRASS directory of
>> > > > >  course) :
>> > > > > 
>> > > > >  library(rgrass7)
>> > > > >  library(sp)
>> > > > >  initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>> > > > >  override = TRUE)
>> > > > >  data(meuse)
>> > > > >  coordinates(meuse) <- ~x+y
>> > > > >  writeVECT(meuse, "meuse")
>> > > > >  execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 
>> > > > >  double
>> > > > >  precision")
>> > > >  This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>> > > >  stand-alone. Do you need to use OSGeo4W - the internal logic used 
>> > > >  for
>> > > >  finding out where the different versions keep their executables and
>> > > >  batch files varies?
>> > > > 
>> > > >  What does traceback() say after the error? The error comes from
>> > > >  parseGRASS("v.db.addcolumn") - the XML error comes from not being 
>> > > >  able
>> > > >  to read the output of v.db.addcolumn<.ext> --interface-description
>> > > >  where <.ext> may be .exe or .bat I think.
>> > > > 
>> > > >  Roger
>> > > > 
>> > > > >  I get :
>> > > > >  Error : XML content does not seem to be XML: 'The specified path
>> > > > >  was not
>> > > > >  found.'
>> > > > >  In addition: Warning message:
>> > > > >  running command 'v.db.addcolumn.bat --interface-description' had
>> > > > >  status 1
>> > > > >  Error in parseGRASS(cmd, legacyExec = legacyExec) :
>> > > > >    v.db.addcolumn not parsed
>> > > > > 
>> > > > >  Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work 
>> > > > >  fine,
>> > > > >  but some other (r.mask) fail with a similar XML error.
>> > > > > 
>> > > > >  All commands work fine when used from the GRASS shell...
>> > > > > 
>> > > > >  What is this XML error ?
>> > > > >  Thanks
>> > > > > 
>> > > > >  Le 22/11/2016 09:34, Roger Bivand a ?crit :
>> > > > > >  On Tue, 22 Nov 2016, Michael DELORME wrote:
>> > > > > > 
>> > > > > > >  Dear list,
>> > > > > > > 
>> > > > > > >  Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo 
>> > > > > > >  distribution),
>> > > > > > >  I get
>> > > > > > >  the following error :
>> > > > > >  Please always try to provide a reproducible example using a 
>> > > > > >  standard
>> > > > > >  data set. In addition, the output of traceback() following the 
>> > > > > >  error
>> > > > > >  would be helpful. Are you running R inside GRASS, or using R to
>> > > > > >  initiate GRASS?
>> > > > > > 
>> > > > > >  Consider using the grass-stats list:
>> > > > > > 
>> > > > > >  https://lists.osgeo.org/mailman/listinfo/grass-stats
>> > > > > > 
>> > > > > >  as it is more likely to yield results, but there also provide an
>> > > > > >  example that anyone can reproduce. The example should avoid 
>> > > > > >  loading
>> > > > > >  other packages, and should be run from the R console (not, say,
>> > > > > >  RStudio).
>> > > > > > 
>> > > > > >  Roger
>> > > > > > 
>> > > > > > 
>> > > > > > 
>> > > > > > > >  execGRASS("v.db.addcolumn", map = "result_v", columns = 
>> > > > > > > >  "area_m2
>> > > > > > > >  double precision")
>> > > > > > >  Error : XML content does not seem to be XML: 'Le chemin 
>> > > > > > >  d'acc?s
>> > > > > > >  sp?cifi? est introuvable.' In addition: Warning message: 
>> > > > > > >  running
>> > > > > > >  command 'v.db.addcolumn.bat --interface-description' had 
>> > > > > > >  status 1
>> > > > > > >  Error in parseGRASS(cmd, legacyExec = legacyExec) :
>> > > > > > >    v.db.addcolumn not parsed
>> > > > > > > 
>> > > > > > > 
>> > > > > > >  and a similar one for r.mask :
>> > > > > > > 
>> > > > > > > >  execGRASS("r.mask", raster = "map")
>> > > > > > >  Error : XML content does not seem to be XML: 'Le chemin 
>> > > > > > >  d'acc?s
>> > > > > > >  sp?cifi? est introuvable.'
>> > > > > > >  In addition: Warning message:
>> > > > > > >  running command 'r.mask.bat --interface-description' had 
>> > > > > > >  status 1
>> > > > > > >  Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>> > > > > > >  parsed
>> > > > > > > 
>> > > > > > > 
>> > > > > > >  whereas most other execGRASS command I tried work as expected.
>> > > > > > >  Any idea ?
>> > > > > > >  Thanks in advance
>> > > > > > > 
>> > > > > > >  Here is my session info :
>> > > > > > > 
>> > > > > > > >  sessionInfo()
>> > > > > > >  R version 3.3.1 (2016-06-21)
>> > > > > > >  Platform: x86_64-w64-mingw32/x64 (64-bit)
>> > > > > > >  Running under: Windows 7 x64 (build 7601) Service Pack 1
>> > > > > > > 
>> > > > > > >  locale:
>> > > > > > >  [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>> > > > > > >  LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>> > > > > > >  LC_TIME=French_France.1252
>> > > > > > >  attached base packages:
>> > > > > > >  [1] parallel  stats     graphics  grDevices utils     datasets
>> > > > > > >  methods   base
>> > > > > > >  other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 
>> > > > > > >  beepr_1.2
>> > > > > > >  raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>> > > > > > > 
>> > > > > > >  loaded via a namespace (and not attached): [1] magrittr_1.5
>> > > > > > >  tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>> > > > > > >  stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>> > > > > > > 
>> > > > > > > 
>> > > > > > > 
>> > > > > > >       [[alternative HTML version deleted]]
>> > > > > > > 
>> > > > > > >  _______________________________________________
>> > > > > > >  R-sig-Geo mailing list
>> > > > > > >  R-sig-Geo at r-project.org
>> > > > > > >  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > > > >  -- 
>> > > > >  *Micha?l DELORME*
>> > > > >  Administrateur de donn?es, charg? de projet en g?omatique
>> > > > >  Service r?gional de l'information statistique, ?conomique et
>> > > > >  territoriale
>> > > > >  Direction r?gionale de l'alimentation, de l'agriculture et de la 
>> > > > >  for?t
>> > > > >  Auvergne-Rh?ne-Alpes
>> > > > >  Site de Lyon
>> > > > >  165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>> > > > >  04 78 63 34 21
>> > > > > 
>> > > > >  Pour ?crire au service :
>> > > > >  DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>> > > > >  16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>> > > > > 
>> > > > >  http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>> > > > > 
>> > > > >       [[alternative HTML version deleted]]
>> > > > > 
>> > > > >  _______________________________________________
>> > > > >  R-sig-Geo mailing list
>> > > > >  R-sig-Geo at r-project.org
>> > > > >  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > > 
>> > >
>>  _______________________________________________
>>  R-sig-Geo mailing list
>>  R-sig-Geo at r-project.org
>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From michael.delorme at agriculture.gouv.fr  Wed Nov 23 11:06:04 2016
From: michael.delorme at agriculture.gouv.fr (Michael DELORME)
Date: Wed, 23 Nov 2016 11:06:04 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <260ac653-9ab0-86f0-f738-72f9629e0beb@uni-marburg.de>
References: <5833E886.7000408@agriculture.gouv.fr>	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>	<58343D69.1040900@agriculture.gouv.fr>	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>	<58344D30.4090206@agriculture.gouv.fr>	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>	<58353973.5000406@agriculture.gouv.fr>
	<260ac653-9ab0-86f0-f738-72f9629e0beb@uni-marburg.de>
Message-ID: <58356A0C.7050108@agriculture.gouv.fr>

Thanks for sharing ; I'll look into it.
Cordially

Le 23/11/2016 09:58, Chris Reudenbach a ?crit :
> Michael,
>
>
> using GRASS from R is a bit cumbersome. GRASS (and this is for sure
> one of it strength ) is extremely rigid with projections etc. Due to
> this you should setup a correct structure. I use a setup that is
> similar to the below snippet.
>
> cheers Chris
>
>
> library(rgrass7)
> library(sp)
>
> # setup a temp workingdir
> working.dir<- "~/tmp/"
>
> # get meuse data
>
> data(meuse)
> data(meuse.grid)
>
> # georeference the meuse grid data
> coordinates(meuse.grid) <- ~x+y
> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
> gridded(meuse.grid) <- TRUE
>
> # get a first cellsize/pixel resolution for GRASS
> resolution <- meuse.grid at grid@cellsize[1]
>
> # georeference the meuse data
> coordinates(meuse) <- ~x+y
> proj4string(meuse) <- as.character(CRS("+init=epsg:28992"))
>
> # get projection, proj4 string and extent for GRASS
> projection<-(strsplit(meuse at proj4string@projargs,split = " "))
> proj4<- paste(projection[[1]][2:length(unlist(projection))], collapse
> = ' ')
> xmax<-meuse at bbox[3]
> xmin<-meuse at bbox[1]
> ymax<-meuse at bbox[4]
> ymin<-meuse@@bbox[2]
>
> # create and set working directory
> if (!file.exists(file.path(working.dir,"run"))){
>   dir.create(file.path(working.dir,"run"),recursive = TRUE)
> }
> setwd(file.path( working.dir,"run"))
>
>
> ############ set up GRASS RUNTIME environment
>
> # define the GRASS executable path
> if(Sys.info()["sysname"] == "Windows"){
>   grass.gis.base<-'C:/OSGeo4W64/apps/grass/grass-7.0.5'
> }else {
>   grass.gis.base<-'/usr/lib/grass72'
> }
>
> # set path for optional GRASS addons
> Sys.setenv(GRASS_ADDON_PATH="~/.grass7/addons")
>
> # create the TEMPORARY GRASS location
> rgrass7::initGRASS(gisBase=grass.gis.base,
>                    home=tempdir(),
>                    mapset='PERMANENT',
>                    override=TRUE
> )
>
> # assign GRASS projection according to data set
> rgrass7::execGRASS('g.proj',
>                    flags=c('c','quiet'),
>                    proj4=proj4
> )
>
> # assign GRASS extent and resolution
> rgrass7::execGRASS('g.region',
>                    flags=c('quiet'),
>                    n=as.character(ymax),
>                    s=as.character(ymin),
>                    e=as.character(xmax),
>                    w=as.character(xmin),
>                    res=as.character(resolution)
> )
>
>
> #############   now do GRASS STUFF
>
> writeVECT(meuse,"meuse")
> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
> precision")
>
>
> On 23.11.2016 07:38, Michael DELORME wrote:
>> Thanks for your insight.
>> I'll use a stand-alone GRASS install.
>>
>> Cordially
>>
>> Le 22/11/2016 15:13, Roger Bivand a ?crit :
>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>
>>>> Thanks for investigating.
>>>>
>>>> I'll try a standalone version of GRASS if needed.
>>>>
>>>> Here is the traceback
>>>>
>>>>> traceback()
>>>> 4: stop(paste(cmd, "not parsed"))
>>>> 3: parseGRASS(cmd, legacyExec = legacyExec)
>>>> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
>>>> echoCmd, legacyExec = legacyExec)
>>>> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>>>> double
>>>> precision")
>>>>
>>>> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>>>> indeed the *.bat command are those which don't work (r.mask.bat,
>>>> v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
>>>> v.db.addcolumn.bat is :
>>>>
>>>> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>>>>
>>>> So I guess something must be wrong in my Python installation... (it
>>>> works however from within a GRASS shell)
>>> No, the logic for Windows and initGRASS has only ever been tested with
>>> stand-alone GRASS. I would guess that in OSGeo4W the path variables
>>> are wrong. I cannot even find out how to run initGRASS in R but
>>> outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
>>> OSGeo4W shell (cannot create a temporary GRASS location). Unless you
>>> or others really need OSGeo4W, I suggest asking others to implement
>>> that - very bulky and fragile.
>>>
>>> Roger
>>>
>>>> Cordially
>>>>
>>>>
>>>> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>
>>>>>> Thanks for replying
>>>>>>
>>>>>> Here is a reproducible example (change your GRASS directory of
>>>>>> course) :
>>>>>>
>>>>>> library(rgrass7)
>>>>>> library(sp)
>>>>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>>>>> override = TRUE)
>>>>>> data(meuse)
>>>>>> coordinates(meuse) <- ~x+y
>>>>>> writeVECT(meuse, "meuse")
>>>>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>>>>> precision")
>>>>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>>>>> stand-alone. Do you need to use OSGeo4W - the internal logic used for
>>>>> finding out where the different versions keep their executables and
>>>>> batch files varies?
>>>>>
>>>>> What does traceback() say after the error? The error comes from
>>>>> parseGRASS("v.db.addcolumn") - the XML error comes from not being
>>>>> able
>>>>> to read the output of v.db.addcolumn<.ext> --interface-description
>>>>> where <.ext> may be .exe or .bat I think.
>>>>>
>>>>> Roger
>>>>>
>>>>>> I get :
>>>>>> Error : XML content does not seem to be XML: 'The specified path
>>>>>> was not
>>>>>> found.'
>>>>>> In addition: Warning message:
>>>>>> running command 'v.db.addcolumn.bat --interface-description' had
>>>>>> status 1
>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>   v.db.addcolumn not parsed
>>>>>>
>>>>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work
>>>>>> fine,
>>>>>> but some other (r.mask) fail with a similar XML error.
>>>>>>
>>>>>> All commands work fine when used from the GRASS shell...
>>>>>>
>>>>>> What is this XML error ?
>>>>>> Thanks
>>>>>>
>>>>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>>
>>>>>>>> Dear list,
>>>>>>>>
>>>>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution),
>>>>>>>> I get
>>>>>>>> the following error :
>>>>>>> Please always try to provide a reproducible example using a
>>>>>>> standard
>>>>>>> data set. In addition, the output of traceback() following the
>>>>>>> error
>>>>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>>>>> initiate GRASS?
>>>>>>>
>>>>>>> Consider using the grass-stats list:
>>>>>>>
>>>>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>>>>
>>>>>>> as it is more likely to yield results, but there also provide an
>>>>>>> example that anyone can reproduce. The example should avoid loading
>>>>>>> other packages, and should be run from the R console (not, say,
>>>>>>> RStudio).
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>>>>>>> double precision")
>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>>>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>>   v.db.addcolumn not parsed
>>>>>>>>
>>>>>>>>
>>>>>>>> and a similar one for r.mask :
>>>>>>>>
>>>>>>>>> execGRASS("r.mask", raster = "map")
>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>> sp?cifi? est introuvable.'
>>>>>>>> In addition: Warning message:
>>>>>>>> running command 'r.mask.bat --interface-description' had status 1
>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>>>>>>>> parsed
>>>>>>>>
>>>>>>>>
>>>>>>>> whereas most other execGRASS command I tried work as expected.
>>>>>>>> Any idea ?
>>>>>>>> Thanks in advance
>>>>>>>>
>>>>>>>> Here is my session info :
>>>>>>>>
>>>>>>>>> sessionInfo()
>>>>>>>> R version 3.3.1 (2016-06-21)
>>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>>
>>>>>>>> locale:
>>>>>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>>>>> LC_TIME=French_France.1252
>>>>>>>> attached base packages:
>>>>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>>>>> methods   base
>>>>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>>>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>>>>
>>>>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>> -- 
>>>>>> *Micha?l DELORME*
>>>>>> Administrateur de donn?es, charg? de projet en g?omatique
>>>>>> Service r?gional de l'information statistique, ?conomique et
>>>>>> territoriale
>>>>>> Direction r?gionale de l'alimentation, de l'agriculture et de la
>>>>>> for?t
>>>>>> Auvergne-Rh?ne-Alpes
>>>>>> Site de Lyon
>>>>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>>>>> 04 78 63 34 21
>>>>>>
>>>>>> Pour ?crire au service :
>>>>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>>>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>>>>
>>>>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>>>>
>>>>>>      [[alternative HTML version deleted]]
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
*Micha?l DELORME*
Administrateur de donn?es, charg? de projet en g?omatique
Service r?gional de l'information statistique, ?conomique et territoriale
Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
Auvergne-Rh?ne-Alpes
Site de Lyon
165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
04 78 63 34 21

Pour ?crire au service :
DRAAF Auvergne-Rh?ne-Alpes ? SRISET
16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES

http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Wed Nov 23 14:15:35 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 23 Nov 2016 07:15:35 -0600
Subject: [R-sig-Geo] v.split.length (GRASS) in R
Message-ID: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>

Dear list members,

Is it possible to run v.split.length from GRASS in R? Or is there anyway to
split a SpatialLinesDataFrame to shorter segments by length in R?

Best,

Manuel

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From flobetz at web.de  Wed Nov 23 14:28:13 2016
From: flobetz at web.de (Florian Betz)
Date: Wed, 23 Nov 2016 14:28:13 +0100
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
References: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
Message-ID: <f03529fe-253c-bf5c-e90c-ab87c48bb8b4@web.de>

Assuming you are using GRASS 7, you can use the rgrass7 package. First 
thing to do is to initialize the R-GRASS connection, then you can run 
the module using execGRASS.

library(rgrass7)
#Arguments depending on your system
initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.0.5",home=tempdir(),
           gisDbase="Path to the folder with your location, 
location="Your GRASS location",mapset="Your GRASS mapset",override=TRUE)
#See the help of v.split.lenght for the necessary function arguments
execGRASS("v.split.length", argument1=, argument2=, ...)

Regards,

Flo

Am 23.11.2016 um 14:15 schrieb Manuel Sp?nola:
> Dear list members,
>
> Is it possible to run v.split.length from GRASS in R? Or is there anyway to
> split a SpatialLinesDataFrame to shorter segments by length in R?
>
> Best,
>
> Manuel
>


From malNamalJa at gmx.de  Wed Nov 23 15:45:24 2016
From: malNamalJa at gmx.de (=?UTF-8?Q?=22Jannes_M=C3=BCnchow=22?=)
Date: Wed, 23 Nov 2016 15:45:24 +0100
Subject: [R-sig-Geo] v.split.length (GRASS) in R
Message-ID: <trinity-f1cf80d6-b50b-4abc-b23b-9e885b03555c-1479912323923@3capp-gmx-bs44>

To achieve this, you can also use the RQGIS-package in conjunction with GRASS given you have installed QGIS along with GRASS (for more information have a look at vignette("install_guide", package = "RQGIS"):

# construct a SpatialPointsDataFrame (which will be accepted as input by
# run_qgis)
library("sp")
# from the sp vignette:
l1 <- cbind(c(1, 2, 3), c(3, 2, 2))
rownames(l1) <- letters[1:3]
l1a <- cbind(l1[, 1] + 0.05, l1[, 2] + 0.05)
rownames(l1a) <- letters[1:3]
l2 <- cbind(c(1, 2, 3), c(1, 1.5, 1))
rownames(l2) <- letters[1:3]
Sl1 <- Line(l1)
Sl1a <- Line(l1a)
Sl2 <- Line(l2)
S1 <- Lines(list(Sl1, Sl1a), ID = "a")
S2 <- Lines(list(Sl2), ID = "b")
Sl <- SpatialLines(list(S1, S2))
# convert it to a SpatialLinesDataFrame
Sl <- SpatialLinesDataFrame(Sl, data = data.frame(1:2), match.ID = FALSE)
proj4string(Sl) <- CRS("+proj=longlat +datum=WGS84")

# Now use RQGIS
library("RQGIS")
# indicate where QGIS is installed on your computer
qgis_env <- set_env("C:/OSGeo4W64/")
args <- get_args_man("grass7:v.split.length", qgis_env = qgis_env, 
                     options = TRUE)
# have a look at the GRASS online help
open_help("grass7:v.split.length", qgis_env = qgis_env)

# specify the necessary arguments
args$input <- Sl
# here length corresponds to one decimal degree
args$length <- "1"
args$output <- file.path(tempdir(), "out.shp")
# load the output directly into R again
out <- run_qgis(alg = "grass7:v.split.length", params = args,
                load_output = args$output,
                qgis_env = qgis_env)
length(Sl)  # 2 line objects
length(out)  #  9 line objects
# Have a look at the output
plot(out, col = rep(c("blue", "green", "black"), 3))
?
Cheers, 

Jannes


From malNamalJa at gmx.de  Wed Nov 23 15:49:18 2016
From: malNamalJa at gmx.de (=?UTF-8?Q?=22Jannes_M=C3=BCnchow=22?=)
Date: Wed, 23 Nov 2016 15:49:18 +0100
Subject: [R-sig-Geo] v.split.length (GRASS) in R
Message-ID: <trinity-31564d0b-286c-4a1a-a086-7b8051c465fd-1479912558865@3capp-gmx-bs44>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161123/8323a2c8/attachment.html>

From thi_veloso at yahoo.com.br  Wed Nov 23 16:56:32 2016
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Wed, 23 Nov 2016 15:56:32 +0000 (UTC)
Subject: [R-sig-Geo] Calculate the area of pixel in square kilometers
 from a raster in lat/long projection
In-Reply-To: <DM5PR20MB12436BE877E0466DCDC9D75BC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>
References: <DM5PR20MB1243FA13887323578215A0FBC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>
	<DM5PR20MB12436BE877E0466DCDC9D75BC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>
Message-ID: <1607627825.1033544.1479916592539@mail.yahoo.com>

raster::area would calculate the area in square kilometers, and from there one can convert to hectare or square meters.

I was wondering: how do those calculations differ from raster::area's? 
Greetings,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota


On Tuesday, November 22, 2016 8:15 PM, Isaque Daniel <isaquedanielre at hotmail.com> wrote:



Hi there,
I found a example in stackoverflow of distance calculation and convertion, so I modificate that to compute the area by pixel in hectares using the raster in degrees.

#####
# Function to compute the area  in hectares

measureAreahec <- function(imageRaster) {
  R <- 6378.137                                # radius of earth in Km
  areaImagetemp <- area(ceiImg)
  xresVal <- xres(areaImagetemp)
  yresVal <- yres(areaImagetemp)
  coords <- data.frame(coordinates(areaImagetemp))
  colnames(coords) <- c("lon","lat")
  lon1 <- coords$lon - (xresVal/2)
  lon2 <- coords$lon + (xresVal/2)
  lat1 <- coords$lat - (yresVal/2)
  lat2 <- coords$lat + (yresVal/2)

  # width
  dLat <- (lat1-lat1)*pi/180
  dLon <- (lon2-lon1)*pi/180
  a <- sin((dLat/2))^2 + cos(lat1*pi/180)*cos(lat1*pi/180)*(sin(dLon/2))^2
  c <- 2 * atan2(sqrt(a), sqrt(1-a))
  dlongitude <- R * c * 1000

  # heigth
  dLat <- (lat1-lat2)*pi/180
  dLon <- (lon1-lon1)*pi/180
  a <- sin((dLat/2))^2 + cos(lat1*pi/180)*cos(lat1*pi/180)*(sin(dLon/2))^2
  c <- 2 * atan2(sqrt(a), sqrt(1-a))
  dlatitude <- R * c * 1000
  return (dlatitude * dlongitude / 10000)                            # distance in meters
}
##########################


It's a very simple one, but ,maybe can help somebody.

Best
Isaque


------------------------------------------------------------------------------------------------------------------
Agronomist engineer
Master in Remote Sensing - National  Institute for Space Research (INPE) - Brazil
PHD Student in Transport - Brazlia University (UNB)


________________________________
De: R-sig-Geo <r-sig-geo-bounces at r-project.org> em nome de Isaque Daniel <isaquedanielre at hotmail.com>
Enviado: ter?-feira, 22 de novembro de 2016 17:48
Para: r-sig-geo
Assunto: [R-sig-Geo] Calculate the area of pixel in square kilometers from a raster in lat/long projection

Hi,


I'm looking for some advice to convert the area calculated by raster::area() in a raster image as the projection in lat/long.

[[elided Hotmail spam]]
Best
Isaque


------------------------------------------------------------------------------------------------------------------
Agronomist engineer
Master in Remote Sensing - National  Institute for Space Research (INPE) - Brazil
PHD Student in Transport - Brazilia University (UNB)

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo





    [[alternative HTML version deleted]]


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From isaquedanielre at hotmail.com  Wed Nov 23 17:11:28 2016
From: isaquedanielre at hotmail.com (Isaque Daniel)
Date: Wed, 23 Nov 2016 16:11:28 +0000
Subject: [R-sig-Geo] Calculate the area of pixel in square kilometers
 from a raster in lat/long projection
In-Reply-To: <1607627825.1033544.1479916592539@mail.yahoo.com>
References: <DM5PR20MB1243FA13887323578215A0FBC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>
	<DM5PR20MB12436BE877E0466DCDC9D75BC9B40@DM5PR20MB1243.namprd20.prod.outlook.com>,
	<1607627825.1033544.1479916592539@mail.yahoo.com>
Message-ID: <DM5PR20MB12434C400CB7F677ABE6AEF5C9B70@DM5PR20MB1243.namprd20.prod.outlook.com>

Hi Thiago,


The function calculate the area by pixel "like raster::area", but, considering the distortions of projection and transforming from degree to hectares (or square kilometers, if someone need).

The problem is: how to compute the area for raster maps during the interactive process and compare as the values used to define the classification (chosing the thresholds), because the raster::area return the area in the projection of raster, and for huge datasets or multiple aplications in sequence (or both togheter, as in my case), is computational hard to reproject raster ou poor to work with "mean value of pixel" in large rasters......

So, I develop this simple function.
Best
Isaque


------------------------------------------------------------------------------------------------------------------
Eng. Agr. Isaque Daniel Rocha Eberhardt
Mestre em Sensoriamento Remoto - Instituto Nacional de Pesquisas Espaciais (INPE)
Doutorando em Transportes - Universidade de Bras??lia (UNB)
Mobile: +55 (061) 99015658
------------------------------------------------------------------------------------------------------------------
Agronomist engineer
Master in Remote Sensing - National  Institute for Space Research (INPE) - Brazil
PHD Student in Transport - Bras??lia University (UNB)


________________________________
De: Thiago V. dos Santos <thi_veloso at yahoo.com.br>
Enviado: quarta-feira, 23 de novembro de 2016 15:56
Para: Isaque Daniel; r-sig-geo
Assunto: Re: [R-sig-Geo] Calculate the area of pixel in square kilometers from a raster in lat/long projection

raster::area would calculate the area in square kilometers, and from there one can convert to hectare or square meters.

I was wondering: how do those calculations differ from raster::area's?
Greetings,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota


On Tuesday, November 22, 2016 8:15 PM, Isaque Daniel <isaquedanielre at hotmail.com> wrote:



Hi there,
I found a example in stackoverflow of distance calculation and convertion, so I modificate that to compute the area by pixel in hectares using the raster in degrees.

#####
# Function to compute the area  in hectares

measureAreahec <- function(imageRaster) {
  R <- 6378.137                                # radius of earth in Km
  areaImagetemp <- area(ceiImg)
  xresVal <- xres(areaImagetemp)
  yresVal <- yres(areaImagetemp)
  coords <- data.frame(coordinates(areaImagetemp))
  colnames(coords) <- c("lon","lat")
  lon1 <- coords$lon - (xresVal/2)
  lon2 <- coords$lon + (xresVal/2)
  lat1 <- coords$lat - (yresVal/2)
  lat2 <- coords$lat + (yresVal/2)

  # width
  dLat <- (lat1-lat1)*pi/180
  dLon <- (lon2-lon1)*pi/180
  a <- sin((dLat/2))^2 + cos(lat1*pi/180)*cos(lat1*pi/180)*(sin(dLon/2))^2
  c <- 2 * atan2(sqrt(a), sqrt(1-a))
  dlongitude <- R * c * 1000

  # heigth
  dLat <- (lat1-lat2)*pi/180
  dLon <- (lon1-lon1)*pi/180
  a <- sin((dLat/2))^2 + cos(lat1*pi/180)*cos(lat1*pi/180)*(sin(dLon/2))^2
  c <- 2 * atan2(sqrt(a), sqrt(1-a))
  dlatitude <- R * c * 1000
  return (dlatitude * dlongitude / 10000)                            # distance in meters
}
##########################


It's a very simple one, but ,maybe can help somebody.

Best
Isaque


------------------------------------------------------------------------------------------------------------------
Agronomist engineer
Master in Remote Sensing - National  Institute for Space Research (INPE) - Brazil
PHD Student in Transport - Brazlia University (UNB)


________________________________
De: R-sig-Geo <r-sig-geo-bounces at r-project.org> em nome de Isaque Daniel <isaquedanielre at hotmail.com>
Enviado: ter?-feira, 22 de novembro de 2016 17:48
Para: r-sig-geo
Assunto: [R-sig-Geo] Calculate the area of pixel in square kilometers from a raster in lat/long projection

Hi,


I'm looking for some advice to convert the area calculated by raster::area() in a raster image as the projection in lat/long.

[[elided Hotmail spam]]
Best
Isaque


------------------------------------------------------------------------------------------------------------------
Agronomist engineer
Master in Remote Sensing - National  Institute for Space Research (INPE) - Brazil
PHD Student in Transport - Brazilia University (UNB)

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo


R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo


stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo





    [[alternative HTML version deleted]]


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
R-sig-Geo Info Page<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
stat.ethz.ch
R-sig-Geo -- R Special Interest Group on using Geographical data and Mapping About R-sig-Geo



	[[alternative HTML version deleted]]


From macqueen1 at llnl.gov  Wed Nov 23 17:40:46 2016
From: macqueen1 at llnl.gov (MacQueen, Don)
Date: Wed, 23 Nov 2016 16:40:46 +0000
Subject: [R-sig-Geo] R - QGIS integration
In-Reply-To: <CAPP0wyhy1MaPDrOUYSc7bqw8hvBfc-bj+2g021GrGDUSO96STQ@mail.gmail.com>
References: <CAPP0wyhy1MaPDrOUYSc7bqw8hvBfc-bj+2g021GrGDUSO96STQ@mail.gmail.com>
Message-ID: <D45B0620.18FF10%macqueen1@llnl.gov>

And if Kent is correct, then there is also:


subplot  package:Hmisc  R Documentation

Embed a new plot within an existing plot

Description:

     Subplot will embed a new plot within an existing plot at the
     coordinates specified (in user units of the existing plot).



(Which would not require learning ggplot2)
-- 
Don MacQueen

Lawrence Livermore National Laboratory
7000 East Ave., L-627
Livermore, CA 94550
925-423-1062





On 11/22/16, 6:05 AM, "R-sig-Geo on behalf of Kent Johnson"
<r-sig-geo-bounces at r-project.org on behalf of kent3737 at gmail.com> wrote:

>If I understand correctly your question is not about QGIS but about using
>R
>to make maps with inset charts. There are several examples of charts on
>maps here:
>http://stackoverflow.com/questions/10368180/plotting-pie-graphs-on-map-in-
>ggplot
>
>Also ggmap + ggmap::inset looks like it will do what you want, see the
>ggplot2::annotation_custom example for a little help.
>
>Kent
>
>On Mon, Nov 21, 2016 at 6:00 AM, <r-sig-geo-request at r-project.org> wrote:
>
>
>> -----------------------------
>>
>> Message: 7
>> Date: Mon, 21 Nov 2016 10:40:26 +0100
>> From: Domagoj Culinovic <culinovic.domagoj at gmail.com>
>> To: R-sig-Geo at r-project.org
>> Subject: [R-sig-Geo] R - QGIS integration
>> Message-ID:
>>         <CACgt3omw7mXC1oPh1pXEO7bmyL-DMhzroYsor7TEeBkwLYxC1Q at mail.
>> gmail.com>
>> Content-Type: text/plain; charset="UTF-8"
>>
>> Hi,
>> I have Polygon and point data in SHP format which i have use in QGIS.
>>also
>> i have several csv files where i have different statistical data about
>> points and polygons in SHP files.
>> This csv data are generated every week.
>> How to make R script which can make georeferenced charts, diagrams or
>> something like heathmap i R, and return picture or charts at theit
>>position
>> on the map?
>>
>> Regards,
>> Domagoj
>>
>>         [[alternative HTML version deleted]]
>>
>>
>>
>> ------------------------------
>>
>> Subject: Digest Footer
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> ------------------------------
>>
>> End of R-sig-Geo Digest, Vol 159, Issue 15
>> ******************************************
>>
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From johannesschumacher at yahoo.de  Wed Nov 23 15:54:17 2016
From: johannesschumacher at yahoo.de (Johannes Schumacher)
Date: Wed, 23 Nov 2016 14:54:17 +0000 (UTC)
Subject: [R-sig-Geo] raster predict with gnls model
References: <1561249859.804713.1479912857946.ref@mail.yahoo.com>
Message-ID: <1561249859.804713.1479912857946@mail.yahoo.com>

Dear List,

I have trouble with the predict function (raster package) when using a gnls model (nonlinear model fit using generalized least squares, from the nlme package).


I'm using R version 3.3.1 (2016-06-21), Platform: x86_64-w64-mingw32/x64 (64-bit), and raster package version 2.5-8.
I want to make predictions based on three continuous variables and one categorical variable. The predictors are layers in a RasterStack object (see description below: s20, s20_excludefactor). Using other models than gnls works. I tested three models (my_nls, my_lm, my_gnls, see description below):

1) Using nonlinear least squares (nls) fit excluding the factor as predictor works fine:
v20 <- predict(object=s20_excludefactor, model=my_nls) 
2) Using linear model (lm) including the factor as predictor works as well, except the warning:
?not sure if the correct factor levels are used here?. 
v20 <- predict(object=s20, model=my_lm) #  or
v20 <- predict(object=s20, model=my_lm, na.rm=T, factors=list(Gruppe=c("1","2","3")))

3) Using the glns model produces error:
?Error in p %*% beta[pmap[[nm]]] : non-conformable arguments?
v20 <- predict(object=s20, model=my_gnls) #  or
v20 <- predict(object=s20, model=my_gnls, na.rm=T, factors=list(Gruppe=c("1","2","3")))


I don't know what to do about the error in 3). Any help is highly appreciated! 
Best regards,
Johannes

> s20_excludefactor (used in my_nls)
class       : RasterStack 
dimensions  : 50, 50, 2500, 3  (nrow, ncol, ncell, nlayers)
resolution  : 20, 20  (x, y)
extent      : 3390000, 3391000, 5296000, 5297000  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=tmerc +lat_0=0 +lon_0=9 +k=1 +x_0=3500000 +y_0=0 +datum=potsdam +units=m +no_defs +ellps=bessel +towgs84=598.1,73.7,418.2,0.202,0.045,-2.455,6.7 
names       : x1, x2, x3 
min values  :      0.0000,      0.0000,    207.3915 
max values  : 243534.0084,      1.0000,    220.1788 


> s20 (used in my_lm and my_gnls)
class       : RasterStack 
dimensions  : 50, 50, 2500, 4  (nrow, ncol, ncell, nlayers)
resolution  : 20, 20  (x, y)
extent      : 3390000, 3391000, 5296000, 5297000  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=tmerc +lat_0=0 +lon_0=9 +k=1 +x_0=3500000 +y_0=0 +datum=potsdam +units=m +no_defs +ellps=bessel +towgs84=598.1,73.7,418.2,0.202,0.045,-2.455,6.7 
names       : x1, x2, x3,      Gruppe 
min values  :      0.0000,      0.0000,    207.3915,      1.0000 
max values  : 243534.0084,      1.0000,    220.1788,      3.0000 


> my_nls
Nonlinear regression model
model: y ~ a/(1 + exp(b0 + b1 * x1 + b2 * x2 + b3 * x3))
data: datapply
a         b0         b1         b2         b3 
1.500e+03  4.544e+00 -9.134e-06 -1.084e+00 -6.121e-04 
weighted residual sum-of-squares: 56.55


> my_lm
Call:
lm(formula = y ~ x1 + x2 + x3 + Gruppe, data = datapply)
Coefficients:
(Intercept) x1 x2 x3      Gruppe2      Gruppe3 
8.208e+01    2.641e-03   -3.463e+02    8.357e-02    6.749e+01    8.759e+01 


> my_gnls
Generalized nonlinear least squares fit
Model: y ~ a/(1 + exp(b0 + b1 * x1 + b2 * x2 + b3 * x3)) 
Data: datapply 
Log-likelihood: -4305.82
Coefficients:
a             b0             b1             b2 b3.(Intercept)     b3.Gruppe2     b3.Gruppe3 
1.312412e+03   4.410668e+00  -1.001456e-05  -1.082276e+00  -7.200440e-05  -4.635569e-04  -5.423707e-04 
Variance function:
Structure: Power of variance covariate
Formula: ~x1 
Parameter estimates:
power 
0.9695105 


From mspinola10 at gmail.com  Wed Nov 23 20:46:48 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 23 Nov 2016 13:46:48 -0600
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <f03529fe-253c-bf5c-e90c-ab87c48bb8b4@web.de>
References: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
	<f03529fe-253c-bf5c-e90c-ab87c48bb8b4@web.de>
Message-ID: <CABkCotTtKsas=X6LVRgzPXc2m=fUSh3EBx9=SbW18E=scoE0nw@mail.gmail.com>

Thank you very much Florian.

Do you know any R function/package to do the same without relying on GRASS?

Manuel

2016-11-23 7:28 GMT-06:00 Florian Betz <flobetz at web.de>:

> Assuming you are using GRASS 7, you can use the rgrass7 package. First
> thing to do is to initialize the R-GRASS connection, then you can run the
> module using execGRASS.
>
> library(rgrass7)
> #Arguments depending on your system
> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.0.5",home=tempdir(),
>           gisDbase="Path to the folder with your location, location="Your
> GRASS location",mapset="Your GRASS mapset",override=TRUE)
> #See the help of v.split.lenght for the necessary function arguments
> execGRASS("v.split.length", argument1=, argument2=, ...)
>
> Regards,
>
> Flo
>
>
> Am 23.11.2016 um 14:15 schrieb Manuel Sp?nola:
>
>> Dear list members,
>>
>> Is it possible to run v.split.length from GRASS in R? Or is there anyway
>> to
>> split a SpatialLinesDataFrame to shorter segments by length in R?
>>
>> Best,
>>
>> Manuel
>>
>>
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Wed Nov 23 20:49:38 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Wed, 23 Nov 2016 13:49:38 -0600
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <trinity-f1cf80d6-b50b-4abc-b23b-9e885b03555c-1479912323923@3capp-gmx-bs44>
References: <trinity-f1cf80d6-b50b-4abc-b23b-9e885b03555c-1479912323923@3capp-gmx-bs44>
Message-ID: <CABkCotR=+5g-1S_Vx4U=LB=RokWMx74eP9q5335G2NW4o+tmsw@mail.gmail.com>

Thank you very much Jannes.

Does the example works with QGIS 2.18 or should I do some setting in QGIS
before running the code?

Manuel

2016-11-23 8:45 GMT-06:00 "Jannes M?nchow" <malNamalJa at gmx.de>:

> To achieve this, you can also use the RQGIS-package in conjunction with
> GRASS given you have installed QGIS along with GRASS (for more information
> have a look at vignette("install_guide", package = "RQGIS"):
>
> # construct a SpatialPointsDataFrame (which will be accepted as input by
> # run_qgis)
> library("sp")
> # from the sp vignette:
> l1 <- cbind(c(1, 2, 3), c(3, 2, 2))
> rownames(l1) <- letters[1:3]
> l1a <- cbind(l1[, 1] + 0.05, l1[, 2] + 0.05)
> rownames(l1a) <- letters[1:3]
> l2 <- cbind(c(1, 2, 3), c(1, 1.5, 1))
> rownames(l2) <- letters[1:3]
> Sl1 <- Line(l1)
> Sl1a <- Line(l1a)
> Sl2 <- Line(l2)
> S1 <- Lines(list(Sl1, Sl1a), ID = "a")
> S2 <- Lines(list(Sl2), ID = "b")
> Sl <- SpatialLines(list(S1, S2))
> # convert it to a SpatialLinesDataFrame
> Sl <- SpatialLinesDataFrame(Sl, data = data.frame(1:2), match.ID = FALSE)
> proj4string(Sl) <- CRS("+proj=longlat +datum=WGS84")
>
> # Now use RQGIS
> library("RQGIS")
> # indicate where QGIS is installed on your computer
> qgis_env <- set_env("C:/OSGeo4W64/")
> args <- get_args_man("grass7:v.split.length", qgis_env = qgis_env,
>                      options = TRUE)
> # have a look at the GRASS online help
> open_help("grass7:v.split.length", qgis_env = qgis_env)
>
> # specify the necessary arguments
> args$input <- Sl
> # here length corresponds to one decimal degree
> args$length <- "1"
> args$output <- file.path(tempdir(), "out.shp")
> # load the output directly into R again
> out <- run_qgis(alg = "grass7:v.split.length", params = args,
>                 load_output = args$output,
>                 qgis_env = qgis_env)
> length(Sl)  # 2 line objects
> length(out)  #  9 line objects
> # Have a look at the output
> plot(out, col = rep(c("blue", "green", "black"), 3))
>
> Cheers,
>
> Jannes
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo




-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From magezijulian at yahoo.co.uk  Thu Nov 24 08:23:22 2016
From: magezijulian at yahoo.co.uk (julian magezi)
Date: Thu, 24 Nov 2016 07:23:22 +0000 (UTC)
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <CABkCotTtKsas=X6LVRgzPXc2m=fUSh3EBx9=SbW18E=scoE0nw@mail.gmail.com>
References: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
	<f03529fe-253c-bf5c-e90c-ab87c48bb8b4@web.de>
	<CABkCotTtKsas=X6LVRgzPXc2m=fUSh3EBx9=SbW18E=scoE0nw@mail.gmail.com>
Message-ID: <337762497.1556003.1479972202161@mail.yahoo.com>

Hello members,
Which package in R does nonparametric statistical testing?
Thanks
?Julian Ijumulana, MSc (Geoinformatics)Land surveyor, GIS/RS Specialist & Assistant Lecturer,?Department of Transportation and Geotechnical Engineering,College of Engineering and Technology,University of Dar es Salaam,Box 35131,Dar es SalaamTANZANIA
Mob: +255 767675416

 

    On Wednesday, 23 November 2016, 20:49, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
 

 Thank you very much Florian.

Do you know any R function/package to do the same without relying on GRASS?

Manuel

2016-11-23 7:28 GMT-06:00 Florian Betz <flobetz at web.de>:

> Assuming you are using GRASS 7, you can use the rgrass7 package. First
> thing to do is to initialize the R-GRASS connection, then you can run the
> module using execGRASS.
>
> library(rgrass7)
> #Arguments depending on your system
> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.0.5",home=tempdir(),
>? ? ? ? ? gisDbase="Path to the folder with your location, location="Your
> GRASS location",mapset="Your GRASS mapset",override=TRUE)
> #See the help of v.split.lenght for the necessary function arguments
> execGRASS("v.split.length", argument1=, argument2=, ...)
>
> Regards,
>
> Flo
>
>
> Am 23.11.2016 um 14:15 schrieb Manuel Sp?nola:
>
>> Dear list members,
>>
>> Is it possible to run v.split.length from GRASS in R? Or is there anyway
>> to
>> split a SpatialLinesDataFrame to shorter segments by length in R?
>>
>> Best,
>>
>> Manuel
>>
>>
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

??? [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

   
	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Thu Nov 24 09:09:14 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 24 Nov 2016 09:09:14 +0100
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
References: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1611240903460.14523@reclus.nhh.no>

Before giving advice, please do ask for clarification. There is no 
v.split.length in GRASS at all, there is only v.split. Without a fully 
specified GRASS command, such as:

v.split -n input=??, output=??, length=10.0, units="meters"

which means add vertices each 10m, but do not split the vector line, we 
could think that the OP wants to divide a line into contiguous shorter 
segments. What does the OP actually want to do? Once we know that (which 
we do not), we can offer advice, including running the command in GRASS - 
which should be done anyway to ensure that the output of R-only approaches 
matches the desired output object.

Roger


On Wed, 23 Nov 2016, Manuel Sp?nola wrote:

> Dear list members,
>
> Is it possible to run v.split.length from GRASS in R? Or is there anyway to
> split a SpatialLinesDataFrame to shorter segments by length in R?
>
> Best,
>
> Manuel
>
> -- 
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From reudenbach at uni-marburg.de  Thu Nov 24 09:17:19 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Thu, 24 Nov 2016 09:17:19 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <58353973.5000406@agriculture.gouv.fr>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
	<58344D30.4090206@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>
	<58353973.5000406@agriculture.gouv.fr>
Message-ID: <b33f884f-25f7-2510-3bae-1e803fd5db76@uni-marburg.de>

Michael,

Using a fresh OSGEO4W64 standard quick desktop installation (i.e. 
installation of the default desktop GIS software packages with the 
installer and using C:\OSGeo4W64 as path)  I suggest the below solution.

You have to set all necessary eniromental and system variables manually. 
I am not quit sure if I got them but actually it seems to work for your 
question. As a conclusion I think your Python and all of the rest is 
installed correct.


cheers Chris


############### librarys, data etc 
---------------------------------------------
library(rgrass7)
library(sp)

# setup a temp workingdir
working.dir<- "~/tmp/"

# get meuse data

data(meuse)
data(meuse.grid)

# georeference the meuse grid data
coordinates(meuse.grid) <- ~x+y
proj4string(meuse.grid) <- CRS("+init=epsg:28992")
gridded(meuse.grid) <- TRUE

# get a first cellsize/pixel resolution for GRASS
resolution <- meuse.grid at grid@cellsize[1]

# georeference the meuse data
coordinates(meuse) <- ~x+y
proj4string(meuse) <- CRS("+init=epsg:28992")

# get projection, proj4 string and extent for GRASS
projection<-(strsplit(meuse at proj4string@projargs,split = " "))
proj4<- paste(projection[[1]][2:length(unlist(projection))], collapse = ' ')
xmax<-meuse at bbox[3]
xmin<-meuse at bbox[1]
ymax<-meuse at bbox[4]
ymin<-meuse at bbox[2]

# create and set working directory
if (!file.exists(file.path(working.dir,"run"))){
   dir.create(file.path(working.dir,"run"),recursive = TRUE)
}
setwd(file.path( working.dir,"run"))


########### SETUP OSGEO4W enviroment settings manually 
-------------------------
# setup the OSGEO4W environ manually
# assuming a osgeow4w default "deskop fastinstall
# using the default installation directory "C:\OSGeo4W64"

# set OSGE4W base directory
osgeo4w.root<-"C:\\OSGEO4~1"
Sys.setenv(OSGEO4W_ROOT=osgeo4w.root)
# define GISBASE
grass.gis.base<-paste0(osgeo4w.root,"\\apps\\grass\\grass-7.0.5")
Sys.setenv(GISBASE=grass.gis.base)

Sys.setenv(GRASS_PYTHON=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\bin\\python.exe"))
Sys.setenv(PYTHONHOME=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\Python27"))
Sys.setenv(PYTHONPATH=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\grass\\grass-7.0.5\\etc\\python"))
Sys.setenv(GRASS_PROJSHARE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
Sys.setenv(PROJ_LIB=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
Sys.setenv(GDAL_DATA=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\gdal"))
Sys.setenv(GEOTIFF_CSV=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\epsg_csv"))
Sys.setenv(FONTCONFIG_FILE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\etc\\fonts.conf"))

# call all OSGEO4W settings
system("C:/OSGeo4W64/bin/o-help.bat")


# create PATH variable
Sys.setenv(PATH=paste0(grass.gis.base,";",
"C:\\OSGEO4~1\\apps\\Python27\\lib\\site-packages\\numpy\\core",";",
"C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\bin",";",
"C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\lib",";",
"C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc",";",
"C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc\\python",";",
"C:\\OSGeo4W64\\apps\\Python27\\Scripts",";",
                        "C:\\OSGeo4W64\\bin",";",
                        "c:\\OSGeo4W64\\apps",";",
                        "C:\\OSGEO4~1\\apps\\saga",";",
                        paste0(Sys.getenv("WINDIR"),"/WBem"),";",
                        Sys.getenv("PATH")))


#################### start with GRASS setup 
------------------------------------
rgrass7::initGRASS(gisBase=grass.gis.base,
                    home=tempdir(),
                    mapset='PERMANENT',
                    override=TRUE
)

# assign GRASS projection according to data set
rgrass7::execGRASS('g.proj',
                    flags=c('c','quiet'),
                    proj4=proj4
)

# assign GRASS extent and resolution
rgrass7::execGRASS('g.region',
                    flags=c('quiet'),
                    n=as.character(ymax),
                    s=as.character(ymin),
                    e=as.character(xmax),
                    w=as.character(xmin),
                    res=as.character(resolution)
)


#############   now do GRASS STUFF 
---------------------------------------------

rgrass7::writeVECT(meuse,"meuse")
rgrass7::execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 
double
                    precision")
#############  do other command line stuff 
-------------------------------------

## call gdal
system("gdal_merge")

# call saga cli
system("saga_cmd")


Am 23.11.2016 um 07:38 schrieb Michael DELORME:
> Thanks for your insight.
> I'll use a stand-alone GRASS install.
>
> Cordially
>
> Le 22/11/2016 15:13, Roger Bivand a ?crit :
>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>
>>> Thanks for investigating.
>>>
>>> I'll try a standalone version of GRASS if needed.
>>>
>>> Here is the traceback
>>>
>>>> traceback()
>>> 4: stop(paste(cmd, "not parsed"))
>>> 3: parseGRASS(cmd, legacyExec = legacyExec)
>>> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
>>> echoCmd, legacyExec = legacyExec)
>>> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>> precision")
>>>
>>> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>>> indeed the *.bat command are those which don't work (r.mask.bat,
>>> v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
>>> v.db.addcolumn.bat is :
>>>
>>> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>>>
>>> So I guess something must be wrong in my Python installation... (it
>>> works however from within a GRASS shell)
>> No, the logic for Windows and initGRASS has only ever been tested with
>> stand-alone GRASS. I would guess that in OSGeo4W the path variables
>> are wrong. I cannot even find out how to run initGRASS in R but
>> outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
>> OSGeo4W shell (cannot create a temporary GRASS location). Unless you
>> or others really need OSGeo4W, I suggest asking others to implement
>> that - very bulky and fragile.
>>
>> Roger
>>
>>> Cordially
>>>
>>>
>>> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>
>>>>> Thanks for replying
>>>>>
>>>>> Here is a reproducible example (change your GRASS directory of
>>>>> course) :
>>>>>
>>>>> library(rgrass7)
>>>>> library(sp)
>>>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>>>> override = TRUE)
>>>>> data(meuse)
>>>>> coordinates(meuse) <- ~x+y
>>>>> writeVECT(meuse, "meuse")
>>>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>>>> precision")
>>>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>>>> stand-alone. Do you need to use OSGeo4W - the internal logic used for
>>>> finding out where the different versions keep their executables and
>>>> batch files varies?
>>>>
>>>> What does traceback() say after the error? The error comes from
>>>> parseGRASS("v.db.addcolumn") - the XML error comes from not being able
>>>> to read the output of v.db.addcolumn<.ext> --interface-description
>>>> where <.ext> may be .exe or .bat I think.
>>>>
>>>> Roger
>>>>
>>>>> I get :
>>>>> Error : XML content does not seem to be XML: 'The specified path
>>>>> was not
>>>>> found.'
>>>>> In addition: Warning message:
>>>>> running command 'v.db.addcolumn.bat --interface-description' had
>>>>> status 1
>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>   v.db.addcolumn not parsed
>>>>>
>>>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work fine,
>>>>> but some other (r.mask) fail with a similar XML error.
>>>>>
>>>>> All commands work fine when used from the GRASS shell...
>>>>>
>>>>> What is this XML error ?
>>>>> Thanks
>>>>>
>>>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>
>>>>>>> Dear list,
>>>>>>>
>>>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution),
>>>>>>> I get
>>>>>>> the following error :
>>>>>> Please always try to provide a reproducible example using a standard
>>>>>> data set. In addition, the output of traceback() following the error
>>>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>>>> initiate GRASS?
>>>>>>
>>>>>> Consider using the grass-stats list:
>>>>>>
>>>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>>>
>>>>>> as it is more likely to yield results, but there also provide an
>>>>>> example that anyone can reproduce. The example should avoid loading
>>>>>> other packages, and should be run from the R console (not, say,
>>>>>> RStudio).
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>>>
>>>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>>>>>> double precision")
>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>   v.db.addcolumn not parsed
>>>>>>>
>>>>>>>
>>>>>>> and a similar one for r.mask :
>>>>>>>
>>>>>>>> execGRASS("r.mask", raster = "map")
>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>> sp?cifi? est introuvable.'
>>>>>>> In addition: Warning message:
>>>>>>> running command 'r.mask.bat --interface-description' had status 1
>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>>>>>>> parsed
>>>>>>>
>>>>>>>
>>>>>>> whereas most other execGRASS command I tried work as expected.
>>>>>>> Any idea ?
>>>>>>> Thanks in advance
>>>>>>>
>>>>>>> Here is my session info :
>>>>>>>
>>>>>>>> sessionInfo()
>>>>>>> R version 3.3.1 (2016-06-21)
>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>
>>>>>>> locale:
>>>>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>>>> LC_TIME=French_France.1252
>>>>>>> attached base packages:
>>>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>>>> methods   base
>>>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>>>
>>>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> -- 
>>>>> *Micha?l DELORME*
>>>>> Administrateur de donn?es, charg? de projet en g?omatique
>>>>> Service r?gional de l'information statistique, ?conomique et
>>>>> territoriale
>>>>> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
>>>>> Auvergne-Rh?ne-Alpes
>>>>> Site de Lyon
>>>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>>>> 04 78 63 34 21
>>>>>
>>>>> Pour ?crire au service :
>>>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>>>
>>>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>>>
>>>>>      [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Thu Nov 24 09:31:40 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 24 Nov 2016 09:31:40 +0100
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <337762497.1556003.1479972202161@mail.yahoo.com>
References: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
	<f03529fe-253c-bf5c-e90c-ab87c48bb8b4@web.de>
	<CABkCotTtKsas=X6LVRgzPXc2m=fUSh3EBx9=SbW18E=scoE0nw@mail.gmail.com>
	<337762497.1556003.1479972202161@mail.yahoo.com>
Message-ID: <alpine.LFD.2.20.1611240924490.14523@reclus.nhh.no>

Never hi-jack existing threads. If you want to ask a question, start a new 
thread with a new subject line; do not reply to an existing post chaning 
the subject line either.

Before asking questions, read the instructions and posting guide:

https://www.r-project.org/mail.html#instructions
https://www.r-project.org/posting-guide.html

Open questions like yours need to go to the correct list - this is not a 
spatial question.

Roger Bivand
List admin.

On Thu, 24 Nov 2016, julian magezi via R-sig-Geo wrote:

> Hello members,
> Which package in R does nonparametric statistical testing?
> Thanks
> ?Julian Ijumulana, MSc (Geoinformatics)Land surveyor, GIS/RS Specialist & Assistant Lecturer,?Department of Transportation and Geotechnical Engineering,College of Engineering and Technology,University of Dar es Salaam,Box 35131,Dar es SalaamTANZANIA
> Mob: +255 767675416
>
> 
>
>    On Wednesday, 23 November 2016, 20:49, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
> 
>
> Thank you very much Florian.
>
> Do you know any R function/package to do the same without relying on GRASS?
>
> Manuel
>
> 2016-11-23 7:28 GMT-06:00 Florian Betz <flobetz at web.de>:
>
>> Assuming you are using GRASS 7, you can use the rgrass7 package. First
>> thing to do is to initialize the R-GRASS connection, then you can run the
>> module using execGRASS.
>>
>> library(rgrass7)
>> #Arguments depending on your system
>> initGRASS(gisBase ="C:/Program Files/GRASS GIS 7.0.5",home=tempdir(),
>> ? ? ? ? ? gisDbase="Path to the folder with your location, location="Your
>> GRASS location",mapset="Your GRASS mapset",override=TRUE)
>> #See the help of v.split.lenght for the necessary function arguments
>> execGRASS("v.split.length", argument1=, argument2=, ...)
>>
>> Regards,
>>
>> Flo
>>
>>
>> Am 23.11.2016 um 14:15 schrieb Manuel Sp?nola:
>>
>>> Dear list members,
>>>
>>> Is it possible to run v.split.length from GRASS in R? Or is there anyway
>>> to
>>> split a SpatialLinesDataFrame to shorter segments by length in R?
>>>
>>> Best,
>>>
>>> Manuel
>>>
>>>
>>
>
>
> -- 
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
> ??? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From michael.delorme at agriculture.gouv.fr  Thu Nov 24 10:40:13 2016
From: michael.delorme at agriculture.gouv.fr (Michael DELORME)
Date: Thu, 24 Nov 2016 10:40:13 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <b33f884f-25f7-2510-3bae-1e803fd5db76@uni-marburg.de>
References: <5833E886.7000408@agriculture.gouv.fr>	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>	<58343D69.1040900@agriculture.gouv.fr>	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>	<58344D30.4090206@agriculture.gouv.fr>	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>	<58353973.5000406@agriculture.gouv.fr>
	<b33f884f-25f7-2510-3bae-1e803fd5db76@uni-marburg.de>
Message-ID: <5836B57D.5030801@agriculture.gouv.fr>

That's great Chris, it works fine as is !
Thank you, I don't have to keep another GRASS install aside then.

I'm sure it will be helpful to other people also.
Thanks again

Le 24/11/2016 09:17, Chris Reudenbach a ?crit :
> Michael,
>
> Using a fresh OSGEO4W64 standard quick desktop installation (i.e.
> installation of the default desktop GIS software packages with the
> installer and using C:\OSGeo4W64 as path)  I suggest the below solution.
>
> You have to set all necessary eniromental and system variables
> manually. I am not quit sure if I got them but actually it seems to
> work for your question. As a conclusion I think your Python and all of
> the rest is installed correct.
>
>
> cheers Chris
>
>
> ############### librarys, data etc
> ---------------------------------------------
> library(rgrass7)
> library(sp)
>
> # setup a temp workingdir
> working.dir<- "~/tmp/"
>
> # get meuse data
>
> data(meuse)
> data(meuse.grid)
>
> # georeference the meuse grid data
> coordinates(meuse.grid) <- ~x+y
> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
> gridded(meuse.grid) <- TRUE
>
> # get a first cellsize/pixel resolution for GRASS
> resolution <- meuse.grid at grid@cellsize[1]
>
> # georeference the meuse data
> coordinates(meuse) <- ~x+y
> proj4string(meuse) <- CRS("+init=epsg:28992")
>
> # get projection, proj4 string and extent for GRASS
> projection<-(strsplit(meuse at proj4string@projargs,split = " "))
> proj4<- paste(projection[[1]][2:length(unlist(projection))], collapse
> = ' ')
> xmax<-meuse at bbox[3]
> xmin<-meuse at bbox[1]
> ymax<-meuse at bbox[4]
> ymin<-meuse at bbox[2]
>
> # create and set working directory
> if (!file.exists(file.path(working.dir,"run"))){
>   dir.create(file.path(working.dir,"run"),recursive = TRUE)
> }
> setwd(file.path( working.dir,"run"))
>
>
> ########### SETUP OSGEO4W enviroment settings manually
> -------------------------
> # setup the OSGEO4W environ manually
> # assuming a osgeow4w default "deskop fastinstall
> # using the default installation directory "C:\OSGeo4W64"
>
> # set OSGE4W base directory
> osgeo4w.root<-"C:\\OSGEO4~1"
> Sys.setenv(OSGEO4W_ROOT=osgeo4w.root)
> # define GISBASE
> grass.gis.base<-paste0(osgeo4w.root,"\\apps\\grass\\grass-7.0.5")
> Sys.setenv(GISBASE=grass.gis.base)
>
> Sys.setenv(GRASS_PYTHON=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\bin\\python.exe"))
>
> Sys.setenv(PYTHONHOME=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\Python27"))
>
> Sys.setenv(PYTHONPATH=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\grass\\grass-7.0.5\\etc\\python"))
>
> Sys.setenv(GRASS_PROJSHARE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
>
> Sys.setenv(PROJ_LIB=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
> Sys.setenv(GDAL_DATA=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\gdal"))
> Sys.setenv(GEOTIFF_CSV=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\epsg_csv"))
>
> Sys.setenv(FONTCONFIG_FILE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\etc\\fonts.conf"))
>
>
> # call all OSGEO4W settings
> system("C:/OSGeo4W64/bin/o-help.bat")
>
>
> # create PATH variable
> Sys.setenv(PATH=paste0(grass.gis.base,";",
> "C:\\OSGEO4~1\\apps\\Python27\\lib\\site-packages\\numpy\\core",";",
> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\bin",";",
> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\lib",";",
> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc",";",
> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc\\python",";",
> "C:\\OSGeo4W64\\apps\\Python27\\Scripts",";",
>                        "C:\\OSGeo4W64\\bin",";",
>                        "c:\\OSGeo4W64\\apps",";",
>                        "C:\\OSGEO4~1\\apps\\saga",";",
>                        paste0(Sys.getenv("WINDIR"),"/WBem"),";",
>                        Sys.getenv("PATH")))
>
>
> #################### start with GRASS setup
> ------------------------------------
> rgrass7::initGRASS(gisBase=grass.gis.base,
>                    home=tempdir(),
>                    mapset='PERMANENT',
>                    override=TRUE
> )
>
> # assign GRASS projection according to data set
> rgrass7::execGRASS('g.proj',
>                    flags=c('c','quiet'),
>                    proj4=proj4
> )
>
> # assign GRASS extent and resolution
> rgrass7::execGRASS('g.region',
>                    flags=c('quiet'),
>                    n=as.character(ymax),
>                    s=as.character(ymin),
>                    e=as.character(xmax),
>                    w=as.character(xmin),
>                    res=as.character(resolution)
> )
>
>
> #############   now do GRASS STUFF
> ---------------------------------------------
>
> rgrass7::writeVECT(meuse,"meuse")
> rgrass7::execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
> double
>                    precision")
> #############  do other command line stuff
> -------------------------------------
>
> ## call gdal
> system("gdal_merge")
>
> # call saga cli
> system("saga_cmd")
>
>
> Am 23.11.2016 um 07:38 schrieb Michael DELORME:
>> Thanks for your insight.
>> I'll use a stand-alone GRASS install.
>>
>> Cordially
>>
>> Le 22/11/2016 15:13, Roger Bivand a ?crit :
>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>
>>>> Thanks for investigating.
>>>>
>>>> I'll try a standalone version of GRASS if needed.
>>>>
>>>> Here is the traceback
>>>>
>>>>> traceback()
>>>> 4: stop(paste(cmd, "not parsed"))
>>>> 3: parseGRASS(cmd, legacyExec = legacyExec)
>>>> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
>>>> echoCmd, legacyExec = legacyExec)
>>>> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>>>> double
>>>> precision")
>>>>
>>>> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>>>> indeed the *.bat command are those which don't work (r.mask.bat,
>>>> v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
>>>> v.db.addcolumn.bat is :
>>>>
>>>> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>>>>
>>>> So I guess something must be wrong in my Python installation... (it
>>>> works however from within a GRASS shell)
>>> No, the logic for Windows and initGRASS has only ever been tested with
>>> stand-alone GRASS. I would guess that in OSGeo4W the path variables
>>> are wrong. I cannot even find out how to run initGRASS in R but
>>> outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
>>> OSGeo4W shell (cannot create a temporary GRASS location). Unless you
>>> or others really need OSGeo4W, I suggest asking others to implement
>>> that - very bulky and fragile.
>>>
>>> Roger
>>>
>>>> Cordially
>>>>
>>>>
>>>> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>
>>>>>> Thanks for replying
>>>>>>
>>>>>> Here is a reproducible example (change your GRASS directory of
>>>>>> course) :
>>>>>>
>>>>>> library(rgrass7)
>>>>>> library(sp)
>>>>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>>>>> override = TRUE)
>>>>>> data(meuse)
>>>>>> coordinates(meuse) <- ~x+y
>>>>>> writeVECT(meuse, "meuse")
>>>>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>>>>> precision")
>>>>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>>>>> stand-alone. Do you need to use OSGeo4W - the internal logic used for
>>>>> finding out where the different versions keep their executables and
>>>>> batch files varies?
>>>>>
>>>>> What does traceback() say after the error? The error comes from
>>>>> parseGRASS("v.db.addcolumn") - the XML error comes from not being
>>>>> able
>>>>> to read the output of v.db.addcolumn<.ext> --interface-description
>>>>> where <.ext> may be .exe or .bat I think.
>>>>>
>>>>> Roger
>>>>>
>>>>>> I get :
>>>>>> Error : XML content does not seem to be XML: 'The specified path
>>>>>> was not
>>>>>> found.'
>>>>>> In addition: Warning message:
>>>>>> running command 'v.db.addcolumn.bat --interface-description' had
>>>>>> status 1
>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>   v.db.addcolumn not parsed
>>>>>>
>>>>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work
>>>>>> fine,
>>>>>> but some other (r.mask) fail with a similar XML error.
>>>>>>
>>>>>> All commands work fine when used from the GRASS shell...
>>>>>>
>>>>>> What is this XML error ?
>>>>>> Thanks
>>>>>>
>>>>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>>
>>>>>>>> Dear list,
>>>>>>>>
>>>>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution),
>>>>>>>> I get
>>>>>>>> the following error :
>>>>>>> Please always try to provide a reproducible example using a
>>>>>>> standard
>>>>>>> data set. In addition, the output of traceback() following the
>>>>>>> error
>>>>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>>>>> initiate GRASS?
>>>>>>>
>>>>>>> Consider using the grass-stats list:
>>>>>>>
>>>>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>>>>
>>>>>>> as it is more likely to yield results, but there also provide an
>>>>>>> example that anyone can reproduce. The example should avoid loading
>>>>>>> other packages, and should be run from the R console (not, say,
>>>>>>> RStudio).
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>>>>>>> double precision")
>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>>>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>>   v.db.addcolumn not parsed
>>>>>>>>
>>>>>>>>
>>>>>>>> and a similar one for r.mask :
>>>>>>>>
>>>>>>>>> execGRASS("r.mask", raster = "map")
>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>> sp?cifi? est introuvable.'
>>>>>>>> In addition: Warning message:
>>>>>>>> running command 'r.mask.bat --interface-description' had status 1
>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>>>>>>>> parsed
>>>>>>>>
>>>>>>>>
>>>>>>>> whereas most other execGRASS command I tried work as expected.
>>>>>>>> Any idea ?
>>>>>>>> Thanks in advance
>>>>>>>>
>>>>>>>> Here is my session info :
>>>>>>>>
>>>>>>>>> sessionInfo()
>>>>>>>> R version 3.3.1 (2016-06-21)
>>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>>
>>>>>>>> locale:
>>>>>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>>>>> LC_TIME=French_France.1252
>>>>>>>> attached base packages:
>>>>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>>>>> methods   base
>>>>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>>>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>>>>
>>>>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>> -- 
>>>>>> *Micha?l DELORME*
>>>>>> Administrateur de donn?es, charg? de projet en g?omatique
>>>>>> Service r?gional de l'information statistique, ?conomique et
>>>>>> territoriale
>>>>>> Direction r?gionale de l'alimentation, de l'agriculture et de la
>>>>>> for?t
>>>>>> Auvergne-Rh?ne-Alpes
>>>>>> Site de Lyon
>>>>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>>>>> 04 78 63 34 21
>>>>>>
>>>>>> Pour ?crire au service :
>>>>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>>>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>>>>
>>>>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>>>>
>>>>>>      [[alternative HTML version deleted]]
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
*Micha?l DELORME*
Administrateur de donn?es, charg? de projet en g?omatique
Service r?gional de l'information statistique, ?conomique et territoriale
Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
Auvergne-Rh?ne-Alpes
Site de Lyon
165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
04 78 63 34 21

Pour ?crire au service :
DRAAF Auvergne-Rh?ne-Alpes ? SRISET
16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES

http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/

	[[alternative HTML version deleted]]


From malNamalJa at gmx.de  Thu Nov 24 10:43:27 2016
From: malNamalJa at gmx.de (=?UTF-8?Q?=22Jannes_M=C3=BCnchow=22?=)
Date: Thu, 24 Nov 2016 10:43:27 +0100
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <CABkCotR=+5g-1S_Vx4U=LB=RokWMx74eP9q5335G2NW4o+tmsw@mail.gmail.com>
References: <trinity-f1cf80d6-b50b-4abc-b23b-9e885b03555c-1479912323923@3capp-gmx-bs44>,
	<CABkCotR=+5g-1S_Vx4U=LB=RokWMx74eP9q5335G2NW4o+tmsw@mail.gmail.com>
Message-ID: <trinity-6ddcab52-d171-42da-88c5-77eebc6a7559-1479980607558@3capp-gmx-bs32>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161124/d57f7fed/attachment.html>

From Roger.Bivand at nhh.no  Thu Nov 24 10:48:47 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 24 Nov 2016 10:48:47 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <5836B57D.5030801@agriculture.gouv.fr>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
	<58344D30.4090206@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>
	<58353973.5000406@agriculture.gouv.fr>
	<b33f884f-25f7-2510-3bae-1e803fd5db76@uni-marburg.de>
	<5836B57D.5030801@agriculture.gouv.fr>
Message-ID: <alpine.LFD.2.20.1611241047080.14523@reclus.nhh.no>

On Thu, 24 Nov 2016, Michael DELORME wrote:

> That's great Chris, it works fine as is !
> Thank you, I don't have to keep another GRASS install aside then.

Thanks for confirming this. I'll try to set up a test rig to allow 
initGRASS to set up the environment variables when using GRASS in OSGeo4W 
for a later release.

Roger

>
> I'm sure it will be helpful to other people also.
> Thanks again
>
> Le 24/11/2016 09:17, Chris Reudenbach a ?crit :
>> Michael,
>>
>> Using a fresh OSGEO4W64 standard quick desktop installation (i.e.
>> installation of the default desktop GIS software packages with the
>> installer and using C:\OSGeo4W64 as path)  I suggest the below solution.
>>
>> You have to set all necessary eniromental and system variables
>> manually. I am not quit sure if I got them but actually it seems to
>> work for your question. As a conclusion I think your Python and all of
>> the rest is installed correct.
>>
>>
>> cheers Chris
>>
>>
>> ############### librarys, data etc
>> ---------------------------------------------
>> library(rgrass7)
>> library(sp)
>>
>> # setup a temp workingdir
>> working.dir<- "~/tmp/"
>>
>> # get meuse data
>>
>> data(meuse)
>> data(meuse.grid)
>>
>> # georeference the meuse grid data
>> coordinates(meuse.grid) <- ~x+y
>> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
>> gridded(meuse.grid) <- TRUE
>>
>> # get a first cellsize/pixel resolution for GRASS
>> resolution <- meuse.grid at grid@cellsize[1]
>>
>> # georeference the meuse data
>> coordinates(meuse) <- ~x+y
>> proj4string(meuse) <- CRS("+init=epsg:28992")
>>
>> # get projection, proj4 string and extent for GRASS
>> projection<-(strsplit(meuse at proj4string@projargs,split = " "))
>> proj4<- paste(projection[[1]][2:length(unlist(projection))], collapse
>> = ' ')
>> xmax<-meuse at bbox[3]
>> xmin<-meuse at bbox[1]
>> ymax<-meuse at bbox[4]
>> ymin<-meuse at bbox[2]
>>
>> # create and set working directory
>> if (!file.exists(file.path(working.dir,"run"))){
>>   dir.create(file.path(working.dir,"run"),recursive = TRUE)
>> }
>> setwd(file.path( working.dir,"run"))
>>
>>
>> ########### SETUP OSGEO4W enviroment settings manually
>> -------------------------
>> # setup the OSGEO4W environ manually
>> # assuming a osgeow4w default "deskop fastinstall
>> # using the default installation directory "C:\OSGeo4W64"
>>
>> # set OSGE4W base directory
>> osgeo4w.root<-"C:\\OSGEO4~1"
>> Sys.setenv(OSGEO4W_ROOT=osgeo4w.root)
>> # define GISBASE
>> grass.gis.base<-paste0(osgeo4w.root,"\\apps\\grass\\grass-7.0.5")
>> Sys.setenv(GISBASE=grass.gis.base)
>>
>> Sys.setenv(GRASS_PYTHON=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\bin\\python.exe"))
>>
>> Sys.setenv(PYTHONHOME=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\Python27"))
>>
>> Sys.setenv(PYTHONPATH=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\grass\\grass-7.0.5\\etc\\python"))
>>
>> Sys.setenv(GRASS_PROJSHARE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
>>
>> Sys.setenv(PROJ_LIB=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
>> Sys.setenv(GDAL_DATA=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\gdal"))
>> Sys.setenv(GEOTIFF_CSV=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\epsg_csv"))
>>
>> Sys.setenv(FONTCONFIG_FILE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\etc\\fonts.conf"))
>>
>>
>> # call all OSGEO4W settings
>> system("C:/OSGeo4W64/bin/o-help.bat")
>>
>>
>> # create PATH variable
>> Sys.setenv(PATH=paste0(grass.gis.base,";",
>> "C:\\OSGEO4~1\\apps\\Python27\\lib\\site-packages\\numpy\\core",";",
>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\bin",";",
>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\lib",";",
>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc",";",
>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc\\python",";",
>> "C:\\OSGeo4W64\\apps\\Python27\\Scripts",";",
>>                        "C:\\OSGeo4W64\\bin",";",
>>                        "c:\\OSGeo4W64\\apps",";",
>>                        "C:\\OSGEO4~1\\apps\\saga",";",
>>                        paste0(Sys.getenv("WINDIR"),"/WBem"),";",
>>                        Sys.getenv("PATH")))
>>
>>
>> #################### start with GRASS setup
>> ------------------------------------
>> rgrass7::initGRASS(gisBase=grass.gis.base,
>>                    home=tempdir(),
>>                    mapset='PERMANENT',
>>                    override=TRUE
>> )
>>
>> # assign GRASS projection according to data set
>> rgrass7::execGRASS('g.proj',
>>                    flags=c('c','quiet'),
>>                    proj4=proj4
>> )
>>
>> # assign GRASS extent and resolution
>> rgrass7::execGRASS('g.region',
>>                    flags=c('quiet'),
>>                    n=as.character(ymax),
>>                    s=as.character(ymin),
>>                    e=as.character(xmax),
>>                    w=as.character(xmin),
>>                    res=as.character(resolution)
>> )
>>
>>
>> #############   now do GRASS STUFF
>> ---------------------------------------------
>>
>> rgrass7::writeVECT(meuse,"meuse")
>> rgrass7::execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>> double
>>                    precision")
>> #############  do other command line stuff
>> -------------------------------------
>>
>> ## call gdal
>> system("gdal_merge")
>>
>> # call saga cli
>> system("saga_cmd")
>>
>>
>> Am 23.11.2016 um 07:38 schrieb Michael DELORME:
>>> Thanks for your insight.
>>> I'll use a stand-alone GRASS install.
>>>
>>> Cordially
>>>
>>> Le 22/11/2016 15:13, Roger Bivand a ?crit :
>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>
>>>>> Thanks for investigating.
>>>>>
>>>>> I'll try a standalone version of GRASS if needed.
>>>>>
>>>>> Here is the traceback
>>>>>
>>>>>> traceback()
>>>>> 4: stop(paste(cmd, "not parsed"))
>>>>> 3: parseGRASS(cmd, legacyExec = legacyExec)
>>>>> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters, echoCmd =
>>>>> echoCmd, legacyExec = legacyExec)
>>>>> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>>>>> double
>>>>> precision")
>>>>>
>>>>> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>>>>> indeed the *.bat command are those which don't work (r.mask.bat,
>>>>> v.db.addcolumn.bat,...). The batch calls Python scripts ; for example
>>>>> v.db.addcolumn.bat is :
>>>>>
>>>>> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>>>>>
>>>>> So I guess something must be wrong in my Python installation... (it
>>>>> works however from within a GRASS shell)
>>>> No, the logic for Windows and initGRASS has only ever been tested with
>>>> stand-alone GRASS. I would guess that in OSGeo4W the path variables
>>>> are wrong. I cannot even find out how to run initGRASS in R but
>>>> outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
>>>> OSGeo4W shell (cannot create a temporary GRASS location). Unless you
>>>> or others really need OSGeo4W, I suggest asking others to implement
>>>> that - very bulky and fragile.
>>>>
>>>> Roger
>>>>
>>>>> Cordially
>>>>>
>>>>>
>>>>> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>
>>>>>>> Thanks for replying
>>>>>>>
>>>>>>> Here is a reproducible example (change your GRASS directory of
>>>>>>> course) :
>>>>>>>
>>>>>>> library(rgrass7)
>>>>>>> library(sp)
>>>>>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>>>>>> override = TRUE)
>>>>>>> data(meuse)
>>>>>>> coordinates(meuse) <- ~x+y
>>>>>>> writeVECT(meuse, "meuse")
>>>>>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 double
>>>>>>> precision")
>>>>>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>>>>>> stand-alone. Do you need to use OSGeo4W - the internal logic used for
>>>>>> finding out where the different versions keep their executables and
>>>>>> batch files varies?
>>>>>>
>>>>>> What does traceback() say after the error? The error comes from
>>>>>> parseGRASS("v.db.addcolumn") - the XML error comes from not being
>>>>>> able
>>>>>> to read the output of v.db.addcolumn<.ext> --interface-description
>>>>>> where <.ext> may be .exe or .bat I think.
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>> I get :
>>>>>>> Error : XML content does not seem to be XML: 'The specified path
>>>>>>> was not
>>>>>>> found.'
>>>>>>> In addition: Warning message:
>>>>>>> running command 'v.db.addcolumn.bat --interface-description' had
>>>>>>> status 1
>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>   v.db.addcolumn not parsed
>>>>>>>
>>>>>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work
>>>>>>> fine,
>>>>>>> but some other (r.mask) fail with a similar XML error.
>>>>>>>
>>>>>>> All commands work fine when used from the GRASS shell...
>>>>>>>
>>>>>>> What is this XML error ?
>>>>>>> Thanks
>>>>>>>
>>>>>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>>>
>>>>>>>>> Dear list,
>>>>>>>>>
>>>>>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution),
>>>>>>>>> I get
>>>>>>>>> the following error :
>>>>>>>> Please always try to provide a reproducible example using a
>>>>>>>> standard
>>>>>>>> data set. In addition, the output of traceback() following the
>>>>>>>> error
>>>>>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>>>>>> initiate GRASS?
>>>>>>>>
>>>>>>>> Consider using the grass-stats list:
>>>>>>>>
>>>>>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>>>>>
>>>>>>>> as it is more likely to yield results, but there also provide an
>>>>>>>> example that anyone can reproduce. The example should avoid loading
>>>>>>>> other packages, and should be run from the R console (not, say,
>>>>>>>> RStudio).
>>>>>>>>
>>>>>>>> Roger
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = "area_m2
>>>>>>>>>> double precision")
>>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>>>>>> command 'v.db.addcolumn.bat --interface-description' had status 1
>>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>>>   v.db.addcolumn not parsed
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> and a similar one for r.mask :
>>>>>>>>>
>>>>>>>>>> execGRASS("r.mask", raster = "map")
>>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>>> sp?cifi? est introuvable.'
>>>>>>>>> In addition: Warning message:
>>>>>>>>> running command 'r.mask.bat --interface-description' had status 1
>>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>>>>>>>>> parsed
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> whereas most other execGRASS command I tried work as expected.
>>>>>>>>> Any idea ?
>>>>>>>>> Thanks in advance
>>>>>>>>>
>>>>>>>>> Here is my session info :
>>>>>>>>>
>>>>>>>>>> sessionInfo()
>>>>>>>>> R version 3.3.1 (2016-06-21)
>>>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>>>
>>>>>>>>> locale:
>>>>>>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>>>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>>>>>> LC_TIME=French_France.1252
>>>>>>>>> attached base packages:
>>>>>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>>>>>> methods   base
>>>>>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 beepr_1.2
>>>>>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>>>>>
>>>>>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>> -- 
>>>>>>> *Micha?l DELORME*
>>>>>>> Administrateur de donn?es, charg? de projet en g?omatique
>>>>>>> Service r?gional de l'information statistique, ?conomique et
>>>>>>> territoriale
>>>>>>> Direction r?gionale de l'alimentation, de l'agriculture et de la
>>>>>>> for?t
>>>>>>> Auvergne-Rh?ne-Alpes
>>>>>>> Site de Lyon
>>>>>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>>>>>> 04 78 63 34 21
>>>>>>>
>>>>>>> Pour ?crire au service :
>>>>>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>>>>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>>>>>
>>>>>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>>>>>
>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> -- 
> *Micha?l DELORME*
> Administrateur de donn?es, charg? de projet en g?omatique
> Service r?gional de l'information statistique, ?conomique et territoriale
> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
> Auvergne-Rh?ne-Alpes
> Site de Lyon
> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
> 04 78 63 34 21
>
> Pour ?crire au service :
> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>
> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From michael.delorme at agriculture.gouv.fr  Thu Nov 24 11:01:28 2016
From: michael.delorme at agriculture.gouv.fr (Michael DELORME)
Date: Thu, 24 Nov 2016 11:01:28 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <alpine.LFD.2.20.1611241047080.14523@reclus.nhh.no>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
	<58344D30.4090206@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>
	<58353973.5000406@agriculture.gouv.fr>
	<b33f884f-25f7-2510-3bae-1e803fd5db76@uni-marburg.de>
	<5836B57D.5030801@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611241047080.14523@reclus.nhh.no>
Message-ID: <5836BA78.60105@agriculture.gouv.fr>

Let me use this opportunity to thank you for all the tools,
documentation and support you provide. This makes R a very useful tool
for us.

Cordially

Le 24/11/2016 10:48, Roger Bivand a ?crit :
> On Thu, 24 Nov 2016, Michael DELORME wrote:
>
>> That's great Chris, it works fine as is !
>> Thank you, I don't have to keep another GRASS install aside then.
>
> Thanks for confirming this. I'll try to set up a test rig to allow
> initGRASS to set up the environment variables when using GRASS in
> OSGeo4W for a later release.
>
> Roger
>
>>
>> I'm sure it will be helpful to other people also.
>> Thanks again
>>
>> Le 24/11/2016 09:17, Chris Reudenbach a ?crit :
>>> Michael,
>>>
>>> Using a fresh OSGEO4W64 standard quick desktop installation (i.e.
>>> installation of the default desktop GIS software packages with the
>>> installer and using C:\OSGeo4W64 as path)  I suggest the below
>>> solution.
>>>
>>> You have to set all necessary eniromental and system variables
>>> manually. I am not quit sure if I got them but actually it seems to
>>> work for your question. As a conclusion I think your Python and all of
>>> the rest is installed correct.
>>>
>>>
>>> cheers Chris
>>>
>>>
>>> ############### librarys, data etc
>>> ---------------------------------------------
>>> library(rgrass7)
>>> library(sp)
>>>
>>> # setup a temp workingdir
>>> working.dir<- "~/tmp/"
>>>
>>> # get meuse data
>>>
>>> data(meuse)
>>> data(meuse.grid)
>>>
>>> # georeference the meuse grid data
>>> coordinates(meuse.grid) <- ~x+y
>>> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
>>> gridded(meuse.grid) <- TRUE
>>>
>>> # get a first cellsize/pixel resolution for GRASS
>>> resolution <- meuse.grid at grid@cellsize[1]
>>>
>>> # georeference the meuse data
>>> coordinates(meuse) <- ~x+y
>>> proj4string(meuse) <- CRS("+init=epsg:28992")
>>>
>>> # get projection, proj4 string and extent for GRASS
>>> projection<-(strsplit(meuse at proj4string@projargs,split = " "))
>>> proj4<- paste(projection[[1]][2:length(unlist(projection))], collapse
>>> = ' ')
>>> xmax<-meuse at bbox[3]
>>> xmin<-meuse at bbox[1]
>>> ymax<-meuse at bbox[4]
>>> ymin<-meuse at bbox[2]
>>>
>>> # create and set working directory
>>> if (!file.exists(file.path(working.dir,"run"))){
>>>   dir.create(file.path(working.dir,"run"),recursive = TRUE)
>>> }
>>> setwd(file.path( working.dir,"run"))
>>>
>>>
>>> ########### SETUP OSGEO4W enviroment settings manually
>>> -------------------------
>>> # setup the OSGEO4W environ manually
>>> # assuming a osgeow4w default "deskop fastinstall
>>> # using the default installation directory "C:\OSGeo4W64"
>>>
>>> # set OSGE4W base directory
>>> osgeo4w.root<-"C:\\OSGEO4~1"
>>> Sys.setenv(OSGEO4W_ROOT=osgeo4w.root)
>>> # define GISBASE
>>> grass.gis.base<-paste0(osgeo4w.root,"\\apps\\grass\\grass-7.0.5")
>>> Sys.setenv(GISBASE=grass.gis.base)
>>>
>>> Sys.setenv(GRASS_PYTHON=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\bin\\python.exe"))
>>>
>>>
>>> Sys.setenv(PYTHONHOME=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\Python27"))
>>>
>>>
>>> Sys.setenv(PYTHONPATH=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\grass\\grass-7.0.5\\etc\\python"))
>>>
>>>
>>> Sys.setenv(GRASS_PROJSHARE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
>>>
>>>
>>> Sys.setenv(PROJ_LIB=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
>>> Sys.setenv(GDAL_DATA=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\gdal"))
>>>
>>> Sys.setenv(GEOTIFF_CSV=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\epsg_csv"))
>>>
>>>
>>> Sys.setenv(FONTCONFIG_FILE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\etc\\fonts.conf"))
>>>
>>>
>>>
>>> # call all OSGEO4W settings
>>> system("C:/OSGeo4W64/bin/o-help.bat")
>>>
>>>
>>> # create PATH variable
>>> Sys.setenv(PATH=paste0(grass.gis.base,";",
>>> "C:\\OSGEO4~1\\apps\\Python27\\lib\\site-packages\\numpy\\core",";",
>>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\bin",";",
>>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\lib",";",
>>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc",";",
>>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc\\python",";",
>>> "C:\\OSGeo4W64\\apps\\Python27\\Scripts",";",
>>>                        "C:\\OSGeo4W64\\bin",";",
>>>                        "c:\\OSGeo4W64\\apps",";",
>>>                        "C:\\OSGEO4~1\\apps\\saga",";",
>>>                        paste0(Sys.getenv("WINDIR"),"/WBem"),";",
>>>                        Sys.getenv("PATH")))
>>>
>>>
>>> #################### start with GRASS setup
>>> ------------------------------------
>>> rgrass7::initGRASS(gisBase=grass.gis.base,
>>>                    home=tempdir(),
>>>                    mapset='PERMANENT',
>>>                    override=TRUE
>>> )
>>>
>>> # assign GRASS projection according to data set
>>> rgrass7::execGRASS('g.proj',
>>>                    flags=c('c','quiet'),
>>>                    proj4=proj4
>>> )
>>>
>>> # assign GRASS extent and resolution
>>> rgrass7::execGRASS('g.region',
>>>                    flags=c('quiet'),
>>>                    n=as.character(ymax),
>>>                    s=as.character(ymin),
>>>                    e=as.character(xmax),
>>>                    w=as.character(xmin),
>>>                    res=as.character(resolution)
>>> )
>>>
>>>
>>> #############   now do GRASS STUFF
>>> ---------------------------------------------
>>>
>>> rgrass7::writeVECT(meuse,"meuse")
>>> rgrass7::execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>>> double
>>>                    precision")
>>> #############  do other command line stuff
>>> -------------------------------------
>>>
>>> ## call gdal
>>> system("gdal_merge")
>>>
>>> # call saga cli
>>> system("saga_cmd")
>>>
>>>
>>> Am 23.11.2016 um 07:38 schrieb Michael DELORME:
>>>> Thanks for your insight.
>>>> I'll use a stand-alone GRASS install.
>>>>
>>>> Cordially
>>>>
>>>> Le 22/11/2016 15:13, Roger Bivand a ?crit :
>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>
>>>>>> Thanks for investigating.
>>>>>>
>>>>>> I'll try a standalone version of GRASS if needed.
>>>>>>
>>>>>> Here is the traceback
>>>>>>
>>>>>>> traceback()
>>>>>> 4: stop(paste(cmd, "not parsed"))
>>>>>> 3: parseGRASS(cmd, legacyExec = legacyExec)
>>>>>> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters,
>>>>>> echoCmd =
>>>>>> echoCmd, legacyExec = legacyExec)
>>>>>> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>>>>>> double
>>>>>> precision")
>>>>>>
>>>>>> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>>>>>> indeed the *.bat command are those which don't work (r.mask.bat,
>>>>>> v.db.addcolumn.bat,...). The batch calls Python scripts ; for
>>>>>> example
>>>>>> v.db.addcolumn.bat is :
>>>>>>
>>>>>> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>>>>>>
>>>>>> So I guess something must be wrong in my Python installation... (it
>>>>>> works however from within a GRASS shell)
>>>>> No, the logic for Windows and initGRASS has only ever been tested
>>>>> with
>>>>> stand-alone GRASS. I would guess that in OSGeo4W the path variables
>>>>> are wrong. I cannot even find out how to run initGRASS in R but
>>>>> outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
>>>>> OSGeo4W shell (cannot create a temporary GRASS location). Unless you
>>>>> or others really need OSGeo4W, I suggest asking others to implement
>>>>> that - very bulky and fragile.
>>>>>
>>>>> Roger
>>>>>
>>>>>> Cordially
>>>>>>
>>>>>>
>>>>>> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>>
>>>>>>>> Thanks for replying
>>>>>>>>
>>>>>>>> Here is a reproducible example (change your GRASS directory of
>>>>>>>> course) :
>>>>>>>>
>>>>>>>> library(rgrass7)
>>>>>>>> library(sp)
>>>>>>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>>>>>>> override = TRUE)
>>>>>>>> data(meuse)
>>>>>>>> coordinates(meuse) <- ~x+y
>>>>>>>> writeVECT(meuse, "meuse")
>>>>>>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>>>>>>>> double
>>>>>>>> precision")
>>>>>>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>>>>>>> stand-alone. Do you need to use OSGeo4W - the internal logic
>>>>>>> used for
>>>>>>> finding out where the different versions keep their executables and
>>>>>>> batch files varies?
>>>>>>>
>>>>>>> What does traceback() say after the error? The error comes from
>>>>>>> parseGRASS("v.db.addcolumn") - the XML error comes from not being
>>>>>>> able
>>>>>>> to read the output of v.db.addcolumn<.ext> --interface-description
>>>>>>> where <.ext> may be .exe or .bat I think.
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>> I get :
>>>>>>>> Error : XML content does not seem to be XML: 'The specified path
>>>>>>>> was not
>>>>>>>> found.'
>>>>>>>> In addition: Warning message:
>>>>>>>> running command 'v.db.addcolumn.bat --interface-description' had
>>>>>>>> status 1
>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>>   v.db.addcolumn not parsed
>>>>>>>>
>>>>>>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work
>>>>>>>> fine,
>>>>>>>> but some other (r.mask) fail with a similar XML error.
>>>>>>>>
>>>>>>>> All commands work fine when used from the GRASS shell...
>>>>>>>>
>>>>>>>> What is this XML error ?
>>>>>>>> Thanks
>>>>>>>>
>>>>>>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>>>>
>>>>>>>>>> Dear list,
>>>>>>>>>>
>>>>>>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution),
>>>>>>>>>> I get
>>>>>>>>>> the following error :
>>>>>>>>> Please always try to provide a reproducible example using a
>>>>>>>>> standard
>>>>>>>>> data set. In addition, the output of traceback() following the
>>>>>>>>> error
>>>>>>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>>>>>>> initiate GRASS?
>>>>>>>>>
>>>>>>>>> Consider using the grass-stats list:
>>>>>>>>>
>>>>>>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>>>>>>
>>>>>>>>> as it is more likely to yield results, but there also provide an
>>>>>>>>> example that anyone can reproduce. The example should avoid
>>>>>>>>> loading
>>>>>>>>> other packages, and should be run from the R console (not, say,
>>>>>>>>> RStudio).
>>>>>>>>>
>>>>>>>>> Roger
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns =
>>>>>>>>>>> "area_m2
>>>>>>>>>>> double precision")
>>>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>>>>>>> command 'v.db.addcolumn.bat --interface-description' had
>>>>>>>>>> status 1
>>>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>>>>   v.db.addcolumn not parsed
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> and a similar one for r.mask :
>>>>>>>>>>
>>>>>>>>>>> execGRASS("r.mask", raster = "map")
>>>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>>>> sp?cifi? est introuvable.'
>>>>>>>>>> In addition: Warning message:
>>>>>>>>>> running command 'r.mask.bat --interface-description' had
>>>>>>>>>> status 1
>>>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>>>>>>>>>> parsed
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> whereas most other execGRASS command I tried work as expected.
>>>>>>>>>> Any idea ?
>>>>>>>>>> Thanks in advance
>>>>>>>>>>
>>>>>>>>>> Here is my session info :
>>>>>>>>>>
>>>>>>>>>>> sessionInfo()
>>>>>>>>>> R version 3.3.1 (2016-06-21)
>>>>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>>>>
>>>>>>>>>> locale:
>>>>>>>>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>>>>>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>>>>>>> LC_TIME=French_France.1252
>>>>>>>>>> attached base packages:
>>>>>>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>>>>>>> methods   base
>>>>>>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4
>>>>>>>>>> beepr_1.2
>>>>>>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>>>>>>
>>>>>>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>>>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>>>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>> -- 
>>>>>>>> *Micha?l DELORME*
>>>>>>>> Administrateur de donn?es, charg? de projet en g?omatique
>>>>>>>> Service r?gional de l'information statistique, ?conomique et
>>>>>>>> territoriale
>>>>>>>> Direction r?gionale de l'alimentation, de l'agriculture et de la
>>>>>>>> for?t
>>>>>>>> Auvergne-Rh?ne-Alpes
>>>>>>>> Site de Lyon
>>>>>>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>>>>>>> 04 78 63 34 21
>>>>>>>>
>>>>>>>> Pour ?crire au service :
>>>>>>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>>>>>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>>>>>>
>>>>>>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>>>>>>
>>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> -- 
>> *Micha?l DELORME*
>> Administrateur de donn?es, charg? de projet en g?omatique
>> Service r?gional de l'information statistique, ?conomique et
>> territoriale
>> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
>> Auvergne-Rh?ne-Alpes
>> Site de Lyon
>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>> 04 78 63 34 21
>>
>> Pour ?crire au service :
>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>
>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>
>>     [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From reudenbach at uni-marburg.de  Thu Nov 24 11:38:02 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Thu, 24 Nov 2016 11:38:02 +0100
Subject: [R-sig-Geo] rgrass7 : Error in parseGRASS
In-Reply-To: <alpine.LFD.2.20.1611241047080.14523@reclus.nhh.no>
References: <5833E886.7000408@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611220929120.29386@reclus.nhh.no>
	<58343D69.1040900@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221424190.32352@reclus.nhh.no>
	<58344D30.4090206@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611221509200.3991@reclus.nhh.no>
	<58353973.5000406@agriculture.gouv.fr>
	<b33f884f-25f7-2510-3bae-1e803fd5db76@uni-marburg.de>
	<5836B57D.5030801@agriculture.gouv.fr>
	<alpine.LFD.2.20.1611241047080.14523@reclus.nhh.no>
Message-ID: <a45ad3e9-6bfd-79cf-ffce-bdcef69f4b13@uni-marburg.de>

@Michael fine!

@Roger

this is  pretty dirty "hack" I did not cross check if I got all 
variables dealing with GRASS. I would like to do it more systematically. 
Nevertheless as far as I understand the osgeo4w concept, we have only 
two changing names. 1) the installation root directory   2) the GRASS 
version name, that is used as a part of the internal  path structure.  I 
would like to check this and if so it might be easy to integrate this in 
initGRASS.

cheers Chris

Am 24.11.2016 um 10:48 schrieb Roger Bivand:
> On Thu, 24 Nov 2016, Michael DELORME wrote:
>
>> That's great Chris, it works fine as is !
>> Thank you, I don't have to keep another GRASS install aside then.
>
> Thanks for confirming this. I'll try to set up a test rig to allow 
> initGRASS to set up the environment variables when using GRASS in 
> OSGeo4W for a later release.
>
> Roger
>
>>
>> I'm sure it will be helpful to other people also.
>> Thanks again
>>
>> Le 24/11/2016 09:17, Chris Reudenbach a ?crit :
>>> Michael,
>>>
>>> Using a fresh OSGEO4W64 standard quick desktop installation (i.e.
>>> installation of the default desktop GIS software packages with the
>>> installer and using C:\OSGeo4W64 as path)  I suggest the below 
>>> solution.
>>>
>>> You have to set all necessary eniromental and system variables
>>> manually. I am not quit sure if I got them but actually it seems to
>>> work for your question. As a conclusion I think your Python and all of
>>> the rest is installed correct.
>>>
>>>
>>> cheers Chris
>>>
>>>
>>> ############### librarys, data etc
>>> ---------------------------------------------
>>> library(rgrass7)
>>> library(sp)
>>>
>>> # setup a temp workingdir
>>> working.dir<- "~/tmp/"
>>>
>>> # get meuse data
>>>
>>> data(meuse)
>>> data(meuse.grid)
>>>
>>> # georeference the meuse grid data
>>> coordinates(meuse.grid) <- ~x+y
>>> proj4string(meuse.grid) <- CRS("+init=epsg:28992")
>>> gridded(meuse.grid) <- TRUE
>>>
>>> # get a first cellsize/pixel resolution for GRASS
>>> resolution <- meuse.grid at grid@cellsize[1]
>>>
>>> # georeference the meuse data
>>> coordinates(meuse) <- ~x+y
>>> proj4string(meuse) <- CRS("+init=epsg:28992")
>>>
>>> # get projection, proj4 string and extent for GRASS
>>> projection<-(strsplit(meuse at proj4string@projargs,split = " "))
>>> proj4<- paste(projection[[1]][2:length(unlist(projection))], collapse
>>> = ' ')
>>> xmax<-meuse at bbox[3]
>>> xmin<-meuse at bbox[1]
>>> ymax<-meuse at bbox[4]
>>> ymin<-meuse at bbox[2]
>>>
>>> # create and set working directory
>>> if (!file.exists(file.path(working.dir,"run"))){
>>>   dir.create(file.path(working.dir,"run"),recursive = TRUE)
>>> }
>>> setwd(file.path( working.dir,"run"))
>>>
>>>
>>> ########### SETUP OSGEO4W enviroment settings manually
>>> -------------------------
>>> # setup the OSGEO4W environ manually
>>> # assuming a osgeow4w default "deskop fastinstall
>>> # using the default installation directory "C:\OSGeo4W64"
>>>
>>> # set OSGE4W base directory
>>> osgeo4w.root<-"C:\\OSGEO4~1"
>>> Sys.setenv(OSGEO4W_ROOT=osgeo4w.root)
>>> # define GISBASE
>>> grass.gis.base<-paste0(osgeo4w.root,"\\apps\\grass\\grass-7.0.5")
>>> Sys.setenv(GISBASE=grass.gis.base)
>>>
>>> Sys.setenv(GRASS_PYTHON=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\bin\\python.exe")) 
>>>
>>>
>>> Sys.setenv(PYTHONHOME=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\Python27")) 
>>>
>>>
>>> Sys.setenv(PYTHONPATH=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\apps\\grass\\grass-7.0.5\\etc\\python")) 
>>>
>>>
>>> Sys.setenv(GRASS_PROJSHARE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj")) 
>>>
>>>
>>> Sys.setenv(PROJ_LIB=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\proj"))
>>> Sys.setenv(GDAL_DATA=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\gdal")) 
>>>
>>> Sys.setenv(GEOTIFF_CSV=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\share\\epsg_csv")) 
>>>
>>>
>>> Sys.setenv(FONTCONFIG_FILE=paste0(Sys.getenv("OSGEO4W_ROOT"),"\\etc\\fonts.conf")) 
>>>
>>>
>>>
>>> # call all OSGEO4W settings
>>> system("C:/OSGeo4W64/bin/o-help.bat")
>>>
>>>
>>> # create PATH variable
>>> Sys.setenv(PATH=paste0(grass.gis.base,";",
>>> "C:\\OSGEO4~1\\apps\\Python27\\lib\\site-packages\\numpy\\core",";",
>>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\bin",";",
>>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\lib",";",
>>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc",";",
>>> "C:\\OSGeo4W64\\apps\\grass\\grass-7.0.5\\etc\\python",";",
>>> "C:\\OSGeo4W64\\apps\\Python27\\Scripts",";",
>>>                        "C:\\OSGeo4W64\\bin",";",
>>>                        "c:\\OSGeo4W64\\apps",";",
>>>                        "C:\\OSGEO4~1\\apps\\saga",";",
>>> paste0(Sys.getenv("WINDIR"),"/WBem"),";",
>>>                        Sys.getenv("PATH")))
>>>
>>>
>>> #################### start with GRASS setup
>>> ------------------------------------
>>> rgrass7::initGRASS(gisBase=grass.gis.base,
>>>                    home=tempdir(),
>>>                    mapset='PERMANENT',
>>>                    override=TRUE
>>> )
>>>
>>> # assign GRASS projection according to data set
>>> rgrass7::execGRASS('g.proj',
>>>                    flags=c('c','quiet'),
>>>                    proj4=proj4
>>> )
>>>
>>> # assign GRASS extent and resolution
>>> rgrass7::execGRASS('g.region',
>>>                    flags=c('quiet'),
>>>                    n=as.character(ymax),
>>>                    s=as.character(ymin),
>>>                    e=as.character(xmax),
>>>                    w=as.character(xmin),
>>>                    res=as.character(resolution)
>>> )
>>>
>>>
>>> #############   now do GRASS STUFF
>>> ---------------------------------------------
>>>
>>> rgrass7::writeVECT(meuse,"meuse")
>>> rgrass7::execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>>> double
>>>                    precision")
>>> #############  do other command line stuff
>>> -------------------------------------
>>>
>>> ## call gdal
>>> system("gdal_merge")
>>>
>>> # call saga cli
>>> system("saga_cmd")
>>>
>>>
>>> Am 23.11.2016 um 07:38 schrieb Michael DELORME:
>>>> Thanks for your insight.
>>>> I'll use a stand-alone GRASS install.
>>>>
>>>> Cordially
>>>>
>>>> Le 22/11/2016 15:13, Roger Bivand a ?crit :
>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>
>>>>>> Thanks for investigating.
>>>>>>
>>>>>> I'll try a standalone version of GRASS if needed.
>>>>>>
>>>>>> Here is the traceback
>>>>>>
>>>>>>> traceback()
>>>>>> 4: stop(paste(cmd, "not parsed"))
>>>>>> 3: parseGRASS(cmd, legacyExec = legacyExec)
>>>>>> 2: doGRASS(cmd, flags = flags, ..., parameters = parameters, 
>>>>>> echoCmd =
>>>>>> echoCmd, legacyExec = legacyExec)
>>>>>> 1: execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2
>>>>>> double
>>>>>> precision")
>>>>>>
>>>>>> My C:\OSGeo4W64\apps\grass\grass-7.0.5\bin lists *.exe or *.bat and
>>>>>> indeed the *.bat command are those which don't work (r.mask.bat,
>>>>>> v.db.addcolumn.bat,...). The batch calls Python scripts ; for 
>>>>>> example
>>>>>> v.db.addcolumn.bat is :
>>>>>>
>>>>>> @"%GRASS_PYTHON%" "%GISBASE%/scripts/v.db.addcolumn.py" %*
>>>>>>
>>>>>> So I guess something must be wrong in my Python installation... (it
>>>>>> works however from within a GRASS shell)
>>>>> No, the logic for Windows and initGRASS has only ever been tested 
>>>>> with
>>>>> stand-alone GRASS. I would guess that in OSGeo4W the path variables
>>>>> are wrong. I cannot even find out how to run initGRASS in R but
>>>>> outside the OSGeo4W shell (doesn't find iconv.dll) or inside the
>>>>> OSGeo4W shell (cannot create a temporary GRASS location). Unless you
>>>>> or others really need OSGeo4W, I suggest asking others to implement
>>>>> that - very bulky and fragile.
>>>>>
>>>>> Roger
>>>>>
>>>>>> Cordially
>>>>>>
>>>>>>
>>>>>> Le 22/11/2016 14:30, Roger Bivand a ?crit :
>>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>>
>>>>>>>> Thanks for replying
>>>>>>>>
>>>>>>>> Here is a reproducible example (change your GRASS directory of
>>>>>>>> course) :
>>>>>>>>
>>>>>>>> library(rgrass7)
>>>>>>>> library(sp)
>>>>>>>> initGRASS("C:/OSGeo4W64/apps/grass/grass-7.0.5", home = tempdir(),
>>>>>>>> override = TRUE)
>>>>>>>> data(meuse)
>>>>>>>> coordinates(meuse) <- ~x+y
>>>>>>>> writeVECT(meuse, "meuse")
>>>>>>>> execGRASS("v.db.addcolumn", map = "meuse", columns = "area_m2 
>>>>>>>> double
>>>>>>>> precision")
>>>>>>> This appears to run correctly on Windows 7 with GRASS 7.0.5 Windows
>>>>>>> stand-alone. Do you need to use OSGeo4W - the internal logic 
>>>>>>> used for
>>>>>>> finding out where the different versions keep their executables and
>>>>>>> batch files varies?
>>>>>>>
>>>>>>> What does traceback() say after the error? The error comes from
>>>>>>> parseGRASS("v.db.addcolumn") - the XML error comes from not being
>>>>>>> able
>>>>>>> to read the output of v.db.addcolumn<.ext> --interface-description
>>>>>>> where <.ext> may be .exe or .bat I think.
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>> I get :
>>>>>>>> Error : XML content does not seem to be XML: 'The specified path
>>>>>>>> was not
>>>>>>>> found.'
>>>>>>>> In addition: Warning message:
>>>>>>>> running command 'v.db.addcolumn.bat --interface-description' had
>>>>>>>> status 1
>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>>   v.db.addcolumn not parsed
>>>>>>>>
>>>>>>>> Other execGRASS commands (like r.neighbors, r.mapcalc,..)  work
>>>>>>>> fine,
>>>>>>>> but some other (r.mask) fail with a similar XML error.
>>>>>>>>
>>>>>>>> All commands work fine when used from the GRASS shell...
>>>>>>>>
>>>>>>>> What is this XML error ?
>>>>>>>> Thanks
>>>>>>>>
>>>>>>>> Le 22/11/2016 09:34, Roger Bivand a ?crit :
>>>>>>>>> On Tue, 22 Nov 2016, Michael DELORME wrote:
>>>>>>>>>
>>>>>>>>>> Dear list,
>>>>>>>>>>
>>>>>>>>>> Using rgrass7 on Windows7 with GRASS 7.0.5 (OSGeo distribution),
>>>>>>>>>> I get
>>>>>>>>>> the following error :
>>>>>>>>> Please always try to provide a reproducible example using a
>>>>>>>>> standard
>>>>>>>>> data set. In addition, the output of traceback() following the
>>>>>>>>> error
>>>>>>>>> would be helpful. Are you running R inside GRASS, or using R to
>>>>>>>>> initiate GRASS?
>>>>>>>>>
>>>>>>>>> Consider using the grass-stats list:
>>>>>>>>>
>>>>>>>>> https://lists.osgeo.org/mailman/listinfo/grass-stats
>>>>>>>>>
>>>>>>>>> as it is more likely to yield results, but there also provide an
>>>>>>>>> example that anyone can reproduce. The example should avoid 
>>>>>>>>> loading
>>>>>>>>> other packages, and should be run from the R console (not, say,
>>>>>>>>> RStudio).
>>>>>>>>>
>>>>>>>>> Roger
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>>> execGRASS("v.db.addcolumn", map = "result_v", columns = 
>>>>>>>>>>> "area_m2
>>>>>>>>>>> double precision")
>>>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>>>> sp?cifi? est introuvable.' In addition: Warning message: running
>>>>>>>>>> command 'v.db.addcolumn.bat --interface-description' had 
>>>>>>>>>> status 1
>>>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) :
>>>>>>>>>>   v.db.addcolumn not parsed
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> and a similar one for r.mask :
>>>>>>>>>>
>>>>>>>>>>> execGRASS("r.mask", raster = "map")
>>>>>>>>>> Error : XML content does not seem to be XML: 'Le chemin d'acc?s
>>>>>>>>>> sp?cifi? est introuvable.'
>>>>>>>>>> In addition: Warning message:
>>>>>>>>>> running command 'r.mask.bat --interface-description' had 
>>>>>>>>>> status 1
>>>>>>>>>> Error in parseGRASS(cmd, legacyExec = legacyExec) : r.mask not
>>>>>>>>>> parsed
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> whereas most other execGRASS command I tried work as expected.
>>>>>>>>>> Any idea ?
>>>>>>>>>> Thanks in advance
>>>>>>>>>>
>>>>>>>>>> Here is my session info :
>>>>>>>>>>
>>>>>>>>>>> sessionInfo()
>>>>>>>>>> R version 3.3.1 (2016-06-21)
>>>>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>>>>
>>>>>>>>>> locale:
>>>>>>>>>> [1] LC_COLLATE=French_France.1252 LC_CTYPE=French_France.1252
>>>>>>>>>> LC_MONETARY=French_France.1252 LC_NUMERIC=C [5]
>>>>>>>>>> LC_TIME=French_France.1252
>>>>>>>>>> attached base packages:
>>>>>>>>>> [1] parallel  stats     graphics  grDevices utils     datasets
>>>>>>>>>> methods   base
>>>>>>>>>> other attached packages: [1] rgrass7_0.1-9 XML_3.98-1.4 
>>>>>>>>>> beepr_1.2
>>>>>>>>>> raster_2.5-8 sp_1.2-3 RPostgreSQL_0.4-1 DBI_0.5-1
>>>>>>>>>>
>>>>>>>>>> loaded via a namespace (and not attached): [1] magrittr_1.5
>>>>>>>>>> tools_3.3.1 audio_0.1-5 Rcpp_0.12.7 stringi_1.1.2 grid_3.3.1
>>>>>>>>>> stringr_1.1.0 lattice_0.20-34 [9] fortunes_1.5-3
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>>>>
>>>>>>>>>> _______________________________________________
>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>> -- 
>>>>>>>> *Micha?l DELORME*
>>>>>>>> Administrateur de donn?es, charg? de projet en g?omatique
>>>>>>>> Service r?gional de l'information statistique, ?conomique et
>>>>>>>> territoriale
>>>>>>>> Direction r?gionale de l'alimentation, de l'agriculture et de la
>>>>>>>> for?t
>>>>>>>> Auvergne-Rh?ne-Alpes
>>>>>>>> Site de Lyon
>>>>>>>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>>>>>>>> 04 78 63 34 21
>>>>>>>>
>>>>>>>> Pour ?crire au service :
>>>>>>>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>>>>>>>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>>>>>>>
>>>>>>>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>>>>>>>
>>>>>>>>      [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> -- 
>> *Micha?l DELORME*
>> Administrateur de donn?es, charg? de projet en g?omatique
>> Service r?gional de l'information statistique, ?conomique et 
>> territoriale
>> Direction r?gionale de l'alimentation, de l'agriculture et de la for?t
>> Auvergne-Rh?ne-Alpes
>> Site de Lyon
>> 165 rue Garibaldi ? BP 3202 ? 69401 LYON cedex 03
>> 04 78 63 34 21
>>
>> Pour ?crire au service :
>> DRAAF Auvergne-Rh?ne-Alpes ? SRISET
>> 16B rue Aim? Rudel ? BP 45 ? 63370 LEMPDES
>>
>> http://www.draaf.auvergne-rhone-alpes.agriculture.gouv.fr/
>>
>>     [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From martazores at gmail.com  Thu Nov 24 14:52:07 2016
From: martazores at gmail.com (marta azores)
Date: Thu, 24 Nov 2016 12:52:07 -0100
Subject: [R-sig-Geo] package sp, extract values points-lines
Message-ID: <CAE3WKgSXaEqSQw5WSseJxCJ+uqcOrnJAtVYzk-RsbLn0hNqL2w@mail.gmail.com>

Hi everyone,

I need to join two datasets, one with survey boats and other with
sightings. There are different boats in the same area.
First I've created the tracks with the gps information, and give to each
track an ID number(column) .
Second, I would like to join by time and space the sightings with the track
of the boats.
I'm trying the"over" function of the package sp.

The first test was try to join only by space, but the function say there
aren't overlap. I don't know why, because the points of the sightings are
over the line.

Any idea?
Thanks in advance
Marta

#boat data
boat <- read.table("path/.csv", header=TRUE, sep=",", na.strings="NA",
dec=".", strip.white=TRUE)#
boatdf<-as.data.frame(boat)
#sighting data
sght <- read.table("path/.csv.csv", header=TRUE, sep=",", na.strings="NA",
dec=".", strip.white=TRUE)#

#Spatial points
#sightings
Sxy = cbind(sght$LONG,sght$LAT)
Spts = SpatialPoints(Sxy)
sghtdf<-as.data.frame(sght)
#boats
xy = cbind(boat$Long1,boat$Lat1)
pts = SpatialPoints(xy)

# dataframe
ptsdf = SpatialPointsDataFrame(pts, boatdf)#data frame barcos
Sptsdf = SpatialPointsDataFrame(Spts, sghtdf)#data frame species

#Line
line<-as(ptsdf, "SpatialLines")

#
#extract values
over(Sptsdf, line)# NA?

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Thu Nov 24 14:54:57 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 24 Nov 2016 07:54:57 -0600
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <alpine.LFD.2.20.1611240903460.14523@reclus.nhh.no>
References: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
	<alpine.LFD.2.20.1611240903460.14523@reclus.nhh.no>
Message-ID: <CABkCotSwwHWka3Scw=veNV4Uf89uSL_O7Dchy14X9a5pfJ9pUw@mail.gmail.com>

Thank you very much Roger.

Sorry about that, I took the name from the Processing toolbox in QGIS and I
assumed (wrongly)  that was the name in GRASS.

I want to split a vector line (route) in equal contiguous segments of 500 m.

Manuel

2016-11-24 2:09 GMT-06:00 Roger Bivand <Roger.Bivand at nhh.no>:

> Before giving advice, please do ask for clarification. There is no
> v.split.length in GRASS at all, there is only v.split. Without a fully
> specified GRASS command, such as:
>
> v.split -n input=??, output=??, length=10.0, units="meters"
>
> which means add vertices each 10m, but do not split the vector line, we
> could think that the OP wants to divide a line into contiguous shorter
> segments. What does the OP actually want to do? Once we know that (which we
> do not), we can offer advice, including running the command in GRASS -
> which should be done anyway to ensure that the output of R-only approaches
> matches the desired output object.
>
> Roger
>
>
> On Wed, 23 Nov 2016, Manuel Sp?nola wrote:
>
> Dear list members,
>>
>> Is it possible to run v.split.length from GRASS in R? Or is there anyway
>> to
>> split a SpatialLinesDataFrame to shorter segments by length in R?
>>
>> Best,
>>
>> Manuel
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.cr <mspinola at una.ac.cr>
>> mspinola10 at gmail.com
>> Tel?fono: (506) 8706 - 4662
>> Personal website: Lobito de r?o <https://sites.google.com/site
>> /lobitoderio/>
>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412




-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From rolandh at uni-muenster.de  Thu Nov 24 15:02:36 2016
From: rolandh at uni-muenster.de (rolandh at uni-muenster.de)
Date: Thu, 24 Nov 2016 15:02:36 +0100 (CET)
Subject: [R-sig-Geo] package sp, extract values points-lines
In-Reply-To: <CAE3WKgSXaEqSQw5WSseJxCJ+uqcOrnJAtVYzk-RsbLn0hNqL2w@mail.gmail.com>
Message-ID: <permail-201611241402363cc687ad00004d88-rolandh@message-id.uni-muenster.de>

Hi Marta,

by ?sp::over you will see that SpatialLines are not supported.

Moreover it says:
"over methods that involve SpatialLines objects, or pairs of SpatialPolygons require package rgeos, and use gIntersects."

So, try gIntersects ...

Cheers,
Roland

marta azores schrieb am 2016-11-24:
> Hi everyone,

> I need to join two datasets, one with survey boats and other with
> sightings. There are different boats in the same area.
> First I've created the tracks with the gps information, and give to each
> track an ID number(column) .
> Second, I would like to join by time and space the sightings with the track
> of the boats.
> I'm trying the"over" function of the package sp.

> The first test was try to join only by space, but the function say there
> aren't overlap. I don't know why, because the points of the sightings are
> over the line.

> Any idea?
> Thanks in advance
> Marta

> #boat data
> boat <- read.table("path/.csv", header=TRUE, sep=",", na.strings="NA",
> dec=".", strip.white=TRUE)#
> boatdf<-as.data.frame(boat)
> #sighting data
> sght <- read.table("path/.csv.csv", header=TRUE, sep=",", na.strings="NA",
> dec=".", strip.white=TRUE)#

> #Spatial points
> #sightings
> Sxy = cbind(sght$LONG,sght$LAT)
> Spts = SpatialPoints(Sxy)
> sghtdf<-as.data.frame(sght)
> #boats
> xy = cbind(boat$Long1,boat$Lat1)
> pts = SpatialPoints(xy)

> # dataframe
> ptsdf = SpatialPointsDataFrame(pts, boatdf)#data frame barcos
> Sptsdf = SpatialPointsDataFrame(Spts, sghtdf)#data frame species

> #Line
> line<-as(ptsdf, "SpatialLines")

> #
> #extract values
> over(Sptsdf, line)# NA?

> 	[[alternative HTML version deleted]]

> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Thu Nov 24 15:09:18 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 24 Nov 2016 15:09:18 +0100
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <CABkCotSwwHWka3Scw=veNV4Uf89uSL_O7Dchy14X9a5pfJ9pUw@mail.gmail.com>
References: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
	<alpine.LFD.2.20.1611240903460.14523@reclus.nhh.no>
	<CABkCotSwwHWka3Scw=veNV4Uf89uSL_O7Dchy14X9a5pfJ9pUw@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1611241457130.14523@reclus.nhh.no>

On Thu, 24 Nov 2016, Manuel Sp?nola wrote:

> Thank you very much Roger.
>
> Sorry about that, I took the name from the Processing toolbox in QGIS and I
> assumed (wrongly)  that was the name in GRASS.
>
> I want to split a vector line (route) in equal contiguous segments of 500 m.

So for a Line object of 5km, you'd want 10 separate contiguous Line 
objects each of 500m in a Lines object? This would be the inverse 
operation to rgeos::gLineMerge(). sp::spsample can give n regular points 
on lines, but they are not a given distance apart (fixed distance, but n 
is given, n total points on the object. The code in spsample methods could 
give guidance. There are many edge cases, unfortunately, especially for 
typical input objects, which may not be clean. GRASS may be the best way 
of doing this, because it has a topological vector model, and will clean 
the lines on input.

Roger

>
> Manuel
>
> 2016-11-24 2:09 GMT-06:00 Roger Bivand <Roger.Bivand at nhh.no>:
>
>> Before giving advice, please do ask for clarification. There is no
>> v.split.length in GRASS at all, there is only v.split. Without a fully
>> specified GRASS command, such as:
>>
>> v.split -n input=??, output=??, length=10.0, units="meters"
>>
>> which means add vertices each 10m, but do not split the vector line, we
>> could think that the OP wants to divide a line into contiguous shorter
>> segments. What does the OP actually want to do? Once we know that (which we
>> do not), we can offer advice, including running the command in GRASS -
>> which should be done anyway to ensure that the output of R-only approaches
>> matches the desired output object.
>>
>> Roger
>>
>>
>> On Wed, 23 Nov 2016, Manuel Sp?nola wrote:
>>
>> Dear list members,
>>>
>>> Is it possible to run v.split.length from GRASS in R? Or is there anyway
>>> to
>>> split a SpatialLinesDataFrame to shorter segments by length in R?
>>>
>>> Best,
>>>
>>> Manuel
>>>
>>> --
>>> *Manuel Sp?nola, Ph.D.*
>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>> Universidad Nacional
>>> Apartado 1350-3000
>>> Heredia
>>> COSTA RICA
>>> mspinola at una.cr <mspinola at una.ac.cr>
>>> mspinola10 at gmail.com
>>> Tel?fono: (506) 8706 - 4662
>>> Personal website: Lobito de r?o <https://sites.google.com/site
>>> /lobitoderio/>
>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>> http://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> http://depsy.org/person/434412
>
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From Roger.Bivand at nhh.no  Thu Nov 24 15:12:34 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 24 Nov 2016 15:12:34 +0100
Subject: [R-sig-Geo] package sp, extract values points-lines
In-Reply-To: <permail-201611241402363cc687ad00004d88-rolandh@message-id.uni-muenster.de>
References: <permail-201611241402363cc687ad00004d88-rolandh@message-id.uni-muenster.de>
Message-ID: <alpine.LFD.2.20.1611241509540.14523@reclus.nhh.no>

On Thu, 24 Nov 2016, rolandh at uni-muenster.de wrote:

> Hi Marta,
>
> by ?sp::over you will see that SpatialLines are not supported.
>
> Moreover it says:
> "over methods that involve SpatialLines objects, or pairs of SpatialPolygons require package rgeos, and use gIntersects."
>
> So, try gIntersects ...

Right, and note that the precision model will bite painfully (the points 
may appear to be on the lines, but given the precision model may not 
actually intersect in the default representation (think one thousandth of 
a millimetre). You may need to buffer either points or lines to get the 
intersections you expect.

Roger

>
> Cheers,
> Roland
>
> marta azores schrieb am 2016-11-24:
>> Hi everyone,
>
>> I need to join two datasets, one with survey boats and other with
>> sightings. There are different boats in the same area.
>> First I've created the tracks with the gps information, and give to each
>> track an ID number(column) .
>> Second, I would like to join by time and space the sightings with the track
>> of the boats.
>> I'm trying the"over" function of the package sp.
>
>> The first test was try to join only by space, but the function say there
>> aren't overlap. I don't know why, because the points of the sightings are
>> over the line.
>
>> Any idea?
>> Thanks in advance
>> Marta
>
>> #boat data
>> boat <- read.table("path/.csv", header=TRUE, sep=",", na.strings="NA",
>> dec=".", strip.white=TRUE)#
>> boatdf<-as.data.frame(boat)
>> #sighting data
>> sght <- read.table("path/.csv.csv", header=TRUE, sep=",", na.strings="NA",
>> dec=".", strip.white=TRUE)#
>
>> #Spatial points
>> #sightings
>> Sxy = cbind(sght$LONG,sght$LAT)
>> Spts = SpatialPoints(Sxy)
>> sghtdf<-as.data.frame(sght)
>> #boats
>> xy = cbind(boat$Long1,boat$Lat1)
>> pts = SpatialPoints(xy)
>
>> # dataframe
>> ptsdf = SpatialPointsDataFrame(pts, boatdf)#data frame barcos
>> Sptsdf = SpatialPointsDataFrame(Spts, sghtdf)#data frame species
>
>> #Line
>> line<-as(ptsdf, "SpatialLines")
>
>> #
>> #extract values
>> over(Sptsdf, line)# NA?
>
>> 	[[alternative HTML version deleted]]
>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From mspinola10 at gmail.com  Thu Nov 24 16:00:41 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 24 Nov 2016 09:00:41 -0600
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <trinity-6ddcab52-d171-42da-88c5-77eebc6a7559-1479980607558@3capp-gmx-bs32>
References: <trinity-f1cf80d6-b50b-4abc-b23b-9e885b03555c-1479912323923@3capp-gmx-bs44>
	<CABkCotR=+5g-1S_Vx4U=LB=RokWMx74eP9q5335G2NW4o+tmsw@mail.gmail.com>
	<trinity-6ddcab52-d171-42da-88c5-77eebc6a7559-1479980607558@3capp-gmx-bs32>
Message-ID: <CABkCotR+0W7OPKZovQ4F8mXLMsAP-wDMomdv4-dKgWmfuOgC9Q@mail.gmail.com>

Thank you Jannes,

I installed the QGIS LTR, but I got the following error:

qgis_env <- set_env("C:/Program Files/QGIS 2.14")

ruta <- readOGR(dsn = ".", layer = "Ruta32_CRTM05_FINAL")

args <- get_args_man("grass7:v.split.length", qgis_env = qgis_env, options
= TRUE)

args$input <- ruta

args$length <- 500

args$output <- "ruta_s.shp"

out <- run_qgis(alg = "grass7:v.split.length", params = args, load_output =
args$output, qgis_env = qgis_env)

Error in .local(.Object, ...) :

 Show Traceback
Error in .rasterObjectFromFile(x, band = band, objecttype = "RasterLayer",
: Cannot create a RasterLayer object from this file. (file does not exist)












2016-11-24 3:43 GMT-06:00 "Jannes M?nchow" <malNamalJa at gmx.de>:

> Hi Manuel,
>
> overall we recommend to use RQGIS with the long-term release of QGIS
> (2.14). Nevertheless, RQGIS works also with QGIS 2.18. However, there is a
> bug in the QGIS Python code. Therefore, one needs to manually change the
> Python code. Here you find how you can do that:
>
> https://github.com/jannes-m/RQGIS#qgis-216-modifications.
>
> Regarding this issue, we have already notified the QGIS developers, and
> they told us that they fixed the issue. Hence, with the release of the next
> QGIS patch release, the manual adjustment of the Python code should no
> longer be necessary.
>
> Best regards,
>
> Jannes
>
>
>
>
> *Gesendet:* Mittwoch, 23. November 2016 um 20:49 Uhr
> *Von:* "Manuel Sp?nola" <mspinola10 at gmail.com>
> *An:* "Jannes M?nchow" <malNamalJa at gmx.de>
> *Cc:* "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> *Betreff:* Re: [R-sig-Geo] v.split.length (GRASS) in R
> Thank you very much Jannes.
>
> Does the example works with QGIS 2.18 or should I do some setting in QGIS
> before running the code?
>
> Manuel
>
> 2016-11-23 8:45 GMT-06:00 "Jannes M?nchow" <malNamalJa at gmx.de>:
>>
>> To achieve this, you can also use the RQGIS-package in conjunction with
>> GRASS given you have installed QGIS along with GRASS (for more information
>> have a look at vignette("install_guide", package = "RQGIS"):
>>
>> # construct a SpatialPointsDataFrame (which will be accepted as input by
>> # run_qgis)
>> library("sp")
>> # from the sp vignette:
>> l1 <- cbind(c(1, 2, 3), c(3, 2, 2))
>> rownames(l1) <- letters[1:3]
>> l1a <- cbind(l1[, 1] + 0.05, l1[, 2] + 0.05)
>> rownames(l1a) <- letters[1:3]
>> l2 <- cbind(c(1, 2, 3), c(1, 1.5, 1))
>> rownames(l2) <- letters[1:3]
>> Sl1 <- Line(l1)
>> Sl1a <- Line(l1a)
>> Sl2 <- Line(l2)
>> S1 <- Lines(list(Sl1, Sl1a), ID = "a")
>> S2 <- Lines(list(Sl2), ID = "b")
>> Sl <- SpatialLines(list(S1, S2))
>> # convert it to a SpatialLinesDataFrame
>> Sl <- SpatialLinesDataFrame(Sl, data = data.frame(1:2), match.ID = FALSE)
>> proj4string(Sl) <- CRS("+proj=longlat +datum=WGS84")
>>
>> # Now use RQGIS
>> library("RQGIS")
>> # indicate where QGIS is installed on your computer
>> qgis_env <- set_env("C:/OSGeo4W64/")
>> args <- get_args_man("grass7:v.split.length", qgis_env = qgis_env,
>>                      options = TRUE)
>> # have a look at the GRASS online help
>> open_help("grass7:v.split.length", qgis_env = qgis_env)
>>
>> # specify the necessary arguments
>> args$input <- Sl
>> # here length corresponds to one decimal degree
>> args$length <- "1"
>> args$output <- file.path(tempdir(), "out.shp")
>> # load the output directly into R again
>> out <- run_qgis(alg = "grass7:v.split.length", params = args,
>>                 load_output = args$output,
>>                 qgis_env = qgis_env)
>> length(Sl)  # 2 line objects
>> length(out)  #  9 line objects
>> # Have a look at the output
>> plot(out, col = rep(c("blue", "green", "black"), 3))
>>
>> Cheers,
>>
>> Jannes
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o
> <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Thu Nov 24 16:01:45 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 24 Nov 2016 09:01:45 -0600
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <alpine.LFD.2.20.1611241457130.14523@reclus.nhh.no>
References: <CABkCotQx+6AS1djN0TKiYZg8idztxA=p=Ogqa5whjY7zL3Vx2Q@mail.gmail.com>
	<alpine.LFD.2.20.1611240903460.14523@reclus.nhh.no>
	<CABkCotSwwHWka3Scw=veNV4Uf89uSL_O7Dchy14X9a5pfJ9pUw@mail.gmail.com>
	<alpine.LFD.2.20.1611241457130.14523@reclus.nhh.no>
Message-ID: <CABkCotSbcXg6-z2-4zvM5wxOs3EgYhm2U=xXPtyZhmaBin39aw@mail.gmail.com>

Thank you very much Roger.



2016-11-24 8:09 GMT-06:00 Roger Bivand <Roger.Bivand at nhh.no>:

> On Thu, 24 Nov 2016, Manuel Sp?nola wrote:
>
> Thank you very much Roger.
>>
>> Sorry about that, I took the name from the Processing toolbox in QGIS and
>> I
>> assumed (wrongly)  that was the name in GRASS.
>>
>> I want to split a vector line (route) in equal contiguous segments of 500
>> m.
>>
>
> So for a Line object of 5km, you'd want 10 separate contiguous Line
> objects each of 500m in a Lines object? This would be the inverse operation
> to rgeos::gLineMerge(). sp::spsample can give n regular points on lines,
> but they are not a given distance apart (fixed distance, but n is given, n
> total points on the object. The code in spsample methods could give
> guidance. There are many edge cases, unfortunately, especially for typical
> input objects, which may not be clean. GRASS may be the best way of doing
> this, because it has a topological vector model, and will clean the lines
> on input.
>
> Roger
>
>
>
>> Manuel
>>
>> 2016-11-24 2:09 GMT-06:00 Roger Bivand <Roger.Bivand at nhh.no>:
>>
>> Before giving advice, please do ask for clarification. There is no
>>> v.split.length in GRASS at all, there is only v.split. Without a fully
>>> specified GRASS command, such as:
>>>
>>> v.split -n input=??, output=??, length=10.0, units="meters"
>>>
>>> which means add vertices each 10m, but do not split the vector line, we
>>> could think that the OP wants to divide a line into contiguous shorter
>>> segments. What does the OP actually want to do? Once we know that (which
>>> we
>>> do not), we can offer advice, including running the command in GRASS -
>>> which should be done anyway to ensure that the output of R-only
>>> approaches
>>> matches the desired output object.
>>>
>>> Roger
>>>
>>>
>>> On Wed, 23 Nov 2016, Manuel Sp?nola wrote:
>>>
>>> Dear list members,
>>>
>>>>
>>>> Is it possible to run v.split.length from GRASS in R? Or is there anyway
>>>> to
>>>> split a SpatialLinesDataFrame to shorter segments by length in R?
>>>>
>>>> Best,
>>>>
>>>> Manuel
>>>>
>>>> --
>>>> *Manuel Sp?nola, Ph.D.*
>>>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>>>> Universidad Nacional
>>>> Apartado 1350-3000
>>>> Heredia
>>>> COSTA RICA
>>>> mspinola at una.cr <mspinola at una.ac.cr>
>>>> mspinola10 at gmail.com
>>>> Tel?fono: (506) 8706 - 4662
>>>> Personal website: Lobito de r?o <https://sites.google.com/site
>>>> /lobitoderio/>
>>>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>> http://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> http://depsy.org/person/434412
>>>
>>
>>
>>
>>
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
>



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From martazores at gmail.com  Thu Nov 24 19:40:46 2016
From: martazores at gmail.com (marta azores)
Date: Thu, 24 Nov 2016 17:40:46 -0100
Subject: [R-sig-Geo] package sp, extract values points-lines
In-Reply-To: <alpine.LFD.2.20.1611241509540.14523@reclus.nhh.no>
References: <permail-201611241402363cc687ad00004d88-rolandh@message-id.uni-muenster.de>
	<alpine.LFD.2.20.1611241509540.14523@reclus.nhh.no>
Message-ID: <CAE3WKgTW0KGtv4Xv7BTNEHgQWoA5+tG=2x1H7GLoqi1V7Jv2og@mail.gmail.com>

Hi Roger,

Thanks for the tip. I tried with only one track the function gIntersects
and gbuffer . It works.
I created my spatiallines from a data frame , and now I was looking for how
create the spatiallines by categories (1 variable of the data.frame).
I have only one spatial line with all the coordinates, and I would like to
have 1000 different lines separates by the IdkeyL. It's that possible??


My spatial data frame:
coordinates IdkeyL  Date
1 (-24.54572, 37.30128)  2815L 42229
2 (-24.59933, 37.32453)  2815L 42229
3 (-24.68027, 37.36087)  2815L 42229


I checked the sp and rgeos manual, and I look into the forums, but in every
example they only use a few lines, which are defined one by one.
l1 <- cbind(c(1, 2, 3), c(3, 2, 2)) l2 <- cbind(c(1, 2, 3), c(1, 1.5, 1))
Sl1 <- Line(l1) Sl2 <- Line(l2) S1 <- Lines(list(Sl1), ID = "a") S2 <- Lines
(list(Sl2), ID = "b") Sl <- SpatialLines(list(S1, S2))

Thanks in advance
Marta


2016-11-24 13:12 GMT-01:00 Roger Bivand <Roger.Bivand at nhh.no>:

> On Thu, 24 Nov 2016, rolandh at uni-muenster.de wrote:
>
> Hi Marta,
>>
>> by ?sp::over you will see that SpatialLines are not supported.
>>
>> Moreover it says:
>> "over methods that involve SpatialLines objects, or pairs of
>> SpatialPolygons require package rgeos, and use gIntersects."
>>
>> So, try gIntersects ...
>>
>
> Right, and note that the precision model will bite painfully (the points
> may appear to be on the lines, but given the precision model may not
> actually intersect in the default representation (think one thousandth of a
> millimetre). You may need to buffer either points or lines to get the
> intersections you expect.
>
> Roger
>
>
>
>> Cheers,
>> Roland
>>
>> marta azores schrieb am 2016-11-24:
>>
>>> Hi everyone,
>>>
>>
>> I need to join two datasets, one with survey boats and other with
>>> sightings. There are different boats in the same area.
>>> First I've created the tracks with the gps information, and give to each
>>> track an ID number(column) .
>>> Second, I would like to join by time and space the sightings with the
>>> track
>>> of the boats.
>>> I'm trying the"over" function of the package sp.
>>>
>>
>> The first test was try to join only by space, but the function say there
>>> aren't overlap. I don't know why, because the points of the sightings are
>>> over the line.
>>>
>>
>> Any idea?
>>> Thanks in advance
>>> Marta
>>>
>>
>> #boat data
>>> boat <- read.table("path/.csv", header=TRUE, sep=",", na.strings="NA",
>>> dec=".", strip.white=TRUE)#
>>> boatdf<-as.data.frame(boat)
>>> #sighting data
>>> sght <- read.table("path/.csv.csv", header=TRUE, sep=",",
>>> na.strings="NA",
>>> dec=".", strip.white=TRUE)#
>>>
>>
>> #Spatial points
>>> #sightings
>>> Sxy = cbind(sght$LONG,sght$LAT)
>>> Spts = SpatialPoints(Sxy)
>>> sghtdf<-as.data.frame(sght)
>>> #boats
>>> xy = cbind(boat$Long1,boat$Lat1)
>>> pts = SpatialPoints(xy)
>>>
>>
>> # dataframe
>>> ptsdf = SpatialPointsDataFrame(pts, boatdf)#data frame barcos
>>> Sptsdf = SpatialPointsDataFrame(Spts, sghtdf)#data frame species
>>>
>>
>> #Line
>>> line<-as(ptsdf, "SpatialLines")
>>>
>>
>> #
>>> #extract values
>>> over(Sptsdf, line)# NA?
>>>
>>
>>         [[alternative HTML version deleted]]
>>>
>>
>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
>

	[[alternative HTML version deleted]]


From Jin.Li at ga.gov.au  Thu Nov 24 23:27:52 2016
From: Jin.Li at ga.gov.au (Li Jin)
Date: Thu, 24 Nov 2016 22:27:52 +0000
Subject: [R-sig-Geo] Error with loading rJava for spcosa [SEC=UNCLASSIFIED]
Message-ID: <1d4093ff8eb048f39aeb72aa0ac1af9e@win-exch-prod01.prod.lan>

Hi All,

I have been using library(spcosa) in R version 3.2.3 (2015-12-10) and all worked well, until today.

The error was as below when I called:
>  library(spcosa)
Loading required package: rJava
Error : .onLoad failed in loadNamespace() for 'rJava', details:
  call: fun(libname, pkgname)
  error: JAVA_HOME cannot be determined from the Registry
Error: package 'rJava' could not be loaded

Although rJava was installed, I reinstalled it, successfully as:
>   install.packages("rJava")
--- Please select a CRAN mirror for use in this session ---
trying URL 'https://cloud.r-project.org/bin/windows/contrib/3.2/rJava_0.9-8.zip'
Content type 'application/zip' length 765340 bytes (747 KB)
downloaded 747 KB

package 'rJava' successfully unpacked and MD5 sums checked

The downloaded binary packages are in
        C:\Users\u09672\AppData\Local\Temp\1\Rtmp2PslO0\downloaded_packages

But when I called:
> library(rJava)
Error in get(Info[i, 1], envir = env) :
  lazy-load database 'C:/LegacyApps/R-3.2.3/library/rJava/R/rJava.rdb' is corrupt
In addition: Warning messages:
1: package 'rJava' was built under R version 3.2.5
2: In get(Info[i, 1], envir = env) : internal error -3 in R_decompress1
Error: package or namespace load failed for 'rJava'

When I called:
>  library(spcosa)
Loading required package: rJava
Error in get(Info[i, 1], envir = env) :
  lazy-load database 'C:/LegacyApps/R-3.2.3/library/rJava/R/rJava.rdb' is corrupt
In addition: Warning messages:
1: package 'rJava' was built under R version 3.2.5
2: In get(Info[i, 1], envir = env) : internal error -3 in R_decompress1
Error: package 'rJava' could not be loaded

Looks like something is wrong with loading "rJava". The only thing has been changed is that my PC was refreshed recently.

Any suggestions to how to fix this loading problem? Thanks!


> sessionInfo()
R version 3.2.3 (2015-12-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] raster_2.5-8 sp_1.2-3

loaded via a namespace (and not attached):
[1] tools_3.2.3     Rcpp_0.12.7     grid_3.2.3      lattice_0.20-34
>

Please note this error persists for:  R version 3.3.1 (2016-06-21)

Kind regards,
Jin

Jin Li, PhD | Spatial Modeller / Computational Statistician
National Earth and Marine Observations | Environmental Geoscience Division
t:  +61 2 6249 9899

Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
-------------------------------------------------------------------------------------------------------------------------


	[[alternative HTML version deleted]]


From malNamalJa at gmx.de  Fri Nov 25 08:49:45 2016
From: malNamalJa at gmx.de (=?UTF-8?Q?=22Jannes_M=C3=BCnchow=22?=)
Date: Fri, 25 Nov 2016 08:49:45 +0100
Subject: [R-sig-Geo] v.split.length (GRASS) in R
In-Reply-To: <CABkCotR+0W7OPKZovQ4F8mXLMsAP-wDMomdv4-dKgWmfuOgC9Q@mail.gmail.com>
References: <trinity-f1cf80d6-b50b-4abc-b23b-9e885b03555c-1479912323923@3capp-gmx-bs44>
	<CABkCotR=+5g-1S_Vx4U=LB=RokWMx74eP9q5335G2NW4o+tmsw@mail.gmail.com>
	<trinity-6ddcab52-d171-42da-88c5-77eebc6a7559-1479980607558@3capp-gmx-bs32>,
	<CABkCotR+0W7OPKZovQ4F8mXLMsAP-wDMomdv4-dKgWmfuOgC9Q@mail.gmail.com>
Message-ID: <trinity-93eed691-2f40-493f-8d1f-55a7eee1fb4b-1480060184998@3capp-gmx-bs24>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161125/62a2f6ec/attachment.html>

From Roger.Bivand at nhh.no  Fri Nov 25 09:23:31 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 25 Nov 2016 09:23:31 +0100
Subject: [R-sig-Geo] Error with loading rJava for spcosa
 [SEC=UNCLASSIFIED]
In-Reply-To: <1d4093ff8eb048f39aeb72aa0ac1af9e@win-exch-prod01.prod.lan>
References: <1d4093ff8eb048f39aeb72aa0ac1af9e@win-exch-prod01.prod.lan>
Message-ID: <alpine.LFD.2.20.1611250916050.5571@reclus.nhh.no>

On Thu, 24 Nov 2016, Li Jin wrote:

> Hi All,
>
> I have been using library(spcosa) in R version 3.2.3 (2015-12-10) and all worked well, until today.
>
> The error was as below when I called:
>>  library(spcosa)
> Loading required package: rJava
> Error : .onLoad failed in loadNamespace() for 'rJava', details:
>  call: fun(libname, pkgname)
>  error: JAVA_HOME cannot be determined from the Registry
> Error: package 'rJava' could not be loaded
>
> Although rJava was installed, I reinstalled it, successfully as:
>>   install.packages("rJava")
> --- Please select a CRAN mirror for use in this session ---
> trying URL 'https://cloud.r-project.org/bin/windows/contrib/3.2/rJava_0.9-8.zip'
> Content type 'application/zip' length 765340 bytes (747 KB)
> downloaded 747 KB
>
> package 'rJava' successfully unpacked and MD5 sums checked
>
> The downloaded binary packages are in
>        C:\Users\u09672\AppData\Local\Temp\1\Rtmp2PslO0\downloaded_packages
>
> But when I called:
>> library(rJava)
> Error in get(Info[i, 1], envir = env) :
>  lazy-load database 'C:/LegacyApps/R-3.2.3/library/rJava/R/rJava.rdb' is corrupt
> In addition: Warning messages:
> 1: package 'rJava' was built under R version 3.2.5
> 2: In get(Info[i, 1], envir = env) : internal error -3 in R_decompress1
> Error: package or namespace load failed for 'rJava'
>
> When I called:
>>  library(spcosa)
> Loading required package: rJava
> Error in get(Info[i, 1], envir = env) :
>  lazy-load database 'C:/LegacyApps/R-3.2.3/library/rJava/R/rJava.rdb' is corrupt
> In addition: Warning messages:
> 1: package 'rJava' was built under R version 3.2.5
> 2: In get(Info[i, 1], envir = env) : internal error -3 in R_decompress1
> Error: package 'rJava' could not be loaded
>
> Looks like something is wrong with loading "rJava". The only thing has 
> been changed is that my PC was refreshed recently.

Three possibilities: you may need rJava built for R 3.2.3 - you are warned 
about the mis-match; the refreshing of your PC may have taken away 
something the rJava needed when it loaded; and the rJava Windows binary 
may be corrupted on your mirror - try a different mirror.

Try replacing R 3.2.3 with the current R 3.3.2, and update all your 
packages (all Windows binary packages for R < 3.3 were built using an 
older compiler, all for R >= 3.3 with a newer compiler, and they are not 
mutually compatible if they include compiled code.

Roger

>
> Any suggestions to how to fix this loading problem? Thanks!
>
>
>> sessionInfo()
> R version 3.2.3 (2015-12-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
>
> locale:
> [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] raster_2.5-8 sp_1.2-3
>
> loaded via a namespace (and not attached):
> [1] tools_3.2.3     Rcpp_0.12.7     grid_3.2.3      lattice_0.20-34
>>
>
> Please note this error persists for:  R version 3.3.1 (2016-06-21)
>
> Kind regards,
> Jin
>
> Jin Li, PhD | Spatial Modeller / Computational Statistician
> National Earth and Marine Observations | Environmental Geoscience Division
> t:  +61 2 6249 9899
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
> -------------------------------------------------------------------------------------------------------------------------
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From patrick.giraudoux at univ-fcomte.fr  Fri Nov 25 15:58:00 2016
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Fri, 25 Nov 2016 15:58:00 +0100
Subject: [R-sig-Geo] Wrong reading of data type in readOGR ?
In-Reply-To: <mailman.9.1480071602.3776.r-sig-geo@r-project.org>
References: <mailman.9.1480071602.3776.r-sig-geo@r-project.org>
Message-ID: <53e72efe-0cb3-8828-0fa5-015a8b08c9b1@univ-fcomte.fr>

Dear Listers,

I meet a problem with readOGR on an ESRI shapefile which was correctly 
read in the past (practical training with students). Now all integer 
variables are read as "factors" although they should be read as integer. 
With the argument stringsAsFactors=FALSE, the reading gives 
"characters", but not the expected integers.

Reading the corresponding *.dbf file with foreign:read.dbf gives a 
correct reading. This makes me suspect that something goes wrong with 
the last version of readOGR (maybe earlier too). Those installed one 
year ago in the computer room are OK.

Any suggestion/idea?

Best,

Patrick


From Roger.Bivand at nhh.no  Fri Nov 25 16:18:15 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 25 Nov 2016 16:18:15 +0100
Subject: [R-sig-Geo] Wrong reading of data type in readOGR ?
In-Reply-To: <53e72efe-0cb3-8828-0fa5-015a8b08c9b1@univ-fcomte.fr>
References: <mailman.9.1480071602.3776.r-sig-geo@r-project.org>
	<53e72efe-0cb3-8828-0fa5-015a8b08c9b1@univ-fcomte.fr>
Message-ID: <alpine.LFD.2.20.1611251614440.15758@reclus.nhh.no>

On Fri, 25 Nov 2016, Patrick Giraudoux wrote:

> Dear Listers,
>
> I meet a problem with readOGR on an ESRI shapefile which was correctly read 
> in the past (practical training with students). Now all integer variables are 
> read as "factors" although they should be read as integer. With the argument 
> stringsAsFactors=FALSE, the reading gives "characters", but not the expected 
> integers.

Please see:

https://stat.ethz.ch/pipermail/r-sig-geo/2016-October/025038.html

https://stat.ethz.ch/pipermail/r-sig-geo/2016-November/025104.html

This is the result of the antiquated way DBF handle numbers, and changes 
made in GDAL2 to accommodate 64-bit integers, which most often are IDs, 
not numbers. Maybe try the GDAL1_integer64_policy= argument, or re-write 
the shapefiles with the offending integer written as a double, or stop 
using shapefiles.

Roger

>
> Reading the corresponding *.dbf file with foreign:read.dbf gives a correct 
> reading. This makes me suspect that something goes wrong with the last 
> version of readOGR (maybe earlier too). Those installed one year ago in the 
> computer room are OK.
>
> Any suggestion/idea?
>
> Best,
>
> Patrick
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From patrick.giraudoux at univ-fcomte.fr  Fri Nov 25 16:48:27 2016
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Fri, 25 Nov 2016 16:48:27 +0100
Subject: [R-sig-Geo] Wrong reading of data type in readOGR ?
In-Reply-To: <alpine.LFD.2.20.1611251614440.15758@reclus.nhh.no>
References: <mailman.9.1480071602.3776.r-sig-geo@r-project.org>
	<53e72efe-0cb3-8828-0fa5-015a8b08c9b1@univ-fcomte.fr>
	<alpine.LFD.2.20.1611251614440.15758@reclus.nhh.no>
Message-ID: <6c1e32c2-aa65-bde2-b16d-9a61001ecd84@univ-fcomte.fr>

Le 25/11/2016 ? 16:18, Roger Bivand a ?crit :
> On Fri, 25 Nov 2016, Patrick Giraudoux wrote:
>
>> Dear Listers,
>>
>> I meet a problem with readOGR on an ESRI shapefile which was 
>> correctly read in the past (practical training with students). Now 
>> all integer variables are read as "factors" although they should be 
>> read as integer. With the argument stringsAsFactors=FALSE, the 
>> reading gives "characters", but not the expected integers.
>
> Please see:
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2016-October/025038.html
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2016-November/025104.html
>
> This is the result of the antiquated way DBF handle numbers, and 
> changes made in GDAL2 to accommodate 64-bit integers, which most often 
> are IDs, not numbers. Maybe try the GDAL1_integer64_policy= argument, 
> or re-write the shapefiles with the offending integer written as a 
> double, or stop using shapefiles.
>
> Roger 

OK. Clear enough. Thanks, Roger. Will modify the training guideline 
accordingly.

Best,

Patrick


From patrick.giraudoux at univ-fcomte.fr  Fri Nov 25 18:45:20 2016
From: patrick.giraudoux at univ-fcomte.fr (Patrick Giraudoux)
Date: Fri, 25 Nov 2016 18:45:20 +0100
Subject: [R-sig-Geo] Wrong reading of data type in readOGR ?
In-Reply-To: <alpine.LFD.2.20.1611251614440.15758@reclus.nhh.no>
References: <mailman.9.1480071602.3776.r-sig-geo@r-project.org>
	<53e72efe-0cb3-8828-0fa5-015a8b08c9b1@univ-fcomte.fr>
	<alpine.LFD.2.20.1611251614440.15758@reclus.nhh.no>
Message-ID: <011d4bf8-d426-0b14-9ab9-ddbcffd98b73@univ-fcomte.fr>

Le 25/11/2016 ? 16:18, Roger Bivand a ?crit :
> On Fri, 25 Nov 2016, Patrick Giraudoux wrote:
>
>> Dear Listers,
>>
>> I meet a problem with readOGR on an ESRI shapefile which was 
>> correctly read in the past (practical training with students). Now 
>> all integer variables are read as "factors" although they should be 
>> read as integer. With the argument stringsAsFactors=FALSE, the 
>> reading gives "characters", but not the expected integers.
>
> Please see:
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2016-October/025038.html
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2016-November/025104.html
>
> This is the result of the antiquated way DBF handle numbers, and 
> changes made in GDAL2 to accommodate 64-bit integers, which most often 
> are IDs, not numbers. Maybe try the GDAL1_integer64_policy= argument, 
> or re-write the shapefiles with the offending integer written as a 
> double, or stop using shapefiles.
>
> Roger 

For info, a command line like this (with GDAL1_integer64=TRUE)

2539<-readOGR(".","Arvicola2539maj11au", GDAL1_integer64=TRUE)

...works perfect and meet the expectations. May be useful to keep in 
mind for old shapefiles left on a shelter in the attic...

Before Roger's response, during the training course (may day, may day, 
etc.), the other way round had been to import with no arguments and then 
use a loop such:

for(i in 18:75) d2539 at data[,i]<-as.numeric(as.character(d2539 at data[,i]))

but it is (not recommandable) ruffian's way (:-)


From sa462 at cornell.edu  Fri Nov 25 22:17:45 2016
From: sa462 at cornell.edu (Samar Deen)
Date: Fri, 25 Nov 2016 16:17:45 -0500
Subject: [R-sig-Geo] Using Stargazer to output spautolm models in Latex
Message-ID: <CAKY_pX5XWEJWHwBdi=RCUQwP1uR1E=8PTYYhcPTJOrwTii9T4w@mail.gmail.com>

Hi Everyone,

I am running some CAR regressions using spautolm. I wanted to generate some
summary tables of the regressions using stargazer to output in Latex.
While stargazer supports some spdep classes, unfortunately, stargazer does
not support  spautolm. Has anyone tried to output CAR model regression
results in Latex? Please do let me know if you have come across a
supporting package.

One alternative will be to convert the spautolm class to a supported
class in stargazer. But I haven't had much luck.

Any tips will be most helpful.

Thank you.
-- 
Samar Deen

Summer Research Fellow,  Atkinson Center for a Sustainable Future
PhD Candidate, Department of Natural Resources, Cornell University
M.P.A. Cornell University, 2011

Phone: +1 607 793 4200
Skype ID: samarnasiruddeen

	[[alternative HTML version deleted]]


From mel at mbacou.com  Fri Nov 25 22:32:15 2016
From: mel at mbacou.com (Melanie Bacou)
Date: Fri, 25 Nov 2016 16:32:15 -0500
Subject: [R-sig-Geo] Using Stargazer to output spautolm models in Latex
In-Reply-To: <CAKY_pX5XWEJWHwBdi=RCUQwP1uR1E=8PTYYhcPTJOrwTii9T4w@mail.gmail.com>
References: <CAKY_pX5XWEJWHwBdi=RCUQwP1uR1E=8PTYYhcPTJOrwTii9T4w@mail.gmail.com>
Message-ID: <d5943a7d-114d-03ee-2198-44d9b547d166@mbacou.com>

You could also check into the `pander` package (documented at 
http://rapporter.github.io/pander/#helper-functions).

AFAIK there's no helper function to output SAR/CAR or GWR objects 
directly, but you might be able to work with `pander.lm`.

Else maybe submit a request on GitHub 
https://github.com/Rapporter/pander/issues.

--Mel.


On 11/25/2016 04:17 PM, Samar Deen wrote:
> Hi Everyone,
>
> I am running some CAR regressions using spautolm. I wanted to generate some
> summary tables of the regressions using stargazer to output in Latex.
> While stargazer supports some spdep classes, unfortunately, stargazer does
> not support  spautolm. Has anyone tried to output CAR model regression
> results in Latex? Please do let me know if you have come across a
> supporting package.
>
> One alternative will be to convert the spautolm class to a supported
> class in stargazer. But I haven't had much luck.
>
> Any tips will be most helpful.
>
> Thank you.


	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Sat Nov 26 10:36:12 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 26 Nov 2016 10:36:12 +0100
Subject: [R-sig-Geo] Using Stargazer to output spautolm models in Latex
In-Reply-To: <d5943a7d-114d-03ee-2198-44d9b547d166@mbacou.com>
References: <CAKY_pX5XWEJWHwBdi=RCUQwP1uR1E=8PTYYhcPTJOrwTii9T4w@mail.gmail.com>
	<d5943a7d-114d-03ee-2198-44d9b547d166@mbacou.com>
Message-ID: <alpine.LFD.2.20.1611260943001.18942@reclus.nhh.no>

The spdep sarlm stargazer support was seriously broken when introduced, 
and the package author was only interested in advertising the package, and 
unresponsive with regard to necessary fixes.

Writing functions to extract what is needed from the summary objects could 
be done, but is hard to do right. For example, a sarlm object fitted using 
lagsarlm or sacsarlm should never have its covariate coefficients 
displayed, only the three-column impacts from the impacts() method (the 
coefficients are not equal to of a unit increment on a covariate in these 
cases unless \rho_{Lag} = 0 as they would be where the spatial process is 
uncorrelated with the covariates).

By the way (checking now), the R code in stargazer is (still) in two 
files, and is very difficult to read (badly constructed, one file is 6500 
lines long). For spdep fitted objects, it does not use their declared 
class, and continues to ignore the need to report the spatial 
coefficients. Of course, impacts are ignored. As previously reported, 
stargazer should never be used with spdep objects, it is seriously 
misleading.

It is possible that pander will work better, but it doesn't do model 
comparison tables out of the box as far as I can see - you'd need to take 
the relevant parts from the summary object for your fitted model. This 
however is something that can be done readily, as can be done for xtable. 
I usually create a formatted character matrix and output through xtable if 
I need a model comparison table. Look at:

example(NY_data)
esar1f <- spautolm(Z ~ PEXPOSURE + PCTAGE65P + PCTOWNHOME,
  data=nydata, listw=listw_NY, family="SAR", method="eigen")
res <- summary(esar1f)
str(res)

to see what is where, and at the code in spdep:::print.summary.spautolm to 
see how its print method extracts the relevant pieces.

For example:

c(c(res$Coef[,1:2]), unname(res$lambda), res$lambda.se, res$fit$s2, 
res$LL)

gives you four interleaved coefficients and their standard errors, 
\rho_{Err} and its standard error, the model sigma^2 and the model log 
likelihood. The issue in table construction is then slotting the right 
(column) vector elements into the right table rows, because covariates may 
be omitted in some models. Row and column names also need care (a trick 
for the coefficient standard errors is to use increasing numbers of 
spaces). Using a character matrix lets you vary the formatting by row 
(different numbers of digits for model sigma^2 and log likelihood).

The stargazer package tried to be clever and make things easy, which might 
be OK if it did things right, but it doesn't (for spdep objects and by 
extension for others its author doesn't understand), so it should be 
avoided. I tried to get its author to fix it, but because of the way the 
code is written (one large operative file), suggesting patches without 
seeing the workflow clearly remains impossible.

So, work from the summary objects of your fitted models and build a 
matrix for, for example, pander or xtable.

Hope this clarifies,

Roger

On Fri, 25 Nov 2016, Melanie Bacou wrote:

> You could also check into the `pander` package (documented at
> http://rapporter.github.io/pander/#helper-functions).>
> AFAIK there's no helper function to output SAR/CAR or GWR objects
> directly, but you might be able to work with `pander.lm`.
>
> Else maybe submit a request on GitHub
> https://github.com/Rapporter/pander/issues.
>
> --Mel.
>
>
> On 11/25/2016 04:17 PM, Samar Deen wrote:
>> Hi Everyone,
>>
>> I am running some CAR regressions using spautolm. I wanted to generate some
>> summary tables of the regressions using stargazer to output in Latex.
>> While stargazer supports some spdep classes, unfortunately, stargazer does
>> not support  spautolm. Has anyone tried to output CAR model regression
>> results in Latex? Please do let me know if you have come across a
>> supporting package.
>>
>> One alternative will be to convert the spautolm class to a supported
>> class in stargazer. But I haven't had much luck.
>>
>> Any tips will be most helpful.
>>
>> Thank you.
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From sa462 at cornell.edu  Sun Nov 27 22:47:39 2016
From: sa462 at cornell.edu (Samar Deen)
Date: Sun, 27 Nov 2016 16:47:39 -0500
Subject: [R-sig-Geo] Using Stargazer to output spautolm models in Latex
In-Reply-To: <alpine.LFD.2.20.1611260943001.18942@reclus.nhh.no>
References: <CAKY_pX5XWEJWHwBdi=RCUQwP1uR1E=8PTYYhcPTJOrwTii9T4w@mail.gmail.com>
	<d5943a7d-114d-03ee-2198-44d9b547d166@mbacou.com>
	<alpine.LFD.2.20.1611260943001.18942@reclus.nhh.no>
Message-ID: <CAKY_pX7MBKGtM8hASnWWccoX-QYFsRfqah6iFmf3DJZA=qU2xA@mail.gmail.com>

Hi Roger,

Thank you. I used the command,

c(c(res$Coef[,1:2]), unname(res$lambda), res$lambda.se, res$fit$s2, res$LL)

and was able to generate the table using xtable.

Regards,

On Sat, Nov 26, 2016 at 4:36 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> The spdep sarlm stargazer support was seriously broken when introduced,
> and the package author was only interested in advertising the package, and
> unresponsive with regard to necessary fixes.
>
> Writing functions to extract what is needed from the summary objects could
> be done, but is hard to do right. For example, a sarlm object fitted using
> lagsarlm or sacsarlm should never have its covariate coefficients
> displayed, only the three-column impacts from the impacts() method (the
> coefficients are not equal to of a unit increment on a covariate in these
> cases unless \rho_{Lag} = 0 as they would be where the spatial process is
> uncorrelated with the covariates).
>
> By the way (checking now), the R code in stargazer is (still) in two
> files, and is very difficult to read (badly constructed, one file is 6500
> lines long). For spdep fitted objects, it does not use their declared
> class, and continues to ignore the need to report the spatial coefficients.
> Of course, impacts are ignored. As previously reported, stargazer should
> never be used with spdep objects, it is seriously misleading.
>
> It is possible that pander will work better, but it doesn't do model
> comparison tables out of the box as far as I can see - you'd need to take
> the relevant parts from the summary object for your fitted model. This
> however is something that can be done readily, as can be done for xtable. I
> usually create a formatted character matrix and output through xtable if I
> need a model comparison table. Look at:
>
> example(NY_data)
> esar1f <- spautolm(Z ~ PEXPOSURE + PCTAGE65P + PCTOWNHOME,
>  data=nydata, listw=listw_NY, family="SAR", method="eigen")
> res <- summary(esar1f)
> str(res)
>
> to see what is where, and at the code in spdep:::print.summary.spautolm to
> see how its print method extracts the relevant pieces.
>
> For example:
>
> c(c(res$Coef[,1:2]), unname(res$lambda), res$lambda.se, res$fit$s2,
> res$LL)
>
> gives you four interleaved coefficients and their standard errors,
> \rho_{Err} and its standard error, the model sigma^2 and the model log
> likelihood. The issue in table construction is then slotting the right
> (column) vector elements into the right table rows, because covariates may
> be omitted in some models. Row and column names also need care (a trick for
> the coefficient standard errors is to use increasing numbers of spaces).
> Using a character matrix lets you vary the formatting by row (different
> numbers of digits for model sigma^2 and log likelihood).
>
> The stargazer package tried to be clever and make things easy, which might
> be OK if it did things right, but it doesn't (for spdep objects and by
> extension for others its author doesn't understand), so it should be
> avoided. I tried to get its author to fix it, but because of the way the
> code is written (one large operative file), suggesting patches without
> seeing the workflow clearly remains impossible.
>
> So, work from the summary objects of your fitted models and build a matrix
> for, for example, pander or xtable.
>
> Hope this clarifies,
>
> Roger
>
>
> On Fri, 25 Nov 2016, Melanie Bacou wrote:
>
> You could also check into the `pander` package (documented at
>> http://rapporter.github.io/pander/#helper-functions).>
>> AFAIK there's no helper function to output SAR/CAR or GWR objects
>> directly, but you might be able to work with `pander.lm`.
>>
>> Else maybe submit a request on GitHub
>> https://github.com/Rapporter/pander/issues.
>>
>> --Mel.
>>
>>
>> On 11/25/2016 04:17 PM, Samar Deen wrote:
>>
>>> Hi Everyone,
>>>
>>> I am running some CAR regressions using spautolm. I wanted to generate
>>> some
>>> summary tables of the regressions using stargazer to output in Latex.
>>> While stargazer supports some spdep classes, unfortunately, stargazer
>>> does
>>> not support  spautolm. Has anyone tried to output CAR model regression
>>> results in Latex? Please do let me know if you have come across a
>>> supporting package.
>>>
>>> One alternative will be to convert the spautolm class to a supported
>>> class in stargazer. But I haven't had much luck.
>>>
>>> Any tips will be most helpful.
>>>
>>> Thank you.
>>>
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
>



-- 
Samar Deen

Summer Research Fellow,  Atkinson Center for a Sustainable Future
PhD Candidate, Department of Natural Resources, Cornell University
M.P.A. Cornell University, 2011

Phone: +1 607 793 4200
Skype ID: samarnasiruddeen

	[[alternative HTML version deleted]]


From Jin.Li at ga.gov.au  Sun Nov 27 23:45:45 2016
From: Jin.Li at ga.gov.au (Li Jin)
Date: Sun, 27 Nov 2016 22:45:45 +0000
Subject: [R-sig-Geo] Error with loading rJava for spcosa
	[SEC=UNCLASSIFIED]
In-Reply-To: <alpine.LFD.2.20.1611250916050.5571@reclus.nhh.no>
References: <1d4093ff8eb048f39aeb72aa0ac1af9e@win-exch-prod01.prod.lan>
	<alpine.LFD.2.20.1611250916050.5571@reclus.nhh.no>
Message-ID: <c3b89c5c36f64af884aa4cf0dcf2b0f4@win-exch-prod01.prod.lan>

Thank you very much, Roger! The suggestions are very helpful.
Best wishes,
Jin

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Friday, 25 November 2016 7:24 PM
To: Li Jin
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Error with loading rJava for spcosa [SEC=UNCLASSIFIED]

On Thu, 24 Nov 2016, Li Jin wrote:

> Hi All,
>
> I have been using library(spcosa) in R version 3.2.3 (2015-12-10) and all worked well, until today.
>
> The error was as below when I called:
>>  library(spcosa)
> Loading required package: rJava
> Error : .onLoad failed in loadNamespace() for 'rJava', details:
>  call: fun(libname, pkgname)
>  error: JAVA_HOME cannot be determined from the Registry
> Error: package 'rJava' could not be loaded
>
> Although rJava was installed, I reinstalled it, successfully as:
>>   install.packages("rJava")
> --- Please select a CRAN mirror for use in this session --- trying URL 
> 'https://cloud.r-project.org/bin/windows/contrib/3.2/rJava_0.9-8.zip'
> Content type 'application/zip' length 765340 bytes (747 KB) downloaded 
> 747 KB
>
> package 'rJava' successfully unpacked and MD5 sums checked
>
> The downloaded binary packages are in
>        
> C:\Users\u09672\AppData\Local\Temp\1\Rtmp2PslO0\downloaded_packages
>
> But when I called:
>> library(rJava)
> Error in get(Info[i, 1], envir = env) :
>  lazy-load database 'C:/LegacyApps/R-3.2.3/library/rJava/R/rJava.rdb' 
> is corrupt In addition: Warning messages:
> 1: package 'rJava' was built under R version 3.2.5
> 2: In get(Info[i, 1], envir = env) : internal error -3 in 
> R_decompress1
> Error: package or namespace load failed for 'rJava'
>
> When I called:
>>  library(spcosa)
> Loading required package: rJava
> Error in get(Info[i, 1], envir = env) :
>  lazy-load database 'C:/LegacyApps/R-3.2.3/library/rJava/R/rJava.rdb' 
> is corrupt In addition: Warning messages:
> 1: package 'rJava' was built under R version 3.2.5
> 2: In get(Info[i, 1], envir = env) : internal error -3 in 
> R_decompress1
> Error: package 'rJava' could not be loaded
>
> Looks like something is wrong with loading "rJava". The only thing has 
> been changed is that my PC was refreshed recently.

Three possibilities: you may need rJava built for R 3.2.3 - you are warned about the mis-match; the refreshing of your PC may have taken away something the rJava needed when it loaded; and the rJava Windows binary may be corrupted on your mirror - try a different mirror.

Try replacing R 3.2.3 with the current R 3.3.2, and update all your packages (all Windows binary packages for R < 3.3 were built using an older compiler, all for R >= 3.3 with a newer compiler, and they are not mutually compatible if they include compiled code.

Roger

>
> Any suggestions to how to fix this loading problem? Thanks!
>
>
>> sessionInfo()
> R version 3.2.3 (2015-12-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit) Running under: Windows 7 x64 
> (build 7601) Service Pack 1
>
> locale:
> [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252 
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C [5] 
> LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] raster_2.5-8 sp_1.2-3
>
> loaded via a namespace (and not attached):
> [1] tools_3.2.3     Rcpp_0.12.7     grid_3.2.3      lattice_0.20-34
>>
>
> Please note this error persists for:  R version 3.3.1 (2016-06-21)
>
> Kind regards,
> Jin
>
> Jin Li, PhD | Spatial Modeller / Computational Statistician National 
> Earth and Marine Observations | Environmental Geoscience Division
> t:  +61 2 6249 9899
>
> Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.
> ----------------------------------------------------------------------
> ---------------------------------------------------
>
>
> [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.


From maogui.hu at gmail.com  Mon Nov 28 10:18:56 2016
From: maogui.hu at gmail.com (maogui.hu)
Date: Mon, 28 Nov 2016 17:18:56 +0800
Subject: [R-sig-Geo] how to fit 3d variogram in gstat
Message-ID: <2016112817185101551830@gmail.com>

Dear list,
    gstat has a powerful function in 2d and spatial-temporal variogram fitting. I'm wondering how can i fit a 3d automatically? Here is a simple snippet to create a 3d dataset:

library(sp) 
library(gstat) 

data(DE_RB_2005, package = "gstat") 
st <- as.data.frame(DE_RB_2005[,1:100]) 
st <- st[,c(1,2,6,16)] 
names(st) <- c("x", "y", "z", "v") 

st$x <- (st$x - mean(st$x)) / sd(st$x) * 100 
st$y <- (st$y - mean(st$y)) / sd(st$y) * 100 
st$z <- (st$z - mean(st$z)) / sd(st$z) * 100 

coordinates(st) <- ~x+y+z 
v <- variogram(v~1, st)  
print(v)


Thanks very much!
 


Maogui Hu, Ph.D.
State Key Laboratory of Resources and Environmental Information System
Institute of Geographic Sciences and Natural Resources Research, CAS

	[[alternative HTML version deleted]]


From carotenuto_francesco at yahoo.it  Mon Nov 28 10:26:19 2016
From: carotenuto_francesco at yahoo.it (Francesco Carotenuto)
Date: Mon, 28 Nov 2016 09:26:19 +0000 (UTC)
Subject: [R-sig-Geo] Downscaling a raster map
References: <1976914839.2775252.1480325179393.ref@mail.yahoo.com>
Message-ID: <1976914839.2775252.1480325179393@mail.yahoo.com>

Hi everyone,I'm looking for a method to downscale a 250x250 km wide resolution altitudemap of the past (about 3 million years ago) to a finer resolution. I would the spatialstructure of the downscaled map to resemble the actual altitude. Is there a way?Thank you,Francesco.?Dr. Francesco Carotenuto (Ph.D.) Department of Earth Sciences 
Federico II University Largo S. Marcellino 10, 80138 NAPLES (ITALY) 
https://www.researchgate.net/profile/Francesco_Carotenuto
	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Mon Nov 28 10:58:38 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 28 Nov 2016 10:58:38 +0100
Subject: [R-sig-Geo] how to fit 3d variogram in gstat
In-Reply-To: <2016112817185101551830@gmail.com>
References: <2016112817185101551830@gmail.com>
Message-ID: <2c3a0c72-3ee8-49e2-d3f4-7bfb8b9c99a5@uni-muenster.de>



On 28/11/16 10:18, maogui.hu wrote:
> Dear list,
>     gstat has a powerful function in 2d and spatial-temporal variogram fitting. I'm wondering how can i fit a 3d automatically? Here is a simple snippet to create a 3d dataset:
> 

It doesn't; either the problem is not simple enough or we don't
understand it well enough in order to let you do that.

> library(sp) 
> library(gstat) 
> 
> data(DE_RB_2005, package = "gstat") 
> st <- as.data.frame(DE_RB_2005[,1:100]) 
> st <- st[,c(1,2,6,16)] 
> names(st) <- c("x", "y", "z", "v") 
> 
> st$x <- (st$x - mean(st$x)) / sd(st$x) * 100 
> st$y <- (st$y - mean(st$y)) / sd(st$y) * 100 
> st$z <- (st$z - mean(st$z)) / sd(st$z) * 100 
> 
> coordinates(st) <- ~x+y+z 
> v <- variogram(v~1, st)  
> print(v)
> 
> 
> Thanks very much!
>  
> 
> 
> Maogui Hu, Ph.D.
> State Key Laboratory of Resources and Environmental Information System
> Institute of Geographic Sciences and Natural Resources Research, CAS
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161128/e4481cbc/attachment.bin>

From loic.dutrieux at conabio.gob.mx  Mon Nov 28 11:17:14 2016
From: loic.dutrieux at conabio.gob.mx (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Mon, 28 Nov 2016 11:17:14 +0100
Subject: [R-sig-Geo] Downscaling a raster map
In-Reply-To: <1976914839.2775252.1480325179393@mail.yahoo.com>
References: <1976914839.2775252.1480325179393.ref@mail.yahoo.com>
	<1976914839.2775252.1480325179393@mail.yahoo.com>
Message-ID: <24c38fd5-c6db-2672-c5b1-ed9863564238@conabio.gob.mx>


On 28/11/2016 10:26, Francesco Carotenuto via R-sig-Geo wrote:
> Hi everyone,I'm looking for a method to downscale a 250x250 km wide resolution altitudemap of the past (about 3 million years ago) to a finer resolution. I would the spatialstructure of the downscaled map to resemble the actual altitude.

You mean that it should use current elevation data like from e.g. SRTM?
Otherwise you may try disaggregate from the raster package.

Cheers,
Lo?c

Is there a way?Thank you,Francesco. Dr. Francesco Carotenuto (Ph.D.)
Department of Earth Sciences
> Federico II University Largo S. Marcellino 10, 80138 NAPLES (ITALY) 
> https://www.researchgate.net/profile/Francesco_Carotenuto
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From carotenuto_francesco at yahoo.it  Mon Nov 28 12:01:51 2016
From: carotenuto_francesco at yahoo.it (Francesco Carotenuto)
Date: Mon, 28 Nov 2016 11:01:51 +0000 (UTC)
Subject: [R-sig-Geo] Downscaling a raster map
In-Reply-To: <24c38fd5-c6db-2672-c5b1-ed9863564238@conabio.gob.mx>
References: <1976914839.2775252.1480325179393.ref@mail.yahoo.com>
	<1976914839.2775252.1480325179393@mail.yahoo.com>
	<24c38fd5-c6db-2672-c5b1-ed9863564238@conabio.gob.mx>
Message-ID: <54775109.2862331.1480330911306@mail.yahoo.com>

Hi Lo?c,?disaggregate?or ?resample? functions of ?raster? package use bilinear or nbg interpolation toreconstruct values in the new cells. I would apply to the nearby-reconstructedcells the same relationship found in the actual altitudinal map at the samelocation.I hope Iexplained it well.?Dr. Francesco Carotenuto (Ph.D.)
Department of Earth Sciences Federico II University Largo S. Marcellino 10, 80138 NAPLES (ITALY)
https://www.researchgate.net/profile/Francesco_Carotenuto 

    Il Luned? 28 Novembre 2016 11:18, Lo?c Dutrieux <loic.dutrieux at conabio.gob.mx> ha scritto:
 

 
On 28/11/2016 10:26, Francesco Carotenuto via R-sig-Geo wrote:
> Hi everyone,I'm looking for a method to downscale a 250x250 km wide resolution altitudemap of the past (about 3 million years ago) to a finer resolution. I would the spatialstructure of the downscaled map to resemble the actual altitude.

You mean that it should use current elevation data like from e.g. SRTM?
Otherwise you may try disaggregate from the raster package.

Cheers,
Lo?c

Is there a way?Thank you,Francesco. Dr. Francesco Carotenuto (Ph.D.)
Department of Earth Sciences
> Federico II University Largo S. Marcellino 10, 80138 NAPLES (ITALY) 
> https://www.researchgate.net/profile/Francesco_Carotenuto
> ??? [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

   
	[[alternative HTML version deleted]]


From carotenuto_francesco at yahoo.it  Mon Nov 28 14:06:36 2016
From: carotenuto_francesco at yahoo.it (Francesco Carotenuto)
Date: Mon, 28 Nov 2016 13:06:36 +0000 (UTC)
Subject: [R-sig-Geo] Downscaling a raster map
In-Reply-To: <54775109.2862331.1480330911306@mail.yahoo.com>
References: <1976914839.2775252.1480325179393.ref@mail.yahoo.com>
	<1976914839.2775252.1480325179393@mail.yahoo.com>
	<24c38fd5-c6db-2672-c5b1-ed9863564238@conabio.gob.mx>
	<54775109.2862331.1480330911306@mail.yahoo.com>
Message-ID: <1156588192.3081453.1480338396894@mail.yahoo.com>

A good solution could be using regression kriging with current altitude map as covariate.
?Dr. Francesco Carotenuto (Ph.D.)
Department of Earth Sciences Federico II University Largo S. Marcellino 10, 80138 NAPLES (ITALY)
https://www.researchgate.net/profile/Francesco_Carotenuto 

    Il Luned? 28 Novembre 2016 12:08, Francesco Carotenuto via R-sig-Geo <r-sig-geo at r-project.org> ha scritto:
 

 Hi Lo?c,?disaggregate?or ?resample? functions of ?raster? package use bilinear or nbg interpolation toreconstruct values in the new cells. I would apply to the nearby-reconstructedcells the same relationship found in the actual altitudinal map at the samelocation.I hope Iexplained it well.?Dr. Francesco Carotenuto (Ph.D.)
Department of Earth Sciences Federico II University Largo S. Marcellino 10, 80138 NAPLES (ITALY)
https://www.researchgate.net/profile/Francesco_Carotenuto 

? ? Il Luned? 28 Novembre 2016 11:18, Lo?c Dutrieux <loic.dutrieux at conabio.gob.mx> ha scritto:
 

 
On 28/11/2016 10:26, Francesco Carotenuto via R-sig-Geo wrote:
> Hi everyone,I'm looking for a method to downscale a 250x250 km wide resolution altitudemap of the past (about 3 million years ago) to a finer resolution. I would the spatialstructure of the downscaled map to resemble the actual altitude.

You mean that it should use current elevation data like from e.g. SRTM?
Otherwise you may try disaggregate from the raster package.

Cheers,
Lo?c

Is there a way?Thank you,Francesco. Dr. Francesco Carotenuto (Ph.D.)
Department of Earth Sciences
> Federico II University Largo S. Marcellino 10, 80138 NAPLES (ITALY) 
> https://www.researchgate.net/profile/Francesco_Carotenuto
> ??? [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

? 
??? [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

   
	[[alternative HTML version deleted]]


From martazores at gmail.com  Mon Nov 28 19:05:23 2016
From: martazores at gmail.com (marta azores)
Date: Mon, 28 Nov 2016 17:05:23 -0100
Subject: [R-sig-Geo]
	Error-message-when-trying-to-compute-the-least-cost-path-in-gdistance-in-R
Message-ID: <CAE3WKgQkdRZszeBjzdeXk8_vx144Ak3rewKH_sLMpjLVDpStYA@mail.gmail.com>

http://r-sig-geo.2731867.n2.nabble.com/Error-message-when-trying-to-compute-the-least-cost-path-in-gdistance-in-R-tt7590273.html

Hi everyone,

I have a similar problem. I have two points that I want to join in one line
"SpatialLines"

class(trCost)#"TransitionLayer"+attr gdistance
summary(trCost)#1560 x 1560 sparse Matrix of class "dsCMatrix", with 8
entries

pts1<-cbind(x=-27.54572,y=38.30128)

pts2<-cbind(x=-28.59933,y=37.32453)
#
class(pts1)#matrix
class(pts2)#matrix
#
is.numeric(pts1)#[1] TRUE

plot(shortestPath(trCost, pts[1,], pts[2,], output="SpatialLines"),
add=TRUE)
Error in if (is.numeric(v) && any(v < 0)) { :
  missing value where TRUE/FALSE needed

Thanks in advance

Marta

	[[alternative HTML version deleted]]


From milujisb at gmail.com  Tue Nov 29 11:54:41 2016
From: milujisb at gmail.com (Miluji Sb)
Date: Tue, 29 Nov 2016 11:54:41 +0100
Subject: [R-sig-Geo] Convert arc-second to degree
Message-ID: <CAMLwc7M31Z2SpnHnWYBPB24Ym6b=cNv_wuLpzpbDO-Xp6MMFug@mail.gmail.com>

Dear all,

I am using the Gridded Population of the World (v4) for the year 2010. The
data is in GeoTiFF format.

Source:
http://sedac.ciesin.columbia.edu/data/set/gpw-v4-population-count-adjusted-to-2015-unwpp-country-totals/data-download

I imported the data using:

library(raster)
library(maptools)
library(ncdf4)
library(rgdal)

population <-
raster("gpw-v4-population-count-adjusted-to-2015-unwpp-country-totals_2010.tif")
population1 <- stack(population )
extent(population1 ) <- c(-180, 180,-58,85)

### Information
class       : RasterStack
dimensions  : 17400, 43200, 751680000, 1  (nrow, ncol, ncell, nlayers)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : -180, 180, -60, 85  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
+towgs84=0,0,0
names       :
gpw.v4.population.count.adjusted.to.2015.unwpp.country.totals_2010
min values  :
   0
max values  :
141715.3
###

I need to extract population by a set of coordinates which are at 1? x 1?,
how can I convert from arc-second to degree in R? The information also
shows that resolution is 0.008333333? x 0.008333333?, is it enough to do
something like this?

pop_agg <- aggregate(population1 , fact=120, fun=sum)

Thank you very much.

Sincerely,

Milu

	[[alternative HTML version deleted]]


From chris.lusk at waikato.ac.nz  Wed Nov 30 01:40:26 2016
From: chris.lusk at waikato.ac.nz (Chris Lusk)
Date: Wed, 30 Nov 2016 13:40:26 +1300
Subject: [R-sig-Geo] centering map on Pacific Basin instead of Greenwich
Message-ID: <CABqyKttXVeDcuGpAu2jcRiK_UvtTeBRP69snwkXBgr-8UH24jw@mail.gmail.com>

Hello all

I'm making a global map of average leaf size in forests, using different
colours to show dominance of different leaf size classes. The world map is
of course centred on Greenwich (longitude zero) but none of my data are
from Europe or Africa, so a map centred on the Pacific basin would look
much better. In fact I'd like to cut Europe and Africa right out of the map
(nothing personal about this!).

Online I've seen several suggestions for re-centering the map, but they
haven't worked for me. I would really appreciate suggestions about how to
achieve this.

My map code is pasted in below, and the data can be downloaded at
http://sci.waikato.ac.nz/sites/clusk/DivrepNZ.csv

cheers

Chris
............

library(maps)
library(mapdata)
library(maptools)

###Get world map and fill landmasses to hide national borders
map("worldHires", xlim=c(-165,180),ylim=c(-60,70),lty=1, col="gainsboro",
fill=TRUE, border="gainsboro")

###Show axes with horizontal tick labels
map.axes(cex.axis=0.75, las=1)

###Make axis titles
title(xlab = "Longitude (degrees E)", ylab="Latitude (degrees S)")
##Get site location data to plot

Data = read.csv("DivrepNZ.csv")

Mesophyll = subset (Data, Size == "Mesophyll", select = c("Size", "ID",
"lon", "lat"))
Notophyll = subset (Data, Size == "Notophyll", select = c("Size", "ID",
"lon", "lat"))
Microphyll = subset (Data, Size == "Microphyll", select = c("Size", "ID",
"lon", "lat"))
Nanophyll = subset (Data, Size == "Nanophyll", select = c("Size", "ID",
"lon", "lat"))

points(Mesophyll[,"lon"], Mesophyll[,"lat"],pch=15, cex=0.6, col="red3")
points(Notophyll[,"lon"], Notophyll[,"lat"], pch=15, cex=0.6, col="orange")
points(Microphyll[,"lon"], Microphyll[,"lat"], pch=15, cex=0.6,
col="green3")
points(Nanophyll[,"lon"], Nanophyll[,"lat"], pch=15, cex=0.6, col="blue")




*- - - - - - -*Chris Lusk
Environmental Research Institute
University of Waikato
Hamilton
New Zealand
Senior Editor, *New Zealand Journal of Botany*

	[[alternative HTML version deleted]]


From englishchristophera at gmail.com  Wed Nov 30 03:32:04 2016
From: englishchristophera at gmail.com (chris english)
Date: Tue, 29 Nov 2016 21:32:04 -0500
Subject: [R-sig-Geo]
	Error-message-when-trying-to-compute-the-least-cost-path-in-gdistance-in-R
In-Reply-To: <CAE3WKgQkdRZszeBjzdeXk8_vx144Ak3rewKH_sLMpjLVDpStYA@mail.gmail.com>
References: <CAE3WKgQkdRZszeBjzdeXk8_vx144Ak3rewKH_sLMpjLVDpStYA@mail.gmail.com>
Message-ID: <CAASFQpSc12-t0a_dcO+y2y_btQNKD6KScYmVP1gCp2uh5rnBCA@mail.gmail.com>

Marta,

I don't know what constructed your trCost (1560 x 1560 sparse Matrix of
class "dsCMatrix") which I take to be symmetric of
8 directions.

> r <- raster(nrows = 1560, ncols = 1560)
> r <- setValues(r, runif(ncell(r)))
> trCost <- transition(r, transitionFunction = mean, directions = 8)

All I can find to the moment is a little problem of naming in the
shortestPath function call

i.e. pts1 and pts2 are matrix objects (like coordinates), presumably to be
start and goal.

and if they are written as:

plot(shortestPath(trCost, pts1[1,], pts2[1,], output="SpatialLines"))
you get a plot
# without add=TRUE in my case as
# with add=TRUE it reminds me I haven't called plot yet hence nothing to
add to:
Error in plot.xy(xy.coords(x, y), type = type, ...) :
  plot.new has not been called yet


rather than:

plot(shortestPath(trCost, pts[1,], pts[2,], output="SpatialLines"))
which gives this error:

Error in shortestPath(tr, pts[1, ], pts[2, ], output = "SpatialLines") :
  object 'pts' not found


So I imagine that isn't what you had in your call


the Error, generally otherwise would point to NA(s) in the matrix (trCost).
Well. I'm guessing.

HTH,

Chris


On Mon, Nov 28, 2016 at 1:05 PM, marta azores <martazores at gmail.com> wrote:

> http://r-sig-geo.2731867.n2.nabble.com/Error-message-when-
> trying-to-compute-the-least-cost-path-in-gdistance-in-R-tt7590273.html
>
> Hi everyone,
>
> I have a similar problem. I have two points that I want to join in one line
> "SpatialLines"
>
> class(trCost)#"TransitionLayer"+attr gdistance
> summary(trCost)#1560 x 1560 sparse Matrix of class "dsCMatrix", with 8
> entries
>
> pts1<-cbind(x=-27.54572,y=38.30128)
>
> pts2<-cbind(x=-28.59933,y=37.32453)
> #
> class(pts1)#matrix
> class(pts2)#matrix
> #
> is.numeric(pts1)#[1] TRUE
>
> plot(shortestPath(trCost, pts[1,], pts[2,], output="SpatialLines"),
> add=TRUE)
> Error in if (is.numeric(v) && any(v < 0)) { :
>   missing value where TRUE/FALSE needed
>
> Thanks in advance
>
> Marta
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Wed Nov 30 10:06:31 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 30 Nov 2016 10:06:31 +0100
Subject: [R-sig-Geo] centering map on Pacific Basin instead of Greenwich
In-Reply-To: <CABqyKttXVeDcuGpAu2jcRiK_UvtTeBRP69snwkXBgr-8UH24jw@mail.gmail.com>
References: <CABqyKttXVeDcuGpAu2jcRiK_UvtTeBRP69snwkXBgr-8UH24jw@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1611300950020.15946@reclus.nhh.no>

On Wed, 30 Nov 2016, Chris Lusk wrote:

> Hello all
>
> I'm making a global map of average leaf size in forests, using different
> colours to show dominance of different leaf size classes. The world map is
> of course centred on Greenwich (longitude zero) but none of my data are
> from Europe or Africa, so a map centred on the Pacific basin would look
> much better. In fact I'd like to cut Europe and Africa right out of the map
> (nothing personal about this!).
>
> Online I've seen several suggestions for re-centering the map, but they
> haven't worked for me. I would really appreciate suggestions about how to
> achieve this.

mapdata comes with world2Hires, which is Pacific centred. However, the 
polygons are not split at 0, so wrap around if you need to fill. I think 
your xlim= values are incorrect too, I get a Pacific basin from:

map("world2Hires", xlim=c(135, 290), ylim=c(-60,70), lty=1,
  interior=FALSE)

but as lines not filled polygons.

Roger

>
> My map code is pasted in below, and the data can be downloaded at
> http://sci.waikato.ac.nz/sites/clusk/DivrepNZ.csv
>
> cheers
>
> Chris
> ............
>
> library(maps)
> library(mapdata)
> library(maptools)
>
> ###Get world map and fill landmasses to hide national borders
> map("worldHires", xlim=c(-165,180),ylim=c(-60,70),lty=1, col="gainsboro",
> fill=TRUE, border="gainsboro")
>
> ###Show axes with horizontal tick labels
> map.axes(cex.axis=0.75, las=1)
>
> ###Make axis titles
> title(xlab = "Longitude (degrees E)", ylab="Latitude (degrees S)")
> ##Get site location data to plot
>
> Data = read.csv("DivrepNZ.csv")
>
> Mesophyll = subset (Data, Size == "Mesophyll", select = c("Size", "ID",
> "lon", "lat"))
> Notophyll = subset (Data, Size == "Notophyll", select = c("Size", "ID",
> "lon", "lat"))
> Microphyll = subset (Data, Size == "Microphyll", select = c("Size", "ID",
> "lon", "lat"))
> Nanophyll = subset (Data, Size == "Nanophyll", select = c("Size", "ID",
> "lon", "lat"))
>
> points(Mesophyll[,"lon"], Mesophyll[,"lat"],pch=15, cex=0.6, col="red3")
> points(Notophyll[,"lon"], Notophyll[,"lat"], pch=15, cex=0.6, col="orange")
> points(Microphyll[,"lon"], Microphyll[,"lat"], pch=15, cex=0.6,
> col="green3")
> points(Nanophyll[,"lon"], Nanophyll[,"lat"], pch=15, cex=0.6, col="blue")
>
>
>
>
> *- - - - - - -*Chris Lusk
> Environmental Research Institute
> University of Waikato
> Hamilton
> New Zealand
> Senior Editor, *New Zealand Journal of Botany*
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From Ded.V at seznam.cz  Wed Nov 30 11:09:24 2016
From: Ded.V at seznam.cz (Vilem Ded)
Date: Wed, 30 Nov 2016 11:09:24 +0100 (CET)
Subject: [R-sig-Geo] =?utf-8?q?PostGIS_layer_to_R_using_OGR_driver_imports?=
	=?utf-8?q?_unwanted_raster_column_as_String?=
Message-ID: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>

Hi, 
right to the point. I? am trying to load?spatial layer from postgis database to R:

obj <- rgdal::readOGR(dsn="PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer = "SCHEMA.TABLE(LAYER)")

My table contains more spatial  columns/layers, these are not loaded from database. Thats OK. The only  think is the raster layer, which is not excluded and it is imported to?obj at data?dataframe as String column. Quite annoying thing in case of big rasters which I dont even want to be loaded. rgdal:ogrInfo() report this column as String, so no surprise that it is loaded as such.

I have tried to export layer using ogr2ogr with command:
ogr2ogr -f "ESRI Shapefile" abc.shp PG:"dbname=DB host=HOST user=USER password=PSSWD port=5432" "SHEMA.TABLE(SPATIAL_COLUMN)"

The raster column was still there, but the String was much shorter - 254 (obviously it was converted/cut to type character(254)). 

Is this an issue? Because it's seems to me like one.

Thank you
Dead Vil


output of? rgdal::ogrInfo():
Source: "PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer: "schema.laketable(lt_shoreline_pol)"
Driver: PostgreSQL; number of rows: 2 
Feature type: wkbPolygon with 2 dimensions
Extent: (403229.3 5598032) - (427369.2 5612437)
CRS: +proj=utm +zone=33 +datum=WGS84 +units=m +no_defs  
Number of fields: 3 
          name type length typeName
1      lt_lake    4     40   String
2 lt_elevation    2      0     Real
3 lt_depthrast    4      0   String

output of sessionInfo():
R version 3.2.4 Revised (2016-03-16 r70336)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Debian GNU/Linux 8 (jessie)
locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] data.table_1.9.7 vegan_2.4-1      lattice_0.20-33  permute_0.9-4    wkb_0.3-0        lubridate_1.5.6  RODBC_1.3-13    
 [8] geosphere_1.5-5  raster_2.5-8     rgeos_0.3-19     rgdal_1.1-10     sp_1.2-3        

loaded via a namespace (and not attached):
 [1] Rcpp_0.12.4    MASS_7.3-45    grid_3.2.4     nlme_3.1-128   magrittr_1.5   stringi_1.0-1  Matrix_1.2-4   tools_3.2.4   
 [9] stringr_1.0.0  parallel_3.2.4 cluster_2.0.3  mgcv_1.8-12 





From Roger.Bivand at nhh.no  Wed Nov 30 12:53:24 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 30 Nov 2016 11:53:24 +0000
Subject: [R-sig-Geo] PostGIS layer to R using OGR driver imports
 unwanted raster column as String
In-Reply-To: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
References: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
Message-ID: <4F58C8D16A2DF6F4.b050fa7c-0295-4ff8-ab5c-9d4a699efe1f@mail.outlook.com>

Briefly, could you add a copy of the startup messages when rgdal is attached, and the version of gdal shown by gdal-config --version? Maybe gdal2 would do better if you are on gdal1?

Roger

Roger Bivand
Norwegian School of Economics
Bergen, Norway

Fra: Vilem Ded
Sendt: onsdag 30. november, 11.11
Emne: [R-sig-Geo] PostGIS layer to R using OGR driver imports unwanted raster column as String
Til: Help R-Sig_Geo

Hi, right to the point. I  am trying to load spatial layer from postgis database to R: obj

	[[alternative HTML version deleted]]


From Ded.V at seznam.cz  Wed Nov 30 14:56:03 2016
From: Ded.V at seznam.cz (Vilem Ded)
Date: Wed, 30 Nov 2016 14:56:03 +0100 (CET)
Subject: [R-sig-Geo]
	=?utf-8?q?PostGIS_layer_to_R_using_OGR_driver_imports?=
	=?utf-8?q?_unwanted_raster_column_as_String?=
References: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
	<4F58C8D16A2DF6F4.b050fa7c-0295-4ff8-ab5c-9d4a699efe1f@mail.outlook.com>
Message-ID: <Fgc.AnNM.6Odi8GU{dPt.1OFjfp@seznam.cz>

Hi,
thx for idea. When rgdal is attached:

Loading required package: sp
rgdal: version: 1.1-10, (SVN revision 622)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26
 Path to GDAL shared files: /usr/share/gdal/1.10
 Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-3

gdal-config --version  really showed version 1, so I have installed gdal2 from source.

Now the rgdal attaching gives me:

Loading required package: sp
rgdal: version: 1.2-4, (SVN revision 643)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.1.2, released 2016/10/24
 Path to GDAL shared files: /usr/local/share/gdal
 Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-3 

readOGR throws an error when running the same command as before:

obj <- rgdal::readOGR(dsn="PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer = "SCHEMA.TABLE(LAYER)")
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv,  : 
  Layer not found

And now ,as expected from error, function ogrInfo() works differently. It throws the same error and work only without specification of LAYER (e.g. layer = "SCHEMA.TABLE")

Some more ideas? Thank you.





---------- P?vodn? zpr?va ----------
Od: Roger Bivand 
Komu: Roger Bivand , Vilem Ded , Help
 R-Sig_Geo 
Datum: 30. 11. 2016 12:53:32
P?edm?t: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports
 unwanted raster column as String



Briefly, could you add a copy of the startup messages when rgdal is attached, and the version of gdal shown by gdal-config --version? Maybe gdal2 would do better if you are on gdal1?


Roger


Roger Bivand

Norwegian School of Economics

Bergen, Norway




Fra: Vilem Ded

Sendt: onsdag 30. november, 11.11

Emne: [R-sig-Geo] PostGIS layer to R using OGR driver imports unwanted raster column as String

Til: Help R-Sig_Geo


Hi, right to the point. I? am trying to load?spatial layer from postgis database to R: obj





From Roger.Bivand at nhh.no  Wed Nov 30 15:01:54 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 30 Nov 2016 14:01:54 +0000
Subject: [R-sig-Geo] PostGIS layer to R using OGR driver imports
 unwanted raster column as String
In-Reply-To: <Fgc.AnNM.6Odi8GU{dPt.1OFjfp@seznam.cz>
References: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
	<4F58C8D16A2DF6F4.b050fa7c-0295-4ff8-ab5c-9d4a699efe1f@mail.outlook.com>,
	<Fgc.AnNM.6Odi8GU{dPt.1OFjfp@seznam.cz>
Message-ID: <E953A98FD6EAA7479A68EE8C24491F6B80DC00AD@COLON.valuta.nhh.no>

OK, what does ogr2ogr do in GDAL2? I do not have any experience of the driver you are using, so others will have to try to repicate - do you have a reproducible case? What does rgdal::ogrListLayers() say?

Roger
--
Roger Bivand
Norwegian School of Economics
Helleveien 30, 5045 Bergen, Norway
Roger.Bivand at nhh.no


________________________________________
Fra: Vilem Ded [Ded.V at seznam.cz]
Sendt: 30. november 2016 2:56
Til: Roger Bivand
Kopi: R-Sig_Geo"
Emne: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports  unwanted raster column as String

Hi,
thx for idea. When rgdal is attached:

Loading required package: sp
rgdal: version: 1.1-10, (SVN revision 622)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 1.10.1, released 2013/08/26
 Path to GDAL shared files: /usr/share/gdal/1.10
 Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-3

gdal-config --version  really showed version 1, so I have installed gdal2 from source.

Now the rgdal attaching gives me:

Loading required package: sp
rgdal: version: 1.2-4, (SVN revision 643)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.1.2, released 2016/10/24
 Path to GDAL shared files: /usr/local/share/gdal
 Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-3

readOGR throws an error when running the same command as before:

obj <- rgdal::readOGR(dsn="PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer = "SCHEMA.TABLE(LAYER)")
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv,  :
  Layer not found

And now ,as expected from error, function ogrInfo() works differently. It throws the same error and work only without specification of LAYER (e.g. layer = "SCHEMA.TABLE")

Some more ideas? Thank you.





---------- P?vodn? zpr?va ----------
Od: Roger Bivand
Komu: Roger Bivand , Vilem Ded , Help
 R-Sig_Geo
Datum: 30. 11. 2016 12:53:32
P?edm?t: Re: [R-sig-Geo] PostGIS layer to R using OGR driver imports
 unwanted raster column as String



Briefly, could you add a copy of the startup messages when rgdal is attached, and the version of gdal shown by gdal-config --version? Maybe gdal2 would do better if you are on gdal1?


Roger


Roger Bivand

Norwegian School of Economics

Bergen, Norway




Fra: Vilem Ded

Sendt: onsdag 30. november, 11.11

Emne: [R-sig-Geo] PostGIS layer to R using OGR driver imports unwanted raster column as String

Til: Help R-Sig_Geo


Hi, right to the point. I  am trying to load spatial layer from postgis database to R: obj





From basille.web at ase-research.org  Wed Nov 30 15:56:20 2016
From: basille.web at ase-research.org (Mathieu Basille)
Date: Wed, 30 Nov 2016 09:56:20 -0500
Subject: [R-sig-Geo] PostGIS layer to R using OGR driver imports
 unwanted raster column as String
In-Reply-To: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
References: <F5p.AnNQ.4R{JCeUqd4P.1OFgLK@seznam.cz>
Message-ID: <591a7832-2819-10f6-b8b5-bb87ccedebe0@ase-research.org>

Hey Vil,

I know it doesn't answer the problem of using rgdal to load PostGIS layers
(especially rasters), but have you tried to use rpostgis::pgGetRast to load
rasters in R? Might not be the most computer efficient, but should get you
there...

Mathieu.


On 11/30/2016 05:09 AM, Vilem Ded wrote:
> Hi, 
> right to the point. I  am trying to load spatial layer from postgis database to R:
> 
> obj <- rgdal::readOGR(dsn="PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer = "SCHEMA.TABLE(LAYER)")
> 
> My table contains more spatial  columns/layers, these are not loaded from database. Thats OK. The only  think is the raster layer, which is not excluded and it is imported to obj at data dataframe as String column. Quite annoying thing in case of big rasters which I dont even want to be loaded. rgdal:ogrInfo() report this column as String, so no surprise that it is loaded as such.
> 
> I have tried to export layer using ogr2ogr with command:
> ogr2ogr -f "ESRI Shapefile" abc.shp PG:"dbname=DB host=HOST user=USER password=PSSWD port=5432" "SHEMA.TABLE(SPATIAL_COLUMN)"
> 
> The raster column was still there, but the String was much shorter - 254 (obviously it was converted/cut to type character(254)). 
> 
> Is this an issue? Because it's seems to me like one.
> 
> Thank you
> Dead Vil
> 
> 
> output of  rgdal::ogrInfo():
> Source: "PG:dbname=DB host=HOST user=USER password=PSSWD port=5432", layer: "schema.laketable(lt_shoreline_pol)"
> Driver: PostgreSQL; number of rows: 2 
> Feature type: wkbPolygon with 2 dimensions
> Extent: (403229.3 5598032) - (427369.2 5612437)
> CRS: +proj=utm +zone=33 +datum=WGS84 +units=m +no_defs  
> Number of fields: 3 
>           name type length typeName
> 1      lt_lake    4     40   String
> 2 lt_elevation    2      0     Real
> 3 lt_depthrast    4      0   String
> 
> output of sessionInfo():
> R version 3.2.4 Revised (2016-03-16 r70336)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Debian GNU/Linux 8 (jessie)
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                 
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base     
> 
> other attached packages:
>  [1] data.table_1.9.7 vegan_2.4-1      lattice_0.20-33  permute_0.9-4    wkb_0.3-0        lubridate_1.5.6  RODBC_1.3-13    
>  [8] geosphere_1.5-5  raster_2.5-8     rgeos_0.3-19     rgdal_1.1-10     sp_1.2-3        
> 
> loaded via a namespace (and not attached):
>  [1] Rcpp_0.12.4    MASS_7.3-45    grid_3.2.4     nlme_3.1-128   magrittr_1.5   stringi_1.0-1  Matrix_1.2-4   tools_3.2.4   
>  [9] stringr_1.0.0  parallel_3.2.4 cluster_2.0.3  mgcv_1.8-12 
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 

Mathieu Basille

basille at ufl.edu | http://ase-research.org/basille
+1 954-577-6314 | University of Florida FLREC

  ? Le tout est de tout dire, et je manque de mots
  Et je manque de temps, et je manque d'audace. ?
  ? Paul ?luard

This message is signed to guarantee its authenticity.
For a true private correspondence, use my public key
to encrypt your messages:

  http://mathieu.basille.net/pub.asc

Learn more: http://mzl.la/1BsOGiZ

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20161130/280ecb59/attachment.bin>

From chris.lusk at waikato.ac.nz  Wed Nov 30 22:22:53 2016
From: chris.lusk at waikato.ac.nz (Chris Lusk)
Date: Thu, 1 Dec 2016 10:22:53 +1300
Subject: [R-sig-Geo] centering map on Pacific Basin instead of Greenwich
In-Reply-To: <alpine.LFD.2.20.1611300950020.15946@reclus.nhh.no>
References: <CABqyKttXVeDcuGpAu2jcRiK_UvtTeBRP69snwkXBgr-8UH24jw@mail.gmail.com>
	<alpine.LFD.2.20.1611300950020.15946@reclus.nhh.no>
Message-ID: <CABqyKttUy4RfAU1g8hocgb4aSQdwHe5Lt4UYd=h1AopOY6+Gmw@mail.gmail.com>

Thanks Roger! After I transform all longitudes to positive values, your
solution works nicely.

Chris


*- - - - - - -*Chris Lusk
Environmental Research Institute
University of Waikato
Hamilton
New Zealand
Senior Editor, *New Zealand Journal of Botany*



On Wed, Nov 30, 2016 at 10:06 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Wed, 30 Nov 2016, Chris Lusk wrote:
>
> Hello all
>>
>> I'm making a global map of average leaf size in forests, using different
>> colours to show dominance of different leaf size classes. The world map is
>> of course centred on Greenwich (longitude zero) but none of my data are
>> from Europe or Africa, so a map centred on the Pacific basin would look
>> much better. In fact I'd like to cut Europe and Africa right out of the
>> map
>> (nothing personal about this!).
>>
>> Online I've seen several suggestions for re-centering the map, but they
>> haven't worked for me. I would really appreciate suggestions about how to
>> achieve this.
>>
>
> mapdata comes with world2Hires, which is Pacific centred. However, the
> polygons are not split at 0, so wrap around if you need to fill. I think
> your xlim= values are incorrect too, I get a Pacific basin from:
>
> map("world2Hires", xlim=c(135, 290), ylim=c(-60,70), lty=1,
>  interior=FALSE)
>
> but as lines not filled polygons.
>
> Roger
>
>
>> My map code is pasted in below, and the data can be downloaded at
>> http://sci.waikato.ac.nz/sites/clusk/DivrepNZ.csv
>>
>> cheers
>>
>> Chris
>> ............
>>
>> library(maps)
>> library(mapdata)
>> library(maptools)
>>
>> ###Get world map and fill landmasses to hide national borders
>> map("worldHires", xlim=c(-165,180),ylim=c(-60,70),lty=1, col="gainsboro",
>> fill=TRUE, border="gainsboro")
>>
>> ###Show axes with horizontal tick labels
>> map.axes(cex.axis=0.75, las=1)
>>
>> ###Make axis titles
>> title(xlab = "Longitude (degrees E)", ylab="Latitude (degrees S)")
>> ##Get site location data to plot
>>
>> Data = read.csv("DivrepNZ.csv")
>>
>> Mesophyll = subset (Data, Size == "Mesophyll", select = c("Size", "ID",
>> "lon", "lat"))
>> Notophyll = subset (Data, Size == "Notophyll", select = c("Size", "ID",
>> "lon", "lat"))
>> Microphyll = subset (Data, Size == "Microphyll", select = c("Size", "ID",
>> "lon", "lat"))
>> Nanophyll = subset (Data, Size == "Nanophyll", select = c("Size", "ID",
>> "lon", "lat"))
>>
>> points(Mesophyll[,"lon"], Mesophyll[,"lat"],pch=15, cex=0.6, col="red3")
>> points(Notophyll[,"lon"], Notophyll[,"lat"], pch=15, cex=0.6,
>> col="orange")
>> points(Microphyll[,"lon"], Microphyll[,"lat"], pch=15, cex=0.6,
>> col="green3")
>> points(Nanophyll[,"lon"], Nanophyll[,"lat"], pch=15, cex=0.6, col="blue")
>>
>>
>>
>>
>> *- - - - - - -*Chris Lusk
>> Environmental Research Institute
>> University of Waikato
>> Hamilton
>> New Zealand
>> Senior Editor, *New Zealand Journal of Botany*
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
>

	[[alternative HTML version deleted]]


