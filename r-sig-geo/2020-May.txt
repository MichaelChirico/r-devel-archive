From @ndremm@rque@ @end|ng |rom y@hoo@com@br  Sat May  2 15:36:09 2020
From: @ndremm@rque@ @end|ng |rom y@hoo@com@br (=?UTF-8?Q?Andr=C3=A9_M=2E_Marques?=)
Date: Sat, 2 May 2020 13:36:09 +0000 (UTC)
Subject: [R-sig-Geo] Help to calculate the impacts using the spreg function
 in sphet package: GMM/IV with one endogenous and one instrument
References: <2013549914.154898.1588426569526.ref@mail.yahoo.com>
Message-ID: <2013549914.154898.1588426569526@mail.yahoo.com>

Dear all,
# I am facing the following problem in calculating the impacts and their significance based on 'impacts' function in# {spatialreg} package:# I have one endogenous (HOVAL) and one instrument (PLUMB) ## endo=~HOVAL ; instruments=~PLUMB
# How can I calculate the impact measures and their significance based on GMM/IV of 'spreg ( )' function in sphet package# when I have one endogenous and one instrument?
# My reproducible example:require("sf", quietly=TRUE)library(sphet)library(spatialreg)
columbus <- st_read(system.file("shapes/columbus.shp", package="spData")[1], quiet=TRUE)require("spdep", quietly=TRUE)col.gal.nb <- spdep::read.gal(system.file("weights/columbus.gal", package="spData")[1])listw <- spdep::nb2listw(col.gal.nb)
# I have one endongenous (HOVAL) and one instrument (PLUMB) ## endo=~HOVAL ; instruments=~PLUMB #?res.spreg <- spreg(CRIME ~ INC + OPEN, columbus, listw,? ? ? ? ? ? ? ? ? ?endo=~HOVAL,lag.instr = TRUE,instruments=~PLUMB,? ? ? ? ? ? ? ? ? ?model=c('ivhac'),het=TRUE,HAC=FALSE)class(res.spreg)#[1] "sphet"? "gstsls"summary(res.spreg)
######################################################################################### Now the problem: I'm unable to calculate the impacts in a (cross-section) Cliff-Ord model based on GMM/IV #########################################################################################
W <- as(listw, "CsparseMatrix")trMatc <- trW(W, type="mult")trMC <- trW(W, type="MC")
set.seed(1234)impacts(res.spreg, listw=listw)
# I get the error message:Error in spatialreg::intImpacts(rho = rho, beta = beta, P = P, n = n,? :?? argumento "evalues" ausente, sem padr?oAl?m disso: Warning message:Function intImpacts moved to the spatialreg package?

# or even:library(coda)lobjIQ5 <- impacts(res.spreg, tr=trMatc, R=200, Q=5)summary(lobjIQ5, zstats=TRUE, short=TRUE)
# When I use the 'evalues' argument as the vector of eigenvalues of spatial weights matrix:
ev <- eigenw(listw)impacts(res.spreg, evalues=ev)
# I get the error:
Error in spatialreg::intImpacts(rho = rho, beta = beta, P = P, n = n,? :?? argumento "evalues" ausente, sem padr?o


Thanks for some help,
Best wishes,

Andr? M. MarquesFederal University of Paraiba
Department of EconomicsGraduate Program of Economics



	[[alternative HTML version deleted]]


From @ndremm@rque@ @end|ng |rom y@hoo@com@br  Sat May  2 18:43:13 2020
From: @ndremm@rque@ @end|ng |rom y@hoo@com@br (=?UTF-8?Q?Andr=C3=A9_M=2E_Marques?=)
Date: Sat, 2 May 2020 16:43:13 +0000 (UTC)
Subject: [R-sig-Geo] Help to calculate the impacts using the spreg function
 in sphet package: GMM/IV with one endogenous and one instrument
References: <1538110015.207966.1588437793908.ref@mail.yahoo.com>
Message-ID: <1538110015.207966.1588437793908@mail.yahoo.com>

Dear all,
I apologize for my previous unclear code in the mail list.Now I hope to be clear about the problem I am facing in the following example:

require("sf", quietly=TRUE)library(sphet)library(spatialreg)
columbus <- st_read(system.file("shapes/columbus.shp", package="spData")[1], quiet=TRUE)require("spdep", quietly=TRUE)col.gal.nb <- spdep::read.gal(system.file("weights/columbus.gal", package="spData")[1])listw <- spdep::nb2listw(col.gal.nb)
# I have one endongenous (HOVAL) and one instrument (PLUMB) ## endo=~HOVAL ; instruments=~PLUMB

res.spreg <- spreg(CRIME ~ INC + OPEN, columbus, listw,endo=~HOVAL,lag.instr = TRUE,instruments=~PLUMB,model=c('ivhac'),het=TRUE,HAC=FALSE)
class(res.spreg)#[1] "sphet"? "gstsls"summary(res.spreg)
Now the problem: I'm unable to calculate the impacts and their p-values in a (cross-section) Cliff-Ord model based on GMM/IV:

W <- as(listw, "CsparseMatrix")trMatc <- trW(W, type="mult")trMC <- trW(W, type="MC")
set.seed(1234)impacts(res.spreg, listw=listw)
# I get the error message:Error in spatialreg::intImpacts(rho = rho, beta = beta, P = P, n = n,? :?? argumento "evalues" ausente, sem padr?oAl?m disso: Warning message:Function intImpacts moved to the spatialreg package
# or even when I try:library(coda)lobjIQ5 <- impacts(res.spreg, tr=trMatc, R=200, Q=5)summary(lobjIQ5, zstats=TRUE, short=TRUE)# I got the same error message.
## When I use the 'evalues' argument as the vector of eigenvalues of spatial weights matrix:
ev <- eigenw(listw)impacts(res.spreg, evalues=ev)
# Even in this way I got the same error message.

Thanks for help.
Best wishes,
Andr? M. Marques
Federal University of ParaibaGraduate Program of Economics


	[[alternative HTML version deleted]]


From m@ur|c|o@z@mbr@no @end|ng |rom u|ronter@@c|  Sat May  2 20:14:14 2020
From: m@ur|c|o@z@mbr@no @end|ng |rom u|ronter@@c| (Mauricio Zambrano-Bigiarini)
Date: Sat, 2 May 2020 14:14:14 -0400
Subject: [R-sig-Geo] How to correctly compare the CRS of 'sf' and 'raster'
 objects?
Message-ID: <CAP6Varuq3Hmsv0y6QYe9ut160JNxovn3A=pRZzV7nyu5TiLbiA@mail.gmail.com>

Dear mailing list,

I'm wondering what is the correct way of comparing the CRS of a
vectorial (simple feature) and a raster object.

Please look a the following reproducible example:

------- CODE START--------
library(sf)
library(raster)

# 1) Getting the character corresponding to lat/lon CRS string
latlon.crs <- st_crs(4326)$proj4string

# 2) Creating a simple feature point geometry and assigning lat/lon CRS
vec <- st_sfc(st_point(c(0,0)), st_point(c(1,1)))
st_crs(vec) <- 4326

# 3) Creating a simple feature point geometry and assigning lat/lon CRS
rast <- raster(nrows=108, ncols=21, xmn=0, xmx=10)
crs(rast) <- latlon.crs

# 4) Getting the CRS of the point and raster objects
vect.crs <- sf::st_crs(vec)$proj4string
rast.crs <- sf::st_crs(rast)$proj4string

# 5) Making the CRS comparison
are.equal <- vect.crs == rast.crs

------- CODE END--------


The previous comparison works fine in R 4.0.0 (raster_3.1-5 sp_1.4-1,
sf_0.9-2) with the following set of libraries:

GEOS 3.5.1, GDAL 2.2.2, PROJ 4.9.2

but the same line of code fails with the newer set of libraries:

GEOS 3.8.1, GDAL 3.0.4, PROJ 7.0.0


Is there any "correct" way of comparing the CRS of the previous
vectorial and raster object in 'sf', something similar to
sp::identicalCRS?

If so, what is the minimum required version of the GEOS, GDAL, and
PROJ libraries?


Thanks in advance for any help,


Mauricio Zambrano-Bigiarini, PhD

=====================================
Department of Civil Engineering
Faculty of Engineering and Sciences
Universidad de La Frontera, Temuco, Chile
http://hzambran.github.io/
=====================================
mailto : mauricio.zambrano at ufrontera.cl
work-phone : +56 45 259 2812
=====================================
"The world is changed by your example,
not your opinion". (Paulo Coelho)
=====================================
Linux user #454569 -- Linux Mint user

-- 
La informaci?n contenida en este correo electr?nico y cualquier anexo o 
respuesta relacionada, puede contener datos e informaci?n confidencial y no 
puede ser usada o difundida por personas distintas a su(s) destinatario(s). 
Si usted no es el destinatario de esta comunicaci?n, le informamos que 
cualquier divulgaci?n, distribuci?n o copia de esta informaci?n constituye 
un delito conforme a la ley chilena. Si lo ha recibido por error, por favor 
borre el mensaje y todos sus anexos y notifique al remitente.


From dom|n|k@w|nge|er2 @end|ng |rom @tudent@un|@g@ch  Sun May  3 16:40:49 2020
From: dom|n|k@w|nge|er2 @end|ng |rom @tudent@un|@g@ch (Wingeier, Dominik)
Date: Sun, 3 May 2020 14:40:49 +0000
Subject: [R-sig-Geo] Spatial Durbin Model (lagsarlm) with two different
 Weight Matrices
Message-ID: <ZR0P278MB0090C93D7DEC530241CC94DE8DA90@ZR0P278MB0090.CHEP278.PROD.OUTLOOK.COM>

Dear Community

I hope you are all doing well despite the special circumstances.

I would like to estimate the following spatial durbin model by making use of the lagsarlm(...,type ="mixed") function in R:

y = ?W1y+X?+W2X? +?

where W1 and W2 have the same dimension and are both row standardized but different weights are assigned to the elements.
I found two older posts in the archive with similar problems (https://stat.ethz.ch/pipermail/r-sig-geo/2015-May/022852.html and https://stat.ethz.ch/pipermail/r-sig-geo/2015-May/022821.html) but I am struggling to understand the proposed solution and how to correctly implement the create_WX() in connection with the lagsarlm() function.
Therefore, I would like to kindly ask you for help on how to deal with two different weight matrices in the case of a spatial durbin model in R.

In advance many thanks for any help and suggestions.
Best regards
Dominik


	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon May  4 09:56:51 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 4 May 2020 09:56:51 +0200
Subject: [R-sig-Geo] 
 Help to calculate the impacts using the spreg function
 in sphet package: GMM/IV with one endogenous and one instrument
In-Reply-To: <1538110015.207966.1588437793908@mail.yahoo.com>
References: <1538110015.207966.1588437793908.ref@mail.yahoo.com>
 <1538110015.207966.1588437793908@mail.yahoo.com>
Message-ID: <alpine.LFD.2.21.2005040942140.75692@reclus.nhh.no>

On Sat, 2 May 2020, Andr? M. Marques via R-sig-Geo wrote:

> Dear all,
> I apologize for my previous unclear code in the mail list.Now I hope to be clear about the problem I am facing in the following example:
>
> require("sf", quietly=TRUE)library(sphet)library(spatialreg)
> columbus <- st_read(system.file("shapes/columbus.shp", package="spData")[1], quiet=TRUE)require("spdep", quietly=TRUE)col.gal.nb <- spdep::read.gal(system.file("weights/columbus.gal", package="spData")[1])listw <- spdep::nb2listw(col.gal.nb)
> # I have one endongenous (HOVAL) and one instrument (PLUMB) ## endo=~HOVAL ; instruments=~PLUMB
>
> res.spreg <- spreg(CRIME ~ INC + OPEN, columbus, listw,endo=~HOVAL,lag.instr = TRUE,instruments=~PLUMB,model=c('ivhac'),het=TRUE,HAC=FALSE)
> class(res.spreg)#[1] "sphet"? "gstsls"summary(res.spreg)
> Now the problem: I'm unable to calculate the impacts and their p-values in a (cross-section) Cliff-Ord model based on GMM/IV:
>

Had you followed list rules and posted plain text, things might have been 
clearer. HTML tries to make code look like a paragraph of text, so messes 
everything up. This is a plain-text version:

library(sphet)
library(spatialreg)
columbus <- sf::st_read(system.file("shapes/columbus.shp",
   package="spData")[1], quiet=TRUE)
col.gal.nb <- spdep::read.gal(system.file("weights/columbus.gal",
   package="spData")[1])
listw <- spdep::nb2listw(col.gal.nb)
res.spreg <- spreg(CRIME ~ INC + OPEN, columbus, listw, endo=~HOVAL,
   lag.instr = TRUE, instruments=~PLUMB, model=c('ivhac'), het=TRUE,
   HAC=FALSE)
class(res.spreg)
summary(res.spreg)
impacts(res.spreg, listw=listw)

This indicates a mismatch firstly between released spatialreg and spdep in 
handling impacts for some sphet objects, and further that the IV case may 
not yet be covered. Please provide this reproducible example on 
https://github.com/r-spatial/spatialreg/issues and ping the sphet 
maintainer.

Roger


> W <- as(listw, "CsparseMatrix")trMatc <- trW(W, type="mult")trMC <- trW(W, type="MC")
> set.seed(1234)impacts(res.spreg, listw=listw)
> # I get the error message:Error in spatialreg::intImpacts(rho = rho, beta = beta, P = P, n = n,? :?? argumento "evalues" ausente, sem padr?oAl?m disso: Warning message:Function intImpacts moved to the spatialreg package
> # or even when I try:library(coda)lobjIQ5 <- impacts(res.spreg, tr=trMatc, R=200, Q=5)summary(lobjIQ5, zstats=TRUE, short=TRUE)# I got the same error message.
> ## When I use the 'evalues' argument as the vector of eigenvalues of spatial weights matrix:
> ev <- eigenw(listw)impacts(res.spreg, evalues=ev)
> # Even in this way I got the same error message.
>
> Thanks for help.
> Best wishes,
> Andr? M. Marques
> Federal University of ParaibaGraduate Program of Economics
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Mon May  4 12:21:01 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 4 May 2020 12:21:01 +0200
Subject: [R-sig-Geo] Spatial Durbin Model (lagsarlm) with two different
 Weight Matrices
In-Reply-To: <ZR0P278MB0090C93D7DEC530241CC94DE8DA90@ZR0P278MB0090.CHEP278.PROD.OUTLOOK.COM>
References: <ZR0P278MB0090C93D7DEC530241CC94DE8DA90@ZR0P278MB0090.CHEP278.PROD.OUTLOOK.COM>
Message-ID: <alpine.LFD.2.21.2005041207310.76496@reclus.nhh.no>

On Sun, 3 May 2020, Wingeier, Dominik wrote:

> Dear Community
>
> I hope you are all doing well despite the special circumstances.
>
> I would like to estimate the following spatial durbin model by making 
> use of the lagsarlm(...,type ="mixed") function in R:
>
> y = ???W1y+X???+W2X??? +???

Please post plain text only, if need be using LaTeX markup for symbols. 
This is illegible.

>
> where W1 and W2 have the same dimension and are both row standardized 
> but different weights are assigned to the elements. I found two older 
> posts in the archive with similar problems 
> (https://stat.ethz.ch/pipermail/r-sig-geo/2015-May/022852.html and 
> https://stat.ethz.ch/pipermail/r-sig-geo/2015-May/022821.html) but I am 
> struggling to understand the proposed solution and how to correctly 
> implement the create_WX() in connection with the lagsarlm() function. 
> Therefore, I would like to kindly ask you for help on how to deal with 
> two different weight matrices in the case of a spatial durbin model in 
> R.

Don't apply advive given in a different setting to a different problem. 
Your model may be:

y = \rho W_1 y + X \beta + W_2 X \gamma + \varepsillon

This is not a Durbin model unless W_1 == W_2; if it was a Durbin model, 
you would use

spatialreg::lagsarlm(y ~ X, ..., Durbin=TRUE, ...)

with the DGP

y = (I - \rho W)^{-1} (X \beta + W X \gamma + \varepsillon).

Your DGP is equivalent to X_a = [X, W_2 X] and

y = (I - \rho W_1)^{-1} (X_a \beta + \varepsillon)

So construct your formula something like:

spatialreg::lagsarlm(y ~ X_1 + I(lag(lw_2, X_1)) + ..., ...)

not using Durbin, by creating the spatial lags of each continuous X 
variable one-by-one. If any X are factors, your job will be even more 
involved. I would doubt strongly that you have a motivation for mixing 
spatial weights in this way, I cannot see any obvious reason for using W_1 
for y and W_2 for X.

Hope this clarifies,

Roger

>
> In advance many thanks for any help and suggestions.
> Best regards
> Dominik
>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Roger@B|v@nd @end|ng |rom nhh@no  Mon May  4 16:01:52 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 4 May 2020 16:01:52 +0200
Subject: [R-sig-Geo] 
 Help to calculate the impacts using the spreg function
 in sphet package: GMM/IV with one endogenous and one instrument
In-Reply-To: <alpine.LFD.2.21.2005040942140.75692@reclus.nhh.no>
References: <1538110015.207966.1588437793908.ref@mail.yahoo.com>
 <1538110015.207966.1588437793908@mail.yahoo.com>
 <alpine.LFD.2.21.2005040942140.75692@reclus.nhh.no>
Message-ID: <alpine.LFD.2.21.2005041557340.85200@reclus.nhh.no>

On Mon, 4 May 2020, Roger Bivand wrote:

> On Sat, 2 May 2020, Andr? M. Marques via R-sig-Geo wrote:
>
>>  Dear all,
>>  I apologize for my previous unclear code in the mail list.Now I hope to be
>>  clear about the problem I am facing in the following example:
>>
>>  require("sf", quietly=TRUE)library(sphet)library(spatialreg)
>>  columbus <- st_read(system.file("shapes/columbus.shp",
>>  package="spData")[1], quiet=TRUE)require("spdep", quietly=TRUE)col.gal.nb
>>  <- spdep::read.gal(system.file("weights/columbus.gal",
>>  package="spData")[1])listw <- spdep::nb2listw(col.gal.nb)
>>  # I have one endongenous (HOVAL) and one instrument (PLUMB) ## endo=~HOVAL
>>  ; instruments=~PLUMB
>>
>>  res.spreg <- spreg(CRIME ~ INC + OPEN, columbus,
>>  listw,endo=~HOVAL,lag.instr =
>>  TRUE,instruments=~PLUMB,model=c('ivhac'),het=TRUE,HAC=FALSE)
>>  class(res.spreg)#[1] "sphet"? "gstsls"summary(res.spreg)
>>  Now the problem: I'm unable to calculate the impacts and their p-values in
>>  a (cross-section) Cliff-Ord model based on GMM/IV:
>> 
>
> Had you followed list rules and posted plain text, things might have been 
> clearer. HTML tries to make code look like a paragraph of text, so messes 
> everything up. This is a plain-text version:
>
> library(sphet)
> library(spatialreg)
> columbus <- sf::st_read(system.file("shapes/columbus.shp",
>  package="spData")[1], quiet=TRUE)
> col.gal.nb <- spdep::read.gal(system.file("weights/columbus.gal",
>  package="spData")[1])
> listw <- spdep::nb2listw(col.gal.nb)
> res.spreg <- spreg(CRIME ~ INC + OPEN, columbus, listw, endo=~HOVAL,
>   lag.instr = TRUE, instruments=~PLUMB, model=c('ivhac'), het=TRUE,
>   HAC=FALSE)
> class(res.spreg)
> summary(res.spreg)
> impacts(res.spreg, listw=listw)
>
> This indicates a mismatch firstly between released spatialreg and spdep in 
> handling impacts for some sphet objects, and further that the IV case may not 
> yet be covered. Please provide this reproducible example on 
> https://github.com/r-spatial/spatialreg/issues and ping the sphet maintainer.

There was a mismatch in declaration of method imports. Try:

install.packages("sphet", repos="http://R-Forge.R-project.org")
remotes::install_github("r-spatial/spatialreg")

if it posssible for you to install packages from source; the example was 
helpful in making progress. If you can install the fresh package versions, 
please also report whether the underlying  problem is resolved on your 
real data.

Roger

>
> Roger
>
>
>>  W <- as(listw, "CsparseMatrix")trMatc <- trW(W, type="mult")trMC <- trW(W,
>>  type="MC")
>>  set.seed(1234)impacts(res.spreg, listw=listw)
>> #  I get the error message:Error in spatialreg::intImpacts(rho = rho, beta 
>> #  = beta, P = P, n = n,? :?? argumento "evalues" ausente, sem padr?oAl?m 
>> #  disso: Warning message:Function intImpacts moved to the spatialreg 
>> #  package
>> #  or even when I try:library(coda)lobjIQ5 <- impacts(res.spreg, tr=trMatc, 
>> #  R=200, Q=5)summary(lobjIQ5, zstats=TRUE, short=TRUE)# I got the same 
>> #  error message.
>>  ## When I use the 'evalues' argument as the vector of eigenvalues of
>>  spatial weights matrix:
>>  ev <- eigenw(listw)impacts(res.spreg, evalues=ev)
>>  # Even in this way I got the same error message.
>>
>>  Thanks for help.
>>  Best wishes,
>>  Andr? M. Marques
>>  Federal University of ParaibaGraduate Program of Economics
>> 
>>
>>   [[alternative HTML version deleted]]
>>
>>  _______________________________________________
>>  R-sig-Geo mailing list
>>  R-sig-Geo at r-project.org
>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From j@ck@onmrodr|gue@ @end|ng |rom gm@||@com  Wed May  6 17:16:39 2020
From: j@ck@onmrodr|gue@ @end|ng |rom gm@||@com (Jackson Rodrigues)
Date: Wed, 6 May 2020 12:16:39 -0300
Subject: [R-sig-Geo] enable parallel analysis on pixels from rasterbrick
Message-ID: <CAPL76w-cndW6Hc+qBkhJ1OPwn7vS1jzGnOOQd7zP-pkQH3zCGA@mail.gmail.com>

Dear all,

Could someone help me on performing parallel analysis on pixels from a
rasterbrick?

I would like to extract and perform  Change-Point Detection from package
trend on pixels from a rasterbrick. and write result as a netcdf file.
However, when applied to my original data it is really time demanding
(days).

So I would like some support on enabling parallel analysis, activating
other cores from my computer aiming to save some time.
I have already tried several techniques and got no satisfactory results, so
far.

I am going through packages doParallel and foreach, but I think that my
error is on selecting pixels from all layers as time series rather than
from a single layer.

Below there is a copy of my function and some syntetic data created.

Thank you all in advance,

Jackson

############
library(raster)
r <- raster(ncol=96, nrow=63, vals=runif(63*96))
n <- 672  # number of copies
s <- stack(lapply(1:n, function(i) rz<-stack(r[i]<-(r^2/3))))

Pettitt <- function(x, date, adjust = "none") {
  require("raster")
  require("trend")
  require("zoo")

#Define how many cores you want to use
UseCores <- detectCores() -1
#Register CoreCluster
cl<- makeCluster(UseCores)
registerDoParallel(cl)

    # pre allocate memory
ptt <- rep(NA, ncell(x))
    # compute Pettitt  Change-Point Detection
  #foreach(i=1:ncell(x)) %dopar% {}
for(i in 1:ncell(x)) {
    temporal <- x[i]
    if(!any(is.na(temporal))) {
      ptt[i] <- pettitt.test(x[i])[3] # Pettitt Test
    }
    cat("\r Processing :", round(i/ncell(x) * 100), "%")
  }

  PTT <- raster(nrow=nrow(x), ncol =ncol(x), crs=crs(x))
  extent(PTT) <- extent(x)
  PTT[] <- unlist(ptt)
    # write output
  raster::writeRaster(PTT, "PTT.nc", overwrite = T)
}

start <- Sys.time()
Pettitt(s, dates)
end <- Sys.time()
difftime(end,start)

Ptt<-brick("PTT.nc")
plot(Ptt)

-- 

Jackson M. Rodrigues

"In order to succeed, we must first believe that we can."

Nikos Kazantzakis

	[[alternative HTML version deleted]]


From |o|c@dutr|eux @end|ng |rom c|r@d@|r  Wed May  6 19:50:17 2020
From: |o|c@dutr|eux @end|ng |rom c|r@d@|r (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Wed, 6 May 2020 19:50:17 +0200
Subject: [R-sig-Geo] enable parallel analysis on pixels from rasterbrick
In-Reply-To: <CAPL76w-cndW6Hc+qBkhJ1OPwn7vS1jzGnOOQd7zP-pkQH3zCGA@mail.gmail.com>
References: <CAPL76w-cndW6Hc+qBkhJ1OPwn7vS1jzGnOOQd7zP-pkQH3zCGA@mail.gmail.com>
Message-ID: <2f2ea5ae-bac5-03ae-1c51-27bf514e4b7b@cirad.fr>

Hi Jackson,

The strategy is to make your function work for raster::calc, and 
parallelize it with raster's built in parallelization utils (see ?clusterR).
Looping over pixels of a raster/matrix is nearly never the correct answer.

stars::st_apply would probably also be a good option.


library(raster)
library(trend)


r <- raster(ncol=96, nrow=63, vals=runif(63*96))
n <- 672  # number of copies
s <- stack(lapply(1:n, function(i) rz<-stack(r[i]<-(r^2/3))))

# Define the function to apply to each pixel; it should return a numeric 
or a vector of numerics with always the same lenght
fun <- function(x){
     out <- pettitt.test(x)[3]$estimate
     return(unname(out))
}

# Check that it works
fun(seq(200))

# Check that it works with calc
s_out <- calc(s, fun = fun)
s_out

# Parallelize with clusterR
beginCluster()
s_out <- clusterR(s, fun=calc, args=list(fun=fun))
endCluster()


Cheers,
Lo?c


On 05/06/2020 05:16 PM, Jackson Rodrigues wrote:
> Dear all,
> 
> Could someone help me on performing parallel analysis on pixels from a
> rasterbrick?
> 
> I would like to extract and perform  Change-Point Detection from package
> trend on pixels from a rasterbrick. and write result as a netcdf file.
> However, when applied to my original data it is really time demanding
> (days).
> 
> So I would like some support on enabling parallel analysis, activating
> other cores from my computer aiming to save some time.
> I have already tried several techniques and got no satisfactory results, so
> far.
> 
> I am going through packages doParallel and foreach, but I think that my
> error is on selecting pixels from all layers as time series rather than
> from a single layer.
> 
> Below there is a copy of my function and some syntetic data created.
> 
> Thank you all in advance,
> 
> Jackson
> 
> ############
> library(raster)
> r <- raster(ncol=96, nrow=63, vals=runif(63*96))
> n <- 672  # number of copies
> s <- stack(lapply(1:n, function(i) rz<-stack(r[i]<-(r^2/3))))
> 
> Pettitt <- function(x, date, adjust = "none") {
>    require("raster")
>    require("trend")
>    require("zoo")
> 
> #Define how many cores you want to use
> UseCores <- detectCores() -1
> #Register CoreCluster
> cl<- makeCluster(UseCores)
> registerDoParallel(cl)
> 
>      # pre allocate memory
> ptt <- rep(NA, ncell(x))
>      # compute Pettitt  Change-Point Detection
>    #foreach(i=1:ncell(x)) %dopar% {}
> for(i in 1:ncell(x)) {
>      temporal <- x[i]
>      if(!any(is.na(temporal))) {
>        ptt[i] <- pettitt.test(x[i])[3] # Pettitt Test
>      }
>      cat("\r Processing :", round(i/ncell(x) * 100), "%")
>    }
> 
>    PTT <- raster(nrow=nrow(x), ncol =ncol(x), crs=crs(x))
>    extent(PTT) <- extent(x)
>    PTT[] <- unlist(ptt)
>      # write output
>    raster::writeRaster(PTT, "PTT.nc", overwrite = T)
> }
> 
> start <- Sys.time()
> Pettitt(s, dates)
> end <- Sys.time()
> difftime(end,start)
> 
> Ptt<-brick("PTT.nc")
> plot(Ptt)
> 


From j@ck@onmrodr|gue@ @end|ng |rom gm@||@com  Fri May  8 15:59:22 2020
From: j@ck@onmrodr|gue@ @end|ng |rom gm@||@com (Jackson Rodrigues)
Date: Fri, 8 May 2020 10:59:22 -0300
Subject: [R-sig-Geo] Error in applying calc to rasterbrick with NA vallues
Message-ID: <CAPL76w9jhZrLJa-0cM4FgztCy3jDk1N_wbfQ=m7PJ+3A0qKxHg@mail.gmail.com>

Dear all,

I am sorry for previous email. I am learning how to handle correctly this
list.

On R-sig-Geo Digest, Vol 201, Issue 5  I got a smart solution for my tests
with parallelization.

However, my original data has NA values, and applying the function created
to my data I get some errors.
I have played around with other commands like na.rm, na.action=na.exclude
or reclassifications and none worked.

Could someone give me some herp again?

best wishes,

Jackson
################
library(raster)
library(trend)

r <- raster(ncol=96, nrow=63, vals=runif(63*96))
n <- 672  # number of copies
s <- stack(lapply(1:n, function(i) rz<-stack(r[i]<-(r^2/3))))
s[s < 0.1] <- NA

# Define the function to apply to each pixel; it should return a numeric
or a vector of numerics with always the same lenght
fun <- function(x){
  out <- pettitt.test(x)[3]$estimate
  return(unname(out))
}

# Check that it works
fun(seq(2000))

# Check that it works with calc
s_out <- calc(s, fun = fun)

Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
  cannot use this function

# Parallelize with clusterR
beginCluster()
s_out <- clusterR(s, fun=calc, args=list(fun=fun))

[1] "cannot use this function"
attr(,"class")
[1] "snow-try-error" "try-error"
Error in clusterR(s, fun = calc, args = list(fun = fun)) : cluster error

endCluster()
##############

	[[alternative HTML version deleted]]


From |o|c@dutr|eux @end|ng |rom c|r@d@|r  Fri May  8 17:08:28 2020
From: |o|c@dutr|eux @end|ng |rom c|r@d@|r (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Fri, 8 May 2020 17:08:28 +0200
Subject: [R-sig-Geo] 
 Error in applying calc to rasterbrick with NA vallues
In-Reply-To: <CAPL76w9jhZrLJa-0cM4FgztCy3jDk1N_wbfQ=m7PJ+3A0qKxHg@mail.gmail.com>
References: <CAPL76w9jhZrLJa-0cM4FgztCy3jDk1N_wbfQ=m7PJ+3A0qKxHg@mail.gmail.com>
Message-ID: <41aaabad-b0e5-04f0-aa1a-b83e4fc6a2e0@cirad.fr>

Hi Jackson,

All the layers of the toy dataset you create in your example are 
identical. Is that intentional?
Below I create a more heterogeneous dataset and introduce a few NAs.

library(raster)
library(trend)

set.seed(12)
r <- raster(nrow=10, ncol=10)
s <- lapply(1:200, function(i) setValues(r, rnorm(ncell(r), 
sample.int(5,1), 0.5)))
s <- stack(s)

s[s < 0] <- NA

# Visualize that some pixels have NAs and other don't
hasna <- stackApply(s, indices = 1, fun = function(x, na.rm){anyNA(x)})
plot(hasna)

# pettitt.test function does not handle NAs, so you need to add a condition
# to "exclude" vectors that contain NAs
fun <- function(x){
     out <- ifelse(anyNA(x),
                   yes = NA,
                   no = unname(pettitt.test(x)[3]$estimate))
     return(out)
}

# Check that it works
fun(as.vector(s[1])) # first pixel, does not contain NAs
fun(as.vector(s[2])) # second pixel, contains NAs

# Check that it works with calc
s_out <- calc(s, fun = fun)
plot(s_out)


Cheers,
Lo?c

On 05/08/2020 03:59 PM, Jackson Rodrigues wrote:
> Dear all,
> 
> I am sorry for previous email. I am learning how to handle correctly this
> list.
> 
> On R-sig-Geo Digest, Vol 201, Issue 5  I got a smart solution for my tests
> with parallelization.
> 
> However, my original data has NA values, and applying the function created
> to my data I get some errors.
> I have played around with other commands like na.rm, na.action=na.exclude
> or reclassifications and none worked.
> 
> Could someone give me some herp again?
> 
> best wishes,
> 
> Jackson
> ################
> library(raster)
> library(trend)
> 
> r <- raster(ncol=96, nrow=63, vals=runif(63*96))
> n <- 672  # number of copies
> s <- stack(lapply(1:n, function(i) rz<-stack(r[i]<-(r^2/3))))
> s[s < 0.1] <- NA
> 
> # Define the function to apply to each pixel; it should return a numeric
> or a vector of numerics with always the same lenght
> fun <- function(x){
>    out <- pettitt.test(x)[3]$estimate
>    return(unname(out))
> }
> 
> # Check that it works
> fun(seq(2000))
> 
> # Check that it works with calc
> s_out <- calc(s, fun = fun)
> 
> Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
>    cannot use this function
> 
> # Parallelize with clusterR
> beginCluster()
> s_out <- clusterR(s, fun=calc, args=list(fun=fun))
> 
> [1] "cannot use this function"
> attr(,"class")
> [1] "snow-try-error" "try-error"
> Error in clusterR(s, fun = calc, args = list(fun = fun)) : cluster error
> 
> endCluster()
> ##############
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From ju||@n@burgo@ @end|ng |rom h@|ogv@tn@|@  Fri May  8 18:36:17 2020
From: ju||@n@burgo@ @end|ng |rom h@|ogv@tn@|@ (Julian M. Burgos)
Date: Fri, 08 May 2020 16:36:17 +0000
Subject: [R-sig-Geo] Fitting a SAR model with no covariates
Message-ID: <xgz4ksql6ym.fsf@hafogvatn.is>

Dear list,

I am trying to fit a very simple spatial autoregressive (SAR) model to measure the degree of spatial correlation in some dataset.  The data consists of location (x, y) and some environmental parameter.  The model I want to fit is of the form

y = rho * W * y + e

where y is a vector with the values of the environmental parameter, W is the matrix of spatial weights given by the inverse of squared distances among locations, rho is the autoregressive coefficient, and e is an error term.  The model does not have any covariates.

I can get W (as a listw object) using the chooseCN function from the adelspatial package, doing something like this:

#---------------------------------------------------
data(OLD.COL)
xy <- as.matrix(COL.OLD[, c("X", "Y")])

W <- chooseCN(xy = xy, ask = FALSE, type = 7, dmin = 1,
              plot.nb = FALSE, a = 2)
#---------------------------------------------------

But then I am a bit confused about how to fit the model itself using some of the functions from the spatialreg package, in particular because my model does not have covariates.  The only thing I want to obtain is the rho parameter.

Any guidance will be welcomed!

Julian

--
Julian Mariano Burgos, PhD
Hafranns?knastofnun, ranns?kna- og r??gjafarstofnun hafs og vatna/
Marine and Freshwater Research Institute
Botnsj?varsvi?s / Demersal Division
Sk?lagata 4, 121 Reykjav?k, Iceland
S?mi/Telephone : +354-5752037
Netfang/Email: julian.burgos at hafogvatn.is


From |8|5h9 @end|ng |rom gm@||@com  Sat May  9 12:07:32 2020
From: |8|5h9 @end|ng |rom gm@||@com (=?utf-8?Q?Fernando_A_L=C3=B3pez_Hern=C3=A1ndez?=)
Date: Sat, 9 May 2020 12:07:32 +0200
Subject: [R-sig-Geo] New version 'spsur' for the estimation of Spatial
 Seemingly Unrelated Regression
Message-ID: <56A3BCB3-FFCD-4BB3-9766-DDE08A45FBEB@gmail.com>

Dear all

I am pleased to announce that the R package ?spsur? for the estimation of Spatial Seemingly Unrelated Regression upload a new version in the CRAN. 

https://cran.r-project.org/web/packages/spsur/index.html <https://cran.r-project.org/web/packages/spsur/index.html>
This version of ?spsur? has been adapted to the standard arguments used in similar packages (spatialreg, spdep, splm, sphet) and include new functionalities.

A new user guide is available on: https://cran.r-project.org/web/packages/spsur/vignettes/vig1.html <https://cran.r-project.org/web/packages/spsur/vignettes/vig1.html>
I hope you find interest this package for you research or for your PhD students. 
Fernando A. L?pez Hern?ndez
fernando.lopez at upct.es <mailto:fernando.lopez at upct.es>
http://metodos.upct.es/falopez/ <http://metodos.upct.es/falopez/>
	[[alternative HTML version deleted]]


From j@ck@onmrodr|gue@ @end|ng |rom gm@||@com  Sat May  9 12:36:29 2020
From: j@ck@onmrodr|gue@ @end|ng |rom gm@||@com (Jackson Rodrigues)
Date: Sat, 9 May 2020 07:36:29 -0300
Subject: [R-sig-Geo] 
 Error in applying calc to rasterbrick with NA vallues
In-Reply-To: <41aaabad-b0e5-04f0-aa1a-b83e4fc6a2e0@cirad.fr>
References: <CAPL76w9jhZrLJa-0cM4FgztCy3jDk1N_wbfQ=m7PJ+3A0qKxHg@mail.gmail.com>
 <41aaabad-b0e5-04f0-aa1a-b83e4fc6a2e0@cirad.fr>
Message-ID: <CAPL76w-qZCQxmXVoZCwmtCcpaq9noMmCiAC9A5MNcW-X5ryF7A@mail.gmail.com>

Hi Loic,

Thank you again.

Actually, I did not worry about data quality created.
My concern was a creation of the same amount of data I originally have.

Your suggestion worked perfectly! I tried to replace NAs by 0 in the
begining, but I got errors.

So, thank you again.

Cheers

Jackson

Em sex, 8 de mai de 2020 12:08, Lo?c Dutrieux <loic.dutrieux at cirad.fr>
escreveu:

> Hi Jackson,
>
> All the layers of the toy dataset you create in your example are
> identical. Is that intentional?
> Below I create a more heterogeneous dataset and introduce a few NAs.
>
> library(raster)
> library(trend)
>
> set.seed(12)
> r <- raster(nrow=10, ncol=10)
> s <- lapply(1:200, function(i) setValues(r, rnorm(ncell(r),
> sample.int(5,1), 0.5)))
> s <- stack(s)
>
> s[s < 0] <- NA
>
> # Visualize that some pixels have NAs and other don't
> hasna <- stackApply(s, indices = 1, fun = function(x, na.rm){anyNA(x)})
> plot(hasna)
>
> # pettitt.test function does not handle NAs, so you need to add a condition
> # to "exclude" vectors that contain NAs
> fun <- function(x){
>      out <- ifelse(anyNA(x),
>                    yes = NA,
>                    no = unname(pettitt.test(x)[3]$estimate))
>      return(out)
> }
>
> # Check that it works
> fun(as.vector(s[1])) # first pixel, does not contain NAs
> fun(as.vector(s[2])) # second pixel, contains NAs
>
> # Check that it works with calc
> s_out <- calc(s, fun = fun)
> plot(s_out)
>
>
> Cheers,
> Lo?c
>
> On 05/08/2020 03:59 PM, Jackson Rodrigues wrote:
> > Dear all,
> >
> > I am sorry for previous email. I am learning how to handle correctly this
> > list.
> >
> > On R-sig-Geo Digest, Vol 201, Issue 5  I got a smart solution for my
> tests
> > with parallelization.
> >
> > However, my original data has NA values, and applying the function
> created
> > to my data I get some errors.
> > I have played around with other commands like na.rm, na.action=na.exclude
> > or reclassifications and none worked.
> >
> > Could someone give me some herp again?
> >
> > best wishes,
> >
> > Jackson
> > ################
> > library(raster)
> > library(trend)
> >
> > r <- raster(ncol=96, nrow=63, vals=runif(63*96))
> > n <- 672  # number of copies
> > s <- stack(lapply(1:n, function(i) rz<-stack(r[i]<-(r^2/3))))
> > s[s < 0.1] <- NA
> >
> > # Define the function to apply to each pixel; it should return a numeric
> > or a vector of numerics with always the same lenght
> > fun <- function(x){
> >    out <- pettitt.test(x)[3]$estimate
> >    return(unname(out))
> > }
> >
> > # Check that it works
> > fun(seq(2000))
> >
> > # Check that it works with calc
> > s_out <- calc(s, fun = fun)
> >
> > Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
> >    cannot use this function
> >
> > # Parallelize with clusterR
> > beginCluster()
> > s_out <- clusterR(s, fun=calc, args=list(fun=fun))
> >
> > [1] "cannot use this function"
> > attr(,"class")
> > [1] "snow-try-error" "try-error"
> > Error in clusterR(s, fun = calc, args = list(fun = fun)) : cluster error
> >
> > endCluster()
> > ##############
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Sat May  9 17:17:57 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 9 May 2020 17:17:57 +0200
Subject: [R-sig-Geo] Fitting a SAR model with no covariates
In-Reply-To: <xgz4ksql6ym.fsf@hafogvatn.is>
References: <xgz4ksql6ym.fsf@hafogvatn.is>
Message-ID: <alpine.LFD.2.21.2005091411040.662923@reclus.nhh.no>

On Fri, 8 May 2020, Julian M. Burgos wrote:

> Dear list,
>
> I am trying to fit a very simple spatial autoregressive (SAR) model to 
> measure the degree of spatial correlation in some dataset.  The data 
> consists of location (x, y) and some environmental parameter.  The model 
> I want to fit is of the form
>
> y = rho * W * y + e
>
> where y is a vector with the values of the environmental parameter, W is 
> the matrix of spatial weights given by the inverse of squared distances 
> among locations, rho is the autoregressive coefficient, and e is an 
> error term.  The model does not have any covariates.
>
> I can get W (as a listw object) using the chooseCN function from the 
> adelspatial package, doing something like this:
>
> #---------------------------------------------------
> data(OLD.COL)
> xy <- as.matrix(COL.OLD[, c("X", "Y")])
>
> W <- chooseCN(xy = xy, ask = FALSE, type = 7, dmin = 1,
>              plot.nb = FALSE, a = 2)
> #---------------------------------------------------
>
> But then I am a bit confused about how to fit the model itself using 
> some of the functions from the spatialreg package, in particular because 
> my model does not have covariates.  The only thing I want to obtain is 
> the rho parameter.

Please see the full reprex I provided for a direct questioner who prefered 
to post on OpenSpace rather than here:

https://groups.google.com/forum/#!topic/openspace-list/RCYcrEcxDWg. In 
your case:

data(oldcol, package="spdep")
xy <- as.matrix(COL.OLD[, c("X", "Y")])
listw <- adespatial::chooseCN(xy=xy, ask=FALSE, type=7, dmin=1,
  plot.nb=FALSE, a=2)
listw
library(spatialreg)
(sar_intercept <- lagsarlm(CRIME ~ 1, data=COL.OLD, listw=listw))

which fails because adespatial::chooseCN() does not construct an spdep 
compliant listw object. Further, it is almost completely dense, so always 
a very bad choice (see Tony Smith's article 
https://doi.org/10.1111/j.1538-4632.2009.00758.x).

dnb <- dnearneigh(xy, 0, 100)
dists <- nbdists(dnb, xy)
dists_idw2 <- lapply(dists, function(x) 1/(x^2))
listw1 <- nb2listw(dnb, glist=dists_idw2, style="W")

all.equal(listw$weights, listw1$weights, check.attributes=FALSE)

(sar_intercept <- lagsarlm(CRIME ~ 1, data=COL.OLD, listw=listw1))

and so on following the reply on OpenSpace.

You cannot fit a no-covariate, no-intercept model of this kind. You can 
centre the response and estimate a (close-to) zero intercept model. If you 
look at fitting APLE ?aple, you'll see that it also centres first, and 
expects a detrended response, that is that relevant covariates have 
already been taken into account:

y <- c(scale(COL.OLD$CRIME, scale = FALSE))
mean(y)
aple(y, listw1)

Hope this clarifies,

Roger

>
> Any guidance will be welcomed!
>
> Julian
>
> --
> Julian Mariano Burgos, PhD
> Hafranns?knastofnun, ranns?kna- og r??gjafarstofnun hafs og vatna/
> Marine and Freshwater Research Institute
> Botnsj?varsvi?s / Demersal Division
> Sk?lagata 4, 121 Reykjav?k, Iceland
> S?mi/Telephone : +354-5752037
> Netfang/Email: julian.burgos at hafogvatn.is
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From |uc@@d@c@godoy @end|ng |rom gm@||@com  Mon May 11 19:34:25 2020
From: |uc@@d@c@godoy @end|ng |rom gm@||@com (Lucas Godoy)
Date: Mon, 11 May 2020 13:34:25 -0400
Subject: [R-sig-Geo] rgeos within Rcpp
Message-ID: <CAE3weNYou6s7EKN+Cp6ohAc8QbNzOUsOsp8CsK5VKPbB-4DoAw@mail.gmail.com>

Dear all,

Is it possible to use *rgeos* functions within an Rcpp script?
I know that *rgeos* is an interface to GEOS, but I am working with
*SpatialPolygons
(sp)* and I do not know how to convert files from an S4 class in Rcpp to a
class compatible with the GEOS functions.

Does the *sf* package make this kind of task easier?

(P.S.: I am asking because I am working with Monte Carlo tests, and almost
everything is done from within Rcpp, but when I need to calculate distances
(gDistance) or intersections (gIntersetion) between polygons I'm forced to
call the R functions.)

Thank you in advance,
Lucas.

	[[alternative HTML version deleted]]


From ju||@n@burgo@ @end|ng |rom h@|ogv@tn@|@  Tue May 12 10:58:12 2020
From: ju||@n@burgo@ @end|ng |rom h@|ogv@tn@|@ (Julian M. Burgos)
Date: Tue, 12 May 2020 08:58:12 +0000
Subject: [R-sig-Geo] Fitting a SAR model with no covariates
In-Reply-To: <alpine.LFD.2.21.2005091411040.662923@reclus.nhh.no>
References: <xgz4ksql6ym.fsf@hafogvatn.is>
 <alpine.LFD.2.21.2005091411040.662923@reclus.nhh.no>
Message-ID: <xgzeerpil7f.fsf@hafogvatn.is>

Thank you Roger for your detailed answer.  Clearly I still have to learn quite a bit about spatial regression.

My best,

Julian Burgos

Roger Bivand writes:

> On Fri, 8 May 2020, Julian M. Burgos wrote:
>
>> Dear list,
>>
>> I am trying to fit a very simple spatial autoregressive (SAR) model
>> to measure the degree of spatial correlation in some dataset.  The
>> data consists of location (x, y) and some environmental parameter.
>> The model I want to fit is of the form
>>
>> y = rho * W * y + e
>>
>> where y is a vector with the values of the environmental parameter,
>> W is the matrix of spatial weights given by the inverse of squared
>> distances among locations, rho is the autoregressive coefficient,
>> and e is an error term.  The model does not have any covariates.
>>
>> I can get W (as a listw object) using the chooseCN function from the
>> adelspatial package, doing something like this:
>>
>> #---------------------------------------------------
>> data(OLD.COL)
>> xy <- as.matrix(COL.OLD[, c("X", "Y")])
>>
>> W <- chooseCN(xy = xy, ask = FALSE, type = 7, dmin = 1,
>>              plot.nb = FALSE, a = 2)
>> #---------------------------------------------------
>>
>> But then I am a bit confused about how to fit the model itself using
>> some of the functions from the spatialreg package, in particular
>> because my model does not have covariates.  The only thing I want to
>> obtain is the rho parameter.
>
> Please see the full reprex I provided for a direct questioner who
> prefered to post on OpenSpace rather than here:
>
> https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgroups.google.com%2Fforum%2F%23!topic%2Fopenspace-list%2FRCYcrEcxDWg&amp;data=02%7C01%7C%7C312f8aadce694232b31208d7f42c3a35%7C8e105b94435e4303a61063620dbe162b%7C0%7C0%7C637246343112765266&amp;sdata=SNoQ6Razc%2Bf5JqvcRyCl0A1q8hJI4%2BkuFPWPsaQfBDw%3D&amp;reserved=0.
> In your case:
>
> data(oldcol, package="spdep")
> xy <- as.matrix(COL.OLD[, c("X", "Y")])
> listw <- adespatial::chooseCN(xy=xy, ask=FALSE, type=7, dmin=1,
>  plot.nb=FALSE, a=2)
> listw
> library(spatialreg)
> (sar_intercept <- lagsarlm(CRIME ~ 1, data=COL.OLD, listw=listw))
>
> which fails because adespatial::chooseCN() does not construct an spdep
> compliant listw object. Further, it is almost completely dense, so
> always a very bad choice (see Tony Smith's article
> https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdoi.org%2F10.1111%2Fj.1538-4632.2009.00758.x&amp;data=02%7C01%7C%7C312f8aadce694232b31208d7f42c3a35%7C8e105b94435e4303a61063620dbe162b%7C0%7C0%7C637246343112765266&amp;sdata=kvz3Oknb0GlXwPgKfOUXbYE%2FGN0ib%2F%2FyrBV7u4JIapY%3D&amp;reserved=0).
>
> dnb <- dnearneigh(xy, 0, 100)
> dists <- nbdists(dnb, xy)
> dists_idw2 <- lapply(dists, function(x) 1/(x^2))
> listw1 <- nb2listw(dnb, glist=dists_idw2, style="W")
>
> all.equal(listw$weights, listw1$weights, check.attributes=FALSE)
>
> (sar_intercept <- lagsarlm(CRIME ~ 1, data=COL.OLD, listw=listw1))
>
> and so on following the reply on OpenSpace.
>
> You cannot fit a no-covariate, no-intercept model of this kind. You
> can centre the response and estimate a (close-to) zero intercept
> model. If you look at fitting APLE ?aple, you'll see that it also
> centres first, and expects a detrended response, that is that relevant
> covariates have already been taken into account:
>
> y <- c(scale(COL.OLD$CRIME, scale = FALSE))
> mean(y)
> aple(y, listw1)
>
> Hope this clarifies,
>
> Roger
>
>>
>> Any guidance will be welcomed!
>>
>> Julian
>>
>> --
>> Julian Mariano Burgos, PhD
>> Hafranns?knastofnun, ranns?kna- og r??gjafarstofnun hafs og vatna/
>> Marine and Freshwater Research Institute
>> Botnsj?varsvi?s / Demersal Division
>> Sk?lagata 4, 121 Reykjav?k, Iceland
>> S?mi/Telephone : +354-5752037
>> Netfang/Email: julian.burgos at hafogvatn.is
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=02%7C01%7C%7C312f8aadce694232b31208d7f42c3a35%7C8e105b94435e4303a61063620dbe162b%7C0%7C0%7C637246343112775269&amp;sdata=m53vPJn6kBhIMyKtQ1jzjapunUalhuu085LKbDCD1xs%3D&amp;reserved=0
>>


--
Julian Mariano Burgos, PhD
Hafranns?knastofnun, ranns?kna- og r??gjafarstofnun hafs og vatna/
Marine and Freshwater Research Institute
Botnsj?varsvi?s / Demersal Division
Sk?lagata 4, 121 Reykjav?k, Iceland
S?mi/Telephone : +354-5752037
Netfang/Email: julian.burgos at hafogvatn.is


From wemb@ye @end|ng |rom mum@edu  Fri May 15 16:32:59 2020
From: wemb@ye @end|ng |rom mum@edu (Weldensie Embaye)
Date: Fri, 15 May 2020 09:32:59 -0500
Subject: [R-sig-Geo] spatialreg::predict.sarlm
Message-ID: <CALyWCxj+DqgKeVQ5jm8TGtnVX3JtMZrPqE4nuXXAA4xP1YUSaQ@mail.gmail.com>

I am trying to run  out-of-sample prediction
using  spatialreg::predict.sarlm package. I tried to prepare my data set as
per the requirements.However, it did not work.

Below is the code.
 csv_train <- read.csv("train.csv") #upload your csv. R needs to know your
region ID
> hhid <- csv_train$hhid #Explicitly created a variable to hold the regions
> nb_train <- read.gwt2nb('train.gwt', region.id=hhid)
> Q_train<-nb2listw(nb_train)
> csv_test <- read.csv("test.csv") #upload your csv. R needs to know your
region ID
> hhid <- csv_test$hhid #Explicitly created a variable to hold the regions
> nb_test <- read.gwt2nb('test.gwt', region.id=hhid)
> Q_test<-nb2listw(nb_test)
> y_test <- dataTable$annualrent[test]
> ######## spatial lag process model
> GM5<-spatialreg::lagsarlm(formula, data=traindata, listw=Q_train)
> summary(GM5)

Call:spatialreg::lagsarlm(formula = formula, data = traindata, listw =
Q_train)

Residuals:
      Min        1Q    Median        3Q       Max
-54.38677  -7.32082  -0.78772   5.69047  90.56889

Type: lag
Coefficients: (asymptotic standard errors)
             Estimate Std. Error z value  Pr(>|z|)
(Intercept) -20.63671    4.08382 -5.0533 4.343e-07
coveredpri   -4.04663    4.71961 -0.8574  0.391219
coveredsha   -3.70054    2.57827 -1.4353  0.151207
vipprivate   -3.19640    4.57774 -0.6982  0.485022
vipshare     -2.26742    2.30487 -0.9838  0.325238
unoveredla   -1.29846    3.62671 -0.3580  0.720322
flushpriva   10.22320    3.31060  3.0880  0.002015
electricit   11.25641    2.07508  5.4246 5.810e-08
privatetap    6.48159    2.63420  2.4606  0.013872
publictap    -2.91930    3.46341 -0.8429  0.399285
watertanke   -5.52987    7.58483 -0.7291  0.465959
protectewe   -5.44122    5.17858 -1.0507  0.293389
river        -1.76395    3.57625 -0.4932  0.621843
numberofro   12.47265    0.94757 13.1628 < 2.2e-16
roof         -2.83454    3.62586 -0.7818  0.434357
externalwa   10.19840    1.92089  5.3092 1.101e-07
floor         3.81212    2.55901  1.4897  0.136307

Rho: 0.3742, LR test value: 4.3541, p-value: 0.03692
Asymptotic standard error: 0.16111
    z-value: 2.3227, p-value: 0.020197
Wald statistic: 5.3948, p-value: 0.020197

Log likelihood: -1842.303 for lag model
ML residual variance (sigma squared): 273.25, (sigma: 16.53)
Number of observations: 436
Number of parameters estimated: 19
AIC: 3722.6, (AIC for lm: 3725)
LM test for residual autocorrelation
test value: 1.3748, p-value: 0.24099

> GM5_predict <- spatialreg::predict.sarlm(GM5, newdata = testdata, listw =
Q_test)
Error in spatialreg::predict.sarlm(GM5, newdata = testdata, listw = Q_test)
:
  mismatch between newdata and spatial weights. newdata should have
region.id as row.names
>

Any idea, what is going on?

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri May 15 17:48:01 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 15 May 2020 17:48:01 +0200
Subject: [R-sig-Geo] spatialreg::predict.sarlm
In-Reply-To: <CALyWCxj+DqgKeVQ5jm8TGtnVX3JtMZrPqE4nuXXAA4xP1YUSaQ@mail.gmail.com>
References: <CALyWCxj+DqgKeVQ5jm8TGtnVX3JtMZrPqE4nuXXAA4xP1YUSaQ@mail.gmail.com>
Message-ID: <alpine.LFD.2.22.394.2005151737370.18186@reclus.nhh.no>

On Fri, 15 May 2020, Weldensie Embaye wrote:

> I am trying to run out-of-sample prediction using 
> spatialreg::predict.sarlm package. I tried to prepare my data set as per 
> the requirements.However, it did not work.
>
> Below is the code.

This is your code, but it cannot be reproduced. Please provide a fully 
reproducible example that has available data, and which others can help 
you to debug. If you can make the input data and weights files available 
on a link, that might be easier than trying to use built-in data, 
especially as you are loading weights generated outside the workflow.

A further problem is that prediction needs both data sets and weights, 
because predictions for test observations are autocorrelated with training 
set observations, linked through the weights links.

This leads to the problematic status of train/test on spatial data, 
because ever-present autocorrelation (or entity misspecification) leaks 
between training and test sets (which are then no longer independent). 
There are steps that can be taken to handle this (see for point support 
the blockCV package), not so far there is no such literature (I think) for 
spatial econometrics models.

Please also post plain text, not HTML, to make copying and pasting code 
simpler.

Hope this helps,

Roger

> csv_train <- read.csv("train.csv") #upload your csv. R needs to know your
> region ID
>> hhid <- csv_train$hhid #Explicitly created a variable to hold the regions
>> nb_train <- read.gwt2nb('train.gwt', region.id=hhid)
>> Q_train<-nb2listw(nb_train)
>> csv_test <- read.csv("test.csv") #upload your csv. R needs to know your
> region ID
>> hhid <- csv_test$hhid #Explicitly created a variable to hold the regions
>> nb_test <- read.gwt2nb('test.gwt', region.id=hhid)
>> Q_test<-nb2listw(nb_test)
>> y_test <- dataTable$annualrent[test]
>> ######## spatial lag process model
>> GM5<-spatialreg::lagsarlm(formula, data=traindata, listw=Q_train)
>> summary(GM5)
>
> Call:spatialreg::lagsarlm(formula = formula, data = traindata, listw =
> Q_train)
>
> Residuals:
>      Min        1Q    Median        3Q       Max
> -54.38677  -7.32082  -0.78772   5.69047  90.56889
>
> Type: lag
> Coefficients: (asymptotic standard errors)
>             Estimate Std. Error z value  Pr(>|z|)
> (Intercept) -20.63671    4.08382 -5.0533 4.343e-07
> coveredpri   -4.04663    4.71961 -0.8574  0.391219
> coveredsha   -3.70054    2.57827 -1.4353  0.151207
> vipprivate   -3.19640    4.57774 -0.6982  0.485022
> vipshare     -2.26742    2.30487 -0.9838  0.325238
> unoveredla   -1.29846    3.62671 -0.3580  0.720322
> flushpriva   10.22320    3.31060  3.0880  0.002015
> electricit   11.25641    2.07508  5.4246 5.810e-08
> privatetap    6.48159    2.63420  2.4606  0.013872
> publictap    -2.91930    3.46341 -0.8429  0.399285
> watertanke   -5.52987    7.58483 -0.7291  0.465959
> protectewe   -5.44122    5.17858 -1.0507  0.293389
> river        -1.76395    3.57625 -0.4932  0.621843
> numberofro   12.47265    0.94757 13.1628 < 2.2e-16
> roof         -2.83454    3.62586 -0.7818  0.434357
> externalwa   10.19840    1.92089  5.3092 1.101e-07
> floor         3.81212    2.55901  1.4897  0.136307
>
> Rho: 0.3742, LR test value: 4.3541, p-value: 0.03692
> Asymptotic standard error: 0.16111
>    z-value: 2.3227, p-value: 0.020197
> Wald statistic: 5.3948, p-value: 0.020197
>
> Log likelihood: -1842.303 for lag model
> ML residual variance (sigma squared): 273.25, (sigma: 16.53)
> Number of observations: 436
> Number of parameters estimated: 19
> AIC: 3722.6, (AIC for lm: 3725)
> LM test for residual autocorrelation
> test value: 1.3748, p-value: 0.24099
>
>> GM5_predict <- spatialreg::predict.sarlm(GM5, newdata = testdata, listw =
> Q_test)
> Error in spatialreg::predict.sarlm(GM5, newdata = testdata, listw = Q_test)
> :
>  mismatch between newdata and spatial weights. newdata should have
> region.id as row.names
>>
>
> Any idea, what is going on?
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Po||ngW @end|ng |rom @etn@@com  Mon May 18 11:46:12 2020
From: Po||ngW @end|ng |rom @etn@@com (Poling, William)
Date: Mon, 18 May 2020 09:46:12 +0000
Subject: [R-sig-Geo] Help with spTransform() function and final plot colors
Message-ID: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>

#RStudio Version Version 1.2.1335
sessionInfo()
# R version 4.0.0 Patched (2020-05-03 r78349)
#Platform: x86_64-w64-mingw32/x64 (64-bit) #Running under: Windows 10 x64 (build 17763)

Hello. I am running my data through a routine I found that finds clusters of data points based on distance rule.
https://gis.stackexchange.com/questions/64392/finding-clusters-of-points-based-distance-rule-using-r

1. I get this error when I get to this point in the routine, see complete routine below?
xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84")) non finite transformation detected:

I tried converting columns from numeric to Integer but did not help.

However, I continue to run the rest of the routine and the final sequence, the plot itself, seems to work Can this error be corrected somehow, despite the fact that it continues to work, just curious what it is I guess"

2. However in the plot at the end of the routine the color key appears with the colors but the clusters in the plot are black, see plot call at the end of the routine below?

Thank you for any advice.

WHP

ERROR:
non finite transformation detected:
      coords.x1 coords.x2        
 [1,] -119.7339  39.53939 Inf Inf
 [2,] -119.7665  39.39630 Inf Inf
 [3,] -119.7794  39.28768 Inf Inf
 [4,] -121.0234  39.20503 Inf Inf
 [5,] -122.0047  47.19262 Inf Inf
 [6,] -122.0135  47.18883 Inf Inf
 [7,] -122.0379  47.52190 Inf Inf
 [8,] -122.0578  47.60975 Inf Inf
 [9,] -122.1330  47.13669 Inf Inf
[10,] -122.1509  47.55962 Inf Inf
[11,] -122.1706  47.15546 Inf Inf
[12,] -122.1846  47.23485 Inf Inf
[13,] -122.1846  48.15307 Inf Inf
[14,] -122.1851  47.44870 Inf Inf
[15,] -122.1954  47.68485 Inf Inf
[16,] -122.1990  47.51610 Inf Inf
[17,] -122.2014  47.44772 Inf Inf
[18,] -122.2025  47.69815 Inf Inf
[19,] -122.2037  47.67190 Inf Inf
[20,] -122.2090  47.40378 Inf Inf
[21,] -122.2108  47.25336 Inf Inf
[22,] -122.2291  47.63880 Inf Inf
[23,] -122.2419  47.76870 Inf Inf
[24,] -122.2722  48.04803 Inf Inf
[25,] -122.2732  47.87700 Inf Inf
[26,] -122.2804  47.77620 Inf Inf
[27,] -122.2839  47.82103 Inf Inf
[28,] -122.2890  47.86899 Inf Inf
[29,] -122.2993  47.67306 Inf Inf
[30,] -122.3180  47.38217 Inf Inf
[31,] -122.3270  47.40378 Inf Inf
[32,] -122.3474  47.43884 Inf Inf
[33,] -122.3484  47.53083 Inf Inf
[34,] -122.3581  47.27678 Inf Inf
[35,] -122.3618  47.76735 Inf Inf
[36,] -122.3700  47.56567 Inf Inf
[37,] -122.3908  47.54938 Inf Inf
[38,] -122.4128  47.64622 Inf Inf
[39,] -122.4293  47.17660 Inf Inf
[40,] -122.4621  47.44505 Inf Inf
[41,] -122.4904  47.27460 Inf Inf
[42,] -122.5515  46.93979 Inf Inf
[43,] -122.7348  42.37320 Inf Inf
[44,] -122.7827  47.31059 Inf Inf
[45,] -122.7987  47.23475 Inf Inf
[46,] -122.8385  42.35119 Inf Inf
[47,] -122.8537  42.34495 Inf Inf
[48,] -122.8904  42.39555 Inf Inf
[49,] -122.8927  42.33022 Inf Inf
[50,] -122.9451  47.37574 Inf Inf
[51,] -122.9594  42.30376 Inf Inf
[52,] -123.0641  47.16428 Inf Inf
[53,] -123.3413  42.44117 Inf Inf
Error in spTransform(xSP, CRSobj, ...) : 
  failure in points 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53
In addition: Warning message:
In spTransform(xSP, CRSobj, ...) : 53 projected point(s) not finite

Here is the data:
dput(sample)
structure(list(ID = 1:53, Longitude = c(-119.733899, -119.766493, -119.779416, -121.0234, -122.004736, -122.013456, -122.0379, -122.0578, -122.132971, -122.150901, -122.170608, -122.18462, -122.184639, -122.185079, -122.195398, -122.198994, -122.201356, -122.202507, -122.20371, -122.209047, -122.210797, -122.229095, -122.2419, -122.27216, -122.273164, -122.280355, -122.28389, -122.289043, -122.299261, -122.318009, -122.326987, -122.347382, -122.34844, -122.358115, -122.361839, -122.37003, -122.390815, -122.41282, -122.429323, -122.462136, -122.490417, -122.551483, -122.734847, -122.782736, -122.798669, -122.838498, -122.853683, -122.8904, -122.89271, -122.94511, -122.959407, -123.064087, -123.341346), Latitude = c(39.53939, 39.396298, 39.287681, 39.205028, 47.192616, 47.188833, 47.5219, 47.609748, 47.13669, 47.559616, 47.155455, 47.234849, 48.15307, 47.448697, 47.684854, 47.516104, 47.447723, 47.698146, 47.6719, 47.403778, 47.253364, 47.638795, 47.768701, 48.048027, 47.876997, 47.776205, 47.821029, 47.868987, 47.673056, 47.382165, 47.403785, 47.438836, 47.530831, 47.276776, 47.76735, 47.565667, 47.549377, 47.646222, 47.176596, 47.445053, 47.274599, 46.939789, 42.373195, 47.310595, 47.234748, 42.351189, 42.344953, 42.395547, 42.33022, 47.375736, 42.303755, 47.164278, 42.441172)), class = "data.frame", row.names = c(NA, -53L))

Here is the routine:
require(sp)
require(rgdal)
#25*1609.34 = 40233.5      
dis <- 40233.5 #Distance threshold 25miles converted to meters

x <- tmp1b[,c(6)]
head(x)
y <- tmp1b[,c(5)]
head(y)
str(y)

xy <- SpatialPointsDataFrame(matrix(c(x,y), ncol=2), data.frame(ID=seq(1:length(x))),
                             proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))

str(xy)

xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84"))#Error occurring here?

chc <- hclust(dist(data.frame(rownames=rownames(xy at data), x=coordinates(xy)[,1], #What is xy at data???? see str(xy)
                              y=coordinates(xy)[,2])), method="complete")
str(chc)

view(xy at data)#Look like 3 clusters

# Distance with a 25 Mile threshold
chc.dis <- cutree(chc, h=dis)
str(chc.dis)
view(chc.dis)

# Join results to meuse sp points
xy at data <- data.frame(xy at data, Clust=chc.dis)
str(xy at data)
view(xy at data)

# Plot results
plot(xy, col=factor(xy at data$Clust), pch=19)
box(col="black")
title(main="Clustering")
legend("topleft", legend=paste("Cluster", 1:3,sep=""),#Change from 4 in demo to 3 in my data
       col=palette()[1:3], pch=rep(19,3), bg="white")


Proprietary

NOTICE TO RECIPIENT OF INFORMATION:\ This e-mail may con...{{dropped:16}}


From Po||ngW @end|ng |rom @etn@@com  Mon May 18 11:47:03 2020
From: Po||ngW @end|ng |rom @etn@@com (Poling, William)
Date: Mon, 18 May 2020 09:47:03 +0000
Subject: [R-sig-Geo] 
 Help with spTransform() function and final plot colors
In-Reply-To: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
References: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
Message-ID: <BYAPR06MB5383B66F7659CC4A348098C5AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>

Hello, I have found an additional problem.

I should be getting 3 columns back in the xy at data at some point.
$ ID                           : int  1 2 3 4 5 6 7 8 9 10 ...
# $ Clust                  : int  1 1 1 1 1 1 1 1 1 1 ... This is always - 1
# $ Clust.1               : int  1 1 1 1 1 1 1 1 1 1 ... This would be the cluster number, like 1-3, I am not getting this column back?


Yet the plot runs and indicates three different clusters?



WHP



Proprietary

-----Original Message-----
From: Poling, William <PolingW at aetna.com> 
Sent: Monday, May 18, 2020 4:46 AM
To: r-sig-geo at r-project.org
Cc: Poling, William <PolingW at aetna.com>
Subject: Help with spTransform() function and final plot colors

#RStudio Version Version 1.2.1335
sessionInfo()
# R version 4.0.0 Patched (2020-05-03 r78349)
#Platform: x86_64-w64-mingw32/x64 (64-bit) #Running under: Windows 10 x64 (build 17763)

Hello. I am running my data through a routine I found that finds clusters of data points based on distance rule.
https://gis.stackexchange.com/questions/64392/finding-clusters-of-points-based-distance-rule-using-r

1. I get this error when I get to this point in the routine, see complete routine below?
xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84")) non finite transformation detected:

I tried converting columns from numeric to Integer but did not help.

However, I continue to run the rest of the routine and the final sequence, the plot itself, seems to work Can this error be corrected somehow, despite the fact that it continues to work, just curious what it is I guess"

2. However in the plot at the end of the routine the color key appears with the colors but the clusters in the plot are black, see plot call at the end of the routine below?

Thank you for any advice.

WHP

ERROR:
non finite transformation detected:
      coords.x1 coords.x2        
 [1,] -119.7339  39.53939 Inf Inf
 [2,] -119.7665  39.39630 Inf Inf
 [3,] -119.7794  39.28768 Inf Inf
 [4,] -121.0234  39.20503 Inf Inf
 [5,] -122.0047  47.19262 Inf Inf
 [6,] -122.0135  47.18883 Inf Inf
 [7,] -122.0379  47.52190 Inf Inf
 [8,] -122.0578  47.60975 Inf Inf
 [9,] -122.1330  47.13669 Inf Inf
[10,] -122.1509  47.55962 Inf Inf
[11,] -122.1706  47.15546 Inf Inf
[12,] -122.1846  47.23485 Inf Inf
[13,] -122.1846  48.15307 Inf Inf
[14,] -122.1851  47.44870 Inf Inf
[15,] -122.1954  47.68485 Inf Inf
[16,] -122.1990  47.51610 Inf Inf
[17,] -122.2014  47.44772 Inf Inf
[18,] -122.2025  47.69815 Inf Inf
[19,] -122.2037  47.67190 Inf Inf
[20,] -122.2090  47.40378 Inf Inf
[21,] -122.2108  47.25336 Inf Inf
[22,] -122.2291  47.63880 Inf Inf
[23,] -122.2419  47.76870 Inf Inf
[24,] -122.2722  48.04803 Inf Inf
[25,] -122.2732  47.87700 Inf Inf
[26,] -122.2804  47.77620 Inf Inf
[27,] -122.2839  47.82103 Inf Inf
[28,] -122.2890  47.86899 Inf Inf
[29,] -122.2993  47.67306 Inf Inf
[30,] -122.3180  47.38217 Inf Inf
[31,] -122.3270  47.40378 Inf Inf
[32,] -122.3474  47.43884 Inf Inf
[33,] -122.3484  47.53083 Inf Inf
[34,] -122.3581  47.27678 Inf Inf
[35,] -122.3618  47.76735 Inf Inf
[36,] -122.3700  47.56567 Inf Inf
[37,] -122.3908  47.54938 Inf Inf
[38,] -122.4128  47.64622 Inf Inf
[39,] -122.4293  47.17660 Inf Inf
[40,] -122.4621  47.44505 Inf Inf
[41,] -122.4904  47.27460 Inf Inf
[42,] -122.5515  46.93979 Inf Inf
[43,] -122.7348  42.37320 Inf Inf
[44,] -122.7827  47.31059 Inf Inf
[45,] -122.7987  47.23475 Inf Inf
[46,] -122.8385  42.35119 Inf Inf
[47,] -122.8537  42.34495 Inf Inf
[48,] -122.8904  42.39555 Inf Inf
[49,] -122.8927  42.33022 Inf Inf
[50,] -122.9451  47.37574 Inf Inf
[51,] -122.9594  42.30376 Inf Inf
[52,] -123.0641  47.16428 Inf Inf
[53,] -123.3413  42.44117 Inf Inf
Error in spTransform(xSP, CRSobj, ...) : 
  failure in points 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53
In addition: Warning message:
In spTransform(xSP, CRSobj, ...) : 53 projected point(s) not finite

Here is the data:
dput(sample)
structure(list(ID = 1:53, Longitude = c(-119.733899, -119.766493, -119.779416, -121.0234, -122.004736, -122.013456, -122.0379, -122.0578, -122.132971, -122.150901, -122.170608, -122.18462, -122.184639, -122.185079, -122.195398, -122.198994, -122.201356, -122.202507, -122.20371, -122.209047, -122.210797, -122.229095, -122.2419, -122.27216, -122.273164, -122.280355, -122.28389, -122.289043, -122.299261, -122.318009, -122.326987, -122.347382, -122.34844, -122.358115, -122.361839, -122.37003, -122.390815, -122.41282, -122.429323, -122.462136, -122.490417, -122.551483, -122.734847, -122.782736, -122.798669, -122.838498, -122.853683, -122.8904, -122.89271, -122.94511, -122.959407, -123.064087, -123.341346), Latitude = c(39.53939, 39.396298, 39.287681, 39.205028, 47.192616, 47.188833, 47.5219, 47.609748, 47.13669, 47.559616, 47.155455, 47.234849, 48.15307, 47.448697, 47.684854, 47.516104, 47.447723, 47.698146, 47.6719, 47.403778, 47.253364, 47.638795, 47.768701, 48.048027, 47.876997, 47.776205, 47.821029, 47.868987, 47.673056, 47.382165, 47.403785, 47.438836, 47.530831, 47.276776, 47.76735, 47.565667, 47.549377, 47.646222, 47.176596, 47.445053, 47.274599, 46.939789, 42.373195, 47.310595, 47.234748, 42.351189, 42.344953, 42.395547, 42.33022, 47.375736, 42.303755, 47.164278, 42.441172)), class = "data.frame", row.names = c(NA, -53L))

Here is the routine:
require(sp)
require(rgdal)
#25*1609.34 = 40233.5      
dis <- 40233.5 #Distance threshold 25miles converted to meters

x <- tmp1b[,c(6)]
head(x)
y <- tmp1b[,c(5)]
head(y)
str(y)

xy <- SpatialPointsDataFrame(matrix(c(x,y), ncol=2), data.frame(ID=seq(1:length(x))),
                             proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))

str(xy)

xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84"))#Error occurring here?

chc <- hclust(dist(data.frame(rownames=rownames(xy at data), x=coordinates(xy)[,1], #What is xy at data???? see str(xy)
                              y=coordinates(xy)[,2])), method="complete")
str(chc)

view(xy at data)#Look like 3 clusters

# Distance with a 25 Mile threshold
chc.dis <- cutree(chc, h=dis)
str(chc.dis)
view(chc.dis)

# Join results to meuse sp points
xy at data <- data.frame(xy at data, Clust=chc.dis)
str(xy at data)
view(xy at data)

# Plot results
plot(xy, col=factor(xy at data$Clust), pch=19)
box(col="black")
title(main="Clustering")
legend("topleft", legend=paste("Cluster", 1:3,sep=""),#Change from 4 in demo to 3 in my data
       col=palette()[1:3], pch=rep(19,3), bg="white")


Proprietary

NOTICE TO RECIPIENT OF INFORMATION:\ This e-mail may con...{{dropped:16}}


From Po||ngW @end|ng |rom @etn@@com  Mon May 18 11:47:57 2020
From: Po||ngW @end|ng |rom @etn@@com (Poling, William)
Date: Mon, 18 May 2020 09:47:57 +0000
Subject: [R-sig-Geo] 
 Help with spTransform() function and final plot colors
In-Reply-To: <BYAPR06MB5383B66F7659CC4A348098C5AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
References: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
 <BYAPR06MB5383B66F7659CC4A348098C5AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
Message-ID: <BYAPR06MB5383C7301CF94003DA8A3E5DAEB80@BYAPR06MB5383.namprd06.prod.outlook.com>

Hello, I have found an additional problem.

I should be getting 3 columns back in the xy at data at some point.
$ ID                           : int  1 2 3 4 5 6 7 8 9 10 ...
# $ Clust                  : int  1 1 1 1 1 1 1 1 1 1 ... This is always - 1
# $ Clust.1               : int  1 1 1 1 1 1 1 1 1 1 ... This would be the cluster number, like 1-3, I am not getting this column back?


Yet the plot runs and indicates three different clusters?



WHP


Proprietary

-----Original Message-----
From: Poling, William <PolingW at aetna.com> 
Sent: Monday, May 18, 2020 4:47 AM
To: r-sig-geo at r-project.org
Cc: Poling, William <PolingW at aetna.com>
Subject: RE: Help with spTransform() function and final plot colors

Hello, I have found an additional problem.

I should be getting 3 columns back in the xy at data at some point.
$ ID                           : int  1 2 3 4 5 6 7 8 9 10 ...
# $ Clust                  : int  1 1 1 1 1 1 1 1 1 1 ... This is always - 1
# $ Clust.1               : int  1 1 1 1 1 1 1 1 1 1 ... This would be the cluster number, like 1-3, I am not getting this column back?


Yet the plot runs and indicates three different clusters?



WHP



Proprietary

-----Original Message-----
From: Poling, William <PolingW at aetna.com> 
Sent: Monday, May 18, 2020 4:46 AM
To: r-sig-geo at r-project.org
Cc: Poling, William <PolingW at aetna.com>
Subject: Help with spTransform() function and final plot colors

#RStudio Version Version 1.2.1335
sessionInfo()
# R version 4.0.0 Patched (2020-05-03 r78349)
#Platform: x86_64-w64-mingw32/x64 (64-bit) #Running under: Windows 10 x64 (build 17763)

Hello. I am running my data through a routine I found that finds clusters of data points based on distance rule.
https://gis.stackexchange.com/questions/64392/finding-clusters-of-points-based-distance-rule-using-r

1. I get this error when I get to this point in the routine, see complete routine below?
xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84")) non finite transformation detected:

I tried converting columns from numeric to Integer but did not help.

However, I continue to run the rest of the routine and the final sequence, the plot itself, seems to work Can this error be corrected somehow, despite the fact that it continues to work, just curious what it is I guess"

2. However in the plot at the end of the routine the color key appears with the colors but the clusters in the plot are black, see plot call at the end of the routine below?

Thank you for any advice.

WHP

ERROR:
non finite transformation detected:
      coords.x1 coords.x2        
 [1,] -119.7339  39.53939 Inf Inf
 [2,] -119.7665  39.39630 Inf Inf
 [3,] -119.7794  39.28768 Inf Inf
 [4,] -121.0234  39.20503 Inf Inf
 [5,] -122.0047  47.19262 Inf Inf
 [6,] -122.0135  47.18883 Inf Inf
 [7,] -122.0379  47.52190 Inf Inf
 [8,] -122.0578  47.60975 Inf Inf
 [9,] -122.1330  47.13669 Inf Inf
[10,] -122.1509  47.55962 Inf Inf
[11,] -122.1706  47.15546 Inf Inf
[12,] -122.1846  47.23485 Inf Inf
[13,] -122.1846  48.15307 Inf Inf
[14,] -122.1851  47.44870 Inf Inf
[15,] -122.1954  47.68485 Inf Inf
[16,] -122.1990  47.51610 Inf Inf
[17,] -122.2014  47.44772 Inf Inf
[18,] -122.2025  47.69815 Inf Inf
[19,] -122.2037  47.67190 Inf Inf
[20,] -122.2090  47.40378 Inf Inf
[21,] -122.2108  47.25336 Inf Inf
[22,] -122.2291  47.63880 Inf Inf
[23,] -122.2419  47.76870 Inf Inf
[24,] -122.2722  48.04803 Inf Inf
[25,] -122.2732  47.87700 Inf Inf
[26,] -122.2804  47.77620 Inf Inf
[27,] -122.2839  47.82103 Inf Inf
[28,] -122.2890  47.86899 Inf Inf
[29,] -122.2993  47.67306 Inf Inf
[30,] -122.3180  47.38217 Inf Inf
[31,] -122.3270  47.40378 Inf Inf
[32,] -122.3474  47.43884 Inf Inf
[33,] -122.3484  47.53083 Inf Inf
[34,] -122.3581  47.27678 Inf Inf
[35,] -122.3618  47.76735 Inf Inf
[36,] -122.3700  47.56567 Inf Inf
[37,] -122.3908  47.54938 Inf Inf
[38,] -122.4128  47.64622 Inf Inf
[39,] -122.4293  47.17660 Inf Inf
[40,] -122.4621  47.44505 Inf Inf
[41,] -122.4904  47.27460 Inf Inf
[42,] -122.5515  46.93979 Inf Inf
[43,] -122.7348  42.37320 Inf Inf
[44,] -122.7827  47.31059 Inf Inf
[45,] -122.7987  47.23475 Inf Inf
[46,] -122.8385  42.35119 Inf Inf
[47,] -122.8537  42.34495 Inf Inf
[48,] -122.8904  42.39555 Inf Inf
[49,] -122.8927  42.33022 Inf Inf
[50,] -122.9451  47.37574 Inf Inf
[51,] -122.9594  42.30376 Inf Inf
[52,] -123.0641  47.16428 Inf Inf
[53,] -123.3413  42.44117 Inf Inf
Error in spTransform(xSP, CRSobj, ...) : 
  failure in points 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53
In addition: Warning message:
In spTransform(xSP, CRSobj, ...) : 53 projected point(s) not finite

Here is the data:
dput(sample)
structure(list(ID = 1:53, Longitude = c(-119.733899, -119.766493, -119.779416, -121.0234, -122.004736, -122.013456, -122.0379, -122.0578, -122.132971, -122.150901, -122.170608, -122.18462, -122.184639, -122.185079, -122.195398, -122.198994, -122.201356, -122.202507, -122.20371, -122.209047, -122.210797, -122.229095, -122.2419, -122.27216, -122.273164, -122.280355, -122.28389, -122.289043, -122.299261, -122.318009, -122.326987, -122.347382, -122.34844, -122.358115, -122.361839, -122.37003, -122.390815, -122.41282, -122.429323, -122.462136, -122.490417, -122.551483, -122.734847, -122.782736, -122.798669, -122.838498, -122.853683, -122.8904, -122.89271, -122.94511, -122.959407, -123.064087, -123.341346), Latitude = c(39.53939, 39.396298, 39.287681, 39.205028, 47.192616, 47.188833, 47.5219, 47.609748, 47.13669, 47.559616, 47.155455, 47.234849, 48.15307, 47.448697, 47.684854, 47.516104, 47.447723, 47.698146, 47.6719, 47.403778, 47.253364, 47.638795, 47.768701, 48.048027, 47.876997, 47.776205, 47.821029, 47.868987, 47.673056, 47.382165, 47.403785, 47.438836, 47.530831, 47.276776, 47.76735, 47.565667, 47.549377, 47.646222, 47.176596, 47.445053, 47.274599, 46.939789, 42.373195, 47.310595, 47.234748, 42.351189, 42.344953, 42.395547, 42.33022, 47.375736, 42.303755, 47.164278, 42.441172)), class = "data.frame", row.names = c(NA, -53L))

Here is the routine:
require(sp)
require(rgdal)
#25*1609.34 = 40233.5      
dis <- 40233.5 #Distance threshold 25miles converted to meters

x <- tmp1b[,c(6)]
head(x)
y <- tmp1b[,c(5)]
head(y)
str(y)

xy <- SpatialPointsDataFrame(matrix(c(x,y), ncol=2), data.frame(ID=seq(1:length(x))),
                             proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))

str(xy)

xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84"))#Error occurring here?

chc <- hclust(dist(data.frame(rownames=rownames(xy at data), x=coordinates(xy)[,1], #What is xy at data???? see str(xy)
                              y=coordinates(xy)[,2])), method="complete")
str(chc)

view(xy at data)#Look like 3 clusters

# Distance with a 25 Mile threshold
chc.dis <- cutree(chc, h=dis)
str(chc.dis)
view(chc.dis)

# Join results to meuse sp points
xy at data <- data.frame(xy at data, Clust=chc.dis)
str(xy at data)
view(xy at data)

# Plot results
plot(xy, col=factor(xy at data$Clust), pch=19)
box(col="black")
title(main="Clustering")
legend("topleft", legend=paste("Cluster", 1:3,sep=""),#Change from 4 in demo to 3 in my data
       col=palette()[1:3], pch=rep(19,3), bg="white")


Proprietary

NOTICE TO RECIPIENT OF INFORMATION:\ This e-mail may con...{{dropped:16}}


From Po||ngW @end|ng |rom @etn@@com  Mon May 18 11:49:06 2020
From: Po||ngW @end|ng |rom @etn@@com (Poling, William)
Date: Mon, 18 May 2020 09:49:06 +0000
Subject: [R-sig-Geo] 
 Help with spTransform() function and final plot colors
In-Reply-To: <BYAPR06MB5383B66F7659CC4A348098C5AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
References: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
 <BYAPR06MB5383B66F7659CC4A348098C5AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
Message-ID: <BYAPR06MB538386C4634069C730E6F525AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>

Hello again.

I also found this discussion on non-finite transformation error, however, I am not sure what to look for in the output after I apply my data?

https://stackoverflow.com/questions/14880294/non-finite-transformation-detected-in-sptransform-in-rgdal-r-package



str(sample)
GPS.Points <- sample[,c(2,3)]

n_chunks <- 3 #number of pieces you will break you data into n.points <- dim(GPS.Points)[1] breaks <- seq(1,n.points, by=round(n.points/n_chunks)) breaks <- c(breaks, n.points) #make sure to include last points as well

i=1
for (i in 1:(length(breaks)-1)){
  cat('\n','converting points', breaks[i], "to", breaks[i+1])
  temp.GPS.Points=GPS.Points[breaks[i]:breaks[i+1],]
  temp.GPS.Points.Spatial.Data <- SpatialPoints(temp.GPS.Points, 
                                                proj4string=CRS("+proj=longlat +ellps=WGS84"))
  temp.GPS.Points.UTM.Spatial.Data <- spTransform(temp.GPS.Points.Spatial.Data,
                                                  CRS("+proj=utm +south +zone=34 
+ellps=WGS84"))
}

Thank you for any advice.

WHP


Proprietary

-----Original Message-----
From: Poling, William <PolingW at aetna.com> 
Sent: Monday, May 18, 2020 4:47 AM
To: r-sig-geo at r-project.org
Cc: Poling, William <PolingW at aetna.com>
Subject: RE: Help with spTransform() function and final plot colors

Hello, I have found an additional problem.

I should be getting 3 columns back in the xy at data at some point.
$ ID                           : int  1 2 3 4 5 6 7 8 9 10 ...
# $ Clust                  : int  1 1 1 1 1 1 1 1 1 1 ... This is always - 1
# $ Clust.1               : int  1 1 1 1 1 1 1 1 1 1 ... This would be the cluster number, like 1-3, I am not getting this column back?


Yet the plot runs and indicates three different clusters?



WHP



Proprietary

-----Original Message-----
From: Poling, William <PolingW at aetna.com> 
Sent: Monday, May 18, 2020 4:46 AM
To: r-sig-geo at r-project.org
Cc: Poling, William <PolingW at aetna.com>
Subject: Help with spTransform() function and final plot colors

#RStudio Version Version 1.2.1335
sessionInfo()
# R version 4.0.0 Patched (2020-05-03 r78349)
#Platform: x86_64-w64-mingw32/x64 (64-bit) #Running under: Windows 10 x64 (build 17763)

Hello. I am running my data through a routine I found that finds clusters of data points based on distance rule.
https://gis.stackexchange.com/questions/64392/finding-clusters-of-points-based-distance-rule-using-r

1. I get this error when I get to this point in the routine, see complete routine below?
xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84")) non finite transformation detected:

I tried converting columns from numeric to Integer but did not help.

However, I continue to run the rest of the routine and the final sequence, the plot itself, seems to work Can this error be corrected somehow, despite the fact that it continues to work, just curious what it is I guess"

2. However in the plot at the end of the routine the color key appears with the colors but the clusters in the plot are black, see plot call at the end of the routine below?

Thank you for any advice.

WHP

ERROR:
non finite transformation detected:
      coords.x1 coords.x2        
 [1,] -119.7339  39.53939 Inf Inf
 [2,] -119.7665  39.39630 Inf Inf
 [3,] -119.7794  39.28768 Inf Inf
 [4,] -121.0234  39.20503 Inf Inf
 [5,] -122.0047  47.19262 Inf Inf
 [6,] -122.0135  47.18883 Inf Inf
 [7,] -122.0379  47.52190 Inf Inf
 [8,] -122.0578  47.60975 Inf Inf
 [9,] -122.1330  47.13669 Inf Inf
[10,] -122.1509  47.55962 Inf Inf
[11,] -122.1706  47.15546 Inf Inf
[12,] -122.1846  47.23485 Inf Inf
[13,] -122.1846  48.15307 Inf Inf
[14,] -122.1851  47.44870 Inf Inf
[15,] -122.1954  47.68485 Inf Inf
[16,] -122.1990  47.51610 Inf Inf
[17,] -122.2014  47.44772 Inf Inf
[18,] -122.2025  47.69815 Inf Inf
[19,] -122.2037  47.67190 Inf Inf
[20,] -122.2090  47.40378 Inf Inf
[21,] -122.2108  47.25336 Inf Inf
[22,] -122.2291  47.63880 Inf Inf
[23,] -122.2419  47.76870 Inf Inf
[24,] -122.2722  48.04803 Inf Inf
[25,] -122.2732  47.87700 Inf Inf
[26,] -122.2804  47.77620 Inf Inf
[27,] -122.2839  47.82103 Inf Inf
[28,] -122.2890  47.86899 Inf Inf
[29,] -122.2993  47.67306 Inf Inf
[30,] -122.3180  47.38217 Inf Inf
[31,] -122.3270  47.40378 Inf Inf
[32,] -122.3474  47.43884 Inf Inf
[33,] -122.3484  47.53083 Inf Inf
[34,] -122.3581  47.27678 Inf Inf
[35,] -122.3618  47.76735 Inf Inf
[36,] -122.3700  47.56567 Inf Inf
[37,] -122.3908  47.54938 Inf Inf
[38,] -122.4128  47.64622 Inf Inf
[39,] -122.4293  47.17660 Inf Inf
[40,] -122.4621  47.44505 Inf Inf
[41,] -122.4904  47.27460 Inf Inf
[42,] -122.5515  46.93979 Inf Inf
[43,] -122.7348  42.37320 Inf Inf
[44,] -122.7827  47.31059 Inf Inf
[45,] -122.7987  47.23475 Inf Inf
[46,] -122.8385  42.35119 Inf Inf
[47,] -122.8537  42.34495 Inf Inf
[48,] -122.8904  42.39555 Inf Inf
[49,] -122.8927  42.33022 Inf Inf
[50,] -122.9451  47.37574 Inf Inf
[51,] -122.9594  42.30376 Inf Inf
[52,] -123.0641  47.16428 Inf Inf
[53,] -123.3413  42.44117 Inf Inf
Error in spTransform(xSP, CRSobj, ...) : 
  failure in points 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53
In addition: Warning message:
In spTransform(xSP, CRSobj, ...) : 53 projected point(s) not finite

Here is the data:
dput(sample)
structure(list(ID = 1:53, Longitude = c(-119.733899, -119.766493, -119.779416, -121.0234, -122.004736, -122.013456, -122.0379, -122.0578, -122.132971, -122.150901, -122.170608, -122.18462, -122.184639, -122.185079, -122.195398, -122.198994, -122.201356, -122.202507, -122.20371, -122.209047, -122.210797, -122.229095, -122.2419, -122.27216, -122.273164, -122.280355, -122.28389, -122.289043, -122.299261, -122.318009, -122.326987, -122.347382, -122.34844, -122.358115, -122.361839, -122.37003, -122.390815, -122.41282, -122.429323, -122.462136, -122.490417, -122.551483, -122.734847, -122.782736, -122.798669, -122.838498, -122.853683, -122.8904, -122.89271, -122.94511, -122.959407, -123.064087, -123.341346), Latitude = c(39.53939, 39.396298, 39.287681, 39.205028, 47.192616, 47.188833, 47.5219, 47.609748, 47.13669, 47.559616, 47.155455, 47.234849, 48.15307, 47.448697, 47.684854, 47.516104, 47.447723, 47.698146, 47.6719, 47.403778, 47.253364, 47.638795, 47.768701, 48.048027, 47.876997, 47.776205, 47.821029, 47.868987, 47.673056, 47.382165, 47.403785, 47.438836, 47.530831, 47.276776, 47.76735, 47.565667, 47.549377, 47.646222, 47.176596, 47.445053, 47.274599, 46.939789, 42.373195, 47.310595, 47.234748, 42.351189, 42.344953, 42.395547, 42.33022, 47.375736, 42.303755, 47.164278, 42.441172)), class = "data.frame", row.names = c(NA, -53L))

Here is the routine:
require(sp)
require(rgdal)
#25*1609.34 = 40233.5      
dis <- 40233.5 #Distance threshold 25miles converted to meters

x <- tmp1b[,c(6)]
head(x)
y <- tmp1b[,c(5)]
head(y)
str(y)

xy <- SpatialPointsDataFrame(matrix(c(x,y), ncol=2), data.frame(ID=seq(1:length(x))),
                             proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))

str(xy)

xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84"))#Error occurring here?

chc <- hclust(dist(data.frame(rownames=rownames(xy at data), x=coordinates(xy)[,1], #What is xy at data???? see str(xy)
                              y=coordinates(xy)[,2])), method="complete")
str(chc)

view(xy at data)#Look like 3 clusters

# Distance with a 25 Mile threshold
chc.dis <- cutree(chc, h=dis)
str(chc.dis)
view(chc.dis)

# Join results to meuse sp points
xy at data <- data.frame(xy at data, Clust=chc.dis)
str(xy at data)
view(xy at data)

# Plot results
plot(xy, col=factor(xy at data$Clust), pch=19)
box(col="black")
title(main="Clustering")
legend("topleft", legend=paste("Cluster", 1:3,sep=""),#Change from 4 in demo to 3 in my data
       col=palette()[1:3], pch=rep(19,3), bg="white")


Proprietary

NOTICE TO RECIPIENT OF INFORMATION:\ This e-mail may con...{{dropped:16}}


From md@umner @end|ng |rom gm@||@com  Mon May 18 12:02:22 2020
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Mon, 18 May 2020 20:02:22 +1000
Subject: [R-sig-Geo] 
 Help with spTransform() function and final plot colors
In-Reply-To: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
References: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
Message-ID: <CAAcGz9_6LxA0oct77Q5TCMJBJ4Zj6TCdhNUiv8Jrz3q0HLvvHQ@mail.gmail.com>

Hi, your longlat coordinates are in the western hemisphere (-119, 39) but
EPSG 27700 is designed for (and appropriate for some scenarios) somewhere
in the UK. You need a local projection suitable for the area you are in.
Look for an EPSG for your region, or maybe Albers conic or Lambert
Azimuthal local authority (look on a paper map if you have one). Or define
your own with projstrings (or wkt, it's a bit complicated atm to advise
simple construction). There's some discussion here:
https://geocompr.robinlovelace.net/reproj-geo-data.html#which-crs-to-use

Some will say use UTM, but you should not unless it's a particular local
one used commonly in your work and the region the data is from.

HTH, Mike





On Mon., 18 May 2020, 19:46 Poling, William via R-sig-Geo, <
r-sig-geo at r-project.org> wrote:

> #RStudio Version Version 1.2.1335
> sessionInfo()
> # R version 4.0.0 Patched (2020-05-03 r78349)
> #Platform: x86_64-w64-mingw32/x64 (64-bit) #Running under: Windows 10 x64
> (build 17763)
>
> Hello. I am running my data through a routine I found that finds clusters
> of data points based on distance rule.
>
> https://gis.stackexchange.com/questions/64392/finding-clusters-of-points-based-distance-rule-using-r
>
> 1. I get this error when I get to this point in the routine, see complete
> routine below?
> xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84")) non finite
> transformation detected:
>
> I tried converting columns from numeric to Integer but did not help.
>
> However, I continue to run the rest of the routine and the final sequence,
> the plot itself, seems to work Can this error be corrected somehow, despite
> the fact that it continues to work, just curious what it is I guess"
>
> 2. However in the plot at the end of the routine the color key appears
> with the colors but the clusters in the plot are black, see plot call at
> the end of the routine below?
>
> Thank you for any advice.
>
> WHP
>
> ERROR:
> non finite transformation detected:
>       coords.x1 coords.x2
>  [1,] -119.7339  39.53939 Inf Inf
>  [2,] -119.7665  39.39630 Inf Inf
>  [3,] -119.7794  39.28768 Inf Inf
>  [4,] -121.0234  39.20503 Inf Inf
>  [5,] -122.0047  47.19262 Inf Inf
>  [6,] -122.0135  47.18883 Inf Inf
>  [7,] -122.0379  47.52190 Inf Inf
>  [8,] -122.0578  47.60975 Inf Inf
>  [9,] -122.1330  47.13669 Inf Inf
> [10,] -122.1509  47.55962 Inf Inf
> [11,] -122.1706  47.15546 Inf Inf
> [12,] -122.1846  47.23485 Inf Inf
> [13,] -122.1846  48.15307 Inf Inf
> [14,] -122.1851  47.44870 Inf Inf
> [15,] -122.1954  47.68485 Inf Inf
> [16,] -122.1990  47.51610 Inf Inf
> [17,] -122.2014  47.44772 Inf Inf
> [18,] -122.2025  47.69815 Inf Inf
> [19,] -122.2037  47.67190 Inf Inf
> [20,] -122.2090  47.40378 Inf Inf
> [21,] -122.2108  47.25336 Inf Inf
> [22,] -122.2291  47.63880 Inf Inf
> [23,] -122.2419  47.76870 Inf Inf
> [24,] -122.2722  48.04803 Inf Inf
> [25,] -122.2732  47.87700 Inf Inf
> [26,] -122.2804  47.77620 Inf Inf
> [27,] -122.2839  47.82103 Inf Inf
> [28,] -122.2890  47.86899 Inf Inf
> [29,] -122.2993  47.67306 Inf Inf
> [30,] -122.3180  47.38217 Inf Inf
> [31,] -122.3270  47.40378 Inf Inf
> [32,] -122.3474  47.43884 Inf Inf
> [33,] -122.3484  47.53083 Inf Inf
> [34,] -122.3581  47.27678 Inf Inf
> [35,] -122.3618  47.76735 Inf Inf
> [36,] -122.3700  47.56567 Inf Inf
> [37,] -122.3908  47.54938 Inf Inf
> [38,] -122.4128  47.64622 Inf Inf
> [39,] -122.4293  47.17660 Inf Inf
> [40,] -122.4621  47.44505 Inf Inf
> [41,] -122.4904  47.27460 Inf Inf
> [42,] -122.5515  46.93979 Inf Inf
> [43,] -122.7348  42.37320 Inf Inf
> [44,] -122.7827  47.31059 Inf Inf
> [45,] -122.7987  47.23475 Inf Inf
> [46,] -122.8385  42.35119 Inf Inf
> [47,] -122.8537  42.34495 Inf Inf
> [48,] -122.8904  42.39555 Inf Inf
> [49,] -122.8927  42.33022 Inf Inf
> [50,] -122.9451  47.37574 Inf Inf
> [51,] -122.9594  42.30376 Inf Inf
> [52,] -123.0641  47.16428 Inf Inf
> [53,] -123.3413  42.44117 Inf Inf
> Error in spTransform(xSP, CRSobj, ...) :
>   failure in points
> 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53
> In addition: Warning message:
> In spTransform(xSP, CRSobj, ...) : 53 projected point(s) not finite
>
> Here is the data:
> dput(sample)
> structure(list(ID = 1:53, Longitude = c(-119.733899, -119.766493,
> -119.779416, -121.0234, -122.004736, -122.013456, -122.0379, -122.0578,
> -122.132971, -122.150901, -122.170608, -122.18462, -122.184639,
> -122.185079, -122.195398, -122.198994, -122.201356, -122.202507,
> -122.20371, -122.209047, -122.210797, -122.229095, -122.2419, -122.27216,
> -122.273164, -122.280355, -122.28389, -122.289043, -122.299261,
> -122.318009, -122.326987, -122.347382, -122.34844, -122.358115,
> -122.361839, -122.37003, -122.390815, -122.41282, -122.429323, -122.462136,
> -122.490417, -122.551483, -122.734847, -122.782736, -122.798669,
> -122.838498, -122.853683, -122.8904, -122.89271, -122.94511, -122.959407,
> -123.064087, -123.341346), Latitude = c(39.53939, 39.396298, 39.287681,
> 39.205028, 47.192616, 47.188833, 47.5219, 47.609748, 47.13669, 47.559616,
> 47.155455, 47.234849, 48.15307, 47.448697, 47.684854, 47.516104, 47.447723,
> 47.698146, 47.6719, 47.403778, 47.253364, 47.638795, 47.768701, 48.048027,
> 47.876997, 47.776205, 47.821029, 47.868987, 47.673056, 47.382165,
> 47.403785, 47.438836, 47.530831, 47.276776, 47.76735, 47.565667, 47.549377,
> 47.646222, 47.176596, 47.445053, 47.274599, 46.939789, 42.373195,
> 47.310595, 47.234748, 42.351189, 42.344953, 42.395547, 42.33022, 47.375736,
> 42.303755, 47.164278, 42.441172)), class = "data.frame", row.names = c(NA,
> -53L))
>
> Here is the routine:
> require(sp)
> require(rgdal)
> #25*1609.34 = 40233.5
> dis <- 40233.5 #Distance threshold 25miles converted to meters
>
> x <- tmp1b[,c(6)]
> head(x)
> y <- tmp1b[,c(5)]
> head(y)
> str(y)
>
> xy <- SpatialPointsDataFrame(matrix(c(x,y), ncol=2),
> data.frame(ID=seq(1:length(x))),
>                              proj4string=CRS("+proj=longlat +ellps=WGS84
> +datum=WGS84"))
>
> str(xy)
>
> xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84"))#Error
> occurring here?
>
> chc <- hclust(dist(data.frame(rownames=rownames(xy at data),
> x=coordinates(xy)[,1], #What is xy at data???? see str(xy)
>                               y=coordinates(xy)[,2])), method="complete")
> str(chc)
>
> view(xy at data)#Look like 3 clusters
>
> # Distance with a 25 Mile threshold
> chc.dis <- cutree(chc, h=dis)
> str(chc.dis)
> view(chc.dis)
>
> # Join results to meuse sp points
> xy at data <- data.frame(xy at data, Clust=chc.dis)
> str(xy at data)
> view(xy at data)
>
> # Plot results
> plot(xy, col=factor(xy at data$Clust), pch=19)
> box(col="black")
> title(main="Clustering")
> legend("topleft", legend=paste("Cluster", 1:3,sep=""),#Change from 4 in
> demo to 3 in my data
>        col=palette()[1:3], pch=rep(19,3), bg="white")
>
>
> Proprietary
>
> NOTICE TO RECIPIENT OF INFORMATION:\ This e-mail may con...{{dropped:16}}
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Mon May 18 12:34:18 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 18 May 2020 12:34:18 +0200
Subject: [R-sig-Geo] 
 Help with spTransform() function and final plot colors
In-Reply-To: <BYAPR06MB5383C7301CF94003DA8A3E5DAEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
References: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
 <BYAPR06MB5383B66F7659CC4A348098C5AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
 <BYAPR06MB5383C7301CF94003DA8A3E5DAEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
Message-ID: <alpine.LFD.2.22.394.2005181224180.69936@reclus.nhh.no>

This messy thread was on R-help first, and comes from a corporation able 
to pay for consulting help. It contains no reproducible example, and 
"+init=epsg:27700 +datum=WGS84" qualifies to fail GIS001 (the datum of 
OSGB is NOT WGS84, the same evident blunder is in the copied&pasted SO 
"code"). No mention is made of the versions of the packages used (as 
printed to the console when rgdal is loaded or from 
rgdal::extSoftVersion(), and no motivation is given.

If the OP really needs assistance, this list expects a fully reproducible 
example using a built-in data set - the SO query seems to refer to Meuse.

Roger

On Mon, 18 May 2020, Poling, William via R-sig-Geo wrote:

> Hello, I have found an additional problem.
>
> I should be getting 3 columns back in the xy at data at some point.
> $ ID                           : int  1 2 3 4 5 6 7 8 9 10 ...
> # $ Clust                  : int  1 1 1 1 1 1 1 1 1 1 ... This is always - 1
> # $ Clust.1               : int  1 1 1 1 1 1 1 1 1 1 ... This would be the cluster number, like 1-3, I am not getting this column back?
>
>
> Yet the plot runs and indicates three different clusters?
>
>
>
> WHP
>
>
> Proprietary
>
> -----Original Message-----
> From: Poling, William <PolingW at aetna.com>
> Sent: Monday, May 18, 2020 4:47 AM
> To: r-sig-geo at r-project.org
> Cc: Poling, William <PolingW at aetna.com>
> Subject: RE: Help with spTransform() function and final plot colors
>
> Hello, I have found an additional problem.
>
> I should be getting 3 columns back in the xy at data at some point.
> $ ID                           : int  1 2 3 4 5 6 7 8 9 10 ...
> # $ Clust                  : int  1 1 1 1 1 1 1 1 1 1 ... This is always - 1
> # $ Clust.1               : int  1 1 1 1 1 1 1 1 1 1 ... This would be the cluster number, like 1-3, I am not getting this column back?
>
>
> Yet the plot runs and indicates three different clusters?
>
>
>
> WHP
>
>
>
> Proprietary
>
> -----Original Message-----
> From: Poling, William <PolingW at aetna.com>
> Sent: Monday, May 18, 2020 4:46 AM
> To: r-sig-geo at r-project.org
> Cc: Poling, William <PolingW at aetna.com>
> Subject: Help with spTransform() function and final plot colors
>
> #RStudio Version Version 1.2.1335
> sessionInfo()
> # R version 4.0.0 Patched (2020-05-03 r78349)
> #Platform: x86_64-w64-mingw32/x64 (64-bit) #Running under: Windows 10 x64 (build 17763)
>
> Hello. I am running my data through a routine I found that finds clusters of data points based on distance rule.
> https://gis.stackexchange.com/questions/64392/finding-clusters-of-points-based-distance-rule-using-r
>
> 1. I get this error when I get to this point in the routine, see complete routine below?
> xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84")) non finite transformation detected:
>
> I tried converting columns from numeric to Integer but did not help.
>
> However, I continue to run the rest of the routine and the final sequence, the plot itself, seems to work Can this error be corrected somehow, despite the fact that it continues to work, just curious what it is I guess"
>
> 2. However in the plot at the end of the routine the color key appears with the colors but the clusters in the plot are black, see plot call at the end of the routine below?
>
> Thank you for any advice.
>
> WHP
>
> ERROR:
> non finite transformation detected:
>      coords.x1 coords.x2
> [1,] -119.7339  39.53939 Inf Inf
> [2,] -119.7665  39.39630 Inf Inf
> [3,] -119.7794  39.28768 Inf Inf
> [4,] -121.0234  39.20503 Inf Inf
> [5,] -122.0047  47.19262 Inf Inf
> [6,] -122.0135  47.18883 Inf Inf
> [7,] -122.0379  47.52190 Inf Inf
> [8,] -122.0578  47.60975 Inf Inf
> [9,] -122.1330  47.13669 Inf Inf
> [10,] -122.1509  47.55962 Inf Inf
> [11,] -122.1706  47.15546 Inf Inf
> [12,] -122.1846  47.23485 Inf Inf
> [13,] -122.1846  48.15307 Inf Inf
> [14,] -122.1851  47.44870 Inf Inf
> [15,] -122.1954  47.68485 Inf Inf
> [16,] -122.1990  47.51610 Inf Inf
> [17,] -122.2014  47.44772 Inf Inf
> [18,] -122.2025  47.69815 Inf Inf
> [19,] -122.2037  47.67190 Inf Inf
> [20,] -122.2090  47.40378 Inf Inf
> [21,] -122.2108  47.25336 Inf Inf
> [22,] -122.2291  47.63880 Inf Inf
> [23,] -122.2419  47.76870 Inf Inf
> [24,] -122.2722  48.04803 Inf Inf
> [25,] -122.2732  47.87700 Inf Inf
> [26,] -122.2804  47.77620 Inf Inf
> [27,] -122.2839  47.82103 Inf Inf
> [28,] -122.2890  47.86899 Inf Inf
> [29,] -122.2993  47.67306 Inf Inf
> [30,] -122.3180  47.38217 Inf Inf
> [31,] -122.3270  47.40378 Inf Inf
> [32,] -122.3474  47.43884 Inf Inf
> [33,] -122.3484  47.53083 Inf Inf
> [34,] -122.3581  47.27678 Inf Inf
> [35,] -122.3618  47.76735 Inf Inf
> [36,] -122.3700  47.56567 Inf Inf
> [37,] -122.3908  47.54938 Inf Inf
> [38,] -122.4128  47.64622 Inf Inf
> [39,] -122.4293  47.17660 Inf Inf
> [40,] -122.4621  47.44505 Inf Inf
> [41,] -122.4904  47.27460 Inf Inf
> [42,] -122.5515  46.93979 Inf Inf
> [43,] -122.7348  42.37320 Inf Inf
> [44,] -122.7827  47.31059 Inf Inf
> [45,] -122.7987  47.23475 Inf Inf
> [46,] -122.8385  42.35119 Inf Inf
> [47,] -122.8537  42.34495 Inf Inf
> [48,] -122.8904  42.39555 Inf Inf
> [49,] -122.8927  42.33022 Inf Inf
> [50,] -122.9451  47.37574 Inf Inf
> [51,] -122.9594  42.30376 Inf Inf
> [52,] -123.0641  47.16428 Inf Inf
> [53,] -123.3413  42.44117 Inf Inf
> Error in spTransform(xSP, CRSobj, ...) :
>  failure in points 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53
> In addition: Warning message:
> In spTransform(xSP, CRSobj, ...) : 53 projected point(s) not finite
>
> Here is the data:
> dput(sample)
> structure(list(ID = 1:53, Longitude = c(-119.733899, -119.766493, -119.779416, -121.0234, -122.004736, -122.013456, -122.0379, -122.0578, -122.132971, -122.150901, -122.170608, -122.18462, -122.184639, -122.185079, -122.195398, -122.198994, -122.201356, -122.202507, -122.20371, -122.209047, -122.210797, -122.229095, -122.2419, -122.27216, -122.273164, -122.280355, -122.28389, -122.289043, -122.299261, -122.318009, -122.326987, -122.347382, -122.34844, -122.358115, -122.361839, -122.37003, -122.390815, -122.41282, -122.429323, -122.462136, -122.490417, -122.551483, -122.734847, -122.782736, -122.798669, -122.838498, -122.853683, -122.8904, -122.89271, -122.94511, -122.959407, -123.064087, -123.341346), Latitude = c(39.53939, 39.396298, 39.287681, 39.205028, 47.192616, 47.188833, 47.5219, 47.609748, 47.13669, 47.559616, 47.155455, 47.234849, 48.15307, 47.448697, 47.684854, 47.516104, 47.447723, 47.698146, 47.6719, 47.403778, 47.253364, 47.638795, 47.768701, 48.048027, 47.876997, 47.776205, 47.821029, 47.868987, 47.673056, 47.382165, 47.403785, 47.438836, 47.530831, 47.276776, 47.76735, 47.565667, 47.549377, 47.646222, 47.176596, 47.445053, 47.274599, 46.939789, 42.373195, 47.310595, 47.234748, 42.351189, 42.344953, 42.395547, 42.33022, 47.375736, 42.303755, 47.164278, 42.441172)), class = "data.frame", row.names = c(NA, -53L))
>
> Here is the routine:
> require(sp)
> require(rgdal)
> #25*1609.34 = 40233.5
> dis <- 40233.5 #Distance threshold 25miles converted to meters
>
> x <- tmp1b[,c(6)]
> head(x)
> y <- tmp1b[,c(5)]
> head(y)
> str(y)
>
> xy <- SpatialPointsDataFrame(matrix(c(x,y), ncol=2), data.frame(ID=seq(1:length(x))),
>                             proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))
>
> str(xy)
>
> xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84"))#Error occurring here?
>
> chc <- hclust(dist(data.frame(rownames=rownames(xy at data), x=coordinates(xy)[,1], #What is xy at data???? see str(xy)
>                              y=coordinates(xy)[,2])), method="complete")
> str(chc)
>
> view(xy at data)#Look like 3 clusters
>
> # Distance with a 25 Mile threshold
> chc.dis <- cutree(chc, h=dis)
> str(chc.dis)
> view(chc.dis)
>
> # Join results to meuse sp points
> xy at data <- data.frame(xy at data, Clust=chc.dis)
> str(xy at data)
> view(xy at data)
>
> # Plot results
> plot(xy, col=factor(xy at data$Clust), pch=19)
> box(col="black")
> title(main="Clustering")
> legend("topleft", legend=paste("Cluster", 1:3,sep=""),#Change from 4 in demo to 3 in my data
>       col=palette()[1:3], pch=rep(19,3), bg="white")
>
>
> Proprietary
>
> NOTICE TO RECIPIENT OF INFORMATION:\ This e-mail may con...{{dropped:16}}
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Mon May 18 13:25:23 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 18 May 2020 13:25:23 +0200
Subject: [R-sig-Geo] spatialreg::predict.sarlm
In-Reply-To: <alpine.LFD.2.22.394.2005151737370.18186@reclus.nhh.no>
References: <CALyWCxj+DqgKeVQ5jm8TGtnVX3JtMZrPqE4nuXXAA4xP1YUSaQ@mail.gmail.com>
 <alpine.LFD.2.22.394.2005151737370.18186@reclus.nhh.no>
Message-ID: <alpine.LFD.2.22.394.2005181303570.69936@reclus.nhh.no>

On Fri, 15 May 2020, Roger Bivand wrote:

> On Fri, 15 May 2020, Weldensie Embaye wrote:
>
>>  I am trying to run out-of-sample prediction using
>>  spatialreg::predict.sarlm package. I tried to prepare my data set as per
>>  the requirements.However, it did not work.
>>
>>  Below is the code.
>
> This is your code, but it cannot be reproduced. Please provide a fully 
> reproducible example that has available data, and which others can help you 
> to debug. If you can make the input data and weights files available on a 
> link, that might be easier than trying to use built-in data, especially as 
> you are loading weights generated outside the workflow.
>
> A further problem is that prediction needs both data sets and weights, 
> because predictions for test observations are autocorrelated with training 
> set observations, linked through the weights links.
>
> This leads to the problematic status of train/test on spatial data, because 
> ever-present autocorrelation (or entity misspecification) leaks between 
> training and test sets (which are then no longer independent). There are 
> steps that can be taken to handle this (see for point support the blockCV 
> package), not so far there is no such literature (I think) for spatial 
> econometrics models.
>
> Please also post plain text, not HTML, to make copying and pasting code 
> simpler.

Although the OP has only replied off list, and I do not follow up off-list 
replies, here is a reproducible example also using the blockCV package:

data(house, package="spData")
library(sf)
house <- st_as_sf(house)
pts <- list(x = c(506449.047777553, 520341.830738478, 519078.850469303,
  506133.302710259), y = c(217578.479394771, 217368.535168049,
  226606.081143817, 225871.27635029)) # digitized subset using locator()
subset <- st_sfc(st_cast(st_linestring(do.call("cbind", pts), dim=2),
  "POLYGON"), crs=st_crs(house))
house_1 <- st_intersection(house, st_buffer(subset, dist=-1500))
library(blockCV)
sB <- spatialBlock(house_1, rows=3, cols=3, showBlocks=FALSE,
  progress=FALSE, verbose=FALSE)
crds <- st_coordinates(house_1)
plot(crds[sB$folds[[1]][[1]],])
points(crds[sB$folds[[1]][[2]],], col="red")
house_1$id <- 1:nrow(house_1)
row.names(house_1) <- as.character(house_1$id)
train <- house_1[sB$folds[[1]][[1]],]
test <- house_1[sB$folds[[1]][[2]],]
nb <- spdep::knn2nb(spdep::knearneigh(house_1, k=6), row.names=house_1$id,
  sym=TRUE) # the nb IDs should match the data IDs
nb_train <- subset(nb, 1:nrow(house_1) %in% sB$folds[[1]][[1]])
fm <- log(price) ~ TLA + frontage + rooms + beds
library(spatialreg)
GM5 <- lagsarlm(fm, data=train, listw=spdep::nb2listw(nb_train),
  method="Matrix") # large object, do not use default method
preds <- predict(GM5, newdata=test, listw=spdep::nb2listw(nb),
  pred.type="TS")
GM5a <- lagsarlm(fm, data=train, listw=spdep::nb2listw(nb_train),
  method="Matrix", Durbin=TRUE)
predsa <- predict(GM5a, newdata=test, listw=spdep::nb2listw(nb),
  pred.type="TS", legacy.mixed=TRUE)
cor(log(test$price), predsa)
cor(log(test$price), preds)

This gives one fold of a blockCV approach. spatialreg::predict.sarlm() 
matches the IDs in the newdata object to the rows and columns in the 
weights matrix, and out-of-sample prediction must be given the full set of 
weights, because members of the test set are neighbours of training set 
members. Using blockCV reduces the spillover between training and test 
sets.

Please follow up here, especially if training/test using spatial 
econometrics estimation methods is of interest.

Hope this clarifies,

Roger


>
> Hope this helps,
>
> Roger
>
>>  csv_train <- read.csv("train.csv") #upload your csv. R needs to know your
>>  region ID
>>>  hhid <- csv_train$hhid #Explicitly created a variable to hold the
>>>  regions
>>>  nb_train <- read.gwt2nb('train.gwt', region.id=hhid)
>>>  Q_train<-nb2listw(nb_train)
>>>  csv_test <- read.csv("test.csv") #upload your csv. R needs to know your
>>  region ID
>>>  hhid <- csv_test$hhid #Explicitly created a variable to hold the regions
>>>  nb_test <- read.gwt2nb('test.gwt', region.id=hhid)
>>>  Q_test<-nb2listw(nb_test)
>>>  y_test <- dataTable$annualrent[test]
>>>  ######## spatial lag process model
>>>  GM5<-spatialreg::lagsarlm(formula, data=traindata, listw=Q_train)
>>>  summary(GM5)
>>
>>  Call:spatialreg::lagsarlm(formula = formula, data = traindata, listw =
>>  Q_train)
>>
>>  Residuals:
>>       Min        1Q    Median        3Q       Max
>>  -54.38677  -7.32082  -0.78772   5.69047  90.56889
>>
>>  Type: lag
>>  Coefficients: (asymptotic standard errors)
>>              Estimate Std. Error z value  Pr(>|z|)
>>  (Intercept) -20.63671    4.08382 -5.0533 4.343e-07
>>  coveredpri   -4.04663    4.71961 -0.8574  0.391219
>>  coveredsha   -3.70054    2.57827 -1.4353  0.151207
>>  vipprivate   -3.19640    4.57774 -0.6982  0.485022
>>  vipshare     -2.26742    2.30487 -0.9838  0.325238
>>  unoveredla   -1.29846    3.62671 -0.3580  0.720322
>>  flushpriva   10.22320    3.31060  3.0880  0.002015
>>  electricit   11.25641    2.07508  5.4246 5.810e-08
>>  privatetap    6.48159    2.63420  2.4606  0.013872
>>  publictap    -2.91930    3.46341 -0.8429  0.399285
>>  watertanke   -5.52987    7.58483 -0.7291  0.465959
>>  protectewe   -5.44122    5.17858 -1.0507  0.293389
>>  river        -1.76395    3.57625 -0.4932  0.621843
>>  numberofro   12.47265    0.94757 13.1628 < 2.2e-16
>>  roof         -2.83454    3.62586 -0.7818  0.434357
>>  externalwa   10.19840    1.92089  5.3092 1.101e-07
>>  floor         3.81212    2.55901  1.4897  0.136307
>>
>>  Rho: 0.3742, LR test value: 4.3541, p-value: 0.03692
>>  Asymptotic standard error: 0.16111
>>     z-value: 2.3227, p-value: 0.020197
>>  Wald statistic: 5.3948, p-value: 0.020197
>>
>>  Log likelihood: -1842.303 for lag model
>>  ML residual variance (sigma squared): 273.25, (sigma: 16.53)
>>  Number of observations: 436
>>  Number of parameters estimated: 19
>>  AIC: 3722.6, (AIC for lm: 3725)
>>  LM test for residual autocorrelation
>>  test value: 1.3748, p-value: 0.24099
>>
>>>  GM5_predict <- spatialreg::predict.sarlm(GM5, newdata = testdata, listw
>>>  =
>>  Q_test)
>>  Error in spatialreg::predict.sarlm(GM5, newdata = testdata, listw =
>>  Q_test)
>>  :
>>  mismatch between newdata and spatial weights. newdata should have
>>  region.id as row.names
>>> 
>>
>>  Any idea, what is going on?
>>
>>   [[alternative HTML version deleted]]
>>
>>  _______________________________________________
>>  R-sig-Geo mailing list
>>  R-sig-Geo at r-project.org
>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Po||ngW @end|ng |rom @etn@@com  Mon May 18 13:46:54 2020
From: Po||ngW @end|ng |rom @etn@@com (Poling, William)
Date: Mon, 18 May 2020 11:46:54 +0000
Subject: [R-sig-Geo] 
 Help with spTransform() function and final plot colors
In-Reply-To: <CAAcGz9_6LxA0oct77Q5TCMJBJ4Zj6TCdhNUiv8Jrz3q0HLvvHQ@mail.gmail.com>
References: <BYAPR06MB538377AD58A8C1E0D9367AD0AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>
 <CAAcGz9_6LxA0oct77Q5TCMJBJ4Zj6TCdhNUiv8Jrz3q0HLvvHQ@mail.gmail.com>
Message-ID: <BYAPR06MB5383048F64A016CDDA05FF30AEB80@BYAPR06MB5383.namprd06.prod.outlook.com>


Thank you Michael this is very helpful. I see now where my trouble is, the EPSG.

Best regards.

WHP

From: Michael Sumner <mdsumner at gmail.com> 
Sent: Monday, May 18, 2020 5:02 AM
To: Poling, William <PolingW at aetna.com>
Cc: RsigGeo <r-sig-geo at r-project.org>
Subject: [EXTERNAL] Re: [R-sig-Geo] Help with spTransform() function and final plot colors

**** External Email - Use Caution ****
Hi, your longlat coordinates are in the western hemisphere (-119, 39) but EPSG 27700 is designed for (and appropriate for some scenarios) somewhere in the UK. You need a local projection suitable for the area you are in. Look for an EPSG for your region, or maybe Albers conic or Lambert Azimuthal local authority (look on a paper map if you have one). Or define your own with projstrings (or wkt, it's a bit complicated atm to advise simple construction). There's some discussion here:
https://urldefense.proofpoint.com/v2/url?u=https-3A__geocompr.robinlovelace.net_reproj-2Dgeo-2Ddata.html-23which-2Dcrs-2Dto-2Duse&d=DwMFaQ&c=wluqKIiwffOpZ6k5sqMWMBOn0vyYnlulRJmmvOXCFpM&r=j7MrcIQm2xjHa8v-2mTpmTCtKvneM2ExlYvnUWbsByY&m=fDdQM1OwedGCkkG0UQTfAOUnp2_nUYnL-S_lSDHqxzM&s=bfYXSOc0JPxDRml-FQoxYoyDQ0nKdjPoNQrEE7yMzik&e=

Some will say use UTM, but you should not unless it's a particular local one used commonly in your work and the region the data is from.

HTH, Mike




On Mon., 18 May 2020, 19:46 Poling, William via R-sig-Geo, <mailto:r-sig-geo at r-project.org> wrote:
#RStudio Version Version 1.2.1335
sessionInfo()
# R version 4.0.0 Patched (2020-05-03 r78349)
#Platform: x86_64-w64-mingw32/x64 (64-bit) #Running under: Windows 10 x64 (build 17763)

Hello. I am running my data through a routine I found that finds clusters of data points based on distance rule.
https://urldefense.proofpoint.com/v2/url?u=https-3A__gis.stackexchange.com_questions_64392_finding-2Dclusters-2Dof-2Dpoints-2Dbased-2Ddistance-2Drule-2Dusing-2Dr&d=DwMFaQ&c=wluqKIiwffOpZ6k5sqMWMBOn0vyYnlulRJmmvOXCFpM&r=j7MrcIQm2xjHa8v-2mTpmTCtKvneM2ExlYvnUWbsByY&m=fDdQM1OwedGCkkG0UQTfAOUnp2_nUYnL-S_lSDHqxzM&s=uZzRrl9yVqRTRQ2iHvphq2JK7UrTcUx61LL4r9ZLVEQ&e=

1. I get this error when I get to this point in the routine, see complete routine below?
xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84")) non finite transformation detected:

I tried converting columns from numeric to Integer but did not help.

However, I continue to run the rest of the routine and the final sequence, the plot itself, seems to work Can this error be corrected somehow, despite the fact that it continues to work, just curious what it is I guess"

2. However in the plot at the end of the routine the color key appears with the colors but the clusters in the plot are black, see plot call at the end of the routine below?

Thank you for any advice.

WHP

ERROR:
non finite transformation detected:
? ? ? coords.x1 coords.x2? ? ? ? 
?[1,] -119.7339? 39.53939 Inf Inf
?[2,] -119.7665? 39.39630 Inf Inf
?[3,] -119.7794? 39.28768 Inf Inf
?[4,] -121.0234? 39.20503 Inf Inf
?[5,] -122.0047? 47.19262 Inf Inf
?[6,] -122.0135? 47.18883 Inf Inf
?[7,] -122.0379? 47.52190 Inf Inf
?[8,] -122.0578? 47.60975 Inf Inf
?[9,] -122.1330? 47.13669 Inf Inf
[10,] -122.1509? 47.55962 Inf Inf
[11,] -122.1706? 47.15546 Inf Inf
[12,] -122.1846? 47.23485 Inf Inf
[13,] -122.1846? 48.15307 Inf Inf
[14,] -122.1851? 47.44870 Inf Inf
[15,] -122.1954? 47.68485 Inf Inf
[16,] -122.1990? 47.51610 Inf Inf
[17,] -122.2014? 47.44772 Inf Inf
[18,] -122.2025? 47.69815 Inf Inf
[19,] -122.2037? 47.67190 Inf Inf
[20,] -122.2090? 47.40378 Inf Inf
[21,] -122.2108? 47.25336 Inf Inf
[22,] -122.2291? 47.63880 Inf Inf
[23,] -122.2419? 47.76870 Inf Inf
[24,] -122.2722? 48.04803 Inf Inf
[25,] -122.2732? 47.87700 Inf Inf
[26,] -122.2804? 47.77620 Inf Inf
[27,] -122.2839? 47.82103 Inf Inf
[28,] -122.2890? 47.86899 Inf Inf
[29,] -122.2993? 47.67306 Inf Inf
[30,] -122.3180? 47.38217 Inf Inf
[31,] -122.3270? 47.40378 Inf Inf
[32,] -122.3474? 47.43884 Inf Inf
[33,] -122.3484? 47.53083 Inf Inf
[34,] -122.3581? 47.27678 Inf Inf
[35,] -122.3618? 47.76735 Inf Inf
[36,] -122.3700? 47.56567 Inf Inf
[37,] -122.3908? 47.54938 Inf Inf
[38,] -122.4128? 47.64622 Inf Inf
[39,] -122.4293? 47.17660 Inf Inf
[40,] -122.4621? 47.44505 Inf Inf
[41,] -122.4904? 47.27460 Inf Inf
[42,] -122.5515? 46.93979 Inf Inf
[43,] -122.7348? 42.37320 Inf Inf
[44,] -122.7827? 47.31059 Inf Inf
[45,] -122.7987? 47.23475 Inf Inf
[46,] -122.8385? 42.35119 Inf Inf
[47,] -122.8537? 42.34495 Inf Inf
[48,] -122.8904? 42.39555 Inf Inf
[49,] -122.8927? 42.33022 Inf Inf
[50,] -122.9451? 47.37574 Inf Inf
[51,] -122.9594? 42.30376 Inf Inf
[52,] -123.0641? 47.16428 Inf Inf
[53,] -123.3413? 42.44117 Inf Inf
Error in spTransform(xSP, CRSobj, ...) : 
? failure in points 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53
In addition: Warning message:
In spTransform(xSP, CRSobj, ...) : 53 projected point(s) not finite

Here is the data:
dput(sample)
structure(list(ID = 1:53, Longitude = c(-119.733899, -119.766493, -119.779416, -121.0234, -122.004736, -122.013456, -122.0379, -122.0578, -122.132971, -122.150901, -122.170608, -122.18462, -122.184639, -122.185079, -122.195398, -122.198994, -122.201356, -122.202507, -122.20371, -122.209047, -122.210797, -122.229095, -122.2419, -122.27216, -122.273164, -122.280355, -122.28389, -122.289043, -122.299261, -122.318009, -122.326987, -122.347382, -122.34844, -122.358115, -122.361839, -122.37003, -122.390815, -122.41282, -122.429323, -122.462136, -122.490417, -122.551483, -122.734847, -122.782736, -122.798669, -122.838498, -122.853683, -122.8904, -122.89271, -122.94511, -122.959407, -123.064087, -123.341346), Latitude = c(39.53939, 39.396298, 39.287681, 39.205028, 47.192616, 47.188833, 47.5219, 47.609748, 47.13669, 47.559616, 47.155455, 47.234849, 48.15307, 47.448697, 47.684854, 47.516104, 47.447723, 47.698146, 47.6719, 47.403778, 47.253364, 47.638795, 47.768701, 48.048027, 47.876997, 47.776205, 47.821029, 47.868987, 47.673056, 47.382165, 47.403785, 47.438836, 47.530831, 47.276776, 47.76735, 47.565667, 47.549377, 47.646222, 47.176596, 47.445053, 47.274599, 46.939789, 42.373195, 47.310595, 47.234748, 42.351189, 42.344953, 42.395547, 42.33022, 47.375736, 42.303755, 47.164278, 42.441172)), class = "data.frame", row.names = c(NA, -53L))

Here is the routine:
require(sp)
require(rgdal)
#25*1609.34 = 40233.5? ? ? 
dis <- 40233.5 #Distance threshold 25miles converted to meters

x <- tmp1b[,c(6)]
head(x)
y <- tmp1b[,c(5)]
head(y)
str(y)

xy <- SpatialPointsDataFrame(matrix(c(x,y), ncol=2), data.frame(ID=seq(1:length(x))),
? ? ? ? ? ? ? ? ? ? ? ? ? ? ?proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))

str(xy)

xy <- spTransform(xy, CRS("+init=epsg:27700 +datum=WGS84"))#Error occurring here?

chc <- hclust(dist(data.frame(rownames=rownames(xy at data), x=coordinates(xy)[,1], #What is xy at data???? see str(xy)
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? y=coordinates(xy)[,2])), method="complete")
str(chc)

view(xy at data)#Look like 3 clusters

# Distance with a 25 Mile threshold
chc.dis <- cutree(chc, h=dis)
str(chc.dis)
view(chc.dis)

# Join results to meuse sp points
xy at data <- data.frame(xy at data, Clust=chc.dis)
str(xy at data)
view(xy at data)

# Plot results
plot(xy, col=factor(xy at data$Clust), pch=19)
box(col="black")
title(main="Clustering")
legend("topleft", legend=paste("Cluster", 1:3,sep=""),#Change from 4 in demo to 3 in my data
? ? ? ?col=palette()[1:3], pch=rep(19,3), bg="white")


Proprietary

NOTICE TO RECIPIENT OF INFORMATION:\ This e-mail may con...{{dropped:16}}

_______________________________________________
R-sig-Geo mailing list
mailto:R-sig-Geo at r-project.org
https://urldefense.proofpoint.com/v2/url?u=https-3A__stat.ethz.ch_mailman_listinfo_r-2Dsig-2Dgeo&d=DwMFaQ&c=wluqKIiwffOpZ6k5sqMWMBOn0vyYnlulRJmmvOXCFpM&r=j7MrcIQm2xjHa8v-2mTpmTCtKvneM2ExlYvnUWbsByY&m=fDdQM1OwedGCkkG0UQTfAOUnp2_nUYnL-S_lSDHqxzM&s=kPefKeqQOlNKKPcGokf_XBbO51mavqj5WQOKbKof4ws&e=

Proprietary

NOTICE TO RECIPIENT OF INFORMATION:
This e-mail may contain confidential or privileged information. If you think you have received this e-mail in error, please advise the sender by reply e-mail and then delete this e-mail immediately.  
This e-mail may also contain protected health information (PHI) with information about sensitive medical conditions, including, but not limited to, treatment for substance use disorders, behavioral health, HIV/AIDS, or pregnancy. This type of information may be protected by various federal and/or state laws which prohibit any further disclosure without the express written consent of the person to whom it pertains or as otherwise permitted by law. Any unauthorized further disclosure may be considered a violation of federal and/or state law. A general authorization for the release of medical or other information may NOT be sufficient consent for release of this type of information.
Thank you. Aetna

From m@p|no|@10 @end|ng |rom gm@||@com  Thu May 21 14:55:30 2020
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 21 May 2020 06:55:30 -0600
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
Message-ID: <CABkCotTL4bcuwZb5o8ZeUrJS-YOiuCC0p9xBAjf-uOrDP2CE4g@mail.gmail.com>

Dear list members,

I am working with R 4.0.0 on MacOS Catalina 10.15.4.

When I load, for example, the library sf, I realized that I have older
versions of GEOS, GDAL  and PROJ

> library(sf)
Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0

How can I update to the latest versions GEOS 3.8.0, GDAL 3.0.4 and PROJ
7.0.0

Manuel

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From r@hep@rd @end|ng |rom @pp|-eco@y@@com  Thu May 21 15:21:55 2020
From: r@hep@rd @end|ng |rom @pp|-eco@y@@com (Rich Shepard)
Date: Thu, 21 May 2020 06:21:55 -0700 (PDT)
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
In-Reply-To: <CABkCotTL4bcuwZb5o8ZeUrJS-YOiuCC0p9xBAjf-uOrDP2CE4g@mail.gmail.com>
References: <CABkCotTL4bcuwZb5o8ZeUrJS-YOiuCC0p9xBAjf-uOrDP2CE4g@mail.gmail.com>
Message-ID: <alpine.LNX.2.20.2005210619560.2661@salmo.appl-ecosys.com>

On Thu, 21 May 2020, Manuel Sp?nola wrote:

> I am working with R 4.0.0 on MacOS Catalina 10.15.4.
> When I load, for example, the library sf, I realized that I have older
> versions of GEOS, GDAL  and PROJ

> How can I update to the latest versions GEOS 3.8.0, GDAL 3.0.4 and PROJ
> 7.0.0

Manuel,

I've no idea how macOS works yet I offer the advice that you
build/upgrade/install this stack by first doing PROJ, then GEOS, and finally
GDAL. The sequence matters as each builds on the earlier one(s).

Regards,

Rich


From m@p|no|@10 @end|ng |rom gm@||@com  Thu May 21 20:40:47 2020
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 21 May 2020 12:40:47 -0600
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
In-Reply-To: <alpine.LNX.2.20.2005210619560.2661@salmo.appl-ecosys.com>
References: <CABkCotTL4bcuwZb5o8ZeUrJS-YOiuCC0p9xBAjf-uOrDP2CE4g@mail.gmail.com>
 <alpine.LNX.2.20.2005210619560.2661@salmo.appl-ecosys.com>
Message-ID: <CABkCotT-mFZaDo9LQzJMJO6pU-Op8rumSZ_uJ+qij0befFp1Ew@mail.gmail.com>

Thank you very much Rich.

Manuel

El jue., 21 may. 2020 a las 7:22, Rich Shepard (<rshepard at appl-ecosys.com>)
escribi?:

> On Thu, 21 May 2020, Manuel Sp?nola wrote:
>
> > I am working with R 4.0.0 on MacOS Catalina 10.15.4.
> > When I load, for example, the library sf, I realized that I have older
> > versions of GEOS, GDAL  and PROJ
>
> > How can I update to the latest versions GEOS 3.8.0, GDAL 3.0.4 and PROJ
> > 7.0.0
>
> Manuel,
>
> I've no idea how macOS works yet I offer the advice that you
> build/upgrade/install this stack by first doing PROJ, then GEOS, and
> finally
> GDAL. The sequence matters as each builds on the earlier one(s).
>
> Regards,
>
> Rich
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From |@t@z@hn @end|ng |rom gm@||@com  Thu May 21 21:50:55 2020
From: |@t@z@hn @end|ng |rom gm@||@com (Ista Zahn)
Date: Thu, 21 May 2020 15:50:55 -0400
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
In-Reply-To: <CABkCotT-mFZaDo9LQzJMJO6pU-Op8rumSZ_uJ+qij0befFp1Ew@mail.gmail.com>
References: <CABkCotTL4bcuwZb5o8ZeUrJS-YOiuCC0p9xBAjf-uOrDP2CE4g@mail.gmail.com>
 <alpine.LNX.2.20.2005210619560.2661@salmo.appl-ecosys.com>
 <CABkCotT-mFZaDo9LQzJMJO6pU-Op8rumSZ_uJ+qij0befFp1Ew@mail.gmail.com>
Message-ID: <CA+vqiLFq_BgT5zP0avhw-RBhErj6O=8GnFnEBp-A65vATcrjXw@mail.gmail.com>

I don't have a Mac myself, but both https://r-spatial.github.io/sf/
and https://github.com/rspatial/terra recommend installing gdal etc.
via homebrew.

Best,
Ista

On Thu, May 21, 2020 at 2:41 PM Manuel Sp?nola <mspinola10 at gmail.com> wrote:
>
> Thank you very much Rich.
>
> Manuel
>
> El jue., 21 may. 2020 a las 7:22, Rich Shepard (<rshepard at appl-ecosys.com>)
> escribi?:
>
> > On Thu, 21 May 2020, Manuel Sp?nola wrote:
> >
> > > I am working with R 4.0.0 on MacOS Catalina 10.15.4.
> > > When I load, for example, the library sf, I realized that I have older
> > > versions of GEOS, GDAL  and PROJ
> >
> > > How can I update to the latest versions GEOS 3.8.0, GDAL 3.0.4 and PROJ
> > > 7.0.0
> >
> > Manuel,
> >
> > I've no idea how macOS works yet I offer the advice that you
> > build/upgrade/install this stack by first doing PROJ, then GEOS, and
> > finally
> > GDAL. The sequence matters as each builds on the earlier one(s).
> >
> > Regards,
> >
> > Rich
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From m@p|no|@10 @end|ng |rom gm@||@com  Thu May 21 22:50:05 2020
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 21 May 2020 14:50:05 -0600
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
In-Reply-To: <CA+vqiLFq_BgT5zP0avhw-RBhErj6O=8GnFnEBp-A65vATcrjXw@mail.gmail.com>
References: <CABkCotTL4bcuwZb5o8ZeUrJS-YOiuCC0p9xBAjf-uOrDP2CE4g@mail.gmail.com>
 <alpine.LNX.2.20.2005210619560.2661@salmo.appl-ecosys.com>
 <CABkCotT-mFZaDo9LQzJMJO6pU-Op8rumSZ_uJ+qij0befFp1Ew@mail.gmail.com>
 <CA+vqiLFq_BgT5zP0avhw-RBhErj6O=8GnFnEBp-A65vATcrjXw@mail.gmail.com>
Message-ID: <CABkCotQpdYUpUKCZC-U-c84UriB8h06SzSAVaTnsLroRPpYifg@mail.gmail.com>

Thank you very much Ista.

I tried several times but I don?t get the last version of gdal

(base) Manuels-MacBook-Pro:~ manuelspinola$ brew install gdal

Warning: gdal 2.4.4_6 is already installed and up-to-date

To reinstall 2.4.4_6, run `brew reinstall gdal`

(base) Manuels-MacBook-Pro:~ manuelspinola$




El jue., 21 may. 2020 a las 13:51, Ista Zahn (<istazahn at gmail.com>)
escribi?:

> I don't have a Mac myself, but both https://r-spatial.github.io/sf/
> and https://github.com/rspatial/terra recommend installing gdal etc.
> via homebrew.
>
> Best,
> Ista
>
> On Thu, May 21, 2020 at 2:41 PM Manuel Sp?nola <mspinola10 at gmail.com>
> wrote:
> >
> > Thank you very much Rich.
> >
> > Manuel
> >
> > El jue., 21 may. 2020 a las 7:22, Rich Shepard (<
> rshepard at appl-ecosys.com>)
> > escribi?:
> >
> > > On Thu, 21 May 2020, Manuel Sp?nola wrote:
> > >
> > > > I am working with R 4.0.0 on MacOS Catalina 10.15.4.
> > > > When I load, for example, the library sf, I realized that I have
> older
> > > > versions of GEOS, GDAL  and PROJ
> > >
> > > > How can I update to the latest versions GEOS 3.8.0, GDAL 3.0.4 and
> PROJ
> > > > 7.0.0
> > >
> > > Manuel,
> > >
> > > I've no idea how macOS works yet I offer the advice that you
> > > build/upgrade/install this stack by first doing PROJ, then GEOS, and
> > > finally
> > > GDAL. The sequence matters as each builds on the earlier one(s).
> > >
> > > Regards,
> > >
> > > Rich
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at r-project.org
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> >
> > --
> > *Manuel Sp?nola, Ph.D.*
> > Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> > Universidad Nacional
> > Apartado 1350-3000
> > Heredia
> > COSTA RICA
> > mspinola at una.cr <mspinola at una.ac.cr>
> > mspinola10 at gmail.com
> > Tel?fono: (506) 8706 - 4662
> > Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> > Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From |@t@z@hn @end|ng |rom gm@||@com  Thu May 21 23:41:16 2020
From: |@t@z@hn @end|ng |rom gm@||@com (Ista Zahn)
Date: Thu, 21 May 2020 17:41:16 -0400
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
In-Reply-To: <CABkCotQpdYUpUKCZC-U-c84UriB8h06SzSAVaTnsLroRPpYifg@mail.gmail.com>
References: <CABkCotTL4bcuwZb5o8ZeUrJS-YOiuCC0p9xBAjf-uOrDP2CE4g@mail.gmail.com>
 <alpine.LNX.2.20.2005210619560.2661@salmo.appl-ecosys.com>
 <CABkCotT-mFZaDo9LQzJMJO6pU-Op8rumSZ_uJ+qij0befFp1Ew@mail.gmail.com>
 <CA+vqiLFq_BgT5zP0avhw-RBhErj6O=8GnFnEBp-A65vATcrjXw@mail.gmail.com>
 <CABkCotQpdYUpUKCZC-U-c84UriB8h06SzSAVaTnsLroRPpYifg@mail.gmail.com>
Message-ID: <CA+vqiLEHDsp9zEUseTAuqRzk=yG6-P_aDLv9_C1d_fjKbLR3_w@mail.gmail.com>

Hi Manuel,

It looks like the brew gdal formula hasn't been updated to version 3
yet[1] at least in part because it breaks other things[2]. Personally
I would just wait for the homebrew community to sort this out.

Best,
Ista

[1] https://formulae.brew.sh/formula/gdal
[2] https://github.com/Homebrew/homebrew-core/pull/46817

On Thu, May 21, 2020 at 4:50 PM Manuel Sp?nola <mspinola10 at gmail.com> wrote:
>
> Thank you very much Ista.
>
> I tried several times but I don?t get the last version of gdal
>
> (base) Manuels-MacBook-Pro:~ manuelspinola$ brew install gdal
>
> Warning: gdal 2.4.4_6 is already installed and up-to-date
>
> To reinstall 2.4.4_6, run `brew reinstall gdal`
>
> (base) Manuels-MacBook-Pro:~ manuelspinola$
>
>
>
>
> El jue., 21 may. 2020 a las 13:51, Ista Zahn (<istazahn at gmail.com>) escribi?:
>>
>> I don't have a Mac myself, but both https://r-spatial.github.io/sf/
>> and https://github.com/rspatial/terra recommend installing gdal etc.
>> via homebrew.
>>
>> Best,
>> Ista
>>
>> On Thu, May 21, 2020 at 2:41 PM Manuel Sp?nola <mspinola10 at gmail.com> wrote:
>> >
>> > Thank you very much Rich.
>> >
>> > Manuel
>> >
>> > El jue., 21 may. 2020 a las 7:22, Rich Shepard (<rshepard at appl-ecosys.com>)
>> > escribi?:
>> >
>> > > On Thu, 21 May 2020, Manuel Sp?nola wrote:
>> > >
>> > > > I am working with R 4.0.0 on MacOS Catalina 10.15.4.
>> > > > When I load, for example, the library sf, I realized that I have older
>> > > > versions of GEOS, GDAL  and PROJ
>> > >
>> > > > How can I update to the latest versions GEOS 3.8.0, GDAL 3.0.4 and PROJ
>> > > > 7.0.0
>> > >
>> > > Manuel,
>> > >
>> > > I've no idea how macOS works yet I offer the advice that you
>> > > build/upgrade/install this stack by first doing PROJ, then GEOS, and
>> > > finally
>> > > GDAL. The sequence matters as each builds on the earlier one(s).
>> > >
>> > > Regards,
>> > >
>> > > Rich
>> > >
>> > > _______________________________________________
>> > > R-sig-Geo mailing list
>> > > R-sig-Geo at r-project.org
>> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > >
>> >
>> >
>> > --
>> > *Manuel Sp?nola, Ph.D.*
>> > Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> > Universidad Nacional
>> > Apartado 1350-3000
>> > Heredia
>> > COSTA RICA
>> > mspinola at una.cr <mspinola at una.ac.cr>
>> > mspinola10 at gmail.com
>> > Tel?fono: (506) 8706 - 4662
>> > Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
>> > Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Manuel Sp?nola, Ph.D.
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Personal website: Lobito de r?o
> Institutional website: ICOMVIS


From m@p|no|@10 @end|ng |rom gm@||@com  Fri May 22 00:50:19 2020
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Thu, 21 May 2020 16:50:19 -0600
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
In-Reply-To: <CA+vqiLEHDsp9zEUseTAuqRzk=yG6-P_aDLv9_C1d_fjKbLR3_w@mail.gmail.com>
References: <CABkCotTL4bcuwZb5o8ZeUrJS-YOiuCC0p9xBAjf-uOrDP2CE4g@mail.gmail.com>
 <alpine.LNX.2.20.2005210619560.2661@salmo.appl-ecosys.com>
 <CABkCotT-mFZaDo9LQzJMJO6pU-Op8rumSZ_uJ+qij0befFp1Ew@mail.gmail.com>
 <CA+vqiLFq_BgT5zP0avhw-RBhErj6O=8GnFnEBp-A65vATcrjXw@mail.gmail.com>
 <CABkCotQpdYUpUKCZC-U-c84UriB8h06SzSAVaTnsLroRPpYifg@mail.gmail.com>
 <CA+vqiLEHDsp9zEUseTAuqRzk=yG6-P_aDLv9_C1d_fjKbLR3_w@mail.gmail.com>
Message-ID: <CABkCotRL71D4if-2ah+FuS6+kB-ysmJ8m9Tnb-c_atB0BxZJWw@mail.gmail.com>

Thank you very much Ista.

El jue., 21 may. 2020 a las 15:41, Ista Zahn (<istazahn at gmail.com>)
escribi?:

> Hi Manuel,
>
> It looks like the brew gdal formula hasn't been updated to version 3
> yet[1] at least in part because it breaks other things[2]. Personally
> I would just wait for the homebrew community to sort this out.
>
> Best,
> Ista
>
> [1] https://formulae.brew.sh/formula/gdal
> [2] https://github.com/Homebrew/homebrew-core/pull/46817
>
> On Thu, May 21, 2020 at 4:50 PM Manuel Sp?nola <mspinola10 at gmail.com>
> wrote:
> >
> > Thank you very much Ista.
> >
> > I tried several times but I don?t get the last version of gdal
> >
> > (base) Manuels-MacBook-Pro:~ manuelspinola$ brew install gdal
> >
> > Warning: gdal 2.4.4_6 is already installed and up-to-date
> >
> > To reinstall 2.4.4_6, run `brew reinstall gdal`
> >
> > (base) Manuels-MacBook-Pro:~ manuelspinola$
> >
> >
> >
> >
> > El jue., 21 may. 2020 a las 13:51, Ista Zahn (<istazahn at gmail.com>)
> escribi?:
> >>
> >> I don't have a Mac myself, but both https://r-spatial.github.io/sf/
> >> and https://github.com/rspatial/terra recommend installing gdal etc.
> >> via homebrew.
> >>
> >> Best,
> >> Ista
> >>
> >> On Thu, May 21, 2020 at 2:41 PM Manuel Sp?nola <mspinola10 at gmail.com>
> wrote:
> >> >
> >> > Thank you very much Rich.
> >> >
> >> > Manuel
> >> >
> >> > El jue., 21 may. 2020 a las 7:22, Rich Shepard (<
> rshepard at appl-ecosys.com>)
> >> > escribi?:
> >> >
> >> > > On Thu, 21 May 2020, Manuel Sp?nola wrote:
> >> > >
> >> > > > I am working with R 4.0.0 on MacOS Catalina 10.15.4.
> >> > > > When I load, for example, the library sf, I realized that I have
> older
> >> > > > versions of GEOS, GDAL  and PROJ
> >> > >
> >> > > > How can I update to the latest versions GEOS 3.8.0, GDAL 3.0.4
> and PROJ
> >> > > > 7.0.0
> >> > >
> >> > > Manuel,
> >> > >
> >> > > I've no idea how macOS works yet I offer the advice that you
> >> > > build/upgrade/install this stack by first doing PROJ, then GEOS, and
> >> > > finally
> >> > > GDAL. The sequence matters as each builds on the earlier one(s).
> >> > >
> >> > > Regards,
> >> > >
> >> > > Rich
> >> > >
> >> > > _______________________________________________
> >> > > R-sig-Geo mailing list
> >> > > R-sig-Geo at r-project.org
> >> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >> > >
> >> >
> >> >
> >> > --
> >> > *Manuel Sp?nola, Ph.D.*
> >> > Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> >> > Universidad Nacional
> >> > Apartado 1350-3000
> >> > Heredia
> >> > COSTA RICA
> >> > mspinola at una.cr <mspinola at una.ac.cr>
> >> > mspinola10 at gmail.com
> >> > Tel?fono: (506) 8706 - 4662
> >> > Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> >> > Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
> >> >
> >> >         [[alternative HTML version deleted]]
> >> >
> >> > _______________________________________________
> >> > R-sig-Geo mailing list
> >> > R-sig-Geo at r-project.org
> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> >
> >
> > --
> > Manuel Sp?nola, Ph.D.
> > Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> > Universidad Nacional
> > Apartado 1350-3000
> > Heredia
> > COSTA RICA
> > mspinola at una.cr
> > mspinola10 at gmail.com
> > Tel?fono: (506) 8706 - 4662
> > Personal website: Lobito de r?o
> > Institutional website: ICOMVIS
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From v|n|c|ovc| @end|ng |rom gm@||@com  Fri May 22 16:51:28 2020
From: v|n|c|ovc| @end|ng |rom gm@||@com (Vinicio Lima)
Date: Fri, 22 May 2020 11:51:28 -0300
Subject: [R-sig-Geo] Tiled processing rgrass7
Message-ID: <CAEZi0_MOKSVPAjzMKUeSBEDTpJUTKAgnuxomMhwuY3me46MQhA@mail.gmail.com>

Dears,



I'm running GRASS 7.8.3 from within R, my goal is to run r.surf.contour to
generate a DEM from a vector file of contour lines.



To overcome the low memory, I tiled the contour lines after converting them
to raster. Now I don't know how to access the tiles in the mapset to apply
r.surf.contour.



When I map the tiles in the mapset and try to store the grass names in an
object in R, I get an empty object.



grass.names <- execGRASS(cmd="g.list", type='raster',
pattern='r_contours_tile*')



Can someone indicate some material or a concrete example of how to run a
GRASS tool on tiled data using rgrass7?



sessionInfo()

R version 3.6.2 (2019-12-12)

Platform: x86_64-w64-mingw32/x64 (64-bit)

Running under: Windows 10 x64 (build 17134)

attached packages:

[1] rgrass7_0.2-1 XML_3.99-0.3  link2GI_0.4.3



-- 
Vin?cio C. Lima
Geo Analyst
*Arauco Brasil **www.arauco.c* <http://www.arauco.cl/>*om.br
<http://om.br/>*

	[[alternative HTML version deleted]]


From t@v|b@r @end|ng |rom gm@||@com  Fri May 22 21:00:40 2020
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Fri, 22 May 2020 22:00:40 +0300
Subject: [R-sig-Geo] Tiled processing rgrass7
In-Reply-To: <CAEZi0_MOKSVPAjzMKUeSBEDTpJUTKAgnuxomMhwuY3me46MQhA@mail.gmail.com>
References: <CAEZi0_MOKSVPAjzMKUeSBEDTpJUTKAgnuxomMhwuY3me46MQhA@mail.gmail.com>
Message-ID: <ce6f0dca-d79d-795e-a72a-b267f24858e0@gmail.com>


On 22/05/2020 17:51, Vinicio Lima wrote:
> Dears,
>
>
>
> I'm running GRASS 7.8.3 from within R, my goal is to run r.surf.contour to
> generate a DEM from a vector file of contour lines.
>
>
>
> To overcome the low memory, I tiled the contour lines after converting them
> to raster. Now I don't know how to access the tiles in the mapset to apply
> r.surf.contour.
>
>
>
> When I map the tiles in the mapset and try to store the grass names in an
> object in R, I get an empty object.
>
>
>
> grass.names <- execGRASS(cmd="g.list", type='raster',
> pattern='r_contours_tile*')
>
>
>
> Can someone indicate some material or a concrete example of how to run a
> GRASS tool on tiled data using rgrass7?
>

Try the parameter 'intern = TRUE' to execGRASS to get a string with 
space separated names of rasters:


library(rgrass7)
initGRASS(gisBase="/usr/lib/grass76", gisDbase="/home/micha/GIS/grass",

 ??? location="nc_basic_spm_grass7",

 ??? mapset="PERMANENT",

 ??? override=TRUE)

rast_list = execGRASS('g.list', type='rast', pattern='elev*', intern = TRUE)
rast_list = strsplit(rast_list, split=" ", fixed=TRUE)
rast_list
[[1]]
[1] "elevation"

[[2]]
[1] "elevation_shade"


>
> sessionInfo()
>
> R version 3.6.2 (2019-12-12)
>
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> Running under: Windows 10 x64 (build 17134)
>
> attached packages:
>
> [1] rgrass7_0.2-1 XML_3.99-0.3  link2GI_0.4.3
>
>
>
-- 
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918
https://orcid.org/0000-0002-1128-1325


From @|@z@ro|op @end|ng |rom po@teo@me  Sun May 24 12:47:47 2020
From: @|@z@ro|op @end|ng |rom po@teo@me (=?utf-8?Q?Alberto_L=C3=A1zaro-L=C3=B3pez?=)
Date: Sun, 24 May 2020 12:47:47 +0200
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
Message-ID: <6095B290-877B-4AF3-9F4E-6D153535BCC7@posteo.me>

Hi Manuel, 

Homebrew for Mac can be extended with taps or external repositories. You could give a try to OSGeo4Mac tap [1].
At this moment, it?s serving bottles for GDAL 3.1.0 and PROJ 6.3.2, but also other GIS software as PostGIS or SAGA.
For example, this is what you get with sf:

> library(sf)
Linking to GEOS 3.8.1, GDAL 3.1.0, PROJ 6.3.2

[1] https://github.com/OSGeo/homebrew-osgeo4mac 

You can solve any doubt through the Github issue page too. I hope you find it useful. 

Best regards,

Alberto L?zaro L?pez
about.me/alazarolop


From m@p|no|@10 @end|ng |rom gm@||@com  Sun May 24 18:14:55 2020
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sun, 24 May 2020 10:14:55 -0600
Subject: [R-sig-Geo] How can I update to versions GEOS 3.8.0,
 GDAL 3.0.4 and PROJ 7.0.0
In-Reply-To: <6095B290-877B-4AF3-9F4E-6D153535BCC7@posteo.me>
References: <6095B290-877B-4AF3-9F4E-6D153535BCC7@posteo.me>
Message-ID: <CABkCotQR_zEqtwGRgD4JEFaZufOggYRc4CY=07SMU4Ug3yQc=Q@mail.gmail.com>

Thank you very much Alberto.

Manuel

El dom., 24 may. 2020 a las 4:48, Alberto L?zaro-L?pez (<
alazarolop at posteo.me>) escribi?:

> Hi Manuel,
>
> Homebrew for Mac can be extended with taps or external repositories. You
> could give a try to OSGeo4Mac tap [1].
> At this moment, it?s serving bottles for GDAL 3.1.0 and PROJ 6.3.2, but
> also other GIS software as PostGIS or SAGA.
> For example, this is what you get with sf:
>
> > library(sf)
> Linking to GEOS 3.8.1, GDAL 3.1.0, PROJ 6.3.2
>
> [1] https://github.com/OSGeo/homebrew-osgeo4mac
>
> You can solve any doubt through the Github issue page too. I hope you find
> it useful.
>
> Best regards,
>
> Alberto L?zaro L?pez
> about.me/alazarolop
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From Po||ngW @end|ng |rom @etn@@com  Wed May 27 21:55:26 2020
From: Po||ngW @end|ng |rom @etn@@com (Poling, William)
Date: Wed, 27 May 2020 19:55:26 +0000
Subject: [R-sig-Geo] Help with geocode()  & get_map() please
Message-ID: <BYAPR06MB53830EEB512F781132E16F4EAEB10@BYAPR06MB5383.namprd06.prod.outlook.com>

Hello:

#RStudio Version Version 1.2.1335 
sessionInfo() 
# R version 4.0.0 Patched (2020-05-03 r78349)
#Platform: x86_64-w64-mingw32/x64 (64-bit)
#Running under: Windows 10 x64 (build 17763)

library(ggmap)
library(sp)
library(rgdal)
library(rgeos)


I am trying to follow along with this stack-reference and recreate the recommended solution, then apply my data
https://gis.stackexchange.com/questions/133693/geographic-heatmaps-with-concentric-circles-by-distance?rq=1


I hope I have provided enough information below to reproduce or identify my errors.

Thank you for any assistance.

1. I am having trouble with geocode() 

nyc <- geocode("New York")
No such file or directory failed to load external entity "http://maps.google.com/maps/api/geocode/xml?address=New+York&sensor=false"
Error : 1: No such file or directory2: failed to load external entity "http://maps.google.com/maps/api/geocode/xml?address=New+York&sensor=false"
Error in .geocode(xx$place, oneRecord = oneRecord, extent = extent, progress = progress) : 
  object 'doc' not found


AND


2. I am having trouble with get_map()

ny.map <- get_map("New York", zoom = 8)

Source : https://maps.googleapis.com/maps/api/staticmap?center=New%20York&zoom=8&size=640x640&scale=2&maptype=terrain&language=en-EN&key=[012819-836529-634EA5]
Error in aperm.default(map, c(2, 1, 3)) : 
invalid first argument, must be an array
In addition: Warning message:
In get_googlemap(center = location, zoom = zoom, maptype = maptype,  :
  HTTP 400 Bad Request 

I have researched these errors and still do not seem to understand what I am doing wrong, or missing?

I have an API key and I believe I have initiated it correctly

I found this reference or a similar problem and followed the advice provided.
https://cran.r-project.org/web/packages/ggmap/ggmap.pdf


As suggested I went out to https://console.cloud.google.com/
and initiated suggested API's.

I manage to get through the next steps: 

#create the circles with gBuffer and then reproject them into WGS84 for ggmap.

# create spatialPoint object
coordinates(clus3) <- ~ lon + lat
proj4string(clus3) <- CRS("+init=epsg:4326")


# reproject to Google Mercator (meters)
clus3.mrc <- spTransform(clus3, CRS = CRS("+init=epsg:3857"))

# concentric rings (in miles):
dist.miles <-  seq(15, 25, 30)

# create a dataframe with the circle coordinates function
circ.df <- do.call(rbind,
                   lapply(dist.miles, function(n) {
                     circ <- gBuffer(clus3.mrc, width = n * 1609.344, quadsegs=20)
                     circ.wgs <- spTransform(circ, CRS=CRS("+init=epsg:4326"))
                     coords <- lapply(circ.wgs at polygons, function(x) {x at Polygons[[1]]@coords})
                     data.frame(x=coords[[1]][,1], y=coords[[1]][,2], distance=n)
                   }))

# text positions
text.pos <- cbind(aggregate( y ~ distance, data=circ.df, FUN=min), x=clus3$lon, row.names = NULL)


# fake a heatmap
set.seed(1)
xy2 <- data.frame(x=runif(100, -74.5, -73.5),y=runif(100, 40.2, 41.2))


But I can get no further at this point due to get_map():

# get basemap
#ny.map <- get_map("New York", zoom = 8) https://cran.r-project.org/web/packages/ggmap/ggmap.pdf
#Source : https://maps.googleapis.com/maps/api/staticmap?center=New%20York&zoom=8&size=640x640&scale=2&maptype=terrain&language=en-EN&key=[012819-836529-634EA5]
Error in aperm.default(map, c(2, 1, 3)) : 
  invalid first argument, must be an array
In addition: Warning message:
In get_googlemap(center = location, zoom = zoom, maptype = maptype,  :
  HTTP 400 Bad Request

I tried to use this in the plot below and of course it errors out --#Error: ggmap plots objects of class ggmap, see ?get_map
ny.map <- ggplot2::map_data("state", region = c('new york', 'new jersey'))

ny.map <- get_map("state", region = c('new york', 'new jersey'))
#ERROR:
Source : https://maps.googleapis.com/maps/api/staticmap?center=state&zoom=10&size=640x640&scale=2&maptype=terrain&language=en-EN&key=[012819-836529-634EA5]
Error in aperm.default(map, c(2, 1, 3)) : 
  invalid first argument, must be an array
In addition: Warning message:
In get_googlemap(center = location, zoom = zoom, maptype = maptype,  :
  HTTP 400 Bad Request

# ny.map <- map('state', region = c('new york', 'new jersey'),
#     xlim=c(-74.12,-73.85), ylim=c(40.58,40.87)) 


# plot
ggmap(ny.map) + 
  stat_density2d(data=xy2, mapping=aes(x=x, y=y, fill=..level..), geom="polygon", alpha=0.2) +
  scale_fill_gradient(low = "blue", high = "red") +
  geom_path(data=circ.df, aes(x=x, y=y, group=distance), alpha=0.5) +
  geom_text(data=text.pos, aes(x=x, y=y, label=paste0(distance,"mi")))
#Error: ggmap plots objects of class ggmap, see ?get_map


#Here is the dataset I would like to use in the solution provided by this reference
https://gis.stackexchange.com/questions/133693/geographic-heatmaps-with-concentric-circles-by-distance?rq=1

dput(clus3)
new("SpatialPointsDataFrame", data = structure(list(ID = c(3L, 
57L, 87L, 141L, 173L, 286L, 287L, 335L, 553L, 574L, 598L, 634L, 
653L, 661L, 676L, 683L, 684L, 687L, 732L, 742L, 753L, 779L, 785L, 
793L, 798L, 799L, 838L, 902L, 903L, 904L, 910L, 912L, 993L, 1022L, 
1048L, 1290L, 1410L, 1414L, 1429L, 1465L, 1507L, 1518L, 1520L, 
1539L, 1546L, 1695L, 1760L, 1767L, 1769L, 1820L, 1876L, 1887L, 
1903L, 1928L, 1958L, 2062L, 2063L, 2084L, 2157L, 2230L, 2263L, 
2337L, 2339L), city = structure(c(230L, 152L, 1323L, 152L, 152L, 
152L, 823L, 1140L, 152L, 1140L, 152L, 1140L, 152L, 152L, 1140L, 
152L, 152L, 152L, 1140L, 152L, 152L, 823L, 823L, 152L, 152L, 
152L, 345L, 1140L, 823L, 152L, 152L, 1140L, 990L, 152L, 1140L, 
1140L, 1140L, 152L, 1323L, 1140L, 1140L, 1140L, 75L, 1140L, 1140L, 
1140L, 823L, 1140L, 152L, 152L, 152L, 152L, 152L, 1140L, 152L, 
562L, 152L, 1140L, 1140L, 1140L, 152L, 152L, 152L), .Label = c("ABBOTTSTOWN", 
"ABILENE", "ACWORTH", "ADAMS", "ADDISON", "ADKINS", "ALBANY", 
"ALBIA", "ALBUQUERQUE", "ALEXANDRIA", "ALFRED", "ALIQUIPPA", 
"ALISO VIEJO", "ALLEN PARK", "ALLENTOWN", "ALPHA", "ALPHARETTA", 
"ALPINE", "ALTOONA", "AMARILLO", "AMBLER", "AMBRIDGE", "AMHERST", 
"AMITYVILLE", "ANAHIEM", "ANDERSON", "ANDOVER", "ANGIER", "ANGLETON", 
"ANKENY", "ANN ARBOR", "ANZA", "APEX", "APOLLO", "ARCADIA", "ARCHDALE", 
"ARDMORE", "ARGYLE", "ARKANSAS CITY", "ARLINGTON", "ARNOLD", 
"ARTHUR", "ASHEBORO", "ASHEVILLE", "ASHLAND", "ASHLAND CITY", 
"ASHTON", "ASTON", "ATHENS", "ATLANTA", "ATLANTIC BCH", "AUBORN", 
"AUGUSTA", "AURORA", "AUSTELL", "AUSTIN", "AVENTURA", "AVONDALE ESTATES", 
"BAKERSFIELD", "BALDWIN CITY", "BALDWIN PLACE", "BALLWIN", "BANGOR", 
"BARBOURSVILLE", "BARNEGAT", "BARTLETT", "BARTON", "BARTONVILLE", 
"BASSETT", "BATAVIA", "BATESBURG", "BATON ROUGE", "BAXTER SPRINGS", 
"BAY CITY", "BAYONNE", "BAYSIDE", "BAYTOWN", "BEAR", "BEAUMONT", 
"BEECH CREEK", "BEECHER CITY", "BELFAIR", "BELLE VERNON", "BELLEAIR", 
"BELLEVUE", "BELLMAWR", "BELLMORE", "BELLWOOD", "BELMAR", "BELMONT", 
"BELVIDERE", "BENNET", "BENTON", "BENTONVILLE", "BERLIN", "BESSEMER CITY", 
"BETHANY", "BETHEL", "BETHEL PARK", "BETHESDA", "BETHLEHEM", 
"BETTENDORF", "BIGLERVILLE", "BINGHAMTON", "BIRDSBORO", "BIWABIK", 
"BLACK MOUNTAIN", "BLACKSBURG", "BLAINE", "BLAIRSVILLE", "BLAKESLEE", 
"BLOOMFIELD", "BLUE BELL", "BLUE GRASS", "BLUE POINT", "BLUE SPRINGS", 
"BOCA RATON", "BODFISH", "BOILING SPRINGS", "BOLIVAR", "BON AQUA", 
"BONNER SPRINGS", "BONNEY LAKE", "BOONEVILLE", "BOSSIER CITY", 
"BOUNTIFUL", "BOWLING GREEN", "BOYERTOWN", "BOYNTON BEACH", "BRADENTON", 
"BRADENVILLE", "BRANDAMORE", "BRANDON", "BRANFORD", "BRANSON", 
"BRASELTON", "BREEZEWOOD", "BRENTON", "BRENTWOOD", "BREWSTER", 
"BRICK", "BRIDGEPORT", "BRIDGETON", "BRIGHAM CITY", "BROADDUS", 
"BROCKPORT", "BROGUE", "BROKEN ARROW", "BRONX", "BROOKFIELD", 
"BROOKHAVEN", "BROOKLYN", "BROWNS MILLS", "BROWNSBURG", "BROWNSVILLE", 
"BRUNSWICK", "BRYAN", "BUCKSPORT", "BUDD LAKE", "BUFFALO", "BULVERDE", 
"BUNKERVILLE", "BURBANK", "BURFORD", "BURIEN", "BURLINGTON", 
"BURR RIDGE", "BURTON", "BUSKIRK", "BUTLER", "BUXTON", "BYRON", 
"CALERA", "CAMBRIDGE", "CAMP HILL", "CAMPBELL", "CANAAN", "CANAL WINCHESTER", 
"CANASTOTA", "CANTON", "CARDIFF BY THE SEA", "CARL JUNCTION", 
"CARLISLE", "CARLTON", "CAROL STREAM", "CARROLLTON", "CARSON CITY", 
"CARTERSVILLE", "CARTHAGE", "CARY", "CASEYVILLE", "CASSVILLE", 
"CASWELL", "CATO", "CEDAR RAPIDS", "CEDARBURG", "CEDARVILLE", 
"CENTER POINT", "CENTERTON", "CENTRAL ISLIP", "CENTRAL POINT", 
"CHAGRIN FALLS", "CHALFONT", "CHAPEL HILL", "CHAPIN", "CHARDON", 
"CHARITON", "CHARLESTON", "CHARLOTTE", "CHEROKEE", "CHERRY HILL", 
"CHERRY VALLEY", "CHESHIRE", "CHEST SPRINGS", "CHESTER", "CHESTERTON", 
"CHICAGO", "CHILLICOTHE", "CHOCTAW", "CICERO", "CINCINNATI", 
"CLAY", "CLEARWATER", "CLEARWATER BEACH", "CLEMMONS", "CLENDENIN", 
"CLEVELAND", "CLEVELAND HTS", "CLEVES", "CLIFFSIDE PARK", "CLIFTON", 
"CLIFTON PARK", "CLIFTON SPGS", "CLINTON", "COACHELLA", "COAL TOWNSHIP", 
"COATESVILLE", "COLLEGE STATION", "COLLINSVILLE", "COLONIA", 
"COLUMBIA", "COLUMBUS", "COMMERCE", "CONCORD", "CONCORD TOWNSHIP", 
"CONNELLSVILLE", "CONROE", "CONWAY", "CONYERS", "COOKEVILLE", 
"COON RAPIDS", "CORAOPOLIS", "CORDOVA", "CORNELIUS", "CORNWALL", 
"CORONADO", "CORPUS CHRISTI", "CORRY", "COTTAGE HILLS", "COTTLEVILLE", 
"COTTONWOOD", "COVINGTON", "COWEN", "CRANBERRY TOWNSHIP", "CROWN POINT", 
"CUBA", "CUMBERLAND CENTER", "CUMBERLAND FORESIDE", "CUMMING", 
"CUYAHOGA FLS", "CYPRESS", "DALLAS", "DALLASTOWN", "DANBURY", 
"DANIA BCH", "DANVILLE", "DAVENPORT", "DAVIE", "DAVIS JUNCTION", 
"DAWSON", "DAYTON", "DE SOTO", "DECATUR", "DEFIANCE", "DEFOREST", 
"DELAVAN", "DELMAR", "DELRAY BEACH", "DEMOTTE", "DENISON", "DENVER", 
"DEPTFORD", "DERBY", "DERRY", "DES MOINES", "DETROIT", "DICKINSON", 
"DILLSBURG", "DITTMER", "DIXON", "DONNA", "DOTHAN", "DOUGLAS", 
"DOUGLASVILLE", "DOVER", "DOYLESTOWN", "DREXEL HILL", "DUBLIN", 
"DUCHESNE", "DULUTH", "DUNCAN", "DUNCANNON", "DUNCANSVILLE", 
"DUNEDIN", "DUNNSVILLE", "DURHAM", "DUTTON", "EAGLE GROVE", "EAST AURORA", 
"EAST CHICAGO", "EAST EARL", "EAST HANOVER", "EAST HARTFORD", 
"EAST HARTLAND", "EAST LEROY", "EAST LIVERPOOL", "EAST MEADOW", 
"EAST NORTHPORT", "EAST ORANGE", "EAST PEORIA", "EAST SAINT LOUIS", 
"EASTON", "EDGERTON", "EDISON", "EDMOND", "EGG HBR TWP", "EL DORADO", 
"EL PASO", "ELDRIDGE", "ELGIN", "ELIZABETHVILLE", "ELLISVILLE", 
"ELLSWORTH", "ELLWOOD CITY", "ELMHURST", "ELMWOOD PARK", "ELOY", 
"ELY", "EMERSON", "EMORY", "ENDICOTT", "ENGLEWOOD", "ENID", "ENNICE", 
"ENOLA", "ENUMCLAW", "EPHRATA", "ERIE", "ESTERO", "EUREKA SPRINGS", 
"EVANSVILLE", "EVERETT", "EXCELSIOR SPRINGS", "EXTON", "FAIRFAX", 
"FAIRFIELD", "FAIRHAVEN", "FAIRVIEW", "FAIRVIEW PARK", "FALMOUTH", 
"FAR HILLS", "FAR ROCKAWAY", "FARMINGDALE", "FARMINGTON", "FAYETTE", 
"FAYETTEVILLE", "FELTON", "FENTON", "FERGUSON", "FIELDALE", "FINDLAY", 
"FINGERVILLE", "FLEMINGTON", "FLINT", "FLORENCE", "FLORESVILLE", 
"FLORISSANT", "FLOVILLA", "FLOWER MOUND", "FLUSHING", "FOGELSVILLE", 
"FOLSOM", "FONTANELLE", "FOREST HILLS", "FOREST PARK", "FORT DODGE", 
"FORT FAIRFIELD", "FORT GAY", "FORT LAUDERDALE", "FORT LEE", 
"FORT MILL", "FORT MOHAVE", "FORT PAYNE", "FORT PIERCE", "FORT SMITH", 
"FORT WAYNE", "FORT WORTH", "FOSTORIA", "FOUNTAIN INN", "FRANKFORT", 
"FRANKLIN", "FREEDOM", "FREEHOLD", "FREEPORT", "FREMONT", "FULLERTON", 
"FULSHEAR", "FULTON", "GADSDEN", "GAFFNEY", "GAINESVILLE", "GALLOWAY", 
"GARDEN PRAIRIE", "GARDNERS", "GARNETT VALLEY", "GARY", "GASTON", 
"GASTONIA", "GENEVA", "GETTYSBURG", "GIBSONIA", "GILBERT", "GIRARD", 
"GLEN BURNIE", "GLEN CARBON", "GLEN COVE", "GLEN MILLS", "GLENSHAW", 
"GLENVIEW", "GLENWOOD", "GOLDEN CITY", "GOLIAD", "GOODSON", "GOODYEAR", 
"GORHAM", "GOSHEN", "GRANBURY", "GRANBY", "GRAND PRAIRIE", "GRAND RAPIDS", 
"GRANDVIEW", "GRANITE CITY", "GRANITE FALLS", "GRANTS PASS", 
"GRASS VALLEY", "GRAVETTE", "GRAYSVILLE", "GREEN LANE", "GREENBRIER", 
"GREENLAWN", "GREENSBORO", "GREENSBURG", "GREENUP", "GREENVILLE", 
"GREER", "GRIFFIN", "GRIFFITH", "GROTON", "GUADALUPE", "GUILFORD", 
"HADLEY", "HAGAN", "HALF WAY", "HALLANDALE BEACH", "HAMBLETON", 
"HAMBURG", "HAMDEN", "HAMILTON", "HAMMOND", "HAMMONTON", "HAMPSHIRE", 
"HAPEVILLE", "HARBORCREEK", "HARLAN", "HARRISBURG", "HARRISON", 
"HARRISONVILLE", "HARTWELL", "HASTINGS", "HATFIELD", "HAVERHILL", 
"HAWK POINT", "HAYESVILLE", "HELEN", "HENDERSON", "HENDERSONVILLE", 
"HENRICO", "HENRIETTA", "HERMITAGE", "HERNDON", "HERSHEY", "HIALEAH", 
"HIAWATHA", "HIBBING", "HICKORY", "HICKORY GROVE", "HIDDENITE", 
"HIGH HILL", "HIGH POINT", "HIGH RIDGE", "HIGHLAND", "HIGHLAND MILLS", 
"HINCKLEY", "HIRAM", "HOBART", "HOLBROOK", "HOLDEN", "HOLDENVILLE", 
"HOLLADAY", "HOLLIS", "HOLLY SPRINGS", "HOLLYWOOD", "HOLTWOOD", 
"HOMER", "HOMESTEAD", "HONEYVILLE", "HOPE MILLS", "HOT SPRINGS", 
"HOT SPRINGS NATIONAL PARK", "HOUSTON", "HUBBARD", "HUDSON", 
"HUFFMAN", "HULL", "HUMANSVILLE", "HUNTERSVILLE", "HUNTINGDON", 
"HUNTINGTON BEACH", "HUNTS POINT", "HURDLE MILLS", "HURRICANE", 
"HURST", "IMPERIAL", "INDEPENDENCE", "INDIAN SHORES", "INDIAN TRAIL", 
"INDIANA", "INDIANAPOLIS", "INDIANOLA", "INMAN", "IOWA CITY", 
"IRMO", "IRVINGTON", "IRWIN", "ISANTI", "ISLESBORO", "ISLIP", 
"ISSAQUAH", "ITHACA", "JACKSBORO", "JACKSON", "JACKSON HTS", 
"JACKSONVILLE", "JAMAICA", "JAMESTOWN", "JASPER", "JEANNETTE", 
"JEFFERSON", "JEFFERSON CITY", "JEWELL", "JOHNSTON", "JOHNSTOWN", 
"JONESBORO", "JONESPORT", "JONESTOWN", "JOPLIN", "JUPITER", "KANKAKEE", 
"KANNAPOLIS", "KANSAS CITY", "KATY", "KEARNEY", "KELLERTON", 
"KEMAH", "KENMORE", "KENNESAW", "KENT", "KINGMAN", "KINGS MOUNTAIN", 
"KINGSLAND", "KINGSTON", "KINGWOOD", "KIRKLAND", "KUTZTOWN", 
"LA QUINTA", "LA RUE", "LA VERNE", "LAFAYETTE", "LAKE BLUFF", 
"LAKE IN THE HILL", "LAKE ISABELLA", "LAKE PLACID", "LAKE SAINT LOUIS", 
"LAKE TAPPS", "LAKE VILLAGE", "LAKE WAUKOMIS", "LAKE WORTH", 
"LAKEBAY", "LAKELAND", "LAKEWOOD", "LAKEWOOD RCH", "LAMBERTVILLE", 
"LANCASTER", "LANDISVILLE", "LANSDALE", "LAREDO", "LARGO", "LAS VEGAS", 
"LATROBE", "LAUDERHILL", "LAWNDALE", "LAWRENCE", "LAWRENCEVILLE", 
"LE MARS", "LE ROY", "LEAGUE CITY", "LEAVENWORTH", "LEAWOOD", 
"LEBANON", "LECOMPTON", "LEECHBURG", "LEES SUMMIT", "LEESBURG", 
"LEESVILLE", "LEETONIA", "LENEXA", "LENOIR", "LEVITTOWN", "LEWES", 
"LEWISTOWN", "LEXINGTON", "LIBERTY TWP", "LILLINGTON", "LINCOLN", 
"LINDENHURST", "LINTON", "LISBON", "LITCHFIELD PK", "LITHIA", 
"LITITZ", "LITTLE EGG HARBOR TO", "LK FOREST PK", "LK PEEKSKILL", 
"LOCKHART", "LOCKWOOD", "LOGAN", "LOMA LINDA", "LONE JACK", "LONG BEACH", 
"LONG LANE", "LONGVIEW", "LORAIN", "LORTON", "LOS ANGELES", "LOUISBURG", 
"LOVES PARK", "LOWER BURRELL", "LOWRY CITY", "LUBBOCK", "LUGOFF", 
"LUMBERTON", "LYNBROOK", "LYNNWOOD", "MACHESNEY PARK", "MACON", 
"MAGNOLIA", "MAHOPAC", "MAHWAH", "MAINEVILLE", "MALVERN", "MALVERNE", 
"MANASSAS", "MANCHACA", "MANCHESTER", "MANCHESTER TOWNSHIP", 
"MANCHESTER TW", "MANHEIM", "MANITO", "MANLIUS", "MANNINGTON", 
"MANSFIELD", "MANSURA", "MAPLE PARK", "MARBLE FALLS", "MARCELLUS", 
"MARICOPA", "MARIETTA", "MARION", "MARKLEYSBURG", "MARS HILL", 
"MARSHALLTOWN", "MARSHFIELD", "MARSHVILLE", "MARTINSVILLE", "MARYSVILLE", 
"MASON CITY", "MASSEY", "MASSILLON", "MASURY", "MATAWAN", "MATEWAN", 
"MATTAPOISETT", "MATTHEWS", "MAYFIELD HTS", "MAYSEL", "MC CLELLAND", 
"MC DONALD", "MC KEES ROCKS", "MC SHERRYSTOWN", "MC VEYTOWN", 
"MCALESTER", "MCDONOUGH", "MCKEESPORT", "MCKINNEY", "MECHANICSBURG", 
"MECHANICSVILLE", "MEDFORD", "MEDIA", "MEDWAY", "MELVILLE", "MEMPHIS", 
"MERIDEN", "MERRIAM", "MERRICK", "MERRILL", "MERRILLVILLE", "MESA", 
"MESQUITE", "MIAMI", "MIAMI GARDENS", "MICHIGAN CITY", "MIDDLETOWN", 
"MIDLAND", "MIFFLINTOWN", "MILFORD", "MILL CREEK", "MILLBROOK", 
"MILLEDGEVILLE", "MILLINOCKET", "MILNER", "MILTON", "MILWAUKEE", 
"MINEOLA", "MINERAL SPGS", "MINERAL WELLS", "MINNEAPOLIS", "MISSION", 
"MISSION HILLS", "MISSION VIEJO", "MISSOURI CITY", "MISSOURI VALLEY", 
"MOLINE", "MONESSEN", "MONROE", "MONROE TOWNSHIP", "MONROEVILLE", 
"MONTCLAIR", "MONTEREY", "MONTICELLO", "MOORESVILLE", "MORGANTON", 
"MORGANTOWN", "MORRIS PLAINS", "MOUND", "MOUND CITY", "MOUNT HOPE", 
"MOUNT JOY", "MOUNT LAUREL", "MOUNT PLEASANT", "MOUNT POCONO", 
"MOUNT UNION", "MOUNT WOLF", "MOUNTVILLE", "MT HOLLY", "MT PLEASANT", 
"MULVANE", "MUNCIE", "MUNSTER", "MURFREESBORO", "MURRAY", "MURRELLS INLT", 
"MUSTANG", "MYERSTOWN", "MYSTIC", "N BRANFORD", "N FT MYERS", 
"NAPERVILLE", "NAPLES", "NAPOLEON", "NASHVILLE", "NATCHITOCHES", 
"NAUGATUCK", "NEOSHO", "NEPTUNE BEACH", "NESCONSET", "NETCONG", 
"NEW BLOOMFIELD", "NEW BRAUNFELS", "NEW BRITAIN", "NEW BRUNSWICK", 
"NEW CASTLE", "NEW CUMBERLAND", "NEW HAVEN", "NEW KENSINGTON", 
"NEW LONDON", "NEW ORLEANS", "NEW PRESTON", "NEW PROVIDENCE", 
"NEW ROCHELLE", "NEW TRIPOLI", "NEW ULM", "NEW WINDSOR", "NEW YORK", 
"NEWARK", "NEWBURGH HEIGHTS", "NEWINGTON", "NEWNAN", "NEWPORT", 
"NEWPORT BEACH", "NEWTON", "NEWTONVILLE", "NIAGARA FALLS", "NIXA", 
"NOANK", "NOKOMIS", "NORCROSS", "NORFOLK", "NORMAN", "NORMANDY PARK", 
"NORTH BABYLON", "NORTH HAVEN", "NORTH HUNTINGDON", "NORTH JACKSON", 
"NORTH LITTLE ROCK", "NORTH MIAMI", "NORTH PORT", "NORTH RICHLAND HILLS", 
"NORTH WALES", "NORTH WATERBORO", "NORTHFIELD", "NORTHRIDGE", 
"NORTON", "NORWALK", "NOTTINGHAM", "NUTLEY", "NYACK", "O FALLON", 
"OAK RIDGE", "OAKDALE", "OCALA", "OCEANSIDE", "OCILLA", "OLATHE", 
"OMAHA", "OMRO", "ONA", "ONALASKA", "OPA LOCKA", "ORADLL", "ORION", 
"ORONO", "ORRINGTON", "OSCEOLA", "OSKALOOSA", "OSSINING", "OSWEGO", 
"OTTAWA", "OVALO", "OVERLAND PARK", "OWASSO", "OWEGO", "OXFORD", 
"OYSTER BAY", "OZARK", "PALERMO", "PALM CITY", "PALM HARBOR", 
"PALMDALE", "PALMYRA", "PALOS HEIGHTS", "PANA", "PAOLA", "PARK RIDGE", 
"PARLIN", "PARMA", "PARRISH", "PARROTT", "PATASKALA", "PAULS VALLEY", 
"PAXTON", "PEA RIDGE", "PEARLAND", "PECULIAR", "PEEKSKILL", "PEKIN", 
"PELION", "PEMBROKE", "PEMBROKE PINES", "PENN YAN", "PENNELLVILLE", 
"PENNSBURG", "PENNSVILLE", "PEORIA", "PERRY", "PERRYOPOLIS", 
"PERRYSBURG", "PERRYVILLE", "PHARR", "PHILADELPHIA", "PHILIPPI", 
"PHOENIX", "PICKENS", "PICKERINGTON", "PIERSON", "PILOT MOUNTAIN", 
"PINE BLUFF", "PINE HILL", "PINEVILLE", "PINNELLAS PARK", "PISCATAWAY", 
"PITMAN", "PITTSBURGH", "PLACIDA", "PLAINFIELD", "PLANO", "PLANT CITY", 
"PLATTEKILL", "PLEASANT HILL", "PLEASANT HOPE", "PLYMOUTH", "POCONO LAKE", 
"POMFRET CENTER", "POMPANO BEACH", "POOLER", "PORT CARBON", "PORT CHARLOTTE", 
"PORT NORRIS", "PORT ORANGE", "PORT SAINT LUCIE", "PORT WASHINGTON", 
"PORTAGE", "PORTER", "PORTERSVILLE", "PORTLAND", "POTTSVILLE", 
"POUGHKEEPSIE", "POWDER SPRINGS", "POWELL", "PRAIRIE VILLAGE", 
"PRESCOTT", "PRESCOTT VALLEY", "PRINCETON", "PROSPECT", "PT PLEASANT", 
"PUNTA GORDA", "PURCHASE", "QUAKERTOWN", "QUEENS VLG", "QUINCY", 
"RALEIGH", "RANDLEMAN", "RANDOLPH", "RAYTOWN", "READING", "READLYN", 
"RED BANK", "RED HOUSE", "RED LION", "REEDERS", "REGO PARK", 
"REHOBOTH BCH", "REIDSVILLE", "RENO", "RENTON", "REPUBLIC", "RICH HILL", 
"RICHARDS", "RICHMOND", "RICHMOND HILL", "RIDGEWOOD", "RINCON", 
"RIO GRANDE CITY", "RIO RANCHO", "RIVERDALE", "RIVERHEAD", "RIVERSIDE", 
"ROANOKE", "ROCHELLE", "ROCHESTER", "ROCK HILL", "ROCKAWAY BCH", 
"ROCKFORD", "ROCKMART", "ROCKY HILL", "ROCKY MOUNT", "ROGERS", 
"ROGERSVILLE", "ROMULUS", "ROOSEVELT", "ROSAMOND", "ROSCOE", 
"ROSENBERG", "ROSENDALE", "ROSWELL", "ROTONDA WEST", "ROUGEMONT", 
"ROXBORO", "ROY", "RUNNELLS", "RURAL HALL", "RUSH VALLEY", "RUSKIN", 
"RUSTBURG", "RUTHER GLEN", "RUTHERFORDTON", "S DEERFIELD", "SACO", 
"SAGINAW", "SAINT AUGUSTINE", "SAINT CHARLES", "SAINT CLAIR", 
"SAINT CLAIRSVILLE", "SAINT LOUIS", "SAINT MARYS", "SAINT MATTHEWS", 
"SAINT PAULS", "SAINT PETERS", "SAINT PETERSBURG", "SALEM", "SALISBURY", 
"SALT LAKE CITY", "SALTSBURG", "SALUNGA", "SAMMAMISH", "SAN ANTONIO", 
"SAN BENITO", "SAN CLEMENTE", "SAN DIEGO", "SAN ELIZARIO", "SAN JUAN", 
"SANDUSKY", "SANDY", "SANFORD", "SANGERVILLE", "SANTA ANA", "SARASOTA", 
"SARATOGA SPRINGS", "SARCOXIE", "SAUGUS", "SAVANNAH", "SAYVILLE", 
"SCALY MOUNTAIN", "SCHAEFFERSTOWN", "SCHULENBURG", "SCOTT", "SCOTTSDALE", 
"SEAFORD", "SEALE", "SEATTLE", "SEDONA", "SEGUIN", "SELDEN", 
"SENECA", "SENOIA", "SEVEN VALLEYS", "SEYMOUR", "SHARON", "SHARPSBURG", 
"SHARPSVILLE", "SHAVANO PARK", "SHAWNEE", "SHELLSBURG", "SHELTON", 
"SHENANDOAH", "SHORELINE", "SHOREWOOD", "SHREVEPORT", "SICKLERVILLE", 
"SILER CITY", "SILOAM SPRINGS", "SIMON", "SIMPSONVILLE", "SIMSBURY", 
"SIOUX CITY", "SIOUX FALLS", "SKOKIE", "SKOWHEGAN", "SLATINGTON", 
"SLIDELL", "SMITHFIELD", "SN BERNRDNO", "SNELLVILLE", "SOCORRO", 
"SOMERS", "SOPHIA", "SOUTH AMBOY", "SOUTH BELOIT", "SOUTH BEND", 
"SOUTH DARTMOUTH", "SOUTH HOUSTON", "SOUTH PARK", "SOUTH PLAINFIELD", 
"SOUTH SIOUX CITY", "SOUTHAMPTON", "SOUTHBURY", "SOUTHGATE", 
"SPARKS", "SPARROW BUSH", "SPENCER", "SPRING", "SPRING BRANCH", 
"SPRING GROVE", "SPRING HILL", "SPRING HOPE", "SPRING VALLEY", 
"SPRINGDALE", "SPRINGFIELD", "SPRINGFIELD GARDENS", "SPRINGHILL", 
"SPRINGTOWN", "SPRNGFLD GDNS", "SPRUCE PINE", "ST PETERSBURG", 
"ST. GEORGE", "STAFFORD", "STAMFORD", "STANDISH", "STANLEY", 
"STANTON", "STATEN ISLAND", "STATESVILLE", "STERLING", "STILLMAN VALLEY", 
"STILWELL", "STOCKBRIDGE", "STOCKTON", "STONE MTN", "STRAFFORD", 
"STRATFORD", "STRONGSVILLE", "STROUDSBURG", "STRUTHERS", "SUFFIELD", 
"SUGAR HILL", "SUGAR LAND", "SULPHUR", "SUMMERVILLE", "SUMMIT", 
"SUN CITY", "SUNBURY", "SUWANEE", "SWANSEA", "SWANTON", "SWEENY", 
"SWISSVALE", "SYCAMORE", "SYLVANIA", "SYRACUSE", "TACOMA", "TAFTVILLE", 
"TAMPA", "TAPPAHANNOCK", "TAR HEEL", "TAUNTON", "TAYLORVILLE", 
"TECUMSEH", "THE WOODLANDS", "THEODOSIA", "THOMASTON", "THOMASVILLE", 
"TIERRA VERDE", "TIFTON", "TILLSON", "TILTON", "TINLEY PARK", 
"TOCCOA", "TOLEDO", "TOLLAND", "TOMBALL", "TOMS RIVER", "TOPEKA", 
"TOPSHAM", "TORRINGTON", "TOVEY", "TOWNSEND", "TRAVELERS RST", 
"TRENT", "TRINITY", "TROUTMAN", "TROY", "TRUMBULL", "TUCKER", 
"TULALIP", "TURNER", "TUSCUMBIA", "TYRONE", "UNION", "UNION CITY", 
"UNIVERSAL CTY", "UNIVERSITY HTS", "UPPR CHICHSTR", "URBANA", 
"URBANDALE", "UTICA", "VAIL", "VALE", "VALENCIA", "VALPARAISO", 
"VAN BUREN", "VAN METER", "VAN WERT", "VANDERGRIFT", "VASSALBORO", 
"VAUGHN", "VENICE", "VERNAL", "VERNON", "VERONA", "VICTOR", "VIDALIA", 
"VIENNA", "VILLA GROVE", "VILLA RIDGE", "VOLANT", "W HAMPTON BCH", 
"W TERRE HAUTE", "WADSWORTH", "WAHOO", "WAKE FOREST", "WALDEN", 
"WALLINGFORD", "WALLINGTON", "WALNUT COVE", "WANAQUE", "WARFORDSBURG", 
"WARMINSTER", "WARREN", "WARSAW", "WARTHEN", "WASHINGTON", "WASOLA", 
"WATAUGA", "WATERBURY", "WATERFORD", "WATERLOO", "WATERVILLE", 
"WATKINS GLEN", "WAXAHACHIE", "WAYCROSS", "WAYNESBORO", "WEBSTER", 
"WEIRTON", "WELLSBORO", "WELLSVILLE", "WENTZVILLE", "WESLACO", 
"WEST CHESTER", "WEST DEPTFORD", "WEST DES MOINES", "WEST HAVEN", 
"WEST HICKORY", "WEST LIBERTY", "WEST MIFFLIN", "WEST PALM BEACH", 
"WEST POINT", "WEST READING", "WEST SENECA", "WEST SUFFIELD", 
"WEST VALLEY CITY", "WESTERVILLE", "WESTHAMPTON", "WESTMINSTER", 
"WESTMORELAND CITY", "WESTPORT", "WESTVILLE", "WETHERSFIELD", 
"WHARTON", "WHEELING", "WHITE PLAINS", "WHITEHALL", "WHITESTONE", 
"WHITESTOWN", "WHITING", "WHITMAN", "WHITTIER", "WICHITA", "WILDWOOD", 
"WILLARD", "WILLIAMSBURG", "WILLIAMSPORT", "WILLOW GROVE", "WILLOWBROOK", 
"WILLOWICK", "WILMETTE", "WILMINGTON", "WILSON", "WILTON MANORS", 
"WIMBERLEY", "WINDCREST", "WINDER", "WINNEBAGO", "WINSIDE", "WINSTON", 
"WINSTON SALEM", "WINTERSET", "WINTHROP", "WOLCOTT", "WOODBRIDGE", 
"WOODBURY HEIGHTS", "WOODLAND PARK", "WOODLAWN", "WOODS CROSS", 
"WOODSIDE", "WOODSTOCK", "WORTHINGTON", "WYOMISSING", "YARMOUTH", 
"YOE", "YONKERS", "YORK", "YORKTOWN", "YORKTOWN HEIGHTS", "YOUNG HARRIS", 
"YOUNGSTOWN", "YPSILANTI", "ZELIENOPLE", "ZEPHYRHILLS"), class = "factor"), 
    Longitude = c(-73.995761, -73.919757, -73.901704, -73.99728, 
    -73.966576, -73.90666, -74.00156, -74.139018, -73.964397, 
    -74.217701, -73.97337, -74.085848, -74.016758, -73.973516, 
    -74.126856, -73.934765, -73.953425, -74.002203, -74.088222, 
    -73.9429, -73.958444, -74.00212, -74.00271, -73.976911, -73.998995, 
    -73.962247, -73.872685, -74.200874, -73.966365, -73.970639, 
    -73.955408, -74.161088, -73.900613, -73.973114, -74.090524, 
    -74.153605, -74.128318, -73.921273, -73.906545, -74.182027, 
    -74.169198, -74.131182, -74.105751, -74.21093, -74.15824, 
    -74.100691, -73.94765, -74.096255, -74.0071, -73.948231, 
    -73.928844, -73.985222, -73.908936, -74.106965, -73.994567, 
    -73.894023, -73.914155, -74.130657, -74.128292, -74.064724, 
    -73.943069, -73.923314, -73.9731), Latitude = c(40.809175, 
    40.701661, 40.751745, 40.67782, 40.590695, 40.64745, 40.75194, 
    40.629037, 40.689129, 40.545124, 40.578366, 40.635833, 40.623769, 
    40.57672, 40.629612, 40.623998, 40.581446, 40.639925, 40.603879, 
    40.63933, 40.656341, 40.727757, 40.73855, 40.579848, 40.61122, 
    40.593927, 40.745527, 40.528453, 40.807577, 40.589197, 40.577279, 
    40.590244, 40.709039, 40.673746, 40.571051, 40.588417, 40.574502, 
    40.68636, 40.739854, 40.564292, 40.554251, 40.557496, 40.677064, 
    40.548405, 40.583232, 40.588659, 40.77633, 40.639926, 40.67494, 
    40.599486, 40.686703, 40.633875, 40.613306, 40.560111, 40.606369, 
    40.749488, 40.607459, 40.615182, 40.623143, 40.594011, 40.593785, 
    40.668828, 40.58116)), class = "data.frame", row.names = c(NA, 
-63L)), coords.nrs = 5:6, coords = structure(c(-73.995761, -73.919757, 
-73.901704, -73.99728, -73.966576, -73.90666, -74.00156, -74.139018, 
-73.964397, -74.217701, -73.97337, -74.085848, -74.016758, -73.973516, 
-74.126856, -73.934765, -73.953425, -74.002203, -74.088222, -73.9429, 
-73.958444, -74.00212, -74.00271, -73.976911, -73.998995, -73.962247, 
-73.872685, -74.200874, -73.966365, -73.970639, -73.955408, -74.161088, 
-73.900613, -73.973114, -74.090524, -74.153605, -74.128318, -73.921273, 
-73.906545, -74.182027, -74.169198, -74.131182, -74.105751, -74.21093, 
-74.15824, -74.100691, -73.94765, -74.096255, -74.0071, -73.948231, 
-73.928844, -73.985222, -73.908936, -74.106965, -73.994567, -73.894023, 
-73.914155, -74.130657, -74.128292, -74.064724, -73.943069, -73.923314, 
-73.9731, 40.809175, 40.701661, 40.751745, 40.67782, 40.590695, 
40.64745, 40.75194, 40.629037, 40.689129, 40.545124, 40.578366, 
40.635833, 40.623769, 40.57672, 40.629612, 40.623998, 40.581446, 
40.639925, 40.603879, 40.63933, 40.656341, 40.727757, 40.73855, 
40.579848, 40.61122, 40.593927, 40.745527, 40.528453, 40.807577, 
40.589197, 40.577279, 40.590244, 40.709039, 40.673746, 40.571051, 
40.588417, 40.574502, 40.68636, 40.739854, 40.564292, 40.554251, 
40.557496, 40.677064, 40.548405, 40.583232, 40.588659, 40.77633, 
40.639926, 40.67494, 40.599486, 40.686703, 40.633875, 40.613306, 
40.560111, 40.606369, 40.749488, 40.607459, 40.615182, 40.623143, 
40.594011, 40.593785, 40.668828, 40.58116), .Dim = c(63L, 2L), .Dimnames = list(
    c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
    "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", 
    "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", 
    "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", 
    "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", 
    "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", 
    "62", "63"), c("lon", "lat"))), bbox = structure(c(-74.217701, 
40.528453, -73.872685, 40.809175), .Dim = c(2L, 2L), .Dimnames = list(
    c("lon", "lat"), c("min", "max"))), proj4string = new("CRS", 
    projargs = "+init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))

Thank you for any assistance.
WHP


Proprietary

NOTICE TO RECIPIENT OF INFORMATION:\ This e-mail may con...{{dropped:16}}


From j@ck@onmrodr|gue@ @end|ng |rom gm@||@com  Thu May 28 00:18:59 2020
From: j@ck@onmrodr|gue@ @end|ng |rom gm@||@com (Jackson Rodrigues)
Date: Wed, 27 May 2020 19:18:59 -0300
Subject: [R-sig-Geo] Comparing 2 rasterbricks using functions from TSdist
 package
Message-ID: <CAPL76w_Ud7G+AAm_j5_9jwN-z414LfadKztQZGdWb-aMAceEiw@mail.gmail.com>

Dear all,

Few days ago I got a important help from this list and I am really thankful
for that.
Today I have a similar challenge with 2 rasterbrick files.

I would like to compare 2 rasterbricks using any similarity function (let's
take CorDistance) from package TSdist.
In my real data, both rasterbricks came from the same region but using
different measurement techniques.

I am trying to adapt the suggestion I got from here rather than looping on
each cell, but no matter what I try I always get an error related to NA.
It seems to be very simples but I am stuck since last Monday.

I have played with several conditional ("ifelse", "if", "if else" etc) and
logical tests ("|", "||", "&" etc) but I got nothing so far.

Could someone help me and show me a path to go through?
Below there is the cleanest code I have tried.

Best regards

Jackson

##############
library(raster)
library(TSdist)

set.seed(12)
r <- raster(nrow=10, ncol=10)
s <- lapply(1:200, function(i) setValues(r, rnorm(ncell(r),
                                                  sample.int(5,1), 0.5)))
s <- stack(s)
s[s < 0] <- NA
s2<-s^2

# Visualize that some pixels have NAs and other don't
hasna <- stackApply(s, indices = 1, fun = function(x, na.rm){anyNA(x)})
hasna2 <- stackApply(s2, indices = 1, fun = function(x, na.rm){anyNA(x)})

par(mfrow=c(1,2))
plot(hasna);plot(hasna2)

# CorDistance function does not handle NAs
CorDistance(as.vector(s[1]),as.vector(s2[1]))
[1] 0.2192382

CorDistance(as.vector(s[2]),as.vector(s2[2]))
<simpleError in .common.ts.sanity.check(x): NA in the series>
  [1] NA

fun <- function(x,y){
  out <- ifelse(anyNA(x) | anyNA(y),
                yes = NA,
                no = unname(CorDistance(x,y)))
  return(out)
}

# Check that it works
fun(as.vector(s[1]),as.vector(s2[1]))
[1] 0.2192382

# Check that it does not work
fun(as.vector(s[2]),as.vector(s2[2]))
[1] NA

new_s1 <- fun(s,s2)
<simpleError in if (any(is.na(x))) { stop("NA in the series")}:
  argument is not interpretable as logical>

# Check that it does not work with calc
new_s2 <- calc(s,s2, fun = fun)
Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
  cannot use this function

plot(s_out)
#############

-- 

Jackson M. Rodrigues

	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Thu May 28 09:05:09 2020
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Thu, 28 May 2020 09:05:09 +0200
Subject: [R-sig-Geo] 
 Comparing 2 rasterbricks using functions from TSdist package
In-Reply-To: <CAPL76w_Ud7G+AAm_j5_9jwN-z414LfadKztQZGdWb-aMAceEiw@mail.gmail.com>
References: <CAPL76w_Ud7G+AAm_j5_9jwN-z414LfadKztQZGdWb-aMAceEiw@mail.gmail.com>
Message-ID: <c3f326f2-6f35-4ef9-71aa-5243146e73df@gmail.com>

Dear Jackson,

I think this is what you are searching for:
new_s3 <- setValues(r, sapply(1:ncell(r), function(i) 
fun(as.vector(s[i]), as.vector(s2[i]))))
plot(new_s3, colNA = "red")

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences



2020.05.28. 0:18 keltez?ssel, Jackson Rodrigues ?rta:
> Dear all,
>
> Few days ago I got a important help from this list and I am really thankful
> for that.
> Today I have a similar challenge with 2 rasterbrick files.
>
> I would like to compare 2 rasterbricks using any similarity function (let's
> take CorDistance) from package TSdist.
> In my real data, both rasterbricks came from the same region but using
> different measurement techniques.
>
> I am trying to adapt the suggestion I got from here rather than looping on
> each cell, but no matter what I try I always get an error related to NA.
> It seems to be very simples but I am stuck since last Monday.
>
> I have played with several conditional ("ifelse", "if", "if else" etc) and
> logical tests ("|", "||", "&" etc) but I got nothing so far.
>
> Could someone help me and show me a path to go through?
> Below there is the cleanest code I have tried.
>
> Best regards
>
> Jackson
>
> ##############
> library(raster)
> library(TSdist)
>
> set.seed(12)
> r <- raster(nrow=10, ncol=10)
> s <- lapply(1:200, function(i) setValues(r, rnorm(ncell(r),
>                                                    sample.int(5,1), 0.5)))
> s <- stack(s)
> s[s < 0] <- NA
> s2<-s^2
>
> # Visualize that some pixels have NAs and other don't
> hasna <- stackApply(s, indices = 1, fun = function(x, na.rm){anyNA(x)})
> hasna2 <- stackApply(s2, indices = 1, fun = function(x, na.rm){anyNA(x)})
>
> par(mfrow=c(1,2))
> plot(hasna);plot(hasna2)
>
> # CorDistance function does not handle NAs
> CorDistance(as.vector(s[1]),as.vector(s2[1]))
> [1] 0.2192382
>
> CorDistance(as.vector(s[2]),as.vector(s2[2]))
> <simpleError in .common.ts.sanity.check(x): NA in the series>
>    [1] NA
>
> fun <- function(x,y){
>    out <- ifelse(anyNA(x) | anyNA(y),
>                  yes = NA,
>                  no = unname(CorDistance(x,y)))
>    return(out)
> }
>
> # Check that it works
> fun(as.vector(s[1]),as.vector(s2[1]))
> [1] 0.2192382
>
> # Check that it does not work
> fun(as.vector(s[2]),as.vector(s2[2]))
> [1] NA
>
> new_s1 <- fun(s,s2)
> <simpleError in if (any(is.na(x))) { stop("NA in the series")}:
>    argument is not interpretable as logical>
>
> # Check that it does not work with calc
> new_s2 <- calc(s,s2, fun = fun)
> Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
>    cannot use this function
>
> plot(s_out)
> #############
>


-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 9865 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20200528/45235511/attachment.png>

From |o|c@dutr|eux @end|ng |rom c|r@d@|r  Thu May 28 12:49:25 2020
From: |o|c@dutr|eux @end|ng |rom c|r@d@|r (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Thu, 28 May 2020 12:49:25 +0200
Subject: [R-sig-Geo] 
 Comparing 2 rasterbricks using functions from TSdist package
In-Reply-To: <c3f326f2-6f35-4ef9-71aa-5243146e73df@gmail.com>
References: <CAPL76w_Ud7G+AAm_j5_9jwN-z414LfadKztQZGdWb-aMAceEiw@mail.gmail.com>
 <c3f326f2-6f35-4ef9-71aa-5243146e73df@gmail.com>
Message-ID: <15c924f3-6e16-8502-b204-30a116b7ffed@cirad.fr>

Hi Jackson,

calc is meant to apply a function pixel wise on a single raster object. 
Its equivalent for multiple raster objects is overlay.

Kind regards,
Lo?c

On 05/28/2020 09:05 AM, Bede-Fazekas ?kos wrote:
> Dear Jackson,
> 
> I think this is what you are searching for:
> new_s3 <- setValues(r, sapply(1:ncell(r), function(i) 
> fun(as.vector(s[i]), as.vector(s2[i]))))
> plot(new_s3, colNA = "red")
> 
> HTH,
> ?kos Bede-Fazekas
> Hungarian Academy of Sciences
> 
> 
> 
> 2020.05.28. 0:18 keltez?ssel, Jackson Rodrigues ?rta:
>> Dear all,
>>
>> Few days ago I got a important help from this list and I am really 
>> thankful
>> for that.
>> Today I have a similar challenge with 2 rasterbrick files.
>>
>> I would like to compare 2 rasterbricks using any similarity function 
>> (let's
>> take CorDistance) from package TSdist.
>> In my real data, both rasterbricks came from the same region but using
>> different measurement techniques.
>>
>> I am trying to adapt the suggestion I got from here rather than 
>> looping on
>> each cell, but no matter what I try I always get an error related to NA.
>> It seems to be very simples but I am stuck since last Monday.
>>
>> I have played with several conditional ("ifelse", "if", "if else" etc) 
>> and
>> logical tests ("|", "||", "&" etc) but I got nothing so far.
>>
>> Could someone help me and show me a path to go through?
>> Below there is the cleanest code I have tried.
>>
>> Best regards
>>
>> Jackson
>>
>> ##############
>> library(raster)
>> library(TSdist)
>>
>> set.seed(12)
>> r <- raster(nrow=10, ncol=10)
>> s <- lapply(1:200, function(i) setValues(r, rnorm(ncell(r),
>> ?????????????????????????????????????????????????? sample.int(5,1), 
>> 0.5)))
>> s <- stack(s)
>> s[s < 0] <- NA
>> s2<-s^2
>>
>> # Visualize that some pixels have NAs and other don't
>> hasna <- stackApply(s, indices = 1, fun = function(x, na.rm){anyNA(x)})
>> hasna2 <- stackApply(s2, indices = 1, fun = function(x, na.rm){anyNA(x)})
>>
>> par(mfrow=c(1,2))
>> plot(hasna);plot(hasna2)
>>
>> # CorDistance function does not handle NAs
>> CorDistance(as.vector(s[1]),as.vector(s2[1]))
>> [1] 0.2192382
>>
>> CorDistance(as.vector(s[2]),as.vector(s2[2]))
>> <simpleError in .common.ts.sanity.check(x): NA in the series>
>> ?? [1] NA
>>
>> fun <- function(x,y){
>> ?? out <- ifelse(anyNA(x) | anyNA(y),
>> ???????????????? yes = NA,
>> ???????????????? no = unname(CorDistance(x,y)))
>> ?? return(out)
>> }
>>
>> # Check that it works
>> fun(as.vector(s[1]),as.vector(s2[1]))
>> [1] 0.2192382
>>
>> # Check that it does not work
>> fun(as.vector(s[2]),as.vector(s2[2]))
>> [1] NA
>>
>> new_s1 <- fun(s,s2)
>> <simpleError in if (any(is.na(x))) { stop("NA in the series")}:
>> ?? argument is not interpretable as logical>
>>
>> # Check that it does not work with calc
>> new_s2 <- calc(s,s2, fun = fun)
>> Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
>> ?? cannot use this function
>>
>> plot(s_out)
>> #############
>>
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From Roger@B|v@nd @end|ng |rom nhh@no  Thu May 28 13:52:04 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Thu, 28 May 2020 13:52:04 +0200
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
Message-ID: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>

With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including 
users of the CRAN Windows binary when it comes) will be part of the big 
migration to WKT2 from Proj4 strings for CRS representation. See

https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html

or for a better rendering of "\phi" and bib-handling:

https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html

for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the 
full sf and sp story.

You will see lots of warnings, they should grab your attention, that is 
what they are for. We need your attention to be as sure as we can be that 
your results - if affected by the transition - have been checked by you.

I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*. 
In some weeks but before flipping the defaults, I'll follow up showing 
ways of muting them, but we really need to be confident that this 
necessary and future-proofing change isn't silently destroying your work 
first. So please don't treat the many warnings as just pesky and nagging - 
they are priming your immune system to check for unwanted consequences of 
your legacy CRS representation choices.

I'd also like to thank the maintainers of packages importing 
from/depending on sp/rgdal for largely positive responses to issues raised 
and emails sent, often less polite than they might have been, but grabbing 
attention was more important. From over 70 broken reverse dependency 
packages we are now well under 20, and I've contacted all of those, with 
only a couple not responding. Edzer has seen similar responsiveness for 
the parallel migration of sf.

Enjoy!

Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Po||ngW @end|ng |rom @etn@@com  Thu May 28 15:01:18 2020
From: Po||ngW @end|ng |rom @etn@@com (Poling, William)
Date: Thu, 28 May 2020 13:01:18 +0000
Subject: [R-sig-Geo] Help with geocode()  & get_map() please
In-Reply-To: <CAPP0wyh=GJKEgWdjKdeZ3F=-u55uQ8xn2gk9qeC3MmLuNqZWMg@mail.gmail.com>
References: <mailman.28109.5.1590660002.64557.r-sig-geo@r-project.org>
 <CAPP0wyh=GJKEgWdjKdeZ3F=-u55uQ8xn2gk9qeC3MmLuNqZWMg@mail.gmail.com>
Message-ID: <BYAPR06MB5383498EA60CD7FA413B9997AE8E0@BYAPR06MB5383.namprd06.prod.outlook.com>

Ok, thank you, I suspected that and was unsure how to proceed beyond what I had described originally.

I will review your reference.

Thank you for your response Kent, much appreciated.

WHP

From: Kent Johnson <kent3737 at gmail.com> 
Sent: Thursday, May 28, 2020 7:52 AM
To: r-sig-geo at r-project.org; Poling, William <PolingW at aetna.com>
Subject: [EXTERNAL] Re: Help with geocode() & get_map() please

**** External Email - Use Caution ****
On Thu, May 28, 2020 at 6:03 AM <mailto:r-sig-geo-request at r-project.org> wrote:
Message: 1
Date: Wed, 27 May 2020 19:55:26 +0000
From: "Poling, William" <mailto:PolingW at aetna.com>
Subject: [R-sig-Geo] Help with geocode()? & get_map() please
?
2. I am having trouble with get_map()

ny.map <- get_map("New York", zoom = 8)

Source : https://urldefense.proofpoint.com/v2/url?u=https-3A__maps.googleapis.com_maps_api_staticmap-3Fcenter-3DNew-2520York-26zoom-3D8-26size-3D640x640-26scale-3D2-26maptype-3Dterrain-26language-3Den-2DEN-26key-3D-5B012819-2D836529-2D634EA5-5D&d=DwMFaQ&c=wluqKIiwffOpZ6k5sqMWMBOn0vyYnlulRJmmvOXCFpM&r=j7MrcIQm2xjHa8v-2mTpmTCtKvneM2ExlYvnUWbsByY&m=CsMl9LHpa9ULoNXKdkrUT6ekC9fM5srAwGtqAbNgep0&s=l5KYIQUC-rz6VESNkigtwbi7rx-YYayVqIrdsrN0prE&e=
Error in aperm.default(map, c(2, 1, 3)) : 
invalid first argument, must be an array
In addition: Warning message:
In get_googlemap(center = location, zoom = zoom, maptype = maptype,? :
? HTTP 400 Bad Request 

This looks like the problem described here:
https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_dkahle_ggmap_issues_262&d=DwMFaQ&c=wluqKIiwffOpZ6k5sqMWMBOn0vyYnlulRJmmvOXCFpM&r=j7MrcIQm2xjHa8v-2mTpmTCtKvneM2ExlYvnUWbsByY&m=CsMl9LHpa9ULoNXKdkrUT6ekC9fM5srAwGtqAbNgep0&s=TegKIx-xo3fzI61Ul_ejBvccaNAV2c0cHSrQV5-5rNg&e=

It is a problem with your Google credentials.?

Kent?

Proprietary

NOTICE TO RECIPIENT OF INFORMATION:
This e-mail may contain confidential or privileged information. If you think you have received this e-mail in error, please advise the sender by reply e-mail and then delete this e-mail immediately.  
This e-mail may also contain protected health information (PHI) with information about sensitive medical conditions, including, but not limited to, treatment for substance use disorders, behavioral health, HIV/AIDS, or pregnancy. This type of information may be protected by various federal and/or state laws which prohibit any further disclosure without the express written consent of the person to whom it pertains or as otherwise permitted by law. Any unauthorized further disclosure may be considered a violation of federal and/or state law. A general authorization for the release of medical or other information may NOT be sufficient consent for release of this type of information.
Thank you. Aetna

From A|ex@nder@Herr @end|ng |rom c@|ro@@u  Thu May 28 17:10:46 2020
From: A|ex@nder@Herr @end|ng |rom c@|ro@@u (Herr, Alexander (L&W, Black Mountain))
Date: Thu, 28 May 2020 15:10:46 +0000
Subject: [R-sig-Geo] ggplot grids  polygons,
 points and lines with sperate legens
Message-ID: <MEAPR01MB4149EBDA74C4975136807EE3EB8E0@MEAPR01MB4149.ausprd01.prod.outlook.com>

Hi,

I am unsuccessfully trying to adjust the legend for a multiple feature plot of geom_tile, and geom_sf (with polygons, lines and points).  I would like to have 1) the geom_tile legend separate from the geom_sf polygon legend and also 2) have the legend descriptors ordered descending and 3) each legend for polygon, line and point should have the respective pattern/color, that is rectangle for polygons, lines for lines and shapes for points.

Reproducible code below. Any suggestions?
Thanks
Herry

XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
require(sf)
require(sp)

pols<-st_as_sf(spPolygons(rbind(c(1,1),c(1,10),c(10,10),c(10,1),c(1,1))))
p1 =st_sfc((st_polygon(list(rbind(c(0,0), c(0,10), c(10,10), c(10,0), c(0,0))))))
pts<-as.data.frame(st_coordinates(st_make_grid(p1,cellsize=1,what='centers')) )%>%mutate(Value=unlist(lapply(1:10,function(x) sample.int(10,n=3, replace=T))) )
lins<-st_as_sf(rbind(spLines(rbind(c(2,3),c(9,9))),spLines(rbind(c(2,7),c(8,1)))))%>%
          transmute(Line=c("6","7"))
p2<-st_as_sf(spPolygons(rbind(c(1,1),c(9,9),c(9,4),c(1,1))))
p3<-st_as_sf(spPolygons(rbind(c(1,1),c(1,7),c(7,7),c(7,5),c(1,1))))
polys<-st_as_sf(rbind(p2,p3))%>%transmute(Fill=c("4","5"))
ponts<-st_as_sf(pts,coords=c("X","Y") )

ptscols<-c("salmon","light blue","orange")
polycols<-c("dark red","aquamarine")
lncols<-c("deepskyblue","gold")

ggplot()+geom_tile(data=pts, aes(x=X,y=Y,fill=as.character(Value)), show.legend=T )  +
         geom_sf(data=polys, aes(fill=as.character(Fill)), alpha=0.5, size=2,show.legend=T)+
         geom_sf(data=lins, aes(color=Line),legend=T, size=5) +
         geom_sf(data=ponts, aes(shape=as.character(Value)), size=10, show.legend=T)+
         scale_fill_manual("Grid",values=c(ptscols,polycols),
              breaks = c(as.character(unique(pts$Value)),polys$Fill),
                        guide = guide_legend(overrid.aes=list(linetype = NULL, shape=NULL))) +
              scale_color_manual("Lines",values=lncols, breaks = lins$Line,
                        guide = guide_legend(override.aes = list(linetype = "solid", size=5)))   +
              scale_shape_manual("Points",values=unique(as.character(ponts$Value)), breaks = ponts$Value,
                        guide = guide_legend(override.aes = list(size=10)))


	[[alternative HTML version deleted]]


From b|@|ev||@t @end|ng |rom gm@||@com  Thu May 28 18:17:21 2020
From: b|@|ev||@t @end|ng |rom gm@||@com (=?UTF-8?Q?Bede-Fazekas_=c3=81kos?=)
Date: Thu, 28 May 2020 18:17:21 +0200
Subject: [R-sig-Geo] ggplot grids polygons,
 points and lines with sperate legens
In-Reply-To: <MEAPR01MB4149EBDA74C4975136807EE3EB8E0@MEAPR01MB4149.ausprd01.prod.outlook.com>
References: <MEAPR01MB4149EBDA74C4975136807EE3EB8E0@MEAPR01MB4149.ausprd01.prod.outlook.com>
Message-ID: <8b155917-4ea3-cbb4-1fdc-b09354ea7865@gmail.com>

Hello Harry,
it is not the final solution, just one a part of it:

fill_levels <- unique(c(polys$Fill, pts$Value))
polys$Fill <- factor(x = polys$Fill, levels = fill_levels)
pts$Value <- factor(x = pts$Value, levels = fill_levels)
ponts$Value <- as.factor(ponts$Value)
ggplot()+
 ??? geom_tile(data=pts, aes(x=X,y=Y,fill=Value), show.legend=F) +
 ??? geom_sf(data=polys, aes(fill=Fill), alpha=0.5, 
size=2,show.legend="polygon")+
 ??? geom_sf(data=lins, aes(color=Line),show.legend="line", size=5) +
 ??? geom_sf(data=ponts, aes(shape=Value), size=10, show.legend="point") +
 ??? scale_fill_manual("Grid",values=c(ptscols,polycols)) +
 ??? scale_color_manual("Lines",values=lncols) +
scale_shape_manual("Points",values=as.numeric(levels(ponts$Value))) +
 ??? guides(fill = guide_legend(override.aes = list(linetype = 0, shape 
= 0)), color = guide_legend(override.aes = list(shape = 0, linetype = 
"solid", size=5)), shape = guide_legend(override.aes = list(linetype = 
0, size=10)))

HTH,
?kos Bede-Fazekas
Hungarian Academy of Sciences

2020.05.28. 17:10 keltez?ssel, Herr, Alexander (L&W, Black Mountain) ?rta:
> Hi,
>
> I am unsuccessfully trying to adjust the legend for a multiple feature plot of geom_tile, and geom_sf (with polygons, lines and points).  I would like to have 1) the geom_tile legend separate from the geom_sf polygon legend and also 2) have the legend descriptors ordered descending and 3) each legend for polygon, line and point should have the respective pattern/color, that is rectangle for polygons, lines for lines and shapes for points.
>
> Reproducible code below. Any suggestions?
> Thanks
> Herry
>
> XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
> require(sf)
> require(sp)
>
> pols<-st_as_sf(spPolygons(rbind(c(1,1),c(1,10),c(10,10),c(10,1),c(1,1))))
> p1 =st_sfc((st_polygon(list(rbind(c(0,0), c(0,10), c(10,10), c(10,0), c(0,0))))))
> pts<-as.data.frame(st_coordinates(st_make_grid(p1,cellsize=1,what='centers')) )%>%mutate(Value=unlist(lapply(1:10,function(x) sample.int(10,n=3, replace=T))) )
> lins<-st_as_sf(rbind(spLines(rbind(c(2,3),c(9,9))),spLines(rbind(c(2,7),c(8,1)))))%>%
>            transmute(Line=c("6","7"))
> p2<-st_as_sf(spPolygons(rbind(c(1,1),c(9,9),c(9,4),c(1,1))))
> p3<-st_as_sf(spPolygons(rbind(c(1,1),c(1,7),c(7,7),c(7,5),c(1,1))))
> polys<-st_as_sf(rbind(p2,p3))%>%transmute(Fill=c("4","5"))
> ponts<-st_as_sf(pts,coords=c("X","Y") )
>
> ptscols<-c("salmon","light blue","orange")
> polycols<-c("dark red","aquamarine")
> lncols<-c("deepskyblue","gold")
>
> ggplot()+geom_tile(data=pts, aes(x=X,y=Y,fill=as.character(Value)), show.legend=T )  +
>           geom_sf(data=polys, aes(fill=as.character(Fill)), alpha=0.5, size=2,show.legend=T)+
>           geom_sf(data=lins, aes(color=Line),legend=T, size=5) +
>           geom_sf(data=ponts, aes(shape=as.character(Value)), size=10, show.legend=T)+
>           scale_fill_manual("Grid",values=c(ptscols,polycols),
>                breaks = c(as.character(unique(pts$Value)),polys$Fill),
>                          guide = guide_legend(overrid.aes=list(linetype = NULL, shape=NULL))) +
>                scale_color_manual("Lines",values=lncols, breaks = lins$Line,
>                          guide = guide_legend(override.aes = list(linetype = "solid", size=5)))   +
>                scale_shape_manual("Points",values=unique(as.character(ponts$Value)), breaks = ponts$Value,
>                          guide = guide_legend(override.aes = list(size=10)))
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Po||ngW @end|ng |rom @etn@@com  Thu May 28 19:29:23 2020
From: Po||ngW @end|ng |rom @etn@@com (Poling, William)
Date: Thu, 28 May 2020 17:29:23 +0000
Subject: [R-sig-Geo] Help with geocode()  & get_map() please
In-Reply-To: <CAPP0wyh=GJKEgWdjKdeZ3F=-u55uQ8xn2gk9qeC3MmLuNqZWMg@mail.gmail.com>
References: <mailman.28109.5.1590660002.64557.r-sig-geo@r-project.org>
 <CAPP0wyh=GJKEgWdjKdeZ3F=-u55uQ8xn2gk9qeC3MmLuNqZWMg@mail.gmail.com>
Message-ID: <BYAPR06MB538334A0D596A2BB3EBB6455AE8E0@BYAPR06MB5383.namprd06.prod.outlook.com>

Hello again.

With Google help chat I discovered that I (we all) have a cloud billing Key and an API key.

I had everything correct in the cloud dashboard in terms of enabled API's, however, I was repeatedly trying to register the billing key and getting the errors after running the scripts, UGH!

register_google(key = "000000-000000-000AA0", write = TRUE) Billing Key NO GOOD
register_google(key = "Blahblah0BBLLAAHHblahlllaaabb00blah", write = TRUE) API Key from credentials GOOD

I hope this helps someone else down stream

Thank you Kent!

WHP

From: Kent Johnson <kent3737 at gmail.com> 
Sent: Thursday, May 28, 2020 7:52 AM
To: r-sig-geo at r-project.org; Poling, William <PolingW at aetna.com>
Subject: [EXTERNAL] Re: Help with geocode() & get_map() please

**** External Email - Use Caution ****
On Thu, May 28, 2020 at 6:03 AM <mailto:r-sig-geo-request at r-project.org> wrote:
Message: 1
Date: Wed, 27 May 2020 19:55:26 +0000
From: "Poling, William" <mailto:PolingW at aetna.com>
Subject: [R-sig-Geo] Help with geocode()? & get_map() please
?
2. I am having trouble with get_map()

ny.map <- get_map("New York", zoom = 8)

Source : https://urldefense.proofpoint.com/v2/url?u=https-3A__maps.googleapis.com_maps_api_staticmap-3Fcenter-3DNew-2520York-26zoom-3D8-26size-3D640x640-26scale-3D2-26maptype-3Dterrain-26language-3Den-2DEN-26key-3D-5B012819-2D836529-2D634EA5-5D&d=DwMFaQ&c=wluqKIiwffOpZ6k5sqMWMBOn0vyYnlulRJmmvOXCFpM&r=j7MrcIQm2xjHa8v-2mTpmTCtKvneM2ExlYvnUWbsByY&m=CsMl9LHpa9ULoNXKdkrUT6ekC9fM5srAwGtqAbNgep0&s=l5KYIQUC-rz6VESNkigtwbi7rx-YYayVqIrdsrN0prE&e=
Error in aperm.default(map, c(2, 1, 3)) : 
invalid first argument, must be an array
In addition: Warning message:
In get_googlemap(center = location, zoom = zoom, maptype = maptype,? :
? HTTP 400 Bad Request 

This looks like the problem described here:
https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_dkahle_ggmap_issues_262&d=DwMFaQ&c=wluqKIiwffOpZ6k5sqMWMBOn0vyYnlulRJmmvOXCFpM&r=j7MrcIQm2xjHa8v-2mTpmTCtKvneM2ExlYvnUWbsByY&m=CsMl9LHpa9ULoNXKdkrUT6ekC9fM5srAwGtqAbNgep0&s=TegKIx-xo3fzI61Ul_ejBvccaNAV2c0cHSrQV5-5rNg&e=

It is a problem with your Google credentials.?

Kent?

Proprietary

NOTICE TO RECIPIENT OF INFORMATION:
This e-mail may contain confidential or privileged information. If you think you have received this e-mail in error, please advise the sender by reply e-mail and then delete this e-mail immediately.  
This e-mail may also contain protected health information (PHI) with information about sensitive medical conditions, including, but not limited to, treatment for substance use disorders, behavioral health, HIV/AIDS, or pregnancy. This type of information may be protected by various federal and/or state laws which prohibit any further disclosure without the express written consent of the person to whom it pertains or as otherwise permitted by law. Any unauthorized further disclosure may be considered a violation of federal and/or state law. A general authorization for the release of medical or other information may NOT be sufficient consent for release of this type of information.
Thank you. Aetna

From |v|@|e|ro @end|ng |rom gm@||@com  Thu May 28 20:21:52 2020
From: |v|@|e|ro @end|ng |rom gm@||@com (Frederico Faleiro)
Date: Thu, 28 May 2020 15:21:52 -0300
Subject: [R-sig-Geo] 
 Comparing 2 rasterbricks using functions from TSdist package
In-Reply-To: <15c924f3-6e16-8502-b204-30a116b7ffed@cirad.fr>
References: <CAPL76w_Ud7G+AAm_j5_9jwN-z414LfadKztQZGdWb-aMAceEiw@mail.gmail.com>
 <c3f326f2-6f35-4ef9-71aa-5243146e73df@gmail.com>
 <15c924f3-6e16-8502-b204-30a116b7ffed@cirad.fr>
Message-ID: <CAL+ycW=f3cP36-Di+n9TsfhOy3s9Uz2CKP156_LAM7368rQA8A@mail.gmail.com>

Hi Jackson,

you could use the complete.cases function to remove the pairs with NA
before run the distance function as bellow.

# CorDistance function does not handle NAs
x <- cbind(as.vector(s[[1]]), as.vector(s2[[1]]))
select.rows <- complete.cases(x)
CorDistance(x[select.rows, ] )

Cheers!
-- 
Frederico Faleiro
Postdoctoral Researcher in the INCT-EECBio (https://www.eecbio.ufg.br/)
Department of Ecology | Institute of Biological Science | Federal
University of Goi?s | Brazil
RG: https://www.researchgate.net/profile/Frederico_Faleiro
CV: http://lattes.cnpq.br/4926404840659003

	[[alternative HTML version deleted]]


From p@tr|ck@@chr@tz @end|ng |rom gm@||@com  Fri May 29 14:06:39 2020
From: p@tr|ck@@chr@tz @end|ng |rom gm@||@com (Patrick Schratz)
Date: Fri, 29 May 2020 14:06:39 +0200
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
Message-ID: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>

The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is 
present.
It does not even install the package if this condition is not met but 
errors during linking.

I could not find any sources in the web or in the announcement post of 
v1.5.8 why this condition was enforced so strictly.
Does it cause unwanted results?
If so, then there is a big issue since the ?gdal2 and proj >= 6? 
combination has been used by many people in the past already.
I haven?t tracked down for how long this situation was on the market 
already.
Also the {sf} package is still installable with this combination and I 
am not aware of any warnings/issues that came up due to this so far.

It further causes complete breakage for people relying on the homebrew 
package manager on macOS since current versions are gdal v2.2.4 and proj 
7.0.1.
The update to gdal3 is blocked since months due to an incompatibility 
with `liblas` (https://github.com/libLAS/libLAS/issues/164). Reading the 
issue, it looks unclear when this issue will be resolved.
The alternative osgeo4mac tap holds formula that is unstable and 
somewhat broken. One cannot link rgdal with the current gdal v3.0.1 from 
osgeo4mac.

This incompatibility with homebrew-core formula leads to further issues 
for CI tests that rely on the spatial homebrew stack for macOS builds.

All of this is really unfortunate and I am wondering if this was a known 
factor when introducing this condition in the new release.
Unfortunately rgdal is not hosted on any Git* provider (there is just 
the CRAN mirror with not much information about the recent changes) and 
it is unclear/untransparent to me if there is a continuous integration 
setup at all for this package.
I hope this is not another case in the series ?I do not like operating 
system XY and hence I do not test on it? which was seen recently in 
another package. That?s what CI is for and the responsibility of 
package authors.

Also one should be aware that not every rgdal user is member of this 
mailing list (I guess not even 5%) and many people in production will 
face this error during install, most of them without any clue what to do 
or an idea why this was raised.

In summary it would be great if

- There would be more detailed information on the introduction of the 
new condition
- Awareness of state-of-the-art platform related library versions before 
making such a release
- Transparency/Existence of a cross-platform build process
- If the incompatibility is just due to some features not being 
accessible with this configuration, I suggest to raise a warning during 
package load but not prevent the package from installing in the first 
place
- A version-based NEWS file would be available. Currently one only sees 
a revision-based Changelog: 
https://cran.r-project.org/web/packages/rgdal/ChangeLog

I am well aware that I am indirectly criticising (hopefully in a 
constructive way) the transparency and release process here, for which I 
will probably get a rough response.
However, if that leads to more robustness and transparency in future 
release, I am fine with this.

A quick patch release resolving the breakage would be highly 
appreciated.

Best, Patrick
	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri May 29 14:45:32 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 29 May 2020 14:45:32 +0200
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
In-Reply-To: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
References: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
Message-ID: <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>

On Fri, 29 May 2020, Patrick Schratz wrote:

> The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is 
> present. It does not even install the package if this condition is not 
> met but errors during linking.

Please document with the output of 00install.out from R CMD check 
rgdal_1.5-8.tar.gz, and pkg-config proj --modversion, gdalinfo --version 
with system details.

Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no sense 
with PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API and the 
old metadata structure with Proj4 string degradation; GDAL < 3 with PROJ 
>= 6 must use the deprecated API and the new metadata structure.

>
> I could not find any sources in the web or in the announcement post of
> v1.5.8 why this condition was enforced so strictly.
> Does it cause unwanted results?

Yes, definitely. GDAL 3 was released as 3, not 2.5, to stress the complete 
break between GDAL 2 (with PROJ <= 5) and GDAL >= 3 (with PROJ >= 6) after 
GDAL barnraising. So:

           PROJ
           < 6 >= 6 
GDAL < 3   OK   NO
     >= 3   NO   OK



> If so, then there is a big issue since the ?gdal2 and proj >= 6?
> combination has been used by many people in the past already.

No good precedent, just binary packagers protecting slow downstream 
adaptation.

> I haven?t tracked down for how long this situation was on the market
> already.
> Also the {sf} package is still installable with this combination and I
> am not aware of any warnings/issues that came up due to this so far.
>

rgdal is a much older package and has much more older code that needs this 
protection. It is possible to accommodate the no-go areas, but I'd really 
value patches to R-forge, as I cannot check multiple PROJ/GDAL version 
combinations just because someone isn't up to speed.

> It further causes complete breakage for people relying on the homebrew
> package manager on macOS since current versions are gdal v2.2.4 and proj
> 7.0.1.

They should never have gone beyond PROJ 5 if they are stuck on GDAL. PROJ 
7 is a very different animal.

> The update to gdal3 is blocked since months due to an incompatibility
> with `liblas` (https://github.com/libLAS/libLAS/issues/164). Reading the
> issue, it looks unclear when this issue will be resolved.
> The alternative osgeo4mac tap holds formula that is unstable and
> somewhat broken. One cannot link rgdal with the current gdal v3.0.1 from
> osgeo4mac.
>
> This incompatibility with homebrew-core formula leads to further issues
> for CI tests that rely on the spatial homebrew stack for macOS builds.
>
> All of this is really unfortunate and I am wondering if this was a known
> factor when introducing this condition in the new release.
> Unfortunately rgdal is not hosted on any Git* provider (there is just
> the CRAN mirror with not much information about the recent changes) and
> it is unclear/untransparent to me if there is a continuous integration
> setup at all for this package.

Do not require me to leave the excellent SVN service on R-forge. Provide 
patches there.

> I hope this is not another case in the series ?I do not like operating
> system XY and hence I do not test on it? which was seen recently in
> another package. That?s what CI is for and the responsibility of
> package authors.
>

I run and develop on Fedora, I  have no access to OSX, and the current 
release was fully checked with ~ 900 revdeps repeatedly since November on 
successive older and newer versions of PROJ and GDAL. I blocked new PROJ 
with old GDAL recently to simplify development. CI is only as good as the 
scripts, I am completely sure that repeated revdep testing and reading the 
output is superior.

> Also one should be aware that not every rgdal user is member of this
> mailing list (I guess not even 5%) and many people in production will
> face this error during install, most of them without any clue what to do
> or an idea why this was raised.
>

There has been plenty of information given about the CRS changes. rgdal 
could simply have been abandoned by me, and all  those production 
volunteers might have fixed things, but I never hear anything at all.

> In summary it would be great if
>
> - There would be more detailed information on the introduction of the
> new condition
> - Awareness of state-of-the-art platform related library versions before
> making such a release
> - Transparency/Existence of a cross-platform build process
> - If the incompatibility is just due to some features not being
> accessible with this configuration, I suggest to raise a warning during
> package load but not prevent the package from installing in the first
> place
> - A version-based NEWS file would be available. Currently one only sees
> a revision-based Changelog:
> https://cran.r-project.org/web/packages/rgdal/ChangeLog
>
> I am well aware that I am indirectly criticising (hopefully in a
> constructive way) the transparency and release process here, for which I
> will probably get a rough response.
> However, if that leads to more robustness and transparency in future
> release, I am fine with this.
>
> A quick patch release resolving the breakage would be highly
> appreciated.

Only with community imput. what you ask is not needed, just extra 
complexity. Please provide patches, or accept my invitation to join the 
R-forge project and commit your fixes directly. I can see how to do it, 
but I don't think it makes sense, and your messsage has not motivated me, 
to be honest. I'm prioritizing working with CRAN to iron out reverse 
dependency problems.

Roger

>
> Best, Patrick
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Fri May 29 18:37:59 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 29 May 2020 18:37:59 +0200
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
In-Reply-To: <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
References: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
 <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
Message-ID: <alpine.LFD.2.22.394.2005291837350.3230794@reclus.nhh.no>

I have put a tarball, built without vignettes with GDAL 2.2.4 and PROJ 
7.0.1 that passes CMD check (with warnings for missing vignettes) on:

http://spatial.nhh.no/R/rgdal/gdal_1.5-9.tar.gz

It involves code copying to provide duplicated functions in three 
settings:

PROJ < 6 & GDAL < 3
PROJ >= 6 & GDAL >= 3
PROJ >= 6 & GDAL < 3 (your homebrew case)

You need the configure argument: 
--configure-args=--with-proj_api=proj_api.h.
Without the argument, you now get directed to use it.

For now I've dropped the configure tests for sqlite3, curl and tiff; works 
for me but may not work for you.

Please make the output of:

R CMD check --install-args="--configure-args=--with-proj_api=proj_api.h" 
rgdal_1.5-9.tar.gz

available ASAP. I count on an immediate response.

Roger

On Fri, 29 May 2020, Roger Bivand wrote:

> On Fri, 29 May 2020, Patrick Schratz wrote:
>
>>  The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is
>>  present. It does not even install the package if this condition is not met
>>  but errors during linking.
>
> Please document with the output of 00install.out from R CMD check 
> rgdal_1.5-8.tar.gz, and pkg-config proj --modversion, gdalinfo --version with 
> system details.
>
> Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no sense with 
> PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API and the old 
> metadata structure with Proj4 string degradation; GDAL < 3 with PROJ 
>> = 6 must use the deprecated API and the new metadata structure.
>
>>
>>  I could not find any sources in the web or in the announcement post of
>>  v1.5.8 why this condition was enforced so strictly.
>>  Does it cause unwanted results?
>
> Yes, definitely. GDAL 3 was released as 3, not 2.5, to stress the complete 
> break between GDAL 2 (with PROJ <= 5) and GDAL >= 3 (with PROJ >= 6) after 
> GDAL barnraising. So:
>
>           PROJ
>           < 6 >= 6 
> GDAL < 3   OK   NO
>    > = 3   NO   OK
>
>
>
>>  If so, then there is a big issue since the ?gdal2 and proj >= 6?
>>  combination has been used by many people in the past already.
>
> No good precedent, just binary packagers protecting slow downstream 
> adaptation.
>
>>  I haven?t tracked down for how long this situation was on the market
>>  already.
>>  Also the {sf} package is still installable with this combination and I
>>  am not aware of any warnings/issues that came up due to this so far.
>> 
>
> rgdal is a much older package and has much more older code that needs this 
> protection. It is possible to accommodate the no-go areas, but I'd really 
> value patches to R-forge, as I cannot check multiple PROJ/GDAL version 
> combinations just because someone isn't up to speed.
>
>>  It further causes complete breakage for people relying on the homebrew
>>  package manager on macOS since current versions are gdal v2.2.4 and proj
>>  7.0.1.
>
> They should never have gone beyond PROJ 5 if they are stuck on GDAL. PROJ 7 
> is a very different animal.
>
>>  The update to gdal3 is blocked since months due to an incompatibility
>>  with `liblas` (https://github.com/libLAS/libLAS/issues/164). Reading the
>>  issue, it looks unclear when this issue will be resolved.
>>  The alternative osgeo4mac tap holds formula that is unstable and
>>  somewhat broken. One cannot link rgdal with the current gdal v3.0.1 from
>>  osgeo4mac.
>>
>>  This incompatibility with homebrew-core formula leads to further issues
>>  for CI tests that rely on the spatial homebrew stack for macOS builds.
>>
>>  All of this is really unfortunate and I am wondering if this was a known
>>  factor when introducing this condition in the new release.
>>  Unfortunately rgdal is not hosted on any Git* provider (there is just
>>  the CRAN mirror with not much information about the recent changes) and
>>  it is unclear/untransparent to me if there is a continuous integration
>>  setup at all for this package.
>
> Do not require me to leave the excellent SVN service on R-forge. Provide 
> patches there.
>
>>  I hope this is not another case in the series ?I do not like operating
>>  system XY and hence I do not test on it? which was seen recently in
>>  another package. That?s what CI is for and the responsibility of
>>  package authors.
>> 
>
> I run and develop on Fedora, I  have no access to OSX, and the current 
> release was fully checked with ~ 900 revdeps repeatedly since November on 
> successive older and newer versions of PROJ and GDAL. I blocked new PROJ with 
> old GDAL recently to simplify development. CI is only as good as the scripts, 
> I am completely sure that repeated revdep testing and reading the output is 
> superior.
>
>>  Also one should be aware that not every rgdal user is member of this
>>  mailing list (I guess not even 5%) and many people in production will
>>  face this error during install, most of them without any clue what to do
>>  or an idea why this was raised.
>> 
>
> There has been plenty of information given about the CRS changes. rgdal could 
> simply have been abandoned by me, and all  those production volunteers might 
> have fixed things, but I never hear anything at all.
>
>>  In summary it would be great if
>>
>>  - There would be more detailed information on the introduction of the
>>  new condition
>>  - Awareness of state-of-the-art platform related library versions before
>>  making such a release
>>  - Transparency/Existence of a cross-platform build process
>>  - If the incompatibility is just due to some features not being
>>  accessible with this configuration, I suggest to raise a warning during
>>  package load but not prevent the package from installing in the first
>>  place
>>  - A version-based NEWS file would be available. Currently one only sees
>>  a revision-based Changelog:
>>  https://cran.r-project.org/web/packages/rgdal/ChangeLog
>>
>>  I am well aware that I am indirectly criticising (hopefully in a
>>  constructive way) the transparency and release process here, for which I
>>  will probably get a rough response.
>>  However, if that leads to more robustness and transparency in future
>>  release, I am fine with this.
>>
>>  A quick patch release resolving the breakage would be highly
>>  appreciated.
>
> Only with community imput. what you ask is not needed, just extra complexity. 
> Please provide patches, or accept my invitation to join the R-forge project 
> and commit your fixes directly. I can see how to do it, but I don't think it 
> makes sense, and your messsage has not motivated me, to be honest. I'm 
> prioritizing working with CRAN to iron out reverse dependency problems.
>
> Roger
>
>>
>>  Best, Patrick
>>   [[alternative HTML version deleted]]
>>
>>  _______________________________________________
>>  R-sig-Geo mailing list
>>  R-sig-Geo at r-project.org
>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From p@tr|ck@@chr@tz @end|ng |rom gm@||@com  Fri May 29 21:43:24 2020
From: p@tr|ck@@chr@tz @end|ng |rom gm@||@com (Patrick Schratz)
Date: Fri, 29 May 2020 21:43:24 +0200
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
In-Reply-To: <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
References: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
 <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
Message-ID: <0BDD2F32-3ECD-4CAE-A440-5C487281EA86@gmail.com>

It?s gdal 2.4.4 instead of 2.2.4 as written before. Should not make a 
difference though.

```
pkg-config proj --modversion
7.0.1

gdalinfo --version
GDAL 2.4.4, released 2020/01/08
```

With revision 993 checked out from svn I see

``?
checking for unistd.h... yes
checking proj.h usability... yes
checking proj.h presence... yes
checking for proj.h... yes
checking for proj_context_create in -lproj... yes
checking Using GDAL < 3 with PROJ >= 6... yes
configure: error: GDAL >= 3 should be used with PROJ >= 6, use 
--with-proj_api="proj_api.h" for deprecated API
```

> Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no sense 
> with PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API and 
> the old metadata structure with Proj4 string degradation; GDAL < 3 
> with PROJ

What does ?makes no sense? mean here? I am interested whether this 
combination produces significant bugs when being used together.
If its just ?the user won?t be able to make use of proj7 features 
without gdal3? but apart from this everything is fine, then I do not 
see **any** reason for this strict installation blocker.
While both gdal and proj are coupled tightly, I would expect assertions 
in the upstream libraries to account for such clashes.
It seems unlikely that client packages like rgdal need to prevent 
installation if this undesired version mixture of both libraries is 
found.

> No good precedent, just binary packagers protecting slow downstream 
> adaptation.

Not sure what you mean here exactly. My point is that the gdal2 + proj7 
combination exists since March 6 in homebrew. Meaning that since then 
users on macOS used this combination.

commit 7234fc2073e5475931238281493ae3367b4dcdf6
Author: Stephan H?gel <shugel at tcd.ie>
Date:   Fri Mar 6 12:56:51 2020 +0000

     proj 7.0.0


> rgdal is a much older package and has much more older code that needs 
> this protection. It is possible to accommodate the no-go areas, but 
> I'd really value patches to R-forge, as I cannot check multiple 
> PROJ/GDAL version combinations just because someone isn't up to speed.

I cannot argue about any needed protection here. However, if that is the 
case then there was a danger zone of almost 3 months on macOS now.
IF that combination causes unwanted side-effects (which is still not 
fully answered).
I am not saying that you should check every gdal/proj combination on 
every platform/distribution, especially not on the niche ones.
However, there are three main platforms (with Ubuntu being the main 
Linux one) and it is part of the game (imo) for client packages to check 
valid installations at least on those three platforms, using their 
default package manager.
If that would have happened, we would not be writing here probably 
because you would have recognised the issue and maybe enforced  the 
update to GDAL3 on macOS or postponed the rgdal update.
It would be great if that kind of coverage could be done in the future.

> Do not require me to leave the excellent SVN service on R-forge. 
> Provide patches there.

I am just sharing my user experience, which is probably the view of many 
others.
More contributions would be made if contributing would be easier. 
R-forge and svn do not make it attractive.
It will always be your choice, no question that.
But if you want to provide a service to the community, sometimes there 
is more to that than just code/releases.

> CI is only as good as the scripts, I am completely sure that repeated 
> revdep testing and reading the output is superior.

CI and revdep checks are two different things.
CI happens at every commit (in the best scenario) and on multiple 
platforms. It aims at package AND platform integrity.
Revdepchecks are on the package side, tackling a completely different 
layer of security.
As of today (but actually since at least 5 years) there are no excuses 
for not being able to check on all main platforms despite arguing with 
?I do not want to do it but rely on my very own local test setup?.

> There has been plenty of information given about the CRS changes. 
> rgdal could simply have been abandoned by me, and all those production 
> volunteers might have fixed things, but I never hear anything at all.

Not sure what this should tell me/us. If you need help maintaining the 
package or porting its infrastructure to the 21st century then there 
would be a lot of people willing to help.#
However, replying to (useful) criticism with ?I could have simply 
abandoned it, be thankful (to me), guys? (that?s my interpretation 
of this sentence) does not help anyone.
No one questions your contributions to the r-spatial community.
However, adapting to new (development) changes and making it easier for 
others to contribute is also a very valuable contribution that is not 
really measurable in any unit.

> Only with community imput. what you ask is not needed, just extra 
> complexity. Please provide patches, or accept my invitation to join 
> the R-forge project and commit your fixes directly. I can see how to 
> do it, but I don't think it makes sense, and your messsage has not 
> motivated me, to be honest. I'm prioritizing working with CRAN to iron 
> out reverse dependency problems.

Ok, I understood. Sadly I have not enough time fighting to break up old 
structures and changing things to the better/making things easier if 
there is no real support from the other side.
The r-spatial community is not really a ?community? in my eyes but a 
conglomerate of three (four) main persons doing it their way, each 
completely different, with few motivation to change things.
Each semester students ask me how the relations between the packages and 
their authors are and why things are so different.
I am not going to expand on what I tell them usually, but often enough 
they come to me with their personal view after some time and all I need 
to say is ?yes? or ?no? (sadly most often ?yes?).
What this means is left as an exercise to the reader.

Regards, Patrick

On 29 May 2020, at 14:45, Roger Bivand wrote:

> On Fri, 29 May 2020, Patrick Schratz wrote:
>
>> The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is 
>> present. It does not even install the package if this condition is 
>> not met but errors during linking.
>
> Please document with the output of 00install.out from R CMD check 
> rgdal_1.5-8.tar.gz, and pkg-config proj --modversion, gdalinfo 
> --version with system details.
>
> Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no sense 
> with PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API and 
> the old metadata structure with Proj4 string degradation; GDAL < 3 
> with PROJ
>> = 6 must use the deprecated API and the new metadata structure.
>
>>
>> I could not find any sources in the web or in the announcement post 
>> of
>> v1.5.8 why this condition was enforced so strictly.
>> Does it cause unwanted results?
>
> Yes, definitely. GDAL 3 was released as 3, not 2.5, to stress the 
> complete break between GDAL 2 (with PROJ <= 5) and GDAL >= 3 (with 
> PROJ >= 6) after GDAL barnraising. So:
>
>           PROJ
>           < 6 >= 6 GDAL < 3   OK   NO
>      >= 3   NO   OK
>
>
>
>> If so, then there is a big issue since the ?gdal2 and proj >= 6?
>> combination has been used by many people in the past already.
>
> No good precedent, just binary packagers protecting slow downstream 
> adaptation.
>
>> I haven?t tracked down for how long this situation was on the 
>> market
>> already.
>> Also the {sf} package is still installable with this combination and 
>> I
>> am not aware of any warnings/issues that came up due to this so far.
>>
>
> rgdal is a much older package and has much more older code that needs 
> this protection. It is possible to accommodate the no-go areas, but 
> I'd really value patches to R-forge, as I cannot check multiple 
> PROJ/GDAL version combinations just because someone isn't up to speed.
>
>> It further causes complete breakage for people relying on the 
>> homebrew
>> package manager on macOS since current versions are gdal v2.2.4 and 
>> proj
>> 7.0.1.
>
> They should never have gone beyond PROJ 5 if they are stuck on GDAL. 
> PROJ 7 is a very different animal.
>
>> The update to gdal3 is blocked since months due to an incompatibility
>> with `liblas` (https://github.com/libLAS/libLAS/issues/164). Reading 
>> the
>> issue, it looks unclear when this issue will be resolved.
>> The alternative osgeo4mac tap holds formula that is unstable and
>> somewhat broken. One cannot link rgdal with the current gdal v3.0.1 
>> from
>> osgeo4mac.
>>
>> This incompatibility with homebrew-core formula leads to further 
>> issues
>> for CI tests that rely on the spatial homebrew stack for macOS 
>> builds.
>>
>> All of this is really unfortunate and I am wondering if this was a 
>> known
>> factor when introducing this condition in the new release.
>> Unfortunately rgdal is not hosted on any Git* provider (there is just
>> the CRAN mirror with not much information about the recent changes) 
>> and
>> it is unclear/untransparent to me if there is a continuous 
>> integration
>> setup at all for this package.
>
> Do not require me to leave the excellent SVN service on R-forge. 
> Provide patches there.
>
>> I hope this is not another case in the series ?I do not like 
>> operating
>> system XY and hence I do not test on it? which was seen recently in
>> another package. That?s what CI is for and the responsibility of
>> package authors.
>>
>
> I run and develop on Fedora, I  have no access to OSX, and the current 
> release was fully checked with ~ 900 revdeps repeatedly since November 
> on successive older and newer versions of PROJ and GDAL. I blocked new 
> PROJ with old GDAL recently to simplify development. CI is only as 
> good as the scripts, I am completely sure that repeated revdep testing 
> and reading the output is superior.
>
>> Also one should be aware that not every rgdal user is member of this
>> mailing list (I guess not even 5%) and many people in production will
>> face this error during install, most of them without any clue what to 
>> do
>> or an idea why this was raised.
>>
>
> There has been plenty of information given about the CRS changes. 
> rgdal could simply have been abandoned by me, and all  those 
> production volunteers might have fixed things, but I never hear 
> anything at all.
>
>> In summary it would be great if
>>
>> - There would be more detailed information on the introduction of the
>> new condition
>> - Awareness of state-of-the-art platform related library versions 
>> before
>> making such a release
>> - Transparency/Existence of a cross-platform build process
>> - If the incompatibility is just due to some features not being
>> accessible with this configuration, I suggest to raise a warning 
>> during
>> package load but not prevent the package from installing in the first
>> place
>> - A version-based NEWS file would be available. Currently one only 
>> sees
>> a revision-based Changelog:
>> https://cran.r-project.org/web/packages/rgdal/ChangeLog
>>
>> I am well aware that I am indirectly criticising (hopefully in a
>> constructive way) the transparency and release process here, for 
>> which I
>> will probably get a rough response.
>> However, if that leads to more robustness and transparency in future
>> release, I am fine with this.
>>
>> A quick patch release resolving the breakage would be highly
>> appreciated.
>
> Only with community imput. what you ask is not needed, just extra 
> complexity. Please provide patches, or accept my invitation to join 
> the R-forge project and commit your fixes directly. I can see how to 
> do it, but I don't think it makes sense, and your messsage has not 
> motivated me, to be honest. I'm prioritizing working with CRAN to iron 
> out reverse dependency problems.
>
> Roger
>
>>
>> Best, Patrick
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From p@tr|ck@@chr@tz @end|ng |rom gm@||@com  Fri May 29 22:05:11 2020
From: p@tr|ck@@chr@tz @end|ng |rom gm@||@com (Patrick Schratz)
Date: Fri, 29 May 2020 22:05:11 +0200
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
In-Reply-To: <alpine.LFD.2.22.394.2005291837350.3230794@reclus.nhh.no>
References: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
 <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
 <alpine.LFD.2.22.394.2005291837350.3230794@reclus.nhh.no>
Message-ID: <1FFD78D0-C362-4362-8065-33A62F6C66F6@gmail.com>

The URL returns a 404.

FWIW I?ve tried it locally using the latest svn revision but have no 
clue where I should find `proj_api.h` (I?ve looked in the complete 
proj installation directory).

I see

```
ls /usr/local/Cellar/proj/7.0.1/lib/
libproj.19.dylib  libproj.a         libproj.dylib@    libproj.la*       
pkgconfig/
```

Even if this custom installation might work at some point, making such 
adjustments until gdal3 arrives in homebrew will be a major pain, also 
for CI builds.
It would still be highly appreciated if this internal assertion would be 
removed again.

On 29 May 2020, at 18:37, Roger Bivand wrote:

> I have put a tarball, built without vignettes with GDAL 2.2.4 and PROJ 
> 7.0.1 that passes CMD check (with warnings for missing vignettes) on:
>
> http://spatial.nhh.no/R/rgdal/gdal_1.5-9.tar.gz
>
> It involves code copying to provide duplicated functions in three 
> settings:
>
> PROJ < 6 & GDAL < 3
> PROJ >= 6 & GDAL >= 3
> PROJ >= 6 & GDAL < 3 (your homebrew case)
>
> You need the configure argument: 
> --configure-args=--with-proj_api=proj_api.h.
> Without the argument, you now get directed to use it.
>
> For now I've dropped the configure tests for sqlite3, curl and tiff; 
> works for me but may not work for you.
>
> Please make the output of:
>
> R CMD check 
> --install-args="--configure-args=--with-proj_api=proj_api.h" 
> rgdal_1.5-9.tar.gz
>
> available ASAP. I count on an immediate response.
>
> Roger
>
> On Fri, 29 May 2020, Roger Bivand wrote:
>
>> On Fri, 29 May 2020, Patrick Schratz wrote:
>>
>>>  The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is
>>>  present. It does not even install the package if this condition is 
>>> not met
>>>  but errors during linking.
>>
>> Please document with the output of 00install.out from R CMD check 
>> rgdal_1.5-8.tar.gz, and pkg-config proj --modversion, gdalinfo 
>> --version with system details.
>>
>> Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no 
>> sense with PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API 
>> and the old metadata structure with Proj4 string degradation; GDAL < 
>> 3 with PROJ
>>> = 6 must use the deprecated API and the new metadata structure.
>>
>>>
>>>  I could not find any sources in the web or in the announcement post 
>>> of
>>>  v1.5.8 why this condition was enforced so strictly.
>>>  Does it cause unwanted results?
>>
>> Yes, definitely. GDAL 3 was released as 3, not 2.5, to stress the 
>> complete break between GDAL 2 (with PROJ <= 5) and GDAL >= 3 (with 
>> PROJ >= 6) after GDAL barnraising. So:
>>
>>           PROJ
>>           < 6 >= 6 GDAL < 3   OK   NO
>>    > = 3   NO   OK
>>
>>
>>
>>>  If so, then there is a big issue since the ?gdal2 and proj >= 
>>> 6?
>>>  combination has been used by many people in the past already.
>>
>> No good precedent, just binary packagers protecting slow downstream 
>> adaptation.
>>
>>>  I haven?t tracked down for how long this situation was on the 
>>> market
>>>  already.
>>>  Also the {sf} package is still installable with this combination 
>>> and I
>>>  am not aware of any warnings/issues that came up due to this so 
>>> far.
>>>
>>
>> rgdal is a much older package and has much more older code that needs 
>> this protection. It is possible to accommodate the no-go areas, but 
>> I'd really value patches to R-forge, as I cannot check multiple 
>> PROJ/GDAL version combinations just because someone isn't up to 
>> speed.
>>
>>>  It further causes complete breakage for people relying on the 
>>> homebrew
>>>  package manager on macOS since current versions are gdal v2.2.4 and 
>>> proj
>>>  7.0.1.
>>
>> They should never have gone beyond PROJ 5 if they are stuck on GDAL. 
>> PROJ 7 is a very different animal.
>>
>>>  The update to gdal3 is blocked since months due to an 
>>> incompatibility
>>>  with `liblas` (https://github.com/libLAS/libLAS/issues/164). 
>>> Reading the
>>>  issue, it looks unclear when this issue will be resolved.
>>>  The alternative osgeo4mac tap holds formula that is unstable and
>>>  somewhat broken. One cannot link rgdal with the current gdal v3.0.1 
>>> from
>>>  osgeo4mac.
>>>
>>>  This incompatibility with homebrew-core formula leads to further 
>>> issues
>>>  for CI tests that rely on the spatial homebrew stack for macOS 
>>> builds.
>>>
>>>  All of this is really unfortunate and I am wondering if this was a 
>>> known
>>>  factor when introducing this condition in the new release.
>>>  Unfortunately rgdal is not hosted on any Git* provider (there is 
>>> just
>>>  the CRAN mirror with not much information about the recent changes) 
>>> and
>>>  it is unclear/untransparent to me if there is a continuous 
>>> integration
>>>  setup at all for this package.
>>
>> Do not require me to leave the excellent SVN service on R-forge. 
>> Provide patches there.
>>
>>>  I hope this is not another case in the series ?I do not like 
>>> operating
>>>  system XY and hence I do not test on it? which was seen recently 
>>> in
>>>  another package. That?s what CI is for and the responsibility of
>>>  package authors.
>>>
>>
>> I run and develop on Fedora, I  have no access to OSX, and the 
>> current release was fully checked with ~ 900 revdeps repeatedly since 
>> November on successive older and newer versions of PROJ and GDAL. I 
>> blocked new PROJ with old GDAL recently to simplify development. CI 
>> is only as good as the scripts, I am completely sure that repeated 
>> revdep testing and reading the output is superior.
>>
>>>  Also one should be aware that not every rgdal user is member of 
>>> this
>>>  mailing list (I guess not even 5%) and many people in production 
>>> will
>>>  face this error during install, most of them without any clue what 
>>> to do
>>>  or an idea why this was raised.
>>>
>>
>> There has been plenty of information given about the CRS changes. 
>> rgdal could simply have been abandoned by me, and all  those 
>> production volunteers might have fixed things, but I never hear 
>> anything at all.
>>
>>>  In summary it would be great if
>>>
>>>  - There would be more detailed information on the introduction of 
>>> the
>>>  new condition
>>>  - Awareness of state-of-the-art platform related library versions 
>>> before
>>>  making such a release
>>>  - Transparency/Existence of a cross-platform build process
>>>  - If the incompatibility is just due to some features not being
>>>  accessible with this configuration, I suggest to raise a warning 
>>> during
>>>  package load but not prevent the package from installing in the 
>>> first
>>>  place
>>>  - A version-based NEWS file would be available. Currently one only 
>>> sees
>>>  a revision-based Changelog:
>>>  https://cran.r-project.org/web/packages/rgdal/ChangeLog
>>>
>>>  I am well aware that I am indirectly criticising (hopefully in a
>>>  constructive way) the transparency and release process here, for 
>>> which I
>>>  will probably get a rough response.
>>>  However, if that leads to more robustness and transparency in 
>>> future
>>>  release, I am fine with this.
>>>
>>>  A quick patch release resolving the breakage would be highly
>>>  appreciated.
>>
>> Only with community imput. what you ask is not needed, just extra 
>> complexity. Please provide patches, or accept my invitation to join 
>> the R-forge project and commit your fixes directly. I can see how to 
>> do it, but I don't think it makes sense, and your messsage has not 
>> motivated me, to be honest. I'm prioritizing working with CRAN to 
>> iron out reverse dependency problems.
>>
>> Roger
>>
>>>
>>>  Best, Patrick
>>>   [[alternative HTML version deleted]]
>>>
>>>  _______________________________________________
>>>  R-sig-Geo mailing list
>>>  R-sig-Geo at r-project.org
>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Fri May 29 22:44:48 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Fri, 29 May 2020 22:44:48 +0200
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
In-Reply-To: <1FFD78D0-C362-4362-8065-33A62F6C66F6@gmail.com>
References: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
 <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
 <alpine.LFD.2.22.394.2005291837350.3230794@reclus.nhh.no>
 <1FFD78D0-C362-4362-8065-33A62F6C66F6@gmail.com>
Message-ID: <alpine.LFD.2.22.394.2005292219240.3656989@reclus.nhh.no>

On Fri, 29 May 2020, Patrick Schratz wrote:

> The URL returns a 404.

Do you mean http://spatial.nhh.no/R/rgdal/? Please do say what you mean. 
If your browser blocks http: rather than https:, that is your choice. I 
imagine that it silently inserts an "s".

>
> FWIW I?ve tried it locally using the latest svn revision but have no clue 
> where I should find `proj_api.h` (I?ve looked in the complete proj 
> installation directory).

If PROJ 7.0.1 is properly installed, the header will be in 
$prefix/include. If your packager put all the headers somewhere else, use 
the command argument:

$ ls /usr/local/include/proj*
/usr/local/include/proj_api.h           /usr/local/include/proj.h
/usr/local/include/proj_constants.h 
/usr/local/include/proj_symbol_rename.h
/usr/local/include/proj_experimental.h

/usr/local/include/proj:
common.hpp               crs.hpp    metadata.hpp
coordinateoperation.hpp  datum.hpp  nn.hpp
coordinatesystem.hpp     io.hpp     util.hpp

You should not need to know. What does pkg-config proj --cflags say (once 
you've set PKG_CONFIG_PATH, of course.

>
> I see
>
> ```
> ls /usr/local/Cellar/proj/7.0.1/lib/
> libproj.19.dylib  libproj.a         libproj.dylib@    libproj.la* 
> pkgconfig/
> ```
>

In your earlier post, you negected to say that you used the necessary 
configure argument. The error message says that you did not use it. Please 
report back when you have done so. Futher, I quote from your message: "It 
further causes complete breakage for people relying on the homebrew 
package manager on macOS since current versions are gdal v2.2.4 and proj 
7.0.1." Please accept that I pay attention to what you write.

> Even if this custom installation might work at some point, making such 
> adjustments until gdal3 arrives in homebrew will be a major pain, also for CI 
> builds.
> It would still be highly appreciated if this internal assertion would be 
> removed again.
>

Getting things right may be painful; GDAL 2 with PROJ 7 is wrong, because 
it mixes two incompatible metadata storage systems. Migrating all users to
GDAL >= 3 & PROJ >= 6 is a matter of urgency to avoid silent positional 
error of about 125m, or about 4 satellite image cells. See the vignette 
here 
http://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html 
and this r-spatial blog https://www.r-spatial.org/r/2020/03/17/wkt.html.

I am not willing to let silent error creep in because some people find it 
inconvenient to avoid the problem. Both sf and sp/rgdal are covering your 
backs even if it feels rough. We've already helped dozens of maintainers 
of reverse dependencies future-proof their users from the consequences of 
changes made in PROJ and GDAL, where we have also contributed to making 
the transition easier by exposing helper functions in their APIs, which we 
use.

I expect you to be able to CMD check a tarball from the commmand line, no 
more than that, to report back, and to try to grasp that these external 
software components are really important and completely non-trivial.

Roger

> On 29 May 2020, at 18:37, Roger Bivand wrote:
>
>>  I have put a tarball, built without vignettes with GDAL 2.2.4 and PROJ
>>  7.0.1 that passes CMD check (with warnings for missing vignettes) on:
>>
>>  http://spatial.nhh.no/R/rgdal/gdal_1.5-9.tar.gz
>>
>>  It involves code copying to provide duplicated functions in three
>>  settings:
>>
>>  PROJ < 6 & GDAL < 3
>> PROJ > = 6 & GDAL >= 3
>> PROJ > = 6 & GDAL < 3 (your homebrew case)
>>
>>  You need the configure argument:
>>  --configure-args=--with-proj_api=proj_api.h.
>>  Without the argument, you now get directed to use it.
>>
>>  For now I've dropped the configure tests for sqlite3, curl and tiff; works
>>  for me but may not work for you.
>>
>>  Please make the output of:
>>
>>  R CMD check --install-args="--configure-args=--with-proj_api=proj_api.h"
>>  rgdal_1.5-9.tar.gz
>>
>>  available ASAP. I count on an immediate response.
>>
>>  Roger
>>
>>  On Fri, 29 May 2020, Roger Bivand wrote:
>>
>>>  On Fri, 29 May 2020, Patrick Schratz wrote:
>>>
>>>>   The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is
>>>>   present. It does not even install the package if this condition is
>>>>  not met
>>>>   but errors during linking.
>>>
>>>  Please document with the output of 00install.out from R CMD check
>>>  rgdal_1.5-8.tar.gz, and pkg-config proj --modversion, gdalinfo --version
>>>  with system details.
>>>
>>>  Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no sense
>>>  with PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API and the
>>>  old metadata structure with Proj4 string degradation; GDAL < 3 with PROJ
>>>>  = 6 must use the deprecated API and the new metadata structure.
>>> 
>>>>
>>>>  I could not find any sources in the web or in the announcement post of
>>>>   v1.5.8 why this condition was enforced so strictly.
>>>>   Does it cause unwanted results?
>>>
>>>  Yes, definitely. GDAL 3 was released as 3, not 2.5, to stress the
>>>  complete break between GDAL 2 (with PROJ <= 5) and GDAL >= 3 (with 
>>> PROJ > = 6) after GDAL barnraising. So:
>>>
>>>            PROJ
>>>            < 6 >= 6 GDAL < 3   OK   NO
>>>    >  = 3   NO   OK
>>> 
>>> 
>>>
>>>>  If so, then there is a big issue since the ?gdal2 and proj >= 6?
>>>>   combination has been used by many people in the past already.
>>>
>>>  No good precedent, just binary packagers protecting slow downstream
>>>  adaptation.
>>>
>>>>  I haven?t tracked down for how long this situation was on the market
>>>>   already.
>>>>   Also the {sf} package is still installable with this combination
>>>>  and I
>>>>  am not aware of any warnings/issues that came up due to this so far.
>>>> 
>>>
>>>  rgdal is a much older package and has much more older code that needs
>>>  this protection. It is possible to accommodate the no-go areas, but I'd
>>>  really value patches to R-forge, as I cannot check multiple PROJ/GDAL
>>>  version combinations just because someone isn't up to speed.
>>>
>>>>  It further causes complete breakage for people relying on the homebrew
>>>>  package manager on macOS since current versions are gdal v2.2.4 and proj
>>>>   7.0.1.
>>>
>>>  They should never have gone beyond PROJ 5 if they are stuck on GDAL. PROJ
>>>  7 is a very different animal.
>>>
>>>>  The update to gdal3 is blocked since months due to an incompatibility
>>>>  with `liblas` (https://github.com/libLAS/libLAS/issues/164). Reading the
>>>>   issue, it looks unclear when this issue will be resolved.
>>>>   The alternative osgeo4mac tap holds formula that is unstable and
>>>>   somewhat broken. One cannot link rgdal with the current gdal v3.0.1
>>>>  from
>>>>   osgeo4mac.
>>>>
>>>>  This incompatibility with homebrew-core formula leads to further issues
>>>>  for CI tests that rely on the spatial homebrew stack for macOS builds.
>>>>
>>>>  All of this is really unfortunate and I am wondering if this was a known
>>>>   factor when introducing this condition in the new release.
>>>>   Unfortunately rgdal is not hosted on any Git* provider (there is
>>>>  just
>>>>  the CRAN mirror with not much information about the recent changes) and
>>>>  it is unclear/untransparent to me if there is a continuous integration
>>>>   setup at all for this package.
>>>
>>>  Do not require me to leave the excellent SVN service on R-forge. Provide
>>>  patches there.
>>>
>>>>  I hope this is not another case in the series ?I do not like operating
>>>>  system XY and hence I do not test on it? which was seen recently in
>>>>   another package. That?s what CI is for and the responsibility of
>>>>   package authors.
>>>> 
>>>
>>>  I run and develop on Fedora, I  have no access to OSX, and the current
>>>  release was fully checked with ~ 900 revdeps repeatedly since November on
>>>  successive older and newer versions of PROJ and GDAL. I blocked new PROJ
>>>  with old GDAL recently to simplify development. CI is only as good as the
>>>  scripts, I am completely sure that repeated revdep testing and reading
>>>  the output is superior.
>>>
>>>>  Also one should be aware that not every rgdal user is member of this
>>>>  mailing list (I guess not even 5%) and many people in production will
>>>>  face this error during install, most of them without any clue what to do
>>>>   or an idea why this was raised.
>>>> 
>>>
>>>  There has been plenty of information given about the CRS changes. rgdal
>>>  could simply have been abandoned by me, and all  those production
>>>  volunteers might have fixed things, but I never hear anything at all.
>>>
>>>>   In summary it would be great if
>>>>
>>>>  - There would be more detailed information on the introduction of the
>>>>   new condition
>>>>   - Awareness of state-of-the-art platform related library versions
>>>>  before
>>>>   making such a release
>>>>   - Transparency/Existence of a cross-platform build process
>>>>   - If the incompatibility is just due to some features not being
>>>>   accessible with this configuration, I suggest to raise a warning
>>>>  during
>>>>  package load but not prevent the package from installing in the first
>>>>   place
>>>>   - A version-based NEWS file would be available. Currently one only
>>>>  sees
>>>>   a revision-based Changelog:
>>>>   https://cran.r-project.org/web/packages/rgdal/ChangeLog
>>>>
>>>>   I am well aware that I am indirectly criticising (hopefully in a
>>>>   constructive way) the transparency and release process here, for
>>>>  which I
>>>>   will probably get a rough response.
>>>>   However, if that leads to more robustness and transparency in
>>>>  future
>>>>   release, I am fine with this.
>>>>
>>>>   A quick patch release resolving the breakage would be highly
>>>>   appreciated.
>>>
>>>  Only with community imput. what you ask is not needed, just extra
>>>  complexity. Please provide patches, or accept my invitation to join the
>>>  R-forge project and commit your fixes directly. I can see how to do it,
>>>  but I don't think it makes sense, and your messsage has not motivated me,
>>>  to be honest. I'm prioritizing working with CRAN to iron out reverse
>>>  dependency problems.
>>>
>>>  Roger
>>> 
>>>>
>>>>   Best, Patrick
>>>>    [[alternative HTML version deleted]]
>>>>
>>>>   _______________________________________________
>>>>   R-sig-Geo mailing list
>>>>   R-sig-Geo at r-project.org
>>>>   https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>> 
>>> 
>>
>>  --
>>  Roger Bivand
>>  Department of Economics, Norwegian School of Economics,
>>  Helleveien 30, N-5045 Bergen, Norway.
>>  voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>  https://orcid.org/0000-0003-2392-6140
>>  https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From roy@mende|@@ohn @end|ng |rom no@@@gov  Fri May 29 23:15:58 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Fri, 29 May 2020 14:15:58 -0700
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
In-Reply-To: <alpine.LFD.2.22.394.2005292219240.3656989@reclus.nhh.no>
References: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
 <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
 <alpine.LFD.2.22.394.2005291837350.3230794@reclus.nhh.no>
 <1FFD78D0-C362-4362-8065-33A62F6C66F6@gmail.com>
 <alpine.LFD.2.22.394.2005292219240.3656989@reclus.nhh.no>
Message-ID: <45D57933-343C-4FDE-A1FA-87B3FF196EEE@noaa.gov>

Hi All:

It appears that Anaconda has the requisite versions,  as well as gdal-config and the appropriate include files etc etc,  though I haven?t tried to compile yet,  as I have to be on a different computer. So I have two questions for now:

1.  Other than the rgdal source and setting everything to point to the correct locations,  is there anything else I need to have installed  (I have the compilers).  If I can get it to work,  this might be for R4.0 only,  I don?t keep two versions around,  and I don?t have Catalina.

2.  I assume there are other packages on the Mac that are in a similar situation,  would I be correct in assuming sp and sf?

Thanks,

-Roy


> On May 29, 2020, at 1:44 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> On Fri, 29 May 2020, Patrick Schratz wrote:
> 
>> The URL returns a 404.
> 
> Do you mean http://spatial.nhh.no/R/rgdal/? <http://spatial.nhh.no/R/rgdal/?> Please do say what you mean. If your browser blocks http: rather than https:, that is your choice. I imagine that it silently inserts an "s".
> 
>> 
>> FWIW I?ve tried it locally using the latest svn revision but have no clue where I should find `proj_api.h` (I?ve looked in the complete proj installation directory).
> 
> If PROJ 7.0.1 is properly installed, the header will be in $prefix/include. If your packager put all the headers somewhere else, use the command argument:
> 
> $ ls /usr/local/include/proj*
> /usr/local/include/proj_api.h           /usr/local/include/proj.h
> /usr/local/include/proj_constants.h /usr/local/include/proj_symbol_rename.h
> /usr/local/include/proj_experimental.h
> 
> /usr/local/include/proj:
> common.hpp               crs.hpp    metadata.hpp
> coordinateoperation.hpp  datum.hpp  nn.hpp
> coordinatesystem.hpp     io.hpp     util.hpp
> 
> You should not need to know. What does pkg-config proj --cflags say (once you've set PKG_CONFIG_PATH, of course.
> 
>> 
>> I see
>> 
>> ```
>> ls /usr/local/Cellar/proj/7.0.1/lib/
>> libproj.19.dylib  libproj.a         libproj.dylib@    libproj.la <http://libproj.la/>* pkgconfig/
>> ```
>> 
> 
> In your earlier post, you negected to say that you used the necessary configure argument. The error message says that you did not use it. Please report back when you have done so. Futher, I quote from your message: "It further causes complete breakage for people relying on the homebrew package manager on macOS since current versions are gdal v2.2.4 and proj 7.0.1." Please accept that I pay attention to what you write.
> 
>> Even if this custom installation might work at some point, making such adjustments until gdal3 arrives in homebrew will be a major pain, also for CI builds.
>> It would still be highly appreciated if this internal assertion would be removed again.
>> 
> 
> Getting things right may be painful; GDAL 2 with PROJ 7 is wrong, because it mixes two incompatible metadata storage systems. Migrating all users to
> GDAL >= 3 & PROJ >= 6 is a matter of urgency to avoid silent positional error of about 125m, or about 4 satellite image cells. See the vignette here http://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html <http://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html> and this r-spatial blog https://www.r-spatial.org/r/2020/03/17/wkt.html <https://www.r-spatial.org/r/2020/03/17/wkt.html>.
> 
> I am not willing to let silent error creep in because some people find it inconvenient to avoid the problem. Both sf and sp/rgdal are covering your backs even if it feels rough. We've already helped dozens of maintainers of reverse dependencies future-proof their users from the consequences of changes made in PROJ and GDAL, where we have also contributed to making the transition easier by exposing helper functions in their APIs, which we use.
> 
> I expect you to be able to CMD check a tarball from the commmand line, no more than that, to report back, and to try to grasp that these external software components are really important and completely non-trivial.
> 
> Roger
> 
>> On 29 May 2020, at 18:37, Roger Bivand wrote:
>> 
>>> I have put a tarball, built without vignettes with GDAL 2.2.4 and PROJ
>>> 7.0.1 that passes CMD check (with warnings for missing vignettes) on:
>>> 
>>> http://spatial.nhh.no/R/rgdal/gdal_1.5-9.tar.gz
>>> 
>>> It involves code copying to provide duplicated functions in three
>>> settings:
>>> 
>>> PROJ < 6 & GDAL < 3
>>> PROJ > = 6 & GDAL >= 3
>>> PROJ > = 6 & GDAL < 3 (your homebrew case)
>>> 
>>> You need the configure argument:
>>> --configure-args=--with-proj_api=proj_api.h.
>>> Without the argument, you now get directed to use it.
>>> 
>>> For now I've dropped the configure tests for sqlite3, curl and tiff; works
>>> for me but may not work for you.
>>> 
>>> Please make the output of:
>>> 
>>> R CMD check --install-args="--configure-args=--with-proj_api=proj_api.h"
>>> rgdal_1.5-9.tar.gz
>>> 
>>> available ASAP. I count on an immediate response.
>>> 
>>> Roger
>>> 
>>> On Fri, 29 May 2020, Roger Bivand wrote:
>>> 
>>>> On Fri, 29 May 2020, Patrick Schratz wrote:
>>>> 
>>>>>  The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is
>>>>>  present. It does not even install the package if this condition is
>>>>> not met
>>>>>  but errors during linking.
>>>> 
>>>> Please document with the output of 00install.out from R CMD check
>>>> rgdal_1.5-8.tar.gz, and pkg-config proj --modversion, gdalinfo --version
>>>> with system details.
>>>> 
>>>> Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no sense
>>>> with PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API and the
>>>> old metadata structure with Proj4 string degradation; GDAL < 3 with PROJ
>>>>> = 6 must use the deprecated API and the new metadata structure.
>>>>> 
>>>>> I could not find any sources in the web or in the announcement post of
>>>>>  v1.5.8 why this condition was enforced so strictly.
>>>>>  Does it cause unwanted results?
>>>> 
>>>> Yes, definitely. GDAL 3 was released as 3, not 2.5, to stress the
>>>> complete break between GDAL 2 (with PROJ <= 5) and GDAL >= 3 (with PROJ > = 6) after GDAL barnraising. So:
>>>> 
>>>>           PROJ
>>>>           < 6 >= 6 GDAL < 3   OK   NO
>>>>   >  = 3   NO   OK
>>>> 
>>>>> If so, then there is a big issue since the ?gdal2 and proj >= 6?
>>>>>  combination has been used by many people in the past already.
>>>> 
>>>> No good precedent, just binary packagers protecting slow downstream
>>>> adaptation.
>>>> 
>>>>> I haven?t tracked down for how long this situation was on the market
>>>>>  already.
>>>>>  Also the {sf} package is still installable with this combination
>>>>> and I
>>>>> am not aware of any warnings/issues that came up due to this so far.
>>>> 
>>>> rgdal is a much older package and has much more older code that needs
>>>> this protection. It is possible to accommodate the no-go areas, but I'd
>>>> really value patches to R-forge, as I cannot check multiple PROJ/GDAL
>>>> version combinations just because someone isn't up to speed.
>>>> 
>>>>> It further causes complete breakage for people relying on the homebrew
>>>>> package manager on macOS since current versions are gdal v2.2.4 and proj
>>>>>  7.0.1.
>>>> 
>>>> They should never have gone beyond PROJ 5 if they are stuck on GDAL. PROJ
>>>> 7 is a very different animal.
>>>> 
>>>>> The update to gdal3 is blocked since months due to an incompatibility
>>>>> with `liblas` (https://github.com/libLAS/libLAS/issues/164). Reading the
>>>>>  issue, it looks unclear when this issue will be resolved.
>>>>>  The alternative osgeo4mac tap holds formula that is unstable and
>>>>>  somewhat broken. One cannot link rgdal with the current gdal v3.0.1
>>>>> from
>>>>>  osgeo4mac.
>>>>> 
>>>>> This incompatibility with homebrew-core formula leads to further issues
>>>>> for CI tests that rely on the spatial homebrew stack for macOS builds.
>>>>> 
>>>>> All of this is really unfortunate and I am wondering if this was a known
>>>>>  factor when introducing this condition in the new release.
>>>>>  Unfortunately rgdal is not hosted on any Git* provider (there is
>>>>> just
>>>>> the CRAN mirror with not much information about the recent changes) and
>>>>> it is unclear/untransparent to me if there is a continuous integration
>>>>>  setup at all for this package.
>>>> 
>>>> Do not require me to leave the excellent SVN service on R-forge. Provide
>>>> patches there.
>>>> 
>>>>> I hope this is not another case in the series ?I do not like operating
>>>>> system XY and hence I do not test on it? which was seen recently in
>>>>>  another package. That?s what CI is for and the responsibility of
>>>>>  package authors.
>>>> 
>>>> I run and develop on Fedora, I  have no access to OSX, and the current
>>>> release was fully checked with ~ 900 revdeps repeatedly since November on
>>>> successive older and newer versions of PROJ and GDAL. I blocked new PROJ
>>>> with old GDAL recently to simplify development. CI is only as good as the
>>>> scripts, I am completely sure that repeated revdep testing and reading
>>>> the output is superior.
>>>> 
>>>>> Also one should be aware that not every rgdal user is member of this
>>>>> mailing list (I guess not even 5%) and many people in production will
>>>>> face this error during install, most of them without any clue what to do
>>>>>  or an idea why this was raised.
>>>> 
>>>> There has been plenty of information given about the CRS changes. rgdal
>>>> could simply have been abandoned by me, and all  those production
>>>> volunteers might have fixed things, but I never hear anything at all.
>>>> 
>>>>>  In summary it would be great if
>>>>> 
>>>>> - There would be more detailed information on the introduction of the
>>>>>  new condition
>>>>>  - Awareness of state-of-the-art platform related library versions
>>>>> before
>>>>>  making such a release
>>>>>  - Transparency/Existence of a cross-platform build process
>>>>>  - If the incompatibility is just due to some features not being
>>>>>  accessible with this configuration, I suggest to raise a warning
>>>>> during
>>>>> package load but not prevent the package from installing in the first
>>>>>  place
>>>>>  - A version-based NEWS file would be available. Currently one only
>>>>> sees
>>>>>  a revision-based Changelog:
>>>>>  https://cran.r-project.org/web/packages/rgdal/ChangeLog
>>>>> 
>>>>>  I am well aware that I am indirectly criticising (hopefully in a
>>>>>  constructive way) the transparency and release process here, for
>>>>> which I
>>>>>  will probably get a rough response.
>>>>>  However, if that leads to more robustness and transparency in
>>>>> future
>>>>>  release, I am fine with this.
>>>>> 
>>>>>  A quick patch release resolving the breakage would be highly
>>>>>  appreciated.
>>>> 
>>>> Only with community imput. what you ask is not needed, just extra
>>>> complexity. Please provide patches, or accept my invitation to join the
>>>> R-forge project and commit your fixes directly. I can see how to do it,
>>>> but I don't think it makes sense, and your messsage has not motivated me,
>>>> to be honest. I'm prioritizing working with CRAN to iron out reverse
>>>> dependency problems.
>>>> 
>>>> Roger
>>>>> 
>>>>>  Best, Patrick
>>>>>   [[alternative HTML version deleted]]
>>>>> 
>>>>>  _______________________________________________
>>>>>  R-sig-Geo mailing list
>>>>>  R-sig-Geo at r-project.org
>>>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> 
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
> https://orcid.org/0000-0003-2392-6140 <https://orcid.org/0000-0003-2392-6140>
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________ <https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________>
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>

	[[alternative HTML version deleted]]


From th|_ve|o@o @end|ng |rom y@hoo@com@br  Fri May 29 23:25:37 2020
From: th|_ve|o@o @end|ng |rom y@hoo@com@br (Thiago V. dos Santos)
Date: Fri, 29 May 2020 21:25:37 +0000 (UTC)
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
Message-ID: <796811998.1903003.1590787537630@mail.yahoo.com>

Dear Roger,

Many thanks for the effort keeping rgdal up-to-date with proj6.

I'd like to report that I am unable to install rgdal 1.5.8 on my macOS system. I am reporting this error here on the list because I thought it would be the best channel in terms of reaching future users experiencing the same error. Please apologize if my rationale is not right, and ignore this message.

GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at the time of this writing). Proj6 has also been installed via Macports.

This is how I am trying to install it:

export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
R
install.packages('rgdal', type="source", configure.args=c(
? ? ?'--with-proj-include=/opt/local/lib/proj6/include',
? ? ?'--with-proj-lib=/opt/local/lib/proj6/lib'))

and this is the output I get:

R version 4.0.0 (2020-04-24) -- "Arbor Day"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin17.0 (64-bit)


R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.


? Natural language support but running in an English locale


R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.


Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.


> install.packages('rgdal', type="source", configure.args=c(
+? ? ? '--with-proj-include=/opt/local/lib/proj6/include',
+? ? ? '--with-proj-lib=/opt/local/lib/proj6/lib'))
Installing package into ?/Users/thiago/Documents/R-packages?
(as ?lib? is unspecified)


????trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
==================================================
downloaded 2.2 MB


* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
** using staged installation
configure: R_HOME: /Library/Frameworks/R.framework/Resources
configure: CC: /opt/local/bin/gcc
configure: CXX: /opt/local/bin/g++
configure: C++11 support available
configure: rgdal: 1.5-8
checking for /usr/bin/svnversion... yes
configure: svn revision: 990
checking for gdal-config... /opt/local/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 3.1.0
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
configure: pkg-config proj exists, will use it
configure: PROJ version: 6.3.2
configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
checking PROJ header API:... proj.h
checking for gcc... /opt/local/bin/gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether /opt/local/bin/gcc accepts -g... yes
checking for /opt/local/bin/gcc option to accept ISO C89... none needed
checking how to run the C preprocessor... /opt/local/bin/gcc -E
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking for ANSI C header files... rm: conftest.dSYM: is a directory
rm: conftest.dSYM: is a directory
yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking proj.h usability... yes
checking proj.h presence... yes
checking for proj.h... yes
checking for proj_context_create in -lproj... no
configure: error: proj_context_create not found in libproj.
ERROR: configuration failed for package ?rgdal?
* removing ?/Users/thiago/Documents/R-packages/rgdal?
* restoring previous ?/Users/thiago/Documents/R-packages/rgdal?


The downloaded source packages are in
?????/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
Warning message:
In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",? :
? installation of package ?rgdal? had non-zero exit status

I found this error to be quite mysterious, and could not find any previous discussion about it.

Are you familiar with it? Is there any other argument that I can pass to install.packages to solve it?

Greetings,
?-- Thiago V. dos Santos

ThiagoDosSantos.com
MudancasClimaticasBrasil.com






On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote: 





With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including 
users of the CRAN Windows binary when it comes) will be part of the big 
migration to WKT2 from Proj4 strings for CRS representation. See

https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html

or for a better rendering of "\phi" and bib-handling:

https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html

for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the 
full sf and sp story.

You will see lots of warnings, they should grab your attention, that is 
what they are for. We need your attention to be as sure as we can be that 
your results - if affected by the transition - have been checked by you.

I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*. 
In some weeks but before flipping the defaults, I'll follow up showing 
ways of muting them, but we really need to be confident that this 
necessary and future-proofing change isn't silently destroying your work 
first. So please don't treat the many warnings as just pesky and nagging - 
they are priming your immune system to check for unwanted consequences of 
your legacy CRS representation choices.

I'd also like to thank the maintainers of packages importing 
from/depending on sp/rgdal for largely positive responses to issues raised 
and emails sent, often less polite than they might have been, but grabbing 
attention was more important. From over 70 broken reverse dependency 
packages we are now well under 20, and I've contacted all of those, with 
only a couple not responding. Edzer has seen similar responsiveness for 
the parallel migration of sf.

Enjoy!

Roger

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From roy@mende|@@ohn @end|ng |rom no@@@gov  Fri May 29 23:46:28 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Fri, 29 May 2020 14:46:28 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <796811998.1903003.1590787537630@mail.yahoo.com>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
Message-ID: <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>

I just tried using the Anaconda setup  Mine dies on not being able to find ?projects.h?.  

> inverser.c:5:10: fatal error: 'projects.h' file not found
> #include <projects.h>
>          ^~~~~~~~~~~~


Doing internet searches,  for PROJ6 and beyond,  this was made private,  and is not suppose to be for public linking, see:

https://github.com/OSGeo/PROJ/issues/835 <https://github.com/OSGeo/PROJ/issues/835>
https://code.mpimet.mpg.de/boards/1/topics/1184 <https://code.mpimet.mpg.de/boards/1/topics/1184>

The discussion in the second one suggests that it should be linking to the public header proj_api.h rather than the private header projects.h.  proj_api.h does exist in the installation I have.  Unless there is an easy fix I can do,  more than I want to mess with.

-Roy



> On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <r-sig-geo at r-project.org> wrote:
> 
> Dear Roger,
> 
> Many thanks for the effort keeping rgdal up-to-date with proj6.
> 
> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS system. I am reporting this error here on the list because I thought it would be the best channel in terms of reaching future users experiencing the same error. Please apologize if my rationale is not right, and ignore this message.
> 
> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at the time of this writing). Proj6 has also been installed via Macports.
> 
> This is how I am trying to install it:
> 
> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> R
> install.packages('rgdal', type="source", configure.args=c(
>      '--with-proj-include=/opt/local/lib/proj6/include',
>      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> 
> and this is the output I get:
> 
> R version 4.0.0 (2020-04-24) -- "Arbor Day"
> Copyright (C) 2020 The R Foundation for Statistical Computing
> Platform: x86_64-apple-darwin17.0 (64-bit)
> 
> 
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
> 
> 
>   Natural language support but running in an English locale
> 
> 
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
> 
> 
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
> 
> 
>> install.packages('rgdal', type="source", configure.args=c(
> +      '--with-proj-include=/opt/local/lib/proj6/include',
> +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> Installing package into ?/Users/thiago/Documents/R-packages?
> (as ?lib? is unspecified)
> 
> 
>     trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> ==================================================
> downloaded 2.2 MB
> 
> 
> * installing *source* package ?rgdal? ...
> ** package ?rgdal? successfully unpacked and MD5 sums checked
> ** using staged installation
> configure: R_HOME: /Library/Frameworks/R.framework/Resources
> configure: CC: /opt/local/bin/gcc
> configure: CXX: /opt/local/bin/g++
> configure: C++11 support available
> configure: rgdal: 1.5-8
> checking for /usr/bin/svnversion... yes
> configure: svn revision: 990
> checking for gdal-config... /opt/local/bin/gdal-config
> checking gdal-config usability... yes
> configure: GDAL: 3.1.0
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking gdal: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> configure: pkg-config proj exists, will use it
> configure: PROJ version: 6.3.2
> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> checking PROJ header API:... proj.h
> checking for gcc... /opt/local/bin/gcc
> checking whether the C compiler works... yes
> checking for C compiler default output file name... a.out
> checking for suffix of executables...
> checking whether we are cross compiling... no
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether /opt/local/bin/gcc accepts -g... yes
> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> checking how to run the C preprocessor... /opt/local/bin/gcc -E
> checking for grep that handles long lines and -e... /usr/bin/grep
> checking for egrep... /usr/bin/grep -E
> checking for ANSI C header files... rm: conftest.dSYM: is a directory
> rm: conftest.dSYM: is a directory
> yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking proj.h usability... yes
> checking proj.h presence... yes
> checking for proj.h... yes
> checking for proj_context_create in -lproj... no
> configure: error: proj_context_create not found in libproj.
> ERROR: configuration failed for package ?rgdal?
> * removing ?/Users/thiago/Documents/R-packages/rgdal?
> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> 
> 
> The downloaded source packages are in
>     ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> Warning message:
> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
>   installation of package ?rgdal? had non-zero exit status
> 
> I found this error to be quite mysterious, and could not find any previous discussion about it.
> 
> Are you familiar with it? Is there any other argument that I can pass to install.packages to solve it?
> 
> Greetings,
>  -- Thiago V. dos Santos
> 
> ThiagoDosSantos.com
> MudancasClimaticasBrasil.com
> 
> 
> 
> 
> 
> 
> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote: 
> 
> 
> 
> 
> 
> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including 
> users of the CRAN Windows binary when it comes) will be part of the big 
> migration to WKT2 from Proj4 strings for CRS representation. See
> 
> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> 
> or for a better rendering of "\phi" and bib-handling:
> 
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> 
> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the 
> full sf and sp story.
> 
> You will see lots of warnings, they should grab your attention, that is 
> what they are for. We need your attention to be as sure as we can be that 
> your results - if affected by the transition - have been checked by you.
> 
> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*. 
> In some weeks but before flipping the defaults, I'll follow up showing 
> ways of muting them, but we really need to be confident that this 
> necessary and future-proofing change isn't silently destroying your work 
> first. So please don't treat the many warnings as just pesky and nagging - 
> they are priming your immune system to check for unwanted consequences of 
> your legacy CRS representation choices.
> 
> I'd also like to thank the maintainers of packages importing 
> from/depending on sp/rgdal for largely positive responses to issues raised 
> and emails sent, often less polite than they might have been, but grabbing 
> attention was more important. From over 70 broken reverse dependency 
> packages we are now well under 20, and I've contacted all of those, with 
> only a couple not responding. Edzer has seen similar responsiveness for 
> the parallel migration of sf.
> 
> Enjoy!
> 
> Roger
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


	[[alternative HTML version deleted]]


From eng||@hchr|@topher@ @end|ng |rom gm@||@com  Fri May 29 23:57:37 2020
From: eng||@hchr|@topher@ @end|ng |rom gm@||@com (chris english)
Date: Fri, 29 May 2020 17:57:37 -0400
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
Message-ID: <CAASFQpT1uSY8hPwuAV+p=DmmtxYP9TiZWGi0nkKTLFUCd6ybpw@mail.gmail.com>

And not desiring to muddy Thiago's clear waters, but when is Proj7*
transition expected?

Chris

On Fri, May 29, 2020 at 5:46 PM Roy Mendelssohn - NOAA Federal via
R-sig-Geo <r-sig-geo at r-project.org> wrote:

> I just tried using the Anaconda setup  Mine dies on not being able to find
> ?projects.h?.
>
> > inverser.c:5:10: fatal error: 'projects.h' file not found
> > #include <projects.h>
> >          ^~~~~~~~~~~~
>
>
> Doing internet searches,  for PROJ6 and beyond,  this was made private,
> and is not suppose to be for public linking, see:
>
> https://github.com/OSGeo/PROJ/issues/835 <
> https://github.com/OSGeo/PROJ/issues/835>
> https://code.mpimet.mpg.de/boards/1/topics/1184 <
> https://code.mpimet.mpg.de/boards/1/topics/1184>
>
> The discussion in the second one suggests that it should be linking to the
> public header proj_api.h rather than the private header projects.h.
> proj_api.h does exist in the installation I have.  Unless there is an easy
> fix I can do,  more than I want to mess with.
>
> -Roy
>
>
>
> > On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <
> r-sig-geo at r-project.org> wrote:
> >
> > Dear Roger,
> >
> > Many thanks for the effort keeping rgdal up-to-date with proj6.
> >
> > I'd like to report that I am unable to install rgdal 1.5.8 on my macOS
> system. I am reporting this error here on the list because I thought it
> would be the best channel in terms of reaching future users experiencing
> the same error. Please apologize if my rationale is not right, and ignore
> this message.
> >
> > GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at
> the time of this writing). Proj6 has also been installed via Macports.
> >
> > This is how I am trying to install it:
> >
> > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> > R
> > install.packages('rgdal', type="source", configure.args=c(
> >      '--with-proj-include=/opt/local/lib/proj6/include',
> >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> >
> > and this is the output I get:
> >
> > R version 4.0.0 (2020-04-24) -- "Arbor Day"
> > Copyright (C) 2020 The R Foundation for Statistical Computing
> > Platform: x86_64-apple-darwin17.0 (64-bit)
> >
> >
> > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > You are welcome to redistribute it under certain conditions.
> > Type 'license()' or 'licence()' for distribution details.
> >
> >
> >   Natural language support but running in an English locale
> >
> >
> > R is a collaborative project with many contributors.
> > Type 'contributors()' for more information and
> > 'citation()' on how to cite R or R packages in publications.
> >
> >
> > Type 'demo()' for some demos, 'help()' for on-line help, or
> > 'help.start()' for an HTML browser interface to help.
> > Type 'q()' to quit R.
> >
> >
> >> install.packages('rgdal', type="source", configure.args=c(
> > +      '--with-proj-include=/opt/local/lib/proj6/include',
> > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > Installing package into ?/Users/thiago/Documents/R-packages?
> > (as ?lib? is unspecified)
> >
> >
> >     trying URL '
> https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> > ==================================================
> > downloaded 2.2 MB
> >
> >
> > * installing *source* package ?rgdal? ...
> > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > ** using staged installation
> > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > configure: CC: /opt/local/bin/gcc
> > configure: CXX: /opt/local/bin/g++
> > configure: C++11 support available
> > configure: rgdal: 1.5-8
> > checking for /usr/bin/svnversion... yes
> > configure: svn revision: 990
> > checking for gdal-config... /opt/local/bin/gdal-config
> > checking gdal-config usability... yes
> > configure: GDAL: 3.1.0
> > checking GDAL version >= 1.11.4... yes
> > checking GDAL version <= 2.5 or >= 3.0... yes
> > checking gdal: linking with --libs only... yes
> > checking GDAL: gdal-config data directory readable... yes
> > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> > configure: pkg-config proj exists, will use it
> > configure: PROJ version: 6.3.2
> > configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> > checking PROJ header API:... proj.h
> > checking for gcc... /opt/local/bin/gcc
> > checking whether the C compiler works... yes
> > checking for C compiler default output file name... a.out
> > checking for suffix of executables...
> > checking whether we are cross compiling... no
> > checking for suffix of object files... o
> > checking whether we are using the GNU C compiler... yes
> > checking whether /opt/local/bin/gcc accepts -g... yes
> > checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> > checking how to run the C preprocessor... /opt/local/bin/gcc -E
> > checking for grep that handles long lines and -e... /usr/bin/grep
> > checking for egrep... /usr/bin/grep -E
> > checking for ANSI C header files... rm: conftest.dSYM: is a directory
> > rm: conftest.dSYM: is a directory
> > yes
> > checking for sys/types.h... yes
> > checking for sys/stat.h... yes
> > checking for stdlib.h... yes
> > checking for string.h... yes
> > checking for memory.h... yes
> > checking for strings.h... yes
> > checking for inttypes.h... yes
> > checking for stdint.h... yes
> > checking for unistd.h... yes
> > checking proj.h usability... yes
> > checking proj.h presence... yes
> > checking for proj.h... yes
> > checking for proj_context_create in -lproj... no
> > configure: error: proj_context_create not found in libproj.
> > ERROR: configuration failed for package ?rgdal?
> > * removing ?/Users/thiago/Documents/R-packages/rgdal?
> > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> >
> >
> > The downloaded source packages are in
> >
>  ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> > Warning message:
> > In install.packages("rgdal", type = "source", configure.args =
> c("--with-proj-include=/opt/local/lib/proj6/include",  :
> >   installation of package ?rgdal? had non-zero exit status
> >
> > I found this error to be quite mysterious, and could not find any
> previous discussion about it.
> >
> > Are you familiar with it? Is there any other argument that I can pass to
> install.packages to solve it?
> >
> > Greetings,
> >  -- Thiago V. dos Santos
> >
> > ThiagoDosSantos.com
> > MudancasClimaticasBrasil.com
> >
> >
> >
> >
> >
> >
> > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <
> roger.bivand at nhh.no> wrote:
> >
> >
> >
> >
> >
> > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
> > users of the CRAN Windows binary when it comes) will be part of the big
> > migration to WKT2 from Proj4 strings for CRS representation. See
> >
> >
> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> >
> > or for a better rendering of "\phi" and bib-handling:
> >
> >
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> >
> > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for
> the
> > full sf and sp story.
> >
> > You will see lots of warnings, they should grab your attention, that is
> > what they are for. We need your attention to be as sure as we can be
> that
> > your results - if affected by the transition - have been checked by you.
> >
> > I plan to flip the warnings to default off from rgdal 1.6-*, and sp
> 1.5-*.
> > In some weeks but before flipping the defaults, I'll follow up showing
> > ways of muting them, but we really need to be confident that this
> > necessary and future-proofing change isn't silently destroying your work
> > first. So please don't treat the many warnings as just pesky and nagging
> -
> > they are priming your immune system to check for unwanted consequences
> of
> > your legacy CRS representation choices.
> >
> > I'd also like to thank the maintainers of packages importing
> > from/depending on sp/rgdal for largely positive responses to issues
> raised
> > and emails sent, often less polite than they might have been, but
> grabbing
> > attention was more important. From over 70 broken reverse dependency
> > packages we are now well under 20, and I've contacted all of those, with
> > only a couple not responding. Edzer has seen similar responsiveness for
> > the parallel migration of sf.
> >
> > Enjoy!
> >
> > Roger
> >
> > --
> > Roger Bivand
> > Department of Economics, Norwegian School of Economics,
> > Helleveien 30, N-5045 Bergen, Norway.
> > voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> > https://orcid.org/0000-0003-2392-6140
> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From eng||@hchr|@topher@ @end|ng |rom gm@||@com  Sat May 30 02:22:12 2020
From: eng||@hchr|@topher@ @end|ng |rom gm@||@com (chris english)
Date: Fri, 29 May 2020 20:22:12 -0400
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
In-Reply-To: <45D57933-343C-4FDE-A1FA-87B3FF196EEE@noaa.gov>
References: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
 <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
 <alpine.LFD.2.22.394.2005291837350.3230794@reclus.nhh.no>
 <1FFD78D0-C362-4362-8065-33A62F6C66F6@gmail.com>
 <alpine.LFD.2.22.394.2005292219240.3656989@reclus.nhh.no>
 <45D57933-343C-4FDE-A1FA-87B3FF196EEE@noaa.gov>
Message-ID: <CAASFQpQbck5PwbjjgQBvmMuzs1ctqQy+3=4YdSjuY31tf6Hg7w@mail.gmail.com>

rgdal-1.5-9 fixed all my install problems on ubuntu 20.04. My mother has a
needle point pillow at her summer home
which declares "Guests of Guests May Not Bring Guests". Analogously,
'dependencies of dependencies will not
check dependencies' is applicable here. rgdal-1.5-9 facilitated:

> library(rgdal)
Loading required package: sp
rgdal: version: 1.5-9, (SVN revision 991M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 3.1.0, released 2020/05/03
Path to GDAL shared files: /usr/local/share/gdal
GDAL binary built with GEOS: TRUE
Loaded PROJ runtime: Rel. 7.0.1, May 1st, 2020, [PJ_VERSION: 701]
Path to PROJ shared files:
/root/.local/share/proj:/usr/local/share/proj:/usr/local/share/proj
PROJ CDN enabled:FALSE
Linking to sp version:1.4-1
To mute warnings of possible GDAL/OSR exportToProj4() degradation,
use options("rgdal_show_exportToProj4_warnings"="none") before loading
rgdal.

GEOS version is 3.9.0dev

I still have some work to do on the PostgreSQL end of things, but I am back
to working
spatial. I still received errors unless I started the Install session in
sudo R, which leads me
to think that my /usr/local/(bin,lib,include) are symlinks from
one/some/all installs of GEOS,
PROJ, GDAL, which are not the fault of R developers, but I'd forgotten this
issue and rediscovered
that I pestered Roger and Edzer about it in 2019. So, sudo R.

I'm back to having a working spatial environment. Thank you Roger!

Chris

On Fri, May 29, 2020 at 5:16 PM Roy Mendelssohn - NOAA Federal via
R-sig-Geo <r-sig-geo at r-project.org> wrote:

> Hi All:
>
> It appears that Anaconda has the requisite versions,  as well as
> gdal-config and the appropriate include files etc etc,  though I haven?t
> tried to compile yet,  as I have to be on a different computer. So I have
> two questions for now:
>
> 1.  Other than the rgdal source and setting everything to point to the
> correct locations,  is there anything else I need to have installed  (I
> have the compilers).  If I can get it to work,  this might be for R4.0
> only,  I don?t keep two versions around,  and I don?t have Catalina.
>
> 2.  I assume there are other packages on the Mac that are in a similar
> situation,  would I be correct in assuming sp and sf?
>
> Thanks,
>
> -Roy
>
>
> > On May 29, 2020, at 1:44 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> > On Fri, 29 May 2020, Patrick Schratz wrote:
> >
> >> The URL returns a 404.
> >
> > Do you mean http://spatial.nhh.no/R/rgdal/? <
> http://spatial.nhh.no/R/rgdal/?> Please do say what you mean. If your
> browser blocks http: rather than https:, that is your choice. I imagine
> that it silently inserts an "s".
> >
> >>
> >> FWIW I?ve tried it locally using the latest svn revision but have no
> clue where I should find `proj_api.h` (I?ve looked in the complete proj
> installation directory).
> >
> > If PROJ 7.0.1 is properly installed, the header will be in
> $prefix/include. If your packager put all the headers somewhere else, use
> the command argument:
> >
> > $ ls /usr/local/include/proj*
> > /usr/local/include/proj_api.h           /usr/local/include/proj.h
> > /usr/local/include/proj_constants.h
> /usr/local/include/proj_symbol_rename.h
> > /usr/local/include/proj_experimental.h
> >
> > /usr/local/include/proj:
> > common.hpp               crs.hpp    metadata.hpp
> > coordinateoperation.hpp  datum.hpp  nn.hpp
> > coordinatesystem.hpp     io.hpp     util.hpp
> >
> > You should not need to know. What does pkg-config proj --cflags say
> (once you've set PKG_CONFIG_PATH, of course.
> >
> >>
> >> I see
> >>
> >> ```
> >> ls /usr/local/Cellar/proj/7.0.1/lib/
> >> libproj.19.dylib  libproj.a         libproj.dylib@    libproj.la <
> http://libproj.la/>* pkgconfig/
> >> ```
> >>
> >
> > In your earlier post, you negected to say that you used the necessary
> configure argument. The error message says that you did not use it. Please
> report back when you have done so. Futher, I quote from your message: "It
> further causes complete breakage for people relying on the homebrew package
> manager on macOS since current versions are gdal v2.2.4 and proj 7.0.1."
> Please accept that I pay attention to what you write.
> >
> >> Even if this custom installation might work at some point, making such
> adjustments until gdal3 arrives in homebrew will be a major pain, also for
> CI builds.
> >> It would still be highly appreciated if this internal assertion would
> be removed again.
> >>
> >
> > Getting things right may be painful; GDAL 2 with PROJ 7 is wrong,
> because it mixes two incompatible metadata storage systems. Migrating all
> users to
> > GDAL >= 3 & PROJ >= 6 is a matter of urgency to avoid silent positional
> error of about 125m, or about 4 satellite image cells. See the vignette
> here
> http://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> <
> http://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html>
> and this r-spatial blog https://www.r-spatial.org/r/2020/03/17/wkt.html <
> https://www.r-spatial.org/r/2020/03/17/wkt.html>.
> >
> > I am not willing to let silent error creep in because some people find
> it inconvenient to avoid the problem. Both sf and sp/rgdal are covering
> your backs even if it feels rough. We've already helped dozens of
> maintainers of reverse dependencies future-proof their users from the
> consequences of changes made in PROJ and GDAL, where we have also
> contributed to making the transition easier by exposing helper functions in
> their APIs, which we use.
> >
> > I expect you to be able to CMD check a tarball from the commmand line,
> no more than that, to report back, and to try to grasp that these external
> software components are really important and completely non-trivial.
> >
> > Roger
> >
> >> On 29 May 2020, at 18:37, Roger Bivand wrote:
> >>
> >>> I have put a tarball, built without vignettes with GDAL 2.2.4 and PROJ
> >>> 7.0.1 that passes CMD check (with warnings for missing vignettes) on:
> >>>
> >>> http://spatial.nhh.no/R/rgdal/gdal_1.5-9.tar.gz
> >>>
> >>> It involves code copying to provide duplicated functions in three
> >>> settings:
> >>>
> >>> PROJ < 6 & GDAL < 3
> >>> PROJ > = 6 & GDAL >= 3
> >>> PROJ > = 6 & GDAL < 3 (your homebrew case)
> >>>
> >>> You need the configure argument:
> >>> --configure-args=--with-proj_api=proj_api.h.
> >>> Without the argument, you now get directed to use it.
> >>>
> >>> For now I've dropped the configure tests for sqlite3, curl and tiff;
> works
> >>> for me but may not work for you.
> >>>
> >>> Please make the output of:
> >>>
> >>> R CMD check
> --install-args="--configure-args=--with-proj_api=proj_api.h"
> >>> rgdal_1.5-9.tar.gz
> >>>
> >>> available ASAP. I count on an immediate response.
> >>>
> >>> Roger
> >>>
> >>> On Fri, 29 May 2020, Roger Bivand wrote:
> >>>
> >>>> On Fri, 29 May 2020, Patrick Schratz wrote:
> >>>>
> >>>>>  The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is
> >>>>>  present. It does not even install the package if this condition is
> >>>>> not met
> >>>>>  but errors during linking.
> >>>>
> >>>> Please document with the output of 00install.out from R CMD check
> >>>> rgdal_1.5-8.tar.gz, and pkg-config proj --modversion, gdalinfo
> --version
> >>>> with system details.
> >>>>
> >>>> Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no sense
> >>>> with PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API and
> the
> >>>> old metadata structure with Proj4 string degradation; GDAL < 3 with
> PROJ
> >>>>> = 6 must use the deprecated API and the new metadata structure.
> >>>>>
> >>>>> I could not find any sources in the web or in the announcement post
> of
> >>>>>  v1.5.8 why this condition was enforced so strictly.
> >>>>>  Does it cause unwanted results?
> >>>>
> >>>> Yes, definitely. GDAL 3 was released as 3, not 2.5, to stress the
> >>>> complete break between GDAL 2 (with PROJ <= 5) and GDAL >= 3 (with
> PROJ > = 6) after GDAL barnraising. So:
> >>>>
> >>>>           PROJ
> >>>>           < 6 >= 6 GDAL < 3   OK   NO
> >>>>   >  = 3   NO   OK
> >>>>
> >>>>> If so, then there is a big issue since the ?gdal2 and proj >= 6?
> >>>>>  combination has been used by many people in the past already.
> >>>>
> >>>> No good precedent, just binary packagers protecting slow downstream
> >>>> adaptation.
> >>>>
> >>>>> I haven?t tracked down for how long this situation was on the market
> >>>>>  already.
> >>>>>  Also the {sf} package is still installable with this combination
> >>>>> and I
> >>>>> am not aware of any warnings/issues that came up due to this so far.
> >>>>
> >>>> rgdal is a much older package and has much more older code that needs
> >>>> this protection. It is possible to accommodate the no-go areas, but
> I'd
> >>>> really value patches to R-forge, as I cannot check multiple PROJ/GDAL
> >>>> version combinations just because someone isn't up to speed.
> >>>>
> >>>>> It further causes complete breakage for people relying on the
> homebrew
> >>>>> package manager on macOS since current versions are gdal v2.2.4 and
> proj
> >>>>>  7.0.1.
> >>>>
> >>>> They should never have gone beyond PROJ 5 if they are stuck on GDAL.
> PROJ
> >>>> 7 is a very different animal.
> >>>>
> >>>>> The update to gdal3 is blocked since months due to an incompatibility
> >>>>> with `liblas` (https://github.com/libLAS/libLAS/issues/164).
> Reading the
> >>>>>  issue, it looks unclear when this issue will be resolved.
> >>>>>  The alternative osgeo4mac tap holds formula that is unstable and
> >>>>>  somewhat broken. One cannot link rgdal with the current gdal v3.0.1
> >>>>> from
> >>>>>  osgeo4mac.
> >>>>>
> >>>>> This incompatibility with homebrew-core formula leads to further
> issues
> >>>>> for CI tests that rely on the spatial homebrew stack for macOS
> builds.
> >>>>>
> >>>>> All of this is really unfortunate and I am wondering if this was a
> known
> >>>>>  factor when introducing this condition in the new release.
> >>>>>  Unfortunately rgdal is not hosted on any Git* provider (there is
> >>>>> just
> >>>>> the CRAN mirror with not much information about the recent changes)
> and
> >>>>> it is unclear/untransparent to me if there is a continuous
> integration
> >>>>>  setup at all for this package.
> >>>>
> >>>> Do not require me to leave the excellent SVN service on R-forge.
> Provide
> >>>> patches there.
> >>>>
> >>>>> I hope this is not another case in the series ?I do not like
> operating
> >>>>> system XY and hence I do not test on it? which was seen recently in
> >>>>>  another package. That?s what CI is for and the responsibility of
> >>>>>  package authors.
> >>>>
> >>>> I run and develop on Fedora, I  have no access to OSX, and the current
> >>>> release was fully checked with ~ 900 revdeps repeatedly since
> November on
> >>>> successive older and newer versions of PROJ and GDAL. I blocked new
> PROJ
> >>>> with old GDAL recently to simplify development. CI is only as good as
> the
> >>>> scripts, I am completely sure that repeated revdep testing and reading
> >>>> the output is superior.
> >>>>
> >>>>> Also one should be aware that not every rgdal user is member of this
> >>>>> mailing list (I guess not even 5%) and many people in production will
> >>>>> face this error during install, most of them without any clue what
> to do
> >>>>>  or an idea why this was raised.
> >>>>
> >>>> There has been plenty of information given about the CRS changes.
> rgdal
> >>>> could simply have been abandoned by me, and all  those production
> >>>> volunteers might have fixed things, but I never hear anything at all.
> >>>>
> >>>>>  In summary it would be great if
> >>>>>
> >>>>> - There would be more detailed information on the introduction of the
> >>>>>  new condition
> >>>>>  - Awareness of state-of-the-art platform related library versions
> >>>>> before
> >>>>>  making such a release
> >>>>>  - Transparency/Existence of a cross-platform build process
> >>>>>  - If the incompatibility is just due to some features not being
> >>>>>  accessible with this configuration, I suggest to raise a warning
> >>>>> during
> >>>>> package load but not prevent the package from installing in the first
> >>>>>  place
> >>>>>  - A version-based NEWS file would be available. Currently one only
> >>>>> sees
> >>>>>  a revision-based Changelog:
> >>>>>  https://cran.r-project.org/web/packages/rgdal/ChangeLog
> >>>>>
> >>>>>  I am well aware that I am indirectly criticising (hopefully in a
> >>>>>  constructive way) the transparency and release process here, for
> >>>>> which I
> >>>>>  will probably get a rough response.
> >>>>>  However, if that leads to more robustness and transparency in
> >>>>> future
> >>>>>  release, I am fine with this.
> >>>>>
> >>>>>  A quick patch release resolving the breakage would be highly
> >>>>>  appreciated.
> >>>>
> >>>> Only with community imput. what you ask is not needed, just extra
> >>>> complexity. Please provide patches, or accept my invitation to join
> the
> >>>> R-forge project and commit your fixes directly. I can see how to do
> it,
> >>>> but I don't think it makes sense, and your messsage has not motivated
> me,
> >>>> to be honest. I'm prioritizing working with CRAN to iron out reverse
> >>>> dependency problems.
> >>>>
> >>>> Roger
> >>>>>
> >>>>>  Best, Patrick
> >>>>>   [[alternative HTML version deleted]]
> >>>>>
> >>>>>  _______________________________________________
> >>>>>  R-sig-Geo mailing list
> >>>>>  R-sig-Geo at r-project.org
> >>>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>> --
> >>> Roger Bivand
> >>> Department of Economics, Norwegian School of Economics,
> >>> Helleveien 30, N-5045 Bergen, Norway.
> >>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> >>> https://orcid.org/0000-0003-2392-6140
> >>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>
> >>
> >
> > --
> > Roger Bivand
> > Department of Economics, Norwegian School of Economics,
> > Helleveien 30, N-5045 Bergen, Norway.
> > voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no <mailto:
> Roger.Bivand at nhh.no>
> > https://orcid.org/0000-0003-2392-6140 <
> https://orcid.org/0000-0003-2392-6140>
> >
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
> <
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
> >
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo <
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From eng||@hchr|@topher@ @end|ng |rom gm@||@com  Sat May 30 02:27:02 2020
From: eng||@hchr|@topher@ @end|ng |rom gm@||@com (chris english)
Date: Fri, 29 May 2020 20:27:02 -0400
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <CAASFQpT1uSY8hPwuAV+p=DmmtxYP9TiZWGi0nkKTLFUCd6ybpw@mail.gmail.com>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
 <CAASFQpT1uSY8hPwuAV+p=DmmtxYP9TiZWGi0nkKTLFUCd6ybpw@mail.gmail.com>
Message-ID: <CAASFQpSXbcFWCemLb5XSv=sCVaubsctjd37-Dgksx4=4gky2jQ@mail.gmail.com>

My problems of install of sf and dependencies were fixed by rgdal-1.5-9 and
additionally
upgrading lwgeom and all other dependencies. Thank you all for your efforts
and I am
in ubuntu 20.04.

On Fri, May 29, 2020 at 5:57 PM chris english <englishchristophera at gmail.com>
wrote:

> And not desiring to muddy Thiago's clear waters, but when is Proj7*
> transition expected?
>
> Chris
>
> On Fri, May 29, 2020 at 5:46 PM Roy Mendelssohn - NOAA Federal via
> R-sig-Geo <r-sig-geo at r-project.org> wrote:
>
>> I just tried using the Anaconda setup  Mine dies on not being able to
>> find ?projects.h?.
>>
>> > inverser.c:5:10: fatal error: 'projects.h' file not found
>> > #include <projects.h>
>> >          ^~~~~~~~~~~~
>>
>>
>> Doing internet searches,  for PROJ6 and beyond,  this was made private,
>> and is not suppose to be for public linking, see:
>>
>> https://github.com/OSGeo/PROJ/issues/835 <
>> https://github.com/OSGeo/PROJ/issues/835>
>> https://code.mpimet.mpg.de/boards/1/topics/1184 <
>> https://code.mpimet.mpg.de/boards/1/topics/1184>
>>
>> The discussion in the second one suggests that it should be linking to
>> the public header proj_api.h rather than the private header projects.h.
>> proj_api.h does exist in the installation I have.  Unless there is an easy
>> fix I can do,  more than I want to mess with.
>>
>> -Roy
>>
>>
>>
>> > On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <
>> r-sig-geo at r-project.org> wrote:
>> >
>> > Dear Roger,
>> >
>> > Many thanks for the effort keeping rgdal up-to-date with proj6.
>> >
>> > I'd like to report that I am unable to install rgdal 1.5.8 on my macOS
>> system. I am reporting this error here on the list because I thought it
>> would be the best channel in terms of reaching future users experiencing
>> the same error. Please apologize if my rationale is not right, and ignore
>> this message.
>> >
>> > GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at
>> the time of this writing). Proj6 has also been installed via Macports.
>> >
>> > This is how I am trying to install it:
>> >
>> > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
>> > R
>> > install.packages('rgdal', type="source", configure.args=c(
>> >      '--with-proj-include=/opt/local/lib/proj6/include',
>> >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>> >
>> > and this is the output I get:
>> >
>> > R version 4.0.0 (2020-04-24) -- "Arbor Day"
>> > Copyright (C) 2020 The R Foundation for Statistical Computing
>> > Platform: x86_64-apple-darwin17.0 (64-bit)
>> >
>> >
>> > R is free software and comes with ABSOLUTELY NO WARRANTY.
>> > You are welcome to redistribute it under certain conditions.
>> > Type 'license()' or 'licence()' for distribution details.
>> >
>> >
>> >   Natural language support but running in an English locale
>> >
>> >
>> > R is a collaborative project with many contributors.
>> > Type 'contributors()' for more information and
>> > 'citation()' on how to cite R or R packages in publications.
>> >
>> >
>> > Type 'demo()' for some demos, 'help()' for on-line help, or
>> > 'help.start()' for an HTML browser interface to help.
>> > Type 'q()' to quit R.
>> >
>> >
>> >> install.packages('rgdal', type="source", configure.args=c(
>> > +      '--with-proj-include=/opt/local/lib/proj6/include',
>> > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>> > Installing package into ?/Users/thiago/Documents/R-packages?
>> > (as ?lib? is unspecified)
>> >
>> >
>> >     trying URL '
>> https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
>> > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
>> > ==================================================
>> > downloaded 2.2 MB
>> >
>> >
>> > * installing *source* package ?rgdal? ...
>> > ** package ?rgdal? successfully unpacked and MD5 sums checked
>> > ** using staged installation
>> > configure: R_HOME: /Library/Frameworks/R.framework/Resources
>> > configure: CC: /opt/local/bin/gcc
>> > configure: CXX: /opt/local/bin/g++
>> > configure: C++11 support available
>> > configure: rgdal: 1.5-8
>> > checking for /usr/bin/svnversion... yes
>> > configure: svn revision: 990
>> > checking for gdal-config... /opt/local/bin/gdal-config
>> > checking gdal-config usability... yes
>> > configure: GDAL: 3.1.0
>> > checking GDAL version >= 1.11.4... yes
>> > checking GDAL version <= 2.5 or >= 3.0... yes
>> > checking gdal: linking with --libs only... yes
>> > checking GDAL: gdal-config data directory readable... yes
>> > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
>> > configure: pkg-config proj exists, will use it
>> > configure: PROJ version: 6.3.2
>> > configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
>> > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
>> > checking PROJ header API:... proj.h
>> > checking for gcc... /opt/local/bin/gcc
>> > checking whether the C compiler works... yes
>> > checking for C compiler default output file name... a.out
>> > checking for suffix of executables...
>> > checking whether we are cross compiling... no
>> > checking for suffix of object files... o
>> > checking whether we are using the GNU C compiler... yes
>> > checking whether /opt/local/bin/gcc accepts -g... yes
>> > checking for /opt/local/bin/gcc option to accept ISO C89... none needed
>> > checking how to run the C preprocessor... /opt/local/bin/gcc -E
>> > checking for grep that handles long lines and -e... /usr/bin/grep
>> > checking for egrep... /usr/bin/grep -E
>> > checking for ANSI C header files... rm: conftest.dSYM: is a directory
>> > rm: conftest.dSYM: is a directory
>> > yes
>> > checking for sys/types.h... yes
>> > checking for sys/stat.h... yes
>> > checking for stdlib.h... yes
>> > checking for string.h... yes
>> > checking for memory.h... yes
>> > checking for strings.h... yes
>> > checking for inttypes.h... yes
>> > checking for stdint.h... yes
>> > checking for unistd.h... yes
>> > checking proj.h usability... yes
>> > checking proj.h presence... yes
>> > checking for proj.h... yes
>> > checking for proj_context_create in -lproj... no
>> > configure: error: proj_context_create not found in libproj.
>> > ERROR: configuration failed for package ?rgdal?
>> > * removing ?/Users/thiago/Documents/R-packages/rgdal?
>> > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>> >
>> >
>> > The downloaded source packages are in
>> >
>>  ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
>> > Warning message:
>> > In install.packages("rgdal", type = "source", configure.args =
>> c("--with-proj-include=/opt/local/lib/proj6/include",  :
>> >   installation of package ?rgdal? had non-zero exit status
>> >
>> > I found this error to be quite mysterious, and could not find any
>> previous discussion about it.
>> >
>> > Are you familiar with it? Is there any other argument that I can pass
>> to install.packages to solve it?
>> >
>> > Greetings,
>> >  -- Thiago V. dos Santos
>> >
>> > ThiagoDosSantos.com
>> > MudancasClimaticasBrasil.com
>> >
>> >
>> >
>> >
>> >
>> >
>> > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <
>> roger.bivand at nhh.no> wrote:
>> >
>> >
>> >
>> >
>> >
>> > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
>> > users of the CRAN Windows binary when it comes) will be part of the big
>> > migration to WKT2 from Proj4 strings for CRS representation. See
>> >
>> >
>> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>> >
>> > or for a better rendering of "\phi" and bib-handling:
>> >
>> >
>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>> >
>> > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for
>> the
>> > full sf and sp story.
>> >
>> > You will see lots of warnings, they should grab your attention, that is
>> > what they are for. We need your attention to be as sure as we can be
>> that
>> > your results - if affected by the transition - have been checked by you.
>> >
>> > I plan to flip the warnings to default off from rgdal 1.6-*, and sp
>> 1.5-*.
>> > In some weeks but before flipping the defaults, I'll follow up showing
>> > ways of muting them, but we really need to be confident that this
>> > necessary and future-proofing change isn't silently destroying your
>> work
>> > first. So please don't treat the many warnings as just pesky and
>> nagging -
>> > they are priming your immune system to check for unwanted consequences
>> of
>> > your legacy CRS representation choices.
>> >
>> > I'd also like to thank the maintainers of packages importing
>> > from/depending on sp/rgdal for largely positive responses to issues
>> raised
>> > and emails sent, often less polite than they might have been, but
>> grabbing
>> > attention was more important. From over 70 broken reverse dependency
>> > packages we are now well under 20, and I've contacted all of those,
>> with
>> > only a couple not responding. Edzer has seen similar responsiveness for
>> > the parallel migration of sf.
>> >
>> > Enjoy!
>> >
>> > Roger
>> >
>> > --
>> > Roger Bivand
>> > Department of Economics, Norwegian School of Economics,
>> > Helleveien 30, N-5045 Bergen, Norway.
>> > voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> > https://orcid.org/0000-0003-2392-6140
>> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

	[[alternative HTML version deleted]]


From roy@mende|@@ohn @end|ng |rom no@@@gov  Sat May 30 02:48:10 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Fri, 29 May 2020 17:48:10 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <CAASFQpSXbcFWCemLb5XSv=sCVaubsctjd37-Dgksx4=4gky2jQ@mail.gmail.com>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
 <CAASFQpT1uSY8hPwuAV+p=DmmtxYP9TiZWGi0nkKTLFUCd6ybpw@mail.gmail.com>
 <CAASFQpSXbcFWCemLb5XSv=sCVaubsctjd37-Dgksx4=4gky2jQ@mail.gmail.com>
Message-ID: <FECE5185-1148-4ED1-AFE5-FADA38BC990D@noaa.gov>


Where did you get  rgdal-1.5-9?  On CRAN I see  rgdal-1.5-8 and that is what I was trying.

Thanks,

-Roy

> On May 29, 2020, at 5:27 PM, chris english <englishchristophera at gmail.com> wrote:
> 
> My problems of install of sf and dependencies were fixed by rgdal-1.5-9 and additionally
> upgrading lwgeom and all other dependencies. Thank you all for your efforts and I am
> in ubuntu 20.04.
> 
> On Fri, May 29, 2020 at 5:57 PM chris english <englishchristophera at gmail.com> wrote:
> And not desiring to muddy Thiago's clear waters, but when is Proj7* transition expected?
> 
> Chris
> 
> On Fri, May 29, 2020 at 5:46 PM Roy Mendelssohn - NOAA Federal via R-sig-Geo <r-sig-geo at r-project.org> wrote:
> I just tried using the Anaconda setup  Mine dies on not being able to find ?projects.h?.  
> 
> > inverser.c:5:10: fatal error: 'projects.h' file not found
> > #include <projects.h>
> >          ^~~~~~~~~~~~
> 
> 
> Doing internet searches,  for PROJ6 and beyond,  this was made private,  and is not suppose to be for public linking, see:
> 
> https://github.com/OSGeo/PROJ/issues/835 <https://github.com/OSGeo/PROJ/issues/835>
> https://code.mpimet.mpg.de/boards/1/topics/1184 <https://code.mpimet.mpg.de/boards/1/topics/1184>
> 
> The discussion in the second one suggests that it should be linking to the public header proj_api.h rather than the private header projects.h.  proj_api.h does exist in the installation I have.  Unless there is an easy fix I can do,  more than I want to mess with.
> 
> -Roy
> 
> 
> 
> > On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <r-sig-geo at r-project.org> wrote:
> > 
> > Dear Roger,
> > 
> > Many thanks for the effort keeping rgdal up-to-date with proj6.
> > 
> > I'd like to report that I am unable to install rgdal 1.5.8 on my macOS system. I am reporting this error here on the list because I thought it would be the best channel in terms of reaching future users experiencing the same error. Please apologize if my rationale is not right, and ignore this message.
> > 
> > GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at the time of this writing). Proj6 has also been installed via Macports.
> > 
> > This is how I am trying to install it:
> > 
> > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> > R
> > install.packages('rgdal', type="source", configure.args=c(
> >      '--with-proj-include=/opt/local/lib/proj6/include',
> >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > 
> > and this is the output I get:
> > 
> > R version 4.0.0 (2020-04-24) -- "Arbor Day"
> > Copyright (C) 2020 The R Foundation for Statistical Computing
> > Platform: x86_64-apple-darwin17.0 (64-bit)
> > 
> > 
> > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > You are welcome to redistribute it under certain conditions.
> > Type 'license()' or 'licence()' for distribution details.
> > 
> > 
> >   Natural language support but running in an English locale
> > 
> > 
> > R is a collaborative project with many contributors.
> > Type 'contributors()' for more information and
> > 'citation()' on how to cite R or R packages in publications.
> > 
> > 
> > Type 'demo()' for some demos, 'help()' for on-line help, or
> > 'help.start()' for an HTML browser interface to help.
> > Type 'q()' to quit R.
> > 
> > 
> >> install.packages('rgdal', type="source", configure.args=c(
> > +      '--with-proj-include=/opt/local/lib/proj6/include',
> > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > Installing package into ?/Users/thiago/Documents/R-packages?
> > (as ?lib? is unspecified)
> > 
> > 
> >     trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> > ==================================================
> > downloaded 2.2 MB
> > 
> > 
> > * installing *source* package ?rgdal? ...
> > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > ** using staged installation
> > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > configure: CC: /opt/local/bin/gcc
> > configure: CXX: /opt/local/bin/g++
> > configure: C++11 support available
> > configure: rgdal: 1.5-8
> > checking for /usr/bin/svnversion... yes
> > configure: svn revision: 990
> > checking for gdal-config... /opt/local/bin/gdal-config
> > checking gdal-config usability... yes
> > configure: GDAL: 3.1.0
> > checking GDAL version >= 1.11.4... yes
> > checking GDAL version <= 2.5 or >= 3.0... yes
> > checking gdal: linking with --libs only... yes
> > checking GDAL: gdal-config data directory readable... yes
> > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> > configure: pkg-config proj exists, will use it
> > configure: PROJ version: 6.3.2
> > configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> > checking PROJ header API:... proj.h
> > checking for gcc... /opt/local/bin/gcc
> > checking whether the C compiler works... yes
> > checking for C compiler default output file name... a.out
> > checking for suffix of executables...
> > checking whether we are cross compiling... no
> > checking for suffix of object files... o
> > checking whether we are using the GNU C compiler... yes
> > checking whether /opt/local/bin/gcc accepts -g... yes
> > checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> > checking how to run the C preprocessor... /opt/local/bin/gcc -E
> > checking for grep that handles long lines and -e... /usr/bin/grep
> > checking for egrep... /usr/bin/grep -E
> > checking for ANSI C header files... rm: conftest.dSYM: is a directory
> > rm: conftest.dSYM: is a directory
> > yes
> > checking for sys/types.h... yes
> > checking for sys/stat.h... yes
> > checking for stdlib.h... yes
> > checking for string.h... yes
> > checking for memory.h... yes
> > checking for strings.h... yes
> > checking for inttypes.h... yes
> > checking for stdint.h... yes
> > checking for unistd.h... yes
> > checking proj.h usability... yes
> > checking proj.h presence... yes
> > checking for proj.h... yes
> > checking for proj_context_create in -lproj... no
> > configure: error: proj_context_create not found in libproj.
> > ERROR: configuration failed for package ?rgdal?
> > * removing ?/Users/thiago/Documents/R-packages/rgdal?
> > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> > 
> > 
> > The downloaded source packages are in
> >     ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> > Warning message:
> > In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
> >   installation of package ?rgdal? had non-zero exit status
> > 
> > I found this error to be quite mysterious, and could not find any previous discussion about it.
> > 
> > Are you familiar with it? Is there any other argument that I can pass to install.packages to solve it?
> > 
> > Greetings,
> >  -- Thiago V. dos Santos
> > 
> > ThiagoDosSantos.com
> > MudancasClimaticasBrasil.com
> > 
> > 
> > 
> > 
> > 
> > 
> > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote: 
> > 
> > 
> > 
> > 
> > 
> > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including 
> > users of the CRAN Windows binary when it comes) will be part of the big 
> > migration to WKT2 from Proj4 strings for CRS representation. See
> > 
> > https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> > 
> > or for a better rendering of "\phi" and bib-handling:
> > 
> > https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> > 
> > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the 
> > full sf and sp story.
> > 
> > You will see lots of warnings, they should grab your attention, that is 
> > what they are for. We need your attention to be as sure as we can be that 
> > your results - if affected by the transition - have been checked by you.
> > 
> > I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*. 
> > In some weeks but before flipping the defaults, I'll follow up showing 
> > ways of muting them, but we really need to be confident that this 
> > necessary and future-proofing change isn't silently destroying your work 
> > first. So please don't treat the many warnings as just pesky and nagging - 
> > they are priming your immune system to check for unwanted consequences of 
> > your legacy CRS representation choices.
> > 
> > I'd also like to thank the maintainers of packages importing 
> > from/depending on sp/rgdal for largely positive responses to issues raised 
> > and emails sent, often less polite than they might have been, but grabbing 
> > attention was more important. From over 70 broken reverse dependency 
> > packages we are now well under 20, and I've contacted all of those, with 
> > only a couple not responding. Edzer has seen similar responsiveness for 
> > the parallel migration of sf.
> > 
> > Enjoy!
> > 
> > Roger
> > 
> > -- 
> > Roger Bivand
> > Department of Economics, Norwegian School of Economics,
> > Helleveien 30, N-5045 Bergen, Norway.
> > voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> > https://orcid.org/0000-0003-2392-6140
> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > 
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
>         [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From Roger@B|v@nd @end|ng |rom nhh@no  Sat May 30 13:17:20 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 30 May 2020 13:17:20 +0200
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <FECE5185-1148-4ED1-AFE5-FADA38BC990D@noaa.gov>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
 <CAASFQpT1uSY8hPwuAV+p=DmmtxYP9TiZWGi0nkKTLFUCd6ybpw@mail.gmail.com>
 <CAASFQpSXbcFWCemLb5XSv=sCVaubsctjd37-Dgksx4=4gky2jQ@mail.gmail.com>
 <FECE5185-1148-4ED1-AFE5-FADA38BC990D@noaa.gov>
Message-ID: <alpine.LFD.2.22.394.2005301313150.4058071@reclus.nhh.no>

On Sat, 30 May 2020, Roy Mendelssohn - NOAA Federal via R-sig-Geo wrote:

>
> Where did you get rgdal-1.5-9?  On CRAN I see rgdal-1.5-8 and that is 
> what I was trying.

See earlier posts on this list May 29.

Roger

>
> Thanks,
>
> -Roy
>
>> On May 29, 2020, at 5:27 PM, chris english <englishchristophera at gmail.com> wrote:
>>
>> My problems of install of sf and dependencies were fixed by rgdal-1.5-9 and additionally
>> upgrading lwgeom and all other dependencies. Thank you all for your efforts and I am
>> in ubuntu 20.04.
>>
>> On Fri, May 29, 2020 at 5:57 PM chris english <englishchristophera at gmail.com> wrote:
>> And not desiring to muddy Thiago's clear waters, but when is Proj7* transition expected?
>>
>> Chris
>>
>> On Fri, May 29, 2020 at 5:46 PM Roy Mendelssohn - NOAA Federal via R-sig-Geo <r-sig-geo at r-project.org> wrote:
>> I just tried using the Anaconda setup  Mine dies on not being able to find ?projects.h?.
>>
>>> inverser.c:5:10: fatal error: 'projects.h' file not found
>>> #include <projects.h>
>>>          ^~~~~~~~~~~~
>>
>>
>> Doing internet searches,  for PROJ6 and beyond,  this was made private,  and is not suppose to be for public linking, see:
>>
>> https://github.com/OSGeo/PROJ/issues/835 <https://github.com/OSGeo/PROJ/issues/835>
>> https://code.mpimet.mpg.de/boards/1/topics/1184 <https://code.mpimet.mpg.de/boards/1/topics/1184>
>>
>> The discussion in the second one suggests that it should be linking to the public header proj_api.h rather than the private header projects.h.  proj_api.h does exist in the installation I have.  Unless there is an easy fix I can do,  more than I want to mess with.
>>
>> -Roy
>>
>>
>>
>>> On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <r-sig-geo at r-project.org> wrote:
>>>
>>> Dear Roger,
>>>
>>> Many thanks for the effort keeping rgdal up-to-date with proj6.
>>>
>>> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS system. I am reporting this error here on the list because I thought it would be the best channel in terms of reaching future users experiencing the same error. Please apologize if my rationale is not right, and ignore this message.
>>>
>>> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at the time of this writing). Proj6 has also been installed via Macports.
>>>
>>> This is how I am trying to install it:
>>>
>>> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
>>> R
>>> install.packages('rgdal', type="source", configure.args=c(
>>>      '--with-proj-include=/opt/local/lib/proj6/include',
>>>      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>
>>> and this is the output I get:
>>>
>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>
>>>
>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>> You are welcome to redistribute it under certain conditions.
>>> Type 'license()' or 'licence()' for distribution details.
>>>
>>>
>>>   Natural language support but running in an English locale
>>>
>>>
>>> R is a collaborative project with many contributors.
>>> Type 'contributors()' for more information and
>>> 'citation()' on how to cite R or R packages in publications.
>>>
>>>
>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>> 'help.start()' for an HTML browser interface to help.
>>> Type 'q()' to quit R.
>>>
>>>
>>>> install.packages('rgdal', type="source", configure.args=c(
>>> +      '--with-proj-include=/opt/local/lib/proj6/include',
>>> +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>> Installing package into ?/Users/thiago/Documents/R-packages?
>>> (as ?lib? is unspecified)
>>>
>>>
>>>     trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
>>> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
>>> ==================================================
>>> downloaded 2.2 MB
>>>
>>>
>>> * installing *source* package ?rgdal? ...
>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>> ** using staged installation
>>> configure: R_HOME: /Library/Frameworks/R.framework/Resources
>>> configure: CC: /opt/local/bin/gcc
>>> configure: CXX: /opt/local/bin/g++
>>> configure: C++11 support available
>>> configure: rgdal: 1.5-8
>>> checking for /usr/bin/svnversion... yes
>>> configure: svn revision: 990
>>> checking for gdal-config... /opt/local/bin/gdal-config
>>> checking gdal-config usability... yes
>>> configure: GDAL: 3.1.0
>>> checking GDAL version >= 1.11.4... yes
>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>> checking gdal: linking with --libs only... yes
>>> checking GDAL: gdal-config data directory readable... yes
>>> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
>>> configure: pkg-config proj exists, will use it
>>> configure: PROJ version: 6.3.2
>>> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
>>> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
>>> checking PROJ header API:... proj.h
>>> checking for gcc... /opt/local/bin/gcc
>>> checking whether the C compiler works... yes
>>> checking for C compiler default output file name... a.out
>>> checking for suffix of executables...
>>> checking whether we are cross compiling... no
>>> checking for suffix of object files... o
>>> checking whether we are using the GNU C compiler... yes
>>> checking whether /opt/local/bin/gcc accepts -g... yes
>>> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
>>> checking how to run the C preprocessor... /opt/local/bin/gcc -E
>>> checking for grep that handles long lines and -e... /usr/bin/grep
>>> checking for egrep... /usr/bin/grep -E
>>> checking for ANSI C header files... rm: conftest.dSYM: is a directory
>>> rm: conftest.dSYM: is a directory
>>> yes
>>> checking for sys/types.h... yes
>>> checking for sys/stat.h... yes
>>> checking for stdlib.h... yes
>>> checking for string.h... yes
>>> checking for memory.h... yes
>>> checking for strings.h... yes
>>> checking for inttypes.h... yes
>>> checking for stdint.h... yes
>>> checking for unistd.h... yes
>>> checking proj.h usability... yes
>>> checking proj.h presence... yes
>>> checking for proj.h... yes
>>> checking for proj_context_create in -lproj... no
>>> configure: error: proj_context_create not found in libproj.
>>> ERROR: configuration failed for package ?rgdal?
>>> * removing ?/Users/thiago/Documents/R-packages/rgdal?
>>> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>>>
>>>
>>> The downloaded source packages are in
>>>     ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
>>> Warning message:
>>> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
>>>   installation of package ?rgdal? had non-zero exit status
>>>
>>> I found this error to be quite mysterious, and could not find any previous discussion about it.
>>>
>>> Are you familiar with it? Is there any other argument that I can pass to install.packages to solve it?
>>>
>>> Greetings,
>>>  -- Thiago V. dos Santos
>>>
>>> ThiagoDosSantos.com
>>> MudancasClimaticasBrasil.com
>>>
>>>
>>>
>>>
>>>
>>>
>>> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>>>
>>>
>>>
>>>
>>>
>>> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
>>> users of the CRAN Windows binary when it comes) will be part of the big
>>> migration to WKT2 from Proj4 strings for CRS representation. See
>>>
>>> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>>>
>>> or for a better rendering of "\phi" and bib-handling:
>>>
>>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>>>
>>> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
>>> full sf and sp story.
>>>
>>> You will see lots of warnings, they should grab your attention, that is
>>> what they are for. We need your attention to be as sure as we can be that
>>> your results - if affected by the transition - have been checked by you.
>>>
>>> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
>>> In some weeks but before flipping the defaults, I'll follow up showing
>>> ways of muting them, but we really need to be confident that this
>>> necessary and future-proofing change isn't silently destroying your work
>>> first. So please don't treat the many warnings as just pesky and nagging -
>>> they are priming your immune system to check for unwanted consequences of
>>> your legacy CRS representation choices.
>>>
>>> I'd also like to thank the maintainers of packages importing
>>> from/depending on sp/rgdal for largely positive responses to issues raised
>>> and emails sent, often less polite than they might have been, but grabbing
>>> attention was more important. From over 70 broken reverse dependency
>>> packages we are now well under 20, and I've contacted all of those, with
>>> only a couple not responding. Edzer has seen similar responsiveness for
>>> the parallel migration of sf.
>>>
>>> Enjoy!
>>>
>>> Roger
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> **********************
> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected"
> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Sat May 30 13:56:18 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 30 May 2020 13:56:18 +0200
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
Message-ID: <alpine.LFD.2.22.394.2005301354000.4058071@reclus.nhh.no>

On Fri, 29 May 2020, Roy Mendelssohn - NOAA Federal wrote:

> I just tried using the Anaconda setup Mine dies on not being able to 
> find ?projects.h?.
>
>> inverser.c:5:10: fatal error: 'projects.h' file not found
>> #include <projects.h>
>>          ^~~~~~~~~~~~

This might happen for particular mixes of versions of PROJ and GDAL, and 
depending on whether pkg-config proj --exists or not. Try draft 1.5-9 as 
mentioned in other threads. You need to state PROJ and GDAL versions and 
how they are detected.

Roger

>
>
> Doing internet searches,  for PROJ6 and beyond,  this was made private,  and is not suppose to be for public linking, see:
>
> https://github.com/OSGeo/PROJ/issues/835 <https://github.com/OSGeo/PROJ/issues/835>
> https://code.mpimet.mpg.de/boards/1/topics/1184 <https://code.mpimet.mpg.de/boards/1/topics/1184>
>
> The discussion in the second one suggests that it should be linking to the public header proj_api.h rather than the private header projects.h.  proj_api.h does exist in the installation I have.  Unless there is an easy fix I can do,  more than I want to mess with.
>
> -Roy
>
>
>
>> On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <r-sig-geo at r-project.org> wrote:
>>
>> Dear Roger,
>>
>> Many thanks for the effort keeping rgdal up-to-date with proj6.
>>
>> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS system. I am reporting this error here on the list because I thought it would be the best channel in terms of reaching future users experiencing the same error. Please apologize if my rationale is not right, and ignore this message.
>>
>> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at the time of this writing). Proj6 has also been installed via Macports.
>>
>> This is how I am trying to install it:
>>
>> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
>> R
>> install.packages('rgdal', type="source", configure.args=c(
>>      '--with-proj-include=/opt/local/lib/proj6/include',
>>      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>
>> and this is the output I get:
>>
>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>> Copyright (C) 2020 The R Foundation for Statistical Computing
>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under certain conditions.
>> Type 'license()' or 'licence()' for distribution details.
>>
>>
>>   Natural language support but running in an English locale
>>
>>
>> R is a collaborative project with many contributors.
>> Type 'contributors()' for more information and
>> 'citation()' on how to cite R or R packages in publications.
>>
>>
>> Type 'demo()' for some demos, 'help()' for on-line help, or
>> 'help.start()' for an HTML browser interface to help.
>> Type 'q()' to quit R.
>>
>>
>>> install.packages('rgdal', type="source", configure.args=c(
>> +      '--with-proj-include=/opt/local/lib/proj6/include',
>> +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>> Installing package into ?/Users/thiago/Documents/R-packages?
>> (as ?lib? is unspecified)
>>
>>
>>     trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
>> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
>> ==================================================
>> downloaded 2.2 MB
>>
>>
>> * installing *source* package ?rgdal? ...
>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>> ** using staged installation
>> configure: R_HOME: /Library/Frameworks/R.framework/Resources
>> configure: CC: /opt/local/bin/gcc
>> configure: CXX: /opt/local/bin/g++
>> configure: C++11 support available
>> configure: rgdal: 1.5-8
>> checking for /usr/bin/svnversion... yes
>> configure: svn revision: 990
>> checking for gdal-config... /opt/local/bin/gdal-config
>> checking gdal-config usability... yes
>> configure: GDAL: 3.1.0
>> checking GDAL version >= 1.11.4... yes
>> checking GDAL version <= 2.5 or >= 3.0... yes
>> checking gdal: linking with --libs only... yes
>> checking GDAL: gdal-config data directory readable... yes
>> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
>> configure: pkg-config proj exists, will use it
>> configure: PROJ version: 6.3.2
>> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
>> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
>> checking PROJ header API:... proj.h
>> checking for gcc... /opt/local/bin/gcc
>> checking whether the C compiler works... yes
>> checking for C compiler default output file name... a.out
>> checking for suffix of executables...
>> checking whether we are cross compiling... no
>> checking for suffix of object files... o
>> checking whether we are using the GNU C compiler... yes
>> checking whether /opt/local/bin/gcc accepts -g... yes
>> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
>> checking how to run the C preprocessor... /opt/local/bin/gcc -E
>> checking for grep that handles long lines and -e... /usr/bin/grep
>> checking for egrep... /usr/bin/grep -E
>> checking for ANSI C header files... rm: conftest.dSYM: is a directory
>> rm: conftest.dSYM: is a directory
>> yes
>> checking for sys/types.h... yes
>> checking for sys/stat.h... yes
>> checking for stdlib.h... yes
>> checking for string.h... yes
>> checking for memory.h... yes
>> checking for strings.h... yes
>> checking for inttypes.h... yes
>> checking for stdint.h... yes
>> checking for unistd.h... yes
>> checking proj.h usability... yes
>> checking proj.h presence... yes
>> checking for proj.h... yes
>> checking for proj_context_create in -lproj... no
>> configure: error: proj_context_create not found in libproj.
>> ERROR: configuration failed for package ?rgdal?
>> * removing ?/Users/thiago/Documents/R-packages/rgdal?
>> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>>
>>
>> The downloaded source packages are in
>>     ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
>> Warning message:
>> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
>>   installation of package ?rgdal? had non-zero exit status
>>
>> I found this error to be quite mysterious, and could not find any previous discussion about it.
>>
>> Are you familiar with it? Is there any other argument that I can pass to install.packages to solve it?
>>
>> Greetings,
>>  -- Thiago V. dos Santos
>>
>> ThiagoDosSantos.com
>> MudancasClimaticasBrasil.com
>>
>>
>>
>>
>>
>>
>> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>>
>>
>>
>>
>>
>> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
>> users of the CRAN Windows binary when it comes) will be part of the big
>> migration to WKT2 from Proj4 strings for CRS representation. See
>>
>> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>>
>> or for a better rendering of "\phi" and bib-handling:
>>
>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>>
>> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
>> full sf and sp story.
>>
>> You will see lots of warnings, they should grab your attention, that is
>> what they are for. We need your attention to be as sure as we can be that
>> your results - if affected by the transition - have been checked by you.
>>
>> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
>> In some weeks but before flipping the defaults, I'll follow up showing
>> ways of muting them, but we really need to be confident that this
>> necessary and future-proofing change isn't silently destroying your work
>> first. So please don't treat the many warnings as just pesky and nagging -
>> they are priming your immune system to check for unwanted consequences of
>> your legacy CRS representation choices.
>>
>> I'd also like to thank the maintainers of packages importing
>> from/depending on sp/rgdal for largely positive responses to issues raised
>> and emails sent, often less polite than they might have been, but grabbing
>> attention was more important. From over 70 broken reverse dependency
>> packages we are now well under 20, and I've contacted all of those, with
>> only a couple not responding. Edzer has seen similar responsiveness for
>> the parallel migration of sf.
>>
>> Enjoy!
>>
>> Roger
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From Roger@B|v@nd @end|ng |rom nhh@no  Sat May 30 14:08:01 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 30 May 2020 14:08:01 +0200
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <796811998.1903003.1590787537630@mail.yahoo.com>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
Message-ID: <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>

On Fri, 29 May 2020, Thiago V. dos Santos wrote:

> Dear Roger,
>
> Many thanks for the effort keeping rgdal up-to-date with proj6.
>
> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS 
> system. I am reporting this error here on the list because I thought it 
> would be the best channel in terms of reaching future users experiencing 
> the same error. Please apologize if my rationale is not right, and 
> ignore this message.
>
> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at 
> the time of this writing). Proj6 has also been installed via Macports.
>
> This is how I am trying to install it:
>
> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> R
> install.packages('rgdal', type="source", configure.args=c(
> ? ? ?'--with-proj-include=/opt/local/lib/proj6/include',
> ? ? ?'--with-proj-lib=/opt/local/lib/proj6/lib'))
>
> and this is the output I get:
>
> R version 4.0.0 (2020-04-24) -- "Arbor Day"
> Copyright (C) 2020 The R Foundation for Statistical Computing
> Platform: x86_64-apple-darwin17.0 (64-bit)
>
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>
> ? Natural language support but running in an English locale
>
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>
>> install.packages('rgdal', type="source", configure.args=c(
> +? ? ? '--with-proj-include=/opt/local/lib/proj6/include',
> +? ? ? '--with-proj-lib=/opt/local/lib/proj6/lib'))
> Installing package into ?/Users/thiago/Documents/R-packages?
> (as ?lib? is unspecified)
>
>
> ????trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> ==================================================
> downloaded 2.2 MB
>
>
> * installing *source* package ?rgdal? ...
> ** package ?rgdal? successfully unpacked and MD5 sums checked
> ** using staged installation
> configure: R_HOME: /Library/Frameworks/R.framework/Resources
> configure: CC: /opt/local/bin/gcc
> configure: CXX: /opt/local/bin/g++
> configure: C++11 support available
> configure: rgdal: 1.5-8
> checking for /usr/bin/svnversion... yes
> configure: svn revision: 990
> checking for gdal-config... /opt/local/bin/gdal-config
> checking gdal-config usability... yes
> configure: GDAL: 3.1.0
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking gdal: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> configure: pkg-config proj exists, will use it

So far so good, but you chose to override pkg-config proj by passing 
configure arguments. You should let pkg-config proj provide those values.

> configure: PROJ version: 6.3.2
> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> checking PROJ header API:... proj.h
> checking for gcc... /opt/local/bin/gcc
> checking whether the C compiler works... yes
> checking for C compiler default output file name... a.out
> checking for suffix of executables...
> checking whether we are cross compiling... no
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether /opt/local/bin/gcc accepts -g... yes
> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> checking how to run the C preprocessor... /opt/local/bin/gcc -E
> checking for grep that handles long lines and -e... /usr/bin/grep
> checking for egrep... /usr/bin/grep -E
> checking for ANSI C header files... rm: conftest.dSYM: is a directory
> rm: conftest.dSYM: is a directory
> yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking proj.h usability... yes
> checking proj.h presence... yes
> checking for proj.h... yes

Also OK.

> checking for proj_context_create in -lproj... no
> configure: error: proj_context_create not found in libproj.

The directory where libproj should be does not contain it - whether you 
got it wrong, pkg-config got it wrong, or for some other reason, the 
library was not found.

> ERROR: configuration failed for package ?rgdal?
> * removing ?/Users/thiago/Documents/R-packages/rgdal?
> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>
>
> The downloaded source packages are in
> ?????/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> Warning message:
> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",? :
> ? installation of package ?rgdal? had non-zero exit status
>
> I found this error to be quite mysterious, and could not find any 
> previous discussion about it.

Try to avoid googling, it is usually misleading. Running ./configure in 
the untarred source package directory, and running ./configure --help to 
show the arguments to configure can be much more helpful. Crucially, they 
are up to date, while most search hits are old, and they are ordered by 
hit counts, which is certainly no guarantee of precision.

>
> Are you familiar with it? Is there any other argument that I can pass to 
> install.packages to solve it?

Try not setting configure arguments and let pkg-config proj do the work if 
you feel you can trust it. If, however, you have multiple installs of GDAL 
and/or PROJ, the proj.pc file may point to a deleted install. Download and 
untar the source package, and run just ./configure with its argumments, or 
setting PKG_CONFIG_PATH= until you find a recipe that works that far.

Roger

>
> Greetings,
> ?-- Thiago V. dos Santos
>
> ThiagoDosSantos.com
> MudancasClimaticasBrasil.com
>
>
>
>
>
>
> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>
>
>
>
>
> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
> users of the CRAN Windows binary when it comes) will be part of the big
> migration to WKT2 from Proj4 strings for CRS representation. See
>
> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>
> or for a better rendering of "\phi" and bib-handling:
>
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>
> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
> full sf and sp story.
>
> You will see lots of warnings, they should grab your attention, that is
> what they are for. We need your attention to be as sure as we can be that
> your results - if affected by the transition - have been checked by you.
>
> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
> In some weeks but before flipping the defaults, I'll follow up showing
> ways of muting them, but we really need to be confident that this
> necessary and future-proofing change isn't silently destroying your work
> first. So please don't treat the many warnings as just pesky and nagging -
> they are priming your immune system to check for unwanted consequences of
> your legacy CRS representation choices.
>
> I'd also like to thank the maintainers of packages importing
> from/depending on sp/rgdal for largely positive responses to issues raised
> and emails sent, often less polite than they might have been, but grabbing
> attention was more important. From over 70 broken reverse dependency
> packages we are now well under 20, and I've contacted all of those, with
> only a couple not responding. Edzer has seen similar responsiveness for
> the parallel migration of sf.
>
> Enjoy!
>
> Roger
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From eng||@hchr|@topher@ @end|ng |rom gm@||@com  Sat May 30 16:03:30 2020
From: eng||@hchr|@topher@ @end|ng |rom gm@||@com (chris english)
Date: Sat, 30 May 2020 10:03:30 -0400
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
Message-ID: <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>

Roy,
From a related prior post Roger shared this link to rgdal-1.5-9,
http://spatial.nhh.no/R/rgdal/ . I followed discussions
from the 'sf' github readme and purged all prior proj/geos/gdal iterations
that have lingered around over the past five
years and built them from source on ubuntu 20.04. This upgrade to 20.04 was
perhaps my first mistake in a month
long effort to bring back my full spatial capabilities as it doesn't become
the official LTS until sometime mid this month.
I don't know how Anaconda packages and may require sym links or copying
files from down in the depths to visible,
but it worked before and can be made to work again.
HTH-
Chris

On Sat, May 30, 2020 at 8:08 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Fri, 29 May 2020, Thiago V. dos Santos wrote:
>
> > Dear Roger,
> >
> > Many thanks for the effort keeping rgdal up-to-date with proj6.
> >
> > I'd like to report that I am unable to install rgdal 1.5.8 on my macOS
> > system. I am reporting this error here on the list because I thought it
> > would be the best channel in terms of reaching future users experiencing
> > the same error. Please apologize if my rationale is not right, and
> > ignore this message.
> >
> > GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at
> > the time of this writing). Proj6 has also been installed via Macports.
> >
> > This is how I am trying to install it:
> >
> > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> > R
> > install.packages('rgdal', type="source", configure.args=c(
> >      '--with-proj-include=/opt/local/lib/proj6/include',
> >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> >
> > and this is the output I get:
> >
> > R version 4.0.0 (2020-04-24) -- "Arbor Day"
> > Copyright (C) 2020 The R Foundation for Statistical Computing
> > Platform: x86_64-apple-darwin17.0 (64-bit)
> >
> >
> > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > You are welcome to redistribute it under certain conditions.
> > Type 'license()' or 'licence()' for distribution details.
> >
> >
> >   Natural language support but running in an English locale
> >
> >
> > R is a collaborative project with many contributors.
> > Type 'contributors()' for more information and
> > 'citation()' on how to cite R or R packages in publications.
> >
> >
> > Type 'demo()' for some demos, 'help()' for on-line help, or
> > 'help.start()' for an HTML browser interface to help.
> > Type 'q()' to quit R.
> >
> >
> >> install.packages('rgdal', type="source", configure.args=c(
> > +      '--with-proj-include=/opt/local/lib/proj6/include',
> > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > Installing package into ?/Users/thiago/Documents/R-packages?
> > (as ?lib? is unspecified)
> >
> >
> >     trying URL '
> https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> > ==================================================
> > downloaded 2.2 MB
> >
> >
> > * installing *source* package ?rgdal? ...
> > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > ** using staged installation
> > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > configure: CC: /opt/local/bin/gcc
> > configure: CXX: /opt/local/bin/g++
> > configure: C++11 support available
> > configure: rgdal: 1.5-8
> > checking for /usr/bin/svnversion... yes
> > configure: svn revision: 990
> > checking for gdal-config... /opt/local/bin/gdal-config
> > checking gdal-config usability... yes
> > configure: GDAL: 3.1.0
> > checking GDAL version >= 1.11.4... yes
> > checking GDAL version <= 2.5 or >= 3.0... yes
> > checking gdal: linking with --libs only... yes
> > checking GDAL: gdal-config data directory readable... yes
> > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> > configure: pkg-config proj exists, will use it
>
> So far so good, but you chose to override pkg-config proj by passing
> configure arguments. You should let pkg-config proj provide those values.
>
> > configure: PROJ version: 6.3.2
> > configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> > checking PROJ header API:... proj.h
> > checking for gcc... /opt/local/bin/gcc
> > checking whether the C compiler works... yes
> > checking for C compiler default output file name... a.out
> > checking for suffix of executables...
> > checking whether we are cross compiling... no
> > checking for suffix of object files... o
> > checking whether we are using the GNU C compiler... yes
> > checking whether /opt/local/bin/gcc accepts -g... yes
> > checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> > checking how to run the C preprocessor... /opt/local/bin/gcc -E
> > checking for grep that handles long lines and -e... /usr/bin/grep
> > checking for egrep... /usr/bin/grep -E
> > checking for ANSI C header files... rm: conftest.dSYM: is a directory
> > rm: conftest.dSYM: is a directory
> > yes
> > checking for sys/types.h... yes
> > checking for sys/stat.h... yes
> > checking for stdlib.h... yes
> > checking for string.h... yes
> > checking for memory.h... yes
> > checking for strings.h... yes
> > checking for inttypes.h... yes
> > checking for stdint.h... yes
> > checking for unistd.h... yes
> > checking proj.h usability... yes
> > checking proj.h presence... yes
> > checking for proj.h... yes
>
> Also OK.
>
> > checking for proj_context_create in -lproj... no
> > configure: error: proj_context_create not found in libproj.
>
> The directory where libproj should be does not contain it - whether you
> got it wrong, pkg-config got it wrong, or for some other reason, the
> library was not found.
>
> > ERROR: configuration failed for package ?rgdal?
> > * removing ?/Users/thiago/Documents/R-packages/rgdal?
> > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> >
> >
> > The downloaded source packages are in
> >
>     ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> > Warning message:
> > In install.packages("rgdal", type = "source", configure.args =
> c("--with-proj-include=/opt/local/lib/proj6/include",  :
> >   installation of package ?rgdal? had non-zero exit status
> >
> > I found this error to be quite mysterious, and could not find any
> > previous discussion about it.
>
> Try to avoid googling, it is usually misleading. Running ./configure in
> the untarred source package directory, and running ./configure --help to
> show the arguments to configure can be much more helpful. Crucially, they
> are up to date, while most search hits are old, and they are ordered by
> hit counts, which is certainly no guarantee of precision.
>
> >
> > Are you familiar with it? Is there any other argument that I can pass to
> > install.packages to solve it?
>
> Try not setting configure arguments and let pkg-config proj do the work if
> you feel you can trust it. If, however, you have multiple installs of GDAL
> and/or PROJ, the proj.pc file may point to a deleted install. Download and
> untar the source package, and run just ./configure with its argumments, or
> setting PKG_CONFIG_PATH= until you find a recipe that works that far.
>
> Roger
>
> >
> > Greetings,
> >  -- Thiago V. dos Santos
> >
> > ThiagoDosSantos.com
> > MudancasClimaticasBrasil.com
> >
> >
> >
> >
> >
> >
> > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <
> roger.bivand at nhh.no> wrote:
> >
> >
> >
> >
> >
> > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
> > users of the CRAN Windows binary when it comes) will be part of the big
> > migration to WKT2 from Proj4 strings for CRS representation. See
> >
> >
> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> >
> > or for a better rendering of "\phi" and bib-handling:
> >
> >
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> >
> > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for
> the
> > full sf and sp story.
> >
> > You will see lots of warnings, they should grab your attention, that is
> > what they are for. We need your attention to be as sure as we can be that
> > your results - if affected by the transition - have been checked by you.
> >
> > I plan to flip the warnings to default off from rgdal 1.6-*, and sp
> 1.5-*.
> > In some weeks but before flipping the defaults, I'll follow up showing
> > ways of muting them, but we really need to be confident that this
> > necessary and future-proofing change isn't silently destroying your work
> > first. So please don't treat the many warnings as just pesky and nagging
> -
> > they are priming your immune system to check for unwanted consequences of
> > your legacy CRS representation choices.
> >
> > I'd also like to thank the maintainers of packages importing
> > from/depending on sp/rgdal for largely positive responses to issues
> raised
> > and emails sent, often less polite than they might have been, but
> grabbing
> > attention was more important. From over 70 broken reverse dependency
> > packages we are now well under 20, and I've contacted all of those, with
> > only a couple not responding. Edzer has seen similar responsiveness for
> > the parallel migration of sf.
> >
> > Enjoy!
> >
> > Roger
> >
> >
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From roy@mende|@@ohn @end|ng |rom no@@@gov  Sat May 30 16:32:10 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Sat, 30 May 2020 07:32:10 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <alpine.LFD.2.22.394.2005301354000.4058071@reclus.nhh.no>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
 <alpine.LFD.2.22.394.2005301354000.4058071@reclus.nhh.no>
Message-ID: <F9A1DB02-284C-4E13-B67B-7FD65CD0598A@noaa.gov>

Thanks. I used "R CMD" and  I did state where most things were found,  the compilation wasn't unhappy about that. It was unhappy about the header file that didn't exist in my installation.  When I get a chance I will find the other tarball and see if i can it compiled.  I would just like to get Mac version of rgdal,  sp and sf using the latest libraries,  and post them somewhere for others to use.  Alas,  I am not an expert in parts of this,  just know that Anaconda looks like it did install the needed files,  so it is a start.

-Roy


> On May 30, 2020, at 4:56 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> On Fri, 29 May 2020, Roy Mendelssohn - NOAA Federal wrote:
> 
>> I just tried using the Anaconda setup Mine dies on not being able to find ?projects.h?.
>> 
>>> inverser.c:5:10: fatal error: 'projects.h' file not found
>>> #include <projects.h>
>>>         ^~~~~~~~~~~~
> 
> This might happen for particular mixes of versions of PROJ and GDAL, and depending on whether pkg-config proj --exists or not. Try draft 1.5-9 as mentioned in other threads. You need to state PROJ and GDAL versions and how they are detected.
> 
> Roger
> 
>> 
>> 
>> Doing internet searches,  for PROJ6 and beyond,  this was made private,  and is not suppose to be for public linking, see:
>> 
>> https://github.com/OSGeo/PROJ/issues/835 <https://github.com/OSGeo/PROJ/issues/835>
>> https://code.mpimet.mpg.de/boards/1/topics/1184 <https://code.mpimet.mpg.de/boards/1/topics/1184>
>> 
>> The discussion in the second one suggests that it should be linking to the public header proj_api.h rather than the private header projects.h.  proj_api.h does exist in the installation I have.  Unless there is an easy fix I can do,  more than I want to mess with.
>> 
>> -Roy
>> 
>> 
>> 
>>> On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <r-sig-geo at r-project.org> wrote:
>>> 
>>> Dear Roger,
>>> 
>>> Many thanks for the effort keeping rgdal up-to-date with proj6.
>>> 
>>> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS system. I am reporting this error here on the list because I thought it would be the best channel in terms of reaching future users experiencing the same error. Please apologize if my rationale is not right, and ignore this message.
>>> 
>>> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at the time of this writing). Proj6 has also been installed via Macports.
>>> 
>>> This is how I am trying to install it:
>>> 
>>> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
>>> R
>>> install.packages('rgdal', type="source", configure.args=c(
>>>     '--with-proj-include=/opt/local/lib/proj6/include',
>>>     '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>> 
>>> and this is the output I get:
>>> 
>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>> 
>>> 
>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>> You are welcome to redistribute it under certain conditions.
>>> Type 'license()' or 'licence()' for distribution details.
>>> 
>>> 
>>>  Natural language support but running in an English locale
>>> 
>>> 
>>> R is a collaborative project with many contributors.
>>> Type 'contributors()' for more information and
>>> 'citation()' on how to cite R or R packages in publications.
>>> 
>>> 
>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>> 'help.start()' for an HTML browser interface to help.
>>> Type 'q()' to quit R.
>>> 
>>> 
>>>> install.packages('rgdal', type="source", configure.args=c(
>>> +      '--with-proj-include=/opt/local/lib/proj6/include',
>>> +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>> Installing package into ?/Users/thiago/Documents/R-packages?
>>> (as ?lib? is unspecified)
>>> 
>>> 
>>>    trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
>>> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
>>> ==================================================
>>> downloaded 2.2 MB
>>> 
>>> 
>>> * installing *source* package ?rgdal? ...
>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>> ** using staged installation
>>> configure: R_HOME: /Library/Frameworks/R.framework/Resources
>>> configure: CC: /opt/local/bin/gcc
>>> configure: CXX: /opt/local/bin/g++
>>> configure: C++11 support available
>>> configure: rgdal: 1.5-8
>>> checking for /usr/bin/svnversion... yes
>>> configure: svn revision: 990
>>> checking for gdal-config... /opt/local/bin/gdal-config
>>> checking gdal-config usability... yes
>>> configure: GDAL: 3.1.0
>>> checking GDAL version >= 1.11.4... yes
>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>> checking gdal: linking with --libs only... yes
>>> checking GDAL: gdal-config data directory readable... yes
>>> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
>>> configure: pkg-config proj exists, will use it
>>> configure: PROJ version: 6.3.2
>>> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
>>> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
>>> checking PROJ header API:... proj.h
>>> checking for gcc... /opt/local/bin/gcc
>>> checking whether the C compiler works... yes
>>> checking for C compiler default output file name... a.out
>>> checking for suffix of executables...
>>> checking whether we are cross compiling... no
>>> checking for suffix of object files... o
>>> checking whether we are using the GNU C compiler... yes
>>> checking whether /opt/local/bin/gcc accepts -g... yes
>>> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
>>> checking how to run the C preprocessor... /opt/local/bin/gcc -E
>>> checking for grep that handles long lines and -e... /usr/bin/grep
>>> checking for egrep... /usr/bin/grep -E
>>> checking for ANSI C header files... rm: conftest.dSYM: is a directory
>>> rm: conftest.dSYM: is a directory
>>> yes
>>> checking for sys/types.h... yes
>>> checking for sys/stat.h... yes
>>> checking for stdlib.h... yes
>>> checking for string.h... yes
>>> checking for memory.h... yes
>>> checking for strings.h... yes
>>> checking for inttypes.h... yes
>>> checking for stdint.h... yes
>>> checking for unistd.h... yes
>>> checking proj.h usability... yes
>>> checking proj.h presence... yes
>>> checking for proj.h... yes
>>> checking for proj_context_create in -lproj... no
>>> configure: error: proj_context_create not found in libproj.
>>> ERROR: configuration failed for package ?rgdal?
>>> * removing ?/Users/thiago/Documents/R-packages/rgdal?
>>> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>>> 
>>> 
>>> The downloaded source packages are in
>>>    ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
>>> Warning message:
>>> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
>>>  installation of package ?rgdal? had non-zero exit status
>>> 
>>> I found this error to be quite mysterious, and could not find any previous discussion about it.
>>> 
>>> Are you familiar with it? Is there any other argument that I can pass to install.packages to solve it?
>>> 
>>> Greetings,
>>> -- Thiago V. dos Santos
>>> 
>>> ThiagoDosSantos.com
>>> MudancasClimaticasBrasil.com
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>>> 
>>> 
>>> 
>>> 
>>> 
>>> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
>>> users of the CRAN Windows binary when it comes) will be part of the big
>>> migration to WKT2 from Proj4 strings for CRS representation. See
>>> 
>>> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>>> 
>>> or for a better rendering of "\phi" and bib-handling:
>>> 
>>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>>> 
>>> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
>>> full sf and sp story.
>>> 
>>> You will see lots of warnings, they should grab your attention, that is
>>> what they are for. We need your attention to be as sure as we can be that
>>> your results - if affected by the transition - have been checked by you.
>>> 
>>> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
>>> In some weeks but before flipping the defaults, I'll follow up showing
>>> ways of muting them, but we really need to be confident that this
>>> necessary and future-proofing change isn't silently destroying your work
>>> first. So please don't treat the many warnings as just pesky and nagging -
>>> they are priming your immune system to check for unwanted consequences of
>>> your legacy CRS representation choices.
>>> 
>>> I'd also like to thank the maintainers of packages importing
>>> from/depending on sp/rgdal for largely positive responses to issues raised
>>> and emails sent, often less polite than they might have been, but grabbing
>>> attention was more important. From over 70 broken reverse dependency
>>> packages we are now well under 20, and I've contacted all of those, with
>>> only a couple not responding. Edzer has seen similar responsiveness for
>>> the parallel migration of sf.
>>> 
>>> Enjoy!
>>> 
>>> Roger
>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From roy@mende|@@ohn @end|ng |rom no@@@gov  Sat May 30 16:33:45 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Sat, 30 May 2020 07:33:45 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
Message-ID: <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>

Yes thanks.  As I said in reply to Roger I am far from an expert in these things,  but if I can get it to build,  then I will try to post somewhere for others to use.

-Roy

> On May 30, 2020, at 7:03 AM, chris english <englishchristophera at gmail.com> wrote:
> 
> Roy, 
> From a related prior post Roger shared this link to rgdal-1.5-9,  http://spatial.nhh.no/R/rgdal/ . I followed discussions
> from the 'sf' github readme and purged all prior proj/geos/gdal iterations that have lingered around over the past five
> years and built them from source on ubuntu 20.04. This upgrade to 20.04 was perhaps my first mistake in a month
> long effort to bring back my full spatial capabilities as it doesn't become the official LTS until sometime mid this month.
> I don't know how Anaconda packages and may require sym links or copying files from down in the depths to visible,
> but it worked before and can be made to work again.
> HTH-
> Chris
> 
> On Sat, May 30, 2020 at 8:08 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 29 May 2020, Thiago V. dos Santos wrote:
> 
> > Dear Roger,
> >
> > Many thanks for the effort keeping rgdal up-to-date with proj6.
> >
> > I'd like to report that I am unable to install rgdal 1.5.8 on my macOS 
> > system. I am reporting this error here on the list because I thought it 
> > would be the best channel in terms of reaching future users experiencing 
> > the same error. Please apologize if my rationale is not right, and 
> > ignore this message.
> >
> > GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at 
> > the time of this writing). Proj6 has also been installed via Macports.
> >
> > This is how I am trying to install it:
> >
> > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> > R
> > install.packages('rgdal', type="source", configure.args=c(
> >      '--with-proj-include=/opt/local/lib/proj6/include',
> >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> >
> > and this is the output I get:
> >
> > R version 4.0.0 (2020-04-24) -- "Arbor Day"
> > Copyright (C) 2020 The R Foundation for Statistical Computing
> > Platform: x86_64-apple-darwin17.0 (64-bit)
> >
> >
> > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > You are welcome to redistribute it under certain conditions.
> > Type 'license()' or 'licence()' for distribution details.
> >
> >
> >   Natural language support but running in an English locale
> >
> >
> > R is a collaborative project with many contributors.
> > Type 'contributors()' for more information and
> > 'citation()' on how to cite R or R packages in publications.
> >
> >
> > Type 'demo()' for some demos, 'help()' for on-line help, or
> > 'help.start()' for an HTML browser interface to help.
> > Type 'q()' to quit R.
> >
> >
> >> install.packages('rgdal', type="source", configure.args=c(
> > +      '--with-proj-include=/opt/local/lib/proj6/include',
> > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > Installing package into ?/Users/thiago/Documents/R-packages?
> > (as ?lib? is unspecified)
> >
> >
> >     trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> > ==================================================
> > downloaded 2.2 MB
> >
> >
> > * installing *source* package ?rgdal? ...
> > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > ** using staged installation
> > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > configure: CC: /opt/local/bin/gcc
> > configure: CXX: /opt/local/bin/g++
> > configure: C++11 support available
> > configure: rgdal: 1.5-8
> > checking for /usr/bin/svnversion... yes
> > configure: svn revision: 990
> > checking for gdal-config... /opt/local/bin/gdal-config
> > checking gdal-config usability... yes
> > configure: GDAL: 3.1.0
> > checking GDAL version >= 1.11.4... yes
> > checking GDAL version <= 2.5 or >= 3.0... yes
> > checking gdal: linking with --libs only... yes
> > checking GDAL: gdal-config data directory readable... yes
> > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> > configure: pkg-config proj exists, will use it
> 
> So far so good, but you chose to override pkg-config proj by passing 
> configure arguments. You should let pkg-config proj provide those values.
> 
> > configure: PROJ version: 6.3.2
> > configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> > checking PROJ header API:... proj.h
> > checking for gcc... /opt/local/bin/gcc
> > checking whether the C compiler works... yes
> > checking for C compiler default output file name... a.out
> > checking for suffix of executables...
> > checking whether we are cross compiling... no
> > checking for suffix of object files... o
> > checking whether we are using the GNU C compiler... yes
> > checking whether /opt/local/bin/gcc accepts -g... yes
> > checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> > checking how to run the C preprocessor... /opt/local/bin/gcc -E
> > checking for grep that handles long lines and -e... /usr/bin/grep
> > checking for egrep... /usr/bin/grep -E
> > checking for ANSI C header files... rm: conftest.dSYM: is a directory
> > rm: conftest.dSYM: is a directory
> > yes
> > checking for sys/types.h... yes
> > checking for sys/stat.h... yes
> > checking for stdlib.h... yes
> > checking for string.h... yes
> > checking for memory.h... yes
> > checking for strings.h... yes
> > checking for inttypes.h... yes
> > checking for stdint.h... yes
> > checking for unistd.h... yes
> > checking proj.h usability... yes
> > checking proj.h presence... yes
> > checking for proj.h... yes
> 
> Also OK.
> 
> > checking for proj_context_create in -lproj... no
> > configure: error: proj_context_create not found in libproj.
> 
> The directory where libproj should be does not contain it - whether you 
> got it wrong, pkg-config got it wrong, or for some other reason, the 
> library was not found.
> 
> > ERROR: configuration failed for package ?rgdal?
> > * removing ?/Users/thiago/Documents/R-packages/rgdal?
> > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> >
> >
> > The downloaded source packages are in
> >     ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> > Warning message:
> > In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
> >   installation of package ?rgdal? had non-zero exit status
> >
> > I found this error to be quite mysterious, and could not find any 
> > previous discussion about it.
> 
> Try to avoid googling, it is usually misleading. Running ./configure in 
> the untarred source package directory, and running ./configure --help to 
> show the arguments to configure can be much more helpful. Crucially, they 
> are up to date, while most search hits are old, and they are ordered by 
> hit counts, which is certainly no guarantee of precision.
> 
> >
> > Are you familiar with it? Is there any other argument that I can pass to 
> > install.packages to solve it?
> 
> Try not setting configure arguments and let pkg-config proj do the work if 
> you feel you can trust it. If, however, you have multiple installs of GDAL 
> and/or PROJ, the proj.pc file may point to a deleted install. Download and 
> untar the source package, and run just ./configure with its argumments, or 
> setting PKG_CONFIG_PATH= until you find a recipe that works that far.
> 
> Roger
> 
> >
> > Greetings,
> >  -- Thiago V. dos Santos
> >
> > ThiagoDosSantos.com
> > MudancasClimaticasBrasil.com
> >
> >
> >
> >
> >
> >
> > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
> >
> >
> >
> >
> >
> > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
> > users of the CRAN Windows binary when it comes) will be part of the big
> > migration to WKT2 from Proj4 strings for CRS representation. See
> >
> > https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> >
> > or for a better rendering of "\phi" and bib-handling:
> >
> > https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> >
> > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
> > full sf and sp story.
> >
> > You will see lots of warnings, they should grab your attention, that is
> > what they are for. We need your attention to be as sure as we can be that
> > your results - if affected by the transition - have been checked by you.
> >
> > I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
> > In some weeks but before flipping the defaults, I'll follow up showing
> > ways of muting them, but we really need to be confident that this
> > necessary and future-proofing change isn't silently destroying your work
> > first. So please don't treat the many warnings as just pesky and nagging -
> > they are priming your immune system to check for unwanted consequences of
> > your legacy CRS representation choices.
> >
> > I'd also like to thank the maintainers of packages importing
> > from/depending on sp/rgdal for largely positive responses to issues raised
> > and emails sent, often less polite than they might have been, but grabbing
> > attention was more important. From over 70 broken reverse dependency
> > packages we are now well under 20, and I've contacted all of those, with
> > only a couple not responding. Edzer has seen similar responsiveness for
> > the parallel migration of sf.
> >
> > Enjoy!
> >
> > Roger
> >
> >
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From Roger@B|v@nd @end|ng |rom nhh@no  Sat May 30 16:46:52 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sat, 30 May 2020 16:46:52 +0200
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <F9A1DB02-284C-4E13-B67B-7FD65CD0598A@noaa.gov>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
 <alpine.LFD.2.22.394.2005301354000.4058071@reclus.nhh.no>
 <F9A1DB02-284C-4E13-B67B-7FD65CD0598A@noaa.gov>
Message-ID: <alpine.LFD.2.22.394.2005301643170.4060588@reclus.nhh.no>

On Sat, 30 May 2020, Roy Mendelssohn - NOAA Federal wrote:

> Thanks. I used "R CMD" and I did state where most things were found, the 
> compilation wasn't unhappy about that. It was unhappy about the header 
> file that didn't exist in my installation.  When I get a chance I will 
> find the other tarball and see if i can it compiled.  I would just like 
> to get Mac version of rgdal, sp and sf using the latest libraries, and 
> post them somewhere for others to use.  Alas, I am not an expert in 
> parts of this, just know that Anaconda looks like it did install the 
> needed files, so it is a start.

Looking for an internal file last used almost ten years ago only suggests 
that your system has defeated the over-complicated logic of ./configure. 
Access to is not needed unless PROJ is < 4.9.3.

Roger

>
> -Roy
>
>
>> On May 30, 2020, at 4:56 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>> On Fri, 29 May 2020, Roy Mendelssohn - NOAA Federal wrote:
>>
>>> I just tried using the Anaconda setup Mine dies on not being able to find ?projects.h?.
>>>
>>>> inverser.c:5:10: fatal error: 'projects.h' file not found
>>>> #include <projects.h>
>>>>         ^~~~~~~~~~~~
>>
>> This might happen for particular mixes of versions of PROJ and GDAL, and depending on whether pkg-config proj --exists or not. Try draft 1.5-9 as mentioned in other threads. You need to state PROJ and GDAL versions and how they are detected.
>>
>> Roger
>>
>>>
>>>
>>> Doing internet searches,  for PROJ6 and beyond,  this was made private,  and is not suppose to be for public linking, see:
>>>
>>> https://github.com/OSGeo/PROJ/issues/835 <https://github.com/OSGeo/PROJ/issues/835>
>>> https://code.mpimet.mpg.de/boards/1/topics/1184 <https://code.mpimet.mpg.de/boards/1/topics/1184>
>>>
>>> The discussion in the second one suggests that it should be linking to the public header proj_api.h rather than the private header projects.h.  proj_api.h does exist in the installation I have.  Unless there is an easy fix I can do,  more than I want to mess with.
>>>
>>> -Roy
>>>
>>>
>>>
>>>> On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <r-sig-geo at r-project.org> wrote:
>>>>
>>>> Dear Roger,
>>>>
>>>> Many thanks for the effort keeping rgdal up-to-date with proj6.
>>>>
>>>> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS system. I am reporting this error here on the list because I thought it would be the best channel in terms of reaching future users experiencing the same error. Please apologize if my rationale is not right, and ignore this message.
>>>>
>>>> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at the time of this writing). Proj6 has also been installed via Macports.
>>>>
>>>> This is how I am trying to install it:
>>>>
>>>> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
>>>> R
>>>> install.packages('rgdal', type="source", configure.args=c(
>>>>     '--with-proj-include=/opt/local/lib/proj6/include',
>>>>     '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>>
>>>> and this is the output I get:
>>>>
>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>
>>>>
>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>> You are welcome to redistribute it under certain conditions.
>>>> Type 'license()' or 'licence()' for distribution details.
>>>>
>>>>
>>>>  Natural language support but running in an English locale
>>>>
>>>>
>>>> R is a collaborative project with many contributors.
>>>> Type 'contributors()' for more information and
>>>> 'citation()' on how to cite R or R packages in publications.
>>>>
>>>>
>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>> 'help.start()' for an HTML browser interface to help.
>>>> Type 'q()' to quit R.
>>>>
>>>>
>>>>> install.packages('rgdal', type="source", configure.args=c(
>>>> +      '--with-proj-include=/opt/local/lib/proj6/include',
>>>> +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>> Installing package into ?/Users/thiago/Documents/R-packages?
>>>> (as ?lib? is unspecified)
>>>>
>>>>
>>>>    trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
>>>> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
>>>> ==================================================
>>>> downloaded 2.2 MB
>>>>
>>>>
>>>> * installing *source* package ?rgdal? ...
>>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>>> ** using staged installation
>>>> configure: R_HOME: /Library/Frameworks/R.framework/Resources
>>>> configure: CC: /opt/local/bin/gcc
>>>> configure: CXX: /opt/local/bin/g++
>>>> configure: C++11 support available
>>>> configure: rgdal: 1.5-8
>>>> checking for /usr/bin/svnversion... yes
>>>> configure: svn revision: 990
>>>> checking for gdal-config... /opt/local/bin/gdal-config
>>>> checking gdal-config usability... yes
>>>> configure: GDAL: 3.1.0
>>>> checking GDAL version >= 1.11.4... yes
>>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>>> checking gdal: linking with --libs only... yes
>>>> checking GDAL: gdal-config data directory readable... yes
>>>> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
>>>> configure: pkg-config proj exists, will use it
>>>> configure: PROJ version: 6.3.2
>>>> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
>>>> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
>>>> checking PROJ header API:... proj.h
>>>> checking for gcc... /opt/local/bin/gcc
>>>> checking whether the C compiler works... yes
>>>> checking for C compiler default output file name... a.out
>>>> checking for suffix of executables...
>>>> checking whether we are cross compiling... no
>>>> checking for suffix of object files... o
>>>> checking whether we are using the GNU C compiler... yes
>>>> checking whether /opt/local/bin/gcc accepts -g... yes
>>>> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
>>>> checking how to run the C preprocessor... /opt/local/bin/gcc -E
>>>> checking for grep that handles long lines and -e... /usr/bin/grep
>>>> checking for egrep... /usr/bin/grep -E
>>>> checking for ANSI C header files... rm: conftest.dSYM: is a directory
>>>> rm: conftest.dSYM: is a directory
>>>> yes
>>>> checking for sys/types.h... yes
>>>> checking for sys/stat.h... yes
>>>> checking for stdlib.h... yes
>>>> checking for string.h... yes
>>>> checking for memory.h... yes
>>>> checking for strings.h... yes
>>>> checking for inttypes.h... yes
>>>> checking for stdint.h... yes
>>>> checking for unistd.h... yes
>>>> checking proj.h usability... yes
>>>> checking proj.h presence... yes
>>>> checking for proj.h... yes
>>>> checking for proj_context_create in -lproj... no
>>>> configure: error: proj_context_create not found in libproj.
>>>> ERROR: configuration failed for package ?rgdal?
>>>> * removing ?/Users/thiago/Documents/R-packages/rgdal?
>>>> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>>>>
>>>>
>>>> The downloaded source packages are in
>>>>    ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
>>>> Warning message:
>>>> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
>>>>  installation of package ?rgdal? had non-zero exit status
>>>>
>>>> I found this error to be quite mysterious, and could not find any previous discussion about it.
>>>>
>>>> Are you familiar with it? Is there any other argument that I can pass to install.packages to solve it?
>>>>
>>>> Greetings,
>>>> -- Thiago V. dos Santos
>>>>
>>>> ThiagoDosSantos.com
>>>> MudancasClimaticasBrasil.com
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
>>>> users of the CRAN Windows binary when it comes) will be part of the big
>>>> migration to WKT2 from Proj4 strings for CRS representation. See
>>>>
>>>> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>>>>
>>>> or for a better rendering of "\phi" and bib-handling:
>>>>
>>>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>>>>
>>>> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
>>>> full sf and sp story.
>>>>
>>>> You will see lots of warnings, they should grab your attention, that is
>>>> what they are for. We need your attention to be as sure as we can be that
>>>> your results - if affected by the transition - have been checked by you.
>>>>
>>>> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
>>>> In some weeks but before flipping the defaults, I'll follow up showing
>>>> ways of muting them, but we really need to be confident that this
>>>> necessary and future-proofing change isn't silently destroying your work
>>>> first. So please don't treat the many warnings as just pesky and nagging -
>>>> they are priming your immune system to check for unwanted consequences of
>>>> your legacy CRS representation choices.
>>>>
>>>> I'd also like to thank the maintainers of packages importing
>>>> from/depending on sp/rgdal for largely positive responses to issues raised
>>>> and emails sent, often less polite than they might have been, but grabbing
>>>> attention was more important. From over 70 broken reverse dependency
>>>> packages we are now well under 20, and I've contacted all of those, with
>>>> only a couple not responding. Edzer has seen similar responsiveness for
>>>> the parallel migration of sf.
>>>>
>>>> Enjoy!
>>>>
>>>> Roger
>>>>
>>>> --
>>>> Roger Bivand
>>>> Department of Economics, Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>> https://orcid.org/0000-0003-2392-6140
>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>
> **********************
> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected"
> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

From roy@mende|@@ohn @end|ng |rom no@@@gov  Sat May 30 16:56:30 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Sat, 30 May 2020 07:56:30 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <alpine.LFD.2.22.394.2005301643170.4060588@reclus.nhh.no>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <0F500E39-EF9D-413B-B0A0-1A8012200CBC@noaa.gov>
 <alpine.LFD.2.22.394.2005301354000.4058071@reclus.nhh.no>
 <F9A1DB02-284C-4E13-B67B-7FD65CD0598A@noaa.gov>
 <alpine.LFD.2.22.394.2005301643170.4060588@reclus.nhh.no>
Message-ID: <0C28F973-AE07-40DE-AE30-ED21E95F4AD7@noaa.gov>

Thanks.  I will make certain that all paths to everything  (gdal,  proj  and geos if needed are fully specified in the command).  As I said,  gdal-conf and geos-conf are there,  as well as the include files for gdal,  geos and proj,  and they are definitely the more recent versions.

-Roy


> On May 30, 2020, at 7:46 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> On Sat, 30 May 2020, Roy Mendelssohn - NOAA Federal wrote:
> 
>> Thanks. I used "R CMD" and I did state where most things were found, the compilation wasn't unhappy about that. It was unhappy about the header file that didn't exist in my installation.  When I get a chance I will find the other tarball and see if i can it compiled.  I would just like to get Mac version of rgdal, sp and sf using the latest libraries, and post them somewhere for others to use.  Alas, I am not an expert in parts of this, just know that Anaconda looks like it did install the needed files, so it is a start.
> 
> Looking for an internal file last used almost ten years ago only suggests that your system has defeated the over-complicated logic of ./configure. Access to is not needed unless PROJ is < 4.9.3.
> 
> Roger
> 
>> 
>> -Roy
>> 
>> 
>>> On May 30, 2020, at 4:56 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> 
>>> On Fri, 29 May 2020, Roy Mendelssohn - NOAA Federal wrote:
>>> 
>>>> I just tried using the Anaconda setup Mine dies on not being able to find ?projects.h?.
>>>> 
>>>>> inverser.c:5:10: fatal error: 'projects.h' file not found
>>>>> #include <projects.h>
>>>>>        ^~~~~~~~~~~~
>>> 
>>> This might happen for particular mixes of versions of PROJ and GDAL, and depending on whether pkg-config proj --exists or not. Try draft 1.5-9 as mentioned in other threads. You need to state PROJ and GDAL versions and how they are detected.
>>> 
>>> Roger
>>> 
>>>> 
>>>> 
>>>> Doing internet searches,  for PROJ6 and beyond,  this was made private,  and is not suppose to be for public linking, see:
>>>> 
>>>> https://github.com/OSGeo/PROJ/issues/835 <https://github.com/OSGeo/PROJ/issues/835>
>>>> https://code.mpimet.mpg.de/boards/1/topics/1184 <https://code.mpimet.mpg.de/boards/1/topics/1184>
>>>> 
>>>> The discussion in the second one suggests that it should be linking to the public header proj_api.h rather than the private header projects.h.  proj_api.h does exist in the installation I have.  Unless there is an easy fix I can do, more than I want to mess with.
>>>> 
>>>> -Roy
>>>> 
>>>> 
>>>> 
>>>>> On May 29, 2020, at 2:25 PM, Thiago V. dos Santos via R-sig-Geo <r-sig-geo at r-project.org> wrote:
>>>>> 
>>>>> Dear Roger,
>>>>> 
>>>>> Many thanks for the effort keeping rgdal up-to-date with proj6.
>>>>> 
>>>>> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS system. I am reporting this error here on the list because I thought it would be the best channel in terms of reaching future users experiencing the same error. Please apologize if my rationale is not right, and ignore this message.
>>>>> 
>>>>> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at the time of this writing). Proj6 has also been installed via Macports.
>>>>> 
>>>>> This is how I am trying to install it:
>>>>> 
>>>>> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
>>>>> R
>>>>> install.packages('rgdal', type="source", configure.args=c(
>>>>>    '--with-proj-include=/opt/local/lib/proj6/include',
>>>>>    '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>>> 
>>>>> and this is the output I get:
>>>>> 
>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>> 
>>>>> 
>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>> You are welcome to redistribute it under certain conditions.
>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>> 
>>>>> 
>>>>> Natural language support but running in an English locale
>>>>> 
>>>>> 
>>>>> R is a collaborative project with many contributors.
>>>>> Type 'contributors()' for more information and
>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>> 
>>>>> 
>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>> 'help.start()' for an HTML browser interface to help.
>>>>> Type 'q()' to quit R.
>>>>> 
>>>>> 
>>>>>> install.packages('rgdal', type="source", configure.args=c(
>>>>> +      '--with-proj-include=/opt/local/lib/proj6/include',
>>>>> +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>>> Installing package into ?/Users/thiago/Documents/R-packages?
>>>>> (as ?lib? is unspecified)
>>>>> 
>>>>> 
>>>>>   trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
>>>>> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
>>>>> ==================================================
>>>>> downloaded 2.2 MB
>>>>> 
>>>>> 
>>>>> * installing *source* package ?rgdal? ...
>>>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>>>> ** using staged installation
>>>>> configure: R_HOME: /Library/Frameworks/R.framework/Resources
>>>>> configure: CC: /opt/local/bin/gcc
>>>>> configure: CXX: /opt/local/bin/g++
>>>>> configure: C++11 support available
>>>>> configure: rgdal: 1.5-8
>>>>> checking for /usr/bin/svnversion... yes
>>>>> configure: svn revision: 990
>>>>> checking for gdal-config... /opt/local/bin/gdal-config
>>>>> checking gdal-config usability... yes
>>>>> configure: GDAL: 3.1.0
>>>>> checking GDAL version >= 1.11.4... yes
>>>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>>>> checking gdal: linking with --libs only... yes
>>>>> checking GDAL: gdal-config data directory readable... yes
>>>>> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
>>>>> configure: pkg-config proj exists, will use it
>>>>> configure: PROJ version: 6.3.2
>>>>> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
>>>>> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
>>>>> checking PROJ header API:... proj.h
>>>>> checking for gcc... /opt/local/bin/gcc
>>>>> checking whether the C compiler works... yes
>>>>> checking for C compiler default output file name... a.out
>>>>> checking for suffix of executables...
>>>>> checking whether we are cross compiling... no
>>>>> checking for suffix of object files... o
>>>>> checking whether we are using the GNU C compiler... yes
>>>>> checking whether /opt/local/bin/gcc accepts -g... yes
>>>>> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
>>>>> checking how to run the C preprocessor... /opt/local/bin/gcc -E
>>>>> checking for grep that handles long lines and -e... /usr/bin/grep
>>>>> checking for egrep... /usr/bin/grep -E
>>>>> checking for ANSI C header files... rm: conftest.dSYM: is a directory
>>>>> rm: conftest.dSYM: is a directory
>>>>> yes
>>>>> checking for sys/types.h... yes
>>>>> checking for sys/stat.h... yes
>>>>> checking for stdlib.h... yes
>>>>> checking for string.h... yes
>>>>> checking for memory.h... yes
>>>>> checking for strings.h... yes
>>>>> checking for inttypes.h... yes
>>>>> checking for stdint.h... yes
>>>>> checking for unistd.h... yes
>>>>> checking proj.h usability... yes
>>>>> checking proj.h presence... yes
>>>>> checking for proj.h... yes
>>>>> checking for proj_context_create in -lproj... no
>>>>> configure: error: proj_context_create not found in libproj.
>>>>> ERROR: configuration failed for package ?rgdal?
>>>>> * removing ?/Users/thiago/Documents/R-packages/rgdal?
>>>>> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>>>>> 
>>>>> 
>>>>> The downloaded source packages are in
>>>>>   ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
>>>>> Warning message:
>>>>> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
>>>>> installation of package ?rgdal? had non-zero exit status
>>>>> 
>>>>> I found this error to be quite mysterious, and could not find any previous discussion about it.
>>>>> 
>>>>> Are you familiar with it? Is there any other argument that I can pass to install.packages to solve it?
>>>>> 
>>>>> Greetings,
>>>>> -- Thiago V. dos Santos
>>>>> 
>>>>> ThiagoDosSantos.com
>>>>> MudancasClimaticasBrasil.com
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
>>>>> users of the CRAN Windows binary when it comes) will be part of the big
>>>>> migration to WKT2 from Proj4 strings for CRS representation. See
>>>>> 
>>>>> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>>>>> 
>>>>> or for a better rendering of "\phi" and bib-handling:
>>>>> 
>>>>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>>>>> 
>>>>> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
>>>>> full sf and sp story.
>>>>> 
>>>>> You will see lots of warnings, they should grab your attention, that is
>>>>> what they are for. We need your attention to be as sure as we can be that
>>>>> your results - if affected by the transition - have been checked by you.
>>>>> 
>>>>> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
>>>>> In some weeks but before flipping the defaults, I'll follow up showing
>>>>> ways of muting them, but we really need to be confident that this
>>>>> necessary and future-proofing change isn't silently destroying your work
>>>>> first. So please don't treat the many warnings as just pesky and nagging -
>>>>> they are priming your immune system to check for unwanted consequences of
>>>>> your legacy CRS representation choices.
>>>>> 
>>>>> I'd also like to thank the maintainers of packages importing
>>>>> from/depending on sp/rgdal for largely positive responses to issues raised
>>>>> and emails sent, often less polite than they might have been, but grabbing
>>>>> attention was more important. From over 70 broken reverse dependency
>>>>> packages we are now well under 20, and I've contacted all of those, with
>>>>> only a couple not responding. Edzer has seen similar responsiveness for
>>>>> the parallel migration of sf.
>>>>> 
>>>>> Enjoy!
>>>>> 
>>>>> Roger
>>>>> 
>>>>> --
>>>>> Roger Bivand
>>>>> Department of Economics, Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>>> https://orcid.org/0000-0003-2392-6140
>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>> 
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> 
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>>> 
>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>> https://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> 
>> **********************
>> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
>> **********************
>> Roy Mendelssohn
>> Supervisory Operations Research Analyst
>> NOAA/NMFS
>> Environmental Research Division
>> Southwest Fisheries Science Center
>> ***Note new street address***
>> 110 McAllister Way
>> Santa Cruz, CA 95060
>> Phone: (831)-420-3666
>> Fax: (831) 420-3980
>> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>> 
>> "Old age and treachery will overcome youth and skill."
>> "From those who have been given much, much will be expected"
>> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>> 
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From eng||@hchr|@topher@ @end|ng |rom gm@||@com  Sat May 30 17:04:10 2020
From: eng||@hchr|@topher@ @end|ng |rom gm@||@com (chris english)
Date: Sat, 30 May 2020 11:04:10 -0400
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
 <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
Message-ID: <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>

my setup - albeit on 20.04 as reported by sf

> library(sf)
Linking to GEOS 3.9.0dev, GDAL 3.1.0, PROJ 7.0.1

Note I'm using release gdal, that I none the less built from source as I
had to enable Mr. Sid for some particular
 data. Couldn't get GDAL 3.2.*dev working but still toying around with it.
Roger's discussion of the history of all
of this on r-spatial and the path forward is very much worth the read as
and relates to his following message here.



On Sat, May 30, 2020 at 10:33 AM Roy Mendelssohn - NOAA Federal <
roy.mendelssohn at noaa.gov> wrote:

> Yes thanks.  As I said in reply to Roger I am far from an expert in these
> things,  but if I can get it to build,  then I will try to post somewhere
> for others to use.
>
> -Roy
>
> > On May 30, 2020, at 7:03 AM, chris english <
> englishchristophera at gmail.com> wrote:
> >
> > Roy,
> > From a related prior post Roger shared this link to rgdal-1.5-9,
> http://spatial.nhh.no/R/rgdal/ . I followed discussions
> > from the 'sf' github readme and purged all prior proj/geos/gdal
> iterations that have lingered around over the past five
> > years and built them from source on ubuntu 20.04. This upgrade to 20.04
> was perhaps my first mistake in a month
> > long effort to bring back my full spatial capabilities as it doesn't
> become the official LTS until sometime mid this month.
> > I don't know how Anaconda packages and may require sym links or copying
> files from down in the depths to visible,
> > but it worked before and can be made to work again.
> > HTH-
> > Chris
> >
> > On Sat, May 30, 2020 at 8:08 AM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> > On Fri, 29 May 2020, Thiago V. dos Santos wrote:
> >
> > > Dear Roger,
> > >
> > > Many thanks for the effort keeping rgdal up-to-date with proj6.
> > >
> > > I'd like to report that I am unable to install rgdal 1.5.8 on my macOS
> > > system. I am reporting this error here on the list because I thought
> it
> > > would be the best channel in terms of reaching future users
> experiencing
> > > the same error. Please apologize if my rationale is not right, and
> > > ignore this message.
> > >
> > > GDAL was installed via MacPorts and is at its latest version, 3.1.0
> (at
> > > the time of this writing). Proj6 has also been installed via Macports.
> > >
> > > This is how I am trying to install it:
> > >
> > > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> > > R
> > > install.packages('rgdal', type="source", configure.args=c(
> > >      '--with-proj-include=/opt/local/lib/proj6/include',
> > >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > >
> > > and this is the output I get:
> > >
> > > R version 4.0.0 (2020-04-24) -- "Arbor Day"
> > > Copyright (C) 2020 The R Foundation for Statistical Computing
> > > Platform: x86_64-apple-darwin17.0 (64-bit)
> > >
> > >
> > > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > > You are welcome to redistribute it under certain conditions.
> > > Type 'license()' or 'licence()' for distribution details.
> > >
> > >
> > >   Natural language support but running in an English locale
> > >
> > >
> > > R is a collaborative project with many contributors.
> > > Type 'contributors()' for more information and
> > > 'citation()' on how to cite R or R packages in publications.
> > >
> > >
> > > Type 'demo()' for some demos, 'help()' for on-line help, or
> > > 'help.start()' for an HTML browser interface to help.
> > > Type 'q()' to quit R.
> > >
> > >
> > >> install.packages('rgdal', type="source", configure.args=c(
> > > +      '--with-proj-include=/opt/local/lib/proj6/include',
> > > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > > Installing package into ?/Users/thiago/Documents/R-packages?
> > > (as ?lib? is unspecified)
> > >
> > >
> > >     trying URL '
> https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> > > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> > > ==================================================
> > > downloaded 2.2 MB
> > >
> > >
> > > * installing *source* package ?rgdal? ...
> > > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > > ** using staged installation
> > > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > > configure: CC: /opt/local/bin/gcc
> > > configure: CXX: /opt/local/bin/g++
> > > configure: C++11 support available
> > > configure: rgdal: 1.5-8
> > > checking for /usr/bin/svnversion... yes
> > > configure: svn revision: 990
> > > checking for gdal-config... /opt/local/bin/gdal-config
> > > checking gdal-config usability... yes
> > > configure: GDAL: 3.1.0
> > > checking GDAL version >= 1.11.4... yes
> > > checking GDAL version <= 2.5 or >= 3.0... yes
> > > checking gdal: linking with --libs only... yes
> > > checking GDAL: gdal-config data directory readable... yes
> > > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> > > configure: pkg-config proj exists, will use it
> >
> > So far so good, but you chose to override pkg-config proj by passing
> > configure arguments. You should let pkg-config proj provide those values.
> >
> > > configure: PROJ version: 6.3.2
> > > configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> > > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> > > checking PROJ header API:... proj.h
> > > checking for gcc... /opt/local/bin/gcc
> > > checking whether the C compiler works... yes
> > > checking for C compiler default output file name... a.out
> > > checking for suffix of executables...
> > > checking whether we are cross compiling... no
> > > checking for suffix of object files... o
> > > checking whether we are using the GNU C compiler... yes
> > > checking whether /opt/local/bin/gcc accepts -g... yes
> > > checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> > > checking how to run the C preprocessor... /opt/local/bin/gcc -E
> > > checking for grep that handles long lines and -e... /usr/bin/grep
> > > checking for egrep... /usr/bin/grep -E
> > > checking for ANSI C header files... rm: conftest.dSYM: is a directory
> > > rm: conftest.dSYM: is a directory
> > > yes
> > > checking for sys/types.h... yes
> > > checking for sys/stat.h... yes
> > > checking for stdlib.h... yes
> > > checking for string.h... yes
> > > checking for memory.h... yes
> > > checking for strings.h... yes
> > > checking for inttypes.h... yes
> > > checking for stdint.h... yes
> > > checking for unistd.h... yes
> > > checking proj.h usability... yes
> > > checking proj.h presence... yes
> > > checking for proj.h... yes
> >
> > Also OK.
> >
> > > checking for proj_context_create in -lproj... no
> > > configure: error: proj_context_create not found in libproj.
> >
> > The directory where libproj should be does not contain it - whether you
> > got it wrong, pkg-config got it wrong, or for some other reason, the
> > library was not found.
> >
> > > ERROR: configuration failed for package ?rgdal?
> > > * removing ?/Users/thiago/Documents/R-packages/rgdal?
> > > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> > >
> > >
> > > The downloaded source packages are in
> > >
>  ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> > > Warning message:
> > > In install.packages("rgdal", type = "source", configure.args =
> c("--with-proj-include=/opt/local/lib/proj6/include",  :
> > >   installation of package ?rgdal? had non-zero exit status
> > >
> > > I found this error to be quite mysterious, and could not find any
> > > previous discussion about it.
> >
> > Try to avoid googling, it is usually misleading. Running ./configure in
> > the untarred source package directory, and running ./configure --help to
> > show the arguments to configure can be much more helpful. Crucially,
> they
> > are up to date, while most search hits are old, and they are ordered by
> > hit counts, which is certainly no guarantee of precision.
> >
> > >
> > > Are you familiar with it? Is there any other argument that I can pass
> to
> > > install.packages to solve it?
> >
> > Try not setting configure arguments and let pkg-config proj do the work
> if
> > you feel you can trust it. If, however, you have multiple installs of
> GDAL
> > and/or PROJ, the proj.pc file may point to a deleted install. Download
> and
> > untar the source package, and run just ./configure with its argumments,
> or
> > setting PKG_CONFIG_PATH= until you find a recipe that works that far.
> >
> > Roger
> >
> > >
> > > Greetings,
> > >  -- Thiago V. dos Santos
> > >
> > > ThiagoDosSantos.com
> > > MudancasClimaticasBrasil.com
> > >
> > >
> > >
> > >
> > >
> > >
> > > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <
> roger.bivand at nhh.no> wrote:
> > >
> > >
> > >
> > >
> > >
> > > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
> > > users of the CRAN Windows binary when it comes) will be part of the big
> > > migration to WKT2 from Proj4 strings for CRS representation. See
> > >
> > >
> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> > >
> > > or for a better rendering of "\phi" and bib-handling:
> > >
> > >
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> > >
> > > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html
> for the
> > > full sf and sp story.
> > >
> > > You will see lots of warnings, they should grab your attention, that is
> > > what they are for. We need your attention to be as sure as we can be
> that
> > > your results - if affected by the transition - have been checked by
> you.
> > >
> > > I plan to flip the warnings to default off from rgdal 1.6-*, and sp
> 1.5-*.
> > > In some weeks but before flipping the defaults, I'll follow up showing
> > > ways of muting them, but we really need to be confident that this
> > > necessary and future-proofing change isn't silently destroying your
> work
> > > first. So please don't treat the many warnings as just pesky and
> nagging -
> > > they are priming your immune system to check for unwanted consequences
> of
> > > your legacy CRS representation choices.
> > >
> > > I'd also like to thank the maintainers of packages importing
> > > from/depending on sp/rgdal for largely positive responses to issues
> raised
> > > and emails sent, often less polite than they might have been, but
> grabbing
> > > attention was more important. From over 70 broken reverse dependency
> > > packages we are now well under 20, and I've contacted all of those,
> with
> > > only a couple not responding. Edzer has seen similar responsiveness for
> > > the parallel migration of sf.
> > >
> > > Enjoy!
> > >
> > > Roger
> > >
> > >
> >
> > --
> > Roger Bivand
> > Department of Economics, Norwegian School of Economics,
> > Helleveien 30, N-5045 Bergen, Norway.
> > voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> > https://orcid.org/0000-0003-2392-6140
> >
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> **********************
> "The contents of this message do not reflect any position of the U.S.
> Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected"
> "the arc of the moral universe is long, but it bends toward justice" -MLK
> Jr.
>
>

	[[alternative HTML version deleted]]


From roy@mende|@@ohn @end|ng |rom no@@@gov  Sat May 30 20:11:59 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Sat, 30 May 2020 11:11:59 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
 <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
 <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>
Message-ID: <76FBBA61-399A-4D7E-A4D5-15C4968EC7F1@noaa.gov>

Hi All:

Okay after some fiddling I was able to get it to sort of successfully compile,  where I am having problems is in finding the dynamic libraries, such as I get this error:

> dyld: Library not loaded: @rpath/libproj.19.dylib

and

> Error: package or namespace load failed for ?rgdal? in dyn.load(file, DLLpath = DLLpath, ...):
>  unable to load shared object '/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
>   dlopen(/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so, 6): Library not loaded: @rpath/libgdal.26.dylib
>   Referenced from: /Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
>   Reason: image not found
> Error: loading failed

It has to do with these are defined in terms of @rpath.  I thought defining this in $LD_LIBRARY_PATH would do it,  but I have:

> echo $LD_LIBRARY_PATH
> /Users/rmendels/Library/R/4.0/library:/Users/rmendels/anaconda3/lib

I also tried setting 	$DYLD_LIBRARY_PATH same problem.  If someone can tell me how to set it so @rpath finds the dynamic libraries I might be able to get this to work.

Thanks,

-Roy



> On May 30, 2020, at 8:04 AM, chris english <englishchristophera at gmail.com> wrote:
> 
> my setup - albeit on 20.04 as reported by sf
> 
> > library(sf)
> Linking to GEOS 3.9.0dev, GDAL 3.1.0, PROJ 7.0.1
> 
> Note I'm using release gdal, that I none the less built from source as I had to enable Mr. Sid for some particular
>  data. Couldn't get GDAL 3.2.*dev working but still toying around with it. Roger's discussion of the history of all
> of this on r-spatial and the path forward is very much worth the read as and relates to his following message here.
> 
> 
> 
> On Sat, May 30, 2020 at 10:33 AM Roy Mendelssohn - NOAA Federal <roy.mendelssohn at noaa.gov> wrote:
> Yes thanks.  As I said in reply to Roger I am far from an expert in these things,  but if I can get it to build,  then I will try to post somewhere for others to use.
> 
> -Roy
> 
> > On May 30, 2020, at 7:03 AM, chris english <englishchristophera at gmail.com> wrote:
> > 
> > Roy, 
> > From a related prior post Roger shared this link to rgdal-1.5-9,  http://spatial.nhh.no/R/rgdal/ . I followed discussions
> > from the 'sf' github readme and purged all prior proj/geos/gdal iterations that have lingered around over the past five
> > years and built them from source on ubuntu 20.04. This upgrade to 20.04 was perhaps my first mistake in a month
> > long effort to bring back my full spatial capabilities as it doesn't become the official LTS until sometime mid this month.
> > I don't know how Anaconda packages and may require sym links or copying files from down in the depths to visible,
> > but it worked before and can be made to work again.
> > HTH-
> > Chris
> > 
> > On Sat, May 30, 2020 at 8:08 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
> > On Fri, 29 May 2020, Thiago V. dos Santos wrote:
> > 
> > > Dear Roger,
> > >
> > > Many thanks for the effort keeping rgdal up-to-date with proj6.
> > >
> > > I'd like to report that I am unable to install rgdal 1.5.8 on my macOS 
> > > system. I am reporting this error here on the list because I thought it 
> > > would be the best channel in terms of reaching future users experiencing 
> > > the same error. Please apologize if my rationale is not right, and 
> > > ignore this message.
> > >
> > > GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at 
> > > the time of this writing). Proj6 has also been installed via Macports.
> > >
> > > This is how I am trying to install it:
> > >
> > > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> > > R
> > > install.packages('rgdal', type="source", configure.args=c(
> > >      '--with-proj-include=/opt/local/lib/proj6/include',
> > >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > >
> > > and this is the output I get:
> > >
> > > R version 4.0.0 (2020-04-24) -- "Arbor Day"
> > > Copyright (C) 2020 The R Foundation for Statistical Computing
> > > Platform: x86_64-apple-darwin17.0 (64-bit)
> > >
> > >
> > > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > > You are welcome to redistribute it under certain conditions.
> > > Type 'license()' or 'licence()' for distribution details.
> > >
> > >
> > >   Natural language support but running in an English locale
> > >
> > >
> > > R is a collaborative project with many contributors.
> > > Type 'contributors()' for more information and
> > > 'citation()' on how to cite R or R packages in publications.
> > >
> > >
> > > Type 'demo()' for some demos, 'help()' for on-line help, or
> > > 'help.start()' for an HTML browser interface to help.
> > > Type 'q()' to quit R.
> > >
> > >
> > >> install.packages('rgdal', type="source", configure.args=c(
> > > +      '--with-proj-include=/opt/local/lib/proj6/include',
> > > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > > Installing package into ?/Users/thiago/Documents/R-packages?
> > > (as ?lib? is unspecified)
> > >
> > >
> > >     trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> > > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> > > ==================================================
> > > downloaded 2.2 MB
> > >
> > >
> > > * installing *source* package ?rgdal? ...
> > > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > > ** using staged installation
> > > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > > configure: CC: /opt/local/bin/gcc
> > > configure: CXX: /opt/local/bin/g++
> > > configure: C++11 support available
> > > configure: rgdal: 1.5-8
> > > checking for /usr/bin/svnversion... yes
> > > configure: svn revision: 990
> > > checking for gdal-config... /opt/local/bin/gdal-config
> > > checking gdal-config usability... yes
> > > configure: GDAL: 3.1.0
> > > checking GDAL version >= 1.11.4... yes
> > > checking GDAL version <= 2.5 or >= 3.0... yes
> > > checking gdal: linking with --libs only... yes
> > > checking GDAL: gdal-config data directory readable... yes
> > > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> > > configure: pkg-config proj exists, will use it
> > 
> > So far so good, but you chose to override pkg-config proj by passing 
> > configure arguments. You should let pkg-config proj provide those values.
> > 
> > > configure: PROJ version: 6.3.2
> > > configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> > > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> > > checking PROJ header API:... proj.h
> > > checking for gcc... /opt/local/bin/gcc
> > > checking whether the C compiler works... yes
> > > checking for C compiler default output file name... a.out
> > > checking for suffix of executables...
> > > checking whether we are cross compiling... no
> > > checking for suffix of object files... o
> > > checking whether we are using the GNU C compiler... yes
> > > checking whether /opt/local/bin/gcc accepts -g... yes
> > > checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> > > checking how to run the C preprocessor... /opt/local/bin/gcc -E
> > > checking for grep that handles long lines and -e... /usr/bin/grep
> > > checking for egrep... /usr/bin/grep -E
> > > checking for ANSI C header files... rm: conftest.dSYM: is a directory
> > > rm: conftest.dSYM: is a directory
> > > yes
> > > checking for sys/types.h... yes
> > > checking for sys/stat.h... yes
> > > checking for stdlib.h... yes
> > > checking for string.h... yes
> > > checking for memory.h... yes
> > > checking for strings.h... yes
> > > checking for inttypes.h... yes
> > > checking for stdint.h... yes
> > > checking for unistd.h... yes
> > > checking proj.h usability... yes
> > > checking proj.h presence... yes
> > > checking for proj.h... yes
> > 
> > Also OK.
> > 
> > > checking for proj_context_create in -lproj... no
> > > configure: error: proj_context_create not found in libproj.
> > 
> > The directory where libproj should be does not contain it - whether you 
> > got it wrong, pkg-config got it wrong, or for some other reason, the 
> > library was not found.
> > 
> > > ERROR: configuration failed for package ?rgdal?
> > > * removing ?/Users/thiago/Documents/R-packages/rgdal?
> > > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> > >
> > >
> > > The downloaded source packages are in
> > >     ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> > > Warning message:
> > > In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
> > >   installation of package ?rgdal? had non-zero exit status
> > >
> > > I found this error to be quite mysterious, and could not find any 
> > > previous discussion about it.
> > 
> > Try to avoid googling, it is usually misleading. Running ./configure in 
> > the untarred source package directory, and running ./configure --help to 
> > show the arguments to configure can be much more helpful. Crucially, they 
> > are up to date, while most search hits are old, and they are ordered by 
> > hit counts, which is certainly no guarantee of precision.
> > 
> > >
> > > Are you familiar with it? Is there any other argument that I can pass to 
> > > install.packages to solve it?
> > 
> > Try not setting configure arguments and let pkg-config proj do the work if 
> > you feel you can trust it. If, however, you have multiple installs of GDAL 
> > and/or PROJ, the proj.pc file may point to a deleted install. Download and 
> > untar the source package, and run just ./configure with its argumments, or 
> > setting PKG_CONFIG_PATH= until you find a recipe that works that far.
> > 
> > Roger
> > 
> > >
> > > Greetings,
> > >  -- Thiago V. dos Santos
> > >
> > > ThiagoDosSantos.com
> > > MudancasClimaticasBrasil.com
> > >
> > >
> > >
> > >
> > >
> > >
> > > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
> > >
> > >
> > >
> > >
> > >
> > > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
> > > users of the CRAN Windows binary when it comes) will be part of the big
> > > migration to WKT2 from Proj4 strings for CRS representation. See
> > >
> > > https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> > >
> > > or for a better rendering of "\phi" and bib-handling:
> > >
> > > https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> > >
> > > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
> > > full sf and sp story.
> > >
> > > You will see lots of warnings, they should grab your attention, that is
> > > what they are for. We need your attention to be as sure as we can be that
> > > your results - if affected by the transition - have been checked by you.
> > >
> > > I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
> > > In some weeks but before flipping the defaults, I'll follow up showing
> > > ways of muting them, but we really need to be confident that this
> > > necessary and future-proofing change isn't silently destroying your work
> > > first. So please don't treat the many warnings as just pesky and nagging -
> > > they are priming your immune system to check for unwanted consequences of
> > > your legacy CRS representation choices.
> > >
> > > I'd also like to thank the maintainers of packages importing
> > > from/depending on sp/rgdal for largely positive responses to issues raised
> > > and emails sent, often less polite than they might have been, but grabbing
> > > attention was more important. From over 70 broken reverse dependency
> > > packages we are now well under 20, and I've contacted all of those, with
> > > only a couple not responding. Edzer has seen similar responsiveness for
> > > the parallel migration of sf.
> > >
> > > Enjoy!
> > >
> > > Roger
> > >
> > >
> > 
> > -- 
> > Roger Bivand
> > Department of Economics, Norwegian School of Economics,
> > Helleveien 30, N-5045 Bergen, Norway.
> > voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> > https://orcid.org/0000-0003-2392-6140
> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> **********************
> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
> 
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected" 
> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
> 

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From eng||@hchr|@topher@ @end|ng |rom gm@||@com  Sat May 30 20:46:56 2020
From: eng||@hchr|@topher@ @end|ng |rom gm@||@com (chris english)
Date: Sat, 30 May 2020 14:46:56 -0400
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <76FBBA61-399A-4D7E-A4D5-15C4968EC7F1@noaa.gov>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
 <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
 <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>
 <76FBBA61-399A-4D7E-A4D5-15C4968EC7F1@noaa.gov>
Message-ID: <CAASFQpSZvf5O-ZAn8+JoqVhBX1Nc8=LHC4Un_J75nrxfSQf-DQ@mail.gmail.com>

Roy,

I'm not OSX but generally I see them as conceptually similar and where I
have stumbled (at what appears to be 'this stage') is in permissions so I
would check the 'geneaology' of permissions and your ownership there upon
the entire path of permissions that allows dynlib to execute
comprehensively. And as you pass the rgdal hurdle so the same for gdal,
geos. As applies to OSX, this may appear as voodoo, but if there is a sudo
analog in OSX, try it. My voodoo (that is possibly disconcerting to those
who view computers as logical systems. I would have advocated base 3 were I
there at the beginning...)

Chris

On Sat, May 30, 2020 at 2:12 PM Roy Mendelssohn - NOAA Federal via
R-sig-Geo <r-sig-geo at r-project.org> wrote:

> Hi All:
>
> Okay after some fiddling I was able to get it to sort of successfully
> compile,  where I am having problems is in finding the dynamic libraries,
> such as I get this error:
>
> > dyld: Library not loaded: @rpath/libproj.19.dylib
>
> and
>
> > Error: package or namespace load failed for ?rgdal? in dyn.load(file,
> DLLpath = DLLpath, ...):
> >  unable to load shared object
> '/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
> >
>  dlopen(/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
> 6): Library not loaded: @rpath/libgdal.26.dylib
> >   Referenced from:
> /Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
> >   Reason: image not found
> > Error: loading failed
>
> It has to do with these are defined in terms of @rpath.  I thought
> defining this in $LD_LIBRARY_PATH would do it,  but I have:
>
> > echo $LD_LIBRARY_PATH
> > /Users/rmendels/Library/R/4.0/library:/Users/rmendels/anaconda3/lib
>
> I also tried setting    $DYLD_LIBRARY_PATH same problem.  If someone can
> tell me how to set it so @rpath finds the dynamic libraries I might be able
> to get this to work.
>
> Thanks,
>
> -Roy
>
>
>
> > On May 30, 2020, at 8:04 AM, chris english <
> englishchristophera at gmail.com> wrote:
> >
> > my setup - albeit on 20.04 as reported by sf
> >
> > > library(sf)
> > Linking to GEOS 3.9.0dev, GDAL 3.1.0, PROJ 7.0.1
> >
> > Note I'm using release gdal, that I none the less built from source as I
> had to enable Mr. Sid for some particular
> >  data. Couldn't get GDAL 3.2.*dev working but still toying around with
> it. Roger's discussion of the history of all
> > of this on r-spatial and the path forward is very much worth the read as
> and relates to his following message here.
> >
> >
> >
> > On Sat, May 30, 2020 at 10:33 AM Roy Mendelssohn - NOAA Federal <
> roy.mendelssohn at noaa.gov> wrote:
> > Yes thanks.  As I said in reply to Roger I am far from an expert in
> these things,  but if I can get it to build,  then I will try to post
> somewhere for others to use.
> >
> > -Roy
> >
> > > On May 30, 2020, at 7:03 AM, chris english <
> englishchristophera at gmail.com> wrote:
> > >
> > > Roy,
> > > From a related prior post Roger shared this link to rgdal-1.5-9,
> http://spatial.nhh.no/R/rgdal/ . I followed discussions
> > > from the 'sf' github readme and purged all prior proj/geos/gdal
> iterations that have lingered around over the past five
> > > years and built them from source on ubuntu 20.04. This upgrade to
> 20.04 was perhaps my first mistake in a month
> > > long effort to bring back my full spatial capabilities as it doesn't
> become the official LTS until sometime mid this month.
> > > I don't know how Anaconda packages and may require sym links or
> copying files from down in the depths to visible,
> > > but it worked before and can be made to work again.
> > > HTH-
> > > Chris
> > >
> > > On Sat, May 30, 2020 at 8:08 AM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> > > On Fri, 29 May 2020, Thiago V. dos Santos wrote:
> > >
> > > > Dear Roger,
> > > >
> > > > Many thanks for the effort keeping rgdal up-to-date with proj6.
> > > >
> > > > I'd like to report that I am unable to install rgdal 1.5.8 on my
> macOS
> > > > system. I am reporting this error here on the list because I thought
> it
> > > > would be the best channel in terms of reaching future users
> experiencing
> > > > the same error. Please apologize if my rationale is not right, and
> > > > ignore this message.
> > > >
> > > > GDAL was installed via MacPorts and is at its latest version, 3.1.0
> (at
> > > > the time of this writing). Proj6 has also been installed via
> Macports.
> > > >
> > > > This is how I am trying to install it:
> > > >
> > > > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> > > > R
> > > > install.packages('rgdal', type="source", configure.args=c(
> > > >      '--with-proj-include=/opt/local/lib/proj6/include',
> > > >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > > >
> > > > and this is the output I get:
> > > >
> > > > R version 4.0.0 (2020-04-24) -- "Arbor Day"
> > > > Copyright (C) 2020 The R Foundation for Statistical Computing
> > > > Platform: x86_64-apple-darwin17.0 (64-bit)
> > > >
> > > >
> > > > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > > > You are welcome to redistribute it under certain conditions.
> > > > Type 'license()' or 'licence()' for distribution details.
> > > >
> > > >
> > > >   Natural language support but running in an English locale
> > > >
> > > >
> > > > R is a collaborative project with many contributors.
> > > > Type 'contributors()' for more information and
> > > > 'citation()' on how to cite R or R packages in publications.
> > > >
> > > >
> > > > Type 'demo()' for some demos, 'help()' for on-line help, or
> > > > 'help.start()' for an HTML browser interface to help.
> > > > Type 'q()' to quit R.
> > > >
> > > >
> > > >> install.packages('rgdal', type="source", configure.args=c(
> > > > +      '--with-proj-include=/opt/local/lib/proj6/include',
> > > > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > > > Installing package into ?/Users/thiago/Documents/R-packages?
> > > > (as ?lib? is unspecified)
> > > >
> > > >
> > > >     trying URL '
> https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> > > > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> > > > ==================================================
> > > > downloaded 2.2 MB
> > > >
> > > >
> > > > * installing *source* package ?rgdal? ...
> > > > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > > > ** using staged installation
> > > > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > > > configure: CC: /opt/local/bin/gcc
> > > > configure: CXX: /opt/local/bin/g++
> > > > configure: C++11 support available
> > > > configure: rgdal: 1.5-8
> > > > checking for /usr/bin/svnversion... yes
> > > > configure: svn revision: 990
> > > > checking for gdal-config... /opt/local/bin/gdal-config
> > > > checking gdal-config usability... yes
> > > > configure: GDAL: 3.1.0
> > > > checking GDAL version >= 1.11.4... yes
> > > > checking GDAL version <= 2.5 or >= 3.0... yes
> > > > checking gdal: linking with --libs only... yes
> > > > checking GDAL: gdal-config data directory readable... yes
> > > > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> > > > configure: pkg-config proj exists, will use it
> > >
> > > So far so good, but you chose to override pkg-config proj by passing
> > > configure arguments. You should let pkg-config proj provide those
> values.
> > >
> > > > configure: PROJ version: 6.3.2
> > > > configure: proj CPP flags: -DPROJ_H_API
> -I/opt/local/lib/proj6/include
> > > > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> > > > checking PROJ header API:... proj.h
> > > > checking for gcc... /opt/local/bin/gcc
> > > > checking whether the C compiler works... yes
> > > > checking for C compiler default output file name... a.out
> > > > checking for suffix of executables...
> > > > checking whether we are cross compiling... no
> > > > checking for suffix of object files... o
> > > > checking whether we are using the GNU C compiler... yes
> > > > checking whether /opt/local/bin/gcc accepts -g... yes
> > > > checking for /opt/local/bin/gcc option to accept ISO C89... none
> needed
> > > > checking how to run the C preprocessor... /opt/local/bin/gcc -E
> > > > checking for grep that handles long lines and -e... /usr/bin/grep
> > > > checking for egrep... /usr/bin/grep -E
> > > > checking for ANSI C header files... rm: conftest.dSYM: is a directory
> > > > rm: conftest.dSYM: is a directory
> > > > yes
> > > > checking for sys/types.h... yes
> > > > checking for sys/stat.h... yes
> > > > checking for stdlib.h... yes
> > > > checking for string.h... yes
> > > > checking for memory.h... yes
> > > > checking for strings.h... yes
> > > > checking for inttypes.h... yes
> > > > checking for stdint.h... yes
> > > > checking for unistd.h... yes
> > > > checking proj.h usability... yes
> > > > checking proj.h presence... yes
> > > > checking for proj.h... yes
> > >
> > > Also OK.
> > >
> > > > checking for proj_context_create in -lproj... no
> > > > configure: error: proj_context_create not found in libproj.
> > >
> > > The directory where libproj should be does not contain it - whether
> you
> > > got it wrong, pkg-config got it wrong, or for some other reason, the
> > > library was not found.
> > >
> > > > ERROR: configuration failed for package ?rgdal?
> > > > * removing ?/Users/thiago/Documents/R-packages/rgdal?
> > > > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> > > >
> > > >
> > > > The downloaded source packages are in
> > > >
>  ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> > > > Warning message:
> > > > In install.packages("rgdal", type = "source", configure.args =
> c("--with-proj-include=/opt/local/lib/proj6/include",  :
> > > >   installation of package ?rgdal? had non-zero exit status
> > > >
> > > > I found this error to be quite mysterious, and could not find any
> > > > previous discussion about it.
> > >
> > > Try to avoid googling, it is usually misleading. Running ./configure
> in
> > > the untarred source package directory, and running ./configure --help
> to
> > > show the arguments to configure can be much more helpful. Crucially,
> they
> > > are up to date, while most search hits are old, and they are ordered
> by
> > > hit counts, which is certainly no guarantee of precision.
> > >
> > > >
> > > > Are you familiar with it? Is there any other argument that I can
> pass to
> > > > install.packages to solve it?
> > >
> > > Try not setting configure arguments and let pkg-config proj do the
> work if
> > > you feel you can trust it. If, however, you have multiple installs of
> GDAL
> > > and/or PROJ, the proj.pc file may point to a deleted install. Download
> and
> > > untar the source package, and run just ./configure with its
> argumments, or
> > > setting PKG_CONFIG_PATH= until you find a recipe that works that far.
> > >
> > > Roger
> > >
> > > >
> > > > Greetings,
> > > >  -- Thiago V. dos Santos
> > > >
> > > > ThiagoDosSantos.com
> > > > MudancasClimaticasBrasil.com
> > > >
> > > >
> > > >
> > > >
> > > >
> > > >
> > > > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <
> roger.bivand at nhh.no> wrote:
> > > >
> > > >
> > > >
> > > >
> > > >
> > > > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6
> (including
> > > > users of the CRAN Windows binary when it comes) will be part of the
> big
> > > > migration to WKT2 from Proj4 strings for CRS representation. See
> > > >
> > > >
> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> > > >
> > > > or for a better rendering of "\phi" and bib-handling:
> > > >
> > > >
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> > > >
> > > > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html
> for the
> > > > full sf and sp story.
> > > >
> > > > You will see lots of warnings, they should grab your attention, that
> is
> > > > what they are for. We need your attention to be as sure as we can be
> that
> > > > your results - if affected by the transition - have been checked by
> you.
> > > >
> > > > I plan to flip the warnings to default off from rgdal 1.6-*, and sp
> 1.5-*.
> > > > In some weeks but before flipping the defaults, I'll follow up
> showing
> > > > ways of muting them, but we really need to be confident that this
> > > > necessary and future-proofing change isn't silently destroying your
> work
> > > > first. So please don't treat the many warnings as just pesky and
> nagging -
> > > > they are priming your immune system to check for unwanted
> consequences of
> > > > your legacy CRS representation choices.
> > > >
> > > > I'd also like to thank the maintainers of packages importing
> > > > from/depending on sp/rgdal for largely positive responses to issues
> raised
> > > > and emails sent, often less polite than they might have been, but
> grabbing
> > > > attention was more important. From over 70 broken reverse dependency
> > > > packages we are now well under 20, and I've contacted all of those,
> with
> > > > only a couple not responding. Edzer has seen similar responsiveness
> for
> > > > the parallel migration of sf.
> > > >
> > > > Enjoy!
> > > >
> > > > Roger
> > > >
> > > >
> > >
> > > --
> > > Roger Bivand
> > > Department of Economics, Norwegian School of Economics,
> > > Helleveien 30, N-5045 Bergen, Norway.
> > > voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> > > https://orcid.org/0000-0003-2392-6140
> > >
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at r-project.org
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > **********************
> > "The contents of this message do not reflect any position of the U.S.
> Government or NOAA."
> > **********************
> > Roy Mendelssohn
> > Supervisory Operations Research Analyst
> > NOAA/NMFS
> > Environmental Research Division
> > Southwest Fisheries Science Center
> > ***Note new street address***
> > 110 McAllister Way
> > Santa Cruz, CA 95060
> > Phone: (831)-420-3666
> > Fax: (831) 420-3980
> > e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
> >
> > "Old age and treachery will overcome youth and skill."
> > "From those who have been given much, much will be expected"
> > "the arc of the moral universe is long, but it bends toward justice"
> -MLK Jr.
> >
>
> **********************
> "The contents of this message do not reflect any position of the U.S.
> Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected"
> "the arc of the moral universe is long, but it bends toward justice" -MLK
> Jr.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From rob00x @end|ng |rom gm@||@com  Sat May 30 21:40:53 2020
From: rob00x @end|ng |rom gm@||@com (Robin Lovelace)
Date: Sat, 30 May 2020 20:40:53 +0100
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <CAASFQpSZvf5O-ZAn8+JoqVhBX1Nc8=LHC4Un_J75nrxfSQf-DQ@mail.gmail.com>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
 <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
 <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>
 <76FBBA61-399A-4D7E-A4D5-15C4968EC7F1@noaa.gov>
 <CAASFQpSZvf5O-ZAn8+JoqVhBX1Nc8=LHC4Un_J75nrxfSQf-DQ@mail.gmail.com>
Message-ID: <CAF16KkUzkGrJUBu1iHXNCWD1NbndRky38a-=pMtSdsiUQ5Wy9g@mail.gmail.com>

Hi all,

For what it's worth I'm having the same issue and am getting this message:

inverser.c:5:10: fatal error: projects.h: No such file or directory
 #include <projects.h>
          ^~~~~~~~~~~~
compilation terminated.
/usr/lib/R/etc/Makeconf:168: recipe for target 'inverser.o' failed
make: *** [inverser.o] Error 1
ERROR: compilation failed for package ?rgdal?
* removing ?/home/robin/R/x86_64-pc-linux-gnu-library/3.6/rgdal?
* restoring previous ?/home/robin/R/x86_64-pc-linux-gnu-library/3.6/rgdal?

The development version of sf installs OK. I'm on Ubuntu with the following
versions:

sf::sf_extSoftVersion()
          GEOS           GDAL         proj.4 GDAL_with_GEOS     USE_PROJ_H
       "3.8.0"        "3.0.4"        "7.0.0"         "true"         "true"

I think I need to set the proj path. My projinfo binary is at

which projinfo
# /usr/bin/projinfo

From the thread I guess I should add the argument ,
 configure.args=c("--with-proj-include=...") but so far my attempts have
been in vain.

As a test I tried installing older versions with the following results:

remotes::install_version(package = "rgdal", version = "1.4-8") # works
remotes::install_version(package = "rgdal", version = "1.4-7") # works
remotes::install_version(package = "rgdal", version = "1.5-8") # fails

Any pointers for installation on my set-up appreciated.

I should say huge thanks to Roger and other developers in the community for
amazing work keeping track of rapidly changing upstream dependencies. It's
a small miracle that R can be used as a powerful geographic data processing
tool, with a vast array of statistical functionality a few keystrokes away.
Hope sharing my experience is useful.




On Sat, May 30, 2020 at 7:47 PM chris english <englishchristophera at gmail.com>
wrote:

> Roy,
>
> I'm not OSX but generally I see them as conceptually similar and where I
> have stumbled (at what appears to be 'this stage') is in permissions so I
> would check the 'geneaology' of permissions and your ownership there upon
> the entire path of permissions that allows dynlib to execute
> comprehensively. And as you pass the rgdal hurdle so the same for gdal,
> geos. As applies to OSX, this may appear as voodoo, but if there is a sudo
> analog in OSX, try it. My voodoo (that is possibly disconcerting to those
> who view computers as logical systems. I would have advocated base 3 were I
> there at the beginning...)
>
> Chris
>
> On Sat, May 30, 2020 at 2:12 PM Roy Mendelssohn - NOAA Federal via
> R-sig-Geo <r-sig-geo at r-project.org> wrote:
>
> > Hi All:
> >
> > Okay after some fiddling I was able to get it to sort of successfully
> > compile,  where I am having problems is in finding the dynamic libraries,
> > such as I get this error:
> >
> > > dyld: Library not loaded: @rpath/libproj.19.dylib
> >
> > and
> >
> > > Error: package or namespace load failed for ?rgdal? in dyn.load(file,
> > DLLpath = DLLpath, ...):
> > >  unable to load shared object
> >
> '/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
> > >
> >
> dlopen(/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so,
> > 6): Library not loaded: @rpath/libgdal.26.dylib
> > >   Referenced from:
> >
> /Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
> > >   Reason: image not found
> > > Error: loading failed
> >
> > It has to do with these are defined in terms of @rpath.  I thought
> > defining this in $LD_LIBRARY_PATH would do it,  but I have:
> >
> > > echo $LD_LIBRARY_PATH
> > > /Users/rmendels/Library/R/4.0/library:/Users/rmendels/anaconda3/lib
> >
> > I also tried setting    $DYLD_LIBRARY_PATH same problem.  If someone can
> > tell me how to set it so @rpath finds the dynamic libraries I might be
> able
> > to get this to work.
> >
> > Thanks,
> >
> > -Roy
> >
> >
> >
> > > On May 30, 2020, at 8:04 AM, chris english <
> > englishchristophera at gmail.com> wrote:
> > >
> > > my setup - albeit on 20.04 as reported by sf
> > >
> > > > library(sf)
> > > Linking to GEOS 3.9.0dev, GDAL 3.1.0, PROJ 7.0.1
> > >
> > > Note I'm using release gdal, that I none the less built from source as
> I
> > had to enable Mr. Sid for some particular
> > >  data. Couldn't get GDAL 3.2.*dev working but still toying around with
> > it. Roger's discussion of the history of all
> > > of this on r-spatial and the path forward is very much worth the read
> as
> > and relates to his following message here.
> > >
> > >
> > >
> > > On Sat, May 30, 2020 at 10:33 AM Roy Mendelssohn - NOAA Federal <
> > roy.mendelssohn at noaa.gov> wrote:
> > > Yes thanks.  As I said in reply to Roger I am far from an expert in
> > these things,  but if I can get it to build,  then I will try to post
> > somewhere for others to use.
> > >
> > > -Roy
> > >
> > > > On May 30, 2020, at 7:03 AM, chris english <
> > englishchristophera at gmail.com> wrote:
> > > >
> > > > Roy,
> > > > From a related prior post Roger shared this link to rgdal-1.5-9,
> > http://spatial.nhh.no/R/rgdal/ . I followed discussions
> > > > from the 'sf' github readme and purged all prior proj/geos/gdal
> > iterations that have lingered around over the past five
> > > > years and built them from source on ubuntu 20.04. This upgrade to
> > 20.04 was perhaps my first mistake in a month
> > > > long effort to bring back my full spatial capabilities as it doesn't
> > become the official LTS until sometime mid this month.
> > > > I don't know how Anaconda packages and may require sym links or
> > copying files from down in the depths to visible,
> > > > but it worked before and can be made to work again.
> > > > HTH-
> > > > Chris
> > > >
> > > > On Sat, May 30, 2020 at 8:08 AM Roger Bivand <Roger.Bivand at nhh.no>
> > wrote:
> > > > On Fri, 29 May 2020, Thiago V. dos Santos wrote:
> > > >
> > > > > Dear Roger,
> > > > >
> > > > > Many thanks for the effort keeping rgdal up-to-date with proj6.
> > > > >
> > > > > I'd like to report that I am unable to install rgdal 1.5.8 on my
> > macOS
> > > > > system. I am reporting this error here on the list because I
> thought
> > it
> > > > > would be the best channel in terms of reaching future users
> > experiencing
> > > > > the same error. Please apologize if my rationale is not right, and
> > > > > ignore this message.
> > > > >
> > > > > GDAL was installed via MacPorts and is at its latest version, 3.1.0
> > (at
> > > > > the time of this writing). Proj6 has also been installed via
> > Macports.
> > > > >
> > > > > This is how I am trying to install it:
> > > > >
> > > > > export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> > > > > R
> > > > > install.packages('rgdal', type="source", configure.args=c(
> > > > >      '--with-proj-include=/opt/local/lib/proj6/include',
> > > > >      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > > > >
> > > > > and this is the output I get:
> > > > >
> > > > > R version 4.0.0 (2020-04-24) -- "Arbor Day"
> > > > > Copyright (C) 2020 The R Foundation for Statistical Computing
> > > > > Platform: x86_64-apple-darwin17.0 (64-bit)
> > > > >
> > > > >
> > > > > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > > > > You are welcome to redistribute it under certain conditions.
> > > > > Type 'license()' or 'licence()' for distribution details.
> > > > >
> > > > >
> > > > >   Natural language support but running in an English locale
> > > > >
> > > > >
> > > > > R is a collaborative project with many contributors.
> > > > > Type 'contributors()' for more information and
> > > > > 'citation()' on how to cite R or R packages in publications.
> > > > >
> > > > >
> > > > > Type 'demo()' for some demos, 'help()' for on-line help, or
> > > > > 'help.start()' for an HTML browser interface to help.
> > > > > Type 'q()' to quit R.
> > > > >
> > > > >
> > > > >> install.packages('rgdal', type="source", configure.args=c(
> > > > > +      '--with-proj-include=/opt/local/lib/proj6/include',
> > > > > +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
> > > > > Installing package into ?/Users/thiago/Documents/R-packages?
> > > > > (as ?lib? is unspecified)
> > > > >
> > > > >
> > > > >     trying URL '
> > https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> > > > > Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> > > > > ==================================================
> > > > > downloaded 2.2 MB
> > > > >
> > > > >
> > > > > * installing *source* package ?rgdal? ...
> > > > > ** package ?rgdal? successfully unpacked and MD5 sums checked
> > > > > ** using staged installation
> > > > > configure: R_HOME: /Library/Frameworks/R.framework/Resources
> > > > > configure: CC: /opt/local/bin/gcc
> > > > > configure: CXX: /opt/local/bin/g++
> > > > > configure: C++11 support available
> > > > > configure: rgdal: 1.5-8
> > > > > checking for /usr/bin/svnversion... yes
> > > > > configure: svn revision: 990
> > > > > checking for gdal-config... /opt/local/bin/gdal-config
> > > > > checking gdal-config usability... yes
> > > > > configure: GDAL: 3.1.0
> > > > > checking GDAL version >= 1.11.4... yes
> > > > > checking GDAL version <= 2.5 or >= 3.0... yes
> > > > > checking gdal: linking with --libs only... yes
> > > > > checking GDAL: gdal-config data directory readable... yes
> > > > > checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> > > > > configure: pkg-config proj exists, will use it
> > > >
> > > > So far so good, but you chose to override pkg-config proj by passing
> > > > configure arguments. You should let pkg-config proj provide those
> > values.
> > > >
> > > > > configure: PROJ version: 6.3.2
> > > > > configure: proj CPP flags: -DPROJ_H_API
> > -I/opt/local/lib/proj6/include
> > > > > configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> > > > > checking PROJ header API:... proj.h
> > > > > checking for gcc... /opt/local/bin/gcc
> > > > > checking whether the C compiler works... yes
> > > > > checking for C compiler default output file name... a.out
> > > > > checking for suffix of executables...
> > > > > checking whether we are cross compiling... no
> > > > > checking for suffix of object files... o
> > > > > checking whether we are using the GNU C compiler... yes
> > > > > checking whether /opt/local/bin/gcc accepts -g... yes
> > > > > checking for /opt/local/bin/gcc option to accept ISO C89... none
> > needed
> > > > > checking how to run the C preprocessor... /opt/local/bin/gcc -E
> > > > > checking for grep that handles long lines and -e... /usr/bin/grep
> > > > > checking for egrep... /usr/bin/grep -E
> > > > > checking for ANSI C header files... rm: conftest.dSYM: is a
> directory
> > > > > rm: conftest.dSYM: is a directory
> > > > > yes
> > > > > checking for sys/types.h... yes
> > > > > checking for sys/stat.h... yes
> > > > > checking for stdlib.h... yes
> > > > > checking for string.h... yes
> > > > > checking for memory.h... yes
> > > > > checking for strings.h... yes
> > > > > checking for inttypes.h... yes
> > > > > checking for stdint.h... yes
> > > > > checking for unistd.h... yes
> > > > > checking proj.h usability... yes
> > > > > checking proj.h presence... yes
> > > > > checking for proj.h... yes
> > > >
> > > > Also OK.
> > > >
> > > > > checking for proj_context_create in -lproj... no
> > > > > configure: error: proj_context_create not found in libproj.
> > > >
> > > > The directory where libproj should be does not contain it - whether
> > you
> > > > got it wrong, pkg-config got it wrong, or for some other reason, the
> > > > library was not found.
> > > >
> > > > > ERROR: configuration failed for package ?rgdal?
> > > > > * removing ?/Users/thiago/Documents/R-packages/rgdal?
> > > > > * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
> > > > >
> > > > >
> > > > > The downloaded source packages are in
> > > > >
> >
> ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> > > > > Warning message:
> > > > > In install.packages("rgdal", type = "source", configure.args =
> > c("--with-proj-include=/opt/local/lib/proj6/include",  :
> > > > >   installation of package ?rgdal? had non-zero exit status
> > > > >
> > > > > I found this error to be quite mysterious, and could not find any
> > > > > previous discussion about it.
> > > >
> > > > Try to avoid googling, it is usually misleading. Running ./configure
> > in
> > > > the untarred source package directory, and running ./configure --help
> > to
> > > > show the arguments to configure can be much more helpful. Crucially,
> > they
> > > > are up to date, while most search hits are old, and they are ordered
> > by
> > > > hit counts, which is certainly no guarantee of precision.
> > > >
> > > > >
> > > > > Are you familiar with it? Is there any other argument that I can
> > pass to
> > > > > install.packages to solve it?
> > > >
> > > > Try not setting configure arguments and let pkg-config proj do the
> > work if
> > > > you feel you can trust it. If, however, you have multiple installs of
> > GDAL
> > > > and/or PROJ, the proj.pc file may point to a deleted install.
> Download
> > and
> > > > untar the source package, and run just ./configure with its
> > argumments, or
> > > > setting PKG_CONFIG_PATH= until you find a recipe that works that far.
> > > >
> > > > Roger
> > > >
> > > > >
> > > > > Greetings,
> > > > >  -- Thiago V. dos Santos
> > > > >
> > > > > ThiagoDosSantos.com
> > > > > MudancasClimaticasBrasil.com
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <
> > roger.bivand at nhh.no> wrote:
> > > > >
> > > > >
> > > > >
> > > > >
> > > > >
> > > > > With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6
> > (including
> > > > > users of the CRAN Windows binary when it comes) will be part of the
> > big
> > > > > migration to WKT2 from Proj4 strings for CRS representation. See
> > > > >
> > > > >
> >
> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
> > > > >
> > > > > or for a better rendering of "\phi" and bib-handling:
> > > > >
> > > > >
> >
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
> > > > >
> > > > > for background and https://www.r-spatial.org/r/2020/03/17/wkt.html
> > for the
> > > > > full sf and sp story.
> > > > >
> > > > > You will see lots of warnings, they should grab your attention,
> that
> > is
> > > > > what they are for. We need your attention to be as sure as we can
> be
> > that
> > > > > your results - if affected by the transition - have been checked by
> > you.
> > > > >
> > > > > I plan to flip the warnings to default off from rgdal 1.6-*, and sp
> > 1.5-*.
> > > > > In some weeks but before flipping the defaults, I'll follow up
> > showing
> > > > > ways of muting them, but we really need to be confident that this
> > > > > necessary and future-proofing change isn't silently destroying your
> > work
> > > > > first. So please don't treat the many warnings as just pesky and
> > nagging -
> > > > > they are priming your immune system to check for unwanted
> > consequences of
> > > > > your legacy CRS representation choices.
> > > > >
> > > > > I'd also like to thank the maintainers of packages importing
> > > > > from/depending on sp/rgdal for largely positive responses to issues
> > raised
> > > > > and emails sent, often less polite than they might have been, but
> > grabbing
> > > > > attention was more important. From over 70 broken reverse
> dependency
> > > > > packages we are now well under 20, and I've contacted all of those,
> > with
> > > > > only a couple not responding. Edzer has seen similar responsiveness
> > for
> > > > > the parallel migration of sf.
> > > > >
> > > > > Enjoy!
> > > > >
> > > > > Roger
> > > > >
> > > > >
> > > >
> > > > --
> > > > Roger Bivand
> > > > Department of Economics, Norwegian School of Economics,
> > > > Helleveien 30, N-5045 Bergen, Norway.
> > > > voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
> > > > https://orcid.org/0000-0003-2392-6140
> > > >
> >
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at r-project.org
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> > > **********************
> > > "The contents of this message do not reflect any position of the U.S.
> > Government or NOAA."
> > > **********************
> > > Roy Mendelssohn
> > > Supervisory Operations Research Analyst
> > > NOAA/NMFS
> > > Environmental Research Division
> > > Southwest Fisheries Science Center
> > > ***Note new street address***
> > > 110 McAllister Way
> > > Santa Cruz, CA 95060
> > > Phone: (831)-420-3666
> > > Fax: (831) 420-3980
> > > e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
> > >
> > > "Old age and treachery will overcome youth and skill."
> > > "From those who have been given much, much will be expected"
> > > "the arc of the moral universe is long, but it bends toward justice"
> > -MLK Jr.
> > >
> >
> > **********************
> > "The contents of this message do not reflect any position of the U.S.
> > Government or NOAA."
> > **********************
> > Roy Mendelssohn
> > Supervisory Operations Research Analyst
> > NOAA/NMFS
> > Environmental Research Division
> > Southwest Fisheries Science Center
> > ***Note new street address***
> > 110 McAllister Way
> > Santa Cruz, CA 95060
> > Phone: (831)-420-3666
> > Fax: (831) 420-3980
> > e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
> >
> > "Old age and treachery will overcome youth and skill."
> > "From those who have been given much, much will be expected"
> > "the arc of the moral universe is long, but it bends toward justice" -MLK
> > Jr.
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From roy@mende|@@ohn @end|ng |rom no@@@gov  Sat May 30 22:02:35 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Sat, 30 May 2020 13:02:35 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <CAF16KkUzkGrJUBu1iHXNCWD1NbndRky38a-=pMtSdsiUQ5Wy9g@mail.gmail.com>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
 <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
 <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>
 <76FBBA61-399A-4D7E-A4D5-15C4968EC7F1@noaa.gov>
 <CAASFQpSZvf5O-ZAn8+JoqVhBX1Nc8=LHC4Un_J75nrxfSQf-DQ@mail.gmail.com>
 <CAF16KkUzkGrJUBu1iHXNCWD1NbndRky38a-=pMtSdsiUQ5Wy9g@mail.gmail.com>
Message-ID: <21B0CA71-51A4-4179-B93A-F541A79DE81E@noaa.gov>



> On May 30, 2020, at 12:40 PM, Robin Lovelace <rob00x at gmail.com> wrote:
> 
> I should say huge thanks to Roger and other developers in the community for
> amazing work keeping track of rapidly changing upstream dependencies. It's
> a small miracle that R can be used as a powerful geographic data processing
> tool, with a vast array of statistical functionality a few keystrokes away.
> Hope sharing my experience is useful.

-Ditto.  I am just interested in seeing if I can get it to work.  It is not always possible for developers to have every OS right at hand to develop and test on. It helped in my case to get version 1.59,  and I since things were in non-standard places I had to set those.

-Roy


**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From eng||@hchr|@topher@ @end|ng |rom gm@||@com  Sat May 30 23:34:59 2020
From: eng||@hchr|@topher@ @end|ng |rom gm@||@com (chris english)
Date: Sat, 30 May 2020 17:34:59 -0400
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <21B0CA71-51A4-4179-B93A-F541A79DE81E@noaa.gov>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
 <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
 <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>
 <76FBBA61-399A-4D7E-A4D5-15C4968EC7F1@noaa.gov>
 <CAASFQpSZvf5O-ZAn8+JoqVhBX1Nc8=LHC4Un_J75nrxfSQf-DQ@mail.gmail.com>
 <CAF16KkUzkGrJUBu1iHXNCWD1NbndRky38a-=pMtSdsiUQ5Wy9g@mail.gmail.com>
 <21B0CA71-51A4-4179-B93A-F541A79DE81E@noaa.gov>
Message-ID: <CAASFQpQXNcLx+S=CjfGT6NF3MjG7TS91MZV7PWjmdE7KWot8UA@mail.gmail.com>

And I'm very grateful for Robin's
https://bookdown.org/robinlovelace/geocompr/intro.html, because at this
point my lazy days
of rstudio are broken and his book provides a very helpful and informative
re-introduction to accomplishing what I need from
the command line. Roy, did permissions figure in your difficulties or was
that an ubuntu based herring whose checking bore no
fruit?
Chris

On Sat, May 30, 2020 at 4:02 PM Roy Mendelssohn - NOAA Federal via
R-sig-Geo <r-sig-geo at r-project.org> wrote:

>
>
> > On May 30, 2020, at 12:40 PM, Robin Lovelace <rob00x at gmail.com> wrote:
> >
> > I should say huge thanks to Roger and other developers in the community
> for
> > amazing work keeping track of rapidly changing upstream dependencies.
> It's
> > a small miracle that R can be used as a powerful geographic data
> processing
> > tool, with a vast array of statistical functionality a few keystrokes
> away.
> > Hope sharing my experience is useful.
>
> -Ditto.  I am just interested in seeing if I can get it to work.  It is
> not always possible for developers to have every OS right at hand to
> develop and test on. It helped in my case to get version 1.59,  and I since
> things were in non-standard places I had to set those.
>
> -Roy
>
>
> **********************
> "The contents of this message do not reflect any position of the U.S.
> Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected"
> "the arc of the moral universe is long, but it bends toward justice" -MLK
> Jr.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From th|_ve|o@o @end|ng |rom y@hoo@com@br  Sun May 31 04:23:16 2020
From: th|_ve|o@o @end|ng |rom y@hoo@com@br (Thiago V. dos Santos)
Date: Sun, 31 May 2020 02:23:16 +0000 (UTC)
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
Message-ID: <562181269.325047.1590891796075@mail.yahoo.com>

Hi Roger,?

Thanks for all the hints. However, I am still struggling with this.

I have PKG_CONFIG_PATH set to /opt/local/lib/proj6/lib/pkgconfig:
cat $PKG_CONFIG_PATH/proj.pc
prefix=/opt/local/lib/proj6
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include
datadir=${prefix}/share/proj

Name: proj
Description: Cartographic Projections Library.
Requires:
Version: 6.3.2
Libs: -L${libdir} -lproj
Libs.Private: -L/opt/local/lib -lsqlite3 -lstdc++
Cflags: -I${includedir}



Note that the paths described within proj.pc are all good:
ls /opt/local/lib/proj6/lib/
libproj.15.dylib* libproj.a? ? ? ? ?libproj.dylib@? ? pkgconfig/

ls /opt/local/lib/proj6/include/
geodesic.h? ? ? ? ? ? proj/? ? ? ? ? ? ? ? ?proj_api.h? ? ? ? ? ? proj_experimental.h
org_proj4_PJ.h? ? ? ? proj.h? ? ? ? ? ? ? ? proj_constants.h? ? ? proj_symbol_rename.h

ls /opt/local/lib/proj6/share/proj/
BETA2007.gsb? ? ? ? ? ITRF2008? ? ? ? ? ? ? WO? ? ? ? ? ? ? ? ? ? nad.lst? ? ? ? ? ? ? ?null? ? ? ? ? ? ? ? ? prvi
CH? ? ? ? ? ? ? ? ? ? ITRF2014? ? ? ? ? ? ? alaska? ? ? ? ? ? ? ? nad27? ? ? ? ? ? ? ? ?nzgd2kgrid0005.gsb? ? stgeorge
FL? ? ? ? ? ? ? ? ? ? MD? ? ? ? ? ? ? ? ? ? conus? ? ? ? ? ? ? ? ?nad83? ? ? ? ? ? ? ? ?other.extra? ? ? ? ? ?stlrnc
GL27? ? ? ? ? ? ? ? ? TN? ? ? ? ? ? ? ? ? ? egm96_15.gtx? ? ? ? ? ntf_r93.gsb? ? ? ? ? ?proj.db? ? ? ? ? ? ? ?stpaul
ITRF2000? ? ? ? ? ? ? WI? ? ? ? ? ? ? ? ? ? hawaii? ? ? ? ? ? ? ? ntv1_can.dat? ? ? ? ? projjson.schema.json? world



It is also recognized by the system:
pkg-config --list-all
...
netcdf? ? ? ? ? ? ? ? ? ? ? ? ? ? ? netCDF - NetCDF Client Library for C
cairo-xml? ? ? ? ? ? ? ? ? ? ? ? ? ?cairo-xml - xml surface backend for cairo graphics library
proj? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? proj - Cartographic Projections Library.
damageproto? ? ? ? ? ? ? ? ? ? ? ? ?DamageProto - Damage extension headers
libraw_r? ? ? ? ? ? ? ? ? ? ? ? ? ? libraw - Raw image decoder library (thread-safe)
...

pkg-config proj --libs
-L/opt/local/lib/proj6/lib -lproj



I am sure that my system's gdal was built against proj6:?
gdal-config --dep-libs
-L/opt/local/lib -lIlmImf -lImath -lHalf -lIex -lIexMath -lIlmThread -lcrypto -lqhull -lqhull -L/opt/local/lib -lgeos_c -lwebp -L/opt/local/lib -lsqlite3 -L/opt/local/lib -lexpat -L/opt/local/lib -lopenjp2 -L/opt/local/include -L/opt/local/include/lib -ljasper -L/opt/local/lib -lnetcdf -L/opt/local/lib -lhdf5 -L/opt/local/lib -lmfhdf -ldf -lsz -lgif -lCharLS -lpng -lzstd -L/opt/local/lib/proj6/lib -lproj -lsqlite3 -lz -lpthread -ldl -L/usr/local/lib -L/opt/local/lib -lspatialite -lpcre -L/opt/local/lib -lcurl -L/opt/local/lib -lxml2



and yet, this is what I get when I try to install rgdal relying only on?pkg-config:

R
install.packages('rgdal', type='source')

Installing package into ?/Users/thiago/Documents/r-packages?
(as ?lib? is unspecified)
trying URL 'https://cran.rstudio.com/src/contrib/rgdal_1.5-8.tar.gz'
Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
==================================================
downloaded 2.2 MB


* installing *source* package ?rgdal? ...
** package ?rgdal? successfully unpacked and MD5 sums checked
** using staged installation
configure: R_HOME: /Library/Frameworks/R.framework/Resources
configure: CC: /opt/local/bin/clang
configure: CXX: /opt/local/bin/clang++
configure: C++11 support available
configure: rgdal: 1.5-8
checking for /usr/bin/svnversion... yes
configure: svn revision: 990
checking for gdal-config... /opt/local/bin/gdal-config
checking gdal-config usability... yes
configure: GDAL: 3.1.0
checking GDAL version >= 1.11.4... yes
checking GDAL version <= 2.5 or >= 3.0... yes
checking gdal: linking with --libs only... yes
checking GDAL: gdal-config data directory readable... yes
checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
configure: pkg-config proj exists, will use it
configure: PROJ version: 6.3.2
configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
configure: PROJ LIBS: -L/opt/local/lib/proj6/lib -lproj
checking PROJ header API:... proj.h
checking for gcc... /opt/local/bin/clang
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether /opt/local/bin/clang accepts -g... yes
checking for /opt/local/bin/clang option to accept ISO C89... none needed
checking how to run the C preprocessor... /opt/local/bin/clang -E
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking for ANSI C header files... rm: conftest.dSYM: is a directory
rm: conftest.dSYM: is a directory
yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking proj.h usability... yes
checking proj.h presence... yes
checking for proj.h... yes
checking for proj_context_create in -lproj... no
configure: error: proj_context_create not found in libproj.
ERROR: configuration failed for package ?rgdal?
* removing ?/Users/thiago/Documents/r-packages/rgdal?
* restoring previous ?/Users/thiago/Documents/r-packages/rgdal?

The downloaded source packages are in
?????/private/var/folders/bm/7dq3pmrx1ynbh2_j69yl_v2r0000gn/T/RtmpLPUVvd/downloaded_packages?
Warning message:
In install.packages("rgdal", type = "source") :
? installation of package ?rgdal? had non-zero exit status


Kind of lost here... Do you happen to think of any other thing I could look at? Otherwise, I will just wait until the macOS binaries are released on CRAN (not really need the latest rgdal on this machine right now).

Greetings,
?-- Thiago V. dos Santos

ThiagoDosSantos.com
MudancasClimaticasBrasil.com



On Saturday, May 30, 2020, 09:08:20 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote: 


On Fri, 29 May 2020, Thiago V. dos Santos wrote:

> Dear Roger,
>
> Many thanks for the effort keeping rgdal up-to-date with proj6.
>
> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS 
> system. I am reporting this error here on the list because I thought it 
> would be the best channel in terms of reaching future users experiencing 
> the same error. Please apologize if my rationale is not right, and 
> ignore this message.
>
> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at 
> the time of this writing). Proj6 has also been installed via Macports.
>
> This is how I am trying to install it:
>
> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
> R
> install.packages('rgdal', type="source", configure.args=c(
> ? ? ?'--with-proj-include=/opt/local/lib/proj6/include',
> ? ? ?'--with-proj-lib=/opt/local/lib/proj6/lib'))
>
> and this is the output I get:
>
> R version 4.0.0 (2020-04-24) -- "Arbor Day"
> Copyright (C) 2020 The R Foundation for Statistical Computing
> Platform: x86_64-apple-darwin17.0 (64-bit)
>
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>
> ? Natural language support but running in an English locale
>
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>
>> install.packages('rgdal', type="source", configure.args=c(
> +? ? ? '--with-proj-include=/opt/local/lib/proj6/include',
> +? ? ? '--with-proj-lib=/opt/local/lib/proj6/lib'))
> Installing package into ?/Users/thiago/Documents/R-packages?
> (as ?lib? is unspecified)
>
>
> ????trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
> ==================================================
> downloaded 2.2 MB
>
>
> * installing *source* package ?rgdal? ...
> ** package ?rgdal? successfully unpacked and MD5 sums checked
> ** using staged installation
> configure: R_HOME: /Library/Frameworks/R.framework/Resources
> configure: CC: /opt/local/bin/gcc
> configure: CXX: /opt/local/bin/g++
> configure: C++11 support available
> configure: rgdal: 1.5-8
> checking for /usr/bin/svnversion... yes
> configure: svn revision: 990
> checking for gdal-config... /opt/local/bin/gdal-config
> checking gdal-config usability... yes
> configure: GDAL: 3.1.0
> checking GDAL version >= 1.11.4... yes
> checking GDAL version <= 2.5 or >= 3.0... yes
> checking gdal: linking with --libs only... yes
> checking GDAL: gdal-config data directory readable... yes
> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
> configure: pkg-config proj exists, will use it

So far so good, but you chose to override pkg-config proj by passing 
configure arguments. You should let pkg-config proj provide those values.

> configure: PROJ version: 6.3.2
> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
> checking PROJ header API:... proj.h
> checking for gcc... /opt/local/bin/gcc
> checking whether the C compiler works... yes
> checking for C compiler default output file name... a.out
> checking for suffix of executables...
> checking whether we are cross compiling... no
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether /opt/local/bin/gcc accepts -g... yes
> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
> checking how to run the C preprocessor... /opt/local/bin/gcc -E
> checking for grep that handles long lines and -e... /usr/bin/grep
> checking for egrep... /usr/bin/grep -E
> checking for ANSI C header files... rm: conftest.dSYM: is a directory
> rm: conftest.dSYM: is a directory
> yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking proj.h usability... yes
> checking proj.h presence... yes
> checking for proj.h... yes

Also OK.

> checking for proj_context_create in -lproj... no
> configure: error: proj_context_create not found in libproj.

The directory where libproj should be does not contain it - whether you 
got it wrong, pkg-config got it wrong, or for some other reason, the 
library was not found.

> ERROR: configuration failed for package ?rgdal?
> * removing ?/Users/thiago/Documents/R-packages/rgdal?
> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>
>
> The downloaded source packages are in
> ?????/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
> Warning message:
> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",? :
> ? installation of package ?rgdal? had non-zero exit status
>
> I found this error to be quite mysterious, and could not find any 
> previous discussion about it.

Try to avoid googling, it is usually misleading. Running ./configure in 
the untarred source package directory, and running ./configure --help to 
show the arguments to configure can be much more helpful. Crucially, they 
are up to date, while most search hits are old, and they are ordered by 
hit counts, which is certainly no guarantee of precision.

>
> Are you familiar with it? Is there any other argument that I can pass to 
> install.packages to solve it?

Try not setting configure arguments and let pkg-config proj do the work if 
you feel you can trust it. If, however, you have multiple installs of GDAL 
and/or PROJ, the proj.pc file may point to a deleted install. Download and 
untar the source package, and run just ./configure with its argumments, or 
setting PKG_CONFIG_PATH= until you find a recipe that works that far.


Roger

>
> Greetings,
> ?-- Thiago V. dos Santos
>
> ThiagoDosSantos.com
> MudancasClimaticasBrasil.com
>
>
>
>
>
>
> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>
>
>
>
>
> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
> users of the CRAN Windows binary when it comes) will be part of the big
> migration to WKT2 from Proj4 strings for CRS representation. See
>
> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>
> or for a better rendering of "\phi" and bib-handling:
>
> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>
> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
> full sf and sp story.
>
> You will see lots of warnings, they should grab your attention, that is
> what they are for. We need your attention to be as sure as we can be that
> your results - if affected by the transition - have been checked by you.
>
> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
> In some weeks but before flipping the defaults, I'll follow up showing
> ways of muting them, but we really need to be confident that this
> necessary and future-proofing change isn't silently destroying your work
> first. So please don't treat the many warnings as just pesky and nagging -
> they are priming your immune system to check for unwanted consequences of
> your legacy CRS representation choices.
>
> I'd also like to thank the maintainers of packages importing
> from/depending on sp/rgdal for largely positive responses to issues raised
> and emails sent, often less polite than they might have been, but grabbing
> attention was more important. From over 70 broken reverse dependency
> packages we are now well under 20, and I've contacted all of those, with
> only a couple not responding. Edzer has seen similar responsiveness for
> the parallel migration of sf.
>
> Enjoy!
>
> Roger
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From roy@mende|@@ohn @end|ng |rom no@@@gov  Sun May 31 05:06:31 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Sat, 30 May 2020 20:06:31 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <604FAF19-C258-4F41-BCCD-6212A9A5A753@R-project.org>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
 <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
 <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>
 <76FBBA61-399A-4D7E-A4D5-15C4968EC7F1@noaa.gov>
 <604FAF19-C258-4F41-BCCD-6212A9A5A753@R-project.org>
Message-ID: <6A890145-B435-4211-8842-A7F886242C98@noaa.gov>

They are all from Anaconda Python.  I used otool and that is indeed how they are set up (see below - and libgdal.26.dylib is the image it can't find) .  I tried DYLD_FALLBACK_LIBRARY_PATH also a little while ago and it didn't make any difference, and we are a the point where it is beyond where I really know things.

> otool -D /Users/rmendels/anaconda3/lib/libgdal.26.dylib
> /Users/rmendels/anaconda3/lib/libgdal.26.dylib:
> @rpath/libgdal.26.dylib

> otool -L /Users/rmendels/anaconda3/lib/libgdal.26.dylib
> /Users/rmendels/anaconda3/lib/libgdal.26.dylib:
> 	@rpath/libgdal.26.dylib (compatibility version 27.0.0, current version 27.4.0)
> 	@rpath/libtiledb.dylib (compatibility version 0.0.0, current version 0.0.0)
> 	@rpath/libpoppler.78.dylib (compatibility version 78.0.0, current version 78.0.0)
> 	@rpath/libjson-c.4.dylib (compatibility version 5.0.0, current version 5.0.0)
> (and a bunch more)

I only mention these because they seem to have the complete set of PROJ,  GEOS and GDAL at the newer versions,  as well as the headers and *-config files.  I have not been able to find another place that has everything  (well perhaps brew has been updated,  but brew has messed up my system in the past and last thing on this list is that it has not.)  Also my usually source,  Kyngchaos is still at gdal2.4

Chris suggested it was a permissions problem,  but to use sudo I would have to get set up on a different machine,  because on this machine I can only sudo as a different user,  and that user doesn't have the necessary libraries and packages,  and to set that up would be more work than I want to do right now.  

So I was just hoping that if I could get it to compile,  I could post what I did  (I realized posting the package wouldn't work because you would need the dynamic libraries) and others could also do so if so desired.  But I am pretty much at the point where I don't really understand what the next steps would be,  and to find out would take more effort that I want to put into it right now. So I was hoping you (or someone else with a lot of knowledge about compiling on the Mac) might have suggestions.

Thanks,

-Roy

PS - I have some packages that use sp and sf,  want to make certain I can test against the most recent versions using the newer libraries.  I can see if errors are generated using some of the test platforms,  but if there are errors they don't allow me to get in and debug.



> On May 30, 2020, at 7:40 PM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> Roy,
> 
> where did you get the libraries? If they use rpath it's quite tricky - that is not how native libraries work on macOS. Also the setting on macOS is not LD_LIBRARY_PATH but DYLD_FALLBACK_LIBRARY_PATH and is typically not needed unless the library is not built properly since macOS offers better options.
> 
> Cheers,
> Simon
> 
> 
> 
>> On May 31, 2020, at 6:11 AM, Roy Mendelssohn - NOAA Federal <roy.mendelssohn at noaa.gov> wrote:
>> 
>> Hi All:
>> 
>> Okay after some fiddling I was able to get it to sort of successfully compile,  where I am having problems is in finding the dynamic libraries, such as I get this error:
>> 
>>> dyld: Library not loaded: @rpath/libproj.19.dylib
>> 
>> and
>> 
>>> Error: package or namespace load failed for ?rgdal? in dyn.load(file, DLLpath = DLLpath, ...):
>>> unable to load shared object '/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
>>> dlopen(/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so, 6): Library not loaded: @rpath/libgdal.26.dylib
>>> Referenced from: /Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
>>> Reason: image not found
>>> Error: loading failed
>> 
>> It has to do with these are defined in terms of @rpath.  I thought defining this in $LD_LIBRARY_PATH would do it,  but I have:
>> 
>>> echo $LD_LIBRARY_PATH
>>> /Users/rmendels/Library/R/4.0/library:/Users/rmendels/anaconda3/lib
>> 
>> I also tried setting 	$DYLD_LIBRARY_PATH same problem.  If someone can tell me how to set it so @rpath finds the dynamic libraries I might be able to get this to work.
>> 
>> Thanks,
>> 
>> -Roy
>> 
>> 
>> 
>>> On May 30, 2020, at 8:04 AM, chris english <englishchristophera at gmail.com> wrote:
>>> 
>>> my setup - albeit on 20.04 as reported by sf
>>> 
>>>> library(sf)
>>> Linking to GEOS 3.9.0dev, GDAL 3.1.0, PROJ 7.0.1
>>> 
>>> Note I'm using release gdal, that I none the less built from source as I had to enable Mr. Sid for some particular
>>> data. Couldn't get GDAL 3.2.*dev working but still toying around with it. Roger's discussion of the history of all
>>> of this on r-spatial and the path forward is very much worth the read as and relates to his following message here.
>>> 
>>> 
>>> 
>>> On Sat, May 30, 2020 at 10:33 AM Roy Mendelssohn - NOAA Federal <roy.mendelssohn at noaa.gov> wrote:
>>> Yes thanks.  As I said in reply to Roger I am far from an expert in these things,  but if I can get it to build,  then I will try to post somewhere for others to use.
>>> 
>>> -Roy
>>> 
>>>> On May 30, 2020, at 7:03 AM, chris english <englishchristophera at gmail.com> wrote:
>>>> 
>>>> Roy, 
>>>> From a related prior post Roger shared this link to rgdal-1.5-9,  http://spatial.nhh.no/R/rgdal/ . I followed discussions
>>>> from the 'sf' github readme and purged all prior proj/geos/gdal iterations that have lingered around over the past five
>>>> years and built them from source on ubuntu 20.04. This upgrade to 20.04 was perhaps my first mistake in a month
>>>> long effort to bring back my full spatial capabilities as it doesn't become the official LTS until sometime mid this month.
>>>> I don't know how Anaconda packages and may require sym links or copying files from down in the depths to visible,
>>>> but it worked before and can be made to work again.
>>>> HTH-
>>>> Chris
>>>> 
>>>> On Sat, May 30, 2020 at 8:08 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>> On Fri, 29 May 2020, Thiago V. dos Santos wrote:
>>>> 
>>>>> Dear Roger,
>>>>> 
>>>>> Many thanks for the effort keeping rgdal up-to-date with proj6.
>>>>> 
>>>>> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS 
>>>>> system. I am reporting this error here on the list because I thought it 
>>>>> would be the best channel in terms of reaching future users experiencing 
>>>>> the same error. Please apologize if my rationale is not right, and 
>>>>> ignore this message.
>>>>> 
>>>>> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at 
>>>>> the time of this writing). Proj6 has also been installed via Macports.
>>>>> 
>>>>> This is how I am trying to install it:
>>>>> 
>>>>> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
>>>>> R
>>>>> install.packages('rgdal', type="source", configure.args=c(
>>>>>    '--with-proj-include=/opt/local/lib/proj6/include',
>>>>>    '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>>> 
>>>>> and this is the output I get:
>>>>> 
>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>> 
>>>>> 
>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>> You are welcome to redistribute it under certain conditions.
>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>> 
>>>>> 
>>>>> Natural language support but running in an English locale
>>>>> 
>>>>> 
>>>>> R is a collaborative project with many contributors.
>>>>> Type 'contributors()' for more information and
>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>> 
>>>>> 
>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>> 'help.start()' for an HTML browser interface to help.
>>>>> Type 'q()' to quit R.
>>>>> 
>>>>> 
>>>>>> install.packages('rgdal', type="source", configure.args=c(
>>>>> +      '--with-proj-include=/opt/local/lib/proj6/include',
>>>>> +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>>> Installing package into ?/Users/thiago/Documents/R-packages?
>>>>> (as ?lib? is unspecified)
>>>>> 
>>>>> 
>>>>>   trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
>>>>> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
>>>>> ==================================================
>>>>> downloaded 2.2 MB
>>>>> 
>>>>> 
>>>>> * installing *source* package ?rgdal? ...
>>>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>>>> ** using staged installation
>>>>> configure: R_HOME: /Library/Frameworks/R.framework/Resources
>>>>> configure: CC: /opt/local/bin/gcc
>>>>> configure: CXX: /opt/local/bin/g++
>>>>> configure: C++11 support available
>>>>> configure: rgdal: 1.5-8
>>>>> checking for /usr/bin/svnversion... yes
>>>>> configure: svn revision: 990
>>>>> checking for gdal-config... /opt/local/bin/gdal-config
>>>>> checking gdal-config usability... yes
>>>>> configure: GDAL: 3.1.0
>>>>> checking GDAL version >= 1.11.4... yes
>>>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>>>> checking gdal: linking with --libs only... yes
>>>>> checking GDAL: gdal-config data directory readable... yes
>>>>> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
>>>>> configure: pkg-config proj exists, will use it
>>>> 
>>>> So far so good, but you chose to override pkg-config proj by passing 
>>>> configure arguments. You should let pkg-config proj provide those values.
>>>> 
>>>>> configure: PROJ version: 6.3.2
>>>>> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
>>>>> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
>>>>> checking PROJ header API:... proj.h
>>>>> checking for gcc... /opt/local/bin/gcc
>>>>> checking whether the C compiler works... yes
>>>>> checking for C compiler default output file name... a.out
>>>>> checking for suffix of executables...
>>>>> checking whether we are cross compiling... no
>>>>> checking for suffix of object files... o
>>>>> checking whether we are using the GNU C compiler... yes
>>>>> checking whether /opt/local/bin/gcc accepts -g... yes
>>>>> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
>>>>> checking how to run the C preprocessor... /opt/local/bin/gcc -E
>>>>> checking for grep that handles long lines and -e... /usr/bin/grep
>>>>> checking for egrep... /usr/bin/grep -E
>>>>> checking for ANSI C header files... rm: conftest.dSYM: is a directory
>>>>> rm: conftest.dSYM: is a directory
>>>>> yes
>>>>> checking for sys/types.h... yes
>>>>> checking for sys/stat.h... yes
>>>>> checking for stdlib.h... yes
>>>>> checking for string.h... yes
>>>>> checking for memory.h... yes
>>>>> checking for strings.h... yes
>>>>> checking for inttypes.h... yes
>>>>> checking for stdint.h... yes
>>>>> checking for unistd.h... yes
>>>>> checking proj.h usability... yes
>>>>> checking proj.h presence... yes
>>>>> checking for proj.h... yes
>>>> 
>>>> Also OK.
>>>> 
>>>>> checking for proj_context_create in -lproj... no
>>>>> configure: error: proj_context_create not found in libproj.
>>>> 
>>>> The directory where libproj should be does not contain it - whether you 
>>>> got it wrong, pkg-config got it wrong, or for some other reason, the 
>>>> library was not found.
>>>> 
>>>>> ERROR: configuration failed for package ?rgdal?
>>>>> * removing ?/Users/thiago/Documents/R-packages/rgdal?
>>>>> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>>>>> 
>>>>> 
>>>>> The downloaded source packages are in
>>>>>   ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
>>>>> Warning message:
>>>>> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
>>>>> installation of package ?rgdal? had non-zero exit status
>>>>> 
>>>>> I found this error to be quite mysterious, and could not find any 
>>>>> previous discussion about it.
>>>> 
>>>> Try to avoid googling, it is usually misleading. Running ./configure in 
>>>> the untarred source package directory, and running ./configure --help to 
>>>> show the arguments to configure can be much more helpful. Crucially, they 
>>>> are up to date, while most search hits are old, and they are ordered by 
>>>> hit counts, which is certainly no guarantee of precision.
>>>> 
>>>>> 
>>>>> Are you familiar with it? Is there any other argument that I can pass to 
>>>>> install.packages to solve it?
>>>> 
>>>> Try not setting configure arguments and let pkg-config proj do the work if 
>>>> you feel you can trust it. If, however, you have multiple installs of GDAL 
>>>> and/or PROJ, the proj.pc file may point to a deleted install. Download and 
>>>> untar the source package, and run just ./configure with its argumments, or 
>>>> setting PKG_CONFIG_PATH= until you find a recipe that works that far.
>>>> 
>>>> Roger
>>>> 
>>>>> 
>>>>> Greetings,
>>>>> -- Thiago V. dos Santos
>>>>> 
>>>>> ThiagoDosSantos.com
>>>>> MudancasClimaticasBrasil.com
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
>>>>> users of the CRAN Windows binary when it comes) will be part of the big
>>>>> migration to WKT2 from Proj4 strings for CRS representation. See
>>>>> 
>>>>> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>>>>> 
>>>>> or for a better rendering of "\phi" and bib-handling:
>>>>> 
>>>>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>>>>> 
>>>>> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
>>>>> full sf and sp story.
>>>>> 
>>>>> You will see lots of warnings, they should grab your attention, that is
>>>>> what they are for. We need your attention to be as sure as we can be that
>>>>> your results - if affected by the transition - have been checked by you.
>>>>> 
>>>>> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
>>>>> In some weeks but before flipping the defaults, I'll follow up showing
>>>>> ways of muting them, but we really need to be confident that this
>>>>> necessary and future-proofing change isn't silently destroying your work
>>>>> first. So please don't treat the many warnings as just pesky and nagging -
>>>>> they are priming your immune system to check for unwanted consequences of
>>>>> your legacy CRS representation choices.
>>>>> 
>>>>> I'd also like to thank the maintainers of packages importing
>>>>> from/depending on sp/rgdal for largely positive responses to issues raised
>>>>> and emails sent, often less polite than they might have been, but grabbing
>>>>> attention was more important. From over 70 broken reverse dependency
>>>>> packages we are now well under 20, and I've contacted all of those, with
>>>>> only a couple not responding. Edzer has seen similar responsiveness for
>>>>> the parallel migration of sf.
>>>>> 
>>>>> Enjoy!
>>>>> 
>>>>> Roger
>>>>> 
>>>>> 
>>>> 
>>>> -- 
>>>> Roger Bivand
>>>> Department of Economics, Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>> https://orcid.org/0000-0003-2392-6140
>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>>> **********************
>>> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
>>> **********************
>>> Roy Mendelssohn
>>> Supervisory Operations Research Analyst
>>> NOAA/NMFS
>>> Environmental Research Division
>>> Southwest Fisheries Science Center
>>> ***Note new street address***
>>> 110 McAllister Way
>>> Santa Cruz, CA 95060
>>> Phone: (831)-420-3666
>>> Fax: (831) 420-3980
>>> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>>> 
>>> "Old age and treachery will overcome youth and skill."
>>> "From those who have been given much, much will be expected" 
>>> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>>> 
>> 
>> **********************
>> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
>> **********************
>> Roy Mendelssohn
>> Supervisory Operations Research Analyst
>> NOAA/NMFS
>> Environmental Research Division
>> Southwest Fisheries Science Center
>> ***Note new street address***
>> 110 McAllister Way
>> Santa Cruz, CA 95060
>> Phone: (831)-420-3666
>> Fax: (831) 420-3980
>> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>> 
>> "Old age and treachery will overcome youth and skill."
>> "From those who have been given much, much will be expected" 
>> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>> 
> 

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From roy@mende|@@ohn @end|ng |rom no@@@gov  Sun May 31 16:17:42 2020
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Sun, 31 May 2020 07:17:42 -0700
Subject: [R-sig-Geo] rgdal 1.5-8 released on CRAN
In-Reply-To: <401DE748-316B-4C80-9A68-2D707A9D69F9@R-project.org>
References: <alpine.LFD.2.22.394.2005281321030.3206251@reclus.nhh.no>
 <796811998.1903003.1590787537630@mail.yahoo.com>
 <alpine.LFD.2.22.394.2005301356310.4058071@reclus.nhh.no>
 <CAASFQpR7FiGzsykgCz=9Ozt_Raa5E4dqJXOres1CPec2817zxw@mail.gmail.com>
 <FB1FFF1B-2D21-4143-8963-7F62A8F9897A@noaa.gov>
 <CAASFQpQ=BiTXJaeNr5+P70w64P8+rOQ1UXF-xBcAb4-p08pzEA@mail.gmail.com>
 <76FBBA61-399A-4D7E-A4D5-15C4968EC7F1@noaa.gov>
 <604FAF19-C258-4F41-BCCD-6212A9A5A753@R-project.org>
 <6A890145-B435-4211-8842-A7F886242C98@noaa.gov>
 <401DE748-316B-4C80-9A68-2D707A9D69F9@R-project.org>
Message-ID: <2274F913-2FD2-4689-B954-016FF1784ABD@noaa.gov>

Thanks.  I am not planning on installing the Anaconda R.  I am using the CRAN version myself.  There are some significant differences in the new PROJ library in how projections are defined, among other things.  I don't remember all the details,  but there are some discussions online of why the changes were made.  One of my concerns is we start having different OSes linking to different versions of the libraries that start causing differences in behavior,  causing errors in some and not in others.  Maybe someone else can work out all the details of this,  or maybe Kyngchaos will update soon,  or maybe homebrew,  we will see.

Thanks again,

-Roy


> On May 31, 2020, at 2:15 AM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> I believe you have to activate the anaconda environment to use it - but that means you have to use R from Anaconda and it is incompatible with anything else. All the package management systems are a horrible mess, because they now replace system libraries which makes them incompatible with the system and each other. Is there a particular reason why you?re not using the CRAN version? I know there was a discussion about how broken some of the most recent versions of the spatial libraries are, but I have not seen any requests yet...
> 
> Cheers,
> Simon
> 
> 
>> On May 31, 2020, at 3:06 PM, Roy Mendelssohn - NOAA Federal <roy.mendelssohn at noaa.gov> wrote:
>> 
>> They are all from Anaconda Python.  I used otool and that is indeed how they are set up (see below - and libgdal.26.dylib is the image it can't find) .  I tried DYLD_FALLBACK_LIBRARY_PATH also a little while ago and it didn't make any difference, and we are a the point where it is beyond where I really know things.
>> 
>>> otool -D /Users/rmendels/anaconda3/lib/libgdal.26.dylib
>>> /Users/rmendels/anaconda3/lib/libgdal.26.dylib:
>>> @rpath/libgdal.26.dylib
>> 
>>> otool -L /Users/rmendels/anaconda3/lib/libgdal.26.dylib
>>> /Users/rmendels/anaconda3/lib/libgdal.26.dylib:
>>> 	@rpath/libgdal.26.dylib (compatibility version 27.0.0, current version 27.4.0)
>>> 	@rpath/libtiledb.dylib (compatibility version 0.0.0, current version 0.0.0)
>>> 	@rpath/libpoppler.78.dylib (compatibility version 78.0.0, current version 78.0.0)
>>> 	@rpath/libjson-c.4.dylib (compatibility version 5.0.0, current version 5.0.0)
>>> (and a bunch more)
>> 
>> I only mention these because they seem to have the complete set of PROJ,  GEOS and GDAL at the newer versions,  as well as the headers and *-config files.  I have not been able to find another place that has everything  (well perhaps brew has been updated,  but brew has messed up my system in the past and last thing on this list is that it has not.)  Also my usually source,  Kyngchaos is still at gdal2.4
>> 
>> Chris suggested it was a permissions problem,  but to use sudo I would have to get set up on a different machine,  because on this machine I can only sudo as a different user,  and that user doesn't have the necessary libraries and packages,  and to set that up would be more work than I want to do right now.  
>> 
>> So I was just hoping that if I could get it to compile,  I could post what I did  (I realized posting the package wouldn't work because you would need the dynamic libraries) and others could also do so if so desired.  But I am pretty much at the point where I don't really understand what the next steps would be,  and to find out would take more effort that I want to put into it right now. So I was hoping you (or someone else with a lot of knowledge about compiling on the Mac) might have suggestions.
>> 
>> Thanks,
>> 
>> -Roy
>> 
>> PS - I have some packages that use sp and sf,  want to make certain I can test against the most recent versions using the newer libraries.  I can see if errors are generated using some of the test platforms,  but if there are errors they don't allow me to get in and debug.
>> 
>> 
>> 
>>> On May 30, 2020, at 7:40 PM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
>>> 
>>> Roy,
>>> 
>>> where did you get the libraries? If they use rpath it's quite tricky - that is not how native libraries work on macOS. Also the setting on macOS is not LD_LIBRARY_PATH but DYLD_FALLBACK_LIBRARY_PATH and is typically not needed unless the library is not built properly since macOS offers better options.
>>> 
>>> Cheers,
>>> Simon
>>> 
>>> 
>>> 
>>>> On May 31, 2020, at 6:11 AM, Roy Mendelssohn - NOAA Federal <roy.mendelssohn at noaa.gov> wrote:
>>>> 
>>>> Hi All:
>>>> 
>>>> Okay after some fiddling I was able to get it to sort of successfully compile,  where I am having problems is in finding the dynamic libraries, such as I get this error:
>>>> 
>>>>> dyld: Library not loaded: @rpath/libproj.19.dylib
>>>> 
>>>> and
>>>> 
>>>>> Error: package or namespace load failed for ?rgdal? in dyn.load(file, DLLpath = DLLpath, ...):
>>>>> unable to load shared object '/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so':
>>>>> dlopen(/Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so, 6): Library not loaded: @rpath/libgdal.26.dylib
>>>>> Referenced from: /Users/rmendels/Library/R/4.0/library/00LOCK-rgdal/00new/rgdal/libs/rgdal.so
>>>>> Reason: image not found
>>>>> Error: loading failed
>>>> 
>>>> It has to do with these are defined in terms of @rpath.  I thought defining this in $LD_LIBRARY_PATH would do it,  but I have:
>>>> 
>>>>> echo $LD_LIBRARY_PATH
>>>>> /Users/rmendels/Library/R/4.0/library:/Users/rmendels/anaconda3/lib
>>>> 
>>>> I also tried setting 	$DYLD_LIBRARY_PATH same problem.  If someone can tell me how to set it so @rpath finds the dynamic libraries I might be able to get this to work.
>>>> 
>>>> Thanks,
>>>> 
>>>> -Roy
>>>> 
>>>> 
>>>> 
>>>>> On May 30, 2020, at 8:04 AM, chris english <englishchristophera at gmail.com> wrote:
>>>>> 
>>>>> my setup - albeit on 20.04 as reported by sf
>>>>> 
>>>>>> library(sf)
>>>>> Linking to GEOS 3.9.0dev, GDAL 3.1.0, PROJ 7.0.1
>>>>> 
>>>>> Note I'm using release gdal, that I none the less built from source as I had to enable Mr. Sid for some particular
>>>>> data. Couldn't get GDAL 3.2.*dev working but still toying around with it. Roger's discussion of the history of all
>>>>> of this on r-spatial and the path forward is very much worth the read as and relates to his following message here.
>>>>> 
>>>>> 
>>>>> 
>>>>> On Sat, May 30, 2020 at 10:33 AM Roy Mendelssohn - NOAA Federal <roy.mendelssohn at noaa.gov> wrote:
>>>>> Yes thanks.  As I said in reply to Roger I am far from an expert in these things,  but if I can get it to build,  then I will try to post somewhere for others to use.
>>>>> 
>>>>> -Roy
>>>>> 
>>>>>> On May 30, 2020, at 7:03 AM, chris english <englishchristophera at gmail.com> wrote:
>>>>>> 
>>>>>> Roy, 
>>>>>> From a related prior post Roger shared this link to rgdal-1.5-9,  http://spatial.nhh.no/R/rgdal/ . I followed discussions
>>>>>> from the 'sf' github readme and purged all prior proj/geos/gdal iterations that have lingered around over the past five
>>>>>> years and built them from source on ubuntu 20.04. This upgrade to 20.04 was perhaps my first mistake in a month
>>>>>> long effort to bring back my full spatial capabilities as it doesn't become the official LTS until sometime mid this month.
>>>>>> I don't know how Anaconda packages and may require sym links or copying files from down in the depths to visible,
>>>>>> but it worked before and can be made to work again.
>>>>>> HTH-
>>>>>> Chris
>>>>>> 
>>>>>> On Sat, May 30, 2020 at 8:08 AM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>>> On Fri, 29 May 2020, Thiago V. dos Santos wrote:
>>>>>> 
>>>>>>> Dear Roger,
>>>>>>> 
>>>>>>> Many thanks for the effort keeping rgdal up-to-date with proj6.
>>>>>>> 
>>>>>>> I'd like to report that I am unable to install rgdal 1.5.8 on my macOS 
>>>>>>> system. I am reporting this error here on the list because I thought it 
>>>>>>> would be the best channel in terms of reaching future users experiencing 
>>>>>>> the same error. Please apologize if my rationale is not right, and 
>>>>>>> ignore this message.
>>>>>>> 
>>>>>>> GDAL was installed via MacPorts and is at its latest version, 3.1.0 (at 
>>>>>>> the time of this writing). Proj6 has also been installed via Macports.
>>>>>>> 
>>>>>>> This is how I am trying to install it:
>>>>>>> 
>>>>>>> export PKG_CONFIG_PATH=/opt/local/lib/proj6/lib/pkgconfig
>>>>>>> R
>>>>>>> install.packages('rgdal', type="source", configure.args=c(
>>>>>>>  '--with-proj-include=/opt/local/lib/proj6/include',
>>>>>>>  '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>>>>> 
>>>>>>> and this is the output I get:
>>>>>>> 
>>>>>>> R version 4.0.0 (2020-04-24) -- "Arbor Day"
>>>>>>> Copyright (C) 2020 The R Foundation for Statistical Computing
>>>>>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>>>>>> 
>>>>>>> 
>>>>>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>>>>>> You are welcome to redistribute it under certain conditions.
>>>>>>> Type 'license()' or 'licence()' for distribution details.
>>>>>>> 
>>>>>>> 
>>>>>>> Natural language support but running in an English locale
>>>>>>> 
>>>>>>> 
>>>>>>> R is a collaborative project with many contributors.
>>>>>>> Type 'contributors()' for more information and
>>>>>>> 'citation()' on how to cite R or R packages in publications.
>>>>>>> 
>>>>>>> 
>>>>>>> Type 'demo()' for some demos, 'help()' for on-line help, or
>>>>>>> 'help.start()' for an HTML browser interface to help.
>>>>>>> Type 'q()' to quit R.
>>>>>>> 
>>>>>>> 
>>>>>>>> install.packages('rgdal', type="source", configure.args=c(
>>>>>>> +      '--with-proj-include=/opt/local/lib/proj6/include',
>>>>>>> +      '--with-proj-lib=/opt/local/lib/proj6/lib'))
>>>>>>> Installing package into ?/Users/thiago/Documents/R-packages?
>>>>>>> (as ?lib? is unspecified)
>>>>>>> 
>>>>>>> 
>>>>>>> trying URL 'https://cran.r-project.org/src/contrib/rgdal_1.5-8.tar.gz'
>>>>>>> Content type 'application/x-gzip' length 2299235 bytes (2.2 MB)
>>>>>>> ==================================================
>>>>>>> downloaded 2.2 MB
>>>>>>> 
>>>>>>> 
>>>>>>> * installing *source* package ?rgdal? ...
>>>>>>> ** package ?rgdal? successfully unpacked and MD5 sums checked
>>>>>>> ** using staged installation
>>>>>>> configure: R_HOME: /Library/Frameworks/R.framework/Resources
>>>>>>> configure: CC: /opt/local/bin/gcc
>>>>>>> configure: CXX: /opt/local/bin/g++
>>>>>>> configure: C++11 support available
>>>>>>> configure: rgdal: 1.5-8
>>>>>>> checking for /usr/bin/svnversion... yes
>>>>>>> configure: svn revision: 990
>>>>>>> checking for gdal-config... /opt/local/bin/gdal-config
>>>>>>> checking gdal-config usability... yes
>>>>>>> configure: GDAL: 3.1.0
>>>>>>> checking GDAL version >= 1.11.4... yes
>>>>>>> checking GDAL version <= 2.5 or >= 3.0... yes
>>>>>>> checking gdal: linking with --libs only... yes
>>>>>>> checking GDAL: gdal-config data directory readable... yes
>>>>>>> checking GDAL: /opt/local/share/gdal/stateplane.csv readable... yes
>>>>>>> configure: pkg-config proj exists, will use it
>>>>>> 
>>>>>> So far so good, but you chose to override pkg-config proj by passing 
>>>>>> configure arguments. You should let pkg-config proj provide those values.
>>>>>> 
>>>>>>> configure: PROJ version: 6.3.2
>>>>>>> configure: proj CPP flags: -DPROJ_H_API -I/opt/local/lib/proj6/include
>>>>>>> configure: PROJ LIBS: -L/opt/local/lib/proj6/lib
>>>>>>> checking PROJ header API:... proj.h
>>>>>>> checking for gcc... /opt/local/bin/gcc
>>>>>>> checking whether the C compiler works... yes
>>>>>>> checking for C compiler default output file name... a.out
>>>>>>> checking for suffix of executables...
>>>>>>> checking whether we are cross compiling... no
>>>>>>> checking for suffix of object files... o
>>>>>>> checking whether we are using the GNU C compiler... yes
>>>>>>> checking whether /opt/local/bin/gcc accepts -g... yes
>>>>>>> checking for /opt/local/bin/gcc option to accept ISO C89... none needed
>>>>>>> checking how to run the C preprocessor... /opt/local/bin/gcc -E
>>>>>>> checking for grep that handles long lines and -e... /usr/bin/grep
>>>>>>> checking for egrep... /usr/bin/grep -E
>>>>>>> checking for ANSI C header files... rm: conftest.dSYM: is a directory
>>>>>>> rm: conftest.dSYM: is a directory
>>>>>>> yes
>>>>>>> checking for sys/types.h... yes
>>>>>>> checking for sys/stat.h... yes
>>>>>>> checking for stdlib.h... yes
>>>>>>> checking for string.h... yes
>>>>>>> checking for memory.h... yes
>>>>>>> checking for strings.h... yes
>>>>>>> checking for inttypes.h... yes
>>>>>>> checking for stdint.h... yes
>>>>>>> checking for unistd.h... yes
>>>>>>> checking proj.h usability... yes
>>>>>>> checking proj.h presence... yes
>>>>>>> checking for proj.h... yes
>>>>>> 
>>>>>> Also OK.
>>>>>> 
>>>>>>> checking for proj_context_create in -lproj... no
>>>>>>> configure: error: proj_context_create not found in libproj.
>>>>>> 
>>>>>> The directory where libproj should be does not contain it - whether you 
>>>>>> got it wrong, pkg-config got it wrong, or for some other reason, the 
>>>>>> library was not found.
>>>>>> 
>>>>>>> ERROR: configuration failed for package ?rgdal?
>>>>>>> * removing ?/Users/thiago/Documents/R-packages/rgdal?
>>>>>>> * restoring previous ?/Users/thiago/Documents/R-packages/rgdal?
>>>>>>> 
>>>>>>> 
>>>>>>> The downloaded source packages are in
>>>>>>> ?/private/var/folders/_z/01gg71zs19g816v6m2dddt8w0000gn/T/RtmpvZAChj/downloaded_packages?
>>>>>>> Warning message:
>>>>>>> In install.packages("rgdal", type = "source", configure.args = c("--with-proj-include=/opt/local/lib/proj6/include",  :
>>>>>>> installation of package ?rgdal? had non-zero exit status
>>>>>>> 
>>>>>>> I found this error to be quite mysterious, and could not find any 
>>>>>>> previous discussion about it.
>>>>>> 
>>>>>> Try to avoid googling, it is usually misleading. Running ./configure in 
>>>>>> the untarred source package directory, and running ./configure --help to 
>>>>>> show the arguments to configure can be much more helpful. Crucially, they 
>>>>>> are up to date, while most search hits are old, and they are ordered by 
>>>>>> hit counts, which is certainly no guarantee of precision.
>>>>>> 
>>>>>>> 
>>>>>>> Are you familiar with it? Is there any other argument that I can pass to 
>>>>>>> install.packages to solve it?
>>>>>> 
>>>>>> Try not setting configure arguments and let pkg-config proj do the work if 
>>>>>> you feel you can trust it. If, however, you have multiple installs of GDAL 
>>>>>> and/or PROJ, the proj.pc file may point to a deleted install. Download and 
>>>>>> untar the source package, and run just ./configure with its argumments, or 
>>>>>> setting PKG_CONFIG_PATH= until you find a recipe that works that far.
>>>>>> 
>>>>>> Roger
>>>>>> 
>>>>>>> 
>>>>>>> Greetings,
>>>>>>> -- Thiago V. dos Santos
>>>>>>> 
>>>>>>> ThiagoDosSantos.com
>>>>>>> MudancasClimaticasBrasil.com
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> On Thursday, May 28, 2020, 08:53:50 AM GMT-3, Roger Bivand <roger.bivand at nhh.no> wrote:
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> With sp 1.4-2 and rgdal 1.5-8, those using GDAL 3 and PROJ 6 (including
>>>>>>> users of the CRAN Windows binary when it comes) will be part of the big
>>>>>>> migration to WKT2 from Proj4 strings for CRS representation. See
>>>>>>> 
>>>>>>> https://cran.r-project.org/web/packages/rgdal/vignettes/CRS_projections_transformations.html
>>>>>>> 
>>>>>>> or for a better rendering of "\phi" and bib-handling:
>>>>>>> 
>>>>>>> https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html
>>>>>>> 
>>>>>>> for background and https://www.r-spatial.org/r/2020/03/17/wkt.html for the
>>>>>>> full sf and sp story.
>>>>>>> 
>>>>>>> You will see lots of warnings, they should grab your attention, that is
>>>>>>> what they are for. We need your attention to be as sure as we can be that
>>>>>>> your results - if affected by the transition - have been checked by you.
>>>>>>> 
>>>>>>> I plan to flip the warnings to default off from rgdal 1.6-*, and sp 1.5-*.
>>>>>>> In some weeks but before flipping the defaults, I'll follow up showing
>>>>>>> ways of muting them, but we really need to be confident that this
>>>>>>> necessary and future-proofing change isn't silently destroying your work
>>>>>>> first. So please don't treat the many warnings as just pesky and nagging -
>>>>>>> they are priming your immune system to check for unwanted consequences of
>>>>>>> your legacy CRS representation choices.
>>>>>>> 
>>>>>>> I'd also like to thank the maintainers of packages importing
>>>>>>> from/depending on sp/rgdal for largely positive responses to issues raised
>>>>>>> and emails sent, often less polite than they might have been, but grabbing
>>>>>>> attention was more important. From over 70 broken reverse dependency
>>>>>>> packages we are now well under 20, and I've contacted all of those, with
>>>>>>> only a couple not responding. Edzer has seen similar responsiveness for
>>>>>>> the parallel migration of sf.
>>>>>>> 
>>>>>>> Enjoy!
>>>>>>> 
>>>>>>> Roger
>>>>>>> 
>>>>>>> 
>>>>>> 
>>>>>> -- 
>>>>>> Roger Bivand
>>>>>> Department of Economics, Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
>>>>>> https://orcid.org/0000-0003-2392-6140
>>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en_______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> 
>>>>> **********************
>>>>> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
>>>>> **********************
>>>>> Roy Mendelssohn
>>>>> Supervisory Operations Research Analyst
>>>>> NOAA/NMFS
>>>>> Environmental Research Division
>>>>> Southwest Fisheries Science Center
>>>>> ***Note new street address***
>>>>> 110 McAllister Way
>>>>> Santa Cruz, CA 95060
>>>>> Phone: (831)-420-3666
>>>>> Fax: (831) 420-3980
>>>>> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>>>>> 
>>>>> "Old age and treachery will overcome youth and skill."
>>>>> "From those who have been given much, much will be expected" 
>>>>> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>>>>> 
>>>> 
>>>> **********************
>>>> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
>>>> **********************
>>>> Roy Mendelssohn
>>>> Supervisory Operations Research Analyst
>>>> NOAA/NMFS
>>>> Environmental Research Division
>>>> Southwest Fisheries Science Center
>>>> ***Note new street address***
>>>> 110 McAllister Way
>>>> Santa Cruz, CA 95060
>>>> Phone: (831)-420-3666
>>>> Fax: (831) 420-3980
>>>> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>>>> 
>>>> "Old age and treachery will overcome youth and skill."
>>>> "From those who have been given much, much will be expected" 
>>>> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>>>> 
>>> 
>> 
>> **********************
>> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
>> **********************
>> Roy Mendelssohn
>> Supervisory Operations Research Analyst
>> NOAA/NMFS
>> Environmental Research Division
>> Southwest Fisheries Science Center
>> ***Note new street address***
>> 110 McAllister Way
>> Santa Cruz, CA 95060
>> Phone: (831)-420-3666
>> Fax: (831) 420-3980
>> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>> 
>> "Old age and treachery will overcome youth and skill."
>> "From those who have been given much, much will be expected" 
>> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>> 
> 

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From Roger@B|v@nd @end|ng |rom nhh@no  Sun May 31 17:44:29 2020
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Sun, 31 May 2020 17:44:29 +0200
Subject: [R-sig-Geo] rgdal: About the new gdal3 and proj >=6 condition
In-Reply-To: <alpine.LFD.2.22.394.2005291837350.3230794@reclus.nhh.no>
References: <54DFB961-C4BB-4937-90AF-450B771F1F21@gmail.com>
 <alpine.LFD.2.22.394.2005291421380.3227460@reclus.nhh.no>
 <alpine.LFD.2.22.394.2005291837350.3230794@reclus.nhh.no>
Message-ID: <alpine.LFD.2.22.394.2005311743370.4085767@reclus.nhh.no>

Fresh version of rgdal rev 995 on link and R-forge, with more tweaks to 
the configure file. Please test.

Roger

On Fri, 29 May 2020, Roger Bivand wrote:

> I have put a tarball, built without vignettes with GDAL 2.2.4 and PROJ 7.0.1 
> that passes CMD check (with warnings for missing vignettes) on:
>
> http://spatial.nhh.no/R/rgdal/gdal_1.5-9.tar.gz
>
> It involves code copying to provide duplicated functions in three settings:
>
> PROJ < 6 & GDAL < 3
> PROJ > = 6 & GDAL >= 3
> PROJ > = 6 & GDAL < 3 (your homebrew case)
>
> You need the configure argument: --configure-args=--with-proj_api=proj_api.h.
> Without the argument, you now get directed to use it.
>
> For now I've dropped the configure tests for sqlite3, curl and tiff; works 
> for me but may not work for you.
>
> Please make the output of:
>
> R CMD check --install-args="--configure-args=--with-proj_api=proj_api.h" 
> rgdal_1.5-9.tar.gz
>
> available ASAP. I count on an immediate response.
>
> Roger
>
> On Fri, 29 May 2020, Roger Bivand wrote:
>
>>  On Fri, 29 May 2020, Patrick Schratz wrote:
>>
>>>   The just released rgdal v1.5.8 requires gdal >= 3 when proj >= 6 is
>>>   present. It does not even install the package if this condition is not
>>>   met
>>>   but errors during linking.
>>
>>  Please document with the output of 00install.out from R CMD check
>>  rgdal_1.5-8.tar.gz, and pkg-config proj --modversion, gdalinfo --version
>>  with system details.
>>
>>  Yes, PROJ >= 6 makes no sense without GDAL >= 3; GDAL 3 makes no sense
>>  with PROJ < 6. GDAL 3 with PROJ < 6 uses the old proj_api.h API and the
>>  old metadata structure with Proj4 string degradation; GDAL < 3 with PROJ
>>>  = 6 must use the deprecated API and the new metadata structure.
>> 
>>>
>>>   I could not find any sources in the web or in the announcement post of
>>>   v1.5.8 why this condition was enforced so strictly.
>>>   Does it cause unwanted results?
>>
>>  Yes, definitely. GDAL 3 was released as 3, not 2.5, to stress the complete
>>  break between GDAL 2 (with PROJ <= 5) and GDAL >= 3 (with PROJ >= 6) after
>>  GDAL barnraising. So:
>>
>>            PROJ
>>            < 6 >= 6
>>  GDAL < 3   OK   NO
>>    >  = 3   NO   OK
>> 
>> 
>>
>>>   If so, then there is a big issue since the ?gdal2 and proj >= 6?
>>>   combination has been used by many people in the past already.
>>
>>  No good precedent, just binary packagers protecting slow downstream
>>  adaptation.
>>
>>>   I haven?t tracked down for how long this situation was on the market
>>>   already.
>>>   Also the {sf} package is still installable with this combination and I
>>>   am not aware of any warnings/issues that came up due to this so far.
>>> 
>>
>>  rgdal is a much older package and has much more older code that needs this
>>  protection. It is possible to accommodate the no-go areas, but I'd really
>>  value patches to R-forge, as I cannot check multiple PROJ/GDAL version
>>  combinations just because someone isn't up to speed.
>>
>>>   It further causes complete breakage for people relying on the homebrew
>>>   package manager on macOS since current versions are gdal v2.2.4 and proj
>>>   7.0.1.
>>
>>  They should never have gone beyond PROJ 5 if they are stuck on GDAL. PROJ
>>  7 is a very different animal.
>>
>>>   The update to gdal3 is blocked since months due to an incompatibility
>>>   with `liblas` (https://github.com/libLAS/libLAS/issues/164). Reading the
>>>   issue, it looks unclear when this issue will be resolved.
>>>   The alternative osgeo4mac tap holds formula that is unstable and
>>>   somewhat broken. One cannot link rgdal with the current gdal v3.0.1 from
>>>   osgeo4mac.
>>>
>>>   This incompatibility with homebrew-core formula leads to further issues
>>>   for CI tests that rely on the spatial homebrew stack for macOS builds.
>>>
>>>   All of this is really unfortunate and I am wondering if this was a known
>>>   factor when introducing this condition in the new release.
>>>   Unfortunately rgdal is not hosted on any Git* provider (there is just
>>>   the CRAN mirror with not much information about the recent changes) and
>>>   it is unclear/untransparent to me if there is a continuous integration
>>>   setup at all for this package.
>>
>>  Do not require me to leave the excellent SVN service on R-forge. Provide
>>  patches there.
>>
>>>   I hope this is not another case in the series ?I do not like operating
>>>   system XY and hence I do not test on it? which was seen recently in
>>>   another package. That?s what CI is for and the responsibility of
>>>   package authors.
>>> 
>>
>>  I run and develop on Fedora, I  have no access to OSX, and the current
>>  release was fully checked with ~ 900 revdeps repeatedly since November on
>>  successive older and newer versions of PROJ and GDAL. I blocked new PROJ
>>  with old GDAL recently to simplify development. CI is only as good as the
>>  scripts, I am completely sure that repeated revdep testing and reading the
>>  output is superior.
>>
>>>   Also one should be aware that not every rgdal user is member of this
>>>   mailing list (I guess not even 5%) and many people in production will
>>>   face this error during install, most of them without any clue what to do
>>>   or an idea why this was raised.
>>> 
>>
>>  There has been plenty of information given about the CRS changes. rgdal
>>  could simply have been abandoned by me, and all  those production
>>  volunteers might have fixed things, but I never hear anything at all.
>>
>>>   In summary it would be great if
>>>
>>>   - There would be more detailed information on the introduction of the
>>>   new condition
>>>   - Awareness of state-of-the-art platform related library versions before
>>>   making such a release
>>>   - Transparency/Existence of a cross-platform build process
>>>   - If the incompatibility is just due to some features not being
>>>   accessible with this configuration, I suggest to raise a warning during
>>>   package load but not prevent the package from installing in the first
>>>   place
>>>   - A version-based NEWS file would be available. Currently one only sees
>>>   a revision-based Changelog:
>>>   https://cran.r-project.org/web/packages/rgdal/ChangeLog
>>>
>>>   I am well aware that I am indirectly criticising (hopefully in a
>>>   constructive way) the transparency and release process here, for which I
>>>   will probably get a rough response.
>>>   However, if that leads to more robustness and transparency in future
>>>   release, I am fine with this.
>>>
>>>   A quick patch release resolving the breakage would be highly
>>>   appreciated.
>>
>>  Only with community imput. what you ask is not needed, just extra
>>  complexity. Please provide patches, or accept my invitation to join the
>>  R-forge project and commit your fixes directly. I can see how to do it,
>>  but I don't think it makes sense, and your messsage has not motivated me,
>>  to be honest. I'm prioritizing working with CRAN to iron out reverse
>>  dependency problems.
>>
>>  Roger
>> 
>>>
>>>   Best, Patrick
>>>    [[alternative HTML version deleted]]
>>>
>>>   _______________________________________________
>>>   R-sig-Geo mailing list
>>>   R-sig-Geo at r-project.org
>>>   https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en

