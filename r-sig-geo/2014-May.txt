From a.mosnier at gmail.com  Thu May  1 14:28:36 2014
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Thu, 1 May 2014 08:28:36 -0400
Subject: [R-sig-Geo] Specifying Albers projection for the contiguous US
Message-ID: <CANkFkEd8mmVmTDst651Aax+AXYqObsmaxVSx5zvKtj=_5zsaAQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140501/4a05f93f/attachment.pl>

From jgrn at illinois.edu  Thu May  1 16:30:54 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Thu, 1 May 2014 09:30:54 -0500
Subject: [R-sig-Geo] Problem merging rasters after conversion and
 reprojection of .hdf file
In-Reply-To: <5360F14C.3090808@wur.nl>
References: <10530E7E-DE99-43D3-81DE-DD3CD51A294B@gmail.com>
	<CABG0rfvUGK0GFM4ij+pfT4VvzLnPV9MT6oGSY4+TUzFO-6kMNw@mail.gmail.com>
	<CABG0rfvTrJY7ckzbJRqm_=YPObDmC+atUN1oSz1oQBBdcd=v1g@mail.gmail.com>
	<362E1298-C2A0-46B1-96CD-E80282689AF3@gmail.com>
	<842A85E8-E6D1-4C2A-A054-D1371AD028EB@gmail.com>
	<5360F14C.3090808@wur.nl>
Message-ID: <CABG0rfsqDb56_zEob3JxWrKHKLSa61y126+VucWRnW60XS2tNg@mail.gmail.com>

That's a good trick -- I'll test to see how it performs vs. the
two-step method I was using and maybe tweak gdalUtils.  Thanks!

--j

On Wed, Apr 30, 2014 at 7:49 AM, Lo?c Dutrieux <loic.dutrieux at wur.nl> wrote:
> Dear Justin,
>
> gdalwarp is able to reproject/resample and mosaic all at once, and that is
> probably the preferred option in that case (since there are no overlapping
> areas).
> See the simplified example below:
>
>
> ###
> library(raster)
> library(gdalUtils)
>
> dir <- file.path(rasterOptions()$tmpdir, 'MODIS')
> dir.create(dir, recursive=TRUE)
>
> # Download two neighboring modis tiles
> download.file('http://e4ftl01.cr.usgs.gov/MOLT/MOD13A2.005/2000.04.22/MOD13A2.A2000113.h20v08.005.2006275210548.hdf',
> destfile=file.path(dir, 'NDVI.h20v08.hdf'))
> download.file('http://e4ftl01.cr.usgs.gov/MOLT/MOD13A2.005/2000.04.22/MOD13A2.A2000113.h21v08.005.2006275210549.hdf',
> destfile=file.path(dir, 'NDVI.h20v09.hdf'))
>
> # Get list of files downloaded
> list <- list.files(dir, full.names=TRUE)
> # Get list of sds1
> sdsList <- sapply(X=list, FUN=function(x){get_subdatasets(x)[1]})
> # Warp
> gdalwarp(srcfile=sdsList, t_srs="+proj=longlat +datum=WGS84 +no_defs",
> dstfile=file.path(dir, 'mosaic_latlong.tif'))
>
> r <- raster(file.path(dir, 'mosaic_latlong.tif'))
> plot(r)
>
> Hope this helps
> Best regards,
>
> --
> Lo?c Dutrieux
> Laboratory of Geo-Information Science and Remote Sensing
> Wageningen University
> The Netherlands
>
>
>
>
> On 14-04-30 01:10 AM, Justin Michell wrote:
>>
>> Hi Jonathan
>>
>> Thanks, very helpful!
>>
>> I have followed your suggestions (except I already had a loop going so I
>> didn?t use batch_gdal_translate). But after this process when I I try to
>> match these NDVI values (for Jan as shown below) to the coordinates of
>> my dataset, I get mostly NA?s. I am not sure if this makes sense,
>> although the reprojected map when I plot it looks fine I think.
>>
>> My coordinates in my spatial dataset represent 464 unique sample sites
>> scattered across Kenya with a count of the number people examined and
>> positive at each site, and downloaded from the malaria atlas project
>> (http://www.map.ox.ac.uk/browse-resources/). Any thoughts would be
>> appreciated!
>>
>> # Jan tiles (4 tiles cover Kenya)
>>
>>> for (i in 1 : 4){
>>
>> +   # extract the NDVI band (sd_index=1) and converts to .tiff
>> +   gdal_translate(out.files[i], paste0("Jan", "_", i, ".tiff"),
>> sd_index=1)
>> + }
>>
>>> mosaic_rasters(gdalfile=c("Jan_1.tiff", "Jan_2.tiff", "Jan_3.tiff",
>>> "Jan_4.tiff"),dst_dataset="NDVI1_mosaic.tiff", separate=F, verbose=TRUE)
>>
>>
>>> gdalwarp("NDVI1_mosaic.tiff","MODIS_NDVI/NDVIJan.tiff", s_srs="+proj=sinu
>>> +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181 +b=6371007.181 +units=m
>>> +no_defs",t_srs="+proj=longlat +datum=WGS84 +no_defs",
>>> srcnodata=-3000,dstnodata=-3000)
>>
>>
>>> NDVI1 <- raster("MODIS_NDVI/NDVIJan.tiff")*0.0001
>>> NDVI1 <- crop(NDVI1, extent(kenya))
>>
>>
>>> NDVI1
>>
>> class       : RasterLayer
>> dimensions  : 1107, 953, 1054971  (nrow, ncol, ncell)
>> resolution  : 0.008397857, 0.008397857  (x, y)
>> extent      : 33.905, 41.90816, -4.671056, 4.625372  (xmin, xmax, ymin,
>> ymax)
>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>> +towgs84=0,0,0
>> data source : in memory
>> names       : NDVIJan
>> values      : -0.2, 0.9031  (min, max)
>>
>>> summary(NDVI1)
>>
>>              NDVIJan
>> Min.        -0.2000
>> 1st Qu.      0.1813
>> Median       0.2892
>> 3rd Qu.      0.4550
>> Max.         0.9031
>> NA's    652208.0000
>>
>>> extract(NDVI1, sitesPolyPoints at coords)
>>
>>
>>   extract(NDVI1, sitesPolyPoints at coords)
>>    [1] 0.5094     NA 0.6557     NA     NA 0.6575 0.6493 0.6469     NA
>> 0.6607     NA     NA     NA 0.6814     NA     NA 0.6620     NA
>> NA     NA     NA 0.6749 0.6887     NA 0.6880 0.5959     NA
>>   [28]     NA     NA 0.6570 0.6212     NA     NA     NA     NA     NA
>> 0.6647     NA     NA 0.6296     NA     NA 0.5831     NA     NA     NA
>> 0.6147     NA 0.6167     NA 0.6258 0.6615     NA 0.6613
>>   [55]     NA 0.6626     NA     NA 0.6406     NA 0.6451 0.6718     NA
>> 0.6641     NA     NA     NA     NA 0.6479     NA 0.6506     NA
>> 0.6478     NA 0.6629     NA     NA     NA 0.6519     NA 0.6699
>>   [82]     NA     NA     NA     NA 0.5996     NA 0.6694     NA
>> 0.6855     NA 0.6625     NA     NA     NA     NA     NA     NA     NA
>> 0.6389     NA     NA     NA     NA     NA     NA     NA     NA
>> [109]     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA 0.6203     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA
>> [136] 0.6159     NA     NA 0.6538     NA 0.6613 0.6731     NA     NA
>> NA 0.6781     NA 0.6090     NA     NA 0.6054     NA     NA     NA
>> 0.6810     NA     NA     NA     NA     NA     NA     NA
>> [163] 0.6486     NA     NA 0.6328     NA     NA 0.6681     NA 0.6681
>> 0.6766     NA     NA 0.6910     NA     NA     NA     NA     NA
>> NA     NA     NA     NA 0.6706     NA     NA     NA     NA
>> [190]     NA 0.6839     NA 0.6632     NA     NA     NA     NA     NA
>> NA 0.6716     NA     NA     NA     NA     NA     NA 0.6282     NA
>> NA     NA     NA 0.6607     NA     NA     NA     NA
>> [217]     NA     NA     NA     NA     NA 0.2105     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> 0.7046     NA 0.7367     NA 0.6968     NA     NA
>> [244]     NA 0.5180 0.3300 0.7082 0.5610 0.3725     NA     NA     NA
>> NA     NA     NA 0.2636 0.7032 0.6201 0.6996     NA     NA 0.3071 0.3292
>> 0.4628     NA     NA     NA     NA     NA     NA
>> [271]     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA
>> [298]     NA     NA     NA     NA 0.7367     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA
>> [325]     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA 0.7073     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA
>> [352]     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA
>> [379]     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA
>> [406]     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA
>> [433]     NA     NA     NA     NA     NA     NA     NA     NA     NA
>> 0.3652     NA     NA     NA     NA     NA     NA     NA     NA
>> NA     NA     NA     NA     NA     NA     NA     NA     NA
>>
>>> head(sitesPolyPoints at coords)
>>
>>       coords.x1 coords.x2
>> [1,]   33.9940    0.1580
>> [2,]   34.1164   -0.0115
>> [3,]   34.1175    0.3770
>> [4,]   34.1277   -0.4222
>> [5,]   34.1318   -0.0035
>> [6,]   34.1350    0.4016
>>
>> Cheers
>> Justin
>>
>>
>> On Apr 29, 2014, at 2:56 PM, Justin Michell <jwm302 at gmail.com> wrote:
>>
>>> Hi Jonathan
>>>
>>> Thanks for you help here. I get the following error when I tried the
>>> following as per you advice (and the example for mosaic_rasters). Do I not
>>> have the right GDALDriver?:
>>>
>>>> gdal_setInstallation()
>>>> valid_install <- !is.null(getOption("gdalUtils_gdalPath"))
>>>> valid_install
>>>
>>> [1] TRUE
>>>>
>>>> if(require(raster) && require(rgdal) && valid_install)
>>>
>>> + {
>>> + NDVI_1 <- mosaic_rasters(gdalfile=c(out.files[1],out.files[2],
>>> out.files[3],out.files[4], out.files[5],
>>> out.files[6]),dst_dataset="NDVI1_mosaic.hdf", separate=F,
>>> of=c("HDF4","HDF5"), verbose=TRUE)
>>> + gdalinfo("NDVI1_mosaic.hdf")
>>> + }
>>> Checking gdal_installation...
>>> GDAL command being used:
>>> "/Library/Frameworks/GDAL.framework/Versions/1.10/Programs/gdalbuildvrt"
>>> -separate
>>> "/var/folders/t_/dby7tsnj0vgbfxp8hgclyrj80000gn/T//RtmpSKFW71/file17fd953983454.vrt"
>>> "MOD13A3.A2013001.h20v08.005.2013042085256.hdf"
>>> "MOD13A3.A2013001.h20v09.005.2013042085401.hdf"
>>> "MOD13A3.A2013001.h21v08.005.2013042085514.hdf"
>>
>> "MOD13A3.A2013001.h21v09.005.2013042085607.hdf"
>> "MOD13A3.A2013001.h22v08.005.2013042085522.hdf"
>> "MOD13A3.A2013001.h22v09.005.2013042085359.hdf"
>>>
>>> Checking gdal_installation...
>>> GDAL command being used:
>>> "/Library/Frameworks/GDAL.framework/Versions/1.10/Programs/gdal_translate"
>>> -of "HDF4" -of "HDF5"
>>> "/var/folders/t_/dby7tsnj0vgbfxp8hgclyrj80000gn/T//RtmpSKFW71/file17fd953983454.vrt"
>>> "NDVI1_mosaic.hdf"
>>> Input file size is 3600, 24000
>>> character(0)
>>> attr(,"status")
>>> [1] 1
>>> Warning messages:
>>> 1: running command
>>> '"/Library/Frameworks/GDAL.framework/Versions/1.10/Programs/gdal_translate"
>>> -of "HDF4" -of "HDF5"
>>> "/var/folders/t_/dby7tsnj0vgbfxp8hgclyrj80000gn/T//RtmpSKFW71/file17fd953983454.vrt"
>>> "NDVI1_mosaic.hdf"' had status 1
>>> 2: running command
>>> '"/Library/Frameworks/GDAL.framework/Versions/1.10/Programs/gdalinfo"
>>> "NDVI1_mosaic.hdf"' had status 1
>>> ERROR 6: GDALDriver::Create() ... no create method implemented for this
>>> format.
>>>
>>> ERROR 4: `NDVI1_mosaic.hdf' does not exist in the file system,
>>> and is not recognised as a supported dataset name.
>>>
>>> gdalinfo failed - unable to open 'NDVI1_mosaic.hdf?.
>>>
>>>
>>> Cheers
>>> Justin
>>>
>>>
>>>
>>>
>>>
>>>
>>> On Apr 28, 2014, at 3:17 PM, Jonathan Greenberg <jgrn at illinois.edu>
>>> wrote:
>>>
>>>> Also note you can use ?batch_gdal_translate to do your HDF -> TIF
>>>> conversions.
>>>>
>>>> --j
>>>>
>>>> On Mon, Apr 28, 2014 at 8:12 AM, Jonathan Greenberg <jgrn at illinois.edu>
>>>> wrote:
>>>>>
>>>>> Justin:
>>>>>
>>>>> Couple of comments:
>>>>>
>>>>> 1) In general, I find it easier to mosaic FIRST and then reproject
>>>>> SECOND -- when you reproject first, mosaic second, you can get weird
>>>>> issues particularly along the seams.
>>>>> 2) Since you are already using gdalUtils, have you tried
>>>>> ?mosaic_rasters (which will be faster than merge() in all likelihood,
>>>>> since it uses the base GDAL mosaicking capabilities)?  Make sure
>>>>> separate=FALSE for this particular application.
>>>>>
>>>>> --j
>>>>>
>>>>> On Mon, Apr 28, 2014 at 7:18 AM, Justin Michell <jwm302 at gmail.com>
>>>>> wrote:
>>>>>>
>>>>>> Dear Group
>>>>>>
>>>>>> I am dealing with the task of preprocessing and re-projecting MODIS
>>>>>> gridded tiles in .hdf format from Sinusoidal projection, in R, to a
>>>>>> geographic projection. I would like to align all my other climate layers
>>>>>> (from worldclim.org) which are at 1km resolution  to my NDVI layers. I am
>>>>>> using the gdal_utils package in R, and only
>>
>> one subset I?m interested in (monthly NDVI). I am working on Mac OS and
>> grabbed gdal from here: http://www.kyngchaos.com/software/frameworks .
>>>>>>
>>>>>>
>>>>>> To do this I use the following code (previous list entries relating to
>>>>>> gdalUtils have assisted me up till this point):
>>>>>>
>>>>>> # download all available monthly images for the year 2013 - MODIS
>>>>>> PRODUCT (MOD13A3, Terra, Vegetation Indices, Tile, 1000m, Monthly)
>>>>>>
>>>>>> ModisDownload(x="MOD13A3",h=c(20,21,22),v=c(8,9),dates=c('2013.01.01','2013.12.31'),mosaic=F,proj=F)
>>>>>>
>>>>>> # extract the NDVI band (sd_index=1) and converts to .tiff for 1 tile
>>>>>> for January
>>>>>> gdal_translate("MOD13A3.A2013001.h20v08.005.2013042085256.hdf",
>>>>>> "Jan_1.tiff", sd_index=1)
>>>>>>
>>>>>> # converts projection to Geog WGS84
>>>>>> gdalwarp(?Jan_1.tiff","MODIS_NDVI/NDVIJan_1.tiff", s_srs="+proj=sinu
>>>>>> +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181 +b=6371007.181 +units=m
>>>>>> +no_defs",t_srs="+proj=longlat +datum=WGS84
>>>>>> +no_defs",srcnodata=-3000,dstnodata=-3000)
>>>>>>
>>>>>> I have 6 tiles per month (covering Kenya). For each month I?d like to
>>>>>> merge all 6 tiles using the raster package (to cover Kenya). For January I
>>>>>> perform the following operation using the merge function in the raster
>>>>>> package:
>>>>>>
>>>>>> NDVI1  <-
>>>>>> (merge(raster("MODIS_NDVI/NDVIJan_1.tiff"),raster("MODIS_NDVI/NDVIJan_2.tiff"),raster("MODIS_NDVI/NDVIJan_3.tiff"),
>>>>>> raster("MODIS_NDVI/NDVIJan_4.tiff"), raster("MODIS_NDVI/NDVIJan_5.tiff"),
>>>>>> raster("MODIS_NDVI/NDVIJan_6.tiff"), tolerance=0.5))*0.0001
>>>>>> NDVI1 <- crop(NDVI1, extent(kenya))
>>>>>>
>>>>>> Without including the tolerance argument I get an error:
>>>>>>
>>>>>> Error in compareRaster(x, extent = FALSE, rowcol = FALSE, orig = TRUE,
>>>>>> :
>>>>>> different origin
>>>>>>
>>>>>> But after this merge a lot of NA?s are introduced and the plot doesn?t
>>>>>> look right (as it did before for each tile).
>>>>>>
>>>>>> The resolution is not exactly the same. Here are a comparison of the
>>>>>> layers (before merging NDVI tiles) and my SpatialPolygonsDataFrame called
>>>>>> kenya, as well as my r sessionInfo() printed below:
>>>>>>
>>>>>>
>>>>>>> n1 <- raster("MODIS_NDVI/NDVIJan_1.tiff")
>>>>>>> n1
>>>>>>
>>>>>> class       : RasterLayer
>>>>>> dimensions  : 1219, 1275, 1554225  (nrow, ncol, ncell)
>>>>>> resolution  : 0.008205785, 0.008205785  (x, y)
>>>>>> extent      : 20, 30.46238, -0.002852273, 10  (xmin, xmax, ymin, ymax)
>>>>>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>>>>>> +towgs84=0,0,0
>>>>>> data source : /Users/justinmichell/MODIS_NDVI/NDVIJan_1.tiff
>>>>>> names       : NDVIJan_1
>>>>>> values      : -32768, 32767  (min, max)
>>>>>>
>>>>>>> meanTemp1
>>>>>>
>>>>>> class       : RasterLayer
>>>>>> dimensions  : 1115, 960, 1070400  (nrow, ncol, ncell)
>>>>>> resolution  : 0.008333333, 0.008333333  (x, y)
>>>>>> extent      : 33.90833, 41.90833, -4.666667, 4.625  (xmin, xmax, ymin,
>>>>>> ymax)
>>>>>> coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
>>>>>> +towgs84=0,0,0
>>>>>> data source : in memory
>>>>>> names       : layer
>>>>>> values      : -4.4, 30  (min, max)
>>>>>>
>>>>>>> kenya
>>>>>>
>>>>>> class       : SpatialPolygonsDataFrame
>>>>>> features    : 1
>>>>>> extent      : 33.90722, 41.90517, -4.669618, 4.622499  (xmin, xmax,
>>>>>> ymin, ymax)
>>>>>> coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
>>>>>> +towgs84=0,0,0
>>>>>> variables   : 11
>>>>>> names       : FIPS, ISO2, ISO3,  UN,  NAME,  AREA,  POP2005, REGION,
>>>>>> SUBREGION,    LON,  LAT
>>>>>> min values  :   KE,   KE,  KEN, 404, Kenya, 56914, 35598952,      2,
>>>>>> 14, 37.858, 0.53
>>>>>> max values  :   KE,   KE,  KEN, 404, Kenya, 56914, 35598952,      2,
>>>>>> 14, 37.858, 0.53
>>>>>>
>>>>>>> sessionInfo()
>>>>>>
>>>>>> R version 3.0.2 (2013-09-25)
>>>>>> Platform: x86_64-apple-darwin10.8.0 (64-bit)
>>>>>>
>>>>>> locale:
>>>>>> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>>>>>>
>>>>>> attached base packages:
>>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>>
>>>>>> other attached packages:
>>>>>> [1] gdalUtils_0.2.0 rgdal_0.8-14    RCurl_1.95-4.1  bitops_1.0-6
>>>>>> raster_2.2-12   sp_1.0-14
>>>>>>
>>>>>> loaded via a namespace (and not attached):
>>>>>> [1] codetools_0.2-8      foreach_1.4.1        grid_3.0.2
>>>>>> iterators_1.0.6      lattice_0.20-24      scatterplot3d_0.3-34
>>>>>>
>>>>>>
>>>>>> Thanks very much,
>>>>>> Justin Michell
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>       [[alternative HTML version deleted]]
>>>>>>
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Jonathan A. Greenberg, PhD
>>>>> Assistant Professor
>>>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>>>> Department of Geography and Geographic Information Science
>>>>> University of Illinois at Urbana-Champaign
>>>>> 259 Computing Applications Building, MC-150
>>>>> 605 East Springfield Avenue
>>>>> Champaign, IL  61820-6371
>>>>> Phone: 217-300-1924
>>>>> http://www.geog.illinois.edu/~jgrn/
>>>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Jonathan A. Greenberg, PhD
>>>> Assistant Professor
>>>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>>>> Department of Geography and Geographic Information Science
>>>> University of Illinois at Urbana-Champaign
>>>> 259 Computing Applications Building, MC-150
>>>> 605 East Springfield Avenue
>>>> Champaign, IL  61820-6371
>>>> Phone: 217-300-1924
>>>> http://www.geog.illinois.edu/~jgrn/
>>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>>>
>>>
>>
>>
>>          [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From kridox at ymail.com  Fri May  2 10:35:38 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Fri, 2 May 2014 17:35:38 +0900
Subject: [R-sig-Geo] Extraction along a SpatialLines object fails
Message-ID: <CAAcyNCx1mb9eGvOaJhaFVdGg6P6hzukWvhD14PVhtTQub6LLPg@mail.gmail.com>

Dear list members,

Could someone explain me why the following example fails when the
latitude is equal to 0?

Thank you,
Pascal

##############################
############################################
library(raster)

old <- setwd(tempdir())
download.file('ftp://topex.ucsd.edu/pub/srtm30_plus/srtm30/grd/w020n40.nc',
'w020n40.nc', method='wget')
srtm <- raster('w020n40.nc')
proj4string(srtm) <- CRS('+proj=longlat +datum=WGS84 +no_defs
+ellps=WGS84 +towgs84=0,0,0')
extent(srtm)

lat <- 0
cds <- rbind(c(-20,lat), c(20,lat))
Sl <- SpatialLines(list(Lines(list(Line(cds)), "1")))
proj4string(Sl) <- CRS('+proj=longlat +datum=WGS84 +no_defs
+ellps=WGS84 +towgs84=0,0,0')

x11()
plot(srtm)
plot(Sl, add=TRUE)

lon <- extract(init(srtm, v='x'), Sl)[[1]]
out <- extract(srtm, Sl)[[1]]
out   # no value


From b.rowlingson at lancaster.ac.uk  Fri May  2 11:36:47 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 2 May 2014 10:36:47 +0100
Subject: [R-sig-Geo] Extraction along a SpatialLines object fails
In-Reply-To: <4c9b82743888419f82b23092bc27a1af@EX-1-HT0.lancs.local>
References: <4c9b82743888419f82b23092bc27a1af@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOACTx_RhG4xd4tnB_4G5HwGZiv=gtBBe_2M=Nk7_994A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140502/64b06f74/attachment.pl>

From kridox at ymail.com  Fri May  2 11:44:50 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Fri, 2 May 2014 18:44:50 +0900
Subject: [R-sig-Geo] Extraction along a SpatialLines object fails
In-Reply-To: <CANVKczOACTx_RhG4xd4tnB_4G5HwGZiv=gtBBe_2M=Nk7_994A@mail.gmail.com>
References: <4c9b82743888419f82b23092bc27a1af@EX-1-HT0.lancs.local>
	<CANVKczOACTx_RhG4xd4tnB_4G5HwGZiv=gtBBe_2M=Nk7_994A@mail.gmail.com>
Message-ID: <CAAcyNCwL2rSdbEeYyF4wKBv0YAfS7Pq7ZC2yhrY8BonHKNrmQA@mail.gmail.com>

Hi Barry,

Thank you for your useful comments.

Regards,
Pascal

On Fri, May 2, 2014 at 6:36 PM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> It looks to me like the line has fallen in the cracks between raster cells,
> and is the same if you try any other cell boundary value for y coordinate.
> Your raster has cells that are 0.0083333 wide, so you get the same thing
> with:
>
>  > cds = cbind(seq(-20,20,len=3),rep(0.008333333333333333333,3))
>
>  > Sl <- SpatialLines(list(Lines(list(Line(cds)), "1")))
>  > proj4string(Sl) <- CRS('+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
> +towgs84=0,0,0')
>  > extract(srtm, Sl)
>  [[1]]
>  [1] NA
>
>  change it ever so slightly and it works:
>
>  > cds = cbind(seq(-20,20,len=3),rep(0.0084333333333333333333,3))
>
>  > Sl <- SpatialLines(list(Lines(list(Line(cds)), "1")))
>  > proj4string(Sl) <- CRS('+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
> +towgs84=0,0,0')
>  > extract(srtm, Sl)
>  [[1]]
>    [1] -2539 -2620 -2756 -2789 -2897 -2974 -3006 -2967 -2916 -2861 -2936
> -3002
>   [13] -2996 -3069 -3163 -3196 -3196 -3210 -3095 -3035 -2969 -2969 -2989
> -2706
>
> [etc]
>
> Now extract for lines says:
>
>  If ?y?   represents lines, the ?extract? method returns the values of the
>      cells of a Raster* object that are touched by a line.
>
> You can now argue with Robert about which cells are touched when a line is
> exactly on a raster cell boundary. Both cells, one at random, or neither?
>
>  A solution may be to buffer your line slightly to a polygon (rgeos,
> gBuffer) and extract with that.
>
> Barry
>
>
>
> On Fri, May 2, 2014 at 9:35 AM, Pascal Oettli <kridox at ymail.com> wrote:
>>
>> Dear list members,
>>
>> Could someone explain me why the following example fails when the
>> latitude is equal to 0?
>>
>> Thank you,
>> Pascal
>>
>> ##############################
>> ############################################
>> library(raster)
>>
>> old <- setwd(tempdir())
>>
>> download.file('ftp://topex.ucsd.edu/pub/srtm30_plus/srtm30/grd/w020n40.nc',
>> 'w020n40.nc', method='wget')
>> srtm <- raster('w020n40.nc')
>> proj4string(srtm) <- CRS('+proj=longlat +datum=WGS84 +no_defs
>> +ellps=WGS84 +towgs84=0,0,0')
>> extent(srtm)
>>
>> lat <- 0
>> cds <- rbind(c(-20,lat), c(20,lat))
>> Sl <- SpatialLines(list(Lines(list(Line(cds)), "1")))
>> proj4string(Sl) <- CRS('+proj=longlat +datum=WGS84 +no_defs
>> +ellps=WGS84 +towgs84=0,0,0')
>>
>> x11()
>> plot(srtm)
>> plot(Sl, add=TRUE)
>>
>> lon <- extract(init(srtm, v='x'), Sl)[[1]]
>> out <- extract(srtm, Sl)[[1]]
>> out   # no value
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From ortiz-bobea at rff.org  Fri May  2 21:18:34 2014
From: ortiz-bobea at rff.org (Ariel Ortiz-Bobea)
Date: Fri, 2 May 2014 12:18:34 -0700 (PDT)
Subject: [R-sig-Geo] Speeding up raster stack to values conversion
In-Reply-To: <CAG_8N1bEo9iEvE0M8OeO+B9DWyj+NptjxfqC+BA3eeN9oPBm-w@mail.gmail.com>
References: <CAG_8N1bEo9iEvE0M8OeO+B9DWyj+NptjxfqC+BA3eeN9oPBm-w@mail.gmail.com>
Message-ID: <1399058314356-7586325.post@n2.nabble.com>

Hello,

Were you able to find a solution for quickly putting in a matrix a bunch of
individual raster files?

Thanks,

Ariel



-----
Ariel Ortiz-Bobea
Fellow at Resources for the Future
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Speeding-up-raster-stack-to-values-conversion-tp7581730p7586325.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From milan.kili11 at gmail.com  Sat May  3 10:42:47 2014
From: milan.kili11 at gmail.com (Milan Kilibarda)
Date: Sat, 3 May 2014 10:42:47 +0200
Subject: [R-sig-Geo] plotGooglemaps - Problem with the legend
In-Reply-To: <CABdaQ+vK4E8ktx1uqGXikR9weo3G8c6uX2Gt0Mz_SU6YF5jUsw@mail.gmail.com>
References: <CABdaQ+tODwM+rY6EzvqJgPLy=AQhP7YLgagVYjn7OswbZF3eJA@mail.gmail.com>
	<CAPSaU-_BUQfSi0CH5OBMnntL8QzFreemN=RAgG8gxEQL93Oftg@mail.gmail.com>
	<CABdaQ+vK4E8ktx1uqGXikR9weo3G8c6uX2Gt0Mz_SU6YF5jUsw@mail.gmail.com>
Message-ID: <CAPSaU-9-V8XcMPYAkzuCMikhgNoEvXSjSH-8=orpGB9+4YD19w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140503/8d9fcc31/attachment.pl>

From rgenevest at free.fr  Sat May  3 13:06:51 2014
From: rgenevest at free.fr (Remi Genevest)
Date: Sat, 3 May 2014 04:06:51 -0700 (PDT)
Subject: [R-sig-Geo] reading CRU files in .dat format into a data frame
Message-ID: <1399115211353-7586327.post@n2.nabble.com>

Hi,
I have downloaded some climatic data provided by the Climatic Research Unit
(ref: Mitchell et al. (2003) ; "CRU TS 1.2" ; 10' resolution for Europe)
from there : 

http://www.cru.uea.ac.uk/cru/data/hrg/timm/grid/CRU_TS_1_2.html
<http://www.cru.uea.ac.uk/cru/data/hrg/timm/grid/CRU_TS_1_2.html>  

I was wondering if a "simple" way may exist to read these data into a R data
frame shaped like this :
Lon Lat ClimaticVariable Year Month

This kind of CRU data are widely used in statistical geography, that's the
reason why I thought some of you may have already been confronted to this
problem.

Thanks for help
best regards





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-CRU-files-in-dat-format-into-a-data-frame-tp7586327.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From tech_dev at wildintellect.com  Sat May  3 20:44:18 2014
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Sat, 03 May 2014 11:44:18 -0700
Subject: [R-sig-Geo] reading CRU files in .dat format into a data frame
In-Reply-To: <1399115211353-7586327.post@n2.nabble.com>
References: <1399115211353-7586327.post@n2.nabble.com>
Message-ID: <53653902.9070304@wildintellect.com>

I see some code on their software page for converting to netcdf.
http://www.cru.uea.ac.uk/~timm/grid/CRU_TS_2_0.html

Thanks,
Alex

On 05/03/2014 04:06 AM, Remi Genevest wrote:
> Hi,
> I have downloaded some climatic data provided by the Climatic Research Unit
> (ref: Mitchell et al. (2003) ; "CRU TS 1.2" ; 10' resolution for Europe)
> from there : 
> 
> http://www.cru.uea.ac.uk/cru/data/hrg/timm/grid/CRU_TS_1_2.html
> <http://www.cru.uea.ac.uk/cru/data/hrg/timm/grid/CRU_TS_1_2.html>  
> 
> I was wondering if a "simple" way may exist to read these data into a R data
> frame shaped like this :
> Lon Lat ClimaticVariable Year Month
> 
> This kind of CRU data are widely used in statistical geography, that's the
> reason why I thought some of you may have already been confronted to this
> problem.
> 
> Thanks for help
> best regards
> 
> 
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-CRU-files-in-dat-format-into-a-data-frame-tp7586327.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From rvaldezr at gmail.com  Sat May  3 23:05:25 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Sat, 3 May 2014 16:05:25 -0500
Subject: [R-sig-Geo] Export matrix weights to excel.
Message-ID: <B4B23918-02B6-4D78-B4B3-0F8CB7712177@gmail.com>

Hello,

I'm working with a matrix weights, I want to know if I can export the output, to handle with excel.

This is a part what I have:

> zm <- readOGR(".", "zmdis?)
OGR data source with driver: ESRI Shapefile 
Source: ".", layer: "zmdis"
with 56 features and 8 fields
Feature type: wkbPolygon with 2 dimensions
> mapaxy = coordinates(zm)
> wdist100 = dnearneigh(mapaxy, d1=0, d2=100000)
> l100 = nb2listw(wdist100, style="W", zero.policy=T)
> summary(l100, zero.policy=T)
Characteristics of weights list object:
Neighbour list object:
Number of regions: 56 
Number of nonzero links: 86 
Percentage nonzero weights: 2.742347 
Average number of links: 1.535714 
21 regions with no links:
3 6 11 13 14 15 16 24 25 27 28 35 36 38 41 47 48 51 52 53 54
Link number distribution:

 0  1  2  3  4  5  8 
21 12 11  2  7  2  1 
12 least connected regions:
1 5 7 17 19 20 21 30 33 34 45 55 with 1 link
1 most connected region:
37 with 8 links

Weights style: W 
Weights constants summary:
   n   nn S0       S1    S2
W 35 1225 35 39.26667 147.3

I want to get a matrix [56 x 56] to work in excel with it.

Thank you in advance.

Rolando Valdez


From Roger.Bivand at nhh.no  Sun May  4 19:46:20 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 4 May 2014 19:46:20 +0200
Subject: [R-sig-Geo] Export matrix weights to excel.
In-Reply-To: <B4B23918-02B6-4D78-B4B3-0F8CB7712177@gmail.com>
References: <B4B23918-02B6-4D78-B4B3-0F8CB7712177@gmail.com>
Message-ID: <alpine.LRH.2.03.1405041944410.8856@reclus.nhh.no>

On Sat, 3 May 2014, Rolando Valdez wrote:

> Hello,
>
> I'm working with a matrix weights, I want to know if I can export the 
> output, to handle with excel.
>
> This is a part what I have:
>
>> zm <- readOGR(".", "zmdis?)
> OGR data source with driver: ESRI Shapefile
> Source: ".", layer: "zmdis"
> with 56 features and 8 fields
> Feature type: wkbPolygon with 2 dimensions
>> mapaxy = coordinates(zm)
>> wdist100 = dnearneigh(mapaxy, d1=0, d2=100000)
>> l100 = nb2listw(wdist100, style="W", zero.policy=T)
>> summary(l100, zero.policy=T)
> Characteristics of weights list object:
> Neighbour list object:
> Number of regions: 56
> Number of nonzero links: 86
> Percentage nonzero weights: 2.742347
> Average number of links: 1.535714
> 21 regions with no links:
> 3 6 11 13 14 15 16 24 25 27 28 35 36 38 41 47 48 51 52 53 54
> Link number distribution:
>
> 0  1  2  3  4  5  8
> 21 12 11  2  7  2  1
> 12 least connected regions:
> 1 5 7 17 19 20 21 30 33 34 45 55 with 1 link
> 1 most connected region:
> 37 with 8 links
>
> Weights style: W
> Weights constants summary:
>   n   nn S0       S1    S2
> W 35 1225 35 39.26667 147.3
>
> I want to get a matrix [56 x 56] to work in excel with it.

?listw2mat should help, then write the matrix in a form that Excel can 
read. But note that your distance criterion leaves 21 of 56 observations 
with no neighbours.

Hope this helps,

Roger

>
> Thank you in advance.
>
> Rolando Valdez
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From katharine.walter at yale.edu  Mon May  5 01:20:42 2014
From: katharine.walter at yale.edu (Katharine Walter)
Date: Sun, 4 May 2014 19:20:42 -0400
Subject: [R-sig-Geo] plotting STSDF objects
Message-ID: <CACAXSaWmWx0goycND4s7m-aTck2HUcDk1HD2hRg8Eq_+KDwdRA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140504/78125611/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon May  5 07:59:18 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 05 May 2014 07:59:18 +0200
Subject: [R-sig-Geo] plotting STSDF objects
In-Reply-To: <CACAXSaWmWx0goycND4s7m-aTck2HUcDk1HD2hRg8Eq_+KDwdRA@mail.gmail.com>
References: <CACAXSaWmWx0goycND4s7m-aTck2HUcDk1HD2hRg8Eq_+KDwdRA@mail.gmail.com>
Message-ID: <536728B6.8020905@uni-muenster.de>



On 05/05/2014 01:20 AM, Katharine Walter wrote:
> Hi,
> 
> I am using the spacetime package to create plots of disease spread across a
> landscape.  I have a sparse dataframe and am having trouble using the
> stplot function to show all of the spatial polygons in a sparse dataframe
> (ie I would like to plot all the spatial polygons, even those representing
> townships with no case reports during the time period).
> 
> I have used the following code:
> stplot(stsdf[,,"lyme_cases"], t, col.regions = brewer.pal(9,
> "YlOrRd"),cuts=9)
> 
> I was wondering if this was the correct syntax for stplot for an STSDF
> object and also what exactly the "signature" means in the Methods section
> of stplot:
> signature(x = "STSDF"): plots object of class STSDF

In the "Methods" section of the man page for stplot, the prhrase

     stplot ?signature(x = "STSDF")?: plots object of class STSDF

refers to, "a call to method stplot where object x is of class STSDF"

> 
> Thank you very much for your help!
> Best,
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795


From ROONEYJ4 at tcd.ie  Mon May  5 11:03:28 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Mon, 5 May 2014 10:03:28 +0100
Subject: [R-sig-Geo] BYM model in R-INLA - how to specify priors individually
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BC2BCC8929@GOMAIL.college.tcd.ie>

Hi all,

I am attempting to implement the Besag-York-Mollie model in R-INLA. Specifically to recreate the WinBUGS model specified in ASDAR fig 11.10.

However I cannot figure out how to specify the spatial and random priors to be different as they are in the WinBUGS model fig11.10.

i.e. from the WinBUGS model fig 11.10 priors are specified as follows:
precu ~dgamma(0.001,0.001)
precv ~dgamma(0.1,0.1)

sigmau <-1/precu
sigmav <-1/precv

I need to do this in the INLA format. I have been playing with an example from the R-INLA webpage also using the North Carolina SIDS dataset - the code is listed below. This uses the default priors and initial values for the spatial and random parts of the INLA model. I would like to specify those priors differently for each component - equivalent to how they are specified in the above WinBugs model.

I'd be greatful for any assistance!
Kind regards,
James



#Load libraries
library(spdep)
library(maptools)
library(INLA)

#Load data from a shapefile included in the spdep package
nc.sids <- readShapePoly(system.file("etc/shapes/sids.shp", package="spdep")[1])

#Create adjacency matrix
nc.nb <- poly2nb(nc.sids)

#Compute expted number of cases
nc.sids$EXP<-nc.sids$BIR74*sum(nc.sids$SID74)/sum(nc.sids$BIR74)

#Compute proportion of non-white births
nc.sids$NWPROP<-nc.sids$NWBIR74/nc.sids$BIR74

#Convert the adjacency matrix into a file in the INLA format
nb2INLA("nc.adj", nc.nb)

#Create areas IDs to match the values in nc.adj
nc.sids$ID<-1:100

#Besag model with random spatial effect (i.e. BYM model)
m2<-inla(SID74~NWPROP+f(nc.sids$ID, model="besag", graph="nc.adj")+f(ID, model="iid"),
         family="poisson", E=nc.sids$EXP, data=as.data.frame(nc.sids),
         control.predictor=list(compute=TRUE))

#Get realtive risk estimates
nc.sids$RR2<-m2$summary.fitted.values[,1]

#Display relative risk estimates to show that both examples fit the same model
spplot(nc.sids, c( "RR2"))

From rgenevest at free.fr  Mon May  5 13:07:21 2014
From: rgenevest at free.fr (Remi Genevest)
Date: Mon, 5 May 2014 04:07:21 -0700 (PDT)
Subject: [R-sig-Geo] reading CRU files in .dat format into a data frame
In-Reply-To: <53653902.9070304@wildintellect.com>
References: <1399115211353-7586327.post@n2.nabble.com>
	<53653902.9070304@wildintellect.com>
Message-ID: <1399288041706-7586334.post@n2.nabble.com>

Well, thanks for this advice, but actually I already read this page. 
What I was looking for is close to the issue proposed in this post by Lionel
:
http://r-sig-geo.2731867.n2.nabble.com/Turning-SpatialPointsDataFrame-to-Raster-using-rasterize-td7582452.html 





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reading-CRU-files-in-dat-format-into-a-data-frame-tp7586327p7586334.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From rvaldezr at gmail.com  Mon May  5 19:20:39 2014
From: rvaldezr at gmail.com (Rolando Valdez)
Date: Mon, 5 May 2014 12:20:39 -0500
Subject: [R-sig-Geo] Export matrix weights to excel.
In-Reply-To: <alpine.LRH.2.03.1405041944410.8856@reclus.nhh.no>
References: <B4B23918-02B6-4D78-B4B3-0F8CB7712177@gmail.com>
	<alpine.LRH.2.03.1405041944410.8856@reclus.nhh.no>
Message-ID: <989767EB-4AFB-4A1D-83D1-2697A36A4928@gmail.com>

Yes, I got it.

Now, I saw an issue in the matrix, I?ve got two regions with value 1 inside the matrix, if it is W style, how is it possible?. The rest of rows are standardized.

Another question, the output follow the order of regions of the shape file, isn?t?

Thank you
El 04/05/2014, a las 12:46, Roger Bivand <Roger.Bivand at nhh.no> escribi?:

> On Sat, 3 May 2014, Rolando Valdez wrote:
> 
>> Hello,
>> 
>> I'm working with a matrix weights, I want to know if I can export the output, to handle with excel.
>> 
>> This is a part what I have:
>> 
>>> zm <- readOGR(".", "zmdis?)
>> OGR data source with driver: ESRI Shapefile
>> Source: ".", layer: "zmdis"
>> with 56 features and 8 fields
>> Feature type: wkbPolygon with 2 dimensions
>>> mapaxy = coordinates(zm)
>>> wdist100 = dnearneigh(mapaxy, d1=0, d2=100000)
>>> l100 = nb2listw(wdist100, style="W", zero.policy=T)
>>> summary(l100, zero.policy=T)
>> Characteristics of weights list object:
>> Neighbour list object:
>> Number of regions: 56
>> Number of nonzero links: 86
>> Percentage nonzero weights: 2.742347
>> Average number of links: 1.535714
>> 21 regions with no links:
>> 3 6 11 13 14 15 16 24 25 27 28 35 36 38 41 47 48 51 52 53 54
>> Link number distribution:
>> 
>> 0  1  2  3  4  5  8
>> 21 12 11  2  7  2  1
>> 12 least connected regions:
>> 1 5 7 17 19 20 21 30 33 34 45 55 with 1 link
>> 1 most connected region:
>> 37 with 8 links
>> 
>> Weights style: W
>> Weights constants summary:
>>  n   nn S0       S1    S2
>> W 35 1225 35 39.26667 147.3
>> 
>> I want to get a matrix [56 x 56] to work in excel with it.
> 
> ?listw2mat should help, then write the matrix in a form that Excel can read. But note that your distance criterion leaves 21 of 56 observations with no neighbours.
> 
> Hope this helps,
> 
> Roger
> 
>> 
>> Thank you in advance.
>> 
>> Rolando Valdez
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no

Rolando Valdez


From Roger.Bivand at nhh.no  Mon May  5 19:51:16 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 5 May 2014 19:51:16 +0200
Subject: [R-sig-Geo] Export matrix weights to excel.
In-Reply-To: <989767EB-4AFB-4A1D-83D1-2697A36A4928@gmail.com>
References: <B4B23918-02B6-4D78-B4B3-0F8CB7712177@gmail.com>
	<alpine.LRH.2.03.1405041944410.8856@reclus.nhh.no>
	<989767EB-4AFB-4A1D-83D1-2697A36A4928@gmail.com>
Message-ID: <alpine.LRH.2.03.1405051946520.16499@reclus.nhh.no>

On Mon, 5 May 2014, Rolando Valdez wrote:

> Yes, I got it.
>
> Now, I saw an issue in the matrix, I?ve got two regions with value 1 
> inside the matrix, if it is W style, how is it possible?. The rest of 
> rows are standardized.

You can "see" it, nobody else can. Are all the rowSums() of the matrix 1? 
If so, two of the observations only have one neighbour (maybe a pair 
linked only to each other). Why would this be unexpected if you are using 
distance-based neighbours?

>
> Another question, the output follow the order of regions of the shape 
> file, isn?t?

They follow the order of the coordinate matrix you passed to dnearneigh(), 
but you can check this easily enough.

Please do read the documentation, none of this is particularly difficult.

Roger

>
> Thank you
> El 04/05/2014, a las 12:46, Roger Bivand <Roger.Bivand at nhh.no> escribi?:
>
>> On Sat, 3 May 2014, Rolando Valdez wrote:
>>
>>> Hello,
>>>
>>> I'm working with a matrix weights, I want to know if I can export the output, to handle with excel.
>>>
>>> This is a part what I have:
>>>
>>>> zm <- readOGR(".", "zmdis?)
>>> OGR data source with driver: ESRI Shapefile
>>> Source: ".", layer: "zmdis"
>>> with 56 features and 8 fields
>>> Feature type: wkbPolygon with 2 dimensions
>>>> mapaxy = coordinates(zm)
>>>> wdist100 = dnearneigh(mapaxy, d1=0, d2=100000)
>>>> l100 = nb2listw(wdist100, style="W", zero.policy=T)
>>>> summary(l100, zero.policy=T)
>>> Characteristics of weights list object:
>>> Neighbour list object:
>>> Number of regions: 56
>>> Number of nonzero links: 86
>>> Percentage nonzero weights: 2.742347
>>> Average number of links: 1.535714
>>> 21 regions with no links:
>>> 3 6 11 13 14 15 16 24 25 27 28 35 36 38 41 47 48 51 52 53 54
>>> Link number distribution:
>>>
>>> 0  1  2  3  4  5  8
>>> 21 12 11  2  7  2  1
>>> 12 least connected regions:
>>> 1 5 7 17 19 20 21 30 33 34 45 55 with 1 link
>>> 1 most connected region:
>>> 37 with 8 links
>>>
>>> Weights style: W
>>> Weights constants summary:
>>>  n   nn S0       S1    S2
>>> W 35 1225 35 39.26667 147.3
>>>
>>> I want to get a matrix [56 x 56] to work in excel with it.
>>
>> ?listw2mat should help, then write the matrix in a form that Excel can read. But note that your distance criterion leaves 21 of 56 observations with no neighbours.
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> Thank you in advance.
>>>
>>> Rolando Valdez
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>
> Rolando Valdez
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From Virgilio.Gomez at uclm.es  Tue May  6 00:40:54 2014
From: Virgilio.Gomez at uclm.es (VIRGILIO GOMEZ RUBIO)
Date: Mon, 5 May 2014 22:40:54 +0000
Subject: [R-sig-Geo] BYM model in R-INLA - how to specify priors
 individually
In-Reply-To: <75C8D19A1470D344A8AF5312F01160A602BC2BCC8929@GOMAIL.college.tcd.ie>
References: <75C8D19A1470D344A8AF5312F01160A602BC2BCC8929@GOMAIL.college.tcd.ie>
Message-ID: <1399329652.3461.3.camel@Virgilio-Gomez>

Dear James,

You should be able to set the prior of your random effects using hyper=
in the call to f(). In your particular case, you can try:

#Create areas IDs to match the values in nc.adj
nc.sids$ID<-1:100
nc.sids$ID2<-1:100

hyper.besag <-list(prec=list(prior="loggamma", params=c(.1, .1)))
hyper.iid<-list(prec=list(prior="loggamma", params=c(.001, .001)))

#Besag model with random spatial effect (i.e. BYM model)
m2<-inla(SID74~NWPROP+
   f(nc.sids$ID, model="besag", graph="nc.adj", hyper=hyper.besag)+
   f(nc.sids$ID2, model="iid", hyper=hyper.iid),
 family="poisson", E=nc.sids$EXP, data=as.data.frame(nc.sids),
 control.predictor=list(compute=TRUE))


Note that I have defined two different indices. You can probably use
model="bym" to simplify the formula in your model. Also, run
inla.models()$latent$bym to know the default definitions of priors of
the hyperparameters.

Hope this helps.

Virgilio


From anusheema at gmail.com  Tue May  6 08:37:25 2014
From: anusheema at gmail.com (Anusheema Chakraborty)
Date: Tue, 6 May 2014 12:07:25 +0530
Subject: [R-sig-Geo] Decision tree classification of satellite image in R
Message-ID: <CAH89e5yuQ9k66Ga9FJTYOpGad8T6USEXmSLTA_vq0mdOOS9bzA@mail.gmail.com>

Hi!

I am trying to classify satellite image in R using RWeka classifier,
J48. I have a CSV file with the classes required, and raster data
loaded in R. I am able to make the tree, however, I am not able to use
the same tree to classify my satellite image.

Here's how it goes.

inputfile=read.csv("E://R/Trial/naini.CSV")
m1 <- J48(Class~B1+B2+B3+B4+B5+B7, data = inputfile)
if(require("party", quietly = TRUE)) plot(m1)
raster<- brick("merge.tif")
plotRGB(raster, 4, 3, 2, stretch="hist")

And then I am attempting to use the tree generated to classify my
satellite image, but I keep getting errors.

predict (test_new, J48, filename=out_classify,
progress='text',format='GTiff', datatype='FLT4S', type='response',
overwrite=TRUE)
Error in trim(filename) : error in evaluating the argument 'x' in
selecting a method for function 'trim': Error: object 'out_classify'
not found

And if I change the arguments, this is what I get. I am not sure how
to proceed from this point forward.

predict (J48, test_new, filename=out_classify,
progress='text',format='GTiff', datatype='FLT4S', type='response',
overwrite=TRUE)
Error in UseMethod("predict") : no applicable method for 'predict'
applied to an object of class "c('R_Weka_classifier_interface',
'R_Weka_interface')"

I am new to R, so I might take a while to decipher your answers. Any
help would be greatly appreciated!

Thanks!


Best,
Anusheema.



-- 
Regards

Anusheema Chakraborty
Ph.D. Scholar
Department of Natural Resources, TERI University
10, Institutional Area, Vasant Kunj, New Delhi - 110070
Website: www.teriuniversity.ac.in


From ROONEYJ4 at tcd.ie  Tue May  6 09:08:26 2014
From: ROONEYJ4 at tcd.ie (James Rooney)
Date: Tue, 6 May 2014 08:08:26 +0100
Subject: [R-sig-Geo] BYM model in R-INLA - how to specify priors
 individually
In-Reply-To: <1399329652.3461.3.camel@Virgilio-Gomez>
References: <75C8D19A1470D344A8AF5312F01160A602BC2BCC8929@GOMAIL.college.tcd.ie>,
	<1399329652.3461.3.camel@Virgilio-Gomez>
Message-ID: <75C8D19A1470D344A8AF5312F01160A602BC2BCC892E@GOMAIL.college.tcd.ie>

Dear Virgilio,

Many thanks - yes that is helpful!
However in my own dataset I am finding those values lead to an oversmoothed model - i.e. the output is very uniform - practically flat across all areas. But I know from BUGS smoothing and also from cluster analysis that there should be areas of variation.
What is if that controls the "degree of smoothing" for want of a better term!

Many thanks,
James

________________________________________
From: VIRGILIO GOMEZ RUBIO [Virgilio.Gomez at uclm.es]
Sent: 05 May 2014 23:40
To: James Rooney
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] BYM model in R-INLA - how to specify priors individually

Dear James,

You should be able to set the prior of your random effects using hyper=
in the call to f(). In your particular case, you can try:

#Create areas IDs to match the values in nc.adj
nc.sids$ID<-1:100
nc.sids$ID2<-1:100

hyper.besag <-list(prec=list(prior="loggamma", params=c(.1, .1)))
hyper.iid<-list(prec=list(prior="loggamma", params=c(.001, .001)))

#Besag model with random spatial effect (i.e. BYM model)
m2<-inla(SID74~NWPROP+
   f(nc.sids$ID, model="besag", graph="nc.adj", hyper=hyper.besag)+
   f(nc.sids$ID2, model="iid", hyper=hyper.iid),
 family="poisson", E=nc.sids$EXP, data=as.data.frame(nc.sids),
 control.predictor=list(compute=TRUE))


Note that I have defined two different indices. You can probably use
model="bym" to simplify the formula in your model. Also, run
inla.models()$latent$bym to know the default definitions of priors of
the hyperparameters.

Hope this helps.

Virgilio


From abidi.zineb at gmail.com  Tue May  6 11:10:14 2014
From: abidi.zineb at gmail.com (az14)
Date: Tue, 6 May 2014 02:10:14 -0700 (PDT)
Subject: [R-sig-Geo] lAGRANGE MULTIPLIER Test and error in listw object
Message-ID: <1399367414246-7586372.post@n2.nabble.com>

Dear List, 
I 'm trying to run  the Lagrange multiplier test (LM Test) using R. 
so i import my data file(don) and do an lm regression as bellow: 

don<-read.csv("donnees2.csv",header=TRUE,sep=";",dec=",")widad.lm<-lm(coop~dens_t1+perchom_t1+percvieux_t1+psdc_t1,data=don)
> summary(widad.lm)

Then i import my distance matrix( 1056*1056).


matrice<-read.csv("matw2.csv",header=FALSEE,sep=";",dec=",")
 mat<-do.call(rbind,matrice) 
dim(mat)
is.matrix(mat)
True 
 mat2<-mat%*%mat
> dim(mat2)
[1] 1056 1056
> x <- mat2listw(mat2)
When i run the LM test; with an nb2listw object, i get this error: 

 lm.LMtests(widad.lm,nb2listw(x$neighbours, glist=x$weights,
style="W"),test=c("LMerr","RLMerr"))
Erreur dans subset.listw(listw, subset, zero.policy = zero.policy) : 
  /Not yet able to subset general weights lists
I tryed to do it with mat2listw, but i get error too. 

lm.LMtests(widad.lm, mat2listw(mat2),test=c("LMerr","RLMerr"))
Erreur dans subset.listw(listw, subset, zero.policy = zero.policy) : 
  Not yet able to subset general weights lists


Any help would be appreciated.
Thank you. 
Zineb. 




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/lAGRANGE-MULTIPLIER-Test-and-error-in-listw-object-tp7586372.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alobolistas at gmail.com  Tue May  6 17:33:04 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 6 May 2014 17:33:04 +0200
Subject: [R-sig-Geo] projection of ggmap:get_map() output
In-Reply-To: <CAMLL7bn7gAFE-_etk-brwBQ+63aSjSDD_JrBb2RSVH2xZLAX4g@mail.gmail.com>
References: <15399b6d75f748d28822ecdb366ebd84@EX-0-HT0.lancs.local>
	<CANVKczNLjyBAZ2y7FOvDP+c-ZSwABT_6BWK276uJJy=7MEew4w@mail.gmail.com>
	<CAG4NReLZfUtayt+koJvSZJAK1q_vNJAnJmQ_9GBtOc=X2uGqfw@mail.gmail.com>
	<CAG4NReJz-eq6GcGm=cQrMikz9VnhSu=HdpOyQHmB9PUK3e=Xpg@mail.gmail.com>
	<5358C986.9080309@uni-muenster.de>
	<345780f75d2045169a2f656dd4fca6a9@EX-0-HT0.lancs.local>
	<CANVKczMKm4JqLbJ-bvJsEiGc+MdmLf7Fvzgc7NtebODOcRvY9g@mail.gmail.com>
	<53595125.60606@uni-muenster.de>
	<CAMLL7bn87AhW-v=C5yhEZJ7ANVMRQUhg2LDtFgPBGLJu6XKXTA@mail.gmail.com>
	<CAG4NReLf4Xg5-SvJgemMxhif=6-fnm_n6842ofvV27W0Y3R7Ug@mail.gmail.com>
	<CAG4NReLXPL7H39SjX=7v3DgH0WMz757VLyTZ_=fTH6zGvHfywg@mail.gmail.com>
	<CAMLL7bkemZSdiDxjf=X=02K65OAvQkh8Tu-_QE42iKaZ+YkMOA@mail.gmail.com>
	<CAG4NReJg+Av678gvt6isyfLiVfZ7apprx77xKfOi00HONdxjqw@mail.gmail.com>
	<CAMLL7bn7gAFE-_etk-brwBQ+63aSjSDD_JrBb2RSVH2xZLAX4g@mail.gmail.com>
Message-ID: <CAG4NReJ9bN42y+1e6xW1iCaDCQWpR0Egjn9HaQD6GVDZGZK2bA@mail.gmail.com>

I think I've clarified this question here:
http://rpubs.com/alobo/getmapCRS

In short, we can get exact positioning of both layers with
* plot(r); plot(v, add=TRUE)
* spplot() + layer() and
* levelplot() + layer()
but we must be careful of CRS details.

Please send comments and corrections.
Agus

On Tue, Apr 29, 2014 at 11:40 AM, Oscar Perpi?an <oscar.perpinan at upm.es> wrote:
>>> I couldn't run your code because I am not able to read the file.
>> Note dsn is the directory where you have the 4 files and layer is the
>> name of the layer, which is the name of the files without extension.
>
> My fault, sorry.
>
>> There has to be a reprojection on the fly because the the two layers of
>> the plot are on different coordinate systems. I think it is clear now that
>> ggplot uses the Google "PseudoMercator" for the matrix while expects
>> all user input on epsg4326
>
> I am not sure what do you mean with "reprojection on the fly" but
> "layer" does not make any reprojection.
> In fact, it is only a wrapper around
> "eval(substitute(expression(...)))" to modify easily the panel
> function of a trellis graphic.
> However, in my code I am using "grid.raster" with its arguments width,
> height, x and y, to resize the ggmap raster and to position it in the
> graphic window created with spplot.
>
>> I think "acceptable" depends on the scale only. At coarser scale you
>> just do not see the error
>> because it is relative to the extent and the result converges to the
>> correct  reprojection.
>
> I think it depends on the extent. I have tested the code again with
> the administrative boundaries of Spain and some of its regions
> (http://biogeo.ucdavis.edu/data/gadm2/shp/ESP_adm.zip).
> It fails for the country extent (as Edzer suggested and you have found
> with your file) but it works correctly for a smaller extent (code
> copied below).
>
>> In the code you provide, how do you know NAD27 is the appropriate datum?
>> There is no prj file (one of the big shortcomings of shapefiles is
>> that the presence
>> of crs information in the form of a prj file is not compulsory). Note
>> that you define
>> a datum != WGS84 and you do not define the towgs argument.
>
> It is an example extracted from the p.121 of the 2008 edition of
> "Applied Spatial Data Analysis with R". That chapter is now available
> here: http://cran.r-project.org/web/packages/maptools/vignettes/combine_maptools.pdf
>
> Best,
>
> Oscar.
>
> #######################################################
> library(ggmap)
> library(latticeExtra)
> library(sp)
> library(maptools)
>
> ## http://biogeo.ucdavis.edu/data/gadm2/shp/ESP_adm.zip
> setwd('/tmp')
> spain <- readShapePoly('ESP_adm/ESP_adm1')
> proj4string(spain) <- CRS("+proj=longlat +datum=WGS84")
>
> andalucia <- spain[spain$ID_1 == 1,]
> catalonia <- spain[spain$ID_1 == 6,]
>
> ## myPoly <- spain
> myPoly <- andalucia
> ## myPoly <- catalonia
>
> bbPoly <- bbox(myPoly)
> gmap <- get_map(c(bbPoly), maptype='watercolor', source='stamen', crop=FALSE)
> bbMap <- attr(gmap, 'bb')
> latCenter <- with(bbMap, ll.lat + ur.lat)/2
> lonCenter <- with(bbMap, ll.lon + ur.lon)/2
> height <- with(bbMap, ur.lat - ll.lat)
> width <- with(bbMap, ur.lon - ll.lon)
>
> spplot(myPoly["ID_1"], fill='transparent') +
>                   layer(grid.raster(gmap,
>                                     x=lonCenter, y=latCenter,
>                                     width=width, height=height,
>                                     default.units='native'),
>                         under=TRUE)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jgrn at illinois.edu  Tue May  6 17:52:57 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 6 May 2014 10:52:57 -0500
Subject: [R-sig-Geo] Decision tree classification of satellite image in R
In-Reply-To: <CAH89e5yuQ9k66Ga9FJTYOpGad8T6USEXmSLTA_vq0mdOOS9bzA@mail.gmail.com>
References: <CAH89e5yuQ9k66Ga9FJTYOpGad8T6USEXmSLTA_vq0mdOOS9bzA@mail.gmail.com>
Message-ID: <CABG0rftT4b9cVkM+eO9T5wEdYcJjPmESSDLWe2Q8LN8AVUFQ3g@mail.gmail.com>

Anusheema:

The first error is because you didn't specify an out filename (it
needs to be a character).

Re: the second error -- is there a predict.R_Weka_classifier_interface
(or something along those lines) in that package?  For predict to
work, you need a predict.* statement available.

You might want to swap in a randomForest for the classifier you are
using, at least to begin with -- randomForest does work properly with
raster's predict() statement.

--j

On Tue, May 6, 2014 at 1:37 AM, Anusheema Chakraborty
<anusheema at gmail.com> wrote:
> Hi!
>
> I am trying to classify satellite image in R using RWeka classifier,
> J48. I have a CSV file with the classes required, and raster data
> loaded in R. I am able to make the tree, however, I am not able to use
> the same tree to classify my satellite image.
>
> Here's how it goes.
>
> inputfile=read.csv("E://R/Trial/naini.CSV")
> m1 <- J48(Class~B1+B2+B3+B4+B5+B7, data = inputfile)
> if(require("party", quietly = TRUE)) plot(m1)
> raster<- brick("merge.tif")
> plotRGB(raster, 4, 3, 2, stretch="hist")
>
> And then I am attempting to use the tree generated to classify my
> satellite image, but I keep getting errors.
>
> predict (test_new, J48, filename=out_classify,
> progress='text',format='GTiff', datatype='FLT4S', type='response',
> overwrite=TRUE)
> Error in trim(filename) : error in evaluating the argument 'x' in
> selecting a method for function 'trim': Error: object 'out_classify'
> not found
>
> And if I change the arguments, this is what I get. I am not sure how
> to proceed from this point forward.
>
> predict (J48, test_new, filename=out_classify,
> progress='text',format='GTiff', datatype='FLT4S', type='response',
> overwrite=TRUE)
> Error in UseMethod("predict") : no applicable method for 'predict'
> applied to an object of class "c('R_Weka_classifier_interface',
> 'R_Weka_interface')"
>
> I am new to R, so I might take a while to decipher your answers. Any
> help would be greatly appreciated!
>
> Thanks!
>
>
> Best,
> Anusheema.
>
>
>
> --
> Regards
>
> Anusheema Chakraborty
> Ph.D. Scholar
> Department of Natural Resources, TERI University
> 10, Institutional Area, Vasant Kunj, New Delhi - 110070
> Website: www.teriuniversity.ac.in
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From aguitatierra at hotmail.com  Tue May  6 17:59:22 2014
From: aguitatierra at hotmail.com (Bea GD)
Date: Tue, 6 May 2014 17:59:22 +0200
Subject: [R-sig-Geo] Aspect data interpretation
Message-ID: <BLU436-SMTP2370E424D2B6D853642FF01D94F0@phx.gbl>

Hi all,

This is a bit general question. I've searched the web but I haven't 
gotten a consistent answer.

I've used a digital elevation model to produce another raster with 
aspect data by using 'terrain{rater}'.
Aspect data ranges from 0 to 360 degrees. In the vignette of the raster 
package it also says:
'If slope = 0, aspect is set to 0.5*pi radians (or 90 degrees if 
unit=?degrees?)'

Could anyone help me to interpret the aspect data?

Many thanks for your help.


From edzer.pebesma at uni-muenster.de  Tue May  6 18:02:00 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 06 May 2014 18:02:00 +0200
Subject: [R-sig-Geo] projection of ggmap:get_map() output
In-Reply-To: <CAG4NReJ9bN42y+1e6xW1iCaDCQWpR0Egjn9HaQD6GVDZGZK2bA@mail.gmail.com>
References: <15399b6d75f748d28822ecdb366ebd84@EX-0-HT0.lancs.local>	<CANVKczNLjyBAZ2y7FOvDP+c-ZSwABT_6BWK276uJJy=7MEew4w@mail.gmail.com>	<CAG4NReLZfUtayt+koJvSZJAK1q_vNJAnJmQ_9GBtOc=X2uGqfw@mail.gmail.com>	<CAG4NReJz-eq6GcGm=cQrMikz9VnhSu=HdpOyQHmB9PUK3e=Xpg@mail.gmail.com>	<5358C986.9080309@uni-muenster.de>	<345780f75d2045169a2f656dd4fca6a9@EX-0-HT0.lancs.local>	<CANVKczMKm4JqLbJ-bvJsEiGc+MdmLf7Fvzgc7NtebODOcRvY9g@mail.gmail.com>	<53595125.60606@uni-muenster.de>	<CAMLL7bn87AhW-v=C5yhEZJ7ANVMRQUhg2LDtFgPBGLJu6XKXTA@mail.gmail.com>	<CAG4NReLf4Xg5-SvJgemMxhif=6-fnm_n6842ofvV27W0Y3R7Ug@mail.gmail.com>	<CAG4NReLXPL7H39SjX=7v3DgH0WMz757VLyTZ_=fTH6zGvHfywg@mail.gmail.com>	<CAMLL7bkemZSdiDxjf=X=02K65OAvQkh8Tu-_QE42iKaZ+YkMOA@mail.gmail.com>	<CAG4NReJg+Av678gvt6isyfLiVfZ7apprx77xKfOi00HONdxjqw@mail.gmail.com>	<CAMLL7bn7gAFE-_etk-brwBQ+63aSjSDD_JrBb2RSVH2xZLAX4g@mail.gmail.com>
	<CAG4NReJ9bN42y+1e6xW1iCaDCQWpR0Egjn9HaQD6GVDZGZK2bA@mail.gmail.com>
Message-ID: <53690778.1060002@uni-muenster.de>



On 05/06/2014 05:33 PM, Agustin Lobo wrote:
> I think I've clarified this question here:
> http://rpubs.com/alobo/getmapCRS
> 
> In short, we can get exact positioning of both layers with
> * plot(r); plot(v, add=TRUE)
> * spplot() + layer() and
> * levelplot() + layer()
> but we must be careful of CRS details.
> 
> Please send comments and corrections.

Useful!

These rpubs read nicely, but are very discouraging to try a rerun. Did
you upload the R-markdown file somewhere?

Anyway, I cannot see how the script can run when levelplot is called
before lattice is loaded, and also the "+" and layer() come, I believe
from latticeExtra which has not been loaded up to that point (2.2).

Does the "+" operator in

levelplot() + layer()

or

spplot() + layer()

check correspondence of the proj4string of the operands on both sides of
the + , can it be made to do so, or do we have remember your conclusions?

> Agus
> 
> On Tue, Apr 29, 2014 at 11:40 AM, Oscar Perpi?an <oscar.perpinan at upm.es> wrote:
>>>> I couldn't run your code because I am not able to read the file.
>>> Note dsn is the directory where you have the 4 files and layer is the
>>> name of the layer, which is the name of the files without extension.
>>
>> My fault, sorry.
>>
>>> There has to be a reprojection on the fly because the the two layers of
>>> the plot are on different coordinate systems. I think it is clear now that
>>> ggplot uses the Google "PseudoMercator" for the matrix while expects
>>> all user input on epsg4326
>>
>> I am not sure what do you mean with "reprojection on the fly" but
>> "layer" does not make any reprojection.
>> In fact, it is only a wrapper around
>> "eval(substitute(expression(...)))" to modify easily the panel
>> function of a trellis graphic.
>> However, in my code I am using "grid.raster" with its arguments width,
>> height, x and y, to resize the ggmap raster and to position it in the
>> graphic window created with spplot.
>>
>>> I think "acceptable" depends on the scale only. At coarser scale you
>>> just do not see the error
>>> because it is relative to the extent and the result converges to the
>>> correct  reprojection.
>>
>> I think it depends on the extent. I have tested the code again with
>> the administrative boundaries of Spain and some of its regions
>> (http://biogeo.ucdavis.edu/data/gadm2/shp/ESP_adm.zip).
>> It fails for the country extent (as Edzer suggested and you have found
>> with your file) but it works correctly for a smaller extent (code
>> copied below).
>>
>>> In the code you provide, how do you know NAD27 is the appropriate datum?
>>> There is no prj file (one of the big shortcomings of shapefiles is
>>> that the presence
>>> of crs information in the form of a prj file is not compulsory). Note
>>> that you define
>>> a datum != WGS84 and you do not define the towgs argument.
>>
>> It is an example extracted from the p.121 of the 2008 edition of
>> "Applied Spatial Data Analysis with R". That chapter is now available
>> here: http://cran.r-project.org/web/packages/maptools/vignettes/combine_maptools.pdf
>>
>> Best,
>>
>> Oscar.
>>
>> #######################################################
>> library(ggmap)
>> library(latticeExtra)
>> library(sp)
>> library(maptools)
>>
>> ## http://biogeo.ucdavis.edu/data/gadm2/shp/ESP_adm.zip
>> setwd('/tmp')
>> spain <- readShapePoly('ESP_adm/ESP_adm1')
>> proj4string(spain) <- CRS("+proj=longlat +datum=WGS84")
>>
>> andalucia <- spain[spain$ID_1 == 1,]
>> catalonia <- spain[spain$ID_1 == 6,]
>>
>> ## myPoly <- spain
>> myPoly <- andalucia
>> ## myPoly <- catalonia
>>
>> bbPoly <- bbox(myPoly)
>> gmap <- get_map(c(bbPoly), maptype='watercolor', source='stamen', crop=FALSE)
>> bbMap <- attr(gmap, 'bb')
>> latCenter <- with(bbMap, ll.lat + ur.lat)/2
>> lonCenter <- with(bbMap, ll.lon + ur.lon)/2
>> height <- with(bbMap, ur.lat - ll.lat)
>> width <- with(bbMap, ur.lon - ll.lon)
>>
>> spplot(myPoly["ID_1"], fill='transparent') +
>>                   layer(grid.raster(gmap,
>>                                     x=lonCenter, y=latCenter,
>>                                     width=width, height=height,
>>                                     default.units='native'),
>>                         under=TRUE)
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140506/7ede7b12/attachment.bin>

From tea3rd at gmail.com  Tue May  6 18:25:25 2014
From: tea3rd at gmail.com (Thomas Adams)
Date: Tue, 6 May 2014 12:25:25 -0400
Subject: [R-sig-Geo] Aspect data interpretation
In-Reply-To: <BLU436-SMTP2370E424D2B6D853642FF01D94F0@phx.gbl>
References: <BLU436-SMTP2370E424D2B6D853642FF01D94F0@phx.gbl>
Message-ID: <CAGxgkWijzS=fDDESJ4XcfejhKKECOnvwN+jWCqRJ9fMR8N1h5w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140506/3fadf2fa/attachment.pl>

From aguitatierra at hotmail.com  Tue May  6 19:34:25 2014
From: aguitatierra at hotmail.com (=?Windows-1252?B?QmVhdHJpeiBHb2564WxleiBEb23tbmd1ZXo=?=)
Date: Tue, 6 May 2014 18:34:25 +0100
Subject: [R-sig-Geo] Aspect data interpretation
In-Reply-To: <CAGxgkWijzS=fDDESJ4XcfejhKKECOnvwN+jWCqRJ9fMR8N1h5w@mail.gmail.com>
References: <BLU436-SMTP2370E424D2B6D853642FF01D94F0@phx.gbl>,
	<CAGxgkWijzS=fDDESJ4XcfejhKKECOnvwN+jWCqRJ9fMR8N1h5w@mail.gmail.com>
Message-ID: <DUB131-W21CAF6CC67677914CB4151D94F0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140506/7b53f2d2/attachment.pl>

From tea3rd at gmail.com  Tue May  6 19:59:28 2014
From: tea3rd at gmail.com (Thomas Adams)
Date: Tue, 6 May 2014 13:59:28 -0400
Subject: [R-sig-Geo] Aspect data interpretation
In-Reply-To: <DUB131-W21CAF6CC67677914CB4151D94F0@phx.gbl>
References: <BLU436-SMTP2370E424D2B6D853642FF01D94F0@phx.gbl>
	<CAGxgkWijzS=fDDESJ4XcfejhKKECOnvwN+jWCqRJ9fMR8N1h5w@mail.gmail.com>
	<DUB131-W21CAF6CC67677914CB4151D94F0@phx.gbl>
Message-ID: <CAGxgkWj=UiCyLc23qHfkdbhniXd=ssWihFnVU438_qN=9noN3A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140506/c3883389/attachment.pl>

From aguitatierra at hotmail.com  Tue May  6 20:25:35 2014
From: aguitatierra at hotmail.com (=?Windows-1252?B?QmVhdHJpeiBHb2564WxleiBEb23tbmd1ZXo=?=)
Date: Tue, 6 May 2014 19:25:35 +0100
Subject: [R-sig-Geo] Aspect data interpretation
In-Reply-To: <CAGxgkWj=UiCyLc23qHfkdbhniXd=ssWihFnVU438_qN=9noN3A@mail.gmail.com>
References: <BLU436-SMTP2370E424D2B6D853642FF01D94F0@phx.gbl>,
	<CAGxgkWijzS=fDDESJ4XcfejhKKECOnvwN+jWCqRJ9fMR8N1h5w@mail.gmail.com>,
	<DUB131-W21CAF6CC67677914CB4151D94F0@phx.gbl>,
	<CAGxgkWj=UiCyLc23qHfkdbhniXd=ssWihFnVU438_qN=9noN3A@mail.gmail.com>
Message-ID: <DUB131-W82AF275D25DC55FB9D96FCD94F0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140506/56035d8f/attachment.pl>

From anusheema at gmail.com  Wed May  7 06:32:46 2014
From: anusheema at gmail.com (Anusheema Chakraborty)
Date: Wed, 7 May 2014 10:02:46 +0530
Subject: [R-sig-Geo] Decision tree classification of satellite image in R
In-Reply-To: <CABG0rftT4b9cVkM+eO9T5wEdYcJjPmESSDLWe2Q8LN8AVUFQ3g@mail.gmail.com>
References: <CAH89e5yuQ9k66Ga9FJTYOpGad8T6USEXmSLTA_vq0mdOOS9bzA@mail.gmail.com>
	<CABG0rftT4b9cVkM+eO9T5wEdYcJjPmESSDLWe2Q8LN8AVUFQ3g@mail.gmail.com>
Message-ID: <CAH89e5xKFRE1suMCFH3wpCCSGeLpQFv4tVbeDZ+iE=9ocu_0Nw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/ae1e6a45/attachment.pl>

From nevil.amos at gmail.com  Wed May  7 06:50:58 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Wed, 7 May 2014 14:50:58 +1000
Subject: [R-sig-Geo] Combine two rasters combining attributes ( or at
 least values of each)?
In-Reply-To: <CABG0rfvh6xHoPrhpg5j6AALgzFeTdSO=6OLOUbKm9b374ieyXQ@mail.gmail.com>
References: <CAN9eD7=zFvF+xXtmCdPRpAoP1tM13HynmMc6_WOuC965FXUpCg@mail.gmail.com>
	<CABG0rfvh6xHoPrhpg5j6AALgzFeTdSO=6OLOUbKm9b374ieyXQ@mail.gmail.com>
Message-ID: <CAN9eD7mcQqNuzud9EZiM_Z0P4kD=6sFSr7qUfOh1H_-WmMkc=g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/6e158394/attachment.pl>

From ndugarsuren at gmail.com  Wed May  7 11:51:16 2014
From: ndugarsuren at gmail.com (Bandrush Barda)
Date: Wed, 7 May 2014 02:51:16 -0700 (PDT)
Subject: [R-sig-Geo] What does the error "ERROR in .calcTest(x[1:5], fun,
 na.rm, forcefun, forceapply): cannot use this function" mean in R?
Message-ID: <1399456276920-7586384.post@n2.nabble.com>

I have a problem with lowess function to predict NDVI as a function of time
by polynomial regression in R. NDVI image is 8-day image from Apr to Oct in
Julian date of 97 to 297. Here is the scripts I run:
 
#Created a time vector to act as x
time<-sort(sample(97:297, nlayers(ndvi2000crop1)))

#locally-weighted polynomial regression of ndvi ~ time
t.lowess <- function(x,...) { if (is.na(x[1])) {NA} else {lowess(x,y,...)$y
} } 
f.pred <- calc(ndvi2000crop1, t.lowess)

When I calculate the function on image by doing the last step of this code,
an error appeared something like this "Error in .calcTest(x[1:5], fun,
na.rm, forcefun, forceapply): cannot use this function". Can you tell me
where this error comes from and how to solve it? 

Thank you




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/What-does-the-error-ERROR-in-calcTest-x-1-5-fun-na-rm-forcefun-forceapply-cannot-use-this-function-m-tp7586384.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alobolistas at gmail.com  Wed May  7 12:18:35 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 7 May 2014 12:18:35 +0200
Subject: [R-sig-Geo] projection of ggmap:get_map() output
In-Reply-To: <53690778.1060002@uni-muenster.de>
References: <15399b6d75f748d28822ecdb366ebd84@EX-0-HT0.lancs.local>
	<CANVKczNLjyBAZ2y7FOvDP+c-ZSwABT_6BWK276uJJy=7MEew4w@mail.gmail.com>
	<CAG4NReLZfUtayt+koJvSZJAK1q_vNJAnJmQ_9GBtOc=X2uGqfw@mail.gmail.com>
	<CAG4NReJz-eq6GcGm=cQrMikz9VnhSu=HdpOyQHmB9PUK3e=Xpg@mail.gmail.com>
	<5358C986.9080309@uni-muenster.de>
	<345780f75d2045169a2f656dd4fca6a9@EX-0-HT0.lancs.local>
	<CANVKczMKm4JqLbJ-bvJsEiGc+MdmLf7Fvzgc7NtebODOcRvY9g@mail.gmail.com>
	<53595125.60606@uni-muenster.de>
	<CAMLL7bn87AhW-v=C5yhEZJ7ANVMRQUhg2LDtFgPBGLJu6XKXTA@mail.gmail.com>
	<CAG4NReLf4Xg5-SvJgemMxhif=6-fnm_n6842ofvV27W0Y3R7Ug@mail.gmail.com>
	<CAG4NReLXPL7H39SjX=7v3DgH0WMz757VLyTZ_=fTH6zGvHfywg@mail.gmail.com>
	<CAMLL7bkemZSdiDxjf=X=02K65OAvQkh8Tu-_QE42iKaZ+YkMOA@mail.gmail.com>
	<CAG4NReJg+Av678gvt6isyfLiVfZ7apprx77xKfOi00HONdxjqw@mail.gmail.com>
	<CAMLL7bn7gAFE-_etk-brwBQ+63aSjSDD_JrBb2RSVH2xZLAX4g@mail.gmail.com>
	<CAG4NReJ9bN42y+1e6xW1iCaDCQWpR0Egjn9HaQD6GVDZGZK2bA@mail.gmail.com>
	<53690778.1060002@uni-muenster.de>
Message-ID: <CAG4NRe+qash+VXwNmmX8e=Qr-NA02zoVxGhPbogBfZ-GeFQA0w@mail.gmail.com>

Edzer,

Thanks for the corrections. I had moved chunks and left loading the
packages in the wrong place.
It is correct now. Also, I've included a link to a file with just R
code and the link to the vector shapefile.

As far as I can tell, "levelplot() + layer()"
or "spplot() + layer()"
do not check correspondence of the proj4string of the operands on both sides of
the +. Actually, both commands totally ignore any CRS information.
This is why we've got into this mess
and must be aware of providing consistent layers.

Agus

On Tue, May 6, 2014 at 6:02 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
>
>
> On 05/06/2014 05:33 PM, Agustin Lobo wrote:
>> I think I've clarified this question here:
>> http://rpubs.com/alobo/getmapCRS
>>
>> In short, we can get exact positioning of both layers with
>> * plot(r); plot(v, add=TRUE)
>> * spplot() + layer() and
>> * levelplot() + layer()
>> but we must be careful of CRS details.
>>
>> Please send comments and corrections.
>
> Useful!
>
> These rpubs read nicely, but are very discouraging to try a rerun. Did
> you upload the R-markdown file somewhere?
>
> Anyway, I cannot see how the script can run when levelplot is called
> before lattice is loaded, and also the "+" and layer() come, I believe
> from latticeExtra which has not been loaded up to that point (2.2).
>
> Does the "+" operator in
>
> levelplot() + layer()
>
> or
>
> spplot() + layer()
>
> check correspondence of the proj4string of the operands on both sides of
> the + , can it be made to do so, or do we have remember your conclusions?
>
>> Agus
>>
>> On Tue, Apr 29, 2014 at 11:40 AM, Oscar Perpi?an <oscar.perpinan at upm.es> wrote:
>>>>> I couldn't run your code because I am not able to read the file.
>>>> Note dsn is the directory where you have the 4 files and layer is the
>>>> name of the layer, which is the name of the files without extension.
>>>
>>> My fault, sorry.
>>>
>>>> There has to be a reprojection on the fly because the the two layers of
>>>> the plot are on different coordinate systems. I think it is clear now that
>>>> ggplot uses the Google "PseudoMercator" for the matrix while expects
>>>> all user input on epsg4326
>>>
>>> I am not sure what do you mean with "reprojection on the fly" but
>>> "layer" does not make any reprojection.
>>> In fact, it is only a wrapper around
>>> "eval(substitute(expression(...)))" to modify easily the panel
>>> function of a trellis graphic.
>>> However, in my code I am using "grid.raster" with its arguments width,
>>> height, x and y, to resize the ggmap raster and to position it in the
>>> graphic window created with spplot.
>>>
>>>> I think "acceptable" depends on the scale only. At coarser scale you
>>>> just do not see the error
>>>> because it is relative to the extent and the result converges to the
>>>> correct  reprojection.
>>>
>>> I think it depends on the extent. I have tested the code again with
>>> the administrative boundaries of Spain and some of its regions
>>> (http://biogeo.ucdavis.edu/data/gadm2/shp/ESP_adm.zip).
>>> It fails for the country extent (as Edzer suggested and you have found
>>> with your file) but it works correctly for a smaller extent (code
>>> copied below).
>>>
>>>> In the code you provide, how do you know NAD27 is the appropriate datum?
>>>> There is no prj file (one of the big shortcomings of shapefiles is
>>>> that the presence
>>>> of crs information in the form of a prj file is not compulsory). Note
>>>> that you define
>>>> a datum != WGS84 and you do not define the towgs argument.
>>>
>>> It is an example extracted from the p.121 of the 2008 edition of
>>> "Applied Spatial Data Analysis with R". That chapter is now available
>>> here: http://cran.r-project.org/web/packages/maptools/vignettes/combine_maptools.pdf
>>>
>>> Best,
>>>
>>> Oscar.
>>>
>>> #######################################################
>>> library(ggmap)
>>> library(latticeExtra)
>>> library(sp)
>>> library(maptools)
>>>
>>> ## http://biogeo.ucdavis.edu/data/gadm2/shp/ESP_adm.zip
>>> setwd('/tmp')
>>> spain <- readShapePoly('ESP_adm/ESP_adm1')
>>> proj4string(spain) <- CRS("+proj=longlat +datum=WGS84")
>>>
>>> andalucia <- spain[spain$ID_1 == 1,]
>>> catalonia <- spain[spain$ID_1 == 6,]
>>>
>>> ## myPoly <- spain
>>> myPoly <- andalucia
>>> ## myPoly <- catalonia
>>>
>>> bbPoly <- bbox(myPoly)
>>> gmap <- get_map(c(bbPoly), maptype='watercolor', source='stamen', crop=FALSE)
>>> bbMap <- attr(gmap, 'bb')
>>> latCenter <- with(bbMap, ll.lat + ur.lat)/2
>>> lonCenter <- with(bbMap, ll.lon + ur.lon)/2
>>> height <- with(bbMap, ur.lat - ll.lat)
>>> width <- with(bbMap, ur.lon - ll.lon)
>>>
>>> spplot(myPoly["ID_1"], fill='transparent') +
>>>                   layer(grid.raster(gmap,
>>>                                     x=lonCenter, y=latCenter,
>>>                                     width=width, height=height,
>>>                                     default.units='native'),
>>>                         under=TRUE)
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Wed May  7 13:21:41 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 7 May 2014 13:21:41 +0200
Subject: [R-sig-Geo] readOGR() with remote folders
Message-ID: <CAG4NReJmwMRT5ZenPGDOc_pp+AsdDgH3j9kPtf4Wks17uRegQA@mail.gmail.com>

Does anyone know if readOGR() can be used with remote files on remote folders?
The following does not work for me:
NWEur <- readOGR(dsn="http://www.wuala.com/aloboa/NWEur",layer="NWEur",stringsAsFactors=FALSE)
Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding,
use_iconv = use_iconv) :
  Cannot open file

(note that you can paste the url into your browser and works and that
there is no https)

But actually even this example from
https://personality-project.org/r/r.guide.html
does not work for me:

datafilename <-
"http://personality-project.org/r/datasets/Maps.mixx.msq1.epi.bf.txt"
person.data  <- read.table(datafilename,header=TRUE)
Error in file(file, "rt") : cannot open the connection

I also need to specify method="curl" to get download.fiel()  to work:
download.file("https://dl.dropboxusercontent.com/u/3180464/NWEur.zip","NWEur.zip",method="curl")

so I do not know if I have an idiosynchratic web security ward or I'm
just not doing things right

Thanks
Agus


From b.rowlingson at lancaster.ac.uk  Wed May  7 13:58:23 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 7 May 2014 12:58:23 +0100
Subject: [R-sig-Geo] readOGR() with remote folders
In-Reply-To: <8d4d1214949b4c8aae4170feb591042f@EX-0-HT0.lancs.local>
References: <8d4d1214949b4c8aae4170feb591042f@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNYVdrJi3_k1wNvCN3owKgTTrLfDEbxijzdVCxRj2Uj1Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/919787aa/attachment.pl>

From oscar.perpinan at upm.es  Wed May  7 14:07:44 2014
From: oscar.perpinan at upm.es (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Wed, 7 May 2014 14:07:44 +0200
Subject: [R-sig-Geo] projection of ggmap:get_map() output
In-Reply-To: <CAG4NRe+qash+VXwNmmX8e=Qr-NA02zoVxGhPbogBfZ-GeFQA0w@mail.gmail.com>
References: <15399b6d75f748d28822ecdb366ebd84@EX-0-HT0.lancs.local>
	<CANVKczNLjyBAZ2y7FOvDP+c-ZSwABT_6BWK276uJJy=7MEew4w@mail.gmail.com>
	<CAG4NReLZfUtayt+koJvSZJAK1q_vNJAnJmQ_9GBtOc=X2uGqfw@mail.gmail.com>
	<CAG4NReJz-eq6GcGm=cQrMikz9VnhSu=HdpOyQHmB9PUK3e=Xpg@mail.gmail.com>
	<5358C986.9080309@uni-muenster.de>
	<345780f75d2045169a2f656dd4fca6a9@EX-0-HT0.lancs.local>
	<CANVKczMKm4JqLbJ-bvJsEiGc+MdmLf7Fvzgc7NtebODOcRvY9g@mail.gmail.com>
	<53595125.60606@uni-muenster.de>
	<CAMLL7bn87AhW-v=C5yhEZJ7ANVMRQUhg2LDtFgPBGLJu6XKXTA@mail.gmail.com>
	<CAG4NReLf4Xg5-SvJgemMxhif=6-fnm_n6842ofvV27W0Y3R7Ug@mail.gmail.com>
	<CAG4NReLXPL7H39SjX=7v3DgH0WMz757VLyTZ_=fTH6zGvHfywg@mail.gmail.com>
	<CAMLL7bkemZSdiDxjf=X=02K65OAvQkh8Tu-_QE42iKaZ+YkMOA@mail.gmail.com>
	<CAG4NReJg+Av678gvt6isyfLiVfZ7apprx77xKfOi00HONdxjqw@mail.gmail.com>
	<CAMLL7bn7gAFE-_etk-brwBQ+63aSjSDD_JrBb2RSVH2xZLAX4g@mail.gmail.com>
	<CAG4NReJ9bN42y+1e6xW1iCaDCQWpR0Egjn9HaQD6GVDZGZK2bA@mail.gmail.com>
	<53690778.1060002@uni-muenster.de>
	<CAG4NRe+qash+VXwNmmX8e=Qr-NA02zoVxGhPbogBfZ-GeFQA0w@mail.gmail.com>
Message-ID: <CAMLL7bm25PS1pMhjQYbuxL=7d7TYgkmNOEx-2XM8uk5dSuDkRA@mail.gmail.com>

Hi,

> As far as I can tell, "levelplot() + layer()"
> or "spplot() + layer()"
> do not check correspondence of the proj4string of the operands on both sides of
> the +. Actually, both commands totally ignore any CRS information.
> This is why we've got into this mess and must be aware of providing consistent layers.

"layer" and "+.trellis" are functions of the latticeExtra package that
modify the panel function of a trellis graphic, for example, the ones
produced by spplot or rasterVis::levelplot. Of course, they don't know
anything about projections. They only display the graphical result of
another function.

Note that "+ layer()" is equivalent to "sp.layout" or modifying
directly the panel function. Some code to explain it better:

library(sp)
library(lattice)
library(latticeExtra)

data(meuse)
coordinates(meuse) <- ~x+y

## These three methods produce the same result:

## Standard lattice method: modification of the panel function
spplot(meuse["ffreq"], panel=function(...){
    panel.pointsplot(...)
    sp.text(c(180500, 329900), 'Meuse')
})

## sp.layout method
l1 <- list("sp.text", c(180500, 329900), 'Meuse')
spplot(meuse["ffreq"], sp.layout=list(l1))

## latticeExtra method: +.trellis and layer
spplot(meuse["ffreq"]) + layer(sp.text(c(180500, 329900), 'Meuse'))

These three methods do not use CRS information. Review the first
example of the spplot help page and you will find that the components
of the sp.layout do not use CRS information. It is the user's
responsibility to make correct use of the corresponding functions.

On the other hand, you can use +.trellis without layer to combine two
trellis objects. For example, levelplot + spplot, or spplot + spplot,
etc. Therefore, in section 2.3 of your RPubs, when you say that
"layer() does not work with raster layers, therefore cannot use the
rgmaprgbGM object.", you can try this:

levelplot(rgmaprgbGM[[3]], margin = FALSE, par.settings = GrTheme) +
spplot(NWEurGM, zcol = "NAME", fill = "transparent", col = "yellow",
xlim = c(extent(rgmaprgbGM)@xmin, extent(rgmaprgbGM)@xmax), ylim =
c(extent(rgmaprgbGM)@ymin, extent(rgmaprgbGM)@ymax),
    colorkey = FALSE)

Best,

Oscar.


From amonleong at wanadoo.es  Wed May  7 14:47:14 2014
From: amonleong at wanadoo.es (Toni Monleon)
Date: Wed, 7 May 2014 14:47:14 +0200
Subject: [R-sig-Geo] =?utf-8?q?Geostatistical_Space=E2=80=93Time_Model?=
Message-ID: <CAFFKpM08V+0i6AAhQNEn5v9t7hSY=7LBTO2nZEN67br9XTPRzw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/7c477a74/attachment.pl>

From 15201514761 at 163.com  Wed May  7 15:04:29 2014
From: 15201514761 at 163.com (=?GBK?B?zMa5+se/?=)
Date: Wed, 7 May 2014 21:04:29 +0800 (CST)
Subject: [R-sig-Geo] How to export the result of krige.conv;
Message-ID: <43543e94.124c2.145d6c9035f.Coremail.15201514761@163.com>

Dear Paulo J. Ribeiro and Peter J. Diggle:
I used "krige.conv" to do Krige interplation in a region. But I have difficulties in export the results.I find some codes on a website https://stat.ethz.ch/pipermail/r-sig-geo/2009-July/006167.html. But I can't get it run and I can't understand it probably because the codes lose some information.
Attachtment is my code. What I want to know is how to export the result of krige.conv to .asc  .xlsx or some others file.
Thank you!


Guoqiang Tang

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/71ff4709/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: VarEst.zip
Type: application/x-zip-compressed
Size: 7062 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/71ff4709/attachment.bin>

From oscar.perpinan at upm.es  Wed May  7 15:36:48 2014
From: oscar.perpinan at upm.es (=?UTF-8?Q?Oscar_Perpi=C3=B1an?=)
Date: Wed, 7 May 2014 15:36:48 +0200
Subject: [R-sig-Geo] projection of ggmap:get_map() output
In-Reply-To: <CAG4NRe+qash+VXwNmmX8e=Qr-NA02zoVxGhPbogBfZ-GeFQA0w@mail.gmail.com>
References: <15399b6d75f748d28822ecdb366ebd84@EX-0-HT0.lancs.local>
	<CANVKczNLjyBAZ2y7FOvDP+c-ZSwABT_6BWK276uJJy=7MEew4w@mail.gmail.com>
	<CAG4NReLZfUtayt+koJvSZJAK1q_vNJAnJmQ_9GBtOc=X2uGqfw@mail.gmail.com>
	<CAG4NReJz-eq6GcGm=cQrMikz9VnhSu=HdpOyQHmB9PUK3e=Xpg@mail.gmail.com>
	<5358C986.9080309@uni-muenster.de>
	<345780f75d2045169a2f656dd4fca6a9@EX-0-HT0.lancs.local>
	<CANVKczMKm4JqLbJ-bvJsEiGc+MdmLf7Fvzgc7NtebODOcRvY9g@mail.gmail.com>
	<53595125.60606@uni-muenster.de>
	<CAMLL7bn87AhW-v=C5yhEZJ7ANVMRQUhg2LDtFgPBGLJu6XKXTA@mail.gmail.com>
	<CAG4NReLf4Xg5-SvJgemMxhif=6-fnm_n6842ofvV27W0Y3R7Ug@mail.gmail.com>
	<CAG4NReLXPL7H39SjX=7v3DgH0WMz757VLyTZ_=fTH6zGvHfywg@mail.gmail.com>
	<CAMLL7bkemZSdiDxjf=X=02K65OAvQkh8Tu-_QE42iKaZ+YkMOA@mail.gmail.com>
	<CAG4NReJg+Av678gvt6isyfLiVfZ7apprx77xKfOi00HONdxjqw@mail.gmail.com>
	<CAMLL7bn7gAFE-_etk-brwBQ+63aSjSDD_JrBb2RSVH2xZLAX4g@mail.gmail.com>
	<CAG4NReJ9bN42y+1e6xW1iCaDCQWpR0Egjn9HaQD6GVDZGZK2bA@mail.gmail.com>
	<53690778.1060002@uni-muenster.de>
	<CAG4NRe+qash+VXwNmmX8e=Qr-NA02zoVxGhPbogBfZ-GeFQA0w@mail.gmail.com>
Message-ID: <CAMLL7bkVe-PLZgOvpxdkuWt5AhBej5t5wTMBjX2B+9_kmafp4A@mail.gmail.com>

Hi again,

I forgot to include a link with an interesting comment in the
OpenStreetMap wiki about the use of these maps:
http://wiki.openstreetmap.org/wiki/Exporting_calibrated_maps#Exporting_calibrated_maps_from_OSM
This OSM user proposes to "import the raw OSM XML data". This is
possible in R thanks to the osmar package
(http://osmar.r-forge.r-project.org/), which is able to produce sp
objects.

Best,

Oscar.
-----------------------------------------------------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
Grupo de Sistemas Fotovoltaicos (IES-UPM)
URL: http://oscarperpinan.github.io
Twitter: @oscarperpinan


2014-05-07 12:18 GMT+02:00 Agustin Lobo <alobolistas at gmail.com>:
> Edzer,
>
> Thanks for the corrections. I had moved chunks and left loading the
> packages in the wrong place.
> It is correct now. Also, I've included a link to a file with just R
> code and the link to the vector shapefile.
>
> As far as I can tell, "levelplot() + layer()"
> or "spplot() + layer()"
> do not check correspondence of the proj4string of the operands on both sides of
> the +. Actually, both commands totally ignore any CRS information.
> This is why we've got into this mess
> and must be aware of providing consistent layers.
>
> Agus
>
> On Tue, May 6, 2014 at 6:02 PM, Edzer Pebesma
> <edzer.pebesma at uni-muenster.de> wrote:
>>
>>
>> On 05/06/2014 05:33 PM, Agustin Lobo wrote:
>>> I think I've clarified this question here:
>>> http://rpubs.com/alobo/getmapCRS
>>>
>>> In short, we can get exact positioning of both layers with
>>> * plot(r); plot(v, add=TRUE)
>>> * spplot() + layer() and
>>> * levelplot() + layer()
>>> but we must be careful of CRS details.
>>>
>>> Please send comments and corrections.
>>
>> Useful!
>>
>> These rpubs read nicely, but are very discouraging to try a rerun. Did
>> you upload the R-markdown file somewhere?
>>
>> Anyway, I cannot see how the script can run when levelplot is called
>> before lattice is loaded, and also the "+" and layer() come, I believe
>> from latticeExtra which has not been loaded up to that point (2.2).
>>
>> Does the "+" operator in
>>
>> levelplot() + layer()
>>
>> or
>>
>> spplot() + layer()
>>
>> check correspondence of the proj4string of the operands on both sides of
>> the + , can it be made to do so, or do we have remember your conclusions?
>>
>>> Agus
>>>
>>> On Tue, Apr 29, 2014 at 11:40 AM, Oscar Perpi?an <oscar.perpinan at upm.es> wrote:
>>>>>> I couldn't run your code because I am not able to read the file.
>>>>> Note dsn is the directory where you have the 4 files and layer is the
>>>>> name of the layer, which is the name of the files without extension.
>>>>
>>>> My fault, sorry.
>>>>
>>>>> There has to be a reprojection on the fly because the the two layers of
>>>>> the plot are on different coordinate systems. I think it is clear now that
>>>>> ggplot uses the Google "PseudoMercator" for the matrix while expects
>>>>> all user input on epsg4326
>>>>
>>>> I am not sure what do you mean with "reprojection on the fly" but
>>>> "layer" does not make any reprojection.
>>>> In fact, it is only a wrapper around
>>>> "eval(substitute(expression(...)))" to modify easily the panel
>>>> function of a trellis graphic.
>>>> However, in my code I am using "grid.raster" with its arguments width,
>>>> height, x and y, to resize the ggmap raster and to position it in the
>>>> graphic window created with spplot.
>>>>
>>>>> I think "acceptable" depends on the scale only. At coarser scale you
>>>>> just do not see the error
>>>>> because it is relative to the extent and the result converges to the
>>>>> correct  reprojection.
>>>>
>>>> I think it depends on the extent. I have tested the code again with
>>>> the administrative boundaries of Spain and some of its regions
>>>> (http://biogeo.ucdavis.edu/data/gadm2/shp/ESP_adm.zip).
>>>> It fails for the country extent (as Edzer suggested and you have found
>>>> with your file) but it works correctly for a smaller extent (code
>>>> copied below).
>>>>
>>>>> In the code you provide, how do you know NAD27 is the appropriate datum?
>>>>> There is no prj file (one of the big shortcomings of shapefiles is
>>>>> that the presence
>>>>> of crs information in the form of a prj file is not compulsory). Note
>>>>> that you define
>>>>> a datum != WGS84 and you do not define the towgs argument.
>>>>
>>>> It is an example extracted from the p.121 of the 2008 edition of
>>>> "Applied Spatial Data Analysis with R". That chapter is now available
>>>> here: http://cran.r-project.org/web/packages/maptools/vignettes/combine_maptools.pdf
>>>>
>>>> Best,
>>>>
>>>> Oscar.
>>>>
>>>> #######################################################
>>>> library(ggmap)
>>>> library(latticeExtra)
>>>> library(sp)
>>>> library(maptools)
>>>>
>>>> ## http://biogeo.ucdavis.edu/data/gadm2/shp/ESP_adm.zip
>>>> setwd('/tmp')
>>>> spain <- readShapePoly('ESP_adm/ESP_adm1')
>>>> proj4string(spain) <- CRS("+proj=longlat +datum=WGS84")
>>>>
>>>> andalucia <- spain[spain$ID_1 == 1,]
>>>> catalonia <- spain[spain$ID_1 == 6,]
>>>>
>>>> ## myPoly <- spain
>>>> myPoly <- andalucia
>>>> ## myPoly <- catalonia
>>>>
>>>> bbPoly <- bbox(myPoly)
>>>> gmap <- get_map(c(bbPoly), maptype='watercolor', source='stamen', crop=FALSE)
>>>> bbMap <- attr(gmap, 'bb')
>>>> latCenter <- with(bbMap, ll.lat + ur.lat)/2
>>>> lonCenter <- with(bbMap, ll.lon + ur.lon)/2
>>>> height <- with(bbMap, ur.lat - ll.lat)
>>>> width <- with(bbMap, ur.lon - ll.lon)
>>>>
>>>> spplot(myPoly["ID_1"], fill='transparent') +
>>>>                   layer(grid.raster(gmap,
>>>>                                     x=lonCenter, y=latCenter,
>>>>                                     width=width, height=height,
>>>>                                     default.units='native'),
>>>>                         under=TRUE)
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
>> 83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jgrn at illinois.edu  Wed May  7 16:36:29 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 7 May 2014 09:36:29 -0500
Subject: [R-sig-Geo] Decision tree classification of satellite image in R
In-Reply-To: <CAH89e5xKFRE1suMCFH3wpCCSGeLpQFv4tVbeDZ+iE=9ocu_0Nw@mail.gmail.com>
References: <CAH89e5yuQ9k66Ga9FJTYOpGad8T6USEXmSLTA_vq0mdOOS9bzA@mail.gmail.com>
	<CABG0rftT4b9cVkM+eO9T5wEdYcJjPmESSDLWe2Q8LN8AVUFQ3g@mail.gmail.com>
	<CAH89e5xKFRE1suMCFH3wpCCSGeLpQFv4tVbeDZ+iE=9ocu_0Nw@mail.gmail.com>
Message-ID: <CABG0rfu80h5CU=oHkbmZjJnoj-YvZ6XM7eZe5TghyMT-7_+d6A@mail.gmail.com>

Anusheema:

If you do want to use the RWeka classifier, you can write a function
in rasterEngine (part of spatial.tools) to use it -- you basically
need to coerce its output back into an array, which shouldn't be too
hard to do.

--j

On Tue, May 6, 2014 at 11:32 PM, Anusheema Chakraborty
<anusheema at gmail.com> wrote:
> Yes, I realized that later. RandomForest is available to predict fitted
> model to raster data, but not RWeka classifier. However, Rpart works too.
>
> Thanks!
>
>
> On Tue, May 6, 2014 at 9:22 PM, Jonathan Greenberg <jgrn at illinois.edu>
> wrote:
>>
>> Anusheema:
>>
>> The first error is because you didn't specify an out filename (it
>> needs to be a character).
>>
>> Re: the second error -- is there a predict.R_Weka_classifier_interface
>> (or something along those lines) in that package?  For predict to
>> work, you need a predict.* statement available.
>>
>> You might want to swap in a randomForest for the classifier you are
>> using, at least to begin with -- randomForest does work properly with
>> raster's predict() statement.
>>
>> --j
>>
>> On Tue, May 6, 2014 at 1:37 AM, Anusheema Chakraborty
>> <anusheema at gmail.com> wrote:
>> > Hi!
>> >
>> > I am trying to classify satellite image in R using RWeka classifier,
>> > J48. I have a CSV file with the classes required, and raster data
>> > loaded in R. I am able to make the tree, however, I am not able to use
>> > the same tree to classify my satellite image.
>> >
>> > Here's how it goes.
>> >
>> > inputfile=read.csv("E://R/Trial/naini.CSV")
>> > m1 <- J48(Class~B1+B2+B3+B4+B5+B7, data = inputfile)
>> > if(require("party", quietly = TRUE)) plot(m1)
>> > raster<- brick("merge.tif")
>> > plotRGB(raster, 4, 3, 2, stretch="hist")
>> >
>> > And then I am attempting to use the tree generated to classify my
>> > satellite image, but I keep getting errors.
>> >
>> > predict (test_new, J48, filename=out_classify,
>> > progress='text',format='GTiff', datatype='FLT4S', type='response',
>> > overwrite=TRUE)
>> > Error in trim(filename) : error in evaluating the argument 'x' in
>> > selecting a method for function 'trim': Error: object 'out_classify'
>> > not found
>> >
>> > And if I change the arguments, this is what I get. I am not sure how
>> > to proceed from this point forward.
>> >
>> > predict (J48, test_new, filename=out_classify,
>> > progress='text',format='GTiff', datatype='FLT4S', type='response',
>> > overwrite=TRUE)
>> > Error in UseMethod("predict") : no applicable method for 'predict'
>> > applied to an object of class "c('R_Weka_classifier_interface',
>> > 'R_Weka_interface')"
>> >
>> > I am new to R, so I might take a while to decipher your answers. Any
>> > help would be greatly appreciated!
>> >
>> > Thanks!
>> >
>> >
>> > Best,
>> > Anusheema.
>> >
>> >
>> >
>> > --
>> > Regards
>> >
>> > Anusheema Chakraborty
>> > Ph.D. Scholar
>> > Department of Natural Resources, TERI University
>> > 10, Institutional Area, Vasant Kunj, New Delhi - 110070
>> > Website: www.teriuniversity.ac.in
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
>
>
>
> --
> Regards
>
> Anusheema Chakraborty
> Ph.D. Scholar
> Department of Natural Resources, TERI University
> 10, Institutional Area, Vasant Kunj, New Delhi - 110070
> Website: www.teriuniversity.ac.in



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From Roger.Bivand at nhh.no  Wed May  7 16:59:45 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 7 May 2014 16:59:45 +0200
Subject: [R-sig-Geo] lAGRANGE MULTIPLIER Test and error in listw object
In-Reply-To: <1399367414246-7586372.post@n2.nabble.com>
References: <1399367414246-7586372.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1405071652150.23775@reclus.nhh.no>

On Tue, 6 May 2014, az14 wrote:

> Dear List,
> I 'm trying to run  the Lagrange multiplier test (LM Test) using R.
> so i import my data file(don) and do an lm regression as bellow:
>
>> don<-read.csv("donnees2.csv",header=TRUE,sep=";",dec=",")
>> widad.lm<-lm(coop~dens_t1+perchom_t1+percvieux_t1+psdc_t1,data=don)
>> summary(widad.lm)
>

The problem starts with lm() because there are missing values on at least 
one of the variables in the model. This reproduces the problem:

library(spdep)
data(columbus)
mat <- nb2mat(col.gal.nb, style="B")
mat2 <- mat%*%mat
x <- mat2listw(mat2)
lw <- nb2listw(x$neighbours, glist=x$weights,style="W")
lm1 <- lm(CRIME ~ HOVAL + INC, data=columbus)
lm.LMtests(lm1, listw=lw, test=c("LMerr","RLMerr"))

# OK

is.na(columbus$CRIME[2]) <- TRUE
lm2 <- lm(CRIME ~ HOVAL + INC, data=columbus)
lm.LMtests(lm2, listw=lw, test=c("LMerr","RLMerr"))

#Error in subset.listw(listw, subset, zero.policy = zero.policy) :
#  Not yet able to subset general weights lists

So arguably you could remove the observations that are not complete from 
don and from the weights matrix (rows and columns), or use a weights 
object in the call to lm.LMtests that can be subsetted.

Fitting OLS models with missing values is risky anyway, and missing values 
may actually indicate that the file read by read.csv() didn't contain what 
you thought it did. The summary of widad.lm reports the number of 
observations deleted due to missingness.

Hope this helps,

Roger

> Then i import my distance matrix( 1056*1056).
>
>
> matrice<-read.csv("matw2.csv",header=FALSEE,sep=";",dec=",")
> mat<-do.call(rbind,matrice)
> dim(mat)
> is.matrix(mat)
> True
> mat2<-mat%*%mat
>> dim(mat2)
> [1] 1056 1056
>> x <- mat2listw(mat2)
> When i run the LM test; with an nb2listw object, i get this error:
>
> lm.LMtests(widad.lm,nb2listw(x$neighbours, glist=x$weights,
> style="W"),test=c("LMerr","RLMerr"))
> Erreur dans subset.listw(listw, subset, zero.policy = zero.policy) :
>  /Not yet able to subset general weights lists
> I tryed to do it with mat2listw, but i get error too.
>
> lm.LMtests(widad.lm, mat2listw(mat2),test=c("LMerr","RLMerr"))
> Erreur dans subset.listw(listw, subset, zero.policy = zero.policy) :
>  Not yet able to subset general weights lists
>
>
> Any help would be appreciated.
> Thank you.
> Zineb.
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/lAGRANGE-MULTIPLIER-Test-and-error-in-listw-object-tp7586372.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From 15201514761 at 163.com  Wed May  7 17:52:05 2014
From: 15201514761 at 163.com (=?GBK?B?zMa5+se/?=)
Date: Wed, 7 May 2014 23:52:05 +0800 (CST)
Subject: [R-sig-Geo] How to export the result of krige.conv;
In-Reply-To: <alpine.DEB.2.00.1405071145460.23894@pataxo.est.ufpr.br>
References: <43543e94.124c2.145d6c9035f.Coremail.15201514761@163.com>
	<alpine.DEB.2.00.1405071145460.23894@pataxo.est.ufpr.br>
Message-ID: <59c2ecfd.124e1.145d762773f.Coremail.15201514761@163.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/c6ce1f26/attachment.pl>

From paulojus at c3sl.ufpr.br  Wed May  7 18:15:39 2014
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 7 May 2014 13:15:39 -0300 (BRT)
Subject: [R-sig-Geo] How to export the result of krige.conv;
In-Reply-To: <59c2ecfd.124e1.145d762773f.Coremail.15201514761@163.com>
References: <43543e94.124c2.145d6c9035f.Coremail.15201514761@163.com>
	<alpine.DEB.2.00.1405071145460.23894@pataxo.est.ufpr.br>
	<59c2ecfd.124e1.145d762773f.Coremail.15201514761@163.com>
Message-ID: <alpine.DEB.2.10.1405071312230.7676@macalan.c3sl.ufpr.br>

So you can transform the values 
returned as list components to matrices

Forinstnce, for predicted values you can
transform kc$pred to a appropriate matrix to reflect your grid.

Note this is underlying several functions
such as
image(kc)
which does such conversion internally.

again your query reffers  how to mnipulate R objects which you can do in 
R's standard ways from krige.conv() output



On Wed, 7 May 2014, ??? wrote:

> In this way I can only get a list of all the values. In my codes, I set up a grid of  420  columns and 565 rows. I hope to fill those values to each grid cell,  then I can get the values on the surface. The result I expect is a 565*420 grid with values calculated with krige.conv.
>
>
>
>
>
> --
> ??????
> ??????
> ??????????????????????
> Tel??15201514761
>
>
>
> At 2014-05-07 22:49:15,"Paulo Justiniano" <paulojus at leg.ufpr.br> wrote:
>> Ths is just about how to export R objects and any std device can be used
>> There is no specific functionin geoR
>>
>> krige.conv() retuns a list where the first two components are the
>> kriging predictions and variances which are the ones you may wish to 
>> export
>>
>> Suppose kc is the object with output of krige.conv()
>> as an example you can export as a csv file with:
>>
>> write.csv(kc[1:2], file="kc.csv")
>>
>>
>> On Wed, 7 May 2014, ?????? wrote:
>>
>>> Dear Paulo J. Ribeiro and Peter J. Diggle:I used "krige.conv" to do Krige interplation in a region. But I have difficulties in export the results.I find some
>>> codes on a website https://stat.ethz.ch/pipermail/r-sig-geo/2009-July/006167.html. But I can't get it run and I can't understand it probably because the codes
>>> lose some information.
>>> Attachtment is my code. What I want to know is how to export the result of krige.conv to .asc  .xlsx or some others file.
>>> Thank you!
>>> 
>>> Guoqiang Tang
>>> 
>>> 
>>> 
>>> ????????????????????????????
>>> 
>>>
>
> 	[[alternative HTML version deleted]]

From abidi.zineb at gmail.com  Wed May  7 20:35:15 2014
From: abidi.zineb at gmail.com (az14)
Date: Wed, 7 May 2014 11:35:15 -0700 (PDT)
Subject: [R-sig-Geo] lAGRANGE MULTIPLIER Test and error in listw object
In-Reply-To: <1399367414246-7586372.post@n2.nabble.com>
References: <1399367414246-7586372.post@n2.nabble.com>
Message-ID: <1399487715356-7586396.post@n2.nabble.com>

 Thank you for your help, it works now. But can we do the same test for
spatial PANEL data?





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/lAGRANGE-MULTIPLIER-Test-and-error-in-listw-object-tp7586372p7586396.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From smithtiffanyt at gmail.com  Wed May  7 21:59:02 2014
From: smithtiffanyt at gmail.com (Tiffany Smith)
Date: Wed, 7 May 2014 15:59:02 -0400
Subject: [R-sig-Geo] alternate corField (clim.pact) function
Message-ID: <5DFCDCE4-AC69-40B0-BFF3-5CA8B41B57CE@gmail.com>

Hello,

I?m looking to produce maps of the correlation between a time series at 1 location to global climate variables (SLP, SST etc). A few years ago I did this using ?corField? from the clim.pact package, but since this package is now defunct I was wondering if anyone has idea for an alternative function/package.

Thanks so much,
Tiffany Smith

From amonleong at wanadoo.es  Wed May  7 22:27:30 2014
From: amonleong at wanadoo.es (Toni Monleon)
Date: Wed, 7 May 2014 22:27:30 +0200
Subject: [R-sig-Geo] =?utf-8?q?Fwd=3A_Geostatistical_Space=E2=80=93Time_Mo?=
	=?utf-8?q?del?=
In-Reply-To: <CAFFKpM08V+0i6AAhQNEn5v9t7hSY=7LBTO2nZEN67br9XTPRzw@mail.gmail.com>
References: <CAFFKpM08V+0i6AAhQNEn5v9t7hSY=7LBTO2nZEN67br9XTPRzw@mail.gmail.com>
Message-ID: <CAFFKpM0-2bV6xByUx8_Utzo2t6UWbnZd5VaMM+K=cTKNOn=4mg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/f48462d5/attachment.pl>

From Roger.Bivand at nhh.no  Wed May  7 22:54:59 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 7 May 2014 22:54:59 +0200
Subject: [R-sig-Geo] lAGRANGE MULTIPLIER Test and error in listw object
In-Reply-To: <1399487715356-7586396.post@n2.nabble.com>
References: <1399367414246-7586372.post@n2.nabble.com>
	<1399487715356-7586396.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.03.1405072248280.24466@reclus.nhh.no>

On Wed, 7 May 2014, az14 wrote:

> Thank you for your help, it works now. But can we do the same test for
> spatial PANEL data?
>

Some tests are available in the splm package, please refer to its 
documentation and JSS paper:

http://www.jstatsoft.org/v47/i01

and consider using the R-forge version:

https://r-forge.r-project.org/R/?group_id=352

as it is somewhat newer than the CRAN version.

Hope this helps,

Roger

>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/lAGRANGE-MULTIPLIER-Test-and-error-in-listw-object-tp7586372p7586396.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From Terry.Beutel at daff.qld.gov.au  Thu May  8 02:05:54 2014
From: Terry.Beutel at daff.qld.gov.au (BEUTEL Terry S)
Date: Thu, 8 May 2014 00:05:54 +0000
Subject: [R-sig-Geo] using rank in stackApply
Message-ID: <0B3A8CE342E4A8409958161BD7B04BD00AD6C8@CHQMBX01.lands.resnet.qg>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140508/088c37f3/attachment.pl>

From nevil.amos at gmail.com  Thu May  8 02:47:55 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Thu, 8 May 2014 10:47:55 +1000
Subject: [R-sig-Geo] Combine two rasters combining attributes ( or at
 least values of each)?
In-Reply-To: <CAN9eD7mcQqNuzud9EZiM_Z0P4kD=6sFSr7qUfOh1H_-WmMkc=g@mail.gmail.com>
References: <CAN9eD7=zFvF+xXtmCdPRpAoP1tM13HynmMc6_WOuC965FXUpCg@mail.gmail.com>
	<CABG0rfvh6xHoPrhpg5j6AALgzFeTdSO=6OLOUbKm9b374ieyXQ@mail.gmail.com>
	<CAN9eD7mcQqNuzud9EZiM_Z0P4kD=6sFSr7qUfOh1H_-WmMkc=g@mail.gmail.com>
Message-ID: <CAN9eD7=4c3QnR0wWambXej_nj=HxY50r8EELJwzYTJu8Y33QeQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140508/096c7590/attachment.pl>

From avi3187 at gmail.com  Thu May  8 06:52:58 2014
From: avi3187 at gmail.com (David Villalobos)
Date: Wed, 7 May 2014 22:52:58 -0600
Subject: [R-sig-Geo] 87:-(=-O
Message-ID: <CA+78ZtEHS48BbAFgxE3=x7Topoef3LO6db2UW-QLN3XYPPZy8A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140507/b4eda454/attachment.pl>

From frtog at vestas.com  Thu May  8 07:52:43 2014
From: frtog at vestas.com (=?utf-8?B?RnJlZGUgQWFrbWFubiBUw7hnZXJzZW4=?=)
Date: Thu, 8 May 2014 07:52:43 +0200
Subject: [R-sig-Geo]
 =?utf-8?q?Fwd=3A_Geostatistical_Space=E2=80=93Time_Mo?=
 =?utf-8?q?del?=
In-Reply-To: <CAFFKpM0-2bV6xByUx8_Utzo2t6UWbnZd5VaMM+K=cTKNOn=4mg@mail.gmail.com>
References: <CAFFKpM08V+0i6AAhQNEn5v9t7hSY=7LBTO2nZEN67br9XTPRzw@mail.gmail.com>
	<CAFFKpM0-2bV6xByUx8_Utzo2t6UWbnZd5VaMM+K=cTKNOn=4mg@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C608CE22@DKRDSEXC016.vestas.net>

Hi Toni

Second time you ask this question! Do you feel lucky now?

Perhaps nobody answers you because this list is about R coding and not statistical problems.

Did you try to get an overview of R task views at http://cran.r-project.org/web/views/ ? Especially the Environmetrics, Spatial, and SpatioTemporal views?

Why didn't you google for  "temporal spatial models"? There you will probably find some pages related to R-INLA. Or google for "temporal spatial models disease"!

Go to http://www.r-inla.org/home and have a look. There you can download R package, see case studies with R code, tutorials, etc.

Perhaps this is what you need: http://www.r-inla.org/examples/case-studies/blangiardo-et-al-2012 ?

I am quite sure this will keep you busy for a long time.

Happy modelling ;-) 


Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Toni Monleon
> Sent: 7. maj 2014 22:28
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Fwd: Geostatistical Space?Time Model
> 
> Hi, I need some help.
> Does anyone have R code to a Geostatistical Space???Time Models applied to
> pests like  the red palm weevil (Rhynchophorus ferrugineus) or fungal
> pathogens of vegetable crops?
> Thanks for  any advice or link to related code or documentation.
> 
> Toni
> Dep of Statistics
> University of Barcelona
> 
> 	[[alternative HTML version deleted]]


From alobolistas at gmail.com  Thu May  8 10:17:04 2014
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 8 May 2014 10:17:04 +0200
Subject: [R-sig-Geo] projection of ggmap:get_map() output
In-Reply-To: <CAMLL7bm25PS1pMhjQYbuxL=7d7TYgkmNOEx-2XM8uk5dSuDkRA@mail.gmail.com>
References: <15399b6d75f748d28822ecdb366ebd84@EX-0-HT0.lancs.local>
	<CANVKczNLjyBAZ2y7FOvDP+c-ZSwABT_6BWK276uJJy=7MEew4w@mail.gmail.com>
	<CAG4NReLZfUtayt+koJvSZJAK1q_vNJAnJmQ_9GBtOc=X2uGqfw@mail.gmail.com>
	<CAG4NReJz-eq6GcGm=cQrMikz9VnhSu=HdpOyQHmB9PUK3e=Xpg@mail.gmail.com>
	<5358C986.9080309@uni-muenster.de>
	<345780f75d2045169a2f656dd4fca6a9@EX-0-HT0.lancs.local>
	<CANVKczMKm4JqLbJ-bvJsEiGc+MdmLf7Fvzgc7NtebODOcRvY9g@mail.gmail.com>
	<53595125.60606@uni-muenster.de>
	<CAMLL7bn87AhW-v=C5yhEZJ7ANVMRQUhg2LDtFgPBGLJu6XKXTA@mail.gmail.com>
	<CAG4NReLf4Xg5-SvJgemMxhif=6-fnm_n6842ofvV27W0Y3R7Ug@mail.gmail.com>
	<CAG4NReLXPL7H39SjX=7v3DgH0WMz757VLyTZ_=fTH6zGvHfywg@mail.gmail.com>
	<CAMLL7bkemZSdiDxjf=X=02K65OAvQkh8Tu-_QE42iKaZ+YkMOA@mail.gmail.com>
	<CAG4NReJg+Av678gvt6isyfLiVfZ7apprx77xKfOi00HONdxjqw@mail.gmail.com>
	<CAMLL7bn7gAFE-_etk-brwBQ+63aSjSDD_JrBb2RSVH2xZLAX4g@mail.gmail.com>
	<CAG4NReJ9bN42y+1e6xW1iCaDCQWpR0Egjn9HaQD6GVDZGZK2bA@mail.gmail.com>
	<53690778.1060002@uni-muenster.de>
	<CAG4NRe+qash+VXwNmmX8e=Qr-NA02zoVxGhPbogBfZ-GeFQA0w@mail.gmail.com>
	<CAMLL7bm25PS1pMhjQYbuxL=7d7TYgkmNOEx-2XM8uk5dSuDkRA@mail.gmail.com>
Message-ID: <CAG4NReLmwoxn4mbutaUL3S=iChoGkSK4AdZTTFLRcd8Fm6Qb7w@mail.gmail.com>

It turns out that the Mary Poppins bag of Robert actually includes
a function dismo:gmap() that returns the GM subscene as a raster layer
of package raster
with correct CRS information, thus http://rpubs.com/alobo/getmapCRS is
kind of obsolete.

We can just do:

require(utils)
require(rgdal)
require(raster)
require(dismo)

## Vector data
download.file("https://dl.dropboxusercontent.com/u/3180464/NWEur.zip","NWEur.zip",method="curl")
unzip("NWEur.zip",exdir="NWEur")
NWEur <- readOGR(dsn="./NWEur",layer="NWEur",stringsAsFactors=FALSE)
NWEurGM <- spTransform(NWEur,CRS("+init=epsg:3857"))

## Background object
miext <- extent(-2.020264,12.042236,46.354589,55.210287)
migmap <- gmap(x=miext, type = "hybrid", zoom = 6,file="NWEurdismo")
migmap

## 1 Standard plots
plot(migmap)
plot(NWEurGM,add=TRUE,lwd=2,ext=extent(migmap),border="yellow")

## 2. rasterVis:
require(latticeExtra)
require(rasterVis)
#NOTE: the order of loading these packages matters!
colors <- migmap at legend@colortable #extract the color from the
pseudocolor raster
levelplot(migmap, maxpixels = ncell(migmap),
          col.regions = colors, at = 0:255,
          panel = panel.levelplot.raster,
          interpolate=TRUE,
          colorkey = FALSE, margin = FALSE) +
  spplot(NWEurGM, zcol = "NAME", fill = "transparent", col = "yellow",
         xlim = c(extent(rgmaprgbGM)@xmin, extent(rgmaprgbGM)@xmax), ylim =
           c(extent(rgmaprgbGM)@ymin, extent(rgmaprgbGM)@ymax),
         colorkey = FALSE)

Note the need of configuring the color style in levelplot() as pointed
out by Oscar.

Agus


On Wed, May 7, 2014 at 2:07 PM, Oscar Perpi?an <oscar.perpinan at upm.es> wrote:
> Hi,
>
>> As far as I can tell, "levelplot() + layer()"
>> or "spplot() + layer()"
>> do not check correspondence of the proj4string of the operands on both sides of
>> the +. Actually, both commands totally ignore any CRS information.
>> This is why we've got into this mess and must be aware of providing consistent layers.
>
> "layer" and "+.trellis" are functions of the latticeExtra package that
> modify the panel function of a trellis graphic, for example, the ones
> produced by spplot or rasterVis::levelplot. Of course, they don't know
> anything about projections. They only display the graphical result of
> another function.
>
> Note that "+ layer()" is equivalent to "sp.layout" or modifying
> directly the panel function. Some code to explain it better:
>
> library(sp)
> library(lattice)
> library(latticeExtra)
>
> data(meuse)
> coordinates(meuse) <- ~x+y
>
> ## These three methods produce the same result:
>
> ## Standard lattice method: modification of the panel function
> spplot(meuse["ffreq"], panel=function(...){
>     panel.pointsplot(...)
>     sp.text(c(180500, 329900), 'Meuse')
> })
>
> ## sp.layout method
> l1 <- list("sp.text", c(180500, 329900), 'Meuse')
> spplot(meuse["ffreq"], sp.layout=list(l1))
>
> ## latticeExtra method: +.trellis and layer
> spplot(meuse["ffreq"]) + layer(sp.text(c(180500, 329900), 'Meuse'))
>
> These three methods do not use CRS information. Review the first
> example of the spplot help page and you will find that the components
> of the sp.layout do not use CRS information. It is the user's
> responsibility to make correct use of the corresponding functions.
>
> On the other hand, you can use +.trellis without layer to combine two
> trellis objects. For example, levelplot + spplot, or spplot + spplot,
> etc. Therefore, in section 2.3 of your RPubs, when you say that
> "layer() does not work with raster layers, therefore cannot use the
> rgmaprgbGM object.", you can try this:
>
> levelplot(rgmaprgbGM[[3]], margin = FALSE, par.settings = GrTheme) +
> spplot(NWEurGM, zcol = "NAME", fill = "transparent", col = "yellow",
> xlim = c(extent(rgmaprgbGM)@xmin, extent(rgmaprgbGM)@xmax), ylim =
> c(extent(rgmaprgbGM)@ymin, extent(rgmaprgbGM)@ymax),
>     colorkey = FALSE)
>
> Best,
>
> Oscar.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jan.verbesselt at wur.nl  Thu May  8 19:11:47 2014
From: jan.verbesselt at wur.nl (Verbesselt, Jan)
Date: Thu, 8 May 2014 17:11:47 +0000
Subject: [R-sig-Geo] What does the error "ERROR in .calcTest(x[1:5], fun,
 na.rm, forcefun, forceapply): cannot use this function" mean in R?
In-Reply-To: <1399456276920-7586384.post@n2.nabble.com>
References: <1399456276920-7586384.post@n2.nabble.com>
Message-ID: <CF9184A5.14779%jan.verbesselt@wur.nl>

As the error message says the error comes from testing your function on a
subset of your raster stack/brick i.e. x[1:5].
See below for a small example:

require(raster)
# create data
r <- raster(nrow=10, ncol=10)
s1 <- list()
for (i in 1:20) {
  s1[i] <- setValues(r, rnorm(ncell(r), i, 3) )
}
s1 <- stack(s1)

f_lowess <- function(x){
  df <- data.frame(t = 1:20, x)
  out <- lowess(df, f = .2)$y
  return(out)
}

## calc with a function
s2 <- calc(s1, fun = f_lowess)

## calc test - tests your function on a subset of the data
d <- s1[1:5] ## every row is a pixel
apply(d, 1, f_lowess) ## here no error occurs.



---
Jan Verbesselt
Wageningen University
The Netherlands
www.wageningenur.nl/changemonitor






On 07/05/14 11:51, "Bandrush Barda" <ndugarsuren at gmail.com> wrote:

>I have a problem with lowess function to predict NDVI as a function of
>time
>by polynomial regression in R. NDVI image is 8-day image from Apr to Oct
>in
>Julian date of 97 to 297. Here is the scripts I run:
> 
>#Created a time vector to act as x
>time<-sort(sample(97:297, nlayers(ndvi2000crop1)))
>
>#locally-weighted polynomial regression of ndvi ~ time
>t.lowess <- function(x,...) { if (is.na(x[1])) {NA} else
>{lowess(x,y,...)$y
>} } 
>f.pred <- calc(ndvi2000crop1, t.lowess)
>
>When I calculate the function on image by doing the last step of this
>code,
>an error appeared something like this "Error in .calcTest(x[1:5], fun,
>na.rm, forcefun, forceapply): cannot use this function". Can you tell me
>where this error comes from and how to solve it?
>
>Thank you
>
>
>
>
>--
>View this message in context:
>http://r-sig-geo.2731867.n2.nabble.com/What-does-the-error-ERROR-in-calcTe
>st-x-1-5-fun-na-rm-forcefun-forceapply-cannot-use-this-function-m-tp758638
>4.html
>Sent from the R-sig-geo mailing list archive at Nabble.com.
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From tchafros at gmail.com  Fri May  9 12:55:53 2014
From: tchafros at gmail.com (Franklin Tchakounte)
Date: Fri, 9 May 2014 11:55:53 +0100
Subject: [R-sig-Geo] Spatio temporal Kriging
Message-ID: <CAA2guuz+Xb9BTOYSbP-gEwJv+G2om959x-0q2LbSFY7tR7mZWQ@mail.gmail.com>

Hello

i am exercising (would like) to use spatiotemporal kriging to predict
in the future the rate of populations in neighborhoods in towns. I
have values for population rate in 2011, 2012, 2013, 2014 for many
neighbourhoods and i need to know the corresponding values in 2015 and
2016 with the spatio temporal kriging using R.
I would to know (if possible) how to apply extrapolation (spatio
temporal kriging) with R from the beginning to the end.

i have attached the actual R code with the help of Graeler and data file.

Thank you a lot

Franklin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: importData1.R
Type: application/octet-stream
Size: 2427 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140509/4d4cfb28/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: donneesannees.csv
Type: text/csv
Size: 3654 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140509/4d4cfb28/attachment.bin>

From abidi.zineb at gmail.com  Fri May  9 13:33:37 2014
From: abidi.zineb at gmail.com (az14)
Date: Fri, 9 May 2014 04:33:37 -0700 (PDT)
Subject: [R-sig-Geo] Repeat columns and rows of matrix
Message-ID: <1399635217003-7586408.post@n2.nabble.com>

Dear list, 
i have a matrixW(1060*1060), i want to repeat each column and row 9 times,
such as to have a new matrix W1(9540*9540).
I use the code: 
rep.row<-function(x,n){
   matrix(rep(x,each=n),nrow=n)
}
rep.col<-function(x,n){
   matrix(rep(x,each=n), ncol=n, byrow=TRUE)
}

ww<-rep.row(w,9)
W1<-rep.col(ww,9)

but i did not work! 

Is there another way to do it ?

Any help would me appreciated. 
Thank YOU.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Repeat-columns-and-rows-of-matrix-tp7586408.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jeandaniel.sylvain at gmail.com  Fri May  9 14:09:32 2014
From: jeandaniel.sylvain at gmail.com (Jean-Daniel Sylvain)
Date: Fri, 09 May 2014 08:09:32 -0400
Subject: [R-sig-Geo] Repeat columns and rows of matrix
In-Reply-To: <1399635217003-7586408.post@n2.nabble.com>
References: <1399635217003-7586408.post@n2.nabble.com>
Message-ID: <536CC57C.60405@gmail.com>

Hi,

You hould use the apply function function, which will apply the function 
rep() on one of the dimension of your matrix (1 for row, and 2 for columns).

mat <- matrix(data=1:100,10,10)

apply(mat,MARGIN=1,function(x) rep(x,10))
apply(mat,MARGIN=2,function(x) rep(x,10))

Hope this helps,

JD

Le 5/9/2014 7:33 AM, az14 a ?crit :
> Dear list,
> i have a matrixW(1060*1060), i want to repeat each column and row 9 times,
> such as to have a new matrix W1(9540*9540).
> I use the code:
> rep.row<-function(x,n){
>     matrix(rep(x,each=n),nrow=n)
> }
> rep.col<-function(x,n){
>     matrix(rep(x,each=n), ncol=n, byrow=TRUE)
> }
>
> ww<-rep.row(w,9)
> W1<-rep.col(ww,9)
>
> but i did not work!
>
> Is there another way to do it ?
>
> Any help would me appreciated.
> Thank YOU.
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Repeat-columns-and-rows-of-matrix-tp7586408.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Fri May  9 14:59:47 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 9 May 2014 14:59:47 +0200
Subject: [R-sig-Geo] Repeat columns and rows of matrix
In-Reply-To: <536CC57C.60405@gmail.com>
References: <1399635217003-7586408.post@n2.nabble.com>
	<536CC57C.60405@gmail.com>
Message-ID: <alpine.LRH.2.03.1405091438490.31171@reclus.nhh.no>

If this question is related to an earlier one (LM tests for spatial panel 
data), I don't think that the correct expansion of W for T=2 is:

W W
W W

but rather

W 0
0 W

so a Kronecker product of W and diag(T). Here the output is sparse, and 
with T=9 and N=1K, this may be important, especially if W is sparse too. 
However, we don't know. So for now we need

M <- matrix(1, nrow=9, ncol=9)
W9 <- kronecker(W, M)

which answers the apparent question. However, I don't think that it was 
the intention.

Roger

On Fri, 9 May 2014, Jean-Daniel Sylvain wrote:

> Hi,
>
> You hould use the apply function function, which will apply the function 
> rep() on one of the dimension of your matrix (1 for row, and 2 for columns).
>
> mat <- matrix(data=1:100,10,10)
>
> apply(mat,MARGIN=1,function(x) rep(x,10))
> apply(mat,MARGIN=2,function(x) rep(x,10))
>
> Hope this helps,
>
> JD
>
> Le 5/9/2014 7:33 AM, az14 a ?crit :
>> Dear list,
>> i have a matrixW(1060*1060), i want to repeat each column and row 9 times,
>> such as to have a new matrix W1(9540*9540).
>> I use the code:
>> rep.row<-function(x,n){
>>     matrix(rep(x,each=n),nrow=n)
>> }
>> rep.col<-function(x,n){
>>     matrix(rep(x,each=n), ncol=n, byrow=TRUE)
>> }
>> 
>> ww<-rep.row(w,9)
>> W1<-rep.col(ww,9)
>> 
>> but i did not work!
>> 
>> Is there another way to do it ?
>> 
>> Any help would me appreciated.
>> Thank YOU.
>> 
>> 
>> 
>> --
>> View this message in context: 
>> http://r-sig-geo.2731867.n2.nabble.com/Repeat-columns-and-rows-of-matrix-tp7586408.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From abidi.zineb at gmail.com  Fri May  9 15:15:09 2014
From: abidi.zineb at gmail.com (az14)
Date: Fri, 9 May 2014 06:15:09 -0700 (PDT)
Subject: [R-sig-Geo] Repeat columns and rows of matrix
In-Reply-To: <alpine.LRH.2.03.1405091438490.31171@reclus.nhh.no>
References: <1399635217003-7586408.post@n2.nabble.com>
	<536CC57C.60405@gmail.com>
	<alpine.LRH.2.03.1405091438490.31171@reclus.nhh.no>
Message-ID: <1399641309742-7586411.post@n2.nabble.com>

Hi, acctually it's for the (LM tests for spatial panel data).
w is a distance matrix ( wih cut of 70km) . 
M <- matrix(1, nrow=9, ncol=9)
W9 <- kronecker(W, M)
I get this error: 

Erreur dans `dimnames<-.data.frame`(`*tmp*`, value = list(n)) : 
  invalid 'dimnames' given for data frame




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Repeat-columns-and-rows-of-matrix-tp7586408p7586411.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From tkeitt at utexas.edu  Fri May  9 16:39:48 2014
From: tkeitt at utexas.edu (Tim Keitt)
Date: Fri, 9 May 2014 09:39:48 -0500
Subject: [R-sig-Geo] Repeat columns and rows of matrix
In-Reply-To: <1399641309742-7586411.post@n2.nabble.com>
References: <1399635217003-7586408.post@n2.nabble.com>
	<536CC57C.60405@gmail.com>
	<alpine.LRH.2.03.1405091438490.31171@reclus.nhh.no>
	<1399641309742-7586411.post@n2.nabble.com>
Message-ID: <CANnL8gqdgTgG1AZ+HD1jQF0P5t-FYv1Hs5qX===JLaF6eCtyVA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140509/998c1d9b/attachment.pl>

From pep.bioalerts at gmail.com  Sat May 10 01:04:05 2014
From: pep.bioalerts at gmail.com (Josep M Serra diaz)
Date: Fri, 9 May 2014 16:04:05 -0700
Subject: [R-sig-Geo] Error when attempting to use rle in 'calc' in Raster
	package
Message-ID: <CAF8H1dczkFUGfc47RUy37C=vViOm5XcQt3VX=SZq+ZRVz+DoAw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140509/f01576be/attachment.pl>

From nevil.amos at gmail.com  Mon May 12 07:39:59 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Mon, 12 May 2014 15:39:59 +1000
Subject: [R-sig-Geo] Extract raster attributes ( factors) directly for points
Message-ID: <CAN9eD7m-qYTCuLvntvFCO-TayHERSaGW6qE-WtkfCJ6smykXcw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140512/dea36f2c/attachment.pl>

From richjh1916 at yahoo.com  Mon May 12 14:26:03 2014
From: richjh1916 at yahoo.com (richard hewitt)
Date: Mon, 12 May 2014 13:26:03 +0100 (BST)
Subject: [R-sig-Geo] allocate cells according to highest values across a
	raster stack
Message-ID: <1399897563.24149.YahooMailNeo@web172703.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140512/3c6e7639/attachment.pl>

From jgrn at illinois.edu  Mon May 12 15:53:08 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Mon, 12 May 2014 08:53:08 -0500
Subject: [R-sig-Geo] Extract raster attributes ( factors) directly for
	points
In-Reply-To: <CAN9eD7m-qYTCuLvntvFCO-TayHERSaGW6qE-WtkfCJ6smykXcw@mail.gmail.com>
References: <CAN9eD7m-qYTCuLvntvFCO-TayHERSaGW6qE-WtkfCJ6smykXcw@mail.gmail.com>
Message-ID: <CABG0rfs6FUngYgO1R1eshaRwsQgmr47HiU6K_snN+wT=r26a7g@mail.gmail.com>

Nevil:

I think if you:

extract(...,sp=TRUE) you'll get what you are looking for (that will
extract the values and place them into the data frame of the spatial
object -- you can always peel off the data.frame afterwards using e.g.
as.data.frame).

--j

On Mon, May 12, 2014 at 12:39 AM, nevil amos <nevil.amos at gmail.com> wrote:
> Is it possible to extract multiple values from  a raster attribute table
> (eg EVDEFG_RC2 at data@attributes[[1]][,4:7] directly to a data frame? or is
> it only possible by joining the raster attribute table to the extracted
> raster value?
>
> thanks
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From nevil.amos at gmail.com  Mon May 12 16:56:19 2014
From: nevil.amos at gmail.com (nevil amos)
Date: Tue, 13 May 2014 00:56:19 +1000
Subject: [R-sig-Geo] Extract raster attributes ( factors) directly for
	points
In-Reply-To: <CABG0rfs6FUngYgO1R1eshaRwsQgmr47HiU6K_snN+wT=r26a7g@mail.gmail.com>
References: <CAN9eD7m-qYTCuLvntvFCO-TayHERSaGW6qE-WtkfCJ6smykXcw@mail.gmail.com>
	<CABG0rfs6FUngYgO1R1eshaRwsQgmr47HiU6K_snN+wT=r26a7g@mail.gmail.com>
Message-ID: <CAN9eD7nteVAOq5-vgmohL-=bLddG7VJZqM=tj_w_Yo3pDBcwqA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140513/f4746a84/attachment.pl>

From Nicolas.Meurisse at scionresearch.com  Tue May 13 02:13:58 2014
From: Nicolas.Meurisse at scionresearch.com (Nicolas Meurisse)
Date: Tue, 13 May 2014 12:13:58 +1200
Subject: [R-sig-Geo] space-time class object with stConstruct
Message-ID: <D05D4B7D92946E468CA98F578A0D739F0C47AFAE64@v-rot-exch01.scion.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140513/5de1eedc/attachment.pl>

From belmont161 at gmail.com  Tue May 13 04:16:11 2014
From: belmont161 at gmail.com (Marcel Belmont)
Date: Tue, 13 May 2014 06:16:11 +0400
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 129, Issue 6
In-Reply-To: <mailman.11.1399370403.13171.r-sig-geo@r-project.org>
References: <mailman.11.1399370403.13171.r-sig-geo@r-project.org>
Message-ID: <CADisB6AwRpmB5Dji2VQ1xagtvX+Jdsm2bMQVAnjxGdT0H7P5PQ@mail.gmail.com>

Hi All,
       I've been looking at the lattice help section and on the web
for some assistance regarding putting my 'months' label in
chronological order on my graph but failed. Presently they are
displayed in alphabetical order when I use this script:-
require(latticeExtra)
require (lattice)
data(seychelles)
z <- read.csv("C:/Users/User/Desktop/Weather Scripts/seychelles.csv",
header = TRUE)

tempatures <- xyplot(min.temp + max.temp ~ day | month,
               data = z, type = "l", layout = c(3, 1))
rainfall <- xyplot(precip ~ day | month, data = z, type = "h", lwd = 4)

doubleYScale(tempatures, rainfall, style1 = 0, style2 = 3, add.ylab2 = TRUE,
   text = c("Min. T", "Max. T", "Rain"), columns = 3)

Any help would be much appreciated. Thanks.

M.Belmont

On 06/05/2014, r-sig-geo-request at r-project.org
<r-sig-geo-request at r-project.org> wrote:
> Send R-sig-Geo mailing list submissions to
> 	r-sig-geo at r-project.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
> 	https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> or, via email, send a message with subject or body 'help' to
> 	r-sig-geo-request at r-project.org
>
> You can reach the person managing the list at
> 	r-sig-geo-owner at r-project.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of R-sig-Geo digest..."
>
>
> Today's Topics:
>
>    1. Re: reading CRU files in .dat format into a data frame
>       (Remi Genevest)
>    2. Re: Export matrix weights to excel. (Rolando Valdez)
>    3. Re: Export matrix weights to excel. (Roger Bivand)
>    4. Re: BYM model in R-INLA - how to specify priors individually
>       (VIRGILIO GOMEZ RUBIO)
>    5. Decision tree classification of satellite image in R
>       (Anusheema Chakraborty)
>    6. Re: BYM model in R-INLA - how to specify priors individually
>       (James Rooney)
>    7. lAGRANGE MULTIPLIER Test and error in listw object (az14)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Mon, 5 May 2014 04:07:21 -0700 (PDT)
> From: Remi Genevest <rgenevest at free.fr>
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] reading CRU files in .dat format into a data
> 	frame
> Message-ID: <1399288041706-7586334.post at n2.nabble.com>
> Content-Type: text/plain; charset=us-ascii
>
> Well, thanks for this advice, but actually I already read this page.
> What I was looking for is close to the issue proposed in this post by
> Lionel
> :
> http://r-sig-geo.2731867.n2.nabble.com/Turning-SpatialPointsDataFrame-to-Raster-using-rasterize-td7582452.html
>
>
>
>
>
>
> --
> View this message in context:
> http://r-sig-geo.2731867.n2.nabble.com/reading-CRU-files-in-dat-format-into-a-data-frame-tp7586327p7586334.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
>
>
> ------------------------------
>
> Message: 2
> Date: Mon, 5 May 2014 12:20:39 -0500
> From: Rolando Valdez <rvaldezr at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Export matrix weights to excel.
> Message-ID: <989767EB-4AFB-4A1D-83D1-2697A36A4928 at gmail.com>
> Content-Type: text/plain; charset=windows-1252
>
> Yes, I got it.
>
> Now, I saw an issue in the matrix, I?ve got two regions with value 1 inside
> the matrix, if it is W style, how is it possible?. The rest of rows are
> standardized.
>
> Another question, the output follow the order of regions of the shape file,
> isn?t?
>
> Thank you
> El 04/05/2014, a las 12:46, Roger Bivand <Roger.Bivand at nhh.no> escribi?:
>
>> On Sat, 3 May 2014, Rolando Valdez wrote:
>>
>>> Hello,
>>>
>>> I'm working with a matrix weights, I want to know if I can export the
>>> output, to handle with excel.
>>>
>>> This is a part what I have:
>>>
>>>> zm <- readOGR(".", "zmdis?)
>>> OGR data source with driver: ESRI Shapefile
>>> Source: ".", layer: "zmdis"
>>> with 56 features and 8 fields
>>> Feature type: wkbPolygon with 2 dimensions
>>>> mapaxy = coordinates(zm)
>>>> wdist100 = dnearneigh(mapaxy, d1=0, d2=100000)
>>>> l100 = nb2listw(wdist100, style="W", zero.policy=T)
>>>> summary(l100, zero.policy=T)
>>> Characteristics of weights list object:
>>> Neighbour list object:
>>> Number of regions: 56
>>> Number of nonzero links: 86
>>> Percentage nonzero weights: 2.742347
>>> Average number of links: 1.535714
>>> 21 regions with no links:
>>> 3 6 11 13 14 15 16 24 25 27 28 35 36 38 41 47 48 51 52 53 54
>>> Link number distribution:
>>>
>>> 0  1  2  3  4  5  8
>>> 21 12 11  2  7  2  1
>>> 12 least connected regions:
>>> 1 5 7 17 19 20 21 30 33 34 45 55 with 1 link
>>> 1 most connected region:
>>> 37 with 8 links
>>>
>>> Weights style: W
>>> Weights constants summary:
>>>  n   nn S0       S1    S2
>>> W 35 1225 35 39.26667 147.3
>>>
>>> I want to get a matrix [56 x 56] to work in excel with it.
>>
>> ?listw2mat should help, then write the matrix in a form that Excel can
>> read. But note that your distance criterion leaves 21 of 56 observations
>> with no neighbours.
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> Thank you in advance.
>>>
>>> Rolando Valdez
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>
> Rolando Valdez
>
>
>
> ------------------------------
>
> Message: 3
> Date: Mon, 5 May 2014 19:51:16 +0200
> From: Roger Bivand <Roger.Bivand at nhh.no>
> To: Rolando Valdez <rvaldezr at gmail.com>
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Export matrix weights to excel.
> Message-ID: <alpine.LRH.2.03.1405051946520.16499 at reclus.nhh.no>
> Content-Type: text/plain; charset="windows-1252"; Format="flowed"
>
> On Mon, 5 May 2014, Rolando Valdez wrote:
>
>> Yes, I got it.
>>
>> Now, I saw an issue in the matrix, I?ve got two regions with value 1
>> inside the matrix, if it is W style, how is it possible?. The rest of
>> rows are standardized.
>
> You can "see" it, nobody else can. Are all the rowSums() of the matrix 1?
> If so, two of the observations only have one neighbour (maybe a pair
> linked only to each other). Why would this be unexpected if you are using
> distance-based neighbours?
>
>>
>> Another question, the output follow the order of regions of the shape
>> file, isn?t?
>
> They follow the order of the coordinate matrix you passed to dnearneigh(),
> but you can check this easily enough.
>
> Please do read the documentation, none of this is particularly difficult.
>
> Roger
>
>>
>> Thank you
>> El 04/05/2014, a las 12:46, Roger Bivand <Roger.Bivand at nhh.no> escribi?:
>>
>>> On Sat, 3 May 2014, Rolando Valdez wrote:
>>>
>>>> Hello,
>>>>
>>>> I'm working with a matrix weights, I want to know if I can export the
>>>> output, to handle with excel.
>>>>
>>>> This is a part what I have:
>>>>
>>>>> zm <- readOGR(".", "zmdis?)
>>>> OGR data source with driver: ESRI Shapefile
>>>> Source: ".", layer: "zmdis"
>>>> with 56 features and 8 fields
>>>> Feature type: wkbPolygon with 2 dimensions
>>>>> mapaxy = coordinates(zm)
>>>>> wdist100 = dnearneigh(mapaxy, d1=0, d2=100000)
>>>>> l100 = nb2listw(wdist100, style="W", zero.policy=T)
>>>>> summary(l100, zero.policy=T)
>>>> Characteristics of weights list object:
>>>> Neighbour list object:
>>>> Number of regions: 56
>>>> Number of nonzero links: 86
>>>> Percentage nonzero weights: 2.742347
>>>> Average number of links: 1.535714
>>>> 21 regions with no links:
>>>> 3 6 11 13 14 15 16 24 25 27 28 35 36 38 41 47 48 51 52 53 54
>>>> Link number distribution:
>>>>
>>>> 0  1  2  3  4  5  8
>>>> 21 12 11  2  7  2  1
>>>> 12 least connected regions:
>>>> 1 5 7 17 19 20 21 30 33 34 45 55 with 1 link
>>>> 1 most connected region:
>>>> 37 with 8 links
>>>>
>>>> Weights style: W
>>>> Weights constants summary:
>>>>  n   nn S0       S1    S2
>>>> W 35 1225 35 39.26667 147.3
>>>>
>>>> I want to get a matrix [56 x 56] to work in excel with it.
>>>
>>> ?listw2mat should help, then write the matrix in a form that Excel can
>>> read. But note that your distance criterion leaves 21 of 56 observations
>>> with no neighbours.
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>>
>>>> Thank you in advance.
>>>>
>>>> Rolando Valdez
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>
>> Rolando Valdez
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>
> ------------------------------
>
> Message: 4
> Date: Mon, 5 May 2014 22:40:54 +0000
> From: VIRGILIO GOMEZ RUBIO <Virgilio.Gomez at uclm.es>
> To: James Rooney <ROONEYJ4 at tcd.ie>
> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] BYM model in R-INLA - how to specify priors
> 	individually
> Message-ID: <1399329652.3461.3.camel at Virgilio-Gomez>
> Content-Type: text/plain; charset="iso-8859-15"
>
> Dear James,
>
> You should be able to set the prior of your random effects using hyper=
> in the call to f(). In your particular case, you can try:
>
> #Create areas IDs to match the values in nc.adj
> nc.sids$ID<-1:100
> nc.sids$ID2<-1:100
>
> hyper.besag <-list(prec=list(prior="loggamma", params=c(.1, .1)))
> hyper.iid<-list(prec=list(prior="loggamma", params=c(.001, .001)))
>
> #Besag model with random spatial effect (i.e. BYM model)
> m2<-inla(SID74~NWPROP+
>    f(nc.sids$ID, model="besag", graph="nc.adj", hyper=hyper.besag)+
>    f(nc.sids$ID2, model="iid", hyper=hyper.iid),
>  family="poisson", E=nc.sids$EXP, data=as.data.frame(nc.sids),
>  control.predictor=list(compute=TRUE))
>
>
> Note that I have defined two different indices. You can probably use
> model="bym" to simplify the formula in your model. Also, run
> inla.models()$latent$bym to know the default definitions of priors of
> the hyperparameters.
>
> Hope this helps.
>
> Virgilio
>
>
>
> ------------------------------
>
> Message: 5
> Date: Tue, 6 May 2014 12:07:25 +0530
> From: Anusheema Chakraborty <anusheema at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Decision tree classification of satellite image
> 	in R
> Message-ID:
> 	<CAH89e5yuQ9k66Ga9FJTYOpGad8T6USEXmSLTA_vq0mdOOS9bzA at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> Hi!
>
> I am trying to classify satellite image in R using RWeka classifier,
> J48. I have a CSV file with the classes required, and raster data
> loaded in R. I am able to make the tree, however, I am not able to use
> the same tree to classify my satellite image.
>
> Here's how it goes.
>
> inputfile=read.csv("E://R/Trial/naini.CSV")
> m1 <- J48(Class~B1+B2+B3+B4+B5+B7, data = inputfile)
> if(require("party", quietly = TRUE)) plot(m1)
> raster<- brick("merge.tif")
> plotRGB(raster, 4, 3, 2, stretch="hist")
>
> And then I am attempting to use the tree generated to classify my
> satellite image, but I keep getting errors.
>
> predict (test_new, J48, filename=out_classify,
> progress='text',format='GTiff', datatype='FLT4S', type='response',
> overwrite=TRUE)
> Error in trim(filename) : error in evaluating the argument 'x' in
> selecting a method for function 'trim': Error: object 'out_classify'
> not found
>
> And if I change the arguments, this is what I get. I am not sure how
> to proceed from this point forward.
>
> predict (J48, test_new, filename=out_classify,
> progress='text',format='GTiff', datatype='FLT4S', type='response',
> overwrite=TRUE)
> Error in UseMethod("predict") : no applicable method for 'predict'
> applied to an object of class "c('R_Weka_classifier_interface',
> 'R_Weka_interface')"
>
> I am new to R, so I might take a while to decipher your answers. Any
> help would be greatly appreciated!
>
> Thanks!
>
>
> Best,
> Anusheema.
>
>
>
> --
> Regards
>
> Anusheema Chakraborty
> Ph.D. Scholar
> Department of Natural Resources, TERI University
> 10, Institutional Area, Vasant Kunj, New Delhi - 110070
> Website: www.teriuniversity.ac.in
>
>
>
> ------------------------------
>
> Message: 6
> Date: Tue, 6 May 2014 08:08:26 +0100
> From: James Rooney <ROONEYJ4 at tcd.ie>
> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] BYM model in R-INLA - how to specify priors
> 	individually
> Message-ID:
> 	<75C8D19A1470D344A8AF5312F01160A602BC2BCC892E at GOMAIL.college.tcd.ie>
> Content-Type: text/plain; charset="us-ascii"
>
> Dear Virgilio,
>
> Many thanks - yes that is helpful!
> However in my own dataset I am finding those values lead to an oversmoothed
> model - i.e. the output is very uniform - practically flat across all areas.
> But I know from BUGS smoothing and also from cluster analysis that there
> should be areas of variation.
> What is if that controls the "degree of smoothing" for want of a better
> term!
>
> Many thanks,
> James
>
> ________________________________________
> From: VIRGILIO GOMEZ RUBIO [Virgilio.Gomez at uclm.es]
> Sent: 05 May 2014 23:40
> To: James Rooney
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] BYM model in R-INLA - how to specify priors
> individually
>
> Dear James,
>
> You should be able to set the prior of your random effects using hyper=
> in the call to f(). In your particular case, you can try:
>
> #Create areas IDs to match the values in nc.adj
> nc.sids$ID<-1:100
> nc.sids$ID2<-1:100
>
> hyper.besag <-list(prec=list(prior="loggamma", params=c(.1, .1)))
> hyper.iid<-list(prec=list(prior="loggamma", params=c(.001, .001)))
>
> #Besag model with random spatial effect (i.e. BYM model)
> m2<-inla(SID74~NWPROP+
>    f(nc.sids$ID, model="besag", graph="nc.adj", hyper=hyper.besag)+
>    f(nc.sids$ID2, model="iid", hyper=hyper.iid),
>  family="poisson", E=nc.sids$EXP, data=as.data.frame(nc.sids),
>  control.predictor=list(compute=TRUE))
>
>
> Note that I have defined two different indices. You can probably use
> model="bym" to simplify the formula in your model. Also, run
> inla.models()$latent$bym to know the default definitions of priors of
> the hyperparameters.
>
> Hope this helps.
>
> Virgilio
>
>
>
> ------------------------------
>
> Message: 7
> Date: Tue, 6 May 2014 02:10:14 -0700 (PDT)
> From: az14 <abidi.zineb at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] lAGRANGE MULTIPLIER Test and error in listw
> 	object
> Message-ID: <1399367414246-7586372.post at n2.nabble.com>
> Content-Type: text/plain; charset=us-ascii
>
> Dear List,
> I 'm trying to run  the Lagrange multiplier test (LM Test) using R.
> so i import my data file(don) and do an lm regression as bellow:
>
> don<-read.csv("donnees2.csv",header=TRUE,sep=";",dec=",")widad.lm<-lm(coop~dens_t1+perchom_t1+percvieux_t1+psdc_t1,data=don)
>> summary(widad.lm)
>
> Then i import my distance matrix( 1056*1056).
>
>
> matrice<-read.csv("matw2.csv",header=FALSEE,sep=";",dec=",")
>  mat<-do.call(rbind,matrice)
> dim(mat)
> is.matrix(mat)
> True
>  mat2<-mat%*%mat
>> dim(mat2)
> [1] 1056 1056
>> x <- mat2listw(mat2)
> When i run the LM test; with an nb2listw object, i get this error:
>
>  lm.LMtests(widad.lm,nb2listw(x$neighbours, glist=x$weights,
> style="W"),test=c("LMerr","RLMerr"))
> Erreur dans subset.listw(listw, subset, zero.policy = zero.policy) :
>   /Not yet able to subset general weights lists
> I tryed to do it with mat2listw, but i get error too.
>
> lm.LMtests(widad.lm, mat2listw(mat2),test=c("LMerr","RLMerr"))
> Erreur dans subset.listw(listw, subset, zero.policy = zero.policy) :
>   Not yet able to subset general weights lists
>
>
> Any help would be appreciated.
> Thank you.
> Zineb.
>
>
>
>
> --
> View this message in context:
> http://r-sig-geo.2731867.n2.nabble.com/lAGRANGE-MULTIPLIER-Test-and-error-in-listw-object-tp7586372.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
>
>
> ------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> End of R-sig-Geo Digest, Vol 129, Issue 6
> *****************************************
>


From srinivasv at feralindia.org  Tue May 13 12:11:43 2014
From: srinivasv at feralindia.org (Srinivas V)
Date: Tue, 13 May 2014 15:41:43 +0530
Subject: [R-sig-Geo] Error in clusterR
Message-ID: <5371EFDF.3030201@feralindia.org>

Hi,

I wrote a code which uses clusterR to run a function on multiple CPUs to 
process MODIS 16 day dataset. The function converts a brick to 
dataframe. The existing commands to do this in package raster is very 
slow on large datasets, therefore I'm attempting to use the multicore 
option to speed up the process.

I get the following error
Error in clusterR(n1, qckextract) : cluster error

I would appreciate your advice on to fix the function. Thanks!


library(raster)

n1<-brick("ndvih25v08masked.grd")

beginCluster(nice=20)
nodes <- length(getCluster())
bs <- blockSize(n1, minblocks=nodes*4)

qckextract <- function(i) {
   for (i in 1:length(bs$n)) {
     e<- extent(xmin(x), xmax(x), yFromRow(x, bs$row[i]+bs$nrows[i]-1) - 
0.5 * yres(x), yFromRow(x, bs$row[i])+0.5 * yres(x))
     n <- cellsFromExtent(x,e)
     v <- (getValues(x, bs$row[i], bs$nrows[i]))/10000
     v<-as.data.frame(v)
     v<- as.data.frame(cbind(n,v))
   }
   return(v)
}

nx<-clusterR(n1,qckextract)
endCluster()

-- 

Srinivas Vaidyanathan
Senior Research Fellow
Foundation for Ecological Research, Advocacy & Learning
India.

Web:www.feralindia.org


From jgrn at illinois.edu  Tue May 13 18:30:27 2014
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 13 May 2014 11:30:27 -0500
Subject: [R-sig-Geo] Error in clusterR
In-Reply-To: <5371EFDF.3030201@feralindia.org>
References: <5371EFDF.3030201@feralindia.org>
Message-ID: <CABG0rfuLkkS2PSzQqSvRm7MNZkc7OS67_bBEqvxjWZkR2e56bA@mail.gmail.com>

Srinivas:

Can you explain, more generally, what you are trying to accomplish?
It seems like you are just trying to get a list-of-dataframes from the
MODIS pixels.  It might be easier to do something like this with the
package "foreach".  Keep in mind reading/write is often I/O limited,
so you may not see any performance gain reading in parallel.

I'd also recommend looking at "rasterEngine" in my spatial.tools
package.  Here's a tutorial on how to use it:

http://publish.illinois.edu/jgrn/software-and-datasets/rasterengine-tutorial/

--j

On Tue, May 13, 2014 at 5:11 AM, Srinivas V <srinivasv at feralindia.org> wrote:
> Hi,
>
> I wrote a code which uses clusterR to run a function on multiple CPUs to
> process MODIS 16 day dataset. The function converts a brick to dataframe.
> The existing commands to do this in package raster is very slow on large
> datasets, therefore I'm attempting to use the multicore option to speed up
> the process.
>
> I get the following error
> Error in clusterR(n1, qckextract) : cluster error
>
> I would appreciate your advice on to fix the function. Thanks!
>
>
> library(raster)
>
> n1<-brick("ndvih25v08masked.grd")
>
> beginCluster(nice=20)
> nodes <- length(getCluster())
> bs <- blockSize(n1, minblocks=nodes*4)
>
> qckextract <- function(i) {
>   for (i in 1:length(bs$n)) {
>     e<- extent(xmin(x), xmax(x), yFromRow(x, bs$row[i]+bs$nrows[i]-1) - 0.5
> * yres(x), yFromRow(x, bs$row[i])+0.5 * yres(x))
>     n <- cellsFromExtent(x,e)
>     v <- (getValues(x, bs$row[i], bs$nrows[i]))/10000
>     v<-as.data.frame(v)
>     v<- as.data.frame(cbind(n,v))
>   }
>   return(v)
> }
>
> nx<-clusterR(n1,qckextract)
> endCluster()
>
> --
>
> Srinivas Vaidyanathan
> Senior Research Fellow
> Foundation for Ecological Research, Advocacy & Learning
> India.
>
> Web:www.feralindia.org
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From Dominik.Schneider at colorado.edu  Tue May 13 20:19:51 2014
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Tue, 13 May 2014 12:19:51 -0600
Subject: [R-sig-Geo] spatial modelling projection question
Message-ID: <CAHYDKLYjqOpy7Ed+RvSEHDmG8SFYi2kO_7jTHFZbQbgXjK3XKQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140513/0ad87fd5/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue May 13 20:32:47 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 13 May 2014 20:32:47 +0200
Subject: [R-sig-Geo] spatial modelling projection question
In-Reply-To: <CAHYDKLYjqOpy7Ed+RvSEHDmG8SFYi2kO_7jTHFZbQbgXjK3XKQ@mail.gmail.com>
References: <CAHYDKLYjqOpy7Ed+RvSEHDmG8SFYi2kO_7jTHFZbQbgXjK3XKQ@mail.gmail.com>
Message-ID: <5372654F.5040403@uni-muenster.de>



On 05/13/2014 08:19 PM, Dominik Schneider wrote:
> so my question is: Wouldn't it make more sense to do spatial modeling with
> a true distance projection, i.e. longlat, than an equal area projection for
> which distances are skewed? What makes the variogram model potentially

I would say yes, but haven't given it much thought.

> inappropriate on a sphere (overlooking the fact that the earth isn't really
> a sphere)?

Some variogram models are not positive definite (or semi-negative
definite) in some spaces; linear-with-sill is only valid in 1 D,
circular only in 2D, spherical only in 3D. Spheres, or ellipsoides, are
another thing when measuring surface lines.

See also http://dx.doi.org/10.1007/s11004-011-9344-7
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140513/a1b42c2b/attachment.bin>

From rshepard at appl-ecosys.com  Tue May 13 20:53:08 2014
From: rshepard at appl-ecosys.com (Rich Shepard)
Date: Tue, 13 May 2014 11:53:08 -0700 (PDT)
Subject: [R-sig-Geo] spatial modelling projection question
In-Reply-To: <CAHYDKLYjqOpy7Ed+RvSEHDmG8SFYi2kO_7jTHFZbQbgXjK3XKQ@mail.gmail.com>
References: <CAHYDKLYjqOpy7Ed+RvSEHDmG8SFYi2kO_7jTHFZbQbgXjK3XKQ@mail.gmail.com>
Message-ID: <alpine.LNX.2.11.1405131142440.11126@localhost>

On Tue, 13 May 2014, Dominik Schneider wrote:

> Most people suggest longlat is not  a proper 'projection' for
> geostatistics ...

Dominik,

   longlat represent geographic coordinates, not a projection of
3-dimensional points on Earth to a 2-dimensional representation on paper or
a computer monitor.

> The standard projection for a domain my size/geographic location seems to
> be the conus albers from USGS (epsg:5070) which is an equal area
> projection so my question is: Wouldn't it make more sense to do spatial
> modeling with a true distance projection, i.e. longlat, than an equal area
> projection for which distances are skewed?

   What question(s) are you trying to answer with your data? Depending on the
size of the area analyzed you might find that UTM or State Plane Feet are
better projections for your use.

> What makes the variogram model potentially inappropriate on a sphere
> (overlooking the fact that the earth isn't really a sphere)? I appreciate
> your help understanding this.

   Every datum (e.g., NAD83 or NAD27; the North American Datums calculated in
the noted year) has errors because the Earth is neither a sphere or a
smooth ellipsoid.

   I highly recommend your studying Snyder, J.P. 1987. Map projections -- A
Working Manual. USGS Professional Paper 1395. It went out of print in the
early 1990s but is considered the benchmark for topographic map projections.
You can also read the documentation for Proj4, but John Snyder's monograph
will greatly increase your understanding.

   Understanding projections will help you select the most appropriate one
for each question you want to answer. You also need to be aware of what
happens when your analytical area is across two zones.

HTH,

Rich

-- 
Richard B. Shepard, Ph.D.        | Technically sound and legally defensible
Applied Ecosystem Services, Inc. | ... guaranteed.
www.appl-ecosys.com      Voice: 503-667-4517         Fax: 503-667-8863


From andrew.bernj at gmail.com  Wed May 14 00:04:39 2014
From: andrew.bernj at gmail.com (Andrew Bernj)
Date: Tue, 13 May 2014 18:04:39 -0400
Subject: [R-sig-Geo] Random polygon maps or dividing a polygon randomly
Message-ID: <CAJQosKfjGWQdpYNEU0SPKjhT=qq3TGtWFCJrXTC8_1Yqc59Khg@mail.gmail.com>

Dear list,

I write you to ask if anyone knows of any package, function, or code
to generate random polygon maps? Of course, a simpler and also good
enough solution for me would be any way to divide/split a single
polygon randomly into other polygons.

I am willing to code it myself either in R or Python if necessary, but
I fell that similar things probably have been tried so far and would
not like to overlap on those.

Thanks for your insights.

Bernj


From r.turner at auckland.ac.nz  Wed May 14 00:31:37 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Wed, 14 May 2014 10:31:37 +1200
Subject: [R-sig-Geo] Random polygon maps or dividing a polygon randomly
In-Reply-To: <CAJQosKfjGWQdpYNEU0SPKjhT=qq3TGtWFCJrXTC8_1Yqc59Khg@mail.gmail.com>
References: <CAJQosKfjGWQdpYNEU0SPKjhT=qq3TGtWFCJrXTC8_1Yqc59Khg@mail.gmail.com>
Message-ID: <53729D49.50709@auckland.ac.nz>

On 14/05/14 10:04, Andrew Bernj wrote:
> Dear list,
>
> I write you to ask if anyone knows of any package, function, or code
> to generate random polygon maps? Of course, a simpler and also good
> enough solution for me would be any way to divide/split a single
> polygon randomly into other polygons.
>
> I am willing to code it myself either in R or Python if necessary, but
> I fell that similar things probably have been tried so far and would
> not like to overlap on those.

How random?  Random in what way?  You can always generate a random point 
pattern and then form the Dirichlet/Voronoi tessellation of that 
pattern.  Is that random enough for you?  If so, the facilities are 
provided in the "spatstat" package (and in a more limited way in the 
"deldir" package that gets used by spatstat for the guts of the 
tessellation calculation).  Note that the polygons generated are all convex.

cheers,

Rolf Turner


From mdsumner at gmail.com  Wed May 14 02:35:47 2014
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 14 May 2014 10:35:47 +1000
Subject: [R-sig-Geo] spatial modelling projection question
In-Reply-To: <alpine.LNX.2.11.1405131142440.11126@localhost>
References: <CAHYDKLYjqOpy7Ed+RvSEHDmG8SFYi2kO_7jTHFZbQbgXjK3XKQ@mail.gmail.com>
	<alpine.LNX.2.11.1405131142440.11126@localhost>
Message-ID: <CAAcGz99S5Uv3YZqJpTAFp00S0LBViwdmX68g5yb3YtJ_0184xA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140514/e6e79774/attachment.pl>

From Jin.Li at ga.gov.au  Wed May 14 03:01:31 2014
From: Jin.Li at ga.gov.au (Jin.Li at ga.gov.au)
Date: Wed, 14 May 2014 01:01:31 +0000
Subject: [R-sig-Geo] [DKIM] Re: spatial modelling projection question
	[SEC=UNCLASSIFIED]
Message-ID: <d2ab75a82b9948d5bcf982b754349f7f@WIN-EXCH01.agso.gov.au>

The effects of spatial reference systems on the predictive accuracy have been preliminarily tested recently. Please see 
W. Jiang, J. Li. 2013. Are Spatial Modelling Methods Sensitive to Spatial Reference Systems for Predicting Marine Environmental Variables? In: International Congress on Modelling and Simulation (MODSIM) 2013, Adelaide. Dec. 2013.
W. Jiang & J. Li. 2014. The effects of spatial reference systems on the predictive accuracy of spatial interpolation methods. Geoscience Australia, Record 2014/01, 33p.
They are freely available online. Any comments are appreciated!
Cheers,
Jin

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Michael Sumner
Sent: Wednesday, 14 May 2014 10:36 AM
To: Rich Shepard
Cc: r-sig-Geo at r-project.org
Subject: [DKIM] Re: [R-sig-Geo] spatial modelling projection question

On Wed, May 14, 2014 at 4:53 AM, Rich Shepard <rshepard at appl-ecosys.com>wrote:

> On Tue, 13 May 2014, Dominik Schneider wrote:
>
>  Most people suggest longlat is not  a proper 'projection' for
>> geostatistics ...
>>
>
> Dominik,
>
>   longlat represent geographic coordinates, not a projection of 
> 3-dimensional points on Earth to a 2-dimensional representation on 
> paper or a computer monitor.
>
>

I believe that Dominik is referring to the fact that with longlat we can use ellipsoid calculations for distance, which cover the most general solution for "most accurate" across many situations. There are many map projections that are more suitable for given applications, but then the general confidence about Cartesian distances is gone: we need to be careful that our distance calcs are appropriate within the constraints of that projection. Any equi-distant projection can provide best accuracy only within specific constraints.  (This is not true for area, those can be always accurate in an equal-area projection albeit with loss of conformality and usual numeric/topology constraints).

I think the only general solution is to back-transform and use the ellipsoid for distance, unless you can be sure that the Cartesian methods match your needs in the projection being used.  The only way to match ellipsoid accuracy is to generate a local unique equi-distant projection for each distance segment and measure from its centre to the other point.
(I think Manifold does this internally for the interactive distance-measuring Tracker tool when you toggle the ellipsoid key. ).

I've been bothered by this for a while, especially with such a wide use of UTM out there. I think you always need to be concerned about it, and do some checks across your region/application to make sure Cartesian distance is good enough when you have chosen a projection for other properties.  If you can forget the need for expensive ellipsoid calculations or many local equidistant projections it's obviously going to be more efficient.

Cheers, Mike.







>
>  The standard projection for a domain my size/geographic location 
> seems to
>> be the conus albers from USGS (epsg:5070) which is an equal area 
>> projection so my question is: Wouldn't it make more sense to do 
>> spatial modeling with a true distance projection, i.e. longlat, than 
>> an equal area projection for which distances are skewed?
>>
>
>   What question(s) are you trying to answer with your data? Depending 
> on the size of the area analyzed you might find that UTM or State 
> Plane Feet are better projections for your use.
>
>
>  What makes the variogram model potentially inappropriate on a sphere
>> (overlooking the fact that the earth isn't really a sphere)? I 
>> appreciate your help understanding this.
>>
>
>   Every datum (e.g., NAD83 or NAD27; the North American Datums 
> calculated in the noted year) has errors because the Earth is neither 
> a sphere or a smooth ellipsoid.
>
>   I highly recommend your studying Snyder, J.P. 1987. Map projections 
> -- A Working Manual. USGS Professional Paper 1395. It went out of 
> print in the early 1990s but is considered the benchmark for 
> topographic map projections.
> You can also read the documentation for Proj4, but John Snyder's 
> monograph will greatly increase your understanding.
>
>   Understanding projections will help you select the most appropriate 
> one for each question you want to answer. You also need to be aware of 
> what happens when your analytical area is across two zones.
>
> HTH,
>
> Rich
>
> --
> Richard B. Shepard, Ph.D.        | Technically sound and legally defensible
> Applied Ecosystem Services, Inc. | ... guaranteed.
> www.appl-ecosys.com      Voice: 503-667-4517         Fax: 503-667-8863
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



--
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Geoscience Australia Disclaimer: This e-mail (and files transmitted with it) is intended only for the person or entity to which it is addressed. If you are not the intended recipient, then you have received this e-mail by mistake and any use, dissemination, forwarding, printing or copying of this e-mail and its file attachments is prohibited. The security of emails transmitted cannot be guaranteed; by forwarding or replying to this email, you acknowledge and accept these risks.


From fabriciovasselai at gmail.com  Wed May 14 06:11:16 2014
From: fabriciovasselai at gmail.com (Fabricio Vasselai)
Date: Wed, 14 May 2014 00:11:16 -0400
Subject: [R-sig-Geo] Random polygon maps or dividing a polygon randomly
In-Reply-To: <53729D49.50709@auckland.ac.nz>
References: <CAJQosKfjGWQdpYNEU0SPKjhT=qq3TGtWFCJrXTC8_1Yqc59Khg@mail.gmail.com>
	<53729D49.50709@auckland.ac.nz>
Message-ID: <CAEkXS9LdJAgFFeVShvYn9cxB1vRs=pCk4+x2T8BVp_-i9825kQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140514/605a7a68/attachment.pl>

From fabriciovasselai at gmail.com  Wed May 14 06:59:28 2014
From: fabriciovasselai at gmail.com (Fabricio Vasselai)
Date: Wed, 14 May 2014 00:59:28 -0400
Subject: [R-sig-Geo] Still a bug when converting from tess to spatial
	polygon (sp) format?
Message-ID: <CAEkXS9+cTvPYikuxVS6Tu31cz7UUtzEROGqN8xxUebJSc9rQ9A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140514/69acc2a1/attachment.pl>

From Roger.Bivand at nhh.no  Wed May 14 09:21:14 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 14 May 2014 09:21:14 +0200
Subject: [R-sig-Geo] Still a bug when converting from tess to spatial
 polygon (sp) format?
In-Reply-To: <CAEkXS9+cTvPYikuxVS6Tu31cz7UUtzEROGqN8xxUebJSc9rQ9A@mail.gmail.com>
References: <CAEkXS9+cTvPYikuxVS6Tu31cz7UUtzEROGqN8xxUebJSc9rQ9A@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1405140905030.4115@reclus.nhh.no>

On Wed, 14 May 2014, Fabricio Vasselai wrote:

> Dear all,
>
>
> After playing around with the tessellation functions of the spatstat
> package to reply to a previous question on the list, I realized that there
> seems to be something odd when converting from tess format to spatial
> polygon format.
>
> Usually, spatial polygonal shapefiles read into R with functions like
> readShapePoly or readOGR, are objects which have a slot called "data", that
> can be assessed with @data and has the format of a data.frame. In there,
> each polygonal feature of the map is a row, while the columns are the
> variables that are eventually present in the shapefiles's data. Therefore,
> if you try to check names() of a spatial polygon object read from a
> shapefile, you get these columns, while row() gives you the polygon
> features present in the map.

Why is this a surprise? There are *two* classes for each Spatial* object, 
the geometries (SpatialPoints, SpatialLines, SpatialPolygons, SpatialGrid, 
SpatialPixels), and each of these can be extended have attributes/fields 
in a data.frame object in the data slot of Spatial*DataFrame objects. This 
has always been like this, since:

Edzer J. Pebesma and Roger S. Bivand. Classes and methods for spatial data 
in R. R News, 5(2):9-13, November 2005

http://cran.r-project.org/doc/Rnews/Rnews_2005-2.pdf

There is also a vignette:

http://cran.r-project.org/web/packages/sp/vignettes/intro_sp.pdf

The real question is why anyone would expect a tesselation geometry to 
have attributes. If a tesselation has attributes/marks, then it would be 
worth writing a method to coerce to SpatialPolygonsDataFrame, for example 
for E in the examples in ?tess. But here:

> Esp <- as(E, "SpatialPolygons")
> length(Esp)
[1] 11
> row.names(Esp)
  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k"

already preserves the levels, so I don't see a use case for such a method. 
If you can suggest one and contribute a coercion method, it could be added 
to maptools.

Hope this clarifies,

Roger


>
> However, when converting a tess object generated by spatstat to shape
> polygon, by using the as( , "SpatialPolygons"), things look quite
> different. First, no slot called data is created. Second, if you try
> names() on the converted object, you will get each polygon features and
> with row(), you get nothing. This looks odd, since the features should be
> the rows of a data.frame-like slot, shouldn't them?
>
> Here it goes a reproducible example:
>
> ###Code begins here
>
> #Let's first read a shp map for comparison
>
> vectors.path <- system.file("vectors", package = "rgdal")[1]
> loaded.map <- readShapePoly(paste(vectors.path, "/scot_BNG.shp", sep=""))
> plot(loaded.map)      #looking at the loaded map
> class(loaded.map)      #checking if it is of the class we want
>
> #Now let's generate a shp map from tessellation
>
> randompoints <- rpoint(100)      #generate random spatial points
> random.map.tess <- dirichlet(randompoints)      #tessellate the points
> random.map <- as(random.map.tess, "SpatialPolygons")      #convert to shape
> polygon
> plot(random.map)      #looking at the random generated map
> class(random.map)      #checking if it is of the class we want
>
>
> #Finally, let's compare both polygon shape objects:
>
> names(loaded.map)
> names(random.map)
>
> row(loaded.map)
> row(random.map)
>
> nrow(loaded.map)
> nrow(random.map)
>
> ncol(loaded.map)
> ncol(random.map)
>
> View(loaded.map at data)
> View(random.map at data)
>
> ###End of code
>
>
> Notice how things look different for the same sp objects when loading them
> or creating from a tess converted object.  I mean, I am not sure whether
> this is really a bug or it is normal and if yes, why does it happen (that's
> why the subject of this email is a question, not an affirmative sentence),
> but I though it was worth bringing to you all since it can be confusing.
> Anyway, is there any way we can convert tess objects to a sp object in the
> pattern a shapefile map is read, i.e. with the "data" slot and with the
> polygon features as rows, no as columns?
>
> As always, thank you all for your time.
>
> Best,
>
> Fabricio Vasselai
> CPS-University of Michigan
> University of S??o Paulo
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From hengl at spatial-analyst.net  Wed May 14 12:20:46 2014
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 14 May 2014 12:20:46 +0200
Subject: [R-sig-Geo] Spatio temporal Kriging
In-Reply-To: <CAA2guuz+Xb9BTOYSbP-gEwJv+G2om959x-0q2LbSFY7tR7mZWQ@mail.gmail.com>
References: <CAA2guuz+Xb9BTOYSbP-gEwJv+G2om959x-0q2LbSFY7tR7mZWQ@mail.gmail.com>
Message-ID: <5373437E.3030806@spatial-analyst.net>


Technically speaking it is OK to predict in future (prepare a stfdfObj 
object with spacetime coordinates in future, then run krigeST), but I 
would assume that the prediction variance will be large (well this 
depends on your variogram / temporal nugget and temporal range of 
spatial autocorrelation). Consider for example the prediction models for 
weather in the Netherlands: 
http://www.knmi.nl/waarschuwingen_en_verwachtingen/ensemble.html
As you get further from the measurement horizon, the confidence limits 
become wider and wider.

Also, I do not know how much is krigeST applicable to non-Gaussian data.

PS: Sending more focused questions that refer to some specific line in 
the code / or specific topic of broad interest are usually more 
efficient on R-sig-geo (see: "Do your homework before posting" in 
http://www.r-project.org/posting-guide.html).

T. (Tom) Hengl
Url: http://www.wageningenur.nl/en/Persons/dr.-T-Tom-Hengl.htm
Network: http://profiles.google.com/tom.hengl
Publications: http://scholar.google.com/citations?user=2oYU7S8AAAAJ

On 9-5-2014 12:55, Franklin Tchakounte wrote:
> Hello
>
> i am exercising (would like) to use spatiotemporal kriging to predict
> in the future the rate of populations in neighborhoods in towns. I
> have values for population rate in 2011, 2012, 2013, 2014 for many
> neighbourhoods and i need to know the corresponding values in 2015 and
> 2016 with the spatio temporal kriging using R.
> I would to know (if possible) how to apply extrapolation (spatio
> temporal kriging) with R from the beginning to the end.
>
> i have attached the actual R code with the help of Graeler and data file.
>
> Thank you a lot
>
> Franklin
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From samantha.franks at bto.org  Wed May 14 13:52:57 2014
From: samantha.franks at bto.org (sfranks)
Date: Wed, 14 May 2014 04:52:57 -0700 (PDT)
Subject: [R-sig-Geo] Error using extract() for raster - NAs are not allowed
 as part of subscripted assignments
Message-ID: <1400068377143-7586434.post@n2.nabble.com>

Hi,

I'm trying to extract data from the Europe CORINE land cover raster.

> r
class       : RasterLayer 
dimensions  : 46000, 59000, 2.714e+09  (nrow, ncol, ncell)
resolution  : 100, 100  (x, y)
extent      : 1500000, 7400000, 9e+05, 5500000  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000
+ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
data source : C:\Users\samf\Documents\Git\cuckoos\data\corine raster
100x100\g100_06.tif 
names       : g100_06 
values      : 0, 255  (min, max)

I have 3 spatial polygons for which I want to extract raster values.

> randomstop
class       : SpatialPolygons 
features    : 3 
extent      : 2997503, 3946661, 1857532, 3090567  (xmin, xmax, ymin, ymax)
coord. ref. : +init=epsg:3035 +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000
+y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

When I try to extract, I get the following error message:

> extract(r, randomstop)
Error in .readCellsGDAL(x, uniquecells, layers) : 
  NAs are not allowed in subscripted assignments

I have extracted each polygon separately, and I know which one is causing
the error.  When I create a new raster using crop() to the same extent as
the problem polygon, it extracts fine.  Also, when I crop r to the extent of
randomstop (all 3 polygons), it also extracts fine.  But there doesn't seem
to be an obvious problem with the extent of r in relation to the extent of
randomstop.

> extent(r)
class       : Extent 
xmin        : 1500000 
xmax        : 7400000 
ymin        : 9e+05 
ymax        : 5500000 
> extent(randomstop)
class       : Extent 
xmin        : 2997503 
xmax        : 3946661 
ymin        : 1857532 
ymax        : 3090567 

I can build crop() into the code to solve the problem and extract my values,
but I'm still mystified as to what the root cause of the error is.

Thanks in advance,
Samantha



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-using-extract-for-raster-NAs-are-not-allowed-as-part-of-subscripted-assignments-tp7586434.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Dominik.Schneider at colorado.edu  Wed May 14 14:43:20 2014
From: Dominik.Schneider at colorado.edu (dschneiderch)
Date: Wed, 14 May 2014 05:43:20 -0700 (PDT)
Subject: [R-sig-Geo] spatial modelling projection question
In-Reply-To: <CAHYDKLYjqOpy7Ed+RvSEHDmG8SFYi2kO_7jTHFZbQbgXjK3XKQ@mail.gmail.com>
References: <CAHYDKLYjqOpy7Ed+RvSEHDmG8SFYi2kO_7jTHFZbQbgXjK3XKQ@mail.gmail.com>
Message-ID: <1400071400265-7586435.post@n2.nabble.com>

thanks for everyone's input. I have looked through the USGS publication but
will also check out those articles. I suppose, like with everything, some
sensitivity tests for the variogram models is in order.  My domain is the
Upper Colorado River basin and covers 4 UTM zones (12,13: S, T) which is why
I haven't used UTM. I am working with estimating a distributed snow surface
at 500m. Given the size of the domain, most geostats is fairly intensive so
moving to a cartesian projection like 5070 might speed things up which is
something I had not thought of and might be worth it alone.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spatial-modelling-projection-question-tp7586423p7586435.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jwesroberts at gmail.com  Wed May 14 16:10:34 2014
From: jwesroberts at gmail.com (Wesley Roberts)
Date: Wed, 14 May 2014 16:10:34 +0200
Subject: [R-sig-Geo] Clip a polyline with a Polygon
Message-ID: <CAFik=FcV4wJttvBxjNTK1xSt9oHNfSa6mjHy+BLsbbftZyercQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140514/608e76e0/attachment.pl>

From bakare at ualberta.ca  Wed May 14 17:53:41 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Wed, 14 May 2014 09:53:41 -0600
Subject: [R-sig-Geo] practical range for kriging interpolation or not
Message-ID: <CAJRR3XPsiaCSAzGnykcQj8g=tj4m9gJ8t_HCPNT+xsB02sEa=Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140514/0af1f306/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed May 14 18:08:16 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 14 May 2014 18:08:16 +0200
Subject: [R-sig-Geo] practical range for kriging interpolation or not
In-Reply-To: <CAJRR3XPsiaCSAzGnykcQj8g=tj4m9gJ8t_HCPNT+xsB02sEa=Q@mail.gmail.com>
References: <CAJRR3XPsiaCSAzGnykcQj8g=tj4m9gJ8t_HCPNT+xsB02sEa=Q@mail.gmail.com>
Message-ID: <537394F0.2030402@uni-muenster.de>



On 05/14/2014 05:53 PM, Moshood Agba Bakare wrote:
> Dear All,
> The range obtained from fitting an exponential function to empirical
> variogram using gstat library of R is 5.5 m. This indicates that the
> practical range is  5.5 x 3 = 16.5 m indicating a pair of sample yield
> points whose distance is beyond 16.5 m is uncorrelated.
> 
> what will be the value of maxdist option of krige function to produce
> estimated values within the grid? I thought of using maxdist=16.5 as my
> search radius in interpolation so that a data point beyond 16.5 m will
> not be used in interpolation. Am I right to use the practical range
> (16.5) or the original range (5.5) obtained directly from fitting the
> exponential model?
> 
> Thank you.
> 

Using 16.5 makes more sense than 5.5, but I've never heard statisticians
confirm that this would be good practice.

The exponential variogram decreases asymptotically to zero correlation,
so correlation is not zero at distance 16.5.

Points far away, at very low spatial correlation distances, are still
taken into account for estimating the mean (ordinary kriging) or mean
function (universal/external drift/regression kriging).

It is pretty simple to try things out e.g. by cross validation.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140514/a1fef2f9/attachment.bin>

From katharine.walter at yale.edu  Wed May 14 18:52:52 2014
From: katharine.walter at yale.edu (Katharine Walter)
Date: Wed, 14 May 2014 12:52:52 -0400
Subject: [R-sig-Geo] Set color key for stplot
Message-ID: <CACAXSaXpF5qRkv1DQKvo6oJoQJ0Q3=oa9ViSOU-oTD7CDRynVg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140514/611c42e7/attachment.pl>

From frtog at vestas.com  Wed May 14 19:29:34 2014
From: frtog at vestas.com (=?iso-8859-1?Q?Frede_Aakmann_T=F8gersen?=)
Date: Wed, 14 May 2014 19:29:34 +0200
Subject: [R-sig-Geo] Set color key for stplot
In-Reply-To: <CACAXSaXpF5qRkv1DQKvo6oJoQJ0Q3=oa9ViSOU-oTD7CDRynVg@mail.gmail.com>
References: <CACAXSaXpF5qRkv1DQKvo6oJoQJ0Q3=oa9ViSOU-oTD7CDRynVg@mail.gmail.com>
Message-ID: <B078CDF40DFE4045AF172A8B4F68FC4857C612D7A6@DKRDSEXC016.vestas.net>

Hi Katherine

Yes, it looks like it is lattice plot functions.

I have an example where I wantes to plot the sea as blue and the land according to terrain.colors()

Here is my call to levelplot:

levelplot( Z ~ X + Y, data = xyz, labels = FALSE, aspect = "iso", contour = FALSE,
          cuts = 16, , at = c(-Inf,do.breaks(range(xyz$Z), 15)),
          col.regions = c("#0000FFFF", terrain.colors(15)),
          subset = X > 370000 & X < 380000 & Y > 670000 & Y < 680000)

and a png is attached.

As you can see you need to combine the cuts and col.regions argument to do what you want.



Yours sincerely / Med venlig hilsen


Frede Aakmann T?gersen
Specialist, M.Sc., Ph.D.
Plant Performance & Modeling

Technology & Service Solutions
T +45 9730 5135
M +45 2547 6050
frtog at vestas.com
http://www.vestas.com

Company reg. name: Vestas Wind Systems A/S
This e-mail is subject to our e-mail disclaimer statement.
Please refer to www.vestas.com/legal/notice
If you have received this e-mail in error please contact the sender. 


> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Katharine Walter
> Sent: 14. maj 2014 18:53
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Set color key for stplot
> 
> Hi,
> Is there a way to use a color ramp when using stplot and simultaneously
> assign a specific color for a single value?  For example, I am trying to
> plot disease cases and would like 0s to be plotted as grey and the rest of
> the cases to be colored by a color ramp.
> 
> #this plots cases including 0s as a color ramp:
> stplot(stfdf[,,"lyme_cases"], t, col.regions = brewer.pal(9, "YlOrRd"),
> cuts=9 )[28]
> cuts=c(1,seq(20,160,by=20), 186)
> 
> I have tried defining cuts so that any polygon with less than 1 case is
> colored grey, but this does not work and instead plots any polygon with <20
> cases as grey.
> 
> stplot(stfdf[,,"lyme_cases"], t, col.regions = c("grey", brewer.pal(9,
> "YlOrRd")), cuts=c(0.1,seq(20,160,by=20), 186) )[28]
> 
> Thank you very much for your help!
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: seaANDland.png
Type: image/png
Size: 6981 bytes
Desc: seaANDland.png
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140514/8ce17b12/attachment.png>

From Roger.Bivand at nhh.no  Wed May 14 20:48:29 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 14 May 2014 20:48:29 +0200
Subject: [R-sig-Geo] Clip a polyline with a Polygon
In-Reply-To: <CAFik=FcV4wJttvBxjNTK1xSt9oHNfSa6mjHy+BLsbbftZyercQ@mail.gmail.com>
References: <CAFik=FcV4wJttvBxjNTK1xSt9oHNfSa6mjHy+BLsbbftZyercQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1405142046350.7117@reclus.nhh.no>

On Wed, 14 May 2014, Wesley Roberts wrote:

> Dear r-sig-geo,
>
> I have been looking for a tool / method to clip a polyline using a polygon
> and cant seem to find a suitable solution. My task is as follows.
>
> I have a property boundary which is a polyline. I have a deforestation
> layer which is a polygon. In my property data set I have 23 boundaries. I
> need to calculated the ratio of threatened perimeter to actual perimeter.
> To do this I select each boundary and then clip the boundary with the
> deforestation layer. The boundaries that remain (are spatially coincident
> with the deforestation layer) then remain. I calculate the length of these
> and calculate my ratio. This task is very straight forward and can be easy
> accomplished using QGIS, however, I have shared boundaries and thus need to
> process each boundary separately. gIntersection does not return what I need.
>
> Can anyone help with a potential solution?

In a complex case with multiple possible misunderstandings, you must 
provide a toy example; if it substantiates your claim about gIntersection, 
you must also state which version of rgeos you are using.

Verbal hand-waving is not precise, code is more illuminating.

Roger

>
> Many thanks and kind regards,
> Wesley
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From fabriciovasselai at gmail.com  Thu May 15 03:05:59 2014
From: fabriciovasselai at gmail.com (Fabricio Vasselai)
Date: Wed, 14 May 2014 21:05:59 -0400
Subject: [R-sig-Geo] Still a bug when converting from tess to spatial
 polygon (sp) format?
In-Reply-To: <alpine.LRH.2.03.1405140905030.4115@reclus.nhh.no>
References: <CAEkXS9+cTvPYikuxVS6Tu31cz7UUtzEROGqN8xxUebJSc9rQ9A@mail.gmail.com>
	<alpine.LRH.2.03.1405140905030.4115@reclus.nhh.no>
Message-ID: <CAEkXS9+O148gtg1B5q5tbJ1+0xvMbLRJ1tvmLkBVB8599y85LA@mail.gmail.com>

Hi professor Bivand, thanks for the fast reply.

Sure, there is no surprise and nothing wrong with the objects
themselves: the converted tess is a SpatialPolygon, not a
SpatialPolygonDataFrame. Therefore, it is normally missing the data
slot. Anyway, although I got interested in that application due to a
previous question someone sent to the list, I can think of uses for
tess objects to have attributes.  For instance, depending on which
type of simulation is being executed one can have a few attributes
being randomly assigned to each tile of the tessellated map, or when
someone wants to save the random generated attributes of a simulation
within the generated maps into a .shp file, maybe those could be
easier and neater to achieve with a SpatialPolygonDataFrame. Sure,
there are other simple enough ways to achieve the same, but still, why
not having the data slot within the converted tess?

Here I send two codes to convert tess objects to SpatialPolygonDataFrame.
The first uses as(, "SpatialPolygons"), the second does all the
conversion step by step. I don't know if either are enough to use for
a coercion method, but it seems to work fine as an user-defined
formula. Any further simplification and corrections are certainly
welcome.

Version 1:

#Code begins here

tess2SPdf <- function(x) {
  stopifnot(is.tess(x))
  require(spatstat)
sp.obj <- as(x, "SpatialPolygons")
d <- data.frame()
d <- d[seq(x$n),]
row.names(d) <- names(x$tiles)
return(SpatialPolygonsDataFrame(sp.obj, data=d))
}

#End of the code


Or if someone needs an entire piece, that does not use the coercion
from the as() function, an option based on past emails from this list
would be:


Version 2:

#Code begins here

tess2SPdf <- function(x) {
  stopifnot(is.tess(x))
  require(sp)
  require(spatstat)
  a <- tiles(x)
  tess.labels <- names(a)
  c <- list()
  for(i in seq(a)){

    b <- as.polygonal(a[[i]])
    closering <- function(df) {
                    df[c(seq(nrow(df)), 1), ]
                 }
    pieces <- lapply(b$bdry,
                     function(p) {
                       Polygon(coords=closering(cbind(p$x,p$y)),
                               hole=is.hole.xypolygon(p))
                     })
    c[[i]] <- Polygons(pieces, tess.labels[i])

  }

  d <- data.frame()
  d <- d[seq(x$n),]
  row.names(d) <- names(x$tiles)
  return(SpatialPolygonsDataFrame(SpatialPolygons(c), data=d))
}
#End of the code


Hope it helps.

Best,

Fabricio


2014-05-14 3:21 GMT-04:00 Roger Bivand <Roger.Bivand at nhh.no>:
>
> On Wed, 14 May 2014, Fabricio Vasselai wrote:
>
>> Dear all,
>>
>>
>> After playing around with the tessellation functions of the spatstat
>> package to reply to a previous question on the list, I realized that there
>> seems to be something odd when converting from tess format to spatial
>> polygon format.
>>
>> Usually, spatial polygonal shapefiles read into R with functions like
>> readShapePoly or readOGR, are objects which have a slot called "data", that
>> can be assessed with @data and has the format of a data.frame. In there,
>> each polygonal feature of the map is a row, while the columns are the
>> variables that are eventually present in the shapefiles's data. Therefore,
>> if you try to check names() of a spatial polygon object read from a
>> shapefile, you get these columns, while row() gives you the polygon
>> features present in the map.
>
>
> Why is this a surprise? There are *two* classes for each Spatial* object, the geometries (SpatialPoints, SpatialLines, SpatialPolygons, SpatialGrid, SpatialPixels), and each of these can be extended have attributes/fields in a data.frame object in the data slot of Spatial*DataFrame objects. This has always been like this, since:
>
> Edzer J. Pebesma and Roger S. Bivand. Classes and methods for spatial data in R. R News, 5(2):9-13, November 2005
>
> http://cran.r-project.org/doc/Rnews/Rnews_2005-2.pdf
>
> There is also a vignette:
>
> http://cran.r-project.org/web/packages/sp/vignettes/intro_sp.pdf
>
> The real question is why anyone would expect a tesselation geometry to have attributes. If a tesselation has attributes/marks, then it would be worth writing a method to coerce to SpatialPolygonsDataFrame, for example for E in the examples in ?tess. But here:
>
>> Esp <- as(E, "SpatialPolygons")
>> length(Esp)
>
> [1] 11
>>
>> row.names(Esp)
>
>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k"
>
> already preserves the levels, so I don't see a use case for such a method. If you can suggest one and contribute a coercion method, it could be added to maptools.
>
> Hope this clarifies,
>
> Roger
>
>
>>
>> However, when converting a tess object generated by spatstat to shape
>> polygon, by using the as( , "SpatialPolygons"), things look quite
>> different. First, no slot called data is created. Second, if you try
>> names() on the converted object, you will get each polygon features and
>> with row(), you get nothing. This looks odd, since the features should be
>> the rows of a data.frame-like slot, shouldn't them?
>>
>> Here it goes a reproducible example:
>>
>> ###Code begins here
>>
>> #Let's first read a shp map for comparison
>>
>> vectors.path <- system.file("vectors", package = "rgdal")[1]
>> loaded.map <- readShapePoly(paste(vectors.path, "/scot_BNG.shp", sep=""))
>> plot(loaded.map)      #looking at the loaded map
>> class(loaded.map)      #checking if it is of the class we want
>>
>> #Now let's generate a shp map from tessellation
>>
>> randompoints <- rpoint(100)      #generate random spatial points
>> random.map.tess <- dirichlet(randompoints)      #tessellate the points
>> random.map <- as(random.map.tess, "SpatialPolygons")      #convert to shape
>> polygon
>> plot(random.map)      #looking at the random generated map
>> class(random.map)      #checking if it is of the class we want
>>
>>
>> #Finally, let's compare both polygon shape objects:
>>
>> names(loaded.map)
>> names(random.map)
>>
>> row(loaded.map)
>> row(random.map)
>>
>> nrow(loaded.map)
>> nrow(random.map)
>>
>> ncol(loaded.map)
>> ncol(random.map)
>>
>> View(loaded.map at data)
>> View(random.map at data)
>>
>> ###End of code
>>
>>
>> Notice how things look different for the same sp objects when loading them
>> or creating from a tess converted object.  I mean, I am not sure whether
>> this is really a bug or it is normal and if yes, why does it happen (that's
>> why the subject of this email is a question, not an affirmative sentence),
>> but I though it was worth bringing to you all since it can be confusing.
>> Anyway, is there any way we can convert tess objects to a sp object in the
>> pattern a shapefile map is read, i.e. with the "data" slot and with the
>> polygon features as rows, no as columns?
>>
>> As always, thank you all for your time.
>>
>> Best,
>>
>> Fabricio Vasselai
>> CPS-University of Michigan
>> University of S??o Paulo
>>
>>         [[alternative HTML version deleted]]
>>
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
>


From bakare at ualberta.ca  Thu May 15 09:06:34 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Thu, 15 May 2014 01:06:34 -0600
Subject: [R-sig-Geo] gstat Cross validation IDW vs ordinary kriging
	interpolation
Message-ID: <CAJRR3XOgB_8Cjr17FL409e70sWA9uoSMX7G7BFc7TPF9BJVvvQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140515/997e1f6a/attachment.pl>

From Roger.Bivand at nhh.no  Thu May 15 09:18:21 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 15 May 2014 09:18:21 +0200
Subject: [R-sig-Geo] Still a bug when converting from tess to spatial
 polygon (sp) format?
In-Reply-To: <CAEkXS9+O148gtg1B5q5tbJ1+0xvMbLRJ1tvmLkBVB8599y85LA@mail.gmail.com>
References: <CAEkXS9+cTvPYikuxVS6Tu31cz7UUtzEROGqN8xxUebJSc9rQ9A@mail.gmail.com>
	<alpine.LRH.2.03.1405140905030.4115@reclus.nhh.no>
	<CAEkXS9+O148gtg1B5q5tbJ1+0xvMbLRJ1tvmLkBVB8599y85LA@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1405150909500.9603@reclus.nhh.no>

Hi Fabricio,

Thanks, but the use case I was considering was that a tess object itself 
includes marks of some kind that are lost in coercion. This is not the 
case here, so it is very much better that users actually learn to use the 
objects provided. The minimal incantation to go from a SpatialPolygons 
object to a SpatialPolygonsDataFrame object is:

x <- as(tess_obj, "SpatialPolygons")

SPDF <- SpatialPolygonsDataFrame(x, data=data.frame(row.names(x),
   row.names=row.names(x), stringsAsFactors=FALSE))

which copies the row.names of x twice. This object contains no more 
information, but can be written by rgdal::writeOGR().

There are many contexts in which the only information left is in the 
feature IDs (as output from topological operations, for example), so this 
should be common knowledge. Possibly sp could have this one-liner as a 
coercion method, but being explicit has the side effect of obliging users 
to think.

Best wishes,

Roger

On Thu, 15 May 2014, Fabricio Vasselai wrote:

> Hi professor Bivand, thanks for the fast reply.
>
> Sure, there is no surprise and nothing wrong with the objects
> themselves: the converted tess is a SpatialPolygon, not a
> SpatialPolygonDataFrame. Therefore, it is normally missing the data
> slot. Anyway, although I got interested in that application due to a
> previous question someone sent to the list, I can think of uses for
> tess objects to have attributes.  For instance, depending on which
> type of simulation is being executed one can have a few attributes
> being randomly assigned to each tile of the tessellated map, or when
> someone wants to save the random generated attributes of a simulation
> within the generated maps into a .shp file, maybe those could be
> easier and neater to achieve with a SpatialPolygonDataFrame. Sure,
> there are other simple enough ways to achieve the same, but still, why
> not having the data slot within the converted tess?
>
> Here I send two codes to convert tess objects to SpatialPolygonDataFrame.
> The first uses as(, "SpatialPolygons"), the second does all the
> conversion step by step. I don't know if either are enough to use for
> a coercion method, but it seems to work fine as an user-defined
> formula. Any further simplification and corrections are certainly
> welcome.
>
> Version 1:
>
> #Code begins here
>
> tess2SPdf <- function(x) {
>  stopifnot(is.tess(x))
>  require(spatstat)
> sp.obj <- as(x, "SpatialPolygons")
> d <- data.frame()
> d <- d[seq(x$n),]
> row.names(d) <- names(x$tiles)
> return(SpatialPolygonsDataFrame(sp.obj, data=d))
> }
>
> #End of the code
>
>
> Or if someone needs an entire piece, that does not use the coercion
> from the as() function, an option based on past emails from this list
> would be:
>
>
> Version 2:
>
> #Code begins here
>
> tess2SPdf <- function(x) {
>  stopifnot(is.tess(x))
>  require(sp)
>  require(spatstat)
>  a <- tiles(x)
>  tess.labels <- names(a)
>  c <- list()
>  for(i in seq(a)){
>
>    b <- as.polygonal(a[[i]])
>    closering <- function(df) {
>                    df[c(seq(nrow(df)), 1), ]
>                 }
>    pieces <- lapply(b$bdry,
>                     function(p) {
>                       Polygon(coords=closering(cbind(p$x,p$y)),
>                               hole=is.hole.xypolygon(p))
>                     })
>    c[[i]] <- Polygons(pieces, tess.labels[i])
>
>  }
>
>  d <- data.frame()
>  d <- d[seq(x$n),]
>  row.names(d) <- names(x$tiles)
>  return(SpatialPolygonsDataFrame(SpatialPolygons(c), data=d))
> }
> #End of the code
>
>
> Hope it helps.
>
> Best,
>
> Fabricio
>
>
> 2014-05-14 3:21 GMT-04:00 Roger Bivand <Roger.Bivand at nhh.no>:
>>
>> On Wed, 14 May 2014, Fabricio Vasselai wrote:
>>
>>> Dear all,
>>>
>>>
>>> After playing around with the tessellation functions of the spatstat
>>> package to reply to a previous question on the list, I realized that there
>>> seems to be something odd when converting from tess format to spatial
>>> polygon format.
>>>
>>> Usually, spatial polygonal shapefiles read into R with functions like
>>> readShapePoly or readOGR, are objects which have a slot called "data", that
>>> can be assessed with @data and has the format of a data.frame. In there,
>>> each polygonal feature of the map is a row, while the columns are the
>>> variables that are eventually present in the shapefiles's data. Therefore,
>>> if you try to check names() of a spatial polygon object read from a
>>> shapefile, you get these columns, while row() gives you the polygon
>>> features present in the map.
>>
>>
>> Why is this a surprise? There are *two* classes for each Spatial* object, the geometries (SpatialPoints, SpatialLines, SpatialPolygons, SpatialGrid, SpatialPixels), and each of these can be extended have attributes/fields in a data.frame object in the data slot of Spatial*DataFrame objects. This has always been like this, since:
>>
>> Edzer J. Pebesma and Roger S. Bivand. Classes and methods for spatial data in R. R News, 5(2):9-13, November 2005
>>
>> http://cran.r-project.org/doc/Rnews/Rnews_2005-2.pdf
>>
>> There is also a vignette:
>>
>> http://cran.r-project.org/web/packages/sp/vignettes/intro_sp.pdf
>>
>> The real question is why anyone would expect a tesselation geometry to have attributes. If a tesselation has attributes/marks, then it would be worth writing a method to coerce to SpatialPolygonsDataFrame, for example for E in the examples in ?tess. But here:
>>
>>> Esp <- as(E, "SpatialPolygons")
>>> length(Esp)
>>
>> [1] 11
>>>
>>> row.names(Esp)
>>
>>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k"
>>
>> already preserves the levels, so I don't see a use case for such a method. If you can suggest one and contribute a coercion method, it could be added to maptools.
>>
>> Hope this clarifies,
>>
>> Roger
>>
>>
>>>
>>> However, when converting a tess object generated by spatstat to shape
>>> polygon, by using the as( , "SpatialPolygons"), things look quite
>>> different. First, no slot called data is created. Second, if you try
>>> names() on the converted object, you will get each polygon features and
>>> with row(), you get nothing. This looks odd, since the features should be
>>> the rows of a data.frame-like slot, shouldn't them?
>>>
>>> Here it goes a reproducible example:
>>>
>>> ###Code begins here
>>>
>>> #Let's first read a shp map for comparison
>>>
>>> vectors.path <- system.file("vectors", package = "rgdal")[1]
>>> loaded.map <- readShapePoly(paste(vectors.path, "/scot_BNG.shp", sep=""))
>>> plot(loaded.map)      #looking at the loaded map
>>> class(loaded.map)      #checking if it is of the class we want
>>>
>>> #Now let's generate a shp map from tessellation
>>>
>>> randompoints <- rpoint(100)      #generate random spatial points
>>> random.map.tess <- dirichlet(randompoints)      #tessellate the points
>>> random.map <- as(random.map.tess, "SpatialPolygons")      #convert to shape
>>> polygon
>>> plot(random.map)      #looking at the random generated map
>>> class(random.map)      #checking if it is of the class we want
>>>
>>>
>>> #Finally, let's compare both polygon shape objects:
>>>
>>> names(loaded.map)
>>> names(random.map)
>>>
>>> row(loaded.map)
>>> row(random.map)
>>>
>>> nrow(loaded.map)
>>> nrow(random.map)
>>>
>>> ncol(loaded.map)
>>> ncol(random.map)
>>>
>>> View(loaded.map at data)
>>> View(random.map at data)
>>>
>>> ###End of code
>>>
>>>
>>> Notice how things look different for the same sp objects when loading them
>>> or creating from a tess converted object.  I mean, I am not sure whether
>>> this is really a bug or it is normal and if yes, why does it happen (that's
>>> why the subject of this email is a question, not an affirmative sentence),
>>> but I though it was worth bringing to you all since it can be confusing.
>>> Anyway, is there any way we can convert tess objects to a sp object in the
>>> pattern a shapefile map is read, i.e. with the "data" slot and with the
>>> polygon features as rows, no as columns?
>>>
>>> As always, thank you all for your time.
>>>
>>> Best,
>>>
>>> Fabricio Vasselai
>>> CPS-University of Michigan
>>> University of S??o Paulo
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From roelofcoster at gmail.com  Thu May 15 10:58:35 2014
From: roelofcoster at gmail.com (Roelof Coster)
Date: Thu, 15 May 2014 10:58:35 +0200
Subject: [R-sig-Geo] Local spacetime kriging
Message-ID: <CAPTd6_uhwNDiHkYQL-uoRXRasbcNp6skr+J_2VTjmK3vrp0jLw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140515/8794cebe/attachment.pl>

From fabrice.pinton at atmo-ca.asso.fr  Thu May 15 15:36:00 2014
From: fabrice.pinton at atmo-ca.asso.fr (xilllium)
Date: Thu, 15 May 2014 06:36:00 -0700 (PDT)
Subject: [R-sig-Geo] contour in spplot
Message-ID: <1400160960595-7586446.post@n2.nabble.com>

Hi ! 

I have some troubles with contour in spplot. I can't define the number of
lines, and the positions of the labels seems impossible to modify. I would
use another tools to make contour (like levelplot), but I'm not able to use
the result with spplot. Is-it possible ? The result must be convert ? 

Sorry for my english, 

Fabrice



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/contour-in-spplot-tp7586446.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Thu May 15 15:47:18 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 15 May 2014 15:47:18 +0200
Subject: [R-sig-Geo] Local spacetime kriging
In-Reply-To: <CAPTd6_uhwNDiHkYQL-uoRXRasbcNp6skr+J_2VTjmK3vrp0jLw@mail.gmail.com>
References: <CAPTd6_uhwNDiHkYQL-uoRXRasbcNp6skr+J_2VTjmK3vrp0jLw@mail.gmail.com>
Message-ID: <5374C566.9070809@uni-muenster.de>



On 05/15/2014 10:58 AM, Roelof Coster wrote:
> Hi,
> 
> The krigeST function has a 'nmax' parameter that sets the maximum number of
> neighbouring observations to be used in the prediction. However, the help
> for this function states that it does not support kriging in a local
> neighbourhood. So, is this just a mistake in the help?

mistake, thanks.

> 
> Also, in case kriging in a neighbourhood is possible, how does the function
> determine this neighbourhood? How is distance in space compared to distance
> in time?

It uses http://cran.r-project.org/web/packages/FNN/index.html
to get nearest neighbours, and, unless parameter stAnis is specified,
tries to figure out a sensible space/time anisotropy from the variogram
model. The source is found
https://r-forge.r-project.org/scm/viewvc.php/pkg/R/krige0.R?view=markup&root=gstat
and look for function krigeST.local

The curent version on CRAN does not pass through parameters
checkNeighbourhood and bufferNmax, just corrected this on r-forge.

Wbr,

> 
> Thanks! Roelof Coster
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140515/819aafdf/attachment.bin>

From ben.graeler at uni-muenster.de  Thu May 15 15:58:31 2014
From: ben.graeler at uni-muenster.de (=?ISO-8859-1?Q?Benedikt_Gr=E4ler?=)
Date: Thu, 15 May 2014 15:58:31 +0200
Subject: [R-sig-Geo] Local spacetime kriging
In-Reply-To: <5374C566.9070809@uni-muenster.de>
References: <CAPTd6_uhwNDiHkYQL-uoRXRasbcNp6skr+J_2VTjmK3vrp0jLw@mail.gmail.com>
	<5374C566.9070809@uni-muenster.de>
Message-ID: <5374C807.9050809@uni-muenster.de>

On 15.05.2014 15:47, Edzer Pebesma wrote:
> On 05/15/2014 10:58 AM, Roelof Coster wrote:
>> Also, in case kriging in a neighbourhood is possible, how does the function
>> determine this neighbourhood? How is distance in space compared to distance
>> in time?
> 
> It uses http://cran.r-project.org/web/packages/FNN/index.html
> to get nearest neighbours, and, unless parameter stAnis is specified,
> tries to figure out a sensible space/time anisotropy from the variogram
> model. The source is found
> https://r-forge.r-project.org/scm/viewvc.php/pkg/R/krige0.R?view=markup&root=gstat
> and look for function krigeST.local

The "closest" neighbours are the "strongest" correlated ones. To achieve
this, a larger (4-fold by default) metric spatio-temporal neighbourhood
with some spatio-temporal anisotropy (stAni or from the variogram model)
is selected. For these neighbours, the spatio-temporal covariance
function is evaluated and the ones with the strongest correlation are
selected. The interpolation is then carried out using these nmax
neighbours.

HTH,

 Ben


> 
> The curent version on CRAN does not pass through parameters
> checkNeighbourhood and bufferNmax, just corrected this on r-forge.
> 
> Wbr,
> 
>>
>> Thanks! Roelof Coster
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Benedikt Gr?ler

ifgi - Institute for Geoinformatics
University of Muenster

http://ifgi.uni-muenster.de/graeler

Phone: +49 251 83-33082
Mail: ben.graeler at uni-muenster.de

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 560 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140515/f3af1bae/attachment.bin>

From Md.Hossain at cchmc.org  Thu May 15 16:05:53 2014
From: Md.Hossain at cchmc.org (Hossain, Md)
Date: Thu, 15 May 2014 14:05:53 +0000
Subject: [R-sig-Geo] Warning message: points were rejected as lying outside
 the specified window
Message-ID: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>

Hi,
Apology, my problem may be so simple to answer. I am trying to read disease locations (in longitude and latitude) for 49 adjacent states of USA as an PPP object with the R code:

usdat <- data.frame(x=data$X, y=data2$Y) 
usmap <- map('usa', fill=TRUE, col="transparent", plot=FALSE) 
uspoly <- map2SpatialPolygons(usmap, IDs=usmap$names, proj4string=CRS("+proj=longlat +datum=WGS84")) 
spatstat.options(checkpolygons=FALSE)
usowin <- as.owin.SpatialPolygons(uspoly)
spatstat.options(checkpolygons=TRUE) 
pts <- as.ppp(usdat, W=usowin)
plot(pts)

But, getting the warning messages:
1: point-in-polygon test had difficulty with 2 points (total score not 0 or 1) 
2: In ppp(X[, 1], X[, 2], window = win, marks = marx, check = check) :
  42 points were rejected as lying outside the specified window

Please suggest if there is any way I can keep these 42 points. With regards,

Monir


From mfiori at arpa.sardegna.it  Thu May 15 17:23:29 2014
From: mfiori at arpa.sardegna.it (Michele Fiori)
Date: Thu, 15 May 2014 17:23:29 +0200
Subject: [R-sig-Geo] R:  Regression Kriging cross validation
In-Reply-To: <535FE602.8070605@gmail.com>
References: <001101cf639e$d6cfa9f0$846efdd0$@arpa.sardegna.it>
	<535FE602.8070605@gmail.com>
Message-ID: <002f01cf7051$a09e3b20$e1dab160$@arpa.sardegna.it>

Thank you for your kind reply
therefore as I have used the Osl method for regression, my result will never
match the universal kriging; However, in order to validate my method, I'm
trying to implement in the script a calculation loop witch runs n times (the
number of stations) regression + kriging without one station at a time.
Thank you again
Michele


-----Messaggio originale-----
Da: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org]
Per conto di rubenfcasal
Inviato: marted? 29 aprile 2014 19:49
A: r-sig-geo at r-project.org
Oggetto: Re: [R-sig-Geo] Regression Kriging cross validation

Hello Michele,

     Universal kriging is equivalent to Linear Regression (with the
generalized-least-squaresestimator) + Simple Kriging of residuals (e.g. 
Cressie, 1993, section 3.4.5). The differences you observe are probably due
to the use of ordinary least squares. If you use (leave-one-out)
cross-validation with krige.cv (considering the UK model), the trend is also
re-estimated at each prediction location. From my point of view, this would
be the recommended way to proceed.
     As far as I know, there are no available implementations of the
procedure you are suggesting.

     Best regards,
         Rub?n.


El 29/04/2014 13:33, Michele Fiori escribi?:
> Hi everyone,
> I am working on rainfall interpolation using regression kriging method 
> and I need suggestions on how I can carry out a cross validation 
> (leave-one-out) for this elaboration. At first I tried to apply 
> directly Krige.cv, similarly to UK method (example for october: 
> PP10uk.cv <- krige.cv(reg, prec2, PP10.vgm)), but unfortunately when I 
> applied Universal Kriging on the same data, I realized that UK map was a
little different from RK map.
> So my question is: How could I manage universal kriging in order to 
> make it equivalent to regression kriging and use the above 
> cross-validation, or is there another different method to apply cross 
> validation (leave-one-out) on Regression Kriging interpolation?
> Below my code:
> Many thanks
>
> Michele Fiori
>
> ARPAS - Environmental Protection Agency of Sardinia MeteoClimatic 
> Department - Meteorological Service
>
> Viale Porto Torres 119 - 07100 Sassari, Italy Tel + 39 079 258617 Fax 
> + 39 079 262681 www.sardegnaambiente.it/arpas
>
> ####	Creating SpatialPixelDataFrame ("dem" - 250x250 m grid)
> 	....
> ####	Loading Precipitation data
>     	prec2 <- read.table("prec2.txt", sep="\t", header =TRUE)
>    	coordinates(prec2) <- c("x", "y")
>     	proj4string(prec2) <- CRS("+init=epsg:32632")
> ####	Linear regression Model
>    	mod.gen <- lm(PP10 ~ QUOTA_MARE + UTM_EST + UTM_NORD + DIST_MARE,
> prec2)
>    	step1 <- stepAIC(mod.gen, direction="both")
>    	reg <- formula(step1)
>     	PP10.lm <- lm(reg, prec2)
>    	summary(PP10.lm)
>     	prec2$residuals <- residuals(PP10.lm)
>      	dem$predlm <- predict(PP10.lm, dem)
> ####	Variogram of residuals
> 	PP10.vgm <- vgm(nugget=51.46, model="Sph", range=38038.89,
> psill=86.44)
> ####	Ordinary Kriging of residuals
> 	PP10.okr <- krige(PP10.lm$residuals ~ 1, prec2, dem, PP10.vgm,
> maxdist=Inf)
> 	dem$varokr <- PP10.okr$var1.pred
> ####	Regression Kriging (Linear Regression + Ordinary Kriging of
> residuals)
> 	dem$vark <- dem$predlm + dem$varokr
> ####	Universal kriging
> 	PP10.uk <- krige(reg, prec2, dem, PP10.vgm, maxdist=Inf)
> 	dem$varuk <- PP10.uk$var1.pred
> 	dem$difference <- dem$vark - dem$varuk
> 	spplot(dem[c("difference")], col.regions=terrain.colors(25), 
> contour=FALSE, cuts = 15)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From bakare at ualberta.ca  Thu May 15 17:39:25 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Thu, 15 May 2014 09:39:25 -0600
Subject: [R-sig-Geo] R: Regression Kriging cross validation
In-Reply-To: <002f01cf7051$a09e3b20$e1dab160$@arpa.sardegna.it>
References: <001101cf639e$d6cfa9f0$846efdd0$@arpa.sardegna.it>
	<535FE602.8070605@gmail.com>
	<002f01cf7051$a09e3b20$e1dab160$@arpa.sardegna.it>
Message-ID: <CAJRR3XMoc=vcpPqX12wshpBZnuz+O=+3rBnr3JyXVM9TSZ2hRw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140515/ba442a4b/attachment.pl>

From rubenfcasal at gmail.com  Thu May 15 20:36:26 2014
From: rubenfcasal at gmail.com (rubenfcasal)
Date: Thu, 15 May 2014 20:36:26 +0200
Subject: [R-sig-Geo] R: Regression Kriging cross validation
In-Reply-To: <CAJRR3XMoc=vcpPqX12wshpBZnuz+O=+3rBnr3JyXVM9TSZ2hRw@mail.gmail.com>
References: <001101cf639e$d6cfa9f0$846efdd0$@arpa.sardegna.it>	<535FE602.8070605@gmail.com>	<002f01cf7051$a09e3b20$e1dab160$@arpa.sardegna.it>
	<CAJRR3XMoc=vcpPqX12wshpBZnuz+O=+3rBnr3JyXVM9TSZ2hRw@mail.gmail.com>
Message-ID: <5375092A.4030503@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140515/3740fc63/attachment.pl>

From mahbobehparsaeian at yahoo.com  Fri May 16 07:36:52 2014
From: mahbobehparsaeian at yahoo.com (Mahbubeh Parsaeian)
Date: Thu, 15 May 2014 22:36:52 -0700 (PDT)
Subject: [R-sig-Geo] error in readShapePoly
Message-ID: <1400218612.67440.YahooMailNeo@web125402.mail.ne1.yahoo.com>

Dear all
I have a shape file of UK. I have used it serveral times before. But now when I want to use this shapefile the following error will apear.


shp<-readShapePoly("GreaterLondon_ward")
Error in read.shape(filen = fn, verbose = verbose, repair = repair) : 
? File size and implied file size differ, consider trying repair=TRUE


shp<-readShapePoly("GreaterLondon_ward", repair=TRUE)
Error in read.shape(filen = fn, verbose = verbose, repair = repair) : 
? Cannot repair file size error


If it is possible please let me know what is the problem.
Best 
Mahboubeh



From Roger.Bivand at nhh.no  Fri May 16 09:21:54 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 16 May 2014 09:21:54 +0200
Subject: [R-sig-Geo] error in readShapePoly
In-Reply-To: <1400218612.67440.YahooMailNeo@web125402.mail.ne1.yahoo.com>
References: <1400218612.67440.YahooMailNeo@web125402.mail.ne1.yahoo.com>
Message-ID: <alpine.LRH.2.03.1405160907230.23369@reclus.nhh.no>

On Fri, 16 May 2014, Mahbubeh Parsaeian wrote:

> Dear all
> I have a shape file of UK. I have used it serveral times before. But now 
> when I want to use this shapefile the following error will apear.
>
>
> shp<-readShapePoly("GreaterLondon_ward")
> Error in read.shape(filen = fn, verbose = verbose, repair = repair) :
> ? File size and implied file size differ, consider trying repair=TRUE
>
>
> shp<-readShapePoly("GreaterLondon_ward", repair=TRUE)
> Error in read.shape(filen = fn, verbose = verbose, repair = repair) :
> ? Cannot repair file size error
>
>
> If it is possible please let me know what is the problem.

The *.shx file is damaged, and is not showing the characteristics of a 
regular bug as found in Geolytics shapefiles some ten years ago (see the 
help file). Consequently, the shapefile cannot be read at all using 
software that needs a correct or corrected *.shx to index the shapes. The 
problem is that the pointers in *.shx to the shapes in *.shp do not match, 
and may read past the end of the *.shp file; shape data read with 
non-matching pointers will not be reliable anyway.

You should get the same error using rgdal::readOGR(); note that 
maptools::readShape*() are not actively maintained and may be deprecated.

You need to re-source the shapefile, or ask your provider for a copy that 
is not damaged. It used to be possible to use the shapefiles package to 
read *.shp and *.dbf after deleting the offending *.shx; read.shp() and 
read.dbf(), but putting this input into usable form is very hard.

Hope this clarifies,

Roger

> Best
> Mahboubeh
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From mfiori at arpa.sardegna.it  Fri May 16 09:50:29 2014
From: mfiori at arpa.sardegna.it (Michele Fiori)
Date: Fri, 16 May 2014 09:50:29 +0200
Subject: [R-sig-Geo] R:  R: Regression Kriging cross validation
In-Reply-To: <CAJRR3XMoc=vcpPqX12wshpBZnuz+O=+3rBnr3JyXVM9TSZ2hRw@mail.gmail.com>
References: <001101cf639e$d6cfa9f0$846efdd0$@arpa.sardegna.it>	<535FE602.8070605@gmail.com>	<002f01cf7051$a09e3b20$e1dab160$@arpa.sardegna.it>
	<CAJRR3XMoc=vcpPqX12wshpBZnuz+O=+3rBnr3JyXVM9TSZ2hRw@mail.gmail.com>
Message-ID: <000901cf70db$8377f7e0$8a67e7a0$@arpa.sardegna.it>

Dear All,
Finally I managed to develop this ad hoc procedure for the regression kriging cross validation; I tried to test the kriging part (the regression part has been already tested successfully) by comparison with the krige.cv function and I noticed that there are small discrepancies. I verified that they are due to the fact that in my case the variogram is recalculated for each step, while the function runs using the same initial variogram obtained on the complete set of data.
What do you think about?
Michele

ARPAS - Environmental Protection Agency of Sardinia MeteoClimatic
Department - Meteorological Service

Viale Porto Torres 119 - 07100 Sassari, Italy Tel + 39 079 258617 Fax
+ 39 079 262681 www.sardegnaambiente.it/arpas

#################### Cross validation REGRESSION KRIGING (leave on out)
					
	PP03.lm <- lm(reg, prec2)
	Nstazioni <- length(prec2$NOME_STAZ)
	for (i in 1:Nstazioni) 	
	{
		###  regression step for point ?i?

		prec2.i <- prec2[-i,] 		
  		md.i <- lm(reg, data=prec2.i) 
	  		ypredlm.i <- predict(md.i,prec2[i,])                 
	  		err[i] <- (ypredlm.i - prec2$PP03[i])^2               
		res[i] <- (ypredlm.i - prec2$PP03[i])  

		###  kriging step for residual point ?i?

		PP03i.rsvar <- variogram(prec2.i$residuals~1, prec2.i)
		PP03i.ivgm <- vgm(nugget=0, model="Sph", range=sqrt(diff(prec2.i at bbox["x",])^2 + diff(prec2.i at bbox["y",])^2)/4, psill=var(prec2.i$residuals))
		PP03i.rvgm <- fit.variogram(PP03i.rsvar, model=PP03i.ivgm)
		ypredok.i<- krige(md.i$residuals~1, prec2.i, prec2[i,], PP03i.rvgm)
		ypredok.i$var1.pred

		###  Regression + kriging predicted value for point ?i?
		
		ypred.i <- ypredlm.i + ypredok.i$var1.pred
	
	   	err[i] <- (ypred.i - prec2$PP03[i])^2               
		ypred[i] <- ypred.i		
	}                                
	err <-c(err)
	ypred <-c(ypred)	
	
	###   mean squared error 
	
	MSE <- sum(err)/(Nstazioni)		
	MSE

	###   root mean square error 

	RMSE.rk <- MSE^0.5
	RMSE.rk

Da: Moshood Agba Bakare [mailto:bakare at ualberta.ca] 
Inviato: gioved? 15 maggio 2014 17:39
A: Michele Fiori
Cc: rubenfcasal; r-sig-geo at r-project.org
Oggetto: Re: [R-sig-Geo] R: Regression Kriging cross validation

Hi Michele,
I have similar problem. I used ordinary kriging and inverse distance weighting method (IDW) to generate set of interpolated values from the same interpolation grid. I don't understand how cross validation can be done to come up with diagnostic statistics such as mse, rmse to use as basis for identifying the best interpolation method. I used krige.cv but I encountered error message. Please any advice on what to do please?

## Create grid for the interpolation through ordinary kriging and idw

grid <- expand.grid(easting = seq(from = 299678, to = 301299, by=10),
northing=seq(from = 5737278, to = 5738129, by=10))


## convert the grid to SpatialPixel class to indicate gridded spatial data

coordinates(grid)<-~easting + northing
proj4string(grid)<-CRS("+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0")
gridded(grid)<- TRUE

#### Ordinary kriging 

prok <- krige(id="yield",yield ~ 1, canmod.sp, newdata = grid, model=exp.mod,nmax=20,maxdist=33.0)

## Inverse Distance Weighting (IDW) Interpolation method

yield.idw = idw(yield~1, canmod.sp, grid,nmax=20,maxdist=33.0,idp=1)  


Thanks 
Moshood


On Thu, May 15, 2014 at 9:23 AM, Michele Fiori <mfiori at arpa.sardegna.it> wrote:
Thank you for your kind reply
therefore as I have used the Osl method for regression, my result will never
match the universal kriging; However, in order to validate my method, I'm
trying to implement in the script a calculation loop witch runs n times (the
number of stations) regression + kriging without one station at a time.
Thank you again
Michele


-----Messaggio originale-----
Da: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org]
Per conto di rubenfcasal
Inviato: marted? 29 aprile 2014 19:49
A: r-sig-geo at r-project.org
Oggetto: Re: [R-sig-Geo] Regression Kriging cross validation

Hello Michele,

     Universal kriging is equivalent to Linear Regression (with the
generalized-least-squaresestimator) + Simple Kriging of residuals (e.g.
Cressie, 1993, section 3.4.5). The differences you observe are probably due
to the use of ordinary least squares. If you use (leave-one-out)
cross-validation with krige.cv (considering the UK model), the trend is also
re-estimated at each prediction location. From my point of view, this would
be the recommended way to proceed.
     As far as I know, there are no available implementations of the
procedure you are suggesting.

     Best regards,
         Rub?n.


El 29/04/2014 13:33, Michele Fiori escribi?:
> Hi everyone,
> I am working on rainfall interpolation using regression kriging method
> and I need suggestions on how I can carry out a cross validation
> (leave-one-out) for this elaboration. At first I tried to apply
> directly Krige.cv, similarly to UK method (example for october:
> PP10uk.cv <- krige.cv(reg, prec2, PP10.vgm)), but unfortunately when I
> applied Universal Kriging on the same data, I realized that UK map was a
little different from RK map.
> So my question is: How could I manage universal kriging in order to
> make it equivalent to regression kriging and use the above
> cross-validation, or is there another different method to apply cross
> validation (leave-one-out) on Regression Kriging interpolation?
> Below my code:
> Many thanks
>
> Michele Fiori
>
> ARPAS - Environmental Protection Agency of Sardinia MeteoClimatic
> Department - Meteorological Service
>
> Viale Porto Torres 119 - 07100 Sassari, Italy Tel + 39 079 258617 Fax
> + 39 079 262681 www.sardegnaambiente.it/arpas
>
> ####  Creating SpatialPixelDataFrame ("dem" - 250x250 m grid)
>       ....
> ####  Loading Precipitation data
>       prec2 <- read.table("prec2.txt", sep="\t", header =TRUE)
>       coordinates(prec2) <- c("x", "y")
>       proj4string(prec2) <- CRS("+init=epsg:32632")
> ####  Linear regression Model
>       mod.gen <- lm(PP10 ~ QUOTA_MARE + UTM_EST + UTM_NORD + DIST_MARE,
> prec2)
>       step1 <- stepAIC(mod.gen, direction="both")
>       reg <- formula(step1)
>       PP10.lm <- lm(reg, prec2)
>       summary(PP10.lm)
>       prec2$residuals <- residuals(PP10.lm)
>       dem$predlm <- predict(PP10.lm, dem)
> ####  Variogram of residuals
>       PP10.vgm <- vgm(nugget=51.46, model="Sph", range=38038.89,
> psill=86.44)
> ####  Ordinary Kriging of residuals
>       PP10.okr <- krige(PP10.lm$residuals ~ 1, prec2, dem, PP10.vgm,
> maxdist=Inf)
>       dem$varokr <- PP10.okr$var1.pred
> ####  Regression Kriging (Linear Regression + Ordinary Kriging of
> residuals)
>       dem$vark <- dem$predlm + dem$varokr
> ####  Universal kriging
>       PP10.uk <- krige(reg, prec2, dem, PP10.vgm, maxdist=Inf)
>       dem$varuk <- PP10.uk$var1.pred
>       dem$difference <- dem$vark - dem$varuk
>       spplot(dem[c("difference")], col.regions=terrain.colors(25),
> contour=FALSE, cuts = 15)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From rubenfcasal at gmail.com  Fri May 16 14:32:22 2014
From: rubenfcasal at gmail.com (rubenfcasal)
Date: Fri, 16 May 2014 14:32:22 +0200
Subject: [R-sig-Geo] R:  R: Regression Kriging cross validation
In-Reply-To: <000901cf70db$8377f7e0$8a67e7a0$@arpa.sardegna.it>
References: <001101cf639e$d6cfa9f0$846efdd0$@arpa.sardegna.it>	<535FE602.8070605@gmail.com>	<002f01cf7051$a09e3b20$e1dab160$@arpa.sardegna.it>
	<CAJRR3XMoc=vcpPqX12wshpBZnuz+O=+3rBnr3JyXVM9TSZ2hRw@mail.gmail.com>
	<000901cf70db$8377f7e0$8a67e7a0$@arpa.sardegna.it>
Message-ID: <53760556.2060401@gmail.com>

Hi Michele,

Kriging methods assume that the variogram is known, although it is not 
in practice. With your procedure, the whole prediction method is 
reproduced (adding the extra-variability due to the estimation of the 
variogram), so a better approximation to the variability of the 
prediction error should be (in principle) obtained.

Excuse the rush...

Ruben Fernandez-Casal


El 16/05/2014 9:50, Michele Fiori escribi?:
> Dear All,
> Finally I managed to develop this ad hoc procedure for the regression kriging cross validation; I tried to test the kriging part (the regression part has been already tested successfully) by comparison with the krige.cv function and I noticed that there are small discrepancies. I verified that they are due to the fact that in my case the variogram is recalculated for each step, while the function runs using the same initial variogram obtained on the complete set of data.
> What do you think about?
> Michele
>
> ARPAS - Environmental Protection Agency of Sardinia MeteoClimatic
> Department - Meteorological Service
>
> Viale Porto Torres 119 - 07100 Sassari, Italy Tel + 39 079 258617 Fax
> + 39 079 262681 www.sardegnaambiente.it/arpas
>
> #################### Cross validation REGRESSION KRIGING (leave on out)
> 					
> 	PP03.lm <- lm(reg, prec2)
> 	Nstazioni <- length(prec2$NOME_STAZ)
> 	for (i in 1:Nstazioni) 	
> 	{
> 		###  regression step for point ?i?
>
> 		prec2.i <- prec2[-i,] 		
>    		md.i <- lm(reg, data=prec2.i)
> 	  		ypredlm.i <- predict(md.i,prec2[i,])
> 	  		err[i] <- (ypredlm.i - prec2$PP03[i])^2
> 		res[i] <- (ypredlm.i - prec2$PP03[i])
>
> 		###  kriging step for residual point ?i?
>
> 		PP03i.rsvar <- variogram(prec2.i$residuals~1, prec2.i)
> 		PP03i.ivgm <- vgm(nugget=0, model="Sph", range=sqrt(diff(prec2.i at bbox["x",])^2 + diff(prec2.i at bbox["y",])^2)/4, psill=var(prec2.i$residuals))
> 		PP03i.rvgm <- fit.variogram(PP03i.rsvar, model=PP03i.ivgm)
> 		ypredok.i<- krige(md.i$residuals~1, prec2.i, prec2[i,], PP03i.rvgm)
> 		ypredok.i$var1.pred
>
> 		###  Regression + kriging predicted value for point ?i?
> 		
> 		ypred.i <- ypredlm.i + ypredok.i$var1.pred
> 	
> 	   	err[i] <- (ypred.i - prec2$PP03[i])^2
> 		ypred[i] <- ypred.i		
> 	}
> 	err <-c(err)
> 	ypred <-c(ypred)	
> 	
> 	###   mean squared error
> 	
> 	MSE <- sum(err)/(Nstazioni)		
> 	MSE
>
> 	###   root mean square error
>
> 	RMSE.rk <- MSE^0.5
> 	RMSE.rk
>
> Da: Moshood Agba Bakare [mailto:bakare at ualberta.ca]
> Inviato: gioved? 15 maggio 2014 17:39
> A: Michele Fiori
> Cc: rubenfcasal; r-sig-geo at r-project.org
> Oggetto: Re: [R-sig-Geo] R: Regression Kriging cross validation
>
> Hi Michele,
> I have similar problem. I used ordinary kriging and inverse distance weighting method (IDW) to generate set of interpolated values from the same interpolation grid. I don't understand how cross validation can be done to come up with diagnostic statistics such as mse, rmse to use as basis for identifying the best interpolation method. I used krige.cv but I encountered error message. Please any advice on what to do please?
>
> ## Create grid for the interpolation through ordinary kriging and idw
>
> grid <- expand.grid(easting = seq(from = 299678, to = 301299, by=10),
> northing=seq(from = 5737278, to = 5738129, by=10))
>
>
> ## convert the grid to SpatialPixel class to indicate gridded spatial data
>
> coordinates(grid)<-~easting + northing
> proj4string(grid)<-CRS("+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0")
> gridded(grid)<- TRUE
>
> #### Ordinary kriging
>
> prok <- krige(id="yield",yield ~ 1, canmod.sp, newdata = grid, model=exp.mod,nmax=20,maxdist=33.0)
>
> ## Inverse Distance Weighting (IDW) Interpolation method
>
> yield.idw = idw(yield~1, canmod.sp, grid,nmax=20,maxdist=33.0,idp=1)
>
>
> Thanks
> Moshood
>
>
> On Thu, May 15, 2014 at 9:23 AM, Michele Fiori <mfiori at arpa.sardegna.it> wrote:
> Thank you for your kind reply
> therefore as I have used the Osl method for regression, my result will never
> match the universal kriging; However, in order to validate my method, I'm
> trying to implement in the script a calculation loop witch runs n times (the
> number of stations) regression + kriging without one station at a time.
> Thank you again
> Michele
>
>
> -----Messaggio originale-----
> Da: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org]
> Per conto di rubenfcasal
> Inviato: marted? 29 aprile 2014 19:49
> A: r-sig-geo at r-project.org
> Oggetto: Re: [R-sig-Geo] Regression Kriging cross validation
>
> Hello Michele,
>
>       Universal kriging is equivalent to Linear Regression (with the
> generalized-least-squaresestimator) + Simple Kriging of residuals (e.g.
> Cressie, 1993, section 3.4.5). The differences you observe are probably due
> to the use of ordinary least squares. If you use (leave-one-out)
> cross-validation with krige.cv (considering the UK model), the trend is also
> re-estimated at each prediction location. From my point of view, this would
> be the recommended way to proceed.
>       As far as I know, there are no available implementations of the
> procedure you are suggesting.
>
>       Best regards,
>           Rub?n.
>
>
> El 29/04/2014 13:33, Michele Fiori escribi?:
>> Hi everyone,
>> I am working on rainfall interpolation using regression kriging method
>> and I need suggestions on how I can carry out a cross validation
>> (leave-one-out) for this elaboration. At first I tried to apply
>> directly Krige.cv, similarly to UK method (example for october:
>> PP10uk.cv <- krige.cv(reg, prec2, PP10.vgm)), but unfortunately when I
>> applied Universal Kriging on the same data, I realized that UK map was a
> little different from RK map.
>> So my question is: How could I manage universal kriging in order to
>> make it equivalent to regression kriging and use the above
>> cross-validation, or is there another different method to apply cross
>> validation (leave-one-out) on Regression Kriging interpolation?
>> Below my code:
>> Many thanks
>>
>> Michele Fiori
>>
>> ARPAS - Environmental Protection Agency of Sardinia MeteoClimatic
>> Department - Meteorological Service
>>
>> Viale Porto Torres 119 - 07100 Sassari, Italy Tel + 39 079 258617 Fax
>> + 39 079 262681 www.sardegnaambiente.it/arpas
>>
>> ####  Creating SpatialPixelDataFrame ("dem" - 250x250 m grid)
>>        ....
>> ####  Loading Precipitation data
>>        prec2 <- read.table("prec2.txt", sep="\t", header =TRUE)
>>        coordinates(prec2) <- c("x", "y")
>>        proj4string(prec2) <- CRS("+init=epsg:32632")
>> ####  Linear regression Model
>>        mod.gen <- lm(PP10 ~ QUOTA_MARE + UTM_EST + UTM_NORD + DIST_MARE,
>> prec2)
>>        step1 <- stepAIC(mod.gen, direction="both")
>>        reg <- formula(step1)
>>        PP10.lm <- lm(reg, prec2)
>>        summary(PP10.lm)
>>        prec2$residuals <- residuals(PP10.lm)
>>        dem$predlm <- predict(PP10.lm, dem)
>> ####  Variogram of residuals
>>        PP10.vgm <- vgm(nugget=51.46, model="Sph", range=38038.89,
>> psill=86.44)
>> ####  Ordinary Kriging of residuals
>>        PP10.okr <- krige(PP10.lm$residuals ~ 1, prec2, dem, PP10.vgm,
>> maxdist=Inf)
>>        dem$varokr <- PP10.okr$var1.pred
>> ####  Regression Kriging (Linear Regression + Ordinary Kriging of
>> residuals)
>>        dem$vark <- dem$predlm + dem$varokr
>> ####  Universal kriging
>>        PP10.uk <- krige(reg, prec2, dem, PP10.vgm, maxdist=Inf)
>>        dem$varuk <- PP10.uk$var1.pred
>>        dem$difference <- dem$vark - dem$varuk
>>        spplot(dem[c("difference")], col.regions=terrain.colors(25),
>> contour=FALSE, cuts = 15)
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


From bakare at ualberta.ca  Fri May 16 18:24:13 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Fri, 16 May 2014 10:24:13 -0600
Subject: [R-sig-Geo] gstat Interpolated values of ordinary kriging vs IDW
Message-ID: <CAJRR3XPuPjSbHQ9+O-nFvTknaih+seNo6eESxh5Ynnes4nRdRw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140516/cfede1b2/attachment.pl>

From r.turner at auckland.ac.nz  Sat May 17 02:29:08 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Sat, 17 May 2014 12:29:08 +1200
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>
Message-ID: <5376AD54.5040708@auckland.ac.nz>

On 16/05/14 02:05, Hossain, Md wrote:
> Hi,
> Apology, my problem may be so simple to answer. I am trying to read disease locations (in longitude and latitude) for 49 adjacent states of USA as an PPP object with the R code:
>
> usdat <- data.frame(x=data$X, y=data2$Y)
> usmap <- map('usa', fill=TRUE, col="transparent", plot=FALSE)
> uspoly <- map2SpatialPolygons(usmap, IDs=usmap$names, proj4string=CRS("+proj=longlat +datum=WGS84"))
> spatstat.options(checkpolygons=FALSE)
> usowin <- as.owin.SpatialPolygons(uspoly)
> spatstat.options(checkpolygons=TRUE)
> pts <- as.ppp(usdat, W=usowin)
> plot(pts)
>
> But, getting the warning messages:
> 1: point-in-polygon test had difficulty with 2 points (total score not 0 or 1)
> 2: In ppp(X[, 1], X[, 2], window = win, marks = marx, check = check) :
>    42 points were rejected as lying outside the specified window
>
> Please suggest if there is any way I can keep these 42 points.

Actually you *do* "keep" them.  They form an attribute of your pattern; 
this attribute is called "rejects".  But they get plotted --- with a 
different symbol from the non-rejected points --- when you plot the pattern.

These points are rejected because they lie outside the window that you 
have specified.  If you want them not to be deemed "rejects" you have 
change your window.  Or possibly *move* these points slightly.  Both of 
these strategies are really "cheating" and therefore dubious.

Polygons provided as map boundaries by GIS facilities are almost always 
problematic.  The boundaries are generally very messy --- that's the 
nature of reality.  There is apparently a particular problem with your 
"usowin" window as indicated by the first warning message.  You should 
identify the two points that are causing the difficulty and figure out 
why the problem is arising.

Plot your pattern that has the rejects and examine the rejects.  Figure 
out if there is something weird about them, or about the map boundary 
near where they lie.  Figure out how to fix the weirdness.

To "focus in" on a small region of your window it might be helpful to
use clickpoly():

plot(usowin)
W <- clickpoly(add=TRUE)
# Click on, e.g. 4, points in anticlockwise order to obtain
# a polygon containing the region which you want to examine closely.
# Read the help on clickpoly().
U <- intersect.owin(usowin,W)
plot(U)

You will then probably want to plot the points of "pts" that fall in U
and the points of the rejects that fall in U.  Or perhaps in W:

plot(W)
plot(pts,add=TRUE)
plot(usowin,add=TRUE,border="red")

Things like that should give some insight into what is going wrong and 
perhaps how to fix it.  It will be fiddly.  Good luck.

cheers,

Rolf Turner


From adrian.baddeley at uwa.edu.au  Sat May 17 03:11:28 2014
From: adrian.baddeley at uwa.edu.au (Adrian Baddeley)
Date: Sat, 17 May 2014 09:11:28 +0800
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <5376AD54.5040708@auckland.ac.nz>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>,
	<5376AD54.5040708@auckland.ac.nz>
Message-ID: <CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>

In addition to Rolf's comments: 
I suggest you make sure you are using the current version
of spatstat (1.37-0).

In the code below you have set 'checkpolygons=FALSE'
before converting from 'SpatialPolygons' to 'owin'.

That was useful in older versions of 'spatstat'
because the checking was time-consuming. However 
turning off the checking carried the risk that the resulting 'owin' object 
could be invalid, causing strange things to happen when we test whether a 
point lies inside the window, etc.

In spatstat version 1.36-0 and later, polygon data is 
automatically repaired by owin() using the package 'polyclip'.
The resulting polygon is always valid; so checking is no longer performed.

So it would be wide to make sure you are running spatstat 1.37-0,
and remove the calls to spatstat.options('checkpolygons').

To inspect the data interactively, you can also use iplot()

regards
Adrian

Prof Adrian Baddeley FAA
University of Western Australia
________________________________________
From: Rolf Turner [r.turner at auckland.ac.nz]
Sent: Saturday, 17 May 2014 8:29 AM
To: Hossain, Md
Cc: r-sig-geo at r-project.org; Adrian Baddeley
Subject: Re: [R-sig-Geo] Warning message: points were rejected as lying outside the specified window

On 16/05/14 02:05, Hossain, Md wrote:
> Hi,
> Apology, my problem may be so simple to answer. I am trying to read disease locations (in longitude and latitude) for 49 adjacent states of USA as an PPP object with the R code:
>
> usdat <- data.frame(x=data$X, y=data2$Y)
> usmap <- map('usa', fill=TRUE, col="transparent", plot=FALSE)
> uspoly <- map2SpatialPolygons(usmap, IDs=usmap$names, proj4string=CRS("+proj=longlat +datum=WGS84"))
> spatstat.options(checkpolygons=FALSE)
> usowin <- as.owin.SpatialPolygons(uspoly)
> spatstat.options(checkpolygons=TRUE)
> pts <- as.ppp(usdat, W=usowin)
> plot(pts)
>
> But, getting the warning messages:
> 1: point-in-polygon test had difficulty with 2 points (total score not 0 or 1)
> 2: In ppp(X[, 1], X[, 2], window = win, marks = marx, check = check) :
>    42 points were rejected as lying outside the specified window
>
> Please suggest if there is any way I can keep these 42 points.

Actually you *do* "keep" them.  They form an attribute of your pattern;
this attribute is called "rejects".  But they get plotted --- with a
different symbol from the non-rejected points --- when you plot the pattern.

These points are rejected because they lie outside the window that you
have specified.  If you want them not to be deemed "rejects" you have
change your window.  Or possibly *move* these points slightly.  Both of
these strategies are really "cheating" and therefore dubious.

Polygons provided as map boundaries by GIS facilities are almost always
problematic.  The boundaries are generally very messy --- that's the
nature of reality.  There is apparently a particular problem with your
"usowin" window as indicated by the first warning message.  You should
identify the two points that are causing the difficulty and figure out
why the problem is arising.

Plot your pattern that has the rejects and examine the rejects.  Figure
out if there is something weird about them, or about the map boundary
near where they lie.  Figure out how to fix the weirdness.

To "focus in" on a small region of your window it might be helpful to
use clickpoly():

plot(usowin)
W <- clickpoly(add=TRUE)
# Click on, e.g. 4, points in anticlockwise order to obtain
# a polygon containing the region which you want to examine closely.
# Read the help on clickpoly().
U <- intersect.owin(usowin,W)
plot(U)

You will then probably want to plot the points of "pts" that fall in U
and the points of the rejects that fall in U.  Or perhaps in W:

plot(W)
plot(pts,add=TRUE)
plot(usowin,add=TRUE,border="red")

Things like that should give some insight into what is going wrong and
perhaps how to fix it.  It will be fiddly.  Good luck.

cheers,

Rolf Turner


From mpnelsen at gmail.com  Sat May 17 13:15:03 2014
From: mpnelsen at gmail.com (Matthew Nelsen)
Date: Sat, 17 May 2014 06:15:03 -0500
Subject: [R-sig-Geo] using getData function in raster to retrieve polygon
	data for all countries
Message-ID: <CABYdB-4xMbEvFsz218ydBcxvyRzfJMopLaqSEios9QF29Geb=Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140517/6972f6a0/attachment.pl>

From Md.Hossain at cchmc.org  Sun May 18 04:35:26 2014
From: Md.Hossain at cchmc.org (Hossain, Md)
Date: Sun, 18 May 2014 02:35:26 +0000
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>,
	<5376AD54.5040708@auckland.ac.nz>,
	<CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>
Message-ID: <5C8A52EFA35D9844BEB1224DD2D633C724A1A3C4@MCEXMB3.chmccorp.cchmc.org>

Very grateful to Rolf and Adrian for your kind suggestions. Obviously I am going to follow, but it seems there is no quick fix.
In the mean time, just wondering, is there anything that I can do with the "map2SpatialPolygons" function. The data came with the long-lat, but no information about how these long-lats are created, i.e., whether using "WGS84" is apropriate or should I try for other options, e.g., for GCS_North_American_1983_HARN. My knowledge in geography is very poor, please help.

Monir
________________________________________
From: Adrian Baddeley [adrian.baddeley at uwa.edu.au]
Sent: Friday, May 16, 2014 9:11 PM
To: Hossain, Md
Cc: r-sig-geo at r-project.org; r.turner at auckland.ac.nz
Subject: RE: [R-sig-Geo] Warning message: points were rejected as lying outside the specified window

In addition to Rolf's comments:
I suggest you make sure you are using the current version
of spatstat (1.37-0).

In the code below you have set 'checkpolygons=FALSE'
before converting from 'SpatialPolygons' to 'owin'.

That was useful in older versions of 'spatstat'
because the checking was time-consuming. However
turning off the checking carried the risk that the resulting 'owin' object
could be invalid, causing strange things to happen when we test whether a
point lies inside the window, etc.

In spatstat version 1.36-0 and later, polygon data is
automatically repaired by owin() using the package 'polyclip'.
The resulting polygon is always valid; so checking is no longer performed.

So it would be wide to make sure you are running spatstat 1.37-0,
and remove the calls to spatstat.options('checkpolygons').

To inspect the data interactively, you can also use iplot()

regards
Adrian

Prof Adrian Baddeley FAA
University of Western Australia
________________________________________
From: Rolf Turner [r.turner at auckland.ac.nz]
Sent: Saturday, 17 May 2014 8:29 AM
To: Hossain, Md
Cc: r-sig-geo at r-project.org; Adrian Baddeley
Subject: Re: [R-sig-Geo] Warning message: points were rejected as lying outside the specified window

On 16/05/14 02:05, Hossain, Md wrote:
> Hi,
> Apology, my problem may be so simple to answer. I am trying to read disease locations (in longitude and latitude) for 49 adjacent states of USA as an PPP object with the R code:
>
> usdat <- data.frame(x=data$X, y=data2$Y)
> usmap <- map('usa', fill=TRUE, col="transparent", plot=FALSE)
> uspoly <- map2SpatialPolygons(usmap, IDs=usmap$names, proj4string=CRS("+proj=longlat +datum=WGS84"))
> spatstat.options(checkpolygons=FALSE)
> usowin <- as.owin.SpatialPolygons(uspoly)
> spatstat.options(checkpolygons=TRUE)
> pts <- as.ppp(usdat, W=usowin)
> plot(pts)
>
> But, getting the warning messages:
> 1: point-in-polygon test had difficulty with 2 points (total score not 0 or 1)
> 2: In ppp(X[, 1], X[, 2], window = win, marks = marx, check = check) :
>    42 points were rejected as lying outside the specified window
>
> Please suggest if there is any way I can keep these 42 points.

Actually you *do* "keep" them.  They form an attribute of your pattern;
this attribute is called "rejects".  But they get plotted --- with a
different symbol from the non-rejected points --- when you plot the pattern.

These points are rejected because they lie outside the window that you
have specified.  If you want them not to be deemed "rejects" you have
change your window.  Or possibly *move* these points slightly.  Both of
these strategies are really "cheating" and therefore dubious.

Polygons provided as map boundaries by GIS facilities are almost always
problematic.  The boundaries are generally very messy --- that's the
nature of reality.  There is apparently a particular problem with your
"usowin" window as indicated by the first warning message.  You should
identify the two points that are causing the difficulty and figure out
why the problem is arising.

Plot your pattern that has the rejects and examine the rejects.  Figure
out if there is something weird about them, or about the map boundary
near where they lie.  Figure out how to fix the weirdness.

To "focus in" on a small region of your window it might be helpful to
use clickpoly():

plot(usowin)
W <- clickpoly(add=TRUE)
# Click on, e.g. 4, points in anticlockwise order to obtain
# a polygon containing the region which you want to examine closely.
# Read the help on clickpoly().
U <- intersect.owin(usowin,W)
plot(U)

You will then probably want to plot the points of "pts" that fall in U
and the points of the rejects that fall in U.  Or perhaps in W:

plot(W)
plot(pts,add=TRUE)
plot(usowin,add=TRUE,border="red")

Things like that should give some insight into what is going wrong and
perhaps how to fix it.  It will be fiddly.  Good luck.

cheers,

Rolf Turner


From r.turner at auckland.ac.nz  Sun May 18 10:29:38 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Sun, 18 May 2014 20:29:38 +1200
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <5C8A52EFA35D9844BEB1224DD2D633C724A1A3C4@MCEXMB3.chmccorp.cchmc.org>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>,
	<5376AD54.5040708@auckland.ac.nz>,
	<CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1A3C4@MCEXMB3.chmccorp.cchmc.org>
Message-ID: <53786F72.7080607@auckland.ac.nz>

On 18/05/14 14:35, Hossain, Md wrote:
> Very grateful to Rolf and Adrian for your kind suggestions. Obviously I
> am going to follow, but it seems there is no quick fix.
> In the mean time, just wondering, is there anything that I can do
> with the "map2SpatialPolygons" function. The data came with the
> long-lat, but no information about how these long-lats are created,
> i.e., whether using "WGS84" is apropriate or should I try for other
> options, e.g., for GCS_North_American_1983_HARN. My knowledge in
> geography is very poor, please help.

My knowledge about projections and the "datum" concept that is involved 
is nil.  So I can't help you.  Perhaps the maintainers of "sp" and/or 
"maptools" will chime in.  Good luck.

cheers,

Rolf Turner


From b.rowlingson at lancaster.ac.uk  Sun May 18 10:50:03 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 18 May 2014 09:50:03 +0100
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <2db59ef3ebcc4d04a6744520b292571b@EX-0-HT0.lancs.local>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>
	<5376AD54.5040708@auckland.ac.nz>
	<CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1A3C4@MCEXMB3.chmccorp.cchmc.org>
	<2db59ef3ebcc4d04a6744520b292571b@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNydHa3xbuHRC-mqMUMCbFZ3ak1Eab0ky39rbNN005jzA@mail.gmail.com>

On Sun, May 18, 2014 at 9:29 AM, Rolf Turner <r.turner at auckland.ac.nz> wrote:
> On 18/05/14 14:35, Hossain, Md wrote:
>> Very grateful to Rolf and Adrian for your kind suggestions. Obviously I
>> am going to follow, but it seems there is no quick fix.
>> In the mean time, just wondering, is there anything that I can do
>> with the "map2SpatialPolygons" function. The data came with the
>> long-lat, but no information about how these long-lats are created,
>> i.e., whether using "WGS84" is apropriate or should I try for other
>> options, e.g., for GCS_North_American_1983_HARN. My knowledge in
>> geography is very poor, please help.

Have you done whats been suggested and plotted the points to see *why*
the points are thought to be outside your map? Various things can
happen with data:

 x and y coordinates get swapped
 x and y coordinates are set to 0,0 or  -999,-999 to make missing data
 numbers get typed in wrong
 minus signs in western or southern hemisphere coordinates get left off
 locations are rounded to the nearest 100m, then converted to lat-long
 etc

 the other problem is that the boundary is an APPROXIMATION to the
border. To keep the dataset size small enough, a lot of the wiggly
coastline is approximated by a straight line. If you have points near
the coast then some may end up on the wrong side of the approximated
line. Is that what's happening? Have you plotted the points?

 don't go messing around with projections and datums (which might only
move points by a few metres) until you've had a look at why the points
are outside your polygon.

Barry


From Md.Hossain at cchmc.org  Sun May 18 17:15:54 2014
From: Md.Hossain at cchmc.org (Hossain, Md)
Date: Sun, 18 May 2014 15:15:54 +0000
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <CANVKczNydHa3xbuHRC-mqMUMCbFZ3ak1Eab0ky39rbNN005jzA@mail.gmail.com>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>
	<5376AD54.5040708@auckland.ac.nz>
	<CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1A3C4@MCEXMB3.chmccorp.cchmc.org>
	<2db59ef3ebcc4d04a6744520b292571b@EX-0-HT0.lancs.local>,
	<CANVKczNydHa3xbuHRC-mqMUMCbFZ3ak1Eab0ky39rbNN005jzA@mail.gmail.com>
Message-ID: <5C8A52EFA35D9844BEB1224DD2D633C724A1E460@MCEXMB3.chmccorp.cchmc.org>

Thanks, Berry.
The data do not have any obvious errors as you have mentioned. Almost all the points those are outside of the window are along the coastline, and rest are near the Great Lakes area. It looks like these 42 points are ending up on the wrong side of the approximated boundary.
Regards,

Monir
________________________________________
From: b.rowlingson at gmail.com [b.rowlingson at gmail.com] on behalf of Barry Rowlingson [b.rowlingson at lancaster.ac.uk]
Sent: Sunday, May 18, 2014 4:50 AM
To: Rolf Turner
Cc: Hossain, Md; r-sig-geo at r-project.org; Adrian Baddeley
Subject: Re: [R-sig-Geo] Warning message: points were rejected as lying outside the specified window

On Sun, May 18, 2014 at 9:29 AM, Rolf Turner <r.turner at auckland.ac.nz> wrote:
> On 18/05/14 14:35, Hossain, Md wrote:
>> Very grateful to Rolf and Adrian for your kind suggestions. Obviously I
>> am going to follow, but it seems there is no quick fix.
>> In the mean time, just wondering, is there anything that I can do
>> with the "map2SpatialPolygons" function. The data came with the
>> long-lat, but no information about how these long-lats are created,
>> i.e., whether using "WGS84" is apropriate or should I try for other
>> options, e.g., for GCS_North_American_1983_HARN. My knowledge in
>> geography is very poor, please help.

Have you done whats been suggested and plotted the points to see *why*
the points are thought to be outside your map? Various things can
happen with data:

 x and y coordinates get swapped
 x and y coordinates are set to 0,0 or  -999,-999 to make missing data
 numbers get typed in wrong
 minus signs in western or southern hemisphere coordinates get left off
 locations are rounded to the nearest 100m, then converted to lat-long
 etc

 the other problem is that the boundary is an APPROXIMATION to the
border. To keep the dataset size small enough, a lot of the wiggly
coastline is approximated by a straight line. If you have points near
the coast then some may end up on the wrong side of the approximated
line. Is that what's happening? Have you plotted the points?

 don't go messing around with projections and datums (which might only
move points by a few metres) until you've had a look at why the points
are outside your polygon.

Barry


From Roger.Bivand at nhh.no  Sun May 18 17:39:24 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 18 May 2014 17:39:24 +0200
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <5C8A52EFA35D9844BEB1224DD2D633C724A1E460@MCEXMB3.chmccorp.cchmc.org>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>
	<5376AD54.5040708@auckland.ac.nz>
	<CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1A3C4@MCEXMB3.chmccorp.cchmc.org>
	<2db59ef3ebcc4d04a6744520b292571b@EX-0-HT0.lancs.local>,
	<CANVKczNydHa3xbuHRC-mqMUMCbFZ3ak1Eab0ky39rbNN005jzA@mail.gmail.com>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1E460@MCEXMB3.chmccorp.cchmc.org>
Message-ID: <alpine.LRH.2.03.1405181729130.19360@reclus.nhh.no>

On Sun, 18 May 2014, Hossain, Md wrote:

> Thanks, Berry.
> The data do not have any obvious errors as you have mentioned. Almost 
> all the points those are outside of the window are along the coastline, 
> and rest are near the Great Lakes area. It looks like these 42 points 
> are ending up on the wrong side of the approximated boundary.

So either you can choose a different approximation to the shoreline you 
are interested in from another source. Or perhaps buffer it out the 
maximum distance from the excluded points to the original polygon (see 
rgeos::gDistance and rgeos::gBuffer)? This may not be adequate, as your 
polygon and points appear to be in geographical rather than planar 
coordinates, which will affect the naive distances obtained when using 
geographical coordinates as if they are planar.

Roger


> Regards,
>
> Monir
> ________________________________________
> From: b.rowlingson at gmail.com [b.rowlingson at gmail.com] on behalf of Barry Rowlingson [b.rowlingson at lancaster.ac.uk]
> Sent: Sunday, May 18, 2014 4:50 AM
> To: Rolf Turner
> Cc: Hossain, Md; r-sig-geo at r-project.org; Adrian Baddeley
> Subject: Re: [R-sig-Geo] Warning message: points were rejected as lying outside the specified window
>
> On Sun, May 18, 2014 at 9:29 AM, Rolf Turner <r.turner at auckland.ac.nz> wrote:
>> On 18/05/14 14:35, Hossain, Md wrote:
>>> Very grateful to Rolf and Adrian for your kind suggestions. Obviously I
>>> am going to follow, but it seems there is no quick fix.
>>> In the mean time, just wondering, is there anything that I can do
>>> with the "map2SpatialPolygons" function. The data came with the
>>> long-lat, but no information about how these long-lats are created,
>>> i.e., whether using "WGS84" is apropriate or should I try for other
>>> options, e.g., for GCS_North_American_1983_HARN. My knowledge in
>>> geography is very poor, please help.
>
> Have you done whats been suggested and plotted the points to see *why*
> the points are thought to be outside your map? Various things can
> happen with data:
>
> x and y coordinates get swapped
> x and y coordinates are set to 0,0 or  -999,-999 to make missing data
> numbers get typed in wrong
> minus signs in western or southern hemisphere coordinates get left off
> locations are rounded to the nearest 100m, then converted to lat-long
> etc
>
> the other problem is that the boundary is an APPROXIMATION to the
> border. To keep the dataset size small enough, a lot of the wiggly
> coastline is approximated by a straight line. If you have points near
> the coast then some may end up on the wrong side of the approximated
> line. Is that what's happening? Have you plotted the points?
>
> don't go messing around with projections and datums (which might only
> move points by a few metres) until you've had a look at why the points
> are outside your polygon.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From anusheema at gmail.com  Sun May 18 20:56:14 2014
From: anusheema at gmail.com (anusheema)
Date: Sun, 18 May 2014 11:56:14 -0700 (PDT)
Subject: [R-sig-Geo] Focal function in R
Message-ID: <1400439374664-7586466.post@n2.nabble.com>

Hi!

I want to run focal values for neighbourhood of focal cells using a matrix,
with a function preferably. My data has 0, 1, and 2 as values, and I want to
add values of "1" only, if I am using the focal function.

It's probably a very simple question, and I have tried many combinations,
but still not getting the desired results.

Please help!

Here's one of the codes that I was attempting:

# to generate the function
   my.function <- function (x) {
      ux <- unique(x)
      ux [if (x==1) ux <- focal(in_image, w=matrix(1/9, ncol=3, nrow=3)),
fun=sum]
      }

# to run the focal window for the desired function
    r_new <- focal(in_image, w=matrix(1/9, ncol=3, nrow=3), fun=my.function)



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Focal-function-in-R-tp7586466.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From martin.ivanov at env.ethz.ch  Mon May 19 09:43:52 2014
From: martin.ivanov at env.ethz.ch (Martin Ivanov)
Date: Mon, 19 May 2014 09:43:52 +0200
Subject: [R-sig-Geo] spplot: how to group the variables according to a
	factor?
Message-ID: <5379B638.9090008@env.ethz.ch>

Dear R users,

I need to produce a spatial plot of having 6 panels.
The upper 3 panels will contain the winter maps of 3 variables, and the lower panel will contain the summer maps of the
same three variables. I also need the outer strips, so that the figure looks something like this:

library(stats); library(latticeExtra);
useOuterStrips(dotplot(variety ~ yield | year * site, data=barley));

In this example there are 2 colums and 3 rows, and I want a 3 columns and 2 rows spatial graph
with a similar look. Is it possible to be achieved by spplot somehow? I know it is achievable by
levelplot if one defines the seasons as a conditioning variable. The problem is that I need to
additionally plot some spatial features like topography and rivers, so I need to take advantage of the
spplot features. I already tried to do that in analogy with this example

library(sp)
demo(meuse, ask = FALSE)
xyplot(y~x|ffreq, as(meuse, "data.frame"), asp="iso",
	panel = function(x,y,...) {
		sp.polygons(meuse.riv)
		# anything else you want to do in every panel
		panel.xyplot(x,y,...)
	},
	scales = list(draw = FALSE),
	xlab = NULL, ylab = NULL
)

The problem is that in my case I use levelplot with a 4-D array (3-rd dimension the 3 variables and
4th dimension the 2 seasons), so that it can automatically recognize the conditioning variable. However,
sp.polygons issued from inside the panel function does not work correctly, because x and y are factors, and
my polygons have numeric values.


Any suggestions will be appreciated.

Best regards,

-- 
Martin Ivanov
Institut f?r Atmosph?re und Klima
ETH Z?rich
CHN L 12.3
Universit?tstrasse 16
CH-8092 Z?rich, Schweiz
  
Telefon: +41 44 632 80 78
E-Mail: martin.ivanov at env.ethz.ch


From matteo.mattiuzzi at boku.ac.at  Mon May 19 10:00:32 2014
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Mon, 19 May 2014 10:00:32 +0200
Subject: [R-sig-Geo] Focal function in R
In-Reply-To: <1400439374664-7586466.post@n2.nabble.com>
References: <1400439374664-7586466.post@n2.nabble.com>
Message-ID: <5379D6400200002700020CC6@gwia2.boku.ac.at>

Is that what you want?

library(raster)
# your reproducible! raster
r <- raster()
r[] <- sample(0:2,ncell(r),replace=TRUE)

funX <- function(x){sum(x==1)} 
res1 <- focal(r,fun=funX,w=matrix(1, ncol=3, nrow=3))
# or in this special case (sum if 1) also 
rn <- r==1
res2 <- focal(rn,w=matrix(1, ncol=3, nrow=3))

# more general (eg sum if 2):
funX <- function(x){sum(x[x==2])} 
res3 <- focal(r,fun=funX,w=matrix(1, ncol=3, nrow=3))

Matteo


>>> anusheema <anusheema at gmail.com> 05/18/14 8:57 PM >>>
Hi!

I want to run focal values for neighbourhood of focal cells using a matrix,
with a function preferably. My data has 0, 1, and 2 as values, and I want to
add values of "1" only, if I am using the focal function.

It's probably a very simple question, and I have tried many combinations,
but still not getting the desired results.

Please help!

Here's one of the codes that I was attempting:

# to generate the function
   my.function <- function (x) {
      ux <- unique(x)
      ux [if (x==1) ux <- focal(in_image, w=matrix(1/9, ncol=3, nrow=3)),
fun=sum]
      }

# to run the focal window for the desired function
    r_new <- focal(in_image, w=matrix(1/9, ncol=3, nrow=3), fun=my.function)



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Focal-function-in-R-tp7586466.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From anusheema at gmail.com  Mon May 19 10:30:52 2014
From: anusheema at gmail.com (anusheema)
Date: Mon, 19 May 2014 01:30:52 -0700 (PDT)
Subject: [R-sig-Geo] Focal function in R
In-Reply-To: <5379D6400200002700020CC6@gwia2.boku.ac.at>
References: <1400439374664-7586466.post@n2.nabble.com>
	<5379D6400200002700020CC6@gwia2.boku.ac.at>
Message-ID: <CAH89e5z167_O8ydno60aqA7MfcX90pAS_r-_400ZEAyUh8bYLQ@mail.gmail.com>

Yes! It worked. Thank you so much!

Best,
Anusheema.


On Mon, May 19, 2014 at 1:31 PM, Matteo Mattiuzzi [via R-sig-geo] <
ml-node+s2731867n7586468h78 at n2.nabble.com> wrote:

> Is that what you want?
>
> library(raster)
> # your reproducible! raster
> r <- raster()
> r[] <- sample(0:2,ncell(r),replace=TRUE)
>
> funX <- function(x){sum(x==1)}
> res1 <- focal(r,fun=funX,w=matrix(1, ncol=3, nrow=3))
> # or in this special case (sum if 1) also
> rn <- r==1
> res2 <- focal(rn,w=matrix(1, ncol=3, nrow=3))
>
> # more general (eg sum if 2):
> funX <- function(x){sum(x[x==2])}
> res3 <- focal(r,fun=funX,w=matrix(1, ncol=3, nrow=3))
>
> Matteo
>
>
> >>> anusheema <[hidden email]<http://user/SendEmail.jtp?type=node&node=7586468&i=0>>
> 05/18/14 8:57 PM >>>
> Hi!
>
> I want to run focal values for neighbourhood of focal cells using a
> matrix,
> with a function preferably. My data has 0, 1, and 2 as values, and I want
> to
> add values of "1" only, if I am using the focal function.
>
> It's probably a very simple question, and I have tried many combinations,
> but still not getting the desired results.
>
> Please help!
>
> Here's one of the codes that I was attempting:
>
> # to generate the function
>    my.function <- function (x) {
>       ux <- unique(x)
>       ux [if (x==1) ux <- focal(in_image, w=matrix(1/9, ncol=3, nrow=3)),
> fun=sum]
>       }
>
> # to run the focal window for the desired function
>     r_new <- focal(in_image, w=matrix(1/9, ncol=3, nrow=3),
> fun=my.function)
>
>
>
> --
> View this message in context:
> http://r-sig-geo.2731867.n2.nabble.com/Focal-function-in-R-tp7586466.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=7586468&i=1>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=7586468&i=2>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://r-sig-geo.2731867.n2.nabble.com/Focal-function-in-R-tp7586466p7586468.html
>  To unsubscribe from Focal function in R, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7586466&code=YW51c2hlZW1hQGdtYWlsLmNvbXw3NTg2NDY2fC0xODk3OTg1ODMw>
> .
> NAML<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>



-- 
Regards

*Anusheema Chakraborty*
Ph.D. Scholar
Department of Natural Resources, TERI University
10, Institutional Area, Vasant Kunj, New Delhi - 110070
Website: www.teriuniversity.ac.in




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Focal-function-in-R-tp7586466p7586469.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From anusheema at gmail.com  Mon May 19 10:31:20 2014
From: anusheema at gmail.com (Anusheema Chakraborty)
Date: Mon, 19 May 2014 14:01:20 +0530
Subject: [R-sig-Geo] Focal function in R
In-Reply-To: <5379D6400200002700020CC6@gwia2.boku.ac.at>
References: <1400439374664-7586466.post@n2.nabble.com>
	<5379D6400200002700020CC6@gwia2.boku.ac.at>
Message-ID: <CAH89e5xrT9QmBoshAeKbXVQgm8ShKTNK7RvE0wiUY6mLTnk3mA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140519/ac5e5e80/attachment.pl>

From jurenoult at gmail.com  Mon May 19 15:03:33 2014
From: jurenoult at gmail.com (Julien Renoult)
Date: Mon, 19 May 2014 15:03:33 +0200
Subject: [R-sig-Geo] spatial analyses from picture
Message-ID: <CAFFd6+a-2f6k29S8HQMzkzN5R8LMExVS1wqaChFfSB-j6ydS8Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140519/de97f095/attachment.pl>

From forrest at ufl.edu  Mon May 19 15:46:54 2014
From: forrest at ufl.edu (Forrest Stevens)
Date: Mon, 19 May 2014 09:46:54 -0400
Subject: [R-sig-Geo] spatial analyses from picture
In-Reply-To: <CAFFd6+a-2f6k29S8HQMzkzN5R8LMExVS1wqaChFfSB-j6ydS8Q@mail.gmail.com>
References: <CAFFd6+a-2f6k29S8HQMzkzN5R8LMExVS1wqaChFfSB-j6ydS8Q@mail.gmail.com>
Message-ID: <CAEBQMMkLqCwt2Qsy0dAQk+1oi4-+jhLRS8DwEeFmUaWt85qOQw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140519/72a122a8/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon May 19 16:47:52 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 19 May 2014 15:47:52 +0100
Subject: [R-sig-Geo] spatial analyses from picture
In-Reply-To: <a004cd8b7f2945c99f862afcac3bb9e6@EX-1-HT0.lancs.local>
References: <CAFFd6+a-2f6k29S8HQMzkzN5R8LMExVS1wqaChFfSB-j6ydS8Q@mail.gmail.com>
	<a004cd8b7f2945c99f862afcac3bb9e6@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOQ_43bSD2LjApKRzfD=FEtCQMM-5AcNw=RT=_dxcFUjA@mail.gmail.com>

Sometimes its easier and cheaper to farm this out to something like
Amazon's Mechanical Turk system. Basically pay people $0.01 to look at
a picture and click if its a zebra or a horse - or whatever! I suspect
you can do multiple tests on each image to make sure people don't just
randomly click.

Of course automating these analyses is a nice research project, but
sometimes you just want to get things done and cheap labour is (sadly)
cheap. In this case, cheaper than research students.

Barry


On Mon, May 19, 2014 at 2:46 PM, Forrest Stevens <forrest at ufl.edu> wrote:
> Hi Julien, you've posed a really interesting problem, and the bulk of which
> I'd argue might not be best solved using R but I'll be very interested to
> hear other people's opinions on it. A large portion of your project is
> going to rely on good image processing, so the raster and jpeg packages
> will almost certainly come in handy. R has packages that tie into external
> utilities that have better analytical capabilities than many native R
> packages provide, however.  A good example of this is ImageJ and the R glue
> package RImageJ. You'll likely need to develop a workflow that does what
> you want using one of these types of external packages in terms of image
> pre-/processing and then end up automating it in R to some degree.
>
> Though I'm more of a remote sensing specialist I've found some of the best
> image analysis packages in R coming from the medical research community.
> The next place I'd point you is to the Medical Imaging task view,as much of
> what you're trying to do might be accomplished using packages there:
>
> http://cran.r-project.org/web/views/MedicalImaging.html
>
> For example, to identify patches of color, and likely do the major task of
> separating "animal" from "background" you will likely want to use a process
> called segmentation.  The dpmixsim package is one R package I found that
> does this using modern techniques, though it looks like it might be
> stagnant. There may be others I'm unaware of. I'm afraid I rely on other
> commercial tools (ENVI/IDL and eCognition for segmentation) so I might not
> be of much use there.
>
> This blog post is a much more basic approach to image segmentation that
> might get you on the road to a solution using only the jpeg package:
>
> http://alandgraf.blogspot.com/2012/02/unsupervised-image-segmentation-with.html
>
> Anyway, the rest of your stated research problem in terms of automating a
> dorsal vs. ventral orientation can be solved in a range of ways from the
> simple (assuming you have pre-processed the image to a horizontal
> orientation, identify "animal" pixels from "background" pixels, identify
> centroid location within animal pixels/outline polygon using the rgeos
> package, draw a horizontal line through it, etc.) to something much more
> complex.
>
> Anyway, hopefully that's food for thought.
>
> Sincerely,
> Forrest
>
> --
> Forrest R. Stevens
> Ph.D. Candidate, QSE3 IGERT Fellow
> Department of Geography
> Land Use and Environmental Change Institute
> University of Florida
> www.clas.ufl.edu/users/forrest
>
>
> On Mon, May 19, 2014 at 9:03 AM, Julien Renoult <jurenoult at gmail.com> wrote:
>
>> Dear R-user
>> I have a series of spatial analyses to run with R, but I have no idea of
>> which packages to use. Actually, these are not spatial analyses sensu
>> stricto, but the principle should be the same.
>> I would like to analyse animal colour patterns from pictures. I have
>> pictures of many species, and I would like to test wether colour A is more
>> associated (ie spatially close to)  with colour B than expected by chance.
>> I thus need to :
>> - open my pictures in R (currently in jpeg)
>> - delineate body contours, colour patches A and colour patches B
>> - extract coordinates for the three shapes
>> - perform some spatial statistics
>> Also, I would like to test wether colour A is located more on the dorsal
>> than on the ventral side. I thus need to define a line (mid-body) and
>> calculate the area of colour A above and below this line.
>>
>> Please, could anyone indicate me which package(s) to use for these tasks? I
>> read the CRAN task view page for spatial data, but there are so many
>> packages !!
>> In advance, thank you very much.
>> Best regards, Julien
>>
>>
>> *Julien Renoult*
>> *Charg? de Recherche CNRS*
>> *Ph.D Evolutionary Biology - Dr. Vet. Med.*
>>
>> *UMR8218*
>> *Art Cr?ation Th?orie & Esth?tique*
>> *49 rue des Bergers*
>> *75015 Paris*
>> *+33615265240*
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>         [[alternative HTML version deleted]]
>


From edzer.pebesma at uni-muenster.de  Mon May 19 16:57:03 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 19 May 2014 16:57:03 +0200
Subject: [R-sig-Geo] spplot: how to group the variables according to a
 factor?
In-Reply-To: <5379B638.9090008@env.ethz.ch>
References: <5379B638.9090008@env.ethz.ch>
Message-ID: <537A1BBF.6080209@uni-muenster.de>

spplot does not support outer strips; I would try to directly use
lattice::levelplot, and sp.polygons added to the default panel function.

To plot array data with levelplot, you need to convert them to a long
table, this can be done for instance with plyr::adply.

On 05/19/2014 09:43 AM, Martin Ivanov wrote:
> Dear R users,
> 
> I need to produce a spatial plot of having 6 panels.
> The upper 3 panels will contain the winter maps of 3 variables, and the
> lower panel will contain the summer maps of the
> same three variables. I also need the outer strips, so that the figure
> looks something like this:
> 
> library(stats); library(latticeExtra);
> useOuterStrips(dotplot(variety ~ yield | year * site, data=barley));
> 
> In this example there are 2 colums and 3 rows, and I want a 3 columns
> and 2 rows spatial graph
> with a similar look. Is it possible to be achieved by spplot somehow? I
> know it is achievable by
> levelplot if one defines the seasons as a conditioning variable. The
> problem is that I need to
> additionally plot some spatial features like topography and rivers, so I
> need to take advantage of the
> spplot features. I already tried to do that in analogy with this example
> 
> library(sp)
> demo(meuse, ask = FALSE)
> xyplot(y~x|ffreq, as(meuse, "data.frame"), asp="iso",
>     panel = function(x,y,...) {
>         sp.polygons(meuse.riv)
>         # anything else you want to do in every panel
>         panel.xyplot(x,y,...)
>     },
>     scales = list(draw = FALSE),
>     xlab = NULL, ylab = NULL
> )
> 
> The problem is that in my case I use levelplot with a 4-D array (3-rd
> dimension the 3 variables and
> 4th dimension the 2 seasons), so that it can automatically recognize the
> conditioning variable. However,
> sp.polygons issued from inside the panel function does not work
> correctly, because x and y are factors, and
> my polygons have numeric values.
> 
> 
> Any suggestions will be appreciated.
> 
> Best regards,
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140519/1b69418e/attachment.bin>

From marcel.au at web.de  Tue May 20 09:40:35 2014
From: marcel.au at web.de (Marcel)
Date: Tue, 20 May 2014 00:40:35 -0700 (PDT)
Subject: [R-sig-Geo] spatial analyses from picture
In-Reply-To: <CAFFd6+a-2f6k29S8HQMzkzN5R8LMExVS1wqaChFfSB-j6ydS8Q@mail.gmail.com>
References: <CAFFd6+a-2f6k29S8HQMzkzN5R8LMExVS1wqaChFfSB-j6ydS8Q@mail.gmail.com>
Message-ID: <1400571635287-7586475.post@n2.nabble.com>

Hello, 

i think you can do that with Bio7 (OpenSource):
 
http://bio7.org

It integrates a R GUI

see: http://bio7.org/documentation/Main.html#toc-Section-4.6

and ImageJ GUI

see: http://bio7.org/documentation/Main.html#toc-Section-4.3

in one platform. 

Images, selected image data and selection coordinates (of different
selection types) can be transferred to an R workspace.

see: http://bio7.org/documentation/Main.html#toc-Subsubsection-4.3.3.1

In addition you can transfer the results of a ImageJ Particle Analysis (e.g.
centroids, diameter, e.g.) from thresholded images directly to R:

http://rsbweb.nih.gov/ij/docs/guide/146-30.html#toc-Subsection-30.2

In your case you could threshold the different colours in ImageJ, select
them (Wand Tool) and send the shapes and pixels to R for a spatial analysis.

Or if you have more than one shape (pattern) with the same signature you can
make a Particle Analysis from thresholded images and send the results to a
ROI (Region Of Interest) Manager:

http://rsbweb.nih.gov/ij/docs/guide/146-30.html#sub:ROI-Manager...

The ROI measurements (pixels) and ROI selection data from the different
shapes can be transferred with two available actions in Bio7. In addition
you can transfer the selection data of a stack of images, too.

The results can be analyzed with R e.g. with the great spatstat package:

http://www.spatstat.org/ 

or maybe the rgeos package is useful for you:

http://www.inside-r.org/packages/cran/rgeos/docs/gDistance

Best regards

Marcel




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spatial-analyses-from-picture-tp7586471p7586475.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alessandracarioli at gmail.com  Tue May 20 15:49:42 2014
From: alessandracarioli at gmail.com (Alessandra Carioli)
Date: Tue, 20 May 2014 15:49:42 +0200
Subject: [R-sig-Geo] kriging to determine effect of area size on global
	Moran index
Message-ID: <AA55B423-4121-4170-BB8D-9C1A35E1DFCE@gmail.com>

Dear bloggers,

I am working with spatial polygons to see how variables are spatially correlated and how such correlation changes in time in a specific country.
I want to look a bit more into detail at Moran?sI and how the morphology (surface and/or population) of the areas I consider can impact spatial correlation.
What I want to do is use my shape file of spatial polygons and divide all the areas in it into a grid of equally surfaced areas (let?s say each area has a surface of 100sqkm).
The resulting grid of areas will have (I think) new centroids and each variable will have to be recomputed (or interpolated) to reflect the new subdivision.

I know kriging should be the ideal tool to do this, but on internet I have found so many tutorials and I am quite confused on the steps to take (also because trying to run the code in my case does not work).

Any help on the matter is greatly appreciated!

Ale


From Roger.Bivand at nhh.no  Tue May 20 16:37:13 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 20 May 2014 16:37:13 +0200
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 128, Issue 17
In-Reply-To: <CABkCotRZ9pW8VOxatki7m+P_Cq4OsK9yrc6X4tEEkb8wRDOEfA@mail.gmail.com>
References: <mailman.11.1397728803.15374.r-sig-geo@r-project.org>
	<9BCFA5AF-986D-4064-9A1B-4036F3797D62@ecotoxicology.de>
	<CABkCotRZ9pW8VOxatki7m+P_Cq4OsK9yrc6X4tEEkb8wRDOEfA@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1405201635560.4707@reclus.nhh.no>

This posting by Brian Ripley on R-sig-mac should provide relief to 
Mavericks sufferers:

https://stat.ethz.ch/pipermail/r-sig-mac/2014-May/010871.html

Roger

On Sat, 19 Apr 2014, Manuel Sp?nola wrote:

> Thank you very much Ralf.
>
> Manuel
>
>
> 2014-04-17 4:14 GMT-06:00 Ralf Sch?fer <senator at ecotoxicology.de>:
>
>>
>>>
>>> Message: 9
>>> Date: Wed, 16 Apr 2014 19:23:09 +0200
>>> From: Roger Bivand <Roger.Bivand at nhh.no>
>>> To: Manuel Sp?nola <mspinola10 at gmail.com>
>>> Cc: "r-sig-geo at r-project.org" <r-sig-geo at r-project.org>
>>> Subject: Re: [R-sig-Geo] rgdal for iOS mavericks build (R 3.1.0)
>>> Message-ID: <alpine.LRH.2.03.1404161913120.18290 at reclus.nhh.no>
>>> Content-Type: text/plain; charset="iso-8859-15"; Format="flowed"
>>>
>>> On Wed, 16 Apr 2014, Manuel Sp?nola wrote:
>>>
>>>> Dear list members,
>>>>
>>>> I am using R 3.1.0 mavericks build but I noticed that rgdal is not
>>>> available yet.  Any idea when will be available?
>>>
>>> Thanks for the heads-up - this is not something the rgdal maintainer or
>>> developers can answer (also I have no OSX access of any kind, let alone
>>> Mavericks). Please ask on R-sig-mac to establish the current situation -
>>> it may be that the new Apple build trains are creating problems for GDAL
>>> and PROJ, and if they cannot be built easily, the rgdal binaries will
>> also
>>> not be forthcoming until this is dealt with. Please report back on
>> replies
>>> on R-sig-mac.
>>>
>>> If you can install rgdal from source, look at:
>>>
>>> http://www.kyngchaos.com/software/frameworks
>>>
>>> for suitable frameworks for GDAL/PROJ (and GEOS if you need rgeos). There
>>> are discussions related to Mavericks on Kyngchaos.
>>>
>>
>> The problems seem to have to do with the new built for Maverick.
>>
>> However, you can download the package here:
>> http://cran.r-project.org/bin/macosx/contrib/3.1/
>> And install manually (local package with source code)
>>
>> This works also for gstat, rgeos, spacetime and so on.
>>
>> I found this solution here:
>> https://groups.google.com/forum/#!msg/r-sig-mac/3yrqRaMrSPQ/ERkzSsoYe-cJ
>>
>> Best regards
>> Ralf
>>
>>
>>
>>
>>
>>
>>
>>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no

From srinivasv at feralindia.org  Tue May 20 16:37:29 2014
From: srinivasv at feralindia.org (Srinivas V)
Date: Tue, 20 May 2014 20:07:29 +0530
Subject: [R-sig-Geo] Error in clusterR
In-Reply-To: <CABG0rfuLkkS2PSzQqSvRm7MNZkc7OS67_bBEqvxjWZkR2e56bA@mail.gmail.com>
References: <5371EFDF.3030201@feralindia.org>
	<CABG0rfuLkkS2PSzQqSvRm7MNZkc7OS67_bBEqvxjWZkR2e56bA@mail.gmail.com>
Message-ID: <537B68A9.50607@feralindia.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140520/cc15c45c/attachment.pl>

From corderos at umich.edu  Tue May 20 17:28:05 2014
From: corderos at umich.edu (Silvia Cordero-Sancho)
Date: Tue, 20 May 2014 11:28:05 -0400
Subject: [R-sig-Geo] Spatstat: (coef(summary()) inquiry/problem.
Message-ID: <CAORmci_mA4XLWS3bb7n+kMnk_TcTPZQuN9q2URKrTig6Ab4A=w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140520/01130640/attachment.pl>

From rgenevest at free.fr  Tue May 20 18:41:36 2014
From: rgenevest at free.fr (Remi Genevest)
Date: Tue, 20 May 2014 09:41:36 -0700 (PDT)
Subject: [R-sig-Geo] Create a simple spatial grid
Message-ID: <1400604096728-7586481.post@n2.nabble.com>

Hi,
My question is very trivial. I want to create a "blank" grid that contains
regular cells from 20meter*20meter in a WGS84 CRS, covering Europe.
My purpose is to used this grid as a "base layer" to then add some
additional layers (with different resolution and extent) and make some
spatial analyses with all these stuff.

Which way should I follow to manage this ?

Thanks a lot




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Create-a-simple-spatial-grid-tp7586481.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Tue May 20 19:04:50 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 20 May 2014 18:04:50 +0100
Subject: [R-sig-Geo] Create a simple spatial grid
In-Reply-To: <1d8203d97b7148ffbbf9ad77890c7ba6@EX-0-HT0.lancs.local>
References: <1d8203d97b7148ffbbf9ad77890c7ba6@EX-0-HT0.lancs.local>
Message-ID: <CANVKczMKAmJxuzvz=wEd2t=3YpUo7YSb+vf24-Ywu2fJyX3E4A@mail.gmail.com>

On Tue, May 20, 2014 at 5:41 PM, Remi Genevest <rgenevest at free.fr> wrote:
> Hi,
> My question is very trivial. I want to create a "blank" grid that contains
> regular cells from 20meter*20meter in a WGS84 CRS, covering Europe.
> My purpose is to used this grid as a "base layer" to then add some
> additional layers (with different resolution and extent) and make some
> spatial analyses with all these stuff.
>
> Which way should I follow to manage this ?

 Step 1 is "buy a bigger computer". Europe is about 3,000km EW and NS
(wikipedia gives the area as about 10,000,000 square km - that might
be the land area? Anyway, orders of magnitude...), which is 150,000 of
your 20metre cells by 150,000. Or twice as many if that was just the
land area. That's 22 billion cells. And you haven't put any data in
them yet.

 Step 2 is the tricky step. You can't create what's commonly thought
of as a 'regular grid' on a sphere. You can make each cell centre 20m
from its nearest neighbours (I think, at least until you run up
against the pole), but it won't be 40m from its next-nearest
neighbours when measured along the great circle distance. You can use
a coordinate system other than WGS84, and make a 20m spaced-out set of
cells, but the distances computed along the sphere won't be right.

 There are some standard map projections that european-wide data seems
to use, mostly based on Lambert conformal conical projections. You
might want to copy the grid used for CORINE data:

http://www.eea.europa.eu/data-and-maps/data/corine-land-cover-2000-raster-3

 - which goes to 100x100m resolution (or 250x250 if you don't want to
have to buy a new PC to load the whole continent...).

Barry


From fierceturtle at gmail.com  Tue May 20 21:19:23 2014
From: fierceturtle at gmail.com (steven brey)
Date: Tue, 20 May 2014 12:19:23 -0700
Subject: [R-sig-Geo] Figuring out a locations local daylight hours
Message-ID: <CAD4v2s0BZ2D-nnD5=62hdzb9SBbp2XFWuPZ8T8=MgOgLX7vbcg@mail.gmail.com>

I am using R to write a text forecast for particulate matter
concentrations. Given a date, latitude, and longitude I would like to
figure out the local daylight hours. Does anyone know of a resource
that can make this calculation? I wanted to see if there was an
existing resource/solution before diving into the
trigonometry/astronomy 101 necessary to figure this out.

Cheers


From galuardi at mit.edu  Tue May 20 21:23:16 2014
From: galuardi at mit.edu (Ben)
Date: Tue, 20 May 2014 19:23:16 +0000
Subject: [R-sig-Geo] Figuring out a locations local daylight hours
In-Reply-To: <CAD4v2s0BZ2D-nnD5=62hdzb9SBbp2XFWuPZ8T8=MgOgLX7vbcg@mail.gmail.com>
Message-ID: <em5c4be68d-ff2f-4867-903e-59451177c77b@lprc-gis>

the maptools library in R can take care of this easily. Look for the 
sunriset function. You can get hours of daylight based on times of 
sunrise and sunset, and adjust according to whatever type of twilight 
definition you wish (i.e. civil vs. astronomical)

hope that helps

Ben

------ Original Message ------
From: "steven brey" <fierceturtle at gmail.com>
To: r-sig-geo at r-project.org
Sent: 5/20/2014 3:19:23 PM
Subject: [R-sig-Geo] Figuring out a locations local daylight hours

>I am using R to write a text forecast for particulate matter
>concentrations. Given a date, latitude, and longitude I would like to
>figure out the local daylight hours. Does anyone know of a resource
>that can make this calculation? I wanted to see if there was an
>existing resource/solution before diving into the
>trigonometry/astronomy 101 necessary to figure this out.
>
>Cheers
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From rgenevest at free.fr  Tue May 20 21:44:06 2014
From: rgenevest at free.fr (Remi Genevest)
Date: Tue, 20 May 2014 12:44:06 -0700 (PDT)
Subject: [R-sig-Geo] Create a simple spatial grid
In-Reply-To: <CANVKczMKAmJxuzvz=wEd2t=3YpUo7YSb+vf24-Ywu2fJyX3E4A@mail.gmail.com>
References: <1400604096728-7586481.post@n2.nabble.com>
	<CANVKczMKAmJxuzvz=wEd2t=3YpUo7YSb+vf24-Ywu2fJyX3E4A@mail.gmail.com>
Message-ID: <1400615046555-7586485.post@n2.nabble.com>

You're right, such a high resolution for all over Europe is unrealistic. 

I should rather build a smaller grid for the 20m*20m cells and make an other
coarser grid for the whole Europe.

But, anyway, how can I create a spatial grid from scratch, by defining CRS,
resolution and extent of my grid ?






--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Create-a-simple-spatial-grid-tp7586481p7586485.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.turner at auckland.ac.nz  Wed May 21 03:25:32 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Wed, 21 May 2014 13:25:32 +1200
Subject: [R-sig-Geo] Spatstat: (coef(summary()) inquiry/problem.
In-Reply-To: <CAORmci_mA4XLWS3bb7n+kMnk_TcTPZQuN9q2URKrTig6Ab4A=w@mail.gmail.com>
References: <CAORmci_mA4XLWS3bb7n+kMnk_TcTPZQuN9q2URKrTig6Ab4A=w@mail.gmail.com>
Message-ID: <537C008C.1060609@auckland.ac.nz>

On 21/05/14 03:28, Silvia Cordero-Sancho wrote:
> Hello,
>
> I am running a hybrid model (following Baddeleyet al 2013). I am using the
> ppm function, the tendency is being represented by a set of environmental
> variables  ("im"- format) and the incidence is being represented by a
> hybrid model (StraussHard and AreaInter). It seems that everything is
> working properly, I have been able to use the following tools with the
> model (simulate(), diagnose.ppm()) but I have not been successful to use
> the tool  (coef(summary()).
>
> The problem is that it runs for hours,  which made me concern that there is
> something abnormal, (so I killed the process after a couple of hours). With
>   previous models (no hybrid ones) I was able to use this tool and display
> the coefficients without problem. I will like to know if this is "normal"
> or it is a sign that it is something abnormal with my model.
>
> I will appreciate any advise.

I just tried a toy example using the sort of model you are fitting and 
there does seem to be a problem with summary() going away and not coming 
back.  We (i.e. Adrian --- (!!!) :-) ) will try to work out what is 
going on.  And with a bit of luck, get back to you.

cheers,

Rolf Turner


From r.turner at auckland.ac.nz  Wed May 21 03:46:52 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Wed, 21 May 2014 13:46:52 +1200
Subject: [R-sig-Geo] Spatstat: (coef(summary()) inquiry/problem.
In-Reply-To: <CAORmci_mA4XLWS3bb7n+kMnk_TcTPZQuN9q2URKrTig6Ab4A=w@mail.gmail.com>
References: <CAORmci_mA4XLWS3bb7n+kMnk_TcTPZQuN9q2URKrTig6Ab4A=w@mail.gmail.com>
Message-ID: <537C058C.4080700@auckland.ac.nz>

On 21/05/14 03:28, Silvia Cordero-Sancho wrote:
> Hello,
>
> I am running a hybrid model (following Baddeleyet al 2013). I am using the
> ppm function, the tendency is being represented by a set of environmental
> variables  ("im"- format) and the incidence is being represented by a
> hybrid model (StraussHard and AreaInter). It seems that everything is
> working properly, I have been able to use the following tools with the
> model (simulate(), diagnose.ppm()) but I have not been successful to use
> the tool  (coef(summary()).
>
> The problem is that it runs for hours,  which made me concern that there is
> something abnormal, (so I killed the process after a couple of hours). With
>   previous models (no hybrid ones) I was able to use this tool and display
> the coefficients without problem. I will like to know if this is "normal"
> or it is a sign that it is something abnormal with my model.
>
> I will appreciate any advise.

Follow up to my previous message --- I was too impatient with my toy 
example.  The summary() function *did* return a result, after a matter 
of minutes (rather than hours).

So it would seem that although it might be a bit slow, there is no 
fundamental problem with summary.ppm().  The problem would appear to be, 
to some extent, peculiar to your data set.

How many points are there in the pattern?  How messy is the observation 
window?

If you could make your data available we might be able to experiment and 
see if anything can be done to speed things up.

cheers,

Rolf Turner


From adrian.baddeley at uwa.edu.au  Wed May 21 05:05:09 2014
From: adrian.baddeley at uwa.edu.au (Adrian Baddeley)
Date: Wed, 21 May 2014 11:05:09 +0800
Subject: [R-sig-Geo] Spatstat: (coef(summary()) inquiry/problem.
In-Reply-To: <537C008C.1060609@auckland.ac.nz>
References: <CAORmci_mA4XLWS3bb7n+kMnk_TcTPZQuN9q2URKrTig6Ab4A=w@mail.gmail.com>,
	<537C008C.1060609@auckland.ac.nz>
Message-ID: <CF5661163F77A44781208D9AC4FDEA725D672605A4@IS-WIN-376.staffad.uwa.edu.au>

On 21/05/14 03:28, Silvia Cordero-Sancho wrote:

> I am running a hybrid model (following Baddeleyet al 2013). I am using the
> ppm function, the tendency is being represented by a set of environmental
> variables  ("im"- format) and the incidence is being represented by a
> hybrid model (StraussHard and AreaInter). It seems that everything is
> working properly, I have been able to use the following tools with the
> model (simulate(), diagnose.ppm()) but I have not been successful to use
> the tool  (coef(summary()).
>
> The problem is that it runs for hours,  which made me concern that there is
> something abnormal, (so I killed the process after a couple of hours). With
>   previous models (no hybrid ones) I was able to use this tool and display
> the coefficients without problem. I will like to know if this is "normal"
> or it is a sign that it is something abnormal with my model.

This is `normal' behaviour in the current version of spatstat.

Because the Hybrid models are relatively new, the package is not yet 
optimised to support them. 

By typing coef(summary(...)) you are asking for the fitted coefficients
and their **standard errors**.

summary.ppm calls vcov.ppm which calculates variance estimates
for the fitted parameters of the model. The variance calculation is 
very time-consuming (because it involves evaluating the
second order conditional intensity for every pair of data points).

For some models, such as pairwise interactions and the area-interaction model,
we have special C code which accelerates this calculation by 3 orders of magnitude. 

For a general Hybrid model, we haven't implemented this yet, so the package has to
fall back on the generic algorithm. Hence it takes about 1000 times as long to do the
variance calculation for Hybrid(A,B) as it does to do it for A and separately for B.

The area-interaction model is computationally expensive, and the computation time
increases dramatically with the disc radius r. Temporary solutions could be to use
smaller interaction radius, or to replace AreaInter with a less computationally-demanding
model.

In the next version of spatstat (1.37-1) we will include a partial implementation
of the fast C code for hybrids, which will work for your example.

Prof Adrian Baddeley FAA
University of Western Australia


From b.rowlingson at lancaster.ac.uk  Wed May 21 11:40:29 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 21 May 2014 10:40:29 +0100
Subject: [R-sig-Geo] Create a simple spatial grid
In-Reply-To: <644fc141a834485ca9e4b08ad77d32bb@EX-0-HT0.lancs.local>
References: <1400604096728-7586481.post@n2.nabble.com>
	<CANVKczMKAmJxuzvz=wEd2t=3YpUo7YSb+vf24-Ywu2fJyX3E4A@mail.gmail.com>
	<644fc141a834485ca9e4b08ad77d32bb@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOmioJEBYKR=c4=gfgdSjA_C9XESgWizTXerpn-vpiLpg@mail.gmail.com>

On Tue, May 20, 2014 at 8:44 PM, Remi Genevest <rgenevest at free.fr> wrote:
> You're right, such a high resolution for all over Europe is unrealistic.
>
> I should rather build a smaller grid for the 20m*20m cells and make an other
> coarser grid for the whole Europe.
>
> But, anyway, how can I create a spatial grid from scratch, by defining CRS,
> resolution and extent of my grid ?
>

 The raster package has functions for doing all that.

# coordinate systems by epsg code - the EU one and lat-long:

eu = CRS("+init=epsg:3035")
ll = CRS("+init=epsg:4326")

# I'm going to make a 101x81 grid of *approximate* 20m squares with
origin at this lat-long point:

origin = SpatialPoints(cbind(-2.783897,54.008399),ll)

# I have to convert that origin point to EU projection coordinates,
which are in metres:

require(rgdal)
origin.eu = spTransform(origin, eu)

# and I'm going to specify my extent. I've rounded the origin
coordinates to the nearest 100:

e = extent(3487700, 3487700+(101*20), 3507300, 3507300 + (81*20))

# now I define a raster based on that extent:

r = raster(e)

# and tell it it has 20m square cells:

res(r)=c(20,20)

# now I can fill it with 81*101 data values:

r[] = runif(81*101)

# set its projection:

projection(r)=eu

# and plot it.

plot(r)

# I can save it as a GeoTIFF:

writeRaster(r,"/tmp/uni.tif")

Now, if I use QGIS to plot that grid over an OpenStreetMap basemap
then it doesn't line up with NS, because the UK is quite far west in
europe and the angular change in a conical projection is extremal at
the west and east limits. If you want NS aligned rasters you need
another CRS, and that will have other distortions in it. C'est la vie.

Barry


From rgenevest at free.fr  Wed May 21 18:14:58 2014
From: rgenevest at free.fr (Remi Genevest)
Date: Wed, 21 May 2014 09:14:58 -0700 (PDT)
Subject: [R-sig-Geo] Create a simple spatial grid
In-Reply-To: <CANVKczOmioJEBYKR=c4=gfgdSjA_C9XESgWizTXerpn-vpiLpg@mail.gmail.com>
References: <1400604096728-7586481.post@n2.nabble.com>
	<CANVKczMKAmJxuzvz=wEd2t=3YpUo7YSb+vf24-Ywu2fJyX3E4A@mail.gmail.com>
	<CANVKczOmioJEBYKR=c4=gfgdSjA_C9XESgWizTXerpn-vpiLpg@mail.gmail.com>
Message-ID: <1400688898276-7586490.post@n2.nabble.com>

Thanks a lot Barry. Your post perfectly matches what I was looking for.

Well now if I want to do a coarser grid covering Europe, what I should do is
doing more or less the same thing, just to change the resolution, right? 

res(r)=c(100,100)  # an approximate 100meters squared cells

Then I got my raster in a EU coordinates system, and I would like to
transform it into a WGS 84 (so as adding other layers would become easier).
I tried this way, but it doesn't work :

# change the CRS into WGS84 (ll)
r.new<-projectRaster(r,crs="+init=epsg:4326") 
# adapt the extent to Europe
ext = extent(-10.417,31.917,34.083,71.083)
extent(r.new)<-ext
# plot the map
plot(r.new,axes=TRUE)
# Here I get a plot that is not projected in a proper way.

So, I wondered if avoiding the projectRaster() function would be alright :

# Change only the extent adapt the extent to Europe
ext = extent(-10.417,31.917,34.083,71.083)
extent(r)<-ext
projection(r)<-"+init=epsg:4326"
plot(r,axes=TRUE)

Am I wrong ?!

Best regards
R?mi



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Create-a-simple-spatial-grid-tp7586481p7586490.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From bakare at ualberta.ca  Wed May 21 21:15:56 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Wed, 21 May 2014 13:15:56 -0600
Subject: [R-sig-Geo] gstat cross validation for accuracy ordinary kriging vs
	IDW
Message-ID: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140521/4a444485/attachment.pl>

From mfiori at arpa.sardegna.it  Thu May 22 10:59:55 2014
From: mfiori at arpa.sardegna.it (Michele Fiori)
Date: Thu, 22 May 2014 10:59:55 +0200
Subject: [R-sig-Geo] R: gstat cross validation for accuracy ordinary kriging
	vs	IDW
In-Reply-To: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
References: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
Message-ID: <001101cf759c$34b5c770$9e215650$@arpa.sardegna.it>

Hi Moshood, 
I think you can do this way

#### Ordinary kriging to create kriging prediction orkrig <- krige(yield ~
1, canmod.sp, newdata = grid, model=exp.mod,nmax=20)

		OrdKrigecv  <- Krige.cv(yield ~ 1, canmod.sp,
model=exp.mod,nmax=20)
 		RMSE.ok <- sqrt(sum(OrdKrigecv
$residual^2)/length(OrdKrigecv $residual))

## Inverse Distance Weighting (IDW) Interpolation method maxdist=16.5

      		idw1cv <- krige.cv(yield~1, canmod.sp, nmax=20,idp=1))
	      	RMSE.id <- sqrt(sum(idw1cv $residual^2)/length(idw1cv
$residual))

-----Messaggio originale-----
Da: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org]
Per conto di Moshood Agba Bakare
Inviato: mercoled? 21 maggio 2014 21:16
A: r-sig-geo at r-project.org
Oggetto: [R-sig-Geo] gstat cross validation for accuracy ordinary kriging vs
IDW

Hi all,

I have been having a couple of challenge with my analysis. I have
irregularly space spatial yield monitor data over four years. Pooling this
data together is not feasible because of misalignment. That is, the
coordinates of data point varies from one year to the other.
I  created a common regular interpolation grid for each year with the same
grid size of 10 x 10 m. I am able to get interpolated value for each point
using ordinary kriging and inverse distance weighting method (IDW). Please
how I cross validate this two interpolation methods to know which one give
me the best estimate.

The problem I notice is that there is no observe value in each interpolation
point to assess the prediction accuracy of these methods.
Please what do I do? see my script below. I correlated the interpolated
values from the two methods. They are highly correlated (r=0.98). How do I
know which  method gave good prediction?

grid <- expand.grid(easting=seq(from = 299678, to = 301299, by=10),
                    northing=seq(from = 5737278, to = 5738129, by=10))

## convert the grid to SpatialPixel class to indicate gridded spatial data
coordinates(grid)<-~easting+northing
proj4string(grid)<-CRS("+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84
+units=m +no_defs +towgs84=0,0,0")

gridded(grid)<- TRUE


#### Ordinary kriging to create kriging prediction orkrig <- krige(yield ~
1, canmod.sp, newdata = grid, model=exp.mod,nmax=20)



## Inverse Distance Weighting (IDW) Interpolation method maxdist=16.5
idw1 = idw(yield~1, canmod.sp, newdata=grid,nmax=20,idp=1)

Thanks while looking forward to reading from you.

	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Thu May 22 12:46:07 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 22 May 2014 11:46:07 +0100
Subject: [R-sig-Geo] Create a simple spatial grid
In-Reply-To: <ecaffdf7409040db8e7d6ab19b90f65a@EX-0-HT0.lancs.local>
References: <1400604096728-7586481.post@n2.nabble.com>
	<CANVKczMKAmJxuzvz=wEd2t=3YpUo7YSb+vf24-Ywu2fJyX3E4A@mail.gmail.com>
	<CANVKczOmioJEBYKR=c4=gfgdSjA_C9XESgWizTXerpn-vpiLpg@mail.gmail.com>
	<ecaffdf7409040db8e7d6ab19b90f65a@EX-0-HT0.lancs.local>
Message-ID: <CANVKczMiw=aWcv+HGgrxnRDg7yYBa+okBPByDk1bM44M=teAwg@mail.gmail.com>

On Wed, May 21, 2014 at 5:14 PM, Remi Genevest <rgenevest at free.fr> wrote:
> Thanks a lot Barry. Your post perfectly matches what I was looking for.
>
> Well now if I want to do a coarser grid covering Europe, what I should do is
> doing more or less the same thing, just to change the resolution, right?
>
> res(r)=c(100,100)  # an approximate 100meters squared cells
>
> Then I got my raster in a EU coordinates system, and I would like to
> transform it into a WGS 84 (so as adding other layers would become easier).
> I tried this way, but it doesn't work :
>
> # change the CRS into WGS84 (ll)
> r.new<-projectRaster(r,crs="+init=epsg:4326")
> # adapt the extent to Europe
> ext = extent(-10.417,31.917,34.083,71.083)
> extent(r.new)<-ext
> # plot the map
> plot(r.new,axes=TRUE)
> # Here I get a plot that is not projected in a proper way.

 Oh its very proper. Its just that you've changed the raster between
systems that don't have parallel axes.

 Rasters can only be defined by: origin x,y; cell-size x,y; number of
cells in x,y; the coordinate system for x and y.

 A system like the EU projection maps the sphere onto a cone, and
unwraps the cone to a flat surface (topologically speaking a cone is
flat - you can make a cone from a flat sheet unlike a sphere). If you
have a grid on that basis and want to convert to cells aligned in
lat-long, you'll get what looks like a rotated grid.

 I suspect what you might want is an approximate 100m grid over
Europe, aligned on lat-long lines. In which case, you can have 100m
cells in the middle of Europe, slightly more closely spaced cells in
the north, and slightly further spaced cells in the south - because
the grid has to span the same number of degrees over its entire
latitude.

 To make that, work out what 100m is in degrees longitude at your
study are mid-latitude, and create a raster from those parameters. You
can compute the distance distortion by computing great-circle
distances from grid cell coordinates.

Barry


From bakare at ualberta.ca  Thu May 22 16:52:09 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Thu, 22 May 2014 08:52:09 -0600
Subject: [R-sig-Geo] gstat cross validation for accuracy ordinary
 kriging vs IDW
In-Reply-To: <001101cf759c$34b5c770$9e215650$@arpa.sardegna.it>
References: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
	<001101cf759c$34b5c770$9e215650$@arpa.sardegna.it>
Message-ID: <CAJRR3XOd=zYuFeK3LDp_-zPWCnP3L7NYCUW-Z5b_+w9OCtFUTA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140522/31c34712/attachment.pl>

From alaba.boluwade at mail.mcgill.ca  Thu May 22 18:10:38 2014
From: alaba.boluwade at mail.mcgill.ca (Alaba Boluwade)
Date: Thu, 22 May 2014 16:10:38 +0000
Subject: [R-sig-Geo] gstat cross validation for accuracy ordinary
 kriging vs IDW
In-Reply-To: <CAJRR3XOd=zYuFeK3LDp_-zPWCnP3L7NYCUW-Z5b_+w9OCtFUTA@mail.gmail.com>
References: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
	<001101cf759c$34b5c770$9e215650$@arpa.sardegna.it>,
	<CAJRR3XOd=zYuFeK3LDp_-zPWCnP3L7NYCUW-Z5b_+w9OCtFUTA@mail.gmail.com>
Message-ID: <B879AF6D5CB2A040A61A6DB25A700B051083DE7F@EXMBX2010-5.campus.MCGILL.CA>

Hi Moshood,

You did not follow what Michele sent to you:

ordkrigcv<- krige.cv(yield ~ 1, canmod.sp, 
model=exp.mod, nmax=20)


 try:

?krige.cv from the gstat library to see what  you need to supply for the function.


I would also advise you try reading  Bivand et al (2008). Some of  these difficulties you are encountering are pretty much solved there.

Bivand, R.S., E.J. Pebesma and V. G?mez- Rubio. 2008. Applied Spatial Data Analysis with R. Springer: New York, NY

Good luck.

Best Regards,

Alaba
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Moshood Agba Bakare [bakare at ualberta.ca]
Sent: Thursday, May 22, 2014 10:52 AM
To: Michele Fiori
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] gstat cross validation for accuracy ordinary kriging vs IDW

Hi Michele,
I tried the script as advised but get the error message

ordkrigcv<- krige.cv(yield ~ 1, canmod.sp, newdata = grid,
model=exp.mod,nmax=20)Error in gstat(g = NULL, id = "var1", formula =
formula, data = locations,  :
  unused argument(s) (newdata = <S4 object of class "SpatialPixels">)


Likewise the same for the idw. Remember the yield data is irregularly
space and I created a regular grid as


grid <- expand.grid(easting=seq(from = 299678, to = 301299,
by=10),northing=seq(from = 5737278, to = 5738129, by=10))


## convert the grid to SpatialPixel class

coordinates(grid)<-~easting+northing
proj4string(grid)<-CRS("+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84
+units=m +no_defs +towgs84=0,0,0")

gridded(grid)<- TRUE


I can not understand what the error message means but I suspect
newdata=grid which has now observed value to compare with the
interpolated value. I may be wrong.


Please what's next? Comments please and suggestions.


Moshood



On Thu, May 22, 2014 at 2:59 AM, Michele Fiori <mfiori at arpa.sardegna.it>wrote:

> Hi Moshood,
> I think you can do this way
>
> #### Ordinary kriging to create kriging prediction orkrig <- krige(yield ~
> 1, canmod.sp, newdata = grid, model=exp.mod,nmax=20)
>
>                 OrdKrigecv  <- Krige.cv(yield ~ 1, canmod.sp,
> model=exp.mod,nmax=20)
>                 RMSE.ok <- sqrt(sum(OrdKrigecv
> $residual^2)/length(OrdKrigecv $residual))
>
> ## Inverse Distance Weighting (IDW) Interpolation method maxdist=16.5
>
>                 idw1cv <- krige.cv(yield~1, canmod.sp, nmax=20,idp=1))
>                 RMSE.id <- sqrt(sum(idw1cv $residual^2)/length(idw1cv
> $residual))
>
> -----Messaggio originale-----
> Da: r-sig-geo-bounces at r-project.org [mailto:
> r-sig-geo-bounces at r-project.org]
> Per conto di Moshood Agba Bakare
> Inviato: mercoled?? 21 maggio 2014 21:16
> A: r-sig-geo at r-project.org
> Oggetto: [R-sig-Geo] gstat cross validation for accuracy ordinary kriging
> vs
> IDW
>
> Hi all,
>
> I have been having a couple of challenge with my analysis. I have
> irregularly space spatial yield monitor data over four years. Pooling this
> data together is not feasible because of misalignment. That is, the
> coordinates of data point varies from one year to the other.
> I  created a common regular interpolation grid for each year with the same
> grid size of 10 x 10 m. I am able to get interpolated value for each point
> using ordinary kriging and inverse distance weighting method (IDW). Please
> how I cross validate this two interpolation methods to know which one give
> me the best estimate.
>
> The problem I notice is that there is no observe value in each
> interpolation
> point to assess the prediction accuracy of these methods.
> Please what do I do? see my script below. I correlated the interpolated
> values from the two methods. They are highly correlated (r=0.98). How do I
> know which  method gave good prediction?
>
> grid <- expand.grid(easting=seq(from = 299678, to = 301299, by=10),
>                     northing=seq(from = 5737278, to = 5738129, by=10))
>
> ## convert the grid to SpatialPixel class to indicate gridded spatial data
> coordinates(grid)<-~easting+northing
> proj4string(grid)<-CRS("+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84
> +units=m +no_defs +towgs84=0,0,0")
>
> gridded(grid)<- TRUE
>
>
> #### Ordinary kriging to create kriging prediction orkrig <- krige(yield ~
> 1, canmod.sp, newdata = grid, model=exp.mod,nmax=20)
>
>
>
> ## Inverse Distance Weighting (IDW) Interpolation method maxdist=16.5
> idw1 = idw(yield~1, canmod.sp, newdata=grid,nmax=20,idp=1)
>
> Thanks while looking forward to reading from you.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

        [[alternative HTML version deleted]]


From rgenevest at free.fr  Thu May 22 20:44:24 2014
From: rgenevest at free.fr (Remi Genevest)
Date: Thu, 22 May 2014 11:44:24 -0700 (PDT)
Subject: [R-sig-Geo] Create a simple spatial grid
In-Reply-To: <CANVKczMiw=aWcv+HGgrxnRDg7yYBa+okBPByDk1bM44M=teAwg@mail.gmail.com>
References: <1400604096728-7586481.post@n2.nabble.com>
	<CANVKczMKAmJxuzvz=wEd2t=3YpUo7YSb+vf24-Ywu2fJyX3E4A@mail.gmail.com>
	<CANVKczOmioJEBYKR=c4=gfgdSjA_C9XESgWizTXerpn-vpiLpg@mail.gmail.com>
	<CANVKczMiw=aWcv+HGgrxnRDg7yYBa+okBPByDk1bM44M=teAwg@mail.gmail.com>
Message-ID: <1400784264971-7586496.post@n2.nabble.com>

Alright !
You pointed out my goal indeed... but 100meters by 100meters is still a bit
too high for a map over Europe.
So, this is what I have done :

### create a grid raster 
ll = CRS("+init=epsg:4326") 
origin = SpatialPoints(cbind(7,40),ll) 
grid = raster() 
## make resolution ie 0.008 min par 0.008 spaced cells (equals to about
800m*800m), that is actually quite accurate 
e = extent(5,18,40,50)
extent(grid)<-e
res(grid)=c(0.008,0.008) 
grid

Now, I hope that the extract() function will work fine after adding my other
layers (that do not have the same original CRS nor resolution...!)

Many thanks !!
R?mi





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Create-a-simple-spatial-grid-tp7586481p7586496.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Fri May 23 00:57:32 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 22 May 2014 23:57:32 +0100
Subject: [R-sig-Geo] Create a simple spatial grid
In-Reply-To: <c5aaad6306cb4afca71f9a6ca8563d34@EX-0-HT0.lancs.local>
References: <1400604096728-7586481.post@n2.nabble.com>
	<CANVKczMKAmJxuzvz=wEd2t=3YpUo7YSb+vf24-Ywu2fJyX3E4A@mail.gmail.com>
	<CANVKczOmioJEBYKR=c4=gfgdSjA_C9XESgWizTXerpn-vpiLpg@mail.gmail.com>
	<CANVKczMiw=aWcv+HGgrxnRDg7yYBa+okBPByDk1bM44M=teAwg@mail.gmail.com>
	<c5aaad6306cb4afca71f9a6ca8563d34@EX-0-HT0.lancs.local>
Message-ID: <CANVKczO0m1rc9VsXUEfD=hGbHS0fmtULOH8TqpmrQhW2cTB15g@mail.gmail.com>

On Thu, May 22, 2014 at 7:44 PM, Remi Genevest <rgenevest at free.fr> wrote:
> Alright !
> You pointed out my goal indeed... but 100meters by 100meters is still a bit
> too high for a map over Europe.
> So, this is what I have done :
>
> ### create a grid raster
> ll = CRS("+init=epsg:4326")
> origin = SpatialPoints(cbind(7,40),ll)
> grid = raster()
> ## make resolution ie 0.008 min par 0.008 spaced cells (equals to about
> 800m*800m), that is actually quite accurate
> e = extent(5,18,40,50)
> extent(grid)<-e
> res(grid)=c(0.008,0.008)
> grid
>
> Now, I hope that the extract() function will work fine after adding my other
> layers (that do not have the same original CRS nor resolution...!)

Converting vector data (points, lines, polygons) from one CRS to
another is essentially lossless and often reversible. However
converting raster data from one grid to another is lossy (eg when your
new grid cells overlap more than one old grid cell and you taken an
average) and when reversed you don't get your original back (because
of the lossy nature). When possible, consider the raster data you may
have been supplied with as the CRS to work with, and transform vector
data to that system.

If you have multiple raster CRSs then you might never need to
transform them to the same system anyway, if all you are doing is,
say, sampling raster values at a set of points - just transform the
points to each raster's CRS in turn, and sample. Doing raster-raster
overlay will need a raster-raster transform though...

Barry


From yasebaytok at gmail.com  Fri May 23 07:50:52 2014
From: yasebaytok at gmail.com (Yerguner)
Date: Thu, 22 May 2014 22:50:52 -0700 (PDT)
Subject: [R-sig-Geo] reproject a multi-layered netcdf file using
 projectRaster with "nearest neighbor method"
Message-ID: <1400824252979-7586498.post@n2.nabble.com>

I'm getting a curious error when trying to reproject a multi-layered netcdf
file using projectRaster() with the "nearest neighbor method" of the raster
package. But, interestingly, projectRasters() works fine when I set the
default "bilinear" method.
I need to use 'ngb' method since I want to keep the values same. And really
hope it can also reduce the process time since I've hundreds of files to
repeat this procedure and planning to use Rmpi.

Actually, another thing that I wonder is the performance of projectRaster
compared to gdalwarp.

Any help would be greatly appreciated.
Thanks,

Yasemin

library(raster)
library(rgdal)
library(ncdf)
rasterOptions(tmpdir=?/some_tmp_path/?)
input_file <- ?cold2002_s1.nc"
cold02s1 <- brick(input_file)
newproj <- "+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
+b=6370997 +units=m +no_defs"
prj1 <- projectExtent(cold02s1, newproj)
res(prj1) <- c(231.6564, 231.6563)
prj1 <- projectRaster(cold02s1, prj1, method='ngb')
Error in getfun(nc, varid = zvar, start = start, count = count) :
NAs in foreign function call (arg 3)
> traceback()
6: .C("R_nc_get_vara_double", as.integer(nc$id), as.integer(varid -
1), as.integer(c.start), as.integer(c.count), data = as.double(rv$data),
error = as.integer(rv$error), PACKAGE = "ncdf", DUP = FALSE)
5: getfun(nc, varid = zvar, start = start, count = count)
4: .readBrickCellsNetCDF(x, cells, layer, nl)
3: .cellValues(object, cells, layer = layer, nl = nl)
2: .xyValues(from, xy, method = method)
1: projectRaster(cold02s1, prj1, method = "ngb")

## I also tried: cold02s1 <- brick(input_file, varname="tmin") and got the
same error

##### here some info about the object and the brick
> prj1
class       : RasterLayer
dimensions  : 2044, 4457, 9110108  (nrow, ncol, ncell)
resolution  : 231.6564, 231.6563  (x, y)
extent      : -52180.77, 980311.8, 242137.5, 715643  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
+b=6370997 +units=m +no_defs

> cold02s1
class       : RasterBrick
dimensions  : 450, 990, 445500, 365  (nrow, ncol, ncell, nlayers)
resolution  : 1000, 1000  (x, y)
extent      : -50000, 940000, 496000, 946000  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=lcc +x_0=0 +y_0=0 +lon_0=-100 +lat_0=42.5 +lat_1=25
+lat_2=60 +ellps=WGS84
data source : /mypath/cold2002_s1.nc
names       : X2002.01.01, X2002.01.02, X2002.01.03, X2002.01.04,
X2002.01.05, X2002.01.06, X2002.01.07, X2002.01.08, X2002.01.09,
X2002.01.10, X2002.01.11, X2002.01.12, X2002.01.13, X2002.01.14,
X2002.01.15, ...
Date        : 2002-01-01, 2002-12-31 (min, max)
varname     : tmin

### I tried these and got the same error
prj1n <- projectRaster(cold02s1, prj1, method = "ngb")
Error in getfun(nc, varid = zvar, start = start, count = count) :
NAs in foreign function call (arg 3)
> prj1m <- projectRaster(cold02s1, crs = newproj, res= c(231.6564,
> 231.6563), method = "ngb")
Error in getfun(nc, varid = zvar, start = start, count = count) :
NAs in foreign function call (arg 3)

#### Interestingly when I try with the ?bilinear? method which is default,
it works fine (it takes ~2 hrs).
prj1b <- projectRaster(cold02s1, prj1)
prj1b
class       : RasterBrick
dimensions  : 2044, 4457, 9110108, 365  (nrow, ncol, ncell, nlayers)
resolution  : 231.6564, 231.6563  (x, y)
extent      : -52180.77, 980311.8, 242137.5, 715643  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997
+b=6370997 +units=m +no_defs
data source :
/pegasus/yb3/modvar2002/raster_tmp_2014-05-22_121316_13547_40735.grd
names       : X2002.01.01, X2002.01.02, X2002.01.03, X2002.01.04,
X2002.01.05, X2002.01.06, X2002.01.07, X2002.01.08, X2002.01.09,
X2002.01.10, X2002.01.11, X2002.01.12, X2002.01.13, X2002.01.14,
X2002.01.15, ...
min values  :    -29.5000,    -59.0000,    -86.0000,   -106.3880,  
-126.8480,   -150.4834,   -177.1940,   -198.6912,   -210.1884,   -218.1140,  
-231.6112,   -246.9922,   -278.9922,   -313.4882,   -344.3330, ...
max values  :    -13.5000,    -28.5000,    -41.5000,    -52.0000,   
-62.0000,    -76.0000,    -92.5000,   -104.0000,   -109.5000,   -114.5000,  
-121.5000,   -130.5000,   -143.5000,   -157.0000,   -171.0000, ...

#### my environment
> sessionInfo()
R version 3.0.2 (2013-09-25)
Platform: x86_64-redhat-linux-gnu (64-bit)
locale:
[1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
[3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
[5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
[7] LC_PAPER=en_US.UTF-8       LC_NAME=C
[9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
other attached packages:
[1] ncdf_1.6.6    rgdal_0.8-16  raster_2.2-31 sp_1.0-15
loaded via a namespace (and not attached):
[1] grid_3.0.2      lattice_0.20-23



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reproject-a-multi-layered-netcdf-file-using-projectRaster-with-nearest-neighbor-method-tp7586498.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From abidi.zineb at gmail.com  Fri May 23 10:18:12 2014
From: abidi.zineb at gmail.com (az14)
Date: Fri, 23 May 2014 01:18:12 -0700 (PDT)
Subject: [R-sig-Geo] probit with fixed effect  SPML package error
Message-ID: <1400833092388-7586499.post@n2.nabble.com>

Dear list, 
I'm trying to estimate a spatial probit with fixed effect using the spml
package on R.
library(splm) 
library(plm)
 data1<-pdata.frame(data1,c("dc","year"))
memory.limit(size=4000)


fm<-coop~x1+x2+x3+x4+wx1+wx2+wx4
listw1<-mat2listw(mat5)
es<-spml(formula=fm,effect="twoways",model="within",lag=TRUE,data=data1,listw=listw)
 but i have this error 
Error: cannot allocate vector of size 544.5 Mb

Any help would be appreciated.
Thank you.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/probit-with-fixed-effect-SPML-package-error-tp7586499.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Md.Hossain at cchmc.org  Fri May 23 19:55:34 2014
From: Md.Hossain at cchmc.org (Hossain, Md)
Date: Fri, 23 May 2014 17:55:34 +0000
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <alpine.LRH.2.03.1405181729130.19360@reclus.nhh.no>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>
	<5376AD54.5040708@auckland.ac.nz>
	<CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1A3C4@MCEXMB3.chmccorp.cchmc.org>
	<2db59ef3ebcc4d04a6744520b292571b@EX-0-HT0.lancs.local>,
	<CANVKczNydHa3xbuHRC-mqMUMCbFZ3ak1Eab0ky39rbNN005jzA@mail.gmail.com>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1E460@MCEXMB3.chmccorp.cchmc.org>
	<alpine.LRH.2.03.1405181729130.19360@reclus.nhh.no>
Message-ID: <5C8A52EFA35D9844BEB1224DD2D633C724A21F30@MCEXMB3.chmccorp.cchmc.org>

With sincere appreciation for all the suggestions so far I got, and thought it's better to keep you all updated.
To my datasets (coded as "points"), I did the point-in-polygon test with the R code:

library("maps")
library ("sp")
library("spatstat")
library(SDMTools)
usmap <- map("usa", fill=TRUE) 
polypnts = cbind(x=usmap$x, y=usmap$y)
points = cbind(x=my_usdat$x, y=my_usdat$y)
plot(rbind(polypnts, points))
out = pnt.in.poly(points,polypnts)
sum(out==0)
> [1] 1746
sum(out==1)
> [1] 0

It shows that in my dataset there is no points outside of USA map. So the problem I was getting, mainly because of not using the correct coordinate reference system (CRS). It prompted me to apply another strategy that does not require to specify any CRS, posted by Rolf Turner as:

us.df <- with(usmap,data.frame(x=rev(x),y=rev(y)))
us.df <- unique(us.df)
B <- list(list(x=us.df$x, y=us.df$y))
owin(poly=B)

But, got the error message as:
Error in owin(poly = B) : 
  poly must be either a list(x,y) or a list of list(x,y)

After removing all the "NA" cases by the code:

us.df <- us.df[is.na(us.df$x)==FALSE, ]
B <- list(list(x=us.df$x, y=us.df$y))
owin(poly=B)

Got another error message as:
Error in owin(poly = B) : Area of window is negative;
 check that all polygons were traversed in the right direction

It seems I am very close, any idea please! 
Thanks,

Monir
 
-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: Sunday, May 18, 2014 11:39 AM
To: Hossain, Md
Cc: Barry Rowlingson; Rolf Turner; r-sig-geo at r-project.org; Adrian Baddeley
Subject: Re: [R-sig-Geo] Warning message: points were rejected as lying outside the specified window

On Sun, 18 May 2014, Hossain, Md wrote:

> Thanks, Berry.
> The data do not have any obvious errors as you have mentioned. Almost 
> all the points those are outside of the window are along the 
> coastline, and rest are near the Great Lakes area. It looks like these 
> 42 points are ending up on the wrong side of the approximated boundary.

So either you can choose a different approximation to the shoreline you are interested in from another source. Or perhaps buffer it out the maximum distance from the excluded points to the original polygon (see rgeos::gDistance and rgeos::gBuffer)? This may not be adequate, as your polygon and points appear to be in geographical rather than planar coordinates, which will affect the naive distances obtained when using geographical coordinates as if they are planar.

Roger


> Regards,
>
> Monir
> ________________________________________
> From: b.rowlingson at gmail.com [b.rowlingson at gmail.com] on behalf of Barry Rowlingson [b.rowlingson at lancaster.ac.uk]
> Sent: Sunday, May 18, 2014 4:50 AM
> To: Rolf Turner
> Cc: Hossain, Md; r-sig-geo at r-project.org; Adrian Baddeley
> Subject: Re: [R-sig-Geo] Warning message: points were rejected as lying outside the specified window
>
> On Sun, May 18, 2014 at 9:29 AM, Rolf Turner <r.turner at auckland.ac.nz> wrote:
>> On 18/05/14 14:35, Hossain, Md wrote:
>>> Very grateful to Rolf and Adrian for your kind suggestions. Obviously I
>>> am going to follow, but it seems there is no quick fix.
>>> In the mean time, just wondering, is there anything that I can do
>>> with the "map2SpatialPolygons" function. The data came with the
>>> long-lat, but no information about how these long-lats are created,
>>> i.e., whether using "WGS84" is apropriate or should I try for other
>>> options, e.g., for GCS_North_American_1983_HARN. My knowledge in
>>> geography is very poor, please help.
>
> Have you done whats been suggested and plotted the points to see *why*
> the points are thought to be outside your map? Various things can
> happen with data:
>
> x and y coordinates get swapped
> x and y coordinates are set to 0,0 or  -999,-999 to make missing data
> numbers get typed in wrong
> minus signs in western or southern hemisphere coordinates get left off
> locations are rounded to the nearest 100m, then converted to lat-long
> etc
>
> the other problem is that the boundary is an APPROXIMATION to the
> border. To keep the dataset size small enough, a lot of the wiggly
> coastline is approximated by a straight line. If you have points near
> the coast then some may end up on the wrong side of the approximated
> line. Is that what's happening? Have you plotted the points?
>
> don't go messing around with projections and datums (which might only
> move points by a few metres) until you've had a look at why the points
> are outside your polygon.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From r.turner at auckland.ac.nz  Sat May 24 02:05:56 2014
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Sat, 24 May 2014 12:05:56 +1200
Subject: [R-sig-Geo] Warning message: points were rejected as lying
 outside the specified window
In-Reply-To: <5C8A52EFA35D9844BEB1224DD2D633C724A21F30@MCEXMB3.chmccorp.cchmc.org>
References: <5C8A52EFA35D9844BEB1224DD2D633C724A16EC0@MCEXMB3.chmccorp.cchmc.org>
	<5376AD54.5040708@auckland.ac.nz>
	<CF5661163F77A44781208D9AC4FDEA725D67260590@IS-WIN-376.staffad.uwa.edu.au>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1A3C4@MCEXMB3.chmccorp.cchmc.org>
	<2db59ef3ebcc4d04a6744520b292571b@EX-0-HT0.lancs.local>,
	<CANVKczNydHa3xbuHRC-mqMUMCbFZ3ak1Eab0ky39rbNN005jzA@mail.gmail.com>
	<5C8A52EFA35D9844BEB1224DD2D633C724A1E460@MCEXMB3.chmccorp.cchmc.org>
	<alpine.LRH.2.03.1405181729130.19360@reclus.nhh.no>
	<5C8A52EFA35D9844BEB1224DD2D633C724A21F30@MCEXMB3.chmccorp.cchmc.org>
Message-ID: <537FE264.6070701@auckland.ac.nz>


On 24/05/14 05:55, Hossain, Md wrote:

> With sincere appreciation for all the suggestions so far I got, and thought it's better to keep you all updated.
> To my datasets (coded as "points"), I did the point-in-polygon test with the R code:
>
> library("maps")
> library ("sp")
> library("spatstat")
> library(SDMTools)
> usmap <- map("usa", fill=TRUE)
> polypnts = cbind(x=usmap$x, y=usmap$y)
> points = cbind(x=my_usdat$x, y=my_usdat$y)
> plot(rbind(polypnts, points))
> out = pnt.in.poly(points,polypnts)
> sum(out==0)
>> [1] 1746
> sum(out==1)
>> [1] 0
>
> It shows that in my dataset there is no points outside of USA map. So the problem I was getting, mainly because of not using the correct coordinate reference system (CRS). It prompted me to apply another strategy that does not require to specify any CRS, posted by Rolf Turner as:
>
> us.df <- with(usmap,data.frame(x=rev(x),y=rev(y)))
> us.df <- unique(us.df)
> B <- list(list(x=us.df$x, y=us.df$y))
> owin(poly=B)
>
> But, got the error message as:
> Error in owin(poly = B) :
>    poly must be either a list(x,y) or a list of list(x,y)
>
> After removing all the "NA" cases by the code:
>
> us.df <- us.df[is.na(us.df$x)==FALSE, ]
> B <- list(list(x=us.df$x, y=us.df$y))
> owin(poly=B)
>
> Got another error message as:
> Error in owin(poly = B) : Area of window is negative;
>   check that all polygons were traversed in the right direction
>
> It seems I am very close, any idea please!

Not really sure what you are up to, but I think a major mistake is 
chucking out the NAs from us.df.

These NAs are there to separate different, distinct, polygons (the 
overall outline of the USA plus various lakes and islands).  This is a 
commonly used convention in GIS data it would seem.  Hellishly kludgy 
and inconvenient, but there's nothing we can do about that.

To make these data into an owin object you need to create a *list*, (say 
"L") each entry of which is a data frame consisting of one of the 
sub-polygons (the parts of us.df "sandwiched" between NA rows).

Then use owin(poly=L).

cheers,

Rolf Turner


From rubenfcasal at gmail.com  Sun May 25 00:20:04 2014
From: rubenfcasal at gmail.com (rubenfcasal)
Date: Sun, 25 May 2014 00:20:04 +0200
Subject: [R-sig-Geo] gstat cross validation for accuracy ordinary
 kriging vs IDW
In-Reply-To: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
References: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
Message-ID: <53811B14.3090503@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140525/c12aa338/attachment.pl>

From bakare at ualberta.ca  Sun May 25 01:44:51 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Sat, 24 May 2014 17:44:51 -0600
Subject: [R-sig-Geo] gstat cross validation for accuracy ordinary
 kriging vs IDW
In-Reply-To: <53811B14.3090503@gmail.com>
References: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
	<53811B14.3090503@gmail.com>
Message-ID: <CAJRR3XO9XwTEczhZ2cwEPDtMNGmfC-5Y5Jwfwx+mnr-TjUQa9w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140524/30d7638a/attachment.pl>

From Roger.Bivand at nhh.no  Sun May 25 10:17:51 2014
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 25 May 2014 10:17:51 +0200
Subject: [R-sig-Geo] gstat cross validation for accuracy ordinary
 kriging vs IDW
In-Reply-To: <53811B14.3090503@gmail.com>
References: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
	<53811B14.3090503@gmail.com>
Message-ID: <alpine.LRH.2.03.1405251011180.15047@reclus.nhh.no>

On Sun, 25 May 2014, rubenfcasal wrote:

> Hi Moshood,
>
>     I think your approach is wrong.
>
>     Cross-validation is a way to diagnose if your fitted
> model/procedure is correct (you cross-validate the model, not the
> predictions). You can use cross-validation to estimate the prediction
> error. The prediction error is the expected error when you use the
> model/method to predict the response on a new observation, one that was
> not used in estimating/fitting the model. It has not to be confused with
> the observed error (nor with other estimate that you can compute).
>
>     The idea behind CV is to repeatedly delete some of the data (one
> observation in leave-one-out cross-validation, the standard procedure)
> and use the remaining data to predict the deleted observations. Then the
> prediction error can be estimated from the differences between
> predictions and true values.
>
>     You can use krige.cv() for CV a kriging model. I think you will
> have to write the appropriate code (calling idw() repeatedly)  for
> inverse distance weighting.

I believe you can use gstat.cv() for an IDW model:

library(gstat)
library(sp)
data(meuse)
coordinates(meuse) <- ~x+y
IDW1n_fit <- gstat(id="IDW1n_fit", formula = log(zinc) ~ 1, data = meuse,
   nmax=12, set=list(idp=1))
pe1 <- gstat.cv(IDW1n_fit, debug.level=0, random=FALSE)
str(pe1) #to see what inside
sqrt(mean(pe1$residual^2)) # RMS prediction error

Then you see differences if you change for example nmax= or idp=.

Roger

>
> Best regards,
>     Ruben Fernandez-Casal
>
>
> El 21/05/2014 21:15, Moshood Agba Bakare escribi?:
>> Hi all,
>>
>> I have been having a couple of challenge with my analysis. I have
>> irregularly space spatial yield monitor data over four years. Pooling this
>> data together is not feasible because of misalignment. That is, the
>> coordinates of data point varies from one year to the other.
>> I  created a common regular interpolation grid for each year with the same
>> grid size of 10 x 10 m. I am able to get interpolated value for each point
>> using ordinary kriging and inverse distance weighting method (IDW). Please
>> how I cross validate this two interpolation methods to know which one give
>> me the best estimate.
>>
>> The problem I notice is that there is no observe value in each
>> interpolation point to assess the prediction accuracy of these methods.
>> Please what do I do? see my script below. I correlated the interpolated
>> values from the two methods. They are highly correlated (r=0.98). How do I
>> know which  method gave good prediction?
>>
>> grid <- expand.grid(easting=seq(from = 299678, to = 301299, by=10),
>>                      northing=seq(from = 5737278, to = 5738129, by=10))
>>
>> ## convert the grid to SpatialPixel class to indicate gridded spatial data
>> coordinates(grid)<-~easting+northing
>> proj4string(grid)<-CRS("+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84
>> +units=m +no_defs +towgs84=0,0,0")
>>
>> gridded(grid)<- TRUE
>>
>>
>> #### Ordinary kriging to create kriging prediction
>> orkrig <- krige(yield ~ 1, canmod.sp, newdata = grid, model=exp.mod,nmax=20)
>>
>>
>>
>> ## Inverse Distance Weighting (IDW) Interpolation method maxdist=16.5
>> idw1 = idw(yield~1, canmod.sp, newdata=grid,nmax=20,idp=1)
>>
>> Thanks while looking forward to reading from you.
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no


From bakare at ualberta.ca  Sun May 25 17:36:05 2014
From: bakare at ualberta.ca (Moshood Agba Bakare)
Date: Sun, 25 May 2014 09:36:05 -0600
Subject: [R-sig-Geo] gstat cross validation for accuracy ordinary
 kriging vs IDW
In-Reply-To: <alpine.LRH.2.03.1405251011180.15047@reclus.nhh.no>
References: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>
	<53811B14.3090503@gmail.com>
	<alpine.LRH.2.03.1405251011180.15047@reclus.nhh.no>
Message-ID: <CAJRR3XOWeLmEq9sPdz6DBv82yCfYyhWX3U=J4y7KrTCLSfS6uQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140525/d2cc67c4/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sun May 25 18:04:23 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 25 May 2014 18:04:23 +0200
Subject: [R-sig-Geo] gstat cross validation for accuracy ordinary
 kriging vs IDW
In-Reply-To: <CAJRR3XOWeLmEq9sPdz6DBv82yCfYyhWX3U=J4y7KrTCLSfS6uQ@mail.gmail.com>
References: <CAJRR3XN9uD_rU97wTCQJ=YCt39dVDAWYYwdUfaN56_42V14OTA@mail.gmail.com>	<53811B14.3090503@gmail.com>	<alpine.LRH.2.03.1405251011180.15047@reclus.nhh.no>
	<CAJRR3XOWeLmEq9sPdz6DBv82yCfYyhWX3U=J4y7KrTCLSfS6uQ@mail.gmail.com>
Message-ID: <53821487.3070702@uni-muenster.de>



On 05/25/2014 05:36 PM, Moshood Agba Bakare wrote:
> Hi Roger,
> Thanks for the script. I will surely use it. I could not see an option for
> "grid". Please remember I am trying to generate interpolated values on a
> regular grid.
> 

Moshood,

Please remember you cannot cross validate on a grid if your data are not
on the same grid, and try to understand what cross validation does.


> Thank you
> Moshood
> 
> 
> On Sun, May 25, 2014 at 2:17 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
>> On Sun, 25 May 2014, rubenfcasal wrote:
>>
>>  Hi Moshood,
>>>
>>>     I think your approach is wrong.
>>>
>>>     Cross-validation is a way to diagnose if your fitted
>>> model/procedure is correct (you cross-validate the model, not the
>>> predictions). You can use cross-validation to estimate the prediction
>>> error. The prediction error is the expected error when you use the
>>> model/method to predict the response on a new observation, one that was
>>> not used in estimating/fitting the model. It has not to be confused with
>>> the observed error (nor with other estimate that you can compute).
>>>
>>>     The idea behind CV is to repeatedly delete some of the data (one
>>> observation in leave-one-out cross-validation, the standard procedure)
>>> and use the remaining data to predict the deleted observations. Then the
>>> prediction error can be estimated from the differences between
>>> predictions and true values.
>>>
>>>     You can use krige.cv() for CV a kriging model. I think you will
>>> have to write the appropriate code (calling idw() repeatedly)  for
>>> inverse distance weighting.
>>>
>>
>> I believe you can use gstat.cv() for an IDW model:
>>
>> library(gstat)
>> library(sp)
>> data(meuse)
>> coordinates(meuse) <- ~x+y
>> IDW1n_fit <- gstat(id="IDW1n_fit", formula = log(zinc) ~ 1, data = meuse,
>>   nmax=12, set=list(idp=1))
>> pe1 <- gstat.cv(IDW1n_fit, debug.level=0, random=FALSE)
>> str(pe1) #to see what inside
>> sqrt(mean(pe1$residual^2)) # RMS prediction error
>>
>> Then you see differences if you change for example nmax= or idp=.
>>
>> Roger
>>
>>
>>> Best regards,
>>>     Ruben Fernandez-Casal
>>>
>>>
>>> El 21/05/2014 21:15, Moshood Agba Bakare escribi?:
>>>
>>>  Hi all,
>>>>
>>>> I have been having a couple of challenge with my analysis. I have
>>>> irregularly space spatial yield monitor data over four years. Pooling
>>>> this
>>>> data together is not feasible because of misalignment. That is, the
>>>> coordinates of data point varies from one year to the other.
>>>> I  created a common regular interpolation grid for each year with the
>>>> same
>>>> grid size of 10 x 10 m. I am able to get interpolated value for each
>>>> point
>>>> using ordinary kriging and inverse distance weighting method (IDW).
>>>> Please
>>>> how I cross validate this two interpolation methods to know which one
>>>> give
>>>> me the best estimate.
>>>>
>>>> The problem I notice is that there is no observe value in each
>>>> interpolation point to assess the prediction accuracy of these methods.
>>>> Please what do I do? see my script below. I correlated the interpolated
>>>> values from the two methods. They are highly correlated (r=0.98). How do
>>>> I
>>>> know which  method gave good prediction?
>>>>
>>>> grid <- expand.grid(easting=seq(from = 299678, to = 301299, by=10),
>>>>                      northing=seq(from = 5737278, to = 5738129, by=10))
>>>>
>>>> ## convert the grid to SpatialPixel class to indicate gridded spatial
>>>> data
>>>> coordinates(grid)<-~easting+northing
>>>> proj4string(grid)<-CRS("+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84
>>>> +units=m +no_defs +towgs84=0,0,0")
>>>>
>>>> gridded(grid)<- TRUE
>>>>
>>>>
>>>> #### Ordinary kriging to create kriging prediction
>>>> orkrig <- krige(yield ~ 1, canmod.sp, newdata = grid,
>>>> model=exp.mod,nmax=20)
>>>>
>>>>
>>>>
>>>> ## Inverse Distance Weighting (IDW) Interpolation method maxdist=16.5
>>>> idw1 = idw(yield~1, canmod.sp, newdata=grid,nmax=20,idp=1)
>>>>
>>>> Thanks while looking forward to reading from you.
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140525/2684eff5/attachment.bin>

From kebennett at alaska.edu  Sun May 25 22:19:55 2014
From: kebennett at alaska.edu (Katrina Bennett)
Date: Sun, 25 May 2014 12:19:55 -0800
Subject: [R-sig-Geo] Raster overlay / calc function with NA values
Message-ID: <CA+SNM80sn-NVe=Oc23vUPhCz8Y7u+ksL1uX-kRiSLa9unzXUeQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140525/7f6326de/attachment.pl>

From lyndon.estes at gmail.com  Mon May 26 13:55:31 2014
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Mon, 26 May 2014 07:55:31 -0400
Subject: [R-sig-Geo] Raster overlay / calc function with NA values
In-Reply-To: <CA+SNM80sn-NVe=Oc23vUPhCz8Y7u+ksL1uX-kRiSLa9unzXUeQ@mail.gmail.com>
References: <CA+SNM80sn-NVe=Oc23vUPhCz8Y7u+ksL1uX-kRiSLa9unzXUeQ@mail.gmail.com>
Message-ID: <CALuVVaav0sTo4BQ9Dg=3hk_1P8qROhjAuv4QvSyTbxfbGstPww@mail.gmail.com>

Hi Katrina,

I might have misunderstood what you are trying to do, but its seems
the main problem is that you are using the calc function rather than
overlay. Also, I think you don't need the separate function for what
you are trying to achieve, if you are just trying to apply this to two
rasters:

# function not necessary, in the form I have written here, this would
produce the same results as your
# versions because sum() returns NA if you don't specify
# na.rm = TRUE
fun.calc <- function(x) {
 tree.w <- sum(x[[1]] / (100 - x[[2]]))  # but summing is superfluous
here in any case
 return(tree.w)
}

# So, based on the example, I think this achieves what you want to do.

r1 <- raster(nrow=50, ncol = 50)
r1[] <- sample(80:100, size=ncell(r1), replace = TRUE)  # added in
some variation here
r1[4:10,] <- NA
r2 <- raster(nrow=50, ncol = 50)
r2[] <- 40
r2[9:15,] <- NA

r3 <- r1 / (100 - r2)  # simple raster calculation
plot(r3)

# If you did want to use the function, you could do this.
st <- stack(r1, r2)
r4 <- calc(st, fun.calc)

plot(r3 - r4)

Is this what you were trying to do, or do you want to do a calculation
over more rasters?

Best, Lyndon



On Sun, May 25, 2014 at 4:19 PM, Katrina Bennett <kebennett at alaska.edu> wrote:
> I am trying to run a function over two rasters. I am not sure what I'm
> doing incorrectly, but I can not seem to get the answer I'm looking for,
> even though the vectorized form of this function works well. I posted this
> question on Stack Overflow but I think this is a raster issue... hence I
> thought I might try this forum instead (
> http://stackoverflow.com/questions/23852409/raster-calc-function-issue-with-na-data/23852610?noredirect=1#23852610
> ).
>
>
> library(raster)
>
> fun.calc <- function(x, y, ...)
> {
> tree.w <- sum(x / (100 - y), ...)
> ifelse(is.na(x) | is.na(y), NA, tree.w)
> }
>
> fun.calc1 <- function(x, y, ...)
> {
> tree.w <- sum(x / (100 - y), ...)
> length.xy <- length(which(!is.na(x) & !is.na(y)))
> ifelse(is.na(x) | is.na(y), NA, tree.w/length.xy)
> }
>
> r1 <- raster(nrow=50, ncol = 50)
> r1[] <- 90
> r1[4:10,] <- NA
> r2 <- raster(nrow=50, ncol = 50)
> r2[] <- 40
> r2[9:15,] <- NA
>
> #This works
> fun.calc(90, 40)
> fun.calc(90, NA)
>
> #This, I have to add in a division by the length of the non-NA data values,
> why?
> fun.calc1(r1[,,1:length(r1)],r2[,,1:length(r2)], na.rm=T)
>
> #My data are rasters, and I wish to produce the data in a raster for output
> as a GeoTIff
> #This produced no information
> overlay(r1, r2, fun=fun.calc1, na.rm=T)
>
> #Throws an error
> overlay(r1[,,1], r2[,,1], fun=fun.calc1, na.rm=T)
> #Error in (function (classes, fdef, mtable)  :
> #  unable to find an inherited method for function 'overlay' for signature
> '"numeric", "numeric"'
>
> Thank you,
>
> Katrina
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From luc.steinbuch at wur.nl  Tue May 27 10:50:50 2014
From: luc.steinbuch at wur.nl (Steinbuch, Luc)
Date: Tue, 27 May 2014 08:50:50 +0000
Subject: [R-sig-Geo] Getting regression coefficients when universal kriging
Message-ID: <F5430DB53756F8428C319EF9B0FC41430AC9F8D6@SCOMP0934.wurnet.nl>

Suppose I have this  (working) code:

library(gstat) 
library(rgdal) 
library(raster) 

data(meuse) 
coordinates(meuse) = ~x+y 
r <- raster(system.file("external/test.grd", package="raster")) 
projection(r)<-projection(meuse) 
names(r) = 'elev' 

vu<-variogram(log(zinc)~elev,meuse) 
mu<-fit.variogram(vu,vgm(1,"Sph",300,1)) 
gUK<-gstat(NULL,"log.zinc",log(zinc)~elev,meuse,model=mu) 
UK<-interpolate(r, gUK, xyOnly=FALSE)

How do I find the finally used regression parameters, calculated by the universal kriging function of 'interpolate'?


From edzer.pebesma at uni-muenster.de  Tue May 27 11:10:35 2014
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 27 May 2014 11:10:35 +0200
Subject: [R-sig-Geo] Getting regression coefficients when universal
	kriging
In-Reply-To: <F5430DB53756F8428C319EF9B0FC41430AC9F8D6@SCOMP0934.wurnet.nl>
References: <F5430DB53756F8428C319EF9B0FC41430AC9F8D6@SCOMP0934.wurnet.nl>
Message-ID: <5384568B.2070407@uni-muenster.de>

Look at ?predict.gstat and search for the BLUE parameter.

In principle, with BLUE = TRUE, prediction is based only on the (BLUE,
GLS) regression coefficients, ignoring residual. To get the regression
parameters, you have to provide fake predictors, e.g. a vector c(0,1)
will, in case of two coeffiecients return you the second parameter as
predicted value, along with its SE.

hth,

On 05/27/2014 10:50 AM, Steinbuch, Luc wrote:
> Suppose I have this  (working) code:
> 
> library(gstat) 
> library(rgdal) 
> library(raster) 
> 
> data(meuse) 
> coordinates(meuse) = ~x+y 
> r <- raster(system.file("external/test.grd", package="raster")) 
> projection(r)<-projection(meuse) 
> names(r) = 'elev' 
> 
> vu<-variogram(log(zinc)~elev,meuse) 
> mu<-fit.variogram(vu,vgm(1,"Sph",300,1)) 
> gUK<-gstat(NULL,"log.zinc",log(zinc)~elev,meuse,model=mu) 
> UK<-interpolate(r, gUK, xyOnly=FALSE)
> 
> How do I find the finally used regression parameters, calculated by the universal kriging function of 'interpolate'?
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140527/7e58515e/attachment.bin>

From st_john_brown at yahoo.com  Tue May 27 15:06:43 2014
From: st_john_brown at yahoo.com (St John Brown)
Date: Tue, 27 May 2014 06:06:43 -0700 (PDT)
Subject: [R-sig-Geo] Calculate Area of Intersection
Message-ID: <1401196003.77875.YahooMailNeo@web122402.mail.ne1.yahoo.com>

Hi All,

I would like calculate the area of the intersection between a given city in the US and a 'circle' of a certain radius and center location. Below is my implementation.

I think I have done this right. I would like to double check to see if I have made some glaring error, or if there was a better way to implement the task.

I really appreciate any help you may provide.

Thanks!

library(sp)
library(rgdal)
library(maps)
library(rgeos)
library(mapproj)
library(geosphere)
library(maptools)
library(UScensus2010)
library(UScensus2010cdp)

make_circle_region = function(circle_center, circle_radius, earth_radius=3958.76) { #radius in miles
? circle_region = data.frame(matrix(ncol = 2, nrow = 361))
? colnames(circle_region) = c('longitude', 'latitude')
? for (bearing in 0:360){
??? circle_region[bearing+1,] = destPoint(p=circle_center,
b=bearing, d=circle_radius, r=earth_radius)
? }
? return(circle_region)
}

map("state", "texas")

austin = city("austin", "texas")
plot(austin, col="red", add=TRUE)

#Plot circle region around an zip code 78721 with radius = 10 miles
circle_center = c(-97.68665, 30.27293 ) #lon & lat of zip code 78721
circle_radius = 10 #units in miles (same units as earth_radius units)
truck_circle = make_circle_region(circle_center, circle_radius)
polygon(mapproject(truck_circle$longitude, truck_circle$latitude),col=rgb(0,1,0,0.5))

#Make circle a spatial object
truck_sp =
SpatialPolygons(list(Polygons(list(Polygon(truck_circle, hole=FALSE)), 1)))
proj4string(truck_sp) = CRS("+proj=longlat +datum=WGS84") #explicitly define the input projections using PROJ4 syntax

# Project to Albers Equal Area, with parameters set for North America
proj.string.alb = CRS("+proj=aea +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=WGS84? +units=km +no_defs")
austin_alb = spTransform(austin, CRS=proj.string.alb)
truck_alb = spTransform(truck_sp, CRS=proj.string.alb)

#Calculate area of intersection
myInt = gIntersection(austin_alb, truck_alb)
sprintf("The intersection is %.2f square km", gArea(myInt))


From veroandreo at gmail.com  Tue May 27 19:32:34 2014
From: veroandreo at gmail.com (Veronica Andreo)
Date: Tue, 27 May 2014 14:32:34 -0300
Subject: [R-sig-Geo] fill layers of a RasterStack with values in rows of a
	matrix
Message-ID: <CAAMki4Gamf4QusNsK_kC=uW=7gteH4Hs0piaN=CDQ-VM18RfTA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140527/b5d41d58/attachment.pl>

From vitale232 at gmail.com  Tue May 27 20:25:54 2014
From: vitale232 at gmail.com (Andrew Vitale)
Date: Tue, 27 May 2014 11:25:54 -0700
Subject: [R-sig-Geo] fill layers of a RasterStack with values in rows of
	a matrix
In-Reply-To: <CAAMki4Gamf4QusNsK_kC=uW=7gteH4Hs0piaN=CDQ-VM18RfTA@mail.gmail.com>
References: <CAAMki4Gamf4QusNsK_kC=uW=7gteH4Hs0piaN=CDQ-VM18RfTA@mail.gmail.com>
Message-ID: <CAFTcopfyYBUg3amJC7wY9wOL+vusP06Qn=mbM8DrYrei=asYOA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140527/7de67619/attachment.pl>

From veroandreo at gmail.com  Tue May 27 21:54:08 2014
From: veroandreo at gmail.com (Veronica Andreo)
Date: Tue, 27 May 2014 16:54:08 -0300
Subject: [R-sig-Geo] fill layers of a RasterStack with values in rows of
	a matrix
In-Reply-To: <CAFTcopfyYBUg3amJC7wY9wOL+vusP06Qn=mbM8DrYrei=asYOA@mail.gmail.com>
References: <CAAMki4Gamf4QusNsK_kC=uW=7gteH4Hs0piaN=CDQ-VM18RfTA@mail.gmail.com>
	<CAFTcopfyYBUg3amJC7wY9wOL+vusP06Qn=mbM8DrYrei=asYOA@mail.gmail.com>
Message-ID: <CAAMki4EujE2m1dmmnL_f8gkPmbszzNTByP8rEOsMUs9NyVWPTg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140527/611e282a/attachment.pl>

From agg18 at pitt.edu  Wed May 28 03:56:19 2014
From: agg18 at pitt.edu (alannie)
Date: Tue, 27 May 2014 18:56:19 -0700 (PDT)
Subject: [R-sig-Geo] Ecological Niche Factor Analysis
Message-ID: <1401242179032-7586516.post@n2.nabble.com>

Hi,

I have been using ENFA in R to perform some analyses. 

I have gotten the procedure to work before, however I can't seem to
replicate the code. This is very important since I would like to do this
analysis for a wide range of species. 

Please advise of best practice for implementing the procedure.

Going from the very beginnings of the procedure:

1) read in .csv formatted locations data for the interested species

   /code/ species1<-read.csv("species1.csv",head=T, sep=",")
                    species1coords<-SpatialPoints(species1)

2) read in raster files (I am using the bioclim variables converted into
ASCII)

   /code/ b1<-read.asc("bio1.asc")
                    b2<-read.asc("bio2.asc")
                    b3<-read.asc("bio3.asc")

3) combine the maps into a single data frame and add slots to the individual
maps
   /code/ map<-cbind(b1 at data,b2 at data,b3 at data) *this form does not allow me
to visualize the maps using image(map)
                    map2<-cbind(b1,b2,b3) *this form, with out the slots,
does allow me to visualize the maps using image(map2)

4) following this step is making a histogram: hist(map, type = "l")  I
usually cannot make one, but when I am able to make a histogram, the
variables show up on a single graph with the warning:

Warning messages:
1: In title(main = main, sub = sub, xlab = xlab, ylab = ylab, ...) :
  graphical parameter "type" is obsolete
2: In axis(1, ...) : graphical parameter "type" is obsolete
3: In axis(2, ...) : graphical parameter "type" is obsolete

4) The tab:
   /code/ tab <- slot(map, "data"), I get this warning:
Error in slot(map, "data") : 
  cannot get a slot ("data") from an object of type "double"

Sometimes I get other warnings such as 'x is not numeric' or something about
NA values.

I will spare the rest of the issues I face.

I believe the origins of these issues are the starting data inputs. I would
appreciate any assistance in modifying the data inputs. I have tried to look
through other resources, however I have not found anything to help with my
specific issues. 

If I can get this worked out, I also hope to post some code somewhere to
aide others in their SDM adventures.

Thank you for reading!

A










--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Ecological-Niche-Factor-Analysis-tp7586516.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From james.miraflor at gmail.com  Wed May 28 05:56:06 2014
From: james.miraflor at gmail.com (James Matthew Miraflor)
Date: Wed, 28 May 2014 11:56:06 +0800
Subject: [R-sig-Geo] Feature Extraction using R, Google Earth
Message-ID: <CAPim8ZK1n=2E=Ucicr6NzrmbnMVX_9eQsFs_aLfNL53RShVhEA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140528/de040bf7/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed May 28 10:24:26 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 28 May 2014 09:24:26 +0100
Subject: [R-sig-Geo] Feature Extraction using R, Google Earth
In-Reply-To: <d678ba70d91142db9fd0240fce124fc4@EX-1-HT0.lancs.local>
References: <d678ba70d91142db9fd0240fce124fc4@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMx-rUZiMEotqJz9CtBb8vgvyX8TRJDA3-dvfAahdV0Lw@mail.gmail.com>

Yes, but I seriously suspect it would be against the license terms and
conditions of Google Earth Imagery.

On Wed, May 28, 2014 at 4:56 AM, James Matthew Miraflor
<james.miraflor at gmail.com> wrote:
> Hi!
>
> Would there be a way to do some feature extraction / image analysis of
> structures using Google Earth images and R? Thanks!
>
> James
>
> --
>
> *James Matthew B. Miraflor*
> MS Computer Science
> College of Engineering
> University of the Philippines
>
> http://politicsforbreakfast.blogspot.com
> ________
>
> "No problem can withstand the assault of sustained thinking." - Voltaire
> ________
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From julleeyaw at yahoo.ca  Wed May 28 12:37:23 2014
From: julleeyaw at yahoo.ca (Julie Lee-Yaw)
Date: Wed, 28 May 2014 03:37:23 -0700 (PDT)
Subject: [R-sig-Geo] How to buffer a polygon by area
Message-ID: <1401273443.50214.YahooMailNeo@web124505.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140528/7f6bbad5/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed May 28 14:38:33 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 28 May 2014 13:38:33 +0100
Subject: [R-sig-Geo] How to buffer a polygon by area
In-Reply-To: <bcb499e92cf441228a9023bc324e0f7c@EX-0-HT0.lancs.local>
References: <bcb499e92cf441228a9023bc324e0f7c@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNEeTc9_1Z13hPpbi9tUO6qOX75U3rujnw8EYL=SZzVww@mail.gmail.com>

On Wed, May 28, 2014 at 11:37 AM, Julie Lee-Yaw <julleeyaw at yahoo.ca> wrote:
> Hello,
> Can anyone tell me how to buffer a polygon by area?
> I have a simple (no-holes and only one feature) polygon shapefile in an equal area projection and I need to buffer it to extend the boundaries so that the resulting polygon is 10% bigger by area. I know how to buffer by a fixed distance using the rgeos package but I will have to repeat this process across many different shapefiles that are of different sizes and a fixed buffer does not make sense in my case.
> Thanks in advance for the help!

 Since the area of a buffered feature must be increasing with
increasing buffer width I think you could use a binary search
algorithm on the buffer width. This might require doing five or six
buffers on each feature until you get to your required accuracy.

Here's something:

abuff <- function(f, percent, precision, maxsteps = 20){
    require(rgeos)
    A0 = gArea(f)

    targetA = A0 + A0 * (percent/100)
    e = bbox(f)
    w0 = 0
    w2 = diff(e[1,])/10 # initial w

    ## initial expansion until we pass the solution:

    repeat{
        b1 = gBuffer(f, width=w2)
        if(gArea(b1) < targetA){
            w2 = w2 * 2
        }else{
            break
        }
    }
    w1 = (w0 + w2)/2

    ## solution is between w0 and w2

    steps = 1

    repeat{
        b = gBuffer(f, width=w1)
        A = gArea(b)
        if(abs(100*(A-targetA)/targetA) < precision){
            return(list(steps = steps, poly = b, target=targetA))
        }
        if(A < targetA){
            w0 = w1
            w1 = (w1+w2)/2
        }
        if(A > targetA){
            w2 = w1
            w1 = (w2+w0)/2
        }
        steps = steps + 1
        if(steps > maxsteps){
            return(NA)
        }
    }
}

Sample usage is, given 'london' as a single row spatial polygons data frame:

 > lbuff = abuff(london, 10, .5)

 - for a 10% area increase to a 0.5% precision

 > lbuff$steps
[1] 6

 - it took 6 steps, so had to compute 6 buffers.

 > plot(lbuff$poly)
 > plot(london,add=TRUE)

 - plots the buffer and the source.

 > lbuff$target
[1] 1766883778
 > gArea(lbuff$poly)
[1] 1768395765

The target element is the area we were trying to find, and the next
line computes the area of the result. If you want more accuracy,
increase the precision at the expense of needing to do more buffers.

I've put this function in a gist if anyone wants to improve it:

https://gist.github.com/barryrowlingson/d1d21c537777cfda8178

Barry


From Thierry.ONKELINX at inbo.be  Wed May 28 16:36:18 2014
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Wed, 28 May 2014 14:36:18 +0000
Subject: [R-sig-Geo] How to buffer a polygon by area
In-Reply-To: <CANVKczNEeTc9_1Z13hPpbi9tUO6qOX75U3rujnw8EYL=SZzVww@mail.gmail.com>
References: <bcb499e92cf441228a9023bc324e0f7c@EX-0-HT0.lancs.local>
	<CANVKczNEeTc9_1Z13hPpbi9tUO6qOX75U3rujnw8EYL=SZzVww@mail.gmail.com>
Message-ID: <AA818EAD2576BC488B4F623941DA7427F3A6FB3C@inbomail.inbo.be>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140528/a15696b0/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed May 28 18:18:08 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 28 May 2014 17:18:08 +0100
Subject: [R-sig-Geo] How to buffer a polygon by area
In-Reply-To: <a74d8118800344ca9c82f90242f5e15d@EX-0-HT0.lancs.local>
References: <bcb499e92cf441228a9023bc324e0f7c@EX-0-HT0.lancs.local>
	<CANVKczNEeTc9_1Z13hPpbi9tUO6qOX75U3rujnw8EYL=SZzVww@mail.gmail.com>
	<a74d8118800344ca9c82f90242f5e15d@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNkkzCEB-=jUP441yWEGyv3J1dRT939C9jnL+XoPBFetw@mail.gmail.com>

On Wed, May 28, 2014 at 3:36 PM, ONKELINX, Thierry
<Thierry.ONKELINX at inbo.be> wrote:

>     while(abs(achieved.precision) > precision & steps < maxsteps){
>       buffered.perimeter <- gLength(buffered.spgeom)
>       buffer.width <- buffer.width - achieved.precision * spgeom.area /
> buffered.perimeter
>       buffered.spgeom <- gBuffer(spgeom, width = buffer.width)
>       achieved.precision <- gArea(buffered.spgeom) / spgeom.area - ratio
>       steps <- steps + 1
>     }

Is this guaranteed to converge? Could there be some polygon for which
the buffer width updating step bounces between two values like the
bistable state of an iterated function? Could a concave polygon have a
smaller perimeter for a larger buffer size? I think yes, but I'm not
sure if that would cause this method to not converge anyway...

My binary search is guaranteed to converge since buffer area is
strictly increasing with increasing buffer width...

Barry


From basille.web at ase-research.org  Wed May 28 22:27:22 2014
From: basille.web at ase-research.org (Mathieu Basille)
Date: Wed, 28 May 2014 16:27:22 -0400
Subject: [R-sig-Geo] =?utf-8?q?Re=C2=A0=3A__Ecological_Niche_Factor_Analys?=
	=?utf-8?q?is?=
In-Reply-To: <1401242179032-7586516.post@n2.nabble.com>
References: <1401242179032-7586516.post@n2.nabble.com>
Message-ID: <14644801e9c.3628716977470606921.6794866803767306633@ase-research.org>

Dear Alannie,

I think your problem comes from the handling of rasters as sp classes, not from the actual ENFA methods. You should try to import the rasters properly first, and check that they are actually valid 'SpatialPixelsDataFrame's. For instance, using rgdal:

library(rgdal)
bio1 <- readGDAL("bio1.asc") 
bio2 <- readGDAL("bio2.asc") 
bio3 <- readGDAL("bio3.asc") 
bio <- cbind(bio1, bio2, bio3)
names(bio) <- c("bio1", "bio2", "bio3")
summary(bio)
image(bio)
spplot(bio)
...

The rest of the analysis should work as expected.
Mathieu.


--

~$ whoami 
Mathieu Basille, PhD 
 
~$ locate --details 
University of Florida \\ 
Fort Lauderdale Research and Education Center 
(+1) 954-577-6314 
http://ase-research.org/basille 
 
~$ fortune 
? Le tout est de tout dire, et je manque de mots 
Et je manque de temps, et je manque d&#39;audace. ? 
  -- Paul ?luard
---- Le mar., 27 mai 2014 21:56:19 -0400 alannie  a ?crit ---- 

>Hi, 
> 
>I have been using ENFA in R to perform some analyses. 
> 
>I have gotten the procedure to work before, however I can't seem to 
>replicate the code. This is very important since I would like to do this 
>analysis for a wide range of species. 
> 
>Please advise of best practice for implementing the procedure. 
> 
>Going from the very beginnings of the procedure: 
> 
>1) read in .csv formatted locations data for the interested species 
> 
> /code/ species1<-read.csv("species1.csv",head=T, sep=",") 
> species1coords<-SpatialPoints(species1) 
> 
>2) read in raster files (I am using the bioclim variables converted into 
>ASCII) 
> 
> /code/ b1<-read.asc("bio1.asc") 
> b2<-read.asc("bio2.asc") 
> b3<-read.asc("bio3.asc") 
> 
>3) combine the maps into a single data frame and add slots to the individual 
>maps 
> /code/ map<-cbind(b1 at data,b2 at data,b3 at data) *this form does not allow me 
>to visualize the maps using image(map) 
> map2<-cbind(b1,b2,b3) *this form, with out the slots, 
>does allow me to visualize the maps using image(map2) 
> 
>4) following this step is making a histogram: hist(map, type = "l") I 
>usually cannot make one, but when I am able to make a histogram, the 
>variables show up on a single graph with the warning: 
> 
>Warning messages: 
>1: In title(main = main, sub = sub, xlab = xlab, ylab = ylab, ...) : 
> graphical parameter "type" is obsolete 
>2: In axis(1, ...) : graphical parameter "type" is obsolete 
>3: In axis(2, ...) : graphical parameter "type" is obsolete 
> 
>4) The tab: 
> /code/ tab <- slot(map, "data"), I get this warning: 
>Error in slot(map, "data") : 
> cannot get a slot ("data") from an object of type "double" 
> 
>Sometimes I get other warnings such as 'x is not numeric' or something about 
>NA values. 
> 
>I will spare the rest of the issues I face. 
> 
>I believe the origins of these issues are the starting data inputs. I would 
>appreciate any assistance in modifying the data inputs. I have tried to look 
>through other resources, however I have not found anything to help with my 
>specific issues. 
> 
>If I can get this worked out, I also hope to post some code somewhere to 
>aide others in their SDM adventures. 
> 
>Thank you for reading! 
> 
>A 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
>-- 
>View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Ecological-Niche-Factor-Analysis-tp7586516.html 
>Sent from the R-sig-geo mailing list archive at Nabble.com. 
> 
>_______________________________________________ 
>R-sig-Geo mailing list 
>R-sig-Geo at r-project.org 
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
>

--

~$ whoami 
Mathieu Basille, PhD 
 
~$ locate --details 
University of Florida \\ 
Fort Lauderdale Research and Education Center 
(+1) 954-577-6314 
http://ase-research.org/basille 
 
~$ fortune 
? Le tout est de tout dire, et je manque de mots 
Et je manque de temps, et je manque d'audace. ? 
 -- Paul ?luard


From Thierry.ONKELINX at inbo.be  Thu May 29 00:30:11 2014
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Wed, 28 May 2014 22:30:11 +0000
Subject: [R-sig-Geo] How to buffer a polygon by area
In-Reply-To: <CANVKczNkkzCEB-=jUP441yWEGyv3J1dRT939C9jnL+XoPBFetw@mail.gmail.com>
References: <bcb499e92cf441228a9023bc324e0f7c@EX-0-HT0.lancs.local>
	<CANVKczNEeTc9_1Z13hPpbi9tUO6qOX75U3rujnw8EYL=SZzVww@mail.gmail.com>
	<a74d8118800344ca9c82f90242f5e15d@EX-0-HT0.lancs.local>,
	<CANVKczNkkzCEB-=jUP441yWEGyv3J1dRT939C9jnL+XoPBFetw@mail.gmail.com>
Message-ID: <AA818EAD2576BC488B4F623941DA7427F3A70C18@inbomail.inbo.be>

Hi Barry,

I think it is guaranteed to converge. The first estimate of the buffer width is the extra area divided by the perimeter. That would be to large in most cases. The adjustments are based on the difference between the target area and the last buffered area and the perimeter of the last buffer. So the buffer width is only updated based on the last errors.

I have tried the examples below. A starlike polygon, a rectangle and a U shape, all very thin. I applied a large buffer (1e6). It takes 11, 12 and 12 steps to converge (precision < 1e-7). With small buffers like 1.1 only a few steps are needed.
The algorithm starts hopping around when the precision < 1e-7). I think that is due to the precision of gBuffer(), gArea() and/or gLength(). On the other hand: a precision of 0.00001% seems acceptable to me.

spgeom <- readWKT("POLYGON((1 0, 10000 10000, 0 1, -10000 10000, -1 0, -10000 -10000, 0 -1, 10000 -10000, 1 0))")
spgeom <- readWKT("POLYGON((0 0, 0 10000, 1 10000, 1 0, 0 0))")
spgeom <- readWKT("POLYGON((0 0, 0 10000, 1 10000, 1 1, 2 1, 2 10000, 3 10000, 3 0, 0 0))")
ratio = 1e6

Best regards,

Thierry

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium
+ 32 2 525 02 51
+ 32 54 43 61 85
Thierry.Onkelinx at inbo.be
www.inbo.be
To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data. ~ John Tukey

________________________________________
Van: b.rowlingson at gmail.com [b.rowlingson at gmail.com] namens Barry Rowlingson [b.rowlingson at lancaster.ac.uk]
Verzonden: woensdag 28 mei 2014 18:18
Aan: ONKELINX, Thierry
CC: Julie Lee-Yaw; r-sig-geo at r-project.org
Onderwerp: Re: [R-sig-Geo] How to buffer a polygon by area

On Wed, May 28, 2014 at 3:36 PM, ONKELINX, Thierry
<Thierry.ONKELINX at inbo.be> wrote:

>     while(abs(achieved.precision) > precision & steps < maxsteps){
>       buffered.perimeter <- gLength(buffered.spgeom)
>       buffer.width <- buffer.width - achieved.precision * spgeom.area /
> buffered.perimeter
>       buffered.spgeom <- gBuffer(spgeom, width = buffer.width)
>       achieved.precision <- gArea(buffered.spgeom) / spgeom.area - ratio
>       steps <- steps + 1
>     }

Is this guaranteed to converge? Could there be some polygon for which
the buffer width updating step bounces between two values like the
bistable state of an iterated function? Could a concave polygon have a
smaller perimeter for a larger buffer size? I think yes, but I'm not
sure if that would cause this method to not converge anyway...

My binary search is guaranteed to converge since buffer area is
strictly increasing with increasing buffer width...

Barry
* * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * * *
Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.
The views expressed in this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document.


From forrest at ufl.edu  Thu May 29 01:52:00 2014
From: forrest at ufl.edu (Forrest Stevens)
Date: Wed, 28 May 2014 19:52:00 -0400
Subject: [R-sig-Geo] How to buffer a polygon by area
In-Reply-To: <AA818EAD2576BC488B4F623941DA7427F3A70C18@inbomail.inbo.be>
References: <bcb499e92cf441228a9023bc324e0f7c@EX-0-HT0.lancs.local>
	<CANVKczNEeTc9_1Z13hPpbi9tUO6qOX75U3rujnw8EYL=SZzVww@mail.gmail.com>
	<a74d8118800344ca9c82f90242f5e15d@EX-0-HT0.lancs.local>
	<CANVKczNkkzCEB-=jUP441yWEGyv3J1dRT939C9jnL+XoPBFetw@mail.gmail.com>
	<AA818EAD2576BC488B4F623941DA7427F3A70C18@inbomail.inbo.be>
Message-ID: <CAEBQMM=RnJH23PcJsUog=-xQiDFpXX4P-FgM1pqgsYcg48MwEA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140528/482cc326/attachment.pl>

From yasebaytok at gmail.com  Thu May 29 05:11:38 2014
From: yasebaytok at gmail.com (Yerguner)
Date: Wed, 28 May 2014 20:11:38 -0700 (PDT)
Subject: [R-sig-Geo] reproject a multi-layered netcdf file using
 projectRaster with "nearest neighbor method"
In-Reply-To: <1400824252979-7586498.post@n2.nabble.com>
References: <1400824252979-7586498.post@n2.nabble.com>
Message-ID: <1401333098984-7586526.post@n2.nabble.com>

Hi,Can anyone help me why I am getting following error while using
projectRaster() with the nearest neighbor method of the raster package?
Since projectRasters() works fine with the bilinear method for the same
files.Error in getfun(nc, varid = zvar, start = start, count = count) : NAs
in foreign function call (arg 3) Thanks,Yasemin



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/reproject-a-multi-layered-netcdf-file-using-projectRaster-with-nearest-neighbor-method-tp7586498p7586526.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Thu May 29 10:01:51 2014
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 29 May 2014 09:01:51 +0100
Subject: [R-sig-Geo] How to buffer a polygon by area
In-Reply-To: <80c1e37f73d3414b935bba1485016924@EX-0-HT0.lancs.local>
References: <bcb499e92cf441228a9023bc324e0f7c@EX-0-HT0.lancs.local>
	<CANVKczNEeTc9_1Z13hPpbi9tUO6qOX75U3rujnw8EYL=SZzVww@mail.gmail.com>
	<a74d8118800344ca9c82f90242f5e15d@EX-0-HT0.lancs.local>
	<CANVKczNkkzCEB-=jUP441yWEGyv3J1dRT939C9jnL+XoPBFetw@mail.gmail.com>
	<80c1e37f73d3414b935bba1485016924@EX-0-HT0.lancs.local>
Message-ID: <CANVKczPF8+7pYK_36C7ujrgR7zztCbukviPHRPaBbJKYv_khww@mail.gmail.com>

On Wed, May 28, 2014 at 11:30 PM, ONKELINX, Thierry
<Thierry.ONKELINX at inbo.be> wrote:
> Hi Barry,
>
> I think it is guaranteed to converge. The first estimate of the buffer width is the extra area divided by the perimeter. That would be to large in most cases. The adjustments are based on the difference between the target area and the last buffered area and the perimeter of the last buffer. So the buffer width is only updated based on the last errors.
>
> I have tried the examples below. A starlike polygon, a rectangle and a U shape, all very thin. I applied a large buffer (1e6). It takes 11, 12 and 12 steps to converge (precision < 1e-7). With small buffers like 1.1 only a few steps are needed.

My first theorem is that the perimeter of a buffered polygon is not
strictly increasing with increasing buffer width. Consider something
like the intricate palm-tree shaped islands in Dubai - for small
buffers the perimeter is large, and as the width increases all the
details are lost and the buffer perimeter shrinks even though the area
is strictly increasing.  QED with a bit of hand (palm?) waving.

Theorem 2 is that the algorithm convergence depends on Theorem 1 being
*not* true. Theorem 2 is currently better known as "Hunch 1" and its
proof (or disproof) will have to wait. I just spilled my breakfast
cornflakes on my notepad and I have to get to work now, so unlike
Fermat I do not claim to have a truly wondrous proof/disproof of this
yet.

Barry


From hakim.abdi at nateko.lu.se  Thu May 29 10:45:36 2014
From: hakim.abdi at nateko.lu.se (Hakim Abdi)
Date: Thu, 29 May 2014 10:45:36 +0200
Subject: [R-sig-Geo] raster stack/brick cor.test p-values
Message-ID: <CALPtVYWHmaMRFYbNNWqGT8oQ17Wy3Ao99005VmCQpFBy0E7S2A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140529/ccc17298/attachment.pl>

From kridox at ymail.com  Thu May 29 10:56:33 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Thu, 29 May 2014 17:56:33 +0900
Subject: [R-sig-Geo] raster stack/brick cor.test p-values
In-Reply-To: <CALPtVYWHmaMRFYbNNWqGT8oQ17Wy3Ao99005VmCQpFBy0E7S2A@mail.gmail.com>
References: <CALPtVYWHmaMRFYbNNWqGT8oQ17Wy3Ao99005VmCQpFBy0E7S2A@mail.gmail.com>
Message-ID: <CAAcyNCwM34N3sZV=QnaPTwQDf179z+Xo39zzCAumVs+fd-3XKg@mail.gmail.com>

Hello Hakim,

The function "cor" can take matrix as input. Not the function "cor.test".

Hope this helps,
Pascal


On Thu, May 29, 2014 at 5:45 PM, Hakim Abdi <hakim.abdi at nateko.lu.se> wrote:
> Dear list:
>
> I am trying to get pixel-wise correlations and significance between two
> raster bricks; one representing monthly NDVI means and another representing
> monthly rainfall means.
>
> I found the following two codes (both from Robert Hijmans) from a previous
> discussions on this list:
> http://r-sig-geo.2731867.n2.nabble.com/questions-on-RasterStack-Brick-td5553580.html
> and
> from StackOverflow:
> http://stackoverflow.com/questions/16698048/r-calculating-pearson-correlation-coefficient-in-each-cell-along-time-line
>
>
> # code 1
>> funcal <- function(xy) {
>>     xy <- na.omit(matrix(xy, ncol=2))
>>     if (ncol(xy) < 2) {
>>         NA
>>     } else {
>>         cor(xy[, 1], xy[, 2])
>>     }
>> }
>> s <- stack(sa, sb)
>> calc(s, funcal)
>> # code 2
>> stackcor <- function(s1, s2, method='spearman') {
>>         mycor <- function(v) {
>>                 x <- v[1:split]
>>                 y <- v[(split+1):(2*split)]
>>                 cor(x, y, method=method)
>>         }
>>         s <- stack(s1, s2)
>>         split <- nlayers(s)/2
>>         calc(s, fun=mycor )
>> }
>
>
> Both codes work as expected with the "cor" function, producing correlation
> grids. However, I tried substituting the cor with cor.test in order to
> extract the p-values:
>
> # using the first code
>> funcal <- function(xy) {
>>     xy <- na.omit(matrix(xy, ncol=2))
>>     if (ncol(xy) < 2) {
>>         NA
>>     } else {
>>         cor.test(xy[, 1], xy[, 2],method="pearson")$p.value
>>     }
>> }
>> s <- stack(sa, sb)
>> calc(s, funcal)
>
>
> I am met with the following error (with trackback in RStudio):
>
> Error in cor.test.default(xy[, 1], xy[, 2], method = "pearson") :
>>   not enough finite observations
>> 8 stop("not enough finite observations")
>> 7 cor.test.default(xy[, 1], xy[, 2], method = "pearson")
>> 6 cor.test(xy[, 1], xy[, 2], method = "pearson")
>> 5 FUN(newX[, i], ...)
>> 4 apply(v, 1, fun)
>> 3 .local(x, fun, ...)
>> 2 calc(meistack, brick.cor.pval)
>> 1 calc(meistack, brick.cor.pval)
>
>
> In the previous r-sig-geo, a user had asked about this error but it was
> left unanswered. I was wondering if anyone can help with this?
>
> Thanks!
>
> Hakim
> ____________________________________________________
>
> Hakim Abdi |  PhD Candidate
> Geobiosphere Science Center
>
> Department of Physical Geography and Ecosystem Science
> Lund University, S?lvegatan 12, SE-223 62 Lund, Sweden
>
> Email: hakim.abdi at nateko.lu.se
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From kridox at ymail.com  Fri May 30 06:53:04 2014
From: kridox at ymail.com (Pascal Oettli)
Date: Fri, 30 May 2014 13:53:04 +0900
Subject: [R-sig-Geo] raster stack/brick cor.test p-values
In-Reply-To: <CALPtVYUYPaJ7vkywDPjdG8Sm7dz0bPGzPDfD8iSBzAKr_++C1g@mail.gmail.com>
References: <CALPtVYWHmaMRFYbNNWqGT8oQ17Wy3Ao99005VmCQpFBy0E7S2A@mail.gmail.com>
	<CAAcyNCwM34N3sZV=QnaPTwQDf179z+Xo39zzCAumVs+fd-3XKg@mail.gmail.com>
	<CALPtVYUYPaJ7vkywDPjdG8Sm7dz0bPGzPDfD8iSBzAKr_++C1g@mail.gmail.com>
Message-ID: <CAAcyNCxes4kFXjm8kmPU5xJvSOufkj49VBfkZ4xDt0E9yLCe+Q@mail.gmail.com>

Please reply to the list, not privately.


> Thanks for the tip. It's a bit strange because the same code, with a minor
> modification, ran well until all of sudden it decided to spit out these
> error. Here it is:
>
> brick.cor.pval <- function(xy) { # Pearson product moment correlation
> p-values
>   xy <- na.omit(matrix(xy, ncol=2))
>   if (ncol(xy) < 2) {
>     NA} else if
>   (is.na(xy[1])) {
>     NA} else
>   { cor.test(xy[, 1], xy[, 2],method="pearson")$p.value
>   }
> }
>
> I just added the "(is.na(xy[1]))" portion. Any ideas as to why this is?
>
>
>
> On Thu, May 29, 2014 at 10:56 AM, Pascal Oettli <kridox at ymail.com> wrote:
>>
>> Hello Hakim,
>>
>> The function "cor" can take matrix as input. Not the function "cor.test".
>>
>> Hope this helps,
>> Pascal
>>
>>
>> On Thu, May 29, 2014 at 5:45 PM, Hakim Abdi <hakim.abdi at nateko.lu.se>
>> wrote:
>> > Dear list:
>> >
>> > I am trying to get pixel-wise correlations and significance between two
>> > raster bricks; one representing monthly NDVI means and another
>> > representing
>> > monthly rainfall means.
>> >
>> > I found the following two codes (both from Robert Hijmans) from a
>> > previous
>> > discussions on this list:
>> >
>> > http://r-sig-geo.2731867.n2.nabble.com/questions-on-RasterStack-Brick-td5553580.html
>> > and
>> > from StackOverflow:
>> >
>> > http://stackoverflow.com/questions/16698048/r-calculating-pearson-correlation-coefficient-in-each-cell-along-time-line
>> >
>> >
>> > # code 1
>> >> funcal <- function(xy) {
>> >>     xy <- na.omit(matrix(xy, ncol=2))
>> >>     if (ncol(xy) < 2) {
>> >>         NA
>> >>     } else {
>> >>         cor(xy[, 1], xy[, 2])
>> >>     }
>> >> }
>> >> s <- stack(sa, sb)
>> >> calc(s, funcal)
>> >> # code 2
>> >> stackcor <- function(s1, s2, method='spearman') {
>> >>         mycor <- function(v) {
>> >>                 x <- v[1:split]
>> >>                 y <- v[(split+1):(2*split)]
>> >>                 cor(x, y, method=method)
>> >>         }
>> >>         s <- stack(s1, s2)
>> >>         split <- nlayers(s)/2
>> >>         calc(s, fun=mycor )
>> >> }
>> >
>> >
>> > Both codes work as expected with the "cor" function, producing
>> > correlation
>> > grids. However, I tried substituting the cor with cor.test in order to
>> > extract the p-values:
>> >
>> > # using the first code
>> >> funcal <- function(xy) {
>> >>     xy <- na.omit(matrix(xy, ncol=2))
>> >>     if (ncol(xy) < 2) {
>> >>         NA
>> >>     } else {
>> >>         cor.test(xy[, 1], xy[, 2],method="pearson")$p.value
>> >>     }
>> >> }
>> >> s <- stack(sa, sb)
>> >> calc(s, funcal)
>> >
>> >
>> > I am met with the following error (with trackback in RStudio):
>> >
>> > Error in cor.test.default(xy[, 1], xy[, 2], method = "pearson") :
>> >>   not enough finite observations
>> >> 8 stop("not enough finite observations")
>> >> 7 cor.test.default(xy[, 1], xy[, 2], method = "pearson")
>> >> 6 cor.test(xy[, 1], xy[, 2], method = "pearson")
>> >> 5 FUN(newX[, i], ...)
>> >> 4 apply(v, 1, fun)
>> >> 3 .local(x, fun, ...)
>> >> 2 calc(meistack, brick.cor.pval)
>> >> 1 calc(meistack, brick.cor.pval)
>> >
>> >
>> > In the previous r-sig-geo, a user had asked about this error but it was
>> > left unanswered. I was wondering if anyone can help with this?
>> >
>> > Thanks!
>> >
>> > Hakim
>> > ____________________________________________________
>> >
>> > Hakim Abdi |  PhD Candidate
>> > Geobiosphere Science Center
>> >
>> > Department of Physical Geography and Ecosystem Science
>> > Lund University, S?lvegatan 12, SE-223 62 Lund, Sweden
>> >
>> > Email: hakim.abdi at nateko.lu.se
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>>
>>
>> --
>> Pascal Oettli
>> Project Scientist
>> JAMSTEC
>> Yokohama, Japan
>
>



-- 
Pascal Oettli
Project Scientist
JAMSTEC
Yokohama, Japan


From hakim.abdi at nateko.lu.se  Fri May 30 10:52:28 2014
From: hakim.abdi at nateko.lu.se (Hakim Abdi)
Date: Fri, 30 May 2014 10:52:28 +0200
Subject: [R-sig-Geo] raster stack/brick cor.test p-values
In-Reply-To: <CAAcyNCwM34N3sZV=QnaPTwQDf179z+Xo39zzCAumVs+fd-3XKg@mail.gmail.com>
References: <CALPtVYWHmaMRFYbNNWqGT8oQ17Wy3Ao99005VmCQpFBy0E7S2A@mail.gmail.com>
	<CAAcyNCwM34N3sZV=QnaPTwQDf179z+Xo39zzCAumVs+fd-3XKg@mail.gmail.com>
Message-ID: <CALPtVYXAvinJBrS3xjJtYG7dWBkjvGS_SfL9dsGYGXhXsVNQLA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140530/3210cbf2/attachment.pl>

From azvoleff at conservation.org  Fri May 30 16:48:04 2014
From: azvoleff at conservation.org (Alex Zvoleff)
Date: Fri, 30 May 2014 10:48:04 -0400
Subject: [R-sig-Geo] Adding smoothing factor to terrain function in raster
Message-ID: <CACwzsXFniWQJ5P=UMFF58YW30uKOmETy6KH1x56k1b48En89cg@mail.gmail.com>

Dear list (and Robert Hijmans in particular),

I am using  the terrain function in the raster package to calculate
slope and aspect prior to performing topographic correction. The
landsat package supports applying a smoothing factor during the slope
calculation, to avoid over-correction of reflectance in high slope
areas with low illumination (as suggested by Ria?o, Salas, and Aguado
2003). However I have been using the terrain function in the raster
package to calculate slope and aspect since it can handle large
rasters and is coded in C.

Attached is a patch to allow applying a smoothing factor when
calculating slope using the terrain function in raster. Is there a
chance of including the attached changes (based on r2994) in the next
release of raster?

Thanks,
Alex

Ref: Ria?o D., Chuvieco E., Salas J., and Aguado I., 2003. Assessment
of different topographic corrections in Landsat-TM data for mapping
vegetation types. IEEE Transactions on Geoscience and Remote Sensing
41: 1056-1061.

-- 
Alex Zvoleff
Postdoctoral Associate
Tropical Ecology Assessment and Monitoring (TEAM) Network
Conservation International
2011 Crystal Dr. Suite 500, Arlington, Virginia 22202, USA
Tel: +1-703-341-2749, Fax: +1-703-979-0953, Skype: azvoleff
http://www.teamnetwork.org | http://www.conservation.org
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smoothing_factor.patch
Type: application/octet-stream
Size: 8163 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20140530/c936da0a/attachment.obj>

From ghiaco at gmail.com  Fri May 30 19:28:51 2014
From: ghiaco at gmail.com (user2602640)
Date: Fri, 30 May 2014 10:28:51 -0700 (PDT)
Subject: [R-sig-Geo] Average home range across animals
Message-ID: <1401470931858-7586534.post@n2.nabble.com>

Hello list,

I'm trying to estimate average home range across animals per season. I use
here a subset of my data, 3 individuals, 7 relocations each, tracked across
3 seasons (actual dataset is ~ 100K, ~30 animals). Not all fish are present
in all seasons, and their locations differ between seasons. I need to
estimate average home range area across fish for each season and plot it.

I think that Anthony Fischbach's reply from the thread below is what I need
to do, I'm just stuck partway there (mainly because I'm very new to spatial
analysis and adehabitatHR).

http://r-sig-geo.2731867.n2.nabble.com/averaging-home-range-contours-td7499301.html#a7503972

Where I'm at now:

## data subset:
df <- structure(list(Season = structure(c(2L, 2L, 2L, 2L, 2L, 2L, 2L, 
3L, 3L, 3L, 3L, 3L, 3L, 3L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 
2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 
2L, 2L, 2L), .Label = c("Spring", "Summer", "Fall"), class = "factor"), 
Easting = c(425952.746437786, 425930.124103401, 425904.838430173, 
425897.396103185, 425859.77203381, 425769.155466566, 425698.934422453, 
425172.162553713, 425201.54784946, 425265.188960297, 425293.907156855, 
425334.519543017, 425351.98115297, 425341.657291998, 426499.521534761, 
426491.617459401, 426489.21804795, 426458.425998741, 426444.572705444, 
426435.13014907, 426428.521796826, 425206.363932968, 425214.055516556, 
425214.686198032, 425219.462846981, 425224.610973811, 425225.509004604, 
425231.130704745, 425295.438309455, 425295.033258023, 425298.385156621, 
425286.605300153, 425292.736058183, 425296.563442322, 425289.068691518, 
425262.047903812, 425245.264536305, 425236.068286685, 425246.961026478, 
425244.291558159, 425234.858476333, 425220.329721481), Northing =
c(5630038.14127036, 
5630042.68938361, 5630053.17010795, 5630050.05067675, 5630050.03021924, 
5630044.42581987, 5630080.68394433, 5631660.65042482, 5631622.41326505, 
5631580.90371775, 5631564.80939618, 5631533.30748204, 5631498.46768363, 
5631476.0382073, 5629521.34564057, 5629530.46592294, 5629545.1806574, 
5629555.1802463, 5629557.15541335, 5629572.08088964, 5629598.08820948, 
5630913.54144105, 5630904.64457731, 5630904.41307655, 5630898.56103167, 
5630889.14462961, 5630887.90831366, 5630886.93779994, 5630645.78035996, 
5630647.00958702, 5630649.85318956, 5630643.90518234, 5630648.93328633, 
5630650.5466496, 5630648.65226268, 5631661.36063509, 5631635.46509059, 
5631632.70549606, 5631635.88559859, 5631631.47516021, 5631626.93945528, 
5631610.91014489), ID = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 
1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 
2L, 2L, 2L, 2L, 2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 
3L, 3L, 3L, 3L, 3L, 3L), .Label = c("01", "04", "06"), class = "factor")),
.Names =         
c("Season", 
"Easting", "Northing", "ID"), row.names = c(NA, 42L), class = "data.frame")


library(adehabitatHR)

## to calculate UD for each fish-season combination:

df$IDS <- paste(df$ID, df$Season, sep = "")
sp_df <- SpatialPoints(subset(df, select = c(Easting, Northing)),
proj4string = CRS("+proj=utm +zone=11 +ellps=WGS84"))
sp_df <- SpatialPointsDataFrame(coords = sp_df, data = subset(df, select =
c(IDS)))
kud_full <- kernelUD(sp_df, grid = 300, extent = 0.4, same4all=TRUE) 
kud_spdf <- estUDm2spixdf(kud_full) 
mimage(kud_spdf)

Now that I have separate UDs, how do I proceed to calculating seasonal
averages of the LOCATION (not area) of home ranges? I can calculate area
values and average them out, not a problem, but I can't figure out how to
estimate the average polygons so that I can then plot them. Completely stuck
here...

Thank you so much!




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Average-home-range-across-animals-tp7586534.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From agg18 at pitt.edu  Fri May 30 21:47:11 2014
From: agg18 at pitt.edu (alannie)
Date: Fri, 30 May 2014 12:47:11 -0700 (PDT)
Subject: [R-sig-Geo]
	=?utf-8?q?Re=C3=82=C2=A0=3A__Ecological_Niche_Factor_?=
	=?utf-8?q?Analysis?=
Message-ID: <e30f88da703560010841836c24aa8d99.squirrel@webmail.pitt.edu>

Thanks Mathieu!

This has gone very well so far, but I cannot seem to get the XY location
data and the bioclim maps in the same proj4string.
 CODE: pr <- slot(count.points(corysp, bio), "data")[,1]
Error in count.points(corysp, bio) : different proj4string in w and xy

This seems strange since everything in the same coordinate system WGS 1984
from previous analysis.

 class(corysp)
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"

summary(corysp)
Object of class SpatialPointsDataFrame
Coordinates:
                min       max
coords.x1 -124.1643 -119.7514
coords.x2   37.0000   40.8030
Is projected: NA
proj4string : [NA]
Number of points: 44
Data attributes:
               taxon_name   Y_latitude      X_longitud
 Collinsia corymbosa:44   Min.   :37.00   Min.   :-124.2
                          1st Qu.:37.98   1st Qu.:-123.8
                          Median :39.46   Median :-123.8
                          Mean   :38.99   Mean   :-123.3
                          3rd Qu.:39.50   3rd Qu.:-122.6
                          Max.   :40.80   Max.   :-119.8


I have tried to change the coordinate system using
CODE:

coordsp<-SpatialPoints(corysp, proj4string=CRS(as.character(NA)), bbox =
NULL)

But get the same issue:

pr <- slot(count.points(coordsp, bio), "data")[,1]
Error in count.points(coordsp, bio) : different proj4string in w and xy


Also, I still cannot may histograms using the bioclim map data.


Thanks so much for your assistance! You have helped me so much!


Alannie




>
>
> Dear Alannie,
>
> I think your problem comes from the handling of rasters as sp classes, not
> from the actual ENFA methods. You should try to import the rasters
> properly first, and check that they are actually valid
> 'SpatialPixelsDataFrame's. For instance, using rgdal:
>
> library(rgdal)
> bio1 <- readGDAL("bio1.asc")
> bio2 <- readGDAL("bio2.asc")
> bio3 <- readGDAL("bio3.asc")
> bio <- cbind(bio1, bio2, bio3)
> names(bio) <- c("bio1", "bio2", "bio3")
> summary(bio)
> image(bio)
> spplot(bio)
> ...
>
> The rest of the analysis should work as expected.
> Mathieu.
>
>
> --
>
> ~$ whoami
> Mathieu Basille, PhD
>
> ~$ locate --details
> University of Florida \\
> Fort Lauderdale Research and Education Center
> (+1) 954-577-6314
> http://ase-research.org/basille
>
> ~$ fortune
> ?? Le tout est de tout dire, et je manque de mots
> Et je manque de temps, et je manque d&#39;audace. ??
>   -- Paul ??luard
> ---- Le mar., 27 mai 2014 21:56:19 -0400 alannie  a ??crit ----
>
>>Hi,
>>
>>I have been using ENFA in R to perform some analyses.
>>
>>I have gotten the procedure to work before, however I can't seem to
>>replicate the code. This is very important since I would like to do this
>>analysis for a wide range of species.
>>
>>Please advise of best practice for implementing the procedure.
>>
>>Going from the very beginnings of the procedure:
>>
>>1) read in .csv formatted locations data for the interested species
>>
>> /code/ species1<-read.csv("species1.csv",head=T, sep=",")
>> species1coords<-SpatialPoints(species1)
>>
>>2) read in raster files (I am using the bioclim variables converted into
>>ASCII)
>>
>> /code/ b1<-read.asc("bio1.asc")
>> b2<-read.asc("bio2.asc")
>> b3<-read.asc("bio3.asc")
>>
>>3) combine the maps into a single data frame and add slots to the
>> individual
>>maps
>> /code/ map<-cbind(b1 at data,b2 at data,b3 at data) *this form does not allow me
>>to visualize the maps using image(map)
>> map2<-cbind(b1,b2,b3) *this form, with out the slots,
>>does allow me to visualize the maps using image(map2)
>>
>>4) following this step is making a histogram: hist(map, type = "l") I
>>usually cannot make one, but when I am able to make a histogram, the
>>variables show up on a single graph with the warning:
>>
>>Warning messages:
>>1: In title(main = main, sub = sub, xlab = xlab, ylab = ylab, ...) :
>> graphical parameter "type" is obsolete
>>2: In axis(1, ...) : graphical parameter "type" is obsolete
>>3: In axis(2, ...) : graphical parameter "type" is obsolete
>>
>>4) The tab:
>> /code/ tab <- slot(map, "data"), I get this warning:
>>Error in slot(map, "data") :
>> cannot get a slot ("data") from an object of type "double"
>>
>>Sometimes I get other warnings such as 'x is not numeric' or something
>> about
>>NA values.
>>
>>I will spare the rest of the issues I face.
>>
>>I believe the origins of these issues are the starting data inputs. I
>> would
>>appreciate any assistance in modifying the data inputs. I have tried to
>> look
>>through other resources, however I have not found anything to help with
>> my
>>specific issues.
>>
>>If I can get this worked out, I also hope to post some code somewhere to
>>aide others in their SDM adventures.
>>
>>Thank you for reading!
>>
>>A
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>--
>>View this message in context:
>> http://r-sig-geo.2731867.n2.nabble.com/Ecological-Niche-Factor-Analysis-tp7586516.html
>>Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>>_______________________________________________
>>R-sig-Geo mailing list
>>R-sig-Geo at r-project.org
>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
>
> ~$ whoami
> Mathieu Basille, PhD
>
> ~$ locate --details
> University of Florida \\
> Fort Lauderdale Research and Education Center
> (+1) 954-577-6314
> http://ase-research.org/basille
>
> ~$ fortune
> ?? Le tout est de tout dire, et je manque de mots
> Et je manque de temps, et je manque d'audace. ??
>  -- Paul ??luard
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> _______________________________________________
> If you reply to this email, your message will be added to the discussion
> below:
> http://r-sig-geo.2731867.n2.nabble.com/Ecological-Niche-Factor-Analysis-tp7586516p7586523.html
> To start a new topic under R-sig-geo, email
> ml-node+s2731867n2731867h11 at n2.nabble.com
> To unsubscribe from Ecological Niche Factor Analysis, visit
> http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7586516&code=YWdnMThAcGl0dC5lZHV8NzU4NjUxNnwtMjAxOTYzNDk0MQ==







--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Re-ReA-Ecological-Niche-Factor-Analysis-tp7586535.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From agg18 at pitt.edu  Fri May 30 22:02:24 2014
From: agg18 at pitt.edu (alannie)
Date: Fri, 30 May 2014 13:02:24 -0700 (PDT)
Subject: [R-sig-Geo]
	=?utf-8?q?Re=C3=82=C2=A0=3A__Ecological_Niche_Factor_?=
	=?utf-8?q?Analysis?=
Message-ID: <b5e67cb38dd58feb8240d7bf30db744c.squirrel@webmail.pitt.edu>

Oh, on that last part with the conversion, I actually used

coordsp<-SpatialPoints(corysp, proj4string=CRS"+proj=longlat
+datum=WGS84")) , bbox = NULL)

Sorry for that mistake. Either way, it does not work.


> Thanks Mathieu!
>
> This has gone very well so far, but I cannot seem to get the XY location
> data and the bioclim maps in the same proj4string.
>  CODE: pr <- slot(count.points(corysp, bio), "data")[,1]
> Error in count.points(corysp, bio) : different proj4string in w and xy
>
> This seems strange since everything in the same coordinate system WGS 1984
> from previous analysis.
>
>  class(corysp)
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
>
> summary(corysp)
> Object of class SpatialPointsDataFrame
> Coordinates:
>                 min       max
> coords.x1 -124.1643 -119.7514
> coords.x2   37.0000   40.8030
> Is projected: NA
> proj4string : [NA]
> Number of points: 44
> Data attributes:
>                taxon_name   Y_latitude      X_longitud
>  Collinsia corymbosa:44   Min.   :37.00   Min.   :-124.2
>                           1st Qu.:37.98   1st Qu.:-123.8
>                           Median :39.46   Median :-123.8
>                           Mean   :38.99   Mean   :-123.3
>                           3rd Qu.:39.50   3rd Qu.:-122.6
>                           Max.   :40.80   Max.   :-119.8
>
>
> I have tried to change the coordinate system using
> CODE:
>
> coordsp<-SpatialPoints(corysp, proj4string=CRS(as.character(NA)), bbox =
> NULL)
>
> But get the same issue:
>
> pr <- slot(count.points(coordsp, bio), "data")[,1]
> Error in count.points(coordsp, bio) : different proj4string in w and xy
>
>
> Also, I still cannot may histograms using the bioclim map data.
>
>
> Thanks so much for your assistance! You have helped me so much!
>
>
> Alannie
>
>
>
>
>>
>>
>> Dear Alannie,
>>
>> I think your problem comes from the handling of rasters as sp classes,
>> not
>> from the actual ENFA methods. You should try to import the rasters
>> properly first, and check that they are actually valid
>> 'SpatialPixelsDataFrame's. For instance, using rgdal:
>>
>> library(rgdal)
>> bio1 <- readGDAL("bio1.asc")
>> bio2 <- readGDAL("bio2.asc")
>> bio3 <- readGDAL("bio3.asc")
>> bio <- cbind(bio1, bio2, bio3)
>> names(bio) <- c("bio1", "bio2", "bio3")
>> summary(bio)
>> image(bio)
>> spplot(bio)
>> ...
>>
>> The rest of the analysis should work as expected.
>> Mathieu.
>>
>>
>> --
>>
>> ~$ whoami
>> Mathieu Basille, PhD
>>
>> ~$ locate --details
>> University of Florida \\
>> Fort Lauderdale Research and Education Center
>> (+1) 954-577-6314
>> http://ase-research.org/basille
>>
>> ~$ fortune
>> ?? Le tout est de tout dire, et je manque de mots
>> Et je manque de temps, et je manque d&#39;audace. ??
>>   -- Paul ??luard
>> ---- Le mar., 27 mai 2014 21:56:19 -0400 alannie  a ??crit ----
>>
>>>Hi,
>>>
>>>I have been using ENFA in R to perform some analyses.
>>>
>>>I have gotten the procedure to work before, however I can't seem to
>>>replicate the code. This is very important since I would like to do this
>>>analysis for a wide range of species.
>>>
>>>Please advise of best practice for implementing the procedure.
>>>
>>>Going from the very beginnings of the procedure:
>>>
>>>1) read in .csv formatted locations data for the interested species
>>>
>>> /code/ species1<-read.csv("species1.csv",head=T, sep=",")
>>> species1coords<-SpatialPoints(species1)
>>>
>>>2) read in raster files (I am using the bioclim variables converted into
>>>ASCII)
>>>
>>> /code/ b1<-read.asc("bio1.asc")
>>> b2<-read.asc("bio2.asc")
>>> b3<-read.asc("bio3.asc")
>>>
>>>3) combine the maps into a single data frame and add slots to the
>>> individual
>>>maps
>>> /code/ map<-cbind(b1 at data,b2 at data,b3 at data) *this form does not allow me
>>>to visualize the maps using image(map)
>>> map2<-cbind(b1,b2,b3) *this form, with out the slots,
>>>does allow me to visualize the maps using image(map2)
>>>
>>>4) following this step is making a histogram: hist(map, type = "l") I
>>>usually cannot make one, but when I am able to make a histogram, the
>>>variables show up on a single graph with the warning:
>>>
>>>Warning messages:
>>>1: In title(main = main, sub = sub, xlab = xlab, ylab = ylab, ...) :
>>> graphical parameter "type" is obsolete
>>>2: In axis(1, ...) : graphical parameter "type" is obsolete
>>>3: In axis(2, ...) : graphical parameter "type" is obsolete
>>>
>>>4) The tab:
>>> /code/ tab <- slot(map, "data"), I get this warning:
>>>Error in slot(map, "data") :
>>> cannot get a slot ("data") from an object of type "double"
>>>
>>>Sometimes I get other warnings such as 'x is not numeric' or something
>>> about
>>>NA values.
>>>
>>>I will spare the rest of the issues I face.
>>>
>>>I believe the origins of these issues are the starting data inputs. I
>>> would
>>>appreciate any assistance in modifying the data inputs. I have tried to
>>> look
>>>through other resources, however I have not found anything to help with
>>> my
>>>specific issues.
>>>
>>>If I can get this worked out, I also hope to post some code somewhere to
>>>aide others in their SDM adventures.
>>>
>>>Thank you for reading!
>>>
>>>A
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>--
>>>View this message in context:
>>> http://r-sig-geo.2731867.n2.nabble.com/Ecological-Niche-Factor-Analysis-tp7586516.html
>>>Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>
>>>_______________________________________________
>>>R-sig-Geo mailing list
>>>R-sig-Geo at r-project.org
>>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>>
>> ~$ whoami
>> Mathieu Basille, PhD
>>
>> ~$ locate --details
>> University of Florida \\
>> Fort Lauderdale Research and Education Center
>> (+1) 954-577-6314
>> http://ase-research.org/basille
>>
>> ~$ fortune
>> ?? Le tout est de tout dire, et je manque de mots
>> Et je manque de temps, et je manque d'audace. ??
>>  -- Paul ??luard
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>>
>> _______________________________________________
>> If you reply to this email, your message will be added to the discussion
>> below:
>> http://r-sig-geo.2731867.n2.nabble.com/Ecological-Niche-Factor-Analysis-tp7586516p7586523.html
>> To start a new topic under R-sig-geo, email
>> ml-node+s2731867n2731867h11 at n2.nabble.com
>> To unsubscribe from Ecological Niche Factor Analysis, visit
>> http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=7586516&code=YWdnMThAcGl0dC5lZHV8NzU4NjUxNnwtMjAxOTYzNDk0MQ==
>
>
>







--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Re-ReA-Ecological-Niche-Factor-Analysis-tp7586536.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


