From parktf at kangwon.ac.kr  Mon Jul  2 03:48:29 2012
From: parktf at kangwon.ac.kr (=?EUC-KR?B?udrDtrrA?=)
Date: Mon, 2 Jul 2012 10:48:29 +0900 (KST)
Subject: [R-sig-Geo] R shut down problem when using "lambdahat"
Message-ID: <1563535395.1341193709495.JavaMail.root@mail.kangwon.ac.kr>

Hello,

I am using function &quot;lambdahat&quot; in &quot;spatialkernel&quot; for my data analysis. 
I meet a problem.  I find under WinXP and Win7, when my code runs to the line of function &quot;lambdahat&quot;, R will shut down, without any error message. Sometimes, it does work for 1 or 2 times. However, if I try continuously, R will shut down. The strange thing is that if I try the code under Linux system, it works very well. 

Does anyone know why?  


Below is my code:



library(spatstat)
library(spatialkernel)
pol=c(0, 1, 1, 0, 0, 0, 1, 1)
dim(pol) = c(4, 2)


aa = rpoispp(100)
bb = density(aa)
cc = as.matrix(data.frame(gx = aa$x, gy = aa$y))


loci = matrix(ncol = 2, nrow = 16384)
loci[,1] = rep(bb$xcol, each = 128)
loci[,2] = rep(bb$yrow, times = 128)


lam = lambdahat(pts = cc, h = 0.1, gpts = loci, poly = pol)



Regards,

Vincent




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120702/69f4001b/attachment.html>

From darunabas at gmail.com  Mon Jul  2 12:27:21 2012
From: darunabas at gmail.com (Barnabas Daru)
Date: Mon, 2 Jul 2012 12:27:21 +0200
Subject: [R-sig-Geo] Species richness in R
Message-ID: <FE40C386-72EC-4B0B-987E-D60A47982997@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120702/b00c4592/attachment.pl>

From mdsumner at gmail.com  Mon Jul  2 12:40:33 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 2 Jul 2012 20:40:33 +1000
Subject: [R-sig-Geo]  R shut down problem when using "lambdahat"
In-Reply-To: <1563535395.1341193709495.JavaMail.root@mail.kangwon.ac.kr>
References: <1563535395.1341193709495.JavaMail.root@mail.kangwon.ac.kr>
Message-ID: <CAAcGz99R_fpza_7iQbsxtN_H+ehV1n=LskiDTYgUpZ1r-E1c_Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120702/2649c17e/attachment.pl>

From mathieu.rajerison at gmail.com  Mon Jul  2 14:25:28 2012
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Mon, 2 Jul 2012 14:25:28 +0200
Subject: [R-sig-Geo] Species richness in R
In-Reply-To: <FE40C386-72EC-4B0B-987E-D60A47982997@gmail.com>
References: <FE40C386-72EC-4B0B-987E-D60A47982997@gmail.com>
Message-ID: <CAGfc75m1Er7mTRmwdPmPTiarF6nvwprUruPhrNo5SnakHc4BQA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120702/6033a56f/attachment.pl>

From lyndon.estes at gmail.com  Mon Jul  2 16:05:59 2012
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Mon, 2 Jul 2012 10:05:59 -0400
Subject: [R-sig-Geo] Species richness in R
In-Reply-To: <CAGfc75m1Er7mTRmwdPmPTiarF6nvwprUruPhrNo5SnakHc4BQA@mail.gmail.com>
References: <FE40C386-72EC-4B0B-987E-D60A47982997@gmail.com>
	<CAGfc75m1Er7mTRmwdPmPTiarF6nvwprUruPhrNo5SnakHc4BQA@mail.gmail.com>
Message-ID: <CALuVVaYjXWsEXrALA-uOUSoVGwXKetpCgCr=jSOV_g4xViuxqQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120702/71ccae6f/attachment.pl>

From Gema.FAviles at uclm.es  Mon Jul  2 17:20:07 2012
From: Gema.FAviles at uclm.es (GEMA FERNANDEZ-AVILES CALDERON)
Date: Mon, 2 Jul 2012 17:20:07 +0200
Subject: [R-sig-Geo] gstat()  Median polish
References: <2DA2DD6A3859694A971ACE0998D7B65904F638@evsab03.uclm.es>
Message-ID: <2DA2DD6A3859694A971ACE0998D7B65904F639@evsab03.uclm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120702/e4acae21/attachment.pl>

From riaarinda at gmail.com  Mon Jul  2 18:35:39 2012
From: riaarinda at gmail.com (riaarinda)
Date: Mon, 2 Jul 2012 09:35:39 -0700 (PDT)
Subject: [R-sig-Geo] Compute Local Moran using Matrix Algebra
Message-ID: <1341246939352-7580374.post@n2.nabble.com>

I am currently trying to compute local moran's (LISA) using matrix algebra. I
have already get the Ii and E(Ii) values (the result is correctly the same
with Geoda's), but now still confused about getting the Var.Ii, Z.Ii, and
Pr(z > 0). I am still confused about how to get b2 when I try to compute
V(Ii).
Anyone can help telling me how to compute them (Var.Ii, Z.Ii, and Pr(z >
0)), please.
Thank you

The code that I've been using :

library(spdep)
jateng.shp <-
readShapePoly('C:/Users/Toshiba/Documents/DATATIM/3/jateng.shp')
jateng.gal <- read.gal('C:/Users/Toshiba/Documents/DATATIM/3/jateng.gal')
jateng.nb <- nb2listw(jateng.gal)
v1 <- jateng.shp$RCAP107
obs <- NROW(v1)
obs1 <- obs-1
obs2 <- obs-2
ll <- (obs-1)/obs
v1z <- v1-mean(v1)
new_sd_1 <- sd(v1)*ll
a <- v1z/new_sd_1
v1zsdv1 <- v1z/sd(v1)
b <- lag.listw(jateng.nb, v1zsdv1)
unilocmor <- a*b ###### Ii values
wadah <- c(1:obs)
for(i in 1:obs){wadah[i] <- sum(jateng.mat[i,])}
Wi <- wadah
EIi <- Wi/(obs-1) ###### EIi values



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Compute-Local-Moran-using-Matrix-Algebra-tp7580374.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From calamita_giuseppe at yahoo.it  Tue Jul  3 10:58:37 2012
From: calamita_giuseppe at yahoo.it (Giuseppe Calamita)
Date: Tue, 3 Jul 2012 01:58:37 -0700 (PDT)
Subject: [R-sig-Geo] SpatialPoints, SpatialGrid and related terminology
In-Reply-To: <CADr8yXDDqh0ozu8Sq5JjroKnDfBm5iamagCd=8RDBx2k5mYJBg@mail.gmail.com>
References: <CADr8yXDDqh0ozu8Sq5JjroKnDfBm5iamagCd=8RDBx2k5mYJBg@mail.gmail.com>
Message-ID: <1341305917068-7580375.post@n2.nabble.com>

Ciao Gabriele,
you can find a shorter yet very useful descriptions of how spatial classes
work in one of the vignettes of the sp-package.

To visualize that, simply write on R terminal 
> vignette("intro_sp") 
this will open a pdf. 
You can also download it directly from
http://cran.r-project.org/web/packages/sp/vignettes/intro_sp.pdf

If you use 
> vignette(package= "sp") 
you'll see all the available vignette in that package, whereas if you use 
> vignette()
you'll see ALL the available vignette in all the installed package (this may
take a long time).

Hope this helps
Giuseppe

-----
Giusepep Calamita
PhD italian National Council of Research - Institute of Methodologies for Environmental Research CNR - IMAA
85050 Tito Scalo - Potenza - Italy 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/SpatialPoints-SpatialGrid-and-related-terminology-tp7580355p7580375.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Tue Jul  3 11:09:56 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 3 Jul 2012 11:09:56 +0200 (CEST)
Subject: [R-sig-Geo] Compute Local Moran using Matrix Algebra
In-Reply-To: <1341246939352-7580374.post@n2.nabble.com>
References: <1341246939352-7580374.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.02.1207031106350.17396@reclus.nhh.no>

On Mon, 2 Jul 2012, riaarinda wrote:

> I am currently trying to compute local moran's (LISA) using matrix algebra. I
> have already get the Ii and E(Ii) values (the result is correctly the same
> with Geoda's), but now still confused about getting the Var.Ii, Z.Ii, and
> Pr(z > 0). I am still confused about how to get b2 when I try to compute
> V(Ii).

Have you looked at the code of the localmoran() function? There you see:

 	b2 <- (sum(z^4, na.rm=NAOK)/n)/(s2^2)

as a (sort of) measure of kurtosis.

Roger

> Anyone can help telling me how to compute them (Var.Ii, Z.Ii, and Pr(z >
> 0)), please.
> Thank you
>
> The code that I've been using :
>
> library(spdep)
> jateng.shp <-
> readShapePoly('C:/Users/Toshiba/Documents/DATATIM/3/jateng.shp')
> jateng.gal <- read.gal('C:/Users/Toshiba/Documents/DATATIM/3/jateng.gal')
> jateng.nb <- nb2listw(jateng.gal)
> v1 <- jateng.shp$RCAP107
> obs <- NROW(v1)
> obs1 <- obs-1
> obs2 <- obs-2
> ll <- (obs-1)/obs
> v1z <- v1-mean(v1)
> new_sd_1 <- sd(v1)*ll
> a <- v1z/new_sd_1
> v1zsdv1 <- v1z/sd(v1)
> b <- lag.listw(jateng.nb, v1zsdv1)
> unilocmor <- a*b ###### Ii values
> wadah <- c(1:obs)
> for(i in 1:obs){wadah[i] <- sum(jateng.mat[i,])}
> Wi <- wadah
> EIi <- Wi/(obs-1) ###### EIi values
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Compute-Local-Moran-using-Matrix-Algebra-tp7580374.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From carolina.lang at ifop.cl  Tue Jul  3 16:36:16 2012
From: carolina.lang at ifop.cl (carolang)
Date: Tue, 3 Jul 2012 07:36:16 -0700 (PDT)
Subject: [R-sig-Geo] adehabitat in R
Message-ID: <1341326176144-7580377.post@n2.nabble.com>

Hi everybody, 
I write to ask if anyone has an R code to calculate ENFA analyses with data
from a matrix.

Any help with R code would be highly appreciated.

Carolina Lang
Chile


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/adehabitat-in-R-tp7580377.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mestre.frederico at gmail.com  Tue Jul  3 20:09:21 2012
From: mestre.frederico at gmail.com (Frederico Mestre)
Date: Tue, 3 Jul 2012 19:09:21 +0100
Subject: [R-sig-Geo] randomly changing raster pixels
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAANurYWtafkREnWeH4rBeYRHigQAAEAAAALr2PUSafdVIt4ETpZ+GuPwBAAAAAA==@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120703/ce7f4cdf/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Jul  3 21:08:40 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 3 Jul 2012 20:08:40 +0100
Subject: [R-sig-Geo] randomly changing raster pixels
In-Reply-To: <18e5dac7d43e4494892d7504b5e05359@EX-1-HT0.lancs.local>
References: <18e5dac7d43e4494892d7504b5e05359@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOCMpYaaTF4oQkeXMZKpeakT21DRw6jO9m1VVbG_3MPrA@mail.gmail.com>

On Tue, Jul 3, 2012 at 7:09 PM, Frederico Mestre
<mestre.frederico at gmail.com> wrote:
> Hello:
>
>
>
> I've got a raster generated with the raster package. I want to randomly
> change the value of  pixels of a given value.
>
>
>
> For example, I want to select 25% of the pixels with value 2, changing its
> value to 3.
>
>
>
> Any ideas?
>

 For some raster r, do a test for which cells are 2:

is2 = r==2

then set FALSE to NA:

is2[!is2]=NA

how many have you got?

sum(values(is2),na.rm=TRUE)
[1] 64

so we want to replace 16. use sampleRandom to return cell indices (it
doesnt return the NA cells, which is the reason for setting the NAs
above):

r[sampleRandom(is2,16,cells=TRUE)[,'cell']]=3

The r raster was originally approx 64 cells of values 1 to 4. Now it is:

 table(values(r))

 1  2  3  4
66 48 82 60

Looks about right...

Expect Robert in about a minute with a simpler solution!

Barry


From thi_veloso at yahoo.com.br  Thu Jul  5 03:30:04 2012
From: thi_veloso at yahoo.com.br (Thiago Veloso)
Date: Wed, 4 Jul 2012 18:30:04 -0700 (PDT)
Subject: [R-sig-Geo] Suggestion to package raster: replace ncdf by ncdf4
Message-ID: <1341451804.97209.YahooMailNeo@web161406.mail.bf1.yahoo.com>

? Dear all (especially Robert),

? I have been reading the documentation of package "ncdf" and I found out that it is now deprecated. David Pierce released "ncdf4", which contains essentially the same features of old ncdf, but supporting netCDF version 4.

? In order to keep up-to-date with the current netcdf specifications, "ncdf" depedency could be replaced by "ncdf4" when dealing with netcdf files. This would demand some extra effort (as the functions have new names), but I think the benefits may worth it.

? Just a suggestion, Robert. Nothing that jeopardises "raster" glamour!

? Best wishes,
? Thiago.


From mdsumner at gmail.com  Thu Jul  5 03:33:49 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 5 Jul 2012 11:33:49 +1000
Subject: [R-sig-Geo] Suggestion to package raster: replace ncdf by ncdf4
In-Reply-To: <1341451804.97209.YahooMailNeo@web161406.mail.bf1.yahoo.com>
References: <1341451804.97209.YahooMailNeo@web161406.mail.bf1.yahoo.com>
Message-ID: <CAAcGz98s-w7rxdL3oJGEjMNVHsqRrJqZof67AU8CwkvPzdwo9A@mail.gmail.com>

The issue is with difficulties in cross-platform support. There is no
CRAN binary for ncdf4, while these are available for ncdf and RNetCDF
(thanks to Prof. Brian Ripley).

Cheers, Mike.

On Thu, Jul 5, 2012 at 11:30 AM, Thiago Veloso <thi_veloso at yahoo.com.br> wrote:
>   Dear all (especially Robert),
>
>   I have been reading the documentation of package "ncdf" and I found out that it is now deprecated. David Pierce released "ncdf4", which contains essentially the same features of old ncdf, but supporting netCDF version 4.
>
>   In order to keep up-to-date with the current netcdf specifications, "ncdf" depedency could be replaced by "ncdf4" when dealing with netcdf files. This would demand some extra effort (as the functions have new names), but I think the benefits may worth it.
>
>   Just a suggestion, Robert. Nothing that jeopardises "raster" glamour!
>
>   Best wishes,
>   Thiago.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From mrca at bgs.ac.uk  Thu Jul  5 10:36:07 2012
From: mrca at bgs.ac.uk (Cave, Mark R.)
Date: Thu, 5 Jul 2012 09:36:07 +0100
Subject: [R-sig-Geo] Aligning an image with a map
Message-ID: <9C29AFE27E3FBA4DB1742CC8E8F74ECD1E7DB875FE@nerckwmb1.ad.nerc.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120705/84263f54/attachment.pl>

From tom.gottfried at o2mail.de  Thu Jul  5 10:55:07 2012
From: tom.gottfried at o2mail.de (Tom Gottfried)
Date: Thu, 05 Jul 2012 10:55:07 +0200
Subject: [R-sig-Geo] Aligning an image with a map
In-Reply-To: <9C29AFE27E3FBA4DB1742CC8E8F74ECD1E7DB875FE@nerckwmb1.ad.nerc.ac.uk>
References: <9C29AFE27E3FBA4DB1742CC8E8F74ECD1E7DB875FE@nerckwmb1.ad.nerc.ac.uk>
Message-ID: <4FF5566B.3050503@o2mail.de>

Am 05.07.2012 10:36, schrieb Cave, Mark R.:
> I have a jpeg image which I wish to overlay on a map. What is the best approach?

Surely not the best but one approach: georectify the image with GRASS 
and e.g. save it as a GeoTIFF that can be imported with rgdal (readGDAL()).

HTH,
Tom

>
> Thanks
>
> Dr Mark Cave
> Medical Geology Project Leader
> British Geological Survey
> Keyworth
> Nottingham
> NG12 5GG
>
> http://www.bgs.ac.uk/staff/profiles/0125.html
>
>
>
>
>


From b.rowlingson at lancaster.ac.uk  Thu Jul  5 11:30:51 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 5 Jul 2012 10:30:51 +0100
Subject: [R-sig-Geo] Aligning an image with a map
In-Reply-To: <b9f89d83479f4636bc7f89d26886405c@EX-1-HT0.lancs.local>
References: <b9f89d83479f4636bc7f89d26886405c@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMFSn7a14A3Dj5qKyF9f5x77RTtJFT_+wdQWT4_GtYa5w@mail.gmail.com>

On Thu, Jul 5, 2012 at 9:36 AM, Cave, Mark R. <mrca at bgs.ac.uk> wrote:
> I have a jpeg image which I wish to overlay on a map. What is the best approach?
>

 If you know its bounds and the coordinate system of its bounds then
create a world file (.jpgw) and then it should be usable to the gdal
library, and hence read in with the raster package...

FYI:

http://en.wikipedia.org/wiki/World_file

If you don't know the bounds then you need to georeference it -
assigning known points on the image (the summit of a hill, the
junction of a road etc) to true coordinates, and then working out the
transformation.

 Quantum GIS has a handy georeferencing feature where you click on
points on your image and then click on corresponding points on your
Qgis project, so you can load in a background layer (say, from
OpenStreetMap) and then register features in your image to those on
OpenStreetMap. Then once you've added enough references, Qgis will
compute the necessary transformation.

Barry


From marion.wenty at gmail.com  Thu Jul  5 14:10:20 2012
From: marion.wenty at gmail.com (Marion Wenty)
Date: Thu, 5 Jul 2012 14:10:20 +0200
Subject: [R-sig-Geo] reprojecting shape files (change coordinates)
In-Reply-To: <4FE3EEF6.8000001@o2mail.de>
References: <CA+=LhL29WhfKv-ShmBAgwDMr6UCPtECWsiCMAQXJDSsJ1ynwLg@mail.gmail.com>
	<4FE3EEF6.8000001@o2mail.de>
Message-ID: <CA+=LhL3_1=YxVd_omAeGTEb9wZxTbA=8guO3Dc=YPhFYHQoqQA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120705/eb2e7c7a/attachment.pl>

From basille at ase-research.org  Thu Jul  5 14:28:53 2012
From: basille at ase-research.org (Mathieu Basille)
Date: Thu, 05 Jul 2012 08:28:53 -0400
Subject: [R-sig-Geo] adehabitat in R
In-Reply-To: <1341326176144-7580377.post@n2.nabble.com>
References: <1341326176144-7580377.post@n2.nabble.com>
Message-ID: <4FF58885.5020207@ase-research.org>

Dear Carolina,

I'm not sure what's your exact problem, since you don't provide any data, 
sample or code. If your matrix is such that rows define available units 
(usually, one row = one pixel of a raster map) over several variables (i.e. 
columns), you just need a vector of presence, with the number of 
observation associated to each available unit. This vector can be an 
additional column. Please have a look at the help of ?enfa, and 
specifically the example:

      data(lynxjura)

      map <- lynxjura$map

      ## We keep only "wild" indices.
      locs <- lynxjura$locs
      locs <- locs[slot(locs, "data")[,2]!="D",]

      hist(map, type = "l")
      ## The variable artif is far from symetric

      ## We perform a square root transformation
      ## of this variable
      ## We therefore normalize the variable 'artif'
      slot(map,"data")[,4] <- sqrt(slot(map,"data")[,4])
      hist(map, type = "l")

      ## We prepare the data for the ENFA
      tab <- slot(map, "data")
      pr <- slot(count.points(locs, map), "data")[,1]

You can then check what's in 'tab' and 'pr', which are the basic elements 
required for an ENFA:

 > head(tab)
      forets     hydro    routes     artif
1  5.154568 11.230920 11.622950 16.607230
2 11.643950 10.054470 11.389700  4.661158
3 16.126420  8.814120 10.972950  7.452453
4 18.757530  7.549436 10.417370  9.770423
5 19.779750  6.323049  9.784133 21.188813
6 22.390620  5.249640  9.140086 26.448665
 > head(pr)
[1] 0 0 0 0 0 0
 > table(pr)
pr
    0    1    2    3    4
8220  379   33    7    1

All that's needed then is to run a PCA on the variables measured on the 
available units (don't forget to remove the vector of presence if it's a 
column of your matrix), and use the result of this PCA together with the 
vector of presence:

      ## We then perform the PCA before the ENFA
      pc <- dudi.pca(tab, scannf = FALSE)

      (enfa1 <- enfa(pc, pr,
                     scannf = FALSE))

Hope this helps,
Mathieu.


Le 03/07/2012 10:36, carolang a ?crit :
> Hi everybody,
> I write to ask if anyone has an R code to calculate ENFA analyses with data
> from a matrix.
>
> Any help with R code would be highly appreciated.
>
> Carolina Lang
> Chile
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/adehabitat-in-R-tp7580377.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 

~$ whoami
Mathieu Basille, Post-Doc

~$ locate
Laboratoire d'?cologie Comportementale et de Conservation de la Faune
+ Centre d'?tude de la For?t
D?partement de Biologie
Universit? Laval, Qu?bec

~$ info
http://ase-research.org/basille

~$ fortune
``If you can't win by reason, go for volume.''
Calvin, by Bill Watterson.


From waldircj at gmail.com  Thu Jul  5 15:24:24 2012
From: waldircj at gmail.com (Waldir de Carvalho Junior)
Date: Thu, 5 Jul 2012 15:24:24 +0200
Subject: [R-sig-Geo] LDL factor
Message-ID: <CAFs5Q4KQiZA-EjNAKQ01hniX8-1EefDFXxwqkXpmjOifJONtoQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120705/005b6cc9/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Jul  5 15:49:09 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 05 Jul 2012 15:49:09 +0200
Subject: [R-sig-Geo] LDL factor
In-Reply-To: <CAFs5Q4KQiZA-EjNAKQ01hniX8-1EefDFXxwqkXpmjOifJONtoQ@mail.gmail.com>
References: <CAFs5Q4KQiZA-EjNAKQ01hniX8-1EefDFXxwqkXpmjOifJONtoQ@mail.gmail.com>
Message-ID: <4FF59B55.6000609@uni-muenster.de>

I tried out on the dataset (off-list), and found the following duplicate
point pair:

> coordinates(dataset)=~X+Y
> zerodist(dataset)
     [,1] [,2]
[1,]   82   84


On 07/05/2012 03:24 PM, Waldir de Carvalho Junior wrote:
> Hi
> I am having problem when try to use the krige function in R.
> I dont have duplicated points and the commands and the error message are:
> 
>> freg = arg.1~1 # regression formule> G<-gstat(id='dataset$ID', formula= freg, locations=~X+Y, data=dataset)> ev <- variogram(G, cressie=F, boundaries=c(seq(0,600,200),seq(800,5800,1000)))> vgm = fit.variogram(ev, vgm(4055, "Exp", 421,3774)) # adjustment> krige(id='dataset$ID', formula= freg, locations=~X+Y, data=dataset,newdata =dataset[,],model = vgm)[using ordinary kriging]
> 
> "chfactor.c", line 131: singular matrix in function LDLfactor()Error
> in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  :
>   LDLfactor
> 
> 
> I have a database of 208 points of soils samples, and i am trying to use
> gstat to estimate the clay content of surface layer.
> I read that the error maybe because of 2 points at the same location, but
> this is not the case.
> If someone can help, I could pass the database to some tests.
> Thank you
> Waldir
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Tom_Roche at pobox.com  Thu Jul  5 19:03:13 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Thu, 05 Jul 2012 13:03:13 -0400
Subject: [R-sig-Geo] "regridding" netCDF?
Message-ID: <87mx3ew372.fsf@pobox.com>


I'd appreciate advice regarding tools and methods for transforming
values "contained" in a netCDF spatial grids in one {projection,
resolution} to another, or pointers to other resources to consult.
Apologies if the following is too verbose (I'm hoping this is a common
usecase) or uses the wrong vocabulary (please correct where needed),
but here's what I mean:

I'm a student attempting to work on N2O using a particular atmospheric
model (CMAQ). My group want to take N2O emissions from various sources
in the continental US (CONUS) and then "blow them around" (and do some
chemistry and photolysis) with CMAQ. We have other CMAQ inputs for our
usecase on a 12 km x 12 km Lambert conformal conic (LCC) grid, so we
need to get our N2O emissions on the same grid (i.e., "regrid" them).
However, most of my emissions will be coming from global inventories
(EDGAR, GEIA, GFED) which are gridded lat-lon at differing resolutions
(e.g., 0.1?x0.1?, 1?x1?).

I know how to reproject grid *points* (corners, centers) from lat-lon
to 12-km LCC using R package=M3

http://cran.r-project.org/web/packages/M3/

What I don't understand yet (algorithmically, anyway--mental picture
below) is how to reallocate gridded *values* from any one given
{projection, resolution} tuple to another. E.g.:

EDGAR 4.2 gives the mass emitted from each 0.1?x0.1? lat-lon gridcell
over the globe. At 40? N (a middle latitude of CONUS), 0.1?x0.1? is
approx 11 km N-S x 8.5 km E-W. I need to transform the values from
those gridcells into those for a 12x12 km LCC CMAQ grid (which of
course will deviate slightly from those exact dimensions--we have the
exact grid centers and corners) over CONUS, such that, over the same
area, the sum of the masses in the CMAQ grid matches that of the EDGAR
grid.

In the general case, each transformed/CMAQ gridcell will intersect/
overlap parts of 4 source/EDGAR gridcells, so the emissions captured
within the CMAQ gridcell will be the sum of the 4 products (for each
of the overlappings)

overlap area * 
total emissions from overlapped EDGAR gridcell / 
total area of overlapped EDGAR gridcell

Calculating that for a large grid sounds like work, but also sounds
like work someone has previously needed to do. (This doesn't sound to
me like a unique task--am I missing something?) As a coder, I'm more
than willing to reuse :-) but am wondering where to look.

Your coding recommendations are appreciated, as would be pointers to
helpful resources. Thanks in advance, and feel free to forward,
Tom Roche <Tom_Roche at pobox.com>


From dave.gregovich at alaska.gov  Thu Jul  5 20:59:46 2012
From: dave.gregovich at alaska.gov (Gregovich, Dave P (DFG))
Date: Thu, 05 Jul 2012 10:59:46 -0800
Subject: [R-sig-Geo] gps file->WGS84->NAD83 Alaska stateplane zone 1
Message-ID: <7EC373B616FB8343A17C27C96726D8D90117038F@soajnumsg04.soa.alaska.gov>

Hello, 

 

I am new to R-sig-geo, thanks for your patience.

 

I am trying to bring GPS animal collar data into R and correctly project
it to NAD83 Alaska Stateplane zone 1 (epsg:26931 should be the correct
proj4 code). In leiu of any other way to verify if my projection is
working, I am comparing it to results in ArcGIS (this is the first time
I have tried to bring GIS data into R). The problem I am having is that
the ArcGIS and R (via RGDAL and sp) processes result in vastly different
projected coordinates. Below is the R code I am using:

 

#wgs 84 definition

wgs84<-"+init=epsg:4326"

#NAD 83 stateplane Alaska zone 1 definition

ak.sp.z1<-"+init=epsg:26931"

 

 

txt.loc<-"C:/bear414.txt"

bear414<-read.table(txt.loc,header=T,sep=",",stringsAsFactors=F)

coordinates(bear414)<-c("Long_","Latitude")

proj4string(bear414)<-CRS(wgs84)

bear414_nad83<-spTransform(bear414,CRS(ak.sp.z1))

writeOGR(obj=bear414_nad83,dsn="C:/dave/temp/rgis",layer="test414",

 
driver=as.character(ogrDrivers()[7,1]),overwrite_layer=TRUE)

 

I realize that this is not an ArcGIS-related list, but in case it helps,
the process I use in ArcGIS is essentially:

Display xy-coordinates, export to WGS84 shapefile, and project to new
NAD83 Alaska stateplane zone 1 shapefile. Also, when I use proj4string()
on NAD83 Alaska stateplane zone 1 shapefiles that are from a published
source (eg. the Southeast Alaska GIS library), the string is identical
to that referenced by epsg:26931.

 

The rough difference (clicking on eye-balled centroid) between the
ArcGIS and R results I am getting are: ArcGIS--    x: 726509 y: 801767,
R--   x: 4912400 y: -4784000

 

Thanks so much for your time. I have spent almost two entire days on
this problem and look forward to eventually overcoming this hurdle!

 

Dave

 

system: windows 7 x64

windows version: build 7601, Service Pack 1

R version: 2.15.1

 

 

__________________________________

Dave Gregovich

Research Analyst

Alaska Department of Fish and Game

Wildlife Conservation Division

Douglas, AK 99821

(907) 465-4291

dave.gregovich at alaska.gov

__________________________________

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120705/7b76cff2/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: bear414.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120705/7b76cff2/attachment.txt>

From Louise.Soanes at liverpool.ac.uk  Thu Jul  5 22:32:28 2012
From: Louise.Soanes at liverpool.ac.uk (Soanes, Louise)
Date: Thu, 5 Jul 2012 20:32:28 +0000
Subject: [R-sig-Geo] combining UD's in kernel denisty analysis
Message-ID: <D416AED6984CEB49A17BFE77601BD59B31B69E89@CHEXMBX1.livad.liv.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120705/2d7efab0/attachment.pl>

From thi_veloso at yahoo.com.br  Thu Jul  5 22:37:51 2012
From: thi_veloso at yahoo.com.br (Thiago Veloso)
Date: Thu, 5 Jul 2012 13:37:51 -0700 (PDT)
Subject: [R-sig-Geo] Function to repair incorrect ring ordering?
Message-ID: <1341520671.20349.YahooMailNeo@web161401.mail.bf1.yahoo.com>

? Dear all,

? I have made a decision to replace ArcGIS by open-source solutions such as qgis, spatial packages etc. ?Gradually, I need to find alternative packages/functions that do the same thing that ArcGIS tools do.

? The first problem: some of my shapefiles are reported by ArcGIS to have some "incorrect ring ordering" problems. In ArcGIS it is easy to fix that by using a tool called "repair geometry". According to the help, this tool "inspects each feature in a feature class for geometry problems. Upon discovery of a geometry problem, a relevant fix will be applied, and a one line description will be printed identifying the feature as well as the problem encountered."

? Is a similar tool available in any R package?

? Many thanks in advance,
? Thiago.


From bxhorn at gmail.com  Thu Jul  5 23:54:22 2012
From: bxhorn at gmail.com (BHorn)
Date: Thu, 5 Jul 2012 14:54:22 -0700 (PDT)
Subject: [R-sig-Geo] RES: Import Part of a GeoTiff using readGDAL{rgdal}
In-Reply-To: <AANLkTi=uSctF=8HXo29Oxa_-TxCPYagVZayO=9aXTzei@mail.gmail.com>
References: <002c01cb29b0$8ab93e90$a02bbbb0$@gmail.com>
	<AANLkTikYqCojBNH2amBl8H85BqIaTctFlVk5dzEkai-B@mail.gmail.com>
	<000001cb2a53$df97a2a0$9ec6e7e0$@gmail.com>
	<AANLkTim-=LvjumSeyi4N_puJ3cTYyCBJ1m9PU6iGSBJh@mail.gmail.com>
	<000f01cb2a70$9d100e50$d7302af0$@gmail.com>
	<AANLkTi=uSctF=8HXo29Oxa_-TxCPYagVZayO=9aXTzei@mail.gmail.com>
Message-ID: <1341525262133-7580393.post@n2.nabble.com>

The readpartGDAL function by Michael Sumner is simple and helpful for pruning
larger raster/DEM maps. 

Please bear in mind the function code is consistent with a simple and
important assumption behind readGDAL that the data origin from which offset
row and column counting begins to define new dim regions is "usually the
upper left corner." Care is advised since some data sources (e.g. GOTOPO30)
do not conform to the usual assumption.  

The function code needs a simple check to confirm the origin location and
adjust as needed.  When the origin is the lower left, for example, a rev()
statement is needed before the Yaxis sequence named "ys".  The section
commented "brain dead and easy" will easily cause the function to die absent
a control check.

Many thanks to Michael for his original post. 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Import-Part-of-a-GeoTiff-using-readGDAL-rgdal-tp5325799p7580393.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Peter.Ellis at med.govt.nz  Fri Jul  6 05:26:19 2012
From: Peter.Ellis at med.govt.nz (Peter Ellis (Wellington))
Date: Fri, 6 Jul 2012 03:26:19 +0000
Subject: [R-sig-Geo] recentering a map to arbitrary center while keeping
 polygons / nowrapRecenter()
Message-ID: <A468281CDBEF1B4AA50301D9C1E8862320F3B05A@wni2k111.wd.govt.nz>

Hi

I'm trying to recenter a world map without breaking the polygons.  If x1 is a SpatialPolygons or SpatialPolygonsDataFrame object that I have (for example) created from a shapefile then:

	plot(nowrapRecenter(x1))

does exactly what I want, with one exception that by making the boundaries 0 and 360 degrees longitude we end up with the UK on the far right of the map and the rest of Europe on the far left (the "world2" map in the maps package has the same issue).  So what I really want is something that can frame the map left to right with an arbitrary set of horizontal coordinates - say -20 to 340.  

>From reading the help file I would have thought that

	plot(nowrapRecenter(x1, offset=-20))

would do the job, but this does two things that surprise me:  
1) The objects on the map don't shift to the right, relative to when offset=0
2) more scratched polygons appear - apparently from polygons that go across the longitude=0

Reproducible example:

library(maps)
library(maptools)
library(rgeos)
library(rgdal)
library(gpclib)

world <- map("world", fill=TRUE, col="transparent", plot=FALSE)
worldSpP <- map2SpatialPolygons(world, world$names, CRS("+proj=longlat"))

# remove incomplete polygons that go over the offset
worldSpP <- worldSpP[-grep("Greenland", row.names(worldSpP)),]
worldSpP <- worldSpP[-grep("Iceland", row.names(worldSpP)),]
worldSpP <- worldSpP[-grep("Antarctica", row.names(worldSpP)),]
worldSpPnr <- nowrapRecenter(worldSpP, offset=-20)
plot(worldSpPnr, col=colors())

My very basic guess of what might be going wrong is that nowrapRecenter has basically done what it intends to, but the plot method is still trying to draw the map from 0 to 360.  However, fixing this goes beyond my troubleshooting powers.


Alternatively, there's two different answers on StackOverflow that will redraw a world map with an arbitrary center very neatly (one using ggplot2 and one using sp), but in both cases the country boundary information is basically lost:
http://stackoverflow.com/questions/10620862/use-different-center-than-the-prime-meridian-in-plotting-a-world-map

So my question reduces to how do I use nowrapRecenter() to center a map arbitrarily; or is there another way to move a world map like that, while keeping country information.

Thanks!

PE



newzealand.govt.nz - connecting you to New Zealand central & local government services

Any opinions expressed in this message are not necessarily those of the Ministry of Business, Innovation and Employment. This message and any files transmitted with it are confidential and solely for the use of the intended recipient. If you are not the intended recipient or the person responsible for delivery to the intended recipient, be advised that you have received this message in error and that any use is strictly prohibited. Please contact the sender and delete the message and any attachment from your computer.


From josesquivel.sm at gmail.com  Fri Jul  6 07:20:03 2012
From: josesquivel.sm at gmail.com (Jocelyn Esquivel)
Date: Fri, 6 Jul 2012 01:20:03 -0400
Subject: [R-sig-Geo] Distance
Message-ID: <CAH46iQutWpHycoxPvyOpQcN41o3pGZi49bMmZbLBt6PniYAKUA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120706/2db188ec/attachment.pl>

From k_jacobi at surf2000.de  Fri Jul  6 10:15:02 2012
From: k_jacobi at surf2000.de (Klaus Jacobi)
Date: Fri, 6 Jul 2012 10:15:02 +0200
Subject: [R-sig-Geo] Conflict of raster package with function SMA of package
	TTR
Message-ID: <7A47CDD1-8B0C-43FF-BA2F-033DCEF8CEAC@surf2000.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120706/c9d38698/attachment.pl>

From marceivissa at gmail.com  Fri Jul  6 11:32:21 2012
From: marceivissa at gmail.com (=?ISO-8859-1?Q?Marc_Mar=ED_Dell=27Olmo?=)
Date: Fri, 6 Jul 2012 11:32:21 +0200
Subject: [R-sig-Geo] How to open and work with an .hdf map
In-Reply-To: <CAOT0YGutKpbu8d=y-Wwpzt72hfsFQBJxFrfWmXkyZNdcO3yMHw@mail.gmail.com>
References: <CAM2w+BrhCLTSUdqZ=gPbRiLQ7vR4qSq2TdS-ZtNGymXEpUqVaQ@mail.gmail.com>
	<CAOT0YGutKpbu8d=y-Wwpzt72hfsFQBJxFrfWmXkyZNdcO3yMHw@mail.gmail.com>
Message-ID: <CAAZSCQ5mU2gXcN8yZbm1XAnUC01XzstoG1wgKz0Lv9XBi3EGSg@mail.gmail.com>

Hello,

I'm trying to open and work with a map I have downloaded from
http://glovis.usgs.gov/, obtained from MODIS Terra satellite. This web
only allows to download maps in .hdf format. I do not have ArcView, a GIS
programme which opens these maps without any problem. I have been trying to
do it using "R", however, I have not succeeded... First, I converted the map
- which is in version 4 - to version 5 (with h4h5tools
http://www.hdfgroup.org/h4toh5). I have tried to open it with satinGet
(library satin) but I have obtained this error message:
Error en queryname(nom.hdf5, what = "date") :
 objeto 'date.str' no encontrado

Finally I managed to open the file using the function hdf5load (library
hdf5). With this function I have obtained two objects   "HDF4_DIMGROUP" ,
"MOD44B_250m_GRID" but I don't know how can I represent spatially the data.
I think I have a grid with the values of the variables but I don't know the
reference of the coordinates (UTM long lat), the distance between the points
of the grid, etc... In general, I don't know how to work with the
information...

I'm using Windows.

Here is the link of the original map, in case it helps.

http://dl.dropbox.com/u/22891835/MOD13Q1NDVI_2012Maig.hdf

Thanks in advance for the help!

Marc


From landis at isciences.com  Fri Jul  6 12:39:18 2012
From: landis at isciences.com (Matthew Landis)
Date: Fri, 06 Jul 2012 06:39:18 -0400
Subject: [R-sig-Geo] How to open and work with an .hdf map
In-Reply-To: <CAAZSCQ5mU2gXcN8yZbm1XAnUC01XzstoG1wgKz0Lv9XBi3EGSg@mail.gmail.com>
References: <CAM2w+BrhCLTSUdqZ=gPbRiLQ7vR4qSq2TdS-ZtNGymXEpUqVaQ@mail.gmail.com>
	<CAOT0YGutKpbu8d=y-Wwpzt72hfsFQBJxFrfWmXkyZNdcO3yMHw@mail.gmail.com>
	<CAAZSCQ5mU2gXcN8yZbm1XAnUC01XzstoG1wgKz0Lv9XBi3EGSg@mail.gmail.com>
Message-ID: <4FF6C056.3000508@isciences.com>

Marc,

It's been a long time since I worked with HDF, so someone out there will 
likely have better suggestions.  But I think you will want to get that 
out of HDF format as fast as possible.  Try using hdp 
(http://www.hdfgroup.org/hdp.html) to dump the file to a binary or ascii 
file and then you should be able to read that in to R using readBin or 
read.delim or such.

There are also hdf viewers at the HDFGroup site that should help you to 
see what the file looks like, figure out the grid, etc.

M

On 7/6/2012 5:32 AM, Marc Mar? Dell'Olmo wrote:
> Hello,
>
> I'm trying to open and work with a map I have downloaded from
> http://glovis.usgs.gov/, obtained from MODIS Terra satellite. This web
> only allows to download maps in .hdf format. I do not have ArcView, a GIS
> programme which opens these maps without any problem. I have been trying to
> do it using "R", however, I have not succeeded... First, I converted the map
> - which is in version 4 - to version 5 (with h4h5tools
> http://www.hdfgroup.org/h4toh5). I have tried to open it with satinGet
> (library satin) but I have obtained this error message:
> Error en queryname(nom.hdf5, what = "date") :
>   objeto 'date.str' no encontrado
>
> Finally I managed to open the file using the function hdf5load (library
> hdf5). With this function I have obtained two objects   "HDF4_DIMGROUP" ,
> "MOD44B_250m_GRID" but I don't know how can I represent spatially the data.
> I think I have a grid with the values of the variables but I don't know the
> reference of the coordinates (UTM long lat), the distance between the points
> of the grid, etc... In general, I don't know how to work with the
> information...
>
> I'm using Windows.
>
> Here is the link of the original map, in case it helps.
>
> http://dl.dropbox.com/u/22891835/MOD13Q1NDVI_2012Maig.hdf
>
> Thanks in advance for the help!
>
> Marc
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
~~~~~~~~~~~~~~~~~~~~~~~~~~
Matthew Landis, Ph.D.
Research Scientist
ISciences, LLC
61 Main St. Suite 200
Burlington VT 05401
802.864.2999
www.isciences.com
~~~~~~~~~~~~~~~~~~~~~~~~~~


From mdsumner at gmail.com  Fri Jul  6 13:32:17 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 6 Jul 2012 21:32:17 +1000
Subject: [R-sig-Geo] How to open and work with an .hdf map
In-Reply-To: <4FF6C056.3000508@isciences.com>
References: <CAM2w+BrhCLTSUdqZ=gPbRiLQ7vR4qSq2TdS-ZtNGymXEpUqVaQ@mail.gmail.com>
	<CAOT0YGutKpbu8d=y-Wwpzt72hfsFQBJxFrfWmXkyZNdcO3yMHw@mail.gmail.com>
	<CAAZSCQ5mU2gXcN8yZbm1XAnUC01XzstoG1wgKz0Lv9XBi3EGSg@mail.gmail.com>
	<4FF6C056.3000508@isciences.com>
Message-ID: <CAAcGz9_OsN7gjw1BRbaKPvti3JkcKA71PMf2r-WKyVS4HanLmg@mail.gmail.com>

Another option is the GDAL tools, if you can deal with the translation
of (potentially) 3+D arrays into GIS-alike raster layers. You'd have
to build your own rgdal with HDF support on Windows (which is hard),
but you can use the GDAL command-line tools that come with an OSGeo4W
installation.

These pages describe the details and usage:

http://www.gdal.org/frmt_hdf4.html
http://www.gdal.org/frmt_hdf5.html

A default gdal_translate will produce a GeoTIFF which can be read
directly by rgdal::readGDAL or raster::raster.

I will try your file if I can.

Cheers, Mike.

On Fri, Jul 6, 2012 at 8:39 PM, Matthew Landis <landis at isciences.com> wrote:
> Marc,
>
> It's been a long time since I worked with HDF, so someone out there will
> likely have better suggestions.  But I think you will want to get that out
> of HDF format as fast as possible.  Try using hdp
> (http://www.hdfgroup.org/hdp.html) to dump the file to a binary or ascii
> file and then you should be able to read that in to R using readBin or
> read.delim or such.
>
> There are also hdf viewers at the HDFGroup site that should help you to see
> what the file looks like, figure out the grid, etc.
>
> M
>
>
> On 7/6/2012 5:32 AM, Marc Mar? Dell'Olmo wrote:
>>
>> Hello,
>>
>> I'm trying to open and work with a map I have downloaded from
>> http://glovis.usgs.gov/, obtained from MODIS Terra satellite. This web
>> only allows to download maps in .hdf format. I do not have ArcView, a GIS
>> programme which opens these maps without any problem. I have been trying
>> to
>> do it using "R", however, I have not succeeded... First, I converted the
>> map
>> - which is in version 4 - to version 5 (with h4h5tools
>> http://www.hdfgroup.org/h4toh5). I have tried to open it with satinGet
>> (library satin) but I have obtained this error message:
>> Error en queryname(nom.hdf5, what = "date") :
>>   objeto 'date.str' no encontrado
>>
>> Finally I managed to open the file using the function hdf5load (library
>> hdf5). With this function I have obtained two objects   "HDF4_DIMGROUP" ,
>> "MOD44B_250m_GRID" but I don't know how can I represent spatially the
>> data.
>> I think I have a grid with the values of the variables but I don't know
>> the
>> reference of the coordinates (UTM long lat), the distance between the
>> points
>> of the grid, etc... In general, I don't know how to work with the
>> information...
>>
>> I'm using Windows.
>>
>> Here is the link of the original map, in case it helps.
>>
>> http://dl.dropbox.com/u/22891835/MOD13Q1NDVI_2012Maig.hdf
>>
>> Thanks in advance for the help!
>>
>> Marc
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> --
> ~~~~~~~~~~~~~~~~~~~~~~~~~~
> Matthew Landis, Ph.D.
> Research Scientist
> ISciences, LLC
> 61 Main St. Suite 200
> Burlington VT 05401
> 802.864.2999
> www.isciences.com
> ~~~~~~~~~~~~~~~~~~~~~~~~~~
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From babuawara at gmail.com  Fri Jul  6 13:59:23 2012
From: babuawara at gmail.com (Vikram Ranga)
Date: Fri, 06 Jul 2012 13:59:23 +0200
Subject: [R-sig-Geo] How to open and work with an .hdf map
In-Reply-To: <4FF6C056.3000508@isciences.com>
References: <CAM2w+BrhCLTSUdqZ=gPbRiLQ7vR4qSq2TdS-ZtNGymXEpUqVaQ@mail.gmail.com>
	<CAOT0YGutKpbu8d=y-Wwpzt72hfsFQBJxFrfWmXkyZNdcO3yMHw@mail.gmail.com>
	<CAAZSCQ5mU2gXcN8yZbm1XAnUC01XzstoG1wgKz0Lv9XBi3EGSg@mail.gmail.com>
	<4FF6C056.3000508@isciences.com>
Message-ID: <4FF6D31B.1010209@gmail.com>

Hello Marc,
I have used HEG tool to convert *.hdf files to *.geotiff. I found it 
very easy here is the link
http://hdfeos.org/software/heg.php/
though, you can also use FWTools. Here is the example how to do that in 
FWTool which is link of earlier conversation on the same topic.
http://r-sig-geo.2731867.n2.nabble.com/Antw-Antw-Re-HDF-format-td7236416.html#a7237481, 
see the last conversation in the list.

HTH,
Cheers,

Vikram.
On 7/6/2012 12:39 PM, Matthew Landis wrote:
> Marc,
>
> It's been a long time since I worked with HDF, so someone out there 
> will likely have better suggestions.  But I think you will want to get 
> that out of HDF format as fast as possible.  Try using hdp 
> (http://www.hdfgroup.org/hdp.html) to dump the file to a binary or 
> ascii file and then you should be able to read that in to R using 
> readBin or read.delim or such.
>
> There are also hdf viewers at the HDFGroup site that should help you 
> to see what the file looks like, figure out the grid, etc.
>
> M
>
> On 7/6/2012 5:32 AM, Marc Mar? Dell'Olmo wrote:
>> Hello,
>>
>> I'm trying to open and work with a map I have downloaded from
>> http://glovis.usgs.gov/, obtained from MODIS Terra satellite. This web
>> only allows to download maps in .hdf format. I do not have ArcView, a 
>> GIS
>> programme which opens these maps without any problem. I have been 
>> trying to
>> do it using "R", however, I have not succeeded... First, I converted 
>> the map
>> - which is in version 4 - to version 5 (with h4h5tools
>> http://www.hdfgroup.org/h4toh5). I have tried to open it with satinGet
>> (library satin) but I have obtained this error message:
>> Error en queryname(nom.hdf5, what = "date") :
>>   objeto 'date.str' no encontrado
>>
>> Finally I managed to open the file using the function hdf5load (library
>> hdf5). With this function I have obtained two objects "HDF4_DIMGROUP" ,
>> "MOD44B_250m_GRID" but I don't know how can I represent spatially the 
>> data.
>> I think I have a grid with the values of the variables but I don't 
>> know the
>> reference of the coordinates (UTM long lat), the distance between the 
>> points
>> of the grid, etc... In general, I don't know how to work with the
>> information...
>>
>> I'm using Windows.
>>
>> Here is the link of the original map, in case it helps.
>>
>> http://dl.dropbox.com/u/22891835/MOD13Q1NDVI_2012Maig.hdf
>>
>> Thanks in advance for the help!
>>
>> Marc
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Tom_Roche at pobox.com  Fri Jul  6 17:39:14 2012
From: Tom_Roche at pobox.com (Tom Roche)
Date: Fri, 06 Jul 2012 11:39:14 -0400
Subject: [R-sig-Geo] How to open and work with an .hdf map
In-Reply-To: <CAAZSCQ5mU2gXcN8yZbm1XAnUC01XzstoG1wgKz0Lv9XBi3EGSg@mail.gmail.com>
References: <CAAZSCQ5mU2gXcN8yZbm1XAnUC01XzstoG1wgKz0Lv9XBi3EGSg@mail.gmail.com>
Message-ID: <87a9zcq4pp.fsf@pobox.com>


Marc Mar? Dell'Olmo Fri, 6 Jul 2012 11:32:21 +0200
> I'm trying to open and work with a map I have downloaded from
> http://glovis.usgs.gov/, obtained from MODIS Terra satellite. This
> web only allows to download maps in .hdf format. [...] I don't know
> how can I represent spatially the data.

I haven't used it, but have "heard good things" about Panoply

http://www.giss.nasa.gov/tools/panoply/

which has a binary for windows.

HTH, Tom Roche <Tom_Roche at pobox.com>


From smithtiffanyt at gmail.com  Fri Jul  6 22:41:29 2012
From: smithtiffanyt at gmail.com (tiffanysmith)
Date: Fri, 6 Jul 2012 13:41:29 -0700 (PDT)
Subject: [R-sig-Geo] Extract values from RasterBrick using lat/lon
Message-ID: <1341607289301-7580402.post@n2.nabble.com>

Hello,

I have imported my data as a RasterBrick and am trying to extract a
timeseries from a location within the larger extent. I have the lat/lon of
the location, so is there a way for me to use the 'extract' command (or
something else?) to get the time series from my RasterBrick at the gridcell
closest to my lat/lon point?

Thanks,
Tiffany

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Extract-values-from-RasterBrick-using-lat-lon-tp7580402.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From rpaolo1967 at gmail.com  Sat Jul  7 13:44:37 2012
From: rpaolo1967 at gmail.com (Paolo Ramoni Perazzi)
Date: Sat, 7 Jul 2012 07:14:37 -0430
Subject: [R-sig-Geo] Getting values from fitted variogram
Message-ID: <CANvsoOsB1kMPpL5r_5_aqTrgJHEKqdR==nznzuq1g5VgSRVqYA@mail.gmail.com>

I'm really sorry if this is a very simple question...

Using gstat and given the code:

data(meuse)
vgm1 <- variogram(log(zinc)~1, ~x+y, meuse)
fit.variogram(vgm1, vgm(1,"Sph",300,1))

I wonder if there is a simple way to get the value of "h"
corresponding to a given "gamma(h)"

Thanks a lot!

Paolo R.


From b.rowlingson at lancaster.ac.uk  Sat Jul  7 17:29:10 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 7 Jul 2012 16:29:10 +0100
Subject: [R-sig-Geo] Extract values from RasterBrick using lat/lon
In-Reply-To: <95b0b709685c4983a55f1bd65ce37e1e@EX-0-HT0.lancs.local>
References: <95b0b709685c4983a55f1bd65ce37e1e@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNmhNQfSE=ExDdyXiZRt5L0nSZD_P_D6Z-x42mWgeTL1g@mail.gmail.com>

On Fri, Jul 6, 2012 at 9:41 PM, tiffanysmith <smithtiffanyt at gmail.com> wrote:
> Hello,
>
> I have imported my data as a RasterBrick and am trying to extract a
> timeseries from a location within the larger extent. I have the lat/lon of
> the location, so is there a way for me to use the 'extract' command (or
> something else?) to get the time series from my RasterBrick at the gridcell
> closest to my lat/lon point?

 Have you read the help for extract? It says for extract(x,y)

      x: Raster* object

       y: A vector (representing cell numbers); or a SpatialPoints
          object or a two-column data.frame or matrix (representing
          points); or a ?SpatialPolygons?, ?SpatialLines?, or ?Extent?
          object

And then it says if y is a SpatialPoints object then it extracts the
value at that location. For a brick this gets the values of all the
layers of the brick, which is your time series. Make a SpatialPoints
from your lat-long with SpatialPoints(longitude, latitude) and you're
nearly there:

 > extract(b,SpatialPoints(cbind(0.1,0.2)))
[1] 0.2296313 0.8351380 0.7611164 0.9320771 0.7940506

 You'll have to make sure this is in the right order, maybe you need
to call rev(that) to reverse it.

You can sample multiple points at once to get a matrix:

 > extract(b,SpatialPoints(cbind(c(0.1,.2),c(0.3,.8))))
          [,1]      [,2]      [,3]      [,4]      [,5]
[1,] 0.2296313 0.8351380 0.7611164 0.9320771 0.7940506
[2,] 0.8162665 0.6251411 0.6882939 0.4350877 0.6635630

Barry


From clement.calenge at oncfs.gouv.fr  Sun Jul  8 15:51:15 2012
From: clement.calenge at oncfs.gouv.fr (Clement Calenge)
Date: Sun, 8 Jul 2012 15:51:15 +0200
Subject: [R-sig-Geo] combining UD's in kernel denisty analysis
In-Reply-To: <D416AED6984CEB49A17BFE77601BD59B31B69E89@CHEXMBX1.livad.liv.ac.uk>
References: <D416AED6984CEB49A17BFE77601BD59B31B69E89@CHEXMBX1.livad.liv.ac.uk>
Message-ID: <4FF99053.4080907@oncfs.gouv.fr>

Dear Louise,



[snip]
>> data<-read.csv("three.csv")
>> library(adehabitatHR)
>> gmt<-(data$gmt)
>> data$gmt<-as.POSIXct(strptime(gmt, "%d/%m/%Y%H:%M:%S"))
>> tr=as.ltraj(xy, data$gmt, id, burst = data$Burst, typeII = TRUE, slsp ="remove")
>> lik<-liker(tr, sig2=1, rangesig1=c(10, 100))
>> hrBB<- kernelbb(tr, sig1 =  6, sig2 = 1, grid = 100, byburst=TRUE)
>> hrBB
>> image(hrBB)
>> plot(getverticeshr(hrBB, 95), add=TRUE, lwd=2)
>> plot(getverticeshr(hrBB, 50), add=TRUE, lwd=2)
> Error in plot(getverticeshr(hrBB, 50), add = TRUE, lwd = 2) :
>    error in evaluating the argument 'x' in selecting a method for function 'plot': Error in re[[i]] : subscript out of bounds

It is hard to understand this particular error without any reproducible 
example. I don't know the origin of this particular error, but there are 
other errors in your code. There are several animals/bursts in tr, so 
that if you want to display the home range contour for each animal, you 
should not use plot(?, add=TRUE) after image(hrBB). Rather, you should use:

par(mfrow=n2mfrow(length(hrBB)), mar=c(0,0,2,0))
lapply(1:length(hrBB), function(i) {
     image(hrBB[[i]], main=names(hrBB)[i])
     plot(getverticeshr(hrBB[[i]], 95), add=TRUE, lwd=2)
     plot(getverticeshr(hrBB[[i]], 50), add=TRUE, lwd=2)
})

I am not sure that this will correct your error, but as indicated, it is 
difficult to debug a code without any reproducible example.


[snip]
> # I then try to combine these 4 individual UD?s using the following code
>
> UDs<- lapply(1:length(hrBB), function(i) hrBB[[i]]$UD)

There is a confusion here. There is no component UD in the object of 
class estUD. This kind of code would have been correct with the "old" 
package adehabitat (no longer developed). The newer package adehabitatHR 
uses quite different classes of objects. You should read the vignette of 
adehabitatHR, by typing:

vignette("adehabitatHR")

Also, you should read documentations related to the classes of objects 
of class "SpatialPixelsDataFrame" used by the package sp, on which the 
package relies (the class estUD inherits from this class). Understanding 
these classes may help you to write correct code.


> UDend<- liUD[[1]]
> for (i in 2:length(liUD))
> UDend<- UDend + liUD[[i]]
> nlocs<- unlist(lapply(1:length(tr), function(i) nrow(tr[[i]])))
> wi<- nlocs/sum(nlocs)
> UDt<- UDs[[1]]
> for (i in 2:length(UDs))
> UDt<- UDt+wi[i]*UDs[[i]]
>
> # And also tried:
>
> liUD<- lapply(1:length(tr), function(i) {
> hrBB[[i]]$UD * (nrow(tr[[i]]) / sum(sapply(tr, nrow)))
> })
> UDend<- liUD[[1]]
> for (i in 2:length(liUD))
> UDend<- UDend + liUD[[i]]
>
> But get this error message:
>
> Error in image.default(UDend) : argument must be matrix-like

These errors are caused by the incorrect use of hrBB[[i]]$UD above.
This code would be correct if you had used the package adehabitat 
instead of adehabitatHR. For adehabitatHR, this code should work (not 
tested):

UDend<- hrBB[[1]]
hrBB <- estUDm2spixdf(hrBB)
nlocs <- unlist(lapply(1:length(tr), function(i) nrow(tr[[i]])))
wi <- nlocs/sum(nlocs)
UDend[[1]] <- apply(hrBB at data, 1, function(x) sum(x*nlocs))

However, be careful that the above code averages the UDs of all bursts 
and all animals. It may be sensible to modify this code so that the 
average is calculated for each animal, depending on your aim.
HTH,


Cl?ment Calenge.

-- 
Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From vijayaraghavan at smart.mit.edu  Sun Jul  8 16:13:13 2012
From: vijayaraghavan at smart.mit.edu (Rajagopal Vijayaraghavan)
Date: Sun, 8 Jul 2012 22:13:13 +0800
Subject: [R-sig-Geo] Kernel Density Estimation from a 3D point pattern in
Message-ID: <9143E983-B10E-42A3-95BE-D10F03AAB271@smart.mit.edu>

Hi,

I am interested in spatial statistical analysis at a beginner user level. I am trying to find an existing software that can perform kernel density estimation on a 3d spatial point pattern within a 3d window with "no go" zones, ie regions where no points exist. I have recently found a package called ks in R that does multidimensional kernel smoothing, but I am not able to introduce no go zones. Could someone guide me to another code or a possible mathematical work around for this? 


Thanks in advance

Vijay


From clement.calenge at oncfs.gouv.fr  Sun Jul  8 17:59:11 2012
From: clement.calenge at oncfs.gouv.fr (Clement Calenge)
Date: Sun, 8 Jul 2012 17:59:11 +0200
Subject: [R-sig-Geo] error: subscript out of bounds using getverticeshr
In-Reply-To: <CAK5WTcFU1ZogjGzB+Kuv3uk-3KEZbUxQrSRsTbcWtYeGFG4HzA@mail.gmail.com>
References: <CAK5WTcFU1ZogjGzB+Kuv3uk-3KEZbUxQrSRsTbcWtYeGFG4HzA@mail.gmail.com>
Message-ID: <4FF9AE4F.4050705@oncfs.gouv.fr>

Hello Melanie


[snip]
> #data is now in proper format to calculate kernelUD for each ID
> #result is a list of elements of class estUD (1 for each replicate)
> kud<-kernelUD(t62spdf,h="href",grid=50,same4all=TRUE,kern=c("bivnorm"))
> kudw<-kernelUD(t62spdfw,h="href",grid=50,same4all=TRUE,kern=c("bivnorm"))
> #get the vertices for the 95% and 50% contours
> ver95<- getverticeshr(kud, lev = 95)  ###########here is where the error

Hard to correct without any reproducible example. This kind of error 
occurs when the required isopleth falls outside the grid used for the 
kernel estimation. For example, this error occurs in the example below 
(just copy and paste):

data(puechabonsp)
loc <- puechabonsp$relocs
ud <- kernelUD(loc[,1], grid=5)
getverticeshr(ud, 30)

The solution is here to increase the size of the grid. In the example 
below, the problem is due to a misspecified grid:

data(puechabonsp)
loc <- puechabonsp$relocs
ud <- kernelUD(loc[,1], grid=5)
gr <- ud[[1]]
ud2 <- kernelUD(loc[,1], grid=gr)
getverticeshr(ud2)

The solution is here to specify another grid. In your case I do not know 
what can cause the problem. Just a guess: you estimate the smoothing 
parameter using the ad hoc method (href). If the distribution of your 
relocations is very different from the expected bivariate normal 
distribution, the home-range contour might be far from the set of 
relocations, and most of the estimated UD might be outside the grid. 
Just an example of this error for a too large href:

df <- data.frame(x=c(rnorm(3), rnorm(3, 10000), rnorm(3, 5000)), 
y=c(rnorm(3), rnorm(3), rnorm(3, 5000)))
ps <- SpatialPoints(df)
plot(ps)
kud <- kernelUD(ps)
image(kud)
ver <- getverticeshr(kud)

If this is the case with your data, try to increase the value of extent 
or to set a smaller value of href in kernelUD (increasing the parameter 
grid won't help here). For this example, using extent=1 allows to 
perform the calculation:

kud <- kernelUD(ps, h="href", extent=1)
image(kud)
ver <- getverticeshr(kud)

Although h="href" is clearly a poor choice in this case.

HTH,

Cl?ment Calenge.
-- 

Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From e.jahanshiri at gmail.com  Mon Jul  9 03:44:51 2012
From: e.jahanshiri at gmail.com (Ebrahim Jahanshiri)
Date: Mon, 9 Jul 2012 09:44:51 +0800
Subject: [R-sig-Geo] Getting values from fitted variogram
Message-ID: <CANCB45udNmGuSa8e4eb1t6FRuH9V+b97JEGzfQhAoMamr+3kjQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120709/b8cb47a7/attachment.pl>

From marceivissa at gmail.com  Mon Jul  9 11:22:34 2012
From: marceivissa at gmail.com (=?ISO-8859-1?Q?Marc_Mar=ED_Dell=27Olmo?=)
Date: Mon, 9 Jul 2012 11:22:34 +0200
Subject: [R-sig-Geo] How to open and work with an .hdf map
In-Reply-To: <87a9zcq4pp.fsf@pobox.com>
References: <CAAZSCQ5mU2gXcN8yZbm1XAnUC01XzstoG1wgKz0Lv9XBi3EGSg@mail.gmail.com>
	<87a9zcq4pp.fsf@pobox.com>
Message-ID: <CAAZSCQ6hd+BZpiiavDS0dOPphFsKbQx-gGauxNNHtPnHwejHuQ@mail.gmail.com>

Thank you very much. I'm going to try to convert in a geotiff with
some of the mentioned programs. I have never used this type of format,
is it only an image? or can I obtain also the data of the variable
represented with the geotiff?

Marc

2012/7/6 Tom Roche <Tom_Roche at pobox.com>:
>
> Marc Mar? Dell'Olmo Fri, 6 Jul 2012 11:32:21 +0200
>> I'm trying to open and work with a map I have downloaded from
>> http://glovis.usgs.gov/, obtained from MODIS Terra satellite. This
>> web only allows to download maps in .hdf format. [...] I don't know
>> how can I represent spatially the data.
>
> I haven't used it, but have "heard good things" about Panoply
>
> http://www.giss.nasa.gov/tools/panoply/
>
> which has a binary for windows.
>
> HTH, Tom Roche <Tom_Roche at pobox.com>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From lyolya at gmail.com  Mon Jul  9 13:58:15 2012
From: lyolya at gmail.com (Lyolya)
Date: Mon, 9 Jul 2012 13:58:15 +0200
Subject: [R-sig-Geo] SpatialLines from SpatialLinesDataFrame
Message-ID: <CA+1Vxx1Bh+U19VgBbSA+06JisRZkSHbXdc31CuEyHRMqPFRVBQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120709/a8e7c24e/attachment.pl>

From Roger.Bivand at nhh.no  Mon Jul  9 14:16:06 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 9 Jul 2012 14:16:06 +0200 (CEST)
Subject: [R-sig-Geo] SpatialLines from SpatialLinesDataFrame
In-Reply-To: <CA+1Vxx1Bh+U19VgBbSA+06JisRZkSHbXdc31CuEyHRMqPFRVBQ@mail.gmail.com>
References: <CA+1Vxx1Bh+U19VgBbSA+06JisRZkSHbXdc31CuEyHRMqPFRVBQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1207091407360.12379@reclus.nhh.no>

On Mon, 9 Jul 2012, Lyolya wrote:

> Dear List,
>
> I am trying to create a map for a SpatialPointsDataFrame object (package
> sp), and I want to use some lines as a layout for my plot. I use the
> function spplot and its argument sp.layout for the purpose. The point is, I
> cannot figure out how to retrieve a SpatialLines object from a
> SpatialLinesDataFrame that I got. I.e, I try to do the following:
>
> #points_object - a SpatialPointsDataFrame
> #lines_object - a SpatialLines object
> #lines_data_frame - a SpatialLinesDataFrame
>
> spplot(points_object, cuts, sp.layout=list("sp.lines", lines_object), main)
>
> and the problem is that I don't know how to derive the lines_object from
> the lines_data_frame. I have already tried the options:
>
> lines_object <- as.SpatialLines.SLDF(lines_data_frame)

Where did you get that from? These are all S4 classes, so the coercion 
method is:

as(lines_data_frame, "SpatialLines")

However, you probably do not need to do anything, as the sp.layout 
"sp.lines" function takes objects which can be coerced to SpatialLines, 
including SpatialLinesDataFrame.

Roger

>
> and
>
> p.layout=list("sp.lines", lines_data_frame at lines)
>
> but none of these works for the plot.
>
> Could you please indicate me how I could make it work?
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gianni.lavaredo at gmail.com  Mon Jul  9 14:54:52 2012
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 9 Jul 2012 14:54:52 +0200
Subject: [R-sig-Geo] Surface Interpolation method for DEM point retrived by
 Terrestrial Laser Scanning after a outlier removing procedure
Message-ID: <CAJ6JbR9Eck6tenfGmw2QABskNuzREnQn5nXX4t5yghWjxHfkbQ@mail.gmail.com>

Dear Researchers,

I wrote a code in R to processing around 1.2 GB of laser data derived by a
Terrestrial Laser Scanning in a forested area. There are few techniques to
derive a DEM from the ground points. One is create a grid of 0.5 x 0.5 m
and give for each pixel the minimum Z value of the points inside the voxel
(0.5 x 0.5 m by the Hmax of vegetation). Normally,  In this ground points
there are a component of outlier. The normal techniques proposed are:


[image: Inline image 1]



1. remove manually
2. special filter based on the angle of neighboured points
3 . RANSAC

 I used locoutNeighbor of library(mvoutlie) with good result using these
set parametrs:

Myres <-
locoutNeighbor(as.matrix(ppZmin.df.clean$z),ppZmin.df.clean$x,ppZmin.df.clean$y,
    variant="knn",
    usemax=1,
    chisqqu=0.999,
    propneighb=1,npoints=nrow(ppZmin.df.clean))


I just make some try yesterday night

[image: Inline image 2]

I am interest to comapre on my data more Outlier removing techniques and
any suggest is really appreciate

Thanks in advance
Gianni
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120709/7029d728/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 12004 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120709/7029d728/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11998 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120709/7029d728/attachment-0001.png>

From jon.skoien at jrc.ec.europa.eu  Mon Jul  9 16:30:13 2012
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Mon, 09 Jul 2012 16:30:13 +0200
Subject: [R-sig-Geo] Getting values from fitted variogram
In-Reply-To: <CANCB45udNmGuSa8e4eb1t6FRuH9V+b97JEGzfQhAoMamr+3kjQ@mail.gmail.com>
References: <CANCB45udNmGuSa8e4eb1t6FRuH9V+b97JEGzfQhAoMamr+3kjQ@mail.gmail.com>
Message-ID: <4FFAEAF5.40305@jrc.ec.europa.eu>

Paolo,

variogramLine can give you the semivariogram values from your variogram 
model for any distance:
 > vm = fit.variogram(vgm1, vgm(1,"Sph",300,1))
 > variogramLine(vm, dist_vector = seq(100,1000,100))

Cheers,
Jon

On 09-Jul-12 3:44, Ebrahim Jahanshiri wrote:
> hi, if it helps, I think if you put vgm1 itself you will get a table like
> this :
>> vgm1
>      np       dist     gamma dir.hor dir.ver   id
> 1   57   79.29244 0.1234479       0       0 var1
> 2  299  163.97367 0.2162185       0       0 var1
> 3  419  267.36483 0.3027859       0       0 var1
> 4  457  372.73542 0.4121448       0       0 var1
> 5  547  478.47670 0.4634128       0       0 var1
> 6  533  585.34058 0.5646933       0       0 var1
> 7  574  693.14526 0.5689683       0       0 var1
> 8  564  796.18365 0.6186769       0       0 var1
> 9  589  903.14650 0.6471479       0       0 var1
> 10 543 1011.29177 0.6915705       0       0 var1
> 11 500 1117.86235 0.7033984       0       0 var1
> 12 477 1221.32810 0.6038770       0       0 var1
> 13 452 1329.16407 0.6517158       0       0 var1
> 14 457 1437.25620 0.5665318       0       0 var1
> 15 415 1543.20248 0.5748227       0       0 var1
>
> that contains the value of gamma (the average for each distance) and other
> information. But these are exprimental semivariances. The models fit will
> produce continuous gamma for the prediction purpose that I think are not as
> important .
>
> Date: Sat, 7 Jul 2012 07:14:37 -0430
> From: Paolo Ramoni Perazzi <rpaolo1967 at gmail.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Getting values from fitted variogram
> Message-ID:
>          <CANvsoOsB1kMPpL5r_5_aqTrgJHEKqdR==nznzuq1g5VgSRVqYA at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> I'm really sorry if this is a very simple question...
>
> Using gstat and given the code:
>
> data(meuse)
> vgm1 <- variogram(log(zinc)~1, ~x+y, meuse)
> fit.variogram(vgm1, vgm(1,"Sph",300,1))
>
> I wonder if there is a simple way to get the value of "h"
> corresponding to a given "gamma(h)"
>
> Thanks a lot!
>
> Paolo R.
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Land Resource Management Unit

Via Fermi 2749, TP 440,  I-21027 Ispra (VA), ITALY

jon.skoien at jrc.ec.europa.eu
Tel:  +39 0332 789206

Disclaimer: Views expressed in this email are those of the individual and do not necessarily represent official views of the European Commission.


From aletsia83 at yahoo.it  Mon Jul  9 21:46:31 2012
From: aletsia83 at yahoo.it (aletsia83)
Date: Mon, 9 Jul 2012 12:46:31 -0700 (PDT)
Subject: [R-sig-Geo] semivariogram calculation - discrepancy between gls
	and gstat
In-Reply-To: <467660.65846.qm@web30803.mail.mud.yahoo.com>
References: <920989.29900.qm@web30805.mail.mud.yahoo.com>
	<4C32DA7E.1040800@uni-muenster.de>
	<467660.65846.qm@web30803.mail.mud.yahoo.com>
Message-ID: <1341863191461-7580415.post@n2.nabble.com>

Hello.

First of all I'd like to thank you both for posting about this topic. I
helped me a lot to understand how the Variogram function works.

Nevertheless, I still have some problems with my data. When I run the
Variogram function on my mixed-effect model, the plot I get shows some
points above the variance=1 threshold. The points actually go all the way to
1.2 (value on the y axis). Any idea of why this is happening?

Alessia Uboni
aletsia83 at yahoo.it

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/semivariogram-calculation-discrepancy-between-gls-and-gstat-tp5257721p7580415.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From eddycaetano at yahoo.com.br  Tue Jul 10 01:01:15 2012
From: eddycaetano at yahoo.com.br (Edmundo Caetano)
Date: Mon, 9 Jul 2012 16:01:15 -0700 (PDT)
Subject: [R-sig-Geo] Anova using CAR and SAR models
Message-ID: <1341874875.82285.YahooMailNeo@web160305.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120709/ddda9e30/attachment.pl>

From thi_veloso at yahoo.com.br  Tue Jul 10 14:02:58 2012
From: thi_veloso at yahoo.com.br (Thiago Veloso)
Date: Tue, 10 Jul 2012 05:02:58 -0700 (PDT)
Subject: [R-sig-Geo] Odd NA value of a netcdf raster
Message-ID: <1341921778.83387.YahooMailNeo@web121902.mail.ne1.yahoo.com>

? Dear R colleagues,

? I am facing troubles with NA values in a netcdf written by raster package. NA values are written as a underscore (_) in the netcdf file. I try to control the values by using "NAflag", but it still doesn't work. Below I am pasting the code used to repdoduce the problem. The following files need to be downloaded to run the code:?https://www.dropbox.com/s/cou3jm7rm6pb1ne/vegtype.nc (0.99MB) and?https://www.dropbox.com/s/i63zd4n0wcr1sma/gcrop.1700.txt?(2.2MB)

library(maptools)
library(raster)

# Load mask. It will be used later
vegtype <- raster("/home/thiago/Dropbox/IBIS_vegmap/deforestation/data/vegtype.nc",crs='NA')

# Load ESRI ascii file
asc <- readAsciiGrid('/home/thiago/Dropbox/web/gcrop.1700.txt', as.image=FALSE)

# Convert to raster
r <- raster(asc)

# Apply mask. This is where NA values appear
r.masked <- mask (x=r, mask=vegtype)

# Save to NETCDF
writeRaster(r.masked, '/home/thiago/Desktop/gcrop.nc', format='CDF', overwrite=T, NAflag=-9999)



? A closer inspection of the final netcdf reveals that NA values are written in a odd way. This is the output yielded by ncdump:




thiago at pocoar:~/deforestation-experiments/input/transition$ ncdump ~/Desktop/gcrop.nc | more

netcdf gcrop {
dimensions:
longitude = 720 ;
latitude = 360 ;
variables:
double longitude(longitude) ;
longitude:units = "degrees_east" ;
double latitude(latitude) ;
latitude:units = "degrees_north" ;
float variable(latitude, longitude) ;
variable:units = ?;
variable:missing_value = -3.4e+38f ;
variable:_FillValue = -3.4e+38f ;
variable:long_name = "variable" ;
variable:min = 0.f ;
variable:max = 0.955328f ;

// global attributes:
:Conventions = "CF-1.4" ;
:created_by = "R, packages ncdf and raster (version 2.0-08)" ;
:date = "2012-07-10 08:39:58" ;
data:

?longitude = -179.75, -179.25, -178.75, -178.25, -177.75, -177.25, -176.75,?
? ? -176.25, -175.75, -175.25, -174.75, -174.25, -173.75, -173.25, -172.75,?
? ? -172.25, -171.75, -171.25, -170.75, -170.25, -169.75, -169.25, -168.75,?
? ? -168.25, -167.75, -167.25, -166.75, -166.25, -165.75, -165.25, -164.75,?
? ? -164.25, -163.75, -163.25, -162.75, -162.25, -161.75, -161.25, -160.75,?
? ? -160.25, -159.75, -159.25, -158.75, -158.25, -157.75, -157.25, -156.75,?
? ? -156.25, -155.75, -155.25, -154.75, -154.25, -153.75, -153.25, -152.75,?
? ? -152.25, -151.75, -151.25, -150.75, -150.25, -149.75, -149.25, -148.75,?
? ? -148.25, -147.75, -147.25, -146.75, -146.25, -145.75, -145.25, -144.75,?
? ? -144.25, -143.75, -143.25, -142.75, -142.25, -141.75, -141.25, -140.75,?
? ? -140.25, -139.75, -139.25, -138.75, -138.25, -137.75, -137.25, -136.75,?
? ? -136.25, -135.75, -135.25, -134.75, -134.25, -133.75, -133.25, -132.75,?
? ? -132.25, -131.75, -131.25, -130.75, -130.25, -129.75, -129.25, -128.75,?
? ? -128.25, -127.75, -127.25, -126.75, -126.25, -125.75, -125.25, -124.75,?
? ? -124.25, -123.75, -123.25, -122.75, -122.25, -121.75, -121.25, -120.75,?
? ? -120.25, -119.75, -119.25, -118.75, -118.25, -117.75, -117.25, -116.75,?
? ? -116.25, -115.75, -115.25, -114.75, -114.25, -113.75, -113.25, -112.75,?
? ? -112.25, -111.75, -111.25, -110.75, -110.25, -109.75, -109.25, -108.75,?
? ? -108.25, -107.75, -107.25, -106.75, -106.25, -105.75, -105.25, -104.75,?
? ? -104.25, -103.75, -103.25, -102.75, -102.25, -101.75, -101.25, -100.75,?
? ? -100.25, -99.75, -99.25, -98.75, -98.25, -97.75, -97.25, -96.75, -96.25,?
? ? -95.75, -95.25, -94.75, -94.25, -93.75, -93.25, -92.75, -92.25, -91.75,?
? ? -91.25, -90.75, -90.25, -89.75, -89.25, -88.75, -88.25, -87.75, -87.25,?
? ? -86.75, -86.25, -85.75, -85.25, -84.75, -84.25, -83.75, -83.25, -82.75,?
? ? -82.25, -81.75, -81.25, -80.75, -80.25, -79.75, -79.25, -78.75, -78.25,?
? ? -77.75, -77.25, -76.75, -76.25, -75.75, -75.25, -74.75, -74.25, -73.75,?
? ? -73.25, -72.75, -72.25, -71.75, -71.25, -70.75, -70.25, -69.75, -69.25,?
? ? -68.75, -68.25, -67.75, -67.25, -66.75, -66.25, -65.75, -65.25, -64.75,?
? ? -64.25, -63.75, -63.25, -62.75, -62.25, -61.75, -61.25, -60.75, -60.25,?
? ? -59.75, -59.25, -58.75, -58.25, -57.75, -57.25, -56.75, -56.25, -55.75,?
? ? -55.25, -54.75, -54.25, -53.75, -53.25, -52.75, -52.25, -51.75, -51.25,?
? ? -50.75, -50.25, -49.75, -49.25, -48.75, -48.25, -47.75, -47.25, -46.75,?
? ? -46.25, -45.75, -45.25, -44.75, -44.25, -43.75, -43.25, -42.75, -42.25,?
? ? -41.75, -41.25, -40.75, -40.25, -39.75, -39.25, -38.75, -38.25, -37.75,?
? ? -37.25, -36.75, -36.25, -35.75, -35.25, -34.75, -34.25, -33.75, -33.25,?
? ? -32.75, -32.25, -31.75, -31.25, -30.75, -30.25, -29.75, -29.25, -28.75,?
? ? -28.25, -27.75, -27.25, -26.75, -26.25, -25.75, -25.25, -24.75, -24.25,?
? ? -23.75, -23.25, -22.75, -22.25, -21.75, -21.25, -20.75, -20.25, -19.75,?
? ? -19.25, -18.75, -18.25, -17.75, -17.25, -16.75, -16.25, -15.75, -15.25,?
? ? -14.75, -14.25, -13.75, -13.25, -12.75, -12.25, -11.75, -11.25, -10.75,?
? ? -10.25, -9.75, -9.25, -8.75, -8.25, -7.75, -7.25, -6.75, -6.25, -5.75,?
? ? -5.25, -4.75, -4.25, -3.75, -3.25, -2.75, -2.25, -1.75, -1.25, -0.75,?
? ? -0.25, 0.25, 0.75, 1.25, 1.75, 2.25, 2.75, 3.25, 3.75, 4.25, 4.75, 5.25,?
? ? 5.75, 6.25, 6.75, 7.25, 7.75, 8.25, 8.75, 9.25, 9.75, 10.25, 10.75,?
? ? 11.25, 11.75, 12.25, 12.75, 13.25, 13.75, 14.25, 14.75, 15.25, 15.75,?
? ? 16.25, 16.75, 17.25, 17.75, 18.25, 18.75, 19.25, 19.75, 20.25, 20.75,?
? ? 21.25, 21.75, 22.25, 22.75, 23.25, 23.75, 24.25, 24.75, 25.25, 25.75,?
? ? 26.25, 26.75, 27.25, 27.75, 28.25, 28.75, 29.25, 29.75, 30.25, 30.75,?
? ? 31.25, 31.75, 32.25, 32.75, 33.25, 33.75, 34.25, 34.75, 35.25, 35.75,?
? ? 36.25, 36.75, 37.25, 37.75, 38.25, 38.75, 39.25, 39.75, 40.25, 40.75,?
? ? 41.25, 41.75, 42.25, 42.75, 43.25, 43.75, 44.25, 44.75, 45.25, 45.75,?
? ? 46.25, 46.75, 47.25, 47.75, 48.25, 48.75, 49.25, 49.75, 50.25, 50.75,?
? ? 51.25, 51.75, 52.25, 52.75, 53.25, 53.75, 54.25, 54.75, 55.25, 55.75,?
? ? 56.25, 56.75, 57.25, 57.75, 58.25, 58.75, 59.25, 59.75, 60.25, 60.75,?
? ? 61.25, 61.75, 62.25, 62.75, 63.25, 63.75, 64.25, 64.75, 65.25, 65.75,?
? ? 66.25, 66.75, 67.25, 67.75, 68.25, 68.75, 69.25, 69.75, 70.25, 70.75,?
? ? 71.25, 71.75, 72.25, 72.75, 73.25, 73.75, 74.25, 74.75, 75.25, 75.75,?
? ? 76.25, 76.75, 77.25, 77.75, 78.25, 78.75, 79.25, 79.75, 80.25, 80.75,?
? ? 81.25, 81.75, 82.25, 82.75, 83.25, 83.75, 84.25, 84.75, 85.25, 85.75,?
? ? 86.25, 86.75, 87.25, 87.75, 88.25, 88.75, 89.25, 89.75, 90.25, 90.75,?
? ? 91.25, 91.75, 92.25, 92.75, 93.25, 93.75, 94.25, 94.75, 95.25, 95.75,?
? ? 96.25, 96.75, 97.25, 97.75, 98.25, 98.75, 99.25, 99.75, 100.25, 100.75,?
? ? 101.25, 101.75, 102.25, 102.75, 103.25, 103.75, 104.25, 104.75, 105.25,?
? ? 105.75, 106.25, 106.75, 107.25, 107.75, 108.25, 108.75, 109.25, 109.75,?
? ? 110.25, 110.75, 111.25, 111.75, 112.25, 112.75, 113.25, 113.75, 114.25,?
? ? 114.75, 115.25, 115.75, 116.25, 116.75, 117.25, 117.75, 118.25, 118.75,?
? ? 119.25, 119.75, 120.25, 120.75, 121.25, 121.75, 122.25, 122.75, 123.25,?
? ? 123.75, 124.25, 124.75, 125.25, 125.75, 126.25, 126.75, 127.25, 127.75,?
? ? 128.25, 128.75, 129.25, 129.75, 130.25, 130.75, 131.25, 131.75, 132.25,?
? ? 132.75, 133.25, 133.75, 134.25, 134.75, 135.25, 135.75, 136.25, 136.75,?
? ? 137.25, 137.75, 138.25, 138.75, 139.25, 139.75, 140.25, 140.75, 141.25,?
? ? 141.75, 142.25, 142.75, 143.25, 143.75, 144.25, 144.75, 145.25, 145.75,?
? ? 146.25, 146.75, 147.25, 147.75, 148.25, 148.75, 149.25, 149.75, 150.25,?
? ? 150.75, 151.25, 151.75, 152.25, 152.75, 153.25, 153.75, 154.25, 154.75,?
? ? 155.25, 155.75, 156.25, 156.75, 157.25, 157.75, 158.25, 158.75, 159.25,?
? ? 159.75, 160.25, 160.75, 161.25, 161.75, 162.25, 162.75, 163.25, 163.75,?
? ? 164.25, 164.75, 165.25, 165.75, 166.25, 166.75, 167.25, 167.75, 168.25,?
? ? 168.75, 169.25, 169.75, 170.25, 170.75, 171.25, 171.75, 172.25, 172.75,?
? ? 173.25, 173.75, 174.25, 174.75, 175.25, 175.75, 176.25, 176.75, 177.25,?
? ? 177.75, 178.25, 178.75, 179.25, 179.75 ;

?latitude = 89.75, 89.25, 88.75, 88.25, 87.75, 87.25, 86.75, 86.25, 85.75,?
? ? 85.25, 84.75, 84.25, 83.75, 83.25, 82.75, 82.25, 81.75, 81.25, 80.75,?
? ? 80.25, 79.75, 79.25, 78.75, 78.25, 77.75, 77.25, 76.75, 76.25, 75.75,?
? ? 75.25, 74.75, 74.25, 73.75, 73.25, 72.75, 72.25, 71.75, 71.25, 70.75,?
? ? 70.25, 69.75, 69.25, 68.75, 68.25, 67.75, 67.25, 66.75, 66.25, 65.75,?
? ? 65.25, 64.75, 64.25, 63.75, 63.25, 62.75, 62.25, 61.75, 61.25, 60.75,?
? ? 60.25, 59.75, 59.25, 58.75, 58.25, 57.75, 57.25, 56.75, 56.25, 55.75,?
? ? 55.25, 54.75, 54.25, 53.75, 53.25, 52.75, 52.25, 51.75, 51.25, 50.75,?
? ? 50.25, 49.75, 49.25, 48.75, 48.25, 47.75, 47.25, 46.75, 46.25, 45.75,?
? ? 45.25, 44.75, 44.25, 43.75, 43.25, 42.75, 42.25, 41.75, 41.25, 40.75,?
? ? 40.25, 39.75, 39.25, 38.75, 38.25, 37.75, 37.25, 36.75, 36.25, 35.75,?
? ? 35.25, 34.75, 34.25, 33.75, 33.25, 32.75, 32.25, 31.75, 31.25, 30.75,?
? ? 30.25, 29.75, 29.25, 28.75, 28.25, 27.75, 27.25, 26.75, 26.25, 25.75,?
? ? 25.25, 24.75, 24.25, 23.75, 23.25, 22.75, 22.25, 21.75, 21.25, 20.75,?
? ? 20.25, 19.75, 19.25, 18.75, 18.25, 17.75, 17.25, 16.75, 16.25, 15.75,?
? ? 15.25, 14.75, 14.25, 13.75, 13.25, 12.75, 12.25, 11.75, 11.25, 10.75,?
? ? 10.25, 9.75, 9.25, 8.75, 8.25, 7.75, 7.25, 6.75, 6.25, 5.75, 5.25, 4.75,?
? ? 4.25, 3.75, 3.25, 2.75, 2.25, 1.75, 1.25, 0.75, 0.25, -0.25, -0.75,?
? ? -1.25, -1.75, -2.25, -2.75, -3.25, -3.75, -4.25, -4.75, -5.25, -5.75,?
? ? -6.25, -6.75, -7.25, -7.75, -8.25, -8.75, -9.25, -9.75, -10.25, -10.75,?
? ? -11.25, -11.75, -12.25, -12.75, -13.25, -13.75, -14.25, -14.75, -15.25,?
? ? -15.75, -16.25, -16.75, -17.25, -17.75, -18.25, -18.75, -19.25, -19.75,?
? ? -20.25, -20.75, -21.25, -21.75, -22.25, -22.75, -23.25, -23.75, -24.25,?
? ? -24.75, -25.25, -25.75, -26.25, -26.75, -27.25, -27.75, -28.25, -28.75,?
? ? -29.25, -29.75, -30.25, -30.75, -31.25, -31.75, -32.25, -32.75, -33.25,?
? ? -33.75, -34.25, -34.75, -35.25, -35.75, -36.25, -36.75, -37.25, -37.75,?
? ? -38.25, -38.75, -39.25, -39.75, -40.25, -40.75, -41.25, -41.75, -42.25,?
? ? -42.75, -43.25, -43.75, -44.25, -44.75, -45.25, -45.75, -46.25, -46.75,?
? ? -47.25, -47.75, -48.25, -48.75, -49.25, -49.75, -50.25, -50.75, -51.25,?
? ? -51.75, -52.25, -52.75, -53.25, -53.75, -54.25, -54.75, -55.25, -55.75,?
? ? -56.25, -56.75, -57.25, -57.75, -58.25, -58.75, -59.25, -59.75, -60.25,?
? ? -60.75, -61.25, -61.75, -62.25, -62.75, -63.25, -63.75, -64.25, -64.75,?
? ? -65.25, -65.75, -66.25, -66.75, -67.25, -67.75, -68.25, -68.75, -69.25,?
? ? -69.75, -70.25, -70.75, -71.25, -71.75, -72.25, -72.75, -73.25, -73.75,?
? ? -74.25, -74.75, -75.25, -75.75, -76.25, -76.75, -77.25, -77.75, -78.25,?
? ? -78.75, -79.25, -79.75, -80.25, -80.75, -81.25, -81.75, -82.25, -82.75,?
? ? -83.25, -83.75, -84.25, -84.75, -85.25, -85.75, -86.25, -86.75, -87.25,?
? ? -87.75, -88.25, -88.75, -89.25, -89.75 ;

?variable =
? _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _,?
? ? _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _,?
? ? _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _,?
? ? _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _,?
? ? _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _,?
? ? _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _,?
? ? _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _,?
? ? _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _, _,?
? <and so on>

? As seen above, NA values are said to be "-3.4e+38f" ?in the header, but in the body of the file they are written as underscores ("_").?

? Does anyone know how to change this and set NA values as, for example, -9999?

? Many thanks in advance,
? Thiago.



From aortizbobea at arec.umd.edu  Tue Jul 10 16:53:05 2012
From: aortizbobea at arec.umd.edu (Ariel Ortiz-Bobea)
Date: Tue, 10 Jul 2012 07:53:05 -0700 (PDT)
Subject: [R-sig-Geo] virtual memory and raster package
Message-ID: <1341931985380-7580420.post@n2.nabble.com>

Hello,

My general goal is to compute the share of cropland in each 0.125 deg grid
in the US. I have a large land cover raster for each state and I reclassify
into 0 and 1 for non-crop/crop. The 0.125deg grid corresponds to another
dataset that I will be using and I want to use the cropland information for
weighting.

To achieve this I:

1- rasterize the 0.125 polygon grid for each state so that i matches the
extent and resolution of the cropland layer raster. (I also proceed to break
up the the polygons into pieces and run rasterize in parallel with mclapply
on a Mac, it's about 60% faster).

2- use the zonal() function with the stat "sum" to get the total number of
"pixels" of cropland in each 0.125deg zone (corresponding to the polygon
grid mentioned above).

It seems that this strategy is faster than using extract() as I believe
Roger Bivand pointed out in a previous thread. However, when I run this code
(with Rscript from the console) I can see my hard disk space decrease
rapidly and after a couple of States have been processed I'm out of HD space
and so the code crashes. When I reboot the computer the free disk space is
restored at its initial level (~110GB) and I'm able to run the code again
for a couple of more states.

I would like to avoid this "leaking" to run the code at once without having
to reboot the computer.

Any ideas or suggestions would be greatly appreciated!

Ariel


-----
Ariel Ortiz-Bobea
PhD Candidate in Agricultural & Resource Economics
University of Maryland - College Park
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/virtual-memory-and-raster-package-tp7580420.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mathieu.rajerison at gmail.com  Wed Jul 11 11:48:53 2012
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Wed, 11 Jul 2012 11:48:53 +0200
Subject: [R-sig-Geo] Conflict of raster package with function SMA of
 package TTR
In-Reply-To: <7A47CDD1-8B0C-43FF-BA2F-033DCEF8CEAC@surf2000.de>
References: <7A47CDD1-8B0C-43FF-BA2F-033DCEF8CEAC@surf2000.de>
Message-ID: <CAGfc75mGPUFnfyStLKAZbHhb_oHM8s--spzyFDBiha6E3T37YQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120711/74517e8d/attachment.pl>

From mathieu.rajerison at gmail.com  Wed Jul 11 11:53:45 2012
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Wed, 11 Jul 2012 11:53:45 +0200
Subject: [R-sig-Geo] Distance
In-Reply-To: <CAH46iQutWpHycoxPvyOpQcN41o3pGZi49bMmZbLBt6PniYAKUA@mail.gmail.com>
References: <CAH46iQutWpHycoxPvyOpQcN41o3pGZi49bMmZbLBt6PniYAKUA@mail.gmail.com>
Message-ID: <CAGfc75mtDyeOARdKOLNHBEGngHAP5v1TY713BaNps-CXMtkKPw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120711/2cb2c16b/attachment.pl>

From bart at njn.nl  Wed Jul 11 15:23:59 2012
From: bart at njn.nl (Bart)
Date: Wed, 11 Jul 2012 15:23:59 +0200
Subject: [R-sig-Geo] zlim and plot in raster
Message-ID: <4FFD7E6F.9050709@njn.nl>

hi

I just noted that zlim does adjust the legend but not the colors causing 
the legend to not match the colors.

example:

require(raster)
par(mfrow=1:2)
plot(a<-raster(matrix(runif(100),ncol=10)))
plot(a, zlim=c(0,10))

This is problem when one tries to create multiple plots with a matching 
legend.

I'm not sure if zlim is suppose to work but i think it should then issue 
a warning or error but not plot something with a wrong legend

Bart


From simeon.mangoti at hotmail.com  Wed Jul 11 16:00:26 2012
From: simeon.mangoti at hotmail.com (Simeon)
Date: Wed, 11 Jul 2012 07:00:26 -0700 (PDT)
Subject: [R-sig-Geo] zlim()...bubble plot
In-Reply-To: <4D62C373.1090605@uni-muenster.de>
References: <AANLkTimZMsb4jrF62vYTosDGucPM88tgd9JYop99iwaU@mail.gmail.com>
	<4D62A240.7040203@uni-muenster.de>
	<AANLkTinVNSpgZhw52nfwbNDh51vzL37jAM3Xs1UWSCXp@mail.gmail.com>
	<4D62C373.1090605@uni-muenster.de>
Message-ID: <1342015226866-7580424.post@n2.nabble.com>

Hi,

I'm trying to modify the display of the bubble function to match to the
cutting classes that I desire. But I do not understand how to do it with the
key.entries argument.


Edzer Pebesma-2 wrote
> 
> 
> Sorry if I wasn't clear, but was
> 
> require(sp)
> data(meuse)
> coordinates(meuse) = ~x+y
> bubble(meuse["zinc"], maxsize=3, key.entries = c(10,100,1000,10000))
> 
> 

When I change the key.entries values, the legend is modified, but circles on
the map still the same.

bubble(meuse["zinc"], maxsize=3, key.entries = c(10,500,1500,10000))
bubble(meuse["zinc"], maxsize=3, key.entries = c(10,800,1600,10000))
bubble(meuse["zinc"], maxsize=3, key.entries = c(10,3000,10000))

My first intention is to use the classInt package to choose the classes of
value to show on the map. But I am blocked on the use of key.entries.

Maybe fortune(122) is the answer to my problem... or not.

As beginner on R and especially on lattice, I don't handle easily this kind
of function. Is there a bible on lattice and sp package that I should read
first?

Thanks,

Sim?on





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/zlim-bubble-plot-tp6049277p7580424.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alexandre.castagna at gmail.com  Wed Jul 11 16:24:10 2012
From: alexandre.castagna at gmail.com (Alexandre Castagna)
Date: Wed, 11 Jul 2012 11:24:10 -0300
Subject: [R-sig-Geo] zlim and plot in raster
In-Reply-To: <4FFD7E6F.9050709@njn.nl>
References: <4FFD7E6F.9050709@njn.nl>
Message-ID: <CAFiuohKg4ezzceXtn4LQmpdtn2SB05p6hfTgLhgx+20Eo4QXEQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120711/b3249d59/attachment.pl>

From riaarinda at gmail.com  Wed Jul 11 16:43:22 2012
From: riaarinda at gmail.com (riaarinda)
Date: Wed, 11 Jul 2012 07:43:22 -0700 (PDT)
Subject: [R-sig-Geo] Data grid in kriging?
Message-ID: <1342017802946-7580428.post@n2.nabble.com>

Currently I am trying to do kriging function in R. When I see the demo(krige)
in R, there are 2 data used. *.shp and *.grid. Can I use kriging when I only
have shape file (*.shp)? What is data.grid actually and can I create the
grid from shp file I have?
Thank you

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Data-grid-in-kriging-tp7580428.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From riaarinda at gmail.com  Wed Jul 11 20:18:40 2012
From: riaarinda at gmail.com (riaarinda)
Date: Wed, 11 Jul 2012 11:18:40 -0700 (PDT)
Subject: [R-sig-Geo] Data grid in kriging?
In-Reply-To: <1342017802946-7580428.post@n2.nabble.com>
References: <1342017802946-7580428.post@n2.nabble.com>
Message-ID: <1342030720583-7580430.post@n2.nabble.com>

specifically, what I ask is "How to create SpatialGridDataFrame from
SpatialPolygonsDataFrame" ?

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Data-grid-in-kriging-tp7580428p7580430.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From sec338 at gmail.com  Wed Jul 11 20:41:29 2012
From: sec338 at gmail.com (sec338)
Date: Wed, 11 Jul 2012 11:41:29 -0700 (PDT)
Subject: [R-sig-Geo] gpclibPermit() returns FALSE
Message-ID: <1342032089702-7580431.post@n2.nabble.com>

I am trying to use the fortify function however when I attempt to enable
gpclib with gpclibPermit() I am always getting FALSE. Any tips on how to get
it to return TRUE?

I am loading the following libraries:

plyr
reshape
proto
ggplot2
sp
rgdal
maptools
gpclib

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gpclibPermit-returns-FALSE-tp7580431.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Wed Jul 11 23:12:05 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 11 Jul 2012 23:12:05 +0200 (CEST)
Subject: [R-sig-Geo] gpclibPermit() returns FALSE
In-Reply-To: <1342032089702-7580431.post@n2.nabble.com>
References: <1342032089702-7580431.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.02.1207112310130.20228@reclus.nhh.no>

On Wed, 11 Jul 2012, sec338 wrote:

> I am trying to use the fortify function however when I attempt to enable
> gpclib with gpclibPermit() I am always getting FALSE. Any tips on how to get
> it to return TRUE?

Ignore gpclib and gpclibPermit(), load rgeos instead. I seem to remember 
that these are not really needed anyway. If you want better advice, please 
provide a reproducible example with one of the provided data sets.

Roger

>
> I am loading the following libraries:
>
> plyr
> reshape
> proto
> ggplot2
> sp
> rgdal
> maptools
> gpclib
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gpclibPermit-returns-FALSE-tp7580431.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jon.skoien at jrc.ec.europa.eu  Thu Jul 12 10:25:03 2012
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Thu, 12 Jul 2012 10:25:03 +0200
Subject: [R-sig-Geo] Data grid in kriging?
In-Reply-To: <1342017802946-7580428.post@n2.nabble.com>
References: <1342017802946-7580428.post@n2.nabble.com>
Message-ID: <4FFE89DF.9090203@jrc.ec.europa.eu>

You may be able to create a SpatialGridDataFrame from 
SpatialPolygonsDataFrame, but it depends on your polygon file. Are the 
polygons referring to the boundaries of grid cells? If sp0 is the 
SpatialPolygonsDataFrame you will probably get what you want with 
(untested):

sp1 = SpatialPointsDataFrame(coordinates(sp0), data = sp0 at data)
gridded(sp1) = TRUE
fullgrid(sp1) = TRUE

But I am not sure if this is what you should do in your case. I do not 
see any reference to a shape file in demo(krige), anyway, R does not 
care about how your data are stored outside R, only what type of spatial 
data it is (grid, points, polygons, lines), and whether the format can 
actually be read into R. meuse.grid is a grid, but you can also predict 
to points not being on a grid, or to polygons. Your observations can be 
points or a grid. The .grid extension of meuse.grid is just for 
convenience to show what kind of data you are working with, the name 
could also be meusePred or something completely else

If this does not help you, then try to describe your problem in more 
detail, what sort of data you have and what you would like to do with them.

Best wishes,
Jon

On 11-Jul-12 20:18, riaarinda wrote:
> specifically, what I ask is "How to create SpatialGridDataFrame from
> SpatialPolygonsDataFrame" ?

On 11-Jul-12 16:43, riaarinda wrote:
> Currently I am trying to do kriging function in R. When I see the demo(krige)
> in R, there are 2 data used. *.shp and *.grid. Can I use kriging when I only
> have shape file (*.shp)? What is data.grid actually and can I create the
> grid from shp file I have?
> Thank you
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Data-grid-in-kriging-tp7580428.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Land Resource Management Unit

Via Fermi 2749, TP 440,  I-21027 Ispra (VA), ITALY

jon.skoien at jrc.ec.europa.eu
Tel:  +39 0332 789206

Disclaimer: Views expressed in this email are those of the individual and do not necessarily represent official views of the European Commission.


From annafreni at yahoo.it  Thu Jul 12 13:24:40 2012
From: annafreni at yahoo.it (anna freni sterrantino)
Date: Thu, 12 Jul 2012 12:24:40 +0100 (BST)
Subject: [R-sig-Geo] ensembleBMA pit function warnings
Message-ID: <1342092280.25724.YahooMailNeo@web29305.mail.ird.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120712/ef48975f/attachment.pl>

From godina at dal.ca  Thu Jul 12 15:40:22 2012
From: godina at dal.ca (Aurelie C.Godin)
Date: Thu, 12 Jul 2012 06:40:22 -0700 (PDT)
Subject: [R-sig-Geo] Where to look for oceanographical/environmental data
	for the Arctic
Message-ID: <1342100422765-7580435.post@n2.nabble.com>

I am looking for oceanographical/environmental variables that are available
for Baffin Bay/Davis Strait area in the Canadian Arctic over the time period
of 1995-2011, however, I am not familiar with oceanographical/environmental
datasets.

Perhaps some of you may be able to point me in the right direction. Which
oceanographical/environmental variables/layers/rasters are available from
this part of the world? Any recommendations on where I can access these?

Thank you very much for your help.

-----
Aurelie Cosandey-Godin
Ph.D. Student, Department of Biology, Dalhousie University
Industrial Graduate Fellow, WWF-Canada
Email: godina at dal.ca | Web: wormlab.biology.dal.ca

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Where-to-look-for-oceanographical-environmental-data-for-the-Arctic-tp7580435.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From gianni.lavaredo at gmail.com  Thu Jul 12 15:45:13 2012
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Thu, 12 Jul 2012 15:45:13 +0200
Subject: [R-sig-Geo] Help to find a way to which voxel a point in space lies
	inside
Message-ID: <CAJ6JbR8Rt-BVMx30UqZg09T3=dzq48JDJAJpwkPivkoR2E=0+Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120712/6fa781e8/attachment.pl>

From thomas.adams at noaa.gov  Thu Jul 12 15:55:14 2012
From: thomas.adams at noaa.gov (Thomas Adams)
Date: Thu, 12 Jul 2012 09:55:14 -0400
Subject: [R-sig-Geo] Where to look for oceanographical/environmental
 data for the Arctic
In-Reply-To: <1342100422765-7580435.post@n2.nabble.com>
References: <1342100422765-7580435.post@n2.nabble.com>
Message-ID: <CAEoga+T98iw2bygLptNa+-r0OL5rZX7WWP_5uXKGgujEbbELZw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120712/bb195b3f/attachment.pl>

From marcelino.delacruz at upm.es  Thu Jul 12 16:13:40 2012
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Thu, 12 Jul 2012 16:13:40 +0200
Subject: [R-sig-Geo] Help to find a way to which voxel a point in space
 lies inside
In-Reply-To: <CAJ6JbR8Rt-BVMx30UqZg09T3=dzq48JDJAJpwkPivkoR2E=0+Q@mail.g
	mail.com>
References: <CAJ6JbR8Rt-BVMx30UqZg09T3=dzq48JDJAJpwkPivkoR2E=0+Q@mail.gmail.com>
Message-ID: <201207121413.q6CEDkXE013877@smtp.upm.es>

Hi Gianni,

I don't know if I this is what you want but maybe would be based in 
something like this:

myPointsc <- apply(myPoints,2,cut, breaks=0:10, labels=paste("v", 
1:10, sep=""))
myPointsc <- apply(myPointsc,1,paste, collapse="")
 > myPoints[myPointsc=="v1v1v1",]
           [,1]      [,2]      [,3]
[1,] 0.8250876 0.9355083 0.1332186
[2,] 0.3455816 0.8866431 0.6895027
 > myPoints[myPointsc=="v1v1v2",]
      [,1] [,2] [,3]
 > myPoints[myPointsc=="v1v1v3",]
[1] 0.6749106 0.5506732 2.5559303
 >
etc


Cheers,

Marcelino





At 15:45 12/07/2012, gianni lavaredo wrote:
>Dear R users,
>I am trying to write a code that could efficiently determine which voxel a
>point in space lies inside. For example, I have a matix with x,y,z values:
>
>library(rgl)
>
>x = runif(500, 0, 10)
>y = runif(500, 0, 10)
>z = runif(500, 0, 10)
>
>myPoints <- matrix(c(x,y,z), ncol=3)
>plot3d(myPoints)
>
>
>Supposing I have a 3 dimensional cube in space (ex: 10 by 10 ), that is
>segmented into 1 by 1 smaller voxels.
>
>My3D <- array(0,dim=c(10,10,3))
>
>I would really appreciate suggestions to writing a very efficient code to
>determine which voxel index each of these points lie inside, especially in
>an optics to do a chunk-by-chunk analysis.
>
>Thanks for any help
>Gianni
>
>         [[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Kerstin.Traut at uni-jena.de  Thu Jul 12 16:16:11 2012
From: Kerstin.Traut at uni-jena.de (Kerstin Traut)
Date: Thu, 12 Jul 2012 16:16:11 +0200
Subject: [R-sig-Geo] =?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
 =?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
Message-ID: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>

Hi,

I have a question on testing spatial autocorrelation on raster data  
including NA-values. In particular, I like to calculate Moran?s I and  
Geary?s C indices by using inverse distance weighting matrices.
Calculating Moran?s I with moran.test works fine, because the function  
contains the option "na.action=na.pass". Unfortunately, the function  
geary.test does not contain this option. The problem is that  
geary.test needs an nb argument for which I cannot perform for example  
nb<-ifelse(value, nb, NA), because it would change the nb-format to a  
list-format.
Is there a way to ignore NA-values in geary.test? Or how can I set NA  
values in a neigbors (nb) list?

Thank you very much,
Kerstin

---

file<-raster(test.tif")
mask<-extent(file, 1, 50, 1, 50)
subset<-crop(file,mask,test.tif", overwrite=TRUE)
value <- as.matrix(subset)

# Creation of a list of integer vectors giving the region id numbers  
for the neighbors within the grid extent
nb <- cell2nb(50, 50, type="queen", torus=TRUE)

# Calculation of the distances along the links in the neighbous list
dist <- nbdists(nb, coordinates(subset), longlat=TRUE)

# Converting the distances to inverse distance values
inv.dist <- lapply(dist, function (x) 1/(x*100))

# Supplementing the neighbors list with spatial weights for a coding scheme
nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
summary(unlist(nb.idw$weights))

# Moran's test (two-sided)
moran.global <- moran.test(value, listw=nb.idw, zero.policy = TRUE,  
na.action=na.pass, alternative="two.sided")
moran.global

# Geary's test (two-sided)
geary.global <- geary.test(value, listw=nb.idw, zero.policy = TRUE ,  
alternative="two.sided")
geary.global

----------------------------------------------------------------
This message was sent through https://webmail.uni-jena.de


From gianni.lavaredo at gmail.com  Thu Jul 12 16:30:07 2012
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Thu, 12 Jul 2012 16:30:07 +0200
Subject: [R-sig-Geo] Help to find a way to which voxel a point in space
 lies inside
In-Reply-To: <201207121413.q6CEDkXE013877@smtp.upm.es>
References: <CAJ6JbR8Rt-BVMx30UqZg09T3=dzq48JDJAJpwkPivkoR2E=0+Q@mail.gmail.com>
	<201207121413.q6CEDkXE013877@smtp.upm.es>
Message-ID: <CAJ6JbR-BqsFy85oSUc1homnFkatAFDiW7MPc17a096O==d9dgw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120712/264b54ea/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jul 12 16:34:57 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jul 2012 16:34:57 +0200 (CEST)
Subject: [R-sig-Geo]
	=?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
	=?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
Message-ID: <alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>

On Thu, 12 Jul 2012, Kerstin Traut wrote:

> Hi,
>
> I have a question on testing spatial autocorrelation on raster data including 
> NA-values. In particular, I like to calculate Moran?s I and Geary?s C indices 
> by using inverse distance weighting matrices.
> Calculating Moran?s I with moran.test works fine, because the function 
> contains the option "na.action=na.pass". Unfortunately, the function 
> geary.test does not contain this option. The problem is that geary.test needs 
> an nb argument for which I cannot perform for example nb<-ifelse(value, nb, 
> NA), because it would change the nb-format to a list-format.
> Is there a way to ignore NA-values in geary.test? Or how can I set NA values 
> in a neigbors (nb) list?

The simple answer is to subset the variable of interest and the nb object 
to omit NA observations (which is what moran.test does internally). 
Alternatively, you could contribute a patch to geary.test(), if you like.

Hope this helps,

Roger

>
> Thank you very much,
> Kerstin
>
> ---
>
> file<-raster(test.tif")
> mask<-extent(file, 1, 50, 1, 50)
> subset<-crop(file,mask,test.tif", overwrite=TRUE)
> value <- as.matrix(subset)
>
> # Creation of a list of integer vectors giving the region id numbers for the 
> neighbors within the grid extent
> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>
> # Calculation of the distances along the links in the neighbous list
> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>
> # Converting the distances to inverse distance values
> inv.dist <- lapply(dist, function (x) 1/(x*100))
>
> # Supplementing the neighbors list with spatial weights for a coding scheme
> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
> summary(unlist(nb.idw$weights))
>
> # Moran's test (two-sided)
> moran.global <- moran.test(value, listw=nb.idw, zero.policy = TRUE, 
> na.action=na.pass, alternative="two.sided")
> moran.global
>
> # Geary's test (two-sided)
> geary.global <- geary.test(value, listw=nb.idw, zero.policy = TRUE , 
> alternative="two.sided")
> geary.global
>
> ----------------------------------------------------------------
> This message was sent through https://webmail.uni-jena.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Kerstin.Traut at uni-jena.de  Thu Jul 12 16:50:35 2012
From: Kerstin.Traut at uni-jena.de (Kerstin Traut)
Date: Thu, 12 Jul 2012 16:50:35 +0200
Subject: [R-sig-Geo]
 =?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
 =?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
Message-ID: <20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>

Zitat von Roger Bivand <Roger.Bivand at nhh.no>:

> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>
>> Hi,
>>
>> I have a question on testing spatial autocorrelation on raster data  
>> including NA-values. In particular, I like to calculate Moran?s I  
>> and Geary?s C indices by using inverse distance weighting matrices.
>> Calculating Moran?s I with moran.test works fine, because the  
>> function contains the option "na.action=na.pass". Unfortunately,  
>> the function geary.test does not contain this option. The problem  
>> is that geary.test needs an nb argument for which I cannot perform  
>> for example nb<-ifelse(value, nb, NA), because it would change the  
>> nb-format to a list-format.
>> Is there a way to ignore NA-values in geary.test? Or how can I set  
>> NA values in a neigbors (nb) list?
>
> The simple answer is to subset the variable of interest and the nb  
> object to omit NA observations (which is what moran.test does  
> internally). Alternatively, you could contribute a patch to  
> geary.test(), if you like.
>
> Hope this helps,
>
> Roger

Thanks for your answer. Unfortunately, I think that subsetting is in  
my case not the right solution, because I need to define the amount of  
neighbors in cell2nb on the basis of a rectangular extent (e.g. 50 x  
50 neighbors). Subsetting this extent by deleting NA-values would  
destroy the nb list format required by geary.test.
Is there any solution for subsetting an nb list without destroying the  
nb format?

Kind regards,
Kerstin


>> Thank you very much,
>> Kerstin
>>
>> ---
>>
>> file<-raster(test.tif")
>> mask<-extent(file, 1, 50, 1, 50)
>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>> value <- as.matrix(subset)
>>
>> # Creation of a list of integer vectors giving the region id  
>> numbers for the neighbors within the grid extent
>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>
>> # Calculation of the distances along the links in the neighbous list
>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>
>> # Converting the distances to inverse distance values
>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>
>> # Supplementing the neighbors list with spatial weights for a coding scheme
>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>> summary(unlist(nb.idw$weights))
>>
>> # Moran's test (two-sided)
>> moran.global <- moran.test(value, listw=nb.idw, zero.policy = TRUE,  
>> na.action=na.pass, alternative="two.sided")
>> moran.global
>>
>> # Geary's test (two-sided)
>> geary.global <- geary.test(value, listw=nb.idw, zero.policy = TRUE  
>> , alternative="two.sided")
>> geary.global
>>
>> ----------------------------------------------------------------
>> This message was sent through https://webmail.uni-jena.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> -- 
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



----------------------------------------------------------------
This message was sent through https://webmail.uni-jena.de


From Roger.Bivand at nhh.no  Thu Jul 12 16:54:55 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jul 2012 16:54:55 +0200 (CEST)
Subject: [R-sig-Geo]
	=?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
	=?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
Message-ID: <alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>

On Thu, 12 Jul 2012, Kerstin Traut wrote:

> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>
>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>> 
>>> Hi,
>>> 
>>> I have a question on testing spatial autocorrelation on raster data 
>>> including NA-values. In particular, I like to calculate Moran?s I and 
>>> Geary?s C indices by using inverse distance weighting matrices.
>>> Calculating Moran?s I with moran.test works fine, because the function 
>>> contains the option "na.action=na.pass". Unfortunately, the function 
>>> geary.test does not contain this option. The problem is that geary.test 
>>> needs an nb argument for which I cannot perform for example 
>>> nb<-ifelse(value, nb, NA), because it would change the nb-format to a 
>>> list-format.
>>> Is there a way to ignore NA-values in geary.test? Or how can I set NA 
>>> values in a neigbors (nb) list?
>> 
>> The simple answer is to subset the variable of interest and the nb object 
>> to omit NA observations (which is what moran.test does internally). 
>> Alternatively, you could contribute a patch to geary.test(), if you like.
>> 
>> Hope this helps,
>> 
>> Roger
>
> Thanks for your answer. Unfortunately, I think that subsetting is in my case 
> not the right solution, because I need to define the amount of neighbors in 
> cell2nb on the basis of a rectangular extent (e.g. 50 x 50 neighbors). 
> Subsetting this extent by deleting NA-values would destroy the nb list format 
> required by geary.test.
> Is there any solution for subsetting an nb list without destroying the nb 
> format?

Yes, there are subset methods for nb and listw objects. To ensure data 
integrity, use dnearneigh() instead of cell2nb(), and use a 
SpatialPointsDataFrame to hold your data. In that way, you make sure that 
the subset condition is applied to the same observations.

Roger

>
> Kind regards,
> Kerstin
>
>
>>> Thank you very much,
>>> Kerstin
>>> 
>>> ---
>>> 
>>> file<-raster(test.tif")
>>> mask<-extent(file, 1, 50, 1, 50)
>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>> value <- as.matrix(subset)
>>> 
>>> # Creation of a list of integer vectors giving the region id numbers for 
>>> the neighbors within the grid extent
>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>> 
>>> # Calculation of the distances along the links in the neighbous list
>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>> 
>>> # Converting the distances to inverse distance values
>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>> 
>>> # Supplementing the neighbors list with spatial weights for a coding 
>>> scheme
>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>> summary(unlist(nb.idw$weights))
>>> 
>>> # Moran's test (two-sided)
>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy = TRUE, 
>>> na.action=na.pass, alternative="two.sided")
>>> moran.global
>>> 
>>> # Geary's test (two-sided)
>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy = TRUE , 
>>> alternative="two.sided")
>>> geary.global
>>> 
>>> ----------------------------------------------------------------
>>> This message was sent through https://webmail.uni-jena.de
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>> -- 
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> 
>
>
>
> ----------------------------------------------------------------
> This message was sent through https://webmail.uni-jena.de

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Thu Jul 12 17:01:28 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jul 2012 17:01:28 +0200 (CEST)
Subject: [R-sig-Geo]
	=?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
	=?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
Message-ID: <alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>

On Thu, 12 Jul 2012, Roger Bivand wrote:

> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>
>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>> 
>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>> 
>>>> Hi,
>>>> 
>>>> I have a question on testing spatial autocorrelation on raster data 
>>>> including NA-values. In particular, I like to calculate Moran?s I and 
>>>> Geary?s C indices by using inverse distance weighting matrices.
>>>> Calculating Moran?s I with moran.test works fine, because the function 
>>>> contains the option "na.action=na.pass". Unfortunately, the function 
>>>> geary.test does not contain this option. The problem is that geary.test 
>>>> needs an nb argument for which I cannot perform for example 
>>>> nb<-ifelse(value, nb, NA), because it would change the nb-format to a 
>>>> list-format.
>>>> Is there a way to ignore NA-values in geary.test? Or how can I set NA 
>>>> values in a neigbors (nb) list?
>>> 
>>> The simple answer is to subset the variable of interest and the nb object 
>>> to omit NA observations (which is what moran.test does internally). 
>>> Alternatively, you could contribute a patch to geary.test(), if you like.
>>> 
>>> Hope this helps,
>>> 
>>> Roger
>> 
>> Thanks for your answer. Unfortunately, I think that subsetting is in my 
>> case not the right solution, because I need to define the amount of 
>> neighbors in cell2nb on the basis of a rectangular extent (e.g. 50 x 50 
>> neighbors). Subsetting this extent by deleting NA-values would destroy the 
>> nb list format required by geary.test.
>> Is there any solution for subsetting an nb list without destroying the nb 
>> format?
>
> Yes, there are subset methods for nb and listw objects. To ensure data 
> integrity, use dnearneigh() instead of cell2nb(), and use a 
> SpatialPointsDataFrame to hold your data. In that way, you make sure that the 
> subset condition is applied to the same observations.

The latter advice may not work if your coordinates are planar and you 
really mean to set torus=TRUE in cell2nb(). You'll have to get the data 
order right by deconstructing the region.id attribute of the nb object 
created by cell2nb() to ensure data integrity.

Roger

>
> Roger
>
>> 
>> Kind regards,
>> Kerstin
>> 
>> 
>>>> Thank you very much,
>>>> Kerstin
>>>> 
>>>> ---
>>>> 
>>>> file<-raster(test.tif")
>>>> mask<-extent(file, 1, 50, 1, 50)
>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>> value <- as.matrix(subset)
>>>> 
>>>> # Creation of a list of integer vectors giving the region id numbers for 
>>>> the neighbors within the grid extent
>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>> 
>>>> # Calculation of the distances along the links in the neighbous list
>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>> 
>>>> # Converting the distances to inverse distance values
>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>> 
>>>> # Supplementing the neighbors list with spatial weights for a coding 
>>>> scheme
>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>> summary(unlist(nb.idw$weights))
>>>> 
>>>> # Moran's test (two-sided)
>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy = TRUE, 
>>>> na.action=na.pass, alternative="two.sided")
>>>> moran.global
>>>> 
>>>> # Geary's test (two-sided)
>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy = TRUE , 
>>>> alternative="two.sided")
>>>> geary.global
>>>> 
>>>> ----------------------------------------------------------------
>>>> This message was sent through https://webmail.uni-jena.de
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>>> -- 
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>> 
>> 
>> 
>> 
>> ----------------------------------------------------------------
>> This message was sent through https://webmail.uni-jena.de
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From marcelino.delacruz at upm.es  Thu Jul 12 17:16:36 2012
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Thu, 12 Jul 2012 17:16:36 +0200
Subject: [R-sig-Geo] Help to find a way to which voxel a point in space
 lies inside
In-Reply-To: <CAJ6JbR-BqsFy85oSUc1homnFkatAFDiW7MPc17a096O==d9dgw@mail.g
	mail.com>
References: <CAJ6JbR8Rt-BVMx30UqZg09T3=dzq48JDJAJpwkPivkoR2E=0+Q@mail.gmail.com>
	<201207121413.q6CEDkXE013877@smtp.upm.es>
	<CAJ6JbR-BqsFy85oSUc1homnFkatAFDiW7MPc17a096O==d9dgw@mail.gmail.com>
Message-ID: <201207121516.q6CFGhUv019144@smtp.upm.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120712/f1553a11/attachment.pl>

From Kerstin.Traut at uni-jena.de  Thu Jul 12 17:42:13 2012
From: Kerstin.Traut at uni-jena.de (Kerstin Traut)
Date: Thu, 12 Jul 2012 17:42:13 +0200
Subject: [R-sig-Geo]
 =?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
 =?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
Message-ID: <20120712174213.10501eu3zy955b34@webmail.uni-jena.de>

Zitat von Roger Bivand <Roger.Bivand at nhh.no>:

> On Thu, 12 Jul 2012, Roger Bivand wrote:
>
>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>
>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>
>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> I have a question on testing spatial autocorrelation on raster  
>>>>> data including NA-values. In particular, I like to calculate  
>>>>> Moran?s I and Geary?s C indices by using inverse distance  
>>>>> weighting matrices.
>>>>> Calculating Moran?s I with moran.test works fine, because the  
>>>>> function contains the option "na.action=na.pass". Unfortunately,  
>>>>> the function geary.test does not contain this option. The  
>>>>> problem is that geary.test needs an nb argument for which I  
>>>>> cannot perform for example nb<-ifelse(value, nb, NA), because it  
>>>>> would change the nb-format to a list-format.
>>>>> Is there a way to ignore NA-values in geary.test? Or how can I  
>>>>> set NA values in a neigbors (nb) list?
>>>>
>>>> The simple answer is to subset the variable of interest and the  
>>>> nb object to omit NA observations (which is what moran.test does  
>>>> internally). Alternatively, you could contribute a patch to  
>>>> geary.test(), if you like.
>>>>
>>>> Hope this helps,
>>>>
>>>> Roger
>>>
>>> Thanks for your answer. Unfortunately, I think that subsetting is  
>>> in my case not the right solution, because I need to define the  
>>> amount of neighbors in cell2nb on the basis of a rectangular  
>>> extent (e.g. 50 x 50 neighbors). Subsetting this extent by  
>>> deleting NA-values would destroy the nb list format required by  
>>> geary.test.
>>> Is there any solution for subsetting an nb list without destroying  
>>> the nb format?
>>
>> Yes, there are subset methods for nb and listw objects. To ensure  
>> data integrity, use dnearneigh() instead of cell2nb(), and use a  
>> SpatialPointsDataFrame to hold your data. In that way, you make  
>> sure that the subset condition is applied to the same observations.
>
> The latter advice may not work if your coordinates are planar and  
> you really mean to set torus=TRUE in cell2nb(). You'll have to get  
> the data order right by deconstructing the region.id attribute of  
> the nb object created by cell2nb() to ensure data integrity.
>
> Roger

I already tested dnearneigh(), but I like to avoid this function  
because for large datasets cell2nb() calculates neighbors more quickly.
Thanks to your suggestion I was able to subset the nb list by using  
nb.subset(). But I could not find a suitable function for subsetting a  
listw. Using the subset() function results in the following error  
message: "Not yet able to subset general weights lists". Do you have  
an explaination?

Kerstin


>>
>> Roger
>>
>>>
>>> Kind regards,
>>> Kerstin
>>>
>>>
>>>>> Thank you very much,
>>>>> Kerstin
>>>>>
>>>>> ---
>>>>>
>>>>> file<-raster(test.tif")
>>>>> mask<-extent(file, 1, 50, 1, 50)
>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>>> value <- as.matrix(subset)
>>>>>
>>>>> # Creation of a list of integer vectors giving the region id  
>>>>> numbers for the neighbors within the grid extent
>>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>
>>>>> # Calculation of the distances along the links in the neighbous list
>>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>>>
>>>>> # Converting the distances to inverse distance values
>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>
>>>>> # Supplementing the neighbors list with spatial weights for a  
>>>>> coding scheme
>>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>>> summary(unlist(nb.idw$weights))
>>>>>
>>>>> # Moran's test (two-sided)
>>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy =  
>>>>> TRUE, na.action=na.pass, alternative="two.sided")
>>>>> moran.global
>>>>>
>>>>> # Geary's test (two-sided)
>>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy =  
>>>>> TRUE , alternative="two.sided")
>>>>> geary.global
>>>>>
>>>>> ----------------------------------------------------------------
>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>> -- 
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>
>>>
>>>
>>> ----------------------------------------------------------------
>>> This message was sent through https://webmail.uni-jena.de
>>
>>
>
> -- 
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



----------------------------------------------------------------
This message was sent through https://webmail.uni-jena.de


From Roger.Bivand at nhh.no  Thu Jul 12 17:45:26 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jul 2012 17:45:26 +0200 (CEST)
Subject: [R-sig-Geo]
	=?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
	=?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
Message-ID: <alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>

On Thu, 12 Jul 2012, Kerstin Traut wrote:

> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>
>> On Thu, 12 Jul 2012, Roger Bivand wrote:
>> 
>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>> 
>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>> 
>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>> 
>>>>>> Hi,
>>>>>> 
>>>>>> I have a question on testing spatial autocorrelation on raster data 
>>>>>> including NA-values. In particular, I like to calculate Moran?s I and 
>>>>>> Geary?s C indices by using inverse distance weighting matrices.
>>>>>> Calculating Moran?s I with moran.test works fine, because the function 
>>>>>> contains the option "na.action=na.pass". Unfortunately, the function 
>>>>>> geary.test does not contain this option. The problem is that geary.test 
>>>>>> needs an nb argument for which I cannot perform for example 
>>>>>> nb<-ifelse(value, nb, NA), because it would change the nb-format to a 
>>>>>> list-format.
>>>>>> Is there a way to ignore NA-values in geary.test? Or how can I set NA 
>>>>>> values in a neigbors (nb) list?
>>>>> 
>>>>> The simple answer is to subset the variable of interest and the nb 
>>>>> object to omit NA observations (which is what moran.test does 
>>>>> internally). Alternatively, you could contribute a patch to 
>>>>> geary.test(), if you like.
>>>>> 
>>>>> Hope this helps,
>>>>> 
>>>>> Roger
>>>> 
>>>> Thanks for your answer. Unfortunately, I think that subsetting is in my 
>>>> case not the right solution, because I need to define the amount of 
>>>> neighbors in cell2nb on the basis of a rectangular extent (e.g. 50 x 50 
>>>> neighbors). Subsetting this extent by deleting NA-values would destroy 
>>>> the nb list format required by geary.test.
>>>> Is there any solution for subsetting an nb list without destroying the nb 
>>>> format?
>>> 
>>> Yes, there are subset methods for nb and listw objects. To ensure data 
>>> integrity, use dnearneigh() instead of cell2nb(), and use a 
>>> SpatialPointsDataFrame to hold your data. In that way, you make sure that 
>>> the subset condition is applied to the same observations.
>> 
>> The latter advice may not work if your coordinates are planar and you 
>> really mean to set torus=TRUE in cell2nb(). You'll have to get the data 
>> order right by deconstructing the region.id attribute of the nb object 
>> created by cell2nb() to ensure data integrity.
>> 
>> Roger
>
> I already tested dnearneigh(), but I like to avoid this function because for 
> large datasets cell2nb() calculates neighbors more quickly.
> Thanks to your suggestion I was able to subset the nb list by using 
> nb.subset(). But I could not find a suitable function for subsetting a listw. 
> Using the subset() function results in the following error message: "Not yet 
> able to subset general weights lists". Do you have an explaination?

Yes, because the changes may not be appropriate, depending on how the 
general weights were defined. In your case, subset the nb object and the 
list of idw weights, and rebuild the listw object with the subsetted 
objects.

Roger

>
> Kerstin
>
>
>>> 
>>> Roger
>>> 
>>>> 
>>>> Kind regards,
>>>> Kerstin
>>>> 
>>>> 
>>>>>> Thank you very much,
>>>>>> Kerstin
>>>>>> 
>>>>>> ---
>>>>>> 
>>>>>> file<-raster(test.tif")
>>>>>> mask<-extent(file, 1, 50, 1, 50)
>>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>>>> value <- as.matrix(subset)
>>>>>> 
>>>>>> # Creation of a list of integer vectors giving the region id numbers 
>>>>>> for the neighbors within the grid extent
>>>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>> 
>>>>>> # Calculation of the distances along the links in the neighbous list
>>>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>>>> 
>>>>>> # Converting the distances to inverse distance values
>>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>> 
>>>>>> # Supplementing the neighbors list with spatial weights for a coding 
>>>>>> scheme
>>>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>>>> summary(unlist(nb.idw$weights))
>>>>>> 
>>>>>> # Moran's test (two-sided)
>>>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy = TRUE, 
>>>>>> na.action=na.pass, alternative="two.sided")
>>>>>> moran.global
>>>>>> 
>>>>>> # Geary's test (two-sided)
>>>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy = TRUE , 
>>>>>> alternative="two.sided")
>>>>>> geary.global
>>>>>> 
>>>>>> ----------------------------------------------------------------
>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>> 
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> 
>>>>> -- 
>>>>> Roger Bivand
>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>> 
>>>> 
>>>> 
>>>> 
>>>> ----------------------------------------------------------------
>>>> This message was sent through https://webmail.uni-jena.de
>>> 
>>> 
>> 
>> -- 
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> 
>
>
>
> ----------------------------------------------------------------
> This message was sent through https://webmail.uni-jena.de

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Kerstin.Traut at uni-jena.de  Thu Jul 12 17:48:35 2012
From: Kerstin.Traut at uni-jena.de (Kerstin Traut)
Date: Thu, 12 Jul 2012 17:48:35 +0200
Subject: [R-sig-Geo]
 =?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
 =?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
Message-ID: <20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>

Zitat von Roger Bivand <Roger.Bivand at nhh.no>:

> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>
>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>
>>> On Thu, 12 Jul 2012, Roger Bivand wrote:
>>>
>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>
>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>
>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>
>>>>>>> Hi,
>>>>>>>
>>>>>>> I have a question on testing spatial autocorrelation on raster  
>>>>>>> data including NA-values. In particular, I like to calculate  
>>>>>>> Moran?s I and Geary?s C indices by using inverse distance  
>>>>>>> weighting matrices.
>>>>>>> Calculating Moran?s I with moran.test works fine, because the  
>>>>>>> function contains the option "na.action=na.pass".  
>>>>>>> Unfortunately, the function geary.test does not contain this  
>>>>>>> option. The problem is that geary.test needs an nb argument  
>>>>>>> for which I cannot perform for example nb<-ifelse(value, nb,  
>>>>>>> NA), because it would change the nb-format to a list-format.
>>>>>>> Is there a way to ignore NA-values in geary.test? Or how can I  
>>>>>>> set NA values in a neigbors (nb) list?
>>>>>>
>>>>>> The simple answer is to subset the variable of interest and the  
>>>>>> nb object to omit NA observations (which is what moran.test  
>>>>>> does internally). Alternatively, you could contribute a patch  
>>>>>> to geary.test(), if you like.
>>>>>>
>>>>>> Hope this helps,
>>>>>>
>>>>>> Roger
>>>>>
>>>>> Thanks for your answer. Unfortunately, I think that subsetting  
>>>>> is in my case not the right solution, because I need to define  
>>>>> the amount of neighbors in cell2nb on the basis of a rectangular  
>>>>> extent (e.g. 50 x 50 neighbors). Subsetting this extent by  
>>>>> deleting NA-values would destroy the nb list format required by  
>>>>> geary.test.
>>>>> Is there any solution for subsetting an nb list without  
>>>>> destroying the nb format?
>>>>
>>>> Yes, there are subset methods for nb and listw objects. To ensure  
>>>> data integrity, use dnearneigh() instead of cell2nb(), and use a  
>>>> SpatialPointsDataFrame to hold your data. In that way, you make  
>>>> sure that the subset condition is applied to the same observations.
>>>
>>> The latter advice may not work if your coordinates are planar and  
>>> you really mean to set torus=TRUE in cell2nb(). You'll have to get  
>>> the data order right by deconstructing the region.id attribute of  
>>> the nb object created by cell2nb() to ensure data integrity.
>>>
>>> Roger
>>
>> I already tested dnearneigh(), but I like to avoid this function  
>> because for large datasets cell2nb() calculates neighbors more  
>> quickly.
>> Thanks to your suggestion I was able to subset the nb list by using  
>> nb.subset(). But I could not find a suitable function for  
>> subsetting a listw. Using the subset() function results in the  
>> following error message: "Not yet able to subset general weights  
>> lists". Do you have an explaination?
>
> Yes, because the changes may not be appropriate, depending on how  
> the general weights were defined. In your case, subset the nb object  
> and the list of idw weights, and rebuild the listw object with the  
> subsetted objects.
>
> Roger

That?s what I already tried, but the error message says "neighbors and  
glist do not conform"??

Kerstin

>>
>> Kerstin
>>
>>
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> Kind regards,
>>>>> Kerstin
>>>>>
>>>>>
>>>>>>> Thank you very much,
>>>>>>> Kerstin
>>>>>>>
>>>>>>> ---
>>>>>>>
>>>>>>> file<-raster(test.tif")
>>>>>>> mask<-extent(file, 1, 50, 1, 50)
>>>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>>>>> value <- as.matrix(subset)
>>>>>>>
>>>>>>> # Creation of a list of integer vectors giving the region id  
>>>>>>> numbers for the neighbors within the grid extent
>>>>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>>>
>>>>>>> # Calculation of the distances along the links in the neighbous list
>>>>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>>>>>
>>>>>>> # Converting the distances to inverse distance values
>>>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>>>
>>>>>>> # Supplementing the neighbors list with spatial weights for a  
>>>>>>> coding scheme
>>>>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>>>>> summary(unlist(nb.idw$weights))
>>>>>>>
>>>>>>> # Moran's test (two-sided)
>>>>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy =  
>>>>>>> TRUE, na.action=na.pass, alternative="two.sided")
>>>>>>> moran.global
>>>>>>>
>>>>>>> # Geary's test (two-sided)
>>>>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy =  
>>>>>>> TRUE , alternative="two.sided")
>>>>>>> geary.global
>>>>>>>
>>>>>>> ----------------------------------------------------------------
>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>> -- 
>>>>>> Roger Bivand
>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>> ----------------------------------------------------------------
>>>>> This message was sent through https://webmail.uni-jena.de
>>>>
>>>>
>>>
>>> -- 
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>
>>
>>
>> ----------------------------------------------------------------
>> This message was sent through https://webmail.uni-jena.de
>
> -- 
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



----------------------------------------------------------------
This message was sent through https://webmail.uni-jena.de


From Roger.Bivand at nhh.no  Thu Jul 12 17:51:14 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jul 2012 17:51:14 +0200 (CEST)
Subject: [R-sig-Geo]
	=?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
	=?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
	<20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>
Message-ID: <alpine.LRH.2.02.1207121749070.23207@reclus.nhh.no>

On Thu, 12 Jul 2012, Kerstin Traut wrote:

> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>
>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>> 
>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>> 
>>>> On Thu, 12 Jul 2012, Roger Bivand wrote:
>>>> 
>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>> 
>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>> 
>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>> 
>>>>>>>> Hi,
>>>>>>>> 
>>>>>>>> I have a question on testing spatial autocorrelation on raster data 
>>>>>>>> including NA-values. In particular, I like to calculate Moran?s I and 
>>>>>>>> Geary?s C indices by using inverse distance weighting matrices.
>>>>>>>> Calculating Moran?s I with moran.test works fine, because the 
>>>>>>>> function contains the option "na.action=na.pass". Unfortunately, the 
>>>>>>>> function geary.test does not contain this option. The problem is that 
>>>>>>>> geary.test needs an nb argument for which I cannot perform for 
>>>>>>>> example nb<-ifelse(value, nb, NA), because it would change the 
>>>>>>>> nb-format to a list-format.
>>>>>>>> Is there a way to ignore NA-values in geary.test? Or how can I set NA 
>>>>>>>> values in a neigbors (nb) list?
>>>>>>> 
>>>>>>> The simple answer is to subset the variable of interest and the nb 
>>>>>>> object to omit NA observations (which is what moran.test does 
>>>>>>> internally). Alternatively, you could contribute a patch to 
>>>>>>> geary.test(), if you like.
>>>>>>> 
>>>>>>> Hope this helps,
>>>>>>> 
>>>>>>> Roger
>>>>>> 
>>>>>> Thanks for your answer. Unfortunately, I think that subsetting is in my 
>>>>>> case not the right solution, because I need to define the amount of 
>>>>>> neighbors in cell2nb on the basis of a rectangular extent (e.g. 50 x 50 
>>>>>> neighbors). Subsetting this extent by deleting NA-values would destroy 
>>>>>> the nb list format required by geary.test.
>>>>>> Is there any solution for subsetting an nb list without destroying the 
>>>>>> nb format?
>>>>> 
>>>>> Yes, there are subset methods for nb and listw objects. To ensure data 
>>>>> integrity, use dnearneigh() instead of cell2nb(), and use a 
>>>>> SpatialPointsDataFrame to hold your data. In that way, you make sure 
>>>>> that the subset condition is applied to the same observations.
>>>> 
>>>> The latter advice may not work if your coordinates are planar and you 
>>>> really mean to set torus=TRUE in cell2nb(). You'll have to get the data 
>>>> order right by deconstructing the region.id attribute of the nb object 
>>>> created by cell2nb() to ensure data integrity.
>>>> 
>>>> Roger
>>> 
>>> I already tested dnearneigh(), but I like to avoid this function because 
>>> for large datasets cell2nb() calculates neighbors more quickly.
>>> Thanks to your suggestion I was able to subset the nb list by using 
>>> nb.subset(). But I could not find a suitable function for subsetting a 
>>> listw. Using the subset() function results in the following error message: 
>>> "Not yet able to subset general weights lists". Do you have an 
>>> explaination?
>> 
>> Yes, because the changes may not be appropriate, depending on how the 
>> general weights were defined. In your case, subset the nb object and the 
>> list of idw weights, and rebuild the listw object with the subsetted 
>> objects.
>> 
>> Roger
>
> That?s what I already tried, but the error message says "neighbors and glist 
> do not conform"??

Right, you'll need to rebuild from the subsetted nb object from the 
nbdists() step (and subsetted coordinates), because the subsetted idw list 
will have weights for excluded observations.

Roger

>
> Kerstin
>
>>> 
>>> Kerstin
>>> 
>>> 
>>>>> 
>>>>> Roger
>>>>> 
>>>>>> 
>>>>>> Kind regards,
>>>>>> Kerstin
>>>>>> 
>>>>>> 
>>>>>>>> Thank you very much,
>>>>>>>> Kerstin
>>>>>>>> 
>>>>>>>> ---
>>>>>>>> 
>>>>>>>> file<-raster(test.tif")
>>>>>>>> mask<-extent(file, 1, 50, 1, 50)
>>>>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>>>>>> value <- as.matrix(subset)
>>>>>>>> 
>>>>>>>> # Creation of a list of integer vectors giving the region id numbers 
>>>>>>>> for the neighbors within the grid extent
>>>>>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>>>> 
>>>>>>>> # Calculation of the distances along the links in the neighbous list
>>>>>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>>>>>> 
>>>>>>>> # Converting the distances to inverse distance values
>>>>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>>>> 
>>>>>>>> # Supplementing the neighbors list with spatial weights for a coding 
>>>>>>>> scheme
>>>>>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>>>>>> summary(unlist(nb.idw$weights))
>>>>>>>> 
>>>>>>>> # Moran's test (two-sided)
>>>>>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy = TRUE, 
>>>>>>>> na.action=na.pass, alternative="two.sided")
>>>>>>>> moran.global
>>>>>>>> 
>>>>>>>> # Geary's test (two-sided)
>>>>>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy = TRUE , 
>>>>>>>> alternative="two.sided")
>>>>>>>> geary.global
>>>>>>>> 
>>>>>>>> ----------------------------------------------------------------
>>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>>> 
>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>> 
>>>>>>> -- 
>>>>>>> Roger Bivand
>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> ----------------------------------------------------------------
>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>> 
>>>>> 
>>>> 
>>>> -- 
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>> 
>>> 
>>> 
>>> 
>>> ----------------------------------------------------------------
>>> This message was sent through https://webmail.uni-jena.de
>> 
>> -- 
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> 
>
>
>
> ----------------------------------------------------------------
> This message was sent through https://webmail.uni-jena.de

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Kerstin.Traut at uni-jena.de  Thu Jul 12 17:56:10 2012
From: Kerstin.Traut at uni-jena.de (Kerstin Traut)
Date: Thu, 12 Jul 2012 17:56:10 +0200
Subject: [R-sig-Geo]
 =?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
 =?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <alpine.LRH.2.02.1207121749070.23207@reclus.nhh.no>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
	<20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121749070.23207@reclus.nhh.no>
Message-ID: <20120712175610.18883xphlqkwqg00@webmail.uni-jena.de>

Zitat von Roger Bivand <Roger.Bivand at nhh.no>:

> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>
>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>
>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>
>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>
>>>>> On Thu, 12 Jul 2012, Roger Bivand wrote:
>>>>>
>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>
>>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>
>>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>>>
>>>>>>>>> Hi,
>>>>>>>>>
>>>>>>>>> I have a question on testing spatial autocorrelation on  
>>>>>>>>> raster data including NA-values. In particular, I like to  
>>>>>>>>> calculate Moran?s I and Geary?s C indices by using inverse  
>>>>>>>>> distance weighting matrices.
>>>>>>>>> Calculating Moran?s I with moran.test works fine, because  
>>>>>>>>> the function contains the option "na.action=na.pass".  
>>>>>>>>> Unfortunately, the function geary.test does not contain this  
>>>>>>>>> option. The problem is that geary.test needs an nb argument  
>>>>>>>>> for which I cannot perform for example nb<-ifelse(value, nb,  
>>>>>>>>> NA), because it would change the nb-format to a list-format.
>>>>>>>>> Is there a way to ignore NA-values in geary.test? Or how can  
>>>>>>>>> I set NA values in a neigbors (nb) list?
>>>>>>>>
>>>>>>>> The simple answer is to subset the variable of interest and  
>>>>>>>> the nb object to omit NA observations (which is what  
>>>>>>>> moran.test does internally). Alternatively, you could  
>>>>>>>> contribute a patch to geary.test(), if you like.
>>>>>>>>
>>>>>>>> Hope this helps,
>>>>>>>>
>>>>>>>> Roger
>>>>>>>
>>>>>>> Thanks for your answer. Unfortunately, I think that subsetting  
>>>>>>> is in my case not the right solution, because I need to define  
>>>>>>> the amount of neighbors in cell2nb on the basis of a  
>>>>>>> rectangular extent (e.g. 50 x 50 neighbors). Subsetting this  
>>>>>>> extent by deleting NA-values would destroy the nb list format  
>>>>>>> required by geary.test.
>>>>>>> Is there any solution for subsetting an nb list without  
>>>>>>> destroying the nb format?
>>>>>>
>>>>>> Yes, there are subset methods for nb and listw objects. To  
>>>>>> ensure data integrity, use dnearneigh() instead of cell2nb(),  
>>>>>> and use a SpatialPointsDataFrame to hold your data. In that  
>>>>>> way, you make sure that the subset condition is applied to the  
>>>>>> same observations.
>>>>>
>>>>> The latter advice may not work if your coordinates are planar  
>>>>> and you really mean to set torus=TRUE in cell2nb(). You'll have  
>>>>> to get the data order right by deconstructing the region.id  
>>>>> attribute of the nb object created by cell2nb() to ensure data  
>>>>> integrity.
>>>>>
>>>>> Roger
>>>>
>>>> I already tested dnearneigh(), but I like to avoid this function  
>>>> because for large datasets cell2nb() calculates neighbors more  
>>>> quickly.
>>>> Thanks to your suggestion I was able to subset the nb list by  
>>>> using nb.subset(). But I could not find a suitable function for  
>>>> subsetting a listw. Using the subset() function results in the  
>>>> following error message: "Not yet able to subset general weights  
>>>> lists". Do you have an explaination?
>>>
>>> Yes, because the changes may not be appropriate, depending on how  
>>> the general weights were defined. In your case, subset the nb  
>>> object and the list of idw weights, and rebuild the listw object  
>>> with the subsetted objects.
>>>
>>> Roger
>>
>> That?s what I already tried, but the error message says "neighbors  
>> and glist do not conform"??
>
> Right, you'll need to rebuild from the subsetted nb object from the  
> nbdists() step (and subsetted coordinates), because the subsetted  
> idw list will have weights for excluded observations.
>
> Roger

Ok, I hope I understood everything right. You mean, firstly, I need to  
subset my nb list and afterwards, I need to calculate the nb-distances  
using nbdists()?

Kerstin


>>
>> Kerstin
>>
>>>>
>>>> Kerstin
>>>>
>>>>
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>>
>>>>>>> Kind regards,
>>>>>>> Kerstin
>>>>>>>
>>>>>>>
>>>>>>>>> Thank you very much,
>>>>>>>>> Kerstin
>>>>>>>>>
>>>>>>>>> ---
>>>>>>>>>
>>>>>>>>> file<-raster(test.tif")
>>>>>>>>> mask<-extent(file, 1, 50, 1, 50)
>>>>>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>>>>>>> value <- as.matrix(subset)
>>>>>>>>>
>>>>>>>>> # Creation of a list of integer vectors giving the region id  
>>>>>>>>> numbers for the neighbors within the grid extent
>>>>>>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>>>>>
>>>>>>>>> # Calculation of the distances along the links in the neighbous list
>>>>>>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>>>>>>>
>>>>>>>>> # Converting the distances to inverse distance values
>>>>>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>>>>>
>>>>>>>>> # Supplementing the neighbors list with spatial weights for  
>>>>>>>>> a coding scheme
>>>>>>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>>>>>>> summary(unlist(nb.idw$weights))
>>>>>>>>>
>>>>>>>>> # Moran's test (two-sided)
>>>>>>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy  
>>>>>>>>> = TRUE, na.action=na.pass, alternative="two.sided")
>>>>>>>>> moran.global
>>>>>>>>>
>>>>>>>>> # Geary's test (two-sided)
>>>>>>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy  
>>>>>>>>> = TRUE , alternative="two.sided")
>>>>>>>>> geary.global
>>>>>>>>>
>>>>>>>>> ----------------------------------------------------------------
>>>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>>> -- 
>>>>>>>> Roger Bivand
>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ----------------------------------------------------------------
>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>
>>>>>>
>>>>>
>>>>> -- 
>>>>> Roger Bivand
>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>
>>>>
>>>>
>>>> ----------------------------------------------------------------
>>>> This message was sent through https://webmail.uni-jena.de
>>>
>>> -- 
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>
>>
>>
>> ----------------------------------------------------------------
>> This message was sent through https://webmail.uni-jena.de
>
> -- 
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



----------------------------------------------------------------
This message was sent through https://webmail.uni-jena.de


From coleman.krawczyk at gmail.com  Thu Jul 12 18:02:26 2012
From: coleman.krawczyk at gmail.com (cmk24)
Date: Thu, 12 Jul 2012 09:02:26 -0700 (PDT)
Subject: [R-sig-Geo] Kriging with known, varying measurement errors
Message-ID: <1342108946537-7580451.post@n2.nabble.com>

I am trying to use R to krige data that has known, varying measurement
errors.  From the gstat user manual it seems like this should be possible, I
just can't figure out hot to implement it.  Does anyone know how I can do
this?

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Kriging-with-known-varying-measurement-errors-tp7580451.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Thu Jul 12 18:04:11 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jul 2012 18:04:11 +0200 (CEST)
Subject: [R-sig-Geo]
	=?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
	=?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <20120712175610.18883xphlqkwqg00@webmail.uni-jena.de>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
	<20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121749070.23207@reclus.nhh.no>
	<20120712175610.18883xphlqkwqg00@webmail.uni-jena.de>
Message-ID: <alpine.LRH.2.02.1207121757230.23207@reclus.nhh.no>

On Thu, 12 Jul 2012, Kerstin Traut wrote:

> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>
>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>> 
>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>> 
>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>> 
>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>> 
>>>>>> On Thu, 12 Jul 2012, Roger Bivand wrote:
>>>>>> 
>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>> 
>>>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>> 
>>>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>>>> 
>>>>>>>>>> Hi,
>>>>>>>>>> 
>>>>>>>>>> I have a question on testing spatial autocorrelation on raster data 
>>>>>>>>>> including NA-values. In particular, I like to calculate Moran?s I 
>>>>>>>>>> and Geary?s C indices by using inverse distance weighting matrices.
>>>>>>>>>> Calculating Moran?s I with moran.test works fine, because the 
>>>>>>>>>> function contains the option "na.action=na.pass". Unfortunately, 
>>>>>>>>>> the function geary.test does not contain this option. The problem 
>>>>>>>>>> is that geary.test needs an nb argument for which I cannot perform 
>>>>>>>>>> for example nb<-ifelse(value, nb, NA), because it would change the 
>>>>>>>>>> nb-format to a list-format.
>>>>>>>>>> Is there a way to ignore NA-values in geary.test? Or how can I set 
>>>>>>>>>> NA values in a neigbors (nb) list?
>>>>>>>>> 
>>>>>>>>> The simple answer is to subset the variable of interest and the nb 
>>>>>>>>> object to omit NA observations (which is what moran.test does 
>>>>>>>>> internally). Alternatively, you could contribute a patch to 
>>>>>>>>> geary.test(), if you like.
>>>>>>>>> 
>>>>>>>>> Hope this helps,
>>>>>>>>> 
>>>>>>>>> Roger
>>>>>>>> 
>>>>>>>> Thanks for your answer. Unfortunately, I think that subsetting is in 
>>>>>>>> my case not the right solution, because I need to define the amount 
>>>>>>>> of neighbors in cell2nb on the basis of a rectangular extent (e.g. 50 
>>>>>>>> x 50 neighbors). Subsetting this extent by deleting NA-values would 
>>>>>>>> destroy the nb list format required by geary.test.
>>>>>>>> Is there any solution for subsetting an nb list without destroying 
>>>>>>>> the nb format?
>>>>>>> 
>>>>>>> Yes, there are subset methods for nb and listw objects. To ensure data 
>>>>>>> integrity, use dnearneigh() instead of cell2nb(), and use a 
>>>>>>> SpatialPointsDataFrame to hold your data. In that way, you make sure 
>>>>>>> that the subset condition is applied to the same observations.
>>>>>> 
>>>>>> The latter advice may not work if your coordinates are planar and you 
>>>>>> really mean to set torus=TRUE in cell2nb(). You'll have to get the data 
>>>>>> order right by deconstructing the region.id attribute of the nb object 
>>>>>> created by cell2nb() to ensure data integrity.
>>>>>> 
>>>>>> Roger
>>>>> 
>>>>> I already tested dnearneigh(), but I like to avoid this function because 
>>>>> for large datasets cell2nb() calculates neighbors more quickly.
>>>>> Thanks to your suggestion I was able to subset the nb list by using 
>>>>> nb.subset(). But I could not find a suitable function for subsetting a 
>>>>> listw. Using the subset() function results in the following error 
>>>>> message: "Not yet able to subset general weights lists". Do you have an 
>>>>> explaination?
>>>> 
>>>> Yes, because the changes may not be appropriate, depending on how the 
>>>> general weights were defined. In your case, subset the nb object and the 
>>>> list of idw weights, and rebuild the listw object with the subsetted 
>>>> objects.
>>>> 
>>>> Roger
>>> 
>>> That?s what I already tried, but the error message says "neighbors and 
>>> glist do not conform"??
>> 
>> Right, you'll need to rebuild from the subsetted nb object from the 
>> nbdists() step (and subsetted coordinates), because the subsetted idw list 
>> will have weights for excluded observations.
>> 
>> Roger
>
> Ok, I hope I understood everything right. You mean, firstly, I need to subset 
> my nb list and afterwards, I need to calculate the nb-distances using 
> nbdists()?

Yes, that will give consistent results when the listw object contains 
general weights. The same would apply to moran.test() with a listw object 
with general weights, I would have thought based on the code of 
subset.listw(), so I suggest not using na.pass in the moran.test() call, 
and doing the same reconstruction before calling the tests. I'd be 
interested in seeing an example of data (value, nb.idw, 
coordinates(subset)),  that run successfully through moran.test() because 
it should also fail on general weights.

Roger



>
> Kerstin
>
>
>>> 
>>> Kerstin
>>> 
>>>>> 
>>>>> Kerstin
>>>>> 
>>>>> 
>>>>>>> 
>>>>>>> Roger
>>>>>>> 
>>>>>>>> 
>>>>>>>> Kind regards,
>>>>>>>> Kerstin
>>>>>>>> 
>>>>>>>> 
>>>>>>>>>> Thank you very much,
>>>>>>>>>> Kerstin
>>>>>>>>>> 
>>>>>>>>>> ---
>>>>>>>>>> 
>>>>>>>>>> file<-raster(test.tif")
>>>>>>>>>> mask<-extent(file, 1, 50, 1, 50)
>>>>>>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>>>>>>>> value <- as.matrix(subset)
>>>>>>>>>> 
>>>>>>>>>> # Creation of a list of integer vectors giving the region id 
>>>>>>>>>> numbers for the neighbors within the grid extent
>>>>>>>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>>>>>> 
>>>>>>>>>> # Calculation of the distances along the links in the neighbous 
>>>>>>>>>> list
>>>>>>>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>>>>>>>> 
>>>>>>>>>> # Converting the distances to inverse distance values
>>>>>>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>>>>>> 
>>>>>>>>>> # Supplementing the neighbors list with spatial weights for a 
>>>>>>>>>> coding scheme
>>>>>>>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>>>>>>>> summary(unlist(nb.idw$weights))
>>>>>>>>>> 
>>>>>>>>>> # Moran's test (two-sided)
>>>>>>>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy = TRUE, 
>>>>>>>>>> na.action=na.pass, alternative="two.sided")
>>>>>>>>>> moran.global
>>>>>>>>>> 
>>>>>>>>>> # Geary's test (two-sided)
>>>>>>>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy = TRUE 
>>>>>>>>>> , alternative="two.sided")
>>>>>>>>>> geary.global
>>>>>>>>>> 
>>>>>>>>>> ----------------------------------------------------------------
>>>>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>>>>> 
>>>>>>>>>> _______________________________________________
>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>> 
>>>>>>>>> -- 
>>>>>>>>> Roger Bivand
>>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>> 
>>>>>>>> 
>>>>>>>> 
>>>>>>>> 
>>>>>>>> ----------------------------------------------------------------
>>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>> 
>>>>>>> 
>>>>>> 
>>>>>> -- 
>>>>>> Roger Bivand
>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> ----------------------------------------------------------------
>>>>> This message was sent through https://webmail.uni-jena.de
>>>> 
>>>> -- 
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>> 
>>> 
>>> 
>>> 
>>> ----------------------------------------------------------------
>>> This message was sent through https://webmail.uni-jena.de
>> 
>> -- 
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> 
>
>
>
> ----------------------------------------------------------------
> This message was sent through https://webmail.uni-jena.de

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Kerstin.Traut at uni-jena.de  Thu Jul 12 19:31:04 2012
From: Kerstin.Traut at uni-jena.de (Kerstin Traut)
Date: Thu, 12 Jul 2012 19:31:04 +0200
Subject: [R-sig-Geo]
 =?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
 =?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <alpine.LRH.2.02.1207121757230.23207@reclus.nhh.no>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
	<20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121749070.23207@reclus.nhh.no>
	<20120712175610.18883xphlqkwqg00@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121757230.23207@reclus.nhh.no>
Message-ID: <20120712193104.162521wsjgtf7xtw@webmail.uni-jena.de>

Zitat von Roger Bivand <Roger.Bivand at nhh.no>:

> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>
>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>
>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>
>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>
>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>
>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>
>>>>>>> On Thu, 12 Jul 2012, Roger Bivand wrote:
>>>>>>>
>>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>>>
>>>>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>>
>>>>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>>>>>
>>>>>>>>>>> Hi,
>>>>>>>>>>>
>>>>>>>>>>> I have a question on testing spatial autocorrelation on  
>>>>>>>>>>> raster data including NA-values. In particular, I like to  
>>>>>>>>>>> calculate Moran?s I and Geary?s C indices by using inverse  
>>>>>>>>>>> distance weighting matrices.
>>>>>>>>>>> Calculating Moran?s I with moran.test works fine, because  
>>>>>>>>>>> the function contains the option "na.action=na.pass".  
>>>>>>>>>>> Unfortunately, the function geary.test does not contain  
>>>>>>>>>>> this option. The problem is that geary.test needs an nb  
>>>>>>>>>>> argument for which I cannot perform for example  
>>>>>>>>>>> nb<-ifelse(value, nb, NA), because it would change the  
>>>>>>>>>>> nb-format to a list-format.
>>>>>>>>>>> Is there a way to ignore NA-values in geary.test? Or how  
>>>>>>>>>>> can I set NA values in a neigbors (nb) list?
>>>>>>>>>>
>>>>>>>>>> The simple answer is to subset the variable of interest and  
>>>>>>>>>> the nb object to omit NA observations (which is what  
>>>>>>>>>> moran.test does internally). Alternatively, you could  
>>>>>>>>>> contribute a patch to geary.test(), if you like.
>>>>>>>>>>
>>>>>>>>>> Hope this helps,
>>>>>>>>>>
>>>>>>>>>> Roger
>>>>>>>>>
>>>>>>>>> Thanks for your answer. Unfortunately, I think that  
>>>>>>>>> subsetting is in my case not the right solution, because I  
>>>>>>>>> need to define the amount of neighbors in cell2nb on the  
>>>>>>>>> basis of a rectangular extent (e.g. 50 x 50 neighbors).  
>>>>>>>>> Subsetting this extent by deleting NA-values would destroy  
>>>>>>>>> the nb list format required by geary.test.
>>>>>>>>> Is there any solution for subsetting an nb list without  
>>>>>>>>> destroying the nb format?
>>>>>>>>
>>>>>>>> Yes, there are subset methods for nb and listw objects. To  
>>>>>>>> ensure data integrity, use dnearneigh() instead of cell2nb(),  
>>>>>>>> and use a SpatialPointsDataFrame to hold your data. In that  
>>>>>>>> way, you make sure that the subset condition is applied to  
>>>>>>>> the same observations.
>>>>>>>
>>>>>>> The latter advice may not work if your coordinates are planar  
>>>>>>> and you really mean to set torus=TRUE in cell2nb(). You'll  
>>>>>>> have to get the data order right by deconstructing the  
>>>>>>> region.id attribute of the nb object created by cell2nb() to  
>>>>>>> ensure data integrity.
>>>>>>>
>>>>>>> Roger
>>>>>>
>>>>>> I already tested dnearneigh(), but I like to avoid this  
>>>>>> function because for large datasets cell2nb() calculates  
>>>>>> neighbors more quickly.
>>>>>> Thanks to your suggestion I was able to subset the nb list by  
>>>>>> using nb.subset(). But I could not find a suitable function for  
>>>>>> subsetting a listw. Using the subset() function results in the  
>>>>>> following error message: "Not yet able to subset general  
>>>>>> weights lists". Do you have an explaination?
>>>>>
>>>>> Yes, because the changes may not be appropriate, depending on  
>>>>> how the general weights were defined. In your case, subset the  
>>>>> nb object and the list of idw weights, and rebuild the listw  
>>>>> object with the subsetted objects.
>>>>>
>>>>> Roger
>>>>
>>>> That?s what I already tried, but the error message says  
>>>> "neighbors and glist do not conform"??
>>>
>>> Right, you'll need to rebuild from the subsetted nb object from  
>>> the nbdists() step (and subsetted coordinates), because the  
>>> subsetted idw list will have weights for excluded observations.
>>>
>>> Roger
>>
>> Ok, I hope I understood everything right. You mean, firstly, I need  
>> to subset my nb list and afterwards, I need to calculate the  
>> nb-distances using nbdists()?
>
> Yes, that will give consistent results when the listw object  
> contains general weights. The same would apply to moran.test() with  
> a listw object with general weights, I would have thought based on  
> the code of subset.listw(), so I suggest not using na.pass in the  
> moran.test() call, and doing the same reconstruction before calling  
> the tests. I'd be interested in seeing an example of data (value,  
> nb.idw, coordinates(subset)),  that run successfully through  
> moran.test() because it should also fail on general weights.
>
> Roger

Finally, after some more failed trials the geary.test() is working for  
my dataset. Thank you so much for your suggestions!
I tested moran.test() with the consistent method against the na.pass  
method. For the first method I got an I-value of 0.7952, for the  
second a Moran?s I value of 0.79477. Do you know, how to explain this  
small (but existing) difference?

Kerstin

>>
>> Kerstin
>>
>>
>>>>
>>>> Kerstin
>>>>
>>>>>>
>>>>>> Kerstin
>>>>>>
>>>>>>
>>>>>>>>
>>>>>>>> Roger
>>>>>>>>
>>>>>>>>>
>>>>>>>>> Kind regards,
>>>>>>>>> Kerstin
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>>> Thank you very much,
>>>>>>>>>>> Kerstin
>>>>>>>>>>>
>>>>>>>>>>> ---
>>>>>>>>>>>
>>>>>>>>>>> file<-raster(test.tif")
>>>>>>>>>>> mask<-extent(file, 1, 50, 1, 50)
>>>>>>>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>>>>>>>>> value <- as.matrix(subset)
>>>>>>>>>>>
>>>>>>>>>>> # Creation of a list of integer vectors giving the region  
>>>>>>>>>>> id numbers for the neighbors within the grid extent
>>>>>>>>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>>>>>>>
>>>>>>>>>>> # Calculation of the distances along the links in the  
>>>>>>>>>>> neighbous list
>>>>>>>>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>>>>>>>>>
>>>>>>>>>>> # Converting the distances to inverse distance values
>>>>>>>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>>>>>>>
>>>>>>>>>>> # Supplementing the neighbors list with spatial weights  
>>>>>>>>>>> for a coding scheme
>>>>>>>>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>>>>>>>>> summary(unlist(nb.idw$weights))
>>>>>>>>>>>
>>>>>>>>>>> # Moran's test (two-sided)
>>>>>>>>>>> moran.global <- moran.test(value, listw=nb.idw,  
>>>>>>>>>>> zero.policy = TRUE, na.action=na.pass,  
>>>>>>>>>>> alternative="two.sided")
>>>>>>>>>>> moran.global
>>>>>>>>>>>
>>>>>>>>>>> # Geary's test (two-sided)
>>>>>>>>>>> geary.global <- geary.test(value, listw=nb.idw,  
>>>>>>>>>>> zero.policy = TRUE , alternative="two.sided")
>>>>>>>>>>> geary.global
>>>>>>>>>>>
>>>>>>>>>>> ----------------------------------------------------------------
>>>>>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>
>>>>>>>>>> -- 
>>>>>>>>>> Roger Bivand
>>>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> ----------------------------------------------------------------
>>>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>> -- 
>>>>>>> Roger Bivand
>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> ----------------------------------------------------------------
>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>
>>>>> -- 
>>>>> Roger Bivand
>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>
>>>>
>>>>
>>>> ----------------------------------------------------------------
>>>> This message was sent through https://webmail.uni-jena.de
>>>
>>> -- 
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>
>>
>>
>> ----------------------------------------------------------------
>> This message was sent through https://webmail.uni-jena.de
>
> -- 
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



----------------------------------------------------------------
This message was sent through https://webmail.uni-jena.de


From djrwicks at gmail.com  Thu Jul 12 20:09:32 2012
From: djrwicks at gmail.com (djrwicks)
Date: Thu, 12 Jul 2012 11:09:32 -0700 (PDT)
Subject: [R-sig-Geo]
 =?utf-8?q?How_to_handle_NA-values_in_raster-based_Gea?=
 =?utf-8?q?ry=C2=B4s_C_test=3F?=
In-Reply-To: <20120712193104.162521wsjgtf7xtw@webmail.uni-jena.de>
References: <20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
	<20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121749070.23207@reclus.nhh.no>
	<20120712175610.18883xphlqkwqg00@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121757230.23207@reclus.nhh.no>
	<20120712193104.162521wsjgtf7xtw@webmail.uni-jena.de>
Message-ID: <1342116572565-7580454.post@n2.nabble.com>

Hi Kerstin,

I have been suffering from a similar problem to you with NA values in my
raster dataset.  I was wondering if you might post or email me your revised
script so I can use it to troubleshooting along with the suggestions in this
thread?

Many thanks,

Dan.

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/How-to-handle-NA-values-in-raster-based-Geary-s-C-test-tp7580439p7580454.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From gianni.lavaredo at gmail.com  Thu Jul 12 20:12:26 2012
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Thu, 12 Jul 2012 20:12:26 +0200
Subject: [R-sig-Geo] Help to find a way to which voxel a point in space
 lies inside
In-Reply-To: <201207121516.q6CFGhUv019144@smtp.upm.es>
References: <CAJ6JbR8Rt-BVMx30UqZg09T3=dzq48JDJAJpwkPivkoR2E=0+Q@mail.gmail.com>
	<201207121413.q6CEDkXE013877@smtp.upm.es>
	<CAJ6JbR-BqsFy85oSUc1homnFkatAFDiW7MPc17a096O==d9dgw@mail.gmail.com>
	<201207121516.q6CFGhUv019144@smtp.upm.es>
Message-ID: <CAJ6JbR8EWBpJ7pdnTAkN0y6qW-AppM+P+L+TpDCT_-JKAj3pCw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120712/d27c01e0/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jul 12 21:31:30 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 12 Jul 2012 21:31:30 +0200 (CEST)
Subject: [R-sig-Geo]
	=?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
	=?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <20120712193104.162521wsjgtf7xtw@webmail.uni-jena.de>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
	<20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121749070.23207@reclus.nhh.no>
	<20120712175610.18883xphlqkwqg00@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121757230.23207@reclus.nhh.no>
	<20120712193104.162521wsjgtf7xtw@webmail.uni-jena.de>
Message-ID: <alpine.LRH.2.02.1207122127060.23207@reclus.nhh.no>

On Thu, 12 Jul 2012, Kerstin Traut wrote:

> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>
>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>> 
>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>> 
>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>> 
>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>> 
>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>> 
>>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>> 
>>>>>>>> On Thu, 12 Jul 2012, Roger Bivand wrote:
>>>>>>>> 
>>>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>>>> 
>>>>>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>>> 
>>>>>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>>>>>> 
>>>>>>>>>>>> Hi,
>>>>>>>>>>>> 
>>>>>>>>>>>> I have a question on testing spatial autocorrelation on raster 
>>>>>>>>>>>> data including NA-values. In particular, I like to calculate 
>>>>>>>>>>>> Moran?s I and Geary?s C indices by using inverse distance 
>>>>>>>>>>>> weighting matrices.
>>>>>>>>>>>> Calculating Moran?s I with moran.test works fine, because the 
>>>>>>>>>>>> function contains the option "na.action=na.pass". Unfortunately, 
>>>>>>>>>>>> the function geary.test does not contain this option. The problem 
>>>>>>>>>>>> is that geary.test needs an nb argument for which I cannot 
>>>>>>>>>>>> perform for example nb<-ifelse(value, nb, NA), because it would 
>>>>>>>>>>>> change the nb-format to a list-format.
>>>>>>>>>>>> Is there a way to ignore NA-values in geary.test? Or how can I 
>>>>>>>>>>>> set NA values in a neigbors (nb) list?
>>>>>>>>>>> 
>>>>>>>>>>> The simple answer is to subset the variable of interest and the nb 
>>>>>>>>>>> object to omit NA observations (which is what moran.test does 
>>>>>>>>>>> internally). Alternatively, you could contribute a patch to 
>>>>>>>>>>> geary.test(), if you like.
>>>>>>>>>>> 
>>>>>>>>>>> Hope this helps,
>>>>>>>>>>> 
>>>>>>>>>>> Roger
>>>>>>>>>> 
>>>>>>>>>> Thanks for your answer. Unfortunately, I think that subsetting is 
>>>>>>>>>> in my case not the right solution, because I need to define the 
>>>>>>>>>> amount of neighbors in cell2nb on the basis of a rectangular extent 
>>>>>>>>>> (e.g. 50 x 50 neighbors). Subsetting this extent by deleting 
>>>>>>>>>> NA-values would destroy the nb list format required by geary.test.
>>>>>>>>>> Is there any solution for subsetting an nb list without destroying 
>>>>>>>>>> the nb format?
>>>>>>>>> 
>>>>>>>>> Yes, there are subset methods for nb and listw objects. To ensure 
>>>>>>>>> data integrity, use dnearneigh() instead of cell2nb(), and use a 
>>>>>>>>> SpatialPointsDataFrame to hold your data. In that way, you make sure 
>>>>>>>>> that the subset condition is applied to the same observations.
>>>>>>>> 
>>>>>>>> The latter advice may not work if your coordinates are planar and you 
>>>>>>>> really mean to set torus=TRUE in cell2nb(). You'll have to get the 
>>>>>>>> data order right by deconstructing the region.id attribute of the nb 
>>>>>>>> object created by cell2nb() to ensure data integrity.
>>>>>>>> 
>>>>>>>> Roger
>>>>>>> 
>>>>>>> I already tested dnearneigh(), but I like to avoid this function 
>>>>>>> because for large datasets cell2nb() calculates neighbors more 
>>>>>>> quickly.
>>>>>>> Thanks to your suggestion I was able to subset the nb list by using 
>>>>>>> nb.subset(). But I could not find a suitable function for subsetting a 
>>>>>>> listw. Using the subset() function results in the following error 
>>>>>>> message: "Not yet able to subset general weights lists". Do you have 
>>>>>>> an explaination?
>>>>>> 
>>>>>> Yes, because the changes may not be appropriate, depending on how the 
>>>>>> general weights were defined. In your case, subset the nb object and 
>>>>>> the list of idw weights, and rebuild the listw object with the 
>>>>>> subsetted objects.
>>>>>> 
>>>>>> Roger
>>>>> 
>>>>> That?s what I already tried, but the error message says "neighbors and 
>>>>> glist do not conform"??
>>>> 
>>>> Right, you'll need to rebuild from the subsetted nb object from the 
>>>> nbdists() step (and subsetted coordinates), because the subsetted idw 
>>>> list will have weights for excluded observations.
>>>> 
>>>> Roger
>>> 
>>> Ok, I hope I understood everything right. You mean, firstly, I need to 
>>> subset my nb list and afterwards, I need to calculate the nb-distances 
>>> using nbdists()?
>> 
>> Yes, that will give consistent results when the listw object contains 
>> general weights. The same would apply to moran.test() with a listw object 
>> with general weights, I would have thought based on the code of 
>> subset.listw(), so I suggest not using na.pass in the moran.test() call, 
>> and doing the same reconstruction before calling the tests. I'd be 
>> interested in seeing an example of data (value, nb.idw, 
>> coordinates(subset)),  that run successfully through moran.test() because 
>> it should also fail on general weights.
>> 
>> Roger
>
> Finally, after some more failed trials the geary.test() is working for my 
> dataset. Thank you so much for your suggestions!
> I tested moran.test() with the consistent method against the na.pass method. 
> For the first method I got an I-value of 0.7952, for the second a Moran?s I 
> value of 0.79477. Do you know, how to explain this small (but existing) 
> difference?

Using na.action=na.pass allows NA values, and will give a different result 
at least, I think, because na.pass does not adjust n (subtracting NA 
observations), nor does it subset. If you use na.action=na.omit, n will be 
reduced as in the consistent method, but subset.listw() fails because the 
"mode" attribute of the weights component of the listw object is not 
"binary". I think here that you should rely on subsetting manually.

Hope this clarifies,

Roger

>
> Kerstin
>
>>> 
>>> Kerstin
>>> 
>>> 
>>>>> 
>>>>> Kerstin
>>>>> 
>>>>>>> 
>>>>>>> Kerstin
>>>>>>> 
>>>>>>> 
>>>>>>>>> 
>>>>>>>>> Roger
>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> Kind regards,
>>>>>>>>>> Kerstin
>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>>>> Thank you very much,
>>>>>>>>>>>> Kerstin
>>>>>>>>>>>> 
>>>>>>>>>>>> ---
>>>>>>>>>>>> 
>>>>>>>>>>>> file<-raster(test.tif")
>>>>>>>>>>>> mask<-extent(file, 1, 50, 1, 50)
>>>>>>>>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE)
>>>>>>>>>>>> value <- as.matrix(subset)
>>>>>>>>>>>> 
>>>>>>>>>>>> # Creation of a list of integer vectors giving the region id 
>>>>>>>>>>>> numbers for the neighbors within the grid extent
>>>>>>>>>>>> nb <- cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>>>>>>>> 
>>>>>>>>>>>> # Calculation of the distances along the links in the neighbous 
>>>>>>>>>>>> list
>>>>>>>>>>>> dist <- nbdists(nb, coordinates(subset), longlat=TRUE)
>>>>>>>>>>>> 
>>>>>>>>>>>> # Converting the distances to inverse distance values
>>>>>>>>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>>>>>>>> 
>>>>>>>>>>>> # Supplementing the neighbors list with spatial weights for a 
>>>>>>>>>>>> coding scheme
>>>>>>>>>>>> nb.idw <- nb2listw(nb, glist=inv.dist, style="W")
>>>>>>>>>>>> summary(unlist(nb.idw$weights))
>>>>>>>>>>>> 
>>>>>>>>>>>> # Moran's test (two-sided)
>>>>>>>>>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy = 
>>>>>>>>>>>> TRUE, na.action=na.pass, alternative="two.sided")
>>>>>>>>>>>> moran.global
>>>>>>>>>>>> 
>>>>>>>>>>>> # Geary's test (two-sided)
>>>>>>>>>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy = 
>>>>>>>>>>>> TRUE , alternative="two.sided")
>>>>>>>>>>>> geary.global
>>>>>>>>>>>> 
>>>>>>>>>>>> ----------------------------------------------------------------
>>>>>>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>>>>>>> 
>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>> 
>>>>>>>>>>> -- 
>>>>>>>>>>> Roger Bivand
>>>>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> ----------------------------------------------------------------
>>>>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>>>>> 
>>>>>>>>> 
>>>>>>>> 
>>>>>>>> -- 
>>>>>>>> Roger Bivand
>>>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> ----------------------------------------------------------------
>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>> 
>>>>>> -- 
>>>>>> Roger Bivand
>>>>>> Department of Economics, NHH Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> ----------------------------------------------------------------
>>>>> This message was sent through https://webmail.uni-jena.de
>>>> 
>>>> -- 
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>> 
>>> 
>>> 
>>> 
>>> ----------------------------------------------------------------
>>> This message was sent through https://webmail.uni-jena.de
>> 
>> -- 
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> 
>
>
>
> ----------------------------------------------------------------
> This message was sent through https://webmail.uni-jena.de

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From kerstin.traut at uni-jena.de  Thu Jul 12 22:16:55 2012
From: kerstin.traut at uni-jena.de (Kerstin Traut)
Date: Thu, 12 Jul 2012 22:16:55 +0200
Subject: [R-sig-Geo]
	=?iso-8859-1?q?How_to_handle_NA-values_in_raster-base?=
	=?iso-8859-1?q?d_Geary=B4s_C_test=3F?=
In-Reply-To: <alpine.LRH.2.02.1207122127060.23207@reclus.nhh.no>
References: <20120712161611.16434jou1bhan604@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121631170.23207@reclus.nhh.no>
	<20120712165035.14135lfmyca88d0c@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121653000.23207@reclus.nhh.no>
	<alpine.LRH.2.02.1207121659100.23207@reclus.nhh.no>
	<20120712174213.10501eu3zy955b34@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121743380.23207@reclus.nhh.no>
	<20120712174835.80361rjrfg30xhb4@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121749070.23207@reclus.nhh.no>
	<20120712175610.18883xphlqkwqg00@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207121757230.23207@reclus.nhh.no>
	<20120712193104.162521wsjgtf7xtw@webmail.uni-jena.de>
	<alpine.LRH.2.02.1207122127060.23207@reclus.nhh.no>
Message-ID: <002c01cd606b$48bdae10$da390a30$@traut@uni-jena.de>



-----Urspr?ngliche Nachricht-----
Von: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Gesendet: Donnerstag, 12. Juli 2012 21:32
An: Kerstin Traut
Cc: r-sig-geo at r-project.org
Betreff: Re: [R-sig-Geo] How to handle NA-values in raster-based Geary?s C
test?

On Thu, 12 Jul 2012, Kerstin Traut wrote:

> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>
>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>> 
>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>> 
>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>> 
>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>> 
>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>> 
>>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>> 
>>>>>>>> On Thu, 12 Jul 2012, Roger Bivand wrote:
>>>>>>>> 
>>>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>>>> 
>>>>>>>>>> Zitat von Roger Bivand <Roger.Bivand at nhh.no>:
>>>>>>>>>> 
>>>>>>>>>>> On Thu, 12 Jul 2012, Kerstin Traut wrote:
>>>>>>>>>>> 
>>>>>>>>>>>> Hi,
>>>>>>>>>>>> 
>>>>>>>>>>>> I have a question on testing spatial autocorrelation on 
>>>>>>>>>>>> raster data including NA-values. In particular, I like to 
>>>>>>>>>>>> calculate Moran?s I and Geary?s C indices by using inverse 
>>>>>>>>>>>> distance weighting matrices.
>>>>>>>>>>>> Calculating Moran?s I with moran.test works fine, because 
>>>>>>>>>>>> the function contains the option "na.action=na.pass". 
>>>>>>>>>>>> Unfortunately, the function geary.test does not contain 
>>>>>>>>>>>> this option. The problem is that geary.test needs an nb 
>>>>>>>>>>>> argument for which I cannot perform for example 
>>>>>>>>>>>> nb<-ifelse(value, nb, NA), because it would change the
nb-format to a list-format.
>>>>>>>>>>>> Is there a way to ignore NA-values in geary.test? Or how 
>>>>>>>>>>>> can I set NA values in a neigbors (nb) list?
>>>>>>>>>>> 
>>>>>>>>>>> The simple answer is to subset the variable of interest and 
>>>>>>>>>>> the nb object to omit NA observations (which is what 
>>>>>>>>>>> moran.test does internally). Alternatively, you could 
>>>>>>>>>>> contribute a patch to geary.test(), if you like.
>>>>>>>>>>> 
>>>>>>>>>>> Hope this helps,
>>>>>>>>>>> 
>>>>>>>>>>> Roger
>>>>>>>>>> 
>>>>>>>>>> Thanks for your answer. Unfortunately, I think that 
>>>>>>>>>> subsetting is in my case not the right solution, because I 
>>>>>>>>>> need to define the amount of neighbors in cell2nb on the 
>>>>>>>>>> basis of a rectangular extent (e.g. 50 x 50 neighbors). 
>>>>>>>>>> Subsetting this extent by deleting NA-values would destroy the nb
list format required by geary.test.
>>>>>>>>>> Is there any solution for subsetting an nb list without 
>>>>>>>>>> destroying the nb format?
>>>>>>>>> 
>>>>>>>>> Yes, there are subset methods for nb and listw objects. To 
>>>>>>>>> ensure data integrity, use dnearneigh() instead of cell2nb(), 
>>>>>>>>> and use a SpatialPointsDataFrame to hold your data. In that 
>>>>>>>>> way, you make sure that the subset condition is applied to the
same observations.
>>>>>>>> 
>>>>>>>> The latter advice may not work if your coordinates are planar 
>>>>>>>> and you really mean to set torus=TRUE in cell2nb(). You'll have 
>>>>>>>> to get the data order right by deconstructing the region.id 
>>>>>>>> attribute of the nb object created by cell2nb() to ensure data
integrity.
>>>>>>>> 
>>>>>>>> Roger
>>>>>>> 
>>>>>>> I already tested dnearneigh(), but I like to avoid this function 
>>>>>>> because for large datasets cell2nb() calculates neighbors more 
>>>>>>> quickly.
>>>>>>> Thanks to your suggestion I was able to subset the nb list by 
>>>>>>> using nb.subset(). But I could not find a suitable function for 
>>>>>>> subsetting a listw. Using the subset() function results in the 
>>>>>>> following error
>>>>>>> message: "Not yet able to subset general weights lists". Do you 
>>>>>>> have an explaination?
>>>>>> 
>>>>>> Yes, because the changes may not be appropriate, depending on how 
>>>>>> the general weights were defined. In your case, subset the nb 
>>>>>> object and the list of idw weights, and rebuild the listw object 
>>>>>> with the subsetted objects.
>>>>>> 
>>>>>> Roger
>>>>> 
>>>>> That?s what I already tried, but the error message says "neighbors 
>>>>> and glist do not conform"??
>>>> 
>>>> Right, you'll need to rebuild from the subsetted nb object from the
>>>> nbdists() step (and subsetted coordinates), because the subsetted 
>>>> idw list will have weights for excluded observations.
>>>> 
>>>> Roger
>>> 
>>> Ok, I hope I understood everything right. You mean, firstly, I need 
>>> to subset my nb list and afterwards, I need to calculate the 
>>> nb-distances using nbdists()?
>> 
>> Yes, that will give consistent results when the listw object contains 
>> general weights. The same would apply to moran.test() with a listw 
>> object with general weights, I would have thought based on the code 
>> of subset.listw(), so I suggest not using na.pass in the moran.test() 
>> call, and doing the same reconstruction before calling the tests. I'd 
>> be interested in seeing an example of data (value, nb.idw, 
>> coordinates(subset)),  that run successfully through moran.test() 
>> because it should also fail on general weights.
>> 
>> Roger
>
> Finally, after some more failed trials the geary.test() is working for 
> my dataset. Thank you so much for your suggestions!
> I tested moran.test() with the consistent method against the na.pass
method. 
> For the first method I got an I-value of 0.7952, for the second a 
> Moran?s I value of 0.79477. Do you know, how to explain this small 
> (but existing) difference?

Using na.action=na.pass allows NA values, and will give a different result
at least, I think, because na.pass does not adjust n (subtracting NA
observations), nor does it subset. If you use na.action=na.omit, n will be
reduced as in the consistent method, but subset.listw() fails because the
"mode" attribute of the weights component of the listw object is not
"binary". I think here that you should rely on subsetting manually.

Hope this clarifies,

Roger

Thank you very very much! Now everything is clear!

Kind regards,
Kerstin

>
> Kerstin
>
>>> 
>>> Kerstin
>>> 
>>> 
>>>>> 
>>>>> Kerstin
>>>>> 
>>>>>>> 
>>>>>>> Kerstin
>>>>>>> 
>>>>>>> 
>>>>>>>>> 
>>>>>>>>> Roger
>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> Kind regards,
>>>>>>>>>> Kerstin
>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>>>> Thank you very much,
>>>>>>>>>>>> Kerstin
>>>>>>>>>>>> 
>>>>>>>>>>>> ---
>>>>>>>>>>>> 
>>>>>>>>>>>> file<-raster(test.tif")
>>>>>>>>>>>> mask<-extent(file, 1, 50, 1, 50) 
>>>>>>>>>>>> subset<-crop(file,mask,test.tif", overwrite=TRUE) value <- 
>>>>>>>>>>>> as.matrix(subset)
>>>>>>>>>>>> 
>>>>>>>>>>>> # Creation of a list of integer vectors giving the region 
>>>>>>>>>>>> id numbers for the neighbors within the grid extent nb <- 
>>>>>>>>>>>> cell2nb(50, 50, type="queen", torus=TRUE)
>>>>>>>>>>>> 
>>>>>>>>>>>> # Calculation of the distances along the links in the 
>>>>>>>>>>>> neighbous list dist <- nbdists(nb, coordinates(subset), 
>>>>>>>>>>>> longlat=TRUE)
>>>>>>>>>>>> 
>>>>>>>>>>>> # Converting the distances to inverse distance values 
>>>>>>>>>>>> inv.dist <- lapply(dist, function (x) 1/(x*100))
>>>>>>>>>>>> 
>>>>>>>>>>>> # Supplementing the neighbors list with spatial weights for 
>>>>>>>>>>>> a coding scheme nb.idw <- nb2listw(nb, glist=inv.dist, 
>>>>>>>>>>>> style="W")
>>>>>>>>>>>> summary(unlist(nb.idw$weights))
>>>>>>>>>>>> 
>>>>>>>>>>>> # Moran's test (two-sided)
>>>>>>>>>>>> moran.global <- moran.test(value, listw=nb.idw, zero.policy 
>>>>>>>>>>>> = TRUE, na.action=na.pass, alternative="two.sided") 
>>>>>>>>>>>> moran.global
>>>>>>>>>>>> 
>>>>>>>>>>>> # Geary's test (two-sided)
>>>>>>>>>>>> geary.global <- geary.test(value, listw=nb.idw, zero.policy 
>>>>>>>>>>>> = TRUE , alternative="two.sided") geary.global
>>>>>>>>>>>> 
>>>>>>>>>>>> -----------------------------------------------------------
>>>>>>>>>>>> ----- This message was sent through 
>>>>>>>>>>>> https://webmail.uni-jena.de
>>>>>>>>>>>> 
>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>> 
>>>>>>>>>>> --
>>>>>>>>>>> Roger Bivand
>>>>>>>>>>> Department of Economics, NHH Norwegian School of Economics, 
>>>>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> 
>>>>>>>>>> -------------------------------------------------------------
>>>>>>>>>> --- This message was sent through https://webmail.uni-jena.de
>>>>>>>>> 
>>>>>>>>> 
>>>>>>>> 
>>>>>>>> --
>>>>>>>> Roger Bivand
>>>>>>>> Department of Economics, NHH Norwegian School of Economics, 
>>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> ----------------------------------------------------------------
>>>>>>> This message was sent through https://webmail.uni-jena.de
>>>>>> 
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Department of Economics, NHH Norwegian School of Economics, 
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> ----------------------------------------------------------------
>>>>> This message was sent through https://webmail.uni-jena.de
>>>> 
>>>> --
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics, 
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>> 
>>> 
>>> 
>>> 
>>> ----------------------------------------------------------------
>>> This message was sent through https://webmail.uni-jena.de
>> 
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics, 
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>> 
>
>
>
> ----------------------------------------------------------------
> This message was sent through https://webmail.uni-jena.de

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics, Helleveien 30,
N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From riaarinda at gmail.com  Fri Jul 13 02:00:45 2012
From: riaarinda at gmail.com (riaarinda)
Date: Thu, 12 Jul 2012 17:00:45 -0700 (PDT)
Subject: [R-sig-Geo] Data grid in kriging?
In-Reply-To: <4FFE89DF.9090203@jrc.ec.europa.eu>
References: <1342017802946-7580428.post@n2.nabble.com>
	<4FFE89DF.9090203@jrc.ec.europa.eu>
Message-ID: <1342137645260-7580458.post@n2.nabble.com>

I think to do krige(), the shapefile must be points, not polygons. I try to
put my shapefile into mapwindow to krige but it didn't work. But after I
convert it into points shapefile through GeoDa and then put it into
mapwindow again, it can do kriging function in mapWindow.
Now I'm confused how to do krige in R. My poly shapefile contains numbers of
districts. In R, to krige we use krige(formula = log(variable)~1, data,
data.grid, model = m). I already have data as I have example.shp, but I
still don't get it what I should put as data.grid. What is data.grid? And if
you don't mind, could you tell me how to convert a polygons shapefile into
points shapefile?
Thanks a lot.

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Data-grid-in-kriging-tp7580428p7580458.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From l.cattarino at uq.edu.au  Fri Jul 13 02:25:00 2012
From: l.cattarino at uq.edu.au (Lorenzo Cattarino)
Date: Fri, 13 Jul 2012 00:25:00 +0000
Subject: [R-sig-Geo] find cells of a raster lying on a ring
Message-ID: <23582DCD2EF0CA4EA89366505DDB692809742C@UQEXMDA8.soe.uq.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120713/48693d0d/attachment.pl>

From jon.skoien at jrc.ec.europa.eu  Fri Jul 13 10:02:32 2012
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Fri, 13 Jul 2012 10:02:32 +0200
Subject: [R-sig-Geo] Data grid in kriging?
In-Reply-To: <1342137645260-7580458.post@n2.nabble.com>
References: <1342017802946-7580428.post@n2.nabble.com>
	<4FFE89DF.9090203@jrc.ec.europa.eu>
	<1342137645260-7580458.post@n2.nabble.com>
Message-ID: <4FFFD618.8060303@jrc.ec.europa.eu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120713/3b37373a/attachment.pl>

From jon.skoien at jrc.ec.europa.eu  Fri Jul 13 10:05:32 2012
From: jon.skoien at jrc.ec.europa.eu (Jon Olav Skoien)
Date: Fri, 13 Jul 2012 10:05:32 +0200
Subject: [R-sig-Geo] Kriging with known, varying measurement errors
In-Reply-To: <1342108946537-7580451.post@n2.nabble.com>
References: <1342108946537-7580451.post@n2.nabble.com>
Message-ID: <4FFFD6CC.9020303@jrc.ec.europa.eu>

You should be able to do this with the weights argument of gstat, have a 
look at this posting that answers a similar question:
http://geostatistics.forum.52north.org/Re-question-about-gstat-td2889218.html

Jon

On 12-Jul-12 18:02, cmk24 wrote:
> I am trying to use R to krige data that has known, varying measurement
> errors.  From the gstat user manual it seems like this should be possible, I
> just can't figure out hot to implement it.  Does anyone know how I can do
> this?
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Kriging-with-known-varying-measurement-errors-tp7580451.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
Jon Olav Sk?ien
Joint Research Centre - European Commission
Institute for Environment and Sustainability (IES)
Land Resource Management Unit

Via Fermi 2749, TP 440,  I-21027 Ispra (VA), ITALY

jon.skoien at jrc.ec.europa.eu
Tel:  +39 0332 789206

Disclaimer: Views expressed in this email are those of the individual and do not necessarily represent official views of the European Commission.


From marcelino.delacruz at upm.es  Fri Jul 13 10:44:41 2012
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Fri, 13 Jul 2012 10:44:41 +0200
Subject: [R-sig-Geo] find cells of a raster lying on a ring
In-Reply-To: <23582DCD2EF0CA4EA89366505DDB692809742C@UQEXMDA8.soe.uq.edu .au>
References: <23582DCD2EF0CA4EA89366505DDB692809742C@UQEXMDA8.soe.uq.edu.au>
Message-ID: <201207130846.q6D8kJaA009291@smtp.upm.es>

Well, it seems you didnt go too far ;-)

Lets say that our point is in the center of the raster

 >point <-c(5,5)

# compute the distances from this point to each 
cell of the raster (the object named "cosa")

 > mg <- expand.grid(x=seq(0,10,length=500), y=seq(0,10,length=500))
 > cosa <- crossdist(point[1],point[2],mg$x,mg$y)

# See how many cells are at *exactly* 2 units distance from the point

 >plot(M)
 > points(mg[cosa==2,],pch=19, col=2)
# none in my computer !

# See how many cells are in a ring of width 0.02 
units at  2 units distance from the point
 > points(mg[cosa<2.01 & cosa>1.99,],pch=19, col=2)

# how many?
 > sum(cosa<2.01 & cosa>1.99)

# get their values
 > M[mg[cosa<2.01 & cosa>1.99,]]


Hope this helps,

Marcelino


At 02:25 13/07/2012, Lorenzo Cattarino wrote:
>Hi R users,
>
>I would like to be able to calculate how many 
>cells of a raster, and their values (1 or 0), 
>lie at a distance r from a particular cell in 
>the raster. In other words, I need to calculate 
>the number and values of the cells lying on a 
>ring with radius r and centred in x0 and y0.
>
>This is as far I got:
>
>
>
>require(spatstat)
>
># Build an example image of 0's and 1's:
>
>M <- im(matrix(sample(0:1,500*500,TRUE),nrow=500),xcol=seq(0,10,length=500),
>
>                yrow=seq(0,10,length=500))
>
>Thanks
>Lorenzo
>
>
>         [[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

___________________________________________________

Marcelino de la Cruz Rot
Departamento de Biolog?a y Geolog?a
Escuela Superior de Ciencias Experimentales y Tecnolog?a
Universidad Rey Juan Carlos
c/ Tulip?n, s/n.
E-28933 M?stoles (Madrid)
Espa?a
Fax: +34 91 664 7490


From marcelino.delacruz at upm.es  Fri Jul 13 10:45:31 2012
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Fri, 13 Jul 2012 10:45:31 +0200
Subject: [R-sig-Geo] find cells of a raster lying on a ring
Message-ID: <201207130846.q6D8kJaC009291@smtp.upm.es>

Well, it seems you didnt go too far ;-)

Lets say that our point is in the center of the raster

 >point <-c(5,5)

# compute the distances from this point to each 
cell of the raster (the object named "cosa")

 > mg <- expand.grid(x=seq(0,10,length=500), y=seq(0,10,length=500))
 > cosa <- crossdist(point[1],point[2],mg$x,mg$y)

# See how many cells are at *exactly* 2 units distance from the point

 >plot(M)
 > points(mg[cosa==2,],pch=19, col=2)
# none in my computer !

# See how many cells are in a ring of width 0.02 
units at  2 units distance from the point
 > points(mg[cosa<2.01 & cosa>1.99,],pch=19, col=2)

# how many?
 > sum(cosa<2.01 & cosa>1.99)

# get their values
 > M[mg[cosa<2.01 & cosa>1.99,]]


Hope this helps,

Marcelino


At 02:25 13/07/2012, Lorenzo Cattarino wrote:
>Hi R users,
>
>I would like to be able to calculate how many 
>cells of a raster, and their values (1 or 0), 
>lie at a distance r from a particular cell in 
>the raster. In other words, I need to calculate 
>the number and values of the cells lying on a 
>ring with radius r and centred in x0 and y0.
>
>This is as far I got:
>
>
>
>require(spatstat)
>
># Build an example image of 0's and 1's:
>
>M <- im(matrix(sample(0:1,500*500,TRUE),nrow=500),xcol=seq(0,10,length=500),
>
>                yrow=seq(0,10,length=500))
>
>Thanks
>Lorenzo
>
>
>         [[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

___________________________________________________

Marcelino de la Cruz Rot
Departamento de Biolog?a y Geolog?a
Escuela Superior de Ciencias Experimentales y Tecnolog?a
Universidad Rey Juan Carlos
c/ Tulip?n, s/n.
E-28933 M?stoles (Madrid)
Espa?a
Fax: +34 91 664 7490


From b.rowlingson at lancaster.ac.uk  Fri Jul 13 11:13:48 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 13 Jul 2012 10:13:48 +0100
Subject: [R-sig-Geo] find cells of a raster lying on a ring
In-Reply-To: <52d300ee51e4491cad47ff340fbf8783@EX-1-HT0.lancs.local>
References: <52d300ee51e4491cad47ff340fbf8783@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNq+FpCLcT8QDxn1tqvcoKMAVE6vnhwPxsEBjSux2zjRw@mail.gmail.com>

On Fri, Jul 13, 2012 at 1:25 AM, Lorenzo Cattarino
<l.cattarino at uq.edu.au> wrote:
> Hi R users,
>
> I would like to be able to calculate how many cells of a raster, and their values (1 or 0), lie at a distance r from a particular cell in the raster. In other words, I need to calculate the number and values of the cells lying on a ring with radius r and centred in x0 and y0.
>
> This is as far I got:
>
>
>
> require(spatstat)

 stop there!

 You might want to use the raster package, especially if you are using
geo-referenced data:

 > library(raster);library(sp)
 > z = raster(matrix(runif(10000),100,100))
 > projection(z)="+init=epsg:4400"
 > pt = cbind(.2,.6)
 > zd = distanceFromPoints(z,pt)
 > circ = zd>.4 & zd<.41
 > plot(circ)

 Note the circle is here computed as all grid cells within .4 and
.4+cell size distance. Then you can easily get the values in z that
correspond to circ==TRUE...

 > summary(z[circ])
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.
0.002594 0.230600 0.479600 0.475500 0.690800 0.985400

 Another way would be to rasterize a circular line:

 > cline = cbind(.2+.4*sin(seq(0,2*pi,len=100)),.6+.4*cos(seq(0,2*pi,len=100)))
 > L = SpatialLines(list(Lines(Line(cline),"C")))
 > plot(z)
 > plot(L,add=TRUE)
 > LR = rasterize(L,z)
 > plot(LR)
 > plot(L,add=TRUE)

 but this is a bit slower, and slightly different:

 > summary(z[LR])
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.
0.003472 0.239600 0.474300 0.476800 0.692900 0.997500

Barry


From riaarinda at gmail.com  Fri Jul 13 19:02:49 2012
From: riaarinda at gmail.com (riaarinda)
Date: Fri, 13 Jul 2012 10:02:49 -0700 (PDT)
Subject: [R-sig-Geo] Data grid in kriging?
In-Reply-To: <4FFFD618.8060303@jrc.ec.europa.eu>
References: <1342017802946-7580428.post@n2.nabble.com>
	<4FFE89DF.9090203@jrc.ec.europa.eu>
	<1342137645260-7580458.post@n2.nabble.com>
	<4FFFD618.8060303@jrc.ec.europa.eu>
Message-ID: <1342198969028-7580465.post@n2.nabble.com>

You say that data.grid can be any spatial object for which I would like
predictions. How could I create it? 
I have successfully done sp1 = SpatialPointsDataFrame(coordinates(sp0), data
= sp0 at data),
but when I tried gridded(sp1) = TRUE, an error came; "suggested tolerance
minimum: 0.0764967. Error in points2grid(points, tolerance, round) :
dimension 1 : coordinate intervals are not constant"
And when I tried fullgrid(sp1) <- TRUE, another error came ; "Error in
function (classes, fdef, mtable)  : 
  unable to find an inherited method for function "fullgrid<-", for
signature "SpatialPointsDataFrame", "logical""

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Data-grid-in-kriging-tp7580428p7580465.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Fri Jul 13 22:21:02 2012
From: edzer.pebesma at uni-muenster.de (Edzer)
Date: Fri, 13 Jul 2012 22:21:02 +0200
Subject: [R-sig-Geo] Data grid in kriging?
In-Reply-To: <1342137645260-7580458.post@n2.nabble.com>
References: <1342017802946-7580428.post@n2.nabble.com>
	<4FFE89DF.9090203@jrc.ec.europa.eu>
	<1342137645260-7580458.post@n2.nabble.com>
Message-ID: <85fad091-cf09-4c06-a708-e30713bd4ea0@email.android.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120713/910fc3b9/attachment.pl>

From jwittische at hotmail.com  Sat Jul 14 03:40:45 2012
From: jwittische at hotmail.com (Julian WITTISCHE)
Date: Sat, 14 Jul 2012 01:40:45 +0000
Subject: [R-sig-Geo] About transforming BIOCLIM grid layers in a dataframe
Message-ID: <DUB115-W12033F299C2BE5817E585AFCFD60@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/6060d2fd/attachment.pl>

From r.hijmans at gmail.com  Sat Jul 14 10:18:46 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 14 Jul 2012 01:18:46 -0700
Subject: [R-sig-Geo] zlim and plot in raster
In-Reply-To: <4FFD7E6F.9050709@njn.nl>
References: <4FFD7E6F.9050709@njn.nl>
Message-ID: <CANtt_hzbK=Sf28St3YhsCxw+_kRQfa9C_xyJ5UfH3HkUvSbHdQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/a8f84abd/attachment.pl>

From r.hijmans at gmail.com  Sat Jul 14 10:25:02 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 14 Jul 2012 01:25:02 -0700
Subject: [R-sig-Geo] Conflict of raster package with function SMA of
	package TTR
In-Reply-To: <7A47CDD1-8B0C-43FF-BA2F-033DCEF8CEAC@surf2000.de>
References: <7A47CDD1-8B0C-43FF-BA2F-033DCEF8CEAC@surf2000.de>
Message-ID: <CANtt_hzpi1hzETh4_9GjadBYYjwUoHFY=yonqdPGfiPj6Zcv4A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/3afff1fa/attachment.pl>

From r.hijmans at gmail.com  Sat Jul 14 11:06:38 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 14 Jul 2012 02:06:38 -0700
Subject: [R-sig-Geo] Odd NA value of a netcdf raster
In-Reply-To: <1341921778.83387.YahooMailNeo@web121902.mail.ne1.yahoo.com>
References: <1341921778.83387.YahooMailNeo@web121902.mail.ne1.yahoo.com>
Message-ID: <CANtt_hz64kO+R+joZ1k36Us44wmoYDuGrEFGWChMRFDSRvJB2w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/b2e862b4/attachment.pl>

From r.hijmans at gmail.com  Sat Jul 14 11:08:58 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 14 Jul 2012 02:08:58 -0700
Subject: [R-sig-Geo] "regridding" netCDF?
In-Reply-To: <87mx3ew372.fsf@pobox.com>
References: <87mx3ew372.fsf@pobox.com>
Message-ID: <CANtt_hx=Ng99z1q+98czJRektuEkQ2NJg5qua5LnCuLm74WzAQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/b42a7b0e/attachment.pl>

From r.hijmans at gmail.com  Sat Jul 14 11:31:23 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 14 Jul 2012 02:31:23 -0700
Subject: [R-sig-Geo] gps file->WGS84->NAD83 Alaska stateplane zone 1
In-Reply-To: <7EC373B616FB8343A17C27C96726D8D90117038F@soajnumsg04.soa.alaska.gov>
References: <7EC373B616FB8343A17C27C96726D8D90117038F@soajnumsg04.soa.alaska.gov>
Message-ID: <CANtt_hzBtxem0UyWFvzA2eSH_dAGDZUhZ6fMhG6S7aNke=+05w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/8a251038/attachment.pl>

From r.hijmans at gmail.com  Sat Jul 14 11:36:15 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Sat, 14 Jul 2012 02:36:15 -0700
Subject: [R-sig-Geo] About transforming BIOCLIM grid layers in a
	dataframe
In-Reply-To: <DUB115-W12033F299C2BE5817E585AFCFD60@phx.gbl>
References: <DUB115-W12033F299C2BE5817E585AFCFD60@phx.gbl>
Message-ID: <CANtt_hzirJptw0uaM19xm7A8vV_V14km_TJtGM0FU35iQBbvEw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/7ec83dcb/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sat Jul 14 12:18:37 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 14 Jul 2012 11:18:37 +0100
Subject: [R-sig-Geo] gps file->WGS84->NAD83 Alaska stateplane zone 1
In-Reply-To: <5de89afb6f1748e98e630c8684467923@EX-1-HT0.lancs.local>
References: <7EC373B616FB8343A17C27C96726D8D90117038F@soajnumsg04.soa.alaska.gov>
	<5de89afb6f1748e98e630c8684467923@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMWruA_QR1T3ccs0L5Kp6x4TyyDnNiWJx_6bWeXq=f62w@mail.gmail.com>

On Sat, Jul 14, 2012 at 10:31 AM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Dave,
>
> What I would do is project the data in ArcGIS, and and then read them into
> R and use proj4string to get the projection from that object. Then use that
> proj4string to project, in R, the lon/lat data and see if they now match
> up. I just did that and I think you espgs code in incorrect. I would
> generally avoid these opaque codes, certainly when sending a question to
> the list. For you epsg code, I get:
>
>> proj4string(bear414_nad83)
> [1] " +init=epsg:26931 +proj=omerc +lat_0=57 +lonc=-133.6666666666667
> +alpha=323.1301023611111 +k=0.9999 +x_0=5000000 +y_0=-5000000 +ellps=GRS80
> +datum=NAD83 +units=m +no_defs +towgs84=0,0,0"
>>
>
> For ArcGIS I get something else (the value of alpha):
>
> [1] "+proj=omerc +lat_0=57 +lonc=-133.6666666666667
> +alpha=-36.86989764583333 +k=0.9999 +x_0=5000000 +y_0=-5000000 +datum=NAD83
> +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>

The first alpha is 360 plus the second alpha (to 8 decimal places), so
if they are rotational parameters they should be equivalent...

Barry


From simon.ohanlon at imperial.ac.uk  Sat Jul 14 16:53:13 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Sat, 14 Jul 2012 14:53:13 +0000
Subject: [R-sig-Geo] Subset SpatialLinesDataFrame with gIntersection and
 reattach data to new SpatialLinesDataFrame
Message-ID: <7AE0828DCFFC0144817331B53EDC11A0188862F0@icexch-m5.ic.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/dad48b5f/attachment.pl>

From gab.cozzi at gmail.com  Sat Jul 14 17:46:29 2012
From: gab.cozzi at gmail.com (Gabriele Cozzi)
Date: Sat, 14 Jul 2012 17:46:29 +0200
Subject: [R-sig-Geo] utilisation distribution maps and weighted kernels
Message-ID: <CADr8yXBhSHP0ox2zaWXF=BL11UY6oFUcXBaO+VwNv7==LoeCMQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120714/3d3eede2/attachment.pl>

From Roger.Bivand at nhh.no  Sat Jul 14 18:38:52 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 14 Jul 2012 18:38:52 +0200 (CEST)
Subject: [R-sig-Geo] Subset SpatialLinesDataFrame with gIntersection and
 reattach data to new SpatialLinesDataFrame
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A0188862F0@icexch-m5.ic.ac.uk>
References: <7AE0828DCFFC0144817331B53EDC11A0188862F0@icexch-m5.ic.ac.uk>
Message-ID: <alpine.LRH.2.02.1207141836520.7423@reclus.nhh.no>

On Sat, 14 Jul 2012, O'Hanlon, Simon J wrote:

> Dear list,
> I have a shapefile (the publically available AQUASTAT Rivers of Africa), which I read into a SpatialLinesDataFrame. I would like to crop this to the extent of a bounding box as I only want to focus on a portion of the data. I would also like to reattach the original data from the data.frame after the cropping has been done (by preserving the IDs of the SpatialLines).
>
> In response to a previous question I had on this list (http://r-sig-geo.2731867.n2.nabble.com/Crop-a-SpatialPolygonsDataFrame-by-a-bounding-box-anotehr-polygon-td7580278.html), Roger Bivand directed me to some lovely code here: https://stat.ethz.ch/pipermail/r-sig-geo/2012-June/015337.html which achieves the same end result for SpatialPolyogns, but I can't seem to get it to work for SpatialLines.
>
>
> Here is a reproducible example. If you would like to try this out please feel free to run the following which will download the shapefile from my Dropbox. Be warned that the gIntersection command can take a while as it has to run through ~69,000 geometries in the rivers shapefile.
>
> #             Download and unzip the AQUASTAT Rivers of Africa dataset
> oldwd <- getwd()
> tmp <- tempdir()
> setwd(tmp)
> url <- "http://dl.dropbox.com/s/pvpi8y9550prxyd/Data.zip"
> f <- file.path(tmp,"Data.zip")
> download.file(url,f) # File is ~8Mb
> unzip(f)
>
> #             Read data into SpatialLinesDataFrame
> rivers <- readShapeLines(paste(tmp , "/rivers_africa" , sep = "" ) , proj4string = CRS("+proj=latlong +datum=WGS84") )
>
> #             Create polygon for extent of study area
> xmin <- -18;  xmax <- 3; ymin <- 4; ymax <- 15     # Coordinates for bounding box
> bb <- cbind(x=c(xmin, xmin, xmax, xmax, xmin), y=c(ymin, ymax, ymax, ymin, ymin))    #Create bounding box
> SP <- SpatialPolygons(list(Polygons(list(Polygon(bb)), "1")), proj4string=CRS(proj4string(rivers)))              # Create polygon from bounding box
>
> #             This is Rogers code to first determine for each SpatialLine if it is within the bounding box
> gI <- gIntersects(rivers, SP, byid=TRUE)
> out <- vector(mode="list", length=length(which(gI)))
> ii <- 1
>
> #             And then create a list of only those SpatialLines for which gI = TRUE
> for (i in seq(along=gI)) if (gI[i]) {out[[ii]] <-
> gIntersection(rivers[i,], SP); row.names(out[[ii]]) <-
> row.names(rivers)[i]; ii <- ii+1}
>
>
> However I t hen run into an error I can't solve. I now want to take this 
> list of objects of SpatialLines and return a single SpatialLines object. 
> However the rbind method which works for SpatialPolygons does not work 
> for SpatialLines (in this instance at least).

> table(sapply(out, class))

  SpatialLines SpatialPoints
          3303             1

shows that one returned object is non-conformant, so:

out_class <- sapply(out, class)
ri <- do.call("rbind", out[out_class == "SpatialLines"])

works.

Hope this helps,

Roger

>
>
> ri <- do.call("rbind", out)
> Error in rbind(<S4 object of class "SpatialLines">, <S4 object of class "SpatialLines">,  :
> no method for coercing this S4 class to a vector
>
> methods(rbind)
> [1] rbind.data.frame               rbind.fill
> [3] rbind.fill.matrix              rbind.gtable*
> [5] rbind.SpatialLines             rbind.SpatialLinesDataFrame
> [7] rbind.SpatialPixels            rbind.SpatialPixelsDataFrame
> [9] rbind.SpatialPoints            rbind.SpatialPointsDataFrame
> [11] rbind.SpatialPolygons          rbind.SpatialPolygonsDataFrame
>
> Okay  so maybe try explicitly calling the "rbind.SpatialLines" method:
>
> rsl <- do.call("rbind.SpatialLines", out)
> Error in slot(x, "lines") :
>  no slot of name "lines" for this object of class "SpatialPoints"
>
> slotNames(out[[1]])
> [1] "lines"       "bbox"        "proj4string"
>
> Does anyone know why the function thinks I am giving it SpatialPoints. 
> Does anyone know what I am doing wrong or why this wouldn't work? I am 
> hoping that If I can get the rbind to work I can remake my 
> SpatialLinesDataFrame with the following:
>
> rid <- sapply(slot(rsl, "lines"), function(x) slot(x, "ID"))
> small_riv <- SpatialLinesDataFrame(rsl , data = rivers at data[ c(rid) , ] )
>
> Thanks you for any help,
>
> Simon
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From simon.ohanlon at imperial.ac.uk  Sat Jul 14 18:42:21 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Sat, 14 Jul 2012 16:42:21 +0000
Subject: [R-sig-Geo] Subset SpatialLinesDataFrame with gIntersection and
 reattach data to new SpatialLinesDataFrame
In-Reply-To: <alpine.LRH.2.02.1207141836520.7423@reclus.nhh.no>
References: <7AE0828DCFFC0144817331B53EDC11A0188862F0@icexch-m5.ic.ac.uk>
	<alpine.LRH.2.02.1207141836520.7423@reclus.nhh.no>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A0188863BF@icexch-m5.ic.ac.uk>

Perfect!

That's solved it.  

Thanks Roger.

Cheers,

Simon

-----Original Message-----
From: Roger Bivand [mailto:Roger.Bivand at nhh.no] 
Sent: 14 July 2012 17:39
To: O'Hanlon, Simon J
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Subset SpatialLinesDataFrame with gIntersection and reattach data to new SpatialLinesDataFrame

On Sat, 14 Jul 2012, O'Hanlon, Simon J wrote:

> Dear list,
> I have a shapefile (the publically available AQUASTAT Rivers of Africa), which I read into a SpatialLinesDataFrame. I would like to crop this to the extent of a bounding box as I only want to focus on a portion of the data. I would also like to reattach the original data from the data.frame after the cropping has been done (by preserving the IDs of the SpatialLines).
>
> In response to a previous question I had on this list (http://r-sig-geo.2731867.n2.nabble.com/Crop-a-SpatialPolygonsDataFrame-by-a-bounding-box-anotehr-polygon-td7580278.html), Roger Bivand directed me to some lovely code here: https://stat.ethz.ch/pipermail/r-sig-geo/2012-June/015337.html which achieves the same end result for SpatialPolyogns, but I can't seem to get it to work for SpatialLines.
>
>
> Here is a reproducible example. If you would like to try this out please feel free to run the following which will download the shapefile from my Dropbox. Be warned that the gIntersection command can take a while as it has to run through ~69,000 geometries in the rivers shapefile.
>
> #             Download and unzip the AQUASTAT Rivers of Africa dataset
> oldwd <- getwd()
> tmp <- tempdir()
> setwd(tmp)
> url <- "http://dl.dropbox.com/s/pvpi8y9550prxyd/Data.zip"
> f <- file.path(tmp,"Data.zip")
> download.file(url,f) # File is ~8Mb
> unzip(f)
>
> #             Read data into SpatialLinesDataFrame
> rivers <- readShapeLines(paste(tmp , "/rivers_africa" , sep = "" ) , 
> proj4string = CRS("+proj=latlong +datum=WGS84") )
>
> #             Create polygon for extent of study area
> xmin <- -18;  xmax <- 3; ymin <- 4; ymax <- 15     # Coordinates for bounding box
> bb <- cbind(x=c(xmin, xmin, xmax, xmax, xmin), y=c(ymin, ymax, ymax, ymin, ymin))    #Create bounding box
> SP <- SpatialPolygons(list(Polygons(list(Polygon(bb)), "1")), proj4string=CRS(proj4string(rivers)))              # Create polygon from bounding box
>
> #             This is Rogers code to first determine for each SpatialLine if it is within the bounding box
> gI <- gIntersects(rivers, SP, byid=TRUE) out <- vector(mode="list", 
> length=length(which(gI))) ii <- 1
>
> #             And then create a list of only those SpatialLines for which gI = TRUE
> for (i in seq(along=gI)) if (gI[i]) {out[[ii]] <- 
> gIntersection(rivers[i,], SP); row.names(out[[ii]]) <- 
> row.names(rivers)[i]; ii <- ii+1}
>
>
> However I t hen run into an error I can't solve. I now want to take 
> this list of objects of SpatialLines and return a single SpatialLines object.
> However the rbind method which works for SpatialPolygons does not work 
> for SpatialLines (in this instance at least).

> table(sapply(out, class))

  SpatialLines SpatialPoints
          3303             1

shows that one returned object is non-conformant, so:

out_class <- sapply(out, class)
ri <- do.call("rbind", out[out_class == "SpatialLines"])

works.

Hope this helps,

Roger

>
>
> ri <- do.call("rbind", out)
> Error in rbind(<S4 object of class "SpatialLines">, <S4 object of class "SpatialLines">,  :
> no method for coercing this S4 class to a vector
>
> methods(rbind)
> [1] rbind.data.frame               rbind.fill
> [3] rbind.fill.matrix              rbind.gtable*
> [5] rbind.SpatialLines             rbind.SpatialLinesDataFrame
> [7] rbind.SpatialPixels            rbind.SpatialPixelsDataFrame
> [9] rbind.SpatialPoints            rbind.SpatialPointsDataFrame
> [11] rbind.SpatialPolygons          rbind.SpatialPolygonsDataFrame
>
> Okay  so maybe try explicitly calling the "rbind.SpatialLines" method:
>
> rsl <- do.call("rbind.SpatialLines", out) Error in slot(x, "lines") :
>  no slot of name "lines" for this object of class "SpatialPoints"
>
> slotNames(out[[1]])
> [1] "lines"       "bbox"        "proj4string"
>
> Does anyone know why the function thinks I am giving it SpatialPoints. 
> Does anyone know what I am doing wrong or why this wouldn't work? I am 
> hoping that If I can get the rbind to work I can remake my 
> SpatialLinesDataFrame with the following:
>
> rid <- sapply(slot(rsl, "lines"), function(x) slot(x, "ID")) small_riv 
> <- SpatialLinesDataFrame(rsl , data = rivers at data[ c(rid) , ] )
>
> Thanks you for any help,
>
> Simon
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics, Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From mspinola10 at gmail.com  Sun Jul 15 17:02:26 2012
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 15 Jul 2012 09:02:26 -0600
Subject: [R-sig-Geo] Help with gpclib
Message-ID: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120715/516d3596/attachment.pl>

From seth at swbigelow.net  Mon Jul 16 02:12:32 2012
From: seth at swbigelow.net (seth at swbigelow.net)
Date: Sun, 15 Jul 2012 19:12:32 -0500
Subject: [R-sig-Geo] Converting UTMs to SpatialPolygons object
Message-ID: <a5cf9178f2dc1815cb36977a36dad678b02a9779@sitemail.hostway.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120715/69f73b1e/attachment.pl>

From seth at swbigelow.net  Mon Jul 16 02:24:20 2012
From: seth at swbigelow.net (seth at swbigelow.net)
Date: Sun, 15 Jul 2012 19:24:20 -0500
Subject: [R-sig-Geo] Converting UTMs to SpatialPolygons object
Message-ID: <5df6db2151cb3d5d79940be3d8614d0843b0cfda@sitemail.hostway.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120715/ba86c8c1/attachment.pl>

From mdsumner at gmail.com  Mon Jul 16 02:24:47 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 16 Jul 2012 10:24:47 +1000
Subject: [R-sig-Geo] Converting UTMs to SpatialPolygons object
In-Reply-To: <a5cf9178f2dc1815cb36977a36dad678b02a9779@sitemail.hostway.com>
References: <a5cf9178f2dc1815cb36977a36dad678b02a9779@sitemail.hostway.com>
Message-ID: <CAAcGz99xbrfZwuiU1BGQ5Xz=HB5Kp21e=B8-2Lhjh4S1L4tpLg@mail.gmail.com>

If you sent code it did not survive the journey. See the vignette in
sp for how to build polygons from scratch, section 7.1.

library(sp)
vignette("intro_sp")



On Mon, Jul 16, 2012 at 10:12 AM,  <seth at swbigelow.net> wrote:
>
>
>         r-sig-geo listers:
>
>         Can anyone provide code or suggest commands for converting a data
> frame with UTMS to a SpatialPolygons (sp package) object? Below, I
> provide code to generate a sample dataframe, with three ordered
> sequences of twelve coordinate pairs each.
>
>         id
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From oluseun.idowu at mail.umkc.edu  Mon Jul 16 02:39:38 2012
From: oluseun.idowu at mail.umkc.edu (Idowu, Oluseun S. (UMKC-Student))
Date: Mon, 16 Jul 2012 00:39:38 +0000
Subject: [R-sig-Geo] How to subset my data
In-Reply-To: <a5cf9178f2dc1815cb36977a36dad678b02a9779@sitemail.hostway.com>
Message-ID: <CC28C9B1.610E%osif38@mail.umkc.edu>

Hello:
I have a .txt file i'm reading in R with 3670016 nrows made up of (256
lat, 512 lon and 28 forecast time) and ncol=31(no of days in the month). I
read the lat/lon data and got that my area of interest is at point row=93
to row 128 for lat and row 30 to 1 & 257 to 286 for lon. My issue is how
do I correctly select my data subset from the 36700016 rows. I see that
most of the data a repeated to make up the nrows but what command can I
use to make a right selection. Thanks in advance for your help.

See data below 
head(dataTEMP)
        V1       V2       V3       V4       V5       V6       V7       V8
1 273.8134 273.8701 274.3947 274.0019 273.9000 273.6819 274.3362 273.6229
2 273.8134 273.8721 274.3947 273.9980 273.8961 273.6838 274.3362 273.6248
3 273.8134 273.8760 274.3947 273.9921 273.8942 273.6858 274.3343 273.6248
4 273.8114 273.8779 274.3947 273.9882 273.8903 273.6877 274.3323 273.6268
5 273.8114 273.8818 274.3947 273.9824 273.8864 273.6897 274.3323 273.6287
6 273.8114 273.8838 274.3947 273.9785 273.8824 273.6917 274.3304 273.6307
        V9      V10      V11      V12      V13      V14      V15      V16
1 274.2525 274.0379 274.6470 274.4238 273.5143 274.1406 274.3043 274.9282
2 274.2525 274.0379 274.6470 274.4218 273.5163 274.1426 274.3043 274.9301
3 274.2525 274.0379 274.6450 274.4218 273.5182 274.1426 274.3024 274.9321
4 274.2525 274.0379 274.6450 274.4218 273.5221 274.1426 274.3024 274.9321
5 274.2525 274.0379 274.6431 274.4199 273.5241 274.1445 274.3004 274.9340
6 274.2505 274.0379 274.6431 274.4199 273.5260 274.1445 274.3004 274.9360
       V17      V18      V19      V20      V21      V22      V23      V24
1 275.0095 274.4799 275.1027 274.9044 274.8814 275.0872 274.9467 275.0533
2 275.0095 274.4799 275.1046 274.9064 274.8794 275.0852 274.9467 275.0553
3 275.0095 274.4799 275.1046 274.9064 274.8775 275.0833 274.9486 275.0553
4 275.0076 274.4819 275.1046 274.9083 274.8755 275.0813 274.9506 275.0573
5 275.0076 274.4819 275.1066 274.9103 274.8736 275.0793 274.9506 275.0592
6 275.0076 274.4838 275.1066 274.9103 274.8697 275.0754 274.9525 275.0612
       V25      V26      V27      V28      V29      V30      V31
1 274.9663 274.6910 274.6379 274.8774 274.7449 274.7726 274.4701
2 274.9702 274.6929 274.6399 274.8754 274.7585 274.7726 274.4701
3 274.9742 274.6929 274.6418 274.8754 274.7703 274.7745 274.4681
4 274.9781 274.6949 274.6438 274.8735 274.7839 274.7745 274.4662
5 274.9800 274.6968 274.6458 274.8735 274.7957 274.7745 274.4662
6 274.9839 274.6988 274.6477 274.8715 274.8093 274.7765 274.4642

tail(dataTEMP)
              V1       V2       V3      V4       V5       V6       V7
 V8
3670011 218.8708 219.7255 219.2522 218.198 221.2890 213.5748 217.6296
226.0363
3670012 218.8786 219.7274 219.2463 218.198 221.2831 213.5807 217.6198
226.0090
3670013 218.8864 219.7294 219.2424 218.198 221.2773 213.5865 217.6100
225.9816
3670014 218.8942 219.7333 219.2385 218.198 221.2714 213.5924 217.5983
225.9543
3670015 218.9020 219.7352 219.2346 218.196 221.2636 213.5982 217.5885
225.9270
3670016 218.9118 219.7391 219.2287 218.196 221.2577 213.6060 217.5768
225.8996
              V9      V10      V11      V12      V13      V14      V15
 V16
3670011 225.0423 216.0866 211.2848 214.1108 214.3512 221.4184 236.3481
217.9475
3670012 225.0306 216.0866 211.2750 214.1010 214.3532 221.4263 236.3364
217.9514
3670013 225.0189 216.0866 211.2653 214.0932 214.3551 221.4360 236.3266
217.9553
3670014 225.0071 216.0866 211.2555 214.0834 214.3571 221.4458 236.3169
217.9592
3670015 224.9954 216.0866 211.2457 214.0756 214.3591 221.4556 236.3051
217.9631
3670016 224.9837 216.0885 211.2360 214.0658 214.3610 221.4634 236.2954
217.9670
             V17      V18      V19      V20      V21      V22      V23
 V24
3670011 222.9712 223.2803 223.1307 218.4524 229.5565 221.0723 226.7856
227.7539
3670012 222.9673 223.2940 223.1365 218.4544 229.5682 221.0801 226.7934
227.7481
3670013 222.9634 223.3057 223.1443 218.4563 229.5818 221.0879 226.8012
227.7422
3670014 222.9615 223.3194 223.1502 218.4583 229.5936 221.0957 226.8071
227.7363
3670015 222.9576 223.3311 223.1561 218.4622 229.6053 221.1055 226.8149
227.7305
3670016 222.9536 223.3428 223.1619 218.4641 229.6190 221.1133 226.8227
227.7227
             V25      V26      V27      V28      V29      V30      V31
3670011 227.5125 230.8432 221.8371 211.2838 216.2357 223.5838 221.5377
3670012 227.5105 230.8491 221.8429 211.2760 216.2376 223.5858 221.5416
3670013 227.5105 230.8549 221.8488 211.2682 216.2396 223.5877 221.5435
3670014 227.5086 230.8608 221.8547 211.2604 216.2435 223.5897 221.5474
3670015 227.5066 230.8667 221.8625 211.2526 216.2454 223.5916 221.5513
3670016 227.5047 230.8725 221.8683 211.2448 216.2493 223.5936 221.5552



Sam 




On 7/15/12 7:12 PM, "seth at swbigelow.net" <seth at swbigelow.net> wrote:

>
>
>	r-sig-geo listers:
>
>	Can anyone provide code or suggest commands for converting a data
>frame with UTMS to a SpatialPolygons (sp package) object? Below, I
>provide code to generate a sample dataframe, with three ordered
>sequences of twelve coordinate pairs each.
>
>	id
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From m.hewson at uq.edu.au  Mon Jul 16 03:22:28 2012
From: m.hewson at uq.edu.au (Michael Hewson)
Date: Mon, 16 Jul 2012 01:22:28 +0000
Subject: [R-sig-Geo] gstat and trend
Message-ID: <4DFD7C68C50FE54A98C0D43A76E08E0803870B@uqexmdb6.soe.uq.edu.au>

G'day list,

I'm calculating cross-variograms (variables below are sumso2="sulphur dioxide emissions" and intensity="rain intensity" - I have 2500 sample points) using GSTAT in R:

g <- gstat(NULL, id = "sumso2", form = sumso2 ~ 1, data=d1)
g <- gstat(g, id = "intensity", form = intensity ~ 1, data=d1)
d1xv.so2Vin <- variogram(g, cutoff=0.3, width=0.01)

but - just looking at the variogram for sumso2 alone after this process (d1so.png):
[cid:image002.png at 01CD6345.4D6377B0]
The sumso2 semi-variogram has a trend - and I need to remove it.

If I calculate the variance of each point from the overall mean squared - and use that as sumso2 in the same gstat process - I get the sumso2 semi-variogram as (d1sores.png):
[cid:image003.png at 01CD6343.D40EC9B0]

This is a better semi-variogram - not ideal yet - but better.

My question is - is that calculation using the mean noted above suitable for removing the trend sufficient for ensuring a suitable cross-variogram? Note - I don't need to fit models or go to co-kriging - I'm just examining the form of the spatial relationships - I just want to describe the variable relationships as shown in the cross-variogram (a geography project).

Now - if this is not suitable for removing the trend - then I understand I need to fit a polynomial to the variable sumso2 - could someone describe how I can do that it gstat please?

My substantial thanks,
________________________________________________________
Michael Hewson PhD candidate
Climate Research Group<http://www.gpem.uq.edu.au/crg> | Centre for Spatial Environmental Research<http://www.gpem.uq.edu.au/cser>
The University of Queensland | Brisbane Q 4072 | Australia
m.hewson at uq.edu.au | +61 (0)408 379 373

[Description: ClimateResearchGroupbanner]


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/c9922cbd/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 8446 bytes
Desc: image001.jpg
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/c9922cbd/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 3531 bytes
Desc: image003.png
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/c9922cbd/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 3537 bytes
Desc: image002.png
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/c9922cbd/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: d1sores.png
Type: image/png
Size: 2061 bytes
Desc: d1sores.png
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/c9922cbd/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: d1so.png
Type: image/png
Size: 2164 bytes
Desc: d1so.png
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/c9922cbd/attachment-0003.png>

From HodgessE at uhd.edu  Mon Jul 16 03:43:05 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 15 Jul 2012 20:43:05 -0500
Subject: [R-sig-Geo] using Geography markup languague (GML)
Message-ID: <586A4828D7AAA04CA9B258C50A28DA200BF594A7@BALI.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120715/d09bdca4/attachment.pl>

From HodgessE at uhd.edu  Mon Jul 16 04:24:07 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 15 Jul 2012 21:24:07 -0500
Subject: [R-sig-Geo] plotKML tutorial or vignette?
Message-ID: <586A4828D7AAA04CA9B258C50A28DA200BF594A9@BALI.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120715/24ee2ee7/attachment.pl>

From epistat at gmail.com  Mon Jul 16 04:28:33 2012
From: epistat at gmail.com (zhijie zhang)
Date: Mon, 16 Jul 2012 10:28:33 +0800
Subject: [R-sig-Geo] problem on krige in gstat package
Message-ID: <CAN9LD-0O11pwCJTRP0w6w98fVojTTDN79ZQ3+ebYY+tGvCkT7Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/75246f2f/attachment.pl>

From mdsumner at gmail.com  Mon Jul 16 04:28:39 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 16 Jul 2012 12:28:39 +1000
Subject: [R-sig-Geo] using Geography markup languague (GML)
In-Reply-To: <586A4828D7AAA04CA9B258C50A28DA200BF594A7@BALI.uhd.campus>
References: <586A4828D7AAA04CA9B258C50A28DA200BF594A7@BALI.uhd.campus>
Message-ID: <CAAcGz99wFfuGgpPyXi=k_VpPjxMWzwAw0WVHD4MjRo2utY7E6A@mail.gmail.com>

Just in terms of R, you could check out support for the OGR GML driver
in rgdal: http://www.gdal.org/ogr/drv_gml.html and the package sos4R
which has GML support (though may be too specialized). There are links
to the OGC documentation on the GDAL/OGR page.

Cheers, Mike.

On Mon, Jul 16, 2012 at 11:43 AM, Hodgess, Erin <HodgessE at uhd.edu> wrote:
> Hello everyone!
>
> Does anyone use GML, please?  If so, could you recommend a good tutorial or intro book, please?
>
> I've used R to produce KML, but have never used GML.
>
> thanks,
> Erin
>
>
> Erin M. Hodgess, PhD
> Associate Professor
> Department of Computer and Mathematical Sciences
> University of Houston - Downtown
> mailto: hodgesse at uhd.edu
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From HodgessE at uhd.edu  Mon Jul 16 04:42:32 2012
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 15 Jul 2012 21:42:32 -0500
Subject: [R-sig-Geo] using Geography markup languague (GML)
References: <586A4828D7AAA04CA9B258C50A28DA200BF594A7@BALI.uhd.campus>
	<CAAcGz99wFfuGgpPyXi=k_VpPjxMWzwAw0WVHD4MjRo2utY7E6A@mail.gmail.com>
Message-ID: <586A4828D7AAA04CA9B258C50A28DA200BF594AA@BALI.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120715/23690225/attachment.pl>

From mark at dimensionaledge.com  Mon Jul 16 07:40:09 2012
From: mark at dimensionaledge.com (Mark Wynter)
Date: Mon, 16 Jul 2012 15:40:09 +1000
Subject: [R-sig-Geo] Problem connecting to GRASS via spgrass6 and plr
Message-ID: <887F9806-BBEB-46BE-A160-33EBC0CBB627@dimensionaledge.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/dc66f37c/attachment.pl>

From mdsumner at gmail.com  Mon Jul 16 08:30:46 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 16 Jul 2012 16:30:46 +1000
Subject: [R-sig-Geo] Converting UTMs to SpatialPolygons object
In-Reply-To: <5df6db2151cb3d5d79940be3d8614d0843b0cfda@sitemail.hostway.com>
References: <5df6db2151cb3d5d79940be3d8614d0843b0cfda@sitemail.hostway.com>
Message-ID: <CAAcGz98OHEz6nZN0dQHdoLa1EDkiMZZnthU3R8jvoJcUEKt-eA@mail.gmail.com>

Here we go, I'm assuming each ring is its own simple object, and a few
other things.

id = rep(seq(1,3),each=12)
az = rep(seq(0,359,30),3)

## assume you meant to use all ids here?
d = data.frame(id,az)
d$dist = round(rnorm(36,10,3),1)
xp = function(azimuth, r){cos(((90-azimuth)*pi)/180)*r}
yp =  function(azimuth, r){sin(((90-azimuth)*pi)/180)*r}
ctr_e = rnorm(3,667314,50)
ctr_n = rnorm(3,4784480,50)

d$utm_e = round(xp(d$az,d$dist),1) + ctr_e[d$id]
d$utm_n = round(yp(d$az,d$dist),1) + ctr_n[d$id]

library(sp)
myCRS = CRS("+proj=utm +zone=18 +ellps=WGS84")

## create list of coords, including repeat of first row for each
l.coords <- lapply(split(d, d$id), function(x)
as.matrix(x[c(seq_len(nrow(x)), 1), c("utm_e", "utm_n")]))


l.Polygons <- vector("list",length(l.coords))

for (i in seq_len(length(l.coords))) {
    l.Polygons[[i]] <- Polygons(list(Polygon(l.coords[i])), as.character(i))
}

SpPolys <- SpatialPolygons(l.Polygons, proj4string = myCRS)

plot(SpPolys, col = c("grey", "red", "blue"))


On Mon, Jul 16, 2012 at 10:24 AM,  <seth at swbigelow.net> wrote:
>
>
>         It seems my data-generating code was cut off. Here's another try:
>
>         id = rep(seq(1,3),each=12)            # Generate polygon
> IDs'
> az = rep(seq(0,359,30),3)               # Generate
> azimuth sequence
> c = data.frame(id
> [1],az)                        # Combine in
> data frame
> c$dist = round(rnorm(36,10,3),1)  # Generate random distances from
> center of polygon
>
>         xp = function(azimuth, r){cos(((90-azimuth)*pi)/180)*r}
>       # Function to calculate horizontal distance from polygon
> center
>
>         yp =  function(azimuth, r){sin(((90-azimuth)*pi)/180)*r}
>       # Function to calculate vertical distance from polygon
> center
>
>         ctr_e = rnorm(3,667314,50)       # Randomly select eastings
> for polygon centers
> ctr_n = rnorm(3,4784480,50)     # Randomly select northings for
> polygon centers
>
>         c$utm_e = round(xp(c$az,c$dist),1) + ctr_e[c$id]  # Calculate
> point eastings
> c$utm_n = round(yp(c$az,c$dist),1) + ctr_n[c$id]  # Calculate point
> northings
>
>         myCRS = CRS("+proj=utm +zone=18 +ellps=WGS84")    # define
> proj4string
>
>         Appreciatively,
>
>         Seth Bigelow
>
>
>
> Links:
> ------
> [1] http://sitemail.hostway.com/http:/
>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From amcrgrodrigues at gmail.com  Mon Jul 16 10:40:31 2012
From: amcrgrodrigues at gmail.com (=?ISO-8859-1?Q?Ant=F3nio_M=2E_Rodrigues?=)
Date: Mon, 16 Jul 2012 09:40:31 +0100
Subject: [R-sig-Geo] How to subset my data
In-Reply-To: <CC28C9B1.610E%osif38@mail.umkc.edu>
References: <a5cf9178f2dc1815cb36977a36dad678b02a9779@sitemail.hostway.com>
	<CC28C9B1.610E%osif38@mail.umkc.edu>
Message-ID: <CAC+EZtQK1bbM51=6FqKQMe4TODX_65bUL-u5YphAvyNyRU4B9g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/619b9a3b/attachment.pl>

From lily_franknich at yahoo.com  Mon Jul 16 11:35:35 2012
From: lily_franknich at yahoo.com (Lilis Husna)
Date: Mon, 16 Jul 2012 17:35:35 +0800
Subject: [R-sig-Geo] How to get each bandwidth values on observation
	points using adaptive kernel in spgwr ?
Message-ID: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/e0440fd6/attachment.pl>

From lily_franknich at yahoo.com  Mon Jul 16 11:36:41 2012
From: lily_franknich at yahoo.com (Lilis Husna)
Date: Mon, 16 Jul 2012 17:36:41 +0800 (SGT)
Subject: [R-sig-Geo] How to get each bandwidth values on observation
	points using adaptive kernel in spgwr ?
In-Reply-To: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>
References: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>
Message-ID: <1342431401.71430.YahooMailNeo@web190304.mail.sg3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/59847ff9/attachment.pl>

From seth at swbigelow.net  Mon Jul 16 11:52:44 2012
From: seth at swbigelow.net (seth at swbigelow.net)
Date: Mon, 16 Jul 2012 04:52:44 -0500
Subject: [R-sig-Geo] Converting UTMs to SpatialPolygons object
In-Reply-To: <CAAcGz98OHEz6nZN0dQHdoLa1EDkiMZZnthU3R8jvoJcUEKt-eA@mail.gmail.com>
Message-ID: <be4bb466871b9065e4e0d69549d1a441f652d2fe@sitemail.hostway.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/0c61556d/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Jul 16 11:55:41 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 16 Jul 2012 10:55:41 +0100
Subject: [R-sig-Geo] How to get each bandwidth values on observation
 points using adaptive kernel in spgwr ?
In-Reply-To: <fc06fe6c788b46d2ba52ad83ddbc9b2c@EX-0-HT0.lancs.local>
References: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>
	<fc06fe6c788b46d2ba52ad83ddbc9b2c@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNcO=FvsdJWPcKWUY1nK4YaTO7YPN-_R=CYC8MYaF0_rw@mail.gmail.com>

On Mon, Jul 16, 2012 at 10:36 AM, Lilis Husna <lily_franknich at yahoo.com> wrote:
> when i run
>
>
> res <- gw.adapt(cbind(columbus$x, columbus$y), cbind(columbus$x,
> columbus$y), quant=0.5)
>
>
> there is error message
>
> Error: could not find function "gw.adapt"
>
>
> why did it happen?

 Who told you about gw.adapt?

 It seems to now be not exported from the spgwr package, but the help
page is still there (Roger: is that a bug? Either you've missed it out
of the exports or you've left in the .Rd file!).

 If you want to use it you can use the triple-colon notation to get an
unexported function from a package:

res = spgwr:::gw.adapt(cbind(columbus$x,columbus$y),cbind(columbus$x,columbus$y),quant=0.5)

 Roger may have removed it for a good reason, and possibly put the
functionality into another function. But the quick fix would be the
triple-colon trick.

 It's also useful if you give package versions with your questions -
here's mine:

> packageDescription("spgwr")$Version
[1] "0.6-14"

Barry


From born.rebel.83 at gmail.com  Mon Jul 16 13:17:01 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Mon, 16 Jul 2012 16:47:01 +0530
Subject: [R-sig-Geo] =?windows-1252?q?ERROR=3A_dependency_=91png=92_is_not?=
	=?windows-1252?q?_available_for_package_=91RgoogleMaps=92?=
Message-ID: <CAM1yFZ_FZW679JCakvqePfpqLrikgMX-_60vTXtPGpiGf8acAw@mail.gmail.com>

Greetings,

I installed R, Rcpp, RInside successfully on my computer (Linux -
openSUSE 11.3, 64 bit).

Now when I try to install `RgoogleMaps` package, I get this error:

_____________________________________________

linux-y3pi:#   R CMD INSTALL RgoogleMaps_1.2.0.tar.gz
* installing to library ?/usr/lib64/R/library?
ERROR: dependency ?png? is not available for package ?RgoogleMaps?
* removing ?/usr/lib64/R/library/RgoogleMaps?
_____________________________________________


What does this indicate? Google didn't help.
Please help.

-- 
Anisha Kaul


From born.rebel.83 at gmail.com  Mon Jul 16 13:33:43 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Mon, 16 Jul 2012 17:03:43 +0530
Subject: [R-sig-Geo]
	=?windows-1252?q?ERROR=3A_dependency_=91png=92_is_not?=
	=?windows-1252?q?_available_for_package_=91RgoogleMaps=92?=
In-Reply-To: <CAM1yFZ_FZW679JCakvqePfpqLrikgMX-_60vTXtPGpiGf8acAw@mail.gmail.com>
References: <CAM1yFZ_FZW679JCakvqePfpqLrikgMX-_60vTXtPGpiGf8acAw@mail.gmail.com>
Message-ID: <CAM1yFZ_YGD3hVvVUUAHBTehib4qfR8mRdaB9PmEtgGKqAYtifQ@mail.gmail.com>

Okay, sorry for bothering - I couldn't have guessed that 'png' is a
tar file that needs to installed separately.
http://cran.r-project.org/web/packages/png/index.html



On 16 July 2012 16:47, Anisha Kaul <born.rebel.83 at gmail.com> wrote:
> Greetings,
>
> I installed R, Rcpp, RInside successfully on my computer (Linux -
> openSUSE 11.3, 64 bit).
>
> Now when I try to install `RgoogleMaps` package, I get this error:
>
> _____________________________________________
>
> linux-y3pi:#   R CMD INSTALL RgoogleMaps_1.2.0.tar.gz
> * installing to library ?/usr/lib64/R/library?
> ERROR: dependency ?png? is not available for package ?RgoogleMaps?
> * removing ?/usr/lib64/R/library/RgoogleMaps?
> _____________________________________________
>
>
> What does this indicate? Google didn't help.
> Please help.
>
> --
> Anisha Kaul



-- 
Anisha Kaul


From born.rebel.83 at gmail.com  Mon Jul 16 13:40:40 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Mon, 16 Jul 2012 17:10:40 +0530
Subject: [R-sig-Geo]
	=?windows-1252?q?ERROR=3A_dependency_=91png=92_is_not?=
	=?windows-1252?q?_available_for_package_=91RgoogleMaps=92?=
In-Reply-To: <5004017D.4030605@cs.helsinki.fi>
References: <CAM1yFZ_FZW679JCakvqePfpqLrikgMX-_60vTXtPGpiGf8acAw@mail.gmail.com>
	<5004017D.4030605@cs.helsinki.fi>
Message-ID: <CAM1yFZ-A5W=55EH0A7Yk34DmNBJgqqLZfrvONU_fb6E3z9TYJw@mail.gmail.com>

On 16 July 2012 17:26, Joona Lehtom?ki <joona.lehtomaki at cs.helsinki.fi> wrote:
> Hi Anisha,
>
> I think R CMD INSTALL does not install the dependencies (i.e. package png)
> from CRAN. Is there a reason why you want to install RgoogleMaps from a
> local tar-file? Installing from within R using the command
>
>> install.packages("RgoogleMaps")
>
> will install all the dependencies as well. Note that package png may have
> further dependencies (libpng and/or libpng-devel) on your system.

I am currently not familiar with the R commands. I just tried your way
out and it worked.
Thanks for being helpful.


Regards,
Anisha.


From born.rebel.83 at gmail.com  Mon Jul 16 14:01:45 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Mon, 16 Jul 2012 17:31:45 +0530
Subject: [R-sig-Geo] =?windows-1252?q?Error_in_eval=28expr=2C_envir=2C_enc?=
	=?windows-1252?q?los=29_=3A_could_not_find_function_=93GetMap=94?=
Message-ID: <CAM1yFZ-1C6G8_26BEDbLomKFK+7vPXm930pvt8b9HVFhXKVGpw@mail.gmail.com>

Greetings,

System: openSUSE 11.3 64 bit
Here's the content of my file - "mow.R"

____________________________________

MyMap <- GetMap(markers =
'40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc',
destfile = "MyTile1.png");
____________________________________


as shown on: http://rgm2.lab.nig.ac.jp/RGM2/func.php?rd_id=RgoogleMaps:RgoogleMaps-package

Now, on executing "mow.R", I get:

____________________________________

> source('mow.R')
Error in eval(expr, envir, enclos) : could not find function "GetMap"
____________________________________


`Rgooglemaps` is already installed.

____________________________________

linux-y3pi: # R CMD INSTALL RgoogleMaps_1.2.0.tar.gz
* installing to library ?/usr/lib64/R/library?
* installing *source* package ?RgoogleMaps? ...
** package ?RgoogleMaps? successfully unpacked and MD5 sums checked
** R
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
   ?RgoogleMaps-intro.Rnw?
** testing if installed package can be loaded

* DONE (RgoogleMaps)
____________________________________

What's the point that I am missing?
Please guide.


-- 
Anisha Kaul


From born.rebel.83 at gmail.com  Mon Jul 16 14:04:55 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Mon, 16 Jul 2012 17:34:55 +0530
Subject: [R-sig-Geo]
	=?windows-1252?q?Error_in_eval=28expr=2C_envir=2C_enc?=
	=?windows-1252?q?los=29_=3A_could_not_find_function_=93GetMap=94?=
In-Reply-To: <CAM1yFZ-1C6G8_26BEDbLomKFK+7vPXm930pvt8b9HVFhXKVGpw@mail.gmail.com>
References: <CAM1yFZ-1C6G8_26BEDbLomKFK+7vPXm930pvt8b9HVFhXKVGpw@mail.gmail.com>
Message-ID: <CAM1yFZ8p7AcYPjPcY4Up6oX1WpqOKdQcxAzc=g5WCbV8EiyFhg@mail.gmail.com>

:sigh:

Didn't know that the program shown here is not complete.
http://rgm2.lab.nig.ac.jp/RGM2/func.php?rd_id=RgoogleMaps:RgoogleMaps-package


The following needs to be added in the file.


library(RgoogleMaps)
png(filename="RgoogleMaps-package_%03d_med.png", width=480, height=480)





On 16 July 2012 17:31, Anisha Kaul <born.rebel.83 at gmail.com> wrote:
> Greetings,
>
> System: openSUSE 11.3 64 bit
> Here's the content of my file - "mow.R"
>
> ____________________________________
>
> MyMap <- GetMap(markers =
> '40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc',
> destfile = "MyTile1.png");
> ____________________________________
>
>
> as shown on: http://rgm2.lab.nig.ac.jp/RGM2/func.php?rd_id=RgoogleMaps:RgoogleMaps-package
>
> Now, on executing "mow.R", I get:
>
> ____________________________________
>
>> source('mow.R')
> Error in eval(expr, envir, enclos) : could not find function "GetMap"
> ____________________________________
>
>
> `Rgooglemaps` is already installed.
>
> ____________________________________
>
> linux-y3pi: # R CMD INSTALL RgoogleMaps_1.2.0.tar.gz
> * installing to library ?/usr/lib64/R/library?
> * installing *source* package ?RgoogleMaps? ...
> ** package ?RgoogleMaps? successfully unpacked and MD5 sums checked
> ** R
> ** inst
> ** preparing package for lazy loading
> ** help
> *** installing help indices
> ** building package indices
> ** installing vignettes
>    ?RgoogleMaps-intro.Rnw?
> ** testing if installed package can be loaded
>
> * DONE (RgoogleMaps)
> ____________________________________
>
> What's the point that I am missing?
> Please guide.
>
>
> --
> Anisha Kaul



-- 
Anisha Kaul


From born.rebel.83 at gmail.com  Mon Jul 16 14:25:30 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Mon, 16 Jul 2012 17:55:30 +0530
Subject: [R-sig-Geo] cannot open: HTTP status was '403 Forbidden' The
 "sensor" parameter specified in the request must be set to either "true" or
 "false".
Message-ID: <CAM1yFZ-ffNYUy5Tqkwqz0NGZ3LkbR6ztz8phG+Wt_=JUEpSvfw@mail.gmail.com>

The "mow.R" now contains:
__________________________________________
library (RgoogleMaps)
png (filename="RgoogleMaps-package_%03d_med.png", width=480, height=480)

MyMap <- GetMap(markers =
'40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc',
sensor = "false", destfile = "MyTile1.png");

tmp <- PlotOnStaticMap(MyMap,lat = c(40.702147,40.711614,40.718217),
lon = c(-74.015794,-74.012318,-73.998284), cex=1.5,pch=20,col=c('red',
'blue', 'green'), add=F)
__________________________________________



Executing this from R results in:
__________________________________________
> source('mow.R')
[1] "Note that when center and zoom are not specified, no meta
information on the map tile can be stored. This basically means that R
cannot compute proper coordinates. You can still download the map tile
and view it in R but overlays are not possible. Do you want to proceed
? (y/n)"
y
[1] "40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc"
[1] "http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=false40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc"
Error in download.file(url, destfile, mode = "wb", quiet = TRUE) :
  cannot open URL
'http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=false40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc'
In addition: Warning message:
In download.file(url, destfile, mode = "wb", quiet = TRUE) :
  cannot open: HTTP status was '403 Forbidden'
>
__________________________________________


I copied its url and pasted it in the browser:
__________________________________________
http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=false40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc
__________________________________________

It resulted in the following message:
The Google Maps API server rejected your request. The "sensor"
parameter specified in the request must be set to either "true" or
"false".


When I change the position of "&sensor=false" in the above url, it works fine:
__________________________________________
http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png3240.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc&sensor=false
__________________________________________


****How to incorporate this change in the "mow.R" file now?****
Please help;

-- 
Anisha Kaul


From Roger.Bivand at nhh.no  Mon Jul 16 15:29:19 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 16 Jul 2012 15:29:19 +0200 (CEST)
Subject: [R-sig-Geo] How to get each bandwidth values on observation
 points using adaptive kernel in spgwr ?
In-Reply-To: <CANVKczNcO=FvsdJWPcKWUY1nK4YaTO7YPN-_R=CYC8MYaF0_rw@mail.gmail.com>
References: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>
	<fc06fe6c788b46d2ba52ad83ddbc9b2c@EX-0-HT0.lancs.local>
	<CANVKczNcO=FvsdJWPcKWUY1nK4YaTO7YPN-_R=CYC8MYaF0_rw@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1207161526090.16075@reclus.nhh.no>

On Mon, 16 Jul 2012, Barry Rowlingson wrote:

> On Mon, Jul 16, 2012 at 10:36 AM, Lilis Husna <lily_franknich at yahoo.com> wrote:
>> when i run
>>
>>
>> res <- gw.adapt(cbind(columbus$x, columbus$y), cbind(columbus$x,
>> columbus$y), quant=0.5)
>>
>>
>> there is error message
>>
>> Error: could not find function "gw.adapt"
>>
>>
>> why did it happen?
>
> Who told you about gw.adapt?
>
> It seems to now be not exported from the spgwr package, but the help
> page is still there (Roger: is that a bug? Either you've missed it out
> of the exports or you've left in the .Rd file!).

I hadn't intended to export it since I cannot see that users need to use 
it directly, but forgot to remove the help file. I've committed gw.adapt 
in the NAMESPACE to R-Forge, and it will be exposed (since a user wants 
it) in the next release, or installing from R-Forge directly. For the 
currently released package, follow Barry's advice and use the spgwr::: 
prefix.

Roger

>
> If you want to use it you can use the triple-colon notation to get an
> unexported function from a package:
>
> res = spgwr:::gw.adapt(cbind(columbus$x,columbus$y),cbind(columbus$x,columbus$y),quant=0.5)
>
> Roger may have removed it for a good reason, and possibly put the
> functionality into another function. But the quick fix would be the
> triple-colon trick.
>
> It's also useful if you give package versions with your questions -
> here's mine:
>
>> packageDescription("spgwr")$Version
> [1] "0.6-14"
>
> Barry
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From babuawara at gmail.com  Mon Jul 16 17:12:48 2012
From: babuawara at gmail.com (Vikram Ranga)
Date: Mon, 16 Jul 2012 17:12:48 +0200
Subject: [R-sig-Geo] Package: Remote Sensing: HelpFile
Message-ID: <50042F70.5010401@gmail.com>

Hello,
I have recently installed the 'RemoteSensing' package but I could not 
find any help file with package describing about the functions.
I have R 2.13.2 version, so it could be installed by first downloading 
the package from the repository and installing from downloaded file (.zip).
Is there any document describing about the help and functions in this 
package?

Thanks in advance,

Vikram.


From roosbeh.nowrouzian at gmail.com  Mon Jul 16 21:57:33 2012
From: roosbeh.nowrouzian at gmail.com (Roosbeh Nowrouzian)
Date: Mon, 16 Jul 2012 15:57:33 -0400
Subject: [R-sig-Geo] Adding Spatial Polygon Data Frame to spplot output
Message-ID: <CAJw-hPaLOTA0Qi58-O6m=VJn4JV_6ikrx6GoWUv9wUJpv--mWw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/e12f2fcb/attachment.pl>

From sturgeon09 at gmail.com  Mon Jul 16 23:02:00 2012
From: sturgeon09 at gmail.com (Samuel Turgeon)
Date: Mon, 16 Jul 2012 17:02:00 -0400
Subject: [R-sig-Geo] Adding Spatial Polygon Data Frame to spplot output
In-Reply-To: <CAJw-hPaLOTA0Qi58-O6m=VJn4JV_6ikrx6GoWUv9wUJpv--mWw@mail.gmail.com>
References: <CAJw-hPaLOTA0Qi58-O6m=VJn4JV_6ikrx6GoWUv9wUJpv--mWw@mail.gmail.com>
Message-ID: <CAH3FZ04bwdV2nu3=70UsrAFsTQ8wc3YpewVeus_vYcL=XEiQ4g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/c3170407/attachment.pl>

From kerryr at sccwrp.org  Tue Jul 17 04:05:34 2012
From: kerryr at sccwrp.org (Kerry Ritter)
Date: Mon, 16 Jul 2012 19:05:34 -0700
Subject: [R-sig-Geo] back transforming kriged values
Message-ID: <5004C86E.2020204@sccwrp.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120716/3284dd13/attachment.pl>

From born.rebel.83 at gmail.com  Tue Jul 17 06:41:05 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Tue, 17 Jul 2012 10:11:05 +0530
Subject: [R-sig-Geo] cannot open: HTTP status was '403 Forbidden' The
 "sensor" parameter specified in the request must be set to either "true" or
 "false".
In-Reply-To: <CAM1yFZ-ffNYUy5Tqkwqz0NGZ3LkbR6ztz8phG+Wt_=JUEpSvfw@mail.gmail.com>
References: <CAM1yFZ-ffNYUy5Tqkwqz0NGZ3LkbR6ztz8phG+Wt_=JUEpSvfw@mail.gmail.com>
Message-ID: <CAM1yFZ-K4Y4tYTEBtYVhpi4cL5nsY-D73=LJb3djrhrMjok1SA@mail.gmail.com>

This is solved - credit to Marcelo from stackoverflow.

Attached the '&' to the front of the markers list as follows:

MyMap <- GetMap(markers='&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc',
destfile="MyTile1.png");

This resulted in the url:
http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=true&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc


-Anisha


On 16 July 2012 17:55, Anisha Kaul <born.rebel.83 at gmail.com> wrote:
> The "mow.R" now contains:
> __________________________________________
> library (RgoogleMaps)
> png (filename="RgoogleMaps-package_%03d_med.png", width=480, height=480)
>
> MyMap <- GetMap(markers =
> '40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc',
> sensor = "false", destfile = "MyTile1.png");
>
> tmp <- PlotOnStaticMap(MyMap,lat = c(40.702147,40.711614,40.718217),
> lon = c(-74.015794,-74.012318,-73.998284), cex=1.5,pch=20,col=c('red',
> 'blue', 'green'), add=F)
> __________________________________________
>
>
>
> Executing this from R results in:
> __________________________________________
>> source('mow.R')
> [1] "Note that when center and zoom are not specified, no meta
> information on the map tile can be stored. This basically means that R
> cannot compute proper coordinates. You can still download the map tile
> and view it in R but overlays are not possible. Do you want to proceed
> ? (y/n)"
> y
> [1] "40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc"
> [1] "http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=false40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc"
> Error in download.file(url, destfile, mode = "wb", quiet = TRUE) :
>   cannot open URL
> 'http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=false40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc'
> In addition: Warning message:
> In download.file(url, destfile, mode = "wb", quiet = TRUE) :
>   cannot open: HTTP status was '403 Forbidden'
>>
> __________________________________________
>
>
> I copied its url and pasted it in the browser:
> __________________________________________
> http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=false40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc
> __________________________________________
>
> It resulted in the following message:
> The Google Maps API server rejected your request. The "sensor"
> parameter specified in the request must be set to either "true" or
> "false".
>
>
> When I change the position of "&sensor=false" in the above url, it works fine:
> __________________________________________
> http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png3240.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc&sensor=false
> __________________________________________
>
>
> ****How to incorporate this change in the "mow.R" file now?****
> Please help;
>
> --
> Anisha Kaul



-- 
Anisha Kaul


From born.rebel.83 at gmail.com  Tue Jul 17 07:24:20 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Tue, 17 Jul 2012 10:54:20 +0530
Subject: [R-sig-Geo] Error in readChar(con, 5L,
	useBytes = TRUE) : cannot open the connection
Message-ID: <CAM1yFZ8jA_LEQqDqyuVsoA24u-BtLaGt92aSQEqGdB0Jk4dhng@mail.gmail.com>

Greetings,

R version 2.15.1
RgoogleMaps version 1.2.0
openSUSE 11.3, 64 bit


The source code file 'mow.R' now contains:
_______________________________________
library(RgoogleMaps);
png(filename="RgoogleMaps-package_%03d_med.png", width=480, height=480);

MyMap <- GetMap(markers='&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc',
destfile="MyTile1.png");
_______________________________________



This results in the following new error:
_______________________________________
> source('mow.R')
[1] "Note that when center and zoom are not specified, no meta
information on the map tile can be stored. This basically means that R
cannot compute proper coordinates. You can still download the map tile
and view it in R but overlays are not possible. Do you want to proceed
? (y/n)"
y
[1] "&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc"
[1] "http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=true&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc"

Error in readChar(con, 5L, useBytes = TRUE) : cannot open the connection
In addition: Warning message:
In readChar(con, 5L, useBytes = TRUE) :
  cannot open compressed file 'MyTile1.png.rda', probable reason 'No
such file or directory'
>
_______________________________________


I have to say that I don't know what does this function do:
`png(filename="RgoogleMaps-package_%03d_med.png", width=480,
height=480);`
I tried this example from here:
http://rgm2.lab.nig.ac.jp/RGM2/func.php?rd_id=RgoogleMaps:RgoogleMaps-package

If there is some other information that you want me to include, please
let me know.
What's the way to correct this error?



-- 
Regards,
Anisha Kaul


From mark at dimensionaledge.com  Tue Jul 17 07:00:53 2012
From: mark at dimensionaledge.com (Mark Wynter)
Date: Tue, 17 Jul 2012 15:00:53 +1000
Subject: [R-sig-Geo] Problem connecting to GRASS via spgrass6 and plr -
	SOLVED
In-Reply-To: <mailman.9.1342432804.12164.r-sig-geo@r-project.org>
References: <mailman.9.1342432804.12164.r-sig-geo@r-project.org>
Message-ID: <C5087299-FA1D-49B4-947A-666CA62F686D@dimensionaledge.com>

Thanks to Joe Conway and Greg Booma on the plr mailing list.  They saw the problem as a permissions issue.

The solution was to create a new GRASS mapset under the "postgres" user, due to the way mapset permissions work in GRASS.  I then changed initGRASS to the mapset="postgres" as per below. And presto!

For completeness, the following function now works when called from PostgreSQL.

CREATE OR REPLACE FUNCTION generate_viewshed() RETURNS text as 
$$
library(spgrass6)
initGRASS(gisBase = "/usr/local/grass-6.4.3svn/", home = tempdir(), gisDbase = "/usr/local/share/grassdata/", location = "aust_dem_1sec_wgs84", mapset = "postgres", SG="aust_dem_1sec", override = TRUE)
execGRASS("g.region", parameters = list(n="-34.9759927736275", s="-34.9985728860995", e="138.641896696527", w="138.619947232807", align="aust_dem_1sec"))
execGRASS("r.viewshed", parameters = list(input = "aust_dem_1sec", output = "viewshed_raster", coordinate = "138.630922,-34.987283", obs_elev = 25, max_dist = 1000), flags = c("b", "overwrite")) 
execGRASS("r.to.vect", parameters = list(input = "viewshed_raster", output = "viewshed_vector", feature = "area"), flags = c("overwrite")) 
execGRASS("v.out.ogr", parameters = list(input = "viewshed_vector", dsn = "PG:host=localhost dbname=test user=postgres password=password", olayer = "viewshed_vector", format = "PostgreSQL", type = "area"), flags = c("c")) 
$$
LANGUAGE 'plr';

- Mark


> 
> Message: 12
> Date: Mon, 16 Jul 2012 15:40:09 +1000
> From: Mark Wynter <mark at dimensionaledge.com>
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Problem connecting to GRASS via spgrass6 and plr
> Message-ID: <887F9806-BBEB-46BE-A160-33EBC0CBB627 at dimensionaledge.com>
> Content-Type: text/plain
> 
> I'm trying to access GRASS functionality via spgrass6 and a plr script.
> 
> The following works (when executed directly from within R)...
> 
> library(spgrass6)
> initGRASS(gisBase = "/usr/local/grass-6.4.3svn/", home = tempdir(), gisDbase = "/usr/local/share/grassdata/", location = "aust_dem_1sec_wgs84", mapset = "ubuntu", SG="aust_dem_1sec", override = TRUE)
> execGRASS("g.region", parameters = list(n="-34.9759927736275", s="-34.9985728860995", e="138.641896696527", w="138.619947232807", align="aust_dem_1sec"))
> execGRASS("r.viewshed", parameters = list(input = "aust_dem_1sec", output = "viewshed_raster", coordinate = "138.630922,-34.987283", obs_elev = 25, max_dist = 1000), flags = c("b", "overwrite")) 
> execGRASS("r.to.vect", parameters = list(input = "viewshed_raster", output = "viewshed_vector", feature = "area"), flags = c("overwrite")) 
> execGRASS("v.out.ogr", parameters = list(input = "viewshed_vector", dsn = "PG:host=localhost dbname=test user=postgres password=password", olayer = "viewshed_vector", format = "PostgreSQL", type = "area"), flags = c("c")) 
> 
> But not so when called by a plr function...
> 
> CREATE OR REPLACE FUNCTION generate_viewshed() RETURNS text as $$
> library(spgrass6)
> initGRASS(gisBase = "/usr/local/grass-6.4.3svn/", home = tempdir(), gisDbase = "/usr/local/share/grassdata/", location = "aust_dem_1sec_wgs84", mapset = "ubuntu", SG="aust_dem_1sec", override = TRUE)
> execGRASS("g.region", parameters = list(n="-34.9759927736275", s="-34.9985728860995", e="138.641896696527", w="138.619947232807", align="aust_dem_1sec"))
> execGRASS("r.viewshed", parameters = list(input = "aust_dem_1sec", output = "viewshed_raster", coordinate = "138.630922,-34.987283", obs_elev = 25, max_dist = 1000), flags = c("b", "overwrite")) 
> execGRASS("r.to.vect", parameters = list(input = "viewshed_raster", output = "viewshed_vector", feature = "area"), flags = c("overwrite")) 
> execGRASS("v.out.ogr", parameters = list(input = "viewshed_vector", dsn = "PG:host=localhost dbname=test user=postgres password=password", olayer = "viewshed_vector", format = "PostgreSQL", type = "area"), flags = c("c")) 
> $$ LANGUAGE 'plr';
> 
> I get the following error.... which through a process of elimination the error occurs at the initGRASS() line...
> 
> ERROR:  R interpreter expression evaluation error
> DETAIL:  Error in parseGRASS(cmd) : g.region not parsed
> CONTEXT:  In PL/R function generate_viewshed
> 
> Is there a compatibility issue between plr and spgrass6, or is it due to something on my part?   Any suggestions?
> 
> BTW, I've also posted this on the plr mailing list.
> 
> Thanks
> 
> Mark
> 	[[alternative HTML version deleted]]
> 
> 
\

From born.rebel.83 at gmail.com  Tue Jul 17 08:22:30 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Tue, 17 Jul 2012 11:52:30 +0530
Subject: [R-sig-Geo] Error in readChar(con, 5L,
	useBytes = TRUE) : cannot open the connection
In-Reply-To: <CAM1yFZ8jA_LEQqDqyuVsoA24u-BtLaGt92aSQEqGdB0Jk4dhng@mail.gmail.com>
References: <CAM1yFZ8jA_LEQqDqyuVsoA24u-BtLaGt92aSQEqGdB0Jk4dhng@mail.gmail.com>
Message-ID: <CAM1yFZ9dn8ah-JY66jWsnq=i1xKRd4=ODxJddVOeAcVH1G6VFg@mail.gmail.com>

This is solved. Here's the working code.

____________________________________
library(RgoogleMaps);
png(filename="Rg.png", width=480, height=480);


lat    = c(40.702147,40.718217,40.711614);
lon    = c(-74.012318,-74.015794,-73.998284);
center = c(mean(lat), mean(lon));
zoom <- min(MaxZoom(range(lat), range(lon)));

MyMap <- GetMap(center=center, zoom=zoom,
markers='&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc',
destfile="My.png");

tmp <- PlotOnStaticMap(MyMap,lat=c(40.702147,40.711614,40.718217),lon=c(-74.015794,-74.012318,-73.998284),cex=1.5,pch=20,col=c('red',
'blue', 'green'),add=F);

dev.off();
____________________________________



On 17 July 2012 10:54, Anisha Kaul <born.rebel.83 at gmail.com> wrote:
> Greetings,
>
> R version 2.15.1
> RgoogleMaps version 1.2.0
> openSUSE 11.3, 64 bit
>
>
> The source code file 'mow.R' now contains:
> _______________________________________
> library(RgoogleMaps);
> png(filename="RgoogleMaps-package_%03d_med.png", width=480, height=480);
>
> MyMap <- GetMap(markers='&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc',
> destfile="MyTile1.png");
> _______________________________________
>
>
>
> This results in the following new error:
> _______________________________________
>> source('mow.R')
> [1] "Note that when center and zoom are not specified, no meta
> information on the map tile can be stored. This basically means that R
> cannot compute proper coordinates. You can still download the map tile
> and view it in R but overlays are not possible. Do you want to proceed
> ? (y/n)"
> y
> [1] "&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc"
> [1] "http://maps.google.com/maps/api/staticmap?size=640x640&maptype=terrain&format=png32&sensor=true&40.702147,-74.015794,blues%7C40.711614,-74.012318,greeng%7C40.718217,-73.998284,redc"
>
> Error in readChar(con, 5L, useBytes = TRUE) : cannot open the connection
> In addition: Warning message:
> In readChar(con, 5L, useBytes = TRUE) :
>   cannot open compressed file 'MyTile1.png.rda', probable reason 'No
> such file or directory'
>>
> _______________________________________
>
>
> I have to say that I don't know what does this function do:
> `png(filename="RgoogleMaps-package_%03d_med.png", width=480,
> height=480);`
> I tried this example from here:
> http://rgm2.lab.nig.ac.jp/RGM2/func.php?rd_id=RgoogleMaps:RgoogleMaps-package
>
> If there is some other information that you want me to include, please
> let me know.
> What's the way to correct this error?
>
>
>
> --
> Regards,
> Anisha Kaul



-- 
Anisha Kaul


From alobolistas at gmail.com  Tue Jul 17 15:34:30 2012
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 17 Jul 2012 15:34:30 +0200
Subject: [R-sig-Geo] Points to line
Message-ID: <CAG4NReK3mF3JA9v_ZeRG6HmJrG_cqd-4En+vOWnYcuASuMfZ3g@mail.gmail.com>

Hi!

Is there a function to convert a set of ordered points (i.e. in a
Spatial Points Data Frame)
into an Spatial Line object?

Thanks

Agus


From b.rowlingson at lancaster.ac.uk  Tue Jul 17 15:49:44 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 17 Jul 2012 14:49:44 +0100
Subject: [R-sig-Geo] Points to line
In-Reply-To: <e82fedfe7d254e2db0f56af4fe4fc171@EX-0-HT0.lancs.local>
References: <e82fedfe7d254e2db0f56af4fe4fc171@EX-0-HT0.lancs.local>
Message-ID: <CANVKczNXFMNonT95_UgFqWhBj6TXk1853Ri8X-e9XQGXD6xDig@mail.gmail.com>

On Tue, Jul 17, 2012 at 2:34 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
>
> Is there a function to convert a set of ordered points (i.e. in a
> Spatial Points Data Frame)
> into an Spatial Line object?

 No, because there's no such thing as a Spatial Line object, or even a
SpatialLine object :)

There are Line objects, Lines objects, SpatialLines objects and
SpatialLinesDataFrame objects, all with different structures and
meanings.

 To convert to SpatialLines, get the coordinates and build in the
usual convoluted manner:

 > s=data.frame(x=runif(10),y=1:10,z=rnorm(10))
 > coordinates(s)=~x+y
 > L = SpatialLines(list(Lines(list(Line(coordinates(s))),"X")))
 > plot(L)


My spatial cheatsheat might help:

http://www.maths.lancs.ac.uk/~rowlings/Teaching/UseR2012/cheatsheet.html

Barry


From simeon.mangoti at hotmail.com  Tue Jul 17 16:10:03 2012
From: simeon.mangoti at hotmail.com (Simeon)
Date: Tue, 17 Jul 2012 07:10:03 -0700 (PDT)
Subject: [R-sig-Geo] Class range on bubble plot
Message-ID: <1342534203683-7580516.post@n2.nabble.com>

Hi,

I desire to customise the key.entries parameter of the bubble function
(package sp) to define classes of values to present on my map.

I first try to use classIntervals (from classInt package) to define classes
of values and then call it in the key.entries argument. But I didn't
succeed.

I try to play with key.entries, but I didn't succeed to modify the size of
circles on the map, just on the legend. Where I'm doing wrong? or is
key.entries the right argument to modify, in order to change the display of
the bubble function?

require(sp) 
data(meuse) 
coordinates(meuse) = ~x+y 
bubble(meuse["zinc"], maxsize=3, key.entries = c(10,100,1000,10000))
bubble(meuse["zinc"], maxsize=3, key.entries = c(10,500,1500,10000)) 
bubble(meuse["zinc"], maxsize=3, key.entries = c(10,800,1600,10000)) 
bubble(meuse["zinc"], maxsize=3, key.entries = c(10,3000,10000)) 


Maybe I don't understand well how to use this function, so if you have any
idea or documentation that I should read, just let me know.

Thanks,

Sim?on


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Class-range-on-bubble-plot-tp7580516.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From sturgeon09 at gmail.com  Tue Jul 17 16:27:00 2012
From: sturgeon09 at gmail.com (Samuel Turgeon)
Date: Tue, 17 Jul 2012 10:27:00 -0400
Subject: [R-sig-Geo] Class range on bubble plot
In-Reply-To: <1342534203683-7580516.post@n2.nabble.com>
References: <1342534203683-7580516.post@n2.nabble.com>
Message-ID: <CAH3FZ04duScd=T2DXbW-nWiKNiX37MroVOi6Aq7e3pTPD3qy_A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120717/75fd67f1/attachment.pl>

From roosbeh.nowrouzian at gmail.com  Tue Jul 17 18:19:52 2012
From: roosbeh.nowrouzian at gmail.com (Roosbeh Nowrouzian)
Date: Tue, 17 Jul 2012 12:19:52 -0400
Subject: [R-sig-Geo] Putting Multiple spplots in the same page
Message-ID: <CAJw-hPZJx5cGnNzXFp0WV8vD+kun1+amUjfJp=Uy7L9wv=+Vmg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120717/a1330f42/attachment.pl>

From simon.ohanlon at imperial.ac.uk  Tue Jul 17 18:46:56 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Tue, 17 Jul 2012 16:46:56 +0000
Subject: [R-sig-Geo] Read raster data in Big Endian (Motorola) byteorder on
 Little Endian (Intel) system
Message-ID: <7AE0828DCFFC0144817331B53EDC11A0188960E7@icexch-m5.ic.ac.uk>

Dear all,
I am working with some raster data (.bil format), with values stored in big endian byteorder. The info in the associated .hdr file is:
BYTEORDER      M
LAYOUT       BIL
NROWS         9194
NCOLS         8736
NBANDS        1
NBITS         16
BANDROWBYTES         17472
TOTALROWBYTES        17472
BANDGAPBYTES         0

When I read in 'mydata' using raster I see that it correctly states the min (-9999) and max (2376) values of the data (I assume from the .stx file since I believe the values are not actually read to memory at this stage?). However when I do str(mydata) I see that @file at byteorder slot is "little" and if I try:
 
values <- getValues(mydata) 
min(values)
2
max(values) 
55537
And most weirdly if I do:
summary(values)
Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      2     757   55540   35030   55540   55540

Does anyone know if/how I can specify the byteorder as Big Endian to the rgdal driver/raster function? I have tried changing BYTEORDER      in the .hdr file to "big", but it does not work.

Thanks,

Simon


From b.rowlingson at lancaster.ac.uk  Tue Jul 17 18:55:29 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 17 Jul 2012 17:55:29 +0100
Subject: [R-sig-Geo] Putting Multiple spplots in the same page
In-Reply-To: <7bd60c9e6c184faea624a43fbf30544e@EX-0-HT0.lancs.local>
References: <7bd60c9e6c184faea624a43fbf30544e@EX-0-HT0.lancs.local>
Message-ID: <CANVKczN4Pvz5ph41r1vHoTB7sNyb45iUz59Tpv7tr6LB_3Gr0Q@mail.gmail.com>

On Tue, Jul 17, 2012 at 5:19 PM, Roosbeh Nowrouzian
<roosbeh.nowrouzian at gmail.com> wrote:
> Dear List members:
>
> While par(mfrow=c(i,j)) works for plot function, I met a problem with
> spplot function. Even after defining e.g. par(mfrow=c(2,2)) The spplot
> draws each figure separately.Here is an example:
>
> par(mfrow=c(2,2))
>
> data(meuse)
> coordinates(meuse) <- ~x+y
>
> spplot ( meuse, "zinc")
> spplot(meuse,"copper")
> spplot(meuse,"lead")
> spplot(meuse,"cadmium")
>
> Does any one knows how to put multiple spplot in the same page?
>

Either ditch spplot and realise that for single maps all that
spplot(foo,"bar") is doing is essentially plot(foo,col=f(foo$bar)).
Just write a function f to map values to colours in a palette and do
that, with par(mfrow=c(2,2)). Also, spplots default palette is awful
for points - you'll get white points on a white background, so don't
use that.

If you dont want to customise your maps with base graphics you need to
dive into grid graphics, get the gridExtra package and then:

 > require(gridExtra)
 > grid.arrange(spplot(meuse,"zinc"),spplot(meuse,"cadmium"),spplot(meuse,"lead"),spplot(meuse,"copper"),ncol=2)

Its a whole new world. Anyway, you'll probably want to do this with
ggplot2 next...

Barry


From sturgeon09 at gmail.com  Tue Jul 17 19:07:43 2012
From: sturgeon09 at gmail.com (Samuel Turgeon)
Date: Tue, 17 Jul 2012 13:07:43 -0400
Subject: [R-sig-Geo] Putting Multiple spplots in the same page
In-Reply-To: <CANVKczN4Pvz5ph41r1vHoTB7sNyb45iUz59Tpv7tr6LB_3Gr0Q@mail.gmail.com>
References: <7bd60c9e6c184faea624a43fbf30544e@EX-0-HT0.lancs.local>
	<CANVKczN4Pvz5ph41r1vHoTB7sNyb45iUz59Tpv7tr6LB_3Gr0Q@mail.gmail.com>
Message-ID: <CAH3FZ07HgVo=U2ow0fMFFVw49HvxjzAAHfLCAyyUC8qXvMEbnQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120717/222729b7/attachment.pl>

From simon.ohanlon at imperial.ac.uk  Tue Jul 17 19:58:03 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Tue, 17 Jul 2012 17:58:03 +0000
Subject: [R-sig-Geo] Read raster data in Big Endian (Motorola) byteorder
 on Little Endian (Intel) system
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A0188960E7@icexch-m5.ic.ac.uk>
References: <7AE0828DCFFC0144817331B53EDC11A0188960E7@icexch-m5.ic.ac.uk>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A018896146@icexch-m5.ic.ac.uk>

For anyone who is working with the Hydro 1K dataset from the USGS EROS centre you might find this useful as this is the data I had a problem getting read in correctly. But it was not due to byte ordering issues as I initially thought (see below). It was simply because the GDAL driver was not recognising that the data was signed integer rather than unsigned.

After reading some documentation on the gdal website and playing around I found all I needed to do was add a PIXELTYPE  argument to my .HDR file and set the value to SIGNEDINT:

And after reading in the same data I now I get the following:
getValues(mydata)
min(mydata)
-9999
max(mydata)
2376

Which is what it is supposed to be according to the data documentation and my plots look correct now.

Hope that helps someone in the future avoid the nasty mistake I nearly made (analysing totally incorrect values!).

Simon

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of O'Hanlon, Simon J
Sent: 17 July 2012 17:47
To: R-sig-Geo at r-project.org
Subject: [R-sig-Geo] Read raster data in Big Endian (Motorola) byteorder on Little Endian (Intel) system

Dear all,
I am working with some raster data (.bil format), with values stored in big endian byteorder. The info in the associated .hdr file is:
BYTEORDER      M
LAYOUT       BIL
NROWS         9194
NCOLS         8736
NBANDS        1
NBITS         16
BANDROWBYTES         17472
TOTALROWBYTES        17472
BANDGAPBYTES         0

When I read in 'mydata' using raster I see that it correctly states the min (-9999) and max (2376) values of the data (I assume from the .stx file since I believe the values are not actually read to memory at this stage?). However when I do str(mydata) I see that @file at byteorder slot is "little" and if I try:
 
values <- getValues(mydata) 
min(values)
2
max(values) 
55537
And most weirdly if I do:
summary(values)
Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      2     757   55540   35030   55540   55540

Does anyone know if/how I can specify the byteorder as Big Endian to the rgdal driver/raster function? I have tried changing BYTEORDER      in the .hdr file to "big", but it does not work.

Thanks,

Simon

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mdsumner at gmail.com  Tue Jul 17 23:57:03 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 18 Jul 2012 07:57:03 +1000
Subject: [R-sig-Geo] Points to line
In-Reply-To: <CAG4NReK3mF3JA9v_ZeRG6HmJrG_cqd-4En+vOWnYcuASuMfZ3g@mail.gmail.com>
References: <CAG4NReK3mF3JA9v_ZeRG6HmJrG_cqd-4En+vOWnYcuASuMfZ3g@mail.gmail.com>
Message-ID: <CAAcGz99xc_TgGxJNiqUmB4gLf_KLk3WVrxT=qwwSz=FYGK64cw@mail.gmail.com>

There is support for coercion from "trip" objects in the trip package,
which might be overkill for your needs, but it handles multiple sets
of coordinates identified by ID and ordered by date-time, creating a
Lines object for each with summary data. (Overkill maybe since if you
only have one set of coordinates you will need an ID, and you need
date-times to be set in the right order).

library(trip)

d <- data.frame(x = 1:10, y = rnorm(10), tms = Sys.time() +  c(1:6,
c(2, 4, 6, 8)), id = c(rep(1, 6), rep(2, 4)))
coordinates(d) <- ~x+y

## this step enforces a number of validation checks
tr <- trip(d, c("tms", "id"))

## Now straightforward coercion works, dropping all data
## except a start/end and duration summary

as(tr, "SpatialLinesDataFrame")

An object of class "SpatialLinesDataFrame"
Slot "data":
  tripID           tripStart             tripEnd tripDur
1      1 2012-07-17 21:55:14 2012-07-17 21:55:19       5
2      2 2012-07-17 21:55:15 2012-07-17 21:55:21       6

Slot "lines":
[[1]]
An object of class "Lines"
Slot "Lines":
[[1]]
An object of class "Line"
Slot "coords":
     x          y
[1,] 1  2.1981132
[2,] 2 -0.1139012
[3,] 3  0.4010417
[4,] 4 -0.5567641
[5,] 5 -0.5245291
[6,] 6  0.2547033



Slot "ID":
[1] "1"


[[2]]
An object of class "Lines"
Slot "Lines":
[[1]]
An object of class "Line"
Slot "coords":
      x          y
[1,]  7  0.6552012
[2,]  8  2.0787520
[3,]  9  0.8308318
[4,] 10 -1.7930436



Slot "ID":
[1] "2"



Slot "bbox":
        min       max
x  1.000000 10.000000
y -1.793044  2.198113

Slot "proj4string":
CRS arguments: NA


Cheers, Mike

On Tue, Jul 17, 2012 at 11:34 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
>
> Is there a function to convert a set of ordered points (i.e. in a
> Spatial Points Data Frame)
> into an Spatial Line object?
>
> Thanks
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From simon.ohanlon at imperial.ac.uk  Wed Jul 18 11:38:28 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Wed, 18 Jul 2012 09:38:28 +0000
Subject: [R-sig-Geo] Help with gpclib
In-Reply-To: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
References: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>

Dear Manuel,
I am also running R2.15.1 on Mac OS X 10.7.

I get:
> library(maptools)
Loading required package: foreign
Loading required package: sp
Loading required package: lattice
Checking rgeos availability: TRUE
> library(rgdal)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.0, released 2011/12/29
Path to GDAL shared files: /Users/Simon/R64Libs/rgdal/gdal
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files: /Users/Simon/R64Libs/rgdal/proj
> library(rgeos)
Loading required package: stringr
Loading required package: plyr
rgeos: (SVN revision 348)
 GEOS runtime version: 3.3.3-CAPI-1.7.4 
 Polygon checking: TRUE 

> gpclibPermitStatus()
[1] FALSE
> gpclibPermit()
[1] TRUE

Perhaps you can try updating to the latest rgeos release? And maybe try updating your rgdal from the kyngchaos website (if it isn't already the latest version)?

HTH,

Simon
--------------------------------
Simon O'Hanlon, BSc MSc
Department of Infectious Disease Epidemiology
Imperial College London
St. Mary's Hospital
London
W2 1PG
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Manuel Sp?nola [mspinola10 at gmail.com]
Sent: 15 July 2012 16:02
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Help with gpclib

Dear list members,

I am running R 2.15.1 on a MAC OSX 10.7.

I receive an error message regarding gpclib (see below):

> library(rgdal)
> library(maptools)
> library(rgeos)
Loading required package: stringr
rgeos: (SVN revision 330)
 GEOS runtime version: 3.3.2-CAPI-1.7.2
 Polygon checking: TRUE
 WARNING! if you turn polygon checking off, and polygons are
 not valid in GEOS, you risk losing data as your R session may crash!

> indice <- readOGR(".", "indicesalud2007crtm")
OGR data source with driver: ESRI Shapefile
Source: ".", layer: "indicesalud2007crtm"
with 82 features and 27 fields
Feature type: wkbPolygon with 2 dimensions

> map <- fortify(indice)
Using NCANTON to define regions.
Error: gpclib, maptools package required for this functionality.  Please
install and try again.

> gpclibPermit()
[1] FALSE

Best,

Manuel


--
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Tel?fono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

        [[alternative HTML version deleted]]



From simon.ohanlon at imperial.ac.uk  Wed Jul 18 13:05:55 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Wed, 18 Jul 2012 11:05:55 +0000
Subject: [R-sig-Geo] spTransform and proj parameters
Message-ID: <7AE0828DCFFC0144817331B53EDC11A0188983D3@icexch-m5.ic.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120718/7643ffdc/attachment.pl>

From JRadinger at gmx.at  Wed Jul 18 15:16:51 2012
From: JRadinger at gmx.at (Johannes Radinger)
Date: Wed, 18 Jul 2012 15:16:51 +0200
Subject: [R-sig-Geo] melt spatialPixelDataFrame
Message-ID: <20120718131651.130240@gmx.net>

Hi,

maybe someone know a simple solution:

I want to melt (melt from reshape2) a SpatialPixelDataFrame with the two ids (x and y). 

I tried: 
1) to transform the SPDF to a normal dataframe with as.data.frame(spdf) but then I loose my x and y columns. Thus I can't use them in melt. Was that behavior changed recently?
2) to melt the spdf itself wasn't working either....

Probably I need a normal dataframe + the x and y column from the SPDF.

/Johannes


From mdsumner at gmail.com  Wed Jul 18 15:22:54 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 18 Jul 2012 23:22:54 +1000
Subject: [R-sig-Geo] melt spatialPixelDataFrame
In-Reply-To: <20120718131651.130240@gmx.net>
References: <20120718131651.130240@gmx.net>
Message-ID: <CAAcGz9-GX=745zuArCyw_w6GJuYDwxfhT_Y3813uX_Ykne4FXg@mail.gmail.com>

On Wed, Jul 18, 2012 at 11:16 PM, Johannes Radinger <JRadinger at gmx.at> wrote:
> Hi,
>
> maybe someone know a simple solution:
>
> I want to melt (melt from reshape2) a SpatialPixelDataFrame with the two ids (x and y).
>
> I tried:
> 1) to transform the SPDF to a normal dataframe with as.data.frame(spdf) but then I loose my x and y columns. Thus I can't use them in melt. Was that behavior changed recently?

No, I really don't think so. Are you sure?  Here x.1 and y.1 are the
(re-attached) grid point coordinates, which incidentally are copies of
the original data "x" and "y".

data(meuse.grid)
m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)
head(as.data.frame(m))
       x      y part.a part.b      dist soil ffreq    x.1    y.1
1 181180 333740      1      0 0.0000000    1     1 181180 333740
2 181140 333700      1      0 0.0000000    1     1 181140 333700
3 181180 333700      1      0 0.0122243    1     1 181180 333700



> 2) to melt the spdf itself wasn't working either....
>
> Probably I need a normal dataframe + the x and y column from the SPDF.
>
> /Johannes
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From simeon.mangoti at hotmail.com  Wed Jul 18 15:31:46 2012
From: simeon.mangoti at hotmail.com (Simeon)
Date: Wed, 18 Jul 2012 06:31:46 -0700 (PDT)
Subject: [R-sig-Geo] Class range on bubble plot
In-Reply-To: <CAH3FZ04duScd=T2DXbW-nWiKNiX37MroVOi6Aq7e3pTPD3qy_A@mail.gmail.com>
References: <1342534203683-7580516.post@n2.nabble.com>
	<CAH3FZ04duScd=T2DXbW-nWiKNiX37MroVOi6Aq7e3pTPD3qy_A@mail.gmail.com>
Message-ID: <1342618306461-7580528.post@n2.nabble.com>

Hi,

Forgive me for this nonsense, I should have check the distribution before
defining the cutting classes on my example. But I still do not understand
what key.entries really do.

When I look to your plot


Samuel Turgeon wrote
> 
> bubble(meuse["zinc"], maxsize=3, key.entries = c(100,500,700,2000))
> 

It seems that there is more circles types on the map than on the legend. Is
each circle on the map represents the exact value of the measuring point? Or
is there a classification of measuring points, and if so how works it?


When I play with the key.entries values, it seems that the circles on the
map are not affected (just the legend).

classIntervals(meuse$zinc,4,style="equal")
bubble(meuse["zinc"], maxsize=3, key.entries = c(544.5,976,1407.5,1839))

classIntervals(meuse$zinc,4,style="quantile")
bubble(meuse["zinc"], maxsize=3, key.entries = c(198,326,674.5,1839))

classIntervals(meuse$zinc,4,style="jenks")
bubble(meuse["zinc"], maxsize=3, key.entries = c(432,833,1190,1839))


And I don't understand why.

Thanks in advance

Sim?on



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Class-range-on-bubble-plot-tp7580516p7580528.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From JRadinger at gmx.at  Wed Jul 18 15:48:08 2012
From: JRadinger at gmx.at (Johannes Radinger)
Date: Wed, 18 Jul 2012 15:48:08 +0200
Subject: [R-sig-Geo] melt spatialPixelDataFrame
In-Reply-To: <CAAcGz9-GX=745zuArCyw_w6GJuYDwxfhT_Y3813uX_Ykne4FXg@mail.gmail.com>
References: <20120718131651.130240@gmx.net>
	<CAAcGz9-GX=745zuArCyw_w6GJuYDwxfhT_Y3813uX_Ykne4FXg@mail.gmail.com>
Message-ID: <20120718134808.17780@gmx.net>

Hi,

> > I tried:
> > 1) to transform the SPDF to a normal dataframe with as.data.frame(spdf)
> but then I loose my x and y columns. Thus I can't use them in melt. Was
> that behavior changed recently?
> 
> No, I really don't think so. Are you sure?  Here x.1 and y.1 are the
> (re-attached) grid point coordinates, which incidentally are copies of
> the original data "x" and "y".
> 
> data(meuse.grid)
> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data =
> meuse.grid)
> head(as.data.frame(m))
>        x      y part.a part.b      dist soil ffreq    x.1    y.1
> 1 181180 333740      1      0 0.0000000    1     1 181180 333740
> 2 181140 333700      1      0 0.0000000    1     1 181140 333700
> 3 181180 333700      1      0 0.0122243    1     1 181180 333700

I am not 100% sure but my output looks different from yours (I am missing x.1 and y.1, the original coords from the SPDF and not the re-attached ones)
Here the output with the same example and sessionInfo():

> library(raster)
Loading required package: sp
raster 2.0-08 (27-June-2012)
> data(meuse.grid)
> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)
> head(as.data.frame(m))
       x      y part.a part.b      dist soil ffreq
1 181180 333740      1      0 0.0000000    1     1
2 181140 333700      1      0 0.0000000    1     1
3 181180 333700      1      0 0.0122243    1     1
4 181220 333700      1      0 0.0434678    1     1
5 181100 333660      1      0 0.0000000    1     1
6 181140 333660      1      0 0.0122243    1     1
> sessionInfo()
R version 2.14.1 (2011-12-22)
Platform: i686-pc-linux-gnu (32-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=C                 LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods  
[7] base     

other attached packages:
[1] raster_2.0-08 sp_0.9-99    

loaded via a namespace (and not attached):
[1] grid_2.14.1    lattice_0.20-0 tools_2.14.1 




Any idea?

/johannes


From erdal.karaca.de at gmail.com  Wed Jul 18 16:42:13 2012
From: erdal.karaca.de at gmail.com (Erdal Karaca)
Date: Wed, 18 Jul 2012 16:42:13 +0200
Subject: [R-sig-Geo] (no subject)
Message-ID: <CAFXiavbsAyrUz9_1+AxZqWiTgKDFtVFpGb-P38OSPS_gSZYgKw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120718/ef01b8b6/attachment.pl>

From mdsumner at gmail.com  Wed Jul 18 16:59:25 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 19 Jul 2012 00:59:25 +1000
Subject: [R-sig-Geo] melt spatialPixelDataFrame
In-Reply-To: <20120718134808.17780@gmx.net>
References: <20120718131651.130240@gmx.net>
	<CAAcGz9-GX=745zuArCyw_w6GJuYDwxfhT_Y3813uX_Ykne4FXg@mail.gmail.com>
	<20120718134808.17780@gmx.net>
Message-ID: <CAAcGz99FpdG6n3GbQ7p6OmTEi0i_iXknV5mXMMJGVnNVnYH-9g@mail.gmail.com>

Right, sure enough I got the x.1 and y.1 as per my first reply with
raster 1.9-92, but after update to 2.0-08 I get your results without
them. And, to be sure, see my run in a fresh session.

I need to explore more to understand this, but things should work as
expected with sp if you don't load raster (for now).

Robert? Sorry I'm not familiar enough with raster to hunt this down
easily, so I thought I'd raise it.

Cheers, Mike.

Code to run:


library(sp)
data(meuse.grid)
m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)
head(as.data.frame(m))



library(raster)
head(as.data.frame(m))



Session:

> library(sp)
> data(meuse.grid)
> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)

> head(as.data.frame(m))
       x      y part.a part.b      dist soil ffreq    x.1    y.1
1 181180 333740      1      0 0.0000000    1     1 181180 333740
2 181140 333700      1      0 0.0000000    1     1 181140 333700
3 181180 333700      1      0 0.0122243    1     1 181180 333700
4 181220 333700      1      0 0.0434678    1     1 181220 333700
5 181100 333660      1      0 0.0000000    1     1 181100 333660
6 181140 333660      1      0 0.0122243    1     1 181140 333660
>
>
>
> library(raster)
raster 2.0-08 (27-June-2012)
> head(as.data.frame(m))
       x      y part.a part.b      dist soil ffreq
1 181180 333740      1      0 0.0000000    1     1
2 181140 333700      1      0 0.0000000    1     1
3 181180 333700      1      0 0.0122243    1     1
4 181220 333700      1      0 0.0434678    1     1
5 181100 333660      1      0 0.0000000    1     1
6 181140 333660      1      0 0.0122243    1     1
>
> sessionInfo()
R version 2.15.1 Patched (2012-06-29 r59683)
Platform: x86_64-pc-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  compiler  methods
[8] base

other attached packages:
[1] raster_2.0-08 sp_0.9-99

loaded via a namespace (and not attached):
[1] grid_2.15.1    lattice_0.20-6 tools_2.15.1





On Wed, Jul 18, 2012 at 11:48 PM, Johannes Radinger <JRadinger at gmx.at> wrote:
> Hi,
>
>> > I tried:
>> > 1) to transform the SPDF to a normal dataframe with as.data.frame(spdf)
>> but then I loose my x and y columns. Thus I can't use them in melt. Was
>> that behavior changed recently?
>>
>> No, I really don't think so. Are you sure?  Here x.1 and y.1 are the
>> (re-attached) grid point coordinates, which incidentally are copies of
>> the original data "x" and "y".
>>
>> data(meuse.grid)
>> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data =
>> meuse.grid)
>> head(as.data.frame(m))
>>        x      y part.a part.b      dist soil ffreq    x.1    y.1
>> 1 181180 333740      1      0 0.0000000    1     1 181180 333740
>> 2 181140 333700      1      0 0.0000000    1     1 181140 333700
>> 3 181180 333700      1      0 0.0122243    1     1 181180 333700
>
> I am not 100% sure but my output looks different from yours (I am missing x.1 and y.1, the original coords from the SPDF and not the re-attached ones)
> Here the output with the same example and sessionInfo():
>
>> library(raster)
> Loading required package: sp
> raster 2.0-08 (27-June-2012)
>> data(meuse.grid)
>> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)
>> head(as.data.frame(m))
>        x      y part.a part.b      dist soil ffreq
> 1 181180 333740      1      0 0.0000000    1     1
> 2 181140 333700      1      0 0.0000000    1     1
> 3 181180 333700      1      0 0.0122243    1     1
> 4 181220 333700      1      0 0.0434678    1     1
> 5 181100 333660      1      0 0.0000000    1     1
> 6 181140 333660      1      0 0.0122243    1     1
>> sessionInfo()
> R version 2.14.1 (2011-12-22)
> Platform: i686-pc-linux-gnu (32-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>  [7] LC_PAPER=C                 LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods
> [7] base
>
> other attached packages:
> [1] raster_2.0-08 sp_0.9-99
>
> loaded via a namespace (and not attached):
> [1] grid_2.14.1    lattice_0.20-0 tools_2.14.1
>
>
>
>
> Any idea?
>
> /johannes



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From ahering at mines.edu  Wed Jul 18 17:54:56 2012
From: ahering at mines.edu (Mandy Hering)
Date: Wed, 18 Jul 2012 15:54:56 +0000
Subject: [R-sig-Geo] New User ST Variogram Error Message
Message-ID: <E83392CE-D908-403F-9B7B-9861B6018797@mines.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120718/2a3ed12d/attachment.pl>

From ahering at mines.edu  Wed Jul 18 20:17:24 2012
From: ahering at mines.edu (Mandy Hering)
Date: Wed, 18 Jul 2012 18:17:24 +0000
Subject: [R-sig-Geo] New User ST Variogram Error Message
Message-ID: <D4E3DF1C-1C10-4C80-864C-EB4D9DDFC630@mines.edu>

I reinstalled the latest version of R and all of the necessary packages, and now everything is working fine.

From robbymarrotte at gmail.com  Wed Jul 18 20:24:58 2012
From: robbymarrotte at gmail.com (Robby Marrotte)
Date: Wed, 18 Jul 2012 14:24:58 -0400
Subject: [R-sig-Geo] Location polygon from triangulation data
Message-ID: <CABd5c47uQ24Nrgfg-zg21fi1wwuiN=7pqk6EyMtOBzkmMQUFKg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120718/69e3def5/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Jul 18 23:09:45 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 18 Jul 2012 22:09:45 +0100
Subject: [R-sig-Geo] Location polygon from triangulation data
In-Reply-To: <a81c8fd1463f4911a30c403f0fd2d892@EX-1-HT0.lancs.local>
References: <a81c8fd1463f4911a30c403f0fd2d892@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOcrDWh2xHUvnc2yj4QkkKi-k0L7oES9=7uhFsEtL2=qw@mail.gmail.com>

On Wed, Jul 18, 2012 at 7:24 PM, Robby Marrotte <robbymarrotte at gmail.com> wrote:
> Hello everyone,
>
> I have data where for every tracked individual we have 3 radio-telemetry xy
> locations with an orientation (0-360 deg). What I want to do is create
> triangles which represent the possible locations of each individual. It
> seems quite simple, but I haven`t found a script which does this yet. I
> tried Hawth`s tools but it doesn't have anything like this.

Hawth? Who that?

 I'm no expert in this, but I've had a good search for anything that
might do this in R, but can't find anything either. Found some
literature (Russell V. Lenth appears to be quite the man for this) and
some of the techniques in "On Finding The Source Of A Signal" in
Technometrics 1981 by him should be easy to implement in R if anyone
has a spare day...

 The naive method of intersecting the lines should be doable with
high-school geometry, but Lenth warns:

"""
A simple method for estimating (x, y) would be to use the
componentwise average of the n(n - 1)/2 bearing intersections
(assuming the observation points are distinct and that each bearing
intersects all other bearings). However, these points of intersection
are not stochastically independent. Moreover, their error structures
depend on the distances from the corresponding observation points as
well as the angle of intersection. Thus it would be difficult to
determine the statistical properties of such an estimator."""

Barry


From r.hijmans at gmail.com  Wed Jul 18 23:40:07 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 18 Jul 2012 14:40:07 -0700
Subject: [R-sig-Geo] Location polygon from triangulation data
In-Reply-To: <CANVKczOcrDWh2xHUvnc2yj4QkkKi-k0L7oES9=7uhFsEtL2=qw@mail.gmail.com>
References: <a81c8fd1463f4911a30c403f0fd2d892@EX-1-HT0.lancs.local>
	<CANVKczOcrDWh2xHUvnc2yj4QkkKi-k0L7oES9=7uhFsEtL2=qw@mail.gmail.com>
Message-ID: <CANtt_hzNvotVn2XOiLRUrm1+RtwyGK24Yzy4g1gk5bH5nfOaDA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120718/8ca37537/attachment.pl>

From mdsumner at gmail.com  Thu Jul 19 03:39:20 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 19 Jul 2012 11:39:20 +1000
Subject: [R-sig-Geo] melt spatialPixelDataFrame
In-Reply-To: <CAAcGz99FpdG6n3GbQ7p6OmTEi0i_iXknV5mXMMJGVnNVnYH-9g@mail.gmail.com>
References: <20120718131651.130240@gmx.net>
	<CAAcGz9-GX=745zuArCyw_w6GJuYDwxfhT_Y3813uX_Ykne4FXg@mail.gmail.com>
	<20120718134808.17780@gmx.net>
	<CAAcGz99FpdG6n3GbQ7p6OmTEi0i_iXknV5mXMMJGVnNVnYH-9g@mail.gmail.com>
Message-ID: <CAAcGz9-xp3ink881sA2Ac0jRu0x=EvLMEeHNRmjX08Ont-=qMw@mail.gmail.com>

The culprit in raster_2.0-08 is in R/as.data.frame.R

setMethod('as.data.frame', signature(x='SpatialPoints'),

and the relevant usage is in (raster's) ?as.data.frame "Get a
data.frame with raster cell values, or coerce a SpatialPolygons,
Lines, or Points file to a data.frame"

 ## S4 method for signature 'SpatialPoints'
     as.data.frame(x, row.names=NULL, optional=FALSE, xy=FALSE, ...)


So, you can get similar to the sp behaviour if you use xy = TRUE, but
note that this is a completely different pathway and logic to the way
the sp:::as.data.frame.SpatialPixelsDataFrame works (it passes the job
to sp:::as.data.frame.SpatialPointsDataFrame).

library(sp)
data(meuse.grid)
m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)
head(as.data.frame(m))

library(raster)
as.data.frame(m, xy = TRUE)
  object      x      y    x.1    y.1 part.a part.b      dist soil ffreq
1      1 181180 333740 181180 333740      1      0 0.0000000    1     1
2      2 181140 333700 181140 333700      1      0 0.0000000    1     1
...

I haven't followed the trail to where the "object" column is removed
again when using as.data.frame(m) with raster loaded.

raster introduces as.data.frame as a generic, with methods for
SpatialPoints, SpatialLines and SpatialPolygons, and the
SpatialPixelsDataFrame must get captured by the "SpatialPoints" one,
which has checks for the @data slot, which seems like a catch-all that
breaks the sp model. Summary is, if you use raster you accept a
completely different paradigm that you might be used to with sp.

Cheers, Mike.

On Thu, Jul 19, 2012 at 12:59 AM, Michael Sumner <mdsumner at gmail.com> wrote:
> Right, sure enough I got the x.1 and y.1 as per my first reply with
> raster 1.9-92, but after update to 2.0-08 I get your results without
> them. And, to be sure, see my run in a fresh session.
>
> I need to explore more to understand this, but things should work as
> expected with sp if you don't load raster (for now).
>
> Robert? Sorry I'm not familiar enough with raster to hunt this down
> easily, so I thought I'd raise it.
>
> Cheers, Mike.
>
> Code to run:
>
>
> library(sp)
> data(meuse.grid)
> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)
> head(as.data.frame(m))
>
>
>
> library(raster)
> head(as.data.frame(m))
>
>
>
> Session:
>
>> library(sp)
>> data(meuse.grid)
>> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)
>
>> head(as.data.frame(m))
>        x      y part.a part.b      dist soil ffreq    x.1    y.1
> 1 181180 333740      1      0 0.0000000    1     1 181180 333740
> 2 181140 333700      1      0 0.0000000    1     1 181140 333700
> 3 181180 333700      1      0 0.0122243    1     1 181180 333700
> 4 181220 333700      1      0 0.0434678    1     1 181220 333700
> 5 181100 333660      1      0 0.0000000    1     1 181100 333660
> 6 181140 333660      1      0 0.0122243    1     1 181140 333660
>>
>>
>>
>> library(raster)
> raster 2.0-08 (27-June-2012)
>> head(as.data.frame(m))
>        x      y part.a part.b      dist soil ffreq
> 1 181180 333740      1      0 0.0000000    1     1
> 2 181140 333700      1      0 0.0000000    1     1
> 3 181180 333700      1      0 0.0122243    1     1
> 4 181220 333700      1      0 0.0434678    1     1
> 5 181100 333660      1      0 0.0000000    1     1
> 6 181140 333660      1      0 0.0122243    1     1
>>
>> sessionInfo()
> R version 2.15.1 Patched (2012-06-29 r59683)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  compiler  methods
> [8] base
>
> other attached packages:
> [1] raster_2.0-08 sp_0.9-99
>
> loaded via a namespace (and not attached):
> [1] grid_2.15.1    lattice_0.20-6 tools_2.15.1
>
>
>
>
>
> On Wed, Jul 18, 2012 at 11:48 PM, Johannes Radinger <JRadinger at gmx.at> wrote:
>> Hi,
>>
>>> > I tried:
>>> > 1) to transform the SPDF to a normal dataframe with as.data.frame(spdf)
>>> but then I loose my x and y columns. Thus I can't use them in melt. Was
>>> that behavior changed recently?
>>>
>>> No, I really don't think so. Are you sure?  Here x.1 and y.1 are the
>>> (re-attached) grid point coordinates, which incidentally are copies of
>>> the original data "x" and "y".
>>>
>>> data(meuse.grid)
>>> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data =
>>> meuse.grid)
>>> head(as.data.frame(m))
>>>        x      y part.a part.b      dist soil ffreq    x.1    y.1
>>> 1 181180 333740      1      0 0.0000000    1     1 181180 333740
>>> 2 181140 333700      1      0 0.0000000    1     1 181140 333700
>>> 3 181180 333700      1      0 0.0122243    1     1 181180 333700
>>
>> I am not 100% sure but my output looks different from yours (I am missing x.1 and y.1, the original coords from the SPDF and not the re-attached ones)
>> Here the output with the same example and sessionInfo():
>>
>>> library(raster)
>> Loading required package: sp
>> raster 2.0-08 (27-June-2012)
>>> data(meuse.grid)
>>> m = SpatialPixelsDataFrame(points = meuse.grid[c("x", "y")], data = meuse.grid)
>>> head(as.data.frame(m))
>>        x      y part.a part.b      dist soil ffreq
>> 1 181180 333740      1      0 0.0000000    1     1
>> 2 181140 333700      1      0 0.0000000    1     1
>> 3 181180 333700      1      0 0.0122243    1     1
>> 4 181220 333700      1      0 0.0434678    1     1
>> 5 181100 333660      1      0 0.0000000    1     1
>> 6 181140 333660      1      0 0.0122243    1     1
>>> sessionInfo()
>> R version 2.14.1 (2011-12-22)
>> Platform: i686-pc-linux-gnu (32-bit)
>>
>> locale:
>>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>  [7] LC_PAPER=C                 LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods
>> [7] base
>>
>> other attached packages:
>> [1] raster_2.0-08 sp_0.9-99
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.14.1    lattice_0.20-0 tools_2.14.1
>>
>>
>>
>>
>> Any idea?
>>
>> /johannes
>
>
>
> --
> Michael Sumner
> Hobart, Australia
> e-mail: mdsumner at gmail.com



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From dave.gregovich at alaska.gov  Thu Jul 19 04:11:33 2012
From: dave.gregovich at alaska.gov (Gregovich, Dave P (DFG))
Date: Thu, 19 Jul 2012 02:11:33 +0000
Subject: [R-sig-Geo] Transforming from WGS84 to NAD83 Stateplane Alaska zone
	1
Message-ID: <174524AB15B8E6478D6F927B2131B09BBAA5@SOAJNUEXMB4.soa.alaska.gov>

Hello,
I apologize for reposting, but am still confounded after spending more time with the following problem, despite some help from the group.

I am attempting to learn GIS in R. I have worked with ArcGIS a lot, and know that my data is projecting correctly in that environment relative to other trusted data.  When I import a text file of animal locations into ArcGIS, then define the projection as WGS84, then transform to NAD83, I can obtain proj4strings from the resulting shapefiles to use as follows:

#__________________________________________________________
#ArcGIS portion---

#step 1: bring text file into ArcGIS
#step 2: display xy events, defining projection as WGS 84
#step 3: export this data to a shapefile (WGS84)
#             --result: 'bear_ArcGIS_wgs84',
bear.file.loc<-"c:/dave/temp/rgis"
bear.wgs84.layer<-"bear_ArcGIS_wgs84"
bear_wgs84<-readOGR(dsn=bear.file.loc,layer=bear.wgs84.layer)
string.wgs84<-proj4string(bear_wgs84)


#step 4: project this shapefile to NAD83 State Plane AK zone 1
#             --result: 'bear_nad83',
bear.nad83.layer<-"bear_ArcGIS_nad83"
bear_nad83<-readOGR(dsn=bear.file.loc,layer=bear.nad83.layer)
string.nad83.sp.ak.z1<-proj4string(bear_nad83)

###check coords...
coordinates(bear_nad83)


Then, I would like to ensure that an analogous process in R (via sp and rgdal) works, so I attempt this, using the proj4strings from above:

#__________________________________________________________
#R portion---

#step 1: read table into R
txt.loc<-"C:/dave/temp/rgis/bear.txt"
bear.via.R.wgs84<-read.table(txt.loc,header=T,sep=",",stringsAsFactors=F)
#step 2: define coordinate columns
#coordinates(bear.via.R.wgs84)<-c("Long_","Latitude")
coordinates(bear.via.R.wgs84)<- ~Long_ + Latitude
#step 3: define projection
proj4string(bear.via.R.wgs84)<-string.wgs84
writeOGR(bear.via.R.wgs84,dsn=bear.file.loc,layer="bear_R_wgs84",
                                driver=ogrDrivers()[7,1])
bear.via.R.nad83<-spTransform(bear.via.R.wgs84,CRS(string.nad83.sp.ak.z1))
proj4string(bear.via.R.nad83)
writeOGR(bear.via.R.nad83,dsn=bear.file.loc,layer="bear_R_nad83",
                                driver=ogrDrivers()[7,1])


###check coords...
coordinates(bear.via.R.nad83)
#__________________________________________________________

As you can see if you are saintly enough to still be with me, the coordinates do not jive. I attach the animal locations I am working with in case there is someone who wants to try to replicate the process. I am also attaching the shapefiles generated by ArcGIS and by R in case they are useful to you.

Thanks so much for your time.
__________________________________
Dave Gregovich
Research Analyst
Alaska Department of Fish and Game
Wildlife Conservation Division
Douglas, AK 99821
(907) 465-4291
dave.gregovich at alaska.gov
__________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120719/f237c7f0/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: bear.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120719/f237c7f0/attachment.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bear_shapefiles.zip
Type: application/x-zip-compressed
Size: 12130 bytes
Desc: bear_shapefiles.zip
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120719/f237c7f0/attachment.bin>

From mspinola10 at gmail.com  Thu Jul 19 04:26:34 2012
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 18 Jul 2012 20:26:34 -0600
Subject: [R-sig-Geo] Help with gpclib
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>
References: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>
Message-ID: <CABkCotScgPzVcVOYKE5OEEH6yZwQzbFn-6XxhvOe7B+Ok-RfLg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120718/7ebc5da9/attachment.pl>

From simon.ohanlon at imperial.ac.uk  Thu Jul 19 08:33:55 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Thu, 19 Jul 2012 06:33:55 +0000
Subject: [R-sig-Geo] Help with gpclib
In-Reply-To: <CABkCotScgPzVcVOYKE5OEEH6yZwQzbFn-6XxhvOe7B+Ok-RfLg@mail.gmail.com>
References: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>,
	<CABkCotScgPzVcVOYKE5OEEH6yZwQzbFn-6XxhvOe7B+Ok-RfLg@mail.gmail.com>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A018898718@icexch-m5.ic.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120719/b9168d38/attachment.pl>

From Roger.Bivand at nhh.no  Thu Jul 19 09:23:28 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Jul 2012 09:23:28 +0200 (CEST)
Subject: [R-sig-Geo] Help with gpclib
In-Reply-To: <7AE0828DCFFC0144817331B53EDC11A018898718@icexch-m5.ic.ac.uk>
References: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>,
	<CABkCotScgPzVcVOYKE5OEEH6yZwQzbFn-6XxhvOe7B+Ok-RfLg@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A018898718@icexch-m5.ic.ac.uk>
Message-ID: <alpine.LRH.2.02.1207190912180.3934@reclus.nhh.no>

On Thu, 19 Jul 2012, O'Hanlon, Simon J wrote:

> Can you load up the gpclib package? If not perhaps you need to reinstall 
> that?

The chief problem is the totally unnecessary use of gpclib in fortify() in 
ggplot2. gpclib should never, ever be used, as its licence only permits 
hobby use to learn about polygon clipping - imposed against the author's 
will by his former university. The rgeos package provides all 
functionality provided by gpclib except breaking polygons into component 
triangles, which is not relevant here. Specifically, 
ggplot2/R/fortify-spatial.R says (l. 33-5):

   # Union together all polygons that make up a region
   try_require(c("gpclib", "maptools"))
   unioned <- unionSpatialPolygons(cp, invert(polys))

If you replace these with:

   # Union together all polygons that make up a region
   try_require(c("rgeos", "maptools"))
   unioned <- unionSpatialPolygons(cp, invert(polys))

it will just work (I have not tried this, I am not a ggplot2 developer). 
The rgeos package does have an external dependency, but is available as a 
CRAN binary for Windows and OSX, so there is no reason at all for ggplot2 
to suggest gpclib rather than rgeos.

Once ggplot2 is updated, service should resume.

Hope this clarifies,

Roger


>
>
>> library(gpclib)
>
> General Polygon Clipper Library for R (version 1.5-1)
>
> Type 'class ? gpc.poly' for help
>
>
> Cheers,
>
>
> Simon
>
>
>
> --------------------------------
> Simon O'Hanlon, BSc MSc
> Department of Infectious Disease Epidemiology
> Imperial College London
> St. Mary's Hospital
> London
> W2 1PG
> ________________________________
> From: Manuel Sp?nola [mspinola10 at gmail.com]
> Sent: 19 July 2012 03:26
> To: O'Hanlon, Simon J
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Help with gpclib
>
> Thank you very much Simon,
>
> I get (I don't know why):
>
>> library(maptools)
> Loading required package: foreign
> Loading required package: sp
> Loading required package: lattice
> Checking rgeos availability: TRUE
>> library(rgdal)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.9.0, released 2011/12/29
> Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/2.15/Resources/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/2.15/Resources/library/rgdal/proj
>> library(rgeos)
> Loading required package: stringr
> Loading required package: plyr
> rgeos: (SVN revision 348)
> GEOS runtime version: 3.3.3-CAPI-1.7.4
> Polygon checking: TRUE
>
>> gpclibPermitStatus()
> [1] FALSE
>> gpclibPermit()
> [1] FALSE
>
> 2012/7/18 O'Hanlon, Simon J <simon.ohanlon at imperial.ac.uk<mailto:simon.ohanlon at imperial.ac.uk>>
> Dear Manuel,
> I am also running R2.15.1 on Mac OS X 10.7.
>
> I get:
>> library(maptools)
> Loading required package: foreign
> Loading required package: sp
> Loading required package: lattice
> Checking rgeos availability: TRUE
>> library(rgdal)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.9.0, released 2011/12/29
> Path to GDAL shared files: /Users/Simon/R64Libs/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: /Users/Simon/R64Libs/rgdal/proj
>> library(rgeos)
> Loading required package: stringr
> Loading required package: plyr
> rgeos: (SVN revision 348)
> GEOS runtime version: 3.3.3-CAPI-1.7.4
> Polygon checking: TRUE
>
>> gpclibPermitStatus()
> [1] FALSE
>> gpclibPermit()
> [1] TRUE
>
> Perhaps you can try updating to the latest rgeos release? And maybe try updating your rgdal from the kyngchaos website (if it isn't already the latest version)?
>
> HTH,
>
> Simon
> --------------------------------
> Simon O'Hanlon, BSc MSc
> Department of Infectious Disease Epidemiology
> Imperial College London
> St. Mary's Hospital
> London
> W2 1PG
> ________________________________________
> From: r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org> [r-sig-geo-bounces at r-project.org<mailto:r-sig-geo-bounces at r-project.org>] on behalf of Manuel Sp?nola [mspinola10 at gmail.com<mailto:mspinola10 at gmail.com>]
> Sent: 15 July 2012 16:02
> To: r-sig-geo at r-project.org<mailto:r-sig-geo at r-project.org>
> Subject: [R-sig-Geo] Help with gpclib
>
> Dear list members,
>
> I am running R 2.15.1 on a MAC OSX 10.7.
>
> I receive an error message regarding gpclib (see below):
>
>> library(rgdal)
>> library(maptools)
>> library(rgeos)
> Loading required package: stringr
> rgeos: (SVN revision 330)
> GEOS runtime version: 3.3.2-CAPI-1.7.2
> Polygon checking: TRUE
> WARNING! if you turn polygon checking off, and polygons are
> not valid in GEOS, you risk losing data as your R session may crash!
>
>> indice <- readOGR(".", "indicesalud2007crtm")
> OGR data source with driver: ESRI Shapefile
> Source: ".", layer: "indicesalud2007crtm"
> with 82 features and 27 fields
> Feature type: wkbPolygon with 2 dimensions
>
>> map <- fortify(indice)
> Using NCANTON to define regions.
> Error: gpclib, maptools package required for this functionality.  Please
> install and try again.
>
>> gpclibPermit()
> [1] FALSE
>
> Best,
>
> Manuel
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr<mailto:mspinola at una.ac.cr>
> mspinola10 at gmail.com<mailto:mspinola10 at gmail.com>
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>        [[alternative HTML version deleted]]
>
>
>
>
> --
> Manuel Sp?nola, Ph.D.
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr<mailto:mspinola at una.ac.cr>
> mspinola10 at gmail.com<mailto:mspinola10 at gmail.com>
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o<https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS<http://www.icomvis.una.ac.cr/>
>
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From mspinola10 at gmail.com  Thu Jul 19 09:43:30 2012
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 19 Jul 2012 01:43:30 -0600
Subject: [R-sig-Geo] Help with gpclib
In-Reply-To: <alpine.LRH.2.02.1207190912180.3934@reclus.nhh.no>
References: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>
	<CABkCotScgPzVcVOYKE5OEEH6yZwQzbFn-6XxhvOe7B+Ok-RfLg@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A018898718@icexch-m5.ic.ac.uk>
	<alpine.LRH.2.02.1207190912180.3934@reclus.nhh.no>
Message-ID: <CABkCotQNrbwXDyo00wLnt3-smwT8rbzRGSQaKu57q2wQi4nh-Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120719/608d2c4b/attachment.pl>

From lily_franknich at yahoo.com  Thu Jul 19 11:19:02 2012
From: lily_franknich at yahoo.com (Lilis Husna)
Date: Thu, 19 Jul 2012 17:19:02 +0800 (SGT)
Subject: [R-sig-Geo] Bls: How to get each bandwidth values on observation
	points using adaptive kernel in spgwr ?
In-Reply-To: <alpine.LRH.2.02.1207161526090.16075@reclus.nhh.no>
References: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>
	<fc06fe6c788b46d2ba52ad83ddbc9b2c@EX-0-HT0.lancs.local>
	<CANVKczNcO=FvsdJWPcKWUY1nK4YaTO7YPN-_R=CYC8MYaF0_rw@mail.gmail.com>
	<alpine.LRH.2.02.1207161526090.16075@reclus.nhh.no>
Message-ID: <1342689542.94908.YahooMailNeo@web190302.mail.sg3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120719/81547528/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Jul 19 13:18:25 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 19 Jul 2012 12:18:25 +0100
Subject: [R-sig-Geo] Transforming from WGS84 to NAD83 Stateplane Alaska
 zone 1
In-Reply-To: <3542acb6a1d147b69c65b21c30638e23@EX-0-HT0.lancs.local>
References: <3542acb6a1d147b69c65b21c30638e23@EX-0-HT0.lancs.local>
Message-ID: <CANVKczPKGEDYZrx3bRJRKgxs9QYLByAhczS76Q4ySrE7=esWxA@mail.gmail.com>

On Thu, Jul 19, 2012 at 3:11 AM, Gregovich, Dave P (DFG)
<dave.gregovich at alaska.gov> wrote:
> Hello,
>
> I apologize for reposting, but am still confounded after spending more time
> with the following problem, despite some help from the group.
>
>
>
> I am attempting to learn GIS in R. I have worked with ArcGIS a lot, and know
> that my data is projecting correctly in that environment relative to other
> trusted data.  When I import a text file of animal locations into ArcGIS,
> then define the projection as WGS84, then transform to NAD83, I can obtain
> proj4strings from the resulting shapefiles to use as follows:
>

 Yeah there's a constant shift between the R coordinates and the ESRI
coordinates:

 > coordinates(bear_R_nad83)-coordinates(bear_ArcGIS_nad83)
      coords.x1 coords.x2
 [1,]   4181322  -5575097
 [2,]   4181322  -5575097
 [3,]   4181322  -5575097

 - a workaround would just be to add this offset to your coordinates....

 I've tried to figure out where this is coming from but with no
success. I've not had any problems with coordinates as long as I stick
to EPSG-defined coordinate systems. I don't have a copy of ArcGis to
hand, but I recall it has all sorts of other systems in it....

Barry


From Roger.Bivand at nhh.no  Thu Jul 19 15:50:49 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Jul 2012 15:50:49 +0200 (CEST)
Subject: [R-sig-Geo] Transforming from WGS84 to NAD83 Stateplane Alaska
 zone 1
In-Reply-To: <CANVKczPKGEDYZrx3bRJRKgxs9QYLByAhczS76Q4ySrE7=esWxA@mail.gmail.com>
References: <3542acb6a1d147b69c65b21c30638e23@EX-0-HT0.lancs.local>
	<CANVKczPKGEDYZrx3bRJRKgxs9QYLByAhczS76Q4ySrE7=esWxA@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1207191541050.6684@reclus.nhh.no>

On Thu, 19 Jul 2012, Barry Rowlingson wrote:

> On Thu, Jul 19, 2012 at 3:11 AM, Gregovich, Dave P (DFG)
> <dave.gregovich at alaska.gov> wrote:
>> Hello,
>>
>> I apologize for reposting, but am still confounded after spending more time
>> with the following problem, despite some help from the group.
>>
>>
>>
>> I am attempting to learn GIS in R. I have worked with ArcGIS a lot, and know
>> that my data is projecting correctly in that environment relative to other
>> trusted data.  When I import a text file of animal locations into ArcGIS,
>> then define the projection as WGS84, then transform to NAD83, I can obtain
>> proj4strings from the resulting shapefiles to use as follows:
>>
>
> Yeah there's a constant shift between the R coordinates and the ESRI
> coordinates:
>
> > coordinates(bear_R_nad83)-coordinates(bear_ArcGIS_nad83)
>      coords.x1 coords.x2
> [1,]   4181322  -5575097
> [2,]   4181322  -5575097
> [3,]   4181322  -5575097
>
> - a workaround would just be to add this offset to your coordinates....
>
> I've tried to figure out where this is coming from but with no
> success. I've not had any problems with coordinates as long as I stick
> to EPSG-defined coordinate systems. I don't have a copy of ArcGis to
> hand, but I recall it has all sorts of other systems in it....

The EPSG codes 3468 and 26931 (Alaska I NAD83) are off by:

> coordinates(bear_nad83) - coordinates(spTransform(bear_wgs84, 
+ CRS("+init=epsg:26931")))
       coords.x1  coords.x2
  [1,]  1.191571 -0.4911515
  [2,]  1.191572 -0.4911513
  [3,]  1.191571 -0.4911517
....

with the main difference being:

> CRS("+init=epsg:26931")
CRS arguments:
  +init=epsg:26931 +proj=omerc +lat_0=57 +lonc=-133.6666666666667
+alpha=323.1301023611111 +k=0.9999 +x_0=5000000 +y_0=-5000000
+gamma=323.1301023611111 +datum=NAD83 +units=m +no_defs +ellps=GRS80
+towgs84=0,0,0

and

> CRS(proj4string(bear_nad83))
CRS arguments:
  +proj=omerc +lat_0=57 +lonc=-133.6666666666667
+alpha=-36.86989764583333 +k=0.9999 +x_0=5000000 +y_0=-5000000
+datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0

+alpha being 360-alpha, and +gamma being declared. readOGR() is reading 
the contents of bear_ArcGIS_nad83.prj correctly, +alpha is given there as 
a negative number, and no +gamma is given, which appears to be why 
projection is failing. There are more details of the complications of the 
(Hotine) oblique mercator here:

http://www.remotesensing.org/geotiff/proj_list/epsg_om.html

Hope this helps,

Roger

>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From h.wickham at gmail.com  Thu Jul 19 16:04:28 2012
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 19 Jul 2012 07:04:28 -0700
Subject: [R-sig-Geo] Help with gpclib
In-Reply-To: <alpine.LRH.2.02.1207190912180.3934@reclus.nhh.no>
References: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>
	<CABkCotScgPzVcVOYKE5OEEH6yZwQzbFn-6XxhvOe7B+Ok-RfLg@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A018898718@icexch-m5.ic.ac.uk>
	<alpine.LRH.2.02.1207190912180.3934@reclus.nhh.no>
Message-ID: <CABdHhvGPdNir8Zu44Q8aSU4XG_GAxfX9miok2y1ZCiibxgO9VA@mail.gmail.com>

> The chief problem is the totally unnecessary use of gpclib in fortify() in
> ggplot2. gpclib should never, ever be used, as its licence only permits
> hobby use to learn about polygon clipping - imposed against the author's
> will by his former university. The rgeos package provides all functionality
> provided by gpclib except breaking polygons into component triangles, which
> is not relevant here. Specifically, ggplot2/R/fortify-spatial.R says (l.
> 33-5):
>
>   # Union together all polygons that make up a region
>   try_require(c("gpclib", "maptools"))
>   unioned <- unionSpatialPolygons(cp, invert(polys))

That code is out of date. The current code is
https://github.com/hadley/ggplot2/blob/master/R/fortify-spatial.r

That only uses try_require("maptools") (and only if you use a
non-default grouping). As far as I know, that should automatically
pick between gpclib and rgeos depending on which is installed.

Despite the license for gpclib making it only suitable for
"hobbyists", it is much easier to install than rgeos, which requires
an external install.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From Roger.Bivand at nhh.no  Thu Jul 19 16:26:04 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 19 Jul 2012 16:26:04 +0200 (CEST)
Subject: [R-sig-Geo] Help with gpclib
In-Reply-To: <CABdHhvGPdNir8Zu44Q8aSU4XG_GAxfX9miok2y1ZCiibxgO9VA@mail.gmail.com>
References: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>
	<CABkCotScgPzVcVOYKE5OEEH6yZwQzbFn-6XxhvOe7B+Ok-RfLg@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A018898718@icexch-m5.ic.ac.uk>
	<alpine.LRH.2.02.1207190912180.3934@reclus.nhh.no>
	<CABdHhvGPdNir8Zu44Q8aSU4XG_GAxfX9miok2y1ZCiibxgO9VA@mail.gmail.com>
Message-ID: <alpine.LRH.2.02.1207191606420.6684@reclus.nhh.no>

On Thu, 19 Jul 2012, hadley wickham wrote:

>> The chief problem is the totally unnecessary use of gpclib in fortify() in
>> ggplot2. gpclib should never, ever be used, as its licence only permits
>> hobby use to learn about polygon clipping - imposed against the author's
>> will by his former university. The rgeos package provides all functionality
>> provided by gpclib except breaking polygons into component triangles, which
>> is not relevant here. Specifically, ggplot2/R/fortify-spatial.R says (l.
>> 33-5):
>>
>>   # Union together all polygons that make up a region
>>   try_require(c("gpclib", "maptools"))
>>   unioned <- unionSpatialPolygons(cp, invert(polys))
>
> That code is out of date. The current code is
> https://github.com/hadley/ggplot2/blob/master/R/fortify-spatial.r

The released code is as quoted, which is what users see. I think github 
does not provide automatic check, build, and binary build of development 
versions of packages (like R-forge). So users cannot install from github 
without checking out the source code?

>
> That only uses try_require("maptools") (and only if you use a
> non-default grouping). As far as I know, that should automatically
> pick between gpclib and rgeos depending on which is installed.
>

Exactly. This will only fail if non-default grouping is requested and 
neither gpclib nor rgeos are available.

> Despite the license for gpclib making it only suitable for
> "hobbyists", it is much easier to install than rgeos, which requires
> an external install.

Not "much easier", for all Windows and OSX users installing CRAN binary 
packages, there is now, thanks to Brian Ripley, Uwe Ligges, and Simon 
Urbanek, no difference at all. GEOS is available as a binary install for 
most popular Linux versions, from there a source install of rgeos is no 
harder than other source packages with external dependencies (like XML).

The gpclib licence is rather perverse (and the link on the CRAN package 
page dead, the href includes a semicolon):

http://www.cs.man.ac.uk/~toby/gpc/

"GPC Licensing

GPC is free for downloading and time-unlimited evaluation by anyone.

Non-commercial use of GPC (for example: private / hobbyist / education)

GPC is free for non-commercial use only.
We invite non-commercial users to make a voluntary donation towards the 
upkeep of GPC.

Commercial use of GPC (for example: product development / commercial 
research)

If you wish to use GPC in support of a commercial product,
you must obtain an official GPC Commercial Use Licence from The University 
of Manchester. Please email for details."

I have seen a definition of "education" as self-learning only, but cannot 
trace it; it is not "free software" for non-commercial use in the "normal" 
(ACM?) sense. I consider that using it in taught courses for which payment 
is received to be borderline (for example useR! tutorials), possibly on 
the wrong side of the border. Simply avoid gpclib!

Roger

>
> Hadley
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From h.wickham at gmail.com  Thu Jul 19 16:36:28 2012
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 19 Jul 2012 07:36:28 -0700
Subject: [R-sig-Geo] Help with gpclib
In-Reply-To: <alpine.LRH.2.02.1207191606420.6684@reclus.nhh.no>
References: <CABkCotSmRYJ-uBkHP7XTPmRrnyzWoaqOpcZ7A15kVWqUUxzxHQ@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A01889633F@icexch-m5.ic.ac.uk>
	<CABkCotScgPzVcVOYKE5OEEH6yZwQzbFn-6XxhvOe7B+Ok-RfLg@mail.gmail.com>
	<7AE0828DCFFC0144817331B53EDC11A018898718@icexch-m5.ic.ac.uk>
	<alpine.LRH.2.02.1207190912180.3934@reclus.nhh.no>
	<CABdHhvGPdNir8Zu44Q8aSU4XG_GAxfX9miok2y1ZCiibxgO9VA@mail.gmail.com>
	<alpine.LRH.2.02.1207191606420.6684@reclus.nhh.no>
Message-ID: <CABdHhvG9M2-MygKFC3iEBzigrD9htT1Yp6GOBLRf_B=tTYc_Qw@mail.gmail.com>

>> That code is out of date. The current code is
>> https://github.com/hadley/ggplot2/blob/master/R/fortify-spatial.r
>
> The released code is as quoted, which is what users see. I think github does
> not provide automatic check, build, and binary build of development versions
> of packages (like R-forge). So users cannot install from github without
> checking out the source code?

library(devtools)
install_github("ggplot2")

> Not "much easier", for all Windows and OSX users installing CRAN binary
> packages, there is now, thanks to Brian Ripley, Uwe Ligges, and Simon
> Urbanek, no difference at all. GEOS is available as a binary install for
> most popular Linux versions, from there a source install of rgeos is no
> harder than other source packages with external dependencies (like XML).

Ok, that's great, although I have to say I found the description on
CRAN rather confusing (it wasn't obvious whether or not you still need
an external package).

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From karl at huftis.org  Thu Jul 19 17:44:03 2012
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Thu, 19 Jul 2012 17:44:03 +0200
Subject: [R-sig-Geo] Better label placement for polygons
Message-ID: <1342712643.22466.6.camel@adrian.site>

I have had some problems with bad label placements for SpatialPolygons,
so I wrote a small function for improving it. Hope it will be of use to
someone on this list. Here?s an example of its output:

  http://huftis.org/kritikk/polygon-labels.png

The orange points are the centroid values as returned by
?coordinates()? (note than one of them is outside its polygon), while
the red ones are the ones generated by the R function below.


The problem: The default label placements as returned by the
?coordinates()? function are the centroids. For convex polygons, they
work well, but for non-convex and non-symmetric polygons, the centroids
may be at a very different position from where one would manually place
the labels (and may even be *outside* the polygons).

A ?good? label position would be in the ?bulk? of the polygon, far away
from any edges. One way to find such a position is to use a negative
buffer to find interesting ?inside? areas of the polygon. This
automatically takes us away from any edges and closes any narrow
passages, which are the worst places for labels. My solution is thus to
use a buffer width so large that the *convex hull* of the resulting
interior polygon is wholly inside the original polygon. If the buffer
operation generates several polygons, I use the largest one (as this
would be the most natural place to put the label). The algorithm is
inspired by (but different from) the one is this article:
http://proceedings.esri.com/library/userconf/proc01/professional/papers/pap388/p388.html

Surprisingly, the resulting R code is quite fast (no doubt due to the
very efficient rgeos package!). For a simple polygon it takes just a
fraction of a second. And it can calculate label position for all the
polygons in the ?rworldmap? world polygons in a few seconds. The
resulting label placement also seems very good. Here?s the code:

-----
calc.labpt = function(pols) {
  # Prepopulate the label point matrix with the centroid values
  coords=coordinates(pols)
  
  # For each polygon in pols, calculate the appropriate label point
  for(i in seq_len(length(pols))) {
    
    # First fetch the polygon to process
    p=pols[i,]
    
    init=0                     # Initial amount to shrink
    estep=sqrt(gArea(p)/pi)/10 # Additional amount to shrink for each step
    
    # Try repeatedly shrinking the polygon until we?re left
    # with a polygon whose convex hulls fits inside 
    repeat {
      repeat {
        r = init + estep               # Amount to shrink
        p2 = gBuffer(p, width = -r)    # Shrink the polygon
        if( gArea(p2) <= 0 )           # If the shrunken polygon is empty ...
          estep = estep/2 else break   # ... try again with a smaller value
      }
      
      # If we?re left with more than one polygon, choose the largest one
      areas=sapply(p2 at polygons[[1]]@Polygons, function(x) x at area)
      if(length(areas) > 1) {
        # Note that we create a *new* SpatialPolygon containing the largest polygon.
        # I guess in theory we *could* have just replaced the @Polygons slot of p2,
        # but then gArea seems to crash R ... :(
        ind.max = which.max(areas)
        p2 = SpatialPolygons(list(Polygons(list(p2 at polygons[[1]]@Polygons[ind.max][[1]]),
                                         ID="middle")), proj4string=CRS(proj4string(p2)))
      }
      
      # Calculate the convex hull of the inner polygon.
      # If this is wholly contained in the original polygon,
      # break out of the loop and set the label point to
      # the centroid of the inner polygon.
      if( gContains(p, gConvexHull(p2)) ) break else init=init+estep
    }
    coords[i,] = coordinates(p2)
  }
  coords
}
-----

Here?s a simple example of how to use the function:

-----
library(rworldmap)
world = getMap(projection="equalArea")
norway = world["NOR",]

plot(norway)
points(coordinates(norway), col="orange", pch=19)
points(calc.labpt(norway), col="red", pch=19)
-----

Note 1: The function assumes that the polygons don?t contain any holes
(if they do, there may not exist a polygon calculated by buffering and
whose convex hull is wholly inside the original polygon). For most real
maps, where the holes are only small lakes, the function *may* very well
work (and usually will), but it?s not guaranteed to do so, and may enter
an endless loop.

Note 2: The label placement returned by the function is only (somewhat)
optimal *if* the label is shaped approximately like a square or
rectangle (e.g., a two-digit number). For very wide or tall labels,
there may exist much better label placements.

Note 3: The function assumes that the polygons are in a projected
coordinate system. When plotting unprojected polygons, the ?plot()?
function automatically chooses an aspect ratio that make the result look
OK (as long as the latitude range is small). The label placement
function does not try to correct for this, and the result may look bad.
Example:

  norway = getMap(projection="none")["NOR",]
  plot(norway)        # ?smart? aspect ratio (looks OK)
  plot(norway, asp=1) # what ?calc.labpt()? sees
  
If you?re happy with the way ?plot()? displays your unprojected data,
just project it to the equivalent equirectangular projection before
calculating the label points:

  lat = mean(bbox(norway)[2,])                  # ?Average? latitude
  proj = CRS(paste0("+proj=eqc +lat_ts=", lat)) # Equirectangular
projection
  nor.proj = spTransform(norway, proj)          # Reproject polygon
  
?plot(nor.proj)? should *look* identical to ?plot(nor)? (but the
coordinates are very different). Now run ?calc.labpt()? on
?nor.proj? (and reproject back if you want to work in longlat
coordinates). (Note that for this example the result of ?calc.labpt()?
on the original polygon is actually OK. In general, it will not be so.)

So, again, hope this will be useful for someone. It?s a quick hack, but
I think it works very well, and it has proven useful for me. I?d
appreciate any comments.

-- 
Karl Ove Hufthammer
http://huftis.org/
Jabber: karl at huftis.org


From b.rowlingson at lancaster.ac.uk  Thu Jul 19 18:16:55 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 19 Jul 2012 17:16:55 +0100
Subject: [R-sig-Geo] Better label placement for polygons
In-Reply-To: <e535f886ba064251a3428017a395f134@EX-1-HT0.lancs.local>
References: <e535f886ba064251a3428017a395f134@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOz2jcS1kX=svDpR6xEWw67VhjBbnza2=RWcqLPw1L43g@mail.gmail.com>

Nice, is it the same method as this:

http://proceedings.esri.com/library/userconf/proc01/professional/papers/pap388/p388.htm

Barry

> Surprisingly, the resulting R code is quite fast (no doubt due to the
> very efficient rgeos package!). For a simple polygon it takes just a
> fraction of a second. And it can calculate label position for all the
> polygons in the ?rworldmap? world polygons in a few seconds. The
> resulting label placement also seems very good. Here?s the code:
>
-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From karl at huftis.org  Thu Jul 19 18:57:27 2012
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Thu, 19 Jul 2012 18:57:27 +0200
Subject: [R-sig-Geo] Better label placement for polygons
In-Reply-To: <CANVKczOz2jcS1kX=svDpR6xEWw67VhjBbnza2=RWcqLPw1L43g@mail.gmail.com>
References: <e535f886ba064251a3428017a395f134@EX-1-HT0.lancs.local>
	<CANVKczOz2jcS1kX=svDpR6xEWw67VhjBbnza2=RWcqLPw1L43g@mail.gmail.com>
Message-ID: <1342717047.22466.23.camel@adrian.site>

to. den 19. 07. 2012 klokka 17.16 (+0100) skreiv Barry Rowlingson:
> Nice, is it the same method as this:
> 
> http://proceedings.esri.com/library/userconf/proc01/professional/papers/pap388/p388.htm

No. As I wrote, I was inspired by the above paper, and the algorithms
are similar (i.e., they are both based on using a negative buffer), but
they are not identical. In the above paper, compactness and
rectangularity is used as a stopping criterion, or area size if
compactness and rectangularity is not achieved, while the R code instead
looks at the convex hull of the polygon buffer and checks if this is
contained in the original polygon.

I had originally planned to just increase the buffer width until the
resulting polygon was tiny (i.e., check if gArea(poly.buffer) /
gArea(poly.orig) was very small but positive), and while this often
works, it turned out that it sometimes creates very bad solutions. One
example would be a polygon similar to the the top-left polygon at
  http://huftis.org/kritikk/polygon-labels.png
As we increase the buffer width, the resulting polygon becomes a wide,
narrow rectangle in the left part of the polygon. Now, if the original
polygon is modified to contain a small notch (like this ---^---) at
the top, the rectangle will shrink to a small area positioned *right
below* the notch, i.e., possibly far from the *middle* of the large left
area, which is the natural label position. That?s why I figured it would
be better to instead have as *small* a buffer width as possible that
still satisfies the convex hull criterion. This should always generate
*reasonable* label positions (though there are probably exceptions I
didn?t think of :) ).

-- 
Karl Ove Hufthammer
http://huftis.org/
Jabber: karl at huftis.org


From r.hijmans at gmail.com  Thu Jul 19 20:25:55 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 19 Jul 2012 11:25:55 -0700
Subject: [R-sig-Geo] melt spatialPixelDataFrame
In-Reply-To: <CAAcGz9-xp3ink881sA2Ac0jRu0x=EvLMEeHNRmjX08Ont-=qMw@mail.gmail.com>
References: <20120718131651.130240@gmx.net>
	<CAAcGz9-GX=745zuArCyw_w6GJuYDwxfhT_Y3813uX_Ykne4FXg@mail.gmail.com>
	<20120718134808.17780@gmx.net>
	<CAAcGz99FpdG6n3GbQ7p6OmTEi0i_iXknV5mXMMJGVnNVnYH-9g@mail.gmail.com>
	<CAAcGz9-xp3ink881sA2Ac0jRu0x=EvLMEeHNRmjX08Ont-=qMw@mail.gmail.com>
Message-ID: <CANtt_hyNURZG6L9p=gvqtegqp7OwagHMpBinWY1YDSMsgvX-Qg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120719/8a8761dd/attachment.pl>

From Zhongkui.Luo at csiro.au  Fri Jul 20 10:19:27 2012
From: Zhongkui.Luo at csiro.au (zhongkui)
Date: Fri, 20 Jul 2012 01:19:27 -0700 (PDT)
Subject: [R-sig-Geo] Re-shape shapefile using another shapefile?
Message-ID: <1342772367880-7580554.post@n2.nabble.com>

Dear List,

 I would like give a example to clearly describe (hopefully) my question. I
have two shapefiles with class of "SpatialPolygonsDataFrame", for example:

Shapefile1 (S1): Australian boundary (land area only)
Shapefile2 (S2): Australian land use type boundary

S2 includes land area and coastal waters, this means both water and land
could be included in one polygon of S2. But I am only interested in the land
area. So, my questions is:

Can S1 be used to re-shape S1 and get a revised S2? And how? Or other
solutions? 

Thanks very much for your help.

Regards,

Zak



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Re-shape-shapefile-using-another-shapefile-tp7580554.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From julian at hafro.is  Fri Jul 20 10:48:39 2012
From: julian at hafro.is (Julian Burgos)
Date: Fri, 20 Jul 2012 08:48:39 +0000
Subject: [R-sig-Geo] Re-shape shapefile using another shapefile?
In-Reply-To: <1342772367880-7580554.post@n2.nabble.com>
References: <1342772367880-7580554.post@n2.nabble.com>
Message-ID: <50091B67.8090402@hafro.is>

Hi Zak,
One option is to use the package "rgeos".  The you can use the 
"gIntersection" function to find the intersection between both polygons 
and keep only the parts of the S2 polygon that are included within the 
S1 polygon.

Julian

-- 
Julian Mariano Burgos, PhD
Hafranns?knastofnunin/Marine Research Institute
Sk?lagata 4, 121 Reykjav?k, Iceland
S?mi/Telephone : +354-5752037
Br?fs?mi/Telefax:  +354-5752001
Netfang/Email: julian at hafro.is



On f?s 20.j?l 2012 08:19, zhongkui wrote:
> Dear List,
>
>   I would like give a example to clearly describe (hopefully) my question. I
> have two shapefiles with class of "SpatialPolygonsDataFrame", for example:
>
> Shapefile1 (S1): Australian boundary (land area only)
> Shapefile2 (S2): Australian land use type boundary
>
> S2 includes land area and coastal waters, this means both water and land
> could be included in one polygon of S2. But I am only interested in the land
> area. So, my questions is:
>
> Can S1 be used to re-shape S1 and get a revised S2? And how? Or other
> solutions?
>
> Thanks very much for your help.
>
> Regards,
>
> Zak
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Re-shape-shapefile-using-another-shapefile-tp7580554.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From a.ali at agrhymet.ne  Fri Jul 20 12:02:47 2012
From: a.ali at agrhymet.ne (Abdou ALI)
Date: Fri, 20 Jul 2012 11:02:47 +0100
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 107, Issue 20
Message-ID: <1089755223@mail.agrhymet.ne>

I am on leave til 10th August 2012 and I will have a limited access to email. I will get back to you as soon as I can. For urgent work related matters, please contact admin at agrhymet.ne


From michela.giusti at isprambiente.it  Fri Jul 20 12:50:11 2012
From: michela.giusti at isprambiente.it (Michela Giusti)
Date: Fri, 20 Jul 2012 12:50:11 +0200
Subject: [R-sig-Geo] problem with Mahalanobis distance calculation in
	AdehabitatHS
Message-ID: <500937E3.7070702@isprambiente.it>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120720/3e8db6ca/attachment.pl>

From clement.calenge at oncfs.gouv.fr  Fri Jul 20 13:12:16 2012
From: clement.calenge at oncfs.gouv.fr (Clement Calenge)
Date: Fri, 20 Jul 2012 13:12:16 +0200
Subject: [R-sig-Geo] problem with Mahalanobis distance calculation in
 AdehabitatHS
In-Reply-To: <500937E3.7070702@isprambiente.it>
References: <500937E3.7070702@isprambiente.it>
Message-ID: <50093D10.1020000@oncfs.gouv.fr>

Dear Michela,

> I am doing an ENFA-MADIFA analysis and I have to do the computation of
> the Mahalanobis distances with the command below:
>
> ma286<-mahasuhab(map286, pres286)
>
> but I receive this error:
>
> Error in solve.default(cov, ...) : Lapack routine dgesv: system is
> exactly singular
>
>
> (map286 is a SpatialPixelDataFrame and pres286 is a SpatialPoints).

This means that the covariance matrix Sigma used in the calculation of 
the Mahalanobis distances is not invertible, because there is a linear 
dependency between two (or more) variables, in the table giving the 
value of the environmental variables (columns) in each used resource 
unit (row). In other words, two variables bring exactly the same 
information. This may be because:
* you have more environmental variables than used resource units (i.e. 
nrow(pres286) < ncol(map286) )
* you have (too) highly correlated environmental variables in map286.

I think that you may have to choose a smaller number of biologically 
relevant variables for your analysis.
 From a technical point of view, to identify the cause of this error, 
copy and paste the following code:

cor(na.omit(join(pres286,map286)))

and look for correlations equal to 1?
HTH,

Cl?ment Calenge
> What does it mean?
>
> Can anyone help me?
>
> Thank you in advance.
> bye,
>
> Michela
>
> *****************************************************************
> Dr. Michela Giusti
> ISPRA
> Istituto Superiore per la Protezione e la Ricerca Ambientale
> Via Brancati, 60
> 00144 Roma
> Tel. +390650074746
> michela.giusti at isprambiente.it
> *****************************************************************
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Cl?ment CALENGE
Cellule d'appui ? l'analyse de donn?es
Direction des Etudes et de la Recherche
Office national de la chasse et de la faune sauvage
Saint Benoist - 78610 Auffargis
tel. (33) 01.30.46.54.14


From FanY at si.edu  Fri Jul 20 17:43:58 2012
From: FanY at si.edu (Fan, Yuanchao)
Date: Fri, 20 Jul 2012 11:43:58 -0400
Subject: [R-sig-Geo] "rasterize" couldn't transfer the polygon field values
Message-ID: <5C820498D2F4594F8EBFED4FD974CE310532D21770@SI-MSEV02.US.SINET.SI.EDU>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120720/5f0586ee/attachment.pl>

From r.hijmans at gmail.com  Fri Jul 20 19:14:26 2012
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 20 Jul 2012 10:14:26 -0700
Subject: [R-sig-Geo] "rasterize" couldn't transfer the polygon field
	values
In-Reply-To: <5C820498D2F4594F8EBFED4FD974CE310532D21770@SI-MSEV02.US.SINET.SI.EDU>
References: <5C820498D2F4594F8EBFED4FD974CE310532D21770@SI-MSEV02.US.SINET.SI.EDU>
Message-ID: <CANtt_hyAQBxnvv+XcjCvNA_BomKLKLSQ_qk9aD5-DgkKC+na+g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120720/ee880fa6/attachment.pl>

From martin.ivanov at ifg.uni-tuebingen.de  Fri Jul 20 19:22:39 2012
From: martin.ivanov at ifg.uni-tuebingen.de (Martin Ivanov)
Date: Fri, 20 Jul 2012 19:22:39 +0200
Subject: [R-sig-Geo] overlay contour lines with labels over spplot with
	color regions?
Message-ID: <500993DF.60609@ifg.uni-tuebingen.de>

Dear R users,

I have the following problem. I plot a SpatialPixelsDataFrame object 
with spplot and I need to add a contourplot
of another spatial variable. To be more precise, I plot the 
SpatialPixelsDataFrame of the mean precipitation over Germany with 
coloured regions and I want to overlay the isolines of the 500, 1000 and 
1500 m height above sea level. Of course I can plot the lines as 
SpatialLines using the sp.layout argument to spplot, but so I lose the 
labels on the lines. And I want the height above sea level to be 
labelled just as it is labelled in a contour plot. Is it possible to 
achieve that with lattice?

I am still new to lattice, so I beg Your excuse in case I am asking 
something trivial. I googled a lot and tried a lot of things, but none 
worked. I tried with contour, it does work with Spatial objects, but 
unfortunately contour does not seem work with lattice. And the lattice 
equivalent contourplot does not recognise Spatial objects.

I am already out of ideas. I am looking forward to Your replies. Any 
suggestions will be appreciated.

Best regards,

Martin

-- 
Dr. Martin Ivanov
Eberhard-Karls-Universit?t T?bingen
Mathematisch-Naturwissenschaftliche Fakult?t
Fachbereich Geowissenschaften
Water & Earth System Science (WESS)
Keplerstra?e 17, 72074 T?bingen, Deutschland
Tel. +4970712975023


From martin.ivanov at ifg.uni-tuebingen.de  Fri Jul 20 21:25:11 2012
From: martin.ivanov at ifg.uni-tuebingen.de (Martin Ivanov)
Date: Fri, 20 Jul 2012 21:25:11 +0200
Subject: [R-sig-Geo] stretch a SpatialPolygons object?
Message-ID: <5009B097.30207@ifg.uni-tuebingen.de>

Dear R users,

I need to stretch a SpatialPolygons object. That is, I need to 
symmetrically expand its borders so that its area grows, but the shape 
preserves. Is this possible to be done?

Best regards,


-- 
Dr. Martin Ivanov
Eberhard-Karls-Universit?t T?bingen
Mathematisch-Naturwissenschaftliche Fakult?t
Fachbereich Geowissenschaften
Water & Earth System Science (WESS)
Keplerstra?e 17, 72074 T?bingen, Deutschland
Tel. +4970712975023


From bellard.celine at gmail.com  Fri Jul 20 21:40:01 2012
From: bellard.celine at gmail.com (=?ISO-8859-1?Q?C=E9line_Bellard?=)
Date: Fri, 20 Jul 2012 21:40:01 +0200
Subject: [R-sig-Geo] Dissolve polygon
Message-ID: <5009B411.5030801@gmail.com>

Hi,

I am working with  a SpatialPolygonsDataFrame of many islands. There are a
lot of polygons (islands) composing my SpatialPolygonsDataFrame.
I want to extract the elevation of each island.
I need to separate the different polygons (like dissolve function in
arcgis), to have the elevation of each island.

Do you have an idea how can I do that ?

dim(hot)
[1] 10945     5

class(hot)
[1] "SpatialLinesDataFrame"
attr(,"package")
[1] "sp"

Thanks in advance for your help,

C?line


From mdsumner at gmail.com  Sat Jul 21 01:23:15 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 21 Jul 2012 09:23:15 +1000
Subject: [R-sig-Geo] stretch a SpatialPolygons object?
In-Reply-To: <5009B097.30207@ifg.uni-tuebingen.de>
References: <5009B097.30207@ifg.uni-tuebingen.de>
Message-ID: <CAAcGz98rZbBCVYQ-5Z-o0WLpqzTPG0knSKKDJDpU7zJ+-i=3XQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120721/e38872ba/attachment.pl>

From mestre.frederico at gmail.com  Sat Jul 21 01:40:26 2012
From: mestre.frederico at gmail.com (Frederico Mestre)
Date: Sat, 21 Jul 2012 00:40:26 +0100
Subject: [R-sig-Geo] random points with a minimum distance
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAANurYWtafkREnWeH4rBeYRHigQAAEAAAANl4db7r+f5GrJoUreYA0s8BAAAAAA==@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120721/d9d3cf76/attachment.pl>

From r.turner at auckland.ac.nz  Sat Jul 21 02:12:29 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Sat, 21 Jul 2012 12:12:29 +1200
Subject: [R-sig-Geo] random points with a minimum distance
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAANurYWtafkREnWeH4rBeYRHigQAAEAAAANl4db7r+f5GrJoUreYA0s8BAAAAAA==@gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAANurYWtafkREnWeH4rBeYRHigQAAEAAAANl4db7r+f5GrJoUreYA0s8BAAAAAA==@gmail.com>
Message-ID: <5009F3ED.1030602@auckland.ac.nz>

On 21/07/12 11:40, Frederico Mestre wrote:
> Hello all:
>
>   
>
> How can I generate quasi-random points with the condition that a minimum
> pre-defined distance is always kept amongst them?
>

With the function rSSI() from the spatstat package.

(You could also use the rmh() function --- with the "hardcore"
cif --- for a somewhat different model of the randomness,
but the call is a bit more complicated.)

     cheers,

         Rolf Turner


From tim.appelhans at gmail.com  Sat Jul 21 08:15:10 2012
From: tim.appelhans at gmail.com (Tim Appelhans)
Date: Sat, 21 Jul 2012 08:15:10 +0200
Subject: [R-sig-Geo] overlay contour lines with labels over spplot with
 color regions?
In-Reply-To: <500993DF.60609@ifg.uni-tuebingen.de>
References: <500993DF.60609@ifg.uni-tuebingen.de>
Message-ID: <500A48EE.5030106@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120721/6d032da8/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sat Jul 21 09:31:30 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 21 Jul 2012 08:31:30 +0100
Subject: [R-sig-Geo] Dissolve polygon
In-Reply-To: <ff16a843de564a1c8474dddbfec3d658@EX-0-HT0.lancs.local>
References: <ff16a843de564a1c8474dddbfec3d658@EX-0-HT0.lancs.local>
Message-ID: <CANVKczPcOzd=CPU9yxBgdVY_khAWoRnZcc2e0TqiMDQca=3K4w@mail.gmail.com>

On Fri, Jul 20, 2012 at 8:40 PM, C?line Bellard
<bellard.celine at gmail.com> wrote:
> Hi,
>
> I am working with  a SpatialPolygonsDataFrame of many islands. There are a
> lot of polygons (islands) composing my SpatialPolygonsDataFrame.
> I want to extract the elevation of each island.
> I need to separate the different polygons (like dissolve function in
> arcgis), to have the elevation of each island.
>
> Do you have an idea how can I do that ?
>
> dim(hot)
> [1] 10945     5
>
> class(hot)
> [1] "SpatialLinesDataFrame"
> attr(,"package")
> [1] "sp"

 Looks like you have 10945 features in your shapefile...

 The extract function in the raster package will process pixels under
polygons. In this example, I sum a pollution raster over each lake
("Lake Exposure", about half-way down)

http://www.maths.lancs.ac.uk/~rowlings/Teaching/UseR2012/plume.html

 You probably want something like the mean or the max of the pixels
over each island. In your case, you should end up with 10945 values.

Barry


From a.ali at agrhymet.ne  Sat Jul 21 12:03:45 2012
From: a.ali at agrhymet.ne (Abdou ALI)
Date: Sat, 21 Jul 2012 11:03:45 +0100
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 107, Issue 21
Message-ID: <1089820790@mail.agrhymet.ne>

I am on leave til 10th August 2012 and I will have a limited access to email. I will get back to you as soon as I can. For urgent work related matters, please contact admin at agrhymet.ne


From bxhorn at gmail.com  Sat Jul 21 22:42:57 2012
From: bxhorn at gmail.com (BHorn)
Date: Sat, 21 Jul 2012 13:42:57 -0700 (PDT)
Subject: [R-sig-Geo] problem with OpenStreetMap
In-Reply-To: <CANtt_hyXDaLF3nkXytYm9cf7sHEbpOyYUA1q5sG=snMOnGDvcg@mail.gmail.com>
References: <CAJESSmad+BPBy_FzF68x8Ny-Yup7CHcDOtEmw895HZN7sg6Njg@mail.gmail.com>
	<CANtt_hyXDaLF3nkXytYm9cf7sHEbpOyYUA1q5sG=snMOnGDvcg@mail.gmail.com>
Message-ID: <1342903377889-7580570.post@n2.nabble.com>

Robert
I tried your proposed solution and I can't deny it works.  However, I don't
like the implication of having to leave my well established
editor/development environment and migrating to JGR in order to get the
OpenStreetMap package to work (on Max OSX).  

Are there environment or command settings that could avoid the error
altogether and the need to migrate to JGR?

In the meanwhile, I stick to the "osmar" package for downloading and
managing OSM data.
http://osmar.r-forge.r-project.org/




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-OpenStreetMap-tp7363530p7580570.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From bxhorn at gmail.com  Sat Jul 21 23:23:48 2012
From: bxhorn at gmail.com (BHorn)
Date: Sat, 21 Jul 2012 14:23:48 -0700 (PDT)
Subject: [R-sig-Geo] problem with OpenStreetMap
In-Reply-To: <1342903377889-7580570.post@n2.nabble.com>
References: <CAJESSmad+BPBy_FzF68x8Ny-Yup7CHcDOtEmw895HZN7sg6Njg@mail.gmail.com>
	<CANtt_hyXDaLF3nkXytYm9cf7sHEbpOyYUA1q5sG=snMOnGDvcg@mail.gmail.com>
	<1342903377889-7580570.post@n2.nabble.com>
Message-ID: <1342905828037-7580571.post@n2.nabble.com>

There is a simple solution to Java interface pointed out in the first
email....it does not require use of JDR.
- Restart your R session and
- use "Sys.setenv(NOAWT=1)" prior to loading OpenStreetMap

All the code the article you reference will now work.  Bottom line: there's
a simple bug in the package code



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-with-OpenStreetMap-tp7363530p7580571.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From martin.ivanov at ifg.uni-tuebingen.de  Sun Jul 22 10:41:50 2012
From: martin.ivanov at ifg.uni-tuebingen.de (Martin Ivanov)
Date: Sun, 22 Jul 2012 10:41:50 +0200
Subject: [R-sig-Geo] contour line labels in trellis contourplot
Message-ID: <500BBCCE.60608@ifg.uni-tuebingen.de>

  Hello,
In the classical function "contour" labels are drawn so that each contour line is broken at the place of the label,
  so that the label does not overlap the line. In the trellis contourplot the labels are placed beside or over the line,
  controlled by the label.style parameter, but I could not find
an option that would place the labels just as in the classical contour: breaking the contour line to make place for
  the label.

Have You got any ideas how breaking the contours to make place for the labels could be achieved in a trellis contourplot?

Best regards,

Martin




-- 
Dr. Martin Ivanov
Eberhard-Karls-Universit?t T?bingen
Mathematisch-Naturwissenschaftliche Fakult?t
Fachbereich Geowissenschaften
Water & Earth System Science (WESS)
Keplerstra?e 17, 72074 T?bingen, Deutschland
Tel. +4970712975023


From Roger.Bivand at nhh.no  Sun Jul 22 15:07:52 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 22 Jul 2012 15:07:52 +0200 (CEST)
Subject: [R-sig-Geo] contour line labels in trellis contourplot
In-Reply-To: <500BBCCE.60608@ifg.uni-tuebingen.de>
References: <500BBCCE.60608@ifg.uni-tuebingen.de>
Message-ID: <alpine.LRH.2.02.1207221459080.20026@reclus.nhh.no>

On Sun, 22 Jul 2012, Martin Ivanov wrote:

> Hello,
> In the classical function "contour" labels are drawn so that each contour 
> line is broken at the place of the label,
>  so that the label does not overlap the line. In the trellis contourplot the 
> labels are placed beside or over the line,
>  controlled by the label.style parameter, but I could not find
> an option that would place the labels just as in the classical contour: 
> breaking the contour line to make place for
>  the label.

This would be so much easier if you did give a working example. Please 
always do so.

library(sp)
library(sp)
data(meuse.grid)
coordinates(meuse.grid) <- c("x", "y")
gridded(meuse.grid) <- TRUE
proj4string(meuse.grid) <- CRS("+init=epsg:28992")
spplot(meuse.grid, "dist", col.regions=bpy.colors(20))
library(maptools)
lns <- ContourLines2SLDF(contourLines(
   as.image.SpatialGridDataFrame(meuse.grid["dist"]),
   nlevels=4), proj4string=CRS(proj4string(meuse.grid)))
spplot(meuse.grid, "dist", col.regions=bpy.colors(20),
   sp.layout=list("sp.lines", lns, lwd=2, col="grey", lty=2))
SLMP <- SpatialLinesMidPoints(as(lns, "SpatialLines"))
# here there is only one Line object per Lines object, so this works
spplot(meuse.grid, "dist", col.regions=bpy.colors(20),
   sp.layout=list(list("sp.lines", lns, lwd=2, col="grey", lty=2),
   list("sp.text", coordinates(SLMP), levels(lns$level), col="grey")))
# in other cases more care will be needed to assign multiple labels to 
# Lines objects.

The contour and contourLines functions do not report label placing points. 
You may extend this to add a background behind the labels if you like. The 
alternative with latticeExtra ought also to be tried.

Roger

>
> Have You got any ideas how breaking the contours to make place for the labels 
> could be achieved in a trellis contourplot?
>
> Best regards,
>
> Martin
>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From mspinola10 at gmail.com  Sun Jul 22 19:59:01 2012
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 22 Jul 2012 11:59:01 -0600
Subject: [R-sig-Geo] How can I plot a shapefile with geom_map from ggplot2
Message-ID: <CABkCotRT2Kr_URWLjwBGB7tKrNcq+O+rybJ+nDqzdVrNfsFtNw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120722/95a3cd27/attachment.pl>

From roman.lustrik at gmail.com  Sun Jul 22 20:09:20 2012
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sun, 22 Jul 2012 20:09:20 +0200
Subject: [R-sig-Geo] How can I plot a shapefile with geom_map from
	ggplot2
In-Reply-To: <CABkCotRT2Kr_URWLjwBGB7tKrNcq+O+rybJ+nDqzdVrNfsFtNw@mail.gmail.com>
References: <CABkCotRT2Kr_URWLjwBGB7tKrNcq+O+rybJ+nDqzdVrNfsFtNw@mail.gmail.com>
Message-ID: <CAHT1vpj--E_b6Jftc6sMZBTQoXpBTnTFyW2SdJ3WCbyVxOXQZw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120722/d1914652/attachment.pl>

From mspinola10 at gmail.com  Sun Jul 22 20:25:52 2012
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Sun, 22 Jul 2012 12:25:52 -0600
Subject: [R-sig-Geo] How can I plot a shapefile with geom_map from
	ggplot2
In-Reply-To: <CAHT1vpj--E_b6Jftc6sMZBTQoXpBTnTFyW2SdJ3WCbyVxOXQZw@mail.gmail.com>
References: <CABkCotRT2Kr_URWLjwBGB7tKrNcq+O+rybJ+nDqzdVrNfsFtNw@mail.gmail.com>
	<CAHT1vpj--E_b6Jftc6sMZBTQoXpBTnTFyW2SdJ3WCbyVxOXQZw@mail.gmail.com>
Message-ID: <CABkCotS5KFRFVdVe8vRuVtdHUsTphNHQwd+x2WhebxB55z6PiQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120722/68d382d6/attachment.pl>

From simon.ohanlon at imperial.ac.uk  Sun Jul 22 20:30:54 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Sun, 22 Jul 2012 18:30:54 +0000
Subject: [R-sig-Geo] How can I plot a shapefile with geom_map from
 ggplot2
In-Reply-To: <CABkCotRT2Kr_URWLjwBGB7tKrNcq+O+rybJ+nDqzdVrNfsFtNw@mail.gmail.com>
References: <CABkCotRT2Kr_URWLjwBGB7tKrNcq+O+rybJ+nDqzdVrNfsFtNw@mail.gmail.com>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A01889DFFE@icexch-m5.ic.ac.uk>

Dear Manuel,
I had the same problem as you.

I googled: "plotting a shapefile with ggplot2"

First hit:

https://github.com/hadley/ggplot2/wiki/plotting-polygon-shapefiles

Using this guide it only take a couple of very minor adjustments to plot using geom_map() rather than geom_polygon(). My example below plots country borders of West African countries using the shapefiles provided by the Natural Earth website.

Note that on the tutorial webpage they use gpclibPermit() to use gpclib for polygon union operations in the fortify function. You should omit this and the fortify method will now select rgeos to union polygons by default (works from ggplot2 0.9.1 onwards - possibly 0.9 as well). The example below uses both geom_map() for outlines and geom_map() for filled polygons.


#Load relevant libraries
library(ggplot2)
library(maptools)
library(rgeos)


#	Download and unzip the Natural Earth Country Polygon data
oldwd <- getwd()
tmp <- tempdir()
setwd(tmp)
url <- "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/50m-admin-0-countries.zip"
dest <- file.path(tmp,"tmp.zip")
download.file(url,dest)	#File is 1.3Mb
unzip(dest)

#	Read in the data to a SpatialPolygonsDataFrame and subset to West African countries
wld <- readShapePoly("ne_50m_admin_0_countries")
wa <- wld[c(21,22,43,44,81,82,84,144,151,158,160,190,195,213),]

#	Convert to data.frame for plotting with ggplot2
wa at data$id <- rownames(wa at data) # Explicitly identifies attribute rows by the .dbf offset
wa.df <- as.data.frame(wa)
gpclibPermit() # required for fortify method if rgeos is unavailable
wa.fort <- fortify(wa, region="id")
wa.gg <- join(wa.fort, wa.df,by="id")

#	Create the plot
p <- ggplot(wa.gg)+
	geom_map(map=wa.gg,aes(long,lat,map_id=id))+
	geom_path(colour="white",aes(long,lat,group=group),size=1.2)+
	coord_equal()+
	scale_x_continuous(name=expression(paste("Longitude (",degree,")")),limits=c(-18,4),expand=c(0,0))+
	scale_y_continuous(name=expression(paste("Latitude (",degree,")")),limits=c(4,17),expand=c(0,0))
print(p)
unlink(tmp,recursive=T)
setwd(oldwd)

Simon


--------------------------------
Simon O'Hanlon, BSc MSc
Department of Infectious Disease Epidemiology
Imperial College London
St. Mary's Hospital
London
W2 1PG
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Manuel Sp?nola [mspinola10 at gmail.com]
Sent: 22 July 2012 18:59
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] How can I plot a shapefile with geom_map from ggplot2

Dear list members,

Sorry for cross-posting.

I asked this question to a ggplot2 forum, but I would like to have other
suggestions from this list.

How can I plot a shapefile with the new function geom_map from ggplot2?

Best,

Manuel

--
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Tel?fono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

        [[alternative HTML version deleted]]



From b.rowlingson at lancaster.ac.uk  Sun Jul 22 22:38:34 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 22 Jul 2012 21:38:34 +0100
Subject: [R-sig-Geo] How can I plot a shapefile with geom_map from
	ggplot2
In-Reply-To: <2151153d80c2477f89250577892dd5a3@EX-0-HT0.lancs.local>
References: <2151153d80c2477f89250577892dd5a3@EX-0-HT0.lancs.local>
Message-ID: <CANVKczP3h0qbKWT=+pc4xSShLKj33ogYZ4ps1qN7gK-wEme0gA@mail.gmail.com>

2012/7/22 Manuel Sp?nola <mspinola10 at gmail.com>:
> Dear list members,
>
> Sorry for cross-posting.
>
> I asked this question to a ggplot2 forum, but I would like to have other
> suggestions from this list.
>
> How can I plot a shapefile with the new function geom_map from ggplot2?

 Well, R is an object-oriented system, so in an ideal world you'd just
pass it anything that geom_map is capable of doing whatever it is that
geom_map needs to do on an object as its 'map' parameter.

 Sadly, geom_map, like most ggplot2 functions, is quite fussy about
its food. It likes its map objects fortified, much like corn flakes or
low-fat milk. So you have to fortify it. Literally:

 myspdf=readOGR(".","myshapes")
 fort = fortify(myspdf)

 And you might also have to specify an id. The help(geom_map) isn't
too clear. Then you have to figure out how to get ggplot() and
geom_map() and anything else to talk to each other. At this point you
may consider just doing:

 plot(myspdf, col=somefunction(myspdf$Value))

where somefunction() maps your values to colours, like a colourPalette
function. Or even:

 spplot(myspdf, "Value")

 I tried to do some maps with geom_map for my spatial data workshop
but I hit this documentation problem and a couple of bugs - if I'd had
more time I would have worked it out, but as it stood it darn near
broke me.

Okay, here's how to plot the regions of the columbus dataset from the
spdep package (see example(columbus)) shaded by the AREA within the
given limnits:

 ggplot(columbus at data)+geom_map(
       map=fortify(columbus,region="id"),
       aes(map_id=id,fill=AREA)) +
       expand_limits(x=c(5,12),y=c(10,15))


Barry


From jefunes at gmail.com  Mon Jul 23 15:26:12 2012
From: jefunes at gmail.com (Jose Funes)
Date: Mon, 23 Jul 2012 09:26:12 -0400
Subject: [R-sig-Geo] Point pattern add covariates
Message-ID: <CAG1eJiFe=DB=astHp=h3qkR7roSX-UrorUx0Odb6bfvDxkikwA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120723/f106e18b/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Jul 23 15:39:30 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 23 Jul 2012 14:39:30 +0100
Subject: [R-sig-Geo] Point pattern add covariates
In-Reply-To: <7b6884a0def84531b023f78bc7aee09a@EX-1-HT0.lancs.local>
References: <7b6884a0def84531b023f78bc7aee09a@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMTx_qV=0Qt9icdwDJ3bmZBH+pS1jNxV9L1-5BRLtkH7w@mail.gmail.com>

On Mon, Jul 23, 2012 at 2:26 PM, Jose Funes <jefunes at gmail.com> wrote:
> Dear list,
> I have point pattern data and would like to attach/add covariates as raster
> (image or grid) to it. For example as the case of the bei data with
> bei.extra with covariates.

 You want to get the values of a raster at a set of points?

 Try extract(points,raster) from the raster package. [or it might be
extract(raster,points)].

 'points' is a SpatialPoints object (or SPDataFrame) and 'raster' is a
raster or stack object from the raster package.

Barry


From r.turner at auckland.ac.nz  Mon Jul 23 23:29:36 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 24 Jul 2012 09:29:36 +1200
Subject: [R-sig-Geo] Point pattern add covariates
In-Reply-To: <CAG1eJiFe=DB=astHp=h3qkR7roSX-UrorUx0Odb6bfvDxkikwA@mail.gmail.com>
References: <CAG1eJiFe=DB=astHp=h3qkR7roSX-UrorUx0Odb6bfvDxkikwA@mail.gmail.com>
Message-ID: <500DC240.9010604@auckland.ac.nz>

On 24/07/12 01:26, Jose Funes wrote:
> Dear list,
> I have point pattern data and would like to attach/add covariates as raster
> (image or grid) to it. For example as the case of the bei data with
> bei.extra with covariates.

I'm afraid I don't understand what it is that you need to do.
What do you mean by "attach/add"?  In the example of the
"bei" data that you refer to, the images (covariates) "elev"
and "grad" are components of the list "bei.extra" which is
a separate object from the point pattern "bei".  The object
"bei.extra" is not "attached" to the object "bei" in any way.

Barry Rowlingson suggested that you might want to find the
values of a covariate associated with each point of a point
pattern.   The easiest way to do this is to use the (undocumented)
function "lookup.im()".

E.g.:

     em <- with(bei.extra,lookup.im(elev,bei$x,bei$y))
     gm <- with(bei.extra,lookup.im(grad,bei$x,bei$y))

Then you could "attach" these values to the point pattern as
*marks*:

     marks(bei) <- data.frame(elev=em,grad=gm)

Is this (anything like) what you want to do?

     cheers,

         Rolf Turner

P. S.  Adrian:  Do you think we should make "lookup.im()" into a 
*documented*
function?  I have found myself recommending its use to inquirers on more 
than
one occasion.

         R.


From jefunes at gmail.com  Tue Jul 24 03:13:29 2012
From: jefunes at gmail.com (Jose Funes)
Date: Mon, 23 Jul 2012 21:13:29 -0400
Subject: [R-sig-Geo] Point pattern add covariates
In-Reply-To: <500DC240.9010604@auckland.ac.nz>
References: <CAG1eJiFe=DB=astHp=h3qkR7roSX-UrorUx0Odb6bfvDxkikwA@mail.gmail.com>
	<500DC240.9010604@auckland.ac.nz>
Message-ID: <CAG1eJiEQoj-5KVVLVc2xk7Y6hS1=wyDHnRJRTsJSMVVOb1gHWw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120723/0c876a13/attachment.pl>

From tiagovieira7 at yahoo.com.br  Tue Jul 24 03:49:44 2012
From: tiagovieira7 at yahoo.com.br (Tiago Vieira)
Date: Mon, 23 Jul 2012 22:49:44 -0300
Subject: [R-sig-Geo] Variogram model 3D
Message-ID: <500DFF38.1040706@yahoo.com.br>

hi,

Excuse my ignorance, but I've read the help of the function vgm in 
package gstat and still do not understand how to change the vertical 
range of the variogram model in 3D, as is possible in gslib (i.e. vmodel 
and kt3d).

Thank you,

Tiago Vieira.

hypothetical examplein gslib:

                   Parameters for KT3D
                   *******************

START OF PARAMETERS:
data3D.dat                         \file with data
0   1   2   3    4     0         \   columns for DH, X, Y, Z, var, sec var
-1.0e21   1.0e21                 \   trimming limits
0                                \option: 0=grid, 1=cross, 2=jackknife
xvk.dat                          \file with jackknife data
1   2   0    3    0              \   columns for X,Y,Z,vr and sec var
3                                \debugging level: 0,1,2,3
kt3d.dbg                         \file for debugging output
teste3D.out                      \file for kriged output
51    0.0    2.0                 \nx,xmn,xsiz
51    0.0    2.0                 \ny,ymn,ysiz
51    0.0    2.0                 \nz,zmn,zsiz
1    1      1                    \x,y and z block discretization
4    8                           \min, max data for kriging
0                                \max per octant (0-> not used)
60.0  60.0  60.0                 \maximum search radii
  0.0   0.0   0.0                 \angles for search ellipsoid
1     2.302                      \0=SK,1=OK,2=non-st SK,3=exdrift
0 0 0 0 0 0 0 0 0                \drift: x,y,z,xx,yy,zz,xy,xz,zy
0                                \0, variable; 1, estimate trend
extdrift.dat                     \gridded file with drift/mean
4                                \  column number in gridded file
1    0.0                         \nst, nugget effect
1    3.0    0.0    0.0    0.0    \it,cc,ang1,ang2,ang3
            40.0   40.0    0.0    \a_hmax, a_hmin, a_vert


From Adrian.Baddeley at csiro.au  Tue Jul 24 04:53:34 2012
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Tue, 24 Jul 2012 10:53:34 +0800
Subject: [R-sig-Geo] Point pattern add covariates
In-Reply-To: <CAG1eJiEQoj-5KVVLVc2xk7Y6hS1=wyDHnRJRTsJSMVVOb1gHWw@mail.gmail.com>
References: <CAG1eJiFe=DB=astHp=h3qkR7roSX-UrorUx0Odb6bfvDxkikwA@mail.gmail.com>
	<500DC240.9010604@auckland.ac.nz>
	<CAG1eJiEQoj-5KVVLVc2xk7Y6hS1=wyDHnRJRTsJSMVVOb1gHWw@mail.gmail.com>
Message-ID: <57DC18C299094D4299F837570C5DF1C50103DB6C9ADF@EXWA-MBX01.nexus.csiro.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120724/539df158/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Jul 24 09:00:17 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 24 Jul 2012 08:00:17 +0100
Subject: [R-sig-Geo] Point pattern add covariates
In-Reply-To: <01f2fe0af7514e51aec24a081a91aae1@EX-1-HT0.lancs.local>
References: <CAG1eJiFe=DB=astHp=h3qkR7roSX-UrorUx0Odb6bfvDxkikwA@mail.gmail.com>
	<500DC240.9010604@auckland.ac.nz>
	<CAG1eJiEQoj-5KVVLVc2xk7Y6hS1=wyDHnRJRTsJSMVVOb1gHWw@mail.gmail.com>
	<01f2fe0af7514e51aec24a081a91aae1@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPGWzzZOSsh56Az9+H9BoFTJxEfuvw8JQjsgaJAu8_jjA@mail.gmail.com>

On Tue, Jul 24, 2012 at 3:53 AM, Adrian.Baddeley at csiro.au
<Adrian.Baddeley at csiro.au> wrote:

> I don't know why Barry Rowlingson is giving you advice about spatstat - he recently said no-one should be using spatstat anyway - maybe it's all part of a disinformation campaign!

 ??!??!!

 The original post didn't mention spatstat and neither did I!

 And I don't recall saying flat out that no-one should use spatstat.
Everyone doing spatial point pattern analysis should be using
spatstat, and *not* using splancs - I don't think there's anything
(useful) that splancs does that spatstat doesn't do. If there is, then
I suggest sometime we sort out a google summer of code project
sometime to kill off splancs and graft anything useful into spatstat
(hmmm didnt we try that ten years ago? :))

 However I don't like the duplication of spatial data handling and
manipulation between packages such as spatstat and sp. We have some
very nice raster and vector data types now, and if spatstat could use
them (natively without coercion) it would save a lot of unneccessary
duplication. In one of the packages I'm involved in it seems that
we're constantly converting from sp to ppp and back again in order to
get some functionality from a package that only handles one!

 So I might have said 'Don't do X in spatstat', but I certainly didn't
say 'Don't do K, F, or G in spatstat'. I more likely said 'Don't do K
in splancs - do it in spatstat!'

Barry


From born.rebel.83 at gmail.com  Tue Jul 24 11:28:43 2012
From: born.rebel.83 at gmail.com (Anisha Kaul)
Date: Tue, 24 Jul 2012 14:58:43 +0530
Subject: [R-sig-Geo] Loading a raster data of map PNG on ggmaps of R
Message-ID: <CAM1yFZ9+zSnoVVcP6HquQ_KMjdLJ+M2GPQkaX24a+0ZYQD0fUg@mail.gmail.com>

Greetings,

I have the map as a png, so I won't be using the get_map function.
I have extracted the raster data from the png, and I wish to load the
map as it is on the display of R, and then I would like to plot a
point on it.

So, here's the way I have tried ggmaps. The program is an error with
Rscript, and there isn't any output "display window" being shown.
___________________________________________________
library (png)
library (ggmap)

latitude  = c(40.702147,40.718217,40.711614)
longitude = c(-74.012318,-74.015794,-73.998284)

# Reads a PNG and outputs a raster array.
img <- readPNG (system.file ("img", "My.png", package="png"))

df <- data.frame (latitude, longitude)

# img: raster array read from the map png.
ggimage (img, fullpage = TRUE) + geom_point (data = df, aes_auto (df), size = 2)

qplot (latitude, longitude, data = df, colour = I("red"), size = I(3))
___________________________________________________




The error is:
___________________________________________________
anisha at linux-y3pi:~> Rscript uff.R
Loading required package: ggplot2
Loading required package: methods
Error in eval(expr, envir, enclos) : object 'x' not found
Calls: print ... sapply -> lapply -> eval.quoted -> lapply -> FUN -> eval
Execution halted
___________________________________________________




R info:
___________________________________________________
> sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] ggmap_2.1     ggplot2_0.9.1 png_0.1-4

loaded via a namespace (and not attached):
 [1] colorspace_1.1-1   dichromat_1.2-4    digest_0.5.2       grid_2.15.1
 [5] labeling_0.1       MASS_7.3-18        memoise_0.1        munsell_0.3
 [9] plyr_1.7.1         proto_0.3-9.2      RColorBrewer_1.0-5 reshape2_1.2.1
[13] RgoogleMaps_1.2.0  rjson_0.2.8        scales_0.2.1       stringr_0.6
[17] tools_2.15.1
>
___________________________________________________

-- 
Anisha Kaul


From dieter.mayr at boku.ac.at  Tue Jul 24 15:51:59 2012
From: dieter.mayr at boku.ac.at (Dieter Mayr)
Date: Tue, 24 Jul 2012 15:51:59 +0200
Subject: [R-sig-Geo] alphanumerical string adress matching
Message-ID: <500EC49F020000A7000049FD@gwia2.boku.ac.at>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120724/e7055342/attachment.pl>

From alexandresantosbr at yahoo.com.br  Tue Jul 24 18:13:41 2012
From: alexandresantosbr at yahoo.com.br (ASANTOS)
Date: Tue, 24 Jul 2012 13:13:41 -0300
Subject: [R-sig-Geo] Multiple circular holes with owin function in spatastat
In-Reply-To: <mailman.17.1336039205.31005.r-sig-geo@r-project.org>
References: <mailman.17.1336039205.31005.r-sig-geo@r-project.org>
Message-ID: <500EC9B5.7090202@yahoo.com.br>

Dear sig-geoers,

       It's possible to making a multiple circular holes with owin() 
function in spatstat package if the circles are created in a loop 
function, for example:

##
##Circle x coordinates
x<-c(524237,524237,524237,524237,524237,524237,524237,524237,524242
,524242,524242,524247,524247,524247,524247,524247,524247,524247
,524247,524257,524257,524257,524257,524257,524257,524257)
##Circle x coordinates
y<-c(7978856,7978866,7978876,7978896,7978916,7978936,7978946,7978956,7978956,7978946
,7978936,7978956,7978946,7978936,7978916,7978896,7978876,7978866
,7978856,7978856,7978876,7978896,7978906,7978916,7978936,7978956)
##

CIR<-NULL
points(a1.past.syn[,1],a1.past.syn[,2])
   for (i in 1:length(x)){
   circle<-disc(radius=5,centre = c(x[i],y[i]))
   CIR<-rbind(CIR, c(circle))
}

Because I don't know, if I can use CIR's objet in the owin(poly = ... ) 
function, that uses list() for create this kind of object.

Thanks,

-- 
Alexandre dos Santos
Engenheiro Florestal, Dr.
Universidade Federal de Lavras
Departamento de Entomologia
Laborat?rio de Entomologia Florestal
Caixa Postal 3037
37200-000 - Lavras/MG
Fone: +55 (35) 9223-0304


From juantomas.sayago at gmail.com  Tue Jul 24 18:17:24 2012
From: juantomas.sayago at gmail.com (Juan Tomas Sayago)
Date: Tue, 24 Jul 2012 12:17:24 -0400
Subject: [R-sig-Geo] How to identify unknown Coordinate systems?
Message-ID: <CAEOXpNAcyyf4pqcnMs-C6t95vi6TmttcRHhbBP9ZK+7k31S+Yw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120724/81c0596c/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Jul 24 18:36:30 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 24 Jul 2012 17:36:30 +0100
Subject: [R-sig-Geo] How to identify unknown Coordinate systems?
In-Reply-To: <b19d42fad9b94dfdac8b3fb839344d17@EX-1-HT0.lancs.local>
References: <b19d42fad9b94dfdac8b3fb839344d17@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOLTE8sVwz774TFJuoR1=BySa_GqDC7pnVdYG+xrDSAYg@mail.gmail.com>

On Tue, Jul 24, 2012 at 5:17 PM, Juan Tomas Sayago
<juantomas.sayago at gmail.com> wrote:
> Hello,
> I have data in an unknown projection  but I know where more or less where
> it is located, but I don't know from what to transform to what I want to
> use.

First of all it could be one of the global systems like UTM zones.
Find out which UTM zone you might expect it to be and see what the
coordinates are of the region you think it might be.

Also, make sure you haven't got a .prj file with your shapefile, or
that the CRS is hidden in some metadata file.

Or try looking up the geographical area here:

http://www.spatialreference.org/

 but you might have to be creative - searching for 'Great Britain'
doesnt find the British national grid system, but searching for
'British' does. That site is also good for checking UTM zones. Note
there's a lot of unofficial CRS in there.

 Another useful thing is to figure out if the coordinates are metres
or km or miles, feet and inches - how far apart are your points in the
coordinate system?

 If all that fails, if you have the location of some of your points in
a known coordinate system, you can probably work out the transform
yourself, but it's likely to be imprecise.

 Finally, try beating the person who gave you the data until they tell
you! Or being nice to them.

Barry


From edzer.pebesma at uni-muenster.de  Tue Jul 24 18:43:41 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 24 Jul 2012 18:43:41 +0200
Subject: [R-sig-Geo] Point pattern add covariates
In-Reply-To: <CANVKczPGWzzZOSsh56Az9+H9BoFTJxEfuvw8JQjsgaJAu8_jjA@mail.gmail.com>
References: <CAG1eJiFe=DB=astHp=h3qkR7roSX-UrorUx0Odb6bfvDxkikwA@mail.gmail.com>
	<500DC240.9010604@auckland.ac.nz>
	<CAG1eJiEQoj-5KVVLVc2xk7Y6hS1=wyDHnRJRTsJSMVVOb1gHWw@mail.gmail.com>
	<01f2fe0af7514e51aec24a081a91aae1@EX-1-HT0.lancs.local>
	<CANVKczPGWzzZOSsh56Az9+H9BoFTJxEfuvw8JQjsgaJAu8_jjA@mail.gmail.com>
Message-ID: <500ED0BD.5050107@uni-muenster.de>



On 07/24/2012 09:00 AM, Barry Rowlingson wrote:
> On Tue, Jul 24, 2012 at 3:53 AM, Adrian.Baddeley at csiro.au
> <Adrian.Baddeley at csiro.au> wrote:
> 
>> I don't know why Barry Rowlingson is giving you advice about spatstat - he recently said no-one should be using spatstat anyway - maybe it's all part of a disinformation campaign!
> 
>  ??!??!!
> 
>  The original post didn't mention spatstat and neither did I!
> 
>  And I don't recall saying flat out that no-one should use spatstat.
> Everyone doing spatial point pattern analysis should be using
> spatstat, and *not* using splancs - I don't think there's anything
> (useful) that splancs does that spatstat doesn't do. If there is, then
> I suggest sometime we sort out a google summer of code project
> sometime to kill off splancs and graft anything useful into spatstat
> (hmmm didnt we try that ten years ago? :))
> 
>  However I don't like the duplication of spatial data handling and
> manipulation between packages such as spatstat and sp. We have some
> very nice raster and vector data types now, and if spatstat could use
> them (natively without coercion) it would save a lot of unneccessary
> duplication. In one of the packages I'm involved in it seems that
> we're constantly converting from sp to ppp and back again in order to
> get some functionality from a package that only handles one!
> 
>  So I might have said 'Don't do X in spatstat', but I certainly didn't
> say 'Don't do K, F, or G in spatstat'. I more likely said 'Don't do K
> in splancs - do it in spatstat!'

I can only recall (but can't trace back) that Barry mentioned recently
that the spatstat objects do not handle coordinate reference systems.

The objects in sp are not tailored in particular for point pattern
analysis (and neither for geostatistics) -- SpatialPoints objects for
instance do not hold an observation window, which would be indispensible
to compute a point density.

The classes in sp do contain, I believe, the building blocks needed for
spatstat objects, and one could easily subclass SpatialPoints for a
SpatialPointsPattern (containing an observation window), and a
SpatialPointsDataFrame to form a marked point pattern with observation
window.

By doing this, seemingly trivial mistakes could be caught, e.g. false
matching of points, windows, or marks by ignoring coordinate reference
systems, or doing Euclidian distances from long/lat coordinates. Seeing
this as a benefit of course assumes that (the spatstat) code developers
*want* to catch such errors.

It would be good to also hear some response from spatstat users whether
a tighter integration between spatstat and sp would be appreciated, or not.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Tue Jul 24 19:01:41 2012
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 24 Jul 2012 19:01:41 +0200
Subject: [R-sig-Geo] Variogram model 3D
In-Reply-To: <500DFF38.1040706@yahoo.com.br>
References: <500DFF38.1040706@yahoo.com.br>
Message-ID: <500ED4F5.7090403@uni-muenster.de>

Could you please tell which part of the help of vgm is unclear to you?

As in GSLIB, X is the major direction, Y the first minor, and Z the
second minor direction. Then, if

anis = c(p,q,r,s,t)

t is the anisotropy ration between the X and Z direction.

On 07/24/2012 03:49 AM, Tiago Vieira wrote:
> hi,
> 
> Excuse my ignorance, but I've read the help of the function vgm in
> package gstat and still do not understand how to change the vertical
> range of the variogram model in 3D, as is possible in gslib (i.e. vmodel
> and kt3d).
> 
> Thank you,
> 
> Tiago Vieira.
> 
> hypothetical examplein gslib:
> 
>                   Parameters for KT3D
>                   *******************
> 
> START OF PARAMETERS:
> data3D.dat                         \file with data
> 0   1   2   3    4     0         \   columns for DH, X, Y, Z, var, sec var
> -1.0e21   1.0e21                 \   trimming limits
> 0                                \option: 0=grid, 1=cross, 2=jackknife
> xvk.dat                          \file with jackknife data
> 1   2   0    3    0              \   columns for X,Y,Z,vr and sec var
> 3                                \debugging level: 0,1,2,3
> kt3d.dbg                         \file for debugging output
> teste3D.out                      \file for kriged output
> 51    0.0    2.0                 \nx,xmn,xsiz
> 51    0.0    2.0                 \ny,ymn,ysiz
> 51    0.0    2.0                 \nz,zmn,zsiz
> 1    1      1                    \x,y and z block discretization
> 4    8                           \min, max data for kriging
> 0                                \max per octant (0-> not used)
> 60.0  60.0  60.0                 \maximum search radii
>  0.0   0.0   0.0                 \angles for search ellipsoid
> 1     2.302                      \0=SK,1=OK,2=non-st SK,3=exdrift
> 0 0 0 0 0 0 0 0 0                \drift: x,y,z,xx,yy,zz,xy,xz,zy
> 0                                \0, variable; 1, estimate trend
> extdrift.dat                     \gridded file with drift/mean
> 4                                \  column number in gridded file
> 1    0.0                         \nst, nugget effect
> 1    3.0    0.0    0.0    0.0    \it,cc,ang1,ang2,ang3
>            40.0   40.0    0.0    \a_hmax, a_hmin, a_vert
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From tephilippi at gmail.com  Tue Jul 24 20:58:43 2012
From: tephilippi at gmail.com (Tom Philippi)
Date: Tue, 24 Jul 2012 11:58:43 -0700
Subject: [R-sig-Geo] alphanumerical string adress matching
In-Reply-To: <500EC49F020000A7000049FD@gwia2.boku.ac.at>
References: <500EC49F020000A7000049FD@gwia2.boku.ac.at>
Message-ID: <CALyPt8zc5dmbayEXw06ecdUxZ6QcWuVQbmQmt4wxjujJP3vQRg@mail.gmail.com>

Dieter--

You may be able to simply paste your separate address components into
single character vectors for each dataframe, change to consistent case
with tolower(), and then use agrep() for  Levenshtein edit distance
approximate matching (minimum number of insertions & deletions).  You
may or may not want to preprocess (replacing 2 or more consecutive
spaces with a single space, etc.).

If not, look in the CRAN task view on Natural Language Processing
http://cran.r-project.org/web/views/NaturalLanguageProcessing.html for
more tools for approximate matching.

Based on my experience with US property assessors' geocoding, I do not
recommend approximate matching by component and numerical compositing
of the distances: one of the most common variants is the same
information put at the end of one component (line) versus the
beginning of the next (line).

Good luck.

Tom

On Tue, Jul 24, 2012 at 6:51 AM, Dieter Mayr <dieter.mayr at boku.ac.at> wrote:
> Dear all,
>
> I am coming up with a rather simple problem. Maybe someone has experience with this problem and knows an easy solution...
> I want to geocode some household data, which contain the exact adresse (street, street Nr, postalcode, city) in colums. Futhermore I have another database with the adresses and the GIS-data of ALL houses in the areas (again: street, street Nr., postalcode, city).
>
> So, I simply have to match these two data bases. However in many cases adresses are sightly different spelled. Thus I think I need some kind of algorithm to combine this two data.
> Does anyone know an easy way how to do it? Rows contain numbers as well as alphabetical street-/city-names.
>
> Thanks a lot in advance and kind regards,
>
>
> Dieter Mayr
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Tue Jul 24 21:07:48 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 24 Jul 2012 21:07:48 +0200 (CEST)
Subject: [R-sig-Geo] R-spatial intensive PhD course 19-27 November 2012
Message-ID: <alpine.LRH.2.02.1207242053480.28083@reclus.nhh.no>

A new edition of the intensive PhD course "Analysing spatial data" will be 
held in Bergen, 19-27 November 2012; its web page has just been published, 
with details of content and how to apply:

http://www.nhh.no/en/research---faculty/department-of-economics/phd-pages/ph
d-courses/ecs530-analysing-spatial-data.aspx

No application deadline has yet been set, but the number of places is 
limited to about 30 by the room used. Please contact me off-list with any 
queries. Non-PhD-student participants are welcome to also apply.

Roger

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.turner at auckland.ac.nz  Tue Jul 24 22:53:54 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Wed, 25 Jul 2012 08:53:54 +1200
Subject: [R-sig-Geo] Multiple circular holes with owin function in
	spatastat
In-Reply-To: <500EC9B5.7090202@yahoo.com.br>
References: <mailman.17.1336039205.31005.r-sig-geo@r-project.org>
	<500EC9B5.7090202@yahoo.com.br>
Message-ID: <500F0B62.9010005@auckland.ac.nz>

On 25/07/12 04:13, ASANTOS wrote:
> Dear sig-geoers,
>
>       It's possible to making a multiple circular holes with owin() 
> function in spatstat package if the circles are created in a loop 
> function, for example:
>
> ##
> ##Circle x coordinates
> x<-c(524237,524237,524237,524237,524237,524237,524237,524237,524242
> ,524242,524242,524247,524247,524247,524247,524247,524247,524247
> ,524247,524257,524257,524257,524257,524257,524257,524257)
> ##Circle x coordinates
     You mean "##Circle y coordinates" here.
> y<-c(7978856,7978866,7978876,7978896,7978916,7978936,7978946,7978956,7978956,7978946 
>
> ,7978936,7978956,7978946,7978936,7978916,7978896,7978876,7978866
> ,7978856,7978856,7978876,7978896,7978906,7978916,7978936,7978956)
> ##
>
> CIR<-NULL
> points(a1.past.syn[,1],a1.past.syn[,2])

     What on earth is the forgoing line all about?  It adds nothing to
     the issue of concern and makes your code non-reproducible.
     We don't have "a1.past.syn".
> for (i in 1:length(x)){
>   circle<-disc(radius=5,centre = c(x[i],y[i]))
>   CIR<-rbind(CIR, c(circle))

     Using rbind() here makes no sense at all; actually c(circle) makes no
     sense at all either.
> }
>
> Because I don't know, if I can use CIR's objet in the owin(poly = ... 
> ) function, that uses list() for create this kind of object.

If your discs did not overlap you could just use owin(poly = ...) in the 
following manner:

     CIR <- vector("list",length(x))
     for(i in 1:length(x)) CIR[[i]] <- 
disc(radius=5,centre=c(x[i],y[i]))[["bdry"]][[1]]
     W <- owin(poly=CIR)

***HOWEVER*** your discs *do* overlap, so the foregoing results in an 
error and produces
no window.  So what you have to/can do is:

     CIR <- vector("list",length(x))
     for(i in 1:length(x)) CIR[[i]] <- disc(radius=5,centre=c(x[i],y[i]))
     W <- do.call(union.owin,CIR)

This takes quite a while --- order of half a minute or so on my elderly 
laptop --- and
creates a window of type "mask".

If you really want a window with polygonal boundaries you need to

     * be operating under conditions compatible with the gpclib license

     * have the gpclib package installed

     * enable gpclib by executing

             spatstat.options(gpclib=TRUE)

before executing "W <- do.call(union.owin,CIR)".  It's much quicker than 
the "mask" type
implementation, but the fly in the ointment is that cotton pickin' license!

HTH

     cheers,

         Rolf Turner


From tiagovieira7 at yahoo.com.br  Wed Jul 25 00:05:21 2012
From: tiagovieira7 at yahoo.com.br (Tiago Vieira)
Date: Tue, 24 Jul 2012 15:05:21 -0700 (PDT)
Subject: [R-sig-Geo] Variogram model 3D
In-Reply-To: <500ED4F5.7090403@uni-muenster.de>
References: <500DFF38.1040706@yahoo.com.br> <500ED4F5.7090403@uni-muenster.de>
Message-ID: <1343167521.58506.YahooMailNeo@web122102.mail.ne1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120724/63fdeaec/attachment.pl>

From mdsumner at gmail.com  Wed Jul 25 02:32:53 2012
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 25 Jul 2012 10:32:53 +1000
Subject: [R-sig-Geo] Point pattern add covariates
In-Reply-To: <500ED0BD.5050107@uni-muenster.de>
References: <CAG1eJiFe=DB=astHp=h3qkR7roSX-UrorUx0Odb6bfvDxkikwA@mail.gmail.com>
	<500DC240.9010604@auckland.ac.nz>
	<CAG1eJiEQoj-5KVVLVc2xk7Y6hS1=wyDHnRJRTsJSMVVOb1gHWw@mail.gmail.com>
	<01f2fe0af7514e51aec24a081a91aae1@EX-1-HT0.lancs.local>
	<CANVKczPGWzzZOSsh56Az9+H9BoFTJxEfuvw8JQjsgaJAu8_jjA@mail.gmail.com>
	<500ED0BD.5050107@uni-muenster.de>
Message-ID: <CAAcGz9-B-8NqfRmXkFcykDUK=QbHE0g8NGq68rm92db6ZvvcHw@mail.gmail.com>

Note that there are some conversions already in maptools, at least for
as(ppp, "SpatialPoints") and as(psp, "SpatialLines") - I use some of
this in the trip package to convert to psp (a trip is implicitly a set
of lines with marks). I'm also interested in conversions from/to
adehabitat* classes and I'd like to see a good summary of what is
already available and what is missing so we can identify where things
have a clean translation and where they need more thought.

I'll try to come back with more detail.

Cheers, Mike.

On Wed, Jul 25, 2012 at 2:43 AM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:
>
>
> On 07/24/2012 09:00 AM, Barry Rowlingson wrote:
>> On Tue, Jul 24, 2012 at 3:53 AM, Adrian.Baddeley at csiro.au
>> <Adrian.Baddeley at csiro.au> wrote:
>>
>>> I don't know why Barry Rowlingson is giving you advice about spatstat - he recently said no-one should be using spatstat anyway - maybe it's all part of a disinformation campaign!
>>
>>  ??!??!!
>>
>>  The original post didn't mention spatstat and neither did I!
>>
>>  And I don't recall saying flat out that no-one should use spatstat.
>> Everyone doing spatial point pattern analysis should be using
>> spatstat, and *not* using splancs - I don't think there's anything
>> (useful) that splancs does that spatstat doesn't do. If there is, then
>> I suggest sometime we sort out a google summer of code project
>> sometime to kill off splancs and graft anything useful into spatstat
>> (hmmm didnt we try that ten years ago? :))
>>
>>  However I don't like the duplication of spatial data handling and
>> manipulation between packages such as spatstat and sp. We have some
>> very nice raster and vector data types now, and if spatstat could use
>> them (natively without coercion) it would save a lot of unneccessary
>> duplication. In one of the packages I'm involved in it seems that
>> we're constantly converting from sp to ppp and back again in order to
>> get some functionality from a package that only handles one!
>>
>>  So I might have said 'Don't do X in spatstat', but I certainly didn't
>> say 'Don't do K, F, or G in spatstat'. I more likely said 'Don't do K
>> in splancs - do it in spatstat!'
>
> I can only recall (but can't trace back) that Barry mentioned recently
> that the spatstat objects do not handle coordinate reference systems.
>
> The objects in sp are not tailored in particular for point pattern
> analysis (and neither for geostatistics) -- SpatialPoints objects for
> instance do not hold an observation window, which would be indispensible
> to compute a point density.
>
> The classes in sp do contain, I believe, the building blocks needed for
> spatstat objects, and one could easily subclass SpatialPoints for a
> SpatialPointsPattern (containing an observation window), and a
> SpatialPointsDataFrame to form a marked point pattern with observation
> window.
>
> By doing this, seemingly trivial mistakes could be caught, e.g. false
> matching of points, windows, or marks by ignoring coordinate reference
> systems, or doing Euclidian distances from long/lat coordinates. Seeing
> this as a benefit of course assumes that (the spatstat) code developers
> *want* to catch such errors.
>
> It would be good to also hear some response from spatstat users whether
> a tighter integration between spatstat and sp would be appreciated, or not.
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From lily_franknich at yahoo.com  Wed Jul 25 05:11:04 2012
From: lily_franknich at yahoo.com (Lilis Husna)
Date: Wed, 25 Jul 2012 11:11:04 +0800
Subject: [R-sig-Geo]  gwr.morantest in spgwr package.
In-Reply-To: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>
References: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>
Message-ID: <1343185864.87721.YahooMailNeo@web190305.mail.sg3.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120725/70c46af0/attachment.pl>

From zbynek.janoska at centrum.cz  Wed Jul 25 09:22:00 2012
From: zbynek.janoska at centrum.cz (zbynek.janoska at centrum.cz)
Date: Wed, 25 Jul 2012 00:22:00 -0700 (PDT)
Subject: [R-sig-Geo] problem extracting Z value from line shapefile
Message-ID: <1343200920869-7580600.post@n2.nabble.com>

Hello,

I have following problem:
I wish to extract z coordinates from a polyline shapefile. Using readOGR() i
get following:

> data <- readOGR(path,'tesikov')
OGR data source with driver: ESRI Shapefile 
Source: "C:/Users/Janoska/Documents/GPS", layer: "tesikov"
with 1 features and 1 fields
Feature type: wkbLineString with 3 dimensions
Warning message:
In readOGR("C:/Users/Janoska/Documents/GPS", "tesikov") :
  Z-dimension discarded

Clearly, Z dimension is stored in the data, but readOGR does not read it.
Hence, I followed this post:
https://stat.ethz.ch/pipermail/r-sig-geo/2007-March/001847.html

data <- coordinates(readShapeLines('path/tesikov.shp'))
> str(data)
List of 1
 $ :List of 1
  ..$ : num [1:335, 1:2] -540376 -540369 -540361 -540353 -540344 ...

Resulting coordinates have only two dimensions.

I am wondering, whether Z dimension can be extracted only from points?

Any suggestion would be appreciated.

Thanks,
Zbynek



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-extracting-Z-value-from-line-shapefile-tp7580600.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Wed Jul 25 11:13:18 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 25 Jul 2012 10:13:18 +0100
Subject: [R-sig-Geo] problem extracting Z value from line shapefile
In-Reply-To: <1167304f725549918fe64e1626251125@EX-0-HT0.lancs.local>
References: <1167304f725549918fe64e1626251125@EX-0-HT0.lancs.local>
Message-ID: <CANVKczPWkcxeoEj8=N_Ky_vXLSji7R0h3UbvGFzM7A5a9L76ZA@mail.gmail.com>

On Wed, Jul 25, 2012 at 8:22 AM, zbynek.janoska at centrum.cz
<zbynek.janoska at centrum.cz> wrote:

> Warning message:
> In readOGR("C:/Users/Janoska/Documents/GPS", "tesikov") :
>   Z-dimension discarded
>
> Clearly, Z dimension is stored in the data, but readOGR does not read it.
> Hence, I followed this post:
> https://stat.ethz.ch/pipermail/r-sig-geo/2007-March/001847.html
>
> data <- coordinates(readShapeLines('path/tesikov.shp'))
>> str(data)
> List of 1
>  $ :List of 1
>   ..$ : num [1:335, 1:2] -540376 -540369 -540361 -540353 -540344 ...
>
> Resulting coordinates have only two dimensions.
>
> I am wondering, whether Z dimension can be extracted only from points?

 It looks that way. SpatialPoints can have more than two coordinates:

 > SpatialPoints(cbind(1:10,1:10,1:10))
SpatialPoints:
      coords.x1 coords.x2 coords.x3
 [1,]         1         1         1
 [2,]         2         2         2

But Line objects cant:

 > Line(cbind(1:10,1:10))
An object of class "Line"
Slot "coords":
      [,1] [,2]
 [1,]    1    1
 [2,]    2    2
 [3,]    3    3

> Line(cbind(1:10,1:10,1:10))
Error in Line(cbind(1:10, 1:10, 1:10)) :
  coords must be a two-column matrix

 - so its not possible to store a third dimension in a
SpatialLinesDataFrame that way.

 You can do horrible things to Line objects once they've been created,
and add extra columns, but there's some validation code you'd be
bypassing, and all sorts of bad things could happen if code assumes
Line objects have two columns and you go sticking your extra column in
there.

 What you could do is...

 * convert to GML ( ogr2ogr -f "GML" rivers3.gml rivers3.shp - will do
this on the linux command line, Windows versions may vary), then:
 * read the GML in using an XML-reading package for R. The Z
coordinates are then right there in a space and comma-separated
string.

OR

 * dump the shapefile using "ogrinfo -al -geom=YES rivers3.shp" and
parse out the x,y,z coords from the LINESTRINGs

 You've then got the issue of how to store them and how to work with
them. The safest way might be as an extra attribute on each Line
element rather than an extra column.

 This probably needs a lot more thought, but these 3d shapefiles are
usually quite rare in the wild so they don't get a lot of attention.
Unlike rare wildlife...

Barry


From agus.camacho at gmail.com  Wed Jul 25 15:36:11 2012
From: agus.camacho at gmail.com (Agus Camacho)
Date: Wed, 25 Jul 2012 10:36:11 -0300
Subject: [R-sig-Geo] how to hange the size of raster maps
Message-ID: <CALsJ7pTMvEyjJnmker0gKj3G2J1iv0q4245=p3tHGoRxLT0kFg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120725/e94eb7ce/attachment.pl>

From adamhsparks at gmail.com  Wed Jul 25 16:34:43 2012
From: adamhsparks at gmail.com (Adam Sparks)
Date: Wed, 25 Jul 2012 09:34:43 -0500
Subject: [R-sig-Geo] how to hange the size of raster maps
In-Reply-To: <CALsJ7pTMvEyjJnmker0gKj3G2J1iv0q4245=p3tHGoRxLT0kFg@mail.gmail.com>
References: <CALsJ7pTMvEyjJnmker0gKj3G2J1iv0q4245=p3tHGoRxLT0kFg@mail.gmail.com>
Message-ID: <CAJmQPwGjN_cH2z635TVwZcAT-meRLdWgyRxKVAN+bSKre8u7hA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120725/02e254f3/attachment.pl>

From mathieu.rajerison at gmail.com  Wed Jul 25 17:21:22 2012
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Wed, 25 Jul 2012 17:21:22 +0200
Subject: [R-sig-Geo] Google Mercator EPSG:900913,
	in which init file to add it?
Message-ID: <CAGfc75mvjLVe1MOsMP_VKT-b-W3phviEcms+0jueNkRJffW=qQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120725/0f24580f/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Jul 25 17:37:46 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 25 Jul 2012 16:37:46 +0100
Subject: [R-sig-Geo] Google Mercator EPSG:900913,
 in which init file to add it?
In-Reply-To: <f87df4aae64a4d16821c2d2431523024@EX-1-HT0.lancs.local>
References: <f87df4aae64a4d16821c2d2431523024@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOduXW_frWD=Z_7UG_0mYdO33=-1Nt87u957m8B91w4Zw@mail.gmail.com>

On Wed, Jul 25, 2012 at 4:21 PM, Mathieu Rajerison
<mathieu.rajerison at gmail.com> wrote:
> Hi,
>
> I'm using Google Mercator (EPSG:900913) for one purpose but it doesn't seem
> recognized by rgdal..
>
> Where to add it please?

 900913 was a 'cute' number used unofficially because it looks like
'google'. Eventually after a couple of false starts it has got an
official EPSG code which is nowhere near 900913. Some discussion here:

http://gis.stackexchange.com/questions/253/what-is-the-current-web-mercator-projection-code

So you should use epsg:3857 from now on. I guess 900913 has been
removed from the epsg database that rgdal uses. Not sure how you add
it back, but if you reassign the proj4code of anything with 900913 to
3857 then they should all work the same. Note I'm saying 3857 several
times in the email so I remember that it's now 3857...

Barry


From janverbesselt at gmail.com  Wed Jul 25 18:40:52 2012
From: janverbesselt at gmail.com (Jan Verbesselt)
Date: Wed, 25 Jul 2012 18:40:52 +0200
Subject: [R-sig-Geo] How can I plot a shapefile with geom_map from
	ggplot2
In-Reply-To: <CANVKczP3h0qbKWT=+pc4xSShLKj33ogYZ4ps1qN7gK-wEme0gA@mail.gmail.com>
References: <2151153d80c2477f89250577892dd5a3@EX-0-HT0.lancs.local>
	<CANVKczP3h0qbKWT=+pc4xSShLKj33ogYZ4ps1qN7gK-wEme0gA@mail.gmail.com>
Message-ID: <CAHKDjo753=BUJFzbL9ACni4tjXFyOw+nj5AGFjJuqW8B-K7duA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120725/3af02c8f/attachment.pl>

From timbean at gmail.com  Wed Jul 25 22:11:20 2012
From: timbean at gmail.com (Tim)
Date: Wed, 25 Jul 2012 13:11:20 -0700 (PDT)
Subject: [R-sig-Geo] Donut holes
Message-ID: <1343247080965-7580607.post@n2.nabble.com>

Can somebody suggest a method for subtracting one SpatialPolygon* object from
another, so that I'm left with a polygon with a donut hole? I can't seem to
find one. Thanks.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Donut-holes-tp7580607.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From simon.ohanlon at imperial.ac.uk  Wed Jul 25 22:24:53 2012
From: simon.ohanlon at imperial.ac.uk (O'Hanlon, Simon J)
Date: Wed, 25 Jul 2012 20:24:53 +0000
Subject: [R-sig-Geo] Donut holes
In-Reply-To: <1343247080965-7580607.post@n2.nabble.com>
References: <1343247080965-7580607.post@n2.nabble.com>
Message-ID: <7AE0828DCFFC0144817331B53EDC11A01889FDB6@icexch-m5.ic.ac.uk>

rgeos::gDifference should do what you are after.

HTH,

Simon

--------------------------------
Simon O'Hanlon, BSc MSc
Department of Infectious Disease Epidemiology
Imperial College London
St. Mary's Hospital
London
W2 1PG
________________________________________
From: r-sig-geo-bounces at r-project.org [r-sig-geo-bounces at r-project.org] on behalf of Tim [timbean at gmail.com]
Sent: 25 July 2012 21:11
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Donut holes

Can somebody suggest a method for subtracting one SpatialPolygon* object from
another, so that I'm left with a polygon with a donut hole? I can't seem to
find one. Thanks.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Donut-holes-tp7580607.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Wed Jul 25 22:37:45 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 25 Jul 2012 22:37:45 +0200
Subject: [R-sig-Geo] gwr.morantest in spgwr package.
In-Reply-To: <1343185864.87721.YahooMailNeo@web190305.mail.sg3.yahoo.com>
References: <1342431335.67972.YahooMailNeo@web190301.mail.sg3.yahoo.com>
	<1343185864.87721.YahooMailNeo@web190305.mail.sg3.yahoo.com>
Message-ID: <alpine.LRH.2.02.1207252237090.31612@reclus.nhh.no>

On Wed, 25 Jul 2012, Lilis Husna wrote:

>
>
> I want to ask about gwr.morantest in spgwr package.
>
> What is the purpose of doing this test?
>
> Which variabel is tested? residual from global model (OLS), residual 
> from local model (GWR), or the dependent variabel (same as testing 
> spatial autocorrelation)?

The residual from the local model (GWR).

Roger

>
> Best Regards,
> Lilis Nurul Husna
> Institute of Statistics?r
>
> Jakarta
> 	[[alternative HTML version deleted]]
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gmarzioz at gmail.com  Thu Jul 26 04:55:05 2012
From: gmarzioz at gmail.com (Giuseppe Marzio Zermo)
Date: Thu, 26 Jul 2012 04:55:05 +0200
Subject: [R-sig-Geo] Legend unit for raster layer and create a color map
	exported to	tiff
Message-ID: <1343271305.4862.8.camel@Nokia-N900>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120726/b4c38524/attachment.pl>

From calamita_giuseppe at yahoo.it  Thu Jul 26 10:33:46 2012
From: calamita_giuseppe at yahoo.it (Giuseppe Calamita)
Date: Thu, 26 Jul 2012 01:33:46 -0700 (PDT)
Subject: [R-sig-Geo] problem on krige in gstat package
In-Reply-To: <CAN9LD-0O11pwCJTRP0w6w98fVojTTDN79ZQ3+ebYY+tGvCkT7Q@mail.gmail.com>
References: <CAN9LD-0O11pwCJTRP0w6w98fVojTTDN79ZQ3+ebYY+tGvCkT7Q@mail.gmail.com>
Message-ID: <1343291625992-7580612.post@n2.nabble.com>


zhijie zhang wrote
> 
> .....
> #-----My problems are as follows.------#
> #Method1-Error
> # perform ordinary kriging prediction-errors?
> v <- variogram(g)
> 
Who is 'g'?? you forget to show us how you defined-created the g object.





-----
Giusepep Calamita
PhD italian National Council of Research - Institute of Methodologies for Environmental Research CNR - IMAA
85050 Tito Scalo - Potenza - Italy 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-on-krige-in-gstat-package-tp7580487p7580612.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From robbymarrotte at gmail.com  Thu Jul 26 17:01:19 2012
From: robbymarrotte at gmail.com (Robby Marrotte)
Date: Thu, 26 Jul 2012 11:01:19 -0400
Subject: [R-sig-Geo] Location polygon from triangulation data
In-Reply-To: <CANtt_hzNvotVn2XOiLRUrm1+RtwyGK24Yzy4g1gk5bH5nfOaDA@mail.gmail.com>
References: <a81c8fd1463f4911a30c403f0fd2d892@EX-1-HT0.lancs.local>
	<CANVKczOcrDWh2xHUvnc2yj4QkkKi-k0L7oES9=7uhFsEtL2=qw@mail.gmail.com>
	<CANtt_hzNvotVn2XOiLRUrm1+RtwyGK24Yzy4g1gk5bH5nfOaDA@mail.gmail.com>
Message-ID: <CABd5c45=7VoUwNGDNV1RK+FFyPwMcYR5XES8N7v4XUT6JKHUMA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120726/d908c229/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Thu Jul 26 17:44:46 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 26 Jul 2012 16:44:46 +0100
Subject: [R-sig-Geo] Location polygon from triangulation data
In-Reply-To: <413cac9c42cc478a94987b7fc15043c8@EX-1-HT0.lancs.local>
References: <a81c8fd1463f4911a30c403f0fd2d892@EX-1-HT0.lancs.local>
	<CANVKczOcrDWh2xHUvnc2yj4QkkKi-k0L7oES9=7uhFsEtL2=qw@mail.gmail.com>
	<CANtt_hzNvotVn2XOiLRUrm1+RtwyGK24Yzy4g1gk5bH5nfOaDA@mail.gmail.com>
	<413cac9c42cc478a94987b7fc15043c8@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNv5ey_-q104Qu4wOxs188F2X0rui_=BVXOtDyS7TqOyA@mail.gmail.com>

On Thu, Jul 26, 2012 at 4:01 PM, Robby Marrotte <robbymarrotte at gmail.com> wrote:
> Thanks, i might try looking at the R packages and if I get frustrated I'll
> check out the book.

 I had another good look for R packages, and found nothing. But I hate
not finding things, and dug up some Fortran code from somewhere. I'm
not totally sure of the license, since it dates back to 1990-something
when people routinely didn't bother with licenses! :)

 I'm wrapping it into an R package right now. Need to get some
permission first though...

 There's a plugin for QuantumGIS that can do this too.

Barry


From stavanastrutz at gmail.com  Thu Jul 26 19:03:24 2012
From: stavanastrutz at gmail.com (Stavana)
Date: Thu, 26 Jul 2012 10:03:24 -0700 (PDT)
Subject: [R-sig-Geo] Raster Brick Iteration
Message-ID: <1343322204474-7580616.post@n2.nabble.com>

Hi listmembers,

I've constructed rasterbricks of the 19 bioclimatic variables (using the
biovars method) for each year in the United States from 1980-2011 and I'd
like to calculate that mean of each bioclim variable over a particular
temporal range. I need to loop through each layer of the rasterbrick for a
set of years and get the mean.

For example, I'd like to calculate the mean of bioclim1, then 2, then 3,
then 4, etc. for the years 1980-89 and store those averages in a new raster
brick or set of raster layers. I know there has to be a way to loop through
each layer of a raster brick or extract corresponding layers from different 
bricks but I'm having difficulty locating an example of how to do so.

I'm also curious as to the exact difference between a raster stack and a
raster brick, I've read the definition in Hijmans Raster package manual but
still do not understand the precise difference.

Any code help would be much appreciated as would suggestions of other web
resources or books on the subject. I generally work in ArcGIS but am trying
out R because it seems a bit faster in some of its raster processing
capabilities.

Thank you,
Stavana Strutz
University of Texas at Austin



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Raster-Brick-Iteration-tp7580616.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mauricio.zambrano at jrc.ec.europa.eu  Fri Jul 27 11:08:01 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Fri, 27 Jul 2012 11:08:01 +0200
Subject: [R-sig-Geo] testing for a valid raster format before reading
Message-ID: <50125A71.90109@jrc.ec.europa.eu>

Dear list,

Do you know if there is any way for testing if a file can be read by the 
'raster' command of the 'raster' package ?

something like:

  is.raster("myfile.asc") ....


I'm asking because I have to read many files within several directories. 
The filenames of the maps go from XXXXXXXX.001 up to XXXXXX99.999, with 
some additional files that should be skipped of the reading process 
(which extension varies from directory to directory, e.g., .csv, .txt, 
.zip, etc).


The error I'm getting now, which appears when trying to get information 
about the file with 'GDALinfo', is the following:


Error in .local(.Object, ...) :
   `lai.zip' not recognised as a supported file format.

1> traceback()
15: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, silent,
         PACKAGE = "rgdal")
14: .local(.Object, ...)
13: initialize(value, ...)
12: initialize(value, ...)
11: new("GDALReadOnlyDataset", filename, silent = silent)
10: GDAL.open(fname, silent = silent)
9: GDALinfo(maps.list[i])


Thanks in advance for any help,

Kinds,

Mauricio Zambrano-Bigiarini

-- 
====================================================
Water Resources Unit
Institute for Environment and Sustainability (IES)
Joint Research Centre (JRC), European Commission
webinfo    : http://floods.jrc.ec.europa.eu/
====================================================
DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:10}}


From b.rowlingson at lancaster.ac.uk  Fri Jul 27 11:35:33 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 27 Jul 2012 10:35:33 +0100
Subject: [R-sig-Geo] testing for a valid raster format before reading
In-Reply-To: <8785e4f231104a8cae362a2a0fe57560@EX-1-HT0.lancs.local>
References: <8785e4f231104a8cae362a2a0fe57560@EX-1-HT0.lancs.local>
Message-ID: <CANVKczMfKOU1=zk5VihNnGFReAbTtDC=TC-O2BBDBhcWDoh_Tg@mail.gmail.com>

On Fri, Jul 27, 2012 at 10:08 AM, Mauricio Zambrano-Bigiarini
<mauricio.zambrano at jrc.ec.europa.eu> wrote:
> Dear list,
>
> Do you know if there is any way for testing if a file can be read by the
> 'raster' command of the 'raster' package ?
>
> something like:
>
>   is.raster("myfile.asc") ....
>
>
> I'm asking because I have to read many files within several directories.
> The filenames of the maps go from XXXXXXXX.001 up to XXXXXX99.999, with
> some additional files that should be skipped of the reading process
> (which extension varies from directory to directory, e.g., .csv, .txt,
> .zip, etc).
>
>
> The error I'm getting now, which appears when trying to get information
> about the file with 'GDALinfo', is the following:
>
>
> Error in .local(.Object, ...) :
>    `lai.zip' not recognised as a supported file format.
>
> 1> traceback()
> 15: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, silent,
>          PACKAGE = "rgdal")
> 14: .local(.Object, ...)
> 13: initialize(value, ...)
> 12: initialize(value, ...)
> 11: new("GDALReadOnlyDataset", filename, silent = silent)
> 10: GDAL.open(fname, silent = silent)
> 9: GDALinfo(maps.list[i])
>
>
> Thanks in advance for any help,

 You can use 'try' to run code and catch errors. See help(try) for more:

for(f in files){
 r = try(raster(f))
 if(inherits(r, "try-error")){
      warning("couldnt read ",f)
   }else{
      print(summary(r))
  }
 }


From guynice111 at yahoo.com  Fri Jul 27 11:44:18 2012
From: guynice111 at yahoo.com (Nice Guy)
Date: Fri, 27 Jul 2012 02:44:18 -0700 (PDT)
Subject: [R-sig-Geo] R SpatialEpi  Package
Message-ID: <1343382258.65147.YahooMailNeo@web114305.mail.gq1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120727/c2f6da37/attachment.pl>

From mauricio.zambrano at jrc.ec.europa.eu  Fri Jul 27 13:45:13 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Fri, 27 Jul 2012 13:45:13 +0200
Subject: [R-sig-Geo] testing for a valid raster format before reading
In-Reply-To: <CANVKczMfKOU1=zk5VihNnGFReAbTtDC=TC-O2BBDBhcWDoh_Tg@mail.gmail.com>
References: <8785e4f231104a8cae362a2a0fe57560@EX-1-HT0.lancs.local>
	<CANVKczMfKOU1=zk5VihNnGFReAbTtDC=TC-O2BBDBhcWDoh_Tg@mail.gmail.com>
Message-ID: <50127F49.9080607@jrc.ec.europa.eu>

On 27/07/12 11:35, Barry Rowlingson wrote:
> On Fri, Jul 27, 2012 at 10:08 AM, Mauricio Zambrano-Bigiarini
> <mauricio.zambrano at jrc.ec.europa.eu>  wrote:
>> Dear list,
>>
>> Do you know if there is any way for testing if a file can be read by the
>> 'raster' command of the 'raster' package ?
>>
>> something like:
>>
>>    is.raster("myfile.asc") ....
>>
>>
>> I'm asking because I have to read many files within several directories.
>> The filenames of the maps go from XXXXXXXX.001 up to XXXXXX99.999, with
>> some additional files that should be skipped of the reading process
>> (which extension varies from directory to directory, e.g., .csv, .txt,
>> .zip, etc).
>>
>>
>> The error I'm getting now, which appears when trying to get information
>> about the file with 'GDALinfo', is the following:
>>
>>
>> Error in .local(.Object, ...) :
>>     `lai.zip' not recognised as a supported file format.
>>
>> 1>  traceback()
>> 15: .Call("RGDAL_OpenDataset", as.character(filename), TRUE, silent,
>>           PACKAGE = "rgdal")
>> 14: .local(.Object, ...)
>> 13: initialize(value, ...)
>> 12: initialize(value, ...)
>> 11: new("GDALReadOnlyDataset", filename, silent = silent)
>> 10: GDAL.open(fname, silent = silent)
>> 9: GDALinfo(maps.list[i])
>>
>>
>> Thanks in advance for any help,
>
>   You can use 'try' to run code and catch errors. See help(try) for more:
>
> for(f in files){
>   r = try(raster(f))
>   if(inherits(r, "try-error")){
>        warning("couldnt read ",f)
>     }else{
>        print(summary(r))
>    }
>   }
>

Thanks Barry for your feedback.

Adding the 'silent' argument to 'try' produced the behaviour I wanted:

for(f in files){
   r = try(raster(f), silent=TRUE)
   if(inherits(r, "try-error")){
        warning("couldnt read ",f)
     }else{
        print(summary(r))
    }
   }
      Length       Class        Mode
       66548 RasterLayer          S4
Warning messages:
1: In eval(expr, envir, enclos) : couldnt read LHOAT-AGNPS2012.txt
2: In eval(expr, envir, enclos) : couldnt read SPSO.zip



All the best,

Mauricio
-- 
====================================================
Water Resources Unit
Institute for Environment and Sustainability (IES)
Joint Research Centre (JRC), European Commission
webinfo    : http://floods.jrc.ec.europa.eu/
====================================================
DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:10}}


From riaarinda at gmail.com  Fri Jul 27 16:08:25 2012
From: riaarinda at gmail.com (ria arinda)
Date: Fri, 27 Jul 2012 07:08:25 -0700 (PDT)
Subject: [R-sig-Geo] Why do I get different P value of LISA from R and GeoDa
	?
Message-ID: <1343398105400-7580621.post@n2.nabble.com>

I wonder why localmoran[,5] or P value which I get from R
localmoran(variableX, weight.nb, alternative='two.sided') is different with
GeoDa's (LISA_P). I have used alternative 'two.sided', 'greater', and 'less'
but the they're still different. Both LISA indices from R and GeoDa are
already equal. What should I do to get similar p value from R localmoran and
GeoDa localmoran?
Thanks



-----
Ria Arinda
Jakarta Institute of Statistics, Indonesia
Tel:  +62 856 1675312
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Why-do-I-get-different-P-value-of-LISA-from-R-and-GeoDa-tp7580621.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Fri Jul 27 16:20:11 2012
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 27 Jul 2012 16:20:11 +0200 (CEST)
Subject: [R-sig-Geo] Why do I get different P value of LISA from R and
 GeoDa	?
In-Reply-To: <1343398105400-7580621.post@n2.nabble.com>
References: <1343398105400-7580621.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.02.1207271613400.7527@reclus.nhh.no>

On Fri, 27 Jul 2012, ria arinda wrote:

> I wonder why localmoran[,5] or P value which I get from R 
> localmoran(variableX, weight.nb, alternative='two.sided') is different 
> with GeoDa's (LISA_P). I have used alternative 'two.sided', 'greater', 
> and 'less' but the they're still different. Both LISA indices from R and 
> GeoDa are already equal. What should I do to get similar p value from R 
> localmoran and GeoDa localmoran? Thanks

If I remember correctly, GeoDa uses a permutation test (with random 
numbers), running only 99 permutations, while localmoran() in spdep uses 
the analytical expectations and variances. Repeated permutation tests 
and/or increasing the number of permutations should lead to similar 
results as the analytical formulae, possibly unless the data do not meet 
the distributional assumptions of the formulae.

Try rather to use localmoran.sad() for a Saddlepoint approximation.

Hope this clarifies,

Roger

>
>
>
> -----
> Ria Arinda
> Jakarta Institute of Statistics, Indonesia
> Tel:  +62 856 1675312
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Why-do-I-get-different-P-value-of-LISA-from-R-and-GeoDa-tp7580621.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From roman.lustrik at gmail.com  Fri Jul 27 18:27:36 2012
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Fri, 27 Jul 2012 18:27:36 +0200
Subject: [R-sig-Geo] R SpatialEpi Package
In-Reply-To: <1343382258.65147.YahooMailNeo@web114305.mail.gq1.yahoo.com>
References: <1343382258.65147.YahooMailNeo@web114305.mail.gq1.yahoo.com>
Message-ID: <CAHT1vpif6Ej9SJzKc3W3xQ0F-krfjNRERL+dagfj7Vvi=7OnSw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120727/471ca49f/attachment.pl>

From martin.ivanov at ifg.uni-tuebingen.de  Sat Jul 28 13:48:04 2012
From: martin.ivanov at ifg.uni-tuebingen.de (Martin Ivanov)
Date: Sat, 28 Jul 2012 13:48:04 +0200
Subject: [R-sig-Geo] contour plots with lattice
Message-ID: <5013D174.8060309@ifg.uni-tuebingen.de>

Dear R users,

I need to overlay the plot of one spatial variable with the contours of 
another spatial variable. And I want to do this with lattice.
Here is an example with the meuse.grid data set that comes with the R 
package sp.
First of all, in the classical function "contour" labels are drawn so 
that each contour line is broken at the place of the label,
so that the label does not overlap the line; besides care is taken that 
the labels look good as labels are plotted only for
those closed contours that are large enough for the label - if the 
closed contour is too small, no label is drawn:

library(sp);
library(lattice);
library(latticeExtra);
library(gridBase);
data(meuse.grid);
coordinates(meuse.grid) <- c("x", "y");
pixDF <- as(meuse.grid, "SpatialPixelsDataFrame")["dist"];
zlevs.conts <- zlevs.fill <- seq(0, 1, 0.1);
Z <- matrix(NA, nrow = pixDF at grid@cells.dim[1], ncol = 
pixDF at grid@cells.dim[2]); # convert the SpatialPixelsDataFrame to a matrix
Z[pixDF at grid.index] <- pixDF at data$dist;
Z <- Z[, ncol(Z):1];
contour(Z, levels=zlevs.conts);

In the trellis contourplot the labels are placed beside or over the 
line, controlled by the label.style parameter:
levelplot(Z, contour=TRUE, labels=TRUE, at=zlevs.conts, region=FALSE);
Labels are drawn at every single contour, even at the closed ones that 
are too small and the map looks nasty.

I do not like this and I could not find an option that would place the 
labels just as in the classical contour: breaking the contour line to 
make place for
the label, and with a smart consideration where to place a label and 
where not. I made several posting in the R and r-sig-geo forum on this 
issue,
and I was lucky to receive generous help from Dr. Tim Appelhans from the 
r-sig-geo forum. He wrote a function for me that combines the 
traditional R contour with grid graphics. With his permission am posting 
his function here:

panel.filledcontour <- function(x, y, z, subscripts, at, fill.cont = T,
                                 col.regions,
                                 contours = T,
                                 col = col.regions(length(zlevs.fill)),
                                 ...)
{
   stopifnot(require("gridBase"))
   z <- matrix(z[subscripts],
               nrow = length(unique(x[subscripts])),
               ncol = length(unique(y[subscripts])))
   if (!is.double(z)) storage.mode(z) <- "double"
   opar <- par(no.readonly = TRUE)
   on.exit(par(opar))
   if (panel.number() > 1) par(new = TRUE)
   par(fig = gridFIG(), omi = c(0, 0, 0, 0), mai = c(0, 0, 0, 0))
   cpl <- current.panel.limits()
   plot.window(xlim = cpl$xlim, ylim = cpl$ylim,
               log = "", xaxs = "i", yaxs = "i")
   # paint the color contour regions
   if (isTRUE(fill.cont))
     .Internal(filledcontour(as.double(do.breaks(cpl$xlim,
                                                 nrow(z) - 1)),
                             as.double(do.breaks(cpl$ylim,
                                                 ncol(z) - 1)),
                             z, levels = as.double(zlevs.fill),
                             col = col))
   else NULL

   #add contour lines
   if (isTRUE(contours))
     contour(as.double(do.breaks(cpl$xlim, nrow(z) - 1)),
             as.double(do.breaks(cpl$ylim, ncol(z) - 1)),
             z, levels = as.double(zlevs.conts),
             add=T, col = "grey10", # color of the lines
             drawlabels = T, ...
              # add labels or not
     )
   else NULL

}

Practically this function solves my problem:

plot1 <- spplot(pixDF, at=zlevs.conts);
plot2 <- levelplot(Z, panel = function(fill.cont, contours, ...) {
           panel.filledcontour(fill.cont = F, contours = T, ...) }, 
col.regions = colorRampPalette(c("snow", "lightblue")),
           plot.args = list(newpage = FALSE))

plot.new();print( plot1 + as.layer(plot2));

My data are all spatial, so they are available as spatial objects. 
However, spplot does not seem to be able to overlay
a plot with a contourplot of another spatial variable, it can only 
overlay spatial points, spatial lines, spatial polygons and text (at least
according to the spplot documentation: see the sp.layout argument). That 
is why one has to use levelplot for the second field. But levelplot
does not recognise spatial objects, so one has to convert the spatial 
object to a matrix. So far so good. But if spplot is given xlim and ylim
arguments:

bbx <- bbox(pixDF);
xlim <- c(.999*bbx[1, 1], 1.001*bbx[1, 2]);
ylim <- c(.999*bbx[2, 1], 1.001*bbx[2, 2]);
plot11 <- spplot(pixDF, at=zlevs.conts, xlim=xlim, ylim=ylim);

plot2 <- levelplot(Z, panel = function(fill.cont, contours, ...) {
           panel.filledcontour(fill.cont = F, contours = T, ...) }, 
col.regions = colorRampPalette(c("snow", "lightblue")),
           plot.args = list(newpage = FALSE))

plot.new();print(plot11 + as.layer(plot2))


things go wrong: the second field is plotted in the old scales of 
course, while spplot plots the first field according to the
newly given scales. This can only be solved by converting the matrix of 
the second field appropriately so that it matches the
new scales of the first field. So my problem is in principle over, but 
nevertheless I have 3 questions:

1. Is there a simpler way to achieve the final result I need with 
trellis/grid graphics? Or possibly some not necessarily simpler way, but 
a way
not relying on traditional R graphics, as so long as I know combinig 
traditional and grid graphics does have drawbacks.
2. Is it possible to get the final result with one or two calls to 
spplot, that is, working
only with spatial objects, without having to transform one of the 
objects to a matrix?
3. How can I see the code of spplot? I tried spplot, sp::spplot, 
sp:::spplot, but neither of the commands returned the code.

I am looking forward to Your comments. Any suggestions will be appreciated.
I would again like to thank Dr. Appelhans for his generous help.


Best regards,

-- 
Dr. Martin Ivanov
Eberhard-Karls-Universit?t T?bingen
Mathematisch-Naturwissenschaftliche Fakult?t
Fachbereich Geowissenschaften
Water & Earth System Science (WESS)
Keplerstra?e 17, 72074 T?bingen, Deutschland
Tel. +4970712975023


From martin.ivanov at ifg.uni-tuebingen.de  Sat Jul 28 13:50:06 2012
From: martin.ivanov at ifg.uni-tuebingen.de (Martin Ivanov)
Date: Sat, 28 Jul 2012 13:50:06 +0200
Subject: [R-sig-Geo] a question on lattice contourplots
Message-ID: <5013D1EE.2080409@ifg.uni-tuebingen.de>

Dear R users,

I am still new to lattice but I am motivated to get to grips with it.
Is it possible to produce the following "traditional R" filled.contour 
graph with some equivalent trellis function?

library(lattice);
heights <- c(90, 100, 120, 140, 160, 180, 195);
data(volcano);
filled.contour(volcano, levels=heights, col=terrain.colors(6))

All my attempts to achieve that with the trellis levelplot were futile, 
e.g.:
levelplot(volcano, at=heights, col.regions=terrain.colors(6));

The difference actually is in the interpolation: the filled.contour 
regions are smooth, while those of levelplot are pixelled.
I tried to see what interpolation filled.contour actually does, but I 
could not see the code of filled.contour:
the  actual function is called from the internal R code 
(.Internal(filledcontour, ...)), which I do not know how to see.
How could I look into the code of the internal R filledcontour?
I know that levelplot is the lattice equivalent of image, but does 
filled.contour also have a lattice eqivalent?

As an alternative, is it possible to fill the regions between the 
contour lines in the following plot:
levelplot(volcano, at=heights, col.regions=terrain.colors(6), 
contour=TRUE, region=FALSE)
without plotting the contourlines themselves?

Thank You very much for Your attention. Any suggestions will be appreciated.

Best regards,
Martin


-- 
Dr. Martin Ivanov
Eberhard-Karls-Universit?t T?bingen
Mathematisch-Naturwissenschaftliche Fakult?t
Fachbereich Geowissenschaften
Water & Earth System Science (WESS)
Keplerstra?e 17, 72074 T?bingen, Deutschland
Tel. +4970712975023


From tim.appelhans at gmail.com  Sat Jul 28 20:04:41 2012
From: tim.appelhans at gmail.com (Tim Appelhans)
Date: Sat, 28 Jul 2012 20:04:41 +0200
Subject: [R-sig-Geo] a question on lattice contourplots
In-Reply-To: <5013D1EE.2080409@ifg.uni-tuebingen.de>
References: <5013D1EE.2080409@ifg.uni-tuebingen.de>
Message-ID: <501429B9.9030501@gmail.com>

Hey Martin,
again me. You can achieve this with the panel.filledcontour() function 
that I sent you. You just need to set the fill.cont to TRUE.
If you are looking for a built in lattice equivalent for 
filled.contour() I think you are out of luck. Though I suggest ,to be 
sure you ask Deepayan Sarkar directly. In the end he's the author of the 
lattice package.
Alternatively you could ask Paul Murrell as he's the author of the grid 
package. I am sure he will be able to answer your question and give you 
all the background on why it may or may not be possible.

Cheers
Tim


On 28/7/2012 13:50, Martin Ivanov wrote:
> Dear R users,
>
> I am still new to lattice but I am motivated to get to grips with it.
> Is it possible to produce the following "traditional R" filled.contour 
> graph with some equivalent trellis function?
>
> library(lattice);
> heights <- c(90, 100, 120, 140, 160, 180, 195);
> data(volcano);
> filled.contour(volcano, levels=heights, col=terrain.colors(6))
>
> All my attempts to achieve that with the trellis levelplot were 
> futile, e.g.:
> levelplot(volcano, at=heights, col.regions=terrain.colors(6));
>
> The difference actually is in the interpolation: the filled.contour 
> regions are smooth, while those of levelplot are pixelled.
> I tried to see what interpolation filled.contour actually does, but I 
> could not see the code of filled.contour:
> the  actual function is called from the internal R code 
> (.Internal(filledcontour, ...)), which I do not know how to see.
> How could I look into the code of the internal R filledcontour?
> I know that levelplot is the lattice equivalent of image, but does 
> filled.contour also have a lattice eqivalent?
>
> As an alternative, is it possible to fill the regions between the 
> contour lines in the following plot:
> levelplot(volcano, at=heights, col.regions=terrain.colors(6), 
> contour=TRUE, region=FALSE)
> without plotting the contourlines themselves?
>
> Thank You very much for Your attention. Any suggestions will be 
> appreciated.
>
> Best regards,
> Martin
>
>

-- 
#####################################
Tim Appelhans
Department of Geography
Environmental Informatics
Philipps Universit?t Marburg
Deutschhausstra?e 12
35032 Marburg (Paketpost: 35037 Marburg)
Germany

Tel +49 (0) 6421 28-25957


From juantomas.sayago at gmail.com  Sat Jul 28 20:19:02 2012
From: juantomas.sayago at gmail.com (Juan Tomas Sayago)
Date: Sat, 28 Jul 2012 14:19:02 -0400
Subject: [R-sig-Geo] I dont understand the projection well please help
Message-ID: <CAEOXpNB4EE7xi--Ucc1CLMVUSFz=7JDbzANbjhLkmbunXhoQVw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120728/2c63e565/attachment.pl>

From tom.gottfried at o2mail.de  Sun Jul 29 10:41:42 2012
From: tom.gottfried at o2mail.de (Tom Gottfried)
Date: Sun, 29 Jul 2012 10:41:42 +0200
Subject: [R-sig-Geo] I dont understand the projection well please help
In-Reply-To: <CAEOXpNB4EE7xi--Ucc1CLMVUSFz=7JDbzANbjhLkmbunXhoQVw@mail.gmail.com>
References: <CAEOXpNB4EE7xi--Ucc1CLMVUSFz=7JDbzANbjhLkmbunXhoQVw@mail.gmail.com>
Message-ID: <5014F746.3060301@o2mail.de>

Install package rgdal and

?spTransform

HTH,
Tom

Am 28.07.2012 20:19, schrieb Juan Tomas Sayago:
> I've got this projection
>
> +proj=tmerc +lat_0=4.680486111 +lon_0=-74.14659167000001 +k=1
> +x_0=92334.879 +y_0=109320.965 +a=6380687
>
> +b=6359293.764473119 +units=m +no_defs
> And want to know how to make other maps into this one but I am not sure,
> where can I read about this?
> Juan
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From tony333_6 at hotmail.com  Sun Jul 29 14:09:55 2012
From: tony333_6 at hotmail.com (tony333)
Date: Sun, 29 Jul 2012 05:09:55 -0700 (PDT)
Subject: [R-sig-Geo] PCA Regression
Message-ID: <1343563795164-7580630.post@n2.nabble.com>

I use PCA regression to make seasonal forecast for precipitation using PCA of
SST.
I have 30 month of SST monthly mean data.I use the whole data (30 month) to
produce PCA .The dimension of PCA is 30*1.
I use the first 15 scores of PCA to make multiple linear regression using
PCA  as predictors ,then I use the rest 15 scores of PCA to verified  the
prediction of the statistical model. this is correct  way to use PCA
regression ,or I have to produce PCA of only 15 month then use PCA in
multiple regression statistical model  , Then produce PCA for the rest
period  (15 month) to use to verified the prediction. 




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/PCA-Regression-tp7580630.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Bastien.Ferland-Raymond at mrnf.gouv.qc.ca  Mon Jul 30 14:11:08 2012
From: Bastien.Ferland-Raymond at mrnf.gouv.qc.ca (Bastien.Ferland-Raymond at mrnf.gouv.qc.ca)
Date: Mon, 30 Jul 2012 08:11:08 -0400
Subject: [R-sig-Geo] determining suitable lakes for landing
Message-ID: <161DC602615F6943A19BAEA3DBF2E4B901A5186694DB@HARFANG.intranet.mrn.gouv>

Dear R gurus,

I'm facing a challenge that I have a good feeling you could help me with.  So far I'm stuck right at the beginning so I don't have any example to show you.  Here is what I'm trying to do:

I have a polygon shape of lakes for which I have to be able to automatically determine if they are suitable (large enough) for a plane to land.  To be suitable, we must be able to fit a rectangle of dimension 50m x 1500m in the lake without it touching any lake contour.  Of course, the rectangle can be in any orientation in the lake, which makes the test a little harder.

I can easily eliminate all the small lakes by using the extent and Pythagorean.  For exemple:

    1500 > sqrt(sum((bbox(lake)[,2] - bbox(lake)[,1])^2))  # measure the diagonal of the bbox of the lake (mtm projection)

All those lake are definitely too small for a plane to land, however not all the lakes that are bigger than that will be large enough.

Anybody have an idea how to place the rectangle and discriminate those lakes?

Thanks for your help!

Bastien


Bastien Ferland-Raymond, M.Sc. Stat., M.Sc. Biol.
Division des orientations et projets sp?ciaux
Direction des inventaires forestiers
Minist?re des Ressources naturelles et de la Faune


From b.rowlingson at lancaster.ac.uk  Mon Jul 30 14:52:27 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 30 Jul 2012 13:52:27 +0100
Subject: [R-sig-Geo] determining suitable lakes for landing
In-Reply-To: <c895d980cb1b4057a2a105bcf14bcb26@EX-1-HT0.lancs.local>
References: <c895d980cb1b4057a2a105bcf14bcb26@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOcbBdG5MZPBCUycV8cCGYo0ZDedPpdDsKZL8wKtsv2Fg@mail.gmail.com>

On Mon, Jul 30, 2012 at 1:11 PM,
Bastien.Ferland-Raymond at mrnf.gouv.qc.ca
<Bastien.Ferland-Raymond at mrnf.gouv.qc.ca> wrote:
> Dear R gurus,
>
> I'm facing a challenge that I have a good feeling you could help me with.  So far I'm stuck right at the beginning so I don't have any example to show you.  Here is what I'm trying to do:
>
> I have a polygon shape of lakes for which I have to be able to automatically determine if they are suitable (large enough) for a plane to land.  To be suitable, we must be able to fit a rectangle of dimension 50m x 1500m in the lake without it touching any lake contour.  Of course, the rectangle can be in any orientation in the lake, which makes the test a little harder.
>
> I can easily eliminate all the small lakes by using the extent and Pythagorean.  For exemple:
>
>     1500 > sqrt(sum((bbox(lake)[,2] - bbox(lake)[,1])^2))  # measure the diagonal of the bbox of the lake (mtm projection)
>
> All those lake are definitely too small for a plane to land, however not all the lakes that are bigger than that will be large enough.
>
> Anybody have an idea how to place the rectangle and discriminate those lakes?
>
> Thanks for your help!

 Fun problem...

 It seems there are algorithms for finding the maximum area rectangle
[http://www.sciencedirect.com/science/article/pii/S0096300312003207]
but in your case the max area rectangle could be 49m x 10000m, and the
lake could have a 50mx1500m finger poking out of it. The max area
rectangle would then not be good enough to land in, but the lake would
actually be okay.

 But if the max area rectangle is > 50m x > 1500m then you've got one
you can land in, but its not a necessary condition....

 Some kind of heuristic approach of dropping 50mx1500m rectangles on
the lake area and testing might work - you'd have to randomise the
location and orientation and vary the randomness by how much the
rectangle overlaps, some kind of simulated annealing approach perhaps.
Again, its not guaranteed to work due to its heuristic approach -
eventually your simulated annealing has to stop and it might not have
found a solution... In the pathological case I mentioned above it
might have trouble...

 I think that if a polygon contains an NxM rectangle then that
rectangle can be shifted to touch two points of the polygon, so maybe
you can reduce the problem to rectangles that touch at two points -
that might help any heuristic algorithms...

 I wonder if everyone on R-sig-geo is now sliding bus tickets around
on pieces of paper like me...

Barry


From calamita_giuseppe at yahoo.it  Mon Jul 30 15:12:22 2012
From: calamita_giuseppe at yahoo.it (Giuseppe Calamita)
Date: Mon, 30 Jul 2012 06:12:22 -0700 (PDT)
Subject: [R-sig-Geo] a question on lattice contourplots
In-Reply-To: <5013D1EE.2080409@ifg.uni-tuebingen.de>
References: <5013D1EE.2080409@ifg.uni-tuebingen.de>
Message-ID: <1343653942907-7580633.post@n2.nabble.com>


Martin Ivanov wrote
> 
> ....
> As an alternative, is it possible to fill the regions between the 
> contour lines in the following plot:
> levelplot(volcano, at=heights, col.regions=terrain.colors(6), 
> contour=TRUE, region=FALSE)
> without plotting the contourlines themselves?
> ...
> 
well, regarding your last question , you just have to change the parameters
of levelplot() function: if you read them, they "speak" clearly ;) : if you
don0t want contourlines switch contour parameter to False, and if you want
your regions to be coloured switch the region parameter to T
try
levelplot(volcano, at=heights, col.regions=terrain.colors(6), contour=F,
region= T)

this should work,







-----
Giusepep Calamita
PhD italian National Council of Research - Institute of Methodologies for Environmental Research CNR - IMAA
85050 Tito Scalo - Potenza - Italy 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/a-question-on-lattice-contourplots-tp7580626p7580633.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From leonardo.monasterio at gmail.com  Mon Jul 30 16:37:10 2012
From: leonardo.monasterio at gmail.com (Leonardo Monasterio)
Date: Mon, 30 Jul 2012 11:37:10 -0300
Subject: [R-sig-Geo] How to select random (contiguous) shapes
Message-ID: <CAKvLVNLKzboZSwey-+NNgJaBHWCuWbKZNdJqrRfyityv9EJjSA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120730/3da27949/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Mon Jul 30 17:41:26 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 30 Jul 2012 16:41:26 +0100
Subject: [R-sig-Geo] determining suitable lakes for landing
In-Reply-To: <f86cfb335f2c43bab820f138db85b587@EX-1-HT0.lancs.local>
References: <c895d980cb1b4057a2a105bcf14bcb26@EX-1-HT0.lancs.local>
	<f86cfb335f2c43bab820f138db85b587@EX-1-HT0.lancs.local>
Message-ID: <CANVKczP0uE0aciuvygc1uFGD+UZEAwr-mYt-CNxKrb17A+dNNA@mail.gmail.com>

On Mon, Jul 30, 2012 at 1:52 PM, Rowlingson, Barry
<b.rowlingson at lancaster.ac.uk> wrote:

>> Anybody have an idea how to place the rectangle and discriminate those lakes?

To save pasting masses of code in here, I've put a random rectangle
tester in a gist:

https://gist.github.com/3207893

 that does a stupid brute-force approach of trying random NxM
rectangles at random angles all over the polygon until it finds one or
gives up. I reckon any polygon that doesn't get a solution after 5000
trials is probably so horrendous that no pilot would want to land
there anyway...

Barry


From Bastien.Ferland-Raymond at mrnf.gouv.qc.ca  Mon Jul 30 18:16:33 2012
From: Bastien.Ferland-Raymond at mrnf.gouv.qc.ca (Bastien.Ferland-Raymond at mrnf.gouv.qc.ca)
Date: Mon, 30 Jul 2012 12:16:33 -0400
Subject: [R-sig-Geo] RE :  determining suitable lakes for landing
In-Reply-To: <CANVKczP0uE0aciuvygc1uFGD+UZEAwr-mYt-CNxKrb17A+dNNA@mail.gmail.com>
Message-ID: <161DC602615F6943A19BAEA3DBF2E4B901A5186694E2@HARFANG.intranet.mrn.gouv>

Thanks Barry for your interest in my problem.  It is indeed an interesting problem at the same time as a complex one.

I've tried your code and it works for two lakes so far.  It's seems like a very good base for what I want to do.  I'll modify it a little to speed it up.  First by removing the very small lakes, than by changing the loop "for" by a "while" as I just need to find if I can fit or not a rectangle, I don't need the rectangle(s).

Here is a example of shape I'm going to apply it to:

https://www.dropbox.com/s/24eg0eetm0o6dth/lacs_amerrissables.zip

There is already a field telling if you could land of not ("AMERISS") that was found by some old ARCgis coding (ARCinfo and aml, not sure exactly how).  It was a consultant that did this code for us a couple of years ago, now we want to transfer to R, explaining why I have this problem now.  The code was also using iteration, however not random, on rasterized lakes.  I think it would be interesting to compare the result from the 2 techniques.

I'm going to try that this afternoon, and let you know the result.

Thanks again!

Bastien

-----Message d'origine-----
De : b.rowlingson at googlemail.com [mailto:b.rowlingson at googlemail.com] De la part de Barry Rowlingson
Envoy? : 30 juillet 2012 11:41
? : Ferland-Raymond, Bastien (DIF)
Cc : r-sig-geo at r-project.org
Objet : Re: [R-sig-Geo] determining suitable lakes for landing

On Mon, Jul 30, 2012 at 1:52 PM, Rowlingson, Barry
<b.rowlingson at lancaster.ac.uk> wrote:

>> Anybody have an idea how to place the rectangle and discriminate those lakes?

To save pasting masses of code in here, I've put a random rectangle
tester in a gist:

https://gist.github.com/3207893

 that does a stupid brute-force approach of trying random NxM
rectangles at random angles all over the polygon until it finds one or
gives up. I reckon any polygon that doesn't get a solution after 5000
trials is probably so horrendous that no pilot would want to land
there anyway...

Barry


From b.rowlingson at lancaster.ac.uk  Mon Jul 30 19:04:44 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 30 Jul 2012 18:04:44 +0100
Subject: [R-sig-Geo] RE :  determining suitable lakes for landing
In-Reply-To: <2380ef4c099e48958fbc2e59408a4e50@EX-1-HT0.lancs.local>
References: <CANVKczP0uE0aciuvygc1uFGD+UZEAwr-mYt-CNxKrb17A+dNNA@mail.gmail.com>
	<2380ef4c099e48958fbc2e59408a4e50@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPd=pAx9rmWbKB6AQG23jJ=D34w0m8pWbgP7AwYRa67Ng@mail.gmail.com>

On Mon, Jul 30, 2012 at 5:16 PM,
Bastien.Ferland-Raymond at mrnf.gouv.qc.ca
<Bastien.Ferland-Raymond at mrnf.gouv.qc.ca> wrote:
> Thanks Barry for your interest in my problem.  It is indeed an interesting problem at the same time as a complex one.
>
> I've tried your code and it works for two lakes so far.  It's seems like a very good base for what I want to do.  I'll modify it a little to speed it up.  First by removing the very small lakes, than by changing the loop "for" by a "while" as I just need to find if I can fit or not a rectangle, I don't need the rectangle(s).

 There's an option to my function that you can use to tell it to stop
if it finds it can fit a rectangle - if you pass all=FALSE it returns
as soon as it finds one, otherwise it returns NA.

 I'm not sure how my method will work if there are islands (I assume
you dont want islands in the middle of your landing strip!). It uses
rgeos:gContains for the test, so I think as long as the island is
properly coded as an island it wont consider rectangles with islands.
This needs testing.

> There is already a field telling if you could land of not ("AMERISS") that was found by some old ARCgis coding (ARCinfo and aml, not sure exactly how).  It was a consultant that did this code for us a couple of years ago, now we want to transfer to R, explaining why I have this problem now.  The code was also using iteration, however not random, on rasterized lakes.  I think it would be interesting to compare the result from the 2 techniques.
>
> I'm going to try that this afternoon, and let you know the result.

I had a brief think about how to do this with rasters, but I couldn't
see any advantage, unless there's some neat trick way of eroding parts
of the lake that can't possibly be part of a given rectangle...

Barry


From rjadenham at gmail.com  Tue Jul 31 00:40:40 2012
From: rjadenham at gmail.com (robert denham)
Date: Tue, 31 Jul 2012 08:40:40 +1000
Subject: [R-sig-Geo] Trouble building rgeos 0.2-7 on R-2.15.1 under Suse
	Linux 64bit
Message-ID: <CAHMvJdSauf7XLwK23Gexbq_u0aKA_GXp+_qBzikHQo8HidXbCA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120731/a985bdc0/attachment.pl>

From mspinola10 at gmail.com  Tue Jul 31 07:08:08 2012
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Mon, 30 Jul 2012 23:08:08 -0600
Subject: [R-sig-Geo] How can I plot a shapefile with geom_map from
	ggplot2
In-Reply-To: <CAHKDjo753=BUJFzbL9ACni4tjXFyOw+nj5AGFjJuqW8B-K7duA@mail.gmail.com>
References: <2151153d80c2477f89250577892dd5a3@EX-0-HT0.lancs.local>
	<CANVKczP3h0qbKWT=+pc4xSShLKj33ogYZ4ps1qN7gK-wEme0gA@mail.gmail.com>
	<CAHKDjo753=BUJFzbL9ACni4tjXFyOw+nj5AGFjJuqW8B-K7duA@mail.gmail.com>
Message-ID: <CABkCotRq2d2g7qHWz8GkJnjq2mdhCCTJmUKZcJSXvA7DNZgFvA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120730/2a9c19c1/attachment.pl>

From karl at huftis.org  Tue Jul 31 09:44:53 2012
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Tue, 31 Jul 2012 09:44:53 +0200
Subject: [R-sig-Geo] RE :  determining suitable lakes for landing
References: <CANVKczP0uE0aciuvygc1uFGD+UZEAwr-mYt-CNxKrb17A+dNNA@mail.gmail.com>
	<2380ef4c099e48958fbc2e59408a4e50@EX-1-HT0.lancs.local>
	<CANVKczPd=pAx9rmWbKB6AQG23jJ=D34w0m8pWbgP7AwYRa67Ng@mail.gmail.com>
Message-ID: <1500173.McCMb78Onn@ID-99504.news.uni-berlin.de>

Barry Rowlingson skreiv:

>> There is already a field telling if you could land of not ("AMERISS")
>> that was found by some old ARCgis coding (ARCinfo and aml, not sure
>> exactly how).  It was a consultant that did this code for us a couple of
>> years ago, now we want to transfer to R, explaining why I have this
>> problem now.  The code was also using iteration, however not random, on
>> rasterized lakes.  I think it would be interesting to compare the result
>> from the 2 techniques.
>>
>> I'm going to try that this afternoon, and let you know the result.
> 
> I had a brief think about how to do this with rasters, but I couldn't
> see any advantage, unless there's some neat trick way of eroding parts
> of the lake that can't possibly be part of a given rectangle...

Perhaps using a 2D Boyer?Moore-style algorithm on the raster could work?	
http://techreports.lib.berkeley.edu/accessPages/CSD-93-784.html

Of course, this doesn?t help with the orientation problem, so you?ll have to 
repeat the algorithm (if it doesn?t succeed one the first trial) for various 
orientations. But, depending on the required accuracy, it might suffice with 
just a *few* rotations of the island or rectangle (5? 10? 20?). Or at least 
it should help to successively try orientations that are very different from 
each other (e.g., first 0? and 90?, then 45?, then 22.5? and 67.5?, etc.).

-- 
Karl Ove Hufthammer
E-mail: karl at huftis.org
Jabber: huftis at jabber.no


From karl at huftis.org  Tue Jul 31 10:00:46 2012
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Tue, 31 Jul 2012 10:00:46 +0200
Subject: [R-sig-Geo] RE :  determining suitable lakes for landing
References: <CANVKczP0uE0aciuvygc1uFGD+UZEAwr-mYt-CNxKrb17A+dNNA@mail.gmail.com>
	<2380ef4c099e48958fbc2e59408a4e50@EX-1-HT0.lancs.local>
	<CANVKczPd=pAx9rmWbKB6AQG23jJ=D34w0m8pWbgP7AwYRa67Ng@mail.gmail.com>
	<1500173.McCMb78Onn@ID-99504.news.uni-berlin.de>
Message-ID: <1466649.8pT3Koq4Fo@ID-99504.news.uni-berlin.de>

Karl Ove Hufthammer skreiv:

> Perhaps using a 2D Boyer?Moore-style algorithm on the raster could work?
> http://techreports.lib.berkeley.edu/accessPages/CSD-93-784.html
> 
> Of course, this doesn?t help with the orientation problem,

But this one does (I think):

Optimal Exact and Fast Approximate Two Dimensional 
Pattern Matching Allowing Rotations
http://www.cwr.cl/publicaciones/cpm02.1.pdf

-- 
Karl Ove Hufthammer
E-mail: karl at huftis.org
Jabber: huftis at jabber.no


From b.rowlingson at lancaster.ac.uk  Tue Jul 31 11:36:53 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 31 Jul 2012 10:36:53 +0100
Subject: [R-sig-Geo] RE : determining suitable lakes for landing
In-Reply-To: <b71873e13e75419a97ff458fa4e5ce1c@EX-1-HT0.lancs.local>
References: <CANVKczP0uE0aciuvygc1uFGD+UZEAwr-mYt-CNxKrb17A+dNNA@mail.gmail.com>
	<2380ef4c099e48958fbc2e59408a4e50@EX-1-HT0.lancs.local>
	<CANVKczPd=pAx9rmWbKB6AQG23jJ=D34w0m8pWbgP7AwYRa67Ng@mail.gmail.com>
	<1500173.McCMb78Onn@ID-99504.news.uni-berlin.de>
	<b71873e13e75419a97ff458fa4e5ce1c@EX-1-HT0.lancs.local>
Message-ID: <CANVKczNEPHPOqTDxQg7Ra+=TLyT85WxGmsg_wuExaemAyR6tfw@mail.gmail.com>

On Tue, Jul 31, 2012 at 9:00 AM, Karl Ove Hufthammer <karl at huftis.org> wrote:
> Karl Ove Hufthammer skreiv:
>
>> Perhaps using a 2D Boyer?Moore-style algorithm on the raster could work?
>> http://techreports.lib.berkeley.edu/accessPages/CSD-93-784.html
>>
>> Of course, this doesn?t help with the orientation problem,
>
> But this one does (I think):
>
> Optimal Exact and Fast Approximate Two Dimensional
> Pattern Matching Allowing Rotations
> http://www.cwr.cl/publicaciones/cpm02.1.pdf

 Typical CompSci paper - 12 pages of theorems and algebra and no
actual working code! Sometimes I think CompSci people don't like the
purity of their algorithms being sullied by actual implementations...

Barry


From r.turner at auckland.ac.nz  Tue Jul 31 11:53:23 2012
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 31 Jul 2012 21:53:23 +1200
Subject: [R-sig-Geo] RE : determining suitable lakes for landing
In-Reply-To: <CANVKczNEPHPOqTDxQg7Ra+=TLyT85WxGmsg_wuExaemAyR6tfw@mail.gmail.com>
References: <CANVKczP0uE0aciuvygc1uFGD+UZEAwr-mYt-CNxKrb17A+dNNA@mail.gmail.com>
	<2380ef4c099e48958fbc2e59408a4e50@EX-1-HT0.lancs.local>
	<CANVKczPd=pAx9rmWbKB6AQG23jJ=D34w0m8pWbgP7AwYRa67Ng@mail.gmail.com>
	<1500173.McCMb78Onn@ID-99504.news.uni-berlin.de>
	<b71873e13e75419a97ff458fa4e5ce1c@EX-1-HT0.lancs.local>
	<CANVKczNEPHPOqTDxQg7Ra+=TLyT85WxGmsg_wuExaemAyR6tfw@mail.gmail.com>
Message-ID: <5017AB13.1080806@auckland.ac.nz>


On 31/07/12 21:36, Barry Rowlingson wrote:

     <SNIP>
>
>   Typical CompSci paper - 12 pages of theorems and algebra and no
> actual working code! Sometimes I think CompSci people don't like the
> purity of their algorithms being sullied by actual implementations...

Fortune nomination!

     cheers,

         Rolf


From r-sig-geo.20.trevva at spamgourmet.com  Tue Jul 31 13:54:28 2012
From: r-sig-geo.20.trevva at spamgourmet.com (r-sig-geo.20.trevva at spamgourmet.com)
Date: Tue, 31 Jul 2012 13:54:28 +0200
Subject: [R-sig-Geo] getRgshhsMap minarea argument
Message-ID: <CA+PCcJP2TXEkt74cgNV20HqhWTAshE3w-H086T7MZfFm-NrnaQ@mail.gmail.com>

Hi,

I have been using the getRgshhsMap() function in maptools to read an
external set of GSHHS coastlines. I am a fan of the function - it
makes the process of extracting coastlines around the meridian so much
simpler. This function is a wrapper to the Rgshhs() function, but
unfortunately, not all of the arguments in Rgshhs() are available in
getRgshhsMap(). e.g.

     Rgshhs(fn, xlim = NULL, ylim = NULL, level = 4, minarea = 0,
shift = FALSE,
     verbose = TRUE, no.clip = FALSE, properly=FALSE, avoidGEOS=FALSE,
     checkPolygons=FALSE)

     getRgshhsMap(fn = system.file("share/gshhs_c.b", package= "maptools"),
      xlim, ylim, level = 1, shift = TRUE, verbose = TRUE, no.clip = FALSE,
      properly=FALSE, avoidGEOS=FALSE, checkPolygons=FALSE)

In particular, I am interested in the minarea argument. Could I
request that it be added?

Best wishes,

Mark


From djrwicks at gmail.com  Tue Jul 31 15:00:37 2012
From: djrwicks at gmail.com (djrwicks)
Date: Tue, 31 Jul 2012 06:00:37 -0700 (PDT)
Subject: [R-sig-Geo] image.kriging in geoR package
Message-ID: <1343739637746-7580645.post@n2.nabble.com>

When I use the contour function with an object of type kriging to create a
filled contour plot:

loci <- expand.grid(seq(0,1,l=51), seq(0,1,l=51))
kc <- krige.conv(s100, loc=loci,krige=krige.control(cov.pars=c(1, .25)))
contour(kc, filled=TRUE)

and then add the contour lines to this plot:

contour(kc, add=TRUE)

the latter appears stretched in the direction of the x axis and does not
overlay the former as it should.

Is this a common problem?  Any suggestions?

Dan.

(example taken from the R help ?image.kriging)



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/image-kriging-in-geoR-package-tp7580645.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Bastien.Ferland-Raymond at mrnf.gouv.qc.ca  Tue Jul 31 15:21:30 2012
From: Bastien.Ferland-Raymond at mrnf.gouv.qc.ca (Bastien.Ferland-Raymond at mrnf.gouv.qc.ca)
Date: Tue, 31 Jul 2012 09:21:30 -0400
Subject: [R-sig-Geo] RE : RE :  determining suitable lakes for landing
In-Reply-To: <CANVKczPd=pAx9rmWbKB6AQG23jJ=D34w0m8pWbgP7AwYRa67Ng@mail.gmail.com>
Message-ID: <161DC602615F6943A19BAEA3DBF2E4B901A5186694E6@HARFANG.intranet.mrn.gouv>

So, I've applied Barry's approach to one of my test territory. Barry nicely qualified is approach as brute-force, so I've made my computer sweat a little.  I've tried 20000 iterations per polygon.  It was surprisingly not that hard.  First, ~90% of my lakes were remove through simple Pythagorean analyses, leaving 162 lakes.  For those lakes, some where big and went through Barry's algorithm very fast. Finally, I speed up the process using parallel processing to take advantage of my 8 cores processor.  All that together, we are talking a 20 minutes analysis, which is really viable in my context.  Here is my code :

#############
library(rgdal)
lacs <- readOGR("M:\\carte R\\en mtm","lacs_amerrissables")

##### begin fonction
ameri <- function(nom, lacs.shape,iter) {
  require(rgeos); require(sp)

  trop.petit <- function(lac) 1500>sqrt(sum((bbox(lac)[,2]-bbox(lac)[,1])^2))

  makeRect <- function(origin, l1, l2, angle){
    sa = sin(angle)
    ca = cos(angle)
    x=origin[1] + c(0,l1*ca,l1*ca-l2*sa,-l2*sa,0)
    y=origin[2] + c(0,l1*sa,l1*sa+l2*ca,l2*ca,0)
    return(SpatialPolygons(list(Polygons(list(Polygon(cbind(x,y))),"Rectangle")), proj4string=CRS(proj4string(lac))))
    return(cbind(origin[1]+x,origin[2]+y))
  }

  tryRandom <- function(w,h,p,n,all=TRUE){
    found=FALSE
    pb = bbox(p)
    if(all){
      foundRects = list()
    }
    for(i in 1:n){
#    dans.pol=F
#    while(dans.pol==F){
      xr = runif(1,pb[1,1],pb[1,2])
      yr = runif(1,pb[2,1],pb[2,2])
#     dans.pol <- gIntersects(SpatialPoints(cbind(xr,yr), proj4string=CRS(proj4string(lac))),lac)
#    }
      angle = runif(1,0,2*pi)
      rrect = makeRect(c(xr,yr),w,h,angle)
      if(gContains(p,rrect)){
        found=TRUE
        if(!all){
          break
        }else{
          foundRects[[length(foundRects)+1]]=rrect
        }
      }
    }
    if(found){
      if(all){
        return(foundRects)
      }else{
        return(rrect)
      }
    }else{
      #warning("No rectangle fit")
      return(NULL)
    }
  }

 lac <- lacs.shape[lacs.shape at data$NOUNIQUE==nom,]
 if(trop.petit(lac)) {
   land <- "non"
  } else {
   nul <- !is.null(tryRandom(50,1500,lac,iter, all=F))
   land <- ifelse(nul, "oui", "p-e")
  }
 land
}
#### end function

ameri(lacs at data$NOUNIQUE[1666], lacs, iter=30000)  # for one lake

library(parallel)
cl=makeCluster(7)
system.time(is.ameri <- parSapply(cl,lacs at data$NOUNIQUE,ameri, lacs.shape=lacs, iter=20000))    ## for multiple lakes
stopCluster(cl)

###############

The code gave pretty good results, however not perfect.  27 lakes gave different results from the initial Arcinfo code.  Following manually looking at those lakes, I've noticed that 40% were missed by Barry's algorithm (false negative).  However, that also meant that the ArcInfo was doing 60% of false-positive, which makes Barry's code better :)  Increasing the number of simulations to 30000 helped finding some of those.

One thing I'm thinking right now that could help the process is to make sure every rectangle origin falls within the lake instead of within the extent of the lake.  This may help make sure it tests only possible rectangle, however the speed may not be that different as it can be kind of hard to find points in the lake in the case of very long narrow lake.

Finally, I'll still have to work on the island problem.  I'll look into rgeos hole managing capability.

Concerning Karl Ove Hufthammer idea.  It's seems nice, however I'm afraid I won't be able to put the time to understand those algorithms and implement them in R.

Thanks again for your help,

Bastien


From b.rowlingson at lancaster.ac.uk  Tue Jul 31 15:32:17 2012
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 31 Jul 2012 14:32:17 +0100
Subject: [R-sig-Geo] RE : RE :  determining suitable lakes for landing
In-Reply-To: <fafc2ac1f461495da652a58881f1b953@EX-1-HT0.lancs.local>
References: <CANVKczPd=pAx9rmWbKB6AQG23jJ=D34w0m8pWbgP7AwYRa67Ng@mail.gmail.com>
	<fafc2ac1f461495da652a58881f1b953@EX-1-HT0.lancs.local>
Message-ID: <CANVKczP81cGtRubWu8Fwh64PmsQx9NmZgYLa1i7-JJJykNBXkg@mail.gmail.com>

On Tue, Jul 31, 2012 at 2:21 PM,
Bastien.Ferland-Raymond at mrnf.gouv.qc.ca <Bastien.Ferland-

> The code gave pretty good results, however not perfect.  27 lakes gave different results from the initial Arcinfo code.  Following manually looking at those lakes, I've noticed that 40% were missed by Barry's algorithm (false negative).  However, that also meant that the ArcInfo was doing 60% of false-positive, which makes Barry's code better :)  Increasing the number of simulations to 30000 helped finding some of those.

Considering the application, false positives are a problem! I'd rather
miss out on flying to a lake that I could land on than fly to a lake
that I can't!

 My algorithm shouldn't generate any false positives.

Barry

-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From mestre.frederico at gmail.com  Tue Jul 31 17:01:48 2012
From: mestre.frederico at gmail.com (Frederico Mestre)
Date: Tue, 31 Jul 2012 16:01:48 +0100
Subject: [R-sig-Geo] cluster points within a given distance
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAANurYWtafkREnWeH4rBeYRHigQAAEAAAAOiKCHhqjepJt7cxhBu8gaEBAAAAAA==@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20120731/a97c4b46/attachment.pl>

From marcelino.delacruz at upm.es  Tue Jul 31 21:38:28 2012
From: marcelino.delacruz at upm.es (marcelino.delacruz at upm.es)
Date: Tue, 31 Jul 2012 20:38:28 +0100
Subject: [R-sig-Geo] cluster points within a given distance
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAANurYWtafkREnWeH4rBeYRHigQAAEAAAAOiKCHhqjepJt7cxhBu8gaEBAAAAAA==@gmail.com>
Message-ID: <JqI1szst.1343763508.9511910.marcelino.delacruz@upm.es>

Let's say that your data.frame with the x and y coordnates is call
"cosaxy"

A possible option would be:

cosa.cc <- hclust(dist(cosaxy), "complete")
cosa.35<- cutree(cosa.cc, h=35)

cosa.35 is a vector that assign each point to a cluster that have a
distance between their points less or equal than 35.


HTH

Marcelino



Con fecha 31/7/2012, "Frederico Mestre" <mestre.frederico at gmail.com>
escribi?:

>Hello:
>
>
>
>Having a data frame with x and y values for a set of points how can I
>cluster all the points that stand within a given distance.
>
>
>
>As an example: create clusters of points that have a distance between them
>less than 35.
>
>
>
>Thanks,
>
>
>
>Frederico
>
>
>
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From dbebber at earthwatch.org.uk  Tue Jul 31 22:01:28 2012
From: dbebber at earthwatch.org.uk (bebber)
Date: Tue, 31 Jul 2012 13:01:28 -0700 (PDT)
Subject: [R-sig-Geo] Spatial autocorrelation on a sphere
In-Reply-To: <4FB2BD87.6050902@uni-muenster.de>
References: <072A17AB8F352A418FEE8CE1C1D4763B238D1AB1@EXCHANGE.earthwatchewe.lan>
	<4FB2BD87.6050902@uni-muenster.de>
Message-ID: <1343764888414-7580650.post@n2.nabble.com>


Edzer Pebesma-2 wrote
> 
> Assuming this is currently not possible, I would try modify nlme::dist
> to accept a spherical distance measure option, and have it call
> sp::spDists; corSpher has a metric parameter.
> 

I don't know how to access nlme::dist
I tried typing nlme::dist into the console but received this message
/Error: 'dist' is not an exported object from 'namespace:nlme'/



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Spatial-autocorrelation-on-a-sphere-tp7560592p7580650.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


