From pierre.roudier at gmail.com  Mon Feb  1 01:31:22 2010
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 1 Feb 2010 11:31:22 +1100
Subject: [R-sig-Geo] knearneigh() computing efficiency on large datasets
In-Reply-To: <4B629222.3050706@uni-muenster.de>
References: <e4178da61001282316n2945e229wb09827ed7295e32f@mail.gmail.com> 
	<4B629222.3050706@uni-muenster.de>
Message-ID: <e4178da61001311631kedda134k1f24ee4407420fb7@mail.gmail.com>

Dear Edzer and Robert,

Thank you for your replies.

> Suggestions to improve this would be to use an index structure (for the
> generic case of possibly irregularly spread data) such as the PR-bucket
> quadtree used in package gstat (nsearch.c).

Yes, I thought about that, as I want to process both regularly and
irregularly gridded data. Unfortunately, my C experience is a bit
short for that. I'll keep looking for something - if I don't find
anything I'd try to code that myself.

> You can try one of the 'focal' functions of the raster package on
> R-Forge. Not particularly fast either, but probably much faster that
> what you have now.

Thanks Robert (and congrats for such a great package BTW), I installed
the last version and will certainly test it, but as I said I would
like to process also ungridded data, so I'm still thinking about a
more general solution.

I was wondering if it could be a solution to use RSAGA or spgrass6 to
do that. Feedback, anyone ?

Cheers,

Pierre



2010/1/29 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
> Pierre Roudier wrote:
>>
>> Dear list,
>>
>> I am processing gridded data like DEMs, imported in R from geotiff
>> files. Of course, such data is regularly gridded, but very often with
>> NA values. In the framwork of some tests, I have to generate a
>> neighbourhood of the DEM, so that to extract local extrema of the
>> layer. For this task, I wrote a function based on ?the knearneig()
>> function from the spdep package, with k=4 or k=8, to generate and
>> analyse the neighbourhood of each point.
>>
>> Unfortunately, I often have to process big datasets (let's say grids
>> with between ?50,000 and 350,000 points), and that's working but
>> knearneigh() takes *hours* to process.
>>
>> Does anybody would have any suggestion to improve the efficiency of this
>> step ?
>>
>
> the algorithm (knn.c file in the spdep sources) seems to compute all
> distances between all grid cells, and for each grid cell find the nearest k
> by some kind of insertion sort. That makes it general for all kinds of
> spatial data points, including irregularly spread ones, but makes it also
> inefficient (because O(n^2) with n the number of grid cells) for large data
> sets.
>
> Suggestions to improve this would be to use an index structure (for the
> generic case of possibly irregularly spread data) such as the PR-bucket
> quadtree used in package gstat (nsearch.c), or specifically for gridded data
> to write a special knearneigh() that exploits the grid indexing already
> present: you can explicitly address the nearest 4/8/12/... neighbours by
> using row/col indexes. In this latter case you'd probably want to rewrite
> the test function for the full grid, instead of looping over the cells.
>>
>> Thanks,
>>
>> Pierre
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e
> 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763
> ?http://ifgi.uni-muenster.de http://www.52north.org/geostatistics
> ?e.pebesma at wwu.de
>
>


From edzer.pebesma at uni-muenster.de  Mon Feb  1 08:39:06 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 01 Feb 2010 08:39:06 +0100
Subject: [R-sig-Geo] knearneigh() computing efficiency on large datasets
In-Reply-To: <e4178da61001311631kedda134k1f24ee4407420fb7@mail.gmail.com>
References: <e4178da61001282316n2945e229wb09827ed7295e32f@mail.gmail.com>
	<4B629222.3050706@uni-muenster.de>
	<e4178da61001311631kedda134k1f24ee4407420fb7@mail.gmail.com>
Message-ID: <4B66851A.9020309@uni-muenster.de>



Pierre Roudier wrote:
> I was wondering if it could be a solution to use RSAGA or spgrass6 to
> do that. Feedback, anyone ?
>   
PostGIS uses a spatial index; if you provide it with a bounding box, it 
should be able to select features (points/lines/polygons) within it. I 
don't know how this relates to grids, and  haven't tried to exploit 
this. rgdal with postgis support seems to be hard to get to work on 
windows; another interface could be RODBC.
> Cheers,
>
> Pierre
>
>
>
> 2010/1/29 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
>   
>> Pierre Roudier wrote:
>>     
>>> Dear list,
>>>
>>> I am processing gridded data like DEMs, imported in R from geotiff
>>> files. Of course, such data is regularly gridded, but very often with
>>> NA values. In the framwork of some tests, I have to generate a
>>> neighbourhood of the DEM, so that to extract local extrema of the
>>> layer. For this task, I wrote a function based on  the knearneig()
>>> function from the spdep package, with k=4 or k=8, to generate and
>>> analyse the neighbourhood of each point.
>>>
>>> Unfortunately, I often have to process big datasets (let's say grids
>>> with between  50,000 and 350,000 points), and that's working but
>>> knearneigh() takes *hours* to process.
>>>
>>> Does anybody would have any suggestion to improve the efficiency of this
>>> step ?
>>>
>>>       
>> the algorithm (knn.c file in the spdep sources) seems to compute all
>> distances between all grid cells, and for each grid cell find the nearest k
>> by some kind of insertion sort. That makes it general for all kinds of
>> spatial data points, including irregularly spread ones, but makes it also
>> inefficient (because O(n^2) with n the number of grid cells) for large data
>> sets.
>>
>> Suggestions to improve this would be to use an index structure (for the
>> generic case of possibly irregularly spread data) such as the PR-bucket
>> quadtree used in package gstat (nsearch.c), or specifically for gridded data
>> to write a special knearneigh() that exploits the grid indexing already
>> present: you can explicitly address the nearest 4/8/12/... neighbours by
>> using row/col indexes. In this latter case you'd probably want to rewrite
>> the test function for the full grid, instead of looping over the cells.
>>     
>>> Thanks,
>>>
>>> Pierre
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>       
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e
>> 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763
>>  http://ifgi.uni-muenster.de http://www.52north.org/geostatistics
>>  e.pebesma at wwu.de
>>
>>
>>     

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Mon Feb  1 09:51:53 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Feb 2010 09:51:53 +0100 (CET)
Subject: [R-sig-Geo] RE :  rgdal problem when connecting with postgres
In-Reply-To: <0B5A5F37D041584DA358BC2E1D73A4B502B0CEC5EC@dc-01.lavilaine.local>
References: <0B5A5F37D041584DA358BC2E1D73A4B502B0C98C54@dc-01.lavilaine.local>,
	<alpine.LRH.2.00.1001292001040.31949@reclus.nhh.no>
	<0B5A5F37D041584DA358BC2E1D73A4B502B0CEC5EC@dc-01.lavilaine.local>
Message-ID: <alpine.LRH.2.00.1002010920270.12331@reclus.nhh.no>

On Sun, 31 Jan 2010, C?dric Briand wrote:

> Dear Roger
>
> Thank you for your answer.
>
> I have done the following : ----------------------------------------- 
> Run in OSGeo4W console, after setting: set OSGEO4W_BUILD=yes set 
> GDAL_HOME=%OSGEO4W_ROOT% download rgdal sources cd C:/rgdal/src using 
> visuel c++ (vc9) command line cl /MT /Ox /EHsc /D "WIN32" /c /I 
> "C:/Program Files/R/R-2.10.1/include" /I C:/OSGeo4W/include /I 
> "C:\Program Files\Microsoft Visual Studio 9.0\VC\include" /D OSGEO4W 
> *.cpp ------------------------------------------------------- at this 
> point, following your insctructions, I need a rdll.lib, and was not able 
> to produce it ...

C?dric:

This is discussed in README.packages in src/gnuwin32 in the source - 
online (for the development version) at:

https://svn.r-project.org/R/trunk/src/gnuwin32/README.packages

or 2.10.1:

https://svn.r-project.org/R/tags/R-2-10-1/src/gnuwin32/README.packages

your error messages suggest that trying the alternative

pexports R.dll > R.exp

might be worth trying. This step is needed for building any source package 
under Windows using VC++, so either make R.exp or using pexports should 
work once everything is lined up (PATH, etc.).

For me with a command line in R-2.10.1/bin, "pexports R.dll > R.exp" does 
work, as does "lib /def:R.exp /out:Rdll.lib", but your mileage may vary.

Roger


>
> I understand I have to download the source and try the following code, but it fails.
>
> C:\R-2.10.1\src\gnuwin32>make R.exp
> -------------------------------------------------
> gcc -std=gnu99 -I../include -I. -I../extra -DHAVE_CONFIG_H -DR_DLL_BUILD  -O3 -W
> all -pedantic   -c console.c -o console.o
> console.c:23:20: error: config.h: No such file or directory
> console.c:73: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'Ch
> aracterMode'
> console.c: In function 'console_normalkeyin':
> console.c:1357: error: 'CharacterMode' undeclared (first use in this function)
> console.c:1357: error: (Each undeclared identifier is reported only once
> console.c:1357: error: for each function it appears in.)
> console.c:1357: error: 'RGui' undeclared (first use in this function)
> make: *** [console.o] Error 1
> ---------------------------------------------------
> C?dric
>
> ________________________________________
> De : Roger Bivand [Roger.Bivand at nhh.no]
> Date d'envoi : vendredi 29 janvier 2010 20:11
> ? : C?dric Briand
> Cc : r-sig-geo at stat.math.ethz.ch
> Objet : Re: [R-sig-Geo] rgdal problem when connecting with postgres
>
> On Fri, 29 Jan 2010, C?dric Briand wrote:
>
>> Dear list members
>> We are using R 2.10.1 and rgdal Version: 0.6-20, and are working with
>> windows XP.
>
> If you mean the Windows binary rgdal package, then the answer is in
>
> file.show(system.file("README", package="rgdal"))
> file.show(system.file("README.windows", package="rgdal"))
>
> The Windows binary package builds the minimal set of drivers, with only
> one external dependency (expat for reading GPX and KML). The file refered
> to describes how you might build rgdal from source, using FWTools or
> OSGEO4W as the provider of GDAL and its dependent DLLs. If you do try this
> out (look for the chunk beginning: "Initial notes for OSGeo4W"), and if:
>
> source(system.file("OSGeo4W_test", package="rgdal"), echo=TRUE)
>
> works, as well as PostGIS access, please let me know.
>
> Roger
>
>
>> Following the nice example found at
>> http://wiki.intamap.org/index.php/PostGIS<http://wiki.intamap.org/index.php/PostGIS>
>> we tried to connect to our postgres database
>>
>
> PS. That example was run on Linux with GDAL built with PostGIS, and rgdal
> installed as a source package.
>
>> library(rgdal)
>> trial = readOGR("PG:dbname=CCM", "riversegments")
>>
>>
>> This does not work. We have tried to use ogr2ogr and examples found at
>>
>> http://www.bostongis.com/?content_name=ogr_cheatsheet
>>
>> and they work fine particularly we were able to connect to our database using the following script
>>
>>
>> C:\OSGeo4W\bin\ogr2ogr -f "ESRI Shapefile" C:\base\basesig\essai.shp PG:"host=localhost user=postgres dbname=CCM password=postgres port=5433" "riversegments
>>
>>
>>
>>
>>
>> As this works we translated the more complex dsn into the rgdal command line
>>
>>
>>
>> require(rgdal)
>>
>> readOGR(dsn="PG:host=locahost user=postgres dbname=CCM password=postgres port=5433",layer="riversegments")
>>
>>
>>
>> but it always returns a "Cannot open file" error :
>>
>>
>>
>>> require(rgdal)
>>
>> Le chargement a n?cessit? le package : rgdal
>>
>> Le chargement a n?cessit? le package : sp
>>
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>
>> Loaded GDAL runtime: GDAL 1.6.2, released 2009/07/31
>>
>> Path to GDAL shared files: C:/Program Files/R/R-2.10.0/library/rgdal/gdal
>>
>> Loaded PROJ.4 runtime: Rel. 4.6.1, 21 August 2008
>>
>> Path to PROJ.4 shared files: C:/Program Files/R/R-2.10.0/library/rgdal/proj
>>
>>> readOGR(dsn="PG:host=localhost dbname=CCM user=postgres passwd=postgres port=5433",layer="riversegments")
>>
>> Erreur dans ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :   Cannot open file
>>
>>
>> The ogrInfo in command line found at 'C:\OSGeo4W\bin\ogrInfo.exe' does seem to work (it does not return any error)
>>
>>
>>
>> The reason behind this failure seems to be that PostgresSQL is not listed in the drivers availaible with the package.
>>
>>> ogrDrivers()
>>
>>             name write
>>
>> 1          AVCBin FALSE
>>
>> 2          AVCE00 FALSE
>>
>> 3             BNA  TRUE
>>
>> 4             CSV  TRUE
>>
>> 5             DGN  TRUE
>>
>> 6  ESRI Shapefile  TRUE
>>
>> 7      Geoconcept  TRUE
>>
>> 8         GeoJSON  TRUE
>>
>> 9             GML  TRUE
>>
>> 10            GMT  TRUE
>>
>> 11            GPX  TRUE
>>
>> 12            KML  TRUE
>>
>> 13   MapInfo File  TRUE
>>
>> 14         Memory  TRUE
>>
>> 15            REC FALSE
>>
>> 16            S57  TRUE
>>
>> 17           SDTS FALSE
>>
>> 18          TIGER  TRUE
>>
>> 19        UK .NTF FALSE
>>
>> 20            VRT FALSE
>>
>> 21         XPlane FALSE
>>
>>
>>
>> After many trials we are at a loss on how to add a driver to the drivers in R. So any hint would be really valuable.
>>
>>
>>
>> C?dric
>>
>>
>>
>>
>>       [[alternative HTML version deleted]]
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From everton.emanuel at gmail.com  Mon Feb  1 13:28:59 2010
From: everton.emanuel at gmail.com (Everton Emanuel)
Date: Mon, 1 Feb 2010 10:28:59 -0200
Subject: [R-sig-Geo] How to put name in map?
Message-ID: <df06e3df1002010428n4dc4aees8ccbef7d343fb398@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100201/d747ea78/attachment.pl>

From sa.cizmeli at usherbrooke.ca  Mon Feb  1 15:24:41 2010
From: sa.cizmeli at usherbrooke.ca (Servet Ahmet Cizmeli)
Date: Mon, 01 Feb 2010 09:24:41 -0500
Subject: [R-sig-Geo] distance problem in GWR
Message-ID: <15386a98e9ed7a4136476449af98280a@courriel.usherbrooke.ca>

Hello all,

I am about to perform a GWR analysis using measurements collected at sea
onboard a ship. Some of the stations are located at opposite sides of an
island or within adjacent bays... Measuring bird's flight distances between
the stations do not make sense at all those cases. 

Is there any way to presently instruct the R's implementation of GWR that
the distances are to be measured along sea-ways? This would probably
necessitate the concurrent input of a land mask (or polygon).

As I presume the answer of the above question is NO (no mention of it
anywhere in the GWR documentation), I would like to know how difficult
would it be to add that functionality for a r-novice like me. 

thanks
Servet


From yud at mail.montclair.edu  Mon Feb  1 15:43:47 2010
From: yud at mail.montclair.edu (Danlin Yu)
Date: Mon, 01 Feb 2010 09:43:47 -0500
Subject: [R-sig-Geo] distance problem in GWR
In-Reply-To: <15386a98e9ed7a4136476449af98280a@courriel.usherbrooke.ca>
References: <15386a98e9ed7a4136476449af98280a@courriel.usherbrooke.ca>
Message-ID: <4B66E8A3.8070908@mail.montclair.edu>

Servet:

I am afraid that your speculation about alternative calculations of the 
distance is not implemented in the current SPGWR. Depending on how the 
sea-way distance is determined (the bird's flight distance is basically 
an Euclidean distance and can be formulated rather easily in R. If it is 
the case for sea-ways (easy to formulate), then I don't think the 
functionality is hard to add (adding alternative distance calculations 
in the coding). You are more than welcome to contribute to the code.

Cheers,
Danlin

Servet Ahmet Cizmeli ??:
> Hello all,
>
> I am about to perform a GWR analysis using measurements collected at sea
> onboard a ship. Some of the stations are located at opposite sides of an
> island or within adjacent bays... Measuring bird's flight distances between
> the stations do not make sense at all those cases. 
>
> Is there any way to presently instruct the R's implementation of GWR that
> the distances are to be measured along sea-ways? This would probably
> necessitate the concurrent input of a land mask (or polygon).
>
> As I presume the answer of the above question is NO (no mention of it
> anywhere in the GWR documentation), I would like to know how difficult
> would it be to add that functionality for a r-novice like me. 
>
> thanks
> Servet
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
___________________________________________
Danlin Yu, Ph.D.
Assistant Professor of GIS and Urban Geography
Department of Earth & Environmental Studies
Montclair State University
Montclair, NJ, 07043
Tel: 973-655-4313
Fax: 973-655-4072
email: yud at mail.montclair.edu
webpage: csam.montclair.edu/~yu


From Roger.Bivand at nhh.no  Mon Feb  1 18:26:13 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Feb 2010 18:26:13 +0100 (CET)
Subject: [R-sig-Geo] distance problem in GWR
In-Reply-To: <15386a98e9ed7a4136476449af98280a@courriel.usherbrooke.ca>
References: <15386a98e9ed7a4136476449af98280a@courriel.usherbrooke.ca>
Message-ID: <alpine.LRH.2.00.1002011812400.13477@reclus.nhh.no>

On Mon, 1 Feb 2010, Servet Ahmet Cizmeli wrote:

> Hello all,
>
> I am about to perform a GWR analysis using measurements collected at sea
> onboard a ship. Some of the stations are located at opposite sides of an
> island or within adjacent bays... Measuring bird's flight distances between
> the stations do not make sense at all those cases.
>
> Is there any way to presently instruct the R's implementation of GWR that
> the distances are to be measured along sea-ways? This would probably
> necessitate the concurrent input of a land mask (or polygon).
>
> As I presume the answer of the above question is NO (no mention of it
> anywhere in the GWR documentation), I would like to know how difficult
> would it be to add that functionality for a r-novice like me.

Look at the fish swims thread on this list recently:

https://stat.ethz.ch/pipermail/r-sig-geo/2010-January/007472.html

You'll see that several participants suggested using MDS to convert the 
non-Euclidic distance matrix to a 2-column coordinate matrix 
"representing" the relative position of the observations. You could use 
those with GWR, I think. It wouldn't be exact, but at least closer to your 
reality than bird flies.

Roger

>
> thanks
> Servet
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Feb  1 18:28:43 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Feb 2010 18:28:43 +0100 (CET)
Subject: [R-sig-Geo] How to put name in map?
In-Reply-To: <df06e3df1002010428n4dc4aees8ccbef7d343fb398@mail.gmail.com>
References: <df06e3df1002010428n4dc4aees8ccbef7d343fb398@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002011827370.13477@reclus.nhh.no>

On Mon, 1 Feb 2010, Everton Emanuel wrote:

> Dear all,
>
> I have a small problem concerning labelling regions and areas in R. I want
> to label a single polygon in a map. I succeed labelling to whole map, but
> when I try a single polygon it did not work.
>
> This is the command that I used:
>
> #for the whole area it works#
> plot(map)
> centroids<-coordinates(map)
> text(centroids,label=map$NAME)
>
> #for a single polygon in whole map, it does not work#
> plot(map)
> centroids<-coordinates(map)[10,1:2]
> text(centroids,label=map$NAME)

Maybe:

centroids <- coordinates(map)[10, 1:2, drop=FALSE]
text(centroids, label=map$NAME[10])

Roger

>
> I appreciate any help.
> Thank you all.
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From cedric.briand at lavilaine.com  Mon Feb  1 22:12:40 2010
From: cedric.briand at lavilaine.com (=?iso-8859-1?Q?C=E9dric_Briand?=)
Date: Mon, 1 Feb 2010 22:12:40 +0100
Subject: [R-sig-Geo] RE : RE : rgdal problem when connecting with postgres
In-Reply-To: <alpine.LRH.2.00.1002010920270.12331@reclus.nhh.no>
References: <0B5A5F37D041584DA358BC2E1D73A4B502B0C98C54@dc-01.lavilaine.local>,
	<alpine.LRH.2.00.1001292001040.31949@reclus.nhh.no>
	<0B5A5F37D041584DA358BC2E1D73A4B502B0CEC5EC@dc-01.lavilaine.local>,
	<alpine.LRH.2.00.1002010920270.12331@reclus.nhh.no>
Message-ID: <0B5A5F37D041584DA358BC2E1D73A4B502B0CEC5EE@dc-01.lavilaine.local>

Oh, I saw this one but did not continue as I did not find the pexports in the Mingw distributed with Rtools. It is not provided and must be downloaded. Getting help from Mingw is difficult as all their pages currently point to some commercial source....
So following your direction I've finally succeded in building the package. To say frankly it was difficult to me (I never included dll in my packages so far). So I'm providing other users with detailed instructions on how to proceed.

##  notes for building gdal against OSGeo4W (modified from Roger Bivand)
## 1- download rgdal sources http://cran.r-project.org/web/packages/rgdal/index.html
## in the following I just copied it in c:\
## 2- Run in OSGeo4W console, after setting:
set OSGEO4W_BUILD=yes
set GDAL_HOME=%OSGEO4W_ROOT%

## 3-get the Rdll.lib
## MinGW is avalaible with Rtools
## install pexports (available at http://sourceforge.net/projects/mingw/files/ somewhere down the long list ...
cd C:\Program Files\R\R-2.10.1\bin
C:\Rtools\MinGW\bin\ pexports R.dll > R.exp
## using visual c++ (vc9) command line url: http://www.microsoft.com/express/Downloads/#2008-Visual-CPP
cd C:\Program Files\R\R-2.10.1\bin
lib /def:R.exp /out:Rdll.lib
cd C:/rgdal/src
cl /MT /Ox /EHsc /D "WIN32" /c /I "C:/Program Files/R/R-2.10.1/include" /I C:/OSGeo4W/include /I "C:\Program Files\Microsoft Visual Studio 9.0\VC\include" /D OSGEO4W *.cpp
link /dll /out:rgdal.dll /def:rgdal.def *.obj "C:/Program Files/R/R-2.10.1/bin/Rdll.lib" /libpath:"C:\Program Files\Microsoft Visual Studio 9.0\VC\lib" /libpath:"C:\Program Files\Microsoft SDKs\Windows\v6.0A\Lib" /libpath:"C:\OSGeo4W\lib" gdal_i.lib proj_i.lib
## 4. Ensure the configure.win, Makefile.win and RGDAL.def are all correct. 
## these files are found in rgdal and rgdal/src
## set the location of GDAL_HOME in configure.win (GDAL_HOME="C:/OSGeo4W") for default OSGeo4W install
-//-- start configure.win
#!/bin/sh
if test -z "$GDAL_HOME" ; then
    GDAL_HOME="C:/OSGeo4W"
fi
echo "GDAL_HOME=${GDAL_HOME}" > src/Makeconf.win
echo "using GDAL_HOME: ${GDAL_HOME}"
if test -z "$OSGEO4W_BUILD" ; then
  if test -z "$R_PACKAGE_DIR" ; then
    R_PACKAGE_DIR=${DPKG}
 fi
  mkdir "${R_PACKAGE_DIR}/libs"
  cp ${GDAL_HOME}/bin/adrg.dll "${R_PACKAGE_DIR}/libs"
  cp ${GDAL_HOME}/bin/cblas.dll "${R_PACKAGE_DIR}/libs"
  cp ${GDAL_HOME}/bin/dted.dll "${R_PACKAGE_DIR}/libs"
  cp ${GDAL_HOME}/bin/fribidi.dll "${R_PACKAGE_DIR}/libs"
  cp ${GDAL_HOME}/bin/gdiplus.dll "${R_PACKAGE_DIR}/libs"
  cp ${GDAL_HOME}/bin/gdal15.dll "${R_PACKAGE_DIR}/libs"
  cp ${GDAL_HOME}/bin/gdal16.dll "${R_PACKAGE_DIR}/libs"
  echo "OSGEO= " >> src/Makeconf.win
else
    echo "OSGEO=-DOSGEO4W" >> src/Makeconf.win
fi
-//-- end configure.win

##   RGDAL.def as supplied in rgdal/src (no modification there)
##   Place Makefile.win in src/, containing a single line:
all:
##5. Install package (my rdal sources are still in c:/)
## CD C:\
C:\"Program Files"\R\R-2.10.1\bin\Rcmd INSTALL --build rgdal
## Note if this step does not work look if you have the Rtools properly installed and configured (especially the path)
## Then copy manually all dll of c:/OSGeo4W/bin in the newly rgdal/libs 
##Post-installation, start R from the OSGeo4W console (command line). If you want
##to check that the OSGeo4W-aware rgdal is present, check the reported support
##file locations, and consider running:
source(system.file("OSGeo4W_test", package="rgdal"), echo=TRUE)
also list drivers with  ogrDrivers() PostgresSQL should be on the list

The test has worked fine but
rdGDAL> GDALinfo(system.file("external/test.ag", package="sp")[1])
Erreur dans .Call("RGDAL_GetMetadata", x, NULL, PACKAGE = "rgdal") : 
  le nom C de symbole "RGDAL_GetMetadata" est introuvable dans la DLL pour le package "rgdal"
De plus : Messages d'avis :
1: In getGeoTransFunc(dataset) : GeoTransform values not available
2: In getGeoTransFunc(dataset) : GeoTransform values not available
3: In x[20:50, 20:50] : GeoTransform values not available
4: In x.gdal[, , 3] : GeoTransform values not available
5: In x.gdal[] : GeoTransform values not available
6: In asMethod(object) : GeoTransform values not available
 

and unfortunately

Erreur dans .Call("R_OGR_types", as.character(dsn), as.character(layer),  : 
  le nom C de symbole "R_OGR_types" est introuvable dans la DLL pour le package "rgdal"


Thanks again for your answers

C?dric

________________________________________
De : Roger Bivand [Roger.Bivand at nhh.no]
Date d'envoi : lundi 1 f?vrier 2010 09:51
? : C?dric Briand
Cc : r-sig-geo at stat.math.ethz.ch
Objet : Re: RE : [R-sig-Geo] rgdal problem when connecting with postgres

On Sun, 31 Jan 2010, C?dric Briand wrote:

> Dear Roger
>
> Thank you for your answer.
>
> I have done the following : -----------------------------------------
> Run in OSGeo4W console, after setting: set OSGEO4W_BUILD=yes set
> GDAL_HOME=%OSGEO4W_ROOT% download rgdal sources cd C:/rgdal/src using
> visuel c++ (vc9) command line cl /MT /Ox /EHsc /D "WIN32" /c /I
> "C:/Program Files/R/R-2.10.1/include" /I C:/OSGeo4W/include /I
> "C:\Program Files\Microsoft Visual Studio 9.0\VC\include" /D OSGEO4W
> *.cpp ------------------------------------------------------- at this
> point, following your insctructions, I need a rdll.lib, and was not able
> to produce it ...

C?dric:

This is discussed in README.packages in src/gnuwin32 in the source -
online (for the development version) at:

https://svn.r-project.org/R/trunk/src/gnuwin32/README.packages

or 2.10.1:

https://svn.r-project.org/R/tags/R-2-10-1/src/gnuwin32/README.packages

your error messages suggest that trying the alternative

pexports R.dll > R.exp

might be worth trying. This step is needed for building any source package
under Windows using VC++, so either make R.exp or using pexports should
work once everything is lined up (PATH, etc.).

For me with a command line in R-2.10.1/bin, "pexports R.dll > R.exp" does
work, as does "lib /def:R.exp /out:Rdll.lib", but your mileage may vary.

Roger


>
> I understand I have to download the source and try the following code, but it fails.
>
> C:\R-2.10.1\src\gnuwin32>make R.exp
> -------------------------------------------------
> gcc -std=gnu99 -I../include -I. -I../extra -DHAVE_CONFIG_H -DR_DLL_BUILD  -O3 -W
> all -pedantic   -c console.c -o console.o
> console.c:23:20: error: config.h: No such file or directory
> console.c:73: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'Ch
> aracterMode'
> console.c: In function 'console_normalkeyin':
> console.c:1357: error: 'CharacterMode' undeclared (first use in this function)
> console.c:1357: error: (Each undeclared identifier is reported only once
> console.c:1357: error: for each function it appears in.)
> console.c:1357: error: 'RGui' undeclared (first use in this function)
> make: *** [console.o] Error 1
> ---------------------------------------------------
> C?dric
>
> ________________________________________
> De : Roger Bivand [Roger.Bivand at nhh.no]
> Date d'envoi : vendredi 29 janvier 2010 20:11
> ? : C?dric Briand
> Cc : r-sig-geo at stat.math.ethz.ch
> Objet : Re: [R-sig-Geo] rgdal problem when connecting with postgres
>
> On Fri, 29 Jan 2010, C?dric Briand wrote:
>
>> Dear list members
>> We are using R 2.10.1 and rgdal Version: 0.6-20, and are working with
>> windows XP.
>
> If you mean the Windows binary rgdal package, then the answer is in
>
> file.show(system.file("README", package="rgdal"))
> file.show(system.file("README.windows", package="rgdal"))
>
> The Windows binary package builds the minimal set of drivers, with only
> one external dependency (expat for reading GPX and KML). The file refered
> to describes how you might build rgdal from source, using FWTools or
> OSGEO4W as the provider of GDAL and its dependent DLLs. If you do try this
> out (look for the chunk beginning: "Initial notes for OSGeo4W"), and if:
>
> source(system.file("OSGeo4W_test", package="rgdal"), echo=TRUE)
>
> works, as well as PostGIS access, please let me know.
>
> Roger
>
>
>> Following the nice example found at
>> http://wiki.intamap.org/index.php/PostGIS<http://wiki.intamap.org/index.php/PostGIS>
>> we tried to connect to our postgres database
>>
>
> PS. That example was run on Linux with GDAL built with PostGIS, and rgdal
> installed as a source package.
>
>> library(rgdal)
>> trial = readOGR("PG:dbname=CCM", "riversegments")
>>
>>
>> This does not work. We have tried to use ogr2ogr and examples found at
>>
>> http://www.bostongis.com/?content_name=ogr_cheatsheet
>>
>> and they work fine particularly we were able to connect to our database using the following script
>>
>>
>> C:\OSGeo4W\bin\ogr2ogr -f "ESRI Shapefile" C:\base\basesig\essai.shp PG:"host=localhost user=postgres dbname=CCM password=postgres port=5433" "riversegments
>>
>>
>>
>>
>>
>> As this works we translated the more complex dsn into the rgdal command line
>>
>>
>>
>> require(rgdal)
>>
>> readOGR(dsn="PG:host=locahost user=postgres dbname=CCM password=postgres port=5433",layer="riversegments")
>>
>>
>>
>> but it always returns a "Cannot open file" error :
>>
>>
>>
>>> require(rgdal)
>>
>> Le chargement a n?cessit? le package : rgdal
>>
>> Le chargement a n?cessit? le package : sp
>>
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>
>> Loaded GDAL runtime: GDAL 1.6.2, released 2009/07/31
>>
>> Path to GDAL shared files: C:/Program Files/R/R-2.10.0/library/rgdal/gdal
>>
>> Loaded PROJ.4 runtime: Rel. 4.6.1, 21 August 2008
>>
>> Path to PROJ.4 shared files: C:/Program Files/R/R-2.10.0/library/rgdal/proj
>>
>>> readOGR(dsn="PG:host=localhost dbname=CCM user=postgres passwd=postgres port=5433",layer="riversegments")
>>
>> Erreur dans ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :   Cannot open file
>>
>>
>> The ogrInfo in command line found at 'C:\OSGeo4W\bin\ogrInfo.exe' does seem to work (it does not return any error)
>>
>>
>>
>> The reason behind this failure seems to be that PostgresSQL is not listed in the drivers availaible with the package.
>>
>>> ogrDrivers()
>>
>>             name write
>>
>> 1          AVCBin FALSE
>>
>> 2          AVCE00 FALSE
>>
>> 3             BNA  TRUE
>>
>> 4             CSV  TRUE
>>
>> 5             DGN  TRUE
>>
>> 6  ESRI Shapefile  TRUE
>>
>> 7      Geoconcept  TRUE
>>
>> 8         GeoJSON  TRUE
>>
>> 9             GML  TRUE
>>
>> 10            GMT  TRUE
>>
>> 11            GPX  TRUE
>>
>> 12            KML  TRUE
>>
>> 13   MapInfo File  TRUE
>>
>> 14         Memory  TRUE
>>
>> 15            REC FALSE
>>
>> 16            S57  TRUE
>>
>> 17           SDTS FALSE
>>
>> 18          TIGER  TRUE
>>
>> 19        UK .NTF FALSE
>>
>> 20            VRT FALSE
>>
>> 21         XPlane FALSE
>>
>>
>>
>> After many trials we are at a loss on how to add a driver to the drivers in R. So any hint would be really valuable.
>>
>>
>>
>> C?dric
>>
>>
>>
>>
>>       [[alternative HTML version deleted]]
>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no

--
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From narayani.ku at gmail.com  Mon Feb  1 23:32:04 2010
From: narayani.ku at gmail.com (Narayani Barve)
Date: Mon, 1 Feb 2010 16:32:04 -0600
Subject: [R-sig-Geo] Help with conversion from NetCDF to ASCII
Message-ID: <f087f1441002011432o1f9c1a1cpa9b33889963f7ab5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100201/79bfa765/attachment.pl>

From paulo.mailing.list at gmail.com  Mon Feb  1 23:34:21 2010
From: paulo.mailing.list at gmail.com (Paulo Eduardo Cardoso)
Date: Mon, 1 Feb 2010 22:34:21 +0000
Subject: [R-sig-Geo] plot polygons - transparent holes/island
In-Reply-To: <alpine.LRH.2.00.1001311115220.9029@reclus.nhh.no>
References: <e805f391001300045o1d17574fwa7dec7710cde2c64@mail.gmail.com>
	<alpine.LRH.2.00.1001301458340.5068@reclus.nhh.no>
	<e805f391001301701p725ca5adu4095c035f8b6262a@mail.gmail.com>
	<alpine.LRH.2.00.1001311115220.9029@reclus.nhh.no>
Message-ID: <e805f391002011434k6446920fw3d2b0234e958e2fc@mail.gmail.com>

Hi,
Code exemple
library(maptools)
load(file='D:\\R\\transparencia\\TransparentPolygon.Rdata')
areas <- readShapeSpatial('D:\\R\\transparencia\\Areas.shp')
pontos <- readShapeSpatial('D:\\R\\transparencia\\Points.shp')
plot(pontos,pch=19,col=pontos$point)
plot(areas,pbg="transparent",bg="red",add=TRUE)

data can be downloaded from

http://rapidshare.com/files/344532718/TransparentPolygon.Rdata.html

example image can be downloaded grom

http://rapidshare.com/files/344533300/ExampleTransparentPolygon.png.html





2010/1/31 Roger Bivand <Roger.Bivand at nhh.no>
>
> On Sun, 31 Jan 2010, Paulo Eduardo Cardoso wrote:
>
>> Roger,
>>
>> I really thank you for you comments. You are always available to explain
>> everything, and that's a fortune for forum users.
>> But I still with the same problem. I did,'t understand how to leave the
>> inner hole or the inner polygon transparent, in order to see any other layer
>> plotter at first.
>> Should I send a simple example?
>
> Please do, either code for a provided data set, or code and a link to the URL where the data set is available.
>
> Roger
>
>>
>> 2010/1/30 Roger Bivand <Roger.Bivand at nhh.no>
>>
>>> On Sat, 30 Jan 2010, Paulo Eduardo Cardoso wrote:
>>>
>>> ?I'd like to plot a SPDF with two objects, one of them buffering the other
>>>>
>>>> "island". How can I set the "island" transparent?
>>>> Similarly, keeping the outer polygon only, how can the hole still
>>>> transparent?
>>>>
>>>
>>> Polygons objects are plotted largest to smallest, as are Polygon objects in
>>> each Polygons object. Each Polygons object and all its constituent Polygon
>>> objects are painted the colour chosen for that Polygons object.
>>>
>>> If you want the holes Polygon objects to overpaint their containing Polygon
>>> objects, in the base graphics plot() method, you set the pbg= argument to
>>> the background colour (not "transparent", this will let you see the painted
>>> Polygon below). In the spplot method, this is handled internally by reading
>>> the trellis.par.get()$background value, and using it if not "transparent",
>>> or "white" if it is "transparent".
>>>
>>> Both approaches depend on the hole slot of the Polygon object being
>>> correctly set.
>>>
>>> R graphics do not analyse objects leaving out say holes, they overpaint.
>>> This is because the holes are not "known" in advance by the functions being
>>> executed.
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>>
>>>> Thanks in advance,
>>>>
>>>> Paulo E. Cardoso
>>>>
>>>> ? ? ? [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From mdsumner at gmail.com  Mon Feb  1 23:49:33 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 2 Feb 2010 09:49:33 +1100
Subject: [R-sig-Geo] Help with conversion from NetCDF to ASCII
In-Reply-To: <f087f1441002011432o1f9c1a1cpa9b33889963f7ab5@mail.gmail.com>
References: <f087f1441002011432o1f9c1a1cpa9b33889963f7ab5@mail.gmail.com>
Message-ID: <522664f81002011449h3cddcf25hef709a317cc3a70@mail.gmail.com>

Does it have to be that ascii format? There are much better options
for regular grids, such as GeoTIFF - but it depends on your target of
course. Note that some software supports different dx/dy sizes, namely
GDAL and Golden Surfer for this format:

http://www.gdal.org/frmt_various.html#AAIGrid

If it does need to be ESRI ASCII, you could write it out with square
cells and then reset the cell sizes in the target (if possible).

Is the requirement for square cells with the ESRI version of this
format, or with the software you want to use next?

As a last resort you could resample the grid using R's indexing/seq
functions, or with spsample in package sp, or warp it with an external
tool like gdalwarp.

Cheers, Mike.

On Tue, Feb 2, 2010 at 9:32 AM, Narayani Barve <narayani.ku at gmail.com> wrote:
> Hi All,
>
> I want to convert netCDF files to ESRI ASCII grid. I used the package ncdf
> to read the file and get the required variable in the matrix format. Now I
> want to write this matrix into ESRI ASCII grid. Looking at the extends of
> the data, and the row and column dimensions, I know that the CELLSIZE is not
> square.
>
> Is there any way, I can convert this data into square ASCII Grid (ESRI)
> format.
>
> Thanks,
> Narayani
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Tue Feb  2 01:41:35 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 1 Feb 2010 16:41:35 -0800
Subject: [R-sig-Geo] Help with conversion from NetCDF to ASCII
In-Reply-To: <522664f81002011449h3cddcf25hef709a317cc3a70@mail.gmail.com>
References: <f087f1441002011432o1f9c1a1cpa9b33889963f7ab5@mail.gmail.com>
	<522664f81002011449h3cddcf25hef709a317cc3a70@mail.gmail.com>
Message-ID: <dc22b2571002011641y478dd98bq280b2feb59023475@mail.gmail.com>

If you really require square cells, then the resample function in
'raster' might be useful:

library(raster)
r = raster('ncdffile')
# or r=raster(matrix); extent(r) = c( , , , )
s = raster(r)
res(s) = min(res(s))
s = resample(r, s,  method='bilinear')
s = writeRaster(s, filename='abc.asc', format='ascii')

Or first do an interpolation first. Many options for that. E.g. see
?raster::interpolate

Robert

On Mon, Feb 1, 2010 at 2:49 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> Does it have to be that ascii format? There are much better options
> for regular grids, such as GeoTIFF - but it depends on your target of
> course. Note that some software supports different dx/dy sizes, namely
> GDAL and Golden Surfer for this format:
>
> http://www.gdal.org/frmt_various.html#AAIGrid
>
> If it does need to be ESRI ASCII, you could write it out with square
> cells and then reset the cell sizes in the target (if possible).
>
> Is the requirement for square cells with the ESRI version of this
> format, or with the software you want to use next?
>
> As a last resort you could resample the grid using R's indexing/seq
> functions, or with spsample in package sp, or warp it with an external
> tool like gdalwarp.
>
> Cheers, Mike.
>
> On Tue, Feb 2, 2010 at 9:32 AM, Narayani Barve <narayani.ku at gmail.com> wrote:
>> Hi All,
>>
>> I want to convert netCDF files to ESRI ASCII grid. I used the package ncdf
>> to read the file and get the required variable in the matrix format. Now I
>> want to write this matrix into ESRI ASCII grid. Looking at the extends of
>> the data, and the row and column dimensions, I know that the CELLSIZE is not
>> square.
>>
>> Is there any way, I can convert this data into square ASCII Grid (ESRI)
>> format.
>>
>> Thanks,
>> Narayani
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From rusers.sh at gmail.com  Tue Feb  2 03:19:31 2010
From: rusers.sh at gmail.com (rusers.sh)
Date: Mon, 1 Feb 2010 21:19:31 -0500
Subject: [R-sig-Geo] generate simulation data for a theoretical spatial
	model
In-Reply-To: <4B654953.4070102@spatial-analyst.net>
References: <4B654953.4070102@spatial-analyst.net>
Message-ID: <a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100201/6e047c49/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Feb  2 08:39:11 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 02 Feb 2010 08:39:11 +0100
Subject: [R-sig-Geo] generate simulation data for a theoretical spatial
 model
In-Reply-To: <a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>
References: <4B654953.4070102@spatial-analyst.net>
	<a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>
Message-ID: <4B67D69F.2040003@uni-muenster.de>



rusers.sh wrote:
> Hi Tomislav,
>   Thanks for your info on unconditional simulation. For conditional
> simulations, i still cannot find any useful information.
>   I searched the R site and didnot find the possible method to do
> conditional simulations.
> 1. CondSimu(RandomField): trend: Not programmed yet. (used by universal
> kriging)
> 2. grf(geoR): generates unconditional simulations of Gaussian random fields
> 3. sim.Krig(fields)  #Conditonal simulation of a spatial process
>    It seems to be based on the actual dataset,not a theoretical model.
> 4. krige(gstat ):Simple, Ordinary or Universal, global or local, Point or
> Block Kriging,or simulation
>   x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, block =
> c(40,40),nsim=1)
>   
rusers.sh, please use

x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, nmax=40, nsim=1)

both adding the block=c(40,40) as well as omitting the nmax=40 tremendously increased the computing time you needed, the second even more (in an O(n^2) manner) than the first.
--
Edzer



>   I used the above modified codes from krige(gstat ) example to see the
> effect of "nsim", but unfortunately, it took a longer time and cannot get
> the results. I guess it used the simulation method to test the model, not
> what i want. (My system is XP, R2.10.0, gstat09.-64.)
>   Anybody can give me further information on generating the conditional
> simulations from a theoretical model just like the unconditional examples
> that Tomislav provided?
>   Thanks a lot.
>
>
> 2010/1/31 Tomislav Hengl <hengl at spatial-analyst.net>
>
>   
>> Dear rusers.sh,
>>
>> Here are few simple examples of how to simulate (not-normal)
>> distributions and point processes using geoR and spatstat:
>>
>> http://spatial-analyst.net/book/node/388
>>
>> See also:
>>
>>
>> http://leg.ufpr.br/geoR/geoRdoc/vignette/geoRintro/geoRintrose8.html#x9-120008
>>
>> I guess that covariates can be also included (I guess that you then need
>> to switch to conditional simulations - not sure).
>>
>> This should also work for lattice (polygon) data so that you will have
>> jumps in values (but I guess you would still work in gridded systems?).
>>
>> T. Hengl
>> http://home.medewerker.uva.nl/t.hengl/
>>
>>
>> rusers.sh wrote:
>>
>>     
>>> Hi all,
>>>  In classical statistics, we always need to generate a theoretical model
>>> such as y=a+b1*x1+b2*x2+e to study some new estimation content. I am
>>> wondering how to generate the similar spatial dataset for a theoretical
>>> model.
>>> Say y is response variable, x1 and x2 are explanatory variables.
>>> 1. If y is a continous variable, how should we generate the dataset for a
>>> theoretical spatial point process model in R?
>>> 2. If y is a continous variable, how should we generate the dataset for a
>>> theoretical spatial lattice data model in R?
>>> 3. If y is 0/1 binary variable, how should we generate the dataset for a
>>> theoretical spatial point process model in R?
>>> 4. If y is 0/1 binary variable, how should we generate the dataset for a
>>> ttheoretical spatial lattice data in R?
>>>  spatstat and other packages allow us to generate a dataset of a specified
>>> point process and other models, but it seems that they donot allow us to
>>> include possible explanatory variables into a theoretical model. Maybe i
>>> missed some ideas in them.
>>>  Anybody can express some ideas or point out some useful resources on the
>>> above four different situations? Small examples in R are preferred.
>>>  Thanks a lot.
>>>
>>>
>>>       
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>     
>
>
>
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Roger.Bivand at nhh.no  Tue Feb  2 11:07:43 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 2 Feb 2010 11:07:43 +0100 (CET)
Subject: [R-sig-Geo] RE : RE : rgdal problem when connecting with
 postgres
In-Reply-To: <0B5A5F37D041584DA358BC2E1D73A4B502B0CEC5EE@dc-01.lavilaine.local>
References: <0B5A5F37D041584DA358BC2E1D73A4B502B0C98C54@dc-01.lavilaine.local>,
	<alpine.LRH.2.00.1001292001040.31949@reclus.nhh.no>
	<0B5A5F37D041584DA358BC2E1D73A4B502B0CEC5EC@dc-01.lavilaine.local>,
	<alpine.LRH.2.00.1002010920270.12331@reclus.nhh.no>
	<0B5A5F37D041584DA358BC2E1D73A4B502B0CEC5EE@dc-01.lavilaine.local>
Message-ID: <alpine.LRH.2.00.1002021100390.16338@reclus.nhh.no>

On Mon, 1 Feb 2010, C?dric Briand wrote:

> Oh, I saw this one but did not continue as I did not find the pexports 
> in the Mingw distributed with Rtools. It is not provided and must be 
> downloaded. Getting help from Mingw is difficult as all their pages 
> currently point to some commercial source.... So following your 
> direction I've finally succeded in building the package. To say frankly 
> it was difficult to me (I never included dll in my packages so far). So 
> I'm providing other users with detailed instructions on how to proceed.

C?dric:

I don't think that you need to copy any OSGEO4W DLLs to the package tree. 
I do think that you have to start R from within an OSGEO4W console or 
environment, which has set up the PATH for the executables. I don't think 
that you need to modify configure.win, just make sure that the package 
build process is being run from within OSGEO4W. I think that running 
everything within your target environment is the key.

Roger

>
> ##  notes for building gdal against OSGeo4W (modified from Roger Bivand)
> ## 1- download rgdal sources http://cran.r-project.org/web/packages/rgdal/index.html
> ## in the following I just copied it in c:\
> ## 2- Run in OSGeo4W console, after setting:
> set OSGEO4W_BUILD=yes
> set GDAL_HOME=%OSGEO4W_ROOT%
>
> ## 3-get the Rdll.lib
> ## MinGW is avalaible with Rtools
> ## install pexports (available at http://sourceforge.net/projects/mingw/files/ somewhere down the long list ...
> cd C:\Program Files\R\R-2.10.1\bin
> C:\Rtools\MinGW\bin\ pexports R.dll > R.exp
> ## using visual c++ (vc9) command line url: http://www.microsoft.com/express/Downloads/#2008-Visual-CPP
> cd C:\Program Files\R\R-2.10.1\bin
> lib /def:R.exp /out:Rdll.lib
> cd C:/rgdal/src
> cl /MT /Ox /EHsc /D "WIN32" /c /I "C:/Program Files/R/R-2.10.1/include" /I C:/OSGeo4W/include /I "C:\Program Files\Microsoft Visual Studio 9.0\VC\include" /D OSGEO4W *.cpp
> link /dll /out:rgdal.dll /def:rgdal.def *.obj "C:/Program Files/R/R-2.10.1/bin/Rdll.lib" /libpath:"C:\Program Files\Microsoft Visual Studio 9.0\VC\lib" /libpath:"C:\Program Files\Microsoft SDKs\Windows\v6.0A\Lib" /libpath:"C:\OSGeo4W\lib" gdal_i.lib proj_i.lib
> ## 4. Ensure the configure.win, Makefile.win and RGDAL.def are all correct.
> ## these files are found in rgdal and rgdal/src
> ## set the location of GDAL_HOME in configure.win (GDAL_HOME="C:/OSGeo4W") for default OSGeo4W install
> -//-- start configure.win
> #!/bin/sh
> if test -z "$GDAL_HOME" ; then
>    GDAL_HOME="C:/OSGeo4W"
> fi
> echo "GDAL_HOME=${GDAL_HOME}" > src/Makeconf.win
> echo "using GDAL_HOME: ${GDAL_HOME}"
> if test -z "$OSGEO4W_BUILD" ; then
>  if test -z "$R_PACKAGE_DIR" ; then
>    R_PACKAGE_DIR=${DPKG}
> fi
>  mkdir "${R_PACKAGE_DIR}/libs"
>  cp ${GDAL_HOME}/bin/adrg.dll "${R_PACKAGE_DIR}/libs"
>  cp ${GDAL_HOME}/bin/cblas.dll "${R_PACKAGE_DIR}/libs"
>  cp ${GDAL_HOME}/bin/dted.dll "${R_PACKAGE_DIR}/libs"
>  cp ${GDAL_HOME}/bin/fribidi.dll "${R_PACKAGE_DIR}/libs"
>  cp ${GDAL_HOME}/bin/gdiplus.dll "${R_PACKAGE_DIR}/libs"
>  cp ${GDAL_HOME}/bin/gdal15.dll "${R_PACKAGE_DIR}/libs"
>  cp ${GDAL_HOME}/bin/gdal16.dll "${R_PACKAGE_DIR}/libs"
>  echo "OSGEO= " >> src/Makeconf.win
> else
>    echo "OSGEO=-DOSGEO4W" >> src/Makeconf.win
> fi
> -//-- end configure.win
>
> ##   RGDAL.def as supplied in rgdal/src (no modification there)
> ##   Place Makefile.win in src/, containing a single line:
> all:
> ##5. Install package (my rdal sources are still in c:/)
> ## CD C:\
> C:\"Program Files"\R\R-2.10.1\bin\Rcmd INSTALL --build rgdal
> ## Note if this step does not work look if you have the Rtools properly installed and configured (especially the path)
> ## Then copy manually all dll of c:/OSGeo4W/bin in the newly rgdal/libs
> ##Post-installation, start R from the OSGeo4W console (command line). If you want
> ##to check that the OSGeo4W-aware rgdal is present, check the reported support
> ##file locations, and consider running:
> source(system.file("OSGeo4W_test", package="rgdal"), echo=TRUE)
> also list drivers with  ogrDrivers() PostgresSQL should be on the list
>
> The test has worked fine but
> rdGDAL> GDALinfo(system.file("external/test.ag", package="sp")[1])
> Erreur dans .Call("RGDAL_GetMetadata", x, NULL, PACKAGE = "rgdal") :
>  le nom C de symbole "RGDAL_GetMetadata" est introuvable dans la DLL pour le package "rgdal"
> De plus : Messages d'avis :
> 1: In getGeoTransFunc(dataset) : GeoTransform values not available
> 2: In getGeoTransFunc(dataset) : GeoTransform values not available
> 3: In x[20:50, 20:50] : GeoTransform values not available
> 4: In x.gdal[, , 3] : GeoTransform values not available
> 5: In x.gdal[] : GeoTransform values not available
> 6: In asMethod(object) : GeoTransform values not available
>
>
> and unfortunately
>
> Erreur dans .Call("R_OGR_types", as.character(dsn), as.character(layer),  :
>  le nom C de symbole "R_OGR_types" est introuvable dans la DLL pour le package "rgdal"
>
>
> Thanks again for your answers
>
> C?dric
>
> ________________________________________
> De : Roger Bivand [Roger.Bivand at nhh.no]
> Date d'envoi : lundi 1 f?vrier 2010 09:51
> ? : C?dric Briand
> Cc : r-sig-geo at stat.math.ethz.ch
> Objet : Re: RE : [R-sig-Geo] rgdal problem when connecting with postgres
>
> On Sun, 31 Jan 2010, C?dric Briand wrote:
>
>> Dear Roger
>>
>> Thank you for your answer.
>>
>> I have done the following : -----------------------------------------
>> Run in OSGeo4W console, after setting: set OSGEO4W_BUILD=yes set
>> GDAL_HOME=%OSGEO4W_ROOT% download rgdal sources cd C:/rgdal/src using
>> visuel c++ (vc9) command line cl /MT /Ox /EHsc /D "WIN32" /c /I
>> "C:/Program Files/R/R-2.10.1/include" /I C:/OSGeo4W/include /I
>> "C:\Program Files\Microsoft Visual Studio 9.0\VC\include" /D OSGEO4W
>> *.cpp ------------------------------------------------------- at this
>> point, following your insctructions, I need a rdll.lib, and was not able
>> to produce it ...
>
> C?dric:
>
> This is discussed in README.packages in src/gnuwin32 in the source -
> online (for the development version) at:
>
> https://svn.r-project.org/R/trunk/src/gnuwin32/README.packages
>
> or 2.10.1:
>
> https://svn.r-project.org/R/tags/R-2-10-1/src/gnuwin32/README.packages
>
> your error messages suggest that trying the alternative
>
> pexports R.dll > R.exp
>
> might be worth trying. This step is needed for building any source package
> under Windows using VC++, so either make R.exp or using pexports should
> work once everything is lined up (PATH, etc.).
>
> For me with a command line in R-2.10.1/bin, "pexports R.dll > R.exp" does
> work, as does "lib /def:R.exp /out:Rdll.lib", but your mileage may vary.
>
> Roger
>
>
>>
>> I understand I have to download the source and try the following code, but it fails.
>>
>> C:\R-2.10.1\src\gnuwin32>make R.exp
>> -------------------------------------------------
>> gcc -std=gnu99 -I../include -I. -I../extra -DHAVE_CONFIG_H -DR_DLL_BUILD  -O3 -W
>> all -pedantic   -c console.c -o console.o
>> console.c:23:20: error: config.h: No such file or directory
>> console.c:73: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'Ch
>> aracterMode'
>> console.c: In function 'console_normalkeyin':
>> console.c:1357: error: 'CharacterMode' undeclared (first use in this function)
>> console.c:1357: error: (Each undeclared identifier is reported only once
>> console.c:1357: error: for each function it appears in.)
>> console.c:1357: error: 'RGui' undeclared (first use in this function)
>> make: *** [console.o] Error 1
>> ---------------------------------------------------
>> C?dric
>>
>> ________________________________________
>> De : Roger Bivand [Roger.Bivand at nhh.no]
>> Date d'envoi : vendredi 29 janvier 2010 20:11
>> ? : C?dric Briand
>> Cc : r-sig-geo at stat.math.ethz.ch
>> Objet : Re: [R-sig-Geo] rgdal problem when connecting with postgres
>>
>> On Fri, 29 Jan 2010, C?dric Briand wrote:
>>
>>> Dear list members
>>> We are using R 2.10.1 and rgdal Version: 0.6-20, and are working with
>>> windows XP.
>>
>> If you mean the Windows binary rgdal package, then the answer is in
>>
>> file.show(system.file("README", package="rgdal"))
>> file.show(system.file("README.windows", package="rgdal"))
>>
>> The Windows binary package builds the minimal set of drivers, with only
>> one external dependency (expat for reading GPX and KML). The file refered
>> to describes how you might build rgdal from source, using FWTools or
>> OSGEO4W as the provider of GDAL and its dependent DLLs. If you do try this
>> out (look for the chunk beginning: "Initial notes for OSGeo4W"), and if:
>>
>> source(system.file("OSGeo4W_test", package="rgdal"), echo=TRUE)
>>
>> works, as well as PostGIS access, please let me know.
>>
>> Roger
>>
>>
>>> Following the nice example found at
>>> http://wiki.intamap.org/index.php/PostGIS<http://wiki.intamap.org/index.php/PostGIS>
>>> we tried to connect to our postgres database
>>>
>>
>> PS. That example was run on Linux with GDAL built with PostGIS, and rgdal
>> installed as a source package.
>>
>>> library(rgdal)
>>> trial = readOGR("PG:dbname=CCM", "riversegments")
>>>
>>>
>>> This does not work. We have tried to use ogr2ogr and examples found at
>>>
>>> http://www.bostongis.com/?content_name=ogr_cheatsheet
>>>
>>> and they work fine particularly we were able to connect to our database using the following script
>>>
>>>
>>> C:\OSGeo4W\bin\ogr2ogr -f "ESRI Shapefile" C:\base\basesig\essai.shp PG:"host=localhost user=postgres dbname=CCM password=postgres port=5433" "riversegments
>>>
>>>
>>>
>>>
>>>
>>> As this works we translated the more complex dsn into the rgdal command line
>>>
>>>
>>>
>>> require(rgdal)
>>>
>>> readOGR(dsn="PG:host=locahost user=postgres dbname=CCM password=postgres port=5433",layer="riversegments")
>>>
>>>
>>>
>>> but it always returns a "Cannot open file" error :
>>>
>>>
>>>
>>>> require(rgdal)
>>>
>>> Le chargement a n?cessit? le package : rgdal
>>>
>>> Le chargement a n?cessit? le package : sp
>>>
>>> Geospatial Data Abstraction Library extensions to R successfully loaded
>>>
>>> Loaded GDAL runtime: GDAL 1.6.2, released 2009/07/31
>>>
>>> Path to GDAL shared files: C:/Program Files/R/R-2.10.0/library/rgdal/gdal
>>>
>>> Loaded PROJ.4 runtime: Rel. 4.6.1, 21 August 2008
>>>
>>> Path to PROJ.4 shared files: C:/Program Files/R/R-2.10.0/library/rgdal/proj
>>>
>>>> readOGR(dsn="PG:host=localhost dbname=CCM user=postgres passwd=postgres port=5433",layer="riversegments")
>>>
>>> Erreur dans ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding = input_field_name_encoding) :   Cannot open file
>>>
>>>
>>> The ogrInfo in command line found at 'C:\OSGeo4W\bin\ogrInfo.exe' does seem to work (it does not return any error)
>>>
>>>
>>>
>>> The reason behind this failure seems to be that PostgresSQL is not listed in the drivers availaible with the package.
>>>
>>>> ogrDrivers()
>>>
>>>             name write
>>>
>>> 1          AVCBin FALSE
>>>
>>> 2          AVCE00 FALSE
>>>
>>> 3             BNA  TRUE
>>>
>>> 4             CSV  TRUE
>>>
>>> 5             DGN  TRUE
>>>
>>> 6  ESRI Shapefile  TRUE
>>>
>>> 7      Geoconcept  TRUE
>>>
>>> 8         GeoJSON  TRUE
>>>
>>> 9             GML  TRUE
>>>
>>> 10            GMT  TRUE
>>>
>>> 11            GPX  TRUE
>>>
>>> 12            KML  TRUE
>>>
>>> 13   MapInfo File  TRUE
>>>
>>> 14         Memory  TRUE
>>>
>>> 15            REC FALSE
>>>
>>> 16            S57  TRUE
>>>
>>> 17           SDTS FALSE
>>>
>>> 18          TIGER  TRUE
>>>
>>> 19        UK .NTF FALSE
>>>
>>> 20            VRT FALSE
>>>
>>> 21         XPlane FALSE
>>>
>>>
>>>
>>> After many trials we are at a loss on how to add a driver to the drivers in R. So any hint would be really valuable.
>>>
>>>
>>>
>>> C?dric
>>>
>>>
>>>
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Tue Feb  2 13:20:09 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 2 Feb 2010 13:20:09 +0100 (CET)
Subject: [R-sig-Geo] plot polygons - transparent holes/island
In-Reply-To: <e805f391002011434k6446920fw3d2b0234e958e2fc@mail.gmail.com>
References: <e805f391001300045o1d17574fwa7dec7710cde2c64@mail.gmail.com>
	<alpine.LRH.2.00.1001301458340.5068@reclus.nhh.no>
	<e805f391001301701p725ca5adu4095c035f8b6262a@mail.gmail.com>
	<alpine.LRH.2.00.1001311115220.9029@reclus.nhh.no>
	<e805f391002011434k6446920fw3d2b0234e958e2fc@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002021303310.16338@reclus.nhh.no>

On Mon, 1 Feb 2010, Paulo Eduardo Cardoso wrote:

> Hi,
> Code exemple
> library(maptools)
> load(file='D:\\R\\transparencia\\TransparentPolygon.Rdata')
> areas <- readShapeSpatial('D:\\R\\transparencia\\Areas.shp')
> pontos <- readShapeSpatial('D:\\R\\transparencia\\Points.shp')
> plot(pontos,pch=19,col=pontos$point)
> plot(areas,pbg="transparent",bg="red",add=TRUE)
>
> data can be downloaded from
>
> http://rapidshare.com/files/344532718/TransparentPolygon.Rdata.html
>
> example image can be downloaded grom
>
> http://rapidshare.com/files/344533300/ExampleTransparentPolygon.png.html
>

The image cannot be reproduced with your plotting order, because the 
polygons overpaint the points. Crucially, the big square is completely 
painted. You also have two Polygons objects, one a square with a round 
hole, the other an island filling the hole. With your objects, you could 
do:

plot(areas[1,], pbg="white", col="grey85", border="grey50") 
# set up background polygon and paint hole
plot(areas[2,], angle=45, density=8, border="grey50", col="grey50",
   add=TRUE)
# hatch the island polygon
points(pontos[pontos$point=="in",], pch=16)
# add the in points
points(pontos[pontos$point=="out",], pch=22, col="grey50", bg="grey50")
# and the out points

If your output devive uses and alpha channel, you may be able to find 
other ways forward, but they will not be portable across devices.

Hope this helps,

Roger

>
>
>
>
> 2010/1/31 Roger Bivand <Roger.Bivand at nhh.no>
>>
>> On Sun, 31 Jan 2010, Paulo Eduardo Cardoso wrote:
>>
>>> Roger,
>>>
>>> I really thank you for you comments. You are always available to explain
>>> everything, and that's a fortune for forum users.
>>> But I still with the same problem. I did,'t understand how to leave the
>>> inner hole or the inner polygon transparent, in order to see any other layer
>>> plotter at first.
>>> Should I send a simple example?
>>
>> Please do, either code for a provided data set, or code and a link to the URL where the data set is available.
>>
>> Roger
>>
>>>
>>> 2010/1/30 Roger Bivand <Roger.Bivand at nhh.no>
>>>
>>>> On Sat, 30 Jan 2010, Paulo Eduardo Cardoso wrote:
>>>>
>>>> ?I'd like to plot a SPDF with two objects, one of them buffering the other
>>>>>
>>>>> "island". How can I set the "island" transparent?
>>>>> Similarly, keeping the outer polygon only, how can the hole still
>>>>> transparent?
>>>>>
>>>>
>>>> Polygons objects are plotted largest to smallest, as are Polygon objects in
>>>> each Polygons object. Each Polygons object and all its constituent Polygon
>>>> objects are painted the colour chosen for that Polygons object.
>>>>
>>>> If you want the holes Polygon objects to overpaint their containing Polygon
>>>> objects, in the base graphics plot() method, you set the pbg= argument to
>>>> the background colour (not "transparent", this will let you see the painted
>>>> Polygon below). In the spplot method, this is handled internally by reading
>>>> the trellis.par.get()$background value, and using it if not "transparent",
>>>> or "white" if it is "transparent".
>>>>
>>>> Both approaches depend on the hole slot of the Polygon object being
>>>> correctly set.
>>>>
>>>> R graphics do not analyse objects leaving out say holes, they overpaint.
>>>> This is because the holes are not "known" in advance by the functions being
>>>> executed.
>>>>
>>>> Hope this helps,
>>>>
>>>> Roger
>>>>
>>>>
>>>>> Thanks in advance,
>>>>>
>>>>> Paulo E. Cardoso
>>>>>
>>>>> ? ? ? [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From paulo.mailing.list at gmail.com  Tue Feb  2 16:10:13 2010
From: paulo.mailing.list at gmail.com (Paulo Eduardo Cardoso)
Date: Tue, 2 Feb 2010 15:10:13 +0000
Subject: [R-sig-Geo] plot polygons - transparent holes/island
In-Reply-To: <alpine.LRH.2.00.1002021303310.16338@reclus.nhh.no>
References: <e805f391001300045o1d17574fwa7dec7710cde2c64@mail.gmail.com>
	<alpine.LRH.2.00.1001301458340.5068@reclus.nhh.no>
	<e805f391001301701p725ca5adu4095c035f8b6262a@mail.gmail.com>
	<alpine.LRH.2.00.1001311115220.9029@reclus.nhh.no>
	<e805f391002011434k6446920fw3d2b0234e958e2fc@mail.gmail.com>
	<alpine.LRH.2.00.1002021303310.16338@reclus.nhh.no>
Message-ID: <e805f391002020710w1fb1e464g20b8f2cc4b2df031@mail.gmail.com>

Hi,

A good work around for representation but not exactly what was
expected for the real dataset.

The image with alpha channel (transparency) is just a schema to
provide the idea of hidden points but they are not supposed to be
visible. Sorry.

Considering that all points are plotted at first, wihout using
"in-out", is there a way to overlap areas[1,] keeping "in" points
visible?

Paulo


2010/2/2 Roger Bivand <Roger.Bivand at nhh.no>:
> On Mon, 1 Feb 2010, Paulo Eduardo Cardoso wrote:
>
>> Hi,
>> Code exemple
>> library(maptools)
>> load(file='D:\\R\\transparencia\\TransparentPolygon.Rdata')
>> areas <- readShapeSpatial('D:\\R\\transparencia\\Areas.shp')
>> pontos <- readShapeSpatial('D:\\R\\transparencia\\Points.shp')
>> plot(pontos,pch=19,col=pontos$point)
>> plot(areas,pbg="transparent",bg="red",add=TRUE)
>>
>> data can be downloaded from
>>
>> http://rapidshare.com/files/344532718/TransparentPolygon.Rdata.html
>>
>> example image can be downloaded grom
>>
>> http://rapidshare.com/files/344533300/ExampleTransparentPolygon.png.html
>>
>
> The image cannot be reproduced with your plotting order, because the
> polygons overpaint the points. Crucially, the big square is completely
> painted. You also have two Polygons objects, one a square with a round hole,
> the other an island filling the hole. With your objects, you could do:
>
> plot(areas[1,], pbg="white", col="grey85", border="grey50") # set up
> background polygon and paint hole
> plot(areas[2,], angle=45, density=8, border="grey50", col="grey50",
> ?add=TRUE)
> # hatch the island polygon
> points(pontos[pontos$point=="in",], pch=16)
> # add the in points
> points(pontos[pontos$point=="out",], pch=22, col="grey50", bg="grey50")
> # and the out points
>
> If your output devive uses and alpha channel, you may be able to find other
> ways forward, but they will not be portable across devices.
>
> Hope this helps,
>
> Roger
>
>>
>>
>>
>>
>> 2010/1/31 Roger Bivand <Roger.Bivand at nhh.no>
>>>
>>> On Sun, 31 Jan 2010, Paulo Eduardo Cardoso wrote:
>>>
>>>> Roger,
>>>>
>>>> I really thank you for you comments. You are always available to explain
>>>> everything, and that's a fortune for forum users.
>>>> But I still with the same problem. I did,'t understand how to leave the
>>>> inner hole or the inner polygon transparent, in order to see any other
>>>> layer
>>>> plotter at first.
>>>> Should I send a simple example?
>>>
>>> Please do, either code for a provided data set, or code and a link to the
>>> URL where the data set is available.
>>>
>>> Roger
>>>
>>>>
>>>> 2010/1/30 Roger Bivand <Roger.Bivand at nhh.no>
>>>>
>>>>> On Sat, 30 Jan 2010, Paulo Eduardo Cardoso wrote:
>>>>>
>>>>> ?I'd like to plot a SPDF with two objects, one of them buffering the
>>>>> other
>>>>>>
>>>>>> "island". How can I set the "island" transparent?
>>>>>> Similarly, keeping the outer polygon only, how can the hole still
>>>>>> transparent?
>>>>>>
>>>>>
>>>>> Polygons objects are plotted largest to smallest, as are Polygon
>>>>> objects in
>>>>> each Polygons object. Each Polygons object and all its constituent
>>>>> Polygon
>>>>> objects are painted the colour chosen for that Polygons object.
>>>>>
>>>>> If you want the holes Polygon objects to overpaint their containing
>>>>> Polygon
>>>>> objects, in the base graphics plot() method, you set the pbg= argument
>>>>> to
>>>>> the background colour (not "transparent", this will let you see the
>>>>> painted
>>>>> Polygon below). In the spplot method, this is handled internally by
>>>>> reading
>>>>> the trellis.par.get()$background value, and using it if not
>>>>> "transparent",
>>>>> or "white" if it is "transparent".
>>>>>
>>>>> Both approaches depend on the hole slot of the Polygon object being
>>>>> correctly set.
>>>>>
>>>>> R graphics do not analyse objects leaving out say holes, they
>>>>> overpaint.
>>>>> This is because the holes are not "known" in advance by the functions
>>>>> being
>>>>> executed.
>>>>>
>>>>> Hope this helps,
>>>>>
>>>>> Roger
>>>>>
>>>>>
>>>>>> Thanks in advance,
>>>>>>
>>>>>> Paulo E. Cardoso
>>>>>>
>>>>>> ? ? ? [[alternative HTML version deleted]]
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>>
>>>>> --
>>>>> Roger Bivand
>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>> of
>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>>
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From Roger.Bivand at nhh.no  Tue Feb  2 16:33:50 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 2 Feb 2010 16:33:50 +0100 (CET)
Subject: [R-sig-Geo] plot polygons - transparent holes/island
In-Reply-To: <e805f391002020710w1fb1e464g20b8f2cc4b2df031@mail.gmail.com>
References: <e805f391001300045o1d17574fwa7dec7710cde2c64@mail.gmail.com>
	<alpine.LRH.2.00.1001301458340.5068@reclus.nhh.no>
	<e805f391001301701p725ca5adu4095c035f8b6262a@mail.gmail.com>
	<alpine.LRH.2.00.1001311115220.9029@reclus.nhh.no> 
	<e805f391002011434k6446920fw3d2b0234e958e2fc@mail.gmail.com>
	<alpine.LRH.2.00.1002021303310.16338@reclus.nhh.no>
	<e805f391002020710w1fb1e464g20b8f2cc4b2df031@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002021623260.16338@reclus.nhh.no>

On Tue, 2 Feb 2010, Paulo Eduardo Cardoso wrote:

> Hi,
>
> A good work around for representation but not exactly what was
> expected for the real dataset.
>
> The image with alpha channel (transparency) is just a schema to
> provide the idea of hidden points but they are not supposed to be
> visible. Sorry.
>
> Considering that all points are plotted at first, wihout using
> "in-out", is there a way to overlap areas[1,] keeping "in" points
> visible?

No, because the enclosing square overpaints them, and the hole is painted 
on top of that - that is the graphics model. The only way round would be 
(as old plotter-based representations) to make returning lines in to the 
hole and back out to the perimeter, so that the hole would be "outside" 
the square. This has been dropped everywhere because of the difficulty of 
hiding the "moorings". If you want to show the points in the hole in 
areas[1,], you have to paint areas[1,] first, then the points in the hole.

In general terms:

plot(areas[1,], pbg="white", col="grey85", border="grey50")
o <- overlay(pontos, areas[1,])
points(pontos[is.na(o),], pch=16)

shows the points in the hole, but you can't use a polygon with an 
un-"moored" hole as a mask.

Roger

>
> Paulo
>
>
> 2010/2/2 Roger Bivand <Roger.Bivand at nhh.no>:
>> On Mon, 1 Feb 2010, Paulo Eduardo Cardoso wrote:
>>
>>> Hi,
>>> Code exemple
>>> library(maptools)
>>> load(file='D:\\R\\transparencia\\TransparentPolygon.Rdata')
>>> areas <- readShapeSpatial('D:\\R\\transparencia\\Areas.shp')
>>> pontos <- readShapeSpatial('D:\\R\\transparencia\\Points.shp')
>>> plot(pontos,pch=19,col=pontos$point)
>>> plot(areas,pbg="transparent",bg="red",add=TRUE)
>>>
>>> data can be downloaded from
>>>
>>> http://rapidshare.com/files/344532718/TransparentPolygon.Rdata.html
>>>
>>> example image can be downloaded grom
>>>
>>> http://rapidshare.com/files/344533300/ExampleTransparentPolygon.png.html
>>>
>>
>> The image cannot be reproduced with your plotting order, because the
>> polygons overpaint the points. Crucially, the big square is completely
>> painted. You also have two Polygons objects, one a square with a round hole,
>> the other an island filling the hole. With your objects, you could do:
>>
>> plot(areas[1,], pbg="white", col="grey85", border="grey50") # set up
>> background polygon and paint hole
>> plot(areas[2,], angle=45, density=8, border="grey50", col="grey50",
>> ?add=TRUE)
>> # hatch the island polygon
>> points(pontos[pontos$point=="in",], pch=16)
>> # add the in points
>> points(pontos[pontos$point=="out",], pch=22, col="grey50", bg="grey50")
>> # and the out points
>>
>> If your output devive uses and alpha channel, you may be able to find other
>> ways forward, but they will not be portable across devices.
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>>
>>>
>>>
>>> 2010/1/31 Roger Bivand <Roger.Bivand at nhh.no>
>>>>
>>>> On Sun, 31 Jan 2010, Paulo Eduardo Cardoso wrote:
>>>>
>>>>> Roger,
>>>>>
>>>>> I really thank you for you comments. You are always available to explain
>>>>> everything, and that's a fortune for forum users.
>>>>> But I still with the same problem. I did,'t understand how to leave the
>>>>> inner hole or the inner polygon transparent, in order to see any other
>>>>> layer
>>>>> plotter at first.
>>>>> Should I send a simple example?
>>>>
>>>> Please do, either code for a provided data set, or code and a link to the
>>>> URL where the data set is available.
>>>>
>>>> Roger
>>>>
>>>>>
>>>>> 2010/1/30 Roger Bivand <Roger.Bivand at nhh.no>
>>>>>
>>>>>> On Sat, 30 Jan 2010, Paulo Eduardo Cardoso wrote:
>>>>>>
>>>>>> ?I'd like to plot a SPDF with two objects, one of them buffering the
>>>>>> other
>>>>>>>
>>>>>>> "island". How can I set the "island" transparent?
>>>>>>> Similarly, keeping the outer polygon only, how can the hole still
>>>>>>> transparent?
>>>>>>>
>>>>>>
>>>>>> Polygons objects are plotted largest to smallest, as are Polygon
>>>>>> objects in
>>>>>> each Polygons object. Each Polygons object and all its constituent
>>>>>> Polygon
>>>>>> objects are painted the colour chosen for that Polygons object.
>>>>>>
>>>>>> If you want the holes Polygon objects to overpaint their containing
>>>>>> Polygon
>>>>>> objects, in the base graphics plot() method, you set the pbg= argument
>>>>>> to
>>>>>> the background colour (not "transparent", this will let you see the
>>>>>> painted
>>>>>> Polygon below). In the spplot method, this is handled internally by
>>>>>> reading
>>>>>> the trellis.par.get()$background value, and using it if not
>>>>>> "transparent",
>>>>>> or "white" if it is "transparent".
>>>>>>
>>>>>> Both approaches depend on the hole slot of the Polygon object being
>>>>>> correctly set.
>>>>>>
>>>>>> R graphics do not analyse objects leaving out say holes, they
>>>>>> overpaint.
>>>>>> This is because the holes are not "known" in advance by the functions
>>>>>> being
>>>>>> executed.
>>>>>>
>>>>>> Hope this helps,
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>>>> Thanks in advance,
>>>>>>>
>>>>>>> Paulo E. Cardoso
>>>>>>>
>>>>>>> ? ? ? [[alternative HTML version deleted]]
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>>>
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Economic Geography Section, Department of Economics, Norwegian School
>>>>>> of
>>>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>
>>>>>>
>>>>>
>>>>
>>>> --
>>>> Roger Bivand
>>>> Economic Geography Section, Department of Economics, Norwegian School of
>>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From darribas at unizar.es  Tue Feb  2 16:38:50 2010
From: darribas at unizar.es (Daniel Arribas-Bel)
Date: Tue, 2 Feb 2010 16:38:50 +0100
Subject: [R-sig-Geo] WikiPedia page on Spatial Analysis Software
Message-ID: <b9ed9a1e1002020738n65bcaebfy5006885b48b599eb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100202/628939c0/attachment.pl>

From rusers.sh at gmail.com  Wed Feb  3 04:18:44 2010
From: rusers.sh at gmail.com (rusers.sh)
Date: Tue, 2 Feb 2010 22:18:44 -0500
Subject: [R-sig-Geo] generate simulation data for a theoretical spatial
	model
In-Reply-To: <4B67D69F.2040003@uni-muenster.de>
References: <4B654953.4070102@spatial-analyst.net>
	<a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>
	<4B67D69F.2040003@uni-muenster.de>
Message-ID: <a835c81e1002021918r184fa313la64adf2de13704c4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100202/6d05f609/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Feb  3 07:54:45 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 03 Feb 2010 07:54:45 +0100
Subject: [R-sig-Geo] generate simulation data for a theoretical spatial
 model
In-Reply-To: <a835c81e1002021918r184fa313la64adf2de13704c4@mail.gmail.com>
References: <4B654953.4070102@spatial-analyst.net>	
	<a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>	
	<4B67D69F.2040003@uni-muenster.de>
	<a835c81e1002021918r184fa313la64adf2de13704c4@mail.gmail.com>
Message-ID: <4B691DB5.5050401@uni-muenster.de>

rusers.sh,

demo(ugsim)

in package gstat gives an example how to generate unconditional Gaussian 
simulations. Specifying the covariates in a formula and the parameter 
vector beta will add a deterministic trend to that.

If, in addition to that, you want unconditionally simulated residuals 
added to a trend effect that is simulated as well, look at rmvnorm in 
package mvtnorm how to generate realisations from the multivariate 
normal distribution with given mean and covariance; finally, combine the 
two.
--
Edzer

rusers.sh wrote:
>   It works. The problem is that it only generates the simulated data 
> based on our observed dataset,e.g. "meuse" here. 
>   I wonder if we can generate the simulated dataset from the 
> user-specified model with covariates included, such as 
> y~a1*x1+a2*x2+spatial effect. Y can be continuous or 0/1 variables. 
> Something like this.
>   The idea is we first specify a theoretical model, and then generate 
> the simulated data based on this model. The coefficients and spatial 
> effects are fixed by users, so we may study some new methods.
>   Thanks.
>
> 2010/2/2 Edzer Pebesma <edzer.pebesma at uni-muenster.de 
> <mailto:edzer.pebesma at uni-muenster.de>>
>
>
>
>     rusers.sh wrote:
>
>         Hi Tomislav,
>          Thanks for your info on unconditional simulation. For conditional
>         simulations, i still cannot find any useful information.
>          I searched the R site and didnot find the possible method to do
>         conditional simulations.
>         1. CondSimu(RandomField): trend: Not programmed yet. (used by
>         universal
>         kriging)
>         2. grf(geoR): generates unconditional simulations of Gaussian
>         random fields
>         3. sim.Krig(fields)  #Conditonal simulation of a spatial process
>           It seems to be based on the actual dataset,not a theoretical
>         model.
>         4. krige(gstat ):Simple, Ordinary or Universal, global or
>         local, Point or
>         Block Kriging,or simulation
>          x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, block =
>         c(40,40),nsim=1)
>          
>
>     rusers.sh, please use
>
>     x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, nmax=40,
>     nsim=1)
>
>     both adding the block=c(40,40) as well as omitting the nmax=40
>     tremendously increased the computing time you needed, the second
>     even more (in an O(n^2) manner) than the first.
>     --
>     Edzer
>
>
>
>
>          I used the above modified codes from krige(gstat ) example to
>         see the
>         effect of "nsim", but unfortunately, it took a longer time and
>         cannot get
>         the results. I guess it used the simulation method to test the
>         model, not
>         what i want. (My system is XP, R2.10.0, gstat09.-64.)
>          Anybody can give me further information on generating the
>         conditional
>         simulations from a theoretical model just like the
>         unconditional examples
>         that Tomislav provided?
>          Thanks a lot.
>
>
>         2010/1/31 Tomislav Hengl <hengl at spatial-analyst.net
>         <mailto:hengl at spatial-analyst.net>>
>
>          
>
>             Dear rusers.sh,
>
>             Here are few simple examples of how to simulate (not-normal)
>             distributions and point processes using geoR and spatstat:
>
>             http://spatial-analyst.net/book/node/388
>
>             See also:
>
>
>             http://leg.ufpr.br/geoR/geoRdoc/vignette/geoRintro/geoRintrose8.html#x9-120008
>
>             I guess that covariates can be also included (I guess that
>             you then need
>             to switch to conditional simulations - not sure).
>
>             This should also work for lattice (polygon) data so that
>             you will have
>             jumps in values (but I guess you would still work in
>             gridded systems?).
>
>             T. Hengl
>             http://home.medewerker.uva.nl/t.hengl/
>
>
>             rusers.sh wrote:
>
>                
>
>                 Hi all,
>                  In classical statistics, we always need to generate a
>                 theoretical model
>                 such as y=a+b1*x1+b2*x2+e to study some new estimation
>                 content. I am
>                 wondering how to generate the similar spatial dataset
>                 for a theoretical
>                 model.
>                 Say y is response variable, x1 and x2 are explanatory
>                 variables.
>                 1. If y is a continous variable, how should we
>                 generate the dataset for a
>                 theoretical spatial point process model in R?
>                 2. If y is a continous variable, how should we
>                 generate the dataset for a
>                 theoretical spatial lattice data model in R?
>                 3. If y is 0/1 binary variable, how should we generate
>                 the dataset for a
>                 theoretical spatial point process model in R?
>                 4. If y is 0/1 binary variable, how should we generate
>                 the dataset for a
>                 ttheoretical spatial lattice data in R?
>                  spatstat and other packages allow us to generate a
>                 dataset of a specified
>                 point process and other models, but it seems that they
>                 donot allow us to
>                 include possible explanatory variables into a
>                 theoretical model. Maybe i
>                 missed some ideas in them.
>                  Anybody can express some ideas or point out some
>                 useful resources on the
>                 above four different situations? Small examples in R
>                 are preferred.
>                  Thanks a lot.
>
>
>                      
>
>             _______________________________________________
>             R-sig-Geo mailing list
>             R-sig-Geo at stat.math.ethz.ch
>             <mailto:R-sig-Geo at stat.math.ethz.ch>
>             https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>                
>
>
>
>
>          
>
>
>     -- 
>     Edzer Pebesma
>     Institute for Geoinformatics (ifgi), University of M?nster Weseler
>     Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax:
>     +49 251 8339763  http://ifgi.uni-muenster.de
>     http://www.52north.org/geostatistics      e.pebesma at wwu.de
>     <mailto:e.pebesma at wwu.de>
>
>
>
>
> -- 
> -----------------
> Jane Chang
> Queen's

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From p.hiemstra at geo.uu.nl  Wed Feb  3 12:06:05 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 03 Feb 2010 12:06:05 +0100
Subject: [R-sig-Geo] help with areal interpolation I think
In-Reply-To: <1516849282.433601264741111513.JavaMail.root@sz0111a.emeryville.ca.mail.comcast.net>
References: <1516849282.433601264741111513.JavaMail.root@sz0111a.emeryville.ca.mail.comcast.net>
Message-ID: <4B69589D.8080803@geo.uu.nl>

musche1 at comcast.net wrote:
> Being new to spatial analysis I don't have the right vocabulary. I have purchased the book applied spatial data analysis in r, but not received yet. 
>
> I have a set of irregularly spaced points (utmx,utmy) where animals were sampled. So for each point I have a location and a species count. There is a spatial pattern in the data (for richness) - it is not just random. I have used a gam from mgcv to model the data. I would like to overlay a shapefile of polygons (watersheds) over the point data and in the end estimate the expected number of species in a watershed. For example if a watershed overlayed two bands of species richness one for a richness of 5 and one for a richness of 6 and each were equally represented in the watershed the expected number for a point in the watershed would be 5.5. Can someone point me in the right direction or provide terminology and/or packages that may do this. thank you. 
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
Hi,

What comes to my mind are the following papers:

@ARTICLE{Royle2005,
  author = {Royle, J.A. and Wikle, C.K.},
  title = {Efficient statistical mapping of avian count data},
  journal = {Environ. Ecol. Stat.},
  year = {2005},
  volume = {12},
  pages = {225--243},
  number = {2}
}
doi: 10.1007/s10651-005-1043-4

@ARTICLE{Pebesma2005b,
  author = {Pebesma, E.J. and Duin, R.N.M. and Burrough, P.A.},
  title = {Mapping sea bird densities over the North Sea: Spatially 
aggregated
    estimates and temporal changes},
  journal = {Environmetrics},
  year = {2005},
  volume = {16},
  pages = {573--587},
  number = {6},
  timestamp = {2010.02.03},
  url = 
{http://www.scopus.com/inward/record.url?eid=2-s2.0-24944447904&partnerID=40&md5=88b8634524719043b9fad1bb71f2c9ca}
}

You could take a look at the papers and see what you can use.

cheers,
Paul



-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From paulojus at c3sl.ufpr.br  Wed Feb  3 12:18:46 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 3 Feb 2010 09:18:46 -0200 (BRST)
Subject: [R-sig-Geo] generate simulation data for a theoretical spatial
 model
In-Reply-To: <4B691DB5.5050401@uni-muenster.de>
References: <4B654953.4070102@spatial-analyst.net>
	<a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>
	<4B67D69F.2040003@uni-muenster.de>
	<a835c81e1002021918r184fa313la64adf2de13704c4@mail.gmail.com>
	<4B691DB5.5050401@uni-muenster.de>
Message-ID: <alpine.DEB.1.10.1002030908270.3026@bowmore.c3sl.ufpr.br>

Just to add that besides unconditional simulation as discussed there are 
some functionality for conditional simulations is some packages.
Is geoR the functions krige.conv() and krige.bayes() have an option for 
that and in geoRglm the krige.binom(), krige.pois() or krige.glsm() also 
does that. Except the first in geoR, the functions implements predictions 
under the Bayesian paradigma relying on (conditional) simulations in their 
algorithms. The algorithms have an argument to "keep" the simulations on 
the resulting object.
They are based on the approach of assuming an hierarquical 
spatial model with  an underlying (latent) Gaussian field $S$
(even when the responses $Y$ are no Gaussian) and the conditional 
simulatios are for such 
latent field from which simulations on the scale of the response variable 
can be obtained if wished under the conditional independence of the 
responses $Y$ given $S$.


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus



On Wed, 3 Feb 2010, Edzer Pebesma wrote:

> rusers.sh,
>
> demo(ugsim)
>
> in package gstat gives an example how to generate unconditional Gaussian 
> simulations. Specifying the covariates in a formula and the parameter vector 
> beta will add a deterministic trend to that.
>
> If, in addition to that, you want unconditionally simulated residuals added 
> to a trend effect that is simulated as well, look at rmvnorm in package 
> mvtnorm how to generate realisations from the multivariate normal 
> distribution with given mean and covariance; finally, combine the two.
> --
> Edzer
>
> rusers.sh wrote:
>>   It works. The problem is that it only generates the simulated data based 
>> on our observed dataset,e.g. "meuse" here.   I wonder if we can generate 
>> the simulated dataset from the user-specified model with covariates 
>> included, such as y~a1*x1+a2*x2+spatial effect. Y can be continuous or 0/1 
>> variables. Something like this.
>>   The idea is we first specify a theoretical model, and then generate the 
>> simulated data based on this model. The coefficients and spatial effects 
>> are fixed by users, so we may study some new methods.
>>   Thanks.
>> 
>> 2010/2/2 Edzer Pebesma <edzer.pebesma at uni-muenster.de 
>> <mailto:edzer.pebesma at uni-muenster.de>>
>> 
>> 
>>
>>     rusers.sh wrote:
>>
>>         Hi Tomislav,
>>          Thanks for your info on unconditional simulation. For conditional
>>         simulations, i still cannot find any useful information.
>>          I searched the R site and didnot find the possible method to do
>>         conditional simulations.
>>         1. CondSimu(RandomField): trend: Not programmed yet. (used by
>>         universal
>>         kriging)
>>         2. grf(geoR): generates unconditional simulations of Gaussian
>>         random fields
>>         3. sim.Krig(fields)  #Conditonal simulation of a spatial process
>>           It seems to be based on the actual dataset,not a theoretical
>>         model.
>>         4. krige(gstat ):Simple, Ordinary or Universal, global or
>>         local, Point or
>>         Block Kriging,or simulation
>>          x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, block =
>>         c(40,40),nsim=1)
>>
>>     rusers.sh, please use
>>
>>     x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, nmax=40,
>>     nsim=1)
>>
>>     both adding the block=c(40,40) as well as omitting the nmax=40
>>     tremendously increased the computing time you needed, the second
>>     even more (in an O(n^2) manner) than the first.
>>     --
>>     Edzer
>> 
>> 
>> 
>>
>>          I used the above modified codes from krige(gstat ) example to
>>         see the
>>         effect of "nsim", but unfortunately, it took a longer time and
>>         cannot get
>>         the results. I guess it used the simulation method to test the
>>         model, not
>>         what i want. (My system is XP, R2.10.0, gstat09.-64.)
>>          Anybody can give me further information on generating the
>>         conditional
>>         simulations from a theoretical model just like the
>>         unconditional examples
>>         that Tomislav provided?
>>          Thanks a lot.
>> 
>>
>>         2010/1/31 Tomislav Hengl <hengl at spatial-analyst.net
>>         <mailto:hengl at spatial-analyst.net>>
>>
>>
>>             Dear rusers.sh,
>>
>>             Here are few simple examples of how to simulate (not-normal)
>>             distributions and point processes using geoR and spatstat:
>>
>>             http://spatial-analyst.net/book/node/388
>>
>>             See also:
>> 
>>
>>             http://leg.ufpr.br/geoR/geoRdoc/vignette/geoRintro/geoRintrose8.html#x9-120008
>>
>>             I guess that covariates can be also included (I guess that
>>             you then need
>>             to switch to conditional simulations - not sure).
>>
>>             This should also work for lattice (polygon) data so that
>>             you will have
>>             jumps in values (but I guess you would still work in
>>             gridded systems?).
>>
>>             T. Hengl
>>             http://home.medewerker.uva.nl/t.hengl/
>> 
>>
>>             rusers.sh wrote:
>>
>>
>>                 Hi all,
>>                  In classical statistics, we always need to generate a
>>                 theoretical model
>>                 such as y=a+b1*x1+b2*x2+e to study some new estimation
>>                 content. I am
>>                 wondering how to generate the similar spatial dataset
>>                 for a theoretical
>>                 model.
>>                 Say y is response variable, x1 and x2 are explanatory
>>                 variables.
>>                 1. If y is a continous variable, how should we
>>                 generate the dataset for a
>>                 theoretical spatial point process model in R?
>>                 2. If y is a continous variable, how should we
>>                 generate the dataset for a
>>                 theoretical spatial lattice data model in R?
>>                 3. If y is 0/1 binary variable, how should we generate
>>                 the dataset for a
>>                 theoretical spatial point process model in R?
>>                 4. If y is 0/1 binary variable, how should we generate
>>                 the dataset for a
>>                 ttheoretical spatial lattice data in R?
>>                  spatstat and other packages allow us to generate a
>>                 dataset of a specified
>>                 point process and other models, but it seems that they
>>                 donot allow us to
>>                 include possible explanatory variables into a
>>                 theoretical model. Maybe i
>>                 missed some ideas in them.
>>                  Anybody can express some ideas or point out some
>>                 useful resources on the
>>                 above four different situations? Small examples in R
>>                 are preferred.
>>                  Thanks a lot.
>> 
>>
>>
>>             _______________________________________________
>>             R-sig-Geo mailing list
>>             R-sig-Geo at stat.math.ethz.ch
>>             <mailto:R-sig-Geo at stat.math.ethz.ch>
>>             https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> 
>> 
>> 
>>
>> 
>>
>>     --     Edzer Pebesma
>>     Institute for Geoinformatics (ifgi), University of M?nster Weseler
>>     Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax:
>>     +49 251 8339763  http://ifgi.uni-muenster.de
>>     http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>     <mailto:e.pebesma at wwu.de>
>> 
>> 
>> 
>> 
>> -- 
>> -----------------
>> Jane Chang
>> Queen's
>
> -- 
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 
> 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763 
> http://ifgi.uni-muenster.de http://www.52north.org/geostatistics 
> e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

From paulojus at c3sl.ufpr.br  Wed Feb  3 12:55:30 2010
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 3 Feb 2010 09:55:30 -0200 (BRST)
Subject: [R-sig-Geo] generate simulation data for a theoretical spatial
 model
In-Reply-To: <a835c81e1002021918r184fa313la64adf2de13704c4@mail.gmail.com>
References: <4B654953.4070102@spatial-analyst.net>
	<a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>
	<4B67D69F.2040003@uni-muenster.de>
	<a835c81e1002021918r184fa313la64adf2de13704c4@mail.gmail.com>
Message-ID: <alpine.DEB.1.10.1002030941210.3026@bowmore.c3sl.ufpr.br>


It is dificult if not irrealistic to set Y to be 0/1 (ou interger counts 
or similar) in such model since this would impose severe contraints in the
a's and x's as well as in the model structure.

This is why the hierarquical model structure is one possible
working around. The ideia is the same as in generalised linear models 
relating the covariates (x's) and spatial effect to as function of the
expected value of Y instead of directly with Y.
In a "loose" notation:
Y_i ~ "some distribution" with E[Y_i] = \mu_i 
g(\mu_i) = a1*x1+a2*x2+spatial effect

where g() is a "convenient" function mapping (-Inf, +Inf)
to the parameter space of \mu_i

Some examples:

1. For binay (0/1) observations a possible model would be
Y_i ~ B(p_i)
log(p_i/(1-p_i) = a1*x1+a2*x2+spatial effect

2. For count data:
Y_i ~ B(\lambda_i)
log(\lambda_i) = a1*x1+a2*x2+spatial effect

3. For Gaussian data
Y_i ~ N(\mu_i, \tau^2)
\mu_i = a1*x1+a2*x2+spatial effect
which in this particular case can be written as
Y_i = a1*x1+a2*x2+spatial effect


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus



On Tue, 2 Feb 2010, rusers.sh wrote:

>  It works. The problem is that it only generates the simulated data based
> on our observed dataset,e.g. "meuse" here.
>  I wonder if we can generate the simulated dataset from the user-specified
> model with covariates included, such as y~a1*x1+a2*x2+spatial effect. Y can
> be continuous or 0/1 variables. Something like this.
>  The idea is we first specify a theoretical model, and then generate the
> simulated data based on this model. The coefficients and spatial effects are
> fixed by users, so we may study some new methods.
>  Thanks.
>
> 2010/2/2 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
>
>>
>>
>> rusers.sh wrote:
>>
>>> Hi Tomislav,
>>>  Thanks for your info on unconditional simulation. For conditional
>>> simulations, i still cannot find any useful information.
>>>  I searched the R site and didnot find the possible method to do
>>> conditional simulations.
>>> 1. CondSimu(RandomField): trend: Not programmed yet. (used by universal
>>> kriging)
>>> 2. grf(geoR): generates unconditional simulations of Gaussian random
>>> fields
>>> 3. sim.Krig(fields)  #Conditonal simulation of a spatial process
>>>   It seems to be based on the actual dataset,not a theoretical model.
>>> 4. krige(gstat ):Simple, Ordinary or Universal, global or local, Point or
>>> Block Kriging,or simulation
>>>  x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, block =
>>> c(40,40),nsim=1)
>>>
>>>
>> rusers.sh, please use
>>
>> x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, nmax=40, nsim=1)
>>
>> both adding the block=c(40,40) as well as omitting the nmax=40 tremendously
>> increased the computing time you needed, the second even more (in an O(n^2)
>> manner) than the first.
>> --
>> Edzer
>>
>>
>>
>>
>>   I used the above modified codes from krige(gstat ) example to see the
>>> effect of "nsim", but unfortunately, it took a longer time and cannot get
>>> the results. I guess it used the simulation method to test the model, not
>>> what i want. (My system is XP, R2.10.0, gstat09.-64.)
>>>  Anybody can give me further information on generating the conditional
>>> simulations from a theoretical model just like the unconditional examples
>>> that Tomislav provided?
>>>  Thanks a lot.
>>>
>>>
>>> 2010/1/31 Tomislav Hengl <hengl at spatial-analyst.net>
>>>
>>>
>>>
>>>> Dear rusers.sh,
>>>>
>>>> Here are few simple examples of how to simulate (not-normal)
>>>> distributions and point processes using geoR and spatstat:
>>>>
>>>> http://spatial-analyst.net/book/node/388
>>>>
>>>> See also:
>>>>
>>>>
>>>>
>>>> http://leg.ufpr.br/geoR/geoRdoc/vignette/geoRintro/geoRintrose8.html#x9-120008
>>>>
>>>> I guess that covariates can be also included (I guess that you then need
>>>> to switch to conditional simulations - not sure).
>>>>
>>>> This should also work for lattice (polygon) data so that you will have
>>>> jumps in values (but I guess you would still work in gridded systems?).
>>>>
>>>> T. Hengl
>>>> http://home.medewerker.uva.nl/t.hengl/
>>>>
>>>>
>>>> rusers.sh wrote:
>>>>
>>>>
>>>>
>>>>> Hi all,
>>>>>  In classical statistics, we always need to generate a theoretical model
>>>>> such as y=a+b1*x1+b2*x2+e to study some new estimation content. I am
>>>>> wondering how to generate the similar spatial dataset for a theoretical
>>>>> model.
>>>>> Say y is response variable, x1 and x2 are explanatory variables.
>>>>> 1. If y is a continous variable, how should we generate the dataset for
>>>>> a
>>>>> theoretical spatial point process model in R?
>>>>> 2. If y is a continous variable, how should we generate the dataset for
>>>>> a
>>>>> theoretical spatial lattice data model in R?
>>>>> 3. If y is 0/1 binary variable, how should we generate the dataset for a
>>>>> theoretical spatial point process model in R?
>>>>> 4. If y is 0/1 binary variable, how should we generate the dataset for a
>>>>> ttheoretical spatial lattice data in R?
>>>>>  spatstat and other packages allow us to generate a dataset of a
>>>>> specified
>>>>> point process and other models, but it seems that they donot allow us to
>>>>> include possible explanatory variables into a theoretical model. Maybe i
>>>>> missed some ideas in them.
>>>>>  Anybody can express some ideas or point out some useful resources on
>>>>> the
>>>>> above four different situations? Small examples in R are preferred.
>>>>>  Thanks a lot.
>>>>>
>>>>>
>>>>>
>>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>>
>>>
>>>
>>>
>>>
>>>
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e
>> 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763
>> http://ifgi.uni-muenster.de http://www.52north.org/geostatistics
>> e.pebesma at wwu.de
>>
>>
>
>
> -- 
> -----------------
> Jane Chang
> Queen's
>
> 	[[alternative HTML version deleted]]
>
>


From mhchen at stat.ncku.edu.tw  Wed Feb  3 14:49:21 2010
From: mhchen at stat.ncku.edu.tw (=?big5?B?s6+p+qe7?=)
Date: Wed, 3 Feb 2010 21:49:21 +0800
Subject: [R-sig-Geo] About Markov Random field
Message-ID: <F310C0BB10D2F54CAAD4AE9797D3AC3CC203B9@EXCHANGE.stat.ncku.edu.tw>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100203/a4b1dedb/attachment.pl>

From freddy.vate01 at gmail.com  Wed Feb  3 14:51:51 2010
From: freddy.vate01 at gmail.com (=?UTF-8?Q?Freddy_L=C3=B3pez?=)
Date: Wed, 3 Feb 2010 07:51:51 -0600
Subject: [R-sig-Geo] About Markov Random field
In-Reply-To: <F310C0BB10D2F54CAAD4AE9797D3AC3CC203B9@EXCHANGE.stat.ncku.edu.tw>
References: <F310C0BB10D2F54CAAD4AE9797D3AC3CC203B9@EXCHANGE.stat.ncku.edu.tw>
Message-ID: <cac512fc1002030551w7676971dmcd224dde50c517c7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100203/66cacaad/attachment.pl>

From rusers.sh at gmail.com  Wed Feb  3 17:18:55 2010
From: rusers.sh at gmail.com (rusers.sh)
Date: Wed, 3 Feb 2010 11:18:55 -0500
Subject: [R-sig-Geo] generate simulation data for a theoretical spatial
	model
In-Reply-To: <alpine.DEB.1.10.1002030941210.3026@bowmore.c3sl.ufpr.br>
References: <4B654953.4070102@spatial-analyst.net>
	<a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>
	<4B67D69F.2040003@uni-muenster.de>
	<a835c81e1002021918r184fa313la64adf2de13704c4@mail.gmail.com>
	<alpine.DEB.1.10.1002030941210.3026@bowmore.c3sl.ufpr.br>
Message-ID: <a835c81e1002030818g58ab4775o1c15fd94ec359bc5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100203/5436b48f/attachment.pl>

From jthayn at ilstu.edu  Wed Feb  3 17:23:36 2010
From: jthayn at ilstu.edu (Jonathan Thayn)
Date: Wed, 3 Feb 2010 10:23:36 -0600
Subject: [R-sig-Geo] NDVI time-series filter
In-Reply-To: <000001caa18e$b2f4b510$18de1f30$@net>
References: <5CDBB1ED-CA5B-408F-AB22-9654B0019F29@ilstu.edu>
	<000001caa18e$b2f4b510$18de1f30$@net>
Message-ID: <03B72F04-B59B-4BEA-A87A-69B20D86ECDD@ilstu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100203/8b598a4c/attachment.pl>

From everton.emanuel at gmail.com  Wed Feb  3 19:56:17 2010
From: everton.emanuel at gmail.com (Everton Emanuel)
Date: Wed, 3 Feb 2010 16:56:17 -0200
Subject: [R-sig-Geo] How to diplasy a compass rose on a map
Message-ID: <df06e3df1002031056o594f37bcqea1fd3a66e49cae0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100203/d2d910ca/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Feb  3 21:27:37 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 03 Feb 2010 21:27:37 +0100
Subject: [R-sig-Geo] How to diplasy a compass rose on a map
In-Reply-To: <df06e3df1002031056o594f37bcqea1fd3a66e49cae0@mail.gmail.com>
References: <df06e3df1002031056o594f37bcqea1fd3a66e49cae0@mail.gmail.com>
Message-ID: <4B69DC39.6030309@uni-muenster.de>

The closest I know of is the north arrow I crafted, shown at fig 3 in

http://r-spatial.sourceforge.net/gallery/

If you create a nice one, we'd be grateful when you would donate it to sp!

Everton Emanuel wrote:
> Dear all,
>
> I want to display a "compass rose" on a map, but I have no idea how to do
> that. Do you know how can I display a compass rose on a map?
>
> Thank you all,
> Everton.
>
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From hengl at spatial-analyst.net  Wed Feb  3 21:52:57 2010
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Wed, 03 Feb 2010 21:52:57 +0100
Subject: [R-sig-Geo] How to diplasy a compass rose on a map
In-Reply-To: <df06e3df1002031056o594f37bcqea1fd3a66e49cae0@mail.gmail.com>
References: <df06e3df1002031056o594f37bcqea1fd3a66e49cae0@mail.gmail.com>
Message-ID: <4B69E229.1050704@spatial-analyst.net>


Package StatDA has an option to generate a nort arrow (I am sure you 
could easily replace this with any symbol you prefer):

 > Northarrow(Xbottom, Ybottom, Xtop, Ytop, Xtext, Ytext, Alength, 
Aangle, Alwd, Tcex)

Here are some examples of publication ready maps:

http://www.statistik.tuwien.ac.at/StatDA/R-scripts/page131.html

These plots are something that a cartographer would like to see in R, 
but the code is long! And of course you need to (manually) get all 
coordinates and dimensions of legend, scale bar and arrow for your study 
area  :(

T. Hengl
http://home.medewerker.uva.nl/t.hengl/


Everton Emanuel wrote:
> Dear all,
> 
> I want to display a "compass rose" on a map, but I have no idea how to do
> that. Do you know how can I display a compass rose on a map?
> 
> Thank you all,
> Everton.
>


From jim at bitwrit.com.au  Thu Feb  4 01:48:07 2010
From: jim at bitwrit.com.au (Jim Lemon)
Date: Thu, 04 Feb 2010 11:48:07 +1100
Subject: [R-sig-Geo] How to diplasy a compass rose on a map
In-Reply-To: <df06e3df1002031056o594f37bcqea1fd3a66e49cae0@mail.gmail.com>
References: <df06e3df1002031056o594f37bcqea1fd3a66e49cae0@mail.gmail.com>
Message-ID: <4B6A1947.5010001@bitwrit.com.au>

On 02/04/2010 05:56 AM, Everton Emanuel wrote:
> Dear all,
>
> I want to display a "compass rose" on a map, but I have no idea how
> to do that. Do you know how can I display a compass rose on a map?
>
Hi Everton,
Here's a very basic compass rose function. rot is in degrees. I'll tart
it up a bit and put it in the next version of plotrix, unless the Geo
people think it should go in one of the mapping packages.

Jim

compassRose<-function(x,y,rot=0,cex=1) {
  oldcex<-par(cex=cex)
  mheight<-strheight("M")
  xylim<-par("usr")
  plotdim<-par("pin")
  xmult<-(xylim[2]-xylim[1])/(xylim[4]-xylim[3])*plotdim[2]/plotdim[1]
  point.angles<-seq(0,7*pi/4,by=pi/4)+pi*rot/180
  crspans<-rep(c(mheight*3,mheight/2),4)
  xpoints<-cos(point.angles)*crspans*xmult+x
  ypoints<-sin(point.angles)*crspans+y
  polygon(xpoints,ypoints)
  txtxpoints<-cos(point.angles[c(1,3,5,7)])*1.33*crspans[1]*xmult+x
  txtypoints<-sin(point.angles[c(1,3,5,7)])*1.33*crspans[1]+y
  text(txtxpoints,txtypoints,c("E","N","W","S"))
  par(oldcex)
}


From greenberg at ucdavis.edu  Thu Feb  4 03:38:38 2010
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Wed, 03 Feb 2010 18:38:38 -0800
Subject: [R-sig-Geo] Vector to raster "zone" conversion...
Message-ID: <4B6A332E.50508@ucdavis.edu>

Rsiggeo'ers:

    Given a vector file containing polygons and a raster file of the 
same projection, I would like to create raster "zones" based on the 
polygons -- e.g. I would like to rasterize the vector polygon at the 
resolution of the raster.  I'm not seeing any obvious way to do this -- 
any ideas?  In the end, I want a set of x,y coordinates of all pixels 
which fall within a given polygon -- ideally I'd like donuts to be 
properly rasterized, and some level of control on how much of a pixel 
must fall within a polygon to "count".  I'm trying to port my program 
"starspan" over to R to provide a much needed training/test data import 
capability to complement rgdal and raster's capabilities. 

    Thanks!

--j

-- 

Jonathan A. Greenberg, PhD
Postdoctoral Scholar
Center for Spatial Technologies and Remote Sensing (CSTARS)
University of California, Davis
One Shields Avenue
The Barn, Room 250N
Davis, CA 95616
Phone: 415-763-5476
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From christoph.hofer at env.ethz.ch  Thu Feb  4 08:55:33 2010
From: christoph.hofer at env.ethz.ch (Christoph Hofer)
Date: Thu, 4 Feb 2010 08:55:33 +0100
Subject: [R-sig-Geo] generate simulation data for a theoretical spatial
	model
In-Reply-To: <a835c81e1002030818g58ab4775o1c15fd94ec359bc5@mail.gmail.com>
References: <4B654953.4070102@spatial-analyst.net>
	<a835c81e1002011819m650fedeyf4eb0b6e739da961@mail.gmail.com>
	<4B67D69F.2040003@uni-muenster.de>
	<a835c81e1002021918r184fa313la64adf2de13704c4@mail.gmail.com>
	<alpine.DEB.1.10.1002030941210.3026@bowmore.c3sl.ufpr.br>
	<a835c81e1002030818g58ab4775o1c15fd94ec359bc5@mail.gmail.com>
Message-ID: <9B7024A3-B714-4391-87EF-ABD7C8AECEDD@env.ethz.ch>

rusers.sh,

You can simulate stationary and isotropic Gaussian random fields ( and transformation of it)  as well as max-stable random fields
by using the RandomFields package.
To get a conditional simulation of the correlated residuals of a linear model
you can first simulate an unconditional realization (\mu = 0 and a given covariance structure),
 then choose the data location and make a simple kriging prediction of this realization. 
Now, take the difference between the unconditional simulation and the simple kriging prediction and you
get one realization of a simulated conditional error term. Now, if you add this term to  a kriging estimation
you get one conditional simulation.

You find a detail descripitoin of this procedure called "Conditioning by kriging" in the book
Geostatistics: Modeling Spatial Uncertainty ( 1999) of Chil?s, J.-P. and Delfiner, P



Sorry, for my bad english (I'm working on it).


Christoph


Am 03.02.2010 um 17:18 schrieb rusers.sh:

> For the method to generate the theoretical models, i agree with you
> completely. For binay (0/1) observations, it will be better to do as
> follows.
>  Y_i ~ B(p_i)
>  log(p_i/(1-p_i) = a1*x1+a2*x2+spatial effect
>  Take the above model as an example. Unfortunately, i still cannot figure
> out how to generate the conditional and unconditional spatial effects.
> #generate two covariates, x1 and x2
> library(mvtnorm)
> x1x2<-rmvnorm(100,mean=c(2,4),method="svd")
> colnames(x1x2)<-c("x1","x2")
> #Then, how to generate the conditional and unconditional spatial effects
> into the above model,respectively.
>  I think my mode of thinking on generating the spatial model in R must be
> at a dead end and needs guiding.
>  I appreciate your help very much.
> 
> 
> 2010/2/3 Paulo Justiniano Ribeiro Jr <paulojus at c3sl.ufpr.br>
> 
>> 
>> It is dificult if not irrealistic to set Y to be 0/1 (ou interger counts or
>> similar) in such model since this would impose severe contraints in the
>> a's and x's as well as in the model structure.
>> 
>> This is why the hierarquical model structure is one possible
>> working around. The ideia is the same as in generalised linear models
>> relating the covariates (x's) and spatial effect to as function of the
>> expected value of Y instead of directly with Y.
>> In a "loose" notation:
>> Y_i ~ "some distribution" with E[Y_i] = \mu_i g(\mu_i) =
>> a1*x1+a2*x2+spatial effect
>> 
>> where g() is a "convenient" function mapping (-Inf, +Inf)
>> to the parameter space of \mu_i
>> 
>> Some examples:
>> 
>> 1. For binay (0/1) observations a possible model would be
>> Y_i ~ B(p_i)
>> log(p_i/(1-p_i) = a1*x1+a2*x2+spatial effect
>> 
>> 2. For count data:
>> Y_i ~ B(\lambda_i)
>> log(\lambda_i) = a1*x1+a2*x2+spatial effect
>> 
>> 3. For Gaussian data
>> Y_i ~ N(\mu_i, \tau^2)
>> \mu_i = a1*x1+a2*x2+spatial effect
>> which in this particular case can be written as
>> Y_i = a1*x1+a2*x2+spatial effect
>> 
>> 
>> 
>> Paulo Justiniano Ribeiro Jr
>> LEG (Laboratorio de Estatistica e Geoinformacao)
>> Universidade Federal do Parana
>> Caixa Postal 19.081
>> CEP 81.531-990
>> Curitiba, PR  -  Brasil
>> Tel: (+55) 41 3361 3573
>> Fax: (+55) 41 3361 3141
>> e-mail: paulojus AT  ufpr  br
>> http://www.leg.ufpr.br/~paulojus
>> 
>> 
>> 
>> On Tue, 2 Feb 2010, rusers.sh wrote:
>> 
>>  It works. The problem is that it only generates the simulated data based
>>> on our observed dataset,e.g. "meuse" here.
>>> I wonder if we can generate the simulated dataset from the user-specified
>>> model with covariates included, such as y~a1*x1+a2*x2+spatial effect. Y
>>> can
>>> be continuous or 0/1 variables. Something like this.
>>> The idea is we first specify a theoretical model, and then generate the
>>> simulated data based on this model. The coefficients and spatial effects
>>> are
>>> fixed by users, so we may study some new methods.
>>> Thanks.
>>> 
>>> 2010/2/2 Edzer Pebesma <edzer.pebesma at uni-muenster.de>
>>> 
>>> 
>>>> 
>>>> rusers.sh wrote:
>>>> 
>>>> Hi Tomislav,
>>>>> Thanks for your info on unconditional simulation. For conditional
>>>>> simulations, i still cannot find any useful information.
>>>>> I searched the R site and didnot find the possible method to do
>>>>> conditional simulations.
>>>>> 1. CondSimu(RandomField): trend: Not programmed yet. (used by universal
>>>>> kriging)
>>>>> 2. grf(geoR): generates unconditional simulations of Gaussian random
>>>>> fields
>>>>> 3. sim.Krig(fields)  #Conditonal simulation of a spatial process
>>>>> It seems to be based on the actual dataset,not a theoretical model.
>>>>> 4. krige(gstat ):Simple, Ordinary or Universal, global or local, Point
>>>>> or
>>>>> Block Kriging,or simulation
>>>>> x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, block =
>>>>> c(40,40),nsim=1)
>>>>> 
>>>>> 
>>>>> rusers.sh, please use
>>>> 
>>>> x <- krige(log(zinc)~x+y, meuse, meuse.grid, model = m, nmax=40, nsim=1)
>>>> 
>>>> both adding the block=c(40,40) as well as omitting the nmax=40
>>>> tremendously
>>>> increased the computing time you needed, the second even more (in an
>>>> O(n^2)
>>>> manner) than the first.
>>>> --
>>>> Edzer
>>>> 
>>>> 
>>>> 
>>>> 
>>>> I used the above modified codes from krige(gstat ) example to see the
>>>> 
>>>>> effect of "nsim", but unfortunately, it took a longer time and cannot
>>>>> get
>>>>> the results. I guess it used the simulation method to test the model,
>>>>> not
>>>>> what i want. (My system is XP, R2.10.0, gstat09.-64.)
>>>>> Anybody can give me further information on generating the conditional
>>>>> simulations from a theoretical model just like the unconditional
>>>>> examples
>>>>> that Tomislav provided?
>>>>> Thanks a lot.
>>>>> 
>>>>> 
>>>>> 2010/1/31 Tomislav Hengl <hengl at spatial-analyst.net>
>>>>> 
>>>>> 
>>>>> 
>>>>> Dear rusers.sh,
>>>>>> 
>>>>>> Here are few simple examples of how to simulate (not-normal)
>>>>>> distributions and point processes using geoR and spatstat:
>>>>>> 
>>>>>> http://spatial-analyst.net/book/node/388
>>>>>> 
>>>>>> See also:
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> http://leg.ufpr.br/geoR/geoRdoc/vignette/geoRintro/geoRintrose8.html#x9-120008
>>>>>> 
>>>>>> I guess that covariates can be also included (I guess that you then
>>>>>> need
>>>>>> to switch to conditional simulations - not sure).
>>>>>> 
>>>>>> This should also work for lattice (polygon) data so that you will have
>>>>>> jumps in values (but I guess you would still work in gridded systems?).
>>>>>> 
>>>>>> T. Hengl
>>>>>> http://home.medewerker.uva.nl/t.hengl/
>>>>>> 
>>>>>> 
>>>>>> rusers.sh wrote:
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> Hi all,
>>>>>>> In classical statistics, we always need to generate a theoretical
>>>>>>> model
>>>>>>> such as y=a+b1*x1+b2*x2+e to study some new estimation content. I am
>>>>>>> wondering how to generate the similar spatial dataset for a
>>>>>>> theoretical
>>>>>>> model.
>>>>>>> Say y is response variable, x1 and x2 are explanatory variables.
>>>>>>> 1. If y is a continous variable, how should we generate the dataset
>>>>>>> for
>>>>>>> a
>>>>>>> theoretical spatial point process model in R?
>>>>>>> 2. If y is a continous variable, how should we generate the dataset
>>>>>>> for
>>>>>>> a
>>>>>>> theoretical spatial lattice data model in R?
>>>>>>> 3. If y is 0/1 binary variable, how should we generate the dataset for
>>>>>>> a
>>>>>>> theoretical spatial point process model in R?
>>>>>>> 4. If y is 0/1 binary variable, how should we generate the dataset for
>>>>>>> a
>>>>>>> ttheoretical spatial lattice data in R?
>>>>>>> spatstat and other packages allow us to generate a dataset of a
>>>>>>> specified
>>>>>>> point process and other models, but it seems that they donot allow us
>>>>>>> to
>>>>>>> include possible explanatory variables into a theoretical model. Maybe
>>>>>>> i
>>>>>>> missed some ideas in them.
>>>>>>> Anybody can express some ideas or point out some useful resources on
>>>>>>> the
>>>>>>> above four different situations? Small examples in R are preferred.
>>>>>>> Thanks a lot.
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>> --
>>>> Edzer Pebesma
>>>> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e
>>>> 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763
>>>> 
>>>> http://ifgi.uni-muenster.de http://www.52north.org/geostatistics
>>>> e.pebesma at wwu.de
>>>> 
>>>> 
>>>> 
>>> 
>>> --
>>> -----------------
>>> Jane Chang
>>> Queen's
>>> 
>>>       [[alternative HTML version deleted]]
>>> 
>>> 
>>> 
> 
> 
> -- 
> -----------------
> Jane Chang
> Queen's
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mccallum at iiasa.ac.at  Thu Feb  4 10:12:56 2010
From: mccallum at iiasa.ac.at (Ian McCallum)
Date: Thu, 04 Feb 2010 10:12:56 +0100
Subject: [R-sig-Geo] Use of lookup table to create new matrix
Message-ID: <201002040913.o149D2nX024219@amazon.iiasa.ac.at>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100204/45bbed59/attachment.pl>

From r.hijmans at gmail.com  Thu Feb  4 18:59:43 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 4 Feb 2010 09:59:43 -0800
Subject: [R-sig-Geo] Use of lookup table to create new matrix
In-Reply-To: <201002040913.o149D2nX024219@amazon.iiasa.ac.at>
References: <201002040913.o149D2nX024219@amazon.iiasa.ac.at>
Message-ID: <dc22b2571002040959y45ac97ecp4cd933c17716d660@mail.gmail.com>

Ian,

As you need interpolation, perhaps the loess function is useful for
you  ((although I wonder whether you need a lookup table. Wouldn't you
rather use an existing function to predicts svp from temp))?

tab = data.frame(temp=-10:9,svp= 1:20)
mat = matrix(20:-29, byrow=T, nrow=5)/2
mat

model = loess(svp~temp, data=tab)
mat2 = predict(model, as.vector(mat))
dim(mat2) = dim(mat)
mat2

# only matching integers:
m = cbind(as.vector(mat), 1:length(mat))
m = merge(m, tab, by=1, all.x=T)
m = m[order(m[,2]), 3]
dim(m) = dim(mat)
m


Robert

On Thu, Feb 4, 2010 at 1:12 AM, Ian McCallum <mccallum at iiasa.ac.at> wrote:
> Greetings All,
> Firstly - thanks for previous answers on exporting to asciigrid!
>
> Now i have a matrix (grid) of temperature,
> and a lookup table of temperature and svp.
>
> I would like to create a new matrix with corresponding svp values.
>
> This is relatively straightforward in a GIS - but i have not found a way in R.
> Ideally it would also interpolate between values in the lookup table.
> Options like merge, cbind, may work??
> Without looping would be ideal.
>
> any ideas?
> thanks!
> Ian
>
> # test matrix
> mat = matrix(-49.5:50,10,10)
>
> # test lookup table
> temp = -10:9
> svp = 1:20
> tab = data.frame(temp,svp)
>
>
> ___________________________________________
>
> Ian McCallum
> Forestry Program
> International Institute for Applied Systems Analysis
> Schlossplatz 1, A-2361 Laxenburg, Austria
> Phone: +43 2236 807-328
> Fax: +43 2236 807-599 or 71313
> E-mail: mccallum at iiasa.ac.at
> Web: http://www.iiasa.ac.at/Research/FOR/
> ___________________________________________
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Thu Feb  4 19:01:35 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 4 Feb 2010 10:01:35 -0800
Subject: [R-sig-Geo] Vector to raster "zone" conversion...
In-Reply-To: <4B6A332E.50508@ucdavis.edu>
References: <4B6A332E.50508@ucdavis.edu>
Message-ID: <dc22b2571002041001j2fbdd342y2b3e1dc1ee1c713f@mail.gmail.com>

Hi Jonathan,

Here is an example of how one could do this with 'raster':

install.packages("packagename",repos="http://R-Forge.R-project.org")
library(raster)
# Let p be a SpatialPolygons* object, e.g.
p = getData('GADM', country='BEL', level=1)
# create a RasterLayer with the same extent
r = raster(extent(p))
# set the resolution (cell size)
res(r) = 0.05
# rasterize polygons
r = polygonsToRaster(p, r)
# extract xy for zone (polygon) # 3
xy = rasterToPoints(r, fun=function(x){x==3}, asSpatialPoints=TRUE)
#plot
plot(r)
plot(p, add=T)
plot(xy, add=T, col='blue', cex=0.2)

holes are supported (if properly specified in the Sp object); and
there is also an option to look at the fraction of a cell covered by a
polygon (but then you need to process one polygon at a time).
See ?polygonsToRaster.

Robert


On Wed, Feb 3, 2010 at 6:38 PM, Jonathan Greenberg
<greenberg at ucdavis.edu> wrote:
> Rsiggeo'ers:
>
> ? Given a vector file containing polygons and a raster file of the same
> projection, I would like to create raster "zones" based on the polygons --
> e.g. I would like to rasterize the vector polygon at the resolution of the
> raster. ?I'm not seeing any obvious way to do this -- any ideas? ?In the
> end, I want a set of x,y coordinates of all pixels which fall within a given
> polygon -- ideally I'd like donuts to be properly rasterized, and some level
> of control on how much of a pixel must fall within a polygon to "count".
> ?I'm trying to port my program "starspan" over to R to provide a much needed
> training/test data import capability to complement rgdal and raster's
> capabilities.
> ? Thanks!
>
> --j
>
> --
>
> Jonathan A. Greenberg, PhD
> Postdoctoral Scholar
> Center for Spatial Technologies and Remote Sensing (CSTARS)
> University of California, Davis
> One Shields Avenue
> The Barn, Room 250N
> Davis, CA 95616
> Phone: 415-763-5476
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Fri Feb  5 00:38:41 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 4 Feb 2010 15:38:41 -0800
Subject: [R-sig-Geo] help with areal interpolation I think
In-Reply-To: <1516849282.433601264741111513.JavaMail.root@sz0111a.emeryville.ca.mail.comcast.net>
References: <2083374966.430051264740300428.JavaMail.root@sz0111a.emeryville.ca.mail.comcast.net>
	<1516849282.433601264741111513.JavaMail.root@sz0111a.emeryville.ca.mail.comcast.net>
Message-ID: <dc22b2571002041538i366d3d90tf3d8bd9ca55d1fbd@mail.gmail.com>

It seems to me that you need "overlay" in the sp package. Essentially
it allows you to determine which points (sampling stations) are in
which polygons (watersheds). Robert

On Thu, Jan 28, 2010 at 8:58 PM,  <musche1 at comcast.net> wrote:
>
> Being new to spatial analysis I don't have the right vocabulary. I have purchased the book applied spatial data analysis in r, but not received yet.
>
> I have a set of irregularly spaced points (utmx,utmy) where animals were sampled. So for each point I have a location and a species count. There is a spatial pattern in the data (for richness) - it is not just random. I have used a gam from mgcv to model the data. I would like to overlay a shapefile of polygons (watersheds) over the point data and in the end estimate the expected number of species in a watershed. For example if a watershed overlayed two bands of species richness one for a richness of 5 and one for a richness of 6 and each were equally represented in the watershed the expected number for a point in the watershed would be 5.5. Can someone point me in the right direction or provide terminology and/or packages that may do this. thank you.
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mayeul.kauffmann at free.fr  Fri Feb  5 01:22:24 2010
From: mayeul.kauffmann at free.fr (mayeulk)
Date: Thu, 4 Feb 2010 16:22:24 -0800 (PST)
Subject: [R-sig-Geo] converting grid objects to spatial polygon objects
 and export as shapefile
In-Reply-To: <alpine.LRH.2.00.0912100952060.3176@reclus.nhh.no>
References: <8CC4755FF335DDD-29E4-A52E@webmail-d100.sysops.aol.com>
	<alpine.LRH.2.00.0912100952060.3176@reclus.nhh.no>
Message-ID: <1265329344875-4517330.post@n2.nabble.com>


Good evening,
I'm trying to do the same thing as discussed here:
https://stat.ethz.ch/pipermail/r-sig-geo/2009-December/007163.html
in my case to create kilometric UTM grid (graticule) as a shape file to
overlay on maps (in GIS software like QGIS) for GPS receiver use.

The above mentioned post does not give the end of the solution.
I tried this, without success (I also tried a few other CRS strings).
library(sp)
library(maptools)

scale.m<-1
#scale.m<-1000 #uncomment to define values in kilometers
grd <- GridTopology(cellcentre.offset=c(475000/scale.m,5078000/scale.m),
  cellsize=c(1000/scale.m,1000/scale.m), cells.dim=c(10,10))
grd2<-SpatialGrid(grid=grd, proj4string = CRS("+proj=utm +zone=32
+ellps=WGS84 +units=m +no_defs"))
spix <- as(grd2, "SpatialPixels")
spol <- as(spix, "SpatialPolygons") 
spdf <- SpatialPolygonsDataFrame(spol, data=data.frame(id=row.names(spol),
   row.names=row.names(spol))) 
plot(spdf)
writeSpatialShape(x=spdf,"~/Documents/randonnee/Italie/UTM_grid_R")


This create a set of shapefiles, but when I load it into qgis nothing is
dispayed and qgis complains about wrong scale.
Thanks for any hint
Mayeulk



-- 
View this message in context: http://n2.nabble.com/converting-grid-objects-to-spatial-polygon-objects-and-export-as-shapefile-tp4143331p4517330.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Pierre.Racine at sbf.ulaval.ca  Fri Feb  5 16:49:29 2010
From: Pierre.Racine at sbf.ulaval.ca (Pierre Racine)
Date: Fri, 5 Feb 2010 10:49:29 -0500
Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or
 WKT	Raster?
In-Reply-To: <4B252466.6090307@spatial-analyst.net>
References: <4B252466.6090307@spatial-analyst.net>
Message-ID: <87A96661E65C5541AB4D20721C2DD7F84D1E559CEA@EXCH-MBX-A.ulaval.ca>

Hi Tom,

I understand that PostGIS WKT Raster is still under development but it is designed to answer exactly the kind of problem you are confronted with: serving as a warehouse for huge raster datasets, integrate them with vector (PostGIS) through raster/vector GIS operations (raster/vector overlay, raster operations like resampling, mask, mapalgebra), all this using a common SQL interface. WKT Raster intent to be a final elegant solution to this kind of problem avoiding the development of multi layer applications like the one you are envisioning. WKT Raster intend to make of PostGIS a complete SQL GIS solution handling both vector and raster data.

As a matter of example we started the WKT Raster project to be able to intersect thousands of vector buffers with many raster dataset covering the extent of Canada (many in the 30 GIG order). Our final goal is to enable our users to do that on the web (even if some query may take days).

Note however that WKT Raster is not a web server. MapServer, Geoserver and OpenLayer will have to be adapted to support WKT Raster. There is already a GDAL driver able to read WKT Raster from the database.

This said, I invite you to consider a contribution to the WKT Raster project (or one to the other web project like MapServer, GeoServer or OpenLayer: adding WKT Raster support to them) in order to concentrate your efforts on a generic solution to problems similar to your one, contributing to the whole community, instead of disseminating your energy on a specific solution, serving only your organisation.

Thanks,

Pierre Racine
WKT Raster Project Manager


>-----Original Message-----
>From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
>Tomislav Hengl
>Sent: 13 d?cembre 2009 12:29
>To: r-sig-geo
>Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or WKT Raster?
>
>
>Dear R-sig-geo,
>
>As a part of our project (EcoGRID.nl) we have prepared some 60 thematic
>grids that we use as auxiliary predictors for species distribution
>modeling. At this stage, we would like to put the gridded maps (50/100 m
>base resolution) into some efficient sharable geo-database.
>
>We will most probably put the data into the NetCDF format
>(http://www.unidata.ucar.edu/software/netcdf/) because it can handle
>any-dimensional array data, and because it has been in continuous
>development and widespread use for many years. NetCDF grids can be read
>relatively easy into R using the RNetCDF package (e.g.
>http://spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to
>use PostGIS WKT Raster format
>(http://trac.osgeo.org/postgis/wiki/WKTRaster), but this seems to be
>still rather experimental (?).
>
>Once we put the grids into NetCDF format. We plan to install OPeNDAP
>(http://www.opendap.org) server on top to make the files accessible
>through the web; then Geoserver (http://www.geoserver.org) or UMN
>Mapserver (http://mapserver.org) to feed a WMS from NetCDF files (raster
>data). Finally, we plan to add a simple OpenLayers interface on top of
>that (Geoserver has it built in) to allow direct browsing of the data
>and metadata (e.g. such as this one: http://africamap.harvard.edu/)
>
>Just to be clear, we want to put the data on a server because we would
>like to run a number of operations directly on the server (via rgdal?):
>
>1. Overlay some point data and get the values of grids (without a need
>to download the grids locally);
>2. Subset/mask and resample gridded data of interest (for a given
>bounding box and proj4 string; again without a need to download the data
>locally);
>3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution (then
>download the upscaled grids).
>4. Write/upload new grids to the database (e.g. using WebDAV).
>5. Browse the grids (and metadata) via the OpenLayers.
>
>These are only our wishes of course. We do not know if all this is
>really possible with the current software.
>
>Any examples or comments/suggestions/experiences are welcome (before we
>start installing and testing the functionality).
>
>Thanx!
>
>Tomislav Hengl and Lourens Veen
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mayeul.kauffmann at free.fr  Sat Feb  6 02:08:10 2010
From: mayeul.kauffmann at free.fr (mayeulk)
Date: Fri, 5 Feb 2010 17:08:10 -0800 (PST)
Subject: [R-sig-Geo] converting grid objects to spatial polygon objects
 and export as shapefile
In-Reply-To: <1265329344875-4517330.post@n2.nabble.com>
References: <8CC4755FF335DDD-29E4-A52E@webmail-d100.sysops.aol.com>
	<alpine.LRH.2.00.0912100952060.3176@reclus.nhh.no>
	<1265329344875-4517330.post@n2.nabble.com>
Message-ID: <1265418490545-4523475.post@n2.nabble.com>


The following works to make a graticule for gps use. I still have some works
to add numbesr, finer grids (with crosses, etc).
Mayeul

#cellcentre.offset: centre of the box with smallest coordinates (South West
box in Italy), hence +c(500,500)
grd <- GridTopology(cellcentre.offset=c(471000,5072000)+c(500,500),
  cellsize=c(1000,1000), # 1km x 1km
  cells.dim=c(40,30)) #40 km West-East and 30km South-North


grd2<-SpatialGrid(grid=grd, proj4string = CRS("+init=epsg:32632 +proj=utm
+zone=32 +ellps=intl +units=m +no_defs"))

spix <- as(grd2, "SpatialPixels")
spol <- as(spix, "SpatialPolygons") 
spdf <- SpatialPolygonsDataFrame(spol, data=data.frame(id=row.names(spol),
   row.names=row.names(spol))) 
#plot(spdf)
writeSpatialShape(x=spdf,"~/Documents/randonnee/Italie/UTM_grid_R")

#then open .shp with qgis, select the layer> properties> apply CRS
epsg:32632> OK.
#Menu preferenes>project properties>on the fly projection then choose one
pojection

-- 
View this message in context: http://n2.nabble.com/converting-grid-objects-to-spatial-polygon-objects-and-export-as-shapefile-tp4143331p4523475.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ingalapuma at gmail.com  Sat Feb  6 02:47:13 2010
From: ingalapuma at gmail.com (ingalapuma)
Date: Fri, 5 Feb 2010 20:47:13 -0500
Subject: [R-sig-Geo] spatial autocorrelation, grids, and the ks-test
Message-ID: <7abee47e1002051747v6b2d9024s5a27d8da66514a79@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100205/021ce5b5/attachment.pl>

From mark_connolly at acm.org  Sat Feb  6 14:46:59 2010
From: mark_connolly at acm.org (Mark Connolly)
Date: Sat, 06 Feb 2010 08:46:59 -0500
Subject: [R-sig-Geo] are these methods appropriate for four dimensional
	modeling?
Message-ID: <4B6D72D3.6060205@acm.org>

I am working on a thesis in soil science with four dimensional modeling 
as a major component.  I am using R for the interpolation of data and 
VisIT to render the data as volumes and as volumes changing in time.  I 
am using Applied Spatial Data Analysis with R (Bivand, Pebesma, 
Gomez-Rubio) as a reference.  I've also been using Chatfield's Analysis 
of Time Series, less for time series specifically than for helping to 
understand the statistical concepts.

My data are soil property data. A purely spatial component comprises 
nine soil physical properties taken across a 12 ha agriculture field. 
There are sixty locations with five measurement depths at each location 
(3D).  The spatial-temporal component is the measure of volumetric soil 
moisture status taken at the same 300 positions.  These data are 
discrete readings taken at unequal intervals.  The readings exist for 
growing seasons over three years.

The observation grid is half regular and half semi-random.  Each of 
thirty regularly placed locations has a satellite location set in random 
proximity but not too far and not too close.  The observation depths are 
at 15 cm intervals starting at -15 cm and extending down to -75 cm.

My first pass through the data was mainly concerned with the mechanics 
of the process.  I used IDW for interpolating each of the soil 
properties through the volume (myriad packages including sp, gstat, and 
others mentioned in Bivand et al), treating each property as independent 
of the others.

I then went after the temporal soil moisture data.  At each of the 300 
positions, I took the set of time-sequenced measures (measurement 
intervals varied from days to weeks during each growing season) and 
interpolated values for days not measured.  I used the Stineman 
algorithm provided by the na.stinterp function from the stinepack R 
package.  Once I had all days for all positions, I used IDW again to 
interpolate volumes for each day.

Each volume was exported as an unstructured point grid for rendering in 
VisIT.  My data analysis was limited to adjusting the IDW weighting 
power such that the density distributions of the interpolated values 
were similar to the density distributions of the observed values 
(eyeballing overlaid plots).

My interpolation grid cell size is defined at 10x10x1, modeling 10 m by 
10 m by 1 meter.  This is a little misleading.  I treat the depth 
dimension as having the same units as the areal dimension, so -15 cm 
becomes equivalent to -15 m.  Two reasons (the second not necessarily 
defensible): I need the depth to be scaled for reasonable visualization, 
and I want to decrease the influence of the depth measures on the layers 
above and below each depth.

In my next iteration through the data, I'd like to use the 
geostatistical techniques presented in Bivand et al.  I have (just) 
started with variograms with the hope of exploring the variogram in the 
context of the volume.  I have run into the problem of dimensionality. 
The plot functions are 2D, so projecting the variogram onto the 
observation spatial volume is not working.  That got me thinking.  If I 
use kriging, will I be using the influence of depth in the interpolation 
model?  Is the variogram created with the influence of depth when the 
spatial structure has three dimensions?  Is a better use to treat each 
depth as a separate layer to be interpolated in two dimensions, 
especially given that soils are often physically layered?  If three 
dimensional kriging is okay, how about four dimensional to move through 
a time series? Or would I be better to stick with the Stineman algorithm 
for the time-series interpolation?

Any feedback on this (including any warnings that I might be abusing 
things with my time series and IDW approaches) would be very much 
appreciated.  I am definitely in learning mode.

Mark


From matthew at matthewvavrek.com  Sun Feb  7 22:37:00 2010
From: matthew at matthewvavrek.com (Matthew Vavrek)
Date: Sun, 07 Feb 2010 14:37:00 -0700
Subject: [R-sig-Geo] spherical polygon
Message-ID: <4B6F327C.4020808@matthewvavrek.com>

Hello,
I have a question that I have yet to find a definitive answer for on 
this mailing list (or elsewhere as of yet) about a method of calculating 
the area of a spherical polygon (ie an area on the surface of the 
earth). I know of the areapl() function in the splancs package, although 
as I understand it can only calculate the area of a planar polygon, not 
a spherical one. The polygons I'm trying to calculate are generally 
simple and convex; is there any way of doing this in R?

Also, I would like to get some feedback on a function that I wrote 
myself that does this (although not perfectly). The function is called 
earth.poly() and can be found in the fossil package on CRAN. Right now, 
it can only deal with areas less than one hemisphere in size, and I 
haven't stress tested it too much yet. Also, it treats the earth as a 
sphere rather than a true ellipsoid for simplicity, which can mean up to 
a 0.2% error in actual area (although it is generally much less). 
Basically though, if anyone knows of something better out there already, 
I would gladly use that instead, rather than spending far too much time 
doing it myself.

Cheers
Matthew


From dylan.beaudette at gmail.com  Mon Feb  8 02:30:23 2010
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Sun, 7 Feb 2010 17:30:23 -0800
Subject: [R-sig-Geo] spherical polygon
In-Reply-To: <4B6F327C.4020808@matthewvavrek.com>
References: <4B6F327C.4020808@matthewvavrek.com>
Message-ID: <3c5546141002071730i57a770a8uee9266cc1ad2e82f@mail.gmail.com>

How about an equal-area map projection?

http://en.wikipedia.org/wiki/Map_projection#Equal-area

Cheers,
Dylan

On Sun, Feb 7, 2010 at 1:37 PM, Matthew Vavrek
<matthew at matthewvavrek.com> wrote:
> Hello,
> I have a question that I have yet to find a definitive answer for on this
> mailing list (or elsewhere as of yet) about a method of calculating the area
> of a spherical polygon (ie an area on the surface of the earth). I know of
> the areapl() function in the splancs package, although as I understand it
> can only calculate the area of a planar polygon, not a spherical one. The
> polygons I'm trying to calculate are generally simple and convex; is there
> any way of doing this in R?
>
> Also, I would like to get some feedback on a function that I wrote myself
> that does this (although not perfectly). The function is called earth.poly()
> and can be found in the fossil package on CRAN. Right now, it can only deal
> with areas less than one hemisphere in size, and I haven't stress tested it
> too much yet. Also, it treats the earth as a sphere rather than a true
> ellipsoid for simplicity, which can mean up to a 0.2% error in actual area
> (although it is generally much less). Basically though, if anyone knows of
> something better out there already, I would gladly use that instead, rather
> than spending far too much time doing it myself.
>
> Cheers
> Matthew
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From hengl at spatial-analyst.net  Mon Feb  8 09:54:15 2010
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Mon, 8 Feb 2010 09:54:15 +0100
Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or
	WKT	Raster?
In-Reply-To: <87A96661E65C5541AB4D20721C2DD7F84D1E559CEA@EXCH-MBX-A.ulaval.ca>
References: <4B252466.6090307@spatial-analyst.net>
	<87A96661E65C5541AB4D20721C2DD7F84D1E559CEA@EXCH-MBX-A.ulaval.ca>
Message-ID: <000d01caa89c$4ad41ce0$e07c56a0$@net>

> -----Original Message-----
> From: Pierre Racine [mailto:Pierre.Racine at sbf.ulaval.ca]
> Sent: Friday, February 05, 2010 4:49 PM
> To: Tomislav Hengl; r-sig-geo
> Subject: RE: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or WKT
> Raster?
> 
> Hi Tom,
> 
> I understand that PostGIS WKT Raster is still under development but it is
> designed to answer exactly the kind of problem you are confronted with: serving
> as a warehouse for huge raster datasets, integrate them with vector (PostGIS)
> through raster/vector GIS operations (raster/vector overlay, raster operations
> like resampling, mask, mapalgebra), all this using a common SQL interface. WKT
> Raster intent to be a final elegant solution to this kind of problem avoiding the
> development of multi layer applications like the one you are envisioning. WKT
> Raster intend to make of PostGIS a complete SQL GIS solution handling both vector
> and raster data.
> 
> As a matter of example we started the WKT Raster project to be able to intersect
> thousands of vector buffers with many raster dataset covering the extent of
> Canada (many in the 30 GIG order). Our final goal is to enable our users to do
> that on the web (even if some query may take days).
> 
> Note however that WKT Raster is not a web server. MapServer, Geoserver and
> OpenLayer will have to be adapted to support WKT Raster. There is already a GDAL
> driver able to read WKT Raster from the database.
> 
> This said, I invite you to consider a contribution to the WKT Raster project (or
> one to the other web project like MapServer, GeoServer or OpenLayer: adding WKT
> Raster support to them) in order to concentrate your efforts on a generic
> solution to problems similar to your one, contributing to the whole community,
> instead of disseminating your energy on a specific solution, serving only your
> organisation.

Dear Pierre,

I am sorry that you might got me wrong (and thank you for your reply even with some months of delay!). I do intend to test also WKT Raster and will certainly report on my results via R-sig-geo. We are just in a process of setting up our server and installing all functionality. Provided that we find your software suitable, efficient and secure (in comparison to e.g. rasdaman or NetCDF), I would be willing to contribute more actively e.g. to your wiki [http://trac.osgeo.org/postgis/wiki/WKTRaster] (certainly by reporting on the results using same sample data-sets).

I am not sure about what kind of set-up do you have with your employer, but my project (EcoGRID, client: Dutch Ministry of Agriculture, Nature and Food Quality) needs to stay a priority of course. The art is to be able to satisfy your employer and still contribute to open access projects such as yours.

T. Hengl
http://home.medewerker.uva.nl/t.hengl/ 


> 
> Thanks,
> 
> Pierre Racine
> WKT Raster Project Manager
> 
> 
> >-----Original Message-----
> >From: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-
> bounces at stat.math.ethz.ch] On Behalf Of
> >Tomislav Hengl
> >Sent: 13 d?cembre 2009 12:29
> >To: r-sig-geo
> >Subject: [R-sig-Geo] Making web-repository of gridded maps: NetCDF or WKT
> Raster?
> >
> >
> >Dear R-sig-geo,
> >
> >As a part of our project (EcoGRID.nl) we have prepared some 60 thematic
> >grids that we use as auxiliary predictors for species distribution
> >modeling. At this stage, we would like to put the gridded maps (50/100 m
> >base resolution) into some efficient sharable geo-database.
> >
> >We will most probably put the data into the NetCDF format
> >(http://www.unidata.ucar.edu/software/netcdf/) because it can handle
> >any-dimensional array data, and because it has been in continuous
> >development and widespread use for many years. NetCDF grids can be read
> >relatively easy into R using the RNetCDF package (e.g.
> >http://spatial-analyst.net/DATA/readNCDF.zip). Another alternative is to
> >use PostGIS WKT Raster format
> >(http://trac.osgeo.org/postgis/wiki/WKTRaster), but this seems to be
> >still rather experimental (?).
> >
> >Once we put the grids into NetCDF format. We plan to install OPeNDAP
> >(http://www.opendap.org) server on top to make the files accessible
> >through the web; then Geoserver (http://www.geoserver.org) or UMN
> >Mapserver (http://mapserver.org) to feed a WMS from NetCDF files (raster
> >data). Finally, we plan to add a simple OpenLayers interface on top of
> >that (Geoserver has it built in) to allow direct browsing of the data
> >and metadata (e.g. such as this one: http://africamap.harvard.edu/)
> >
> >Just to be clear, we want to put the data on a server because we would
> >like to run a number of operations directly on the server (via rgdal?):
> >
> >1. Overlay some point data and get the values of grids (without a need
> >to download the grids locally);
> >2. Subset/mask and resample gridded data of interest (for a given
> >bounding box and proj4 string; again without a need to download the data
> >locally);
> >3. Upscale the grids from 100 m to 250, 500 m and 1 km resolution (then
> >download the upscaled grids).
> >4. Write/upload new grids to the database (e.g. using WebDAV).
> >5. Browse the grids (and metadata) via the OpenLayers.
> >
> >These are only our wishes of course. We do not know if all this is
> >really possible with the current software.
> >
> >Any examples or comments/suggestions/experiences are welcome (before we
> >start installing and testing the functionality).
> >
> >Thanx!
> >
> >Tomislav Hengl and Lourens Veen
> >
> >_______________________________________________
> >R-sig-Geo mailing list
> >R-sig-Geo at stat.math.ethz.ch
> >https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger.Bivand at nhh.no  Mon Feb  8 10:38:32 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 8 Feb 2010 10:38:32 +0100 (CET)
Subject: [R-sig-Geo] spatial autocorrelation, grids, and the ks-test
In-Reply-To: <7abee47e1002051747v6b2d9024s5a27d8da66514a79@mail.gmail.com>
References: <7abee47e1002051747v6b2d9024s5a27d8da66514a79@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002081017040.7098@reclus.nhh.no>

On Fri, 5 Feb 2010, ingalapuma wrote:

> I would like to run the Moran's I on a .img file of forest composition
> change categories.

(Please, could anonymous questioners give some indication of their 
standing, for example in an informative signature? The R lists posting 
guide does say: "Some consider it good manners to include a concise 
signature specifying affiliation" - I am one of these some, for good 
reason. Helpers find it much easier to help when they have some idea of 
disciplinary background and motivation of the questioner, and a 
signature field can provide these.)

There are many questions here. Firstly, Moran's I is for continuous 
variables, not categories. For categories, use join count statistics. 
Secondly, the possible dependency in your data will be being driven both 
by any inherent (subatantive) dependency, and by the match (or mismatch) 
between the scale(s) of the phenomena and the resolution of your grid. In 
addition, there may be background variables that drive the dependency, 
like slope or elevation, so observed dependency even for correct scaling 
may not say anything about the effect of contiguity.

You can of course compute spatial autocorrelation of your data (treat them 
as having point support and use a distance criterion like the raster step 
for rook neighbours or the diagonal step for queen neighbours. It's just 
that the test will only reflect your resolution and possibly omitted 
variables. With raster data, especially with fine resolution, one 
typically has many "observations" of the same "natural" entity or object, 
leading to apparent spatial autocorrelation.

> I need to know if I can treat the categories as
> independent for performing the two sample Kolmogorov-Smirnov on relative
> fire frequency distributions of these forest composition change categories.
> Without considering spatial autocorrelation, the fire frequency
> distributions of the categories are significantly different according to the
> ks-test (which I was advised to use).  It is obvious that these categories
> are spatially clustered as are the areas of similar fire frequency, so my
> questions/statements are:

I think that you could consider checking your KS results against a better 
null, that is generating from distributions with the same level of spatial 
dependence (or rather not use KS, but fit a model and evaluate it in the 
context of dependence).

>
> 1.  Does it make sense to run the Moran's I on the thematic grid data with
> R? (Have tried to convert it to vector in both ArcGIS and Imagine and have
> run into errors...presumably because of size and complexity?)
>

In spdep use dnearneigh() to make a list of neighbours. If there is a lot 
of data in the raster, you will not gain any insight anyway - consider 
vigorous subsetting. Contrast the subsets.

> 2.  I have no idea how to do anything in R (besides the ks-test) and am
> completely new to it's spatial tools (although I am keen to learn and have
> loaded several of the packages/libraries).
>

Since the KS test maybe isn't a good idea anyway, perhaps starting afresh? 
You'd need to vary your raster resolution anyway to get any idea on how 
scaling works. This is going to take substantial time to do right. In your 
best case, join count tests are insignificant, and you can risk KS, but if 
you can see spatial patterning and have put the question on the table, you 
need an alternative approach.

Roger

> 3.  How would I incorporate the p-value results of the Moran's I (if I can
> get it to work) into the ks-test of my relative frequencies?
>
> I have ordered the spatial data with R book but I figured I'd cut to the
> chase and see if you all could help me get a jumpstart on this.
>
> Thanks ahead of time.
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From wmconnol at ncsu.edu  Mon Feb  8 13:49:39 2010
From: wmconnol at ncsu.edu (Mark Connolly)
Date: Mon, 08 Feb 2010 07:49:39 -0500
Subject: [R-sig-Geo] are these methods appropriate for four dimensional
	modeling?
Message-ID: <4B700863.2010103@ncsu.edu>

repeat post - added signature

I am working on a thesis in soil science with four dimensional modeling 
as a major component.  I am using R for the interpolation of data and 
VisIT to render the data as volumes and as volumes changing in time.  I 
am using Applied Spatial Data Analysis with R (Bivand, Pebesma, 
Gomez-Rubio) as a reference.  I've also been using Chatfield's Analysis 
of Time Series, less for time series specifically than for helping to 
understand the statistical concepts.

My data are soil property data. A purely spatial component comprises 
nine soil physical properties taken across a 12 ha agriculture field. 
There are sixty locations with five measurement depths at each location 
(3D).  The spatial-temporal component is the measure of volumetric soil 
moisture status taken at the same 300 positions.  These data are 
discrete readings taken at unequal intervals.  The readings exist for 
growing seasons over three years.

The observation grid is half regular and half semi-random.  Each of 
thirty regularly placed locations has a satellite location set in random 
proximity but not too far and not too close.  The observation depths are 
at 15 cm intervals starting at -15 cm and extending down to -75 cm.

My first pass through the data was mainly concerned with the mechanics 
of the process.  I used IDW for interpolating each of the soil 
properties through the volume (myriad packages including sp, gstat, and 
others mentioned in Bivand et al), treating each property as independent 
of the others.

I then went after the temporal soil moisture data.  At each of the 300 
positions, I took the set of time-sequenced measures (measurement 
intervals varied from days to weeks during each growing season) and 
interpolated values for days not measured.  I used the Stineman 
algorithm provided by the na.stinterp function from the stinepack R 
package.  Once I had all days for all positions, I used IDW again to 
interpolate volumes for each day.

Each volume was exported as an unstructured point grid for rendering in 
VisIT.  My data analysis was limited to adjusting the IDW weighting 
power such that the density distributions of the interpolated values 
were similar to the density distributions of the observed values 
(eyeballing overlaid plots).

My interpolation grid cell size is defined at 10x10x1, modeling 10 m by 
10 m by 1 meter.  This is a little misleading.  I treat the depth 
dimension as having the same units as the areal dimension, so -15 cm 
becomes equivalent to -15 m.  Two reasons (the second not necessarily 
defensible): I need the depth to be scaled for reasonable visualization, 
and I want to decrease the influence of the depth measures on the layers 
above and below each depth.

In my next iteration through the data, I'd like to use the 
geostatistical techniques presented in Bivand et al.  I have (just) 
started with variograms with the hope of exploring the variogram in the 
context of the volume.  I have run into the problem of dimensionality. 
The plot functions are 2D, so projecting the variogram onto the 
observation spatial volume is not working.  That got me thinking.  If I 
use kriging, will I be using the influence of depth in the interpolation 
model?  Is the variogram created with the influence of depth when the 
spatial structure has three dimensions?  Is a better use to treat each 
depth as a separate layer to be interpolated in two dimensions, 
especially given that soils are often physically layered?  If three 
dimensional kriging is okay, how about four dimensional to move through 
a time series? Or would I be better to stick with the Stineman algorithm 
for the time-series interpolation?

Any feedback on this (including any warnings that I might be abusing 
things with my time series and IDW approaches) would be very much 
appreciated.  I am definitely in learning mode.

Mark

-- 
Graduate Student, Master of Science
Department of Soil Science
North Carolina State University


From ingalapuma at gmail.com  Mon Feb  8 15:31:33 2010
From: ingalapuma at gmail.com (ingalapuma at gmail.com)
Date: Mon, 08 Feb 2010 14:31:33 +0000
Subject: [R-sig-Geo] spatial autocorrelation, grids, and the ks-test
In-Reply-To: <alpine.LRH.2.00.1002081017040.7098@reclus.nhh.no>
Message-ID: <0016e6469116720baa047f17a8b2@google.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100208/a0d8f995/attachment.pl>

From karl at huftis.org  Mon Feb  8 15:34:45 2010
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Mon, 8 Feb 2010 15:34:45 +0100
Subject: [R-sig-Geo] spherical polygon
References: <4B6F327C.4020808@matthewvavrek.com>
	<3c5546141002071730i57a770a8uee9266cc1ad2e82f@mail.gmail.com>
Message-ID: <MPG.25da3f625f377d429896d8@news.gmane.org>

On Sun, 7 Feb 2010 17:30:23 -0800 Dylan Beaudette 
<dylan.beaudette at gmail.com> wrote:
> How about an equal-area map projection?
> 
> http://en.wikipedia.org/wiki/Map_projection#Equal-area

Good idea. This will easily give you correct relative area measures, 
which will often be sufficient.

But how to convert these into absolute measures, for example, the area 
in km?? Any known conversion factors for the equal-area projections 
available in 'spTransform'?

-- 
Karl Ove Hufthammer


From debeaudette at ucdavis.edu  Mon Feb  8 18:47:54 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Mon, 8 Feb 2010 09:47:54 -0800
Subject: [R-sig-Geo] spherical polygon
In-Reply-To: <MPG.25da3f625f377d429896d8@news.gmane.org>
References: <4B6F327C.4020808@matthewvavrek.com>
	<3c5546141002071730i57a770a8uee9266cc1ad2e82f@mail.gmail.com>
	<MPG.25da3f625f377d429896d8@news.gmane.org>
Message-ID: <201002080947.54225.dylan.beaudette@gmail.com>

On Monday 08 February 2010, Karl Ove Hufthammer wrote:
> On Sun, 7 Feb 2010 17:30:23 -0800 Dylan Beaudette
>
> <dylan.beaudette at gmail.com> wrote:
> > How about an equal-area map projection?
> >
> > http://en.wikipedia.org/wiki/Map_projection#Equal-area
>
> Good idea. This will easily give you correct relative area measures,
> which will often be sufficient.
>
> But how to convert these into absolute measures, for example, the area
> in km?? Any known conversion factors for the equal-area projections
> available in 'spTransform'?

Most equal area map projections use meter as the linear unit of measure.

Cheers,
Dylan

-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From debeaudette at ucdavis.edu  Mon Feb  8 19:13:15 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Mon, 8 Feb 2010 10:13:15 -0800
Subject: [R-sig-Geo] are these methods appropriate for four dimensional
	modeling?
In-Reply-To: <4B700863.2010103@ncsu.edu>
References: <4B700863.2010103@ncsu.edu>
Message-ID: <201002081013.15620.dylan.beaudette@gmail.com>

On Monday 08 February 2010, Mark Connolly wrote:
> repeat post - added signature
>
> I am working on a thesis in soil science with four dimensional modeling
> as a major component.  I am using R for the interpolation of data and
> VisIT to render the data as volumes and as volumes changing in time.  I
> am using Applied Spatial Data Analysis with R (Bivand, Pebesma,
> Gomez-Rubio) as a reference.  I've also been using Chatfield's Analysis
> of Time Series, less for time series specifically than for helping to
> understand the statistical concepts.

Hi Mark, nice to see a fellow soil scientist on R-sig-geo.

> My data are soil property data. A purely spatial component comprises
> nine soil physical properties taken across a 12 ha agriculture field.
> There are sixty locations with five measurement depths at each location
> (3D).  The spatial-temporal component is the measure of volumetric soil
> moisture status taken at the same 300 positions.  These data are
> discrete readings taken at unequal intervals.  The readings exist for
> growing seasons over three years.

We have a similar dataset, and have found that RST interpolation to be a 
useful starting point. GRASS has functionality for interpolating volumetric 
data, and numerous export routines for visualization in Paraview. Here are 
some examples:

http://www-pool.math.tu-berlin.de/~soeren/grass/modules/screenshots/

> The observation grid is half regular and half semi-random.  Each of
> thirty regularly placed locations has a satellite location set in random
> proximity but not too far and not too close.  The observation depths are
> at 15 cm intervals starting at -15 cm and extending down to -75 cm.
>
> My first pass through the data was mainly concerned with the mechanics
> of the process.  I used IDW for interpolating each of the soil
> properties through the volume (myriad packages including sp, gstat, and
> others mentioned in Bivand et al), treating each property as independent
> of the others.
>
> I then went after the temporal soil moisture data.  At each of the 300
> positions, I took the set of time-sequenced measures (measurement
> intervals varied from days to weeks during each growing season) and
> interpolated values for days not measured.  I used the Stineman
> algorithm provided by the na.stinterp function from the stinepack R
> package.  Once I had all days for all positions, I used IDW again to
> interpolate volumes for each day.
>
> Each volume was exported as an unstructured point grid for rendering in
> VisIT.  My data analysis was limited to adjusting the IDW weighting
> power such that the density distributions of the interpolated values
> were similar to the density distributions of the observed values
> (eyeballing overlaid plots).
>
> My interpolation grid cell size is defined at 10x10x1, modeling 10 m by
> 10 m by 1 meter.  This is a little misleading.  I treat the depth
> dimension as having the same units as the areal dimension, so -15 cm
> becomes equivalent to -15 m.  Two reasons (the second not necessarily
> defensible): I need the depth to be scaled for reasonable visualization,
> and I want to decrease the influence of the depth measures on the layers
> above and below each depth.

Again RST interpolation to voxels may be useful in this case. There has been 
some talk on the GRASS mailing list about interpolation through time, but I 
haven't seen anything available yet.

Cheers,
Dylan


> In my next iteration through the data, I'd like to use the
> geostatistical techniques presented in Bivand et al.  I have (just)
> started with variograms with the hope of exploring the variogram in the
> context of the volume.  I have run into the problem of dimensionality.
> The plot functions are 2D, so projecting the variogram onto the
> observation spatial volume is not working.  That got me thinking.  If I
> use kriging, will I be using the influence of depth in the interpolation
> model?  Is the variogram created with the influence of depth when the
> spatial structure has three dimensions?  Is a better use to treat each
> depth as a separate layer to be interpolated in two dimensions,
> especially given that soils are often physically layered?  If three
> dimensional kriging is okay, how about four dimensional to move through
> a time series? Or would I be better to stick with the Stineman algorithm
> for the time-series interpolation?
>
> Any feedback on this (including any warnings that I might be abusing
> things with my time series and IDW approaches) would be very much
> appreciated.  I am definitely in learning mode.
>
> Mark



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From haileyeckstrand at gmail.com  Mon Feb  8 20:56:47 2010
From: haileyeckstrand at gmail.com (Hailey Eckstrand)
Date: Mon, 8 Feb 2010 11:56:47 -0800
Subject: [R-sig-Geo] convert a shapefile to geotiff with type = "Float32"
Message-ID: <e3b09e741002081156p293dc810o4c9a6054613f9a99@mail.gmail.com>

Hello List,
I am trying to load in a shapefile and then write it out as a geoTiff.
I am using the package rgdal.

library("rgdal")
## load in my shapefile
shp <- readOGR("/home/data3/projects/hydrology/vic/output/water_balance/peace_cc/summary",
"peace_base_et_6190")

# Just to be clear, here is the structure of my data
str(shp)
Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
  ..@ data       :'data.frame': 3975 obs. of  13 variables:
  .. ..$ jan: num [1:3975] 12 12.4 12.3 12.3 12.5 ...
  .. ..$ feb: num [1:3975] 12.8 13.2 13 13.1 13.5 ...
  .. ..$ mar: num [1:3975] 16.3 16.6 16.8 16.8 17.1 ...
  .. ..$ apr: num [1:3975] 31.2 33.7 30.1 28.1 29.2 ...
  .. ..$ may: num [1:3975] 106 111 101 99 103 ...
  .. ..$ jun: num [1:3975] 99.4 116 121.1 115.1 108 ...
  .. ..$ jul: num [1:3975] 57.8 56.9 74.7 69.5 65 ...
  .. ..$ aug: num [1:3975] 53.8 51.2 59.5 58.6 57.3 ...
  .. ..$ sep: num [1:3975] 44 40.6 52.8 49.4 49.2 ...
  .. ..$ oct: num [1:3975] 32.4 32 35.3 34.1 34.9 ...
  .. ..$ nov: num [1:3975] 12.6 12.9 12.9 12.9 13.4 ...
  .. ..$ dec: num [1:3975] 12.8 13.2 13.2 13.1 13.6 ...
  .. ..$ sum: num [1:3975] 491 510 542 522 517 ...
  ..@ coords.nrs : num(0)
  ..@ coords     : num [1:3975, 1:2] -123 -123 -122 -123 -123 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
  ..@ bbox       : num [1:2, 1:2] -127.7 54.2 -120.6 58
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
+no_defs +towgs84=0,0,0"

# Convert it to a SpatialGridDataGrame, so I can writeGDAL
gridded(shp) <- TRUE
shp.grid <- as(shp, "SpatialGridDataFrame")

# structure of my SpatialGridDataFrame
str(shp.grid)
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
  ..@ data       :'data.frame': 7130 obs. of  13 variables:
  .. ..$ jan: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ feb: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ mar: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ apr: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ may: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ jun: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ jul: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ aug: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ sep: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ oct: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ nov: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ dec: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  .. ..$ sum: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
  .. .. ..@ cellcentre.offset: Named num [1:2] -127.7 54.2
  .. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
  .. .. ..@ cellsize         : Named num [1:2] 0.0625 0.0625
  .. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
  .. .. ..@ cells.dim        : Named int [1:2] 115 62
  .. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
  ..@ grid.index : int(0)
  ..@ coords     : num [1:2, 1:2] -127.7 -120.6 54.2 58
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
  ..@ bbox       : num [1:2, 1:2] -127.8 54.2 -120.6 58.1
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
+no_defs +towgs84=0,0,0"

# attempt to write out a geotiff
writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
drivername = "GTiff", type = "Float32", mvFlag = NA, options=NULL,
copy_drivername = "GTiff")


The file that I write out only has NA values. I realize something is
wrong as I haven't figured out how to define which column I'd like to
convert.
Thanks in advance,
Hailey


From haileyeckstrand at gmail.com  Mon Feb  8 23:08:39 2010
From: haileyeckstrand at gmail.com (Hailey Eckstrand)
Date: Mon, 8 Feb 2010 14:08:39 -0800
Subject: [R-sig-Geo] convert a shapefile to geotiff with type = "Float32"
In-Reply-To: <e3b09e741002081156p293dc810o4c9a6054613f9a99@mail.gmail.com>
References: <e3b09e741002081156p293dc810o4c9a6054613f9a99@mail.gmail.com>
Message-ID: <e3b09e741002081408x4277b16eq7050ae38c5a41eef@mail.gmail.com>

Hello again,
My writeGDAL statement was slightly wrong.. I didn't have the NA
values in quotes.
it should be:
# attempt to write out a geotiff
 writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
drivername = "GTiff", type = "Float32", mvFlag = 'NA', options=NULL,
copy_drivername = "GTiff")

I can now load the tiff file into QGis correctly, but still not ArcMap.
Has anyone found a grid type that loads into Arc smoothly?
Hailey


On Mon, Feb 8, 2010 at 11:56 AM, Hailey Eckstrand
<haileyeckstrand at gmail.com> wrote:
> Hello List,
> I am trying to load in a shapefile and then write it out as a geoTiff.
> I am using the package rgdal.
>
> library("rgdal")
> ## load in my shapefile
> shp <- readOGR("/home/data3/projects/hydrology/vic/output/water_balance/peace_cc/summary",
> "peace_base_et_6190")
>
> # Just to be clear, here is the structure of my data
> str(shp)
> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
> ?..@ data ? ? ? :'data.frame': 3975 obs. of ?13 variables:
> ?.. ..$ jan: num [1:3975] 12 12.4 12.3 12.3 12.5 ...
> ?.. ..$ feb: num [1:3975] 12.8 13.2 13 13.1 13.5 ...
> ?.. ..$ mar: num [1:3975] 16.3 16.6 16.8 16.8 17.1 ...
> ?.. ..$ apr: num [1:3975] 31.2 33.7 30.1 28.1 29.2 ...
> ?.. ..$ may: num [1:3975] 106 111 101 99 103 ...
> ?.. ..$ jun: num [1:3975] 99.4 116 121.1 115.1 108 ...
> ?.. ..$ jul: num [1:3975] 57.8 56.9 74.7 69.5 65 ...
> ?.. ..$ aug: num [1:3975] 53.8 51.2 59.5 58.6 57.3 ...
> ?.. ..$ sep: num [1:3975] 44 40.6 52.8 49.4 49.2 ...
> ?.. ..$ oct: num [1:3975] 32.4 32 35.3 34.1 34.9 ...
> ?.. ..$ nov: num [1:3975] 12.6 12.9 12.9 12.9 13.4 ...
> ?.. ..$ dec: num [1:3975] 12.8 13.2 13.2 13.1 13.6 ...
> ?.. ..$ sum: num [1:3975] 491 510 542 522 517 ...
> ?..@ coords.nrs : num(0)
> ?..@ coords ? ? : num [1:3975, 1:2] -123 -123 -122 -123 -123 ...
> ?.. ..- attr(*, "dimnames")=List of 2
> ?.. .. ..$ : NULL
> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
> ?..@ bbox ? ? ? : num [1:2, 1:2] -127.7 54.2 -120.6 58
> ?.. ..- attr(*, "dimnames")=List of 2
> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
> ?.. .. ..$ : chr [1:2] "min" "max"
> ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
> ?.. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
> +no_defs +towgs84=0,0,0"
>
> # Convert it to a SpatialGridDataGrame, so I can writeGDAL
> gridded(shp) <- TRUE
> shp.grid <- as(shp, "SpatialGridDataFrame")
>
> # structure of my SpatialGridDataFrame
> str(shp.grid)
> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
> ?..@ data ? ? ? :'data.frame': 7130 obs. of ?13 variables:
> ?.. ..$ jan: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ feb: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ mar: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ apr: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ may: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ jun: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ jul: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ aug: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ sep: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ oct: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ nov: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ dec: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?.. ..$ sum: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
> ?..@ grid ? ? ? :Formal class 'GridTopology' [package "sp"] with 3 slots
> ?.. .. ..@ cellcentre.offset: Named num [1:2] -127.7 54.2
> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
> ?.. .. ..@ cellsize ? ? ? ? : Named num [1:2] 0.0625 0.0625
> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
> ?.. .. ..@ cells.dim ? ? ? ?: Named int [1:2] 115 62
> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
> ?..@ grid.index : int(0)
> ?..@ coords ? ? : num [1:2, 1:2] -127.7 -120.6 54.2 58
> ?.. ..- attr(*, "dimnames")=List of 2
> ?.. .. ..$ : NULL
> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
> ?..@ bbox ? ? ? : num [1:2, 1:2] -127.8 54.2 -120.6 58.1
> ?.. ..- attr(*, "dimnames")=List of 2
> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
> ?.. .. ..$ : chr [1:2] "min" "max"
> ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
> ?.. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
> +no_defs +towgs84=0,0,0"
>
> # attempt to write out a geotiff
> writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
> drivername = "GTiff", type = "Float32", mvFlag = NA, options=NULL,
> copy_drivername = "GTiff")
>
>
> The file that I write out only has NA values. I realize something is
> wrong as I haven't figured out how to define which column I'd like to
> convert.
> Thanks in advance,
> Hailey
>


From haileyeckstrand at gmail.com  Tue Feb  9 01:24:20 2010
From: haileyeckstrand at gmail.com (Hailey Eckstrand)
Date: Mon, 8 Feb 2010 16:24:20 -0800
Subject: [R-sig-Geo] convert a shapefile to geotiff with type = "Float32"
In-Reply-To: <e3b09e741002081408x4277b16eq7050ae38c5a41eef@mail.gmail.com>
References: <e3b09e741002081156p293dc810o4c9a6054613f9a99@mail.gmail.com>
	<e3b09e741002081408x4277b16eq7050ae38c5a41eef@mail.gmail.com>
Message-ID: <e3b09e741002081624j4f4ee799k7c19c0a7f5ec175f@mail.gmail.com>

So, after reading more posts and getting help from Robert, I guess
this is a pretty common problem and as of now, this is the easiest
raster type to load into ArcGIS. In case anyone needs this code, this
is what I ended up doing:
 library("rgdal")
## load in my shapefile
shp <- readOGR("/home/data3/projects/hydrology/vic/output/water_balance/peace_cc/summary",
"peace_base_et_6190")

## Convert it to a SpatialGridDataGrame, so I can writeGDAL
gridded(shp) <- TRUE
shp.grid <- as(shp, "SpatialGridDataFrame")
writeGDAL(shp.grd["jan"],
"/home/data2/gis/AT_Hailey/r_rasters/test.tif", drivername = "GTiff",
type = "Float32", mvFlag = 1e20)

Then to load it into ArcGIS.. add the geotiff, and usually it comes in
with incorrect min & max values.
Right click the file > Properties > Symbology
In the Stetched menu, under Stretch, select Type: Custom and then
click Yes when it asks you if you want to compute a new histogram.
Then click apply and then click OK and now you have forced ArcGIS to
display the true min & max.
That worked for me, I am using ArcGIS 9.3
Hailey

On Mon, Feb 8, 2010 at 2:08 PM, Hailey Eckstrand
<haileyeckstrand at gmail.com> wrote:
> Hello again,
> My writeGDAL statement was slightly wrong.. I didn't have the NA
> values in quotes.
> it should be:
> # attempt to write out a geotiff
> ?writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
> drivername = "GTiff", type = "Float32", mvFlag = 'NA', options=NULL,
> copy_drivername = "GTiff")
>
> I can now load the tiff file into QGis correctly, but still not ArcMap.
> Has anyone found a grid type that loads into Arc smoothly?
> Hailey
>
>
> On Mon, Feb 8, 2010 at 11:56 AM, Hailey Eckstrand
> <haileyeckstrand at gmail.com> wrote:
>> Hello List,
>> I am trying to load in a shapefile and then write it out as a geoTiff.
>> I am using the package rgdal.
>>
>> library("rgdal")
>> ## load in my shapefile
>> shp <- readOGR("/home/data3/projects/hydrology/vic/output/water_balance/peace_cc/summary",
>> "peace_base_et_6190")
>>
>> # Just to be clear, here is the structure of my data
>> str(shp)
>> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>> ?..@ data ? ? ? :'data.frame': 3975 obs. of ?13 variables:
>> ?.. ..$ jan: num [1:3975] 12 12.4 12.3 12.3 12.5 ...
>> ?.. ..$ feb: num [1:3975] 12.8 13.2 13 13.1 13.5 ...
>> ?.. ..$ mar: num [1:3975] 16.3 16.6 16.8 16.8 17.1 ...
>> ?.. ..$ apr: num [1:3975] 31.2 33.7 30.1 28.1 29.2 ...
>> ?.. ..$ may: num [1:3975] 106 111 101 99 103 ...
>> ?.. ..$ jun: num [1:3975] 99.4 116 121.1 115.1 108 ...
>> ?.. ..$ jul: num [1:3975] 57.8 56.9 74.7 69.5 65 ...
>> ?.. ..$ aug: num [1:3975] 53.8 51.2 59.5 58.6 57.3 ...
>> ?.. ..$ sep: num [1:3975] 44 40.6 52.8 49.4 49.2 ...
>> ?.. ..$ oct: num [1:3975] 32.4 32 35.3 34.1 34.9 ...
>> ?.. ..$ nov: num [1:3975] 12.6 12.9 12.9 12.9 13.4 ...
>> ?.. ..$ dec: num [1:3975] 12.8 13.2 13.2 13.1 13.6 ...
>> ?.. ..$ sum: num [1:3975] 491 510 542 522 517 ...
>> ?..@ coords.nrs : num(0)
>> ?..@ coords ? ? : num [1:3975, 1:2] -123 -123 -122 -123 -123 ...
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?.. .. ..$ : NULL
>> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> ?..@ bbox ? ? ? : num [1:2, 1:2] -127.7 54.2 -120.6 58
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> ?.. .. ..$ : chr [1:2] "min" "max"
>> ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>> ?.. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
>> +no_defs +towgs84=0,0,0"
>>
>> # Convert it to a SpatialGridDataGrame, so I can writeGDAL
>> gridded(shp) <- TRUE
>> shp.grid <- as(shp, "SpatialGridDataFrame")
>>
>> # structure of my SpatialGridDataFrame
>> str(shp.grid)
>> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>> ?..@ data ? ? ? :'data.frame': 7130 obs. of ?13 variables:
>> ?.. ..$ jan: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ feb: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ mar: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ apr: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ may: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ jun: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ jul: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ aug: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ sep: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ oct: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ nov: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ dec: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ sum: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?..@ grid ? ? ? :Formal class 'GridTopology' [package "sp"] with 3 slots
>> ?.. .. ..@ cellcentre.offset: Named num [1:2] -127.7 54.2
>> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>> ?.. .. ..@ cellsize ? ? ? ? : Named num [1:2] 0.0625 0.0625
>> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>> ?.. .. ..@ cells.dim ? ? ? ?: Named int [1:2] 115 62
>> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>> ?..@ grid.index : int(0)
>> ?..@ coords ? ? : num [1:2, 1:2] -127.7 -120.6 54.2 58
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?.. .. ..$ : NULL
>> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> ?..@ bbox ? ? ? : num [1:2, 1:2] -127.8 54.2 -120.6 58.1
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> ?.. .. ..$ : chr [1:2] "min" "max"
>> ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>> ?.. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
>> +no_defs +towgs84=0,0,0"
>>
>> # attempt to write out a geotiff
>> writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
>> drivername = "GTiff", type = "Float32", mvFlag = NA, options=NULL,
>> copy_drivername = "GTiff")
>>
>>
>> The file that I write out only has NA values. I realize something is
>> wrong as I haven't figured out how to define which column I'd like to
>> convert.
>> Thanks in advance,
>> Hailey
>>
>


From jgarcia at ija.csic.es  Tue Feb  9 11:56:19 2010
From: jgarcia at ija.csic.es (jgarcia at ija.csic.es)
Date: Tue, 9 Feb 2010 11:56:19 +0100 (CET)
Subject: [R-sig-Geo] convert a shapefile to geotiff with type = "Float32"
In-Reply-To: <e3b09e741002081408x4277b16eq7050ae38c5a41eef@mail.gmail.com>
References: <e3b09e741002081156p293dc810o4c9a6054613f9a99@mail.gmail.com>
	<e3b09e741002081408x4277b16eq7050ae38c5a41eef@mail.gmail.com>
Message-ID: <1131.79.149.26.224.1265712979.squirrel@paleo.ija.csic.es>

I can tell that I have also a problem writting NA values in map exported
through rgdal (with several drivers, e.g., IDRISI) and imported in
ArcInfo. The NA values are not properly imported, and at the moment I'm
exporting NA values as a number (e.g., -9999)

Javier
---

> Hello again,
> My writeGDAL statement was slightly wrong.. I didn't have the NA
> values in quotes.
> it should be:
> # attempt to write out a geotiff
>  writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
> drivername = "GTiff", type = "Float32", mvFlag = 'NA', options=NULL,
> copy_drivername = "GTiff")
>
> I can now load the tiff file into QGis correctly, but still not ArcMap.
> Has anyone found a grid type that loads into Arc smoothly?
> Hailey
>
>
> On Mon, Feb 8, 2010 at 11:56 AM, Hailey Eckstrand
> <haileyeckstrand at gmail.com> wrote:
>> Hello List,
>> I am trying to load in a shapefile and then write it out as a geoTiff.
>> I am using the package rgdal.
>>
>> library("rgdal")
>> ## load in my shapefile
>> shp <-
>> readOGR("/home/data3/projects/hydrology/vic/output/water_balance/peace_cc/summary",
>> "peace_base_et_6190")
>>
>> # Just to be clear, here is the structure of my data
>> str(shp)
>> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>> ?..@ data ? ? ? :'data.frame': 3975 obs. of ?13 variables:
>> ?.. ..$ jan: num [1:3975] 12 12.4 12.3 12.3 12.5 ...
>> ?.. ..$ feb: num [1:3975] 12.8 13.2 13 13.1 13.5 ...
>> ?.. ..$ mar: num [1:3975] 16.3 16.6 16.8 16.8 17.1 ...
>> ?.. ..$ apr: num [1:3975] 31.2 33.7 30.1 28.1 29.2 ...
>> ?.. ..$ may: num [1:3975] 106 111 101 99 103 ...
>> ?.. ..$ jun: num [1:3975] 99.4 116 121.1 115.1 108 ...
>> ?.. ..$ jul: num [1:3975] 57.8 56.9 74.7 69.5 65 ...
>> ?.. ..$ aug: num [1:3975] 53.8 51.2 59.5 58.6 57.3 ...
>> ?.. ..$ sep: num [1:3975] 44 40.6 52.8 49.4 49.2 ...
>> ?.. ..$ oct: num [1:3975] 32.4 32 35.3 34.1 34.9 ...
>> ?.. ..$ nov: num [1:3975] 12.6 12.9 12.9 12.9 13.4 ...
>> ?.. ..$ dec: num [1:3975] 12.8 13.2 13.2 13.1 13.6 ...
>> ?.. ..$ sum: num [1:3975] 491 510 542 522 517 ...
>> ?..@ coords.nrs : num(0)
>> ?..@ coords ? ? : num [1:3975, 1:2] -123 -123 -122 -123 -123 ...
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?.. .. ..$ : NULL
>> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> ?..@ bbox ? ? ? : num [1:2, 1:2] -127.7 54.2 -120.6 58
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> ?.. .. ..$ : chr [1:2] "min" "max"
>> ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>> ?.. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
>> +no_defs +towgs84=0,0,0"
>>
>> # Convert it to a SpatialGridDataGrame, so I can writeGDAL
>> gridded(shp) <- TRUE
>> shp.grid <- as(shp, "SpatialGridDataFrame")
>>
>> # structure of my SpatialGridDataFrame
>> str(shp.grid)
>> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>> ?..@ data ? ? ? :'data.frame': 7130 obs. of ?13 variables:
>> ?.. ..$ jan: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ feb: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ mar: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ apr: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ may: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ jun: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ jul: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ aug: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ sep: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ oct: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ nov: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ dec: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?.. ..$ sum: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>> ?..@ grid ? ? ? :Formal class 'GridTopology' [package "sp"] with 3 slots
>> ?.. .. ..@ cellcentre.offset: Named num [1:2] -127.7 54.2
>> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>> ?.. .. ..@ cellsize ? ? ? ? : Named num [1:2] 0.0625 0.0625
>> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>> ?.. .. ..@ cells.dim ? ? ? ?: Named int [1:2] 115 62
>> ?.. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>> ?..@ grid.index : int(0)
>> ?..@ coords ? ? : num [1:2, 1:2] -127.7 -120.6 54.2 58
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?.. .. ..$ : NULL
>> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> ?..@ bbox ? ? ? : num [1:2, 1:2] -127.8 54.2 -120.6 58.1
>> ?.. ..- attr(*, "dimnames")=List of 2
>> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> ?.. .. ..$ : chr [1:2] "min" "max"
>> ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>> ?.. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
>> +no_defs +towgs84=0,0,0"
>>
>> # attempt to write out a geotiff
>> writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
>> drivername = "GTiff", type = "Float32", mvFlag = NA, options=NULL,
>> copy_drivername = "GTiff")
>>
>>
>> The file that I write out only has NA values. I realize something is
>> wrong as I haven't figured out how to define which column I'd like to
>> convert.
>> Thanks in advance,
>> Hailey
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From educheyne at avia-gis.be  Tue Feb  9 12:20:00 2010
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Tue, 9 Feb 2010 12:20:00 +0100
Subject: [R-sig-Geo] convert a shapefile to geotiff with type = "Float32"
In-Reply-To: <1131.79.149.26.224.1265712979.squirrel@paleo.ija.csic.es>
References: <e3b09e741002081156p293dc810o4c9a6054613f9a99@mail.gmail.com>
	<e3b09e741002081408x4277b16eq7050ae38c5a41eef@mail.gmail.com>
	<1131.79.149.26.224.1265712979.squirrel@paleo.ija.csic.es>
Message-ID: <D3011750-EAD4-4E27-8C80-A61E09AA1EAA@avia-gis.be>

Dear all
indeed some drivers cannot handle the NA
just modify them in R before you export and that does the trick

img[img(is.an)] <- (-9999)

Els
On 9 Feb 2010, at 11:56, jgarcia at ija.csic.es wrote:

> I can tell that I have also a problem writting NA values in map exported
> through rgdal (with several drivers, e.g., IDRISI) and imported in
> ArcInfo. The NA values are not properly imported, and at the moment I'm
> exporting NA values as a number (e.g., -9999)
> 
> Javier
> ---
> 
>> Hello again,
>> My writeGDAL statement was slightly wrong.. I didn't have the NA
>> values in quotes.
>> it should be:
>> # attempt to write out a geotiff
>> writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
>> drivername = "GTiff", type = "Float32", mvFlag = 'NA', options=NULL,
>> copy_drivername = "GTiff")
>> 
>> I can now load the tiff file into QGis correctly, but still not ArcMap.
>> Has anyone found a grid type that loads into Arc smoothly?
>> Hailey
>> 
>> 
>> On Mon, Feb 8, 2010 at 11:56 AM, Hailey Eckstrand
>> <haileyeckstrand at gmail.com> wrote:
>>> Hello List,
>>> I am trying to load in a shapefile and then write it out as a geoTiff.
>>> I am using the package rgdal.
>>> 
>>> library("rgdal")
>>> ## load in my shapefile
>>> shp <-
>>> readOGR("/home/data3/projects/hydrology/vic/output/water_balance/peace_cc/summary",
>>> "peace_base_et_6190")
>>> 
>>> # Just to be clear, here is the structure of my data
>>> str(shp)
>>> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>>>  ..@ data       :'data.frame': 3975 obs. of  13 variables:
>>>  .. ..$ jan: num [1:3975] 12 12.4 12.3 12.3 12.5 ...
>>>  .. ..$ feb: num [1:3975] 12.8 13.2 13 13.1 13.5 ...
>>>  .. ..$ mar: num [1:3975] 16.3 16.6 16.8 16.8 17.1 ...
>>>  .. ..$ apr: num [1:3975] 31.2 33.7 30.1 28.1 29.2 ...
>>>  .. ..$ may: num [1:3975] 106 111 101 99 103 ...
>>>  .. ..$ jun: num [1:3975] 99.4 116 121.1 115.1 108 ...
>>>  .. ..$ jul: num [1:3975] 57.8 56.9 74.7 69.5 65 ...
>>>  .. ..$ aug: num [1:3975] 53.8 51.2 59.5 58.6 57.3 ...
>>>  .. ..$ sep: num [1:3975] 44 40.6 52.8 49.4 49.2 ...
>>>  .. ..$ oct: num [1:3975] 32.4 32 35.3 34.1 34.9 ...
>>>  .. ..$ nov: num [1:3975] 12.6 12.9 12.9 12.9 13.4 ...
>>>  .. ..$ dec: num [1:3975] 12.8 13.2 13.2 13.1 13.6 ...
>>>  .. ..$ sum: num [1:3975] 491 510 542 522 517 ...
>>>  ..@ coords.nrs : num(0)
>>>  ..@ coords     : num [1:3975, 1:2] -123 -123 -122 -123 -123 ...
>>>  .. ..- attr(*, "dimnames")=List of 2
>>>  .. .. ..$ : NULL
>>>  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>>  ..@ bbox       : num [1:2, 1:2] -127.7 54.2 -120.6 58
>>>  .. ..- attr(*, "dimnames")=List of 2
>>>  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>>  .. .. ..$ : chr [1:2] "min" "max"
>>>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>>  .. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
>>> +no_defs +towgs84=0,0,0"
>>> 
>>> # Convert it to a SpatialGridDataGrame, so I can writeGDAL
>>> gridded(shp) <- TRUE
>>> shp.grid <- as(shp, "SpatialGridDataFrame")
>>> 
>>> # structure of my SpatialGridDataFrame
>>> str(shp.grid)
>>> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>>>  ..@ data       :'data.frame': 7130 obs. of  13 variables:
>>>  .. ..$ jan: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ feb: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ mar: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ apr: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ may: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ jun: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ jul: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ aug: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ sep: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ oct: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ nov: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ dec: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  .. ..$ sum: num [1:7130] NA NA NA NA NA NA NA NA NA NA ...
>>>  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>>>  .. .. ..@ cellcentre.offset: Named num [1:2] -127.7 54.2
>>>  .. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>>>  .. .. ..@ cellsize         : Named num [1:2] 0.0625 0.0625
>>>  .. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>>>  .. .. ..@ cells.dim        : Named int [1:2] 115 62
>>>  .. .. .. ..- attr(*, "names")= chr [1:2] "coords.x1" "coords.x2"
>>>  ..@ grid.index : int(0)
>>>  ..@ coords     : num [1:2, 1:2] -127.7 -120.6 54.2 58
>>>  .. ..- attr(*, "dimnames")=List of 2
>>>  .. .. ..$ : NULL
>>>  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>>  ..@ bbox       : num [1:2, 1:2] -127.8 54.2 -120.6 58.1
>>>  .. ..- attr(*, "dimnames")=List of 2
>>>  .. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>>>  .. .. ..$ : chr [1:2] "min" "max"
>>>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>>>  .. .. ..@ projargs: chr " +proj=longlat +ellps=WGS84 +datum=WGS84
>>> +no_defs +towgs84=0,0,0"
>>> 
>>> # attempt to write out a geotiff
>>> writeGDAL(shp.grd, "/home/data2/gis/AT_Hailey/r_rasters/test.tif",
>>> drivername = "GTiff", type = "Float32", mvFlag = NA, options=NULL,
>>> copy_drivername = "GTiff")
>>> 
>>> 
>>> The file that I write out only has NA values. I realize something is
>>> wrong as I haven't figured out how to define which column I'd like to
>>> convert.
>>> Thanks in advance,
>>> Hailey
>>> 
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From alobolistas at gmail.com  Tue Feb  9 14:32:28 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 9 Feb 2010 14:32:28 +0100
Subject: [R-sig-Geo] hist() in raster package
Message-ID: <f96702321002090532w5476b12anaedd6b0a1ca4a214@mail.gmail.com>

Hi!
I'm confused by the following
> r <- brick("SDIM0069.tif")
> nlayers(r)
[1] 3

Then I do
> hist(r)
and get 3 histograms plotted, but I do:
> a <- hist(r,plot=F)
and object a seems to hold the histogram of only one layer (actually,
the 3rd one):
> str(a)
List of 7
 $ breaks     : num [1:19] 0 5 10 15 20 25 30 35 40 45 ...
 $ counts     : int [1:18] 337 1131 1280 1172 951 815 808 827 741 636 ...
 $ intensities: num [1:18] 0.00675 0.02264 0.02563 0.02346 0.01904 ...
 $ density    : num [1:18] 0.00675 0.02264 0.02563 0.02346 0.01904 ...
 $ mids       : num [1:18] 2.5 7.5 12.5 17.5 22.5 27.5 32.5 37.5 42.5 47.5 ...
 $ xname      : chr "values"
 $ equidist   : logi TRUE
 - attr(*, "class")= chr "histogram"

Am I doing something wrong?

Thanks

Agus

PS. Is package RemoteSensing being under active development?


From wmconnol at ncsu.edu  Tue Feb  9 16:21:49 2010
From: wmconnol at ncsu.edu (Mark Connolly)
Date: Tue, 09 Feb 2010 10:21:49 -0500
Subject: [R-sig-Geo] are these methods appropriate for four dimensional
 modeling?
In-Reply-To: <201002081013.15620.dylan.beaudette@gmail.com>
References: <4B700863.2010103@ncsu.edu>
	<201002081013.15620.dylan.beaudette@gmail.com>
Message-ID: <4B717D8D.7090400@ncsu.edu>

On 02/08/2010 01:13 PM, Dylan Beaudette wrote:
> On Monday 08 February 2010, Mark Connolly wrote:
>    
>> repeat post - added signature
>>
>> I am working on a thesis in soil science with four dimensional modeling
>> as a major component.  I am using R for the interpolation of data and
>> VisIT to render the data as volumes and as volumes changing in time.  I
>> am using Applied Spatial Data Analysis with R (Bivand, Pebesma,
>> Gomez-Rubio) as a reference.  I've also been using Chatfield's Analysis
>> of Time Series, less for time series specifically than for helping to
>> understand the statistical concepts.
>>      
> Hi Mark, nice to see a fellow soil scientist on R-sig-geo.
>
>    
>> My data are soil property data. A purely spatial component comprises
>> nine soil physical properties taken across a 12 ha agriculture field.
>> There are sixty locations with five measurement depths at each location
>> (3D).  The spatial-temporal component is the measure of volumetric soil
>> moisture status taken at the same 300 positions.  These data are
>> discrete readings taken at unequal intervals.  The readings exist for
>> growing seasons over three years.
>>      
> We have a similar dataset, and have found that RST interpolation to be a
> useful starting point. GRASS has functionality for interpolating volumetric
> data, and numerous export routines for visualization in Paraview. Here are
> some examples:
>
> http://www-pool.math.tu-berlin.de/~soeren/grass/modules/screenshots/
>
>    
>> The observation grid is half regular and half semi-random.  Each of
>> thirty regularly placed locations has a satellite location set in random
>> proximity but not too far and not too close.  The observation depths are
>> at 15 cm intervals starting at -15 cm and extending down to -75 cm.
>>
>> My first pass through the data was mainly concerned with the mechanics
>> of the process.  I used IDW for interpolating each of the soil
>> properties through the volume (myriad packages including sp, gstat, and
>> others mentioned in Bivand et al), treating each property as independent
>> of the others.
>>
>> I then went after the temporal soil moisture data.  At each of the 300
>> positions, I took the set of time-sequenced measures (measurement
>> intervals varied from days to weeks during each growing season) and
>> interpolated values for days not measured.  I used the Stineman
>> algorithm provided by the na.stinterp function from the stinepack R
>> package.  Once I had all days for all positions, I used IDW again to
>> interpolate volumes for each day.
>>
>> Each volume was exported as an unstructured point grid for rendering in
>> VisIT.  My data analysis was limited to adjusting the IDW weighting
>> power such that the density distributions of the interpolated values
>> were similar to the density distributions of the observed values
>> (eyeballing overlaid plots).
>>
>> My interpolation grid cell size is defined at 10x10x1, modeling 10 m by
>> 10 m by 1 meter.  This is a little misleading.  I treat the depth
>> dimension as having the same units as the areal dimension, so -15 cm
>> becomes equivalent to -15 m.  Two reasons (the second not necessarily
>> defensible): I need the depth to be scaled for reasonable visualization,
>> and I want to decrease the influence of the depth measures on the layers
>> above and below each depth.
>>      
> Again RST interpolation to voxels may be useful in this case. There has been
> some talk on the GRASS mailing list about interpolation through time, but I
> haven't seen anything available yet.
>
> Cheers,
> Dylan
>
>
>    
>> In my next iteration through the data, I'd like to use the
>> geostatistical techniques presented in Bivand et al.  I have (just)
>> started with variograms with the hope of exploring the variogram in the
>> context of the volume.  I have run into the problem of dimensionality.
>> The plot functions are 2D, so projecting the variogram onto the
>> observation spatial volume is not working.  That got me thinking.  If I
>> use kriging, will I be using the influence of depth in the interpolation
>> model?  Is the variogram created with the influence of depth when the
>> spatial structure has three dimensions?  Is a better use to treat each
>> depth as a separate layer to be interpolated in two dimensions,
>> especially given that soils are often physically layered?  If three
>> dimensional kriging is okay, how about four dimensional to move through
>> a time series? Or would I be better to stick with the Stineman algorithm
>> for the time-series interpolation?
>>
>> Any feedback on this (including any warnings that I might be abusing
>> things with my time series and IDW approaches) would be very much
>> appreciated.  I am definitely in learning mode.
>>
>> Mark
>>      
>
>
>    
Thanks for the feedback and the link.  Are you using RST for the amount 
of smoothness you are getting?  Better interpolation results compared to 
some form of kriging, based on RSME, for example?  Some other reason?

-- 
Graduate Student, Master of Science
Department of Soil Science
North Carolina State University


From alobolistas at gmail.com  Tue Feb  9 19:08:26 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 09 Feb 2010 19:08:26 +0100
Subject: [R-sig-Geo] More on hist() from raster package
Message-ID: <4B71A49A.3050107@gmail.com>

After trying with the linux version
(0.9.9.-12), I get a different behaviour than with the last windows version:
 > a <- hist(r, plot=F)
 > a
NULL

Also,

1. Considering r is a brick of 3 bands, how can I select a given band?
2. How can I change the 2x2 plot regions? I want a 1x3, and tried
setting par(mfrow=c(1,3)) before hist() but get the same 2x2
arrangement of the 3 histograms

Thanks for this powerful package!

Agus


From alobolistas at gmail.com  Tue Feb  9 19:42:44 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 09 Feb 2010 19:42:44 +0100
Subject: [R-sig-Geo] Bug in brick() (raster package)?
Message-ID: <4B71ACA4.4040101@gmail.com>

I might have found a bug in raster while trying to set the xlim for
my histograms taking into account whether input files are 8 or 16 bits.
In the following, note that GDALinfo reports one file as Byte and the
other one as UInt16, while brick() sets the same file at datanotation slot
for both files:

 > GDALinfo("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0373.tif")
CPL Warning 1: TIFFReadDirectory:Unknown field with tag 37717 (0x9355) encountered
rows        1760
columns     2640
bands       3
origin.x        0
origin.y        0
res.x       1
res.y       1
oblique.x   0
oblique.y   0
driver      GTiff
projection  NA
file        /media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0373.tif
apparent band summary:
   GDType Bmin Bmax
1   Byte    0  255
2   Byte    0  255
3   Byte    0  255
Metadata:
TIFFTAG_SOFTWARE=SIGMA PhotoPro 2.5.0.3250
TIFFTAG_DATETIME=2010:02:09 17:25:29
TIFFTAG_XRESOLUTION=180
TIFFTAG_YRESOLUTION=180
TIFFTAG_RESOLUTIONUNIT=2 (pixels/inch)
Warning message:
In GDALinfo("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0373.tif") :
   GeoTransform values not available

 > r <- brick("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0373.tif")
CPL Warning 1: TIFFReadDirectory:Unknown field with tag 37717 (0x9355) encountered
Warning message:
In GDALinfo(filename) : GeoTransform values not available

 > r at file@datanotation
[1] "FLT4S"

 > GDALinfo("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0402.tif")
CPL Warning 1: TIFFReadDirectory:Unknown field with tag 37717 (0x9355) encountered
rows        3048
columns     4573
bands       3
origin.x        0
origin.y        0
res.x       1
res.y       1
oblique.x   0
oblique.y   0
driver      GTiff
projection  NA
file        /media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0402.tif
apparent band summary:
   GDType Bmin  Bmax
1 UInt16    0 65535
2 UInt16    0 65535
3 UInt16    0 65535
Metadata:
TIFFTAG_SOFTWARE=SIGMA PhotoPro 2.5.0.3250
TIFFTAG_DATETIME=2009:11:05 09:08:39
TIFFTAG_XRESOLUTION=180
TIFFTAG_YRESOLUTION=180
TIFFTAG_RESOLUTIONUNIT=2 (pixels/inch)
Warning message:
In GDALinfo("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0402.tif") :
   GeoTransform values not available

 > r <- brick("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0402.tif")
CPL Warning 1: TIFFReadDirectory:Unknown field with tag 37717 (0x9355) encountered
Warning message:
In GDALinfo(filename) : GeoTransform values not available

 > r at file@datanotation
[1] "FLT4S"

Hope this is useful

Agus


From r.hijmans at gmail.com  Tue Feb  9 20:08:33 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 9 Feb 2010 11:08:33 -0800
Subject: [R-sig-Geo] hist() in raster package
In-Reply-To: <f96702321002090532w5476b12anaedd6b0a1ca4a214@mail.gmail.com>
References: <f96702321002090532w5476b12anaedd6b0a1ca4a214@mail.gmail.com>
Message-ID: <dc22b2571002091108t3a1d7824lc0d2101969bb59a@mail.gmail.com>

Hello Agus,

You did not do anything wrong. I did. This has been fixed in version
0.9.9-14 and hist now returns a histogram object (invisibly if plot =
TRUE) or a list of such objects.

Development of pkg RemoteSensing is currently a bit slow and the code
unorganized, but I think it will get more active again soon.

Robert



On Tue, Feb 9, 2010 at 5:32 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
> I'm confused by the following
>> r <- brick("SDIM0069.tif")
>> nlayers(r)
> [1] 3
>
> Then I do
>> hist(r)
> and get 3 histograms plotted, but I do:
>> a <- hist(r,plot=F)
> and object a seems to hold the histogram of only one layer (actually,
> the 3rd one):
>> str(a)
> List of 7
> ?$ breaks ? ? : num [1:19] 0 5 10 15 20 25 30 35 40 45 ...
> ?$ counts ? ? : int [1:18] 337 1131 1280 1172 951 815 808 827 741 636 ...
> ?$ intensities: num [1:18] 0.00675 0.02264 0.02563 0.02346 0.01904 ...
> ?$ density ? ?: num [1:18] 0.00675 0.02264 0.02563 0.02346 0.01904 ...
> ?$ mids ? ? ? : num [1:18] 2.5 7.5 12.5 17.5 22.5 27.5 32.5 37.5 42.5 47.5 ...
> ?$ xname ? ? ?: chr "values"
> ?$ equidist ? : logi TRUE
> ?- attr(*, "class")= chr "histogram"
>
> Am I doing something wrong?
>
> Thanks
>
> Agus
>
> PS. Is package RemoteSensing being under active development?
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Tue Feb  9 20:18:02 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 9 Feb 2010 11:18:02 -0800
Subject: [R-sig-Geo] Bug in brick() (raster package)?
In-Reply-To: <4B71ACA4.4040101@gmail.com>
References: <4B71ACA4.4040101@gmail.com>
Message-ID: <dc22b2571002091118ne932344k4a8893668e82a09e@mail.gmail.com>

Hi Agus, Thanks for reporing this. It is not really a bug, as what is
reported by   dataType(object)   is used for reading native formats
and for writing. When I developed this, GDALinfo did not report the
data type (or perhaps I missed it).  I shall update the value in the
Raster* object accordingly to reflect the true data type; if anything
to avoid confusion.  Robert

On Tue, Feb 9, 2010 at 10:42 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> I might have found a bug in raster while trying to set the xlim for
> my histograms taking into account whether input files are 8 or 16 bits.
> In the following, note that GDALinfo reports one file as Byte and the
> other one as UInt16, while brick() sets the same file at datanotation slot
> for both files:
>
>>
>> GDALinfo("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0373.tif")
> CPL Warning 1: TIFFReadDirectory:Unknown field with tag 37717 (0x9355)
> encountered
> rows ? ? ? ?1760
> columns ? ? 2640
> bands ? ? ? 3
> origin.x ? ? ? ?0
> origin.y ? ? ? ?0
> res.x ? ? ? 1
> res.y ? ? ? 1
> oblique.x ? 0
> oblique.y ? 0
> driver ? ? ?GTiff
> projection ?NA
> file
> ?/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0373.tif
> apparent band summary:
> ?GDType Bmin Bmax
> 1 ? Byte ? ?0 ?255
> 2 ? Byte ? ?0 ?255
> 3 ? Byte ? ?0 ?255
> Metadata:
> TIFFTAG_SOFTWARE=SIGMA PhotoPro 2.5.0.3250
> TIFFTAG_DATETIME=2010:02:09 17:25:29
> TIFFTAG_XRESOLUTION=180
> TIFFTAG_YRESOLUTION=180
> TIFFTAG_RESOLUTIONUNIT=2 (pixels/inch)
> Warning message:
> In
> GDALinfo("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0373.tif")
> :
> ?GeoTransform values not available
>
>> r <-
>> brick("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0373.tif")
> CPL Warning 1: TIFFReadDirectory:Unknown field with tag 37717 (0x9355)
> encountered
> Warning message:
> In GDALinfo(filename) : GeoTransform values not available
>
>> r at file@datanotation
> [1] "FLT4S"
>
>>
>> GDALinfo("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0402.tif")
> CPL Warning 1: TIFFReadDirectory:Unknown field with tag 37717 (0x9355)
> encountered
> rows ? ? ? ?3048
> columns ? ? 4573
> bands ? ? ? 3
> origin.x ? ? ? ?0
> origin.y ? ? ? ?0
> res.x ? ? ? 1
> res.y ? ? ? 1
> oblique.x ? 0
> oblique.y ? 0
> driver ? ? ?GTiff
> projection ?NA
> file
> ?/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0402.tif
> apparent band summary:
> ?GDType Bmin ?Bmax
> 1 UInt16 ? ?0 65535
> 2 UInt16 ? ?0 65535
> 3 UInt16 ? ?0 65535
> Metadata:
> TIFFTAG_SOFTWARE=SIGMA PhotoPro 2.5.0.3250
> TIFFTAG_DATETIME=2009:11:05 09:08:39
> TIFFTAG_XRESOLUTION=180
> TIFFTAG_YRESOLUTION=180
> TIFFTAG_RESOLUTIONUNIT=2 (pixels/inch)
> Warning message:
> In
> GDALinfo("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0402.tif")
> :
> ?GeoTransform values not available
>
>> r <-
>> brick("/media/Transcend/MONTSENY2008/Montseny20090409/TiffOri/sdim0402.tif")
> CPL Warning 1: TIFFReadDirectory:Unknown field with tag 37717 (0x9355)
> encountered
> Warning message:
> In GDALinfo(filename) : GeoTransform values not available
>
>> r at file@datanotation
> [1] "FLT4S"
>
> Hope this is useful
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Wed Feb 10 09:01:10 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Feb 2010 09:01:10 +0100
Subject: [R-sig-Geo] hist() in raster package
In-Reply-To: <dc22b2571002091108t3a1d7824lc0d2101969bb59a@mail.gmail.com>
References: <f96702321002090532w5476b12anaedd6b0a1ca4a214@mail.gmail.com>
	<dc22b2571002091108t3a1d7824lc0d2101969bb59a@mail.gmail.com>
Message-ID: <4B7267C6.50208@gmail.com>

Robert,

I'm using
 > packageDescription("raster")
Package: raster
Type: Package
Title: Geographic analysis and modeling with raster data
Version: 0.9.9-14
Date: 8-Febrary-2010

(Maybe I should wait few more hours to get the fixed version?
The date above seems earlier than your message, but just to let you
know in case this is a really pending issue, as you were mentioning 0.9.9-14)

on a linux machine now and still have problems
 > a <- hist(r,plot=F,maxnsample=100)
 > a
NULL

also, the graphic window gets opened although
no graphic is plotted.


Thanks for you help.

Agus

Robert J. Hijmans wrote:
> Hello Agus,
> 
> You did not do anything wrong. I did. This has been fixed in version
> 0.9.9-14 and hist now returns a histogram object (invisibly if plot =
> TRUE) or a list of such objects.
> 
> Development of pkg RemoteSensing is currently a bit slow and the code
> unorganized, but I think it will get more active again soon.
> 
> Robert
> 
> 
> 
> On Tue, Feb 9, 2010 at 5:32 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi!
>> I'm confused by the following
>>> r <- brick("SDIM0069.tif")
>>> nlayers(r)
>> [1] 3
>>
>> Then I do
>>> hist(r)
>> and get 3 histograms plotted, but I do:
>>> a <- hist(r,plot=F)
>> and object a seems to hold the histogram of only one layer (actually,
>> the 3rd one):
>>> str(a)
>> List of 7
>>  $ breaks     : num [1:19] 0 5 10 15 20 25 30 35 40 45 ...
>>  $ counts     : int [1:18] 337 1131 1280 1172 951 815 808 827 741 636 ...
>>  $ intensities: num [1:18] 0.00675 0.02264 0.02563 0.02346 0.01904 ...
>>  $ density    : num [1:18] 0.00675 0.02264 0.02563 0.02346 0.01904 ...
>>  $ mids       : num [1:18] 2.5 7.5 12.5 17.5 22.5 27.5 32.5 37.5 42.5 47.5 ...
>>  $ xname      : chr "values"
>>  $ equidist   : logi TRUE
>>  - attr(*, "class")= chr "histogram"
>>
>> Am I doing something wrong?
>>
>> Thanks
>>
>> Agus
>>
>> PS. Is package RemoteSensing being under active development?
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From muhammad.rahiz at ouce.ox.ac.uk  Wed Feb 10 10:51:40 2010
From: muhammad.rahiz at ouce.ox.ac.uk (Muhammad Rahiz)
Date: Wed, 10 Feb 2010 09:51:40 +0000
Subject: [R-sig-Geo] Question about image.plot
Message-ID: <4B7281AC.10406@ouce.ox.ac.uk>

Dear all,

I've plotted my data using the following

image.plot(data, zlim=c(0,500), add=FALSE, nlevel=64, horizontal=T, 
legend.shrink=0.5, legend.width=.8, col=tim.colors(64))

However, I see white spaces in my image which I attribute them to values 
that is >500 than that defined in zlim().

Does anyone have any suggestions how I can rectify this issue? I am 
thinking in the lines of, if value >=500, assign color x.



Thanks.


Muhammad


From alobolistas at gmail.com  Wed Feb 10 15:28:06 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Feb 2010 15:28:06 +0100
Subject: [R-sig-Geo] Reversed raster after readGDAL()
Message-ID: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100210/06399382/attachment.pl>

From alobolistas at gmail.com  Wed Feb 10 16:23:39 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Feb 2010 16:23:39 +0100
Subject: [R-sig-Geo] Fwd:  Reversed raster after readGDAL()
In-Reply-To: <f96702321002100704o1dadf1a5xb9daa724aa9e1dd1@mail.gmail.com>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
	<alpine.LRH.2.00.1002101547000.3457@reclus.nhh.no>
	<f96702321002100704o1dadf1a5xb9daa724aa9e1dd1@mail.gmail.com>
Message-ID: <f96702321002100723mf428bc3x207690f5dde428a2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100210/24954f1e/attachment.pl>

From Roger.Bivand at nhh.no  Wed Feb 10 16:23:27 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Feb 2010 16:23:27 +0100 (CET)
Subject: [R-sig-Geo] Reversed raster after readGDAL()
In-Reply-To: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>

On Wed, 10 Feb 2010, Agustin Lobo wrote:

> Hi!
>
> After
>
>> r3 <- readGDAL("test2.tif")
> test2.tif has GDAL driver GTiff
> and has 256 rows and 256 columns
>
>> image(r3,col=rainbow(128))
>
> I get the image N-S reversed.
>
> I've put an screenshot and the actual geotif image here:
>
> http://sites.google.com/site/eospansite/dummy/test2_screenshot2.jpeg
> http://sites.google.com/site/eospansite/dummy/test2.tif

Collected from:

http://sites.google.com/site/eospansite/dummy

Yes, it is flipped on the Y axis. What software made it? Could you please 
show the images with axes, as I think that the GTiff has a wrong sign on 
its y-step? What are the coordinates of the NW and SW corners of the image 
in QGIS? GDAL expects images to be read by row N to S, so a y-step with 
the wrong sign (+ instead of -) flips the image northward.

Roger

PS:

gdalinfo externally has lower left north of upper left:

> system("gdalinfo test2.tif")
Driver: GTiff/GeoTIFF
Files: test2.tif
Size is 256, 256
Coordinate System is:
PROJCS["ED50 / UTM zone 31N",
     GEOGCS["ED50",
         DATUM["European_Datum_1950",
             SPHEROID["International 1924",6378388,297.0000000000014,
                 AUTHORITY["EPSG","7022"]],
             AUTHORITY["EPSG","6230"]],
         PRIMEM["Greenwich",0],
         UNIT["degree",0.0174532925199433],
         AUTHORITY["EPSG","4230"]],
     PROJECTION["Transverse_Mercator"],
     PARAMETER["latitude_of_origin",0],
     PARAMETER["central_meridian",3],
     PARAMETER["scale_factor",0.9996],
     PARAMETER["false_easting",500000],
     PARAMETER["false_northing",0],
     UNIT["metre",1,
         AUTHORITY["EPSG","9001"]],
     AUTHORITY["EPSG","23031"]]
Origin = (424389.000000000000000,4635822.000000000000000)
Pixel Size = (345.007812500000000,194.019531250000000)
Metadata:
   AREA_OR_POINT=Area
Image Structure Metadata:
   INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (  424389.000, 4635822.000) (  2d 5'20.10"E, 41d52'11.88"N)
Lower Left  (  424389.000, 4685491.000) (  2d 4'56.97"E, 42d19'2.06"N)
Upper Right (  512711.000, 4635822.000) (  3d 9'11.42"E, 41d52'24.52"N)
Lower Right (  512711.000, 4685491.000) (  3d 9'15.31"E, 42d19'14.90"N)
Center      (  468550.000, 4660656.500) (  2d37'10.89"E, 42d 5'47.83"N)
Band 1 Block=256x4 Type=Float64, ColorInterp=Gray

and:

> GDALinfo("test2.tif")
rows        256
columns     256
bands       1
origin.x        424389
origin.y        4636016
res.x       345.0078
res.y       194.0195
oblique.x   0
oblique.y   0
driver      GTiff
projection  +proj=utm +zone=31 +ellps=intl +units=m +no_defs
file        test2.tif
apparent band summary:
    GDType        Bmin       Bmax
1 Float64 -4294967295 4294967295
Metadata:
AREA_OR_POINT=Area


>
> Agus
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From alobolistas at gmail.com  Wed Feb 10 17:17:37 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Feb 2010 17:17:37 +0100
Subject: [R-sig-Geo] Reversed raster after readGDAL()
In-Reply-To: <alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
	<alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>
Message-ID: <f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>

I think I tripped on this same stone, but cannot find anything in my
records, perhaps it's on the lost computer.

The file test2.tif was made by plugin Interpolation in QGIS out of a
vector layer of points with nitrate concentration values, just
a simple inverse distance method. I think that the author f that
pluginis Marco Hugentobler (Marco, sorry if it's not you) to whom I'm
forwarding.

Relevant info from the metadata in QGIS for this raster:

Layer Spatial Reference System:
+proj=utm +zone=31 +ellps=intl +units=m +no_defs

Origin
424389,4.68549e+06

Pixel Size:
279.887,-279.887

NW corner in QGIS (interactive):424388.820,4685490.931
SW corner in QGIS (interactive):424389.122,4635951.740

Image with grid: http://sites.google.com/site/eospansite/dummy/test2gridqgis.jpg

The weird thing is that QGIS uses gdal to read the geotif files.


Agus

2010/2/10 Roger Bivand <Roger.Bivand at nhh.no>
>
> On Wed, 10 Feb 2010, Agustin Lobo wrote:
>
>> Hi!
>>
>> After
>>
>>> r3 <- readGDAL("test2.tif")
>>
>> test2.tif has GDAL driver GTiff
>> and has 256 rows and 256 columns
>>
>>> image(r3,col=rainbow(128))
>>
>> I get the image N-S reversed.
>>
>> I've put an screenshot and the actual geotif image here:
>>
>> http://sites.google.com/site/eospansite/dummy/test2_screenshot2.jpeg
>> http://sites.google.com/site/eospansite/dummy/test2.tif
>
> Collected from:
>
> http://sites.google.com/site/eospansite/dummy
>
> Yes, it is flipped on the Y axis. What software made it? Could you please show the images with axes, as I think that the GTiff has a wrong sign on its y-step? What are the coordinates of the NW and SW corners of the image in QGIS? GDAL expects images to be read by row N to S, so a y-step with the wrong sign (+ instead of -) flips the image northward.
>
> Roger
>
> PS:
>
> gdalinfo externally has lower left north of upper left:
>
>> system("gdalinfo test2.tif")
>
> Driver: GTiff/GeoTIFF
> Files: test2.tif
> Size is 256, 256
> Coordinate System is:
> PROJCS["ED50 / UTM zone 31N",
> ? ?GEOGCS["ED50",
> ? ? ? ?DATUM["European_Datum_1950",
> ? ? ? ? ? ?SPHEROID["International 1924",6378388,297.0000000000014,
> ? ? ? ? ? ? ? ?AUTHORITY["EPSG","7022"]],
> ? ? ? ? ? ?AUTHORITY["EPSG","6230"]],
> ? ? ? ?PRIMEM["Greenwich",0],
> ? ? ? ?UNIT["degree",0.0174532925199433],
> ? ? ? ?AUTHORITY["EPSG","4230"]],
> ? ?PROJECTION["Transverse_Mercator"],
> ? ?PARAMETER["latitude_of_origin",0],
> ? ?PARAMETER["central_meridian",3],
> ? ?PARAMETER["scale_factor",0.9996],
> ? ?PARAMETER["false_easting",500000],
> ? ?PARAMETER["false_northing",0],
> ? ?UNIT["metre",1,
> ? ? ? ?AUTHORITY["EPSG","9001"]],
> ? ?AUTHORITY["EPSG","23031"]]
> Origin = (424389.000000000000000,4635822.000000000000000)
> Pixel Size = (345.007812500000000,194.019531250000000)
> Metadata:
> ?AREA_OR_POINT=Area
> Image Structure Metadata:
> ?INTERLEAVE=BAND
> Corner Coordinates:
> Upper Left ?( ?424389.000, 4635822.000) ( ?2d 5'20.10"E, 41d52'11.88"N)
> Lower Left ?( ?424389.000, 4685491.000) ( ?2d 4'56.97"E, 42d19'2.06"N)
> Upper Right ( ?512711.000, 4635822.000) ( ?3d 9'11.42"E, 41d52'24.52"N)
> Lower Right ( ?512711.000, 4685491.000) ( ?3d 9'15.31"E, 42d19'14.90"N)
> Center ? ? ?( ?468550.000, 4660656.500) ( ?2d37'10.89"E, 42d 5'47.83"N)
> Band 1 Block=256x4 Type=Float64, ColorInterp=Gray
>
> and:
>
>> GDALinfo("test2.tif")
>
> rows ? ? ? ?256
> columns ? ? 256
> bands ? ? ? 1
> origin.x ? ? ? ?424389
> origin.y ? ? ? ?4636016
> res.x ? ? ? 345.0078
> res.y ? ? ? 194.0195
> oblique.x ? 0
> oblique.y ? 0
> driver ? ? ?GTiff
> projection ?+proj=utm +zone=31 +ellps=intl +units=m +no_defs
> file ? ? ? ?test2.tif
> apparent band summary:
> ? GDType ? ? ? ?Bmin ? ? ? Bmax
> 1 Float64 -4294967295 4294967295
> Metadata:
> AREA_OR_POINT=Area
>
>
>>
>> Agus
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From sarah.goslee at gmail.com  Wed Feb 10 17:34:20 2010
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Wed, 10 Feb 2010 11:34:20 -0500
Subject: [R-sig-Geo] Reversed raster after readGDAL()
In-Reply-To: <f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
	<alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>
	<f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>
Message-ID: <efb536d51002100834o529fcfdap9dbc1a3686a1d73e@mail.gmail.com>

This may well be too simplistic an answer, but it might just be image().

>From the help for image:
     Notice that ?image? interprets the ?z? matrix as a table of
     ?f(x[i], y[j])? values, so that the x axis corresponds to row
     number and the y axis to column number, with column 1 at the
     bottom, i.e. a 90 degree counter-clockwise rotation of the
     conventional printed layout of a matrix.

x <- matrix(rep(1:10, each=10), nrow=10)
x
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
 [1,]    1    2    3    4    5    6    7    8    9    10
 [2,]    1    2    3    4    5    6    7    8    9    10
 [3,]    1    2    3    4    5    6    7    8    9    10
 [4,]    1    2    3    4    5    6    7    8    9    10
 [5,]    1    2    3    4    5    6    7    8    9    10
 [6,]    1    2    3    4    5    6    7    8    9    10
 [7,]    1    2    3    4    5    6    7    8    9    10
 [8,]    1    2    3    4    5    6    7    8    9    10
 [9,]    1    2    3    4    5    6    7    8    9    10
[10,]    1    2    3    4    5    6    7    8    9    10
image(x) # not what you might expect
image(t(x)) # this view matches the matrix representation

What happens if you use plot(mygeotiff) instead of image(mygeotiff)?

Sarah

On Wed, Feb 10, 2010 at 11:17 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> I think I tripped on this same stone, but cannot find anything in my
> records, perhaps it's on the lost computer.
>
> The file test2.tif was made by plugin Interpolation in QGIS out of a
> vector layer of points with nitrate concentration values, just
> a simple inverse distance method. I think that the author f that
> pluginis Marco Hugentobler (Marco, sorry if it's not you) to whom I'm
> forwarding.
>
> Relevant info from the metadata in QGIS for this raster:
>
> Layer Spatial Reference System:
> +proj=utm +zone=31 +ellps=intl +units=m +no_defs
>
> Origin
> 424389,4.68549e+06
>
> Pixel Size:
> 279.887,-279.887
>
> NW corner in QGIS (interactive):424388.820,4685490.931
> SW corner in QGIS (interactive):424389.122,4635951.740
>
> Image with grid: http://sites.google.com/site/eospansite/dummy/test2gridqgis.jpg
>
> The weird thing is that QGIS uses gdal to read the geotif files.
>
>
> Agus
>


-- 
Sarah Goslee
http://www.functionaldiversity.org


From alobolistas at gmail.com  Wed Feb 10 17:43:21 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Feb 2010 17:43:21 +0100
Subject: [R-sig-Geo] Reversed raster after readGDAL()
In-Reply-To: <efb536d51002100834o529fcfdap9dbc1a3686a1d73e@mail.gmail.com>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
	<alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>
	<f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>
	<efb536d51002100834o529fcfdap9dbc1a3686a1d73e@mail.gmail.com>
Message-ID: <f96702321002100843q4d6d0f2bj936f904b505e1d2@mail.gmail.com>

Thanks Sarah. But I think that package sp has an specific method of
image() for objects SpatialGridDataFrame, which is the class returned
by readGDAL(), and this specific method takes care of this problem. Check
image.SpatialGridDataFrame in package {sp}

Agus

2010/2/10 Sarah Goslee <sarah.goslee at gmail.com>:
> This may well be too simplistic an answer, but it might just be image().
>
> From the help for image:
> ? ? Notice that ?image? interprets the ?z? matrix as a table of
> ? ? ?f(x[i], y[j])? values, so that the x axis corresponds to row
> ? ? number and the y axis to column number, with column 1 at the
> ? ? bottom, i.e. a 90 degree counter-clockwise rotation of the
> ? ? conventional printed layout of a matrix.
>
> x <- matrix(rep(1:10, each=10), nrow=10)
> x
> ? ? ?[,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
> ?[1,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> ?[2,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> ?[3,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> ?[4,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> ?[5,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> ?[6,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> ?[7,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> ?[8,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> ?[9,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> [10,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
> image(x) # not what you might expect
> image(t(x)) # this view matches the matrix representation
>
> What happens if you use plot(mygeotiff) instead of image(mygeotiff)?
>
> Sarah
>
> On Wed, Feb 10, 2010 at 11:17 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> I think I tripped on this same stone, but cannot find anything in my
>> records, perhaps it's on the lost computer.
>>
>> The file test2.tif was made by plugin Interpolation in QGIS out of a
>> vector layer of points with nitrate concentration values, just
>> a simple inverse distance method. I think that the author f that
>> pluginis Marco Hugentobler (Marco, sorry if it's not you) to whom I'm
>> forwarding.
>>
>> Relevant info from the metadata in QGIS for this raster:
>>
>> Layer Spatial Reference System:
>> +proj=utm +zone=31 +ellps=intl +units=m +no_defs
>>
>> Origin
>> 424389,4.68549e+06
>>
>> Pixel Size:
>> 279.887,-279.887
>>
>> NW corner in QGIS (interactive):424388.820,4685490.931
>> SW corner in QGIS (interactive):424389.122,4635951.740
>>
>> Image with grid: http://sites.google.com/site/eospansite/dummy/test2gridqgis.jpg
>>
>> The weird thing is that QGIS uses gdal to read the geotif files.
>>
>>
>> Agus
>>
>
>
> --
> Sarah Goslee
> http://www.functionaldiversity.org
>


From p.hiemstra at geo.uu.nl  Wed Feb 10 17:43:03 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 10 Feb 2010 17:43:03 +0100
Subject: [R-sig-Geo] Reversed raster after readGDAL()
In-Reply-To: <f96702321002100843q4d6d0f2bj936f904b505e1d2@mail.gmail.com>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>	<alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>	<f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>	<efb536d51002100834o529fcfdap9dbc1a3686a1d73e@mail.gmail.com>
	<f96702321002100843q4d6d0f2bj936f904b505e1d2@mail.gmail.com>
Message-ID: <4B72E217.8050607@geo.uu.nl>

Hi,

What if you make an spplot, still the same problem?

cheers,
Paul

Agustin Lobo wrote:
> Thanks Sarah. But I think that package sp has an specific method of
> image() for objects SpatialGridDataFrame, which is the class returned
> by readGDAL(), and this specific method takes care of this problem. Check
> image.SpatialGridDataFrame in package {sp}
>
> Agus
>
> 2010/2/10 Sarah Goslee <sarah.goslee at gmail.com>:
>   
>> This may well be too simplistic an answer, but it might just be image().
>>
>> From the help for image:
>>     Notice that ?image? interprets the ?z? matrix as a table of
>>     ?f(x[i], y[j])? values, so that the x axis corresponds to row
>>     number and the y axis to column number, with column 1 at the
>>     bottom, i.e. a 90 degree counter-clockwise rotation of the
>>     conventional printed layout of a matrix.
>>
>> x <- matrix(rep(1:10, each=10), nrow=10)
>> x
>>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
>>  [1,]    1    2    3    4    5    6    7    8    9    10
>>  [2,]    1    2    3    4    5    6    7    8    9    10
>>  [3,]    1    2    3    4    5    6    7    8    9    10
>>  [4,]    1    2    3    4    5    6    7    8    9    10
>>  [5,]    1    2    3    4    5    6    7    8    9    10
>>  [6,]    1    2    3    4    5    6    7    8    9    10
>>  [7,]    1    2    3    4    5    6    7    8    9    10
>>  [8,]    1    2    3    4    5    6    7    8    9    10
>>  [9,]    1    2    3    4    5    6    7    8    9    10
>> [10,]    1    2    3    4    5    6    7    8    9    10
>> image(x) # not what you might expect
>> image(t(x)) # this view matches the matrix representation
>>
>> What happens if you use plot(mygeotiff) instead of image(mygeotiff)?
>>
>> Sarah
>>
>> On Wed, Feb 10, 2010 at 11:17 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>     
>>> I think I tripped on this same stone, but cannot find anything in my
>>> records, perhaps it's on the lost computer.
>>>
>>> The file test2.tif was made by plugin Interpolation in QGIS out of a
>>> vector layer of points with nitrate concentration values, just
>>> a simple inverse distance method. I think that the author f that
>>> pluginis Marco Hugentobler (Marco, sorry if it's not you) to whom I'm
>>> forwarding.
>>>
>>> Relevant info from the metadata in QGIS for this raster:
>>>
>>> Layer Spatial Reference System:
>>> +proj=utm +zone=31 +ellps=intl +units=m +no_defs
>>>
>>> Origin
>>> 424389,4.68549e+06
>>>
>>> Pixel Size:
>>> 279.887,-279.887
>>>
>>> NW corner in QGIS (interactive):424388.820,4685490.931
>>> SW corner in QGIS (interactive):424389.122,4635951.740
>>>
>>> Image with grid: http://sites.google.com/site/eospansite/dummy/test2gridqgis.jpg
>>>
>>> The weird thing is that QGIS uses gdal to read the geotif files.
>>>
>>>
>>> Agus
>>>
>>>       
>> --
>> Sarah Goslee
>> http://www.functionaldiversity.org
>>
>>     
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From alobolistas at gmail.com  Wed Feb 10 17:53:58 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Feb 2010 17:53:58 +0100
Subject: [R-sig-Geo] Reversed raster after readGDAL()
In-Reply-To: <4B72E217.8050607@geo.uu.nl>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
	<alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>
	<f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>
	<efb536d51002100834o529fcfdap9dbc1a3686a1d73e@mail.gmail.com>
	<f96702321002100843q4d6d0f2bj936f904b505e1d2@mail.gmail.com>
	<4B72E217.8050607@geo.uu.nl>
Message-ID: <f96702321002100853x6eaa1285ra731322a4f78829e@mail.gmail.com>

Yes, same problem
Agus

2010/2/10 Paul Hiemstra <p.hiemstra at geo.uu.nl>:
> Hi,
>
> What if you make an spplot, still the same problem?
>
> cheers,
> Paul
>
> Agustin Lobo wrote:
>>
>> Thanks Sarah. But I think that package sp has an specific method of
>> image() for objects SpatialGridDataFrame, which is the class returned
>> by readGDAL(), and this specific method takes care of this problem. Check
>> image.SpatialGridDataFrame in package {sp}
>>
>> Agus
>>
>> 2010/2/10 Sarah Goslee <sarah.goslee at gmail.com>:
>>
>>>
>>> This may well be too simplistic an answer, but it might just be image().
>>>
>>> From the help for image:
>>> ? ?Notice that ?image? interprets the ?z? matrix as a table of
>>> ? ??f(x[i], y[j])? values, so that the x axis corresponds to row
>>> ? ?number and the y axis to column number, with column 1 at the
>>> ? ?bottom, i.e. a 90 degree counter-clockwise rotation of the
>>> ? ?conventional printed layout of a matrix.
>>>
>>> x <- matrix(rep(1:10, each=10), nrow=10)
>>> x
>>> ? ? [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
>>> ?[1,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> ?[2,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> ?[3,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> ?[4,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> ?[5,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> ?[6,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> ?[7,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> ?[8,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> ?[9,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> [10,] ? ?1 ? ?2 ? ?3 ? ?4 ? ?5 ? ?6 ? ?7 ? ?8 ? ?9 ? ?10
>>> image(x) # not what you might expect
>>> image(t(x)) # this view matches the matrix representation
>>>
>>> What happens if you use plot(mygeotiff) instead of image(mygeotiff)?
>>>
>>> Sarah
>>>
>>> On Wed, Feb 10, 2010 at 11:17 AM, Agustin Lobo <alobolistas at gmail.com>
>>> wrote:
>>>
>>>>
>>>> I think I tripped on this same stone, but cannot find anything in my
>>>> records, perhaps it's on the lost computer.
>>>>
>>>> The file test2.tif was made by plugin Interpolation in QGIS out of a
>>>> vector layer of points with nitrate concentration values, just
>>>> a simple inverse distance method. I think that the author f that
>>>> pluginis Marco Hugentobler (Marco, sorry if it's not you) to whom I'm
>>>> forwarding.
>>>>
>>>> Relevant info from the metadata in QGIS for this raster:
>>>>
>>>> Layer Spatial Reference System:
>>>> +proj=utm +zone=31 +ellps=intl +units=m +no_defs
>>>>
>>>> Origin
>>>> 424389,4.68549e+06
>>>>
>>>> Pixel Size:
>>>> 279.887,-279.887
>>>>
>>>> NW corner in QGIS (interactive):424388.820,4685490.931
>>>> SW corner in QGIS (interactive):424389.122,4635951.740
>>>>
>>>> Image with grid:
>>>> http://sites.google.com/site/eospansite/dummy/test2gridqgis.jpg
>>>>
>>>> The weird thing is that QGIS uses gdal to read the geotif files.
>>>>
>>>>
>>>> Agus
>>>>
>>>>
>>>
>>> --
>>> Sarah Goslee
>>> http://www.functionaldiversity.org
>>>
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Drs. Paul Hiemstra
> Department of Physical Geography
> Faculty of Geosciences
> University of Utrecht
> Heidelberglaan 2
> P.O. Box 80.115
> 3508 TC Utrecht
> Phone: ?+3130 274 3113 Mon-Tue
> Phone: ?+3130 253 5773 Wed-Fri
> http://intamap.geo.uu.nl/~paul
>
>


From alobolistas at gmail.com  Wed Feb 10 18:45:11 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Feb 2010 18:45:11 +0100
Subject: [R-sig-Geo] Additional info on "Reversed raster after readGDAL()"
	(Fwd: Overlay spatial lines on raster)
Message-ID: <f96702321002100945p1b63612t43c9bc431ac6dbf9@mail.gmail.com>

FYI
This problem was actually identified because I was getting wrong
results at calculating
averaged raster values for intersecting line segments.
I include the last message sent by Robert. His trick is a good
workaround by now.
Agus


---------- Forwarded message ----------
From: "Robert J. Hijmans" <r.hijmans at gmail.com>
Date: Wed, 10 Feb 2010 09:01:30 -0800
Subject: Re: [R-sig-Geo] Overlay spatial lines on raster
To: Agustin Lobo <Agustin.Lobo at ija.csic.es>

Ah!

The fundamentals seems to be beyond my reach (in (r)gdal) but the
simple raster patch if you *know* this is happening is:

r = flip(r)

Robert


On Wed, Feb 10, 2010 at 4:19 AM, Agustin Lobo <Agustin.Lobo at ija.csic.es> wrote:
> Robert,
>
> Sorry I could not react earlier to this mystery, I've found a clue now:
> the raster is reversed in R in respect to QGIS (see attachment).
>
> I've uploaded test2.tif (identical to test.tif but with the
> appropriate projection info)
> to
> http://sites.google.com/site/eospansite/dummy/test2.tif
>
> The same problem arises with raster() and with readGDAL(), so we
> should CC to sig-geo at some point?
>
> This is what I do:
>
>> r2 <- raster("test2.tif")
>> plot(r2)
>> GDALinfo("test2.tif")
> rows ? ? ? ?256
> columns ? ? 256
> bands ? ? ? 1
> origin.x ? ? ? ?424389
> origin.y ? ? ? ?4636016
> res.x ? ? ? 345.0078
> res.y ? ? ? 194.0195
> oblique.x ? 0
> oblique.y ? 0
> driver ? ? ?GTiff
> projection ?+proj=utm +zone=31 +ellps=intl +units=m +no_defs
> file ? ? ? ?test2.tif
> apparent band summary:
> ? GDType ? ? ? ?Bmin ? ? ? Bmax
> 1 Float64 -4294967295 4294967295
> Metadata:
> AREA_OR_POINT=Area
>
>>
>> r3 <- readGDAL("test2.tif")
> test2.tif has GDAL driver GTiff
> and has 256 rows and 256 columns
>
>> image(r3)
>
> I'm not sure I'm not doing something really stupid here, I apologize
> in that case!
>
> Thanks
>
> Agus
>
> 2010/2/1, Robert J. Hijmans <r.hijmans at gmail.com>:
>> Agus, I am not sure what is going on here. But this example seems to
>> work for me:
>>
>> library(raster)
>> setwd('c:/downloads')
>> load("xter.rda")
>> r <- raster("test.tif")
>> projection(r) <- projection(xter)
>>
>> # to speed things up for testing
>> r = crop(r, extent(423517, ?454000, 4675610 , 4686260 ))
>>
>> lr = linesToRaster(xter, r, field = "ID_GRAFIC", ?progress='text')
>>
>> z = zonal(r, lr, mean)
>> z$mean = as.numeric(z$mean) ?# this will not be necessary in the next
>> version
>>
>> d <- xter at data
>> dd <- merge(d, z, by.x="ID_GRAFIC", by.y="zone", sort=F, all.x=T)
>> xter at data <- dd[order(dd[,1]),]
>>
>> # just for testing
>> test = linesToRaster(xter, r, field = "mean", progress='text')
>>
>> par(mfrow=c(1,3))
>> plot(lr)
>> plot(r)
>> lines(xter)
>> plot(test)
>>
>> # looks good, also in spplot
>> x11()
>> spplot(xter, 'mean')
>>
>> writeOGR(xter, dsn="xter",layer="xtertest",driver="ESRI Shapefile")
>>
>>
>>
>>
>>
>> On Mon, Feb 1, 2010 at 1:21 AM, Agustin Lobo <Agustin.Lobo at ija.csic.es>
>> wrote:
>>> Robert,
>>>
>>> Thanks. The mechanics work, but I get inconsistent results.
>>> This is what I do (there is also a minor problem with writeOGR() that
>>> I'm circumventing by now):
>>>
>>> lr = linesToRaster(xter, lr, field = "ID_GRAFIC" )
>>> xterpdata2 = zonal(r, lr, mean)
>>> xterpdata2 = xterpdata2[order(xterpdata2[,1]),]
>>> xterpdata3 <- na.omit(xterpdata2)
>>> dim(xterpdata3)
>>> dim(xterpdata2)
>>> xter2 <- xter
>>> xter2data <- xter2 at data
>>> xter2data <-
>>> merge(xter2data,xterpdata3,by.x="ID_GRAFIC",by.y="zone",sort=F,all.x=T)
>>> xter2data <- xter2data[order(xter2data[,1]),]
>>> xter2 at data <- xter2data
>>> writeOGR(xter2, dsn="xter2",layer="xter2",driver="ESRI Shapefile")
>>> #and get an error:
>>> #Error in writeOGR(xter2, dsn = "xter2", layer = "xter2", driver = "ESRI
>>> Shapefile") :
>>> # ?Can't convert columns of class: array; column names: mean
>>> #class(xter2 at data$mean)
>>> #[1] "array"
>>> #which I curcunvent by:
>>> xter2 at data$mean <- as.numeric(xter2 at data$mean)
>>> writeOGR(xter2, dsn="xter2",layer="xter2",driver="ESRI Shapefile")
>>> writeRaster(lr,filename="lr",format="GTiff")
>>>
>>>
>>> Now, we check for example the result of zonal()
>>>> xterpdata2[xterpdata2[,1]==8500,]
>>> ? ? zone ? ? mean
>>> 8500 8500 4.253456
>>>
>>> But in the QGIS we see that the values of test.tif (r in R)
>>> are very different (~19 in test (see to the left), while field "mean" is
>>> 4.253, see attached picture).
>>> Could be the problem is in zonal() ?
>>>
>>> Agus
>>>
>>>
>>> Robert J. Hijmans wrote:
>>>>
>>>> Hola Agus,
>>>>
>>>> Thanks for sending these data. That was very helpful. This is a whole
>>>> different (subsetting) problem for line segments consisting of two
>>>> points only (with simple solution, "drop=FALSE"). Nice to have found
>>>> it.
>>>> Your example now runs for me, although it takes three minutes on my PC
>>>> (I'll speed it up eventually, let's first make sure it works). You can
>>>> use the attached updated package (or wait till tomorrow for R-Forge).
>>>>
>>>> Robert
>>>>
>>>>
>>>> On Sun, Jan 31, 2010 at 3:18 PM, Agustin Lobo <Agustin.Lobo at ija.csic.es>
>>>> wrote:
>>>>>
>>>>> Thanks, actually the sourceforge version was ready when I tried again
>>>>> (few
>>>>> minutes ago)
>>>>> Still problems. I've uploaded the files for you to try if you wish:
>>>>> http://sites.google.com/site/eospansite/dummy/xter.rda
>>>>> http://sites.google.com/site/eospansite/dummy/test.tif
>>>>>
>>>>> It would be great if you could run:
>>>>> load("xter.rda")
>>>>> r <- raster("test.tif")
>>>>> projection(r) <- projection(xter)
>>>>> lr = linesToRaster(xter, r, field = "ID_GRAFIC" )
>>>>>
>>>>> I get:
>>>>> Error in subset.matrix(xyxy, !((xyxy[, 2] > maxy & xyxy[, 4] > maxy) |
>>>>> ?:
>>>>> ?subscript out of bounds
>>>>> Calls: linesToRaster -> .getCols -> subset -> subset.matrix
>>>>>
>>>>>
>>>>> Agus
>>>>>
>>>>> Robert J. Hijmans wrote:
>>>>>>
>>>>>> Hi Agus, Attached is the linux (is that your o.s.?) package for local
>>>>>> install. Robert
>>>>>>
>>>>>> On Sun, Jan 31, 2010 at 2:00 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>>> wrote:
>>>>>>>
>>>>>>> Looks great, is there any way I can try
>>>>>>> right now? Otherwise I'll wait
>>>>>>> until 0.9.9-5 is ready for installation. I tried
>>>>>>> now and only 0.9.9-4 is available.
>>>>>>>
>>>>>>> Thanks!
>>>>>>>
>>>>>>> Agus
>>>>>>>
>>>>>>> Robert J. Hijmans wrote:
>>>>>>>>
>>>>>>>> Hi Agus, thank you. You were right about the cause of the problem ---
>>>>>>>> I patched it in version 0.9.9-5, now on R-Forge (and should be
>>>>>>>> available for automatic install within 24 hours); the function could
>>>>>>>> use some optimization for speed but at least it works now for
>>>>>>>> SpatialLines* with a larger extent then the target RasterLayer.
>>>>>>>>
>>>>>>>> # simple example
>>>>>>>> library(raster)
>>>>>>>> library(maptools)
>>>>>>>> data(wrld_simpl)
>>>>>>>> r = raster(xmn=-10, xmx=20, ymn=37, ymx=43, ncol=360, nrow=72)
>>>>>>>> r = linesToRaster(wrld_simpl, r, progress='text')
>>>>>>>> plot(r)
>>>>>>>> plot(wrld_simpl, add=T)
>>>>>>>>
>>>>>>>>
>>>>>>>> # example using zonal as I proposed in your original question, but
>>>>>>>> here with polygonsToRaster
>>>>>>>> # What is (roughly) the mean latitude of each country?
>>>>>>>>
>>>>>>>> x = raster()
>>>>>>>> # res(x) = 0.1 ? ?# higher res, slower, but more small countries are
>>>>>>>> included
>>>>>>>> x = polygonsToRaster(wrld_simpl, x, progress='text')
>>>>>>>> y = raster(x)
>>>>>>>> y[] = rep(yFromRow(y, 1:nrow(y)), each=ncol(y))
>>>>>>>> z = zonal(y, x, mean)
>>>>>>>> res= data.frame(wrld_simpl[z[,'zone'], 'NAME'], lat=z[,2])
>>>>>>>> res[order(res[,2]), ]
>>>>>>>>
>>>>>>>> Robert
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On Sat, Jan 30, 2010 at 5:03 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>>>>> wrote:
>>>>>>>>>
>>>>>>>>> Thanks Robert,
>>>>>>>>>
>>>>>>>>> The raster package is a magician's chest!
>>>>>>>>> I get an error, though:
>>>>>>>>>
>>>>>>>>>> class(xter)
>>>>>>>>>
>>>>>>>>> [1] "SpatialLinesDataFrame"
>>>>>>>>> attr(,"package")
>>>>>>>>> [1] "sp"
>>>>>>>>>
>>>>>>>>>> class(r)
>>>>>>>>>
>>>>>>>>> [1] "RasterLayer"
>>>>>>>>> attr(,"package")
>>>>>>>>> [1] "raster"
>>>>>>>>>
>>>>>>>>>> lr = linesToRaster(xter, r, field = "ID_GRAFIC" )
>>>>>>>>>
>>>>>>>>> [1] "A"
>>>>>>>>> ? rows cols
>>>>>>>>> [1,] ? ?1 ? -1
>>>>>>>>> [2,] ? -1 ? -1
>>>>>>>>> ? ? ? [,1] ? ?[,2]
>>>>>>>>> [1,] 413809.3 4685685
>>>>>>>>> [1] ?413786.5 4685646.9 ?413810.1 4685686.4
>>>>>>>>> Error in col1:col2 : NA/NaN argument
>>>>>>>>> Calls: linesToRaster -> .getCols
>>>>>>>>>
>>>>>>>>> I think because the extent of the raster is smaller than the extent
>>>>>>>>> of
>>>>>>>>> the
>>>>>>>>> lines
>>>>>>>>>>
>>>>>>>>>> extent(xter)
>>>>>>>>>
>>>>>>>>> class ? ? ? : Extent
>>>>>>>>> xmin ? ? ? ?: 412792
>>>>>>>>> xmax ? ? ? ?: 517648.1
>>>>>>>>> ymin ? ? ? ?: 4624794
>>>>>>>>> ymax ? ? ? ?: 4698657
>>>>>>>>>
>>>>>>>>>> extent(r)
>>>>>>>>>
>>>>>>>>> class ? ? ? : Extent
>>>>>>>>> xmin ? ? ? ?: 424389
>>>>>>>>> xmax ? ? ? ?: 512711
>>>>>>>>> ymin ? ? ? ?: 4636016
>>>>>>>>> ymax ? ? ? ?: 4685685
>>>>>>>>>
>>>>>>>>> which I can visualize with:
>>>>>>>>>>
>>>>>>>>>> plot(extent(xter))
>>>>>>>>>> plot(extent(r),col="red",add=T)
>>>>>>>>>
>>>>>>>>> The problem is that I cannot find the way to clip xter to the extent
>>>>>>>>> of
>>>>>>>>> r.
>>>>>>>>> pruneMap() assumes a map object and
>>>>>>>>> I guess that we cannot convert from Spatial Lines to map.
>>>>>>>>>
>>>>>>>>> I've tried
>>>>>>>>>>
>>>>>>>>>> delme <- xter
>>>>>>>>>> delme at bbox <- bbox(r)
>>>>>>>>>
>>>>>>>>> but still get the same problem:
>>>>>>>>>>
>>>>>>>>>> lr = linesToRaster(delme, r, field = "ID_GRAFIC" )
>>>>>>>>>
>>>>>>>>> [1] "A"
>>>>>>>>> ? rows cols
>>>>>>>>> [1,] ? ?1 ? -1
>>>>>>>>> [2,] ? -1 ? -1
>>>>>>>>> ? [,1] [,2]
>>>>>>>>> [1,] ? NA ? NA
>>>>>>>>> [1] ?413786.5 4685646.9 ?413810.1 4685686.4
>>>>>>>>> Error in col1:col2 : NA/NaN argument
>>>>>>>>> Calls: linesToRaster -> .getCols
>>>>>>>>>
>>>>>>>>> Agus
>>>>>>>>>
>>>>>>>>> 2010/1/29 Robert J. Hijmans <r.hijmans at gmail.com>
>>>>>>>>>>
>>>>>>>>>> How about something like:
>>>>>>>>>>
>>>>>>>>>> library(raster)
>>>>>>>>>> r = linesToRaster(xter, xterpdata, field = "ID" )
>>>>>>>>>> v = zonal(xterpdata, r, mean)
>>>>>>>>>>
>>>>>>>>>> v now shold has the mean value of the raster for each line ID and
>>>>>>>>>> you
>>>>>>>>>> can merge those back
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On Fri, Jan 29, 2010 at 9:54 AM, Agustin Lobo
>>>>>>>>>> <alobolistas at gmail.com>
>>>>>>>>>> wrote:
>>>>>>>>>>>
>>>>>>>>>>> Partially answering myself:
>>>>>>>>>>> This is what I've done until now:
>>>>>>>>>>>
>>>>>>>>>>> xter <-
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> readOGR(dsn="/media/Transcend/PROVI/MARICEL2/x_terRiverBasin",layer="x_ter")
>>>>>>>>>>>>
>>>>>>>>>>>> class(xter)
>>>>>>>>>>>
>>>>>>>>>>> [1] "SpatialLinesDataFrame"
>>>>>>>>>>> attr(,"package")
>>>>>>>>>>> [1] "sp"
>>>>>>>>>>>
>>>>>>>>>>> xterp <- coordinates(xter)
>>>>>>>>>>> xterp <- sapply(xterp, function(x) do.call("rbind", x))
>>>>>>>>>>> xterp <- do.call("rbind",xterp)
>>>>>>>>>>>
>>>>>>>>>>> as told by Roger.
>>>>>>>>>>>
>>>>>>>>>>> Now:
>>>>>>>>>>> require(raster)
>>>>>>>>>>> r <- raster("test.tif")
>>>>>>>>>>> xterpdata <- xyValues(r,xterp)
>>>>>>>>>>> xterp2 <- data.frame(utmx=xterp[,1], utmy=xterp[,2],
>>>>>>>>>>> NO3_2007=xterpdata)
>>>>>>>>>>> coordinates(xterp2) <- c("utmx", "utmy")
>>>>>>>>>>>
>>>>>>>>>>> So I get to step 2, but don't see how to convert from the points
>>>>>>>>>>> to the lines again (to get xterl). The problem is that when I did:
>>>>>>>>>>> xterp <- sapply(xterp, function(x) do.call("rbind", x))
>>>>>>>>>>> xterp <- do.call("rbind",xterp)
>>>>>>>>>>>
>>>>>>>>>>> I lost the IDs of the lines. So I would need to keep the IDs of
>>>>>>>>>>> the
>>>>>>>>>>> lines
>>>>>>>>>>> for each point in the result of
>>>>>>>>>>> coordinates() to be able of going back to the lines once I've put
>>>>>>>>>>> the
>>>>>>>>>>> raster
>>>>>>>>>>> values in the data slot of the xterp
>>>>>>>>>>>
>>>>>>>>>>> I'll keep on, but any help would be much appreciated.
>>>>>>>>>>>
>>>>>>>>>>> Agus
>>>>>>>>>>>
>>>>>>>>>>> 2010/1/29 Agustin Lobo <alobolistas at gmail.com>
>>>>>>>>>>>
>>>>>>>>>>>> Hi!
>>>>>>>>>>>>
>>>>>>>>>>>> My goal is to colorcode a river network according to the values
>>>>>>>>>>>> of
>>>>>>>>>>>> a raster map (which comes from an interpolation). The spatial
>>>>>>>>>>>> lines
>>>>>>>>>>>> are
>>>>>>>>>>>> imported
>>>>>>>>>>>> from a shapefile. The raster could be imported or I could run the
>>>>>>>>>>>> interpolation in R.
>>>>>>>>>>>>
>>>>>>>>>>>> As what I'm planing could be rather involved, I prefer asking
>>>>>>>>>>>> before:
>>>>>>>>>>>>
>>>>>>>>>>>> 1. Convert spatial lines to spatial points as discussed earlier
>>>>>>>>>>>> this
>>>>>>>>>>>> week.
>>>>>>>>>>>> 2. Overlay points on the raster and get the values for the points
>>>>>>>>>>>> in
>>>>>>>>>>>> a
>>>>>>>>>>>> Spatial Points Data Frame
>>>>>>>>>>>> 3. Convert the Spatial Points Data Frame into Spatial Lines Data
>>>>>>>>>>>> Frame
>>>>>>>>>>>> 4. writeOGR() to shapefile.
>>>>>>>>>>>>
>>>>>>>>>>>> The main question is: is the data frame of the points going to be
>>>>>>>>>>>> transferred to the lines
>>>>>>>>>>>> at step 3?
>>>>>>>>>>>>
>>>>>>>>>>>> THnaks
>>>>>>>>>>>>
>>>>>>>>>>>> Agus
>>>>>>>>>>>>
>>>>>>>>>>> ? ? [[alternative HTML version deleted]]
>>>>>>>>>>>
>>>>>>>>>>> _______________________________________________
>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>>
>>>>> --
>>>>> Dr. Agustin Lobo
>>>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>>> LLuis Sole Sabaris s/n
>>>>> 08028 Barcelona
>>>>> Spain
>>>>> Tel. 34 934095410
>>>>> Fax. 34 934110012
>>>>> email: Agustin.Lobo at ija.csic.es
>>>>> http://www.ija.csic.es/gt/obster
>>>>>
>>>
>>> --
>>> Dr. Agustin Lobo
>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>> LLuis Sole Sabaris s/n
>>> 08028 Barcelona
>>> Spain
>>> Tel. 34 934095410
>>> Fax. 34 934110012
>>> email: Agustin.Lobo at ija.csic.es
>>> http://www.ija.csic.es/gt/obster
>>>
>>
>
>
> --
> Dr. Agustin Lobo
> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
> Lluis Sole Sabaris s/n
> 08028 Barcelona
> Spain
> Tel. 34 934095410
> Fax. 34 934110012
> e-mail Agustin.Lobo at ija.csic.es
> http://www.ija.csic.es/gt/obster
>



--
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
Lluis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
e-mail Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster


From Roger.Bivand at nhh.no  Wed Feb 10 18:48:35 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Feb 2010 18:48:35 +0100 (CET)
Subject: [R-sig-Geo] Reversed raster after readGDAL()
In-Reply-To: <f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
	<alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>
	<f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002101841540.3457@reclus.nhh.no>

On Wed, 10 Feb 2010, Agustin Lobo wrote:

> I think I tripped on this same stone, but cannot find anything in my
> records, perhaps it's on the lost computer.

Sorry, can't find such a posting - maybe my search keys were wrong - you 
could try the nabble archive.

>
> The file test2.tif was made by plugin Interpolation in QGIS out of a
> vector layer of points with nitrate concentration values, just
> a simple inverse distance method. I think that the author f that
> pluginis Marco Hugentobler (Marco, sorry if it's not you) to whom I'm
> forwarding.
>
> Relevant info from the metadata in QGIS for this raster:
>
> Layer Spatial Reference System:
> +proj=utm +zone=31 +ellps=intl +units=m +no_defs
>
> Origin
> 424389,4.68549e+06
>
> Pixel Size:
> 279.887,-279.887
>

No, it is 345.0078, 194.0195.

> NW corner in QGIS (interactive):424388.820,4685490.931
> SW corner in QGIS (interactive):424389.122,4635951.740
>

SW in R is 424389, 4635822
or SW cell centre 424561.5, 4635919.0 which is the SW corner plus 0.5* the 
resolution.

Try:

GDALinfo(system.file("pictures/cea.tif", package = "rgdal")[1])
system(paste("gdalinfo", system.file("pictures/cea.tif", package =
   "rgdal")[1]))

to see the oddness of gdalinfo on your raster. The SW (LL) corner is north 
of the NW (UL) one. The provided raster is OK, so I guess one might think 
that yours isn't?

> Image with grid: 
> http://sites.google.com/site/eospansite/dummy/test2gridqgis.jpg
>
> The weird thing is that QGIS uses gdal to read the geotif files.

How is the plugin writing the GTiff?

Roger



>
>
> Agus
>
> 2010/2/10 Roger Bivand <Roger.Bivand at nhh.no>
>>
>> On Wed, 10 Feb 2010, Agustin Lobo wrote:
>>
>>> Hi!
>>>
>>> After
>>>
>>>> r3 <- readGDAL("test2.tif")
>>>
>>> test2.tif has GDAL driver GTiff
>>> and has 256 rows and 256 columns
>>>
>>>> image(r3,col=rainbow(128))
>>>
>>> I get the image N-S reversed.
>>>
>>> I've put an screenshot and the actual geotif image here:
>>>
>>> http://sites.google.com/site/eospansite/dummy/test2_screenshot2.jpeg
>>> http://sites.google.com/site/eospansite/dummy/test2.tif
>>
>> Collected from:
>>
>> http://sites.google.com/site/eospansite/dummy
>>
>> Yes, it is flipped on the Y axis. What software made it? Could you please show the images with axes, as I think that the GTiff has a wrong sign on its y-step? What are the coordinates of the NW and SW corners of the image in QGIS? GDAL expects images to be read by row N to S, so a y-step with the wrong sign (+ instead of -) flips the image northward.
>>
>> Roger
>>
>> PS:
>>
>> gdalinfo externally has lower left north of upper left:
>>
>>> system("gdalinfo test2.tif")
>>
>> Driver: GTiff/GeoTIFF
>> Files: test2.tif
>> Size is 256, 256
>> Coordinate System is:
>> PROJCS["ED50 / UTM zone 31N",
>> ? ?GEOGCS["ED50",
>> ? ? ? ?DATUM["European_Datum_1950",
>> ? ? ? ? ? ?SPHEROID["International 1924",6378388,297.0000000000014,
>> ? ? ? ? ? ? ? ?AUTHORITY["EPSG","7022"]],
>> ? ? ? ? ? ?AUTHORITY["EPSG","6230"]],
>> ? ? ? ?PRIMEM["Greenwich",0],
>> ? ? ? ?UNIT["degree",0.0174532925199433],
>> ? ? ? ?AUTHORITY["EPSG","4230"]],
>> ? ?PROJECTION["Transverse_Mercator"],
>> ? ?PARAMETER["latitude_of_origin",0],
>> ? ?PARAMETER["central_meridian",3],
>> ? ?PARAMETER["scale_factor",0.9996],
>> ? ?PARAMETER["false_easting",500000],
>> ? ?PARAMETER["false_northing",0],
>> ? ?UNIT["metre",1,
>> ? ? ? ?AUTHORITY["EPSG","9001"]],
>> ? ?AUTHORITY["EPSG","23031"]]
>> Origin = (424389.000000000000000,4635822.000000000000000)
>> Pixel Size = (345.007812500000000,194.019531250000000)
>> Metadata:
>> ?AREA_OR_POINT=Area
>> Image Structure Metadata:
>> ?INTERLEAVE=BAND
>> Corner Coordinates:
>> Upper Left ?( ?424389.000, 4635822.000) ( ?2d 5'20.10"E, 41d52'11.88"N)
>> Lower Left ?( ?424389.000, 4685491.000) ( ?2d 4'56.97"E, 42d19'2.06"N)
>> Upper Right ( ?512711.000, 4635822.000) ( ?3d 9'11.42"E, 41d52'24.52"N)
>> Lower Right ( ?512711.000, 4685491.000) ( ?3d 9'15.31"E, 42d19'14.90"N)
>> Center ? ? ?( ?468550.000, 4660656.500) ( ?2d37'10.89"E, 42d 5'47.83"N)
>> Band 1 Block=256x4 Type=Float64, ColorInterp=Gray
>>
>> and:
>>
>>> GDALinfo("test2.tif")
>>
>> rows ? ? ? ?256
>> columns ? ? 256
>> bands ? ? ? 1
>> origin.x ? ? ? ?424389
>> origin.y ? ? ? ?4636016
>> res.x ? ? ? 345.0078
>> res.y ? ? ? 194.0195
>> oblique.x ? 0
>> oblique.y ? 0
>> driver ? ? ?GTiff
>> projection ?+proj=utm +zone=31 +ellps=intl +units=m +no_defs
>> file ? ? ? ?test2.tif
>> apparent band summary:
>> ? GDType ? ? ? ?Bmin ? ? ? Bmax
>> 1 Float64 -4294967295 4294967295
>> Metadata:
>> AREA_OR_POINT=Area
>>
>>
>>>
>>> Agus
>>>
>>> ? ? ? ?[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Wed Feb 10 18:50:05 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Feb 2010 18:50:05 +0100 (CET)
Subject: [R-sig-Geo] Additional info on "Reversed raster after
 readGDAL()" (Fwd: Overlay spatial lines on raster)
In-Reply-To: <f96702321002100945p1b63612t43c9bc431ac6dbf9@mail.gmail.com>
References: <f96702321002100945p1b63612t43c9bc431ac6dbf9@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002101849020.3457@reclus.nhh.no>

On Wed, 10 Feb 2010, Agustin Lobo wrote:

> FYI
> This problem was actually identified because I was getting wrong
> results at calculating
> averaged raster values for intersecting line segments.
> I include the last message sent by Robert. His trick is a good
> workaround by now.

And there is a similar mechanism in sp. However, please find out and 
report to the plugin author why the plugin is flipping GTiffs.

Roger

> Agus
>
>
> ---------- Forwarded message ----------
> From: "Robert J. Hijmans" <r.hijmans at gmail.com>
> Date: Wed, 10 Feb 2010 09:01:30 -0800
> Subject: Re: [R-sig-Geo] Overlay spatial lines on raster
> To: Agustin Lobo <Agustin.Lobo at ija.csic.es>
>
> Ah!
>
> The fundamentals seems to be beyond my reach (in (r)gdal) but the
> simple raster patch if you *know* this is happening is:
>
> r = flip(r)
>
> Robert
>
>
> On Wed, Feb 10, 2010 at 4:19 AM, Agustin Lobo <Agustin.Lobo at ija.csic.es> wrote:
>> Robert,
>>
>> Sorry I could not react earlier to this mystery, I've found a clue now:
>> the raster is reversed in R in respect to QGIS (see attachment).
>>
>> I've uploaded test2.tif (identical to test.tif but with the
>> appropriate projection info)
>> to
>> http://sites.google.com/site/eospansite/dummy/test2.tif
>>
>> The same problem arises with raster() and with readGDAL(), so we
>> should CC to sig-geo at some point?
>>
>> This is what I do:
>>
>>> r2 <- raster("test2.tif")
>>> plot(r2)
>>> GDALinfo("test2.tif")
>> rows ? ? ? ?256
>> columns ? ? 256
>> bands ? ? ? 1
>> origin.x ? ? ? ?424389
>> origin.y ? ? ? ?4636016
>> res.x ? ? ? 345.0078
>> res.y ? ? ? 194.0195
>> oblique.x ? 0
>> oblique.y ? 0
>> driver ? ? ?GTiff
>> projection ?+proj=utm +zone=31 +ellps=intl +units=m +no_defs
>> file ? ? ? ?test2.tif
>> apparent band summary:
>> ? GDType ? ? ? ?Bmin ? ? ? Bmax
>> 1 Float64 -4294967295 4294967295
>> Metadata:
>> AREA_OR_POINT=Area
>>
>>>
>>> r3 <- readGDAL("test2.tif")
>> test2.tif has GDAL driver GTiff
>> and has 256 rows and 256 columns
>>
>>> image(r3)
>>
>> I'm not sure I'm not doing something really stupid here, I apologize
>> in that case!
>>
>> Thanks
>>
>> Agus
>>
>> 2010/2/1, Robert J. Hijmans <r.hijmans at gmail.com>:
>>> Agus, I am not sure what is going on here. But this example seems to
>>> work for me:
>>>
>>> library(raster)
>>> setwd('c:/downloads')
>>> load("xter.rda")
>>> r <- raster("test.tif")
>>> projection(r) <- projection(xter)
>>>
>>> # to speed things up for testing
>>> r = crop(r, extent(423517, ?454000, 4675610 , 4686260 ))
>>>
>>> lr = linesToRaster(xter, r, field = "ID_GRAFIC", ?progress='text')
>>>
>>> z = zonal(r, lr, mean)
>>> z$mean = as.numeric(z$mean) ?# this will not be necessary in the next
>>> version
>>>
>>> d <- xter at data
>>> dd <- merge(d, z, by.x="ID_GRAFIC", by.y="zone", sort=F, all.x=T)
>>> xter at data <- dd[order(dd[,1]),]
>>>
>>> # just for testing
>>> test = linesToRaster(xter, r, field = "mean", progress='text')
>>>
>>> par(mfrow=c(1,3))
>>> plot(lr)
>>> plot(r)
>>> lines(xter)
>>> plot(test)
>>>
>>> # looks good, also in spplot
>>> x11()
>>> spplot(xter, 'mean')
>>>
>>> writeOGR(xter, dsn="xter",layer="xtertest",driver="ESRI Shapefile")
>>>
>>>
>>>
>>>
>>>
>>> On Mon, Feb 1, 2010 at 1:21 AM, Agustin Lobo <Agustin.Lobo at ija.csic.es>
>>> wrote:
>>>> Robert,
>>>>
>>>> Thanks. The mechanics work, but I get inconsistent results.
>>>> This is what I do (there is also a minor problem with writeOGR() that
>>>> I'm circumventing by now):
>>>>
>>>> lr = linesToRaster(xter, lr, field = "ID_GRAFIC" )
>>>> xterpdata2 = zonal(r, lr, mean)
>>>> xterpdata2 = xterpdata2[order(xterpdata2[,1]),]
>>>> xterpdata3 <- na.omit(xterpdata2)
>>>> dim(xterpdata3)
>>>> dim(xterpdata2)
>>>> xter2 <- xter
>>>> xter2data <- xter2 at data
>>>> xter2data <-
>>>> merge(xter2data,xterpdata3,by.x="ID_GRAFIC",by.y="zone",sort=F,all.x=T)
>>>> xter2data <- xter2data[order(xter2data[,1]),]
>>>> xter2 at data <- xter2data
>>>> writeOGR(xter2, dsn="xter2",layer="xter2",driver="ESRI Shapefile")
>>>> #and get an error:
>>>> #Error in writeOGR(xter2, dsn = "xter2", layer = "xter2", driver = "ESRI
>>>> Shapefile") :
>>>> # ?Can't convert columns of class: array; column names: mean
>>>> #class(xter2 at data$mean)
>>>> #[1] "array"
>>>> #which I curcunvent by:
>>>> xter2 at data$mean <- as.numeric(xter2 at data$mean)
>>>> writeOGR(xter2, dsn="xter2",layer="xter2",driver="ESRI Shapefile")
>>>> writeRaster(lr,filename="lr",format="GTiff")
>>>>
>>>>
>>>> Now, we check for example the result of zonal()
>>>>> xterpdata2[xterpdata2[,1]==8500,]
>>>> ? ? zone ? ? mean
>>>> 8500 8500 4.253456
>>>>
>>>> But in the QGIS we see that the values of test.tif (r in R)
>>>> are very different (~19 in test (see to the left), while field "mean" is
>>>> 4.253, see attached picture).
>>>> Could be the problem is in zonal() ?
>>>>
>>>> Agus
>>>>
>>>>
>>>> Robert J. Hijmans wrote:
>>>>>
>>>>> Hola Agus,
>>>>>
>>>>> Thanks for sending these data. That was very helpful. This is a whole
>>>>> different (subsetting) problem for line segments consisting of two
>>>>> points only (with simple solution, "drop=FALSE"). Nice to have found
>>>>> it.
>>>>> Your example now runs for me, although it takes three minutes on my PC
>>>>> (I'll speed it up eventually, let's first make sure it works). You can
>>>>> use the attached updated package (or wait till tomorrow for R-Forge).
>>>>>
>>>>> Robert
>>>>>
>>>>>
>>>>> On Sun, Jan 31, 2010 at 3:18 PM, Agustin Lobo <Agustin.Lobo at ija.csic.es>
>>>>> wrote:
>>>>>>
>>>>>> Thanks, actually the sourceforge version was ready when I tried again
>>>>>> (few
>>>>>> minutes ago)
>>>>>> Still problems. I've uploaded the files for you to try if you wish:
>>>>>> http://sites.google.com/site/eospansite/dummy/xter.rda
>>>>>> http://sites.google.com/site/eospansite/dummy/test.tif
>>>>>>
>>>>>> It would be great if you could run:
>>>>>> load("xter.rda")
>>>>>> r <- raster("test.tif")
>>>>>> projection(r) <- projection(xter)
>>>>>> lr = linesToRaster(xter, r, field = "ID_GRAFIC" )
>>>>>>
>>>>>> I get:
>>>>>> Error in subset.matrix(xyxy, !((xyxy[, 2] > maxy & xyxy[, 4] > maxy) |
>>>>>> ?:
>>>>>> ?subscript out of bounds
>>>>>> Calls: linesToRaster -> .getCols -> subset -> subset.matrix
>>>>>>
>>>>>>
>>>>>> Agus
>>>>>>
>>>>>> Robert J. Hijmans wrote:
>>>>>>>
>>>>>>> Hi Agus, Attached is the linux (is that your o.s.?) package for local
>>>>>>> install. Robert
>>>>>>>
>>>>>>> On Sun, Jan 31, 2010 at 2:00 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>>>> wrote:
>>>>>>>>
>>>>>>>> Looks great, is there any way I can try
>>>>>>>> right now? Otherwise I'll wait
>>>>>>>> until 0.9.9-5 is ready for installation. I tried
>>>>>>>> now and only 0.9.9-4 is available.
>>>>>>>>
>>>>>>>> Thanks!
>>>>>>>>
>>>>>>>> Agus
>>>>>>>>
>>>>>>>> Robert J. Hijmans wrote:
>>>>>>>>>
>>>>>>>>> Hi Agus, thank you. You were right about the cause of the problem ---
>>>>>>>>> I patched it in version 0.9.9-5, now on R-Forge (and should be
>>>>>>>>> available for automatic install within 24 hours); the function could
>>>>>>>>> use some optimization for speed but at least it works now for
>>>>>>>>> SpatialLines* with a larger extent then the target RasterLayer.
>>>>>>>>>
>>>>>>>>> # simple example
>>>>>>>>> library(raster)
>>>>>>>>> library(maptools)
>>>>>>>>> data(wrld_simpl)
>>>>>>>>> r = raster(xmn=-10, xmx=20, ymn=37, ymx=43, ncol=360, nrow=72)
>>>>>>>>> r = linesToRaster(wrld_simpl, r, progress='text')
>>>>>>>>> plot(r)
>>>>>>>>> plot(wrld_simpl, add=T)
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> # example using zonal as I proposed in your original question, but
>>>>>>>>> here with polygonsToRaster
>>>>>>>>> # What is (roughly) the mean latitude of each country?
>>>>>>>>>
>>>>>>>>> x = raster()
>>>>>>>>> # res(x) = 0.1 ? ?# higher res, slower, but more small countries are
>>>>>>>>> included
>>>>>>>>> x = polygonsToRaster(wrld_simpl, x, progress='text')
>>>>>>>>> y = raster(x)
>>>>>>>>> y[] = rep(yFromRow(y, 1:nrow(y)), each=ncol(y))
>>>>>>>>> z = zonal(y, x, mean)
>>>>>>>>> res= data.frame(wrld_simpl[z[,'zone'], 'NAME'], lat=z[,2])
>>>>>>>>> res[order(res[,2]), ]
>>>>>>>>>
>>>>>>>>> Robert
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> On Sat, Jan 30, 2010 at 5:03 AM, Agustin Lobo <alobolistas at gmail.com>
>>>>>>>>> wrote:
>>>>>>>>>>
>>>>>>>>>> Thanks Robert,
>>>>>>>>>>
>>>>>>>>>> The raster package is a magician's chest!
>>>>>>>>>> I get an error, though:
>>>>>>>>>>
>>>>>>>>>>> class(xter)
>>>>>>>>>>
>>>>>>>>>> [1] "SpatialLinesDataFrame"
>>>>>>>>>> attr(,"package")
>>>>>>>>>> [1] "sp"
>>>>>>>>>>
>>>>>>>>>>> class(r)
>>>>>>>>>>
>>>>>>>>>> [1] "RasterLayer"
>>>>>>>>>> attr(,"package")
>>>>>>>>>> [1] "raster"
>>>>>>>>>>
>>>>>>>>>>> lr = linesToRaster(xter, r, field = "ID_GRAFIC" )
>>>>>>>>>>
>>>>>>>>>> [1] "A"
>>>>>>>>>> ? rows cols
>>>>>>>>>> [1,] ? ?1 ? -1
>>>>>>>>>> [2,] ? -1 ? -1
>>>>>>>>>> ? ? ? [,1] ? ?[,2]
>>>>>>>>>> [1,] 413809.3 4685685
>>>>>>>>>> [1] ?413786.5 4685646.9 ?413810.1 4685686.4
>>>>>>>>>> Error in col1:col2 : NA/NaN argument
>>>>>>>>>> Calls: linesToRaster -> .getCols
>>>>>>>>>>
>>>>>>>>>> I think because the extent of the raster is smaller than the extent
>>>>>>>>>> of
>>>>>>>>>> the
>>>>>>>>>> lines
>>>>>>>>>>>
>>>>>>>>>>> extent(xter)
>>>>>>>>>>
>>>>>>>>>> class ? ? ? : Extent
>>>>>>>>>> xmin ? ? ? ?: 412792
>>>>>>>>>> xmax ? ? ? ?: 517648.1
>>>>>>>>>> ymin ? ? ? ?: 4624794
>>>>>>>>>> ymax ? ? ? ?: 4698657
>>>>>>>>>>
>>>>>>>>>>> extent(r)
>>>>>>>>>>
>>>>>>>>>> class ? ? ? : Extent
>>>>>>>>>> xmin ? ? ? ?: 424389
>>>>>>>>>> xmax ? ? ? ?: 512711
>>>>>>>>>> ymin ? ? ? ?: 4636016
>>>>>>>>>> ymax ? ? ? ?: 4685685
>>>>>>>>>>
>>>>>>>>>> which I can visualize with:
>>>>>>>>>>>
>>>>>>>>>>> plot(extent(xter))
>>>>>>>>>>> plot(extent(r),col="red",add=T)
>>>>>>>>>>
>>>>>>>>>> The problem is that I cannot find the way to clip xter to the extent
>>>>>>>>>> of
>>>>>>>>>> r.
>>>>>>>>>> pruneMap() assumes a map object and
>>>>>>>>>> I guess that we cannot convert from Spatial Lines to map.
>>>>>>>>>>
>>>>>>>>>> I've tried
>>>>>>>>>>>
>>>>>>>>>>> delme <- xter
>>>>>>>>>>> delme at bbox <- bbox(r)
>>>>>>>>>>
>>>>>>>>>> but still get the same problem:
>>>>>>>>>>>
>>>>>>>>>>> lr = linesToRaster(delme, r, field = "ID_GRAFIC" )
>>>>>>>>>>
>>>>>>>>>> [1] "A"
>>>>>>>>>> ? rows cols
>>>>>>>>>> [1,] ? ?1 ? -1
>>>>>>>>>> [2,] ? -1 ? -1
>>>>>>>>>> ? [,1] [,2]
>>>>>>>>>> [1,] ? NA ? NA
>>>>>>>>>> [1] ?413786.5 4685646.9 ?413810.1 4685686.4
>>>>>>>>>> Error in col1:col2 : NA/NaN argument
>>>>>>>>>> Calls: linesToRaster -> .getCols
>>>>>>>>>>
>>>>>>>>>> Agus
>>>>>>>>>>
>>>>>>>>>> 2010/1/29 Robert J. Hijmans <r.hijmans at gmail.com>
>>>>>>>>>>>
>>>>>>>>>>> How about something like:
>>>>>>>>>>>
>>>>>>>>>>> library(raster)
>>>>>>>>>>> r = linesToRaster(xter, xterpdata, field = "ID" )
>>>>>>>>>>> v = zonal(xterpdata, r, mean)
>>>>>>>>>>>
>>>>>>>>>>> v now shold has the mean value of the raster for each line ID and
>>>>>>>>>>> you
>>>>>>>>>>> can merge those back
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>> On Fri, Jan 29, 2010 at 9:54 AM, Agustin Lobo
>>>>>>>>>>> <alobolistas at gmail.com>
>>>>>>>>>>> wrote:
>>>>>>>>>>>>
>>>>>>>>>>>> Partially answering myself:
>>>>>>>>>>>> This is what I've done until now:
>>>>>>>>>>>>
>>>>>>>>>>>> xter <-
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> readOGR(dsn="/media/Transcend/PROVI/MARICEL2/x_terRiverBasin",layer="x_ter")
>>>>>>>>>>>>>
>>>>>>>>>>>>> class(xter)
>>>>>>>>>>>>
>>>>>>>>>>>> [1] "SpatialLinesDataFrame"
>>>>>>>>>>>> attr(,"package")
>>>>>>>>>>>> [1] "sp"
>>>>>>>>>>>>
>>>>>>>>>>>> xterp <- coordinates(xter)
>>>>>>>>>>>> xterp <- sapply(xterp, function(x) do.call("rbind", x))
>>>>>>>>>>>> xterp <- do.call("rbind",xterp)
>>>>>>>>>>>>
>>>>>>>>>>>> as told by Roger.
>>>>>>>>>>>>
>>>>>>>>>>>> Now:
>>>>>>>>>>>> require(raster)
>>>>>>>>>>>> r <- raster("test.tif")
>>>>>>>>>>>> xterpdata <- xyValues(r,xterp)
>>>>>>>>>>>> xterp2 <- data.frame(utmx=xterp[,1], utmy=xterp[,2],
>>>>>>>>>>>> NO3_2007=xterpdata)
>>>>>>>>>>>> coordinates(xterp2) <- c("utmx", "utmy")
>>>>>>>>>>>>
>>>>>>>>>>>> So I get to step 2, but don't see how to convert from the points
>>>>>>>>>>>> to the lines again (to get xterl). The problem is that when I did:
>>>>>>>>>>>> xterp <- sapply(xterp, function(x) do.call("rbind", x))
>>>>>>>>>>>> xterp <- do.call("rbind",xterp)
>>>>>>>>>>>>
>>>>>>>>>>>> I lost the IDs of the lines. So I would need to keep the IDs of
>>>>>>>>>>>> the
>>>>>>>>>>>> lines
>>>>>>>>>>>> for each point in the result of
>>>>>>>>>>>> coordinates() to be able of going back to the lines once I've put
>>>>>>>>>>>> the
>>>>>>>>>>>> raster
>>>>>>>>>>>> values in the data slot of the xterp
>>>>>>>>>>>>
>>>>>>>>>>>> I'll keep on, but any help would be much appreciated.
>>>>>>>>>>>>
>>>>>>>>>>>> Agus
>>>>>>>>>>>>
>>>>>>>>>>>> 2010/1/29 Agustin Lobo <alobolistas at gmail.com>
>>>>>>>>>>>>
>>>>>>>>>>>>> Hi!
>>>>>>>>>>>>>
>>>>>>>>>>>>> My goal is to colorcode a river network according to the values
>>>>>>>>>>>>> of
>>>>>>>>>>>>> a raster map (which comes from an interpolation). The spatial
>>>>>>>>>>>>> lines
>>>>>>>>>>>>> are
>>>>>>>>>>>>> imported
>>>>>>>>>>>>> from a shapefile. The raster could be imported or I could run the
>>>>>>>>>>>>> interpolation in R.
>>>>>>>>>>>>>
>>>>>>>>>>>>> As what I'm planing could be rather involved, I prefer asking
>>>>>>>>>>>>> before:
>>>>>>>>>>>>>
>>>>>>>>>>>>> 1. Convert spatial lines to spatial points as discussed earlier
>>>>>>>>>>>>> this
>>>>>>>>>>>>> week.
>>>>>>>>>>>>> 2. Overlay points on the raster and get the values for the points
>>>>>>>>>>>>> in
>>>>>>>>>>>>> a
>>>>>>>>>>>>> Spatial Points Data Frame
>>>>>>>>>>>>> 3. Convert the Spatial Points Data Frame into Spatial Lines Data
>>>>>>>>>>>>> Frame
>>>>>>>>>>>>> 4. writeOGR() to shapefile.
>>>>>>>>>>>>>
>>>>>>>>>>>>> The main question is: is the data frame of the points going to be
>>>>>>>>>>>>> transferred to the lines
>>>>>>>>>>>>> at step 3?
>>>>>>>>>>>>>
>>>>>>>>>>>>> THnaks
>>>>>>>>>>>>>
>>>>>>>>>>>>> Agus
>>>>>>>>>>>>>
>>>>>>>>>>>> ? ? [[alternative HTML version deleted]]
>>>>>>>>>>>>
>>>>>>>>>>>> _______________________________________________
>>>>>>>>>>>> R-sig-Geo mailing list
>>>>>>>>>>>> R-sig-Geo at stat.math.ethz.ch
>>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>>>>>
>>>>>> --
>>>>>> Dr. Agustin Lobo
>>>>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>>>> LLuis Sole Sabaris s/n
>>>>>> 08028 Barcelona
>>>>>> Spain
>>>>>> Tel. 34 934095410
>>>>>> Fax. 34 934110012
>>>>>> email: Agustin.Lobo at ija.csic.es
>>>>>> http://www.ija.csic.es/gt/obster
>>>>>>
>>>>
>>>> --
>>>> Dr. Agustin Lobo
>>>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>> LLuis Sole Sabaris s/n
>>>> 08028 Barcelona
>>>> Spain
>>>> Tel. 34 934095410
>>>> Fax. 34 934110012
>>>> email: Agustin.Lobo at ija.csic.es
>>>> http://www.ija.csic.es/gt/obster
>>>>
>>>
>>
>>
>> --
>> Dr. Agustin Lobo
>> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>> Lluis Sole Sabaris s/n
>> 08028 Barcelona
>> Spain
>> Tel. 34 934095410
>> Fax. 34 934110012
>> e-mail Agustin.Lobo at ija.csic.es
>> http://www.ija.csic.es/gt/obster
>>
>
>
>
> --
> Dr. Agustin Lobo
> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
> Lluis Sole Sabaris s/n
> 08028 Barcelona
> Spain
> Tel. 34 934095410
> Fax. 34 934110012
> e-mail Agustin.Lobo at ija.csic.es
> http://www.ija.csic.es/gt/obster
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From alobolistas at gmail.com  Wed Feb 10 18:59:32 2010
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 10 Feb 2010 18:59:32 +0100
Subject: [R-sig-Geo] Reversed raster after readGDAL()
In-Reply-To: <alpine.LRH.2.00.1002101841540.3457@reclus.nhh.no>
References: <f96702321002100628t46ed6fc7nb346046c5d649687@mail.gmail.com>
	<alpine.LRH.2.00.1002101616030.3457@reclus.nhh.no>
	<f96702321002100817y1d167f6aq9bb0d739be03217f@mail.gmail.com>
	<alpine.LRH.2.00.1002101841540.3457@reclus.nhh.no>
Message-ID: <f96702321002100959r755c42bfj3aeebf52b4e5cbd1@mail.gmail.com>

I forward to qgis devel and Marco Hugentobler.
I really cannot understand, Qgis uses gdal for writing and reading geotif files
as far as I know.
I think the point is that QGIS reports the origin in the NW corner and then uses
negative resolution for Y. But do not understand the discrepancy in
the absolute values
of the pixel size that you report.

I'm going to check if this is just for this plugin or for any raster
written by QGIS
as geotiff.

Agus

2010/2/10 Roger Bivand <Roger.Bivand at nhh.no>:
> On Wed, 10 Feb 2010, Agustin Lobo wrote:
>
>> I think I tripped on this same stone, but cannot find anything in my
>> records, perhaps it's on the lost computer.
>
> Sorry, can't find such a posting - maybe my search keys were wrong - you
> could try the nabble archive.
>
>>
>> The file test2.tif was made by plugin Interpolation in QGIS out of a
>> vector layer of points with nitrate concentration values, just
>> a simple inverse distance method. I think that the author f that
>> pluginis Marco Hugentobler (Marco, sorry if it's not you) to whom I'm
>> forwarding.
>>
>> Relevant info from the metadata in QGIS for this raster:
>>
>> Layer Spatial Reference System:
>> +proj=utm +zone=31 +ellps=intl +units=m +no_defs
>>
>> Origin
>> 424389,4.68549e+06
>>
>> Pixel Size:
>> 279.887,-279.887
>>
>
> No, it is 345.0078, 194.0195.
>
>> NW corner in QGIS (interactive):424388.820,4685490.931
>> SW corner in QGIS (interactive):424389.122,4635951.740
>>
>
> SW in R is 424389, 4635822
> or SW cell centre 424561.5, 4635919.0 which is the SW corner plus 0.5* the
> resolution.
>
> Try:
>
> GDALinfo(system.file("pictures/cea.tif", package = "rgdal")[1])
> system(paste("gdalinfo", system.file("pictures/cea.tif", package =
> ?"rgdal")[1]))
>
> to see the oddness of gdalinfo on your raster. The SW (LL) corner is north
> of the NW (UL) one. The provided raster is OK, so I guess one might think
> that yours isn't?
>
>> Image with grid:
>> http://sites.google.com/site/eospansite/dummy/test2gridqgis.jpg
>>
>> The weird thing is that QGIS uses gdal to read the geotif files.
>
> How is the plugin writing the GTiff?
>
> Roger
>
>
>
>>
>>
>> Agus
>>
>> 2010/2/10 Roger Bivand <Roger.Bivand at nhh.no>
>>>
>>> On Wed, 10 Feb 2010, Agustin Lobo wrote:
>>>
>>>> Hi!
>>>>
>>>> After
>>>>
>>>>> r3 <- readGDAL("test2.tif")
>>>>
>>>> test2.tif has GDAL driver GTiff
>>>> and has 256 rows and 256 columns
>>>>
>>>>> image(r3,col=rainbow(128))
>>>>
>>>> I get the image N-S reversed.
>>>>
>>>> I've put an screenshot and the actual geotif image here:
>>>>
>>>> http://sites.google.com/site/eospansite/dummy/test2_screenshot2.jpeg
>>>> http://sites.google.com/site/eospansite/dummy/test2.tif
>>>
>>> Collected from:
>>>
>>> http://sites.google.com/site/eospansite/dummy
>>>
>>> Yes, it is flipped on the Y axis. What software made it? Could you please
>>> show the images with axes, as I think that the GTiff has a wrong sign on its
>>> y-step? What are the coordinates of the NW and SW corners of the image in
>>> QGIS? GDAL expects images to be read by row N to S, so a y-step with the
>>> wrong sign (+ instead of -) flips the image northward.
>>>
>>> Roger
>>>
>>> PS:
>>>
>>> gdalinfo externally has lower left north of upper left:
>>>
>>>> system("gdalinfo test2.tif")
>>>
>>> Driver: GTiff/GeoTIFF
>>> Files: test2.tif
>>> Size is 256, 256
>>> Coordinate System is:
>>> PROJCS["ED50 / UTM zone 31N",
>>> ? ?GEOGCS["ED50",
>>> ? ? ? ?DATUM["European_Datum_1950",
>>> ? ? ? ? ? ?SPHEROID["International 1924",6378388,297.0000000000014,
>>> ? ? ? ? ? ? ? ?AUTHORITY["EPSG","7022"]],
>>> ? ? ? ? ? ?AUTHORITY["EPSG","6230"]],
>>> ? ? ? ?PRIMEM["Greenwich",0],
>>> ? ? ? ?UNIT["degree",0.0174532925199433],
>>> ? ? ? ?AUTHORITY["EPSG","4230"]],
>>> ? ?PROJECTION["Transverse_Mercator"],
>>> ? ?PARAMETER["latitude_of_origin",0],
>>> ? ?PARAMETER["central_meridian",3],
>>> ? ?PARAMETER["scale_factor",0.9996],
>>> ? ?PARAMETER["false_easting",500000],
>>> ? ?PARAMETER["false_northing",0],
>>> ? ?UNIT["metre",1,
>>> ? ? ? ?AUTHORITY["EPSG","9001"]],
>>> ? ?AUTHORITY["EPSG","23031"]]
>>> Origin = (424389.000000000000000,4635822.000000000000000)
>>> Pixel Size = (345.007812500000000,194.019531250000000)
>>> Metadata:
>>> ?AREA_OR_POINT=Area
>>> Image Structure Metadata:
>>> ?INTERLEAVE=BAND
>>> Corner Coordinates:
>>> Upper Left ?( ?424389.000, 4635822.000) ( ?2d 5'20.10"E, 41d52'11.88"N)
>>> Lower Left ?( ?424389.000, 4685491.000) ( ?2d 4'56.97"E, 42d19'2.06"N)
>>> Upper Right ( ?512711.000, 4635822.000) ( ?3d 9'11.42"E, 41d52'24.52"N)
>>> Lower Right ( ?512711.000, 4685491.000) ( ?3d 9'15.31"E, 42d19'14.90"N)
>>> Center ? ? ?( ?468550.000, 4660656.500) ( ?2d37'10.89"E, 42d 5'47.83"N)
>>> Band 1 Block=256x4 Type=Float64, ColorInterp=Gray
>>>
>>> and:
>>>
>>>> GDALinfo("test2.tif")
>>>
>>> rows ? ? ? ?256
>>> columns ? ? 256
>>> bands ? ? ? 1
>>> origin.x ? ? ? ?424389
>>> origin.y ? ? ? ?4636016
>>> res.x ? ? ? 345.0078
>>> res.y ? ? ? 194.0195
>>> oblique.x ? 0
>>> oblique.y ? 0
>>> driver ? ? ?GTiff
>>> projection ?+proj=utm +zone=31 +ellps=intl +units=m +no_defs
>>> file ? ? ? ?test2.tif
>>> apparent band summary:
>>> ? GDType ? ? ? ?Bmin ? ? ? Bmax
>>> 1 Float64 -4294967295 4294967295
>>> Metadata:
>>> AREA_OR_POINT=Area
>>>
>>>
>>>>
>>>> Agus
>>>>
>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>


From gianni.lavaredo at gmail.com  Wed Feb 10 20:10:16 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Wed, 10 Feb 2010 20:10:16 +0100
Subject: [R-sig-Geo] Problem to Read maptools Help
Message-ID: <518dff331002101110n442d47d2g5d84d4a7378502ba@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100210/118fa716/attachment.pl>

From gianni.lavaredo at gmail.com  Wed Feb 10 20:16:47 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Wed, 10 Feb 2010 20:16:47 +0100
Subject: [R-sig-Geo] problem with Maptools pack
Message-ID: <518dff331002101116g15011a70n26486f3adb6e3b7b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100210/aa2fc8c1/attachment.pl>

From Roger.Bivand at nhh.no  Wed Feb 10 20:23:58 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Feb 2010 20:23:58 +0100 (CET)
Subject: [R-sig-Geo] Problem to Read maptools Help
In-Reply-To: <518dff331002101110n442d47d2g5d84d4a7378502ba@mail.gmail.com>
References: <518dff331002101110n442d47d2g5d84d4a7378502ba@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002102017310.3457@reclus.nhh.no>

On Wed, 10 Feb 2010, gianni lavaredo wrote:

> Dear researchers
> I download the new version of R 2.10.1 and I have a problem to read maptools
> Help as the older version
>
> thanks for attention
> Gianni
>
>> library(maptools)
> Carico il pacchetto richiesto: foreign
> Carico il pacchetto richiesto: sp
> Carico il pacchetto richiesto: lattice
>> ?maptools
> No documentation for 'maptools' in specified packages and libraries:
> you could try '??maptools'
>>

The function is removed from the namespace and its help page is removed 
to:

file.show(system.file("old_man/maptools.Rd", package="maptools"))

To use the function, do:

maptools:::maptools()

if you must, but you can more easily use:

packageDescription("maptools")

to find out what the package version is. It has been made redundant by 
packages now using Changelogs, so:

file.show(system.file("ChangeLog", package="maptools"))

automatically shows which changes have been made and when.

Hope this helps,

Roger

>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Wed Feb 10 20:37:35 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 10 Feb 2010 20:37:35 +0100 (CET)
Subject: [R-sig-Geo] problem with Maptools pack
In-Reply-To: <518dff331002101116g15011a70n26486f3adb6e3b7b@mail.gmail.com>
References: <518dff331002101116g15011a70n26486f3adb6e3b7b@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002102024370.3457@reclus.nhh.no>

On Wed, 10 Feb 2010, gianni lavaredo wrote:

> Dear Reseachers
>
> I have a problem to read the Help file of maptools and now I see I have a
> problem to read.shape fucntion. I download the new version of R (2.10.1)
>
> library(maptools)
> x <- read.shape("sample.shp", package="maptools")
> Error: I don't find the function "read.shape"

Please refer to:

https://stat.ethz.ch/pipermail/r-sig-geo/2009-December/007256.html

for details of the retirement of long deprecated functions. If you must 
use read.shape(), use maptools:::read.shape() to access it within the 
package namespace.

Roger

>
> it's the first time I have this problem, sorry for desturb
>
> Gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gianni.lavaredo at gmail.com  Wed Feb 10 22:54:46 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Wed, 10 Feb 2010 22:54:46 +0100
Subject: [R-sig-Geo] get X and Y form point shapefile
Message-ID: <518dff331002101354y66481d28ja49c651c08efcefb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100210/86cef62d/attachment.pl>

From mdsumner at gmail.com  Wed Feb 10 23:13:40 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 11 Feb 2010 09:13:40 +1100
Subject: [R-sig-Geo] get X and Y form point shapefile
In-Reply-To: <518dff331002101354y66481d28ja49c651c08efcefb@mail.gmail.com>
References: <518dff331002101354y66481d28ja49c651c08efcefb@mail.gmail.com>
Message-ID: <522664f81002101413i36728140k461031e11da08aa6@mail.gmail.com>

xy <- coordinates(sample.shp)

will give you a 2-column matrix "xy" of the X and Y coordinates.

For more complete reporting for this list, please provide the packages
you are using and the version. The easiest way is to use sessionInfo()

See here for more information, and the posting guide:
http://www.r-project.org/mail.html

Cheers, Mike.

On Thu, Feb 11, 2010 at 8:54 AM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> dear Rearchers
>
> I know this is easy but after 5 hours on R, I am honest and ?I don't
> rememeber to get X, Y coordinate from point shapefile
>
> sample.shp <- readShapeSpatial("sample.shp")
> proj4string(sample.shp) <- CRS("+init=epsg:26911")
> str(sample.shp)
> ?str(sample.shp)
>
> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
> ?..@ data ? ? ? :'data.frame': 50372 obs. of ?1 variable:
> ?.. ..$ Z: num [1:50372] 1498 1498 1499 1499 1503 ...
> ?.. ..- attr(*, "data_types")= chr "N"
> ?..@ coords.nrs : num(0)
> ?..@ coords ? ? : num [1:50372, 1:2] 268753 268754 268763 268761 268774 ...
> ?.. ..- attr(*, "dimnames")=List of 2
> ?.. .. ..$ : chr [1:50372] "0" "1" "2" "3" ...
> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
> ?..@ bbox ? ? ? : num [1:2, 1:2] 268501 4147540 268881 4147786
> ?.. ..- attr(*, "dimnames")=List of 2
> ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
> ?.. .. ..$ : chr [1:2] "min" "max"
> ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
> ?.. .. ..@ projargs: chr "+init=epsg:26911"
>
> thanks
> gianni
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mdsumner at gmail.com  Wed Feb 10 23:33:52 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 11 Feb 2010 09:33:52 +1100
Subject: [R-sig-Geo] get X and Y form point shapefile
In-Reply-To: <518dff331002101417u4210b0fal515b26a774b9f877@mail.gmail.com>
References: <518dff331002101354y66481d28ja49c651c08efcefb@mail.gmail.com>
	<522664f81002101413i36728140k461031e11da08aa6@mail.gmail.com>
	<518dff331002101417u4210b0fal515b26a774b9f877@mail.gmail.com>
Message-ID: <522664f81002101433j7d045d5frb1b8329c2211bf42@mail.gmail.com>

Hello,

On Thu, Feb 11, 2010 at 9:17 AM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> Thanks Mike,
>
> i have this question. Is It possible to get X,Y and have two new columns
> inside the dbf of shape? as GET X and GET Y of ArcMap
>

I have no idea about any of ArcMap's functions, and I'm sure many on
this list do not know either. I'm guessing that you want to add new
columns to the data-attributes of the object - this can be done
directly like this.

Assuming that sp package is loaded, and that "X" and "Y" do not
already exist, or you don't mind replacing them:

sample.df$X <-  coordinates(sample.df)[,1]
sample.df$Y <-  coordinates(sample.df)[,2]

A SpatialPointsDataFrame has no connection to the original shp/shx/dbf
files - you would need to write this object out to get the same result
in a shapefile.

Cheers, Mike.

> Gianni
>
> 2010/2/10 Michael Sumner <mdsumner at gmail.com>
>>
>> xy <- coordinates(sample.shp)
>>
>> will give you a 2-column matrix "xy" of the X and Y coordinates.
>>
>> For more complete reporting for this list, please provide the packages
>> you are using and the version. The easiest way is to use sessionInfo()
>>
>> See here for more information, and the posting guide:
>> http://www.r-project.org/mail.html
>>
>> Cheers, Mike.
>>
>> On Thu, Feb 11, 2010 at 8:54 AM, gianni lavaredo
>> <gianni.lavaredo at gmail.com> wrote:
>> > dear Rearchers
>> >
>> > I know this is easy but after 5 hours on R, I am honest and ?I don't
>> > rememeber to get X, Y coordinate from point shapefile
>> >
>> > sample.shp <- readShapeSpatial("sample.shp")
>> > proj4string(sample.shp) <- CRS("+init=epsg:26911")
>> > str(sample.shp)
>> > ?str(sample.shp)
>> >
>> > Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>> > ?..@ data ? ? ? :'data.frame': 50372 obs. of ?1 variable:
>> > ?.. ..$ Z: num [1:50372] 1498 1498 1499 1499 1503 ...
>> > ?.. ..- attr(*, "data_types")= chr "N"
>> > ?..@ coords.nrs : num(0)
>> > ?..@ coords ? ? : num [1:50372, 1:2] 268753 268754 268763 268761 268774
>> > ...
>> > ?.. ..- attr(*, "dimnames")=List of 2
>> > ?.. .. ..$ : chr [1:50372] "0" "1" "2" "3" ...
>> > ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> > ?..@ bbox ? ? ? : num [1:2, 1:2] 268501 4147540 268881 4147786
>> > ?.. ..- attr(*, "dimnames")=List of 2
>> > ?.. .. ..$ : chr [1:2] "coords.x1" "coords.x2"
>> > ?.. .. ..$ : chr [1:2] "min" "max"
>> > ?..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>> > ?.. .. ..@ projargs: chr "+init=epsg:26911"
>> >
>> > thanks
>> > gianni
>> >
>> > ? ? ? ?[[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at stat.math.ethz.ch
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>
>


From wouter at paramo.be  Wed Feb 10 23:38:24 2010
From: wouter at paramo.be (Wouter Buytaert)
Date: Wed, 10 Feb 2010 22:38:24 +0000 (GMT)
Subject: [R-sig-Geo] zero distance in spDistsN1
Message-ID: <alpine.DEB.2.00.1002101854460.2350@cotopaxi>


Hi list,

I found some strange behaviour in the latest version of spDistsN1:

> spDistsN1(cbind(c(1,2,3,4),c(0,0,0,0)), c(0,0), longlat = TRUE)
[1] 0 0 0 0
> spDistsN1(cbind(c(1,2,3,4),c(0,0,0,0)), c(0,0), longlat = FALSE)
[1] 1 2 3 4

It seems that for longlat=TRUE, zeros are returned whenever the latitude 
values are equal, because:

> spDistsN1(cbind(c(1,2,3,4),c(0.0001,0,0,0)), c(0,0), longlat = TRUE)
[1] 111.3195   0.0000   0.0000   0.0000

Here is some info on the package version:

> packageDescription("sp")
Package: sp
Version: 0.9-57
[...]
Built: R 2.10.1; x86_64-pc-linux-gnu; 2010-01-29 17:10:42 UTC; unix

but I also get it under windows and mac. Version 0.9-56 under mac worked 
fine:

> spDistsN1(cbind(c(1,2,3,4),c(0,0,0,0)), c(0,0), longlat = TRUE)
[1] 111.3195 222.6390 333.9585 445.2780



cheers
wouter


From gianni.lavaredo at gmail.com  Thu Feb 11 03:24:59 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Thu, 11 Feb 2010 03:24:59 +0100
Subject: [R-sig-Geo] create a polygon shape file from a points shape file
Message-ID: <518dff331002101824i2c185d48hefde38f6e02f505a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100211/eb30c1b9/attachment.pl>

From mdsumner at gmail.com  Thu Feb 11 06:42:29 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 11 Feb 2010 16:42:29 +1100
Subject: [R-sig-Geo] obtain all vertices from SpatialPolygonsDataFrame
Message-ID: <522664f81002102142w3452cabaxd85d537da56513be@mail.gmail.com>

Hello, this example came up in discussion today - this will retrieve
all the raw coordinates from a SpatialPolygonsDataFrame.

I cannot find any helper functions for this in maptools or sp, but if
there are some I'd like to know. This doesn't do anything to tag each
vertex in terms of its origin in the hierarchy, and a helper function
for that might be nice to work out.

I thought it might be of interest. There was a similar discussion
here: https://stat.ethz.ch/pipermail/r-sig-geo/2009-March/005302.html

Regards, Mike

library(rgdal)
dsn <- system.file("vectors", package = "rgdal")[1]

p <- readOGR(dsn=dsn, layer="trin_inca_pl03")


## this shows  the number of coordinates in the first polygon
lapply(p at polygons[[1]]@Polygons, function(x) dim(x at coords))

## how many parts across each polygon?
unlist(lapply(p at polygons, function(x) length(x)))

## how many coordinates in the first part of each?
lapply(p at polygons, function(x) dim(x at Polygons[[1]]@coords))


## get them all, dropping the last as a duplicate
xy <- do.call("rbind", lapply(p at polygons, function(x1)
do.call("rbind", lapply(x1 at Polygons, function(x2)
x2 at coords[-nrow(x2 at coords), ]))))


plot(p, col = "grey")

points(xy, col = "red", pch = ".")

## exploration I used to figure out the lapply commands above

## 3 levels of hierarchy, because of possible multi-parts (holes and islands)
slotNames(p)
#[1] "data"        "polygons"    "plotOrder"   "bbox"   "proj4string"
slotNames(p at polygons[[1]])
#[1] "Polygons"  "plotOrder" "labpt"     "ID"        "area"
slotNames(p at polygons[[1]]@Polygons[[1]])
#[1] "labpt"   "area"    "hole"    "ringDir" "coords"


From Roger.Bivand at nhh.no  Thu Feb 11 08:38:43 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 11 Feb 2010 08:38:43 +0100 (CET)
Subject: [R-sig-Geo] zero distance in spDistsN1
In-Reply-To: <alpine.DEB.2.00.1002101854460.2350@cotopaxi>
References: <alpine.DEB.2.00.1002101854460.2350@cotopaxi>
Message-ID: <alpine.LRH.2.00.1002110831180.9661@reclus.nhh.no>

On Wed, 10 Feb 2010, Wouter Buytaert wrote:

>
> Hi list,
>
> I found some strange behaviour in the latest version of spDistsN1:
>
>> spDistsN1(cbind(c(1,2,3,4),c(0,0,0,0)), c(0,0), longlat = TRUE)
> [1] 0 0 0 0
>> spDistsN1(cbind(c(1,2,3,4),c(0,0,0,0)), c(0,0), longlat = FALSE)
> [1] 1 2 3 4
>
> It seems that for longlat=TRUE, zeros are returned whenever the latitude 
> values are equal, because:

Thanks for an accurate and easily reproducible report. Fixed sp 0.9-59 
submitted to CRAN, committed to sourceforge CVS on r-spatial.

The reason was the omission of an abs() around a new test introduced 14 
January 2010 to return 0.0 when longitudes were 360 degrees apart (so 
effectively but not numerically identical) for identical latitudes. Output 
since that time, for identical latitudes only, may bave been affected.

Roger

>
>> spDistsN1(cbind(c(1,2,3,4),c(0.0001,0,0,0)), c(0,0), longlat = TRUE)
> [1] 111.3195   0.0000   0.0000   0.0000
>
> Here is some info on the package version:
>
>> packageDescription("sp")
> Package: sp
> Version: 0.9-57
> [...]
> Built: R 2.10.1; x86_64-pc-linux-gnu; 2010-01-29 17:10:42 UTC; unix
>
> but I also get it under windows and mac. Version 0.9-56 under mac worked 
> fine:
>
>> spDistsN1(cbind(c(1,2,3,4),c(0,0,0,0)), c(0,0), longlat = TRUE)
> [1] 111.3195 222.6390 333.9585 445.2780
>
>
>
> cheers
> wouter
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gianni.lavaredo at gmail.com  Thu Feb 11 14:49:54 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Thu, 11 Feb 2010 14:49:54 +0100
Subject: [R-sig-Geo] Export IDRISI vector format
Message-ID: <518dff331002110549k3bccde78x5e89b4a066cdafce@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100211/fddcb624/attachment.pl>

From h.lundqvist at gmail.com  Thu Feb 11 17:22:56 2010
From: h.lundqvist at gmail.com (Henrik Lundqvist)
Date: Thu, 11 Feb 2010 17:22:56 +0100
Subject: [R-sig-Geo] Export IDRISI vector format
In-Reply-To: <518dff331002110549k3bccde78x5e89b4a066cdafce@mail.gmail.com>
References: <518dff331002110549k3bccde78x5e89b4a066cdafce@mail.gmail.com>
Message-ID: <5d355e911002110822r7a1dc650l94127d93467211f0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100211/82f568fc/attachment.pl>

From h.lundqvist at gmail.com  Thu Feb 11 17:24:25 2010
From: h.lundqvist at gmail.com (Henrik Lundqvist)
Date: Thu, 11 Feb 2010 17:24:25 +0100
Subject: [R-sig-Geo] LoCoH isopleths intervals...
Message-ID: <5d355e911002110824g5366c462rb5b95934bb860d8c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100211/12c99fea/attachment.pl>

From Roger.Bivand at nhh.no  Thu Feb 11 17:53:36 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 11 Feb 2010 17:53:36 +0100 (CET)
Subject: [R-sig-Geo] Export IDRISI vector format
In-Reply-To: <518dff331002110549k3bccde78x5e89b4a066cdafce@mail.gmail.com>
References: <518dff331002110549k3bccde78x5e89b4a066cdafce@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002111745570.23405@reclus.nhh.no>

On Thu, 11 Feb 2010, gianni lavaredo wrote:

> Dear reseachers
>
> is there a pck to export (and import) vector and raster with IDRISI format?

Please do review the information in the Spatial Task View at your nearest 
CRAN mirror, many of your questions are answered there. In this case, see 
the drivers supported in the rgdal package with:

ogrDrivers() # for vector
gdalDrivers() # for raster

You need to avoid the Idrisi vector format, which is as bad as ArcGIS' 
personal geodatabase, and is a customised Access database:

http://lists.osgeo.org/pipermail/gdal-dev/2009-February/019760.html

If you need this under Windows, you'll have to build rgdal from source. 
Store vector data in something for which OGR has solid read and write 
drivers available for your platform.

Roger

>
> Thanks
> Gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Thu Feb 11 19:21:52 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 11 Feb 2010 10:21:52 -0800
Subject: [R-sig-Geo] create a polygon shape file from a points shape file
In-Reply-To: <518dff331002101824i2c185d48hefde38f6e02f505a@mail.gmail.com>
References: <518dff331002101824i2c185d48hefde38f6e02f505a@mail.gmail.com>
Message-ID: <dc22b2571002111021g795e21aqd310205c5c2768ba@mail.gmail.com>

Gianni,

If you read a points shpfile to get a SpatialPointsDataFrame object
(via maptools or readOGR) then, if your object is called 'x'

pts = coordinates(x)

# this will return something like:
pts <- rbind(c(-180,-20), c(-140,55), c(10, 0), c(-140,-60))

# you need to make sure that the last point and first coincide, so perhaps do
pts = rbind(pts, pts[1,])

# and then something like this
sp = SpatialPolygons( list(  Polygons(list(Polygon(pts)), 1)))

plot(sp)
points(pts, col='red', pch=as.character(0:9), cex=2)

And you can use writeOGR to save 'sp' as a shapefile.
Of course this assumes that the points are in the right order. Also,
you might prefer to read in the points from a text file rather then
going through a shapefile.

Robert

On Wed, Feb 10, 2010 at 6:24 PM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> dear R users,
>
> there is same possibility to convert a points shape file in a polygon shape
> file? where the corner are the last points
>
> thanks
> gianni
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From gianni.lavaredo at gmail.com  Fri Feb 12 00:32:41 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 12 Feb 2010 00:32:41 +0100
Subject: [R-sig-Geo] suggestion to creating LIS (Line Intersect Sampling )
	for Dead Wood
Message-ID: <518dff331002111532j354866ds34c71cea3a7b916a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100212/414668d4/attachment.pl>

From caspar.hallmann at gmail.com  Fri Feb 12 14:38:31 2010
From: caspar.hallmann at gmail.com (caspar hallmann)
Date: Fri, 12 Feb 2010 14:38:31 +0100
Subject: [R-sig-Geo] R crash with readOGR
Message-ID: <b552b8401002120538x38d66183jce82db2f44ea5ffb@mail.gmail.com>

Dear All,

Perhaps one can help me with the obvious, however I have been trying
to import a shapefile using function readOGR as in:
myshp<-readOGR("mydirectorypath", "shapefilename"), and without any
warning (e.g. can't allocate memory size or something trivial) R
crashes en shuts down. The shapefile itself does not seem too large
though ( 42mb the .shp alone).
I wonder if anyone has encountered the same problem, or beter, the solution.
For now, I have resorted to importing the .dbf of the shapefile (works
fine), then converting it to some preferred spatial format. However,
since now I am required to manually set the CRS this pretty much
prevents me from applying batch analysis on a range of shapesfile
differing in their CRS's. Note that the .prj are present, and would
like to take advantage of readOGR's capability of recognizing the CRS
of each shapefile.

Thanks in advance

Caspar

PS: BTW: Is there a function like ''readprj()'' around ?
PS2: sessionInfo:
R version 2.10.1 (2009-12-14)
i386-pc-mingw32

locale:
[1] LC_COLLATE=Dutch_Netherlands.1252  LC_CTYPE=Dutch_Netherlands.1252
   LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
[5] LC_TIME=Dutch_Netherlands.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] RSAGA_0.9-6     rgdal_0.6-24    maptools_0.7-29 lattice_0.18-3
sp_0.9-57       foreign_0.8-39

loaded via a namespace (and not attached):
[1] grid_2.10.1  proj4_1.0-4  tools_2.10.1
>


From Roger.Bivand at nhh.no  Fri Feb 12 15:47:40 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 12 Feb 2010 15:47:40 +0100 (CET)
Subject: [R-sig-Geo] R crash with readOGR
In-Reply-To: <b552b8401002120538x38d66183jce82db2f44ea5ffb@mail.gmail.com>
References: <b552b8401002120538x38d66183jce82db2f44ea5ffb@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002121512440.25792@reclus.nhh.no>

On Fri, 12 Feb 2010, caspar hallmann wrote:

> Dear All,
>
> Perhaps one can help me with the obvious, however I have been trying
> to import a shapefile using function readOGR as in:
> myshp<-readOGR("mydirectorypath", "shapefilename"), and without any
> warning (e.g. can't allocate memory size or something trivial) R
> crashes en shuts down. The shapefile itself does not seem too large
> though ( 42mb the .shp alone).

OK. You are on Windows, where memory management is not as capable as on 
Unix-based systems. If R say that it cannot allocate memory under Windows, 
it has not "crashed", only responded to the inadequacy of the system. If 
you read the R for Windows FAQ, you'll see some tricks for improving 
memory use. A 42MB shapefile is very large, you have not said what you 
need to use it for.

The R lists posting guide does say when you can term anything a crash, 
this is not one of those cases.

There is no separate function for reading a *.prj file. The so-called WKT 
spatial reference in the *.prj is read by the OGR driver, and converted to 
PROJ.4.

"OGRSpatialRef" <- function(dsn, layer) {
     .Call("ogrP4S", as.character(dsn), as.character(layer),
         PACKAGE="rgdal")
}

is a function that will return that representation without trying to read 
the features, I'll add it and one for GDAL rasters to the next release - 
the GDAL information is already in the object returned by GDALinfo(), but 
noy yet in that returned by ogrInfo().

Hope this helps,

Roger

> I wonder if anyone has encountered the same problem, or beter, the solution.
> For now, I have resorted to importing the .dbf of the shapefile (works
> fine), then converting it to some preferred spatial format. However,
> since now I am required to manually set the CRS this pretty much
> prevents me from applying batch analysis on a range of shapesfile
> differing in their CRS's. Note that the .prj are present, and would
> like to take advantage of readOGR's capability of recognizing the CRS
> of each shapefile.
>
> Thanks in advance
>
> Caspar
>
> PS: BTW: Is there a function like ''readprj()'' around ?
> PS2: sessionInfo:
> R version 2.10.1 (2009-12-14)
> i386-pc-mingw32
>
> locale:
> [1] LC_COLLATE=Dutch_Netherlands.1252  LC_CTYPE=Dutch_Netherlands.1252
>   LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
> [5] LC_TIME=Dutch_Netherlands.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] RSAGA_0.9-6     rgdal_0.6-24    maptools_0.7-29 lattice_0.18-3
> sp_0.9-57       foreign_0.8-39
>
> loaded via a namespace (and not attached):
> [1] grid_2.10.1  proj4_1.0-4  tools_2.10.1
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From caspar.hallmann at gmail.com  Fri Feb 12 16:40:32 2010
From: caspar.hallmann at gmail.com (caspar hallmann)
Date: Fri, 12 Feb 2010 16:40:32 +0100
Subject: [R-sig-Geo] R crash with readOGR
In-Reply-To: <alpine.LRH.2.00.1002121512440.25792@reclus.nhh.no>
References: <b552b8401002120538x38d66183jce82db2f44ea5ffb@mail.gmail.com>
	<alpine.LRH.2.00.1002121512440.25792@reclus.nhh.no>
Message-ID: <b552b8401002120740n13364425t716ffabd3f35b807@mail.gmail.com>

Hi Roger,

Thank you for your very quick response.
This surely helps...

Perhaps however I should have emphasized: "without" any warning, the
thing being that I 'suspected' this is a memory issue.
What happened is that after submitting the code to R, and after
waiting a few minutes, R just shuts down. No warnings, no errors,
nothing.
And this keeps coming up after clearing memory (other data) or
restarting R altogether.

What I want to do is retrieve a range of shapefiles, possibly
differing in their CRS's, homogenizing the reference system,
overlaying and finally creating a 'covariate' dataset for further
geostatistical analysis. Since this will eventually be called in a
batch mode for many spatial response variables, with each response
having differing set of covariates (and thus layers and projections),
I need to get this streamlined.

Anyway, the function 'OGRSpatialRef' worked fine, and in conjunction
with read.dbf from library 'foreign'  (to get the data) I'm pretty
much sorted. So thanks again!

all the best,

Caspar



On Fri, Feb 12, 2010 at 3:47 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 12 Feb 2010, caspar hallmann wrote:
>
>> Dear All,
>>
>> Perhaps one can help me with the obvious, however I have been trying
>> to import a shapefile using function readOGR as in:
>> myshp<-readOGR("mydirectorypath", "shapefilename"), and without any
>> warning (e.g. can't allocate memory size or something trivial) R
>> crashes en shuts down. The shapefile itself does not seem too large
>> though ( 42mb the .shp alone).
>
> OK. You are on Windows, where memory management is not as capable as on
> Unix-based systems. If R say that it cannot allocate memory under Windows,
> it has not "crashed", only responded to the inadequacy of the system. If you
> read the R for Windows FAQ, you'll see some tricks for improving memory use.
> A 42MB shapefile is very large, you have not said what you need to use it
> for.
>
> The R lists posting guide does say when you can term anything a crash, this
> is not one of those cases.
>
> There is no separate function for reading a *.prj file. The so-called WKT
> spatial reference in the *.prj is read by the OGR driver, and converted to
> PROJ.4.
>
> "OGRSpatialRef" <- function(dsn, layer) {
> ? ?.Call("ogrP4S", as.character(dsn), as.character(layer),
> ? ? ? ?PACKAGE="rgdal")
> }
>
> is a function that will return that representation without trying to read
> the features, I'll add it and one for GDAL rasters to the next release - the
> GDAL information is already in the object returned by GDALinfo(), but noy
> yet in that returned by ogrInfo().
>
> Hope this helps,
>
> Roger
>
>> I wonder if anyone has encountered the same problem, or beter, the
>> solution.
>> For now, I have resorted to importing the .dbf of the shapefile (works
>> fine), then converting it to some preferred spatial format. However,
>> since now I am required to manually set the CRS this pretty much
>> prevents me from applying batch analysis on a range of shapesfile
>> differing in their CRS's. Note that the .prj are present, and would
>> like to take advantage of readOGR's capability of recognizing the CRS
>> of each shapefile.
>>
>> Thanks in advance
>>
>> Caspar
>>
>> PS: BTW: Is there a function like ''readprj()'' around ?
>> PS2: sessionInfo:
>> R version 2.10.1 (2009-12-14)
>> i386-pc-mingw32
>>
>> locale:
>> [1] LC_COLLATE=Dutch_Netherlands.1252 ?LC_CTYPE=Dutch_Netherlands.1252
>> ?LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
>> [5] LC_TIME=Dutch_Netherlands.1252
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] RSAGA_0.9-6 ? ? rgdal_0.6-24 ? ?maptools_0.7-29 lattice_0.18-3
>> sp_0.9-57 ? ? ? foreign_0.8-39
>>
>> loaded via a namespace (and not attached):
>> [1] grid_2.10.1 ?proj4_1.0-4 ?tools_2.10.1
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>


From markus.loecher at gmail.com  Sat Feb 13 14:35:52 2010
From: markus.loecher at gmail.com (Markus Loecher)
Date: Sat, 13 Feb 2010 08:35:52 -0500
Subject: [R-sig-Geo] rgdal writeOGR, KML examples
Message-ID: <bf460e021002130535j38390fa2t7ed2bfda5b057e7e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100213/e2213564/attachment.pl>

From Roger.Bivand at nhh.no  Sun Feb 14 20:57:43 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 14 Feb 2010 20:57:43 +0100 (CET)
Subject: [R-sig-Geo] R crash with readOGR
In-Reply-To: <b552b8401002120740n13364425t716ffabd3f35b807@mail.gmail.com>
References: <b552b8401002120538x38d66183jce82db2f44ea5ffb@mail.gmail.com>
	<alpine.LRH.2.00.1002121512440.25792@reclus.nhh.no>
	<b552b8401002120740n13364425t716ffabd3f35b807@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002142021070.31326@reclus.nhh.no>

On Fri, 12 Feb 2010, caspar hallmann wrote:

> Hi Roger,
>
> Thank you for your very quick response.
> This surely helps...

The analysis for the data set that Caspar kindly made available is as 
follows:

1. With a very large number of polygons for some (which unknown) versions 
of R and sp, the instantiation of the SpatialPolygonsDataFrame can begin 
to use increasing amounts of memory, which is not freed and may render a 
platform with too little RAM unusable. On Windows with default memory 
settings, this may terminate R as reported. The next releases of sp and 
rgdal should address this problem. I think that the cause lies in the base 
methods package, but the changes should avoid problems. Please contact me 
if anyone observes similar behaviour from sp 0.9-60 or subsequent and 
rgdal 0.6-25 or subsequent.

2. readOGR() now has a default useC=TRUE argument; however, time savings 
are small since Polygon, Polygons, and SpatialPolygons object creation is 
already handled in C from the sp package, so the extra layer in rgdal 
does not gain much. Attempts to rewrite readOGR in C will follow later.

3. Caspar's data set is a projected grid of raster cells with 327615 
"polygons", each with only 5 coordinates, that is 80 bytes (each feature 
in the shapefile takes just 150 bytes). Putting this into a Polygons 
object adds over 2800 bytes, which is effectively a worst case scenario. A 
grid cell then looks like:

> str(slot(fc, "polygons")[[1]])
Formal class 'Polygons' [package "sp"] with 5 slots
   ..@ Polygons :List of 1
   .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
   .. .. .. ..@ labpt  : num [1:2] -14383 569871
   .. .. .. ..@ area   : num 1003399
   .. .. .. ..@ hole   : logi FALSE
   .. .. .. ..@ ringDir: int 1
   .. .. .. ..@ coords : num [1:5, 1:2] -13841 -13927 -14925 -14839 -13841 
...
   ..@ plotOrder: int 1
   ..@ labpt    : num [1:2] -14383 569871
   ..@ ID       : chr "0"
   ..@ area     : num 1003399

where

> 2896 * 327615
[1] 948773040

so the SpatialPolygons object "weighs in" at 1GB for a <50MB shapefile.

With this size of object, one needs a lot of RAM, and probably a 64-bit 
platform. Reading it for me with 4GB pushed memory usage to just over 2GB 
(including all running processes). With useC=TRUE, reading completed in 
135 seconds, with useC=FALSE 153 seconds.

4. My feeling is that the main issue is the workflow, and choice of 
representation. The data are raster data with 1000m resolution, and 
instead of warping to the OSGB National Grid, they have been vectorised, 
and the vector squares quasi-projected (quasi- because the curved southern 
and northern borders are represented by straight lines).

If the data had been warped instead of vectorised, or if the subsequent 
analysis could be done in the input projection, the worst-case behaviour 
of the SpatialPolygons, Polygons, and Polygon class could be avoided. 
Indeed, using the R-Forge raster package, much finer resolution raster 
data could have been used.

I'll be submitting new sp and rgdal releases to CRAN. The rgdal release 
should also trigger the building of the Windows binary with the new GDAL 
1.7.1 release, with R and SAGA raster drivers.

Thanks to Caspar for helping analyse this problem.

Roger

>
> Perhaps however I should have emphasized: "without" any warning, the
> thing being that I 'suspected' this is a memory issue.
> What happened is that after submitting the code to R, and after
> waiting a few minutes, R just shuts down. No warnings, no errors,
> nothing.
> And this keeps coming up after clearing memory (other data) or
> restarting R altogether.
>
> What I want to do is retrieve a range of shapefiles, possibly
> differing in their CRS's, homogenizing the reference system,
> overlaying and finally creating a 'covariate' dataset for further
> geostatistical analysis. Since this will eventually be called in a
> batch mode for many spatial response variables, with each response
> having differing set of covariates (and thus layers and projections),
> I need to get this streamlined.
>
> Anyway, the function 'OGRSpatialRef' worked fine, and in conjunction
> with read.dbf from library 'foreign'  (to get the data) I'm pretty
> much sorted. So thanks again!
>
> all the best,
>
> Caspar
>
>
>
> On Fri, Feb 12, 2010 at 3:47 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Fri, 12 Feb 2010, caspar hallmann wrote:
>>
>>> Dear All,
>>>
>>> Perhaps one can help me with the obvious, however I have been trying
>>> to import a shapefile using function readOGR as in:
>>> myshp<-readOGR("mydirectorypath", "shapefilename"), and without any
>>> warning (e.g. can't allocate memory size or something trivial) R
>>> crashes en shuts down. The shapefile itself does not seem too large
>>> though ( 42mb the .shp alone).
>>
>> OK. You are on Windows, where memory management is not as capable as on
>> Unix-based systems. If R say that it cannot allocate memory under Windows,
>> it has not "crashed", only responded to the inadequacy of the system. If you
>> read the R for Windows FAQ, you'll see some tricks for improving memory use.
>> A 42MB shapefile is very large, you have not said what you need to use it
>> for.
>>
>> The R lists posting guide does say when you can term anything a crash, this
>> is not one of those cases.
>>
>> There is no separate function for reading a *.prj file. The so-called WKT
>> spatial reference in the *.prj is read by the OGR driver, and converted to
>> PROJ.4.
>>
>> "OGRSpatialRef" <- function(dsn, layer) {
>> ? ?.Call("ogrP4S", as.character(dsn), as.character(layer),
>> ? ? ? ?PACKAGE="rgdal")
>> }
>>
>> is a function that will return that representation without trying to read
>> the features, I'll add it and one for GDAL rasters to the next release - the
>> GDAL information is already in the object returned by GDALinfo(), but noy
>> yet in that returned by ogrInfo().
>>
>> Hope this helps,
>>
>> Roger
>>
>>> I wonder if anyone has encountered the same problem, or beter, the
>>> solution.
>>> For now, I have resorted to importing the .dbf of the shapefile (works
>>> fine), then converting it to some preferred spatial format. However,
>>> since now I am required to manually set the CRS this pretty much
>>> prevents me from applying batch analysis on a range of shapesfile
>>> differing in their CRS's. Note that the .prj are present, and would
>>> like to take advantage of readOGR's capability of recognizing the CRS
>>> of each shapefile.
>>>
>>> Thanks in advance
>>>
>>> Caspar
>>>
>>> PS: BTW: Is there a function like ''readprj()'' around ?
>>> PS2: sessionInfo:
>>> R version 2.10.1 (2009-12-14)
>>> i386-pc-mingw32
>>>
>>> locale:
>>> [1] LC_COLLATE=Dutch_Netherlands.1252 ?LC_CTYPE=Dutch_Netherlands.1252
>>> ?LC_MONETARY=Dutch_Netherlands.1252 LC_NUMERIC=C
>>> [5] LC_TIME=Dutch_Netherlands.1252
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] RSAGA_0.9-6 ? ? rgdal_0.6-24 ? ?maptools_0.7-29 lattice_0.18-3
>>> sp_0.9-57 ? ? ? foreign_0.8-39
>>>
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.10.1 ?proj4_1.0-4 ?tools_2.10.1
>>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From Roger.Bivand at nhh.no  Mon Feb 15 08:24:12 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 15 Feb 2010 08:24:12 +0100 (CET)
Subject: [R-sig-Geo] rgdal writeOGR, KML examples
In-Reply-To: <bf460e021002130535j38390fa2t7ed2bfda5b057e7e@mail.gmail.com>
References: <bf460e021002130535j38390fa2t7ed2bfda5b057e7e@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002150817060.4830@reclus.nhh.no>

On Sat, 13 Feb 2010, Markus Loecher wrote:

> Dear all,
> I was wondering if anyone has a few more examples on creating KML files with
> the fantastic writeOGR() function in the rgdal package. The meuse example is
> great but I am particularly interested in modifying some of the simple style
> attributes (marker size, type, etc..) in the resulting kml files. Is that
> possible at all via writeOGR(..., , driver="KML") ?

What is possible in writeOGR() is what is possible in the OGR driver, so 
please refer to:

http://www.gdal.org/ogr/drv_kml.html

You will see that there is "little support" for formatting, but as the 
driver documentation says, try a few simple test files to see what can be 
done. Alternatives not using this driver are kmlLine() and kmlPolygon() in 
maptools, which may permit more customising, or the GE_SpatialGrid() and 
kmlOverlay() tandem in maptools for making an image overlay. This permits 
arbitrary R symbology, but no querying in GE.

Hope this helps,

Roger

>
> Thanks !
>
> Markus Loecher
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From b.rowlingson at lancaster.ac.uk  Mon Feb 15 09:03:05 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 15 Feb 2010 08:03:05 +0000
Subject: [R-sig-Geo] rgdal writeOGR, KML examples
In-Reply-To: <alpine.LRH.2.00.1002150817060.4830@reclus.nhh.no>
References: <bf460e021002130535j38390fa2t7ed2bfda5b057e7e@mail.gmail.com>
	<alpine.LRH.2.00.1002150817060.4830@reclus.nhh.no>
Message-ID: <d8ad40b51002150003g2a2c0ed1j16821e012d309852@mail.gmail.com>

On Mon, Feb 15, 2010 at 7:24 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> What is possible in writeOGR() is what is possible in the OGR driver, so
> please refer to:
>
> http://www.gdal.org/ogr/drv_kml.html
>
> You will see that there is "little support" for formatting, but as the
> driver documentation says, try a few simple test files to see what can be
> done. Alternatives not using this driver are kmlLine() and kmlPolygon() in
> maptools, which may permit more customising, or the GE_SpatialGrid() and
> kmlOverlay() tandem in maptools for making an image overlay. This permits
> arbitrary R symbology, but no querying in GE.
>

 Another possibility when you want total flexibility in your KML
output is to roll-your-own conversion, using the 'brew' package. This
lets you set up a template with embedded chunks of R code. You'll need
to understand the KML file format, of course, but that's quite simple
and well documented.

You can use the standard KML conversion functions to give you a head
start. Do a 'writeOGR' on your data for starters, then edit the KML
and spot the bit that recurs for each point or polygon. Put one copy
of that section in a loop and save as a brew template. Add salt,
pepper, and cook for five minutes.

Barry

[once again apologies for sending this with the wrong 'From:' address
first time]

-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From gianni.lavaredo at gmail.com  Mon Feb 15 14:39:26 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Mon, 15 Feb 2010 14:39:26 +0100
Subject: [R-sig-Geo] compute buffer from point shapefile to have shapefile
Message-ID: <518dff331002150539l962469fh75e1b097a431a4b6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100215/c1c95540/attachment.pl>

From etiennebr at gmail.com  Mon Feb 15 17:23:26 2010
From: etiennebr at gmail.com (Etienne Bellemare Racine)
Date: Mon, 15 Feb 2010 11:23:26 -0500
Subject: [R-sig-Geo] Looking for a clustering indicator
Message-ID: <4B7974FE.5070802@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100215/3d169948/attachment.pl>

From adam.a28 at wp.pl  Mon Feb 15 17:29:00 2010
From: adam.a28 at wp.pl (Adam A)
Date: Mon, 15 Feb 2010 17:29:00 +0100
Subject: [R-sig-Geo] border
Message-ID: <4b79764c67f653.03486223@wp.pl>

Good day!
I would like to connect 2,3 or 4 administrative units so as not to have 
a common border.
Thanks in advance for your help.
Adam


From Roger.Bivand at nhh.no  Mon Feb 15 18:05:49 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 15 Feb 2010 18:05:49 +0100 (CET)
Subject: [R-sig-Geo] border
In-Reply-To: <4b79764c67f653.03486223@wp.pl>
References: <4b79764c67f653.03486223@wp.pl>
Message-ID: <alpine.LRH.2.00.1002151759200.5439@reclus.nhh.no>

On Mon, 15 Feb 2010, Adam A wrote:

> Good day!
> I would like to connect 2,3 or 4 administrative units so as not to have
> a common border.

Please see the unionSpatialPolygons() function in maptools.

Note that you (still) need to use the gpclib package to dissolve borders, 
which has a rather non-free licence. If this is a problem, ask again, and 
I'll direct you to the beta rgeos package and forthcoming changes in 
maptools, which will prefer rgeos over gpclib if rgeos is installed.

Hope this helps,

Roger

PS. an informative signature would avoid doubt about licences, because if 
you are in academia, the gpclib licence would possibly be OK (educational 
purposes, hobby, etc.), but if you work in real estate or telecoms, it 
certainly isn't, even just for using gpclib, I'm afraid. This is one of 
the reasons why informative affiliations or signatures help us give 
appropriate advice.

> Thanks in advance for your help.
> Adam
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Mon Feb 15 21:53:43 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 15 Feb 2010 12:53:43 -0800
Subject: [R-sig-Geo] compute buffer from point shapefile to have
	shapefile
In-Reply-To: <518dff331002150539l962469fh75e1b097a431a4b6@mail.gmail.com>
References: <518dff331002150539l962469fh75e1b097a431a4b6@mail.gmail.com>
Message-ID: <dc22b2571002151253gc583ba1q68d4e48fea1bbced@mail.gmail.com>

Gianni,

Here is an example for longitude/latitude data using (together with
the more usual suspects) the geosphere package (recently released to
CRAN).

xy <- cbind(0, seq(-80, 80, by=20))
dist = 1000000  # 500 km
angles = seq(1,360, by=5)

library(geosphere)
crds = list()
for (i in 1:nrow(xy)) {
	d = destPoint(xy[i,], angles, dist)
	crds[[i]] = rbind(d, d[1,])
}

library(sp)
p = lapply(crds, Polygon)
pp = list()
for (i in 1:length(p)) pp[i] = Polygons(p[i], i)
spdf = SpatialPolygonsDataFrame(SpatialPolygons(pp), data.frame(id=1:length(p)))

library(maptools)
data(wrld_simpl)
plot(wrld_simpl)
plot(spdf, add=TRUE, border='red', lwd=2)
points(xy, pch=20, col='blue')






On Mon, Feb 15, 2010 at 5:39 AM, gianni lavaredo
<gianni.lavaredo at gmail.com> wrote:
> Dear Researchers,
>
> I am looking for a library to compute buffer (Ex: 10 m radius) around a
> shapefile point file. I find buffer {adehabitat} but I wish to know if there
> is another library to compute buffer.
>
> Thanks for helps
> gianni
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From tgriffin at uaex.edu  Mon Feb 15 19:33:17 2010
From: tgriffin at uaex.edu (Terry Griffin)
Date: Mon, 15 Feb 2010 12:33:17 -0600
Subject: [R-sig-Geo] Looking for a clustering indicator
In-Reply-To: <4B7974FE.5070802@gmail.com>
References: <4B7974FE.5070802@gmail.com>
Message-ID: <4B793F0D.CF06.00FB.0@uaex.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100215/dd521470/attachment.pl>

From tylerdeanrudolph at gmail.com  Tue Feb 16 01:42:15 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Mon, 15 Feb 2010 19:42:15 -0500
Subject: [R-sig-Geo] Create SpatialLinesDataFrame
Message-ID: <9fb1ae891002151642h2ccaf07fy186e70e4f0dbae03@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100215/e2e68469/attachment.pl>

From mdsumner at gmail.com  Tue Feb 16 02:49:18 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 16 Feb 2010 12:49:18 +1100
Subject: [R-sig-Geo] Create SpatialLinesDataFrame
In-Reply-To: <9fb1ae891002151642h2ccaf07fy186e70e4f0dbae03@mail.gmail.com>
References: <9fb1ae891002151642h2ccaf07fy186e70e4f0dbae03@mail.gmail.com>
Message-ID: <522664f81002151749q2936e015o7658747677cce94d@mail.gmail.com>

Using apply makes it difficult to set an appropriate ID for each Line,
so I've done it in a loop:

ranlines <- list()

for (irow in 1:nrow(temp)) {
	ranlines[[irow]] <- Lines(Line(rbind(as.numeric(temp[irow, c("x",
"y")]), as.numeric(temp[irow, c("X2", "Y2")]))),
		ID = as.character(irow))
}

sldf <- SpatialLinesDataFrame(SpatialLines(ranlines), temp, match.ID = FALSE)


I've also used named arguments as your indexes don't match the table
as you presented it, I presume that start is "x/y" and the end is
"X2/Y2"?

Then you can use this to write a shapefile to the current directory:

library(rgdal)
writeOGR(sldf, ".", "ranlines", "ESRI Shapefile")

I agree there needs to be more examples, the fact of multi-part lines,
polygons and points can be hard to grasp and the need for them makes
the structure of sp objects difficult to understand. It's not hard
once you do though. I posted this as I thought it might be of use:

https://stat.ethz.ch/pipermail/r-sig-geo/2010-February/007619.html

It's not a great example, but it shows how I explore these objects to
get an understanding. In case it's of use I also put this together
this morning, to work with the results of package "alphahull":

This example creates a (possibly multi-branched) line object and
writes to shapefile.

#R

library(alphahull)

library(rgdal)

# Uniform sample of size n=300 in the annulus B(c,0.5)\B(c,0.25),

# with c=(0.5,0.5).

n <- 300

theta<-runif(n,0,2*pi)

r<-sqrt(runif(n,0.25^2,0.5^2))

x<-cbind(0.5+r*cos(theta),0.5+r*sin(theta))



x <- do.call('cbind', locator())

# Value of alpha

alpha <- 0.1

# alpha-shape

x.shape <- ashape(x, alpha = alpha)

## construct a GIS-line object

l <- list()

for (i in 1:nrow(x.shape$edges)) {

 l[[i]] <-  Line(rbind(x.shape$edges[i, 3:4], x.shape$edges[i, 5:6]))

}

## one line object, one ID value

l <- list(Lines(l, as.character("1")))

## equivalent to a drawing with a single line object:

sldf <- SpatialLinesDataFrame(SpatialLines(l), data.frame(name =
"ashape"), match.ID = FALSE)



## write to desired OGR driver (see ogrDrivers() for available ones)

## this creates lines.shp/shx/dbf in current directory

writeOGR(sldf, ".", "lines", "ESRI Shapefile")


Cheers, Mike.





On Tue, Feb 16, 2010 at 11:42 AM, Tyler Dean Rudolph
<tylerdeanrudolph at gmail.com> wrote:
> I have searched extensively for some good examples or documentation on how
> to create a SpatialLinesDataFrame and for the life of me have found zilch.
> This does not mean there is no such thing available, it just means that
> wherever it is it is not readily accessible through the circuitous pathways
> of R help documentation or via a simple web search. ?As someone who
> struggles daily to achieve highly technical things with scarcely the savvy
> required, I wish there were more (or any?) examples in the documentation for
> most of the spatial packages available. ?(I also wish that managing and
> manipulating Spatial objects was about 65% less complicated, but for the
> moment let's start with this)...
>
> I have a data.frame (temp) containing endpoints of animal trajectories with
> which I would like to create a SpatialLinesDataFrame for export into a GIS.
>
>> temp
> ? ? ? id ? ? ? ? ? ? ? ? day ? ? ? x ? ? ? ?y ? ? ? ?X2 ? ? ? Y2
> 1 2002007 2005-04-04 12:01:01 -300358 748992.6 -300450.8 748764.8
> 2 2002007 2005-04-04 12:01:01 -300358 748992.6 -301694.2 751728.4
> 3 2002007 2005-04-04 12:01:01 -300358 748992.6 -299983.1 749528.8
> 4 2002007 2005-04-04 12:01:01 -300358 748992.6 -300569.4 749640.7
> 5 2002007 2005-04-04 12:01:01 -300358 748992.6 -300439.0 748308.8
>
> I seem reasonably able to create a Lines object (though I can't get the ID
> argument to work for me where there are multiple records involved)....
>
>> ranlines<-apply(temp, 1, ?function(x)
> Lines(Line(list(rbind(as.numeric(x[7:8]), as.numeric(x[9:10]))))))
>
>> str(ranlines[[1]])
> Formal class 'Lines' [package "sp"] with 2 slots
> ?..@ Lines:List of 1
> ?.. ..$ :Formal class 'Line' [package "sp"] with 1 slots
> ?.. .. .. ..@ coords: num [1:2, 1:2] -300358 -300451 748993 748765
> ?.. .. .. .. ..- attr(*, "dimnames")=List of 2
> ?.. .. .. .. .. ..$ : NULL
> ?.. .. .. .. .. ..$ : chr [1:2] "X1" "X2"
> ?..@ ID ? : chr NA
>
> Am I at least on the right track? ? Unfortunately now I'm clueless as to
> what to do next because apparently Lines cannot be coerced to SpatialLines,
> and while I am normally able to figure my way out of things there is just
> nothing intuitive about this as far as I can tell. ?I have tried to create
> SLDFs numerous times in the past and I have always been discouraged from
> continuing. ?I can create a psp object in Spatstat but I am equally unable
> to convert that into a SLDF shape. ?Terribly sorry about the rant but it's
> difficulties like these that prevent a lot of people more clueless than me
> from ever getting anywhere with R and more specifically the spatial
> stuff....
>
> Tyler
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Tue Feb 16 10:06:22 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 16 Feb 2010 10:06:22 +0100 (CET)
Subject: [R-sig-Geo] Create SpatialLinesDataFrame
In-Reply-To: <9fb1ae891002151642h2ccaf07fy186e70e4f0dbae03@mail.gmail.com>
References: <9fb1ae891002151642h2ccaf07fy186e70e4f0dbae03@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002160954040.8609@reclus.nhh.no>

On Mon, 15 Feb 2010, Tyler Dean Rudolph wrote:

> I have searched extensively for some good examples or documentation on how
> to create a SpatialLinesDataFrame and for the life of me have found zilch.
> This does not mean there is no such thing available, it just means that
> wherever it is it is not readily accessible through the circuitous pathways
> of R help documentation or via a simple web search.

I have discussed with Achim Zeilis, who faces the same problem, the 
ethical appropriateness of mentioning our book on the Spatial Task View, 
and we've found until now that we shouldn't mention our own books. If 
opinion is that we should, and because they are in a number of university 
libraries, I can do that, and encourage Achim to do the same for 
Econometrics.

If you visit the book website (http://www.asdar-book.org), you will find 
links to code showing how to do this (chapter 2). In addition, under 
"Additional materials", you find links to course materials, especially to 
a course given at Imperial College in 2007, in which a good deal of these 
questions are covered (see "Representing Spatial Data").

Because the classes were designed as interface containers, most users do 
not need to know how to construct them from scratch, typically reading in 
data or coercing from other classes of objects. While the help pages could 
certainly be improved, we do provide a vignette that ships with the 
package, and where section 6 covers Line objects etc. See:

http://cran.r-project.org/web/packages/sp/vignettes/sp.pdf

or:

vignette("sp", package="sp")

in R.

I'm sure that Mike's answer resolves your immediate problem - this is more 
of an answer to your general question about where to look for information 
about sp classes and how to make and use them.

Hope this helps,

Roger

> As someone who
> struggles daily to achieve highly technical things with scarcely the savvy
> required, I wish there were more (or any?) examples in the documentation for
> most of the spatial packages available.  (I also wish that managing and
> manipulating Spatial objects was about 65% less complicated, but for the
> moment let's start with this)...
>
> I have a data.frame (temp) containing endpoints of animal trajectories with
> which I would like to create a SpatialLinesDataFrame for export into a GIS.
>
>> temp
>       id                 day       x        y        X2       Y2
> 1 2002007 2005-04-04 12:01:01 -300358 748992.6 -300450.8 748764.8
> 2 2002007 2005-04-04 12:01:01 -300358 748992.6 -301694.2 751728.4
> 3 2002007 2005-04-04 12:01:01 -300358 748992.6 -299983.1 749528.8
> 4 2002007 2005-04-04 12:01:01 -300358 748992.6 -300569.4 749640.7
> 5 2002007 2005-04-04 12:01:01 -300358 748992.6 -300439.0 748308.8
>
> I seem reasonably able to create a Lines object (though I can't get the ID
> argument to work for me where there are multiple records involved)....
>
>> ranlines<-apply(temp, 1,  function(x)
> Lines(Line(list(rbind(as.numeric(x[7:8]), as.numeric(x[9:10]))))))
>
>> str(ranlines[[1]])
> Formal class 'Lines' [package "sp"] with 2 slots
>  ..@ Lines:List of 1
>  .. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>  .. .. .. ..@ coords: num [1:2, 1:2] -300358 -300451 748993 748765
>  .. .. .. .. ..- attr(*, "dimnames")=List of 2
>  .. .. .. .. .. ..$ : NULL
>  .. .. .. .. .. ..$ : chr [1:2] "X1" "X2"
>  ..@ ID   : chr NA
>
> Am I at least on the right track?   Unfortunately now I'm clueless as to
> what to do next because apparently Lines cannot be coerced to SpatialLines,
> and while I am normally able to figure my way out of things there is just
> nothing intuitive about this as far as I can tell.  I have tried to create
> SLDFs numerous times in the past and I have always been discouraged from
> continuing.  I can create a psp object in Spatstat but I am equally unable
> to convert that into a SLDF shape.  Terribly sorry about the rant but it's
> difficulties like these that prevent a lot of people more clueless than me
> from ever getting anywhere with R and more specifically the spatial
> stuff....
>
> Tyler
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From h.lundqvist at gmail.com  Tue Feb 16 14:44:39 2010
From: h.lundqvist at gmail.com (Henrik Lundqvist)
Date: Tue, 16 Feb 2010 14:44:39 +0100
Subject: [R-sig-Geo] NNCH (adehabitat) into RUF
Message-ID: <5d355e911002160544yf636c9hbc142c34ec4626eb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100216/40146d74/attachment.pl>

From andy.south at cefas.co.uk  Tue Feb 16 15:28:38 2010
From: andy.south at cefas.co.uk (Andy South (Cefas))
Date: Tue, 16 Feb 2010 14:28:38 -0000
Subject: [R-sig-Geo] rworldmap workshop Bristol March 8-9
Message-ID: <04A370231C10664C88B28D1EF74F487901873D08@LOWEXPRESS.corp.cefas.co.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100216/535c55c0/attachment.pl>

From andy.south at cefas.co.uk  Tue Feb 16 16:35:35 2010
From: andy.south at cefas.co.uk (Andy South (Cefas))
Date: Tue, 16 Feb 2010 15:35:35 -0000
Subject: [R-sig-Geo] better formatted rworldmap workshop Bristol March 8-9
Message-ID: <04A370231C10664C88B28D1EF74F487901873D0C@LOWEXPRESS.corp.cefas.co.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100216/5ba9f17f/attachment.pl>

From andrew.chapkowski at gmail.com  Tue Feb 16 16:50:47 2010
From: andrew.chapkowski at gmail.com (A. Chapkowski)
Date: Tue, 16 Feb 2010 10:50:47 -0500
Subject: [R-sig-Geo] Rpy with ArcMap or Spatial Data
Message-ID: <b99914441002160750r7c4288edv2a469f38148057a0@mail.gmail.com>

Are there any examples of RPy being used with ArcMap or any other
spatial software?

Thanks

A


From carson.farmer at gmail.com  Tue Feb 16 18:21:43 2010
From: carson.farmer at gmail.com (Carson Farmer)
Date: Tue, 16 Feb 2010 17:21:43 +0000
Subject: [R-sig-Geo] Rpy with ArcMap or Spatial Data
In-Reply-To: <94b3c8441002160920r229097d0v645763c57357259e@mail.gmail.com>
References: <b99914441002160750r7c4288edv2a469f38148057a0@mail.gmail.com>
	<94b3c8441002160920r229097d0v645763c57357259e@mail.gmail.com>
Message-ID: <94b3c8441002160921v5c58e18ci6d1c3fb85909b689@mail.gmail.com>

Hi Andrew,

Shameless self promotion:
Have a look at manageR (http://www.ftools.ca/manageR).
It is available within the 3rd party repositories in QGIS (the gis it
links with).
If you have any questions regarding dependencies and installation,
please don't hesitate to contact me off list.

Regards,

Carson


> On Tue, Feb 16, 2010 at 3:50 PM, A. Chapkowski
> <andrew.chapkowski at gmail.com> wrote:
>> Are there any examples of RPy being used with ArcMap or any other
>> spatial software?
>>
>> Thanks
>>
>> A
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Carson J. Q. Farmer
> ISSP Doctoral Fellow
> National Centre for Geocomputation
> National University of Ireland, Maynooth,
> http://www.carsonfarmer.com/
>



-- 
Carson J. Q. Farmer
ISSP Doctoral Fellow
National Centre for Geocomputation
National University of Ireland, Maynooth,
http://www.carsonfarmer.com/


From tylerdeanrudolph at gmail.com  Wed Feb 17 00:28:08 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Tue, 16 Feb 2010 18:28:08 -0500
Subject: [R-sig-Geo] Create SpatialLinesDataFrame
In-Reply-To: <alpine.LRH.2.00.1002160954040.8609@reclus.nhh.no>
References: <9fb1ae891002151642h2ccaf07fy186e70e4f0dbae03@mail.gmail.com> 
	<alpine.LRH.2.00.1002160954040.8609@reclus.nhh.no>
Message-ID: <9fb1ae891002161528j2a1a5764n8c0b3503ab390ab1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100216/d5d55e06/attachment.pl>

From mdsumner at gmail.com  Wed Feb 17 00:51:49 2010
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 17 Feb 2010 10:51:49 +1100
Subject: [R-sig-Geo] Create SpatialLinesDataFrame
In-Reply-To: <9fb1ae891002161528j2a1a5764n8c0b3503ab390ab1@mail.gmail.com>
References: <9fb1ae891002151642h2ccaf07fy186e70e4f0dbae03@mail.gmail.com>
	<alpine.LRH.2.00.1002160954040.8609@reclus.nhh.no>
	<9fb1ae891002161528j2a1a5764n8c0b3503ab390ab1@mail.gmail.com>
Message-ID: <522664f81002161551u486d59c5mac5fade4135b875c@mail.gmail.com>

>> flop<-Lines(Line(list(rbind(as.numeric(temp[1,7:8]),
> as.numeric(temp[1,9:10])))), ID=row.names(temp))
>> SpatialLines(flop)
> Error in as.list.default(X) :
>  no method for coercing this S4 class to a vector
>

You need to put "flop" in a list of its own, as SpatialLines is a
collection class that may contain more than one "Lines" (think of
multi-branched line sequences that may not be connected, but exist as
a single entity/feature - a "Line" is a matrix of a coordinates that
are connected in sequence, a "Lines" is a collection of those, and a
SpatialLines is a collection of Lines - each Lines will have a row in
the attribute table). So SpatialLines(list(flop)) should work.

See in my code how I start with a generic empty list, then populate it
with many Lines:

ranlines <- list()

for (irow in 1:nrow(temp)) {
       ranlines[[irow]] <- Lines(Line


> Why is this?  Also to export my SLDF as a shapefile I would normally use the
> following
>> writeSpatialShape(ranslines, "C:/GIS/ranslines")
>
> ...but this is different from what Michael has proposed.
>> writeOGR(sldf, ".", "ranlines", "ESRI Shapefile")
>
> Is one method better than the other?
>

I use the rgdal package as it was my first introduction to read/write
for GIS data in R, and it is very general. It can be hard to install
as there are 3rd-party dependencies even for the base package (very
easy on Windows with a binary/zip package), though when you compile
from source you have greater control and the potental for adding new
drivers (formats) over and above the base ones. There may be important
differences between the way shapefiles are written but it's personal
preference and ease of use/installation as far as I can see.

cheers, Mike.

On Wed, Feb 17, 2010 at 10:28 AM, Tyler Dean Rudolph
<tylerdeanrudolph at gmail.com> wrote:
> Much thanks to all for these useful and informative responses.
>
> I had come across the book in my searches but I had not stumbled onto its
> homepage with the additional resources Roger has provided, which are
> indispensable. ?Perhaps to circumvent the potential conflict of interest you
> could add a URL to your personal signature referring interested parties to a
> website containing information on your related books and projects? ?This to
> me seems entirely reasonable as it does not solicit interest, it merely
> provides access to that information.
>
> I realize that have a different way of accessing the package vignettes (or
> so I thought: http://cran.r-project.org/web/packages/sp/sp.pdf) so I haven't
> necessarily been working with all the available information either.
>
> I will keep Robert's handy conversion code nearby, which promises to make
> creating sp objects quick and easy.
>
> Thank you to Michael for his solution and encouragement. ?I gathered that
> the "ID" argument was critical to successfully passing the SpatialLines
> command. ?I considered doing a "for" loop, but when the following failed to
> work with one mere record I decided there was no solution there to be found.
>
>> flop<-Lines(Line(list(rbind(as.numeric(temp[1,7:8]),
> as.numeric(temp[1,9:10])))), ID=row.names(temp))
>> SpatialLines(flop)
> Error in as.list.default(X) :
> ?no method for coercing this S4 class to a vector
>
> Why is this? ?Also to export my SLDF as a shapefile I would normally use the
> following
>> writeSpatialShape(ranslines, "C:/GIS/ranslines")
>
> ...but this is different from what Michael has proposed.
>> writeOGR(sldf, ".", "ranlines", "ESRI Shapefile")
>
> Is one method better than the other?
>
> Tyler
>
>
> On Tue, Feb 16, 2010 at 4:06 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Mon, 15 Feb 2010, Tyler Dean Rudolph wrote:
>>
>> ?I have searched extensively for some good examples or documentation on how
>>> to create a SpatialLinesDataFrame and for the life of me have found zilch.
>>> This does not mean there is no such thing available, it just means that
>>> wherever it is it is not readily accessible through the circuitous
>>> pathways
>>> of R help documentation or via a simple web search.
>>>
>>
>> I have discussed with Achim Zeilis, who faces the same problem, the ethical
>> appropriateness of mentioning our book on the Spatial Task View, and we've
>> found until now that we shouldn't mention our own books. If opinion is that
>> we should, and because they are in a number of university libraries, I can
>> do that, and encourage Achim to do the same for Econometrics.
>>
>> If you visit the book website (http://www.asdar-book.org), you will find
>> links to code showing how to do this (chapter 2). In addition, under
>> "Additional materials", you find links to course materials, especially to a
>> course given at Imperial College in 2007, in which a good deal of these
>> questions are covered (see "Representing Spatial Data").
>>
>> Because the classes were designed as interface containers, most users do
>> not need to know how to construct them from scratch, typically reading in
>> data or coercing from other classes of objects. While the help pages could
>> certainly be improved, we do provide a vignette that ships with the package,
>> and where section 6 covers Line objects etc. See:
>>
>> http://cran.r-project.org/web/packages/sp/vignettes/sp.pdf
>>
>> or:
>>
>> vignette("sp", package="sp")
>>
>> in R.
>>
>> I'm sure that Mike's answer resolves your immediate problem - this is more
>> of an answer to your general question about where to look for information
>> about sp classes and how to make and use them.
>>
>> Hope this helps,
>>
>> Roger
>>
>> ?As someone who
>>> struggles daily to achieve highly technical things with scarcely the savvy
>>> required, I wish there were more (or any?) examples in the documentation
>>> for
>>> most of the spatial packages available. ?(I also wish that managing and
>>> manipulating Spatial objects was about 65% less complicated, but for the
>>> moment let's start with this)...
>>>
>>> I have a data.frame (temp) containing endpoints of animal trajectories
>>> with
>>> which I would like to create a SpatialLinesDataFrame for export into a
>>> GIS.
>>>
>>> ?temp
>>>>
>>> ? ? ?id ? ? ? ? ? ? ? ? day ? ? ? x ? ? ? ?y ? ? ? ?X2 ? ? ? Y2
>>> 1 2002007 2005-04-04 12:01:01 -300358 748992.6 -300450.8 748764.8
>>> 2 2002007 2005-04-04 12:01:01 -300358 748992.6 -301694.2 751728.4
>>> 3 2002007 2005-04-04 12:01:01 -300358 748992.6 -299983.1 749528.8
>>> 4 2002007 2005-04-04 12:01:01 -300358 748992.6 -300569.4 749640.7
>>> 5 2002007 2005-04-04 12:01:01 -300358 748992.6 -300439.0 748308.8
>>>
>>> I seem reasonably able to create a Lines object (though I can't get the ID
>>> argument to work for me where there are multiple records involved)....
>>>
>>> ?ranlines<-apply(temp, 1, ?function(x)
>>>>
>>> Lines(Line(list(rbind(as.numeric(x[7:8]), as.numeric(x[9:10]))))))
>>>
>>> ?str(ranlines[[1]])
>>>>
>>> Formal class 'Lines' [package "sp"] with 2 slots
>>> ?..@ Lines:List of 1
>>> ?.. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>>> ?.. .. .. ..@ coords: num [1:2, 1:2] -300358 -300451 748993 748765
>>> ?.. .. .. .. ..- attr(*, "dimnames")=List of 2
>>> ?.. .. .. .. .. ..$ : NULL
>>> ?.. .. .. .. .. ..$ : chr [1:2] "X1" "X2"
>>> ?..@ ID ? : chr NA
>>>
>>> Am I at least on the right track? ? Unfortunately now I'm clueless as to
>>> what to do next because apparently Lines cannot be coerced to
>>> SpatialLines,
>>> and while I am normally able to figure my way out of things there is just
>>> nothing intuitive about this as far as I can tell. ?I have tried to create
>>> SLDFs numerous times in the past and I have always been discouraged from
>>> continuing. ?I can create a psp object in Spatstat but I am equally unable
>>> to convert that into a SLDF shape. ?Terribly sorry about the rant but it's
>>> difficulties like these that prevent a lot of people more clueless than me
>>> from ever getting anywhere with R and more specifically the spatial
>>> stuff....
>>>
>>> Tyler
>>>
>>> ? ? ? ?[[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Adrian.Baddeley at csiro.au  Wed Feb 17 01:46:01 2010
From: Adrian.Baddeley at csiro.au (Adrian.Baddeley at csiro.au)
Date: Wed, 17 Feb 2010 08:46:01 +0800
Subject: [R-sig-Geo] Looking for a clustering indicator
Message-ID: <57DC18C299094D4299F837570C5DF1C52B0C2F6A17@EXWA-MBX01.nexus.csiro.au>

Etienne Bellemare Racine etiennebr at gmail.com<mailto:etiennebr at gmail.com> writes:

> I am looking for a way to tell how much clustered or not a process is
> (on a numeric scale). I've tried to test for CSR, but the result is too
> narrow as it only tell if the process is random and uniform inside a
> confidence interval. I would like to have an indicator going e.g. from
> random, to clustered, to very clustered. Do you know any way I could do
> that on a more than 3000 points pattern ?

> Maybe I've overlooked a simple CSR test, which could be interpreted to
> give a non-boolean answer ?
If I'm not mistaken, you are asking about spatial point pattern data. (So Moran's I is not applicable).

A hypothesis test is designed to give a yes/no answer. To get a measure of clustering, you need a summary statistic of some kind.

You could use the K-function or one of the other classical summary statistics (G-function, F-function etc). The values of these functions are indicators of the degree of clustering or regularity in the point pattern. Choose a particular distance r. Then K(r) suggests clustering if K(r) > pi * r^2 and suggests regularity if K(r) < pi * r^2. The value of K(r) is a measure of the degree of clustering or regularity. Similarly for the other summary functions.

I assume that you calculated envelopes of the K-function (for example) based on simulation from CSR, and plotted these together with the estimated K-function from the data point pattern. This is equivalent to a hypothesis test (it is NOT equivalent to a confidence interval). The test statistic is the rank of the observed value of K(r) amongst the simulated values of K(r). You could use this rank as a measure of clustering or repulsion.

However the most precise way to get an estimate of the degree of clustering is to fit a model to the data, and use the  value of an appropriate parameter in the model. For example, computing K(r) is equivalent to fitting a Strauss point process model with interaction range r. The interaction parameter 'gamma' of the Strauss process is a measure of the degree of regularity. There are many other models you could use. The Geyer saturation model allows both clustering and regularity. The interaction parameter 'gamma' of the Geyer model ranges from 0 to infinity with gamma < 1 indicating regularity and gamma > 1 indicating clustering.

In the package 'spatstat' you can fit the Strauss process model with r=0.2 to a point pattern dataset X by typing
      fit <- ppm(X, ~1, Strauss(0.2))
Then printing 'fit' gives the interaction parameter gamma.

For more information please read the spatstat workshop notes www.csiro.au/resources/pf16h.html<http://www.csiro.au/resources/pf16h.html>

Adrian Baddeley


From Roger.Bivand at nhh.no  Wed Feb 17 08:25:56 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 17 Feb 2010 08:25:56 +0100 (CET)
Subject: [R-sig-Geo] Create SpatialLinesDataFrame
In-Reply-To: <522664f81002161551u486d59c5mac5fade4135b875c@mail.gmail.com>
References: <9fb1ae891002151642h2ccaf07fy186e70e4f0dbae03@mail.gmail.com>
	<alpine.LRH.2.00.1002160954040.8609@reclus.nhh.no>
	<9fb1ae891002161528j2a1a5764n8c0b3503ab390ab1@mail.gmail.com>
	<522664f81002161551u486d59c5mac5fade4135b875c@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002170823120.12191@reclus.nhh.no>

On Wed, 17 Feb 2010, Michael Sumner wrote:

>>> flop<-Lines(Line(list(rbind(as.numeric(temp[1,7:8]),
>> as.numeric(temp[1,9:10])))), ID=row.names(temp))

I think that there is a misplacement too:

flop <- Lines(list(Line(rbind(as.numeric(temp[1,7:8]),
   as.numeric(temp[1,9:10])))), ID=row.names(temp))

looks better - Lines() takes a list of Line objects as its first argument.

Roger

>>> SpatialLines(flop)
>> Error in as.list.default(X) :
>>  no method for coercing this S4 class to a vector
>>
>
> You need to put "flop" in a list of its own, as SpatialLines is a
> collection class that may contain more than one "Lines" (think of
> multi-branched line sequences that may not be connected, but exist as
> a single entity/feature - a "Line" is a matrix of a coordinates that
> are connected in sequence, a "Lines" is a collection of those, and a
> SpatialLines is a collection of Lines - each Lines will have a row in
> the attribute table). So SpatialLines(list(flop)) should work.
>
> See in my code how I start with a generic empty list, then populate it
> with many Lines:
>
> ranlines <- list()
>
> for (irow in 1:nrow(temp)) {
>       ranlines[[irow]] <- Lines(Line
>
>
>> Why is this?  Also to export my SLDF as a shapefile I would normally use the
>> following
>>> writeSpatialShape(ranslines, "C:/GIS/ranslines")
>>
>> ...but this is different from what Michael has proposed.
>>> writeOGR(sldf, ".", "ranlines", "ESRI Shapefile")
>>
>> Is one method better than the other?
>>
>
> I use the rgdal package as it was my first introduction to read/write
> for GIS data in R, and it is very general. It can be hard to install
> as there are 3rd-party dependencies even for the base package (very
> easy on Windows with a binary/zip package), though when you compile
> from source you have greater control and the potental for adding new
> drivers (formats) over and above the base ones. There may be important
> differences between the way shapefiles are written but it's personal
> preference and ease of use/installation as far as I can see.
>
> cheers, Mike.
>
> On Wed, Feb 17, 2010 at 10:28 AM, Tyler Dean Rudolph
> <tylerdeanrudolph at gmail.com> wrote:
>> Much thanks to all for these useful and informative responses.
>>
>> I had come across the book in my searches but I had not stumbled onto its
>> homepage with the additional resources Roger has provided, which are
>> indispensable. ?Perhaps to circumvent the potential conflict of interest you
>> could add a URL to your personal signature referring interested parties to a
>> website containing information on your related books and projects? ?This to
>> me seems entirely reasonable as it does not solicit interest, it merely
>> provides access to that information.
>>
>> I realize that have a different way of accessing the package vignettes (or
>> so I thought: http://cran.r-project.org/web/packages/sp/sp.pdf) so I haven't
>> necessarily been working with all the available information either.
>>
>> I will keep Robert's handy conversion code nearby, which promises to make
>> creating sp objects quick and easy.
>>
>> Thank you to Michael for his solution and encouragement. ?I gathered that
>> the "ID" argument was critical to successfully passing the SpatialLines
>> command. ?I considered doing a "for" loop, but when the following failed to
>> work with one mere record I decided there was no solution there to be found.
>>
>>> flop<-Lines(Line(list(rbind(as.numeric(temp[1,7:8]),
>> as.numeric(temp[1,9:10])))), ID=row.names(temp))
>>> SpatialLines(flop)
>> Error in as.list.default(X) :
>> ?no method for coercing this S4 class to a vector
>>
>> Why is this? ?Also to export my SLDF as a shapefile I would normally use the
>> following
>>> writeSpatialShape(ranslines, "C:/GIS/ranslines")
>>
>> ...but this is different from what Michael has proposed.
>>> writeOGR(sldf, ".", "ranlines", "ESRI Shapefile")
>>
>> Is one method better than the other?
>>
>> Tyler
>>
>>
>> On Tue, Feb 16, 2010 at 4:06 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>>> On Mon, 15 Feb 2010, Tyler Dean Rudolph wrote:
>>>
>>> ?I have searched extensively for some good examples or documentation on how
>>>> to create a SpatialLinesDataFrame and for the life of me have found zilch.
>>>> This does not mean there is no such thing available, it just means that
>>>> wherever it is it is not readily accessible through the circuitous
>>>> pathways
>>>> of R help documentation or via a simple web search.
>>>>
>>>
>>> I have discussed with Achim Zeilis, who faces the same problem, the ethical
>>> appropriateness of mentioning our book on the Spatial Task View, and we've
>>> found until now that we shouldn't mention our own books. If opinion is that
>>> we should, and because they are in a number of university libraries, I can
>>> do that, and encourage Achim to do the same for Econometrics.
>>>
>>> If you visit the book website (http://www.asdar-book.org), you will find
>>> links to code showing how to do this (chapter 2). In addition, under
>>> "Additional materials", you find links to course materials, especially to a
>>> course given at Imperial College in 2007, in which a good deal of these
>>> questions are covered (see "Representing Spatial Data").
>>>
>>> Because the classes were designed as interface containers, most users do
>>> not need to know how to construct them from scratch, typically reading in
>>> data or coercing from other classes of objects. While the help pages could
>>> certainly be improved, we do provide a vignette that ships with the package,
>>> and where section 6 covers Line objects etc. See:
>>>
>>> http://cran.r-project.org/web/packages/sp/vignettes/sp.pdf
>>>
>>> or:
>>>
>>> vignette("sp", package="sp")
>>>
>>> in R.
>>>
>>> I'm sure that Mike's answer resolves your immediate problem - this is more
>>> of an answer to your general question about where to look for information
>>> about sp classes and how to make and use them.
>>>
>>> Hope this helps,
>>>
>>> Roger
>>>
>>> ?As someone who
>>>> struggles daily to achieve highly technical things with scarcely the savvy
>>>> required, I wish there were more (or any?) examples in the documentation
>>>> for
>>>> most of the spatial packages available. ?(I also wish that managing and
>>>> manipulating Spatial objects was about 65% less complicated, but for the
>>>> moment let's start with this)...
>>>>
>>>> I have a data.frame (temp) containing endpoints of animal trajectories
>>>> with
>>>> which I would like to create a SpatialLinesDataFrame for export into a
>>>> GIS.
>>>>
>>>> ?temp
>>>>>
>>>> ? ? ?id ? ? ? ? ? ? ? ? day ? ? ? x ? ? ? ?y ? ? ? ?X2 ? ? ? Y2
>>>> 1 2002007 2005-04-04 12:01:01 -300358 748992.6 -300450.8 748764.8
>>>> 2 2002007 2005-04-04 12:01:01 -300358 748992.6 -301694.2 751728.4
>>>> 3 2002007 2005-04-04 12:01:01 -300358 748992.6 -299983.1 749528.8
>>>> 4 2002007 2005-04-04 12:01:01 -300358 748992.6 -300569.4 749640.7
>>>> 5 2002007 2005-04-04 12:01:01 -300358 748992.6 -300439.0 748308.8
>>>>
>>>> I seem reasonably able to create a Lines object (though I can't get the ID
>>>> argument to work for me where there are multiple records involved)....
>>>>
>>>> ?ranlines<-apply(temp, 1, ?function(x)
>>>>>
>>>> Lines(Line(list(rbind(as.numeric(x[7:8]), as.numeric(x[9:10]))))))
>>>>
>>>> ?str(ranlines[[1]])
>>>>>
>>>> Formal class 'Lines' [package "sp"] with 2 slots
>>>> ?..@ Lines:List of 1
>>>> ?.. ..$ :Formal class 'Line' [package "sp"] with 1 slots
>>>> ?.. .. .. ..@ coords: num [1:2, 1:2] -300358 -300451 748993 748765
>>>> ?.. .. .. .. ..- attr(*, "dimnames")=List of 2
>>>> ?.. .. .. .. .. ..$ : NULL
>>>> ?.. .. .. .. .. ..$ : chr [1:2] "X1" "X2"
>>>> ?..@ ID ? : chr NA
>>>>
>>>> Am I at least on the right track? ? Unfortunately now I'm clueless as to
>>>> what to do next because apparently Lines cannot be coerced to
>>>> SpatialLines,
>>>> and while I am normally able to figure my way out of things there is just
>>>> nothing intuitive about this as far as I can tell. ?I have tried to create
>>>> SLDFs numerous times in the past and I have always been discouraged from
>>>> continuing. ?I can create a psp object in Spatstat but I am equally unable
>>>> to convert that into a SLDF shape. ?Terribly sorry about the rant but it's
>>>> difficulties like these that prevent a lot of people more clueless than me
>>>> from ever getting anywhere with R and more specifically the spatial
>>>> stuff....
>>>>
>>>> Tyler
>>>>
>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>> --
>>> Roger Bivand
>>> Economic Geography Section, Department of Economics, Norwegian School of
>>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>>
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From tylerdeanrudolph at gmail.com  Wed Feb 17 15:49:19 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Wed, 17 Feb 2010 09:49:19 -0500
Subject: [R-sig-Geo] compute buffer from point shapefile to have
	shapefile
Message-ID: <9fb1ae891002170649t490bf113s26ac3e493ed2cd83@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100217/1e3a5d56/attachment.pl>

From cc157 at duke.edu  Wed Feb 17 17:00:06 2010
From: cc157 at duke.edu (Corrie Curtice)
Date: Wed, 17 Feb 2010 11:00:06 -0500
Subject: [R-sig-Geo] Calculate location given observation distance and angle
	from transect line
Message-ID: <33debc421002170800x4c0f9eb3ic8fa235b51737255@mail.gmail.com>

Hello,

I've turned up little in searching for a package that already has this
function.  Dspat is close but I don't think it does quite what I want.

I have observation data gathered from a ship transect doing a zig-zag
pattern.  I have the current location of the ship, the ship's bearing,
the angle from the transect to the sighting, and the observed distance
to the sighting (and the height of the observer above water).  Is
there already a package/function in R that will "easily" convert this
information to the lat/lon of the observed animal?

Thanks for any help or guidance.

Corrie

---
Corrie Curtice
Research Associate
Marine Geospatial Ecology Lab
Nicholas School of the Environment, Duke University
http://mgel.env.duke.edu
em: corrie.curtice at duke.edu


From Roger.Bivand at nhh.no  Wed Feb 17 17:53:49 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 17 Feb 2010 17:53:49 +0100 (CET)
Subject: [R-sig-Geo] compute buffer from point shapefile to have
 shapefile
In-Reply-To: <9fb1ae891002170649t490bf113s26ac3e493ed2cd83@mail.gmail.com>
References: <9fb1ae891002170649t490bf113s26ac3e493ed2cd83@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002171751540.13466@reclus.nhh.no>

On Wed, 17 Feb 2010, Tyler Dean Rudolph wrote:

> Here is another way to compute buffered polygons around points:
>
> ## One record (point) at a time (buffer of 25m radius)
>> temp
>        x        y
> 1 -300358 748992.6
>
> library(spatstat)
> discbuff<-disc(radius=25, centre=c(temp$x, temp$y))

Note that from here you can use the coerce method in maptools:

polybuff <- as(discbuff, "SpatialPolygons")

There are many coercion methods in maptools for sp and spatstat classes.

Hope this simplifies!

Roger

>
> library(sp)
> polybuff<-SpatialPolygons(list(Polygons(list(Polygon(rbind(cbind(discbuff$bdry[[1]]$x,
> y=discbuff$bdry[[1]]$y), c(discbuff$bdry[[1]]$x[1],
> y=discbuff$bdry[[1]]$y[1])))), ID=row.names(temp))))
> plot(polybuff)
> points(temp, col="red")
>
> ## Numerous records (points) at once (buffer of 25m radius)
>> temp
>           x        y
> 1  -300358.0 748992.6
> 7  -300450.8 748764.8
> 13 -300415.1 748865.8
> 19 -300504.5 748698.4
> 25 -300488.4 748460.1
>
> polys<-list()
> for(i in 1:nrow(temp)) {
>  discbuff<-disc(radius=25, centre=c(temp$x[i], temp$y[i]))
>     discpoly<-Polygon(rbind(cbind(discbuff$bdry[[1]]$x,
> y=discbuff$bdry[[1]]$y), c(discbuff$bdry[[1]]$x[1],
> y=discbuff$bdry[[1]]$y[1])))
>     polys<-c(polys, discpoly)
> }
>
> spolys<-list()
> for(i in 1:length(polys)) {
>  spolybuff<-Polygons(list(polys[[i]]), ID=row.names(temp)[i])
>  spolys<-c(spolys, spolybuff)
> }
>
> polybuffs<-SpatialPolygons(spolys)
>
> plot(polybuffs)
> points(temp, col="red")
>
> Tyler
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From r.hijmans at gmail.com  Wed Feb 17 18:11:00 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 17 Feb 2010 09:11:00 -0800
Subject: [R-sig-Geo] Calculate location given observation distance and
	angle from transect line
In-Reply-To: <33debc421002170800x4c0f9eb3ic8fa235b51737255@mail.gmail.com>
References: <33debc421002170800x4c0f9eb3ic8fa235b51737255@mail.gmail.com>
Message-ID: <dc22b2571002170911p3dba37c1xe11afca5d378f3f@mail.gmail.com>

Corrie:

I think you can use the function 'destPoint' in 'geosphere', It
computes (for longitude/latitude coordinate data) the coordinates of a
destination point given a start point, initial bearing, and distance.

Robert

On Wed, Feb 17, 2010 at 8:00 AM, Corrie Curtice <cc157 at duke.edu> wrote:
> Hello,
>
> I've turned up little in searching for a package that already has this
> function. ?Dspat is close but I don't think it does quite what I want.
>
> I have observation data gathered from a ship transect doing a zig-zag
> pattern. ?I have the current location of the ship, the ship's bearing,
> the angle from the transect to the sighting, and the observed distance
> to the sighting (and the height of the observer above water). ?Is
> there already a package/function in R that will "easily" convert this
> information to the lat/lon of the observed animal?
>
> Thanks for any help or guidance.
>
> Corrie
>
> ---
> Corrie Curtice
> Research Associate
> Marine Geospatial Ecology Lab
> Nicholas School of the Environment, Duke University
> http://mgel.env.duke.edu
> em: corrie.curtice at duke.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From tylerdeanrudolph at gmail.com  Wed Feb 17 19:17:20 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Wed, 17 Feb 2010 13:17:20 -0500
Subject: [R-sig-Geo] Merge polygons
Message-ID: <9fb1ae891002171017n68d9a047ta0810535a3920ca0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100217/04951cc8/attachment.pl>

From r.hijmans at gmail.com  Wed Feb 17 19:39:22 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 17 Feb 2010 10:39:22 -0800
Subject: [R-sig-Geo] Merge polygons
In-Reply-To: <9fb1ae891002171017n68d9a047ta0810535a3920ca0@mail.gmail.com>
References: <9fb1ae891002171017n68d9a047ta0810535a3920ca0@mail.gmail.com>
Message-ID: <dc22b2571002171039u229d364dp5f3e41ec63d53dd1@mail.gmail.com>

Hi Tyler,

Your example would have been more easily reproducible if it had
started with something like:

temp = list(x=-300358, y=748992.6,  X2=-300450.8,  Y2=748764.8)
library(spatstat)
...

library(maptools)
union = unionSpatialPolygons(polybuffs, ID=rep(1,
times=length(polybuffs at polygons)) )
plot(union)

# then perhaps:
library(raster)
polygonValues(union, raster)

Robert


On Wed, Feb 17, 2010 at 10:17 AM, Tyler Dean Rudolph
<tylerdeanrudolph at gmail.com> wrote:
> I've been attempting for many moons to develop a function which will allow
> me to place a buffer of adjustable radius around an animal's movement
> trajectory with which I may extract underlying pixel values from a raster of
> environmental data. ?I would like to be able to extract the habitat values
> using read functions in the raster package as I have tens of thousands of
> observations (trajectories) and importing or cropping images is much too
> demanding on time and processing.
>
> One fairly intuitive solution is to create circular buffers around points
> along each trajectory, thus creating the buffered trajectory with which I
> can interpolate the raster values. ?This is fairly simple and looks good:
>
>> temp
> ? ? ? ?x ? ? ? ?y ? ? ? ?X2 ? ? ? Y2
> 1 -300358 748992.6 -300450.8 748764.8
>
> xran<-range(c(temp$x, temp$X)-500, c(temp$x, temp$X)+500)
> ?yran<-range(c(temp$y, temp$Y)-500, c(temp$y, temp$Y)+500)
> ?subwin<-owin(xrange=xran, yrange=yran)
> ?traj<-pointsOnLines(psp(temp$x, temp$y, temp$X, temp$Y, subwin), eps=12)
> ?polys<-list()
> ? ?for(i in 1:length(traj$x)) {
> ? ? discbuff<-disc(radius=25, centre=c(traj$x[i], traj$y[i]))
> ? ? discpoly<-Polygon(rbind(cbind(discbuff$bdry[[1]]$x,
> y=discbuff$bdry[[1]]$y), c(discbuff$bdry[[1]]$x[1],
> y=discbuff$bdry[[1]]$y[1])))
> ? ? polys<-c(polys, discpoly)
> ? ?}
> ?spolys<-list()
> ? ?for(i in 1:length(polys)) {
> ? ? ?polybuff<-Polygons(list(polys[[i]]), ID=i)
> ? ? ?spolys<-c(spolys, polybuff)
> ?}
> polybuffs<-SpatialPolygons(spolys)
>
> plot(polybuffs)
>
> ...but is there a way now to merge all these circles into one polygon? ?I'm
> afraid I haven't found it yet yet.
>
> Likewise if there are other methods folks can suggest that would accomplish
> the same goal I am all ears.
>
> Tyler
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From tylerdeanrudolph at gmail.com  Thu Feb 18 02:39:22 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Wed, 17 Feb 2010 20:39:22 -0500
Subject: [R-sig-Geo] Prevent minor discrepancy in pixel resolution using
	Spatstat
Message-ID: <9fb1ae891002171739m230dd3cdp5f06c61ccc8613c0@mail.gmail.com>

When I specify eps=25 (m resolution) in a call to distmap...

> library(spatstat)
> temp <- data.frame(x=-670049.2, y=752814.6,  X2=-669961.9,  Y2=752648.2)
>        subwin<-owin(xrange=c(-100, 100) + sort(c(temp$x, temp$X2)),
yrange=c(-100, 100) + sort(c(temp$y, temp$Y2)))
>        trajpsp<-psp(temp$x,temp$y, temp$X2, temp$Y2, subwin, check=TRUE)
>        plot(trajmap<-distmap(trajpsp, eps=25))
> trajmap$xstep
[1] 23.94167
> trajmap$ystep
[1] 24.42667

...The resulting resolution is slightly different than 25x25 metres.  So now
when I use it as a mask:
>        trajmap$v<-ifelse(trajmap$v>50, 0, 1)
> library(maptools)

...and convert it to a RasterLayer for matrix algebra with another raster
> trajrast<-raster(as.SpatialGridDataFrame.im(from=trajmap))
> tempmap<-crop(habmap, extent(trajrast)) # tempmap.grd is attached
> top<-table(getValues(tempmap*trajrast))
Error in compare(c(e1, e2)) : Different bounding box
Error in getValues(tempmap * trajrast) :
  error in evaluating the argument 'x' in selecting a method for function
'getValues'

...it doesn't work because the resolution is not exactly equal.  Now I can
sometimes trick it when the number of rows and cells are still equal, BUT...
extent(trajrast)<-extent(tempmap)
> top<-table(getValues(tempmap*trajrast))
Error in compare(c(e1, e2)) : nrows different
Error in getValues(tempmap * trajrast) :
  error in evaluating the argument 'x' in selecting a method for function
'getValues'

...This is not always the case!

How can I prevent the numbers of rows and columns from being so slightly
different because of a minor different in resolution?  Otherwise put, how
can I make the actual resolution of my distmap image exactly 25m as desired?

Tyler
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100217/d87eca10/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tempmap.grd
Type: application/octet-stream
Size: 596 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100217/d87eca10/attachment.obj>

From sjmyers at syr.edu  Thu Feb 18 04:24:54 2010
From: sjmyers at syr.edu (Seth J Myers)
Date: Thu, 18 Feb 2010 03:24:54 +0000
Subject: [R-sig-Geo] spatial regression for large data sets
Message-ID: <266CBFBFD14254478D52158AE6BF9017051E5B30@BL2PRD0103MB038.prod.exchangelabs.com>

Hi everyone,

I'm trying to model a binary response using logistic regression for a large data set with spatial autocorrelation issues.  The mixed models in SAS and R that can include spatially correlated errors cannot handle the large NxN matrix needed for their methods.  Past around 700 meters, spatial autocorrelation is negligible.  So, it seems that a sparse matrix with zeros for pairs of observations separated by > 700 meters would help.  I've been searching and not found a way to implement this in R using established packages.  Any advice on methods to try for a large data set with spatial autocorrelation is welcome.  I'm currently reading to see if generalized estimating equations or some of the detrended krigging fuctions may help.  If I sample systematically with a 700 m distance, I will lose substantial information and so would like to avoid this. Thanks, Seth

From brenning at uwaterloo.ca  Thu Feb 18 04:49:20 2010
From: brenning at uwaterloo.ca (Alexander Brenning)
Date: Wed, 17 Feb 2010 22:49:20 -0500
Subject: [R-sig-Geo] Rpy with ArcMap or Spatial Data
In-Reply-To: <b99914441002160750r7c4288edv2a469f38148057a0@mail.gmail.com>
References: <b99914441002160750r7c4288edv2a469f38148057a0@mail.gmail.com>
Message-ID: <4B7CB8C0.5050308@uwaterloo.ca>

Hi,

there is an ArcGIS toolbox written by Mark Janikas from ESRI that links 
ArcGIS/ArcMap/ArcCatalog with R through Python. This is more like a 
proof-of-principle, it allows to access a point clustering method from R 
from within ArcGIS. Don't ask me for the details, but at least one of 
the two alternative approaches used is based on RPy.

http://resources.esri.com/geoprocessing/index.cfm?fa=codeGalleryDetails&
scriptId=16444

On the other hand, the RPyGeo package for R uses Python (but not RPy!) 
to call ArcGIS tools from within R. Sort of a basic ArcGIS front-end in 
R, but it suffers from the long latency time of ArcGIS.

Cheers
  Alex


On 16/02/2010 10:50 AM, A. Chapkowski wrote:
> Are there any examples of RPy being used with ArcMap or any other
> spatial software?
>
> Thanks
>
> A
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Alexander Brenning
brenning at uwaterloo.ca - T +1-519-888-4567 ext 35783
Department of Geography and Environmental Management
University of Waterloo
200 University Ave. W - Waterloo, ON - Canada N2L 3G1
http://www.fes.uwaterloo.ca/geography/faculty/brenning/


From Roger.Bivand at nhh.no  Thu Feb 18 08:01:17 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Feb 2010 08:01:17 +0100 (CET)
Subject: [R-sig-Geo] Rpy with ArcMap or Spatial Data
In-Reply-To: <4B7CB8C0.5050308@uwaterloo.ca>
References: <b99914441002160750r7c4288edv2a469f38148057a0@mail.gmail.com>
	<4B7CB8C0.5050308@uwaterloo.ca>
Message-ID: <alpine.LRH.2.00.1002180757170.16439@reclus.nhh.no>

On Wed, 17 Feb 2010, Alexander Brenning wrote:

> Hi,
>
> there is an ArcGIS toolbox written by Mark Janikas from ESRI that links 
> ArcGIS/ArcMap/ArcCatalog with R through Python. This is more like a 
> proof-of-principle, it allows to access a point clustering method from R from 
> within ArcGIS. Don't ask me for the details, but at least one of the two 
> alternative approaches used is based on RPy.
>
> http://resources.esri.com/geoprocessing/index.cfm?fa=codeGalleryDetails&
> scriptId=16444
>
> On the other hand, the RPyGeo package for R uses Python (but not RPy!) to 
> call ArcGIS tools from within R. Sort of a basic ArcGIS front-end in R, but 
> it suffers from the long latency time of ArcGIS.

I have posted references to MGET before:

http://pypi.python.org/pypi/GeoEco/0.6

but for me http://code.env.duke.edu/projects/mget/ is not responding now. 
There was plenty of code there, but I think using DCOM through Python 
rather than Rpy (or better Rpy2). Carson Farmer's Qgis plugin manageR does 
run through Rpy2, and so is a cross-platform interface. Using DCOM for 
ArcGIS does make some sense, as ArcGIS is most frequently found on 
platforms running DCOM.

Roger


>
> Cheers
> Alex
>
>
> On 16/02/2010 10:50 AM, A. Chapkowski wrote:
>> Are there any examples of RPy being used with ArcMap or any other
>> spatial software?
>> 
>> Thanks
>> 
>> A
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Thu Feb 18 08:41:46 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Feb 2010 08:41:46 +0100 (CET)
Subject: [R-sig-Geo] Prevent minor discrepancy in pixel resolution using
 Spatstat
In-Reply-To: <9fb1ae891002171739m230dd3cdp5f06c61ccc8613c0@mail.gmail.com>
References: <9fb1ae891002171739m230dd3cdp5f06c61ccc8613c0@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002180813130.16439@reclus.nhh.no>

On Wed, 17 Feb 2010, Tyler Dean Rudolph wrote:

> When I specify eps=25 (m resolution) in a call to distmap...
>
>> library(spatstat)
>> temp <- data.frame(x=-670049.2, y=752814.6,  X2=-669961.9,  Y2=752648.2)
>>        subwin<-owin(xrange=c(-100, 100) + sort(c(temp$x, temp$X2)),
> yrange=c(-100, 100) + sort(c(temp$y, temp$Y2)))
>>        trajpsp<-psp(temp$x,temp$y, temp$X2, temp$Y2, subwin, check=TRUE)
>>        plot(trajmap<-distmap(trajpsp, eps=25))
>> trajmap$xstep
> [1] 23.94167
>> trajmap$ystep
> [1] 24.42667
>
> ...The resulting resolution is slightly different than 25x25 metres.

I think that you are seeing the impact of your input window not being 
exactly divisible by your eps in as.mask() and then getting nr and nc that 
do not partition the x and y ranges into discrete 25m blocks, because of 
ceiling().

             if (!is.null(eps)) {
                 nr <- ceiling(diff(w$yrange)/eps)
                 nc <- ceiling(diff(w$xrange)/eps)
             }

Browse[2]> nr
[1] 15
Browse[2]> nc
[1] 12

With:

subwin<-owin(xrange=c(-100, 110+2.7) + sort(c(temp$x, temp$X2)),
  yrange=c(-100, 90+18.6) + sort(c(temp$y, temp$Y2)))

you get something like what you want, with a lot of fiddling. Have you 
considered not setting eps, using spatstat.options("npixel") to set nr and 
nc, and tailoring the window to suit 25m (yrange == eps*nr, etc.). If you 
know the xrange, yrange of the raster you want to compare with, maybe use 
that as the source for the window, spatstat.options("npixel") to feed 
through nr and nc, then you could fix eps indirectly?

Hope this helps,

Roger


> So now when I use it as a mask:
>>        trajmap$v<-ifelse(trajmap$v>50, 0, 1)
>> library(maptools)
>
> ...and convert it to a RasterLayer for matrix algebra with another raster
>> trajrast<-raster(as.SpatialGridDataFrame.im(from=trajmap))
>> tempmap<-crop(habmap, extent(trajrast)) # tempmap.grd is attached
>> top<-table(getValues(tempmap*trajrast))
> Error in compare(c(e1, e2)) : Different bounding box
> Error in getValues(tempmap * trajrast) :
>  error in evaluating the argument 'x' in selecting a method for function
> 'getValues'
>
> ...it doesn't work because the resolution is not exactly equal.  Now I can
> sometimes trick it when the number of rows and cells are still equal, BUT...
> extent(trajrast)<-extent(tempmap)
>> top<-table(getValues(tempmap*trajrast))
> Error in compare(c(e1, e2)) : nrows different
> Error in getValues(tempmap * trajrast) :
>  error in evaluating the argument 'x' in selecting a method for function
> 'getValues'
>
> ...This is not always the case!
>
> How can I prevent the numbers of rows and columns from being so slightly
> different because of a minor different in resolution?  Otherwise put, how
> can I make the actual resolution of my distmap image exactly 25m as desired?
>
> Tyler
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From nikhil.list at gmail.com  Thu Feb 18 13:49:58 2010
From: nikhil.list at gmail.com (Nikhil Kaza)
Date: Thu, 18 Feb 2010 07:49:58 -0500
Subject: [R-sig-Geo] Neighborhood weights spam matrix
Message-ID: <FC817941-6BBA-4258-AD56-E403A6289D83@gmail.com>

Hello,

I am not sure if this is the right forum to ask as this is mostly a  
sparse matrix question, nevertheless here it is.

I am using R - 2.10.1 and spdep 0.4-54 on Windows Vista

I have a large shapefile for which I need to create a neighborhood  
matrix file, I used the following command to create a neighborhood  
matrix

shp_file <- readShapePoly(file.choose())
grid_nb_mat <- as.spam.listw(nb2listw(poly2nb(shp_file,  
row.names=shp_file$CELL_ID)))

Now I would like to subset this matrix based on a subset of the  
shapefile and I have a vector of CELL_IDs. However, I cannot figure  
out a way to assign row and column names to grid_nb_mat, so that I can  
subset this matrix. Could someone point me in the right direction? If  
it is were a simple matrix row.names and colnames would work.

regards
Nikhil


From Roger.Bivand at nhh.no  Thu Feb 18 14:36:57 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Feb 2010 14:36:57 +0100 (CET)
Subject: [R-sig-Geo] Neighborhood weights spam matrix
In-Reply-To: <FC817941-6BBA-4258-AD56-E403A6289D83@gmail.com>
References: <FC817941-6BBA-4258-AD56-E403A6289D83@gmail.com>
Message-ID: <alpine.LRH.2.00.1002181422420.17260@reclus.nhh.no>

On Thu, 18 Feb 2010, Nikhil Kaza wrote:

> Hello,
>
> I am not sure if this is the right forum to ask as this is mostly a sparse 
> matrix question, nevertheless here it is.
>
> I am using R - 2.10.1 and spdep 0.4-54 on Windows Vista
>
> I have a large shapefile for which I need to create a neighborhood matrix 
> file, I used the following command to create a neighborhood matrix
>
> shp_file <- readShapePoly(file.choose())
> grid_nb_mat <- as.spam.listw(nb2listw(poly2nb(shp_file, 
> row.names=shp_file$CELL_ID)))
>
> Now I would like to subset this matrix based on a subset of the shapefile and 
> I have a vector of CELL_IDs. However, I cannot figure out a way to assign row 
> and column names to grid_nb_mat, so that I can subset this matrix. Could 
> someone point me in the right direction? If it is were a simple matrix 
> row.names and colnames would work.

If you had saved the output of poly2nb as an nb object, you could have 
used the subset method for that class. You are using default row 
standardisation in the nb2listw() step, so only subsetting grid_nb_mat - 
by using "[" with keep vectors:

keep <- which(shp_file$CELL_ID "... to keep")

kgrid_nb_mat <- grid_nb_mat[keep, keep]

will not have correct row sums. str(grid_nb_mat) shows no row or column 
names stored (probably to save space). If possible start again from 
poly2nb() and save the output object. Otherwise:

example(columbus)
col.listw <- nb2listw(col.gal.nb)
col.sp <- as.spam.listw(col.listw)
str(col.sp)
keep <- c(1:20, 25:40)
kcol.sp <- col.sp[keep, keep]
apply(kcol.sp, 1, sum)
str(kcol.sp)
kcol.sp at entries <- rep(1, 150)
apply(kcol.sp, 1, sum)
rsum <- apply(kcol.sp, 1, sum)
kkcol.sp <- diag.spam(1/rsum) %*% kcol.sp
apply(kkcol.sp, 1, sum)

Roger

>
> regards
> Nikhil
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From nikhil.list at gmail.com  Thu Feb 18 19:33:02 2010
From: nikhil.list at gmail.com (nikhil kaza)
Date: Thu, 18 Feb 2010 13:33:02 -0500
Subject: [R-sig-Geo] Neighborhood weights spam matrix
In-Reply-To: <alpine.LRH.2.00.1002181422420.17260@reclus.nhh.no>
References: <FC817941-6BBA-4258-AD56-E403A6289D83@gmail.com>
	<alpine.LRH.2.00.1002181422420.17260@reclus.nhh.no>
Message-ID: <642b93e21002181033h3cc8370cub0c5b2ded4b2b445@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100218/301521dc/attachment.pl>

From gianni.lavaredo at gmail.com  Thu Feb 18 22:40:38 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Thu, 18 Feb 2010 22:40:38 +0100
Subject: [R-sig-Geo] suggestion to imrpove: Generating Random Transects of
	Same Length (by marcelino de la cruz)
Message-ID: <518dff331002181340q222b2dcte7ae485a1dab4083@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100218/27cd622a/attachment.pl>

From tylerdeanrudolph at gmail.com  Thu Feb 18 23:01:19 2010
From: tylerdeanrudolph at gmail.com (Tyler Dean Rudolph)
Date: Thu, 18 Feb 2010 17:01:19 -0500
Subject: [R-sig-Geo] Prevent minor discrepancy in pixel resolution using
	Spatstat
In-Reply-To: <alpine.LRH.2.00.1002180813130.16439@reclus.nhh.no>
References: <9fb1ae891002171739m230dd3cdp5f06c61ccc8613c0@mail.gmail.com> 
	<alpine.LRH.2.00.1002180813130.16439@reclus.nhh.no>
Message-ID: <9fb1ae891002181401y3a54614er3d4693dd85215b3b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100218/8386859e/attachment.pl>

From csoykan at mail.sdsu.edu  Fri Feb 19 06:15:04 2010
From: csoykan at mail.sdsu.edu (csoykan at mail.sdsu.edu)
Date: Thu, 18 Feb 2010 21:15:04 -0800 (PST)
Subject: [R-sig-Geo] Bayesian Block Kriging?
Message-ID: <20100218211504.CYJ41976@mail.sdsu.edu>

Hello,
    I'm interested in doing Bayesian kriging using R.  I see that the package geoR has a function that will allow one to do this (krige.bayes).  However, my data are not in the form of points, but rather they are blocks that represent spatial averages (i.e., the number of fishing hooks per month in a given lat x long square).  I am therefore interested in treating the data as spatial blocks, rather than points.  I see that package gstat has a function that will allow one to
do block kriging (krige).  However, I cannot find a function that will allow me to do both, Bayesian and block kriging at the same time.  My questions are:

1) Can the function "krige.bayes" be made to accommodate data in areal form (rather than point data)? or
2) Does the function "krige" allow for Bayesian inference (i.e., priors, posteriors)? or
3) Is there another package that can do both? or
4) Is there a method for combining functions to do what I would like to do?

A response to any and/or all of these questions would be greatly appreciated.  Thank you in advance.

Candan Soykan
csoykan at mail.sdsu.edu


From edzer.pebesma at uni-muenster.de  Fri Feb 19 10:12:58 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 19 Feb 2010 10:12:58 +0100
Subject: [R-sig-Geo] Bayesian Block Kriging?
In-Reply-To: <20100218211504.CYJ41976@mail.sdsu.edu>
References: <20100218211504.CYJ41976@mail.sdsu.edu>
Message-ID: <4B7E561A.1030107@uni-muenster.de>

Candan, that is a very interesting question.

You should note that by block kriging one usually refers to the 
situation where the observations are (nearly) points, and the prediction 
refer to mean values over larger areas, the blocks. This is the 
assumption made in gstat, anyway. If your data are spatial averages, and 
you want to predict averages over areas of the same size, you could 
still use point kriging as there is no change in support from 
observations to predictions size / area / volume. Is your prediction 
support different from your observation support?

csoykan at mail.sdsu.edu wrote:
> Hello,
>     I'm interested in doing Bayesian kriging using R.  I see that the package geoR has a function that will allow one to do this (krige.bayes).  However, my data are not in the form of points, but rather they are blocks that represent spatial averages (i.e., the number of fishing hooks per month in a given lat x long square).  I am therefore interested in treating the data as spatial blocks, rather than points.  I see that package gstat has a function that will allow one to
> do block kriging (krige).  However, I cannot find a function that will allow me to do both, Bayesian and block kriging at the same time.  My questions are:
>
> 1) Can the function "krige.bayes" be made to accommodate data in areal form (rather than point data)? or
> 2) Does the function "krige" allow for Bayesian inference (i.e., priors, posteriors)? or
>   
No.
> 3) Is there another package that can do both? or
> 4) Is there a method for combining functions to do what I would like to do?
>   
I believe that krige.bayes does everything simulation-based. Of course 
you could use krige() to do simulations for you. You could also simulate 
on a (fine) point scale, and do the upscaling to blocks realisation by 
realisation, yourself. But again, I'm not sure if this is what you need.
> A response to any and/or all of these questions would be greatly appreciated.  Thank you in advance.
>
> Candan Soykan
> csoykan at mail.sdsu.edu
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From marcelino.delacruz at upm.es  Fri Feb 19 15:41:57 2010
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Fri, 19 Feb 2010 15:41:57 +0100
Subject: [R-sig-Geo] suggestion to imrpove: Generating Random Transects
 of Same Length (by marcelino de la cruz)
In-Reply-To: <518dff331002181340q222b2dcte7ae485a1dab4083@mail.gmail.com
 >
References: <518dff331002181340q222b2dcte7ae485a1dab4083@mail.gmail.com>
Message-ID: <201002191442.o1JEgH28029883@edison.ccupm.upm.es>


See below:

At 22:40 18/02/2010, gianni lavaredo wrote:
>Dear Researchers,
>
>I wish to improve the code of "Generating Random 
>Transects of Same Length", by  Marcellino De la 
>Cruz to do a forest invetory analysis
>I am trying to use with "Stratified Random Point" inside a grid.
>
>the problem is: sometimes the transect line 
>enter inside another square (if You run the code 
>you can see very easy the problem). Eventually 
>with vertices(tiles(Z)) I can change in w=
>.....................
>
># Test if every circle point is inside polygonal boundary
>srp.disc.df <- lapply(srp.disc, function(W){
> 
>inside.owin(W$bdry[[1]]$x,W$bdry[[1]]$y ,w=mywindow)})
>
###########################
#### START HERE::



>library(spatstat)
>mywindow <- owin(c(0,3000),c(0,2000))
>plot(mywindow)
># Divide Region into Quadrats
>Z <- quadrats(mywindow, 10, 10)

# you mean 100 transects i.e. one in each tile
npoints <- 100
s <- 1:npoints

#create the tiles object:
Ztiles <- tiles(Z)

>plot(Z, add=T)
># Stratified Random Point
>     #srp <- rstrat(win=Z, nx=10,k=1)
>      #plot(srp,pch=20,cex = 0.8, add=T,col="blue")
>

# better, choose one random point within each tile:
srp2 <- lapply(Ztiles, function(x) rpoint(1,w=x)) 
#one rnadom point within each tile
lapply(srp2,plot, pch=20,cex = 0.8, add=T,col="blue")




># transect
>ltransect <- 100
>
>#srp.xy <- data.frame(srp$x,srp$y)
srp.xy<-t(sapply(srp2, function(k) c(k$x,k$y)))



>#compute a circle around each point
>#srp.disc <- apply(srp.xy,1, function(x) disc(r=ltransect, x))


srp.disc <- lapply(srp2, function(x) disc(r=ltransect, c(x$x,x$y)))


># Plot all circle buffer
>for(i in 1:length(srp.disc)) {
>                     plot(srp.disc[[i]],add=T)
>}
>
>
># the problem is here. I need to change in 
>w=with the each part of Z(=Divide Region into Quadrats),
># and compte for each points the following test
>
># Test if every circle point is inside polygonal boundary
>#srp.disc.df <- lapply(srp.disc, function(W){
># 
>inside.owin(W$bdry[[1]]$x,W$bdry[[1]]$y ,w=mywindow)})

# test if every circle point is inside the 
polygonal boundary of each tile
srp.disc.df <- NULL
for (i in 1:length(srp.disc)){
      srp.disc.df[[i]] <- inside.owin(srp.disc[[i]]$bdry[[1]]$x,
                                             srp.disc[[i]]$bdry[[1]]$y 
,w=Ztiles[[i]])

}




># function to sample circle points within the window
>samplea2 <- function(srp.xy, l1=srp.disc, l2=srp.disc.df){
>                     result <-c(0,0)
>                     for(i in 1:length(l1)){
>                                       truinside<-sum(l2[[i]])
>                                       inside 
> <-cbind(l1[[i]]$bdry[[1]]$x,l1[[i]]$bdry[[1]]$y)[l2[[i]],]
> 
>result<-rbind(result, inside[sample(1:truinside, size=1),])
>                                 }
>                             result <- result[-1,]
>                             result <- cbind(srp.xy,result)
>                             return(result)
>}
>
># the result is a matrix with x0,y0, x1, y1 for each transect
># Plot the random transects:
>segmentos <- samplea2(srp.xy)
>segments(segmentos[,1][s], 
>segmentos[,2][s],segmentos[,3][s], segmentos[,4][s])


Hope this helps!

Marcelino













>this is the orginal code:
>
>library(spatstat)
>
># Define polygon, length of transect and number of (points)transects
>data(letterR)
>mywindow <- letterR
>ltransect <- 0.3
>npoints <- 100
>s <- 1:npoints
>
># Generate random origin points
>cosa <- runifpoint(npoints, w=mywindow)
>plot(cosa)
>
>
>cosaxy <- data.frame(cosa$x,cosa$y)
>
>#compute a circle around each point
>cosadisc<- apply(cosaxy,1, function(x) disc(r=ltransect, x))
>
># Test if every circle point is inside polygonal boundary
>cosadisc.df <- lapply(cosadisc, function(W){
> 
>inside.owin(W$bdry[[1]]$x,W$bdry[[1]]$y ,w=mywindow)})
>
>#function to sample circle points within the window
>samplea2 <- function(cosaxy, l1=cosadisc, l2=cosadisc.df){
>                     result<-c(0,0)
>                     for (i in 1:length(l1)){
>                           truinside<-sum(l2[[i]])
>                           inside 
> <-cbind(l1[[i]]$bdry[[1]]$x,l1[[i]]$bdry[[1]]$y)[l2[[i]],]
>                           result<-rbind(result, 
>   inside[sample(1:truinside, size=1),])
>                     }
>                     result<-result[-1,]
>                     result<-cbind(cosaxy,result)
>                     return(result)
>}
>
>#the result is a matrix with x0,y0, x1, y1 for each transect
>#Plot the random transects:
>
>segmentos<-samplea2(cosaxy)
>segments(segmentos[,1][s], 
>segmentos[,2][s],segmentos[,3][s], segmentos[,4][s])

________________________________

Marcelino de la Cruz Rot

Departamento de  Biolog?a Vegetal
E.U.T.I. Agr?cola
Universidad Polit?cnica de Madrid
28040-Madrid
Tel.: 91 336 54 35
Fax: 91 336 56 56
marcelino.delacruz at upm.es
_________________________________ 


From j.m.signer at gmail.com  Fri Feb 19 19:03:00 2010
From: j.m.signer at gmail.com (Johannes Signer)
Date: Fri, 19 Feb 2010 19:03:00 +0100
Subject: [R-sig-Geo] Least Cost Path/Corridor
Message-ID: <aa7630001002191003u28ebfd87v7098ec5aa429c253@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100219/0be8f587/attachment.pl>

From andrew.chapkowski at gmail.com  Fri Feb 19 20:35:12 2010
From: andrew.chapkowski at gmail.com (A. Chapkowski)
Date: Fri, 19 Feb 2010 14:35:12 -0500
Subject: [R-sig-Geo] Spatial Data Mining
Message-ID: <b99914441002191135s22e961d4q1200669711ed1193@mail.gmail.com>

Is it possible to perform spatial data mining using R and ArcMap?

If so, does anyone have any documentation showing this or examples
that could help me get started?

Thank you

Andrew


From nitmithv at yahoo.com.cn  Sun Feb 21 06:07:32 2010
From: nitmithv at yahoo.com.cn (Kai Zhang)
Date: Sun, 21 Feb 2010 00:07:32 -0500
Subject: [R-sig-Geo] How to do cross validation for universal kriging in
	Gstat
Message-ID: <201002210007317966711@yahoo.com.cn>

Dear all,

I am attempting several Kriging methods to interpolate temperature in a area. It works well for me to use krige.cv to conduct cross validation for ordinary kriging and gstat.cv for co-kriging. However, I am confused on how to conduct cv for universal kriging. The temperature data is from the data file 1 and the secondary variable with more intense sampling is from another file. Krige.cv does not provide a parameter on 'newdata'. When I was trying gstat.cv, the variogram function automatically fits cross-variogram after I incorporate both temperature and the secondary information into a gstat object. Any suggestions are welcome.

g <- gstat(NULL,id="Temp", formula=Temp~1, data=TMP)
g <- gstat(g,id="Ele", formula=Ele~1, data=ELE)
g <- gstat(g, id = "Temp", model = vgm(1, "Exp", 44559, 1))
x <- variogram(g)

Many thanks,
Kai Zhang



__________________________________________________
???????????????


From markus.loecher at gmail.com  Sun Feb 21 14:10:38 2010
From: markus.loecher at gmail.com (Markus Loecher)
Date: Sun, 21 Feb 2010 08:10:38 -0500
Subject: [R-sig-Geo] clipping polygons, overlaying big polygon on polygons
Message-ID: <bf460e021002210510p1bc68560t8fb0ac58f92efe49@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100221/506ab223/attachment.pl>

From Roger.Bivand at nhh.no  Sun Feb 21 14:26:26 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 21 Feb 2010 14:26:26 +0100 (CET)
Subject: [R-sig-Geo] clipping polygons,
 overlaying big polygon on polygons
In-Reply-To: <bf460e021002210510p1bc68560t8fb0ac58f92efe49@mail.gmail.com>
References: <bf460e021002210510p1bc68560t8fb0ac58f92efe49@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002211421190.29488@reclus.nhh.no>

On Sun, 21 Feb 2010, Markus Loecher wrote:

> Dear all,
> I apologize if this is too simple a question as it does appear to be a basic
> GIS operation but I have not found the appropriate function that performs a
> clipping of polygons into boundaries given by a (larger "outer") polygon. I
> tried overlay() from package sp and clipPolys from package PBSmapping but
> none converted the "inner" polygons into new ones laying inside the
> boundaries given by the outer polygon.

Maybe a basic GIS operation should be done in a GIS? Otherwise, please 
feel free to consult threads on the license problems of gpclib, and about 
the R-forge rgeos package. If you'd like to contribute such an 
intersection (I think you want the intersection between an arbitrary 
SpatialPolygons object and a simple SpatialPolygons object for the outer 
polygon) function tool to rgeos, or at least a sketch of how it might 
work, that would be helpful.

Roger

>
> Any help would be greatly appreciated,
> Thanks,
>
> Markus
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Sun Feb 21 17:51:42 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 21 Feb 2010 17:51:42 +0100
Subject: [R-sig-Geo] How to do cross validation for universal kriging
 in	Gstat
In-Reply-To: <201002210007317966711@yahoo.com.cn>
References: <201002210007317966711@yahoo.com.cn>
Message-ID: <4B81649E.2000703@uni-muenster.de>

Kai,

krige.cv(Temp~Ele, data, model)

should do the job, assuming that your primary variable of interest is
temperature.
--
Edzer


Kai Zhang wrote:
> Dear all,
>
> I am attempting several Kriging methods to interpolate temperature in a area. It works well for me to use krige.cv to conduct cross validation for ordinary kriging and gstat.cv for co-kriging. However, I am confused on how to conduct cv for universal kriging. The temperature data is from the data file 1 and the secondary variable with more intense sampling is from another file. Krige.cv does not provide a parameter on 'newdata'. When I was trying gstat.cv, the variogram function automatically fits cross-variogram after I incorporate both temperature and the secondary information into a gstat object. Any suggestions are welcome.
>
> g <- gstat(NULL,id="Temp", formula=Temp~1, data=TMP)
> g <- gstat(g,id="Ele", formula=Ele~1, data=ELE)
> g <- gstat(g, id = "Temp", model = vgm(1, "Exp", 44559, 1))
> x <- variogram(g)
>
> Many thanks,
> Kai Zhang
>
>
>
> __________________________________________________
> ???????????????
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From smartfra at msu.edu  Sun Feb 21 20:35:18 2010
From: smartfra at msu.edu (Francis Smart)
Date: Sun, 21 Feb 2010 14:35:18 -0500
Subject: [R-sig-Geo] Preparing R plots for Publication
Message-ID: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100221/67dc6dbe/attachment.pl>

From nitmithv at yahoo.com.cn  Sun Feb 21 21:20:51 2010
From: nitmithv at yahoo.com.cn (Kai Zhang)
Date: Sun, 21 Feb 2010 15:20:51 -0500
Subject: [R-sig-Geo] How to do cross validation for universal
	krigingin	Gstat
References: <201002210007317966711@yahoo.com.cn>,
	<4B81649E.2000703@uni-muenster.de>
Message-ID: <201002211520508759213@yahoo.com.cn>

Hi Edzer,

Thanks for your quick reply. The primary variable of my interest is temperature.  I tried to use krige.cv before, but it did not work. The problem arises because the temperature and impervious surface are from two files. For universal kriging, the krige function has a parameter called "newdata" which handles the second data file. However, the krige.cv does not include a "newdata" parameter according to the help document. There is a error when I specified two datasources when I was running krige.cv in specifying a newdata source:  

> dtw.vgm <- variogram(Temp~ Ele, TMP)
> dtw.fit <- fit.variogram(dtw.vgm, model = vgm(1.45, "Exp", 9502,0))
> uk.kriged.am <- krige.cv(Temp~Ele,data=TMP,newdata=IMP,model=dtw.fit)
Error in function (classes, fdef, mtable)  : 
  unable to find an inherited method for function "krige.cv", for signature "formula", "missing"

I tried to delete parameters names such as 'data' and 'newdata' according to your response to a related problem before in the R-sig-Geo archives. However, it still did not work.

Thanks,
Kai Zhang



======= 2010-02-21 11:51:45 You wrote =======

>Kai,
>
>krige.cv(Temp~Ele, data, model)
>
>should do the job, assuming that your primary variable of interest is
>temperature.
>--
>Edzer
>
>
>Kai Zhang wrote:
>> Dear all,
>>
>> I am attempting several Kriging methods to interpolate temperature in a area. It works well for me to use krige.cv to conduct cross validation for ordinary kriging and gstat.cv for co-kriging. However, I am confused on how to conduct cv for universal kriging. The temperature data is from the data file 1 and the secondary variable with more intense sampling is from another file. Krige.cv does not provide a parameter on 'newdata'. When I was trying gstat.cv, the variogram function automatically fits cross-variogram after I incorporate both temperature and the secondary information into a gstat object. Any suggestions are welcome.
>>
>> g <- gstat(NULL,id="Temp", formula=Temp~1, data=TMP)
>> g <- gstat(g,id="Ele", formula=Ele~1, data=ELE)
>> g <- gstat(g, id = "Temp", model = vgm(1, "Exp", 44559, 1))
>> x <- variogram(g)
>>
>> Many thanks,
>> Kai Zhang
>>
>>
>>
>> __________________________________________________
>> ???????????????
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>   
>
>-- 
>Edzer Pebesma
>Institute for Geoinformatics (ifgi), University of M?nster 
>Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
>8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
>http://www.52north.org/geostatistics      e.pebesma at wwu.de
>



From edzer.pebesma at uni-muenster.de  Sun Feb 21 21:33:47 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 21 Feb 2010 21:33:47 +0100
Subject: [R-sig-Geo] How to do cross validation for universal krigingin
 Gstat
In-Reply-To: <201002211520508759213@yahoo.com.cn>
References: <201002210007317966711@yahoo.com.cn>,
	<4B81649E.2000703@uni-muenster.de>
	<201002211520508759213@yahoo.com.cn>
Message-ID: <4B8198AB.7070102@uni-muenster.de>



Kai Zhang wrote:
> Hi Edzer,
>
> Thanks for your quick reply. The primary variable of my interest is temperature.  I tried to use krige.cv before, but it did not work. The problem arises because the temperature and impervious surface are from two files. For universal kriging, the krige function has a parameter called "newdata" which handles the second data file. However, the krige.cv does not include a "newdata" parameter according to the help document. There is a error when I specified two datasources when I was running krige.cv in specifying a newdata source:  
>   
krige only works when the secondary variable (ELE) is present both in 
the data and in the newdata argument. krige.cv only uses the data 
argument, where ELE is present.
>   
>> dtw.vgm <- variogram(Temp~ Ele, TMP)
>> dtw.fit <- fit.variogram(dtw.vgm, model = vgm(1.45, "Exp", 9502,0))
>> uk.kriged.am <- krige.cv(Temp~Ele,data=TMP,newdata=IMP,model=dtw.fit)
>>     
> Error in function (classes, fdef, mtable)  : 
>   unable to find an inherited method for function "krige.cv", for signature "formula", "missing"
>   

> I tried to delete parameters names such as 'data' and 'newdata' according to your response to a related problem before in the R-sig-Geo archives. However, it still did not work.
>   
The krige.cv documentation does not mention a newdata argument. Pls try:

uk.kriged.am <- krige.cv(Temp~Ele, TMP, dtw.fit)

> Thanks,
> Kai Zhang
>
>
>
> ======= 2010-02-21 11:51:45 You wrote =======
>
>   
>> Kai,
>>
>> krige.cv(Temp~Ele, data, model)
>>
>> should do the job, assuming that your primary variable of interest is
>> temperature.
>> --
>> Edzer
>>
>>
>> Kai Zhang wrote:
>>     
>>> Dear all,
>>>
>>> I am attempting several Kriging methods to interpolate temperature in a area. It works well for me to use krige.cv to conduct cross validation for ordinary kriging and gstat.cv for co-kriging. However, I am confused on how to conduct cv for universal kriging. The temperature data is from the data file 1 and the secondary variable with more intense sampling is from another file. Krige.cv does not provide a parameter on 'newdata'. When I was trying gstat.cv, the variogram function automatically fits cross-variogram after I incorporate both temperature and the secondary information into a gstat object. Any suggestions are welcome.
>>>
>>> g <- gstat(NULL,id="Temp", formula=Temp~1, data=TMP)
>>> g <- gstat(g,id="Ele", formula=Ele~1, data=ELE)
>>> g <- gstat(g, id = "Temp", model = vgm(1, "Exp", 44559, 1))
>>> x <- variogram(g)
>>>
>>> Many thanks,
>>> Kai Zhang
>>>
>>>
>>>
>>> __________________________________________________
>>> ???????????????
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>   
>>>       
>> -- 
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster 
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>>     
>
>
> ?i??'????&

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From breitbach at uni-mainz.de  Sun Feb 21 22:23:25 2010
From: breitbach at uni-mainz.de (Breitbach, Nils)
Date: Sun, 21 Feb 2010 22:23:25 +0100
Subject: [R-sig-Geo] Preparing R plots for Publication
In-Reply-To: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com>
References: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com>
Message-ID: <6634A5A114BA554C927CF724BA50404102060A9F16BB@EXCHANGE-02.zdv.uni-mainz.de>

Dear Francis,

I also struggle with graphics in R. To get an answer for your specific question it would be necessary to tell the forum what kind of graphic you need (PDF, eps, tif, jpg, ...) and what function you used so far. Generally there is not an all-in-one answer for formatting graphics in R. The book R-Graphics by Paul Murrell is a kind of a standard reference and it might be listed in your university library. Usually formatting is done with par().

For some first ideas try: http://www.stat.auckland.ac.nz/~paul/RGraphics/rgraphics.html or http://addictedtor.free.fr/graphiques/

Regards,

Nils

_______________________________________________________

Nils Breitbach, Dipl.-Biol.
Institut f?r Zoologie, Abt. 5: ?kologie
J.-J.-Becher-Weg 13
Johannes Gutenberg-Universit?t
55128 Mainz
Germany

phone: +49 6131 39-26108
fax:   +49 6131 39-23731
WWW: www.community-ecology.uni-mainz.de/126_ENG_HTML.php
_______________________________________________________


________________________________________
Von: r-sig-geo-bounces at stat.math.ethz.ch [r-sig-geo-bounces at stat.math.ethz.ch] im Auftrag von Francis Smart [smartfra at msu.edu]
Gesendet: Sonntag, 21. Februar 2010 20:35
An: r-sig-geo at stat.math.ethz.ch
Betreff: [R-sig-Geo] Preparing R plots for Publication

Dear R-Users,

I am attempting to submit an article using R generated plots for
publication.  I am having a bit of difficulty figuring out how to format my
plots suitably.

Is there a small tutorial available that walks through how to format plots?

If not perhaps someone could please tell me how to at least change my font
to Times New Roman.  It does not seam to be a font that is available, yet it
is available on my system.

Thanks,
Francis Smart

--
Francis Smart
--------------------
PhD Student - Michigan State University
Agricultural, Food, and Resource Economics
(406) 223-8108

        [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From michael.denslow at gmail.com  Sun Feb 21 22:28:03 2010
From: michael.denslow at gmail.com (Michael Denslow)
Date: Sun, 21 Feb 2010 16:28:03 -0500
Subject: [R-sig-Geo] problem writing GML file
Message-ID: <b440a3f81002211328g9cb7a16u1453bb018879d5cd@mail.gmail.com>

Dear r-sig-geo,

I am having a problem writing a GML file. The file I am trying to use
is a .csv that looks like this. I apologize that I am not sure how to
efficiently post this file to the list.

> str(floras)
'data.frame':	86 obs. of  47 variables:
 $ ref.num                   : Factor w/ 85 levels "10132","10185",..:
69 29 35 48 60 23 67 68 8 59 ...
 $ Flora                     : Factor w/ 76 levels " LaVerne Smith
1977",..: 41 67 40 4 34 47 73 71 33 69 ...
 $ Short.Name                : Factor w/ 86 levels "Andrews Bald",..:
55 7 18 48 9 39 68 38 40 79 ...
 $ Field.Year                : int  2006 1972 1984 1987 1969 1978 2003
2003 1915 1994 ...
 $ State                     : Factor w/ 2 levels "NC","SC": 1 1 1 1 1
1 1 1 1 1 ...
 $ State2                    : Factor w/ 6 levels
"","GA","NC","SC",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ State3                    : Factor w/ 2 levels "","SC": 1 1 1 1 1 1
1 1 1 1 ...
 $ County1                   : Factor w/ 43 levels "","Alleghany",..:
3 3 23 4 2 39 20 16 20 15 ...
 $ County2                   : Factor w/ 26 levels
"","`","Alleghany",..: 1 1 1 1 1 4 1 1 1 1 ...
 $ County3                   : Factor w/ 13 levels "","Brunswick",..:
1 1 1 1 1 1 1 1 1 1 ...
 $ County4                   : Factor w/ 7 levels "","Cumberland",..:
1 1 1 1 1 1 1 1 1 1 ...
 $ County5                   : Factor w/ 3 levels "","Blount, TN",..:
1 1 1 1 1 1 1 1 1 1 ...
 $ Families                  : int  108 88 97 91 71 76 101 85 95 52 ...
 $ FamCalc                   : int  NA 110 111 98 77 85 NA NA NA NA ...
 $ Genera                    : int  381 348 327 272 197 222 305 223 336 81 ...
 $ GeneraCalc                : int  NA 368 344 284 207 232 NA NA NA NA ...
 $ species                   : int  695 677 596 430 328 355 519 346 659 106 ...
 $ spp.Calc                  : int  696 693 590 426 327 353 NA NA NA NA ...
 $ taxa                      : int  702 681 604 431 333 355 521 353 665 107 ...
 $ native.sp                 : int  537 589 534 375 302 317 440 280 620 104 ...
 $ exotic.sp                 : int  158 88 62 55 26 38 79 66 39 2 ...
 $ exotic.taxa..if.different.: int  NA NA NA NA NA NA NA NA NA NA ...
 $ per.exotics.sp            : num  22.73 13 10.4 12.79 7.93 ...
 $ lat.cent.N                : num  36.4 36.4 35.1 36 36.4 ...
 $ long.cent.W               : num  -81.5 -81.6 -83.5 -81.8 -81.1 ...
 $ min.lat.s                 : num  36.4 36.4 35 36 36.4 ...
 $ max.lat.n                 : num  36.4 36.4 35.1 36.1 36.5 ...
 $ max.long.e                : num  -81.5 -81.5 -83.4 -81.8 -81 ...
 $ min.long.w                : num  -81.5 -81.6 -83.5 -81.9 -81.1 ...
 $ min.elev                  : num  1067 1050 670 549 484 ...
 $ max.elev                  : num  1427 1522 1575 1219 1227 ...
 $ mid.elev                  : num  1247 1286 1122 884 856 ...
 $ elev.range                : num  361 472 905 671 743 ...
 $ area.ha                   : num  368 2849 1626 2308 484 ...
 $ physio                    : Factor w/ 3 levels "CP","MT","PD": 2 2
2 2 2 2 2 3 2 2 ...
 $ tax.concept               : Factor w/ 36 levels "","?RAB","Britton
& Brown 1896?, Chapman 1897",..: 33 21 22 30 21 21 14 14 4 34 ...
 $ prim.herb                 : Factor w/ 21 levels "","BOON","Carl
Sandburg Home NHS",..: 2 9 20 8 10 10 3 7 4 20 ...
 $ other.herbaria            : Factor w/ 18 levels
"","BRP-NPS","DUKE",..: 1 15 1 1 1 1 1 1 7 1 ...
 $ political                 : Factor w/ 7 levels
"","county","military",..: 5 6 5 5 6 6 5 5 2 5 ...
 $ preserve.type             : Factor w/ 18 levels "","Botanical",..:
11 1 4 5 1 1 7 7 1 8 ...
 $ pub.type                  : Factor w/ 8 levels
"","Book","Dissertation",..: 7 5 4 7 7 5 6 6 5 5 ...
 $ Vouchers                  : int  1167 NA NA NA NA NA NA NA NA NA ...
 $ Entered.                  : Factor w/ 2 levels "","Y": 2 2 2 2 2 2
1 1 1 1 ...
 $ Stats.                    : Factor w/ 2 levels "","Y": 2 2 2 2 2 2
2 2 2 2 ...
 $ Bib.Checked               : Factor w/ 3 levels "","N","Y": 3 3 3 3
3 3 3 3 3 3 ...
 $ island                    : logi  NA NA NA NA NA NA ...
 $ Notes                     : Factor w/ 33 levels "","A few taxa were
excluded from counts because they were labeled as cultivated. The
Supplement (Sieren 1982b) does not include ne"| __truncated__,..: 1 24
1 1 17 19 28 1 1 20 ...


I was able to make a SpatialPointsDataFrame just fine with the
following commands.
> library(rgdal)
> coordinates(floras) = c('long.cent.W','lat.cent.N')
> class(floras)
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"

but when I run writeOGR, I get an error

> writeOGR(floras,paste(getwd(),'florasTEST.gml',sep='/'),'floras', driver = 'GML')
Error in writeOGR(floras, paste(getwd(), "florasTEST.gml", sep = "/"),  :
  unknown data type

I am not sure why this is not working. I suspect that there may be a
problem with my file since it has many rows and columns with no
values. But...

The following reproducible example does work without problems.
library(rgdal)
ex <- data.frame(fl = LETTERS[1:4],
lat = c(36.4, 36.3908, 35.055, 36.0226),
long = c(-81.4614, -81.5717, -83.455, -81.8264),
d = c('','blah','blah',''))

coordinates(ex) = c('long','lat')
class(ex)
plot(ex)
# it works!
writeOGR(ex,paste(getwd(),'flTEST.gml',sep='/'),'fl', driver = 'GML')
# and can be read back in
fl <- readOGR(dsn = paste(getwd(),'flTEST.gml',sep='/'), layer = 'fl')
plot(fl)

Any advise would be most appreciated,
Michael

> sessionInfo()
R version 2.10.1 (2009-12-14)
x86_64-apple-darwin9.8.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-20 sp_0.9-44

loaded via a namespace (and not attached):
[1] grid_2.10.1     lattice_0.17-26 tools_2.10.1
-- 
Michael Denslow

I.W. Carpenter Jr. Herbarium [BOON]
Department of Biology
Appalachian State University
Boone, North Carolina U.S.A.
-- AND --
Communications Manager
Southeast Regional Network of Expertise and Collections
sernec.org

36.214177, -81.681480 +/- 3103 meters


From nicolas.bergeron at sympatico.ca  Sun Feb 21 22:45:09 2010
From: nicolas.bergeron at sympatico.ca (Nicolas Bergeron)
Date: Sun, 21 Feb 2010 16:45:09 -0500
Subject: [R-sig-Geo] image2grid x or y not equally spaced
Message-ID: <87eikejmai.fsf@sympatico.ca>


Hello,


I   tried   to  transform   a   style-image   list   into  an   object
SpatialGridDataFrame  but I  have  a problem  concerning the  function
image2grid. I have the following message:

Erreur dans image2Grid(im) : x or y not equally spaced

Have you a track I suggest?

Thank's


#### MY CODE

# Longitude(x) et latitude(y)
xy <- cbind(x=err$x, y=err$y)

> xy
               x        y
  [1,] -446529.3 694533.6
  [2,] -446579.9 693934.9
  [3,] -444977.1 694335.8
  [4,] -444683.5 695310.2
  [5,] -444632.7 695763.3
  [6,] -444507.0 695797.4
  [7,] -444419.4 695844.2
  [8,] -444130.2 696264.6
  [9,] -444215.2 696799.0
 [10,] -443785.3 699918.4
 [11,] -442931.7 701051.2
 [12,] -440677.3 702047.6
 [13,] -440216.3 701987.9
 [14,] -440096.9 702108.6
 [15,] -441193.4 702916.2
 [16,] -441323.3 702928.1
 [17,] -441380.8 702946.9
 [18,] -441761.5 702806.9
 [19,] -441676.4 702842.0
 [20,] -441601.0 702835.9
 [21,] -441599.9 702836.6
 [22,] -441365.2 702905.0
 [23,] -441372.4 702884.9
 [24,] -441366.6 702922.4
 [25,] -441155.2 702871.6
 [26,] -440538.3 702125.6
 [27,] -440195.4 701771.5
 [28,] -439753.7 701558.5
 [29,] -440218.5 701523.0
 [30,] -440489.4 701520.5
 [31,] -440557.8 701416.3
 [32,] -440611.0 701392.8
 [33,] -440502.4 700831.7
 [34,] -440457.9 700803.0
 [35,] -441242.7 701022.9
 [36,] -441829.7 701382.0
 [37,] -441950.6 701181.5
 [38,] -442003.4 701143.9
 [39,] -442158.1 700977.0
 [40,] -442538.7 701296.6
 [41,] -442649.7 701524.5
 [42,] -442788.4 701675.5
 [43,] -443024.7 701776.3
 [44,] -443292.6 701895.6
 [45,] -443662.9 701686.0
 [46,] -444524.6 701858.6
 [47,] -444485.9 701936.1
 [48,] -444442.5 701913.3
 [49,] -444433.3 701937.9
 [50,] -444363.5 702089.2
 [51,] -444265.6 701986.1
 [52,] -444721.1 701824.9
 [53,] -444720.8 701839.8
 [54,] -444695.4 701849.5
 [55,] -445057.1 701887.7
 [56,] -444993.3 701884.1
 [57,] -445036.0 701867.0
 [58,] -445411.2 701681.5
 [59,] -445818.8 701201.0
 [60,] -445830.7 701199.3
 [61,] -445871.2 701180.8
 [62,] -445951.3 701357.4
 [63,] -446012.8 701349.3
 [64,] -446613.8 701300.5
 [65,] -446048.3 701770.0
 [66,] -445907.0 701922.9
 [67,] -445773.6 701955.8
 [68,] -445224.1 701942.1
 [69,] -444901.5 701918.9
 [70,] -444898.0 701898.3
 [71,] -444240.1 702038.9
 [72,] -444435.4 701996.1
 [73,] -444447.5 702007.9
 [74,] -443831.5 701752.3
 [75,] -443407.9 701506.0
 [76,] -443413.0 701495.4
 [77,] -443519.7 701415.3
 [78,] -443267.0 701340.2
 [79,] -443260.2 701349.2
 [80,] -443115.7 701384.1
 [81,] -443077.4 701459.1
 [82,] -443025.2 701426.4
 [83,] -442962.3 701282.3
 [84,] -442947.7 701276.3
 [85,] -442723.0 701260.4
 [86,] -442408.9 701387.6
 [87,] -442319.4 701386.5
 [88,] -442293.5 701267.2
 [89,] -442305.6 701269.2
 [90,] -442229.4 701224.7
 [91,] -442207.0 701232.0
 [92,] -442129.4 701272.7
 [93,] -442130.5 701273.4
 [94,] -442081.5 701343.0
 [95,] -442096.6 701327.7
 [96,] -442058.0 701363.9
 [97,] -442036.5 701379.0
 [98,] -441777.3 701000.5
 [99,] -441721.0 701014.2
[100,] -441432.3 700993.5
[101,] -441453.3 700997.8
[102,] -441136.7 701319.5
[103,] -441001.4 701386.3
[104,] -440982.2 701388.8
[105,] -440952.3 701301.7
[106,] -440874.0 701289.4
[107,] -440863.5 701294.2
[108,] -440856.8 701320.2
[109,] -440853.4 701222.5
[110,] -441022.9 701155.5
[111,] -442464.1 701366.2
[112,] -442748.7 701275.7
[113,] -443334.8 702582.5
[114,] -443805.7 702625.4
[115,] -444346.9 702386.8
[116,] -444435.0 702446.3
[117,] -444309.5 702308.6
[118,] -444426.1 702396.3
[119,] -444244.5 702436.3
[120,] -444240.7 702437.3
[121,] -444247.7 702435.1
[122,] -444152.1 702626.4
[123,] -444157.5 702433.0
[124,] -444092.4 702412.6
[125,] -444088.3 702477.5
[126,] -444089.7 702446.9
[127,] -444084.3 702457.7
[128,] -444221.6 702194.4
[129,] -444291.4 702155.8
[130,] -444352.0 702102.3
[131,] -444348.8 702130.5
[132,] -444988.1 703317.4
[133,] -444966.6 703307.9
[134,] -444907.3 703278.2
[135,] -444566.9 702589.4
[136,] -444773.8 702304.8
[137,] -444781.7 702313.7
[138,] -444811.2 702316.7
[139,] -444872.8 702187.3
[140,] -445050.1 702078.3
[141,] -445091.3 702055.1
[142,] -445095.2 701960.4
[143,] -445964.2 700782.4
[144,] -445911.0 700805.5
[145,] -448432.0 699148.5
[146,] -448476.0 698833.6
[147,] -448426.4 698900.5
[148,] -448530.0 698516.8
[149,] -448386.4 697765.2
[150,] -448173.1 697726.4
[151,] -447817.5 697843.7
[152,] -447938.7 697579.2
[153,] -447936.9 697354.7
[154,] -447616.1 697863.2
[155,] -446237.8 697294.5
[156,] -446235.1 697311.9
[157,] -445919.8 697376.2
[158,] -445829.5 698040.0
[159,] -445439.8 697777.5
[160,] -445450.5 697785.5
[161,] -445646.6 697908.6
[162,] -445814.3 697196.4
[163,] -445771.9 697246.5
[164,] -445787.6 697223.3
[165,] -445812.7 697096.1
[166,] -445806.6 697107.7
[167,] -445822.3 697070.6
[168,] -445858.0 697069.6
[169,] -445986.6 697222.9
[170,] -446670.6 697772.8
[171,] -446620.4 697715.9
[172,] -446285.8 698334.3
[173,] -446991.8 698321.9
[174,] -446946.4 698324.9
[175,] -446295.9 696733.0
[176,] -446003.1 696836.0
[177,] -445911.7 696856.9
[178,] -446010.4 696827.8
[179,] -445832.5 696905.0
[180,] -445817.3 696865.4
[181,] -445835.4 696876.1
[182,] -445838.2 696854.8
[183,] -445811.1 696915.6
[184,] -445673.2 697016.9
[185,] -445948.4 697223.7
[186,] -445965.1 697213.9
[187,] -445948.7 697217.0
[188,] -445660.0 697297.7
[189,] -445669.1 697352.2
[190,] -445542.3 697235.0
[191,] -445454.1 697278.7
[192,] -445532.1 697239.8
[193,] -445448.5 697303.7
[194,] -445420.4 697282.5
[195,] -445411.6 697274.0
[196,] -445412.6 697272.5
[197,] -445531.9 697220.1
[198,] -445514.1 697479.3
[199,] -445533.3 697484.1
[200,] -445529.7 697496.3
[201,] -445643.4 697807.1
[202,] -445686.8 697681.8
[203,] -445657.1 697635.9
[204,] -445651.8 697645.1
[205,] -445926.6 697205.1
[206,] -445977.7 697184.4
[207,] -445859.8 697072.7
[208,] -445823.3 697063.3
[209,] -445529.9 697215.0
[210,] -445528.4 697203.8
[211,] -445391.3 697154.8
[212,] -445450.8 697292.1
[213,] -445686.4 697358.4
[214,] -445680.2 697608.6
[215,] -447930.8 698683.5
[216,] -448185.5 699073.1
[217,] -448262.3 698997.5
[218,] -447795.6 698537.6
[219,] -447778.4 698530.4
[220,] -447357.0 698420.1
[221,] -447741.7 698629.4
[222,] -447720.9 698872.7
[223,] -447648.1 699106.8
[224,] -447379.3 698306.0
[225,] -447692.8 698881.4
[226,] -447778.8 699159.3
[227,] -447772.2 699121.6
[228,] -447683.3 699162.6
[229,] -447775.4 699152.3
[230,] -447693.4 699106.6
[231,] -447627.2 699039.7
[232,] -447615.7 698864.3
[233,] -447705.2 698839.5
[234,] -447568.7 698601.8
[235,] -447975.8 698662.9
[236,] -448001.7 698680.0
[237,] -448137.3 700507.2
[238,] -447389.2 700395.1
[239,] -447821.5 699790.1
[240,] -447004.7 700016.4
[241,] -447210.2 699527.0
[242,] -447215.5 699645.0
[243,] -447231.4 699637.2
[244,] -447878.1 699060.1
[245,] -447196.6 698442.3
[246,] -446823.2 698570.4
[247,] -446933.0 697555.7
[248,] -446928.6 697555.7
[249,] -446963.9 697643.8
[250,] -447475.6 697976.2
[251,] -447338.9 698340.5
[252,] -447288.4 698288.2
[253,] -445784.9 698136.8
[254,] -446244.4 698795.6
[255,] -446319.8 698806.8
[256,] -446322.2 698806.0
[257,] -446298.3 698774.1
[258,] -446107.0 698943.9
[259,] -446066.4 698948.9
[260,] -446021.4 698950.2
[261,] -445895.1 698941.0
[262,] -445892.5 698933.6
[263,] -444618.6 700277.2
[264,] -446199.0 698845.0
[265,] -446228.6 698785.1
[266,] -443626.9 690057.4
[267,] -444387.3 690388.2
[268,] -444474.0 690213.3
[269,] -443501.3 689789.7
[270,] -443277.2 689898.7
[271,] -443272.2 689940.3
[272,] -443282.5 689901.2
[273,] -443380.1 689747.7
[274,] -443298.9 689885.0
[275,] -443481.7 689699.2
[276,] -443912.4 689717.7
[277,] -443617.5 689863.8
[278,] -443485.3 689694.1
[279,] -443921.8 689744.3
[280,] -443844.5 689583.4
[281,] -443888.1 689746.8


# range
range(err$x)
range(err$y)

# hpi-diag - scale
HpiScale <- Hpi.diag(x=xy)
# resolution (25m x 25m)
fhat.HpiScale <- kde(x=xy, H=HpiScale,
                     gridsize=c(round((max(xy$x)-min(xy$x))/25),
                                round((max(xy$y)-min(xy$y))/25)))

# export gridsize
im <- list(x=fhat.HpiScale$eval.points[[1]],
           y=fhat.HpiScale$eval.points[[2]],
           z=fhat.HpiScale$estimate)

# make an image-style list
image(im)
contour(im)

# convert 
SPim <- image2Grid(im)


Erreur dans image2Grid(im) : x or y not equally spaced

-- 
Nicolas Bergeron
bio., tech.


From b.rowlingson at lancaster.ac.uk  Sun Feb 21 22:49:50 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 21 Feb 2010 21:49:50 +0000
Subject: [R-sig-Geo] problem writing GML file
In-Reply-To: <b440a3f81002211328g9cb7a16u1453bb018879d5cd@mail.gmail.com>
References: <b440a3f81002211328g9cb7a16u1453bb018879d5cd@mail.gmail.com>
Message-ID: <d8ad40b51002211349k3ceb72beh58aaf9fba38af70f@mail.gmail.com>

On Sun, Feb 21, 2010 at 9:28 PM, Michael Denslow
<michael.denslow at gmail.com> wrote:
> Dear r-sig-geo,
>

> I was able to make a SpatialPointsDataFrame just fine with the
> following commands.
>> library(rgdal)
>> coordinates(floras) = c('long.cent.W','lat.cent.N')
>> class(floras)
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
>
> but when I run writeOGR, I get an error
>
>> writeOGR(floras,paste(getwd(),'florasTEST.gml',sep='/'),'floras', driver = 'GML')
> Error in writeOGR(floras, paste(getwd(), "florasTEST.gml", sep = "/"), ?:
> ?unknown data type

That's weird - writeOGR looks like it should output the type and class
of the column when it gets this problem:

else stop(paste(dfcls[i], dftof[i], "unknown data type"))

 - unless you're on a different version. Try running writeOGR in debug
mode - do:

debug(writeOGR)

then run your writeOGR function call. Hit return to step a line at a
time, and inspect variables. Or how about cutting some of your
variables out and seeing what fixes it/breaks it?

your sp object only seemed to have factors, numbers, and logicals and
so writeOGR shouldnt have any problem with it...

Barry

-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From michael.denslow at gmail.com  Sun Feb 21 23:16:55 2010
From: michael.denslow at gmail.com (Michael Denslow)
Date: Sun, 21 Feb 2010 17:16:55 -0500
Subject: [R-sig-Geo] problem writing GML file
In-Reply-To: <d8ad40b51002211349k3ceb72beh58aaf9fba38af70f@mail.gmail.com>
References: <b440a3f81002211328g9cb7a16u1453bb018879d5cd@mail.gmail.com>
	<d8ad40b51002211349k3ceb72beh58aaf9fba38af70f@mail.gmail.com>
Message-ID: <b440a3f81002211416v273a2459m75d1b4c7c0e4dbad@mail.gmail.com>

Hi Barry,

>> Dear r-sig-geo,
>>
>
>> I was able to make a SpatialPointsDataFrame just fine with the
>> following commands.
>>> library(rgdal)
>>> coordinates(floras) = c('long.cent.W','lat.cent.N')
>>> class(floras)
>> [1] "SpatialPointsDataFrame"
>> attr(,"package")
>> [1] "sp"
>>
>> but when I run writeOGR, I get an error
>>
>>> writeOGR(floras,paste(getwd(),'florasTEST.gml',sep='/'),'floras', driver = 'GML')
>> Error in writeOGR(floras, paste(getwd(), "florasTEST.gml", sep = "/"), ?:
>> ?unknown data type
>
> That's weird - writeOGR looks like it should output the type and class
> of the column when it gets this problem:
>
> else stop(paste(dfcls[i], dftof[i], "unknown data type"))
>
> ?- unless you're on a different version. Try running writeOGR in debug
> mode - do:
>
> debug(writeOGR)
>
> then run your writeOGR function call. Hit return to step a line at a
> time, and inspect variables. Or how about cutting some of your
> variables out and seeing what fixes it/breaks it?
>
> your sp object only seemed to have factors, numbers, and logicals and
> so writeOGR shouldnt have any problem with it...

Thanks for the advice! debug() helped me figure it out. If I
understand correctly it was because I did have a logical. As I read it
the file can't have a logical.

...
 dfcls <- sapply(slot(obj, "data"), function(x) class(x)[1])
    known <- c("numeric", "character", "factor", "POSIXt", "integer")
    if (!all(dfcls %in% known))
        stop("unknown data type")
....

When I removed the logical column it worked just fine.
Thanks again for all of your help,

Michael

> Barry
>
> --
> blog: http://geospaced.blogspot.com/
> web: http://www.maths.lancs.ac.uk/~rowlings
> web: http://www.rowlingson.com/
> twitter: http://twitter.com/geospacedman
> pics: http://www.flickr.com/photos/spacedman
>



-- 
Michael Denslow

I.W. Carpenter Jr. Herbarium [BOON]
Department of Biology
Appalachian State University
Boone, North Carolina U.S.A.
-- AND --
Communications Manager
Southeast Regional Network of Expertise and Collections
sernec.org

36.214177, -81.681480 +/- 3103 meters


From b.rowlingson at lancaster.ac.uk  Sun Feb 21 23:22:21 2010
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 21 Feb 2010 22:22:21 +0000
Subject: [R-sig-Geo] problem writing GML file
In-Reply-To: <b440a3f81002211328g9cb7a16u1453bb018879d5cd@mail.gmail.com>
References: <b440a3f81002211328g9cb7a16u1453bb018879d5cd@mail.gmail.com>
Message-ID: <d8ad40b51002211422p1066e20t4e531d17138a9268@mail.gmail.com>

On Sun, Feb 21, 2010 at 9:28 PM, Michael Denslow
<michael.denslow at gmail.com> wrote:

> other attached packages:
> [1] rgdal_0.6-20 sp_0.9-44

rgdal upgrade time for you I think. I have:

other attached packages:
[1] rgdal_0.6-24 sp_0.9-57

 - handles logicals and tells you the columns it can't handle when it
can't handle them!

 Actually I think this was a fix Roger did on my request...

Barry


From smartfra at msu.edu  Sun Feb 21 23:27:43 2010
From: smartfra at msu.edu (Francis Smart)
Date: Sun, 21 Feb 2010 17:27:43 -0500
Subject: [R-sig-Geo] Preparing R plots for Publication
In-Reply-To: <6634A5A114BA554C927CF724BA50404102060A9F16BB@EXCHANGE-02.zdv.uni-mainz.de>
References: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com> 
	<6634A5A114BA554C927CF724BA50404102060A9F16BB@EXCHANGE-02.zdv.uni-mainz.de>
Message-ID: <66b6c3541002211427q6bc66f51j52cdf329a9ed9fb6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100221/e08c957e/attachment.pl>

From macq at llnl.gov  Sun Feb 21 23:32:10 2010
From: macq at llnl.gov (Don MacQueen)
Date: Sun, 21 Feb 2010 14:32:10 -0800
Subject: [R-sig-Geo] Preparing R plots for Publication
In-Reply-To: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com>
References: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com>
Message-ID: <p06240801c7a76465689a@[128.115.67.9]>

The help page for postscript() mentions Times as an available option 
for the "family" argument. That's close, at least.

(And the question would be more appropriate on R-help)

-Don

At 2:35 PM -0500 2/21/10, Francis Smart wrote:
>Dear R-Users,
>
>I am attempting to submit an article using R generated plots for
>publication.  I am having a bit of difficulty figuring out how to format my
>plots suitably.
>
>Is there a small tutorial available that walks through how to format plots?
>
>If not perhaps someone could please tell me how to at least change my font
>to Times New Roman.  It does not seam to be a font that is available, yet it
>is available on my system.
>
>Thanks,
>Francis Smart
>
>--
>Francis Smart
>--------------------
>PhD Student - Michigan State University
>Agricultural, Food, and Resource Economics
>(406) 223-8108
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://*stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062


From ggrothendieck at gmail.com  Sun Feb 21 23:48:45 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 21 Feb 2010 17:48:45 -0500
Subject: [R-sig-Geo] Preparing R plots for Publication
In-Reply-To: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com>
References: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com>
Message-ID: <971536df1002211448q6454bbf8l6b874b50241af440@mail.gmail.com>

You did not mention your platform but there is info for R on Windows here:

http://www.statmethods.net/advgraphs/parameters.html
?windows
?windowsFont
file.show(file.path(R.home(), "etc", "Rdevga"))

On Sun, Feb 21, 2010 at 2:35 PM, Francis Smart <smartfra at msu.edu> wrote:
> Dear R-Users,
>
> I am attempting to submit an article using R generated plots for
> publication. ?I am having a bit of difficulty figuring out how to format my
> plots suitably.
>
> Is there a small tutorial available that walks through how to format plots?
>
> If not perhaps someone could please tell me how to at least change my font
> to Times New Roman. ?It does not seam to be a font that is available, yet it
> is available on my system.
>
> Thanks,
> Francis Smart
>
> --
> Francis Smart
> --------------------
> PhD Student - Michigan State University
> Agricultural, Food, and Resource Economics
> (406) 223-8108


From michael.denslow at gmail.com  Mon Feb 22 01:13:26 2010
From: michael.denslow at gmail.com (Michael Denslow)
Date: Sun, 21 Feb 2010 19:13:26 -0500
Subject: [R-sig-Geo] problem writing GML file
In-Reply-To: <d8ad40b51002211422p1066e20t4e531d17138a9268@mail.gmail.com>
References: <b440a3f81002211328g9cb7a16u1453bb018879d5cd@mail.gmail.com>
	<d8ad40b51002211422p1066e20t4e531d17138a9268@mail.gmail.com>
Message-ID: <b440a3f81002211613v46848417r917e718ad0f4dea7@mail.gmail.com>

Barry and List,
My apologies, I should have upgrade BEFORE posting the question.
Michael

> <michael.denslow at gmail.com> wrote:
>
>> other attached packages:
>> [1] rgdal_0.6-20 sp_0.9-44
>
> rgdal upgrade time for you I think. I have:
>
> other attached packages:
> [1] rgdal_0.6-24 sp_0.9-57
>
> ?- handles logicals and tells you the columns it can't handle when it
> can't handle them!
>
> ?Actually I think this was a fix Roger did on my request...
>
> Barry
>



-- 
Michael Denslow

I.W. Carpenter Jr. Herbarium [BOON]
Department of Biology
Appalachian State University
Boone, North Carolina U.S.A.
-- AND --
Communications Manager
Southeast Regional Network of Expertise and Collections
sernec.org

36.214177, -81.681480 +/- 3103 meters


From markus.loecher at gmail.com  Mon Feb 22 02:51:12 2010
From: markus.loecher at gmail.com (Markus Loecher)
Date: Sun, 21 Feb 2010 20:51:12 -0500
Subject: [R-sig-Geo] clipping polygons,
	overlaying big polygon on polygons
In-Reply-To: <alpine.LRH.2.00.1002211421190.29488@reclus.nhh.no>
References: <bf460e021002210510p1bc68560t8fb0ac58f92efe49@mail.gmail.com>
	<alpine.LRH.2.00.1002211421190.29488@reclus.nhh.no>
Message-ID: <bf460e021002211751m350c5e2bmf10e349c0826b1aa@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100221/e2ceac83/attachment.pl>

From aboessen at uci.edu  Mon Feb 22 05:26:19 2010
From: aboessen at uci.edu (Adam Boessen)
Date: Sun, 21 Feb 2010 20:26:19 -0800
Subject: [R-sig-Geo] Inverse distance weights and spatial error model
Message-ID: <14463480-3983-4696-B95F-C244B651B523@uci.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100221/0d7dcde6/attachment.pl>

From aboessen at uci.edu  Mon Feb 22 05:59:36 2010
From: aboessen at uci.edu (Adam Boessen)
Date: Sun, 21 Feb 2010 20:59:36 -0800
Subject: [R-sig-Geo] Inverse distance weights and spatial error model-update
Message-ID: <FC07C5AF-7CB4-48DA-8C1F-8ABCE42767D9@uci.edu>

My apologies for the duplicate list, but I forgot to use plain text in my last post, and thus there was a problem posting to archive.  Here is the post now:

Hi Everyone,
I'm new to R, so thank you in advance for your patience.  I'm using US census block groups in Buffalo New York to examine how neighborhood characteristics affect crime.  I would like to use an inverse distance weights (distance decay) of block group centroids that is banded at 1 kilometer.  In other words, I would like to create a one kilometer buffer around each of the centroids, then use row standardized inverse distance weights.  Finally, I would like to run a spatial error model using these weights.  

Here is my code:
> library(foreign)
> library(spdep)
> 
> buffalo <- read.dta("buffalo_blkgrps.dta")
> attach(buffalo)
> names(buffalo)
 [1] "bgidfp00"     "gage2900"     "gavghhinc00"  "gblack00"     "gcrwd00"     
 [6] "gethhet00"    "ghhincsdln00" "glatino00"    "gocc00"       "gowner00"    
[11] "gpop00"       "gpov00"       "assaul"       "robber"       "burglr"      
[16] "motveh"       "murder"       "larcen"       "x"            "y"           
> 
> #distance based neighbors - making a neighbor list - bounded to 1 kilometer
> coords <-(cbind(x,y))
> neigh.nb <- dnearneigh(coords, 0, 1, longlat=TRUE) 
> summary(neigh.nb)
Neighbour list object:
Number of regions: 409 
Number of nonzero links: 5298 
Percentage nonzero weights: 3.167126 
Average number of links: 12.95355 
1 region with no links:
12
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
 1  1  3  3  4  5 14 25 28 23 19 26 32 44 29 24 29 25 24 13 15 12  3  4  1  1  1 
1 least connected region:
3 with 1 link
1 most connected region:
382 with 26 links
> 
> #making inverse distance weights
> neigh.dist <- nbdists(neigh.nb, coords, longlat=TRUE) 
> inverse <- lapply(neigh.dist, function(x) (1/(x^2)))
> 
> #creating row standardized spatial weights from list
> neigh.listw <- nb2listw(inverse, style="W",zero.policy=TRUE)
Error in nb2listw(inverse, style = "W", zero.policy = TRUE) : 
  Not a neighbours list
> traceback()
2: stop("Not a neighbours list")
1: nb2listw(inverse, style = "W", zero.policy = TRUE)
> 
> 
> assault <- errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 + gethhet00 + ghhincsdln00 + glatino00 + gocc00+ gowner00 + gpov00,
+ data=buffalo,listw=neigh.listw, zero.policy=TRUE)
Error in eval(expr, envir, enclos) : object 'assaul_r' not found

The model will run when I do not include the code with the inverse weights and only interpoint distances, but it's unclear to me why I can't include the inverse distances when using nb2listw.  Any ideas on why this is occurring and/or help to alleviate this issue would be much appreciated.  The spatial error model from errorsarlm (package=spdep) will also run fine when I don't include the inverse weights.  Is there a better way to go about running this spatial error model using row standardized inverse distance weights?   Would spautolm from the spdep package be better suited for these data?  Any comments or suggestions are welcome.
Thank you for your time!  

Adam

Adam Boessen 
Doctoral Student 
Department of Criminology, Law and Society 
University of California, Irvine 
aboessen at uci.edu

p.s. If it's helpful, here is my version of R:
> version
               _                            
platform       i386-apple-darwin9.8.0       
arch           i386                         
os             darwin9.8.0                  
system         i386, darwin9.8.0            
status                                      
major          2                            
minor          10.1                         
year           2009                         
month          12                           
day            14                           
svn rev        50720                        
language       R                            
version.string R version 2.10.1 (2009-12-14)


From smartfra at msu.edu  Mon Feb 22 06:11:43 2010
From: smartfra at msu.edu (Francis Smart)
Date: Mon, 22 Feb 2010 00:11:43 -0500
Subject: [R-sig-Geo] Preparing R plots for Publication
In-Reply-To: <971536df1002211448q6454bbf8l6b874b50241af440@mail.gmail.com>
References: <66b6c3541002211135y40344e50t8c5f9388bf728a01@mail.gmail.com> 
	<971536df1002211448q6454bbf8l6b874b50241af440@mail.gmail.com>
Message-ID: <66b6c3541002212111x5bf5a946p1dd861b3284999b1@mail.gmail.com>

Thanks everybody for all of your responses.  I know it sounded like a
dumb question but I really spent a couple of hours going in circles
trying to get the right font before emailing the group.

Thanks for you patience and sorry about emailing the wrong list. I am
running a couple of versions of windows on my machine and I have
already processed the postscript graphs I needed for the publication
using the windowsFonts() function method outlined in the above link.

Take care,
Francis

On Sun, Feb 21, 2010 at 5:48 PM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> You did not mention your platform but there is info for R on Windows here:
>
> http://www.statmethods.net/advgraphs/parameters.html
> ?windows
> ?windowsFont
> file.show(file.path(R.home(), "etc", "Rdevga"))
>
> On Sun, Feb 21, 2010 at 2:35 PM, Francis Smart <smartfra at msu.edu> wrote:
>> Dear R-Users,
>>
>> I am attempting to submit an article using R generated plots for
>> publication. ?I am having a bit of difficulty figuring out how to format my
>> plots suitably.
>>
>> Is there a small tutorial available that walks through how to format plots?
>>
>> If not perhaps someone could please tell me how to at least change my font
>> to Times New Roman. ?It does not seam to be a font that is available, yet it
>> is available on my system.
>>
>> Thanks,
>> Francis Smart
>>
>> --
>> Francis Smart
>> --------------------
>> PhD Student - Michigan State University
>> Agricultural, Food, and Resource Economics
>> (406) 223-8108
>



-- 
Francis Smart
--------------------
PhD Student - Michigan State University
Agricultural, Food, and Resource Economics
(406) 223-8108


From Roger.Bivand at nhh.no  Mon Feb 22 08:28:54 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 22 Feb 2010 08:28:54 +0100 (CET)
Subject: [R-sig-Geo] clipping polygons,
 overlaying big polygon on polygons
In-Reply-To: <bf460e021002211751m350c5e2bmf10e349c0826b1aa@mail.gmail.com>
References: <bf460e021002210510p1bc68560t8fb0ac58f92efe49@mail.gmail.com>
	<alpine.LRH.2.00.1002211421190.29488@reclus.nhh.no>
	<bf460e021002211751m350c5e2bmf10e349c0826b1aa@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002220807280.32328@reclus.nhh.no>

On Sun, 21 Feb 2010, Markus Loecher wrote:

> I should have been much more specific with my question and supplied an
> example.
> In the meantime I believe I found the solution in the PBSmapping package,
> this time I will provide an example that illustrates what I am trying to
> achieve:
>
> #Get the boundaries for Manhattan:
> library(maps);
> library(PBSmapping);
> Manhattan <- map('county', 'new york,new york', plot=F);
> #define a few points in Manhattan and compute the corresponding Voronoi
> regions:
> XY <- cbind.data.frame( PID = 1, POS = 1:10,
>         X =
> c(-73.97220,-73.95456,-73.97906,-73.98685,-73.99968,-73.96716,-73.97127,-73.96524,-73.98322,-74.00587),
> Y =
> c(40.74983,40.77402,40.75022,40.73952,40.72842,40.75677,40.75112,40.75513,40.76271,40.74026)
> );
> polys <- calcVoronoi(as.PolySet(XY, projection="LL") );
> #plot the Voronoi regions:
> plotMap(polys)
> #It would be a much more meaningful plot to clip these Voronoi regions to
> the Manhattan boundaries:
> m <- as.PolySet (cbind.data.frame(PID = 1, POS = 1:length(Manhattan$x),  X =
> Manhattan$x, Y = Manhattan$y))
> plotMap(joinPolys(m, polys, "INT" ), xlim = Manhattan$range[1:2], ylim =
> Manhattan$range[3:4]);
>
> So the key operation I was looking for was simply the intersection provided
> by the function (joinPolys(..., "INT" ) from PBSmapping.

Yes, but sadly this does not solve the problem if you are going to use the 
output beyond hobby or education, as PBSmapping also uses the GPC code. 
Attempts were made to persuade the author to license his code in a more 
helpful way, but he has left his employing university, and they have 
retained the rights to his software.

Although the PBSmapping maintainers claim to have permission to ship GPC 
under GPL, I would try to stay as far away from it as possible. Once code 
using it gets into the workflow, it is really hard to remove. The spatstat 
maintainers are working hard to make users aware of the problems, which 
will not go away, I'm afraid.

If you'd like to try rgeos, please checkout or download from R-Forge. The 
gpc.poly-shadowing classes and methods now provide an intersection 
operation. Kicking the GPC habit is hard, but must be done, otherwise we 
risk spreading downstream dependencies.

Before long CRAN may have colour-coded license dependencies, and 
organisations can already block the installation of CRAN packages that 
have non-free (as in speech) licenses or that depend upstream on non-free 
packages. The akima package is another worry, but has a much clearer 
license that does permit research under noncommercial use. GPC only 
permits "non-commercial use of GPC (for example: private / hobbyist / 
education)" while "commercial research" requires a commercial use license. 
Any contract research could fall under "commercial research", because it 
generates income.

I would be very grateful for help with rgeos ...

Roger

>
> Thanks again,
> Markus
>
>
> On Sun, Feb 21, 2010 at 8:26 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Sun, 21 Feb 2010, Markus Loecher wrote:
>>
>>  Dear all,
>>> I apologize if this is too simple a question as it does appear to be a
>>> basic
>>> GIS operation but I have not found the appropriate function that performs
>>> a
>>> clipping of polygons into boundaries given by a (larger "outer") polygon.
>>> I
>>> tried overlay() from package sp and clipPolys from package PBSmapping but
>>> none converted the "inner" polygons into new ones laying inside the
>>> boundaries given by the outer polygon.
>>>
>>
>> Maybe a basic GIS operation should be done in a GIS? Otherwise, please feel
>> free to consult threads on the license problems of gpclib, and about the
>> R-forge rgeos package. If you'd like to contribute such an intersection (I
>> think you want the intersection between an arbitrary SpatialPolygons object
>> and a simple SpatialPolygons object for the outer polygon) function tool to
>> rgeos, or at least a sketch of how it might work, that would be helpful.
>>
>> Roger
>>
>>
>>> Any help would be greatly appreciated,
>>> Thanks,
>>>
>>> Markus
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Feb 22 08:38:31 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 22 Feb 2010 08:38:31 +0100 (CET)
Subject: [R-sig-Geo] Inverse distance weights and spatial error
 model-update
In-Reply-To: <FC07C5AF-7CB4-48DA-8C1F-8ABCE42767D9@uci.edu>
References: <FC07C5AF-7CB4-48DA-8C1F-8ABCE42767D9@uci.edu>
Message-ID: <alpine.LRH.2.00.1002220829020.32328@reclus.nhh.no>

On Sun, 21 Feb 2010, Adam Boessen wrote:

> My apologies for the duplicate list, but I forgot to use plain text in 
> my last post, and thus there was a problem posting to archive.  Here is 
> the post now:

Thanks for cooperating about this, keeping to plain text really helps!

>
> Hi Everyone,
> I'm new to R, so thank you in advance for your patience.  I'm using US 
> census block groups in Buffalo New York to examine how neighborhood 
> characteristics affect crime.  I would like to use an inverse distance 
> weights (distance decay) of block group centroids that is banded at 1 
> kilometer.  In other words, I would like to create a one kilometer 
> buffer around each of the centroids, then use row standardized inverse 
> distance weights.  Finally, I would like to run a spatial error model 
> using these weights.
>
> Here is my code:
>> library(foreign)
>> library(spdep)
>>
>> buffalo <- read.dta("buffalo_blkgrps.dta")
>> attach(buffalo)
>> names(buffalo)
> [1] "bgidfp00"     "gage2900"     "gavghhinc00"  "gblack00"     "gcrwd00"
> [6] "gethhet00"    "ghhincsdln00" "glatino00"    "gocc00"       "gowner00"
> [11] "gpop00"       "gpov00"       "assaul"       "robber"       "burglr"
> [16] "motveh"       "murder"       "larcen"       "x"            "y"
>>
>> #distance based neighbors - making a neighbor list - bounded to 1 kilometer
>> coords <-(cbind(x,y))
>> neigh.nb <- dnearneigh(coords, 0, 1, longlat=TRUE)

I'm assuming that you know definitely that your coordinates are 
geographical not projected - I've seen users adding longlat=TRUE when 
not appropriate.

>> summary(neigh.nb)
> Neighbour list object:
> Number of regions: 409
> Number of nonzero links: 5298
> Percentage nonzero weights: 3.167126
> Average number of links: 12.95355
> 1 region with no links:
> 12
> Link number distribution:
>
> 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26
> 1  1  3  3  4  5 14 25 28 23 19 26 32 44 29 24 29 25 24 13 15 12  3  4  1  1  1
> 1 least connected region:
> 3 with 1 link
> 1 most connected region:
> 382 with 26 links
>>
>> #making inverse distance weights
>> neigh.dist <- nbdists(neigh.nb, coords, longlat=TRUE)
>> inverse <- lapply(neigh.dist, function(x) (1/(x^2)))
>>
>> #creating row standardized spatial weights from list
>> neigh.listw <- nb2listw(inverse, style="W",zero.policy=TRUE)

No, use:

neigh.listw <- nb2listw(neigh.nb, glist=inverse, style="W",
   zero.policy=TRUE)

You pass the list of weights through the glist= argument, as in the 
example for col.w.d in ?nb2listw.

> Error in nb2listw(inverse, style = "W", zero.policy = TRUE) :
>  Not a neighbours list
>> traceback()
> 2: stop("Not a neighbours list")
> 1: nb2listw(inverse, style = "W", zero.policy = TRUE)
>>
>>
>> assault <- errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 + gethhet00 + ghhincsdln00 + glatino00 + gocc00+ gowner00 + gpov00,
> + data=buffalo,listw=neigh.listw, zero.policy=TRUE)
> Error in eval(expr, envir, enclos) : object 'assaul_r' not found
>

Well, there is no assaul_r in buffalo, is there?

Hope this helps,

Roger

> The model will run when I do not include the code with the inverse weights and only interpoint distances, but it's unclear to me why I can't include the inverse distances when using nb2listw.  Any ideas on why this is occurring and/or help to alleviate this issue would be much appreciated.  The spatial error model from errorsarlm (package=spdep) will also run fine when I don't include the inverse weights.  Is there a better way to go about running this spatial error model using row standardized inverse distance weights?   Would spautolm from the spdep package be better suited for these data?  Any comments or suggestions are welcome.
> Thank you for your time!
>
> Adam
>
> Adam Boessen
> Doctoral Student
> Department of Criminology, Law and Society
> University of California, Irvine
> aboessen at uci.edu
>
> p.s. If it's helpful, here is my version of R:
>> version
>               _
> platform       i386-apple-darwin9.8.0
> arch           i386
> os             darwin9.8.0
> system         i386, darwin9.8.0
> status
> major          2
> minor          10.1
> year           2009
> month          12
> day            14
> svn rev        50720
> language       R
> version.string R version 2.10.1 (2009-12-14)
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From aboessen at uci.edu  Mon Feb 22 09:19:20 2010
From: aboessen at uci.edu (Adam Boessen)
Date: Mon, 22 Feb 2010 00:19:20 -0800
Subject: [R-sig-Geo] Inverse distance weights and spatial error
	model-update
In-Reply-To: <alpine.LRH.2.00.1002220829020.32328@reclus.nhh.no>
References: <FC07C5AF-7CB4-48DA-8C1F-8ABCE42767D9@uci.edu>
	<alpine.LRH.2.00.1002220829020.32328@reclus.nhh.no>
Message-ID: <A3C3D2CE-60EC-4833-9204-C710BDE9AC24@uci.edu>

Hi Roger,
Thank you very much for your quick reply and for creating the spdep package.  I tried the tweaks to the code as you note below, but I still get a warning message.  I have reposted my code below with a few more questions:

> #making inverse distance weights
> neigh.dist <- nbdists(neigh.nb, coords, longlat=TRUE) 
> inverse <- lapply(neigh.dist, function(x) (1/(x^2)))
> 
> #creating row standardized spatial weights from list
> neigh.listw <- nb2listw(neigh.nb, glist=inverse, style="W", zero.policy=TRUE)
Warning message:
In nb2listw(neigh.nb, glist = inverse, style = "W", zero.policy = TRUE) :
  zero sum general weights
> warning()
Warning message:
 
There was nothing listed here.  Is this warning a problem?  I was hesitant about using glist since I didn't think it could be incorporated in the errorsarlm models (hence the error in the code below).   Would using spautolm() help to get around my error below in the model? 

> #making crime counts into rates
> assaul_r <- (assaul/gpop00)*1000
> 


Good catch on this one.  I meant to make my crime counts into rates.  I haven't found a package where I can model crime counts as Poisson or negative binomial regressions.  Any suggestions?


> #SAR MODEL
> ass05 <- errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 + gethhet00 + ghhincsdln00 + glatino00 + gocc00+ gowner00 + gpov00,data=buffalo,listw=neigh.listw, zero.policy=TRUE)
Error in subset.listw(listw, subset, zero.policy = zero.policy) : 
  Not yet able to subset general weights lists
> traceback()
4: stop("Not yet able to subset general weights lists")
3: subset.listw(listw, subset, zero.policy = zero.policy)
2: subset(listw, subset, zero.policy = zero.policy)
1: errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 + gethhet00 + 
       ghhincsdln00 + glatino00 + gocc00 + gowner00 + gpov00, data = buffalo, 
       listw = neigh.listw, zero.policy = TRUE)

 Thanks again for your help!

Adam

Adam Boessen 
Doctoral Student 
Department of Criminology, Law and Society 
University of California, Irvine 
aboessen at uci.edu


On Feb 21, 2010, at 11:38 PM, Roger Bivand wrote:

> On Sun, 21 Feb 2010, Adam Boessen wrote:
> 
>> My apologies for the duplicate list, but I forgot to use plain text in my last post, and thus there was a problem posting to archive.  Here is the post now:
> 
> Thanks for cooperating about this, keeping to plain text really helps!
> 
>> 
>> Hi Everyone,
>> I'm new to R, so thank you in advance for your patience.  I'm using US census block groups in Buffalo New York to examine how neighborhood characteristics affect crime.  I would like to use an inverse distance weights (distance decay) of block group centroids that is banded at 1 kilometer.  In other words, I would like to create a one kilometer buffer around each of the centroids, then use row standardized inverse distance weights.  Finally, I would like to run a spatial error model using these weights.
>> 
>> Here is my code:
>>> library(foreign)
>>> library(spdep)
>>> 
>>> buffalo <- read.dta("buffalo_blkgrps.dta")
>>> attach(buffalo)
>>> names(buffalo)
>> [1] "bgidfp00"     "gage2900"     "gavghhinc00"  "gblack00"     "gcrwd00"
>> [6] "gethhet00"    "ghhincsdln00" "glatino00"    "gocc00"       "gowner00"
>> [11] "gpop00"       "gpov00"       "assaul"       "robber"       "burglr"
>> [16] "motveh"       "murder"       "larcen"       "x"            "y"
>>> 
>>> #distance based neighbors - making a neighbor list - bounded to 1 kilometer
>>> coords <-(cbind(x,y))
>>> neigh.nb <- dnearneigh(coords, 0, 1, longlat=TRUE)
> 
> I'm assuming that you know definitely that your coordinates are geographical not projected - I've seen users adding longlat=TRUE when not appropriate.
> 
>>> summary(neigh.nb)
>> Neighbour list object:
>> Number of regions: 409
>> Number of nonzero links: 5298
>> Percentage nonzero weights: 3.167126
>> Average number of links: 12.95355
>> 1 region with no links:
>> 12
>> Link number distribution:
>> 
>> 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26
>> 1  1  3  3  4  5 14 25 28 23 19 26 32 44 29 24 29 25 24 13 15 12  3  4  1  1  1
>> 1 least connected region:
>> 3 with 1 link
>> 1 most connected region:
>> 382 with 26 links
>>> 
>>> #making inverse distance weights
>>> neigh.dist <- nbdists(neigh.nb, coords, longlat=TRUE)
>>> inverse <- lapply(neigh.dist, function(x) (1/(x^2)))
>>> 
>>> #creating row standardized spatial weights from list
>>> neigh.listw <- nb2listw(inverse, style="W",zero.policy=TRUE)
> 
> No, use:
> 
> neigh.listw <- nb2listw(neigh.nb, glist=inverse, style="W",
>  zero.policy=TRUE)
> 
> You pass the list of weights through the glist= argument, as in the example for col.w.d in ?nb2listw.
> 
>> Error in nb2listw(inverse, style = "W", zero.policy = TRUE) :
>> Not a neighbours list
>>> traceback()
>> 2: stop("Not a neighbours list")
>> 1: nb2listw(inverse, style = "W", zero.policy = TRUE)
>>> 
>>> 
>>> assault <- errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 + gethhet00 + ghhincsdln00 + glatino00 + gocc00+ gowner00 + gpov00,
>> + data=buffalo,listw=neigh.listw, zero.policy=TRUE)
>> Error in eval(expr, envir, enclos) : object 'assaul_r' not found
>> 
> 
> Well, there is no assaul_r in buffalo, is there?
> 
> Hope this helps,
> 
> Roger
> 
>> The model will run when I do not include the code with the inverse weights and only interpoint distances, but it's unclear to me why I can't include the inverse distances when using nb2listw.  Any ideas on why this is occurring and/or help to alleviate this issue would be much appreciated.  The spatial error model from errorsarlm (package=spdep) will also run fine when I don't include the inverse weights.  Is there a better way to go about running this spatial error model using row standardized inverse distance weights?   Would spautolm from the spdep package be better suited for these data?  Any comments or suggestions are welcome.
>> Thank you for your time!
>> 
>> Adam
>> 
>> Adam Boessen
>> Doctoral Student
>> Department of Criminology, Law and Society
>> University of California, Irvine
>> aboessen at uci.edu
>> 
>> p.s. If it's helpful, here is my version of R:
>>> version
>>              _
>> platform       i386-apple-darwin9.8.0
>> arch           i386
>> os             darwin9.8.0
>> system         i386, darwin9.8.0
>> status
>> major          2
>> minor          10.1
>> year           2009
>> month          12
>> day            14
>> svn rev        50720
>> language       R
>> version.string R version 2.10.1 (2009-12-14)
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
> 


From p.hiemstra at geo.uu.nl  Mon Feb 22 09:30:49 2010
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 22 Feb 2010 09:30:49 +0100
Subject: [R-sig-Geo] How to do cross validation for universal krigingin
 Gstat
In-Reply-To: <4B8198AB.7070102@uni-muenster.de>
References: <201002210007317966711@yahoo.com.cn>,
	<4B81649E.2000703@uni-muenster.de>	<201002211520508759213@yahoo.com.cn>
	<4B8198AB.7070102@uni-muenster.de>
Message-ID: <4B8240B9.3030701@geo.uu.nl>

Edzer Pebesma wrote:
>
>
> Kai Zhang wrote:
>> Hi Edzer,
>>
>> Thanks for your quick reply. The primary variable of my interest is 
>> temperature.  I tried to use krige.cv before, but it did not work. 
>> The problem arises because the temperature and impervious surface are 
>> from two files. For universal kriging, the krige function has a 
>> parameter called "newdata" which handles the second data file. 
>> However, the krige.cv does not include a "newdata" parameter 
>> according to the help document. There is a error when I specified two 
>> datasources when I was running krige.cv in specifying a newdata 
>> source:    
> krige only works when the secondary variable (ELE) is present both in 
> the data and in the newdata argument. krige.cv only uses the data 
> argument, where ELE is present.
>>  
>>> dtw.vgm <- variogram(Temp~ Ele, TMP)
>>> dtw.fit <- fit.variogram(dtw.vgm, model = vgm(1.45, "Exp", 9502,0))
>>> uk.kriged.am <- krige.cv(Temp~Ele,data=TMP,newdata=IMP,model=dtw.fit)
>>>     
>> Error in function (classes, fdef, mtable)  :   unable to find an 
>> inherited method for function "krige.cv", for signature "formula", 
>> "missing"
>>   
>
>> I tried to delete parameters names such as 'data' and 'newdata' 
>> according to your response to a related problem before in the 
>> R-sig-Geo archives. However, it still did not work.
>>  
Hi Kai,

The krige.cv function does not need newdata because the newdata is 
always equal to the data dataset. *Cross* validation means that you use 
the same dataset for fitting the variogram model / regression parameters 
and for validation.

Hope this makes it more clear,

cheers,
Paul
> The krige.cv documentation does not mention a newdata argument. Pls try:
>
> uk.kriged.am <- krige.cv(Temp~Ele, TMP, dtw.fit)
>
>> Thanks,
>> Kai Zhang
>>
>>
>>
>> ======= 2010-02-21 11:51:45 You wrote =======
>>
>>  
>>> Kai,
>>>
>>> krige.cv(Temp~Ele, data, model)
>>>
>>> should do the job, assuming that your primary variable of interest is
>>> temperature.
>>> -- 
>>> Edzer
>>>
>>>
>>> Kai Zhang wrote:
>>>    
>>>> Dear all,
>>>>
>>>> I am attempting several Kriging methods to interpolate temperature 
>>>> in a area. It works well for me to use krige.cv to conduct cross 
>>>> validation for ordinary kriging and gstat.cv for co-kriging. 
>>>> However, I am confused on how to conduct cv for universal kriging. 
>>>> The temperature data is from the data file 1 and the secondary 
>>>> variable with more intense sampling is from another file. Krige.cv 
>>>> does not provide a parameter on 'newdata'. When I was trying 
>>>> gstat.cv, the variogram function automatically fits cross-variogram 
>>>> after I incorporate both temperature and the secondary information 
>>>> into a gstat object. Any suggestions are welcome.
>>>>
>>>> g <- gstat(NULL,id="Temp", formula=Temp~1, data=TMP)
>>>> g <- gstat(g,id="Ele", formula=Ele~1, data=ELE)
>>>> g <- gstat(g, id = "Temp", model = vgm(1, "Exp", 44559, 1))
>>>> x <- variogram(g)
>>>>
>>>> Many thanks,
>>>> Kai Zhang
>>>>
>>>>
>>>>
>>>> __________________________________________________
>>>> ???????????????
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at stat.math.ethz.ch
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>         
>>> -- 
>>> Edzer Pebesma
>>> Institute for Geoinformatics (ifgi), University of M?nster Weseler 
>>> Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 
>>> 251 8339763  http://ifgi.uni-muenster.de 
>>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>>
>>>     
>>
>>
>> ?i??'????&
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:  +3130 274 3113 Mon-Tue
Phone:  +3130 253 5773 Wed-Fri
http://intamap.geo.uu.nl/~paul


From Roger.Bivand at nhh.no  Mon Feb 22 09:38:58 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 22 Feb 2010 09:38:58 +0100 (CET)
Subject: [R-sig-Geo] Inverse distance weights and spatial error
 model-update
In-Reply-To: <A3C3D2CE-60EC-4833-9204-C710BDE9AC24@uci.edu>
References: <FC07C5AF-7CB4-48DA-8C1F-8ABCE42767D9@uci.edu>
	<alpine.LRH.2.00.1002220829020.32328@reclus.nhh.no>
	<A3C3D2CE-60EC-4833-9204-C710BDE9AC24@uci.edu>
Message-ID: <alpine.LRH.2.00.1002220926590.32328@reclus.nhh.no>

On Mon, 22 Feb 2010, Adam Boessen wrote:

> Hi Roger, Thank you very much for your quick reply and for creating the 
> spdep package.  I tried the tweaks to the code as you note below, but I 
> still get a warning message.  I have reposted my code below with a few 
> more questions:
>
>> #making inverse distance weights
>> neigh.dist <- nbdists(neigh.nb, coords, longlat=TRUE)
>> inverse <- lapply(neigh.dist, function(x) (1/(x^2)))
>>
>> #creating row standardized spatial weights from list
>> neigh.listw <- nb2listw(neigh.nb, glist=inverse, style="W", zero.policy=TRUE)
> Warning message:
> In nb2listw(neigh.nb, glist = inverse, style = "W", zero.policy = TRUE) :
>  zero sum general weights
>> warning()
> Warning message:

>From your listing of the neighbour object, one region has no neighbours at 
the 1km threshold. This means that the general weights sum is zero for 
this region. It's a warning, not an error - you've set zero.policy to 
TRUE, so the output is OK assuming that you accept no-neighbour 
observations.

>
> There was nothing listed here.  Is this warning a problem?  I was 
> hesitant about using glist since I didn't think it could be incorporated 
> in the errorsarlm models (hence the error in the code below).  Would 
> using spautolm() help to get around my error below in the model?
>
>> #making crime counts into rates
>> assaul_r <- (assaul/gpop00)*1000
>>
>
>
> Good catch on this one.  I meant to make my crime counts into rates.  I 
> haven't found a package where I can model crime counts as Poisson or 
> negative binomial regressions.  Any suggestions?

Use disease mapping approaches, usually going out to WinBUGS or BayesX, or 
GLMM through one of the avaliable functions elsewhere in R. We discuss 
this in the final two chapters of our book, code on book website 
www.asdar-book.org. These however do not let you use the spatial weights 
in the same way. If you need these kinds of weights, then maybe the 
spatial filtering or Moran eigenvector approach might help (adding 
selected eigenvectors of the centred weights matrix to the right hand side 
variables in a regular GLM). Using a GLM (or spautolm) also lets you use 
case weights, which would likely be relevant in your case - see also 
Waller & Gotway 2004.

>>
>> #SAR MODEL
>> ass05 <- errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 + gethhet00 + ghhincsdln00 + glatino00 + gocc00+ gowner00 + gpov00,data=buffalo,listw=neigh.listw, zero.policy=TRUE)
> Error in subset.listw(listw, subset, zero.policy = zero.policy) :
>  Not yet able to subset general weights lists

It appears that one or more of your observations has missing values, and 
the function really prefers all observations to be complete. If they are 
not, and the weights are not general, it subsets the data and the weights 
to drop incomplete observations, but cannot do that if the weights are 
general. Use of complete.cases() and subset() before running the model 
will help.

Hope this helps,

Roger


>> traceback()
> 4: stop("Not yet able to subset general weights lists")
> 3: subset.listw(listw, subset, zero.policy = zero.policy)
> 2: subset(listw, subset, zero.policy = zero.policy)
> 1: errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 + gethhet00 +
>       ghhincsdln00 + glatino00 + gocc00 + gowner00 + gpov00, data = buffalo,
>       listw = neigh.listw, zero.policy = TRUE)
>
> Thanks again for your help!
>
> Adam
>
> Adam Boessen
> Doctoral Student
> Department of Criminology, Law and Society
> University of California, Irvine
> aboessen at uci.edu
>
>
> On Feb 21, 2010, at 11:38 PM, Roger Bivand wrote:
>
>> On Sun, 21 Feb 2010, Adam Boessen wrote:
>>
>>> My apologies for the duplicate list, but I forgot to use plain text in my last post, and thus there was a problem posting to archive.  Here is the post now:
>>
>> Thanks for cooperating about this, keeping to plain text really helps!
>>
>>>
>>> Hi Everyone,
>>> I'm new to R, so thank you in advance for your patience.  I'm using US census block groups in Buffalo New York to examine how neighborhood characteristics affect crime.  I would like to use an inverse distance weights (distance decay) of block group centroids that is banded at 1 kilometer.  In other words, I would like to create a one kilometer buffer around each of the centroids, then use row standardized inverse distance weights.  Finally, I would like to run a spatial error model using these weights.
>>>
>>> Here is my code:
>>>> library(foreign)
>>>> library(spdep)
>>>>
>>>> buffalo <- read.dta("buffalo_blkgrps.dta")
>>>> attach(buffalo)
>>>> names(buffalo)
>>> [1] "bgidfp00"     "gage2900"     "gavghhinc00"  "gblack00"     "gcrwd00"
>>> [6] "gethhet00"    "ghhincsdln00" "glatino00"    "gocc00"       "gowner00"
>>> [11] "gpop00"       "gpov00"       "assaul"       "robber"       "burglr"
>>> [16] "motveh"       "murder"       "larcen"       "x"            "y"
>>>>
>>>> #distance based neighbors - making a neighbor list - bounded to 1 kilometer
>>>> coords <-(cbind(x,y))
>>>> neigh.nb <- dnearneigh(coords, 0, 1, longlat=TRUE)
>>
>> I'm assuming that you know definitely that your coordinates are geographical not projected - I've seen users adding longlat=TRUE when not appropriate.
>>
>>>> summary(neigh.nb)
>>> Neighbour list object:
>>> Number of regions: 409
>>> Number of nonzero links: 5298
>>> Percentage nonzero weights: 3.167126
>>> Average number of links: 12.95355
>>> 1 region with no links:
>>> 12
>>> Link number distribution:
>>>
>>> 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26
>>> 1  1  3  3  4  5 14 25 28 23 19 26 32 44 29 24 29 25 24 13 15 12  3  4  1  1  1
>>> 1 least connected region:
>>> 3 with 1 link
>>> 1 most connected region:
>>> 382 with 26 links
>>>>
>>>> #making inverse distance weights
>>>> neigh.dist <- nbdists(neigh.nb, coords, longlat=TRUE)
>>>> inverse <- lapply(neigh.dist, function(x) (1/(x^2)))
>>>>
>>>> #creating row standardized spatial weights from list
>>>> neigh.listw <- nb2listw(inverse, style="W",zero.policy=TRUE)
>>
>> No, use:
>>
>> neigh.listw <- nb2listw(neigh.nb, glist=inverse, style="W",
>>  zero.policy=TRUE)
>>
>> You pass the list of weights through the glist= argument, as in the example for col.w.d in ?nb2listw.
>>
>>> Error in nb2listw(inverse, style = "W", zero.policy = TRUE) :
>>> Not a neighbours list
>>>> traceback()
>>> 2: stop("Not a neighbours list")
>>> 1: nb2listw(inverse, style = "W", zero.policy = TRUE)
>>>>
>>>>
>>>> assault <- errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 + gethhet00 + ghhincsdln00 + glatino00 + gocc00+ gowner00 + gpov00,
>>> + data=buffalo,listw=neigh.listw, zero.policy=TRUE)
>>> Error in eval(expr, envir, enclos) : object 'assaul_r' not found
>>>
>>
>> Well, there is no assaul_r in buffalo, is there?
>>
>> Hope this helps,
>>
>> Roger
>>
>>> The model will run when I do not include the code with the inverse weights and only interpoint distances, but it's unclear to me why I can't include the inverse distances when using nb2listw.  Any ideas on why this is occurring and/or help to alleviate this issue would be much appreciated.  The spatial error model from errorsarlm (package=spdep) will also run fine when I don't include the inverse weights.  Is there a better way to go about running this spatial error model using row standardized inverse distance weights?   Would spautolm from the spdep package be better suited for these data?  Any comments or suggestions are welcome.
>>> Thank you for your time!
>>>
>>> Adam
>>>
>>> Adam Boessen
>>> Doctoral Student
>>> Department of Criminology, Law and Society
>>> University of California, Irvine
>>> aboessen at uci.edu
>>>
>>> p.s. If it's helpful, here is my version of R:
>>>> version
>>>              _
>>> platform       i386-apple-darwin9.8.0
>>> arch           i386
>>> os             darwin9.8.0
>>> system         i386, darwin9.8.0
>>> status
>>> major          2
>>> minor          10.1
>>> year           2009
>>> month          12
>>> day            14
>>> svn rev        50720
>>> language       R
>>> version.string R version 2.10.1 (2009-12-14)
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Economic Geography Section, Department of Economics, Norwegian School of
>> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>
>
>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From carlosalberto.gutierrezcarvajal at ugent.be  Mon Feb 22 10:49:52 2010
From: carlosalberto.gutierrezcarvajal at ugent.be (Carlos Alberto Gutierrez Carvajal)
Date: Mon, 22 Feb 2010 10:49:52 +0100
Subject: [R-sig-Geo] Cell declustering examples in Gstat
Message-ID: <20100222104952.34483up1tk6v5f7k@webmail.ugent.be>

Hello everybody in the list.

My question have been treated previously by Edzer Pebesma in his  
communications with Stefano Pegoretti in july 2007, however I would  
find very useful some examples.

Basically, Edzer Pebesma pointed to two methods to perform cell declustering.

One of these methods is voronoi diagrams (avaliable in package deldir).

The other method is, in words of Edzer Pebesma, by  'using the number  
of nearest cells based on a regular discretization of the study area;  
for the latter you could misuse package gstat, interpolate record  
number with nmax=1 and compute a table of the resulting "prediction"  
grid'.

Could you provide me some examples for each one of this methods for an  
  R user,please?.

Regards,

Carlos Gutierrez Carvajal.


From edzer.pebesma at uni-muenster.de  Mon Feb 22 11:53:07 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 22 Feb 2010 11:53:07 +0100
Subject: [R-sig-Geo] Cell declustering examples in Gstat
In-Reply-To: <20100222104952.34483up1tk6v5f7k@webmail.ugent.be>
References: <20100222104952.34483up1tk6v5f7k@webmail.ugent.be>
Message-ID: <4B826213.5030704@uni-muenster.de>

Carlos, please try:

library(gstat)
data(meuse)
meuse$rn = 1:nrow(meuse)
coordinates(meuse)=~x+y
spplot(meuse["rn"])
data(meuse.grid)
gridded(meuse.grid)=~x+y
out = krige(rn~1, meuse, meuse.grid, nmax=1)
spplot(out[1])
meuse$w = as.vector(table(out[[1]])/sum(table(out[[1]])))
spplot(out[1],col.regions=bpy.colors(),sp.layout=list("sp.points",meuse))
spplot(meuse["w"], col.regions=bpy.colors())

Having a somewhat finer interpolation grid might give slightly more 
satisfactory results.

Best regards,
--
Edzer

Carlos Alberto Gutierrez Carvajal wrote:
> Hello everybody in the list.
>
> My question have been treated previously by Edzer Pebesma in his 
> communications with Stefano Pegoretti in july 2007, however I would 
> find very useful some examples.
>
> Basically, Edzer Pebesma pointed to two methods to perform cell 
> declustering.
>
> One of these methods is voronoi diagrams (avaliable in package deldir).
>
> The other method is, in words of Edzer Pebesma, by  'using the number 
> of nearest cells based on a regular discretization of the study area; 
> for the latter you could misuse package gstat, interpolate record 
> number with nmax=1 and compute a table of the resulting "prediction" 
> grid'.
>
> Could you provide me some examples for each one of this methods for an 
>  R user,please?.
>
> Regards,
>
> Carlos Gutierrez Carvajal.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From simonerfreitas at yahoo.com.br  Mon Feb 22 13:40:54 2010
From: simonerfreitas at yahoo.com.br (Simone R. Freitas)
Date: Mon, 22 Feb 2010 09:40:54 -0300
Subject: [R-sig-Geo] Raster table: how separate lines with the same value
	(count > 1)
Message-ID: <5e9beea71002220440p7c50dcd3g5da607f5778786ff@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100222/1e822922/attachment.pl>

From nikhil.list at gmail.com  Mon Feb 22 13:59:43 2010
From: nikhil.list at gmail.com (Nikhil Kaza)
Date: Mon, 22 Feb 2010 07:59:43 -0500
Subject: [R-sig-Geo] Inverse distance weights and spatial error model
In-Reply-To: <14463480-3983-4696-B95F-C244B651B523@uci.edu>
References: <14463480-3983-4696-B95F-C244B651B523@uci.edu>
Message-ID: <475ED992-BDE2-4D8B-8E99-007600D18ED2@gmail.com>



Your question would be better answered on r-sig-Geo list.  
Nevertheless, here is the solution

>> neigh.dist <- nbdists(neigh.nb, coords, longlat=TRUE)
>> inverse <- lapply(neigh.dist, function(x) (1/(x^2)))

Now instead use,
>> neigh.listw <- nb2listw(neigh.dist, glist=inverse,  
>> style="W",zero.policy=TRUE)

You have to use a nb object  to create the list.

Nikhil


On Feb 21, 2010, at 11:26 PM, Adam Boessen wrote:

> Hi Everyone,
> I'm new to R, so thank you in advance for your patience.  I'm using  
> US census block groups in Buffalo New York to examine how  
> neighborhood characteristics affect crime.  I would like to use an  
> inverse distance weights (distance decay) of block group centroids  
> that is banded at 1 kilometer.  In other words, I would like to  
> create a one kilometer buffer around each of the centroids, then use  
> row standardized inverse distance weights.  Finally, I would like to  
> run a spatial error model using these weights.
>
> Here is my code:
>> library(foreign)
>> library(spdep)
>>
>> buffalo <- read.dta("buffalo_blkgrps.dta")
>> attach(buffalo)
>> names(buffalo)
> [1] "bgidfp00"     "gage2900"     "gavghhinc00"  "gblack00"      
> "gcrwd00"
> [6] "gethhet00"    "ghhincsdln00" "glatino00"    "gocc00"        
> "gowner00"
> [11] "gpop00"       "gpov00"       "assaul"       "robber"        
> "burglr"
> [16] "motveh"       "murder"       "larcen"       "x"            "y"
>>
>> #distance based neighbors - making a neighbor list - bounded to 1  
>> kilometer
>> coords <-(cbind(x,y))
>> neigh.nb <- dnearneigh(coords, 0, 1, longlat=TRUE)
>> summary(neigh.nb)
> Neighbour list object:
> Number of regions: 409
> Number of nonzero links: 5298
> Percentage nonzero weights: 3.167126
> Average number of links: 12.95355
> 1 region with no links:
> 12
> Link number distribution:
>
> 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22  
> 23 24 25 26
> 1  1  3  3  4  5 14 25 28 23 19 26 32 44 29 24 29 25 24 13 15 12  3   
> 4  1  1  1
> 1 least connected region:
> 3 with 1 link
> 1 most connected region:
> 382 with 26 links
>>
>> #making inverse distance weights
>> neigh.dist <- nbdists(neigh.nb, coords, longlat=TRUE)
>> inverse <- lapply(neigh.dist, function(x) (1/(x^2)))
>>
>> #creating row standardized spatial weights from list
>> neigh.listw <- nb2listw(inverse, style="W",zero.policy=TRUE)
> Error in nb2listw(inverse, style = "W", zero.policy = TRUE) :
>  Not a neighbours list
>> traceback()
> 2: stop("Not a neighbours list")
> 1: nb2listw(inverse, style = "W", zero.policy = TRUE)
>>
>>
>> assault <- errorsarlm(assaul_r ~ gage2900 + gblack00 + gcrwd00 +  
>> gethhet00 + ghhincsdln00 + glatino00 + gocc00+ gowner00 + gpov00,
> + data=buffalo,listw=neigh.listw, zero.policy=TRUE)
> Error in eval(expr, envir, enclos) : object 'assaul_r' not found
>
> The model will run when I do not include the code with the inverse  
> weights and only interpoint distances, but it's unclear to me why I  
> can't include the inverse distances when using nb2listw.  Any ideas  
> on why this is occurring and/or help to alleviate this issue would  
> be much appreciated.  The spatial error model from errorsarlm  
> (package=spdep) will also run fine when I don't include the inverse  
> weights.  Is there a better way to go about running this spatial  
> error model using row standardized inverse distance weights?   Would  
> spautolm from the spdep package be better suited for these data?   
> Any comments or suggestions are welcome.
> Thank you for your time!
>
> Adam
>
> Adam Boessen
> Doctoral Student
> Department of Criminology, Law and Society
> University of California, Irvine
> aboessen at uci.edu
>
> p.s. If it's helpful, here is my version of R:
>> version
>               _
> platform       i386-apple-darwin9.8.0
> arch           i386
> os             darwin9.8.0
> system         i386, darwin9.8.0
> status
> major          2
> minor          10.1
> year           2009
> month          12
> day            14
> svn rev        50720
> language       R
> version.string R version 2.10.1 (2009-12-14)
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From egoossens at avia-gis.be  Mon Feb 22 16:12:25 2010
From: egoossens at avia-gis.be (Els Goossens)
Date: Mon, 22 Feb 2010 16:12:25 +0100
Subject: [R-sig-Geo] Error in im2asc() conversion
Message-ID: <dd16028e-c099-47c1-94c7-c1ebf21e6fb5@avia-gis.be>

Dear list,
I have an object (soil) of the class ?im? that I want to convert to an object of the class ?asc? using im2asc(). An error is returned that cellsize in X and Y directions are not identical. Inspecting the "im"-object, the dimensions of each pixel are the same (i.c. 0.01 units). Is there another way to convert these "im"-data into "asc"-data.

Thanks,
Els

> summary(soil)
real-valued pixel image
202 x 391 pixel array (ny, nx)
enclosing rectangle: [2.546947, 6.45694708336902] x [49.4855561358497, 51.5055561789202] units
dimensions of each pixel: 0.01 x 0.01 units 
Image is defined on a subset of the rectangular grid
Subset area =  3.87300016516024 square units 
Pixel values (inside window):
        range = [0,100]
        integral = 357.54941524725
        mean = 92.3184611412342
> soil.asc<-im2asc(soil)
Error in im2asc(soil) : 
  the grid cellsize should be identical for both X and Y directions.


From debeaudette at ucdavis.edu  Mon Feb 22 18:41:38 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Mon, 22 Feb 2010 09:41:38 -0800
Subject: [R-sig-Geo] Cell declustering examples in Gstat
In-Reply-To: <4B826213.5030704@uni-muenster.de>
References: <20100222104952.34483up1tk6v5f7k@webmail.ugent.be>
	<4B826213.5030704@uni-muenster.de>
Message-ID: <201002220941.38559.dylan.beaudette@gmail.com>

On Monday 22 February 2010, Edzer Pebesma wrote:
> Carlos, please try:
>
> library(gstat)
> data(meuse)
> meuse$rn = 1:nrow(meuse)
> coordinates(meuse)=~x+y
> spplot(meuse["rn"])
> data(meuse.grid)
> gridded(meuse.grid)=~x+y
> out = krige(rn~1, meuse, meuse.grid, nmax=1)
> spplot(out[1])
> meuse$w = as.vector(table(out[[1]])/sum(table(out[[1]])))
> spplot(out[1],col.regions=bpy.colors(),sp.layout=list("sp.points",meuse))
> spplot(meuse["w"], col.regions=bpy.colors())
>
> Having a somewhat finer interpolation grid might give slightly more
> satisfactory results.
>
> Best regards,
> --
> Edzer

Thanks for the example Edzer. This is a really interesting demonstration of 
cell declustering... however, pardon my lack of understanding, I can't quite 
figure out how the resulting are obtained by interpolating the row numbers. 
Can you please elaborate on how/why the use of row numbers and setting nmax=1 
produces these results?

Thanks!

Dylan


>
> Carlos Alberto Gutierrez Carvajal wrote:
> > Hello everybody in the list.
> >
> > My question have been treated previously by Edzer Pebesma in his
> > communications with Stefano Pegoretti in july 2007, however I would
> > find very useful some examples.
> >
> > Basically, Edzer Pebesma pointed to two methods to perform cell
> > declustering.
> >
> > One of these methods is voronoi diagrams (avaliable in package deldir).
> >
> > The other method is, in words of Edzer Pebesma, by  'using the number
> > of nearest cells based on a regular discretization of the study area;
> > for the latter you could misuse package gstat, interpolate record
> > number with nmax=1 and compute a table of the resulting "prediction"
> > grid'.
> >
> > Could you provide me some examples for each one of this methods for an
> >  R user,please?.
> >
> > Regards,
> >
> > Carlos Gutierrez Carvajal.
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From edzer.pebesma at uni-muenster.de  Mon Feb 22 20:06:00 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 22 Feb 2010 20:06:00 +0100
Subject: [R-sig-Geo] Cell declustering examples in Gstat
In-Reply-To: <201002220941.38559.dylan.beaudette@gmail.com>
References: <20100222104952.34483up1tk6v5f7k@webmail.ugent.be>
	<4B826213.5030704@uni-muenster.de>
	<201002220941.38559.dylan.beaudette@gmail.com>
Message-ID: <4B82D598.6070004@uni-muenster.de>



Dylan Beaudette wrote:
> On Monday 22 February 2010, Edzer Pebesma wrote:
>   
>> Carlos, please try:
>>
>> library(gstat)
>> data(meuse)
>> meuse$rn = 1:nrow(meuse)
>> coordinates(meuse)=~x+y
>> spplot(meuse["rn"])
>> data(meuse.grid)
>> gridded(meuse.grid)=~x+y
>> out = krige(rn~1, meuse, meuse.grid, nmax=1)
>> spplot(out[1])
>> meuse$w = as.vector(table(out[[1]])/sum(table(out[[1]])))
>> spplot(out[1],col.regions=bpy.colors(),sp.layout=list("sp.points",meuse))
>> spplot(meuse["w"], col.regions=bpy.colors())
>>
>> Having a somewhat finer interpolation grid might give slightly more
>> satisfactory results.
>>
>> Best regards,
>> --
>> Edzer
>>     
>
> Thanks for the example Edzer. This is a really interesting demonstration of 
> cell declustering... however, pardon my lack of understanding, I can't quite 
> figure out how the resulting are obtained by interpolating the row numbers. 
> Can you please elaborate on how/why the use of row numbers and setting nmax=1 
> produces these results?
>   
Hi Dylan,

When "interpolating" with nmax=1, you basically assign the value of the 
nearest observation to each grid cell, so, honoustly, it's hard to call 
this interpolation, it is rather something of a discretized Thiessen 
polygon. At least, this is the case for inverse distance (used in the 
example above) and ordinary/universal kriging.

Challenged to avoid the krige function, the following script assigns row 
indexes to all nearest grid cells (when executed after the one above), 
using spDists from sp to find the right index:

d = spDists(meuse, meuse.grid)
dim(d)
out$x = apply(d, 2, function(x) { which(x == min(x)) })
sum(abs(out[[1]]-out$x))
# should give 0

following that you could use the table stuff. Of course the spDists 
function computes all n x N distances, and is not recommended for large 
/ massive data sets. The idw / krige functions in gstat use a PR bucket 
quadtree (not written by me!) to efficiently find the nearest nmax 
points; this does scale up.

Best wishes,
--
Edzer
> Thanks!
>
> Dylan
>
>
>   
>> Carlos Alberto Gutierrez Carvajal wrote:
>>     
>>> Hello everybody in the list.
>>>
>>> My question have been treated previously by Edzer Pebesma in his
>>> communications with Stefano Pegoretti in july 2007, however I would
>>> find very useful some examples.
>>>
>>> Basically, Edzer Pebesma pointed to two methods to perform cell
>>> declustering.
>>>
>>> One of these methods is voronoi diagrams (avaliable in package deldir).
>>>
>>> The other method is, in words of Edzer Pebesma, by  'using the number
>>> of nearest cells based on a regular discretization of the study area;
>>> for the latter you could misuse package gstat, interpolate record
>>> number with nmax=1 and compute a table of the resulting "prediction"
>>> grid'.
>>>
>>> Could you provide me some examples for each one of this methods for an
>>>  R user,please?.
>>>
>>> Regards,
>>>
>>> Carlos Gutierrez Carvajal.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>       
>
>
>
>   

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From Tim.Haering at lwf.bayern.de  Tue Feb 23 11:42:39 2010
From: Tim.Haering at lwf.bayern.de (=?iso-8859-1?Q?H=E4ring=2C_Tim_=28LWF=29?=)
Date: Tue, 23 Feb 2010 11:42:39 +0100
Subject: [R-sig-Geo] convert nominal grid values into polygons
Message-ID: <70FC67C4A585D1489E66225A4E0238BA74D284@RZS-EXC-CL06.rz-sued.bayern.de>

Hello !

I`m looking for a way to convert a grid with nominal values into polygons. Up to now I didn`t find a way to do this in R. Maybe someone can give me a hint.

Here is what I did:

# I start with a xyz table with the coordinates and a factor variable as z-value.
# The points were regularly spaced because they were converted from a grid to apply a statistical model in R
str(dat)
'data.frame':   337842 obs. of  3 variables:
 $ soil_unit: Factor w/ 37 levels "12b","16b","3c",..: 1 1 1 2 2 2 2 2 2 2 ...
 $ X        : num  4400098 4395378 4400358 4399438 4399638 ...
 $ Y        : num  5578198 5563698 5578238 5564918 5565358 ...

gridded(dat) = ~X+Y  # to get a SpatialPixelsDataFrame

# the following I found on this list to convert 
# grid objects to spatial polygon objects
# see: http://www.mail-archive.com/r-sig-geo at stat.math.ethz.ch/msg06549.html

dat <- as(dat, "SpatialPixels")
dat <- as(dat, "SpatialPolygons")

The problem is, that every SpatialPixel is converted to one polygon - in my case 337842 polygons.
Isn`t there a way to convert a SpatialGridDataFrame or a SpatialPixelsDataFrame into a SpatialPolygonsDataFrame. Because I have nominal values the conversion has to consider the DateFrame, I think.
But something like
poly <- SpatialPolygonsDataFrame(dat, ...)
gives an error message.

Any help is very welcome.

Thanks
TIM


----------------------------------------------------------------------------------- 
Tim H?ring
Bavarian State Institute of Forest Research 
Department of Forest Ecology
Hans-Carl-von-Carlowitz-Platz 1
D-85354 Freising

E-Mail: tim.haering at lwf.bayern.de
http://www.lwf.bayern.de


From gianni.lavaredo at gmail.com  Tue Feb 23 13:55:04 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Tue, 23 Feb 2010 13:55:04 +0100
Subject: [R-sig-Geo] Convert a random point in a CROSS Invetory tools for
	line elements in a ground: Helps and suggestion
Message-ID: <518dff331002230455r8c91df9ue9dc19a3a94c2294@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100223/92614b90/attachment.pl>

From educheyne at avia-gis.be  Tue Feb 23 14:31:36 2010
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Tue, 23 Feb 2010 14:31:36 +0100
Subject: [R-sig-Geo] spixdf2kasc error
Message-ID: <FAB95D75-08A8-40CE-A5F4-B8EF32D38C9A@avia-gis.be>

Dear list
I have been working with the ADEHABITAT package for species modelling. I have data in a spatialgriddataframe and wanted to convert this to a kasc for ENFA modelling
Now I have come across an error using the spixdf2kasc function. It yields an error in cell dimensions although the grid has the same x and y resolution if you look at the spatialgriddataframe

I have managed to trace the error to rounding problem and modified the function accordingly. 
   
if (round(gr[1, 2],15) != round(gr[2, 2],15)) 
        stop("the cellsize should be the same in x and y directions")
   

My question is thus : can this also be adapted in the original spixdf2kasc function or not? How should i proceed?

Thanks for advice

From John.Carson at shawgrp.com  Tue Feb 23 15:27:12 2010
From: John.Carson at shawgrp.com (Carson, John)
Date: Tue, 23 Feb 2010 08:27:12 -0600
Subject: [R-sig-Geo] specifying beta prior with trend in krige.bayes
Message-ID: <79911294E2D6B14087F5AC36345A50BB03492295@entbtrxmb01.shawgrp.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100223/055405f8/attachment.pl>

From debeaudette at ucdavis.edu  Tue Feb 23 18:45:45 2010
From: debeaudette at ucdavis.edu (Dylan Beaudette)
Date: Tue, 23 Feb 2010 09:45:45 -0800
Subject: [R-sig-Geo] Cell declustering examples in Gstat
In-Reply-To: <4B82D598.6070004@uni-muenster.de>
References: <20100222104952.34483up1tk6v5f7k@webmail.ugent.be>
	<201002220941.38559.dylan.beaudette@gmail.com>
	<4B82D598.6070004@uni-muenster.de>
Message-ID: <201002230945.45053.dylan.beaudette@gmail.com>

On Monday 22 February 2010, Edzer Pebesma wrote:
> Dylan Beaudette wrote:
> > On Monday 22 February 2010, Edzer Pebesma wrote:
> >> Carlos, please try:
> >>
> >> library(gstat)
> >> data(meuse)
> >> meuse$rn = 1:nrow(meuse)
> >> coordinates(meuse)=~x+y
> >> spplot(meuse["rn"])
> >> data(meuse.grid)
> >> gridded(meuse.grid)=~x+y
> >> out = krige(rn~1, meuse, meuse.grid, nmax=1)
> >> spplot(out[1])
> >> meuse$w = as.vector(table(out[[1]])/sum(table(out[[1]])))
> >> spplot(out[1],col.regions=bpy.colors(),sp.layout=list("sp.points",meuse)
> >>) spplot(meuse["w"], col.regions=bpy.colors())
> >>
> >> Having a somewhat finer interpolation grid might give slightly more
> >> satisfactory results.
> >>
> >> Best regards,
> >> --
> >> Edzer
> >
> > Thanks for the example Edzer. This is a really interesting demonstration
> > of cell declustering... however, pardon my lack of understanding, I can't
> > quite figure out how the resulting are obtained by interpolating the row
> > numbers. Can you please elaborate on how/why the use of row numbers and
> > setting nmax=1 produces these results?
>
> Hi Dylan,
>
> When "interpolating" with nmax=1, you basically assign the value of the
> nearest observation to each grid cell, so, honoustly, it's hard to call
> this interpolation, it is rather something of a discretized Thiessen
> polygon. At least, this is the case for inverse distance (used in the
> example above) and ordinary/universal kriging.
>
> Challenged to avoid the krige function, the following script assigns row
> indexes to all nearest grid cells (when executed after the one above),
> using spDists from sp to find the right index:
>
> d = spDists(meuse, meuse.grid)
> dim(d)
> out$x = apply(d, 2, function(x) { which(x == min(x)) })
> sum(abs(out[[1]]-out$x))
> # should give 0
>
> following that you could use the table stuff. Of course the spDists
> function computes all n x N distances, and is not recommended for large
> / massive data sets. The idw / krige functions in gstat use a PR bucket
> quadtree (not written by me!) to efficiently find the nearest nmax
> points; this does scale up.
>
> Best wishes,
> --
> Edzer

Excellent. Thank you for the extended discussion Edzer. I'll try and work up a 
small example comparing the weights derived from this method with those 
derived from Thiessen polygons.

Cheers,
Dylan




> > Thanks!
> >
> > Dylan
> >
> >> Carlos Alberto Gutierrez Carvajal wrote:
> >>> Hello everybody in the list.
> >>>
> >>> My question have been treated previously by Edzer Pebesma in his
> >>> communications with Stefano Pegoretti in july 2007, however I would
> >>> find very useful some examples.
> >>>
> >>> Basically, Edzer Pebesma pointed to two methods to perform cell
> >>> declustering.
> >>>
> >>> One of these methods is voronoi diagrams (avaliable in package deldir).
> >>>
> >>> The other method is, in words of Edzer Pebesma, by  'using the number
> >>> of nearest cells based on a regular discretization of the study area;
> >>> for the latter you could misuse package gstat, interpolate record
> >>> number with nmax=1 and compute a table of the resulting "prediction"
> >>> grid'.
> >>>
> >>> Could you provide me some examples for each one of this methods for an
> >>>  R user,please?.
> >>>
> >>> Regards,
> >>>
> >>> Carlos Gutierrez Carvajal.
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at stat.math.ethz.ch
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341


From Bjarke.Christensen at sydbank.dk  Wed Feb 24 11:13:42 2010
From: Bjarke.Christensen at sydbank.dk (Bjarke Christensen)
Date: Wed, 24 Feb 2010 11:13:42 +0100
Subject: [R-sig-Geo] GPL polygon clipping (was: clipping polygons,
 overlaying big polygon on polygons)
In-Reply-To: <mailman.9.1266836403.30279.r-sig-geo@stat.math.ethz.ch>
Message-ID: <OF9425D313.7D719365-ONC12576D4.00364B6A-C12576D4.00383028@bdpnet.dk>

I would be happy to write a polygon clipping algorithm. I am not much of a
GIS expert, though, so I would need some hand holding - particularly for
the design requirements and definitions.

* what functions are needed?
* what should their inputs be?
* what should the output be?

For a polygon clipping function, I assume that the inputs are two polygons,
A and B, and the output is a polygon C = A - (A intersect (Not B)). Am I
right? Does anyone know of an article or comme-il-faut way to do this?

Presumably, polygon clipping would depend on a more general polygon
intersection function, if this does not already exist?

Bjarke Christensen

------------------------------

Message: 21
Date: Mon, 22 Feb 2010 08:28:54 +0100 (CET)
From: Roger Bivand <Roger.Bivand at nhh.no>
To: Markus Loecher <markus.loecher at gmail.com>
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] clipping polygons, overlaying big polygon on
             polygons
Message-ID: <alpine.LRH.2.00.1002220807280.32328 at reclus.nhh.no>
Content-Type: TEXT/PLAIN; format=flowed; charset=US-ASCII

On Sun, 21 Feb 2010, Markus Loecher wrote:

> I should have been much more specific with my question and supplied an
> example.
> In the meantime I believe I found the solution in the PBSmapping package,
> this time I will provide an example that illustrates what I am trying to
> achieve:
>
> #Get the boundaries for Manhattan:
> library(maps);
> library(PBSmapping);
> Manhattan <- map('county', 'new york,new york', plot=F);
> #define a few points in Manhattan and compute the corresponding Voronoi
> regions:
> XY <- cbind.data.frame( PID = 1, POS = 1:10,
>         X =
>
c(-73.97220,-73.95456,-73.97906,-73.98685,-73.99968,-73.96716,-73.97127,-73.96524,-73.98322,-74.00587),

> Y =
>
c(40.74983,40.77402,40.75022,40.73952,40.72842,40.75677,40.75112,40.75513,40.76271,40.74026)

> );
> polys <- calcVoronoi(as.PolySet(XY, projection="LL") );
> #plot the Voronoi regions:
> plotMap(polys)
> #It would be a much more meaningful plot to clip these Voronoi regions to
> the Manhattan boundaries:
> m <- as.PolySet (cbind.data.frame(PID = 1, POS = 1:length(Manhattan$x),
X =
> Manhattan$x, Y = Manhattan$y))
> plotMap(joinPolys(m, polys, "INT" ), xlim = Manhattan$range[1:2], ylim =
> Manhattan$range[3:4]);
>
> So the key operation I was looking for was simply the intersection
provided
> by the function (joinPolys(..., "INT" ) from PBSmapping.

Yes, but sadly this does not solve the problem if you are going to use the
output beyond hobby or education, as PBSmapping also uses the GPC code.
Attempts were made to persuade the author to license his code in a more
helpful way, but he has left his employing university, and they have
retained the rights to his software.

Although the PBSmapping maintainers claim to have permission to ship GPC
under GPL, I would try to stay as far away from it as possible. Once code
using it gets into the workflow, it is really hard to remove. The spatstat
maintainers are working hard to make users aware of the problems, which
will not go away, I'm afraid.

If you'd like to try rgeos, please checkout or download from R-Forge. The
gpc.poly-shadowing classes and methods now provide an intersection
operation. Kicking the GPC habit is hard, but must be done, otherwise we
risk spreading downstream dependencies.

Before long CRAN may have colour-coded license dependencies, and
organisations can already block the installation of CRAN packages that
have non-free (as in speech) licenses or that depend upstream on non-free
packages. The akima package is another worry, but has a much clearer
license that does permit research under noncommercial use. GPC only
permits "non-commercial use of GPC (for example: private / hobbyist /
education)" while "commercial research" requires a commercial use license.
Any contract research could fall under "commercial research", because it
generates income.

I would be very grateful for help with rgeos ...

Roger


From pazurrobert at gmail.com  Wed Feb 24 13:06:36 2010
From: pazurrobert at gmail.com (Robert Pazur)
Date: Wed, 24 Feb 2010 12:06:36 +0000
Subject: [R-sig-Geo] raster summary statistics
Message-ID: <a4655df91002240406l7f8c7910rd9977393217ed4b5@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100224/2eb8b714/attachment.pl>

From oliver.wearn08 at imperial.ac.uk  Thu Feb 25 15:34:51 2010
From: oliver.wearn08 at imperial.ac.uk (Wearn, Oliver)
Date: Thu, 25 Feb 2010 14:34:51 +0000
Subject: [R-sig-Geo] overlay() in raster package
Message-ID: <0D514038F2AECF42BBDF5C7962C11C9A037F58F9E0@ICEXM3.ic.ac.uk>

Dear all,

I'm trying to use the overlay() function in the raster package, but can't get 'if' clauses to work. Can anyone help?

I have two rasters, the first of which I would like to modify, depending on the value in the second (a forest cover raster). Specifically, if the value in the first (called ENN.500) is NA, I would like to change the value to zero, but only if the value in the forest cover raster is 1 (otherwise the value should just be left).

So, I tried:

test <- overlay(x = ENN.500,y = forest.cover,fun = function(x,y) {
  if (is.na(x))  {
    if (y==1)  {
      return(0)
    }
    else {
      return(x)
    }
  }
  else {
    return(x)
  }
})

...but I'm guessing overlay() doesn't work like this? I'm getting the following errors:

Error: object 'applymethod' not found
In addition: Warning message:
In if (is.na(x)) { :
  the condition has length > 1 and only the first element will be used

I also tried:

test <- overlay(x = ENN.500,y = forest.cover,fun = function(x,y) {
  if (x[is.na(x)])  {
    if (y[y==1])  {
      return(0)
    }
    else {
      return(x)
    }
  }
  else {
    return(x)
  }
})

...which returned the following error:

Error in .overlayList(rasters, fun = fun, filename = filename, datatype = datatype,  : 
  cannot use this formula

The alternative would be to use arithmetic operators: 

ENN.500[is.na(ENN.500] <- 0
forest.cover[forest.cover==0] <- 1
result <- ENN.500*forest.cover

...but it says in ?overlay that this is slow for very large rasters (which I will be using), so I'm guessing I should try not to use this method?

Thanks, in advance, for any help whatsoever.
Oliver

From oliver.wearn08 at imperial.ac.uk  Thu Feb 25 16:23:03 2010
From: oliver.wearn08 at imperial.ac.uk (Wearn, Oliver)
Date: Thu, 25 Feb 2010 15:23:03 +0000
Subject: [R-sig-Geo] overlay() in raster package
In-Reply-To: <20100225143902.M52406@mail.orn.mpg.de>
References: <0D514038F2AECF42BBDF5C7962C11C9A037F58F9E0@ICEXM3.ic.ac.uk>,
	<20100225143902.M52406@mail.orn.mpg.de>
Message-ID: <0D514038F2AECF42BBDF5C7962C11C9A037F58F9E1@ICEXM3.ic.ac.uk>

Thanks Kamran, unfortunately I don't think the placement of 'else' has any effect - the same errors arise.

To answer the request for more details, here's a self-contained version of what my data pretty much looks like:

require(raster)
rs <- raster(system.file("external/test.grd", package="raster"))
ENN.500<-reclass(rs,rclmat=matrix(c(200,250,NA),ncol=3,byrow=T))
forest.cover<-reclass(rs,rclmat=matrix(c(0,160,0,160,290,1,290,xmax(rs),0),ncol=3,byrow=T))
plot(stack(forest.cover,ENN.500))

Cheers,
Oliver

________________________________________
From: Kamran Safi Radolfzell [ksafi at mail.orn.mpg.de]
Sent: 25 February 2010 14:42
To: Wearn, Oliver; r-sig-geo at stat.math.ethz.ch
Cc: r-sig-geo-bounces at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] overlay() in raster package

Hi Oliver,

don't really understand what you are trying to do with the overlay, but the
"if" issue might be due to the wrong use of your "else".

if(...)
{
...
}else{  #important to have else on the same line
...
}

This might help.
If you need more help on the overlay, I guess more details would be helpful.

hth

Kami

On Thu, 25 Feb 2010 14:34:51 +0000, Wearn, Oliver wrote
> Dear all,
>
> I'm trying to use the overlay() function in the raster package, but
> can't get 'if' clauses to work. Can anyone help?
>
> I have two rasters, the first of which I would like to modify,
> depending on the value in the second (a forest cover raster).
> Specifically, if the value in the first (called ENN.500) is NA, I
> would like to change the value to zero, but only if the value in the
> forest cover raster is 1 (otherwise the value should just be left).
>
> So, I tried:
>
> test <- overlay(x = ENN.500,y = forest.cover,fun = function(x,y) {
>   if (is.na(x))  {
>     if (y==1)  {
>       return(0)
>     }
>     else {
>       return(x)
>     }
>   }
>   else {
>     return(x)
>   }
> })
>
> ...but I'm guessing overlay() doesn't work like this? I'm getting
> the following errors:
>
> Error: object 'applymethod' not found
> In addition: Warning message:
> In if (is.na(x)) { :
>   the condition has length > 1 and only the first element will be used
>
> I also tried:
>
> test <- overlay(x = ENN.500,y = forest.cover,fun = function(x,y) {
>   if (x[is.na(x)])  {
>     if (y[y==1])  {
>       return(0)
>     }
>     else {
>       return(x)
>     }
>   }
>   else {
>     return(x)
>   }
> })
>
> ...which returned the following error:
>
> Error in .overlayList(rasters, fun = fun, filename = filename,
> datatype = datatype,  :   cannot use this formula
>
> The alternative would be to use arithmetic operators:
>
> ENN.500[is.na(ENN.500] <- 0
> forest.cover[forest.cover==0] <- 1
> result <- ENN.500*forest.cover
>
> ...but it says in ?overlay that this is slow for very large rasters
> (which I will be using), so I'm guessing I should try not to use
> this method?
>
> Thanks, in advance, for any help whatsoever.
> Oliver
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


--
Open WebMail Project (http://openwebmail.org)

From r.hijmans at gmail.com  Thu Feb 25 18:12:45 2010
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 25 Feb 2010 09:12:45 -0800
Subject: [R-sig-Geo] overlay() in raster package
In-Reply-To: <0D514038F2AECF42BBDF5C7962C11C9A037F58F9E1@ICEXM3.ic.ac.uk>
References: <0D514038F2AECF42BBDF5C7962C11C9A037F58F9E0@ICEXM3.ic.ac.uk>
	<20100225143902.M52406@mail.orn.mpg.de>
	<0D514038F2AECF42BBDF5C7962C11C9A037F58F9E1@ICEXM3.ic.ac.uk>
Message-ID: <dc22b2571002250912o62145a90w771e5be20cbe4df6@mail.gmail.com>

Oliver,

The function passed to overlay should be work if the arguments are
vectors; but your function only works if the arguments are single
numbers.

Rather than this:

fun = function(x,y) {
	if (is.na(x))  {
		if (y==1)  { return(0)
		} else { return(x) }
	} else { return(x)	}
}


Do this:

fun = function(x,y) {
	x[is.na(x) & y==1] <- 0
	return(x)
}



Robert

On Thu, Feb 25, 2010 at 7:23 AM, Wearn, Oliver
<oliver.wearn08 at imperial.ac.uk> wrote:
> Thanks Kamran, unfortunately I don't think the placement of 'else' has any effect - the same errors arise.
>
> To answer the request for more details, here's a self-contained version of what my data pretty much looks like:
>
> require(raster)
> rs <- raster(system.file("external/test.grd", package="raster"))
> ENN.500<-reclass(rs,rclmat=matrix(c(200,250,NA),ncol=3,byrow=T))
> forest.cover<-reclass(rs,rclmat=matrix(c(0,160,0,160,290,1,290,xmax(rs),0),ncol=3,byrow=T))
> plot(stack(forest.cover,ENN.500))
>
> Cheers,
> Oliver
>
> ________________________________________
> From: Kamran Safi Radolfzell [ksafi at mail.orn.mpg.de]
> Sent: 25 February 2010 14:42
> To: Wearn, Oliver; r-sig-geo at stat.math.ethz.ch
> Cc: r-sig-geo-bounces at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] overlay() in raster package
>
> Hi Oliver,
>
> don't really understand what you are trying to do with the overlay, but the
> "if" issue might be due to the wrong use of your "else".
>
> if(...)
> {
> ...
> }else{ ?#important to have else on the same line
> ...
> }
>
> This might help.
> If you need more help on the overlay, I guess more details would be helpful.
>
> hth
>
> Kami
>
> On Thu, 25 Feb 2010 14:34:51 +0000, Wearn, Oliver wrote
>> Dear all,
>>
>> I'm trying to use the overlay() function in the raster package, but
>> can't get 'if' clauses to work. Can anyone help?
>>
>> I have two rasters, the first of which I would like to modify,
>> depending on the value in the second (a forest cover raster).
>> Specifically, if the value in the first (called ENN.500) is NA, I
>> would like to change the value to zero, but only if the value in the
>> forest cover raster is 1 (otherwise the value should just be left).
>>
>> So, I tried:
>>
>> test <- overlay(x = ENN.500,y = forest.cover,fun = function(x,y) {
>> ? if (is.na(x)) ?{
>> ? ? if (y==1) ?{
>> ? ? ? return(0)
>> ? ? }
>> ? ? else {
>> ? ? ? return(x)
>> ? ? }
>> ? }
>> ? else {
>> ? ? return(x)
>> ? }
>> })
>>
>> ...but I'm guessing overlay() doesn't work like this? I'm getting
>> the following errors:
>>
>> Error: object 'applymethod' not found
>> In addition: Warning message:
>> In if (is.na(x)) { :
>> ? the condition has length > 1 and only the first element will be used
>>
>> I also tried:
>>
>> test <- overlay(x = ENN.500,y = forest.cover,fun = function(x,y) {
>> ? if (x[is.na(x)]) ?{
>> ? ? if (y[y==1]) ?{
>> ? ? ? return(0)
>> ? ? }
>> ? ? else {
>> ? ? ? return(x)
>> ? ? }
>> ? }
>> ? else {
>> ? ? return(x)
>> ? }
>> })
>>
>> ...which returned the following error:
>>
>> Error in .overlayList(rasters, fun = fun, filename = filename,
>> datatype = datatype, ?: ? cannot use this formula
>>
>> The alternative would be to use arithmetic operators:
>>
>> ENN.500[is.na(ENN.500] <- 0
>> forest.cover[forest.cover==0] <- 1
>> result <- ENN.500*forest.cover
>>
>> ...but it says in ?overlay that this is slow for very large rasters
>> (which I will be using), so I'm guessing I should try not to use
>> this method?
>>
>> Thanks, in advance, for any help whatsoever.
>> Oliver
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> --
> Open WebMail Project (http://openwebmail.org)
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From oliver.wearn08 at imperial.ac.uk  Thu Feb 25 18:40:15 2010
From: oliver.wearn08 at imperial.ac.uk (Wearn, Oliver)
Date: Thu, 25 Feb 2010 17:40:15 +0000
Subject: [R-sig-Geo] overlay() in raster package
In-Reply-To: <dc22b2571002250912o62145a90w771e5be20cbe4df6@mail.gmail.com>
References: <0D514038F2AECF42BBDF5C7962C11C9A037F58F9E0@ICEXM3.ic.ac.uk>
	<20100225143902.M52406@mail.orn.mpg.de>
	<0D514038F2AECF42BBDF5C7962C11C9A037F58F9E1@ICEXM3.ic.ac.uk>,
	<dc22b2571002250912o62145a90w771e5be20cbe4df6@mail.gmail.com>
Message-ID: <0D514038F2AECF42BBDF5C7962C11C9A037F58F9E3@ICEXM3.ic.ac.uk>

Thanks Robert, that makes sense. I guess the function is working on the rasters on a row-by-row basis, rather than cell-by-cell basis.

Many thanks,
Oliver

________________________________________
From: Robert J. Hijmans [r.hijmans at gmail.com]
Sent: 25 February 2010 17:12
To: Wearn, Oliver
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] overlay() in raster package

Oliver,

The function passed to overlay should be work if the arguments are
vectors; but your function only works if the arguments are single
numbers.

Rather than this:

fun = function(x,y) {
        if (is.na(x))  {
                if (y==1)  { return(0)
                } else { return(x) }
        } else { return(x)      }
}


Do this:

fun = function(x,y) {
        x[is.na(x) & y==1] <- 0
        return(x)
}



Robert

On Thu, Feb 25, 2010 at 7:23 AM, Wearn, Oliver
<oliver.wearn08 at imperial.ac.uk> wrote:
> Thanks Kamran, unfortunately I don't think the placement of 'else' has any effect - the same errors arise.
>
> To answer the request for more details, here's a self-contained version of what my data pretty much looks like:
>
> require(raster)
> rs <- raster(system.file("external/test.grd", package="raster"))
> ENN.500<-reclass(rs,rclmat=matrix(c(200,250,NA),ncol=3,byrow=T))
> forest.cover<-reclass(rs,rclmat=matrix(c(0,160,0,160,290,1,290,xmax(rs),0),ncol=3,byrow=T))
> plot(stack(forest.cover,ENN.500))
>
> Cheers,
> Oliver
>
> ________________________________________
> From: Kamran Safi Radolfzell [ksafi at mail.orn.mpg.de]
> Sent: 25 February 2010 14:42
> To: Wearn, Oliver; r-sig-geo at stat.math.ethz.ch
> Cc: r-sig-geo-bounces at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] overlay() in raster package
>
> Hi Oliver,
>
> don't really understand what you are trying to do with the overlay, but the
> "if" issue might be due to the wrong use of your "else".
>
> if(...)
> {
> ...
> }else{  #important to have else on the same line
> ...
> }
>
> This might help.
> If you need more help on the overlay, I guess more details would be helpful.
>
> hth
>
> Kami
>
> On Thu, 25 Feb 2010 14:34:51 +0000, Wearn, Oliver wrote
>> Dear all,
>>
>> I'm trying to use the overlay() function in the raster package, but
>> can't get 'if' clauses to work. Can anyone help?
>>
>> I have two rasters, the first of which I would like to modify,
>> depending on the value in the second (a forest cover raster).
>> Specifically, if the value in the first (called ENN.500) is NA, I
>> would like to change the value to zero, but only if the value in the
>> forest cover raster is 1 (otherwise the value should just be left).
>>
>> So, I tried:
>>
>> test <- overlay(x = ENN.500,y = forest.cover,fun = function(x,y) {
>>   if (is.na(x))  {
>>     if (y==1)  {
>>       return(0)
>>     }
>>     else {
>>       return(x)
>>     }
>>   }
>>   else {
>>     return(x)
>>   }
>> })
>>
>> ...but I'm guessing overlay() doesn't work like this? I'm getting
>> the following errors:
>>
>> Error: object 'applymethod' not found
>> In addition: Warning message:
>> In if (is.na(x)) { :
>>   the condition has length > 1 and only the first element will be used
>>
>> I also tried:
>>
>> test <- overlay(x = ENN.500,y = forest.cover,fun = function(x,y) {
>>   if (x[is.na(x)])  {
>>     if (y[y==1])  {
>>       return(0)
>>     }
>>     else {
>>       return(x)
>>     }
>>   }
>>   else {
>>     return(x)
>>   }
>> })
>>
>> ...which returned the following error:
>>
>> Error in .overlayList(rasters, fun = fun, filename = filename,
>> datatype = datatype,  :   cannot use this formula
>>
>> The alternative would be to use arithmetic operators:
>>
>> ENN.500[is.na(ENN.500] <- 0
>> forest.cover[forest.cover==0] <- 1
>> result <- ENN.500*forest.cover
>>
>> ...but it says in ?overlay that this is slow for very large rasters
>> (which I will be using), so I'm guessing I should try not to use
>> this method?
>>
>> Thanks, in advance, for any help whatsoever.
>> Oliver
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> --
> Open WebMail Project (http://openwebmail.org)
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

From wmconnol at ncsu.edu  Thu Feb 25 20:05:01 2010
From: wmconnol at ncsu.edu (Mark Connolly)
Date: Thu, 25 Feb 2010 14:05:01 -0500
Subject: [R-sig-Geo] An easy way to extract an irregular volume from a
	regular SpatialPointsDataFrame
Message-ID: <4B86C9DD.8010202@ncsu.edu>

I am interpolating a SpatialGridDataFrame from an irregular volume.  I 
would like to retrieve the data as the shape of the original volume.  
Any chance there is an easy way to do such a thing?

Mark Connolly

-- 
Graduate Student, Master of Science
Department of Soil Science
North Carolina State University


From gianni.lavaredo at gmail.com  Thu Feb 25 21:24:35 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Thu, 25 Feb 2010 21:24:35 +0100
Subject: [R-sig-Geo] selection a right number in a sequance for a RS filter
	sampling
Message-ID: <518dff331002251224w1dc4b521g1b0781973409c940@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100225/bbd564da/attachment.pl>

From clint at ecy.wa.gov  Thu Feb 25 21:49:43 2010
From: clint at ecy.wa.gov (Clint Bowman)
Date: Thu, 25 Feb 2010 12:49:43 -0800 (PST)
Subject: [R-sig-Geo] selection a right number in a sequance for a RS
 filter sampling
In-Reply-To: <518dff331002251224w1dc4b521g1b0781973409c940@mail.gmail.com>
References: <518dff331002251224w1dc4b521g1b0781973409c940@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1002251237230.6629@aeolus.ecy.wa.gov>

If I understand the sequence, you want the odd columns from the odd 
rows and the even columns from the even rows to "a" and the 
remainder go to "b".  Once you have a transposed matrix, the recipe 
looks straightforward.

Clint

-- 
Clint Bowman			INTERNET:	clint at ecy.wa.gov
Air Quality Modeler		INTERNET:	clint at math.utah.edu
Department of Ecology		VOICE:		(360) 407-6815
PO Box 47600			FAX:		(360) 407-7534
Olympia, WA 98504-7600

On Thu, 25 Feb 2010, gianni lavaredo wrote:

> dear Researcher
>
> Sorry that I know this is not the right email-list and this is a basic help
> but I am doing a remotesensing filter and I am honest, I have no idea how I
> can do this.
> I have a sequance form 1 to 16
>
> > seq(1:16)
> [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16
>
> and I wish to select this combination in a vector
> a <- c(1,3,6,8,9,11,14,16)
> b <- c(2,4,5,7,10,12,13,15)
>
> following the below example
>
>> t(matrix(data = seq(1:16), nrow = 4, ncol = 4))
>     [,1] [,2] [,3] [,4]
> [1,]    1    2    3    4
> [2,]    5    6    7    8
> [3,]    9   10   11   12
> [4,]   13   14   15   16
>
> gianni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From macq at llnl.gov  Fri Feb 26 02:53:33 2010
From: macq at llnl.gov (Don MacQueen)
Date: Thu, 25 Feb 2010 17:53:33 -0800
Subject: [R-sig-Geo] Polygon hole=TRUE not being preserved?
Message-ID: <p06240806c7acd6dd39a9@[128.115.67.9]>

I'm puzzled by an apparent change of @hole from TRUE to FALSE when a 
Polygon object becomes part of a Polygons object.

Here's an example, adapted from ?overlay

r2 <- cbind(c(180042, 180545, 180553, 180314, 179955, 179142, 179437,
   179524, 179979, 180042),
   c(332373, 332026, 331426, 330889, 330683,
     331133, 331623, 332152, 332357, 332373))

r3 <- cbind( c( 179662.7, 179759.0, 180188.4, 180179.6, 179662.7),
   c(331630.3, 331270.5, 331428.4, 331674.1, 331630.3)
   )

sr2=Polygons(list(Polygon(r2)),"r2")

p3 <- Polygon(r3,hole=TRUE)
sr3=Polygons(list(p3),"r3")


Then check:

>  str(p3)
Formal class 'Polygon' [package "sp"] with 5 slots
   ..@ labpt  : num [1:2] 179930 331501
   ..@ area   : num 148546
   ..@ hole   : logi TRUE
   ..@ ringDir: int -1
   ..@ coords : num [1:5, 1:2] 179663 179759 180188 180180 179663 ...
>

Note that @hole is TRUE

>  str(sr3)
Formal class 'Polygons' [package "sp"] with 5 slots
   ..@ Polygons :List of 1
   .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
   .. .. .. ..@ labpt  : num [1:2] 179930 331501
   .. .. .. ..@ area   : num 148546
   .. .. .. ..@ hole   : logi FALSE
   .. .. .. ..@ ringDir: int 1
   .. .. .. ..@ coords : num [1:5, 1:2] 179663 180180 180188 179759 179663 ...
   ..@ plotOrder: int 1
   ..@ labpt    : num [1:2] 179930 331501
   ..@ ID       : chr "r3"
   ..@ area     : num 148546

@hole is now FALSE


This arose because when I continue with the adapted example from ?overlay:

sr=SpatialPolygons(list(sr2,sr3))
srdf=SpatialPolygonsDataFrame(sr, data.frame(i=cbind(1:2,4:3), 
row.names=c("r2","r3")))

And plot with

plot(srdf,col='red')

the red fills the entire outer polygon. I was expecting there to be a 
hole in the fill -- based on remembering this from last time I did 
this, which was *not* recent.

Am I doing something wrong?

Thanks
-Don

Session information:


Sampling[327]% R --no-save --vanilla

R version 2.10.1 (2009-12-14)
Copyright (C) 2009 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

<- cut ->


>  sessionInfo()
R version 2.10.1 (2009-12-14)
i386-apple-darwin8.11.1

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] maptools_0.7-29 lattice_0.17-26 sp_0.9-57       foreign_0.8-39

loaded via a namespace (and not attached):
[1] grid_2.10.1
Warning message:
'DESCRIPTION' file has 'Encoding' field and re-encoding is not possible


Note, finally, that although CRAN shows sp at 0.9-60, I have 
installed from three different mirrors and in all cases get 0.9-57. I 
don't know what the issue is there. I have not (yet) tried a manual 
download and install of 0.9-60.

I doubt that the warning message from sessionInfo() is relevant.


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062


From bibiko at eva.mpg.de  Fri Feb 26 10:48:18 2010
From: bibiko at eva.mpg.de (=?iso-8859-1?Q?Hans-J=F6rg_Bibiko?=)
Date: Fri, 26 Feb 2010 10:48:18 +0100
Subject: [R-sig-Geo] Coastline data for TM_WORLD_BORDERS 0.2
Message-ID: <BD314398-43A5-4D57-9159-35BD437CBA5D@eva.mpg.de>

Hi,

My task is to draw a projected map (proj=cea, lon_0=25E) based on data coming from

http://mappinghacks.com/data/TM_WORLD_BORDERS-0.2.zip (not wrld_simpl)

which should have different colours for political boundaries and coastlines AND some country polygons should be highlighted by a different colour.

My approach is to draw TM_WORLD_BORDERS and on top of it the gshhs coastline data coming from gshhs_h.b. Fine. Even I was able to get rid of the horizontal clipping lines due to my re-centered map, but it turns out that the gshhs and TM_WORLD_BORDERS differs for some regions which disturbs the map a bit.

My question is now if someone here has a coastlines object which is based on TM_WORLD_BORDERS data or know how to generate such one. Of course, my first idea was to use unionSpatialPolygons() but after an hour of calculation time I quit that process, and I'm not quite sure if unionSpatialPolygons() generates the desired coastlines since the function has to use a kind of 'threshold' due to several reasons.

Or does someone know an other approach to draw coastlines and boundaries in different colours AND to be able to colourise some country polygons?

One idea would be to use the gshhs data wbd_borders_h.b instead of TM_WORLD_BORDERS but then I cannot fill a country polygon.

Any hint would help! Many thanks in advance,

--Hans


**********************************************************
Hans-Joerg Bibiko
Max Planck Institute for Evolutionary Anthropology
Department of Linguistics
Deutscher Platz 6     phone:   +49 (0) 341 3550 341
D-04103 Leipzig       fax:     +49 (0) 341 3550 333
Germany               e-mail:  bibiko[AT]eva.mpg.de


From Roger.Bivand at nhh.no  Fri Feb 26 11:41:42 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 26 Feb 2010 11:41:42 +0100
Subject: [R-sig-Geo] Polygon hole=TRUE not being preserved?
References: <p06240806c7acd6dd39a9@[128.115.67.9]>
Message-ID: <AD51AB79BC327C40AB2C7EB75D57A3C4051308@TOLAR.valuta.nhh.no>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100226/7ba0dbf6/attachment.pl>

From gianni.lavaredo at gmail.com  Fri Feb 26 17:29:29 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Fri, 26 Feb 2010 17:29:29 +0100
Subject: [R-sig-Geo] select number in a filter matrix
Message-ID: <518dff331002260829x76495484qa4759ca5f018260a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100226/67a57962/attachment.pl>

From macq at llnl.gov  Fri Feb 26 20:06:40 2010
From: macq at llnl.gov (Don MacQueen)
Date: Fri, 26 Feb 2010 11:06:40 -0800
Subject: [R-sig-Geo] Polygon hole=TRUE not being preserved?
In-Reply-To: <AD51AB79BC327C40AB2C7EB75D57A3C4051308@TOLAR.valuta.nhh.no>
References: <p06240806c7acd6dd39a9@[128.115.67.9]>
	<AD51AB79BC327C40AB2C7EB75D57A3C4051308@TOLAR.valuta.nhh.no>
Message-ID: <p06240806c7adcc26b634@[128.115.67.9]>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100226/edfe7cc3/attachment.pl>

From jochen at hunter.cuny.edu  Fri Feb 26 21:14:08 2010
From: jochen at hunter.cuny.edu (Jochen Albrecht)
Date: Fri, 26 Feb 2010 15:14:08 -0500
Subject: [R-sig-Geo] classInt::classIntervals only for very small data sets?
In-Reply-To: <AD51AB79BC327C40AB2C7EB75D57A3C4051308@TOLAR.valuta.nhh.no>
References: <p06240806c7acd6dd39a9@[128.115.67.9]>
	<AD51AB79BC327C40AB2C7EB75D57A3C4051308@TOLAR.valuta.nhh.no>
Message-ID: <4B882B90.7040904@hunter.cuny.edu>


I am trying to do a natural breaks (Jenks) classification on a data set 
with some 300,000 observations. I started with
     salescat=classIntervals(sales, 100, style="jenks")
and cut this process off after it ran for 12 hours. Then I tried it with 
just ten classes but this made no difference.
With a subset of just 300 observations, it runs for 36 seconds.
For 1,000 records, it runs seven minutes and then throws the following 
error:
     Error in if (mat2[l, j] >= (v + mat2[i4, j - 1])) { :
       missing value where TRUE/FALSE needed
     In addition: Warning message:
     In val * val : NAs produced by integer overflow
I checked the data interactively; there are no missing or non-integer 
values.
ArcMap classifies it instantaneously without hiccups and takes about ten 
seconds for all 300,000 records (though limiting itself to a maximum of 
32 classes).
Do you have any suggestions as to what I am doing wrong or what could be 
done to resolve my problem?
Cheers,
     Jochen


From Roger.Bivand at nhh.no  Fri Feb 26 22:51:31 2010
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 26 Feb 2010 22:51:31 +0100 (CET)
Subject: [R-sig-Geo] classInt::classIntervals only for very small data
 sets?
In-Reply-To: <4B882B90.7040904@hunter.cuny.edu>
References: <p06240806c7acd6dd39a9@[128.115.67.9]>
	<AD51AB79BC327C40AB2C7EB75D57A3C4051308@TOLAR.valuta.nhh.no>
	<4B882B90.7040904@hunter.cuny.edu>
Message-ID: <alpine.LRH.2.00.1002262233580.19034@reclus.nhh.no>

On Fri, 26 Feb 2010, Jochen Albrecht wrote:

>
> I am trying to do a natural breaks (Jenks) classification on a data set with 
> some 300,000 observations. I started with
>    salescat=classIntervals(sales, 100, style="jenks")

The "jenks" method is programmed in R, the "fisher" method in Fortran. On 
my laptop, 10000 values into 100 classes with "fisher" ran in under a 
minute. The fact that Arc claims to do things (which are not documented in 
code) doesn't mean that what you see is what is actually happening. I 
believe that in an earlier thread it was suggested that Arc samples the 
input data and adds the range to be sure to include everyone. You could do 
the same if you like - "fisher" and "jenks" are very similar.

Hope this helps,

Roger

> and cut this process off after it ran for 12 hours. Then I tried it with just 
> ten classes but this made no difference.
> With a subset of just 300 observations, it runs for 36 seconds.
> For 1,000 records, it runs seven minutes and then throws the following error:
>    Error in if (mat2[l, j] >= (v + mat2[i4, j - 1])) { :
>      missing value where TRUE/FALSE needed
>    In addition: Warning message:
>    In val * val : NAs produced by integer overflow
> I checked the data interactively; there are no missing or non-integer values.

PS: Integer overflow is caused by the implementation, not by the data

> ArcMap classifies it instantaneously without hiccups and takes about ten 
> seconds for all 300,000 records (though limiting itself to a maximum of 32 
> classes).

PPS: It gives a classification among many possible "natural breaks" 
classifications, for a version of Jenks. Whether this is misleading or 
not is a different question, as is the legibility of a graphic with 100 
classes and 300000 discrete entities (unless raster, where entities do 
not differ in shape.

> Do you have any suggestions as to what I am doing wrong or what could be done 
> to resolve my problem?
> Cheers,
>    Jochen
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From gianni.lavaredo at gmail.com  Sat Feb 27 00:29:31 2010
From: gianni.lavaredo at gmail.com (gianni lavaredo)
Date: Sat, 27 Feb 2010 00:29:31 +0100
Subject: [R-sig-Geo] get attribute from line to points
Message-ID: <518dff331002261529t438dae52h5f9821d339bf2bb2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100227/740106d3/attachment.pl>

From wmconnol at ncsu.edu  Sun Feb 28 15:27:25 2010
From: wmconnol at ncsu.edu (Mark Connolly)
Date: Sun, 28 Feb 2010 09:27:25 -0500
Subject: [R-sig-Geo] bug in process definition for retrieving point pair
 indexes from varigramCloud
Message-ID: <4B8A7D4D.3080009@ncsu.edu>

gstat reference states

If cloud is TRUE: an object of class variogramCloud, with the field np 
encoding the numbers of the point pair that contributed to a variogram 
cloud estimate, as follows. The first point is found by the integer 
division of np by 2^16, the second point by the remainder of that division.

For
Classes ?variogramCloud? and 'data.frame': 3275 obs. of 6 variables:
$ np : num 8.59e+09 8.00 8.59e+09 1.29e+10 1.29e+10 ...
$ dist : num 18.8 79.2 77.8 78.7 100.1 ...
$ gamma : num 0.781 0.845 12.903 5.611 0.344 ...
$ dir.hor: num 0 0 0 0 0 0 0 0 0 0 ...
$ dir.ver: num 0 0 0 0 0 0 0 0 0 0 ...
$ id : Factor w/ 1 level "var1": 1 1 1 1 1 1 1 1 1 1 ...
- attr(*, "direct")='data.frame': 1 obs. of 2 variables:
..$ id : Factor w/ 1 level "var1": 1
..$ is.direct: logi TRUE
- attr(*, ".BigInt")= num 4.29e+09


v[1,] yields:
dist gamma dir.hor dir.ver id left right
1 18.75474 0.78125 0 0 var1 6 3


v$np[1] %/% 2^16 yields:
131072

Which is != 6

Am I misinterpreting the documentation?

-- 

Mark Connolly
Graduate Student, Master of Science
Department of Soil Science
North Carolina State University


From edzer.pebesma at uni-muenster.de  Sun Feb 28 15:49:28 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 28 Feb 2010 15:49:28 +0100
Subject: [R-sig-Geo] bug in process definition for retrieving point pair
 indexes from varigramCloud
In-Reply-To: <4B8A7D4D.3080009@ncsu.edu>
References: <4B8A7D4D.3080009@ncsu.edu>
Message-ID: <4B8A8278.7080005@uni-muenster.de>

Mark, the documentation falsely assumes all computers have 32 bits 
integers; yours seems not -- compare the .BigInt with sqrt(2^64). To see 
how the point pairs are obtained, look at:

 > gstat:::as.data.frame.variogramCloud
function (x, row.names, optional, ...)
{
    .BigInt = attr(x, ".BigInt")
    x$left = x$np%%.BigInt + 1
    x$right = x$np%/%.BigInt + 1
    x$np = NULL
    class(x) = "data.frame"
    x
}

so the .BigInt attribute is the divisor; 1 is added because the arrays 
are set up in the C code, starting at 0.
--
Edzer

Mark Connolly wrote:
> gstat reference states
>
> If cloud is TRUE: an object of class variogramCloud, with the field np 
> encoding the numbers of the point pair that contributed to a variogram 
> cloud estimate, as follows. The first point is found by the integer 
> division of np by 2^16, the second point by the remainder of that 
> division.
>
> For
> Classes ?variogramCloud? and 'data.frame': 3275 obs. of 6 variables:
> $ np : num 8.59e+09 8.00 8.59e+09 1.29e+10 1.29e+10 ...
> $ dist : num 18.8 79.2 77.8 78.7 100.1 ...
> $ gamma : num 0.781 0.845 12.903 5.611 0.344 ...
> $ dir.hor: num 0 0 0 0 0 0 0 0 0 0 ...
> $ dir.ver: num 0 0 0 0 0 0 0 0 0 0 ...
> $ id : Factor w/ 1 level "var1": 1 1 1 1 1 1 1 1 1 1 ...
> - attr(*, "direct")='data.frame': 1 obs. of 2 variables:
> ..$ id : Factor w/ 1 level "var1": 1
> ..$ is.direct: logi TRUE
> - attr(*, ".BigInt")= num 4.29e+09
>
>
> v[1,] yields:
> dist gamma dir.hor dir.ver id left right
> 1 18.75474 0.78125 0 0 var1 6 3
>
>
> v$np[1] %/% 2^16 yields:
> 131072
>
> Which is != 6
>
> Am I misinterpreting the documentation?
>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From E.Couce.07 at bristol.ac.uk  Sun Feb 28 16:14:35 2010
From: E.Couce.07 at bristol.ac.uk (ElenaC)
Date: Sun, 28 Feb 2010 07:14:35 -0800 (PST)
Subject: [R-sig-Geo] Polygon splitting at the edges of plot
Message-ID: <1267370075981-4649202.post@n2.nabble.com>


Dear all,

I'm working with a shapefile with information of different ecoregions that
I'm able to read into R as a SpatialPolygonsDataFrame object, and convert to
geographical coordinates (using spTransform). But when I try to plot it, I
find that several polygons cross the 180? meridian, and I get horizontal
lines across the plot joining the two halves of these polygons. Is there a
simple way of removing these horizontal lines from the plot? 

I have searched on the internet and found the function nowrapRecenter which
might be able to fix it, but I haven't managed to get it to do what I want.
(I dont want to change the center of the plot to a Pacific view, and I find
that even if I do it, I still get horizontal lines from other polygons that
cross the 360? meridian). 

Any help would be greatly appreciated!
Elena
-- 
View this message in context: http://n2.nabble.com/Polygon-splitting-at-the-edges-of-plot-tp4649202p4649202.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From wmconnol at ncsu.edu  Sun Feb 28 16:30:55 2010
From: wmconnol at ncsu.edu (Mark Connolly)
Date: Sun, 28 Feb 2010 10:30:55 -0500
Subject: [R-sig-Geo] bug in process definition for retrieving point pair
 indexes from varigramCloud
In-Reply-To: <4B8A8278.7080005@uni-muenster.de>
References: <4B8A7D4D.3080009@ncsu.edu> <4B8A8278.7080005@uni-muenster.de>
Message-ID: <4B8A8C2F.2010000@ncsu.edu>

Thanks.  That works better.

It looks as though the documentation has left and right (implicitly) 
switched?  I am drawing line segments in 3D space using rgl, and I don't 
care so much about the order.  Might be confusing in some cases.


On 02/28/2010 09:49 AM, Edzer Pebesma wrote:
> Mark, the documentation falsely assumes all computers have 32 bits 
> integers; yours seems not -- compare the .BigInt with sqrt(2^64). To 
> see how the point pairs are obtained, look at:
>
> > gstat:::as.data.frame.variogramCloud
> function (x, row.names, optional, ...)
> {
>    .BigInt = attr(x, ".BigInt")
>    x$left = x$np%%.BigInt + 1
>    x$right = x$np%/%.BigInt + 1
>    x$np = NULL
>    class(x) = "data.frame"
>    x
> }
>
> so the .BigInt attribute is the divisor; 1 is added because the arrays 
> are set up in the C code, starting at 0.
> -- 
> Edzer
>
> Mark Connolly wrote:
>> gstat reference states
>>
>> If cloud is TRUE: an object of class variogramCloud, with the field 
>> np encoding the numbers of the point pair that contributed to a 
>> variogram cloud estimate, as follows. The first point is found by the 
>> integer division of np by 2^16, the second point by the remainder of 
>> that division.
>>
>> For
>> Classes ?variogramCloud? and 'data.frame': 3275 obs. of 6 variables:
>> $ np : num 8.59e+09 8.00 8.59e+09 1.29e+10 1.29e+10 ...
>> $ dist : num 18.8 79.2 77.8 78.7 100.1 ...
>> $ gamma : num 0.781 0.845 12.903 5.611 0.344 ...
>> $ dir.hor: num 0 0 0 0 0 0 0 0 0 0 ...
>> $ dir.ver: num 0 0 0 0 0 0 0 0 0 0 ...
>> $ id : Factor w/ 1 level "var1": 1 1 1 1 1 1 1 1 1 1 ...
>> - attr(*, "direct")='data.frame': 1 obs. of 2 variables:
>> ..$ id : Factor w/ 1 level "var1": 1
>> ..$ is.direct: logi TRUE
>> - attr(*, ".BigInt")= num 4.29e+09
>>
>>
>> v[1,] yields:
>> dist gamma dir.hor dir.ver id left right
>> 1 18.75474 0.78125 0 0 var1 6 3
>>
>>
>> v$np[1] %/% 2^16 yields:
>> 131072
>>
>> Which is != 6
>>
>> Am I misinterpreting the documentation?
>>
>


-- 
Graduate Student, Master of Science
Department of Soil Science
North Carolina State University


From edzer.pebesma at uni-muenster.de  Sun Feb 28 16:37:21 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 28 Feb 2010 16:37:21 +0100
Subject: [R-sig-Geo] bug in process definition for retrieving point pair
 indexes from varigramCloud
In-Reply-To: <4B8A8C2F.2010000@ncsu.edu>
References: <4B8A7D4D.3080009@ncsu.edu> <4B8A8278.7080005@uni-muenster.de>
	<4B8A8C2F.2010000@ncsu.edu>
Message-ID: <4B8A8DB1.7060900@uni-muenster.de>

Well, they're called first and second, and a bit later they're named 
"left" and "right", it nowhere says that "left" is first, or second.

As you say, there's little point in making the distinction anyway; give 
me a case where it is confusing and I'll change it.
--
Edzer

Mark Connolly wrote:
> Thanks.  That works better.
>
> It looks as though the documentation has left and right (implicitly) 
> switched?  I am drawing line segments in 3D space using rgl, and I 
> don't care so much about the order.  Might be confusing in some cases.
>
>
> On 02/28/2010 09:49 AM, Edzer Pebesma wrote:
>> Mark, the documentation falsely assumes all computers have 32 bits 
>> integers; yours seems not -- compare the .BigInt with sqrt(2^64). To 
>> see how the point pairs are obtained, look at:
>>
>> > gstat:::as.data.frame.variogramCloud
>> function (x, row.names, optional, ...)
>> {
>>    .BigInt = attr(x, ".BigInt")
>>    x$left = x$np%%.BigInt + 1
>>    x$right = x$np%/%.BigInt + 1
>>    x$np = NULL
>>    class(x) = "data.frame"
>>    x
>> }
>>
>> so the .BigInt attribute is the divisor; 1 is added because the 
>> arrays are set up in the C code, starting at 0.
>> -- 
>> Edzer
>>
>> Mark Connolly wrote:
>>> gstat reference states
>>>
>>> If cloud is TRUE: an object of class variogramCloud, with the field 
>>> np encoding the numbers of the point pair that contributed to a 
>>> variogram cloud estimate, as follows. The first point is found by 
>>> the integer division of np by 2^16, the second point by the 
>>> remainder of that division.
>>>
>>> For
>>> Classes ?variogramCloud? and 'data.frame': 3275 obs. of 6 variables:
>>> $ np : num 8.59e+09 8.00 8.59e+09 1.29e+10 1.29e+10 ...
>>> $ dist : num 18.8 79.2 77.8 78.7 100.1 ...
>>> $ gamma : num 0.781 0.845 12.903 5.611 0.344 ...
>>> $ dir.hor: num 0 0 0 0 0 0 0 0 0 0 ...
>>> $ dir.ver: num 0 0 0 0 0 0 0 0 0 0 ...
>>> $ id : Factor w/ 1 level "var1": 1 1 1 1 1 1 1 1 1 1 ...
>>> - attr(*, "direct")='data.frame': 1 obs. of 2 variables:
>>> ..$ id : Factor w/ 1 level "var1": 1
>>> ..$ is.direct: logi TRUE
>>> - attr(*, ".BigInt")= num 4.29e+09
>>>
>>>
>>> v[1,] yields:
>>> dist gamma dir.hor dir.ver id left right
>>> 1 18.75474 0.78125 0 0 var1 6 3
>>>
>>>
>>> v$np[1] %/% 2^16 yields:
>>> 131072
>>>
>>> Which is != 6
>>>
>>> Am I misinterpreting the documentation?
>>>
>>
>
>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From pierces1 at msu.edu  Sun Feb 28 17:34:50 2010
From: pierces1 at msu.edu (Steven J. Pierce)
Date: Sun, 28 Feb 2010 11:34:50 -0500
Subject: [R-sig-Geo] Multilevel model with CAR structure for
	neighborhood-level intercepts
Message-ID: <55482FCBC165490D99B5248AA241701B@TheVoid>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20100228/5f9ef206/attachment.pl>

From wmconnol at ncsu.edu  Sun Feb 28 20:16:57 2010
From: wmconnol at ncsu.edu (Mark Connolly)
Date: Sun, 28 Feb 2010 14:16:57 -0500
Subject: [R-sig-Geo] bug in process definition for retrieving point pair
 indexes from varigramCloud
In-Reply-To: <4B8A8DB1.7060900@uni-muenster.de>
References: <4B8A7D4D.3080009@ncsu.edu> <4B8A8278.7080005@uni-muenster.de>
	<4B8A8C2F.2010000@ncsu.edu> <4B8A8DB1.7060900@uni-muenster.de>
Message-ID: <4B8AC129.6080306@ncsu.edu>

Does .BigInt always exist and always contain the appropriate divisor 
regardless of the architecture?  If not, does it exist _only_ for 64-bit 
architectures?

Is the result of the operation always an offset, regardless of the 
architecture?  (I am presuming yes, but I don't have access to a 32-bit 
machine right now).

If I am writing R code to extract left and right appropriately, I'd like 
to make sure it is portable across architectures.  I am presuming that 
this is the best way to get left and right.  Capturing the results of 
print(variogramCloud) seems kludgy.

Better method than both of these available?


On 02/28/2010 10:37 AM, Edzer Pebesma wrote:
> Well, they're called first and second, and a bit later they're named 
> "left" and "right", it nowhere says that "left" is first, or second.
>
> As you say, there's little point in making the distinction anyway; 
> give me a case where it is confusing and I'll change it.
> -- 
> Edzer
>
> Mark Connolly wrote:
>> Thanks.  That works better.
>>
>> It looks as though the documentation has left and right (implicitly) 
>> switched?  I am drawing line segments in 3D space using rgl, and I 
>> don't care so much about the order.  Might be confusing in some cases.
>>
>>
>> On 02/28/2010 09:49 AM, Edzer Pebesma wrote:
>>> Mark, the documentation falsely assumes all computers have 32 bits 
>>> integers; yours seems not -- compare the .BigInt with sqrt(2^64). To 
>>> see how the point pairs are obtained, look at:
>>>
>>> > gstat:::as.data.frame.variogramCloud
>>> function (x, row.names, optional, ...)
>>> {
>>>    .BigInt = attr(x, ".BigInt")
>>>    x$left = x$np%%.BigInt + 1
>>>    x$right = x$np%/%.BigInt + 1
>>>    x$np = NULL
>>>    class(x) = "data.frame"
>>>    x
>>> }
>>>
>>> so the .BigInt attribute is the divisor; 1 is added because the 
>>> arrays are set up in the C code, starting at 0.
>>> -- 
>>> Edzer
>>>
>>> Mark Connolly wrote:
>>>> gstat reference states
>>>>
>>>> If cloud is TRUE: an object of class variogramCloud, with the field 
>>>> np encoding the numbers of the point pair that contributed to a 
>>>> variogram cloud estimate, as follows. The first point is found by 
>>>> the integer division of np by 2^16, the second point by the 
>>>> remainder of that division.
>>>>
>>>> For
>>>> Classes ?variogramCloud? and 'data.frame': 3275 obs. of 6 variables:
>>>> $ np : num 8.59e+09 8.00 8.59e+09 1.29e+10 1.29e+10 ...
>>>> $ dist : num 18.8 79.2 77.8 78.7 100.1 ...
>>>> $ gamma : num 0.781 0.845 12.903 5.611 0.344 ...
>>>> $ dir.hor: num 0 0 0 0 0 0 0 0 0 0 ...
>>>> $ dir.ver: num 0 0 0 0 0 0 0 0 0 0 ...
>>>> $ id : Factor w/ 1 level "var1": 1 1 1 1 1 1 1 1 1 1 ...
>>>> - attr(*, "direct")='data.frame': 1 obs. of 2 variables:
>>>> ..$ id : Factor w/ 1 level "var1": 1
>>>> ..$ is.direct: logi TRUE
>>>> - attr(*, ".BigInt")= num 4.29e+09
>>>>
>>>>
>>>> v[1,] yields:
>>>> dist gamma dir.hor dir.ver id left right
>>>> 1 18.75474 0.78125 0 0 var1 6 3
>>>>
>>>>
>>>> v$np[1] %/% 2^16 yields:
>>>> 131072
>>>>
>>>> Which is != 6
>>>>
>>>> Am I misinterpreting the documentation?
>>>>
>>>
>>
>>
>


-- 
Graduate Student, Master of Science
Department of Soil Science
North Carolina State University


From edzer.pebesma at uni-muenster.de  Sun Feb 28 20:24:33 2010
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 28 Feb 2010 20:24:33 +0100
Subject: [R-sig-Geo] bug in process definition for retrieving point pair
 indexes from varigramCloud
In-Reply-To: <4B8AC129.6080306@ncsu.edu>
References: <4B8A7D4D.3080009@ncsu.edu> <4B8A8278.7080005@uni-muenster.de>
	<4B8A8C2F.2010000@ncsu.edu> <4B8A8DB1.7060900@uni-muenster.de>
	<4B8AC129.6080306@ncsu.edu>
Message-ID: <4B8AC2F1.9080708@uni-muenster.de>



Mark Connolly wrote:
> Does .BigInt always exist and always contain the appropriate divisor 
> regardless of the architecture?  If not, does it exist _only_ for 
> 64-bit architectures?
It always exists, and gives the right number for division - platform 
dependent. Using a system constant wouldn't make the object portable 
across architectures, assuming someone would want to do this of course.
>
> Is the result of the operation always an offset, regardless of the 
> architecture?  (I am presuming yes, but I don't have access to a 
> 32-bit machine right now).
Yes. (It is 2^16 on 32 bits machines)
>
> If I am writing R code to extract left and right appropriately, I'd 
> like to make sure it is portable across architectures.  I am presuming 
> that this is the best way to get left and right.  Capturing the 
> results of print(variogramCloud) seems kludgy.
> Better method than both of these available?
Update your gstat package; the newer has an as.data.frame.variogramCloud 
method, which avoids this kludge; just do an

as.data.frame(obj)
>
>
> On 02/28/2010 10:37 AM, Edzer Pebesma wrote:
>> Well, they're called first and second, and a bit later they're named 
>> "left" and "right", it nowhere says that "left" is first, or second.
>>
>> As you say, there's little point in making the distinction anyway; 
>> give me a case where it is confusing and I'll change it.
>> -- 
>> Edzer
>>
>> Mark Connolly wrote:
>>> Thanks.  That works better.
>>>
>>> It looks as though the documentation has left and right (implicitly) 
>>> switched?  I am drawing line segments in 3D space using rgl, and I 
>>> don't care so much about the order.  Might be confusing in some cases.
>>>
>>>
>>> On 02/28/2010 09:49 AM, Edzer Pebesma wrote:
>>>> Mark, the documentation falsely assumes all computers have 32 bits 
>>>> integers; yours seems not -- compare the .BigInt with sqrt(2^64). 
>>>> To see how the point pairs are obtained, look at:
>>>>
>>>> > gstat:::as.data.frame.variogramCloud
>>>> function (x, row.names, optional, ...)
>>>> {
>>>>    .BigInt = attr(x, ".BigInt")
>>>>    x$left = x$np%%.BigInt + 1
>>>>    x$right = x$np%/%.BigInt + 1
>>>>    x$np = NULL
>>>>    class(x) = "data.frame"
>>>>    x
>>>> }
>>>>
>>>> so the .BigInt attribute is the divisor; 1 is added because the 
>>>> arrays are set up in the C code, starting at 0.
>>>> -- 
>>>> Edzer
>>>>
>>>> Mark Connolly wrote:
>>>>> gstat reference states
>>>>>
>>>>> If cloud is TRUE: an object of class variogramCloud, with the 
>>>>> field np encoding the numbers of the point pair that contributed 
>>>>> to a variogram cloud estimate, as follows. The first point is 
>>>>> found by the integer division of np by 2^16, the second point by 
>>>>> the remainder of that division.
>>>>>
>>>>> For
>>>>> Classes ?variogramCloud? and 'data.frame': 3275 obs. of 6 variables:
>>>>> $ np : num 8.59e+09 8.00 8.59e+09 1.29e+10 1.29e+10 ...
>>>>> $ dist : num 18.8 79.2 77.8 78.7 100.1 ...
>>>>> $ gamma : num 0.781 0.845 12.903 5.611 0.344 ...
>>>>> $ dir.hor: num 0 0 0 0 0 0 0 0 0 0 ...
>>>>> $ dir.ver: num 0 0 0 0 0 0 0 0 0 0 ...
>>>>> $ id : Factor w/ 1 level "var1": 1 1 1 1 1 1 1 1 1 1 ...
>>>>> - attr(*, "direct")='data.frame': 1 obs. of 2 variables:
>>>>> ..$ id : Factor w/ 1 level "var1": 1
>>>>> ..$ is.direct: logi TRUE
>>>>> - attr(*, ".BigInt")= num 4.29e+09
>>>>>
>>>>>
>>>>> v[1,] yields:
>>>>> dist gamma dir.hor dir.ver id left right
>>>>> 1 18.75474 0.78125 0 0 var1 6 3
>>>>>
>>>>>
>>>>> v$np[1] %/% 2^16 yields:
>>>>> 131072
>>>>>
>>>>> Which is != 6
>>>>>
>>>>> Am I misinterpreting the documentation?
>>>>>
>>>>
>>>
>>>
>>
>
>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster 
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de 
http://www.52north.org/geostatistics      e.pebesma at wwu.de


